
<!DOCTYPE html><html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 7.1.1">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>CANopen - 玲璐</title>

  
    <meta name="description" content="项目地址  CANopenNode https:&#x2F;&#x2F;github.com&#x2F;CANopenNode&#x2F;CANopenNode CANopenLinux https:&#x2F;&#x2F;github.com&#x2F;CANopenNode&#x2F;CANopenLinux CANopenDemo https:&#x2F;&#x2F;github.com&#x2F;CANopenNode&#x2F;CANopenDemo CANopenEditor https:&#x2F;&#x2F;githu">
<meta property="og:type" content="article">
<meta property="og:title" content="CANopen">
<meta property="og:url" content="http://liuluhua.github.io/2024/05/24/%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE-CAN-CANopen/index.html">
<meta property="og:site_name" content="玲璐">
<meta property="og:description" content="项目地址  CANopenNode https:&#x2F;&#x2F;github.com&#x2F;CANopenNode&#x2F;CANopenNode CANopenLinux https:&#x2F;&#x2F;github.com&#x2F;CANopenNode&#x2F;CANopenLinux CANopenDemo https:&#x2F;&#x2F;github.com&#x2F;CANopenNode&#x2F;CANopenDemo CANopenEditor https:&#x2F;&#x2F;githu">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/20/20240520145302.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523133451.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523161558.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523134834.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/20/20240520150656.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523142652.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523135609.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523161012.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523165217.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/20/20240520151626.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523150230.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/20/20240520153535.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523152443.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523152452.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523152500.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523152715.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523152725.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523162157.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/20/20240520153344.png">
<meta property="og:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523114715.png">
<meta property="article:published_time" content="2024-05-24T01:48:06.353Z">
<meta property="article:modified_time" content="2024-05-24T01:48:34.306Z">
<meta property="article:author" content="liuluhua">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/20/20240520145302.png">
  
  
  
  

  <!-- feed -->
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  

  

  
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/21/20240521095147.jpg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">玲璐</div><div class="sub cap">玲璐的充电站</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="Search"></form><div id="search-result"></div><div class="search-no-result">No Results!</div></div>


<nav class="menu dis-select"><a class="nav-item active" title="博客" href="/" style="color:#1BCDFC"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M5.879 2.879C5 3.757 5 5.172 5 8v8c0 2.828 0 4.243.879 5.121C6.757 22 8.172 22 11 22h2c2.828 0 4.243 0 5.121-.879C19 20.243 19 18.828 19 16V8c0-2.828 0-4.243-.879-5.121C17.243 2 15.828 2 13 2h-2c-2.828 0-4.243 0-5.121.879M8.25 17a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75M9 12.25a.75.75 0 0 0 0 1.5h6a.75.75 0 0 0 0-1.5zM8.25 9A.75.75 0 0 1 9 8.25h6a.75.75 0 0 1 0 1.5H9A.75.75 0 0 1 8.25 9" clip-rule="evenodd"/><path fill="currentColor" d="M5.235 4.058C5 4.941 5 6.177 5 8v8c0 1.823 0 3.058.235 3.942L5 19.924c-.975-.096-1.631-.313-2.121-.803C2 18.243 2 16.828 2 14v-4c0-2.829 0-4.243.879-5.121c.49-.49 1.146-.707 2.121-.803zm13.53 15.884C19 19.058 19 17.822 19 16V8c0-1.823 0-3.059-.235-3.942l.235.018c.975.096 1.631.313 2.121.803C22 5.757 22 7.17 22 9.999v4c0 2.83 0 4.243-.879 5.122c-.49.49-1.146.707-2.121.803z" opacity=".5"/></svg></a><a class="nav-item" title="文档" href="/wiki/" style="color:#3DC550"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M14.25 4.48v3.057c0 .111 0 .27.02.406a.936.936 0 0 0 .445.683a.96.96 0 0 0 .783.072c.13-.04.272-.108.378-.159L17 8.005l1.124.534c.106.05.248.119.378.16a.958.958 0 0 0 .783-.073a.936.936 0 0 0 .444-.683c.021-.136.021-.295.021-.406V3.031c.113-.005.224-.01.332-.013C21.154 2.98 22 3.86 22 4.933v11.21c0 1.112-.906 2.01-2.015 2.08c-.97.06-2.108.179-2.985.41c-1.082.286-1.99 1.068-3.373 1.436c-.626.167-1.324.257-1.627.323V5.174c.32-.079 1.382-.203 1.674-.371c.184-.107.377-.216.576-.323m5.478 8.338a.75.75 0 0 1-.546.91l-4 1a.75.75 0 0 1-.364-1.456l4-1a.75.75 0 0 1 .91.546" clip-rule="evenodd"/><path fill="currentColor" d="M18.25 3.151c-.62.073-1.23.18-1.75.336a8.2 8.2 0 0 0-.75.27v3.182l.75-.356l.008-.005a1.13 1.13 0 0 1 .492-.13c.047 0 .094.004.138.01c.175.029.315.1.354.12l.009.005l.749.356V3.647z"/><path fill="currentColor" d="M12 5.214c-.334-.064-1.057-.161-1.718-.339C8.938 4.515 8.05 3.765 7 3.487c-.887-.234-2.041-.352-3.018-.412C2.886 3.007 2 3.9 2 4.998v11.146c0 1.11.906 2.01 2.015 2.079c.97.06 2.108.179 2.985.41c.486.129 1.216.431 1.873.726c1.005.451 2.052.797 3.127 1.034z" opacity=".5"/><path fill="currentColor" d="M4.273 12.818a.75.75 0 0 1 .91-.545l4 1a.75.75 0 1 1-.365 1.455l-4-1a.75.75 0 0 1-.545-.91m.909-4.545a.75.75 0 1 0-.364 1.455l4 1a.75.75 0 0 0 .364-1.455z"/></svg></a><a class="nav-item" title="探索" href="/explore/" style="color:#FA6400"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M20 12a8 8 0 1 1-16 0a8 8 0 0 1 16 0" opacity=".5"/><path fill="currentColor" d="M17.712 5.453c1.047-.193 2.006-.259 2.797-.152c.77.103 1.536.393 1.956 1.064c.446.714.312 1.542-.012 2.258c-.33.728-.918 1.499-1.672 2.268c-1.516 1.547-3.836 3.226-6.597 4.697c-2.763 1.472-5.495 2.484-7.694 2.92c-1.095.217-2.098.299-2.923.201c-.8-.095-1.6-.383-2.032-1.075c-.47-.752-.296-1.63.07-2.379c.375-.768 1.032-1.586 1.872-2.403L4 12.416c0 .219.083.71.168 1.146c.045.23.09.444.123.596c-.652.666-1.098 1.263-1.339 1.756c-.277.567-.208.825-.145.925c.072.116.305.305.937.38c.609.073 1.44.018 2.455-.183c2.02-.4 4.613-1.351 7.28-2.772c2.667-1.42 4.85-3.015 6.23-4.423c.694-.707 1.15-1.334 1.377-1.836c.233-.515.167-.75.107-.844c-.07-.112-.289-.294-.883-.374c-.542-.072-1.272-.041-2.163.112L16.87 5.656c.338-.101.658-.17.842-.203"/></svg></a><a class="nav-item" title="社交" href="/friends/" style="color:#F44336"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="m13.629 20.472l-.542.916c-.483.816-1.69.816-2.174 0l-.542-.916c-.42-.71-.63-1.066-.968-1.262c-.338-.197-.763-.204-1.613-.219c-1.256-.021-2.043-.098-2.703-.372a5 5 0 0 1-2.706-2.706C2 14.995 2 13.83 2 11.5v-1c0-3.273 0-4.91.737-6.112a5 5 0 0 1 1.65-1.651C5.59 2 7.228 2 10.5 2h3c3.273 0 4.91 0 6.113.737a5 5 0 0 1 1.65 1.65C22 5.59 22 7.228 22 10.5v1c0 2.33 0 3.495-.38 4.413a5 5 0 0 1-2.707 2.706c-.66.274-1.447.35-2.703.372c-.85.015-1.275.022-1.613.219c-.338.196-.548.551-.968 1.262" opacity=".5"/><path fill="currentColor" d="M10.99 14.308c-1.327-.978-3.49-2.84-3.49-4.593c0-2.677 2.475-3.677 4.5-1.609c2.025-2.068 4.5-1.068 4.5 1.609c0 1.752-2.163 3.615-3.49 4.593c-.454.335-.681.502-1.01.502c-.329 0-.556-.167-1.01-.502"/></svg></a></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">Recent Update</span></div><div class="widget-body fs14"><a class="item title" href="/2024/05/24/%E5%85%B6%E4%BB%96-3D%E6%89%93%E5%8D%B0%E6%9C%BA-3D%E6%89%93%E5%8D%B0%E7%9B%B8%E5%85%B3%E8%BD%AF%E4%BB%B6/"><span class="title">3D打印相关软件</span></a><a class="item title" href="/2024/05/24/%E5%85%B6%E4%BB%96-%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1-16-8%E7%A6%81%E9%A3%9F%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/"><span class="title">16-8禁食软件架构设计</span></a><a class="item title" href="/2024/05/24/%E5%85%B6%E4%BB%96-%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1-%E6%96%87%E4%BB%B6%E5%A4%B9%E5%8F%8C%E5%90%91%E5%90%8C%E6%AD%A5%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/"><span class="title">文件夹双向同步软件设计</span></a><a class="item title" href="/2024/05/24/%E5%85%B6%E4%BB%96-%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1-%E6%A4%8D%E7%89%A9%E5%A4%A7%E6%88%98%E5%83%B5%E5%B0%B8%E6%B8%B8%E6%88%8F%E6%9E%B6%E6%9E%84/"><span class="title">植物大战僵尸游戏架构</span></a><a class="item title" href="/2024/05/24/%E5%85%B6%E4%BB%96-%E9%98%85%E8%AF%BB-%E4%BA%8E%E6%98%AF%E4%BD%A0%E5%B9%BB%E6%83%B3%E5%8E%BB%E6%97%85%E8%A1%8C/"><span class="title">于是你幻想去旅行</span></a><a class="item title" href="/2024/05/24/%E5%85%B6%E4%BB%96-%E9%98%85%E8%AF%BB-%E5%A4%AA%E9%98%B3%E7%9A%84%E5%AF%BF%E5%91%BD/"><span class="title">太阳的寿命</span></a><a class="item title" href="/2024/05/24/%E5%85%B6%E4%BB%96-%E9%98%85%E8%AF%BB-%E4%B8%AD%E5%8D%8E%E5%AD%97%E7%BB%8F/"><span class="title">中华字经</span></a><a class="item title" href="/2024/05/24/%E5%85%B6%E4%BB%96-%E9%98%85%E8%AF%BB-%E6%8D%A2%E4%BA%86%E4%B8%89%E4%BB%BD%E5%B7%A5%E4%BD%9C/"><span class="title">换了三份工作</span></a><a class="item title" href="/2024/05/24/%E5%85%B6%E4%BB%96-%E9%98%85%E8%AF%BB-%E7%94%9F%E4%B9%8B%E6%84%8F%E4%B9%89/"><span class="title">生之意义</span></a><a class="item title" href="/2024/05/24/%E5%85%B6%E4%BB%96-%E9%98%85%E8%AF%BB-%E8%A2%AB15%E5%BC%A0%E5%81%87%E9%92%9E%E6%89%93%E8%90%BD%E7%9A%84%E4%BA%BA%E7%94%9F/"><span class="title">被15张假钞打落的人生</span></a></div></widget>
</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="/" rel="noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/08a41b181ce68.svg"/></a><a class="social" href="/" rel="noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/3845874.svg"/></a><a class="social" href="/" rel="noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/3616429.svg"/></a><a class="social" href="/about/#comments" rel="noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/942ebbf1a4b91.svg"/></a><a class="social" onclick="switchTheme()"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" fill-rule="evenodd" d="M582.4 326.4c-140.8 0-256 115.2-256 256s115.2 256 256 256 256-115.2 256-256-115.2-256-256-256z m0 448c-70.4 0-131.2-36.8-164.8-92.8 12.8 3.2 27.2 4.8 40 4.8 121.6 0 219.2-99.2 219.2-219.2 0-17.6-1.6-35.2-6.4-52.8 60.8 32 102.4 96 102.4 169.6 1.6 104-84.8 190.4-190.4 190.4zM582.4 262.4c17.6 0 32-14.4 32-32v-128c0-17.6-14.4-32-32-32s-32 14.4-32 32v128c0 17.6 14.4 32 32 32zM262.4 582.4c0-17.6-14.4-32-32-32h-128c-17.6 0-32 14.4-32 32s14.4 32 32 32h128c17.6 0 32-14.4 32-32zM310.4 356.8c6.4 6.4 14.4 9.6 22.4 9.6 8 0 16-3.2 22.4-9.6 12.8-12.8 12.8-32 0-44.8l-91.2-91.2c-12.8-12.8-32-12.8-44.8 0-12.8 12.8-12.8 32 0 44.8l91.2 91.2zM944 220.8c-12.8-12.8-32-12.8-44.8 0l-91.2 91.2c-12.8 12.8-12.8 32 0 44.8 6.4 6.4 14.4 9.6 22.4 9.6 8 0 16-3.2 22.4-9.6l91.2-91.2c12.8-12.8 12.8-33.6 0-44.8zM310.4 808l-91.2 91.2c-12.8 12.8-12.8 32 0 44.8 6.4 6.4 14.4 9.6 22.4 9.6 8 0 16-3.2 22.4-9.6l91.2-91.2c12.8-12.8 12.8-32 0-44.8-11.2-11.2-32-11.2-44.8 0z"></path></svg></a></div></footer>
</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">Home</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">Blog</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE/">通讯协议</a> <span class="sep"></span> <a class="cap breadcrumb-link" href="/categories/%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE/CAN/">CAN</a></div>
<div class="flex-row" id="post-meta"><span class="text created">Posted on: <time datetime="2024-05-24T01:48:06.353Z">2024-05-24</time></span><span class="sep updated"></span><span class="text updated">Updated on: <time datetime="2024-05-24T01:48:34.306Z">2024-05-24</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>CANopen</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><p>项目地址 </p>
<p>CANopenNode <a target="_blank" rel="noopener" href="https://github.com/CANopenNode/CANopenNode">https://github.com/CANopenNode/CANopenNode</a></p>
<p>CANopenLinux <a target="_blank" rel="noopener" href="https://github.com/CANopenNode/CANopenLinux">https://github.com/CANopenNode/CANopenLinux</a></p>
<p>CANopenDemo <a target="_blank" rel="noopener" href="https://github.com/CANopenNode/CANopenDemo">https://github.com/CANopenNode/CANopenDemo</a></p>
<p>CANopenEditor <a target="_blank" rel="noopener" href="https://github.com/CANopenNode/CANopenEditor">https://github.com/CANopenNode/CANopenEditor</a></p>
<p>帮助文档</p>
<p>CANopenLinux <a target="_blank" rel="noopener" href="https://canopennode.github.io/CANopenLinux">https://canopennode.github.io/CANopenLinux</a></p>
<p>CANopenDemo <a target="_blank" rel="noopener" href="https://canopennode.github.io/index.html">https://canopennode.github.io/index.html</a></p>
<h1 id="CANopen"><a href="#CANopen" class="headerlink" title="CANopen"></a>CANopen</h1><p>CANopen 是一种基于 CAN（Controller Area Network）通信协议的高层协议和设备协议，主要用于嵌入式系统中的网络通信。</p>
<p>CANopen 协议定义了网络管理、设备配置、通信对象和应用对象等方面的标准，以确保不同设备之间的互操作性和通信的一致性。</p>
<p>CANopen 的 OSI 模型</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/20/20240520145302.png" alt="image.png"></p>
<p>Data link 和 Physical 是由 CAN 进行实现的</p>
<p>Presentation 和 Session 是由 CANopen 进行实现的</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523133451.png" alt="image.png"></p>
<h2 id="CANopen-协议"><a href="#CANopen-协议" class="headerlink" title="CANopen 协议"></a>CANopen 协议</h2><p>CiA 通过一系列文件维护保持 CANopen 设备和通讯协议规定。CANopen 的 <a target="_blank" rel="noopener" href="https://www.can-cia.org/groups/specifications/">CiA 文件</a> 包括下列 3 类:</p>
<p>CiA 规定 – 为实施协议，对硬件及软件配置的功能规定。<br>CiA 建议 – 关于最适宜解决方案的信息。<br>CiA 实施和用户指南– 关于怎样使用 CiA 功能和建议的说明。<br>基本配置由 CiA 301 规范定义。它被命名为“CANopen 应用层和通信配置”，并规定了 CANopen 应用层。这些规范包括：</p>
<ol>
<li>CANopen 对象字典中的数据类型、编码规则和对象  </li>
<li>CANopen 通信服务和协议  </li>
<li>CANopen 网络管理服务和协议  </li>
<li>CANopen 通讯配置 – 物理层  </li>
<li>预定义的通信对象标识符连接数集、与紧急事件相关的对象、时间标识和同步通信对象</li>
</ol>
<p>此基本 CiA 301 配置规定由其他 CiA 文件进行了补充和扩展，为一些具体领域的设备和功能规定了设备、应用程序和接口配置。下面是其中几个例子：</p>
<ul>
<li>CiA 302 – CANopen 附加应用层功能  </li>
<li>CiA 303-1 – 布线和接头管脚分配  </li>
<li>CiA 303-3 – 指示器规范  </li>
<li>CiA 306 – CANopen 电子数据表规范  </li>
<li>CiA 309 – 从其他网络接入 CANopen  </li>
<li>CiA 315 – CANopen 通用框架  </li>
<li>CiA 401 – 通用 I&#x2F;O 模块的 CANopen 设备配置  </li>
<li>CiA 402 – 驱动和运动控制的 CANopen 设备配置</li>
</ul>
<h2 id="CANopen-设备模型"><a href="#CANopen-设备模型" class="headerlink" title="CANopen 设备模型"></a>CANopen 设备模型</h2><p>每个 CANopen 设备都遵循一个通用的设备模型，因此不同的设备能依据同样的 CANopen 标准。CANopen 设备模型的三个组成部分是：</p>
<ul>
<li>通讯接口</li>
<li>对象字典</li>
<li>应用程序</li>
</ul>
<p>一个 CANopen 设备必须支持一定数量的网络管理服务（管理报文，administrative messages），需要至少一个 SDO。每个生产或消费过程数据的设备需要至少一个 PDO。所有其它的通讯对象是可选的。一个 CANopen 设备中 CAN 通讯接口、对象字典和应用程序之间的联系：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523161558.png" alt="image.png"></p>
<h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><p>通讯模式</p>
<ul>
<li>设备&#x2F;节点通信有 3 种模型：主设备&#x2F;从设备、客户端&#x2F;服务器和生产者&#x2F;消费者</li>
</ul>
<p>通讯协议</p>
<ul>
<li>协议用于通信，例如配置节点（SDO）或传输实时数据（PDO）</li>
</ul>
<p>定义了设备之间通信的机制和方式，包括对象字典、服务数据对象（SDO）、过程数据对象（PDO）、网络管理（NMT）等。</p>
<p>设备状态</p>
<ul>
<li>设备支持不同的状态。“主”节点可以更改“从”节点的状态，例如将其重置。</li>
</ul>
<p>对象字典（Object Dictionary，OD）</p>
<ul>
<li>每个 CANopen 设备都有一个对象字典，OD 带有指定设备配置的条目，类似于一个查找表，列出了设备中的所有参数和数据。对象字典包括通信对象和应用对象，使用 16 位索引和 8 位子索引进行标识。可以通过 SDO 访问。</li>
</ul>
<p>EDS（Electronic Data Sheet）</p>
<p>*EDS 是用于 OD 的标准文件格式，允许更新设备的服务</p>
<h2 id="通讯模式"><a href="#通讯模式" class="headerlink" title="通讯模式"></a>通讯模式</h2><p>CANopen 通过不同的通讯模式在节点之间传输报文:</p>
<p><strong>生产&#x2F;消费模式:</strong> 它是一个广播连接，以推送模式工作（信号生产节点向消费节点发送无任何特定要求的信息）和引入模式（消费节点向信号生产节点要求特定信息）。</p>
<p><strong>用户机&#x2F;服务器模式:</strong> 通过 SDO 协议，用户节点向服务器节点要求数据（对象字典索引），然后服务器节点通过发送在指定索引处的对象内容来响应。</p>
<p><strong>主机&#x2F;从机模式:</strong> 主机节点可在任何时候向从机节点发送或要求数据。例如：NMT 协议通信。</p>
<p>CANopen 通信单元由必要的通信接口和协议软件组成，通过总线在节点之间进行通信对象的发送和接收。各种 CANopen 通信对象用于实现各种类型的通信，如过程数据、网络管理、节点监控、同步信号错误控制和紧急报文。</p>
<h2 id="通信对象"><a href="#通信对象" class="headerlink" title="通信对象"></a>通信对象</h2><p>CANopen 协议定义了几种不同类型的通信对象，每种对象都用于特定的通信目的：</p>
<ol>
<li><strong>过程数据对象（PDO）</strong>：用于实时数据传输，具有高优先级和低延迟。PDO 传输的数据量小，但传输速度快，适用于传感器数据和控制命令等实时性要求高的场景。</li>
<li><strong>服务数据对象（SDO）</strong>：用于非实时数据传输，如配置参数和大数据块的传输。SDO 传输的灵活性更大，但优先级较低，适用于设备配置和诊断等场景。</li>
<li><strong>网络管理对象（NMT）</strong>：用于控制设备状态和网络操作模式，如启动、停止和复位设备。</li>
<li><strong>同步对象（SYNC）</strong>：用于网络同步，确保所有节点在同一时间点进行操作。</li>
<li><strong>时间戳对象（TIME）</strong>：提供时间参考，用于时间相关的操作。</li>
<li><strong>紧急情况对象 (EMCY)</strong> ：</li>
</ol>
<h2 id="数据帧"><a href="#数据帧" class="headerlink" title="数据帧"></a>数据帧</h2><p>数据帧由帧头 + 数据区组成</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523134834.png" alt="image.png"></p>
<p>帧头由 COB+RTR+DLC 组成</p>
<table>
<thead>
<tr>
<th align="center">范围</th>
<th align="center">帧头</th>
<th align="center"></th>
<th align="center"></th>
<th>数据区</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="center">内容</td>
<td align="center">COB-ID</td>
<td align="center">RTR</td>
<td align="center">DLC</td>
<td>byte 1</td>
<td>byte n</td>
</tr>
<tr>
<td align="center">长度</td>
<td align="center">11bits</td>
<td align="center">1 bit</td>
<td align="center">4 bits</td>
<td>8 bits</td>
<td></td>
</tr>
<tr>
<td align="center">数值</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>11 位的 CAN ID 称为通信对象标识符（COB-ID），分为两个部分：</p>
<ul>
<li>前 4 位等于功能代码 <code>Function Code</code>（代表一个 CANopen 通信对象）</li>
<li>后 7 位包含节点 ID<code>Node ID</code><br>CANopen 网络中使用的 COB-ID 标识符的预定义分配<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/20/20240520150656.png" alt="image.png"></li>
</ul>
<p>RTR&#x3D;远程传输请求，写 0</p>
<h1 id="网络管理"><a href="#网络管理" class="headerlink" title="网络管理"></a>网络管理</h1><p>所有的 CANopen 节点都有自己专属的 NMT 状态，而主站可以藉由 NMT 的讯息去控制从站的状态。</p>
<p>CANopen 的网络管理采取主机&#x2F;从机通信模式。整个网络被设置为一个“状态机”，其中一个设备被指定为 NMT 主机，另一个设备被指定为 NMT 从机。</p>
<p>NMT 主机控制和监控 NMT 从机的状态。通过 NMT 主机触发，NMT 从机进行状态转换，实现 CANopen 网络的各个阶段。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523142652.png"></p>
<p>通过具体的 NMT 协议，如启动协议、模块控制协议、心跳协议（Heartbeat Protocol）和节点监测，<strong>主机向从机发出状态更改命令，进行这些状态转换</strong>。NMT 主机向特定节点或所有节点发送 NMT 命令代码以改变状态。</p>
<p>在<strong>预运行状态</strong>下，应用程序配置工具可以使用<strong>SDO 通信</strong>，配置 NMT 从机和设置参数。由于设备尚未开始运行，因此在此状态下<strong>不能使用 PDO 通信</strong>。</p>
<p>一旦状态从<strong>预运行</strong>变为<strong>运行</strong>状态，节点中的<strong>所有通信对象</strong>都将变为活跃状态，并且运行节点之间均可进行 PDO 和 SDO 通信。在此阶段，<strong>也可以通过 SDO 访问对象字典</strong>。当节点状态更改为停止时，PDO 和 SDO 通信都将停止。</p>
<h1 id="对象字典-OD"><a href="#对象字典-OD" class="headerlink" title="对象字典 OD"></a>对象字典 OD</h1><p>对象字典（OD）是 CANopen 协议的核心概念。它是一组预定义的 CANopen 对象，通过网络使用索引和子索引访问对象。对象字典提供了应用程序和设备之间的沟通方式，提供了配置该设备的途径，和与设备通信的方法。</p>
<p>所有 CANopen 节点必须具有对象字典（OD），对象字典是指含有描述的 CANopen 节点的 <code>行为</code> 的所有 <code>参数</code> 的 <code>标准化结构</code>。</p>
<p><strong>设备（例如从设备）的 OD 条目可以由其他设备（例如主机）使用 SDO 通过 CAN 进行访问</strong>。例如，通过 SDO 可以使应用程序主机更改从属发送心跳的频率。</p>
<p>作为对象索引存储在对象字典中的信息包括：</p>
<ul>
<li>通信和应用程序配置参数</li>
<li>标准化设备配置参数</li>
<li>制造商特定设备配置文件参数</li>
<li>设备配置静态数据类型</li>
<li>设备配置复杂数据类型</li>
<li>复杂和静态数据类型</li>
<li>制造商特定数据类型</li>
<li>其他</li>
</ul>
<p>从上述对象说明可以清楚地看出，制造商可以通过扩展由标准设备配置和数据类型规范要求的标准设备功能，来增强其设备的功能。</p>
<p>可以按照 CANopen 标准的指导，以预定义的方式添加自己特定的制造商配置和数据类型。</p>
<p>通过 16 位索引和 8 位子索引查找 OD 条目。具体来说，对象字典条目中的场包括:</p>
<ul>
<li>索引：对象的 16 位基址</li>
<li>对象名称：制造商设备名称</li>
<li>目标代码：数组，变量或记录</li>
<li>数据类型：例如 VISIBLE_STRING 或 UNSIGNED32 或记录名称</li>
<li>访问： rw（读&#x2F;写），ro（只读），wo（只写）</li>
<li>类别：指示此参数是否为必需&#x2F;可选（M &#x2F; O）</li>
</ul>
<p>主索引基址段划分定义：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523135609.png" alt="image.png"></p>
<p>不要被对象字典中索引值低于 0x0FFF 的‘data types’项所迷惑，它们仅仅是一些数据类型定义。</p>
<p>一个节点的对象字典的有关范围在 0x1000 到 0x9FFF 之间。CANopen 由一系列称为子协议的文档组成。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523161012.png" alt="image.png"></p>
<h2 id="OD-示例配置"><a href="#OD-示例配置" class="headerlink" title="OD 示例配置"></a>OD 示例配置</h2><p>通讯配置范例</p>
<table>
<thead>
<tr>
<th align="center">索引</th>
<th align="center">对象</th>
<th align="left">名称</th>
<th align="center">类型</th>
<th align="center">访问</th>
<th align="center">类别</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1000</td>
<td align="center">VAR</td>
<td align="left">device_type</td>
<td align="center">Unsigned32</td>
<td align="center">ro</td>
<td align="center">M</td>
</tr>
<tr>
<td align="center">1001</td>
<td align="center">VAR</td>
<td align="left">error_register</td>
<td align="center">Unsigned8</td>
<td align="center">ro</td>
<td align="center">M</td>
</tr>
<tr>
<td align="center">1002</td>
<td align="center">VAR</td>
<td align="left">manufacturer_status_register</td>
<td align="center">Unsigned32</td>
<td align="center">ro</td>
<td align="center">O</td>
</tr>
<tr>
<td align="center">1003</td>
<td align="center">ARRAY</td>
<td align="left">pre-defined_error_field</td>
<td align="center">Unsigned32</td>
<td align="center">ro</td>
<td align="center">O</td>
</tr>
</tbody></table>
<p><strong>引用复杂或结构化数据类型条目的子索引示例</strong><br>这些条目用于单通道 RS-232 适配器，其通信参数在索引 6092H 处以单一结构数据类型存在。然后，各个通信参数存在于子索引 6092H 中，范围从 0 起。</p>
<table>
<thead>
<tr>
<th align="center">索引</th>
<th>子索引</th>
<th>可访问的变量</th>
<th>数据类型</th>
</tr>
</thead>
<tbody><tr>
<td align="center">6092</td>
<td>0</td>
<td>条目数</td>
<td>Unsigned8</td>
</tr>
<tr>
<td align="center">6092</td>
<td>1</td>
<td>波特率</td>
<td>Unsigned16</td>
</tr>
<tr>
<td align="center">6092</td>
<td>2</td>
<td>数据位数</td>
<td>Unsigned8</td>
</tr>
<tr>
<td align="center">6092</td>
<td>3</td>
<td>停止位数</td>
<td>Unsigned8</td>
</tr>
<tr>
<td align="center">6092</td>
<td>4</td>
<td>等值</td>
<td>Unsigned8</td>
</tr>
</tbody></table>
<p>上述对象字典项的 C 编程语言结构定义为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span> </span><br><span class="line">	UNSIGNED <span class="type">char</span> NumberOfEntries; </span><br><span class="line">	UNSIGNED <span class="type">short</span> BaudRate; </span><br><span class="line">	UNSIGNED <span class="type">char</span> NumberOfDataBits; </span><br><span class="line">	UNSIGNED <span class="type">char</span> NumberOfStopBits; </span><br><span class="line">	UNSIGNED <span class="type">char</span> Parity </span><br><span class="line">&#125; RS232</span><br></pre></td></tr></table></figure>

<h2 id="OD-标准化"><a href="#OD-标准化" class="headerlink" title="OD 标准化"></a>OD 标准化</h2><p>一个节点的对象字典是在电子数据文档（EDS：Electronic Data Sheet）中描述。</p>
<h3 id="电子数据表（EDS）"><a href="#电子数据表（EDS）" class="headerlink" title="电子数据表（EDS）"></a>电子数据表（EDS）</h3><p>实际上，将使用适当的软件工具来配置&#x2F;管理复杂的 CANopen 网络。</p>
<p>一个电子数据表（EDS）是一个标准化的电子文件，描述为 CANopen 设备定义的通信功能和对象。此供应方生成的文件有 3 个区域：</p>
<ul>
<li>关于 EDS 文件的信息</li>
<li>一般设备信息</li>
<li>具有默认变量的对象字典</li>
</ul>
<p>EDS 文件可用作 CANopen 设备的配置和网络设置工具。</p>
<h1 id="服务类型"><a href="#服务类型" class="headerlink" title="服务类型"></a>服务类型</h1><p>各服务类型指定状态下可用及状态转换说明：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523165217.png" alt="image.png"></p>
<p>中括号内的字母表示处于不同状态那些通讯对象可以使用。</p>
<p>a. NMT</p>
<p>b. Node Guard </p>
<p>c. SDO </p>
<p>d. Emergency</p>
<p>e. PDO </p>
<p>f. Boot-up</p>
<p>状态转移（1－5 由 NMT 服务发起），NMT 命令字（在括号中）：</p>
<p>1： Start_Remote_node (0x01)</p>
<p>2：Stop_Remote_Node (0x02)</p>
<p>3： Enter_Pre-Operational_State (0x80)</p>
<p>4： Reset_Node (0x81)</p>
<p>5：Reset_Communication (0x82)</p>
<p>6：设备初始化结束，自动进入 Pre_Operational 状态，发送 Boot-up 消息</p>
<h2 id="网络管理（NMT）"><a href="#网络管理（NMT）" class="headerlink" title="网络管理（NMT）"></a>网络管理（NMT）</h2><p>NMT 服务用于通过 NMT 命令来控制 CANopen 设备的状态。</p>
<p>只有 NMT-Master 节点能够传送 NMT Module Control 报文。所有从设备必须支持 NMT 模块控制服务。NMT Module Control 消息不需要应答。</p>
<p>为了更改状态，NMT 主设备发送 COBID+2 字节的消息。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/20/20240520151626.png" alt="image.png"></p>
<ol>
<li><p>COB-ID 为 0（function code&#x3D;0 和 node ID&#x3D;0）。优先级为最高。</p>
</li>
<li><p>第一个 CAN 数据字节 Requested State 包含请求的状态</p>
<ul>
<li>命令包括转换到 operation（状态 01），stop（状态 02），pre-operation（状态 80）以及 reset app（81）和 reset communication（82）。<br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523150230.png" alt="image.png"></li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th align="center">Byte 0 取值（命令）</th>
<th>状态</th>
</tr>
</thead>
<tbody><tr>
<td align="center">01</td>
<td>start_remote_node</td>
</tr>
<tr>
<td align="center">02</td>
<td>stop_remote_node</td>
</tr>
<tr>
<td align="center">80</td>
<td>enter_pre-operational</td>
</tr>
<tr>
<td align="center">81</td>
<td>reset_node</td>
</tr>
<tr>
<td align="center">82</td>
<td>reset_communication</td>
</tr>
</tbody></table>
<ol start="3">
<li>第二个 CAN 数据字节包含目标节点的节点 ID。节点 ID 0 表示广播命令。所有从节点都处理此消息。</li>
</ol>
<p><strong>示例</strong><br>node 0x6 进入 <code>operational</code> 模式 : <code>000 01 06</code><br>所有节点进入 <code>pre-operational</code> 模式 : <code>000 80 00</code></p>
<h2 id="服务数据对象（SDO）"><a href="#服务数据对象（SDO）" class="headerlink" title="服务数据对象（SDO）"></a>服务数据对象（SDO）</h2><p>SDO 属于服务数据，有指定被接收节点的地址（Node-ID），并且需要指定的接收节点回应 CAN 报文来确认已经接收，如果超时没有确认，则发送节点将会重新发送原报文。</p>
<p>SDO 提供了直接访问 CANopen 设备对象字典的入口，入口条件包括数据类型及大小；任何类型的 SDO 传输都由客户端发起，数据字典持有者是服务端，客户端和服务端都可以主动中止传输。</p>
<p>请求读或写的节点是客户端节点；读取或写入数据的节点是服务节点；</p>
<p>SDO 服务用于访问&#x2F;更改 CANopen 设备的对象字典中的值。</p>
<ul>
<li>例如，当应用程序服务需要更改 CANopen 设备的某些配置时。</li>
</ul>
<p>SDO 服务允许 CANopen 节点通过 CAN 网络读取另一个节点的对象字典&#x2F;编辑值。</p>
<p>如“通信模型”中所述，SDO 服务利用“客户端&#x2F;服务端”行为。</p>
<p>客户端节点可以通过以下 CAN 帧广播来启动 SDO 下载到节点 5，这将触发节点 5（并被其他节点忽略）。</p>
<p>SDO“接收”（即请求）CAN 帧如下所示：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/20/20240520153535.png" alt="image.png"></p>
<p>SDO 消息变量说明：</p>
<ul>
<li>COB-ID 605 反映了“ SDO 接收”（COB-ID 600 + 节点 ID）的使用。</li>
<li>所述 CCS（客户端命令说明符）是传输类型（例如，1：下载，2：上载）</li>
<li>n 是数据字节 4-7 中不包含数据的 bytes （如果设置了 e＆s 则有效）</li>
<li>如果设置，e 表示“快速传输”（所有数据在单个 CAN 帧中）</li>
<li>如果设置，s 表示数据大小显示在 n 中</li>
<li>索引（16 位）和子索引（8 位）反映了要访问的 OD 地址</li>
<li>最后，字节 4-7 包含要下载到节点 5 的数据</li>
</ul>
<ul>
<li>一旦节点（客户端）发送了 CAN 帧，从节点 5（服务端）便会通过“ SDO 发送”进行响应，并带有 COB-ID585。该响应包含索引&#x2F;子索引和 4 个空数据字节。<br>自然地，如果客户端节点请求上传（即从节点 5 OD 读取数据），则节点 5 将以字节 4-7 中包含的相关数据进行响应。</li>
</ul>
<p>每个 SDO 使用 2 个标识符，创建一个“ SDO 渠道（包含命令字节和 OD 地址）”，数据包含在 4 个字节中，对于较大的数据方案，可以使用 SDO 分段&#x2F;块传输。</p>
<p>SDO 灵活，但会带来大量输出，使其不适用于实时操作数据。</p>
<p><strong>通讯示例 -upload</strong><br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523152443.png" alt="image.png"><br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523152452.png" alt="image.png"><br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523152500.png" alt="image.png"></p>
<p>数据 0xFE ，对象字典节点 5 ,  索引 index 0x1400, 子索引 subindex 2 </p>
<p>客户端请求   ： <code>605 40 00 14 02 00 00 00 00</code> </p>
<p>若成功，应答： <code>585 4F 00 14 02 FE 00 00 00</code></p>
<p>数据 0x60120208 ，对象字典节点 5 ,  索引 index 0x1802, 子索引 subindex 1</p>
<p>客户端请求   ：<code>605 40 02 18 01 00 00 00 00</code></p>
<p>若成功，应答：<code>585 60 02 18 01 08 02 12 60</code></p>
<p><strong>通讯示例 -download</strong><br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523152715.png" alt="image.png"><br><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523152725.png" alt="image.png"><br>数据 0xFE ，对象字典节点 5 ,  索引 index 0x1400, 子索引 subindex 2 </p>
<p>客户端请求   ： <code>605 2F 00 14 02 FE 00 00 00</code></p>
<p>若成功，应答： <code>585 60 00 14 02 00 00 00 00</code></p>
<p>数据 0x60120208 ，对象字典节点 5 ,  索引 index 0x1802, 子索引 subindex 1</p>
<p>客户端请求   ：<code>605 23 02 18 01 08 02 12 60</code></p>
<p>若成功，应答：<code>585 60 02 18 01 00 00 00 00</code></p>
<h2 id="过程数据对象（PDO）"><a href="#过程数据对象（PDO）" class="headerlink" title="过程数据对象（PDO）"></a>过程数据对象（PDO）</h2><p>PDO 属于过程数据，即单向传输，无需接收节点回应 CAN 报文来确认，从通讯术语上来说是属于“生产消费”模型。PDO 服务用于在设备之间传输实时数据，例如来自温度传感器的温度数据。PDO 承载大量信息，被视为最重要的 CANopen 协议。</p>
<ul>
<li>原则上可以使用 SDO 服务。但是单个 SDO 响应只能携带 4 个数据字节（需要包含命令字节和 OD 地址）。假设一个主节点需要来自节点 5 的两个参数值（例如“ SensTemp2”和“ Torque5”），要通过 SDO 获得此值，它将需要 4 个完整的 CAN 帧（2 个请求，2 个响应）。</li>
</ul>
<p>相比之下，PDO 消息可以包含 8 个完整字节的数据 - 并且它可以在单个帧中包含多个对象参数值。因此，可能需要在 PDO 服务中用 1 帧完成 SDO 至少需要 4 帧的操作。</p>
<p>对于 PDO，使用消费者&#x2F;生产者术语。因此，生产者“生产数据”，并使用 Transmit PDO（TPDO）将其传输到“消费者”（主用户）。</p>
<p>相反，它可以通过 Receive PDO（RPDO）从使用者接收数据。</p>
<p><strong>传输方式</strong><br>PDO 可以有多种传送方式：</p>
<ul>
<li>同步（通过接收 SYNC 对象实现同步）<ul>
<li>非周期：由远程帧预触发传送，或者由设备子协议中规定的对象特定事件预触发传送。</li>
<li>周期：传送在每 1 到 240 个 SYNC 消息后触发。</li>
</ul>
</li>
<li>异步<ul>
<li>由远程帧触发传送。</li>
<li>由设备子协议中规定的对象特定事件触发传送。</li>
</ul>
</li>
</ul>
<p>由传输类型定义的不同 PDO 传输模式，传输类型为 PDO 通讯参数对象的一部分，由 8 位无符号整数定义。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523162157.png" alt="image.png"></p>
<p><strong>间隔时间</strong><br>一个 PDO 可以指定一个禁止时间，即定义两个连续 PDO 传输的最小间隔时间，避免由于高优先级信息的数据量太大，始终占据总线，而使其它优先级较低的数据无力竞争总线的问题。禁止时间由 16 位无符号整数定义，单位 100us。</p>
<p><strong>定时周期</strong><br>一个 PDO 可以指定一个事件定时周期，当超过定时时间后，一个 PDO 传输可以被触发（不需要触发位）。事件定时周期由 16 位无符号整数定义，单位 1ms。</p>
<p>生产者节点可以被配置为每 100ms 响应消费者所广播的 SYNC 触发。然后，节点 5 可以例如在下面广播，以 COB-ID 185 的 TPDO：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/20/20240520153344.png" alt="image.png"></p>
<p>注意数据字节是如何用 3 个参数值打包的。这些值反映了节点 5 特定 OD 条目的实时数据。使用此信息的节点（使用者）当然需要知道如何解释 PDO 数据字节。数据字节是由对象字典提供 PDO 数据和配置的接口，数据字典中对应的映射结构决定了一个 PDO 的数据类型和映射关系。</p>
<p>每个 PDO 在对象字典中用 2 个对象描述：</p>
<ul>
<li>PDO 通讯参数：包含哪个 COB-ID 将被 PDO 使用，传输类型，禁止时间和定时器周期。</li>
<li>PDO 映射参数：包含一个对象字典中对象的列表，这些对象映射到 PDO 里，包括它们的数据长度（in bits）。生产者和消费者必须知道这个映射，以解释 PDO 内容。</li>
</ul>
<p>PDO 消息的内容是预定义的（或者在网络启动时配置的）。如果 CANopen 设备支持可变映射 PDO，可通过 SDO 实现对 PDO 在数据字典中对应的配置进行修改。</p>
<p>TPDO</p>
<p>对于 TPDO 来说，其通信参数中的 COB-ID 是<strong>自身</strong>的 COB-ID，当发送 TPDO 时用来表明这个 TPDO 是谁发出的。</p>
<p>RPDO</p>
<p>对于 RPDO 来说，其通信参数的 COB-ID 是<strong>发送方</strong>的 COB-ID，用来表示自己只接受某个 CAN 节点发过来的 TPDO。</p>
<p><strong>示例 - 设置一个 TPDO</strong></p>
<ul>
<li>Index 1800 + n，subindex <code>01</code> ，<strong>COB_ID</strong>（通讯对象的标识符）：包含 CAN-ID 和附加控制位的标识符</li>
<li>Index 1800 + n，subindex <code>02</code>， 写<strong>传输类型 t</strong>，<br>  t &#x3D; 1 – 0xF0：同步，时间触发模式 ，每 t 一周期<br>  t &#x3D; FD  　　：收到 PDO 请求后<br>  t &#x3D; FE　　  ：事件驱动（制造商指定）<br>  t &#x3D; FF  　　：事件传输，节点自发传输 PDO</li>
<li>Index 1800 + n， subindex <code>03</code>，<strong>抑制时间</strong>。<br>  如果传输类型设置为 FE 和 FF，它是最小的 PDO 传输间隔，单位 100us，值为 0 禁用抑制时间。PDO 报文需要延时 t × 100us 的时间才发出，以此避免在多 PDO 报文同时发出时，引起的时间冲突 。</li>
<li>Index 1800 + n， subindex <code>05</code>，<strong>时间定时器</strong>。<br>  如果传输类型设置为 FE 和 FF，它是 PDO 传输间隔，单位 ms，值为 0 禁用。t &#x3D;0xCB，200ms。</li>
<li>Index 1A00 + n，<strong>定义映射</strong><ul>
<li>subindex <code>0</code> ：定义映射数量（1 byte）。<br>  值 0，映射禁用；值 01，子索引 01 有效；值 02，子索引 01–02 有效……</li>
<li>subindex <code>1</code> ：映射第一个参数。<br>  格式，index (2 bytes) – subindex (1 byte) – size (1 byte)</li>
<li>subindex <code>2</code> ：映射第二个参数。<br>  格式，index (2 bytes) – subindex (1 byte) – size (1 byte)</li>
</ul>
</li>
</ul>
<p><code>605 2F 00 18 02 FF 00 00 00</code> 设置索引 Index 1800，事件传输</p>
<p><code>605 2F 00 18 05 CB 00 00 00</code> 设置索引 Index 1800，时间间隔 200ms</p>
<p><code>605 2F 00 1A 00 00 00 00 00</code> 设置子索引禁用</p>
<p><code>605 23 00 1A 01 10 00 30 40</code>0x40300010，设置映射索引 0x4030，子索引 00，大小 0x10（16 位）</p>
<p><code>605 23 00 1A 02 20 00 10 20</code>0x20100020，设置映射索引 0x2010，子索引 00，大小 0x20（32 位）</p>
<p><code>605 2F 00 1A 00 02 00 00 00</code> 设置映射数量，用多少设多少，这里用了 2 个</p>
<p><strong>示例 - 设置一个 RPDO</strong></p>
<ul>
<li>Index 1400 + n, subindex <code>01</code> ，<strong>COB_ID</strong>（通讯对象的标识符）</li>
<li>Index 1400 + n, subindex <code>02</code>，写<strong>传输类型</strong> t，　　　　　　　　　　　　　　<br>  t &#x3D; 1 – 0xF0：同步，时间触发模式 ，每 t 一周期<br>  t &#x3D; FD  　　：收到 PDO 请求后<br>  t &#x3D; FE　　  ：事件驱动（制造商指定）<br>  t &#x3D; FF  　　：事件传输，节点自发传输 PDO</li>
<li>Index 1600 + n，<strong>定义映射</strong><ul>
<li>subindex 0 ：定义映射数量（1 byte）。<br>  值 0，映射禁用；值 01，子索引 01 有效；值 02，子索引 01–02 有效……</li>
<li>subindex 1 ：映射第一个参数。<br>  格式，index (2 bytes) – subindex (1 byte) – size (1 byte)</li>
<li>subindex 2 ：映射第二个参数。<br>  格式，index (2 bytes) – subindex (1 byte) – size (1 byte)</li>
</ul>
</li>
</ul>
<p><code>605 2F 00 14 02 FF 00 00 00</code> 设置索引 Index 1400，事件传输</p>
<p><code>605 2F 00 16 00 00 00 00 00</code> 设置子索引禁用</p>
<p><code>605 23 00 16 01 10 00 30 40</code> 设置映射索引 0x4030，子索引 00，大小 0x10（16 位）</p>
<p><code>605 2F 00 16 00 01 00 00 00</code> 设置映射数量，用多少设多少，这里用了 01</p>
<ul>
<li>定义映射时，先设置子索引禁用；再设置相应映射；然后设置映射数量</li>
</ul>
<h2 id="同步（SYNC）"><a href="#同步（SYNC）" class="headerlink" title="同步（SYNC）"></a>同步（SYNC）</h2><p>SYNC 消息通常由应用程序主机触发。</p>
<ul>
<li>在网络范围内同步（尤其在驱动应用中）：在整个网络范围内当前输入值准同时保存，随后传送（如果需要），根据前一个 SYNC 后接收到的报文更新输出值。</li>
<li>主从模式：SYNC 主节点定时发送 SYNC 对象，SYNC 从节点收到后同步执行任务。</li>
<li>在 SYNC 报文传送后，在给定的时间窗口内传送一个同步 PDO。</li>
<li>用 CAL 中基本变量类型的 CMS 对象实现。</li>
<li>CANopen 建议用一个最高优先级的 COB-ID 以保证同步信号正常传送。SYNC 报文可以不传送数据以使报文尽可能短。</li>
</ul>
<p>应用程序主机将 SYNC 消息（COB-ID 080）发送到 CANopen 网络。</p>
<h2 id="时间戳（TIME）"><a href="#时间戳（TIME）" class="headerlink" title="时间戳（TIME）"></a>时间戳（TIME）</h2><p>利用该通信服务，可以分配全球网络时间。TIME 服务包含一个 6 字节的日期和时间信息。</p>
<p>主机发出带有 CAN ID 100 的 TIME 消息，其中最初的 4 个数据字节包含午夜之后的毫秒数，随后的 2 个字节包含自 1984 年 1 月 1 日以来的天数。</p>
<h2 id="紧急情况（EMCY）"><a href="#紧急情况（EMCY）" class="headerlink" title="紧急情况（EMCY）"></a>紧急情况（EMCY）</h2><p>紧急服务用于设备发生致命错误（例如传感器故障）的情况，从而使其可以向网络的其余部分指示此错误。</p>
<p>受影响的节点以高优先级向网络发送单个 EMCY 消息</p>
<ul>
<li>例如，节点 5 具有 COB-ID 085</li>
</ul>
<p>数据字节包含有关错误的信息，可以查找有关详细信息。</p>
<h2 id="节点监测"><a href="#节点监测" class="headerlink" title="节点监测"></a>节点监测</h2><p>NMT 主机定期使用远程帧询问从机的当前状态，并将其与网络数据库中记录的早期状态相比较。</p>
<p>任何不匹配和缺少 PDO 传输的状态都会以适当的错误代码表示，然后应用程序将采取适当的操作，如设备重置或错误标识。这称为节点监测，是通过使用节点监测协议得以实现。</p>
<p>NMT 从机使用一种称为生命监测的技术，通过在预定义的时间间隔里，内部检查节点监测帧的接收，来检测 NMT 主机的缺失。</p>
<p>现代设备设计使用 Heartbeat 协议进行节点监视，其中 NMT 从设备（Heartbeat Producer 心跳发出者）将周期性地向 NMT 主设备（Heartbeat Consumer 心跳使用者）发送 Heartbeat 报文。</p>
<p>这些报文之间的间隔是可配置的，并在主、从两个设备的对象字典中 Heartbeat producer time（心跳产生时间）对象上都进行设置。如果心跳报文在此时间限制内未到达，则发出者将被视为关机，使用者将采取补救措施，如设备重置或错误显示。</p>
<p>Master 节点发送远程帧（无数据）如下</p>
<p>NMT-Master -&gt; NMT-Slave</p>
<p><code>COB-ID</code> &#x3D; <code>0x700</code> + <code>Node_ID</code></p>
<p>NMT-Slave 节点发送如下报文应答</p>
<p>NMT-Master &lt;- NMT-Slave</p>
<p><code>COB-ID</code> &#x3D; <code>0x700</code> + <code>Node_ID</code></p>
<p><code>Byte0</code> &#x3D; <code>Bit 7 : toggle</code> +  <code>Bit6-0 : 状态</code></p>
<h2 id="Boot-up"><a href="#Boot-up" class="headerlink" title="Boot-up"></a>Boot-up</h2><p>NMT 状态机的初始状态序列<strong>开机</strong>，或<strong>关机事件的恢复</strong>开始，然后是<strong>设备初始化</strong>。然后，NMT<strong>从机将自动转换到预运行状态</strong>。在错误监测和诊断期间的内部设备<strong>重置</strong>（重置应用程序和重置通信）也会使 NMT 从机进入<strong>初始化状态</strong>，然后进入<strong>预运行状态</strong>。在此转换之前，该从机将使用<strong>启动协议</strong>向总线发送启动报文，以表明启动过程。</p>
<p><strong>示例</strong><br>启动协议<br>从 initialization 进入 pre-communication 状态时，<br>slave 自动发送一个 ID 为 0x700+address，内容为 0 的消息。</p>
<h1 id="CANopenNode-流程图"><a href="#CANopenNode-流程图" class="headerlink" title="CANopenNode 流程图"></a>CANopenNode 流程图</h1><p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/23/20240523114715.png" alt="image.png"></p>
<ul>
<li>只需添加自定义 makefile、自定义对象字典 OD.h&#x2F;c 文件和 Arduino 风格的自定义应用程序源文件（从 CO_main_basic.c 文件调用），即可在新目录中启动新项目。</li>
<li>默认情况下，canopend 在单线程中运行（Makefile 中的 CO_SINGLE_THREAD 选项）。不同的事件，例如可以接收或定时器到期触发堆栈循环（所有代码都是非阻塞的）。</li>
<li>在多线程操作中，除了主线线程之外还建立了实时线程。 RT 线程每毫秒运行一次，并通过外围读&#x2F;写、控制程序或类似程序处理 PDO 和可选应用程序代码。使用此配置时，必须考虑竞争条件，例如，从主线线程运行的应用程序代码在访问 OD 变量时必须使用 CO_(UN)LOCK_OD 宏。</li>
</ul>
<p>OD 编辑器地址 <a target="_blank" rel="noopener" href="https://github.com/CANopenNode/CANopenEditor">https://github.com/CANopenNode/CANopenEditor</a></p>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>License</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    
    <section id="share">
      <div class="header"><span>Share</span></div>
      <div class="body">
        <div class="link"><input class="copy-area" readonly="true" id="copy-link" value="http://liuluhua.github.io/2024/05/24/%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE-CAN-CANopen/" /></div>
        <div class="social-wrap dis-select"><a class="social share-item wechat" onclick="util.toggle(&quot;qrcode-wechat&quot;)"><img class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/b32ef3da1162a.svg" /></a><a class="social share-item weibo" target="_blank" rel="external nofollow noopener noreferrer" href="https://service.weibo.com/share/share.php?url=http://liuluhua.github.io/2024/05/24/%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE-CAN-CANopen/&title=CANopen - 玲璐&summary=项目地址 
CANopenNode https://github.com/CANopenNode/CANopenNode
CANopenLinux https://github.com/CANopenNode/CANopenLinux..."><img class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/80c07e4dbb303.svg" /></a><a class="social share-item email" href="mailto:?subject=CANopen - 玲璐&amp;body=http://liuluhua.github.io/2024/05/24/%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE-CAN-CANopen/"><img class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/a1b00e20f425d.svg" /></a><a class="social share-item link" onclick="util.copy(&quot;copy-link&quot;, &quot;Copied!&quot;)"><img class="lazy"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/social/8411ed322ced6.svg" /></a></div>
        
        <div class="qrcode" id="qrcode-wechat" style="opacity:0;height:0">
          <img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=http://liuluhua.github.io/2024/05/24/%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE-CAN-CANopen/"/>
        </div>
        
      </div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">Newer</div><a href="/2024/05/24/%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE-CAN-CAN%E5%92%8CCANFD/">CAN和CANFD</a></div><div class="item" id="next"><div class="note">Older</div><a href="/2024/05/24/%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE-CAN-CAN%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">CAN学习笔记</a></div></section></div>

<div class="related-wrap" id="related-posts">
    <section class='header'>
      <div class='title cap theme'>Related Posts</div>
    </section>
    <section class='body'>
    <div class="related-posts"><a class="item" href="/2024/05/24/通讯协议-CAN-CAN和CANFD/" title="CAN和CANFD"><span class="title">CAN和CANFD</span></a></div></section></div>


  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>快来参与讨论吧~</p>

    </section>
    <section class='body cmt-body utterances'>
      

<svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg>

<div id="utterances" repo="liuluhua/liuluhua.github.io" issue-term="url" theme="preferred-color-scheme" label="💬"></div>

    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="sitemap"><div class="sitemap-group"><span class="fs15">博客</span><a href="/">近期</a><a href="/">分类</a><a href="/">标签</a><a href="/">归档</a></div><div class="sitemap-group"><span class="fs15">项目</span><a href="/">开源库</a></div><div class="sitemap-group"><span class="fs15">社交</span><a href="/">友链</a><a href="/">留言板</a></div><div class="sitemap-group"><span class="fs15">更多</span><a href="/aboutWork">关于本站</a><a target="_blank" rel="noopener" href="https://github.com/liuluhua/liuluhua.github.io">GitHub</a></div></div><div class="text"><p>本站由 <a href="/">liuluhua</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> 主题创建。<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。<br>站点访问量 <span id="qexo-site-pv">Loading…</span><br>站点访客数 <span id="qexo-site-uv">Loading…</span><br>页面访问量 <span id="qexo-page-pv">Loading…</span></p>
<script src="https://cdn.jsdelivr.net/npm/qexo-static@1.6.0/hexo/statistic.js"></script>
<script>loadStatistic("https://liuluhua.github.io")</script>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">On This Page</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CANopen"><span class="toc-text">CANopen</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CANopen-%E5%8D%8F%E8%AE%AE"><span class="toc-text">CANopen 协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CANopen-%E8%AE%BE%E5%A4%87%E6%A8%A1%E5%9E%8B"><span class="toc-text">CANopen 设备模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">核心概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%AE%AF%E6%A8%A1%E5%BC%8F"><span class="toc-text">通讯模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E4%BF%A1%E5%AF%B9%E8%B1%A1"><span class="toc-text">通信对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%B8%A7"><span class="toc-text">数据帧</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86"><span class="toc-text">网络管理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%AD%97%E5%85%B8-OD"><span class="toc-text">对象字典 OD</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#OD-%E7%A4%BA%E4%BE%8B%E9%85%8D%E7%BD%AE"><span class="toc-text">OD 示例配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OD-%E6%A0%87%E5%87%86%E5%8C%96"><span class="toc-text">OD 标准化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%B5%E5%AD%90%E6%95%B0%E6%8D%AE%E8%A1%A8%EF%BC%88EDS%EF%BC%89"><span class="toc-text">电子数据表（EDS）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%B1%BB%E5%9E%8B"><span class="toc-text">服务类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%EF%BC%88NMT%EF%BC%89"><span class="toc-text">网络管理（NMT）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%95%B0%E6%8D%AE%E5%AF%B9%E8%B1%A1%EF%BC%88SDO%EF%BC%89"><span class="toc-text">服务数据对象（SDO）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B%E6%95%B0%E6%8D%AE%E5%AF%B9%E8%B1%A1%EF%BC%88PDO%EF%BC%89"><span class="toc-text">过程数据对象（PDO）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%EF%BC%88SYNC%EF%BC%89"><span class="toc-text">同步（SYNC）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3%EF%BC%88TIME%EF%BC%89"><span class="toc-text">时间戳（TIME）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A7%E6%80%A5%E6%83%85%E5%86%B5%EF%BC%88EMCY%EF%BC%89"><span class="toc-text">紧急情况（EMCY）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E7%9B%91%E6%B5%8B"><span class="toc-text">节点监测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Boot-up"><span class="toc-text">Boot-up</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CANopenNode-%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-text">CANopenNode 流程图</span></a></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>Scroll to Top</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.46 1.25h3.08c1.603 0 2.86 0 3.864.095c1.023.098 1.861.3 2.6.752a5.75 5.75 0 0 1 1.899 1.899c.452.738.654 1.577.752 2.6c.095 1.004.095 2.261.095 3.865v1.067c0 1.141 0 2.036-.05 2.759c-.05.735-.153 1.347-.388 1.913a5.75 5.75 0 0 1-3.112 3.112c-.805.334-1.721.408-2.977.43a10.81 10.81 0 0 0-.929.036c-.198.022-.275.054-.32.08c-.047.028-.112.078-.224.232c-.121.166-.258.396-.476.764l-.542.916c-.773 1.307-2.69 1.307-3.464 0l-.542-.916a10.605 10.605 0 0 0-.476-.764c-.112-.154-.177-.204-.224-.232c-.045-.026-.122-.058-.32-.08c-.212-.023-.49-.03-.93-.037c-1.255-.021-2.171-.095-2.976-.429A5.75 5.75 0 0 1 1.688 16.2c-.235-.566-.338-1.178-.389-1.913c-.049-.723-.049-1.618-.049-2.76v-1.066c0-1.604 0-2.86.095-3.865c.098-1.023.3-1.862.752-2.6a5.75 5.75 0 0 1 1.899-1.899c.738-.452 1.577-.654 2.6-.752C7.6 1.25 8.857 1.25 10.461 1.25M6.739 2.839c-.914.087-1.495.253-1.959.537A4.25 4.25 0 0 0 3.376 4.78c-.284.464-.45 1.045-.537 1.96c-.088.924-.089 2.11-.089 3.761v1c0 1.175 0 2.019.046 2.685c.045.659.131 1.089.278 1.441a4.25 4.25 0 0 0 2.3 2.3c.515.214 1.173.294 2.429.316h.031c.398.007.747.013 1.037.045c.311.035.616.104.909.274c.29.17.5.395.682.645c.169.232.342.525.538.856l.559.944a.52.52 0 0 0 .882 0l.559-.944c.196-.331.37-.624.538-.856c.182-.25.392-.476.682-.645c.293-.17.598-.24.909-.274c.29-.032.639-.038 1.037-.045h.032c1.255-.022 1.913-.102 2.428-.316a4.25 4.25 0 0 0 2.3-2.3c.147-.352.233-.782.278-1.441c.046-.666.046-1.51.046-2.685v-1c0-1.651 0-2.837-.089-3.762c-.087-.914-.253-1.495-.537-1.959a4.25 4.25 0 0 0-1.403-1.403c-.464-.284-1.045-.45-1.96-.537c-.924-.088-2.11-.089-3.761-.089h-3c-1.651 0-2.837 0-3.762.089" clip-rule="evenodd"/><path fill="currentColor" d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/></svg><span>Join Discussion</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `Just`,
      min: `minutes ago`,
      hour: `hours ago`,
      day: `days ago`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://raw.githubusercontent.com/liuluhua/liuluhua.github.io/ImageBed/PicGo/2024/05/21/20240521095147.jpg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>
<script type="text/javascript">
  (() => {
    const tagSwitchers = document.querySelectorAll('.tag-subtree.parent-tag > a > .tag-switcher-wrapper')
    for (const tagSwitcher of tagSwitchers) {
      tagSwitcher.addEventListener('click', (e) => {
        const parent = e.target.closest('.tag-subtree.parent-tag')
        parent.classList.toggle('expanded')
        e.preventDefault()
      })
    }

    // Get active tag from query string, then activate it.
    const urlParams = new URLSearchParams(window.location.search)
    const activeTag = urlParams.get('tag')
    if (activeTag) {
      let tag = document.querySelector(`.tag-subtree[data-tag="${activeTag}"]`)
      if (tag) {
        tag.querySelector('a').classList.add('active')
        
        while (tag) {
          tag.classList.add('expanded')
          tag = tag.parentElement.closest('.tag-subtree.parent-tag')
        }
      }
    }
  })()
</script>


<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<script type="text/javascript">
  const applyTheme = (theme) => {
    if (theme === 'auto') {
      document.documentElement.removeAttribute('data-theme')
    } else {
      document.documentElement.setAttribute('data-theme', theme)
    }

    applyThemeToGiscus(theme)
  }

  const applyThemeToGiscus = (theme) => {
    theme = theme === 'auto' ? 'preferred_color_scheme' : theme

    const cmt = document.getElementById('giscus')
    if (cmt) {
      // This works before giscus load.
      cmt.setAttribute('data-theme', theme)
    }

    const iframe = document.querySelector('#comments > section.giscus > iframe')
    if (iframe) {
      // This works after giscus loaded.
      const src = iframe.src
      const newSrc = src.replace(/theme=[\w]+/, `theme=${theme}`)
      iframe.src = newSrc
    }
  }

  const switchTheme = () => {
    // light -> dark -> auto -> light -> ...
    const currentTheme = document.documentElement.getAttribute('data-theme')
    let newTheme;
    switch (currentTheme) {
      case 'light':
        newTheme = 'dark'
        break
      case 'dark':
        newTheme = 'auto'
        break
      default:
        newTheme = 'light'
    }
    applyTheme(newTheme)
    window.localStorage.setItem('Stellar.theme', newTheme)

    const messages = {
      light: `Switched to Light Mode`,
      dark: `Switched to Dark Mode`,
      auto: `Switched to Auto Mode`,
    }
    hud?.toast?.(messages[newTheme])
  }

  (() => {
    // Apply user's preferred theme, if any.
    const theme = window.localStorage.getItem('Stellar.theme')
    if (theme !== null) {
      applyTheme(theme)
    }
  })()
</script>


<!-- optional -->

  <script>
  function loadUtterances() {
    const els = document.querySelectorAll("#comments #utterances");
    if (els.length === 0) return;
    els.forEach((el, i) => {
      try {
        el.innerHTML = '';
      } catch (error) {
        console.error(error);
      }
      var script = document.createElement('script');
      script.src = 'https://utteranc.es/client.js';
      script.async = true;
      for (let key of Object.keys(el.attributes)) {
        let attr = el.attributes[key];
        if (['class', 'id'].includes(attr.name) === false) {
          script.setAttribute(attr.name, attr.value);
        }
      }
      el.appendChild(script);
    });
  }
  window.addEventListener('DOMContentLoaded', (event) => {
      loadUtterances();
  });
</script>




<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
