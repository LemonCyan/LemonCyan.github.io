[{"title":"Qtå›¾è¡¨åº“é€‰å‹æŒ‡å—ï¼šQwtã€QCustomPlotã€Qt Charts æ·±åº¦å¯¹æ¯”","path":"/2026/01/22/3-å¼€å‘æ¡†æ¶-Qt-Standby-Qtå›¾è¡¨åº“é€‰å‹æŒ‡å—-Qwt-QCustomPlot-QChart/","content":"Qwtã€QCustomPlotã€Qt Charts æ˜¯ Qt ç”Ÿæ€ä¸­æœ€å¸¸ç”¨çš„ä¸‰ä¸ªå›¾è¡¨åº“ã€‚å®ƒä»¬çš„æ¶æ„å·®å¼‚ç›´æ¥å½±å“æ€§èƒ½ä¸Šé™å’Œé›†æˆæˆæœ¬ï¼Œè®¸å¯è¯ç­–ç•¥ä¹Ÿå„ä¸ç›¸åŒã€‚æœ¬æ–‡æ±‡æ€»å®˜æ–¹æ–‡æ¡£ã€GitHub Issues å’Œç¤¾åŒºå®æµ‹æ•°æ®ï¼Œç»™å‡ºé€‰å‹æ‰€éœ€çš„å…³é”®ä¿¡æ¯ã€‚ å¿«é€Ÿé€‰å‹ åœºæ™¯ æ¨è ç†ç”± ç§‘å­¦ä»ªå™¨ å·¥ä¸šæ§åˆ¶ Qwt LGPL è®¸å¯ã€å¤–éƒ¨ç¼“å†²åŒºã€ä»ªå™¨æ§ä»¶åº“ å¿«é€ŸåŸå‹ ç¾è§‚ä¼˜å…ˆ QCustomPlot åŒæ–‡ä»¶é›†æˆã€é»˜è®¤æ ·å¼å¥½çœ‹ QML åŸç”Ÿ (Qt 6.8+) Qt Graphs RHI åç«¯ã€å®˜æ–¹æ¨è å­˜é‡å•†ä¸šé¡¹ç›® Qt Charts ä»…é™ç»´æŠ¤å·²æœ‰ä»£ç  å…³é”®å·®å¼‚ï¼š è®¸å¯è¯ï¼šQwt é‡‡ç”¨ LGPL å…¼å®¹åè®®ï¼Œå•†ä¸šé—­æºæ›´å‹å¥½ï¼›QCustomPlot å’Œ Qt Charts æ˜¯ GPL v3 æ€§èƒ½ï¼šQwt QCustomPlot Qt Chartsï¼ˆåè€…å— Graphics View æ¶æ„æ‹–ç´¯ï¼‰ é›†æˆï¼šQCustomPlot ä»…éœ€ 2 ä¸ªæ–‡ä»¶ï¼ŒQwt éœ€ç¼–è¯‘åº“ï¼ŒQt Charts éœ€æ¨¡å—é…ç½® å®æ—¶åˆ·æ–°ï¼šQwt å’Œ QCustomPlot ç¨³å®šæ”¯æŒ 100Hz+ï¼ŒQt Charts è¶…è¿‡ 10Hz å°±ä¼šå¡ [!IMPORTANT]Qt Charts åœ¨ Qt 6.10 æ­£å¼åºŸå¼ƒï¼Œå®˜æ–¹å»ºè®®æ–°é¡¹ç›®ç”¨ Qt Graphsã€‚ å·®å¼‚å¯¹æ¯” ç»´åº¦ Qwt 6.3.x QCustomPlot 2.1.x Qt Charts è®¸å¯è¯ LGPL å…¼å®¹ (Qwt License 1.0) GPL v3 (å•†ä¸šéœ€è´­ä¹°) GPL v3 å•†ä¸š é›†æˆæ–¹å¼ ç¼–è¯‘é™æ€åŠ¨æ€åº“ åŒæ–‡ä»¶ (.h + .cpp) Qt æ¨¡å— æ¸²æŸ“åç«¯ QPainter (å¯é€‰ OpenGL) QPainter (å¯é€‰ OpenGL) Graphics View é€‚ç”¨åœºæ™¯ ä»ªå™¨ã€å·¥ä¸šæ§åˆ¶ å®æ—¶ç›‘æ§ã€åŸå‹ å•†ä¸šæŠ¥è¡¨ Qt ç‰ˆæœ¬ 4.8 5.x 6.x 4.7+ 5.x 6.4 5.x 6.x (6.10 åºŸå¼ƒ) QML æ”¯æŒ éœ€åµŒå…¥ QWidget éœ€åµŒå…¥ QWidget åŸç”Ÿç»„ä»¶ æ¶æ„ä¸‰è€…çš„åº•å±‚æ¶æ„å·®å¼‚å†³å®šäº†æ€§èƒ½ç‰¹å¾ã€‚ QwtQwt åŸºäº QWidgetï¼Œæ ¸å¿ƒç»„ä»¶ QwtPlot ç»§æ‰¿è‡ª QFrameï¼Œåˆ†å±‚ç»˜åˆ¶ï¼š graph TB subgraph QwtPlot Canvas[QwtPlotCanvasbr/ç»˜å›¾ç”»å¸ƒ] Legend[QwtLegendbr/å›¾ä¾‹] Scale[QwtScaleWidgetbr/åæ ‡è½´] end subgraph PlotItems Curve[QwtPlotCurvebr/æ›²çº¿] Marker[QwtPlotMarkerbr/æ ‡è®°] Grid[QwtPlotGridbr/ç½‘æ ¼] Spectrogram[QwtPlotSpectrogrambr/é¢‘è°±å›¾] end Canvas -- PlotItems QwtPlot -- Canvas QwtPlot -- Legend QwtPlot -- Scale æ•°æ®é€šè¿‡ QwtSeriesDataT æ¥å£ç®¡ç†ã€‚å¯ä»¥ç›´æ¥å¼•ç”¨å¤–éƒ¨ç¼“å†²åŒºï¼Œä¸æ‹·è´æ•°æ®ã€‚å¤§è§„æ¨¡ç‚¹é›†æ¸²æŸ“æ—¶ï¼ŒQwtPlotCurve::FilterPoints èƒ½è‡ªåŠ¨æŠ½ç¨€ã€‚ QCustomPlotQCustomPlot è®¾è®¡åæ‰å¹³ï¼ŒåŠŸèƒ½éƒ½å°è£…åœ¨ä¸€ä¸ªç±»é‡Œï¼š // æ•°æ®å®¹å™¨ (QCustomPlot 2.x)class QCPDataContainer QVectorDataType mData; // æŒ‰ key æ’åº // O(log n) èŒƒå›´æŸ¥è¯¢; æ¸²æŸ“æµç¨‹ï¼šæ•°æ®å˜æ›´ â†’ æ ‡è®° dirty â†’ replot() éå†å„ Layer â†’ æ¯ä¸ª Layer å¯ç‹¬ç«‹ç¼“å†²ï¼ˆlmBuffered æ¨¡å¼ï¼‰ã€‚ Qt ChartsQt Charts åŸºäº Graphics View Frameworkï¼Œæ‰€æœ‰å›¾è¡¨å…ƒç´ éƒ½æ˜¯ QGraphicsItemï¼š QChartView (QGraphicsView) â””â”€â”€ QChart (QGraphicsWidget) â”œâ”€â”€ QAbstractSeries â”œâ”€â”€ QAbstractAxis â””â”€â”€ QLegend æ€§èƒ½ç“¶é¢ˆåœ¨è¿™é‡Œã€‚QGraphicsScene çš„äº‹ä»¶åˆ†å‘å¼€é”€å¤§ï¼Œæ¯ä¸ªæ•°æ®ç‚¹å¯¹åº”ä¸€ä¸ª QGraphicsItemï¼Œå†…å­˜å ç”¨é«˜ï¼Œä¹Ÿæ²¡æœ‰ç¡¬ä»¶åŠ é€Ÿçš„è‡ªé€‚åº”é‡‡æ ·ã€‚ æ€§èƒ½å®æµ‹æ•°æ® åœºæ™¯ Qwt 6.2 QCustomPlot 2.1 Qt Charts 5.15 1 ä¸‡ç‚¹é™æ€æ¸²æŸ“ ~15ms ~20ms ~80ms 10 ä¸‡ç‚¹é™æ€æ¸²æŸ“ ~120ms ~180ms ~2500ms+ 100Hz åˆ·æ–° (1000 ç‚¹æ¬¡) ç¨³å®š ç¨³å®š æ˜æ˜¾å¡ æ‹–æ‹½å¹³ç§» æµç•… æµç•… å»¶è¿Ÿ 200-500ms å†…å­˜ (10 ä¸‡ç‚¹) ~8MB ~12MB ~45MB [!NOTE]æ•°æ®æ¥æºäº Qt Forum å’Œ StackOverflow ç¤¾åŒºå®æµ‹ï¼Œç¡¬ä»¶ä¸åŒä¼šæœ‰å·®å¼‚ã€‚Qwt å’Œ QCustomPlot å¼€å¯ OpenGL è¿˜èƒ½å†å¿« 30-50%ã€‚ ä¼˜åŒ–é…ç½®Qwtï¼š // å…³é—­æŠ—é”¯é½¿ã€å¯ç”¨ç‚¹è¿‡æ»¤curve-setRenderHint(QwtPlotItem::RenderAntialiased, false);curve-setCurveAttribute(QwtPlotCurve::FilterPoints);// å¤–éƒ¨ç¼“å†²åŒºé¿å…æ‹·è´class ExternalData : public QwtSeriesDataQPointF const float* m_buffer; size_t m_size; // å®ç° sample() å’Œ size(); QCustomPlotï¼š customPlot-setOpenGl(true); // ç¡¬ä»¶åŠ é€Ÿ// åˆ†å±‚ç¼“å†²QCPLayer *dataLayer = customPlot-addLayer(data);dataLayer-setMode(QCPLayer::lmBuffered);// æ‰¹é‡æ›´æ–°QVectordouble keys, values;graph-setData(keys, values, true); // alreadySortedcustomPlot-setNoAntialiasingOnDrag(true); // æ‹–æ‹½æ—¶å…³æŠ—é”¯é½¿ Qt Chartsï¼š series-setUseOpenGL(true); // æ•ˆæœæœ‰é™// ç”¨ replace ä»£æ›¿ appendï¼Œå¿« 10 å€QVectorQPointF points;series-replace(points);chartView-setRenderHint(QPainter::Antialiasing, false); é€‰å‹å†³ç­–æ ‘flowchart TD Start[éœ€æ±‚åˆ†æ] -- Q1QML åŸç”Ÿ? Q1 --|æ˜¯| QML[Qt Graphs] Q1 --|å¦| Q2è®¸å¯è¯? Q2 --|éœ€ LGPL| Qwt[Qwt] Q2 --|GPL å¯æ¥å—| Q3æ•°æ®é‡? Q3 --|50 ä¸‡ç‚¹| Qwt2[Qwt + å¤–éƒ¨ç¼“å†²åŒº] Q3 --|1-50 ä¸‡ç‚¹| Q4å¼€å‘å‘¨æœŸ? Q4 --|èµ¶| QCP[QCustomPlot] Q4 --|é•¿æœŸ| Q5è¦ä»ªè¡¨ç›˜? Q5 --|è¦| Qwt3[Qwt] Q5 --|ä¸ç”¨| QCP2[QCustomPlot] å·¥ä¸šç›‘æ§æ¨è Qwtã€‚ å…¸å‹åœºæ™¯ï¼š8-32 é€šé“æ³¢å½¢ã€1kHz+ é‡‡æ ·ç‡ã€é¢‘è°±å›¾ç€‘å¸ƒå›¾ã€7Ã—24 è¿è¡Œã€‚ Qwt çš„ QwtPlotSpectrogram åŸç”Ÿæ”¯æŒé¢‘è°±å’Œçƒ­åŠ›å›¾ï¼Œå†…å­˜æ•ˆç‡é«˜ã€‚QwtWheelã€QwtKnob ç­‰å·¥ä¸šæ§ä»¶ä¹Ÿæ˜¯ç°æˆçš„ã€‚ç¤ºæ³¢å™¨ã€é¢‘è°±ä»ªç”¨å®ƒçš„å¾ˆå¤šã€‚ å¿«é€ŸåŸå‹æ¨è QCustomPlotã€‚ å…¸å‹åœºæ™¯ï¼šå‘¨æœŸæ€§æŠ¥è¡¨ã€10-100Hz æ›²çº¿ç›‘æ§ã€èµ¶å·¥æœŸã€æ ·å¼è¦å¥½çœ‹ã€‚ ä¸¤ä¸ªæ–‡ä»¶ä¸¢è¿›é¡¹ç›®å°±èƒ½ç”¨ï¼Œä¸ç”¨é…æ„å»ºç³»ç»Ÿã€‚é»˜è®¤æ ·å¼æ¯”è¾ƒç°ä»£ï¼Œäº¤äº’åŠŸèƒ½ä¹Ÿå…¨ã€‚ç¤¾åŒºæ´»è·ƒï¼Œç¤ºä¾‹å¤šã€‚ QML åº”ç”¨æ¨è Qt Graphsï¼ˆQt 6.8+ï¼‰ã€‚ é€‚åˆé™æ€æˆ–ä½é¢‘æ›´æ–°å›¾è¡¨ã€éœ€è¦ QML æ·±åº¦é›†æˆã€é¥¼å›¾æŸ±çŠ¶å›¾ä¹‹ç±»çš„å•†ä¸šå›¾è¡¨ã€‚ [!WARNING]Qt Charts å·²åºŸå¼ƒã€‚è€ä»£ç é‡Œå¦‚æœç”¨äº†å®ƒï¼Œæ³¨æ„ GPL v3 è®¸å¯è¯å¯¹å•†ä¸šé¡¹ç›®çš„é™åˆ¶ã€‚ å±€é™æ€§Qwt é—®é¢˜ æè¿° è§£æ³• Windows ç¼–è¯‘éº»çƒ¦ æ²¡é¢„ç¼–è¯‘åŒ…ï¼Œè¦æ‰‹åŠ¨é… qmake çœ‹ qwt.pro é…ç½® QML åµŒå…¥å·® åŸºäº QWidget ç”¨ QQuickWidget åŒ…è£… ä¸Šæ‰‹æ…¢ API ååº•å±‚ ä» examples ç›®å½•å­¦èµ· 3D å¼± QwtPlot3D åœæ›´äº† æ¢ Qt Data Visualization QCustomPlot é—®é¢˜ æè¿° è§£æ³• é•¿è·‘å†…å­˜æ¶¨ æ•°æ®ç‚¹ç´¯ç§¯ åšæ»‘åŠ¨çª—å£ QML é‡Œæ…¢ åµŒè¿›å»å¸§ç‡æ‰ å•ç‹¬å¼€ QWidget çª—å£ GPL é™åˆ¶ å•†ä¸šé—­æºè¦ä¹°è®¸å¯ è”ç³»ä½œè€… ç™¾ä¸‡ç‚¹æ’‘ä¸ä½ è¶… 100 ä¸‡ç‚¹å°±æ…¢ é™é‡‡æ · Qt Charts é—®é¢˜ æè¿° è§£æ³• åºŸå¼ƒäº† 6.10 èµ·ä¸ç»´æŠ¤ è¿åˆ° Qt Graphs æ¶æ„é™åˆ¶ Graphics View å¼€é”€å¤§ æ²¡æ•‘ å‡ åƒç‚¹å°±å¡ å¤§æ•°æ®é›†æ’‘ä¸ä½ æ¢ QCustomPlot å®æ—¶å·® é«˜é¢‘åˆ·æ–°åƒä¸æ¶ˆ æ‰¹é‡ replace + é™å¸§ç‡ æ€ä¹ˆé€‰ è®¸å¯è¯æ•æ„Ÿ â†’ Qwtï¼ˆLGPLï¼‰ æ€§èƒ½ä¼˜å…ˆ â†’ Qwt â‰¥ QCustomPlot Qt Charts å¿«é€Ÿé›†æˆ â†’ QCustomPlotï¼ˆä¸¤æ–‡ä»¶ï¼‰ Qt Charts Qwt QML åŸç”Ÿ â†’ Qt Graphs å…¶ä»– ç»“åˆå†³ç­–æ ‘å’Œå®é™…çº¦æŸæƒè¡¡å³å¯ã€‚ å‚è€ƒ Qwt å®˜æ–¹æ–‡æ¡£ QCustomPlot æ–‡æ¡£ Qt Graphs Qt Charts åºŸå¼ƒè¯´æ˜ Qt Forum","tags":["Qt","Qwt","æ•°æ®å¯è§†åŒ–","QCustomPlot","å›¾è¡¨åº“","QChart"],"categories":["å¼€å‘æ¡†æ¶","Qt"]},{"path":"/2026/01/22/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-åšå®¢-Hexoéƒ¨ç½²ä¸ä½¿ç”¨/","content":"Hexo éƒ¨ç½²Hexo æ˜¯ä¸€ä¸ªåŸºäº Node.js çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œä¸»è¦ç”¨äºå¿«é€Ÿã€ç®€å•åœ°æ­å»ºä¸ªäººåšå®¢æˆ–é™æ€ç½‘ç«™ã€‚å®ƒé‡‡ç”¨ Markdown æ ¼å¼æ¥æ’°å†™å†…å®¹ï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„ä¸»é¢˜å’Œæ’ä»¶ç”Ÿæ€ç³»ç»Ÿï¼Œå¯ä»¥è½»æ¾æ‰©å±•å’Œå®šåˆ¶ç½‘ç«™åŠŸèƒ½å’Œå¤–è§‚ã€‚ é€‚ç”¨äºä¸ªäººåšå®¢ã€é¡¹ç›®æ–‡æ¡£ã€ä¸ªäººç®€å†ç­‰å„ç§é™æ€ç½‘ç«™çš„æ­å»ºå’Œç®¡ç†ã€‚ ç›®å½•æ¶æ„_config.yml #ç½‘ç«™çš„é…ç½®ä¿¡æ¯package.json #åº”ç”¨ç¨‹åºçš„ä¿¡æ¯scaffolds #æ¨¡ç‰ˆæ–‡ä»¶å¤¹source #å­˜æ”¾ç”¨æˆ·èµ„æºï¼ŒMarkdown æ–‡æ¡£ _drafts _poststhemes #ä¸»é¢˜æ–‡ä»¶å¤¹public #ç½‘ç«™æ–‡ä»¶ Hexo ä½¿ç”¨ä½¿ç”¨æµç¨‹ å®‰è£… hexosudo npm install -g hexo-cli æŸ¥çœ‹ç‰ˆæœ¬ï¼Œç¡®è®¤å®‰è£…æˆåŠŸ hexo -v åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ Hexoï¼Œå¹¶åˆå§‹åŒ–è¯¥æ–‡ä»¶å¤¹ hexo init Hexo æ¸…é™¤ç¼“å­˜ hexo clean ç”Ÿæˆé™æ€æ–‡ä»¶ hexo g å¼€å¯æœ¬åœ°æœåŠ¡å™¨å¹¶ä¿®æ”¹ç«¯å£ä¸º 80hexo s -p 9050 å¸¸ç”¨å‘½ä»¤ npm install -g hexo-cli #å®‰è£…Hexo npm update hexo -g #å‡çº§ hexo init #åˆå§‹åŒ–åšå®¢ å‘½ä»¤ç®€å†™ hexo n çš„åšå®¢hexo new çš„åšå®¢ #æ–°å»ºæ–‡ç«  hexo ghexo generate #ç”Ÿæˆ hexo shexo server #å¯åŠ¨æœåŠ¡é¢„è§ˆ hexo dhexo deploy #éƒ¨ç½² hexo server #Hexoä¼šç›‘è§†æ–‡ä»¶å˜åŠ¨å¹¶è‡ªåŠ¨æ›´æ–°ï¼Œæ— é¡»é‡å¯æœåŠ¡å™¨ hexo server -s #é™æ€æ¨¡å¼ hexo server -p 5000 #æ›´æ”¹ç«¯å£ hexo server -i 192.168.1.1 #è‡ªå®šä¹‰ IP hexo clean #æ¸…é™¤ç¼“å­˜ï¼Œè‹¥æ˜¯ç½‘é¡µæ­£å¸¸æƒ…å†µä¸‹å¯ä»¥å¿½ç•¥è¿™æ¡å‘½ä»¤ç«¯å£ä¿®æ”¹ node_modules\\hexo-server\\index.js ä¸´æ—¶å¯åŠ¨ hexo s -p 9050 hexo generate å°† Hexo æºç ç›®å½•ä¸­å·²æœ‰çš„æºç ç¼–è¯‘ç”Ÿæˆä¸ºé™æ€ç½‘é¡µæ–‡ä»¶ï¼Œç”Ÿæˆä»¥ä¸‹ï¼š db.json æ–‡ä»¶ï¼šç¼–è¯‘è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸­é—´æ–‡ä»¶ï¼Œä¸ç”¨å…³å¿ƒï¼› public æ–‡ä»¶å¤¹ï¼šæ–°ç”Ÿæˆçš„é™æ€ç½‘é¡µæ–‡ä»¶å°±å­˜æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚ hexo deploy å°†é™æ€ç½‘é¡µæ–‡ä»¶æ¨é€åˆ° GitHub Pages Hexo ä¼šå°†Â publicÂ ç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•æ¨é€è‡³Â _config.ymlÂ ä¸­æŒ‡å®šçš„è¿œç«¯ä»“åº“å’Œåˆ†æ”¯ä¸­ï¼Œå¹¶ä¸”å®Œå…¨è¦†ç›–è¯¥åˆ†æ”¯ä¸‹çš„å·²æœ‰å†…å®¹ å¿«æ·ç¼–è¾‘é…ç½®æ–‡ä»¶ç«™ç‚¹é…ç½®æ–‡ä»¶å’Œä¸»é¢˜é…ç½®æ–‡ä»¶æ˜¯ DIY åšå®¢ç»å¸¸è¦ç¼–è¾‘çš„ä¸¤ä¸ªæ–‡ä»¶ï¼Œåœ¨ Obsidian ä¸­æ²¡æ³•ç¼–è¾‘ yml æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ URL æ¥æ‰“å¼€ yml æ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨é»˜è®¤çš„ç¼–è¾‘å™¨æ‰“å¼€ã€‚åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨äºç¼–è¾‘é…ç½®çš„æ–‡ä»¶ï¼Œå†™å…¥ä¸¤ä¸ªé…ç½®æ–‡ä»¶æ‰€åœ¨çš„ç›¸å¯¹è·¯å¾„ï¼š [æ‰“å¼€ç«™ç‚¹é…ç½®æ–‡ä»¶](Blog/_config.yml)[æ‰“å¼€ä¸»é¢˜é…ç½®æ–‡ä»¶](Blog/themes/stellar/_config.yml)# æˆ–è€…é€šè¿‡osidianæ’ä»¶shellcommandsæ‰“å¼€.å¼€å¤´çš„éšè—æ–‡ä»¶[Github åŒæ­¥å¿½ç•¥æ–‡ä»¶é…ç½®](obsidian://shell-commands/?vault=BlogDeployexecute=f4b02rlcvr) ç«™ç‚¹é…ç½®æ–‡ä»¶åœ¨ blog æ ¹ç›®å½•é‡Œçš„ _config.yml æ–‡ä»¶ç§°ä¸ºç«™ç‚¹é…ç½®æ–‡ä»¶ ä¸»é¢˜ä¿®æ”¹:theme ç½‘ç«™æ ‡é¢˜:title å‰¯æ ‡é¢˜:subtitle ç½‘ç«™æè¿°:description ä½œè€…:author ç½‘ç«™å¤´åƒå¤–éƒ¨é“¾æ¥:avatar ç½‘ç«™è¯­è¨€:language:zh-Hans æ—¶åŒº:timezone:AsiaShanghai è‡ªå®šä¹‰åŸŸåï¼šurl: å¿½ç•¥æ–‡ä»¶ï¼š skip_render: # æ’é™¤ä¸€äº›obsidianç¼–è¾‘å™¨çš„æ–‡ä»¶å’Œä¸€äº›è„šæœ¬/æ¨¡æ¿æ–‡ä»¶ - _posts/.obsidian/* - _posts/Scripts/* - _posts/Templates/* ä¸»é¢˜é…ç½®æ–‡ä»¶ä½¿ç”¨çš„ä¸»é¢˜ï¼šstellar æˆ–è€… Nextï¼ŒäºŒé€‰å…¶ä¸€ è¿›å…¥æ ¹ç›®å½• themes æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸ª _config.yml æ–‡ä»¶ï¼Œä¸ºä¸»é¢˜é…ç½®æ–‡ä»¶ ç¤¾äº¤å¤–é“¾çš„è®¾ç½®ï¼Œå³åœ¨ä¾§æ å±•ç¤ºçš„ä¸ªäººç¤¾äº¤ç½‘ç«™ä¿¡æ¯ã€‚(æ’ä»¶ jiathis) æ’å…¥ç½‘æ˜“äº‘ï¼Œè¿›å…¥ç½‘é¡µç‰ˆçš„ç½‘æ˜“äº‘éŸ³ä¹ï¼Œé€‰æ‹©å–œæ¬¢çš„éŸ³ä¹ï¼Œç‚¹å‡»ç”Ÿæˆå¤–é“¾æ’­æ”¾å™¨ï¼Œåœ¨ä¾§æ æ’å…¥è¿™é¦–æ­Œçš„éŸ³ä¹æ’­æ”¾å™¨ï¼Œä¿®æ”¹ blog/themes/next/layout/_macro çš„ sidebar.swig æ–‡ä»¶ï¼Œæ·»åŠ åˆšåˆšå¤åˆ¶çš„å¤–é“¾ä»£ç  è®¾ç½®èƒŒæ™¯ï¼Œåœ¨ blog/themes/next/source/css/_custom æ–‡ä»¶çš„ custom.styl é¦–éƒ¨æ·»åŠ  body background:url(./background.jpg); background-attachment: fixed; ï¼Œfixed å›ºå®šèƒŒæ™¯å›¾ç‰‡ å¢åŠ ä¾§æ èœå•æ¡ç›®ï¼Œé»˜è®¤çš„ä¾§æ èœå•æ¡ç›®æœ‰ï¼šé¦–é¡µã€å½’æ¡£ã€æ ‡ç­¾ã€å…³äºã€æœç´¢ç­‰ã€‚å¦‚æœæƒ³è¦å¢åŠ å…¶ä»–çš„èœå•æ¡ç›®ï¼Œä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ _config.yml é‡Œçš„ Menu Settings ä¸­çš„ menu å’Œ menu_icons ä¸¤ä¸ªåœ°æ–¹ åŸŸåé…ç½®æ–‡ä»¶è¿›å…¥ blog/source ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶å CNAMEï¼Œå†™å…¥çš„è‡ªå®šä¹‰åŸŸå Front-matterFront-matter æ˜¯æ–‡ä»¶æœ€ä¸Šæ–¹ä»¥Â ---Â åˆ†éš”çš„åŒºåŸŸï¼Œç”¨äºæŒ‡å®šä¸ªåˆ«æ–‡ä»¶çš„å˜é‡ã€‚ æ‰©å±•ï¼šabbrlinkæ–‡ç« æ°¸ä¹…é“¾æ¥ categoryå¹¶åˆ—åˆ†ç±»ï¼Œäº†è§£ä¸€ä¸‹ï¼š categories: - [Linux] - [Tools]å¹¶åˆ—+å­åˆ†ç±»ï¼Œå†äº†è§£ä¸€ä¸‹ï¼š categories: - [Linux, Hexo] - [Tools, PHP] è‡ªå®šä¹‰æ–‡ç« æ ‡ç­¾ç”Ÿæˆæ ‡ç­¾é¡µé¢ hexo new page tagsï¼Œä¿®æ”¹ blogsourcetagsindex.mdï¼Œæ·»åŠ  type: â€œtagsâ€ title: tagsdate: 2023-01-08 11:27:57type: tags ä»¥åå°±å¯ä»¥åœ¨æ–‡ç« æ–‡ä»¶å¤´æ·»åŠ æ ‡ç­¾äº†ï¼Œå¦‚ä¸‹ title: Hexo + GitHub æ­å»ºä¸ªäººåšå®¢date: 2023-01-07 13:15:00tags:- Hexo- Next- åšå®¢ æ‰‹åŠ¨ç”Ÿæˆå’Œæ·»åŠ æ˜¯ååˆ†ç¹ççš„ï¼Œåç»­åˆ©ç”¨æ’ä»¶å½¢å¼æŒ‰ç…§ç›®å½•æ ¼å¼ä¸ºæ–‡ç« è‡ªåŠ¨ç”Ÿæˆæ ‡ç­¾ã€‚ éƒ¨ç½²æ’ä»¶ hexo-deployer-gitÂ ç¼–è¾‘ Hexo é¡¶å±‚ç›®å½•ä¸‹çš„ _config.yml æ–‡ä»¶ï¼Œæ–‡ä»¶æœ€åå¯ä»¥çœ‹åˆ° deployment ç›¸å…³å†…å®¹ deployï¼š type: git repo: git@github.com:liuluhua/liuluhua.github.io.git branch: main repo å¡«å†™ä»“åº“ ssh åœ°å€ branch çš„å¡«å†™éœ€è¦å’Œ GitHub Pageséƒ¨åˆ†æŒ‡å®šçš„Branchä¿æŒä¸€è‡´ æœç´¢æ’ä»¶ hexo-generator-searchdbstellar è‡ªå¸¦äº†æœç´¢æ’ä»¶ï¼Œæ•…æœªé…ç½®è¯¥æ’ä»¶ å®‰è£… hexo-generator-searchdbnpm install hexo-generator-searchdb ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ local_search: enable: true è‡ªåŠ¨æ ‡ç­¾æ’ä»¶ hexo-auto-categoryè¯¥æ’ä»¶åœ¨ Hexo è¿›è¡Œ build çš„æ—¶å€™ä¼šå»è‡ªåŠ¨æ ¹æ®æ–‡ç« ç›®å½•æƒ…å†µæ¥è‡ªåŠ¨ä¿®æ”¹æ–‡ç« çš„Â categoriesÂ ä¿¡æ¯ å®‰è£…æ’ä»¶ npm install hexo-auto-category --save ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶ _config.ymlï¼Œä½¿æ–‡ç« é“¾æ¥æ¸…æ™° # Generate categories from directory-tree# Dependencies: https://github.com/xu-song/hexo-auto-category# depth: the max_depth of directory-tree you want to generate, should 0# multiple: multiple category hierarchiesauto_category: enable: true multiple: true depth: 5# ä¿®æ”¹ permalink è®©çš„æ–‡ç« é“¾æ¥æ›´åŠ å‹å¥½ï¼Œå¹¶ä¸”æœ‰ç›Šäº SEO permalink: :year/:month/:hash.html# è§„å®šçš„æ–°æ–‡ç« åœ¨ _post ç›®å½•ä¸‹æ˜¯ä»¥ cateory new_post_name: :category/:title| è¯¥æ’ä»¶éœ€è¦æ¯æ¬¡æ‰‹åŠ¨æ„å»ºæ‰§è¡Œ hexo g æ—¶æ‰ä¼šæ›´æ–° categories ä¿¡æ¯ã€‚ ä»“åº“éƒ¨ç½²åœ¨æœ¬åœ°ï¼Œä¸Šä¼ æ—¶ä½¿ç”¨ git hookï¼Œåœ¨æ¯æ¬¡æ‰§è¡ŒÂ commitÂ å‰éƒ½è‡ªåŠ¨è¿è¡ŒÂ npx hexo generateÂ è§¦å‘è‡ªåŠ¨ç”ŸæˆÂ categoriesÂ çš„è¡Œä¸ºï¼Œå¹¶å°†ç”Ÿæˆåçš„å˜æ›´è‡ªåŠ¨æ·»åŠ åˆ°æœ¬æ¬¡æäº¤ä¸­ï¼Œç„¶åä¸€åŒ push åˆ° github ä¸Šå»ã€‚è¿™é‡Œå¯ä»¥ä½¿ç”¨ husky æ¥å¾ˆæ–¹ä¾¿çš„è®¾ç½®è¿™æ ·ä¸€ä¸ª git hook 1. å®‰è£… huksyï¼šnpm install husky --save-dev 2. æ‰§è¡Œ huksy åˆå§‹åŒ–æŒ‡ä»¤ï¼šnpx husky install *3. åœ¨Â package.jsonÂ ä¸­çš„Â scriptsÂ ä¸­å†™å…¥ï¼šprepare: husky install 4. åœ¨ç”Ÿæˆçš„Â .huskyÂ ç›®å½•åˆ›å»ºÂ pre-commitÂ æ–‡ä»¶ï¼ˆchmod a+x pre-commitï¼‰ï¼Œå¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼Œä¹‹åæäº¤ä»£ç æ—¶ï¼Œæ£€æŸ¥æœ‰æ—  categories çš„ç”Ÿæˆä¿¡æ¯ã€‚ #!/usr/bin/env sh . $(dirname -- $0)/_/husky.sh npx hexo generate git add . ä»“åº“éƒ¨ç½²åœ¨ GitHub æ—¶ç›´æ¥åˆ©ç”¨ GitHub Actions è‡ªåŠ¨ç”Ÿæˆ ç«™ç‚¹åœ°å›¾ hexo-generator-sitemapä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ menu: sitemap: /sitemap.xml || fa fa-sitemap æ‰§è¡Œ hexo cl hexo g ç”Ÿæˆ sitemap.xml æ­¤æ—¶å¯ä»¥åœ¨ blog/public æ–‡ä»¶å¤¹ä¸‹çœ‹åˆ° sitemap.xml éªŒè¯ï¼Œè¿›å…¥Â Google Search ConsoleÂ ï¼Œé€‰æ‹©ç½‘å€å‰ç¼€ï¼Œè¾“å…¥ç½‘å€æ—¶è®°å¾—åŠ ä¸Š https:ï¼Œé€‰æ‹© HTML æ ‡è®°ï¼Œä¼šå¾—åˆ°å…ƒæ ‡è®° meta name=google-site-verification content=xxxxxxxx /ï¼Œå°† content åçš„å†…å®¹åŠ å…¥åˆ°ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ google_site_verification: xxxxxxxxï¼Œæ‰§è¡Œ hexo cl hexo g hexo d ç‚¹å‡»å‰å¾€èµ„æºé¡µé¢ï¼Œæ·»åŠ ç«™ç‚¹åœ°å›¾ï¼ŒæˆåŠŸæäº¤ é™æ€èµ„æºå‹ç¼© hexo-neatä¸»é¢˜é…ç½®æ–‡ä»¶æ·»åŠ é…ç½® neat_enable: trueneat_html: enable: true exclude:neat_css: enable: true exclude: - **/*.min.cssneat_js: enable: true mangle: true output: compress: exclude: - **/*.min.js å­—æ•°ç»Ÿè®¡ hexo-word-counterè¯„è®ºç³»ç»Ÿ utterancUtterances æ˜¯ä¸€ä¸ªåŸºäº Github Issues çš„è½»é‡çº§è¯„è®ºç³»ç»Ÿï¼Œä¸»é¡µåœ°å€ http://utteranc.es Hexo Stellar ä¸»é¢˜çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š ######## Comments ########comments: service: utterances # beaudar, utterances, giscus, twikoo, waline, artalk comment_title: å¿«æ¥å‚ä¸è®¨è®ºå§~ # utterances # https://utteranc.es/ utterances: repo: liuluhua/liuluhua.github.io issue-term: title issue-number: theme: preferred-color-scheme label: ğŸ’¬ å…¶ä»–ä½¿ç”¨æƒ…å†µä¸‹ï¼Œåœ¨ç½‘é¡µéœ€è¦æ’å…¥ Utterances è¯„è®ºçš„ä½ç½®ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç ï¼ˆusernameï¼Œreponame åˆ†åˆ«ä¿®æ”¹ä¸º GitHub ç”¨æˆ·åï¼Œä»“åº“åï¼‰ã€‚ script src=https://utteranc.es/client.js repo=username/reponame issue-term=pathname theme=github-light crossorigin=anonymous async/script è®¾ç½®å­—ä½“éœé¹œæ–‡æ¥·å­—åº“ GitHub åœ°å€ï¼š https://github.com/lxgw/LxgwWenKai æ›´æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼Œå¢åŠ å¦‚ä¸‹å­—æ®µ inject: head: link rel=stylesheet href=https://cdn.jsdelivr.net/gh/satouriko/LxgwWenKai_Webfonts@v1.101/dist/LXGWWenKaiMono-Bold.css / æ›´æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ° style å­—æ®µåœ¨ font-family ä¸­å¢åŠ å­—ä½“åç§°ï¼š style: font-family: logo: LXGWWenKaiMono body: LXGWWenKaiMono code: LXGWWenKaiMono codeblock: LXGWWenKaiMono Canvas nest èƒŒæ™¯åŠ¨ç”» åœ¨ blog/source/_data æ–‡ä»¶å¤¹ä¸‹æ–°å»º footer.njk å¹¶ç¼–è¾‘ script color=0,255,255 opacity=1 zIndex=-1 count=70 src=https://cdn.staticfile.org/canvas-nest.js/1.0.1/canvas-nest.js/script ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ custom_file_path: footer: source/_data/footer.njk stellar ä¸»é¢˜ä¸­ç›´æ¥æ·»åŠ åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ _config.yml footer çš„ content ä¸­ è®¾ç½®èƒŒæ™¯éŸ³ä¹åœ¨ stellar ä¸»é¢˜çš„ _data/widgets.yml æ–‡ä»¶ä¸­æ‰¾åˆ° welcome å­—æ®µï¼Œåœ¨å…¶ä¸­çš„ content éƒ¨åˆ†æ·»åŠ ï¼š welcome: layout: markdown title: å“ˆå–½~ æ—…äººï¼š content: |iframe frameborder=no border=0 marginwidth=0 marginheight=0 width=224 height=86 src=//music.163.com/outchain/player?type=2id=512983678auto=1height=66/iframe ç™¾åº¦æ•°æ®åˆ†æè¿›å…¥ https://tongji.baidu.com/ ç”³è¯·è´¦å·åï¼Œè¾“å…¥ç½‘å€è·å–ç»Ÿè®¡ä»£ç ï¼Œä¹‹ååœ¨ stellar ä¸»é¢˜çš„é…ç½®æ–‡ä»¶ _config.yml çš„æ‰©å±•æ’ä»¶éƒ¨åˆ†æ’å…¥ä»¥ä¸‹ä»£ç ï¼š baiduanalytics: enable: true # ä½¿èƒ½ç™¾åº¦åˆ†ææ¥å£ inject: | ...æ‰©å±•æ’ä»¶ä»£ç  MathJax å®‰è£… hexo-filter-mathjax ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ math: mathjax: enable: true æ­¤åå¯åœ¨æ–‡ç« æ–‡ä»¶å¼€å¤´æ·»åŠ å‚æ•° mathjax: true ä»¥ä½¿ç”¨ MathJax CDN ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ vendors: plugins: custom custom_cdn_url: https://cdn.staticfile.org/$cdnjs_name/$version/$cdnjs_file è¿è¡Œæ—¶é—´next ä¸»é¢˜åœ¨ /blog/themes/next/layout/_partials/footer.njk ä¸­æ·»åŠ  stellar ä¸»é¢˜åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ _config.yml ä¸­æ‰¾åˆ° footer: ä¸­çš„ content: |ï¼Œåœ¨å…¶åæ·»åŠ  div span id=timeDateè½½å…¥å¤©æ•°.../span span id=timesè½½å…¥æ—¶åˆ†ç§’.../span/divscript var now = new Date(); function createtime() var grt= new Date(05/20/2024 05:20:00);//æ­¤å¤„ä¿®æ”¹çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´ now.setTime(now.getTime()+250); days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); if(String(hnum).length ==1 )hnum = 0 + hnum; minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); mnum = Math.floor(minutes); if(String(mnum).length ==1 )mnum = 0 + mnum; seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); snum = Math.round(seconds); if(String(snum).length ==1 )snum = 0 + snum; document.getElementById(timeDate).innerHTML = æœ¬ç«™å·²å®‰å…¨è¿è¡Œ +dnum+ å¤© ; document.getElementById(times).innerHTML = hnum + å°æ—¶ + mnum + åˆ† + snum + ç§’; setInterval(createtime(),250);/script æ–‡ç« é¡µçœ‰æ˜¾ç¤ºæ ‡ç­¾ç”¨äº next ä¸»é¢˜ åœ¨ blog/source/_data æ–‡ä»¶å¤¹ä¸‹æ–°å»º post-meta.njk å¹¶ç¼–è¾‘ span class=post-meta-item %- if post.tags and post.tags.length % %- set tag_indicate = i class=fa fa-tag/i if theme.tag_icon else # % span class=post-tags %- for tag in post.tags.toArray() % a href= url_for(tag.path) rel=tag tag_indicate tag.name /a %- endfor % /span %- endif %/span ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ custom_file_path: postMeta: source/_data/post-meta.njk è¯„è®ºç³»ç»Ÿ Waline Walineè¯„è®ºç³»ç»Ÿçš„é…ç½® å‰å¾€ Waline å®˜ç½‘ æ ¹æ®æŒ‡å¼•åˆ° Vercel è¿›è¡Œ Waline æœåŠ¡ç«¯éƒ¨ç½² å®‰è£… @walinehexo-nextnpm install @waline/hexo-next ä¸ºäº†ä¸ä½¿ç”¨é­”æ³•ä¹Ÿèƒ½æ­£å¸¸è¯„è®ºï¼Œéœ€è¦æœ‰è‡ªå·±çš„åŸŸåè§£æåˆ° Waline æœåŠ¡ç«¯ï¼Œå¯ä»¥åœ¨åŸŸåæ§åˆ¶å°ç»™è‡ªå·±çš„åšå®¢åŸŸåæ·»åŠ äºŒçº§åŸŸåï¼Œæ·»åŠ  CNAME è§£æåˆ° cname-china.vercel-dns.com æˆ–æ·»åŠ  A è§£æåˆ° 76.223.126.88ï¼ˆä¹Ÿå¯ä»¥å‰å¾€ Vercel All IP è‡ªè¡ŒæŒ‘é€‰åˆé€‚çš„èŠ‚ç‚¹ï¼‰ï¼Œæ¥ç€è¿›å…¥ Vercel çš„ Waline åº”ç”¨çš„æ§åˆ¶å°ï¼Œåœ¨ Settings-Domains é‡Œæ·»åŠ ä¸Šæ–‡æåˆ°çš„äºŒçº§åŸŸåï¼Œè¿™æ ·åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶æ·»åŠ é…ç½®åå°±å¯ä»¥æ­£å¸¸è¯„è®ºäº† ä¸»é¢˜é…ç½®æ–‡ä»¶æ·»åŠ é…ç½® é…ç½®å®Œè¯„è®ºååŠæ—¶åˆ° Waline æœåŠ¡ç«¯ç™»å½•ï¼Œä»¥ä¾¿ç®¡ç†è¯„è®º å¯é€‰æ‹©å¼€å¯è¯„è®ºé‚®ä»¶æé†’åŠŸèƒ½ï¼ŒÂ Waline å®˜ç½‘Â æœ‰è¯¦ç»†çš„è¯´æ˜ é˜…è¯»é‡ç»Ÿè®¡ç”¨äº next ä¸»é¢˜ Leancloudï¼ˆhttps://console.leancloud.cn/ï¼‰ åˆ›å»ºåº”ç”¨ï¼Œè¿›å…¥è¯¥åº”ç”¨çš„Â è®¾ç½®-åº”ç”¨å‡­è¯ï¼Œæ‰¾åˆ°Â AppIDÂ å’ŒÂ AppKeyï¼Œè®°å½•ä¸‹æ¥åé¢é…ç½®è¦ç”¨ é…ç½® _config.yml å¯ç”¨ç½‘é¡µè®¿é—®ç»Ÿè®¡ï¼Œé…ç½®Â leancloud çš„Â app_idÂ å’ŒÂ app_keyï¼Œæ‰“å¼€è®¡æ•°åŠŸèƒ½ï¼Œç»Ÿè®¡æ¥æºæ”¹ä¸ºÂ leancloud #ç½‘é¡µè®¿é—®ç»Ÿè®¡#Analysis of website visitorsweb analytics: enable:trueleancloud: app id: app key: # æµè§ˆé‡è®¡æ•°# Number of visitsviews: enable:true #ç»Ÿè®¡æ•°æ®æ¥æº #Data Source #Options:busuanzi | leancloud source:leancloud format:æ¬¡ PVã€UV ç»Ÿè®¡æ•°ç”¨äº next ä¸»é¢˜æ˜¾ç¤ºé¡µé¢çš„è®¿é—®é‡å’Œè®¿å®¢æ•°é‡ # å±•ç¤ºç½‘ç«™çš„ pvã€w ç»Ÿè®¡æ•°# Display website pv and uv statisticsstatistics: enable:true #ç»Ÿè®¡æ•°æ®æ¥æºï¼Œä½¿ç”¨leancloud éœ€è¦è®¾ç½®web analytics:leancloudä¸­çš„å‚æ•°;busuanzi æ˜¾ç¤ºç»Ÿè®¡æ•°æ®å¾ˆå¤§å±äºæ­£å¸¸ç°è±¡ï¼Œéƒ¨ç½²åä¼šæ­£å¸¸ # Data source.If use leancloud,you need to set the parameter inweb analytics:leancloud # Options:busuanzian | leancloud source:leancloud #é¡µé¢æ˜¾ç¤ºçš„æ–‡æœ¬ï¼Œæ˜¯æ•°å­—çš„å ä½ç¬¦(å¿…é¡»åŒ…å«)ï¼Œä¸‹åŒ # Displayed text, is a placeholder for numbers (must be included), the same below pv format:æ€»è®¿é—®é‡ æ¬¡ uv format:æ€»è®¿å®¢æ•° äºº è¯å¥ APIp id=hitokotoa href=# id=hitokoto_text:D è·å–ä¸­.../a/pscriptfetch(https://v1.hitokoto.cn).then(response = response.json()).then(data = const hitokoto = document.querySelector(#hitokoto_text)hitokoto.href = `https://hitokoto.cn/?uuid=$data.uuid`hitokoto.innerText = data.hitokoto).catch(console.error)/script","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨","åšå®¢"]},{"title":"å¼€æºè½¯ä»¶æˆæƒåè®®å®Œæ•´æŒ‡å—ï¼šGPLã€LGPLã€MITã€Apache 2.0 ä¸ BSD æ·±åº¦è§£æ","path":"/2026/01/22/3-å¼€å‘æ¡†æ¶-Qt-å¼€æºè½¯ä»¶æˆæƒåè®®å®Œæ•´æŒ‡å—/","content":"æ ¸å¿ƒæ¦‚å¿µï¼šCopyleft ä¸ Permissiveå¼€æºè®¸å¯è¯åˆ†ä¸ºä¸¤å¤§é˜µè¥ï¼š ç±»å‹ ä»£è¡¨åè®® æ ¸å¿ƒç‰¹å¾ Copyleft (å¼ºä¼ æŸ“) GPL v2v3 è¡ç”Ÿä½œå“å¿…é¡»ä¿æŒç›¸åŒè®¸å¯è¯å¼€æº Weak Copyleft LGPL v2.1v3 ä»…åº“æœ¬èº«ä¿æŒ Copyleftï¼Œé“¾æ¥ç¨‹åºå¯é—­æº Permissive (å®½æ¾) MIT, BSD, Apache 2.0 å…è®¸é—­æºå•†ç”¨ï¼Œä»…ä¿ç•™ç‰ˆæƒå£°æ˜ MIT Licenseåè®®åŸæ–‡æ ¸å¿ƒæ¡æ¬¾Permission is hereby granted, free of charge, to any person obtaining a copyof this software and associated documentation files (the Software), to dealin the Software without restriction, including without limitation the rightsto use, copy, modify, merge, publish, distribute, sublicense, and/or sellcopies of the Software...The above copyright notice and this permission notice shall be included in allcopies or substantial portions of the Software. åˆè§„è¦æ±‚æ¸…å• è¡Œä¸º æ˜¯å¦å…è®¸ é¢å¤–ä¹‰åŠ¡ å•†ä¸šä½¿ç”¨ âœ… æ—  ä¿®æ”¹ä»£ç  âœ… æ— éœ€å…¬å¼€ä¿®æ”¹ é—­æºåˆ†å‘ âœ… ä¿ç•™ç‰ˆæƒå£°æ˜å’Œ MIT åè®®æ–‡æœ¬ æ›´æ¢è®¸å¯è¯ âœ… è¡ç”Ÿå“å¯ç”¨ä»»æ„åè®® ä¸“åˆ©æˆæƒ âŒ æ— æ˜ç¡®ä¸“åˆ©æ¡æ¬¾ å®é™…æ“ä½œ# åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º LICENSE æ–‡ä»¶cat LICENSE EOFMIT LicenseCopyright (c) 2026 Your NamePermission is hereby granted, free of charge, to any person obtaining a copy...[å®Œæ•´ MIT åè®®æ–‡æœ¬]EOF å±€é™æ€§ æ— ä¸“åˆ©ä¿æŠ¤ï¼šå¦‚æœè´¡çŒ®è€…æŒæœ‰ç›¸å…³ä¸“åˆ©ï¼ŒMIT åè®®ä¸æä¾›éšå¼ä¸“åˆ©æˆæƒ è´£ä»»å…é™¤ä»…é™è½¯ä»¶æœ¬èº«ï¼šåœ¨æŸäº›å¸æ³•ç®¡è¾–åŒºå¯èƒ½å­˜åœ¨æ³•å¾‹ä¸ç¡®å®šæ€§ GPL (GNU General Public License)GPLv2 ä¸ GPLv3 æ ¸å¿ƒå·®å¼‚graph LR A[GPL v2] -- Bæ ¸å¿ƒå·®å¼‚ C[GPL v3] -- B B -- D[ä¸“åˆ©æ¡æ¬¾] B -- E[å Tivoization] B -- F[è®¸å¯è¯å…¼å®¹æ€§] B -- G[å›½é™…åŒ–æ¡æ¬¾] D -- D1[v2: æ— æ˜ç¡®ä¸“åˆ©æˆæƒ] D -- D2[v3: æ˜¾å¼ä¸“åˆ©æˆæƒ + ç»ˆæ­¢æ¡æ¬¾] E -- E1[v2: æ— é™åˆ¶] E -- E2[v3: å¿…é¡»æä¾›å®‰è£…ä¿¡æ¯] F -- F1[v2: ä¸ Apache 2.0 ä¸å…¼å®¹] F -- F2[v3: ä¸ Apache 2.0 å…¼å®¹] GPLv3 æ¡æ¬¾è¯¦è§£Section 3: ä¸“åˆ©æˆæƒæ¯ä¸ªè´¡çŒ®è€…è‡ªåŠ¨æˆäºˆä½ ï¼š æ°¸ä¹…ã€å…¨çƒã€å…ç‰ˆç¨ã€ä¸å¯æ’¤é”€çš„ä¸“åˆ©è®¸å¯ è¦†ç›–èŒƒå›´ï¼šåˆ¶é€ ã€ä½¿ç”¨ã€é”€å”®ã€è¿›å£ã€è½¬è®© Section 10: è‡ªåŠ¨è®¸å¯å‡çº§You may convey a covered work under the terms of this License,or any later version... å®è·µæ„ä¹‰ï¼šä½¿ç”¨ GPL-2.0-or-later SPDX æ ‡è¯†ç¬¦å¯ç¡®ä¿å‘å‰å…¼å®¹ã€‚ åˆè§„è¦æ±‚å¯¹æ¯” è¦æ±‚ GPLv2 GPLv3 æºç å…¬å¼€ âœ… åˆ†å‘äºŒè¿›åˆ¶æ—¶å¿…é¡» âœ… åŒå·¦ ä¿ç•™è®¸å¯è¯æ–‡æœ¬ âœ… âœ… æ ‡æ³¨ä¿®æ”¹å†…å®¹ âœ… âœ… ä¸“åˆ©æˆæƒ âŒ æ—  âœ… æ˜¾å¼æˆæƒ å Tivoization âŒ âœ… æ¶ˆè´¹è®¾å¤‡éœ€æä¾›å®‰è£…ä¿¡æ¯ ä¸ Apache 2.0 å…¼å®¹ âŒ âœ… é™æ€é“¾æ¥ vs åŠ¨æ€é“¾æ¥å¯¹äº GPL ä»£ç ï¼š // âŒ è¿è§„åœºæ™¯ï¼šé™æ€é“¾æ¥ GPL åº“åˆ°é—­æºç¨‹åº// æ•´ä¸ªç¨‹åºå¿…é¡»ä»¥ GPL å‘å¸ƒ// âœ… åˆè§„æ–¹æ¡ˆï¼š// 1. å°†ä½ çš„ä»£ç ä¹Ÿä»¥ GPL å‘å¸ƒ// 2. ä½¿ç”¨ LGPL æ›¿ä»£åº“ï¼ˆå¦‚æœå¯ç”¨ï¼‰// 3. é€šè¿‡ IPC/Socket ä¸ GPL ç¨‹åºé€šä¿¡ï¼ˆè¿›ç¨‹éš”ç¦»ï¼‰ LGPL (GNU Lesser General Public License)è®¾è®¡ç›®çš„LGPL ä¸“ä¸ºå…±äº«åº“è®¾è®¡ï¼Œå…è®¸é—­æºç¨‹åºé“¾æ¥ä½¿ç”¨ LGPL åº“ï¼ŒåŒæ—¶ä¿æŠ¤åº“æœ¬èº«çš„å¼€æºæ€§ã€‚ åŠ¨æ€é“¾æ¥ vs é™æ€é“¾æ¥åˆè§„è¦æ±‚åŠ¨æ€é“¾æ¥ (æ¨è)# CMakeLists.txt - åŠ¨æ€é“¾æ¥ LGPL åº“find_package(SomeLGPLLib REQUIRED)target_link_libraries(your_app PRIVATE SomeLGPLLib::SomeLGPLLib)# é»˜è®¤åŠ¨æ€é“¾æ¥ï¼Œç”¨æˆ·å¯æ›¿æ¢ .so/.dll åˆè§„ä¹‰åŠ¡ï¼š åˆ†å‘ LGPL åè®®æ–‡æœ¬ ä¿ç•™åº“çš„ç‰ˆæƒå£°æ˜ ç¡®ä¿ç”¨æˆ·å¯ä»¥æ›¿æ¢ LGPL åº“ç‰ˆæœ¬ é™æ€é“¾æ¥ (å¤æ‚)# é™æ€é“¾æ¥ LGPL åº“çš„åˆè§„æ–¹å¼# å¿…é¡»æä¾›ä»¥ä¸‹å†…å®¹ï¼š# 1. ä½ çš„ç¨‹åºçš„ç›®æ ‡æ–‡ä»¶ (.o æ–‡ä»¶)OBJECTS = main.o utils.o app.o# 2. LGPL åº“çš„æºç # 3. é‡æ–°é“¾æ¥è¯´æ˜relink: $(CC) $(OBJECTS) -L/path/to/modified/lgpl_lib -llgpllib -o your_app é“¾æ¥æ–¹å¼ ä½ çš„ä»£ç éœ€å¼€æº? é¢å¤–ä¹‰åŠ¡ åŠ¨æ€é“¾æ¥ âŒ æä¾›åè®®æ–‡æœ¬ï¼Œå…è®¸ç”¨æˆ·æ›¿æ¢åº“ é™æ€é“¾æ¥ âŒ æä¾›ç›®æ ‡æ–‡ä»¶ + åº“æºç  + é‡é“¾æ¥è¯´æ˜ LGPLv2.1 vs LGPLv3 å·®å¼‚ ç‰¹æ€§ LGPLv2.1 LGPLv3 ç‹¬ç«‹åè®® âœ… å•ç‹¬æ–‡æ¡£ âŒ GPLv3 é™„åŠ æ¡æ¬¾ ä¸ Apache 2.0 å…¼å®¹ âŒ âœ… å Tivoization âŒ âœ… æ¶ˆè´¹è®¾å¤‡éœ€æä¾›å®‰è£…ä¿¡æ¯ Apache License 2.0æ ¸å¿ƒä¼˜åŠ¿ï¼šæ˜¾å¼ä¸“åˆ©æˆæƒSection 3. Grant of Patent LicenseSubject to the terms and conditions of this License, each Contributor herebygrants to You a perpetual, worldwide, non-exclusive, no-charge, royalty-free,irrevocable... patent license to make, have made, use, offer to sell, sell,import, and otherwise transfer the Work... ä¸“åˆ©æŠ¥å¤æ¡æ¬¾If You institute patent litigation against any entity... alleging that the Workor a Contribution... constitutes direct or contributory patent infringement,then any patent licenses granted to You under this License... shall terminateas of the date such litigation is filed. å®è·µæ„ä¹‰ï¼šä½¿ç”¨ Apache 2.0 è½¯ä»¶çš„ä¼ä¸šå¦‚æœå¯¹é¡¹ç›®å‘èµ·ä¸“åˆ©è¯‰è®¼ï¼Œå°†ä¸§å¤±æ‰€æœ‰ä¸“åˆ©æƒã€‚ åˆè§„æ£€æŸ¥æ¸…å•# åˆè§„è‡ªæ£€ YAMLapache2_compliance: distribution: - include_license: true # åŒ…å« LICENSE æ–‡ä»¶ - include_notice: true # åŒ…å« NOTICE æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ - retain_copyright: true # ä¿ç•™æ‰€æœ‰ç‰ˆæƒå£°æ˜ - state_changes: true # æ ‡æ³¨ä¿®æ”¹å†…å®¹ï¼ˆå¦‚æœä¿®æ”¹äº†ï¼‰ derivatives: - can_change_license: true # å¯æ›´æ¢è®¸å¯è¯ - must_give_patent_grant: false # æ— éœ€æˆäºˆä½ çš„ä¸“åˆ© - can_close_source: true # å¯é—­æº patent: - explicit_grant: true # è´¡çŒ®è€…æˆäºˆä¸“åˆ©è®¸å¯ - retaliation_clause: true # å‘èµ·è¯‰è®¼åˆ™ç»ˆæ­¢è®¸å¯ BSD Licenseå˜ä½“å¯¹æ¯” å˜ä½“ æ¡æ¬¾æ•° ç‰¹æ®Šé™åˆ¶ 0-Clause BSD 0 æ— ä»»ä½•é™åˆ¶ï¼Œç­‰åŒå…¬æœ‰é¢†åŸŸ 2-Clause BSD 2 ä¿ç•™ç‰ˆæƒ + å…è´£å£°æ˜ 3-Clause BSD 3 + ç¦æ­¢ä½¿ç”¨ä½œè€…åèƒŒä¹¦ 4-Clause BSD (åŸå§‹) 4 + å¹¿å‘Šæ¡æ¬¾ï¼ˆå·²å¼ƒç”¨ï¼‰ 2-Clause BSD åŸæ–‡Redistribution and use in source and binary forms, with or without modification,are permitted provided that the following conditions are met:1. Redistributions of source code must retain the above copyright notice...2. Redistributions in binary form must reproduce the above copyright notice...THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AS IS AND ANY EXPRESSOR IMPLIED WARRANTIES... ARE DISCLAIMED. BSD vs MIT å¯¹æ¯”ç»´åº¦ BSD 2-Clause MIT æ¡æ¬¾é•¿åº¦ è¾ƒé•¿ æ›´ç®€æ´ æ ¸å¿ƒè¦æ±‚ ç›¸åŒ ç›¸åŒ ä¸“åˆ©æˆæƒ âŒ æ—  âŒ æ—  ç¤¾åŒºåå¥½ ç³»ç»Ÿè½¯ä»¶ (FreeBSD, OpenBSD) WebNode ç”Ÿæ€ è®¸å¯è¯å…¼å®¹æ€§çŸ©é˜µgraph TD subgraph Permissive MIT[MIT] BSD[BSD 2/3-Clause] Apache[Apache 2.0] end subgraph Copyleft GPL2[GPL v2] GPL3[GPL v3] LGPL2[LGPL v2.1] LGPL3[LGPL v3] end MIT --|å…¼å®¹| GPL2 MIT --|å…¼å®¹| GPL3 MIT --|å…¼å®¹| Apache BSD --|å…¼å®¹| GPL2 BSD --|å…¼å®¹| GPL3 BSD --|å…¼å®¹| Apache Apache --|ä¸å…¼å®¹| GPL2 Apache --|å…¼å®¹| GPL3 LGPL2 --|å…¼å®¹| GPL2 LGPL3 --|å…¼å®¹| GPL3 GPL2 --|ä¸å…¼å®¹| GPL3 å®é™…åœºæ™¯é€ŸæŸ¥è¡¨ åœºæ™¯ æ¨èè®¸å¯è¯ åŸå›  å•†ä¸šé—­æºäº§å“ä½¿ç”¨å¼€æºåº“ MIT BSD Apache 2.0 æ—  Copyleft ä¼ æŸ“ ä¼ä¸šçº§å…±äº«åº“ Apache 2.0 ä¸“åˆ©ä¿æŠ¤ + ä¸“åˆ©æŠ¥å¤ å¸Œæœ›ä»£ç ä¿æŒå¼€æº GPL v3 å¼º Copyleft åº“å…è®¸é—­æºç¨‹åºé“¾æ¥ LGPL v3 å¼± Copyleft åµŒå…¥å¼è®¾å¤‡ é¿å… GPLv3LGPLv3 å Tivoization æ¡æ¬¾ å®æˆ˜ï¼šå¦‚ä½•æ·»åŠ è®¸å¯è¯æ–¹å¼ä¸€ï¼šSPDX æ ‡è¯†ç¬¦# SPDX-License-Identifier: MIT# Copyright (c) 2026 Your Namedef main(): pass æ–¹å¼äºŒï¼šé¡¹ç›®æ ¹ç›®å½•your-project/â”œâ”€â”€ LICENSE # å®Œæ•´è®¸å¯è¯æ–‡æœ¬â”œâ”€â”€ NOTICE # Apache 2.0 é¡¹ç›®éœ€è¦â”œâ”€â”€ COPYING # GPL ä¼ ç»Ÿå‘½åâ””â”€â”€ src/ â””â”€â”€ main.py # SPDX å¤´æ³¨é‡Š æ–¹å¼ä¸‰ï¼špackage.json Cargo.toml name: your-package, license: MIT, licenses: [ type: MIT, url: https://opensource.org/licenses/MIT ] [package]name = your-cratelicense = MIT OR Apache-2.0 # åŒè®¸å¯ å¸¸è§é”™è¯¯ä¸é£é™©é”™è¯¯ 1ï¼šæ··æ·† GPL ä¸ LGPL// âŒ é”™è¯¯è®¤çŸ¥ï¼šä½¿ç”¨ GPL åº“åªè¦åŠ¨æ€é“¾æ¥å°±æ²¡é—®é¢˜// å®é™…ï¼šGPL æ— è®ºåŠ¨æ€è¿˜æ˜¯é™æ€é“¾æ¥ï¼Œæ•´ä¸ªç¨‹åºéƒ½å¿…é¡» GPL// âœ… æ­£ç¡®ï¼šç¡®è®¤æ˜¯ LGPL è€Œé GPL// LGPL åŠ¨æ€é“¾æ¥å¯å…äº Copyleft é”™è¯¯ 2ï¼šå¿½ç•¥ GPLv2 ä¸ GPLv3 ä¸å…¼å®¹# Linux å†…æ ¸æ˜¯ GPL-2.0-only# ä¸èƒ½å°† GPL-3.0-only ä»£ç åˆå…¥ Linux# é™¤éåŸä»£ç æ ‡æ³¨ä¸º GPL-2.0-or-later é”™è¯¯ 3ï¼šApache 2.0 ç”¨äº GPLv2 é¡¹ç›®Apache 2.0 ä¸ GPLv2 ä¸å…¼å®¹Apache 2.0 ä¸ GPLv3 å…¼å®¹è‹¥é¡¹ç›®æœ‰ GPLv2 ä»£ç ï¼Œä¸èƒ½å¼•å…¥ Apache 2.0 ä»£ç  é”™è¯¯ 4ï¼šBSDMIT æ— è§†ä¸“åˆ©é—®é¢˜BSD å’Œ MIT ä¸å«ä¸“åˆ©æ¡æ¬¾è‹¥è´¡çŒ®è€…æŒæœ‰è½¯ä»¶ä¸“åˆ©ï¼Œå¯èƒ½é¢ä¸´ä¾µæƒç´¢èµ”å¯¹äºä¸“åˆ©æ•æ„Ÿé¡¹ç›®ï¼Œè€ƒè™‘ä½¿ç”¨ Apache 2.0 å·¥å…·æ¨èè®¸å¯è¯æ‰«æ# FOSSA CLIfossa analyze# ScanCode Toolkitscancode -clpieu --json-pp output.json /path/to/project# License Finder (Ruby)license_finder SPDX éªŒè¯# éªŒè¯ SPDX è¡¨è¾¾å¼æœ‰æ•ˆæ€§npx spdx-expression-validate MIT OR Apache-2.0 å‚è€ƒèµ„æ–™ èµ„æº è¯´æ˜ SPDX License List å®˜æ–¹è®¸å¯è¯æ ‡è¯†ç¬¦åˆ—è¡¨ Choose a License GitHub è®¸å¯è¯é€‰æ‹©å™¨ GNU License FAQ FSF å®˜æ–¹ GPL å¸¸è§é—®é¢˜ Apache 2.0 åŸæ–‡ å®˜æ–¹åè®®æ–‡æœ¬ tl;drLegal è®¸å¯è¯é€šä¿—è§£è¯» [!CAUTION]æœ¬æ–‡ä»…ä¾›æŠ€æœ¯å‚è€ƒï¼Œä¸æ„æˆæ³•å¾‹å»ºè®®ã€‚æ¶‰åŠå…·ä½“å•†ä¸šå†³ç­–æ—¶ï¼Œè¯·å’¨è¯¢ä¸“ä¸šçŸ¥è¯†äº§æƒå¾‹å¸ˆã€‚","tags":["å¼€æºåè®®","è½¯ä»¶æˆæƒ","GPL","MIT","Apache"],"categories":["é€šç”¨æŠ€æœ¯"]},{"title":"QCustomPlot å›¾è¡¨åº“å®Œæ•´æŒ‡å—","path":"/2026/01/22/3-å¼€å‘æ¡†æ¶-Qt-Standby-QCustomPlotå›¾è¡¨åº“å®Œæ•´æŒ‡å—/","content":"QCustomPlot æ˜¯ Qt C++ çš„ 2D ç»‘å®šåº“ï¼Œä¸»è¦ç”¨äº QtWidgets åº”ç”¨çš„å®æ—¶æ•°æ®å¯è§†åŒ–ã€‚ æ¶æ„ç±»ç»“æ„QCustomPlot æ˜¯ä¸»éƒ¨ä»¶ï¼Œå†…éƒ¨ç”¨ Layout ç³»ç»Ÿç®¡ç†å¯è§†å…ƒç´ ã€‚ classDiagram QWidget |-- QCustomPlot QCustomPlot *-- QCPLayoutGrid : plotLayout QCPLayoutElement |-- QCPLayout QCPLayout |-- QCPLayoutGrid QCPLayout |-- QCPLayoutInset QCPLayoutElement |-- QCPAxisRect QCPAxisRect *-- QCPAxis : xAxis, yAxis QCPAbstractPlottable |-- QCPGraph QCPAbstractPlottable |-- QCPCurve QCPAbstractPlottable |-- QCPBars QCPAbstractPlottable |-- QCPColorMap QCPAbstractPlottable |-- QCPFinancial ç±» åŠŸèƒ½ QCustomPlot ä¸»éƒ¨ä»¶ï¼Œç®¡ç†å›¾å±‚ã€åæ ‡è½´ã€ç»‘å®šå¯¹è±¡å’Œäº¤äº’ QCPAxisRect åæ ‡è½´çŸ©å½¢ï¼ŒåŒ…å«å¤šä¸ª QCPAxis QCPAxis åæ ‡è½´ï¼Œå¤„ç†åˆ»åº¦ã€æ ‡ç­¾ã€èŒƒå›´ QCPGraph æŠ˜çº¿å›¾æ•£ç‚¹å›¾ï¼Œç»§æ‰¿è‡ª QCPAbstractPlottable QCPLayoutGrid ç½‘æ ¼å¸ƒå±€ï¼Œç”¨äºæ’åˆ—å¤šä¸ª AxisRect æ¸²æŸ“æµç¨‹é»˜è®¤ç”¨ QPainter è½¯ä»¶æ¸²æŸ“ï¼Œå¯å¼€å¯ OpenGL åŠ é€Ÿï¼š æŒ‰ z-order éå†æ‰€æœ‰ QCPLayer æ¯ä¸ª Layer ç»‘å®šå…¶ QCPLayerable å¯¹è±¡ lmBuffered æ¨¡å¼å¯ç¼“å­˜é™æ€å…ƒç´  // OpenGL åŠ é€Ÿï¼šç¼–è¯‘æ—¶å®šä¹‰ QCUSTOMPLOT_USE_OPENGLï¼Œè¿è¡Œæ—¶è°ƒç”¨customPlot-setOpenGl(true); é¡¹ç›®é…ç½®ä¾èµ– ä¾èµ–é¡¹ ç‰ˆæœ¬è¦æ±‚ å¤‡æ³¨ Qt 5.0+ Qt 6.4+ å…¼å®¹ (v2.1.1) C++ C++11 ç¼–è¯‘å™¨éœ€æ”¯æŒ OS è·¨å¹³å° Windows Linux macOS æ–‡ä»¶åªéœ€ä¸¤ä¸ªæ–‡ä»¶ï¼šqcustomplot.h å’Œ qcustomplot.cppã€‚ qmake# Qt5+ å¿…é¡»åŠ  printsupportgreaterThan(QT_MAJOR_VERSION, 4): QT += widgets printsupport# OpenGL åŠ é€Ÿï¼ˆå¯é€‰ï¼‰DEFINES += QCUSTOMPLOT_USE_OPENGLQT += opengl# MinGW å¤§å¯¹è±¡æ”¯æŒï¼ˆå¯é€‰ï¼‰QMAKE_CXXFLAGS += -Wa,-mbig-objSOURCES += qcustomplot.cppHEADERS += qcustomplot.h CMakecmake_minimum_required(VERSION 3.16)project(MyPlotApp LANGUAGES CXX)set(CMAKE_CXX_STANDARD 11)set(CMAKE_CXX_STANDARD_REQUIRED ON)set(CMAKE_AUTOMOC ON)find_package(Qt6 REQUIRED COMPONENTS Widgets PrintSupport)add_executable($PROJECT_NAME main.cpp qcustomplot.cpp qcustomplot.h)target_link_libraries($PROJECT_NAME PRIVATE Qt6::Widgets Qt6::PrintSupport)# OpenGL åŠ é€Ÿï¼ˆå¯é€‰ï¼‰# find_package(Qt6 REQUIRED COMPONENTS OpenGL OpenGLWidgets)# target_link_libraries($PROJECT_NAME PRIVATE Qt6::OpenGL Qt6::OpenGLWidgets)# target_compile_definitions($PROJECT_NAME PRIVATE QCUSTOMPLOT_USE_OPENGL) Qt Designer æ‹–å…¥ QWidget å³é”® Promote Toâ€¦ å¡« Promoted class name: QCustomPlotï¼ŒHeader file: qcustomplot.h ç‚¹ Add â†’ Promote API ç”¨æ³•åæ ‡è½´ (QCPAxis)QCPAxis *xAxis = customPlot-xAxis; // åº•éƒ¨ X è½´QCPAxis *yAxis = customPlot-yAxis; // å·¦ä¾§ Y è½´// èŒƒå›´xAxis-setRange(0, 100);yAxis-setRangeReversed(true); // åè½¬ (v2.1.1+)// åˆ»åº¦xAxis-ticker()-setTickCount(10);xAxis-setTickLabelFont(QFont(Arial, 9));xAxis-setTickLabelRotation(45);// å¯¹æ•°åæ ‡yAxis-setScaleType(QCPAxis::stLogarithmic);yAxis-setTicker(QSharedPointerQCPAxisTickerLog(new QCPAxisTickerLog));// æ—¶é—´è½´QSharedPointerQCPAxisTickerDateTime dateTicker(new QCPAxisTickerDateTime);dateTicker-setDateTimeFormat(yyyy-MM-dd hh:mm:ss);xAxis-setTicker(dateTicker);xAxis-setLabel(Time (s)); æ›²çº¿ (QCPGraph)QCPGraph *graph = customPlot-addGraph();QVectordouble x(100), y(100);for (int i = 0; i 100; ++i) x[i] = i; y[i] = qSin(i / 10.0);graph-setData(x, y);graph-setName(Sine Wave);graph-setPen(QPen(Qt::blue, 2));graph-setLineStyle(QCPGraph::lsLine);graph-setScatterStyle(QCPScatterStyle(QCPScatterStyle::ssCircle, 5));graph-setBrush(QBrush(QColor(0, 0, 255, 50)));graph-setAntialiased(true); äº¤äº’customPlot-setInteractions(QCP::iRangeDrag | QCP::iRangeZoom | QCP::iSelectPlottables);customPlot-axisRect()-setRangeDrag(Qt::Horizontal); // åªèƒ½æ°´å¹³æ‹–customPlot-axisRect()-setRangeZoom(Qt::Vertical); // åªèƒ½å‚ç›´ç¼©æ”¾customPlot-axisRect()-setRangeZoomFactor(0.9, 0.9); å®ç”¨åœºæ™¯å®æ—¶æ•°æ®æµä¼ æ„Ÿå™¨é‡‡é›†ã€ç¤ºæ³¢å™¨ç­‰åœºæ™¯çš„å¤„ç†è¦ç‚¹ï¼š é—®é¢˜ åšæ³• çº¿ç¨‹é˜»å¡ é‡‡é›†å’Œæ¸²æŸ“åˆ†å¼€ é¢‘ç¹é‡ç»‘ æ”’æ•°æ®åæ‰¹é‡ setData è¿‡åº¦åˆ·æ–° ç”¨ rpQueuedReplot å†…å­˜æ³„éœ² removeBefore() æ¸…ç†æ—§æ•°æ® class RealtimePlotWidget : public QWidget Q_OBJECTpublic: void appendData(double timestamp, double value); // çº¿ç¨‹å®‰å…¨private slots: void updatePlot();private: QCustomPlot *m_plot; QTimer *m_refreshTimer; QMutex m_dataMutex; QVectordouble m_pendingTimestamps, m_pendingValues; static constexpr double WINDOW_SIZE = 10.0; // æ˜¾ç¤ºçª—å£(ç§’) static constexpr int REFRESH_RATE_MS = 33; // ~30 FPS;void RealtimePlotWidget::updatePlot() QVectordouble timestamps, values; QMutexLocker locker(m_dataMutex); if (m_pendingTimestamps.isEmpty()) return; timestamps = std::move(m_pendingTimestamps); values = std::move(m_pendingValues); auto *graph = m_plot-graph(0); for (int i = 0; i timestamps.size(); ++i) graph-addData(timestamps[i], values[i]); double currentTime = timestamps.last(); graph-data()-removeBefore(currentTime - WINDOW_SIZE); // æ¸…æ—§æ•°æ® m_plot-xAxis-setRange(currentTime - WINDOW_SIZE, currentTime); m_plot-yAxis-rescale(true); m_plot-replot(QCustomPlot::rpQueuedReplot); é¼ æ ‡åæ ‡æ˜¾ç¤ºç‚¹å‡»æ—¶æ˜¾ç¤ºåæ ‡å€¼ï¼š QCPItemText *m_textLabel;QCPItemLine *m_arrow;// åˆå§‹åŒ–m_textLabel = new QCPItemText(m_plot);m_textLabel-setPositionAlignment(Qt::AlignTop | Qt::AlignHCenter);m_textLabel-position-setType(QCPItemPosition::ptAxisRectRatio);m_textLabel-position-setCoords(0.5, 0);m_textLabel-setVisible(false);m_arrow = new QCPItemLine(m_plot);m_arrow-start-setParentAnchor(m_textLabel-bottom);m_arrow-setHead(QCPLineEnding::esSpikeArrow);// mousePressEvent ä¸­double x = m_plot-xAxis-pixelToCoord(event-pos().x());double y = m_plot-yAxis-pixelToCoord(event-pos().y());m_arrow-end-setCoords(x, y);m_textLabel-setText(QString(x=%1 y=%2).arg(x).arg(y)); K çº¿å›¾QCPFinancial *candlestick = new QCPFinancial(customPlot-xAxis, customPlot-yAxis);candlestick-setChartStyle(QCPFinancial::csCandlestick);candlestick-setWidth(0.5);candlestick-setTwoColored(true);candlestick-setBrushPositive(QColor(0, 180, 0)); // é˜³çº¿candlestick-setBrushNegative(QColor(220, 50, 50)); // é˜´çº¿QSharedPointerQCPAxisTickerDateTime dateTicker(new QCPAxisTickerDateTime);dateTicker-setDateTimeFormat(MM-dd hh:mm);customPlot-xAxis-setTicker(dateTicker);candlestick-setData(time, open, high, low, close);customPlot-rescaleAxes();customPlot-replot(); åŒYè½´customPlot-yAxis2-setVisible(true);customPlot-yAxis2-setTickLabels(true);QCPGraph *graph1 = customPlot-addGraph(customPlot-xAxis, customPlot-yAxis);graph1-setName(Temperature (Â°C));graph1-setPen(QPen(Qt::red, 2));QCPGraph *graph2 = customPlot-addGraph(customPlot-xAxis, customPlot-yAxis2);graph2-setName(Humidity (%));graph2-setPen(QPen(Qt::blue, 2));customPlot-yAxis-setLabelColor(Qt::red);customPlot-yAxis2-setLabelColor(Qt::blue);customPlot-legend-setVisible(true); å¸¸è§é—®é¢˜ç¼–è¯‘é”™è¯¯ æŠ¥é”™ åŸå›  è§£æ³• undefined reference to QPrinter ç¼º printsupport .pro åŠ  QT += printsupport GL/gl.h: No such file ç¼º OpenGL å¼€å‘åº“ Linux: apt install mesa-common-dev libgl1-mesa-dev too many sections (MinGW) å¯¹è±¡æ–‡ä»¶å¤ªå¤§ åŠ  QMAKE_CXXFLAGS += -Wa,-mbig-obj unresolved external symbol æ–‡ä»¶æ²¡åŠ è¿›é¡¹ç›® ç¡®è®¤ qcustomplot.cpp åœ¨é¡¹ç›®é‡Œ è¿è¡Œé—®é¢˜å›¾è¡¨ä¸æ˜¾ç¤º graph-setData(x, y);customPlot-replot(); // åˆ«å¿˜äº† å†…å­˜ä¸€ç›´æ¶¨ï¼ˆå®æ—¶åœºæ™¯ï¼‰ graph-data()-removeBefore(currentTime - windowSize); é«˜ DPI æ¨¡ç³Š customPlot-setBufferDevicePixelRatio(devicePixelRatio()); å­çº¿ç¨‹æ›´æ–°å´©æºƒ // é”™ï¼šç›´æ¥æ“ä½œworkerThread-graph()-addData(x, y); // å´©æºƒ// å¯¹ï¼šä¿¡å·æ§½emit dataReady(x, y); // Qt::QueuedConnection å¯¹æ¯”QCustomPlot vs Qt Charts æ–¹é¢ QCustomPlot Qt Charts æ¶æ„ ç‹¬ç«‹ QWidget Graphics View å®æ—¶æ€§èƒ½ é«˜ (å¯å¼€ OpenGL) ä¸­ç­‰ å†…å­˜ ä½ è¾ƒé«˜ è®¸å¯è¯ GPLv3 å•†ä¸š LGPLv3 å•†ä¸š Qt ç‰ˆæœ¬ 5.0+ 6.x 5.7+ 6.x å±€é™ æ²¡æœ‰ QML åŸç”Ÿæ”¯æŒï¼Œéœ€ç”¨ QQuickPaintedItem åŒ…ä¸€å±‚ åªæœ‰ 2Dï¼Œæ²¡æœ‰ 3D å•æ–‡ä»¶ 2.8MBï¼Œç¼–è¯‘æ…¢ GPLv3 æœ‰ä¼ æŸ“æ€§ï¼Œé—­æºè¦ä¹°å•†ä¸šæˆæƒ å‚è€ƒ å±æ€§ å€¼ ç‰ˆæœ¬ 2.1.1 (2022-11-06) Qt 6.4 å…¼å®¹ å®˜ç½‘ https://www.qcustomplot.com è®¸å¯ GPLv3 Commercial [1] å®˜æ–¹æ–‡æ¡£ https://www.qcustomplot.com/documentation/ [2] å®˜æ–¹æ•™ç¨‹ https://www.qcustomplot.com/index.php/tutorials/basicplotting","tags":["Qt","C++","æ•°æ®å¯è§†åŒ–","QCustomPlot"],"categories":["Qt","å›¾è¡¨åº“"]},{"title":"Qwt 6.x å›¾è¡¨åº“å®Œæ•´æŒ‡å—ï¼šé…ç½®ã€æ ¸å¿ƒAPIä¸å·¥ç¨‹å®è·µ","path":"/2026/01/21/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qwtå›¾è¡¨åº“å®Œæ•´æŒ‡å—/","content":"Qwt 6.x å›¾è¡¨åº“å®Œæ•´æŒ‡å—Qwt (Qt Widgets for Technical Applications) æ˜¯ä¸€ä¸ªåŸºäº Qt çš„ C++ GUI ç»„ä»¶åº“ï¼Œä¸»è¦ç”¨äºç§‘å­¦å’Œå·¥ç¨‹é¢†åŸŸã€‚é™¤äº†äºŒç»´ç»˜å›¾ç»„ä»¶ï¼Œå®ƒè¿˜æä¾›åˆ»åº¦å°ºã€æ»‘å—ã€è¡¨ç›˜ç­‰å·¥ä¸šæ§ä»¶ã€‚å½“å‰ç¨³å®šç‰ˆæœ¬ Qwt 6.3.0ï¼Œæ”¯æŒ Qt 5.6+ å’Œ Qt 6.xã€‚ ä¸€ã€æ ¸å¿ƒæ¶æ„1.1 ç±»å±‚æ¬¡ç»“æ„Qwt ç»˜å›¾ç³»ç»Ÿä»¥ QwtPlot ä¸ºæ ¸å¿ƒï¼Œä½¿ç”¨ç»„åˆæ¨¡å¼ç®¡ç†å›¾è¡¨å…ƒç´ ã€‚ classDiagram QFrame |-- QwtPlot QwtPlot *-- QwtPlotCanvas : ç”»å¸ƒ QwtPlot *-- QwtScaleWidget : åæ ‡è½´(4ä¸ª) QwtPlot *-- QwtLegend : å›¾ä¾‹ QwtPlot o-- QwtPlotItem : å›¾å…ƒ(Nä¸ª) QwtPlotItem |-- QwtPlotCurve QwtPlotItem |-- QwtPlotMarker QwtPlotItem |-- QwtPlotGrid QwtPlotItem |-- QwtPlotSpectroCurve QwtPlotPicker |-- QwtPlotZoomer ç»„ä»¶æŒ‡è´£ï¼š ç»„ä»¶ èŒè´£ ç”Ÿå‘½å‘¨æœŸ QwtPlot å®¹å™¨ï¼Œè´Ÿè´£åæ ‡è½´ä¸å›¾å…ƒçš„å¸ƒå±€ éšçˆ¶çª—å£é”€æ¯ QwtPlotCanvas æ¸²æŸ“å±‚ï¼Œå¤„ç†ç»˜åˆ¶å’Œè¾“å…¥ ç”± QwtPlot ç®¡ç† QwtPlotItem å›¾å…ƒï¼ˆæ›²çº¿ã€æ ‡è®°ã€ç½‘æ ¼ï¼‰ attach() åå½’ QwtPlot æ‰€æœ‰ QwtScaleEngine åˆ»åº¦è®¡ç®—å¼•æ“ é€šè¿‡ setAxisScaleEngine() è®¾ç½® 1.2 æ¸²æŸ“æµç¨‹sequenceDiagram participant App as åº”ç”¨ä»£ç  participant Plot as QwtPlot participant Canvas as QwtPlotCanvas participant Item as QwtPlotItem App-Plot: replot() Plot-Plot: updateAxes() Plot-Canvas: invalidateBackingStore() Canvas-Canvas: paintEvent() loop æ¯ä¸ªå·²é™„åŠ å›¾å…ƒ Canvas-Item: draw(painter, xMap, yMap, canvasRect) end replot() æ˜¯æ›´æ–°å›¾è¡¨çš„å…¥å£ã€‚å®ƒä¼šå…ˆé‡ç®—åæ ‡è½´åˆ»åº¦ï¼Œæ ‡è®°ç¼“å­˜å¤±æ•ˆï¼Œç„¶ååœ¨ paintEvent ä¸­éå†å›¾å…ƒè¿›è¡Œç»˜åˆ¶ã€‚ äºŒã€éƒ¨ç½²ä¸é…ç½®2.1 ç¯å¢ƒè¦æ±‚ ä¾èµ–é¡¹ æœ€ä½ç‰ˆæœ¬ æ¨èç‰ˆæœ¬ Qt 5.6.0 6.5+ C++ æ ‡å‡† C++11 C++17 ç¼–è¯‘å™¨ MSVC 2017 GCC 7 Clang 5 MSVC 2022 GCC 13 2.2 æºç ç¼–è¯‘å»ºè®®è‡ªå·±ç¼–è¯‘æºç ï¼Œè¿™æ ·èƒ½ä¿è¯äºŒè¿›åˆ¶å…¼å®¹æ€§ã€‚ Windows (MSVCMinGW)# 1. è§£å‹æºç Expand-Archive qwt-6.3.0.zip -DestinationPath C:\\libs\\cd C:\\libs\\qwt-6.3.0# 2. é…ç½®ï¼ˆç”¨å¯¹åº” Qt ç‰ˆæœ¬çš„ qmakeï¼‰# æ¨èç”¨ç»å¯¹è·¯å¾„C:\\Qt\\6.5.0\\mingw_64\\bin\\qmake.exe qwt.pro# 3. ç¼–è¯‘å®‰è£…mingw32-make # MinGW# nmake # MSVCmingw32-make install LinuxmacOStar -xjf qwt-6.3.0.tar.bz2cd qwt-6.3.0# æ£€æŸ¥ qmake ç‰ˆæœ¬/opt/Qt/6.5.0/gcc_64/bin/qmake qwt.promake -j$(nproc)sudo make install 2.3 é™æ€ç¼–è¯‘å¦‚æœéœ€è¦å•æ–‡ä»¶éƒ¨ç½²æˆ–åµŒå…¥å¼ä½¿ç”¨ï¼Œå¯ä»¥é™æ€ç¼–è¯‘ã€‚ä¿®æ”¹æºç ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š ç¼–è¾‘ qwtconfig.priï¼Œæ³¨é‡Šæ‰åŠ¨æ€åº“ï¼š # QWT_CONFIG += QwtDll -- æ³¨é‡Šæ‰ ç¼–è¾‘ qwtbuild.priï¼ŒåŠ å…¥é™æ€ç¼–è¯‘é€‰é¡¹ï¼š CONFIG += staticCONFIG += staticlib é‡æ–°è¿è¡Œ qmake å’Œ makeã€‚ 2.4 æ–‡ä»¶éƒ¨ç½²ç¼–è¯‘åï¼ŒæŠŠæ–‡ä»¶æ”¾åˆ° Qt å®‰è£…ç›®å½•ï¼Œæ–¹ä¾¿å¼€å‘ï¼š æ–‡ä»¶ç±»å‹ æºè·¯å¾„ ç›®æ ‡è·¯å¾„ (Qtå®‰è£…ç›®å½•) åŠ¨æ€åº“ lib/qwt.dll bin/ é“¾æ¥åº“ lib/libqwt.a æˆ– qwt.lib lib/ å¤´æ–‡ä»¶ include/*.h include/Qwt/ æ’ä»¶ plugins/designer/qwt_designer_plugin.dll plugins/designer/ [!TIP]é™æ€ç¼–è¯‘ä¸éœ€è¦éƒ¨ç½² .dllã€‚ 2.5 å…³é”®é…ç½® (qwtconfig.pri)QWT_INSTALL_PREFIX = /usr/local/qwt-$$QWT_VERSIONQWT_CONFIG += QwtPlot # ç»˜å›¾æ¨¡å—QWT_CONFIG += QwtWidgets # ä»ªè¡¨ç›˜æ§ä»¶QWT_CONFIG += QwtSvg # SVG å¯¼å‡º (ä¾èµ– Qt SVG)QWT_CONFIG += QwtOpenGL # OpenGL åŠ é€ŸQWT_CONFIG += QwtDesigner # Designer æ’ä»¶ [!WARNING]å¦‚æœç¼–è¯‘æŠ¥é”™ qsvgrenderer.h not foundï¼Œè¯´æ˜æ²¡è£… Qt SVG æ¨¡å—ï¼ŒæŠŠ QWT_CONFIG += QwtSvg æ³¨é‡Šæ‰å³å¯ã€‚ 2.6 é¡¹ç›®é›†æˆqmake (.pro)CONFIG += qwt# å¦‚æœ Qwt ä¸åœ¨ Qt æ ‡å‡†ç›®å½•ï¼šINCLUDEPATH += /path/to/qwt-6.3.0/srcLIBS += -L/path/to/qwt-6.3.0/lib -lqwt CMake (CMakeLists.txt)find_path(QWT_INCLUDE_DIR qwt_plot.h PATHS /usr/local/qwt-6.3.0/include)find_library(QWT_LIBRARY qwt PATHS /usr/local/qwt-6.3.0/lib)target_include_directories(myapp PRIVATE $QWT_INCLUDE_DIR)target_link_libraries(myapp $QWT_LIBRARY) ä¸‰ã€æ ¸å¿ƒ API ç¤ºä¾‹3.1 åŸºç¡€å›¾è¡¨#include qwt_plot.h#include qwt_plot_curve.h#include qwt_plot_grid.h#include qwt_legend.hclass SensorPlot : public QwtPlot public: explicit SensorPlot(QWidget* parent = nullptr) : QwtPlot(parent) // 1. è®¾ç½®å¤–è§‚ setTitle(ä¼ æ„Ÿå™¨å®æ—¶ç›‘æ§); setCanvasBackground(Qt::white); // 2. åæ ‡è½´ setAxisTitle(QwtPlot::xBottom, æ—¶é—´ (s)); setAxisTitle(QwtPlot::yLeft, æ¸©åº¦ (Â°C)); setAxisScale(QwtPlot::xBottom, 0.0, 100.0); setAxisAutoScale(QwtPlot::yLeft); // 3. ç½‘æ ¼ auto* grid = new QwtPlotGrid(); grid-setMajorPen(Qt::gray, 0, Qt::DotLine); grid-attach(this); // 4. å›¾ä¾‹ insertLegend(new QwtLegend(), QwtPlot::RightLegend); void addCurve(const QVectordouble x, const QVectordouble y) auto* curve = new QwtPlotCurve(æ¸©åº¦ä¼ æ„Ÿå™¨ A); curve-setPen(Qt::red, 2); curve-setRenderHint(QwtPlotItem::RenderAntialiased, true); // setSamples ä¼šå¤åˆ¶æ•°æ® curve-setSamples(x, y); curve-attach(this); ; 3.2 äº¤äº’é…ç½®Qwt å†…ç½®äº†ä¸€å¥—äº¤äº’æ¡†æ¶ï¼Œä¸éœ€è¦è‡ªå·±å¤„ç†åº•å±‚é¼ æ ‡äº‹ä»¶ã€‚ #include qwt_plot_zoomer.h#include qwt_plot_panner.h#include qwt_plot_magnifier.hvoid setupInteractions(QwtPlot* plot) // 1. æ¡†é€‰ç¼©æ”¾ (å³é”®+Ctrl) auto* zoomer = new QwtPlotZoomer(plot-canvas()); zoomer-setMousePattern(QwtEventPattern::MouseSelect2, Qt::RightButton, Qt::ControlModifier); zoomer-setRubberBand(QwtPicker::RectRubberBand); zoomer-setZoomBase(true); // é”å®šå½“å‰è§†å›¾ // 2. æ‹–æ‹½å¹³ç§» (ä¸­é”®) auto* panner = new QwtPlotPanner(plot-canvas()); panner-setMouseButton(Qt::MiddleButton); // 3. æ»šè½®ç¼©æ”¾ auto* magnifier = new QwtPlotMagnifier(plot-canvas()); magnifier-setWheelFactor(1.1); // 10% æ­¥è¿› 3.3 åæ ‡è½´å®šåˆ¶å¯¹æ•°åæ ‡#include qwt_scale_engine.h// å¯ç”¨å¯¹æ•° (èŒƒå›´å¿…é¡» 0)plot-setAxisScaleEngine(QwtPlot::yLeft, new QwtLogScaleEngine(10)); è‡ªå®šä¹‰æ ‡ç­¾#include qwt_scale_draw.hclass TimeScaleDraw : public QwtScaleDraw protected: QwtText label(double v) const override // æ•°å€¼è½¬ HH:mm:ss QTime t = QTime(0,0).addSecs(static_castint(v)); return t.toString(HH:mm:ss); ;plot-setAxisScaleDraw(QwtPlot::xBottom, new TimeScaleDraw()); 3.4 å®æ—¶ç»˜å›¾é«˜é¢‘æ›´æ–°ï¼ˆå¦‚ç¤ºæ³¢å™¨ï¼‰å»ºè®®ç¦ç”¨è‡ªåŠ¨é‡ç»˜ï¼Œç”¨ QwtPlotDirectPainterã€‚ // 1. å…³æ‰è‡ªåŠ¨é‡ç»˜plot-setAutoReplot(false);// 2. å¢é‡ç»˜åˆ¶QwtPlotDirectPainter* painter = new QwtPlotDirectPainter(plot);// ... æ•°æ®æ›´æ–°æ—¶ ...painter-drawSeries(curve, startIndex, endIndex); å››ã€é—®é¢˜æ’æŸ¥4.1 ç¼–è¯‘é“¾æ¥ é”™è¯¯ åŸå›  è§£å†³ undefined reference to QwtPlot::... æ²¡é“¾æ¥ä¸Š æŸ¥ .pro çš„ LIBSï¼Œç¡®è®¤ x86x64 åŒ¹é… qwt_compat.h: No such file å¼•ç”¨äº†æ—§å¤´æ–‡ä»¶ Qwt 6.2+ åˆ äº†è¿™ä¸ªæ–‡ä»¶ï¼Œæ”¹ä»£ç å§ LNK2019 (MSVC) DebugRelease æ··ç”¨ Debug ç”¨ qwtd.libï¼ŒRelease ç”¨ qwt.lib 4.2 è¿è¡Œæ—¶ ç°è±¡ æ£€æŸ¥ æ›²çº¿ä¸æ˜¾ç¤º 1. attach() äº†å—ï¼Ÿ2. replot() äº†å—ï¼Ÿ3. æ•°æ®åœ¨åæ ‡è½´èŒƒå›´å†…å—ï¼Ÿ å¯¹æ•°è½´å´©æºƒ æ•°æ®é‡Œæœ‰ $\\le 0$ çš„æ•°ï¼ˆå¯¹æ•°ä¸èƒ½å¤„ç†ï¼‰ Designer æ— æ’ä»¶ qwt_designer_plugin.dll æ²¡æ”¾å¯¹ä½ç½® 4.3 Qt å…¼å®¹æ€§ Qwt ç‰ˆæœ¬ Qt 5.x Qt 6.x å»ºè®® 6.1.x âœ“ âœ— æ—§é¡¹ç›® 6.2.0 âœ“ âš  éƒ¨åˆ†æ”¯æŒ è¿‡æ¸¡ 6.3.0 âœ“ âœ“ æ¨è äº”ã€é€‰å‹ï¼šQwt è¿˜æ˜¯ Qt Charts?5.1 ä¸Šæ‰‹å¯¹æ¯” ç‰¹æ€§ Qwt Qt Charts åè®® LGPL (é—­æºå‹å¥½) GPL å•†ä¸šè®¸å¯ åœºæ™¯ ç§‘å­¦ç»˜å›¾ã€å·¥ä¸šæ§åˆ¶ å•†ä¸šæŠ¥è¡¨ã€é‡‘èKçº¿ æ€§èƒ½ ä¼˜ç§€ (æ”¯æŒ OpenGL) è‰¯å¥½ äº¤äº’ å†…ç½® ZoomerPanner éœ€è¦è‡ªå·±å†™ æ›²çº¿ è‡ªå¸¦æ’å€¼ç®—æ³• åŸºç¡€çº¿æ¡ é›†æˆ éœ€ç¼–è¯‘ Qt è‡ªå¸¦ 5.2 å¦‚ä½•é€‰æ‹© ç”¨ Qwtï¼šå¦‚æœä½ åšåŒ»ç–—ä»ªå™¨ã€ç¤ºæ³¢å™¨ã€å·¥æ§è½¯ä»¶ï¼Œæˆ–è€…å¿…é¡»ç”¨ LGPL åè®®ã€‚ ç”¨ Qt Chartsï¼šå¦‚æœä½ åªéœ€è¦ç”»ä¸ªæ¼‚äº®çš„æŸ±çŠ¶å›¾æˆ–é¥¼å›¾ï¼Œå¹¶ä¸”æ¥å— GPL æˆ–ä¹°äº† Qt å•†ä¸šç‰ˆã€‚ å‚è€ƒèµ„æº Qwt å®˜æ–¹æ–‡æ¡£ Qwt GitHub é•œåƒ Qt è®ºå› Qwt ç‰ˆå—","tags":["Qwt","QwtPlot","Qt Charts","æ•°æ®å¯è§†åŒ–"]},{"title":"Doxygen å·¥ç¨‹åŒ–æœ€ä½³å®è·µï¼šä»æ³¨é‡Šè§„èŒƒåˆ°è‡ªåŠ¨åŒ–æ–‡æ¡£æµæ°´çº¿","path":"/2026/01/16/6-å¼€å‘å·¥å…·-Doxygen-Best-Practices/","content":"1. æ ¸å¿ƒæœºåˆ¶ä¸æ¶æ„ (Architecture Mechanism)Doxygen ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ–‡æ¡£æå–å·¥å…·ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª**é’ˆå¯¹ä»£ç çš„è¯æ³•åˆ†æå™¨ (Lexical Scanner)**ã€‚ å·¥ä½œåŸç† (Under the hood)å½“ä½ è¿è¡Œ doxygen æ—¶ï¼Œå®ƒå¹¶ä¸åªæ˜¯ç®€å•çš„æ­£åˆ™åŒ¹é…ã€‚å®ƒåˆ©ç”¨ Flexï¼ˆè¯æ³•åˆ†æå™¨ç”Ÿæˆå™¨ï¼‰å’Œ Bisonï¼ˆè§£æå™¨ç”Ÿæˆå™¨ï¼‰å¯¹æºä»£ç è¿›è¡Œå®Œæ•´çš„ Tokenizeã€‚ é¢„å¤„ç† (Preprocessing): å¦‚æœé…ç½®äº† ENABLE_PREPROCESSING = YESï¼Œå®ƒä¼šåƒç¼–è¯‘å™¨ä¸€æ ·å¤„ç†å®å®šä¹‰ï¼Œè¿™å¯¹äºè§£æ CC++ ä¸­çš„æ¡ä»¶ç¼–è¯‘ä»£ç å—è‡³å…³é‡è¦ã€‚ è¯æ³•è§£æ (Lexical Analysis): å®ƒå°†æºä»£ç æµåˆ†è§£ä¸º Tokenï¼Œè¯†åˆ«å‡ºç±»ã€å‡½æ•°ã€å˜é‡ä»¥åŠå®ƒä»¬å…³è”çš„æ³¨é‡Šå—ã€‚ æŠ½è±¡è¯­æ³•æ ‘ (AST) æ„å»º: è™½ç„¶ Doxygen ä¸ç”Ÿæˆå¯æ‰§è¡Œä»£ç ï¼Œä½†å®ƒæ„å»ºäº†å†…éƒ¨çš„ç¬¦å·è¡¨å’Œå±‚çº§ç»“æ„ï¼ˆNamespace - Class - Memberï¼‰ã€‚ å…³è” (Linking): è¿™æ˜¯ Doxygen æœ€å¼ºå¤§çš„åœ°æ–¹ã€‚å®ƒä¼šè‡ªåŠ¨è§£æç±»å‹å¼•ç”¨ï¼Œå°†å‡½æ•°å‚æ•°ç±»å‹ã€è¿”å›å€¼ç±»å‹è‡ªåŠ¨é“¾æ¥åˆ°å¯¹åº”çš„å®šä¹‰å¤„ã€‚ å…³é”®è®¤çŸ¥ï¼š Doxygen æ˜¯é™æ€åˆ†æå·¥å…·ã€‚å®ƒä¸éœ€è¦ä»£ç èƒ½ç¼–è¯‘é€šè¿‡ï¼Œä½†ä»£ç çš„è¯­æ³•é”™è¯¯å¯èƒ½ä¼šå¯¼è‡´æ–‡æ¡£ç”Ÿæˆä¸å®Œæ•´ã€‚ å®ƒå¯¹ C++ çš„è§£æèƒ½åŠ›æå¼ºï¼Œæ”¯æŒ Templateã€Virtual Inheritance ç­‰å¤æ‚ç‰¹æ€§ã€‚ 2. å·¥ç¨‹åŒ–éƒ¨ç½²ä¸é…ç½® (Production Setup)æ‹’ç» doxygen -g ç”Ÿæˆçš„é»˜è®¤é…ç½®æ–‡ä»¶ã€‚ç”Ÿäº§ç¯å¢ƒéœ€è¦ç²¾ç¡®æ§åˆ¶ã€‚ 2.1 ç¯å¢ƒè¦æ±‚ Operating System: Linux (Ubuntu 22.04+) Windows 10+ macOS Doxygen: 1.9.8 (å…³é”®æ›´æ–°ï¼šæ›´å¥½çš„ Markdown æ”¯æŒå’Œ Dark Mode å…¼å®¹æ€§) Graphviz: optional, for DOT graph generation. å®‰è£…æŒ‡ä»¤ (Ubuntu): sudo apt-get install doxygen graphvizdoxygen --version # Ensure = 1.9.8 2.2 æ ¸å¿ƒé…ç½®è¯¦è§£ (Doxyfile)ä»¥ä¸‹æ˜¯ä¸€ä»½ç”Ÿäº§ç¯å¢ƒæ¨èçš„ Doxyfile ç‰‡æ®µï¼Œä»…åˆ—å‡ºå…³é”®ä¿®æ”¹é¡¹ã€‚ # -------------------------------------------------------------------------# Project Configuration# -------------------------------------------------------------------------PROJECT_NAME = MyCoreEnginePROJECT_NUMBER = 1.2.0OUTPUT_DIRECTORY = docs_buildOUTPUT_LANGUAGE = Chinese # æˆ– EnglishSTRIP_FROM_PATH = ../src # ç§»é™¤æºæ–‡ä»¶è·¯å¾„å‰ç¼€ï¼Œä¿æŒæ–‡æ¡£è·¯å¾„æ•´æ´FULL_PATH_NAMES = NO # é¿å…æ˜¾ç¤ºæœ¬åœ°ç»å¯¹è·¯å¾„ï¼Œä¿æŠ¤éšç§# -------------------------------------------------------------------------# Input File Patterns# -------------------------------------------------------------------------INPUT = include src README.mdRECURSIVE = YESEXCLUDE_PATTERNS = */build/* */tests/* *.tmp# -------------------------------------------------------------------------# Parser Comments# -------------------------------------------------------------------------JAVADOC_AUTOBRIEF = YES # æå…¶é‡è¦ï¼ç¬¬ä¸€è¡Œè‡ªåŠ¨ä½œä¸ºç®€è¿°ï¼Œæ— éœ€ @briefMARKDOWN_SUPPORT = YESEXTENSION_MAPPING = no_extension=C++ # å¤„ç†æ— åç¼€å¤´æ–‡ä»¶# -------------------------------------------------------------------------# Output Format (Modern Look)# -------------------------------------------------------------------------GENERATE_HTML = YESHTML_OUTPUT = htmlHTML_FILE_EXTENSION = .html# ä½¿ç”¨ doxygen-awesome-css ç°ä»£åŒ–ä¸»é¢˜ (éœ€å•ç‹¬ä¸‹è½½)HTML_EXTRA_STYLESHEET = docs/doxygen-awesome.cssGENERATE_LATEX = NO # é€šå¸¸ä¸éœ€è¦ LaTeXï¼Œé™¤éä½ è¦æ‰“å° PDF# -------------------------------------------------------------------------# Diagrams Visualization (Graphviz)# -------------------------------------------------------------------------HAVE_DOT = YESDOT_IMAGE_FORMAT = svg # SVG ç¼©æ”¾ä¸å¤±çœŸï¼Œä¼˜äº PNGCALL_GRAPH = YES # ç”Ÿæˆå‡½æ•°è°ƒç”¨å›¾CALLER_GRAPH = YES # ç”Ÿæˆå‡½æ•°è¢«è°ƒç”¨å›¾TEMPLATE_RELATIONS = YES # æ˜¾ç¤ºæ¨¡æ¿ç»§æ‰¿å…³ç³» [!IMPORTANT]ç¼–ç é™·é˜±ï¼šåœ¨ Windows ä¸‹ï¼ŒåŠ¡å¿…ç¡®ä¿ INPUT_ENCODING è®¾ä¸º UTF-8ï¼Œä¸”æºæ–‡ä»¶æœ¬èº«ä¹Ÿæ˜¯ UTF-8 ç¼–ç ï¼ˆæ—  BOM æˆ–å¸¦ BOM å‡å¯ï¼ŒDoxygen 1.9+ å¤„ç†è¾ƒå¥½ï¼‰ï¼Œå¦åˆ™ä¸­æ–‡æ³¨é‡Šä¼šä¹±ç ã€‚ 3. æ³¨é‡Šæ ¼å¼æ ‡å‡† (Syntax Format)Doxygen æ”¯æŒå¤šç§é£æ ¼ï¼ˆJavadoc, Qt, Google, Slashï¼‰ã€‚ä¸è¦æ··ç”¨ã€‚ 3.1 æ¨èé£æ ¼ï¼šJavadoc é£æ ¼ (/** ... */)è¿™æ˜¯æœ€é€šç”¨ã€å·¥å…·é“¾æ”¯æŒæœ€å¥½ï¼ˆVSCode, CLion è‡ªåŠ¨æŠ˜å ï¼‰çš„é£æ ¼ã€‚ /** * @brief è®¡ç®—é«˜ç²¾åº¦æ—¶é—´å·®. * * ä½¿ç”¨åº•å±‚çš„ OS API (QueryPerformanceCounter on Windows) è®¡ç®— * ä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹é—´çš„å¾®ç§’çº§å·®å€¼ã€‚ * * @param start èµ·å§‹æ—¶é—´æˆ³ * @param end ç»“æŸæ—¶é—´æˆ³ * @return int64_t æ—¶é—´å·® (microseconds). å¦‚æœ start endï¼Œè¿”å›è´Ÿå€¼. * * @note æ­¤å‡½æ•°æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†ä¸ä¿è¯è·¨è¿›ç¨‹çš„æ—¶é—´å•è°ƒæ€§. * @warning åŠ¡å¿…æ£€æŸ¥è¿”å›å€¼æ˜¯å¦æº¢å‡º. */int64_t CalculateTimeDelta(const Timestamp start, const Timestamp end); 3.2 ä¸ºä»€ä¹ˆä¸æ¨è Qt é£æ ¼ (/*! ... */) æˆ– Triple Slash (///) /// (Triple Slash): é€‚åˆå•è¡Œç®€çŸ­æ³¨é‡Šã€‚å¯¹äºé•¿ç¯‡å¤§è®ºçš„ API è¯´æ˜ï¼Œæ’ç‰ˆå›°éš¾ã€‚ /*! (Qt Style): è™½ç„¶ Qt æºç åœ¨ç”¨ï¼Œä½†åœ¨å…¶ä»– IDE ä¸­çš„è¯­æ³•é«˜äº®æ”¯æŒä¸å¦‚ Javadoc é£æ ¼æ™®éã€‚ 3.3 å…³é”®æ ‡ç­¾ (Must-Have Tags) Tag ç”¨é€” æœ€ä½³å®è·µ @brief ç®€è¿° å¦‚æœå¼€äº† JAVADOC_AUTOBRIEF=YESï¼Œå¯ä»¥çœç•¥ tagï¼Œç›´æ¥å†™ç¬¬ä¸€è¡Œã€‚ @param å‚æ•°è¯´æ˜ å¿…é¡»è¦†ç›–æ‰€æœ‰å‚æ•°ã€‚ä½¿ç”¨ [in], [out] ä¿®é¥°æ–¹å‘ï¼š@param[out] bufferã€‚ @return è¿”å›å€¼ æè¿°è¿”å›å€¼çš„å«ä¹‰ï¼Œä»¥åŠç‰¹æ®Šå€¼çš„æ„ä¹‰ï¼ˆå¦‚ NULL, -1ï¼‰ã€‚ @throw å¼‚å¸¸ æ˜ç¡®å‡½æ•°å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ã€‚ @see å…³è” é“¾æ¥åˆ°ç›¸å…³å‡½æ•°æˆ–ç±»ã€‚è¿™æ˜¯æ„å»ºæ–‡æ¡£çŸ¥è¯†å›¾è°±çš„å…³é”®ã€‚ 4. é«˜é˜¶å®æˆ˜ï¼šCMake é›†æˆä¸ç°ä»£åŒ– (Advanced Integration)åœ¨ç°ä»£ C++ å·¥ç¨‹ä¸­ï¼Œæ–‡æ¡£ç”Ÿæˆåº”è¯¥æ˜¯ Build Pipeline çš„ä¸€éƒ¨åˆ†ã€‚ 4.1 CMake é›†æˆ (find_package)ä¸è¦å†™ Shell è„šæœ¬è°ƒç”¨ doxygenã€‚åœ¨ CMakeLists.txt ä¸­åŸç”Ÿé›†æˆï¼š find_package(Doxygen 1.9)if (DOXYGEN_FOUND) set(DOXYGEN_IN $CMAKE_CURRENT_SOURCE_DIR/docs/Doxyfile.in) set(DOXYGEN_OUT $CMAKE_CURRENT_BINARY_DIR/docs/Doxyfile) # è‡ªåŠ¨æ›¿æ¢ Doxyfile.in ä¸­çš„å˜é‡ (@PROJECT_NAME@ ç­‰) configure_file($DOXYGEN_IN $DOXYGEN_OUT @ONLY) # æ·»åŠ è‡ªå®šä¹‰ç›®æ ‡ add_custom_target(docs COMMAND $DOXYGEN_EXECUTABLE $DOXYGEN_OUT WORKING_DIRECTORY $CMAKE_CURRENT_BINARY_DIR COMMENT Generating API documentation with Doxygen VERBATIM )else() message(WARNING Doxygen not found, documentation target will not be available.)endif() 4.2 ç°ä»£åŒ– UI: doxygen-awesome-cssé»˜è®¤çš„ Doxygen ç•Œé¢åœç•™åœ¨ 90 å¹´ä»£ã€‚doxygen-awesome-css æ˜¯ç›®å‰äº‹å®ä¸Šçš„æ ‡å‡†ç°ä»£åŒ–ä¸»é¢˜ã€‚ é…ç½®æ­¥éª¤: ä¸‹è½½ doxygen-awesome.css åˆ°é¡¹ç›®ç›®å½•ï¼ˆå¦‚ docs/ï¼‰ã€‚ é…ç½® Doxyfile:HTML_EXTRA_STYLESHEET = docs/doxygen-awesome.cssHTML_COLORSTYLE_HUE = 209 # è°ƒæ•´ä¸»è‰²è°ƒ (Blue)HTML_COLORSTYLE_SAT = 255HTML_COLORSTYLE_GAMMA = 113 è¿™å°†ç«‹å³ä½¿ä½ çš„æ–‡æ¡£æ‹¥æœ‰ç±»ä¼¼ GitBook çš„ç°ä»£å¤–è§‚ï¼Œæ”¯æŒæš—è‰²æ¨¡å¼ï¼Œä¸”æ‰‹æœºç«¯é€‚é…è‰¯å¥½ã€‚ 5. å¯¹æ¯”ä¸å±€é™æ€§ (Comparison Limitations)5.1 Doxygen vs Sphinx Doxygen: ä¼˜åŠ¿: é’ˆå¯¹ CC++ æºç çš„ä¸€ç­‰å…¬æ°‘æ”¯æŒã€‚é›¶é…ç½®å³å¯ç”Ÿæˆè°ƒç”¨å›¾ã€ç»§æ‰¿å›¾ã€‚ åŠ£åŠ¿: è‡ªå®šä¹‰é¡µé¢ï¼ˆéä»£ç æ–‡æ¡£ï¼‰çš„ç¼–å†™ä½“éªŒä¸å¦‚ reStructuredTextMarkdown çµæ´»ã€‚ Sphinx: ä¼˜åŠ¿: Python ç”Ÿæ€æ ‡å‡†ã€‚ç”Ÿæˆçš„æ–‡æ¡£æ’ç‰ˆæä½³ï¼Œé€‚åˆç¼–å†™ User Manualã€‚ åŠ£åŠ¿: å¦‚æœä¸é€šè¿‡ Breathe + Doxygen XMLï¼ŒSphinx æ— æ³•è§£æ C++ ä»£ç ã€‚ ç»“è®º: C++ API Reference ç”¨ Doxygenï¼›ç”¨æˆ·æ‰‹å†Œæ¶æ„ç™½çš®ä¹¦å¦‚æœæœ‰ç²¾åŠ›æŠ˜è…¾ï¼Œå¯ä»¥ç”¨ Sphinx + Breathe ç»„åˆï¼Œå¦åˆ™ç›´æ¥ç”¨ Doxygen çš„ Markdown Page åŠŸèƒ½è¶³çŸ£ã€‚ 5.2 å·²çŸ¥å±€é™ (Known Issues) Modern C++: å¯¹ C++20 Modules çš„æ”¯æŒä»åœ¨å®Œå–„ä¸­ï¼Œå¯èƒ½ä¼šä¸¢ç¬¦å·ã€‚ Concepts: C++20 Concepts çš„çº¦æŸæ¡ä»¶æ˜¾ç¤ºæœ‰æ—¶ä¸ç›´è§‚ã€‚ å®åœ°ç‹±: ä¸¥é‡ä¾èµ–å®æ‹¼æ¥ä»£ç çš„é¡¹ç›®ï¼ˆå¦‚ Boost çš„æŸäº›éƒ¨åˆ†ï¼‰ï¼ŒDoxygen å¾ˆéš¾ç”Ÿæˆå¹²å‡€çš„æ–‡æ¡£ï¼Œå¿…é¡»å¤§é‡é…ç½® PREDEFINED å’Œ EXPAND_AS_DEFINEDã€‚","tags":["Doxygen","CMake","CI/CD","Documentation"],"categories":["å¼€å‘å·¥å…·","æ–‡æ¡£ç”Ÿæˆ"]},{"title":"Qt ç½‘ç»œç¼–ç¨‹å…¨é¢æŒ‡å—ï¼šä» HTTP åˆ° å¤šçº¿ç¨‹ TCP","path":"/2026/01/14/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qt-ç½‘ç»œæ¨¡å—/","content":"Qt æä¾›äº†å¼ºå¤§çš„ç½‘ç»œæ¨¡å— (Qt Network)ï¼Œæ¶µç›–äº†ä»é«˜å±‚çº§çš„ HTTP è¯·æ±‚ (QNetworkAccessManager) åˆ°ä½å±‚çº§çš„ TCPUDP å¥—æ¥å­— (QTcpSocketQUdpSocket)ã€‚ æœ¬æ–‡å‰”é™¤ç¹æ‚çš„ä»£ç å°è£…ï¼Œç›´æ¥å±•ç¤ºæ ¸å¿ƒå®ç°æ¨¡å¼ï¼Œå¸®åŠ©ä½ å¿«é€ŸæŒæ¡ HTTP å¼‚æ­¥è¯·æ±‚ä¸é«˜æ€§èƒ½å¤šçº¿ç¨‹ TCP çš„æœ€ä½³å®è·µã€‚ 1. é«˜å±‚çº§ï¼šHTTP è¯·æ±‚ (QNetworkAccessManager)QNetworkAccessManager (QNAM) æ˜¯å¤„ç† HTTPHTTPS çš„æ ¸å¿ƒï¼Œå¤©ç„¶å¼‚æ­¥ï¼Œæ— éœ€é¢å¤–å¼€å¯çº¿ç¨‹ã€‚ 1.1 æ ¸å¿ƒä½¿ç”¨èŒƒå¼å…³é”®ç‚¹ï¼šå¤ç”¨ Manager å¯¹è±¡ï¼Œä½¿ç”¨ Lambda å¤„ç†å›è°ƒã€‚ // ã€å»ºè®®ã€‘Manager åº”ä½œä¸ºæˆå‘˜å˜é‡é•¿æœŸå­˜åœ¨ï¼Œä¸è¦åœ¨å‡½æ•°å†…åˆ›å»ºä¸´æ—¶å˜é‡QNetworkAccessManager *manager = new QNetworkAccessManager(this);// 1. å‘èµ· GET è¯·æ±‚QNetworkRequest request(QUrl(https://api.example.com/data));request.setHeader(QNetworkRequest::UserAgentHeader, MyQtApp/1.0);QNetworkReply *reply = manager-get(request);// 2. å¤„ç†å“åº” (ä¿¡å·æ§½)connect(reply, QNetworkReply::finished, this, [reply]() if (reply-error() == QNetworkReply::NoError) // è¯»å–å¹¶è§£æ JSON QByteArray data = reply-readAll(); QJsonObject json = QJsonDocument::fromJson(data).object(); qDebug() Success: json; else qWarning() Network Error: reply-errorString(); // 3. ã€é‡è¦ã€‘æ¸…ç† Reply å¯¹è±¡ reply-deleteLater();); 1.2 å¸¸ç”¨è¿›é˜¶æ“ä½œ POST JSON æ•°æ®ï¼šrequest.setHeader(QNetworkRequest::ContentTypeHeader, application/json);QJsonObject json key, value;manager-post(request, QJsonDocument(json).toJson()); **æ–‡ä»¶ä¸Šä¼  (Multipart)**ï¼šä½¿ç”¨ QHttpMultiPart ç±»æ„å»º form-data åŒ…ä½“ã€‚ 2. ä½å±‚çº§ï¼šå¤šçº¿ç¨‹ TCP å®¢æˆ·ç«¯åœ¨ä¸»çº¿ç¨‹ç›´æ¥æ“ä½œ QTcpSocket å¤„ç†é«˜é¢‘æ•°æ®ä¼šå¯¼è‡´ç•Œé¢å¡æ­»ã€‚Worker + moveToThread æ˜¯æœ€æ ‡å‡†ã€ç¨³å¥çš„å¤šçº¿ç¨‹æ–¹æ¡ˆã€‚ 2.1 æ ¸å¿ƒæ¶æ„å›¾è§£ä¸è¦ç»§æ‰¿ QThreadï¼è¯·éµå¾ªä»¥ä¸‹æ¨¡å¼ï¼š Worker ç±»ï¼šç»§æ‰¿ QObjectï¼ŒåŒ…å« QTcpSocket æŒ‡é’ˆã€‚ Controllerï¼šåœ¨ä¸»çº¿ç¨‹åˆ›å»º QThread å’Œ Workerã€‚ moveToThreadï¼šå°† Worker ç§»å…¥æ–°çº¿ç¨‹ã€‚ 2.2 å…³é”®ä»£ç å®ç°TcpWorker (å­çº¿ç¨‹æ‰§è¡Œè€…): class TcpWorker : public QObject Q_OBJECT QTcpSocket *m_socket = nullptr;public slots: // è¿æ¥é€»è¾‘ï¼šå¿…é¡»åœ¨ Worker çº¿ç¨‹æ‰§è¡Œ void doConnect(const QString host, quint16 port) m_socket = new QTcpSocket(this); // ã€å…³é”®ã€‘Socket åœ¨æ­¤çº¿ç¨‹åˆ›å»º // æ¥æ”¶æ•°æ® connect(m_socket, QTcpSocket::readyRead, this, [this]() QByteArray data = m_socket-readAll(); // ... æ­¤å¤„æ·»åŠ ç²˜åŒ…/æ‹†åŒ…å¤„ç†é€»è¾‘ ... emit messageReceived(data); ); m_socket-connectToHost(host, port); // å‘é€é€»è¾‘ void doSend(const QByteArray data) if (m_socket m_socket-isOpen()) m_socket-write(data); ; Main Controller (ä¸»çº¿ç¨‹æ§åˆ¶): void setupThread() QThread *thread = new QThread; TcpWorker *worker = new TcpWorker; // ä¸èƒ½æŒ‡å®š parent worker-moveToThread(thread); // çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç† connect(thread, QThread::finished, worker, QObject::deleteLater); connect(thread, QThread::finished, thread, QObject::deleteLater); thread-start(); // ã€å…³é”®ã€‘è·¨çº¿ç¨‹è°ƒç”¨ doConnect // æ–¹å¼1ï¼šé€šè¿‡ä¿¡å·è§¦å‘ (æ¨è) // emit startConnectSignal(127.0.0.1, 8080); // æ–¹å¼2ï¼šQMetaObject::invokeMethod QMetaObject::invokeMethod(worker, doConnect, Q_ARG(QString, 127.0.0.1), Q_ARG(quint16, 8080)); [!WARNING]å¸¸è§è¯¯åŒºï¼šå¦‚æœåœ¨ TcpWorker çš„æ„é€ å‡½æ•°ä¸­åˆ›å»º QTcpSocketï¼Œé‚£ä¹ˆ Socket å¯¹è±¡ä»ç„¶å±äºä¸»çº¿ç¨‹ï¼Œåç»­åœ¨å­çº¿ç¨‹è°ƒç”¨ socket æ–¹æ³•ä¼šæŠ¥é”™ã€‚ 3. TCP æœåŠ¡ç«¯ (QTcpServer)å¤„ç†é«˜å¹¶å‘è¿æ¥æ—¶ï¼Œéœ€è¦é‡å†™ incomingConnectionã€‚ 3.1 å¤šçº¿ç¨‹ Accept æ¨¡å¼// ç»§æ‰¿ QTcpServervoid MyServer::incomingConnection(qintptr socketDescriptor) // ä¸ºæ¯ä¸ªæ–°è¿æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ QThread *thread = new QThread; ClientHandler *handler = new ClientHandler(socketDescriptor); // ä¼ é€’ socket æè¿°ç¬¦ handler-moveToThread(thread); connect(thread, QThread::started, handler, ClientHandler::process); // ç»‘å®šçº¿ç¨‹é€€å‡ºæ¸…ç†é€»è¾‘... thread-start(); ClientHandler::process() å®ç°ï¼š void ClientHandler::process() QTcpSocket socket; // ã€å…³é”®ã€‘ä½¿ç”¨ Socket æè¿°ç¬¦åˆå§‹åŒ– if (socket.setSocketDescriptor(m_socketDescriptor)) // åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨é˜»å¡ç­‰å¾…ï¼Œç¼–ç¨‹æ›´ç®€å• if (socket.waitForReadyRead(timeout)) QByteArray data = socket.readAll(); // å¤„ç†ä¸šåŠ¡... emit finished(); // é€šçŸ¥çº¿ç¨‹é€€å‡º 4. UDP ä¸ SSL ç®€è¿°4.1 UDP é€šä¿¡UDP æ— è¿æ¥ï¼Œç›´æ¥ç»‘å®šç«¯å£æ”¶å‘ã€‚ QUdpSocket udp;udp.bind(QHostAddress::Any, 9999); // ç›‘å¬ç«¯å£// æ¥æ”¶connect(udp, QUdpSocket::readyRead, [udp]() while (udp.hasPendingDatagrams()) QNetworkDatagram dgram = udp.receiveDatagram(); qDebug() Data: dgram.data() From: dgram.senderAddress(); );// å‘é€udp.writeDatagram(Hello, QHostAddress(192.168.1.100), 8888); 4.2 SSLTLS åŠ å¯†ç”Ÿäº§ç¯å¢ƒå»ºè®®å§‹ç»ˆå¼€å¯ SSLã€‚å°† QTcpSocket æ›¿æ¢ä¸º QSslSocketã€‚ å®¢æˆ·ç«¯ï¼šä½¿ç”¨ socket-connectToHostEncrypted(host, port)ã€‚ æœåŠ¡ç«¯ï¼š åŠ è½½è¯ä¹¦ï¼šsocket-setLocalCertificate(server.crt) åŠ è½½ç§é’¥ï¼šsocket-setPrivateKey(server.key) å¯åŠ¨æ¡æ‰‹ï¼šsocket-startServerEncryption() é™„å½•ï¼šæ ¸å¿ƒç±»é€ŸæŸ¥ ç±»å åŠŸèƒ½ å¤‡æ³¨ QNetworkAccessManager HTTPHTTPS è¯·æ±‚ é«˜çº§ APIï¼Œè‡ªå¸¦ Cookieç¼“å­˜ç®¡ç† QTcpSocket TCP å®¢æˆ·ç«¯æ•°æ®ä¼ è¾“ éœ€æ³¨æ„çº¿ç¨‹å½’å±ï¼Œå®ƒæ˜¯ QIODevice QTcpServer TCP ç›‘å¬ä¸ Accept é‡å†™ incomingConnection å®ç°å¤šçº¿ç¨‹ QUdpSocket UDP æ•°æ®æŠ¥ æ”¯æŒå•æ’­ã€å¹¿æ’­ã€ç»„æ’­ QSslSocket åŠ å¯†å¥—æ¥å­— æ¥å£ä¸ TcpSocket å…¼å®¹ï¼Œéœ€ OpenSSL æ”¯æŒ","tags":["Qt","å¤šçº¿ç¨‹","ç½‘ç»œ","TCP","HTTP"],"categories":["3.å¼€å‘æ¡†æ¶","Qt","Standby"]},{"title":"Qt å›¾å½¢è§†å›¾æ¡†æ¶ (Graphics View) è¯¦è§£","path":"/2026/01/14/3-å¼€å‘æ¡†æ¶-Qt-Standby-Qtå›¾å½¢è§†å›¾æ¡†æ¶è¯¦è§£/","content":"Qt å›¾å½¢è§†å›¾æ¡†æ¶ï¼ˆGraphics View Frameworkï¼‰æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„å¹³å°ï¼Œç”¨äºç®¡ç†å’Œäº¤äº’å¤§é‡çš„å®šåˆ¶ 2D å›¾å½¢é¡¹ï¼Œä»¥åŠä¸€ä¸ªå¯è§†åŒ–è¿™äº›é¡¹çš„è§†å›¾éƒ¨ä»¶ï¼ˆView widgetï¼‰ã€‚å®ƒä¸ä»…æ˜¯ä¼ ç»Ÿçš„ QCanvas æ¨¡å—çš„æ›¿ä»£å“ï¼Œæ›´æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„äº¤äº’å¼ç»˜å›¾å¼•æ“ã€‚ 1. æ ¸å¿ƒæ¶æ„ (MVC)Graphics View æ¡†æ¶é‡‡ç”¨äº†åŸºäºå›¾å…ƒï¼ˆItem-basedï¼‰çš„æ–¹æ³•ï¼Œè€ŒéåŸºäºåƒç´ ï¼ˆPixel-basedï¼‰ã€‚é€šè¿‡ä½¿ç”¨ BSPï¼ˆBinary Space Partitioningï¼ŒäºŒå…ƒç©ºé—´åˆ†å‰²ï¼‰ æ ‘æŠ€æœ¯ï¼Œå®ƒèƒ½å¤Ÿå¿«é€ŸæŸ¥æ‰¾å›¾å…ƒï¼Œä»è€Œå®æ—¶æ¸²æŸ“åŒ…å«æ•°ç™¾ä¸‡ä¸ªå›¾å…ƒçš„åœºæ™¯ã€‚ å…¶æ¶æ„éµå¾ªæ”¹è¿›çš„ MVCï¼ˆModel-View-Controllerï¼‰ æ¨¡å¼ï¼š graph TD User((User/Event)) --|Input| View[QGraphicsView (View)] View --|Transforms| Scene[QGraphicsScene (Model)] Scene --|Dispatches| Item[QGraphicsItem (Item)] Item --|Updates| Scene Scene --|Notifies| View 1.1 åœºæ™¯ (QGraphicsScene) - ModelQGraphicsScene æ˜¯å›¾å½¢é¡¹çš„å®¹å™¨ï¼Œæ‰®æ¼”æ¨¡å‹ï¼ˆModelï¼‰çš„è§’è‰²ã€‚å®ƒæœ¬èº«æ˜¯ä¸å¯è§çš„ï¼Œä¸»è¦è´Ÿè´£ï¼š å›¾å…ƒç®¡ç†ï¼šç»´æŠ¤æ‰€æœ‰å›¾å…ƒçš„ä½ç½®å’ŒçŠ¶æ€ã€‚ äº‹ä»¶ä¼ æ’­ï¼šå°†æ¥è‡ªè§†å›¾çš„äº‹ä»¶ä¼ é€’ç»™å¯¹åº”çš„å›¾å…ƒã€‚ å›¾å…ƒæŸ¥æ‰¾ï¼šæä¾›é«˜æ•ˆçš„æ¥å£ï¼ˆå¦‚ items()ï¼‰æ¥æ£€æµ‹ç¢°æ’æˆ–æŸ¥æ‰¾ç‰¹å®šåŒºåŸŸå†…çš„å›¾å…ƒã€‚ æ¸²æŸ“ç®¡ç†ï¼šè™½ç„¶ä¸ç›´æ¥æ˜¾ç¤ºï¼Œä½†æä¾› render() å‡½æ•°å°†åœºæ™¯å†…å®¹ç»˜åˆ¶åˆ° QImage æˆ– QPrinterã€‚ 1.2 è§†å›¾ (QGraphicsView) - ViewQGraphicsView æ˜¯è§‚å¯Ÿåœºæ™¯çš„çª—å£ï¼Œæ‰®æ¼”è§†å›¾ï¼ˆViewï¼‰çš„è§’è‰²ã€‚å®ƒæ˜¯ QWidget çš„å­ç±»ï¼Œè´Ÿè´£ï¼š å¯è§†åŒ–ï¼šæ˜¾ç¤ºåœºæ™¯çš„å¯è§†åŒºåŸŸï¼Œæ”¯æŒæ»šåŠ¨æ¡ã€‚ äº¤äº’æ¥å£ï¼šæ¥æ”¶é”®ç›˜ã€é¼ æ ‡è¾“å…¥ï¼Œå¹¶è½¬æ¢ä¸ºåœºæ™¯äº‹ä»¶ã€‚ åæ ‡å˜æ¢ï¼šæ”¯æŒä»¿å°„å˜æ¢ï¼ˆç¼©æ”¾ã€æ—‹è½¬ï¼‰ï¼Œå®ç°è§†å›¾çš„ç¼©æ”¾å’Œå¹³ç§»ï¼Œè€Œä¸æ”¹å˜åº•å±‚æ•°æ®ã€‚ æ¸²æŸ“åŠ é€Ÿï¼šé€šè¿‡è®¾ç½®è§†å£ï¼ˆViewportï¼‰ï¼Œå¯ä»¥åˆ©ç”¨ OpenGL (QOpenGLWidget) è¿›è¡Œç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“ã€‚ 1.3 å›¾å…ƒ (QGraphicsItem) - ElementQGraphicsItem æ˜¯åœºæ™¯ä¸­çš„åŸºæœ¬å›¾å½¢å•ä½ã€‚å®ƒä¸ä»…åŒ…å«å‡ ä½•ä¿¡æ¯ï¼Œè¿˜åŒ…å«é€»è¾‘çŠ¶æ€ï¼š å‡ ä½•å½¢çŠ¶ï¼šå®šä¹‰è‡ªèº«çš„è¾¹ç•ŒçŸ©å½¢ (boundingRect()) å’Œç²¾ç¡®å½¢çŠ¶ (shape())ã€‚ äº¤äº’å¤„ç†ï¼šå¤„ç†ç‚¹å‡»ã€æ‹–æ‹½ã€é”®ç›˜ç„¦ç‚¹ç­‰äº‹ä»¶ã€‚ å±‚çº§å…³ç³»ï¼šæ”¯æŒçˆ¶å­åµŒå¥—ï¼Œå­å›¾å…ƒè·Ÿéšçˆ¶å›¾å…ƒå˜æ¢ã€‚ ç»˜å›¾å®ç°ï¼šé€šè¿‡é‡å†™ paint() å‡½æ•°ç»˜åˆ¶è‡ªèº«å†…å®¹ã€‚ 2. ä¸‰å¤§åæ ‡ç³»ç»Ÿç†è§£åæ ‡ç³»ç»Ÿæ˜¯æŒæ¡ Graphics View çš„å…³é”®ã€‚æ¡†æ¶ä¸­å­˜åœ¨ä¸‰ä¸ªç‹¬ç«‹çš„åæ ‡ç³»ï¼šå›¾å…ƒåæ ‡ã€åœºæ™¯åæ ‡å’Œè§†å›¾åæ ‡ã€‚ graph LR Item[å›¾å…ƒåæ ‡ (Item)] --|mapToScene / mapFromScene| Scene[åœºæ™¯åæ ‡ (Scene)] Scene --|mapFromScene / mapToScene| View[è§†å›¾åæ ‡ (View)] Item .-|mapToParent| Parent[çˆ¶å›¾å…ƒåæ ‡] 2.1 å›¾å…ƒåæ ‡ (Item Coordinates) åŸºå‡†ï¼šä»¥å›¾å…ƒè‡ªèº«çš„åŸç‚¹ (0, 0) ä¸ºä¸­å¿ƒã€‚ ç‰¹æ€§ï¼šè¿™æ˜¯å›¾å…ƒçš„å±€éƒ¨åæ ‡ç³»ã€‚æ— è®ºå›¾å…ƒå¦‚ä½•åœ¨åœºæ™¯ä¸­ç§»åŠ¨ã€æ—‹è½¬æˆ–ç¼©æ”¾ï¼Œå…¶å†…éƒ¨ç»˜å›¾é€»è¾‘ï¼ˆå¦‚ paint()ï¼‰å§‹ç»ˆåŸºäºæ­¤åæ ‡ç³»ã€‚ åº”ç”¨ï¼šboundingRect() å’Œ shape() çš„è¿”å›å€¼å¿…é¡»åŸºäºæ­¤åæ ‡ç³»ã€‚ 2.2 åœºæ™¯åæ ‡ (Scene Coordinates) åŸºå‡†ï¼šåœºæ™¯çš„åŸç‚¹ (0, 0)ã€‚ ç‰¹æ€§ï¼šè¿™æ˜¯æ‰€æœ‰å›¾å…ƒå…±äº«çš„é€»è¾‘ä¸–ç•Œåæ ‡ç³»ã€‚ åº”ç”¨ï¼šscenePos() ç”¨äºè·å–å›¾å…ƒåœ¨åœºæ™¯ä¸­çš„ç»å¯¹ä½ç½®ã€‚åœºæ™¯çš„äº‹ä»¶å¤„ç†é€šå¸¸åŸºäºæ­¤åæ ‡ã€‚ 2.3 è§†å›¾åæ ‡ (View Coordinates) åŸºå‡†ï¼šè§†å›¾çª—å£ï¼ˆWidgetï¼‰çš„å·¦ä¸Šè§’ã€‚ ç‰¹æ€§ï¼šå•ä½æ˜¯åƒç´ ï¼Œç›´æ¥å¯¹åº”å±å¹•ä¸Šçš„ç‰©ç†ç‚¹ã€‚ åº”ç”¨ï¼šé¼ æ ‡äº‹ä»¶ï¼ˆQMouseEventï¼‰æœ€åˆæä¾›çš„å°±æ˜¯è§†å›¾åæ ‡ã€‚ 2.4 åæ ‡è½¬æ¢å¸¸ç”¨ APIåœ¨å¤„ç†äº¤äº’æ—¶ï¼Œç»å¸¸éœ€è¦åœ¨ä¸åŒåæ ‡ç³»é—´è½¬æ¢ï¼š è½¬æ¢æ–¹å‘ API ç¤ºä¾‹ è§†å›¾ â†’ åœºæ™¯ view-mapToScene(point) å°†é¼ æ ‡ç‚¹å‡»ä½ç½®è½¬æ¢ä¸ºé€»è¾‘åæ ‡ åœºæ™¯ â†’ å›¾å…ƒ item-mapFromScene(point) åˆ¤æ–­ç‚¹å‡»ç‚¹æ˜¯å¦è½åœ¨å›¾å…ƒå†…éƒ¨ å›¾å…ƒ â†’ åœºæ™¯ item-mapToScene(point) è·å–å›¾å…ƒçš„ç»å¯¹ä½ç½® å­ â†’ çˆ¶ item-mapToParent(point) è·å–å­å›¾å…ƒåœ¨çˆ¶å›¾å…ƒä¸­çš„ä½ç½® æ³¨æ„ï¼šåœ¨ mousePressEvent ä¸­ï¼ŒåŠ¡å¿…åŒºåˆ† event-pos() (å›¾å…ƒå±€éƒ¨åæ ‡) å’Œ event-scenePos() (åœºæ™¯åæ ‡)ã€‚ 3. æ ¸å¿ƒç‰¹æ€§ä¸æœºåˆ¶3.1 å˜æ¢ (Transformations)Graphics View æ”¯æŒé€šè¿‡çŸ©é˜µè¿›è¡Œä»¿å°„å˜æ¢ã€‚ è§†å›¾å˜æ¢ï¼šview-scale(2, 2) (æ”¾å¤§) æˆ– view-rotate(45) (æ—‹è½¬)ã€‚è¿™åªæ”¹å˜è§‚å¯Ÿè§’åº¦ï¼Œä¸ä¿®æ”¹å›¾å…ƒæ•°æ®ã€‚ å›¾å…ƒå˜æ¢ï¼šitem-setRotation(45) æˆ– item-setScale(0.5)ã€‚è¿™ä¼šæ”¹å˜å›¾å…ƒåœ¨åœºæ™¯ä¸­çš„å‘ˆç°ï¼Œå¹¶å½±å“å…¶å­å›¾å…ƒã€‚ 3.2 å›¾å…ƒåˆ†ç»„ (Grouping) çˆ¶å­å±‚çº§ï¼šå°†ä¸€ä¸ªå›¾å…ƒè®¾ç½®ä¸ºå¦ä¸€ä¸ªçš„å­é¡¹ (child-setParentItem(parent))ã€‚å­é¡¹çš„åæ ‡å’Œå˜æ¢ç›¸å¯¹äºçˆ¶é¡¹ã€‚ QGraphicsItemGroupï¼šå°†å¤šä¸ªå›¾å…ƒæ‰“åŒ…æˆä¸€ä¸ªç‹¬ç«‹çš„é€»è¾‘å•å…ƒï¼Œç»Ÿä¸€å¤„ç†é€‰æ‹©å’Œç§»åŠ¨äº‹ä»¶ã€‚ 3.3 ç¢°æ’æ£€æµ‹ (Collision Detection)æ¡†æ¶æä¾›ä¸¤çº§ç¢°æ’æ£€æµ‹æœºåˆ¶ï¼š ç²—ç•¥æ£€æµ‹ï¼šåŸºäº boundingRect()ï¼Œå¿«é€Ÿæ’é™¤ä¸ç›¸äº¤çš„å›¾å…ƒã€‚ ç²¾ç¡®æ£€æµ‹ï¼šåŸºäº shape()ï¼Œé€šè¿‡ QPainterPath è¿›è¡Œåƒç´ çº§ç²¾ç¡®åˆ¤æ–­ã€‚ APIï¼šscene-collidingItems(item) æˆ– item-collidesWithItem(other)ã€‚ 3.4 åŠ¨ç”» (Animation) QPropertyAnimationï¼šæœ€æ¨èçš„æ–¹å¼ã€‚å›¾å…ƒç»§æ‰¿è‡ª QGraphicsObject åï¼Œå¯ä»¥ç›´æ¥å¯¹ posã€rotation ç­‰å±æ€§åº”ç”¨ Qt å±æ€§åŠ¨ç”»ã€‚ Advance æ¥å£ï¼šé‡å†™ scene-advance() å’Œå›¾å…ƒçš„ advance(int phase)ï¼Œé€‚ç”¨äºå¸§åŒæ­¥çš„æ¸¸æˆé€»è¾‘ã€‚ 4. äº‹ä»¶å¤„ç†ä¸äº¤äº’Graphics View æ‹¥æœ‰å®Œå–„çš„äº‹ä»¶åˆ†å‘æœºåˆ¶ã€‚äº‹ä»¶é¦–å…ˆç”± View æ¥æ”¶ï¼Œè½¬æ¢ä¸º Scene äº‹ä»¶ï¼Œæœ€ååˆ†å‘ç»™ Itemã€‚ 4.1 é¼ æ ‡äº‹ä»¶å›¾å…ƒé»˜è®¤æ¥æ”¶é¼ æ ‡ç‚¹å‡»ã€‚è¦å¤„ç†æ‚¬åœæˆ–æ‹–æ‹½ï¼Œéœ€æ˜¾å¼å¼€å¯ï¼š setAcceptHoverEvents(true); // å¼€å¯æ‚¬åœäº‹ä»¶ hoverEnterEvent/hoverLeaveEventsetFlag(ItemIsMovable); // å¼€å¯å†…ç½®çš„æ‹–æ‹½ç§»åŠ¨setFlag(ItemIsSelectable); // å¼€å¯é€‰ä¸­çŠ¶æ€æ”¯æŒ 4.2 æ‹–æ”¾ (Drag Drop)æ”¯æŒæ ‡å‡†çš„ Qt æ‹–æ”¾æœºåˆ¶ï¼š åœ¨å›¾å…ƒä¸­è°ƒç”¨ setAcceptDrops(true)ã€‚ é‡å†™ dragEnterEventã€dragLeaveEvent å’Œ dropEventã€‚è¿™ä½¿å¾—å›¾å…ƒå¯ä»¥ä½œä¸ºæ‹–æ”¾æ“ä½œçš„æ¥æ”¶è€…ï¼Œå¤„ç†æ¥è‡ªå¤–éƒ¨æˆ–å…¶ä»–å›¾å…ƒçš„æ•°æ®ã€‚ 5. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥åœ¨å¤„ç†æˆåƒä¸Šä¸‡ä¸ªå›¾å…ƒæ—¶ï¼Œæ€§èƒ½æ˜¯é¦–è¦è€ƒè™‘å› ç´ ã€‚ 5.1 ç²¾ç¡®çš„è¾¹ç•Œ (Bounding Rect)boundingRect() çš„æ•ˆç‡å¯¹æ€§èƒ½å½±å“æå¤§ã€‚ åŸåˆ™ï¼šå¿…é¡»æ¶µç›–å›¾å…ƒç»˜åˆ¶çš„æ‰€æœ‰åƒç´ ï¼ˆåŒ…æ‹¬ç”»ç¬”å®½åº¦çš„ä¸€åŠï¼‰ï¼Œä½†ä¸èƒ½è¿‡å¤§ã€‚ ç¼“å­˜ï¼šå¦‚æœå½¢çŠ¶å›ºå®šï¼Œåº”ç¼“å­˜è¾¹ç•ŒçŸ©å½¢ï¼Œé¿å…åœ¨æ¯æ¬¡è°ƒç”¨æ—¶é‡å¤è®¡ç®—ã€‚ 5.2 ç»†èŠ‚å±‚æ¬¡ (LOD - Level of Detail)åœ¨æ¸²æŸ“æ—¶ï¼Œæ ¹æ®å½“å‰çš„ç¼©æ”¾çº§åˆ«åŠ¨æ€è°ƒæ•´ç»˜åˆ¶å¤æ‚åº¦ã€‚ void MyItem::paint(QPainter *painter, const QStyleOptionGraphicsItem *option, QWidget *) // levelOfDetailFromTransform å°†å˜æ¢çŸ©é˜µè½¬æ¢ä¸ºå•ä¸€çš„ç¼©æ”¾ç³»æ•° qreal lod = option-levelOfDetailFromTransform(painter-worldTransform()); if (lod 0.2) painter-drawRect(...); // ç¼©å°çœ‹æ—¶ç”»ç®€å•çš„æ¡† else painter-drawPixmap(...); // æ”¾å¤§çœ‹æ—¶ç”»é«˜æ¸…å›¾ 5.3 è§†å›¾æ¸²æŸ“ä¼˜åŒ– å…¨è§†å£æ›´æ–°ï¼šview-setViewportUpdateMode(QGraphicsView::FullViewportUpdate)ã€‚åœ¨å›¾å…ƒå¯†é›†ä¸”é¢‘ç¹ç§»åŠ¨çš„åœºæ™¯ä¸‹ï¼Œç›´æ¥é‡ç»˜æ•´ä¸ªè§†å£å¾€å¾€æ¯”è®¡ç®—è„çŸ©å½¢ï¼ˆDirty Rectï¼‰æ›´é«˜æ•ˆã€‚ èƒŒæ™¯ç¼“å­˜ï¼šview-setCacheMode(QGraphicsView::CacheBackground)ã€‚å¦‚æœèƒŒæ™¯æ˜¯é™æ€çš„ï¼Œå¼€å¯ç¼“å­˜å¯æ˜¾è‘—å‡å°‘é‡ç»˜å¼€é”€ã€‚ OpenGL åŠ é€Ÿï¼šview-setViewport(new QOpenGLWidget())ã€‚åˆ©ç”¨ GPU è¿›è¡Œæ¸²æŸ“ã€‚ 5.4 ç´¢å¼•æ¨¡å¼ åŠ¨æ€åœºæ™¯ï¼šå¦‚æœå›¾å…ƒé¢‘ç¹ç§»åŠ¨ï¼ŒBSP æ ‘çš„é‡å»ºæˆæœ¬å¯èƒ½é«˜äºå…¶å¸¦æ¥çš„æŸ¥æ‰¾æ”¶ç›Šã€‚æ­¤æ—¶å¯è®¾ä¸º scene-setItemIndexMethod(QGraphicsScene::NoIndex)ï¼Œä½¿ç”¨çº¿æ€§æŸ¥æ‰¾ã€‚ 6. å‚è€ƒæ¥æº Qt Documentation: Graphics View Framework (Qt å®˜æ–¹æ–‡æ¡£) Qt Examples: Graphics View (å®˜æ–¹ç¤ºä¾‹åº“) Optimizing the Graphics View (å®˜æ–¹æ€§èƒ½æŒ‡å—)","tags":["Qt","GraphicsView","ç»˜å›¾","æ¶æ„"]},{"title":"Qt æ¨¡æ€ä¸éæ¨¡æ€å¯¹è¯æ¡†æ·±åº¦æŒ‡å—","path":"/2026/01/14/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qt-å¯¹è¯æ¡†-æ¨¡æ€ä¸éæ¨¡æ€/","content":"Qt å¯¹è¯æ¡†æ¨¡æ€æœºåˆ¶æ·±åº¦æŒ‡å— (Qt 6.x)åœ¨ Qt GUI å¼€å‘ä¸­ï¼Œå¯¹è¯æ¡†çš„æ¨¡æ€ (Modality) å†³å®šäº†ç”¨æˆ·äº¤äº’çš„é˜»å¡è¡Œä¸ºå’Œä»£ç æ‰§è¡Œæµç¨‹ã€‚æœ¬æ–‡åŸºäº Qt 6.x å®˜æ–¹æ–‡æ¡£ï¼Œæ·±å…¥è§£ææ¨¡æ€æœºåˆ¶çš„åº•å±‚åŸç†ã€å†…å­˜ç®¡ç†ç­–ç•¥åŠç”Ÿäº§çº§æœ€ä½³å®è·µã€‚ 1. æ ¸å¿ƒæ¦‚å¿µé€ŸæŸ¥1.1 ä¸‰ç§æ¨¡æ€æ¨¡å¼ æ¨¡å¼ è°ƒç”¨æ–¹æ³• UI äº¤äº’ ä»£ç æ‰§è¡Œ å†…å­˜ç®¡ç† å…¸å‹åœºæ™¯ æ¨¡æ€ (Modal) exec() é˜»å¡ é˜»å¡ æ ˆåˆ†é… ç™»å½•æ¡†ã€ç¡®è®¤å¯¹è¯æ¡†ã€æ–‡ä»¶ä¿å­˜ éæ¨¡æ€ (Modeless) show() ä¸é˜»å¡ ä¸é˜»å¡ å †åˆ†é… + WA_DeleteOnClose æŸ¥æ‰¾æ›¿æ¢ã€å·¥å…·é¢æ¿ã€æ—¥å¿—çª—å£ åŠæ¨¡æ€ (Semi-Modal) open() é˜»å¡ ä¸é˜»å¡ å †åˆ†é… + ä¿¡å·æ§½ è¿›åº¦å¯¹è¯æ¡†ã€å¼‚æ­¥æ“ä½œæç¤º 1.2 æ¨¡æ€çº§åˆ« (Qt::WindowModality) æšä¸¾å€¼ é˜»å¡èŒƒå›´ ä½¿ç”¨åœºæ™¯ Qt::NonModal æ— é˜»å¡ å·¥å…·çª—å£ã€æµ®åŠ¨é¢æ¿ Qt::WindowModal ä»…é˜»å¡çˆ¶çª—å£åŠå…¶ç¥–å…ˆ å­æ–‡æ¡£çš„ä¿å­˜ç¡®è®¤ Qt::ApplicationModal é˜»å¡æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ‰€æœ‰çª—å£ å…¨å±€è®¾ç½®ã€ç™»å½•è®¤è¯ 1.3 API æ–¹æ³•å¯¹æ¯” æ–¹æ³• é˜»å¡è°ƒç”¨çº¿ç¨‹ åˆ›å»ºåµŒå¥—äº‹ä»¶å¾ªç¯ é»˜è®¤æ¨¡æ€æ€§ è¿”å›å€¼ ç»“æœè·å–æ–¹å¼ Qt å®˜æ–¹æ¨è exec() âœ… æ˜¯ âœ… æ˜¯ åº”ç”¨æ¨¡æ€ DialogCode åŒæ­¥è¿”å›å€¼ âš ï¸ ä¸æ¨è show() âŒ å¦ âŒ å¦ éæ¨¡æ€ void æ‰‹åŠ¨æ£€æŸ¥ âœ… éæ¨¡æ€åœºæ™¯ open() âŒ å¦ âŒ å¦ çª—å£æ¨¡æ€ void finished() ä¿¡å· âœ… æ¨¡æ€åœºæ™¯ [!WARNING]Qt å®˜æ–¹æ–‡æ¡£æ˜ç¡®è­¦å‘Šï¼šexec() ç”±äºåµŒå¥—äº‹ä»¶å¾ªç¯å¯èƒ½å¯¼è‡´å±é™©çš„é‡å…¥ Bugã€‚æ¨èä½¿ç”¨ open() + finished() ä¿¡å·æ›¿ä»£ã€‚ 2. äº‹ä»¶å¾ªç¯æœºåˆ¶2.1 åµŒå¥—äº‹ä»¶å¾ªç¯åŸç†exec() æ–¹æ³•çš„æ ¸å¿ƒæœºåˆ¶æ˜¯å¯åŠ¨**åµŒå¥—äº‹ä»¶å¾ªç¯ (Nested Event Loop)**ï¼š sequenceDiagram participant MainLoop as ä¸»äº‹ä»¶å¾ªç¯ participant Dialog as QDialog participant NestedLoop as åµŒå¥—äº‹ä»¶å¾ªç¯ MainLoop-Dialog: dialog-exec() activate Dialog Dialog-NestedLoop: åˆ›å»ºå¹¶è¿›å…¥åµŒå¥—å¾ªç¯ activate NestedLoop Note over NestedLoop: å¤„ç†å¯¹è¯æ¡†äº‹ä»¶br/(ç‚¹å‡»ã€è¾“å…¥ã€é‡ç»˜) NestedLoop-NestedLoop: ç”¨æˆ·äº¤äº’ NestedLoop--Dialog: accept()/reject() é€€å‡ºå¾ªç¯ deactivate NestedLoop Dialog--MainLoop: è¿”å› DialogCode deactivate Dialog 2.2 exec() ä¼ªä»£ç å®ç°int QDialog::exec() setAttribute(Qt::WA_ShowModal, true); show(); QEventLoop eventLoop; m_eventLoop = eventLoop; // é˜»å¡åœ¨æ­¤ï¼Œç›´åˆ° accept()/reject()/done() è¢«è°ƒç”¨ return eventLoop.exec(QEventLoop::DialogExec); 2.3 å…³é”®ç»“è®º æ¨¡æ€å¯¹è¯æ¡†ä¸åˆ›å»ºæ–°çº¿ç¨‹ï¼šexec() åœ¨ä¸»çº¿ç¨‹è¿è¡ŒåµŒå¥—äº‹ä»¶å¾ªç¯ åµŒå¥—å¾ªç¯å¯å¤„ç†äº‹ä»¶ï¼šç•Œé¢ä»å¯å“åº”é‡ç»˜ã€å®šæ—¶å™¨ç­‰äº‹ä»¶ é˜»å¡æ˜¯é€»è¾‘é˜»å¡ï¼šCPU å¹¶æœªç©ºé—²ï¼Œåªæ˜¯æ‰§è¡Œæµè¢«æ‹¦æˆª 2.4 éªŒè¯å®éªŒvoid MainWindow::testEventLoop() qDebug() 1. ä¸»çº¿ç¨‹ ID: QThread::currentThreadId(); QDialog dialog(this); QTimer::singleShot(1000, [this]() // è¿™ä¸ªå®šæ—¶å™¨ä¼šåœ¨åµŒå¥—äº‹ä»¶å¾ªç¯ä¸­è¢«å¤„ç† qDebug() 2. å®šæ—¶å™¨è§¦å‘ï¼Œçº¿ç¨‹ ID: QThread::currentThreadId(); ); qDebug() 3. è°ƒç”¨ exec() å‰; dialog.exec(); qDebug() 4. exec() è¿”å›å;// è¾“å‡ºé¡ºåº: 1 - 3 - 2 - 4// çº¿ç¨‹ ID å…¨éƒ¨ç›¸åŒï¼Œè¯æ˜æ˜¯åŒä¸€çº¿ç¨‹ [!TIP]ç†è§£åµŒå¥—äº‹ä»¶å¾ªç¯æ˜¯æŒæ¡ Qt å¯¹è¯æ¡†è¡Œä¸ºçš„å…³é”®ã€‚è°ƒè¯•æ—¶å¯ä½¿ç”¨ QCoreApplication::processEvents() è§‚å¯Ÿäº‹ä»¶å¤„ç†æ—¶æœºã€‚ 3. ç”Ÿäº§çº§ä»£ç ç¤ºä¾‹æœ¬èŠ‚æä¾›å››ç±»å…¸å‹å¯¹è¯æ¡†çš„å®Œæ•´å®ç°ï¼šæ¨¡æ€ä¿å­˜ç¡®è®¤ã€å¸¦éªŒè¯ç™»å½•æ¡†ã€éæ¨¡æ€æŸ¥æ‰¾æ›¿æ¢ã€åŠæ¨¡æ€è¿›åº¦å¯¹è¯æ¡†ã€‚ 3.1 æ¨¡æ€å¯¹è¯æ¡†ï¼šæ¨èç”¨æ³•ï¼ˆopen + finished ä¿¡å·ï¼‰éœ€æ±‚ï¼šç”¨æˆ·å…³é—­çª—å£æ—¶è¯¢é—®æ˜¯å¦ä¿å­˜ï¼Œå¿…é¡»ç­‰å¾…ç”¨æˆ·å“åº”ã€‚ // âœ… æ¨èï¼šä½¿ç”¨ open() + finished ä¿¡å·ï¼Œé¿å…åµŒå¥—äº‹ä»¶å¾ªç¯void MainWindow::closeEvent(QCloseEvent* event) if (!m_isModified) event-accept(); return; auto* dialog = new QDialog(this); dialog-setModal(true); // ... è®¾ç½® UIï¼ˆä½¿ç”¨ QDialogButtonBox è‡ªåŠ¨é€‚é…å¹³å°æŒ‰é’®é¡ºåºï¼‰ connect(dialog, QDialog::finished, this, [this, dialog](int result) if (result == QDialog::Accepted) saveDocument(); dialog-deleteLater(); // â† å…³é”®ï¼šå¼‚æ­¥åˆ é™¤ ); event-ignore(); dialog-open(); // â† å…³é”®ï¼šä¸é˜»å¡ä»£ç ï¼Œä½†é˜»å¡ UI å…³é”®ç‚¹ï¼š open() ä¸åˆ›å»ºåµŒå¥—äº‹ä»¶å¾ªç¯ï¼Œæ¯” exec() æ›´å®‰å…¨ é€šè¿‡ finished ä¿¡å·è·å–ç»“æœï¼Œæ”¯æŒå¼‚æ­¥å¤„ç† ä½¿ç”¨ deleteLater() ç¡®ä¿å¯¹è¯æ¡†å®‰å…¨é”€æ¯ 3.2 æ¨¡æ€å¯¹è¯æ¡†ï¼šexec() åŒæ­¥è°ƒç”¨ï¼ˆæ ˆåˆ†é…ï¼‰// â„¹ï¸ exec() åˆ›å»ºåµŒå¥—äº‹ä»¶å¾ªç¯ï¼Œè°¨æ…ä½¿ç”¨void MainWindow::onLogin() LoginDialog dialog(this); // â† æ ˆä¸Šåˆ›å»ºï¼Œå‡½æ•°è¿”å›æ—¶è‡ªåŠ¨é”€æ¯ if (dialog.exec() == QDialog::Accepted) QString user = dialog.username(); // æ‰§è¡Œç™»å½•é€»è¾‘... å…³é”®ç‚¹ï¼š æ ˆåˆ†é… + exec() æ˜¯æœ€ç®€æ´çš„åŒæ­¥æ¨¡æ€ç”¨æ³• ä¸è¦å¯¹æ ˆåˆ†é…å¯¹è¯æ¡†è®¾ç½® WA_DeleteOnCloseï¼ˆä¼šå¯¼è‡´åŒé‡é‡Šæ”¾ï¼‰ ç¡®ä¿çˆ¶çª—å£åœ¨ exec() æœŸé—´ä¸ä¼šè¢«åˆ é™¤ 3.3 éæ¨¡æ€å¯¹è¯æ¡†ï¼šæŸ¥æ‰¾æ›¿æ¢éœ€æ±‚ï¼šç”¨æˆ·å¯åŒæ—¶ç¼–è¾‘æ–‡æ¡£å’Œæ“ä½œæŸ¥æ‰¾å¯¹è¯æ¡†ã€‚ class FindDialog : public QDialog Q_OBJECTpublic: explicit FindDialog(QWidget* parent) : QDialog(parent) setModal(false); // â† å…³é”®ï¼šéæ¨¡æ€ setWindowFlags(windowFlags() | Qt::Tool); // å·¥å…·çª—å£æ ·å¼ setAttribute(Qt::WA_DeleteOnClose, false); // å¤ç”¨å®ä¾‹ protected: void closeEvent(QCloseEvent* event) override hide(); // â† å…³é”®ï¼šéšè—è€Œéé”€æ¯ event-ignore(); ;// è°ƒç”¨æ–¹å¼ï¼šæˆå‘˜å˜é‡æŒæœ‰ï¼ˆé˜²æ­¢åˆ›å»ºå¤šä¸ªå®ä¾‹ï¼‰class MainWindow QPointerFindDialog m_findDialog; // â† ä½¿ç”¨ QPointer é˜²æ­¢æ‚¬ç©ºæŒ‡é’ˆ void showFind() if (!m_findDialog) m_findDialog = new FindDialog(this); m_findDialog-show(); m_findDialog-raise(); // ç½®é¡¶ m_findDialog-activateWindow(); // æ¿€æ´» ; å…³é”®ç‚¹ï¼š setModal(false) + show() å®ç°éæ¨¡æ€ ä½¿ç”¨æˆå‘˜å˜é‡æˆ–å•ä¾‹æ¨¡å¼é˜²æ­¢åˆ›å»ºå¤šä¸ªå¯¹è¯æ¡†å®ä¾‹ hide() è€Œé close() å¯ä¿ç•™ç”¨æˆ·è¾“å…¥çŠ¶æ€ 3.4 åŠæ¨¡æ€å¯¹è¯æ¡†ï¼šQProgressDialog å¼‚æ­¥ä»»åŠ¡éœ€æ±‚ï¼šæ˜¾ç¤ºè¿›åº¦æ¡ï¼ŒUI é˜»å¡ä½†ä»£ç ä¸é˜»å¡ã€‚ void startDownload(const QUrl url) auto* progress = new QProgressDialog(æ­£åœ¨ä¸‹è½½..., å–æ¶ˆ, 0, 100, this); progress-setWindowModality(Qt::WindowModal); // â† å…³é”®ï¼šçª—å£æ¨¡æ€ progress-setMinimumDuration(500); // å»¶è¿Ÿæ˜¾ç¤ºï¼ˆé¿å…é—ªçƒï¼‰ progress-setAttribute(Qt::WA_DeleteOnClose); QNetworkReply* reply = networkManager-get(QNetworkRequest(url)); connect(reply, QNetworkReply::downloadProgress, [progress](qint64 received, qint64 total) if (total 0) progress-setValue(received * 100 / total); ); connect(reply, QNetworkReply::finished, progress, QDialog::close); connect(progress, QProgressDialog::canceled, reply, QNetworkReply::abort); progress-open(); // â† å…³é”®ï¼šopen() ä¸é˜»å¡ä»£ç  å…³é”®ç‚¹ï¼š open() å®ç°åŠæ¨¡æ€ï¼šUI é˜»å¡ + ä»£ç ç»§ç»­æ‰§è¡Œ setMinimumDuration() é¿å…çŸ­ä»»åŠ¡çš„å¯¹è¯æ¡†é—ªçƒ é€šè¿‡ä¿¡å·æ§½æ›´æ–°è¿›åº¦å’Œå¤„ç†å–æ¶ˆ 3.5 åŠæ¨¡æ€å¯¹è¯æ¡†ï¼šQtConcurrent + è¿›åº¦æ›´æ–°// å¼‚æ­¥ä»»åŠ¡ + è·¨çº¿ç¨‹è¿›åº¦æ›´æ–°void MainWindow::runHeavyTask() auto* progress = new QProgressDialog(å¤„ç†ä¸­..., å–æ¶ˆ, 0, 100, this); progress-setWindowModality(Qt::WindowModal); QFutureWatchervoid* watcher = new QFutureWatchervoid(this); connect(watcher, QFutureWatchervoid::finished, [=]() progress-close(); watcher-deleteLater(); ); // å¯åŠ¨å¼‚æ­¥ä»»åŠ¡ watcher-setFuture(QtConcurrent::run([=]() for (int i = 0; i = 100; ++i) QThread::msleep(50); // â† å…³é”®ï¼šè·¨çº¿ç¨‹æ›´æ–° UI å¿…é¡»ç”¨ invokeMethod QMetaObject::invokeMethod(progress, [=]() progress-setValue(i); , Qt::QueuedConnection); )); progress-open(); å…³é”®ç‚¹ï¼š QtConcurrent::run() åœ¨å·¥ä½œçº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œ QMetaObject::invokeMethod() + Qt::QueuedConnection å®ç°è·¨çº¿ç¨‹ UI æ›´æ–° QFutureWatcher::finished ä¿¡å·å¤„ç†ä»»åŠ¡å®Œæˆ 4. QWidget å®ç°æ¨¡æ€è¡Œä¸ºæ™®é€š QWidget æ²¡æœ‰ exec() æ–¹æ³•ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®æ¨¡æ€å±æ€§ã€‚ 4.1 ä¸¤ç§è®¾ç½®æ–¹å¼// æ–¹å¼ 1ï¼šsetWindowModality (æ¨è)QWidget *widget = new QWidget();widget-setWindowModality(Qt::ApplicationModal);widget-show();// æ–¹å¼ 2ï¼šsetAttributewidget-setAttribute(Qt::WA_ShowModal, true);widget-show(); 4.2 æ— è¾¹æ¡†çª—å£æ¨¡æ€å¤±æ•ˆé—®é¢˜// é—®é¢˜ä»£ç widget-setWindowFlags(Qt::FramelessWindowHint | Qt::WindowStaysOnTopHint);widget-setWindowModality(Qt::ApplicationModal);// æ¨¡æ€å¯èƒ½ä¸ç”Ÿæ•ˆï¼// è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ  Qt::Dialog æ ‡å¿—widget-setWindowFlags(Qt::Dialog | Qt::FramelessWindowHint | Qt::WindowStaysOnTopHint);widget-setWindowModality(Qt::ApplicationModal); 5. å¸¸è§è¯¯åŒºä¸é¿å‘æŒ‡å—ä»¥ä¸‹æ˜¯ç”Ÿäº§ç¯å¢ƒä¸­æœ€å¸¸è§çš„å¯¹è¯æ¡†é”™è¯¯æ¨¡å¼åŠå…¶è§£å†³æ–¹æ¡ˆã€‚ 5.1 å†…å­˜ç®¡ç†é”™è¯¯ é”™è¯¯æ¨¡å¼ åæœ æ­£ç¡®åšæ³• æ ˆåˆ†é… + show() å¯¹è¯æ¡†ç«‹å³æ¶ˆå¤±ï¼ˆé—ªé€€ï¼‰ å †åˆ†é… + WA_DeleteOnClose æ ˆåˆ†é… + WA_DeleteOnClose åŒé‡é‡Šæ”¾å´©æºƒ æ ˆåˆ†é…æ—¶ä¸è®¾ç½®è¯¥å±æ€§ å †åˆ†é…æ—  parent æ—  WA_DeleteOnClose å†…å­˜æ³„æ¼ è®¾ç½® parent æˆ–ä½¿ç”¨ deleteLater() å †åˆ†é… + exec() åå¿˜è®°åˆ é™¤ å†…å­˜æ³„æ¼ ä½¿ç”¨ deleteLater() æˆ– WA_DeleteOnClose 5.2 exec() çš„å±é™©åœºæ™¯ï¼šçˆ¶çª—å£æå‰é”€æ¯// âŒ å±é™©ä»£ç void ParentWidget::dangerous() QDialog* dialog = new QDialog(this); // åœ¨å¯¹è¯æ¡†è¿è¡ŒæœŸé—´ï¼ŒæŸä¸ªäº‹ä»¶å¯¼è‡´ this è¢«åˆ é™¤ connect(someTimer, QTimer::timeout, this, QObject::deleteLater); dialog-exec(); // çˆ¶çª—å£å¯èƒ½åœ¨ exec() æœŸé—´è¢«åˆ é™¤ â†’ æœªå®šä¹‰è¡Œä¸º// âœ… å®‰å…¨æ›¿ä»£ï¼šä½¿ç”¨ open()void ParentWidget::safe() QDialog* dialog = new QDialog(this); connect(dialog, QDialog::finished, this, [dialog](int result) dialog-deleteLater(); ); dialog-open(); 5.3 éæ¨¡æ€å¯¹è¯æ¡†çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†// âŒ é”™è¯¯ï¼šæ¯æ¬¡åˆ›å»ºæ–°å®ä¾‹void MainWindow::showFind() auto* dialog = new FindDialog(this); dialog-show(); // å¤šæ¬¡ç‚¹å‡» â†’ åˆ›å»ºå¤šä¸ªå¯¹è¯æ¡†// âœ… æ­£ç¡®ï¼šå•ä¾‹æˆ–æˆå‘˜å˜é‡æŒæœ‰class MainWindow QPointerFindDialog m_findDialog; void showFind() if (!m_findDialog) m_findDialog = new FindDialog(this); m_findDialog-show(); m_findDialog-raise(); ; 5.4 ä¿¡å·é‡å¤è¿æ¥// âŒ æ¯æ¬¡è°ƒç”¨éƒ½é‡å¤è¿æ¥void MainWindow::showDialog() connect(dialog, QDialog::accepted, this, MainWindow::onAccepted); // å¤šæ¬¡è°ƒç”¨ â†’ æ§½å‡½æ•°æ‰§è¡Œå¤šæ¬¡// âœ… ä½¿ç”¨ UniqueConnectionconnect(dialog, QDialog::accepted, this, MainWindow::onAccepted, Qt::UniqueConnection); 5.5 exec() ä¸ show() æ··ç”¨// âŒ é”™è¯¯ï¼šshow() æ˜¯å¤šä½™çš„dialog-show();dialog-exec(); // exec() å†…éƒ¨å·²è°ƒç”¨ show()// âœ… æ­£ç¡®dialog-exec(); 5.6 è¿è¡Œæ—¶ä¿®æ”¹æ¨¡æ€å±æ€§// âŒ é”™è¯¯ï¼šçª—å£å¯è§æ—¶ä¿®æ”¹æ— æ•ˆdialog-show();dialog-setWindowModality(Qt::ApplicationModal); // æ— æ•ˆï¼// âœ… æ­£ç¡®ï¼šå¿…é¡»å…ˆéšè—å†æ˜¾ç¤ºdialog-hide();dialog-setWindowModality(Qt::ApplicationModal);dialog-show(); 5.7 åœ¨æ¨¡æ€å¯¹è¯æ¡†ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ// âŒ é˜»å¡ UIï¼Œå¯¹è¯æ¡†æ— æ³•é‡ç»˜void MyDialog::onOkClicked() for (int i = 0; i 1000000; ++i) heavyComputation(); // UI å†»ç»“ accept();// âœ… ä½¿ç”¨ QtConcurrent æˆ– QThreadvoid MyDialog::onOkClicked() m_okButton-setEnabled(false); QtConcurrent::run([this]() for (int i = 0; i 1000000; ++i) heavyComputation(); QMetaObject::invokeMethod(this, QDialog::accept, Qt::QueuedConnection); ); 6. æœ€ä½³å®è·µæ€»ç»“ åœºæ™¯ æ¨èæ–¹å¼ å…³é”®é…ç½® å¿…é¡»ç­‰å¾…ç”¨æˆ·å“åº” open() + finished() ä¿¡å· setModal(true) ä¼ ç»ŸåŒæ­¥æ¨¡æ€ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ exec() + æ ˆåˆ†é… ç¡®ä¿çˆ¶çª—å£ç”Ÿå‘½å‘¨æœŸå®‰å…¨ å·¥å…·æ€§è´¨å¯¹è¯æ¡† show() + å•ä¾‹æˆå‘˜æŒæœ‰ Qt::Tool çª—å£æ ‡å¿— é•¿æ—¶é—´ä»»åŠ¡ å¼‚æ­¥çº¿ç¨‹ + è¿›åº¦ä¿¡å· QFutureWatcher è·¨å¹³å°æŒ‰é’®é¡ºåº QDialogButtonBox è‡ªåŠ¨é€‚é…å¹³å°è§„èŒƒ 7. è·¨å¹³å°æ³¨æ„äº‹é¡¹ä¸åŒæ“ä½œç³»ç»Ÿå¯¹æ¨¡æ€å¯¹è¯æ¡†çš„å¤„ç†å­˜åœ¨å·®å¼‚ï¼Œå¼€å‘æ—¶éœ€ç‰¹åˆ«å…³æ³¨ï¼š å¹³å° è¡Œä¸ºå·®å¼‚ macOS Qt::WindowModal å¯¹è¯æ¡†å¯èƒ½æ˜¾ç¤ºä¸º Sheetï¼ˆå¸é™„åœ¨çˆ¶çª—å£æ ‡é¢˜æ ä¸‹æ–¹ï¼‰ Windows æ¨¡æ€å¯¹è¯æ¡†ä¼šä½¿çˆ¶çª—å£é—ªçƒé«˜äº®æç¤º Linux (X11) æŸäº›çª—å£ç®¡ç†å™¨å¯èƒ½å¿½ç•¥æ¨¡æ€æ ‡å¿— å‚è€ƒèµ„æ–™ Qt 6 å®˜æ–¹æ–‡æ¡£ï¼šQDialog Class Qt 6 å®˜æ–¹æ–‡æ¡£ï¼šQt::WindowModality Qt Wiki - Nested Event Loops Qt æºç ï¼šsrc/widgets/dialogs/qdialog.cpp ç‰ˆæœ¬è¯´æ˜ï¼šæœ¬æ–‡åŸºäº Qt 6.x ç¼–å†™ã€‚Qt 5.x ç”¨æˆ·æ³¨æ„ open() æ–¹æ³•åœ¨ Qt 4.5+ å¯ç”¨ï¼ŒAPI åŸºæœ¬ä¸€è‡´ã€‚","tags":["Qt","äº‹ä»¶å¾ªç¯","C++","QDialog","å¯¹è¯æ¡†","å†…å­˜ç®¡ç†"],"categories":["3.å¼€å‘æ¡†æ¶","Qt","Standby"]},{"title":"é˜²ç«å¢™","path":"/2026/01/14/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-æœåŠ¡å™¨å®‰å…¨-é˜²ç«å¢™/","content":"è¿™æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„ä¿¡æ¯ã€‚æ—¢ç„¶ä½ åˆšåˆšä¿®æ”¹äº†é…ç½®å¹¶â€œåªç•™äº†å¯†é’¥ç™»å½•â€ï¼Œé‚£ä¹ˆé—®é¢˜çš„æ€§è´¨å°±å˜äº†ã€‚ ç›®å‰çš„é”™è¯¯ç—‡çŠ¶ï¼ˆConnection closedï¼‰è¡¨æ˜ï¼šé—®é¢˜å¤§æ¦‚ç‡ä¸åœ¨â€œå¯†é’¥ä¸å¯¹â€ï¼Œè€Œåœ¨ä½ ä¿®æ”¹é…ç½®çš„è¿‡ç¨‹ä¸­â€œè¯¯ä¼¤â€äº† SSH æœåŠ¡ï¼Œæˆ–è€…è§¦å‘äº†å®‰å…¨æ‹¦æˆªã€‚ å¦‚æœå¯†é’¥ä»…ä»…æ˜¯ä¸åŒ¹é…ï¼Œä½ ä¼šçœ‹åˆ° Permission denied (publickey)ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿æ¥ä¸­æ–­ã€‚ ä»¥ä¸‹æ˜¯é’ˆå¯¹â€œä¿®æ”¹é…ç½®åæ— æ³•è¿æ¥â€çš„æ’æŸ¥æ€è·¯ï¼ŒæŒ‰å¯èƒ½æ€§æ’åºï¼š 1. æœ€å¯èƒ½çš„åŸå› ï¼šé…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯æˆ–é€»è¾‘å†²çªä½ å¯èƒ½åœ¨ç¼–è¾‘ /etc/ssh/sshd_config æ—¶æ— æ„ä¸­ç•™ä¸‹äº†è¯­æ³•é”™è¯¯ï¼Œæˆ–è€…é…ç½®é¡¹å†™é”™äº†ï¼Œå¯¼è‡´ SSH æœåŠ¡ï¼ˆsshdï¼‰è™½ç„¶ç«¯å£å¼€ç€ï¼Œä½†æ— æ³•æ­£å¸¸å¤„ç†æ¡æ‰‹ã€‚ å¸¸è§è¯¯åŒºï¼šä½ ç”¨çš„æ˜¯ root ç”¨æˆ·ç™»å½•ã€‚ å¦‚æœä½ æŠŠ PermitRootLogin è®¾ç½®ä¸ºäº† noï¼Œé‚£ä¹ˆ root ç”¨æˆ·ä¼šè¢«å½»åº•ç¦æ­¢ç™»å½•ï¼ˆå³ä½¿æœ‰å¯†é’¥ä¹Ÿä¸è¡Œï¼‰ã€‚ æ­£ç¡®è®¾ç½®åº”è¯¥æ˜¯ï¼šPermitRootLogin prohibit-password æˆ– PermitRootLogin without-passwordï¼ˆè¿™è¡¨ç¤ºï¼šç¦æ­¢ root ç”¨å¯†ç ï¼Œä½†å…è®¸ç”¨å¯†é’¥ï¼‰ã€‚ 2. æƒé™è¿‡å®½å¯¼è‡´ SSH è‡ªæˆ‘ä¿æŠ¤ (StrictModes)SSH å¯¹å¯†é’¥æ–‡ä»¶çš„æƒé™è¦æ±‚æé«˜ã€‚å¦‚æœä½ åœ¨é…ç½®å¯†é’¥æ—¶ï¼Œä¸ºäº†çœäº‹æŠŠ /root/.ssh/ ç›®å½•æˆ– /root/.ssh/authorized_keys æ–‡ä»¶çš„æƒé™æ”¹ä¸ºäº† 777ï¼ˆæ‰€æœ‰äººå¯è¯»å†™ï¼‰ï¼ŒSSH ä¼šå› ä¸ºâ€œç”±äºæƒé™å¤ªå¼€æ”¾ï¼Œä¸å®‰å…¨â€è€Œç›´æ¥æ‹’ç»è¯»å–è¿™äº›å¯†é’¥ã€‚ è™½ç„¶è¿™é€šå¸¸å¯¼è‡´ Permission deniedï¼Œä½†åœ¨æŸäº›ä¸¥æ ¼é…ç½®ä¸‹å¯èƒ½è¡¨ç°å¼‚å¸¸ã€‚ 3. ä½ ä»ç„¶è¢« Fail2Ban å…³åœ¨å¤–é¢æ­£å¦‚ä¸Šä¸€ä¸ªå›ç­”æ‰€è¯´ï¼Œå¦‚æœä½ åœ¨æµ‹è¯•é…ç½®è¿‡ç¨‹ä¸­å¤±è´¥å¤šæ¬¡ï¼ŒFail2Ban å¯èƒ½ä¸ç®¡ä½ ç”¨ä»€ä¹ˆæ–¹å¼ç™»å½•ï¼Œç›´æ¥åœ¨é˜²ç«å¢™å±‚æŠŠä½ æ‹¦æˆªäº†ã€‚ å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ VNC Console (æ•‘æ´æ§åˆ¶å°)æ—¢ç„¶ SSH å·²ç»è¿ä¸ä¸Šï¼Œä½ å¿…é¡»é€šè¿‡â€œç‰©ç†æ–¹å¼â€ä»‹å…¥ã€‚è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š ç¬¬ä¸€æ­¥ï¼šç™»å½• VPS æä¾›å•†çš„ç½‘é¡µæ§åˆ¶å°æ— è®ºä½ ç”¨çš„æ˜¯ RackNerd, Bandwagon, Vultr è¿˜æ˜¯ AWSï¼Œç™»å½•ä»–ä»¬çš„å®˜ç½‘åå°ï¼Œæ‰¾åˆ°ä½ çš„æœåŠ¡å™¨ï¼Œç‚¹å‡» â€œVNCâ€, â€œConsoleâ€ æˆ– **â€VNC Consoleâ€**ã€‚ è¿™æ˜¯ä¸€ä¸ªç½‘é¡µç‰ˆçš„å±å¹•ï¼Œå®ƒç›¸å½“äºç›´æ¥æŠŠæ˜¾ç¤ºå™¨æ¥åœ¨äº†æœåŠ¡å™¨ä¸Šï¼Œä¸ä¾èµ– SSH ç½‘ç»œåè®®ã€‚ ç¬¬äºŒæ­¥ï¼šåœ¨æ§åˆ¶å°é‡Œæ£€æŸ¥å¹¶ä¿®å¤åœ¨ç½‘é¡µé»‘æ¡†ä¸­ç™»å½•ï¼ˆè¿™æ—¶ä½ å¯èƒ½éœ€è¦è¾“å…¥ root å¯†ç ï¼Œå¦‚æœä¹‹å‰è®¾è¿‡çš„è¯ï¼‰ã€‚ æ£€æŸ¥ SSH æœåŠ¡çŠ¶æ€ï¼šè¾“å…¥å‘½ä»¤ï¼šsystemctl status sshd å¦‚æœæ˜¯ failed æˆ– activatingï¼ˆä¸€ç›´åœ¨é‡å¯ï¼‰ï¼Œè¯´æ˜é…ç½®æ–‡ä»¶å†™é”™äº†ã€‚2. æµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ï¼šè¾“å…¥å‘½ä»¤ï¼ˆéå¸¸é‡è¦ï¼‰ï¼š sshd -t å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œè¯´æ˜è¯­æ³•æ²¡é—®é¢˜ã€‚ å¦‚æœæœ‰è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼ˆæ¯”å¦‚ line 35: Bad configuration optionï¼‰ï¼Œè¯·æ ¹æ®æç¤ºå»ä¿®æ”¹æ–‡ä»¶ã€‚ æ£€æŸ¥ Root ç™»å½•è®¾ç½®ï¼šè¾“å…¥å‘½ä»¤ç¼–è¾‘é…ç½®ï¼šnano /etc/ssh/sshd_config# æˆ–è€… vi /etc/ssh/sshd_config æ‰¾åˆ° PermitRootLogin è¿™ä¸€è¡Œï¼Œç¡®ä¿å®ƒä¸æ˜¯ noã€‚æ”¹ä¸ºï¼š PermitRootLogin prohibit-password æ£€æŸ¥æ–‡ä»¶æƒé™ï¼šç¡®ä¿æƒé™æ˜¯æ­£ç¡®çš„ï¼ˆä¸¥æ ¼æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼‰ï¼š chmod 700 /root/.sshchmod 600 /root/.ssh/authorized_keyschown -R root:root /root/.ssh æœ€åï¼Œé‡å¯ SSH æœåŠ¡ï¼š systemctl restart sshd åšå®Œè¿™å‡ æ­¥åï¼Œå†å›åˆ°ä½ çš„ Windows ç»ˆç«¯å°è¯• ssh -vvv ... è¿æ¥ã€‚"},{"title":"æœåŠ¡å™¨å®‰å…¨å®Œæ•´æŒ‡å—","path":"/2026/01/13/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-æœåŠ¡å™¨å®‰å…¨-æœåŠ¡å™¨å®‰å…¨å®Œæ•´æŒ‡å—/","content":"æœåŠ¡å™¨æš´éœ²åœ¨å…¬ç½‘ç¯å¢ƒä¸‹ï¼Œé¢ä¸´ç€ç«¯å£æ‰«æã€æš´åŠ›ç ´è§£ã€æµé‡æ»¥ç”¨ç­‰å¤šç§å®‰å…¨å¨èƒã€‚æœ¬æ–‡æ•´åˆäº†é˜²ç«å¢™é…ç½®ã€å…¥ä¾µé˜²å¾¡å’Œèº«ä»½è®¤è¯ä¸‰å¤§æ ¸å¿ƒå®‰å…¨æ‰‹æ®µï¼Œå¸®åŠ©ä½ æ„å»ºå¤šå±‚æ¬¡çš„æœåŠ¡å™¨å®‰å…¨é˜²çº¿ã€‚ ä¸€ã€UFW é˜²ç«å¢™é…ç½®UFW (Uncomplicated Firewall) æ˜¯ Linux ä¸Šè½»é‡çº§çš„é˜²ç«å¢™é…ç½®å·¥å…·ï¼Œç®€åŒ–äº† iptables çš„å¤æ‚æ“ä½œã€‚ åŸºç¡€å‘½ä»¤çŠ¶æ€æŸ¥çœ‹# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€å’Œè§„åˆ™sudo ufw status# è¯¦ç»†æ¨¡å¼ï¼ˆæ˜¾ç¤ºé»˜è®¤ç­–ç•¥å’Œæ—¥å¿—çº§åˆ«ï¼‰sudo ufw status verbose# å¸¦ç¼–å·æ˜¾ç¤ºï¼ˆç”¨äºåˆ é™¤è§„åˆ™ï¼‰sudo ufw status numbered å¯ç”¨ä¸ç¦ç”¨ [!WARNING]å¯ç”¨å‰è¯·ç¡®ä¿å·²å…è®¸ SSH (22 ç«¯å£) è¿æ¥ï¼Œå¦åˆ™å¯èƒ½ä¼šæ–­å¼€æœåŠ¡å™¨è¿æ¥ï¼ # å¯ç”¨é˜²ç«å¢™sudo ufw enable# ç¦ç”¨é˜²ç«å¢™sudo ufw disable# é‡ç½®æ‰€æœ‰è§„åˆ™ï¼ˆæ¢å¤é»˜è®¤è®¾ç½®ï¼‰sudo ufw reset ç«¯å£ä¸æœåŠ¡ç®¡ç†å…è®¸å…¥ç«™è¿æ¥# å…è®¸ç‰¹å®šç«¯å£ (TCP/UDP)sudo ufw allow 22sudo ufw allow 80/tcpsudo ufw allow 443# å…è®¸ç‰¹å®šæœåŠ¡åç§°sudo ufw allow sshsudo ufw allow httpsudo ufw allow https# å…è®¸ç‰¹å®š IP è®¿é—®æ‰€æœ‰ç«¯å£sudo ufw allow from 192.168.1.100# å…è®¸ç‰¹å®š IP è®¿é—®ç‰¹å®šç«¯å£sudo ufw allow from 192.168.1.100 to any port 22 æ‹’ç»å…¥ç«™è¿æ¥# æ‹’ç»è¿æ¥è¯·æ±‚ï¼ˆå¯¹æ–¹æ— å“åº”ï¼‰sudo ufw deny 80sudo ufw deny from 192.168.1.200# æ‹’ç»å¹¶å‘å¯¹æ–¹å‘é€æ‹’ç»å“åº”sudo ufw reject 22 åˆ é™¤è§„åˆ™# 1. æŸ¥çœ‹å¸¦ç¼–å·çš„è§„åˆ™sudo ufw status numbered# 2. æŒ‰ç¼–å·åˆ é™¤ï¼ˆä¾‹å¦‚åˆ é™¤ç¬¬ 3 æ¡è§„åˆ™ï¼‰sudo ufw delete 3# ä¹Ÿå¯ä»¥ç›´æ¥åˆ é™¤è§„åˆ™å®šä¹‰sudo ufw delete allow 80 é«˜çº§é…ç½®é»˜è®¤ç­–ç•¥å»ºè®®è®¾ç½®ä¸ºï¼šæ‹’ç»æ‰€æœ‰å…¥ç«™ï¼Œå…è®¸æ‰€æœ‰å‡ºç«™ sudo ufw default deny incomingsudo ufw default allow outgoing é™åˆ¶è¿æ¥é¢‘ç‡å¯¹äº SSH ç­‰å…³é”®æœåŠ¡ï¼Œä½¿ç”¨ limit é™åˆ¶è¿æ¥é¢‘ç‡ï¼ˆ30 ç§’å†…å°è¯•è¿æ¥ 6 æ¬¡å³æ‹’ç»ï¼‰ï¼š sudo ufw limit ssh# æˆ–è€…sudo ufw limit 22/tcp ç½‘æ®µæ§åˆ¶# å…è®¸å­ç½‘æ®µè®¿é—®ç‰¹å®šç«¯å£sudo ufw allow from 192.168.1.0/24 to any port 8080 æ—¥å¿—ç®¡ç†# å¼€å¯/å…³é—­æ—¥å¿—è®°å½•sudo ufw logging onsudo ufw logging off# æ—¥å¿—ä½ç½®ï¼š/var/log/ufw.log å¸¸è§åœºæ™¯é…ç½®Web æœåŠ¡å™¨sudo ufw default deny incomingsudo ufw default allow outgoingsudo ufw limit sshsudo ufw allow 80/tcpsudo ufw allow 443/tcpsudo ufw enable æ•°æ®åº“æœåŠ¡å™¨ï¼ˆä»…å…è®¸ç‰¹å®šå†…ç½‘ IPï¼‰# å…è®¸ Web æœåŠ¡å™¨ (10.0.0.5) è®¿é—® MySQL (3306)sudo ufw allow from 10.0.0.5 to any port 3306 SSH ç™½åå•æ–¹æ¡ˆé€‚ç”¨äºå›ºå®š IP åœºæ™¯ï¼ˆå…¬å¸ã€å®¶åº­ï¼‰ï¼š # ç§»é™¤åŸæœ‰çš„ limit è§„åˆ™sudo ufw delete limit 22/tcp# æ·»åŠ ç™½åå•sudo ufw allow from YOUR_IP_ADDRESS to any port 22 proto tcp# æ‹’ç»å…¶ä»– SSH è¿æ¥sudo ufw deny 22/tcp# éªŒè¯è§„åˆ™sudo ufw status numbered è¢«é”å®šåçš„æ¢å¤å¦‚æœå› é™é€Ÿè§„åˆ™è¢«é”åœ¨å¤–é¢ï¼Œéœ€è¦é€šè¿‡æ§åˆ¶å°KVM è®¿é—®æœåŠ¡å™¨ï¼š sudo ufw resetsudo ufw default deny incomingsudo ufw default allow outgoingsudo ufw allow sshsudo ufw enable äºŒã€Fail2ban å…¥ä¾µé˜²å¾¡Fail2ban å¯ä»¥è‡ªåŠ¨ç›‘æ§æ—¥å¿—æ–‡ä»¶ï¼Œå‘ç°æš´åŠ›ç ´è§£ç­‰æ¶æ„è¡Œä¸ºåè‡ªåŠ¨å°ç¦ IPï¼Œæ˜¯é˜²å¾¡ SSH çˆ†ç ´çš„æœ€å®ç”¨æ–¹æ¡ˆã€‚ å®‰è£…ä¸å¯ç”¨# å®‰è£…sudo apt updatesudo apt install fail2ban# å¯ç”¨è‡ªå¯åŠ¨sudo systemctl enable fail2bansudo systemctl start fail2ban# æŸ¥çœ‹çŠ¶æ€sudo systemctl status fail2ban é…ç½®åˆ›å»ºæœ¬åœ°é…ç½®æ–‡ä»¶# å¤åˆ¶é»˜è®¤é…ç½®ï¼ˆä¸è¦ç›´æ¥ä¿®æ”¹ jail.confï¼‰sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local# ç¼–è¾‘é…ç½®sudo nano /etc/fail2ban/jail.local æ ¸å¿ƒé…ç½®é¡¹åœ¨ [DEFAULT] éƒ¨åˆ†ä¿®æ”¹ï¼š [DEFAULT]bantime = 3600findtime = 600maxretry = 3[sshd]enabled = trueport = sshfilter = sshdlogpath = /var/log/auth.log å‚æ•°è¯´æ˜ï¼š bantimeï¼šIP è¢«å°ç¦çš„æ—¶é•¿ï¼Œ3600 ç§’ findtimeï¼šåœ¨æ­¤æ—¶é—´çª—å£å†…ç»Ÿè®¡å¤±è´¥æ¬¡æ•°ï¼Œ600 ç§’ maxretryï¼šè¾¾åˆ°æ­¤æ¬¡æ•°åè§¦å‘å°ç¦ï¼Œ3 æ¬¡ å¸¸ç”¨å‘½ä»¤# æŸ¥çœ‹ SSH æœåŠ¡çš„å°ç¦çŠ¶æ€sudo fail2ban-client status sshd# æ‰‹åŠ¨è§£é™¤ IP å°ç¦sudo fail2ban-client set sshd unbanip YOUR_IP# æŸ¥çœ‹ fail2ban æ—¥å¿—sudo tail -f /var/log/fail2ban.log æ•…éšœæ’æŸ¥å¦‚æœ fail2ban æ— æ³•å¯åŠ¨ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç²¾ç¡®é”™è¯¯åŸå› ï¼š # å‰å°å¯åŠ¨ï¼Œæ˜¾ç¤ºè¯¦ç»†é”™è¯¯fail2ban-client -x start# æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•fail2ban-client -t ä¸‰ã€SSH å¯†é’¥è®¤è¯å¯†é’¥è®¤è¯æ˜¯æœ€å®‰å…¨çš„ SSH è®¤è¯æ–¹å¼ï¼Œå¯ä»¥å½»åº•æ¶ˆé™¤å¯†ç çˆ†ç ´å¨èƒã€‚ ç”Ÿæˆå¯†é’¥å¯¹åœ¨æœ¬åœ°æœºå™¨ä¸Šæ‰§è¡Œï¼š # ç”Ÿæˆ RSA 4096 ä½å¯†é’¥ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa éƒ¨ç½²å…¬é’¥åˆ°æœåŠ¡å™¨# æ–¹æ³•ä¸€ï¼šä½¿ç”¨ ssh-copy-idï¼ˆæ¨èï¼‰ssh-copy-id -i ~/.ssh/id_rsa.pub user@server# æ–¹æ³•äºŒï¼šæ‰‹åŠ¨æ·»åŠ # åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œmkdir -p ~/.sshchmod 700 ~/.ssh# å°†æœ¬åœ° ~/.ssh/id_rsa.pub çš„å†…å®¹è¿½åŠ åˆ°æœåŠ¡å™¨çš„ ~/.ssh/authorized_keyschmod 600 ~/.ssh/authorized_keys é…ç½® SSH æœåŠ¡å™¨sudo nano /etc/ssh/sshd_config ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š PasswordAuthentication no # ç¦ç”¨å¯†ç è®¤è¯PubkeyAuthentication yes # å¯ç”¨å¯†é’¥è®¤è¯PermitRootLogin no # ç¦ç”¨ root ç™»å½•Port 2222 # æ”¹ä¸ºéæ ‡å‡†ç«¯å£ï¼ˆå¯é€‰ï¼‰ ä¿å­˜åé‡å¯ SSHï¼š sudo systemctl restart sshd [!CAUTION]ç¦ç”¨å¯†ç è®¤è¯å‰ï¼Œè¯·ç¡®ä¿å¯†é’¥ç™»å½•å·²æµ‹è¯•æˆåŠŸï¼Œå¦åˆ™å¯èƒ½æ°¸ä¹…ä¸¢å¤±æœåŠ¡å™¨è®¿é—®æƒé™ï¼ SSH å¸¸è§æ•…éšœæ’æŸ¥ä¿®æ”¹ SSH é…ç½®åæ— æ³•è¿æ¥æ˜¯å¸¸è§é—®é¢˜ï¼Œä»¥ä¸‹æ˜¯æŒ‰å¯èƒ½æ€§æ’åºçš„æ’æŸ¥æ€è·¯ã€‚ ç—‡çŠ¶åˆ¤æ–­ **Permission denied (publickey)**ï¼šå¯†é’¥ä¸åŒ¹é…æˆ–æœªæ­£ç¡®éƒ¨ç½² **Connection closed**ï¼šé…ç½®é”™è¯¯æˆ–è¢«å®‰å…¨æœºåˆ¶æ‹¦æˆª å¸¸è§åŸå› 1. é…ç½®æ–‡ä»¶è¯­æ³•æˆ–é€»è¾‘é”™è¯¯ å¦‚æœä½¿ç”¨ root ç”¨æˆ·ç™»å½•ï¼Œæ³¨æ„ PermitRootLogin çš„è®¾ç½®ï¼š PermitRootLogin noï¼šå®Œå…¨ç¦æ­¢ root ç™»å½•ï¼ˆå³ä½¿æœ‰å¯†é’¥ä¹Ÿä¸è¡Œï¼‰ PermitRootLogin prohibit-passwordï¼šç¦æ­¢å¯†ç ï¼Œå…è®¸å¯†é’¥ï¼ˆæ¨èï¼‰ 2. æƒé™è¿‡å®½è§¦å‘ SSH è‡ªæˆ‘ä¿æŠ¤ SSH å¯¹å¯†é’¥æ–‡ä»¶æƒé™è¦æ±‚ä¸¥æ ¼ï¼Œæƒé™è¿‡å®½ï¼ˆå¦‚ 777ï¼‰ä¼šå¯¼è‡´æ‹’ç»è¯»å–ï¼š # æ­£ç¡®çš„æƒé™è®¾ç½®chmod 700 ~/.sshchmod 600 ~/.ssh/authorized_keyschown -R $(whoami):$(whoami) ~/.ssh 3. Fail2ban è¯¯å° æµ‹è¯•é…ç½®è¿‡ç¨‹ä¸­å¤šæ¬¡å¤±è´¥å¯èƒ½è§¦å‘ Fail2ban å°ç¦ï¼Œå‚è€ƒå‰æ–‡â€Fail2ban å…¥ä¾µé˜²å¾¡â€ç« èŠ‚è§£å°ã€‚ VNC æ§åˆ¶å°æ•‘æ´å½“ SSH å®Œå…¨æ— æ³•è¿æ¥æ—¶ï¼Œéœ€è¦é€šè¿‡ VPS æä¾›å•†çš„ VNCConsole åŠŸèƒ½ä»‹å…¥ï¼š ç™»å½• VPS æ§åˆ¶å°ï¼šåœ¨æä¾›å•†ç½‘é¡µåå°æ‰¾åˆ° VNC æˆ– Console å…¥å£ æ£€æŸ¥ SSH æœåŠ¡çŠ¶æ€ï¼š systemctl status sshd æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•ï¼š sshd -t # æ— è¾“å‡ºè¡¨ç¤ºè¯­æ³•æ­£ç¡® ä¿®å¤é…ç½®å¹¶é‡å¯ï¼š nano /etc/ssh/sshd_config # æ ¹æ® sshd -t è¾“å‡ºä¿®å¤é”™è¯¯systemctl restart sshd å››ã€ç›‘æ§ä¸æ—¥å¿—åˆ†æå®æ—¶ç›‘æ§# å®æ—¶æŸ¥çœ‹ SSH ç™»å½•å°è¯•sudo tail -f /var/log/auth.log | grep sshd# ç»Ÿè®¡å¤±è´¥ç™»å½•æ¬¡æ•°sudo grep Failed password /var/log/auth.log | wc -l# æŸ¥çœ‹æœ€è¿‘å°è¯•çš„ IPï¼ˆæŒ‰æ¬¡æ•°æ’åºï¼‰sudo grep Failed password /var/log/auth.log | awk print $(NF-3) | sort | uniq -c | sort -rn æµé‡ç›‘æ§# å®‰è£… vnstatapt install vnstat# æŸ¥çœ‹æµé‡ç»Ÿè®¡vnstat -d # æŒ‰å¤©vnstat -h # æŒ‰å°æ—¶ ç½‘ç»œè¿æ¥åˆ†æ# æŸ¥çœ‹å½“å‰æ‰€æœ‰ç½‘ç»œè¿æ¥netstat -antp# æˆ–ss -antp# ç»Ÿè®¡ç‰¹å®šç«¯å£çš„è¿æ¥ IPnetstat -antp | grep 7890 | awk print $5 | cut -d: -f1 | sort | uniq -c | sort -rn | head -20 å…¥ä¾µæ£€æŸ¥# æ£€æŸ¥å¯ç–‘ç”¨æˆ·cat /etc/passwd# æ£€æŸ¥è®¡åˆ’ä»»åŠ¡crontab -lcat /etc/crontab# æ£€æŸ¥æœ€è¿‘ç™»å½•è®°å½•lastlastb# æ£€æŸ¥å¯ç–‘è¿›ç¨‹ps auxps aux --sort=-%cpu | head -10 äº”ã€å®æˆ˜æ¡ˆä¾‹ï¼šClash ä»£ç†æš´éœ²å…¬ç½‘è¿™æ˜¯ä¸€ä¸ªçœŸå®çš„å®‰å…¨äº‹æ•…æ¡ˆä¾‹ï¼Œè®°å½•äº†å› ä»£ç†æœåŠ¡é…ç½®ä¸å½“å¯¼è‡´æœåŠ¡å™¨è¢«æ»¥ç”¨çš„æ’æŸ¥è¿‡ç¨‹ã€‚ é—®é¢˜ç°è±¡ å‡ºç«™æµé‡ä»æ¯å¤©å‡ ç™¾ MB æš´å¢åˆ°å‡ å GB CPU å ç”¨æŒç»­ 100% å…¶ä»–æœåŠ¡å“åº”å˜æ…¢ç”šè‡³è¶…æ—¶ æ ¹å› åˆ†ææ£€æŸ¥ Clash é…ç½®æ–‡ä»¶å‘ç°ï¼š port: 7890socks-port: 7891allow-lan: true # é—®é¢˜æ‰€åœ¨ï¼external-controller: 0.0.0.0:9090 # ç®¡ç†æ¥å£æš´éœ² é—®é¢˜å‡ºåœ¨ï¼š **allow-lan: true**ï¼šæœåŠ¡å™¨æœ‰å…¬ç½‘ IP æ—¶ï¼Œâ€å±€åŸŸç½‘â€å˜æˆäº†æ•´ä¸ªäº’è”ç½‘ ç®¡ç†æ¥å£ç»‘å®š 0.0.0.0ï¼šå¤–ç½‘å¯ç›´æ¥è®¿é—®æ§åˆ¶é¢æ¿ é˜²ç«å¢™å®‰å…¨ç»„æ”¾è¡Œäº†ä»£ç†ç«¯å£ è§£å†³æ–¹æ¡ˆä¿®æ”¹ Clash é…ç½®port: 7890socks-port: 7891allow-lan: false # å…³é—­å±€åŸŸç½‘è®¿é—®external-controller: 127.0.0.1:9090 # åªç»‘å®šæœ¬åœ° é˜²ç«å¢™é™åˆ¶# ä½¿ç”¨ iptables åªå…è®¸æœ¬åœ°è®¿é—®iptables -A INPUT -p tcp --dport 7890 -s 127.0.0.1 -j ACCEPTiptables -A INPUT -p tcp --dport 7890 -j DROPiptables -A INPUT -p tcp --dport 7891 -s 127.0.0.1 -j ACCEPTiptables -A INPUT -p tcp --dport 7891 -j DROPiptables -A INPUT -p tcp --dport 9090 -s 127.0.0.1 -j ACCEPTiptables -A INPUT -p tcp --dport 9090 -j DROP# ä¿å­˜è§„åˆ™iptables-save /etc/iptables.rules # Debian/Ubuntuservice iptables save # CentOS äº‘å®‰å…¨ç»„åœ¨äº‘æœåŠ¡å•†æ§åˆ¶å°ç¡®ä¿ä»¥ä¸‹ç«¯å£ä¸å¯¹å…¬ç½‘å¼€æ”¾ï¼š 7890ï¼ˆHTTP ä»£ç†ç«¯å£ï¼‰ 7891ï¼ˆSOCKS5 ä»£ç†ç«¯å£ï¼‰ 9090ï¼ˆç®¡ç†æ¥å£ç«¯å£ï¼‰ ç»éªŒæ•™è®­ æœåŠ¡å™¨ä¸Šè·‘ä»£ç†æœåŠ¡è¦æ ¼å¤–å°å¿ƒï¼šç¡®è®¤åªç›‘å¬æœ¬åœ°åœ°å€ é˜²ç«å¢™é…ç½®è¦ç²¾ç»†åŒ–ï¼šä¸è¦æ”¾è¡Œå¤§èŒƒå›´ç«¯å£ å®šæœŸæ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€ï¼šç›‘æ§æµé‡ã€CPUã€è¿æ¥æ•° å®‰å…¨ç»„æ˜¯ç¬¬ä¸€é“é˜²çº¿ï¼šäº‘æœåŠ¡å™¨çš„å®‰å…¨ç»„è§„åˆ™è¦é…ç½®å¥½ å…­ã€å®‰å…¨åŠ å›ºä¼˜å…ˆçº§æ ¹æ®å®é™…æƒ…å†µï¼Œå»ºè®®æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§å®æ–½ï¼š é˜¶æ®µ æ—¶é—´ è¡ŒåŠ¨é¡¹ ç«‹å³ ä»Šå¤© å¯ç”¨ UFW é»˜è®¤æ‹’ç»ç­–ç•¥ï¼Œåªå¼€æ”¾å¿…è¦ç«¯å£ çŸ­æœŸ æœ¬å‘¨ å®‰è£…å¹¶é…ç½® Fail2ban è‡ªåŠ¨é˜²æŠ¤ ä¸­æœŸ æœ¬æœˆ éƒ¨ç½² SSH å¯†é’¥è®¤è¯ï¼Œç¦ç”¨å¯†ç ç™»å½• æŒç»­ å¸¸æ€ å®šæœŸæ›´æ–°ç³»ç»Ÿè¡¥ä¸ï¼Œç›‘æ§æ—¥å¿—ï¼Œè€ƒè™‘ VPN è®¿é—® SSH ä¸ƒã€å¿«é€Ÿæ£€æŸ¥æ¸…å•åœ¨éƒ¨ç½²æ–°æœåŠ¡å™¨æˆ–å®¡è®¡ç°æœ‰æœåŠ¡å™¨æ—¶ï¼Œå¯å‚è€ƒä»¥ä¸‹æ¸…å•ï¼š UFW å·²å¯ç”¨ä¸”é»˜è®¤ç­–ç•¥ä¸ºæ‹’ç»å…¥ç«™ åªå¼€æ”¾äº†å¿…è¦ç«¯å£ï¼ˆSSHã€Web ç­‰ï¼‰ SSH ä½¿ç”¨éæ ‡å‡†ç«¯å£æˆ–é…ç½®äº†è®¿é—®é™åˆ¶ Fail2ban å·²å®‰è£…å¹¶æ­£å¸¸è¿è¡Œ SSH å·²å¯ç”¨å¯†é’¥è®¤è¯ å·²ç¦ç”¨ SSH å¯†ç ç™»å½• å·²ç¦ç”¨ root ç›´æ¥ç™»å½• äº‘å®‰å…¨ç»„è§„åˆ™ä¸æœ¬åœ°é˜²ç«å¢™è§„åˆ™ä¸€è‡´ æ—¥å¿—ç›‘æ§å·²é…ç½®ï¼ˆauth.logã€ufw.logã€fail2ban.logï¼‰","tags":["æœåŠ¡å™¨","å®‰å…¨","UFW","Fail2ban","SSH"],"categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨","æœåŠ¡å™¨å®‰å…¨"]},{"title":"åå‘ä»£ç†","path":"/2026/01/13/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-åå‘ä»£ç†/","content":"è¿™æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„éœ€æ±‚ï¼Œé€šå¸¸æˆ‘ä»¬ç§°ä¹‹ä¸ºåå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æˆ–åŸºäºè·¯å¾„çš„è·¯ç”±ï¼ˆPath-based Routingï¼‰ã€‚ å®ç°è¿™ä¸ªç›®æ ‡ï¼Œæœ€æˆç†Ÿä¸”æ ‡å‡†çš„å·¥å…·æ˜¯ Nginxã€‚ ä»¥ä¸‹æ˜¯å®ç°è¿™ä¸€ç›®æ ‡çš„å…·ä½“æ­¥éª¤ï¼Œæ¶µç›–äº†æ–‡ä»¶å‡†å¤‡ã€Nginx é…ç½®ä»¥åŠæœ€å®¹æ˜“è¸©å‘çš„â€œèµ„æºè·¯å¾„â€é—®é¢˜ã€‚ 1. æ ¸å¿ƒæ€è·¯å‡è®¾ä½ çš„åŸŸåæ˜¯ www.example.comï¼Œæˆ‘ä»¬è¦å®ç°ï¼š è®¿é—® https://www.example.com/site1 - æŒ‡å‘æœåŠ¡å™¨ä¸Šçš„ /var/www/site1 ç›®å½• è®¿é—® https://www.example.com/site2 - æŒ‡å‘æœåŠ¡å™¨ä¸Šçš„ /var/www/site2 ç›®å½• è®¿é—® https://www.example.com/site3 - æŒ‡å‘æœåŠ¡å™¨ä¸Šçš„ /var/www/site3 ç›®å½• 2. å‡†å¤‡å·¥ä½œé¦–å…ˆï¼Œåœ¨ä½ çš„æœåŠ¡å™¨ä¸Šåˆ›å»ºå­˜æ”¾è¿™ä¸‰ä¸ªç½‘é¡µæ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸Šä¼ ä½ çš„ä»£ç ï¼ˆHTMLCSSJSï¼‰ã€‚ Bash # ç¤ºä¾‹å‘½ä»¤mkdir -p /var/www/site1mkdir -p /var/www/site2mkdir -p /var/www/site3# ç¡®ä¿ Nginx æœ‰æƒé™è¯»å–è¿™äº›æ–‡ä»¶chown -R www-data:www-data /var/www/chmod -R 755 /var/www/ 3. Nginx é…ç½® (æ ¸å¿ƒæ­¥éª¤)ä½ éœ€è¦ä¿®æ”¹ Nginx çš„é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸ä½äº /etc/nginx/sites-available/default æˆ– /etc/nginx/nginx.confï¼‰ã€‚ è¿™é‡Œä½¿ç”¨ alias æŒ‡ä»¤å°† URL è·¯å¾„æ˜ å°„åˆ°æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚ Nginx server listen 443 ssl; server_name www.example.com; # æ¢æˆä½ çš„åŸŸå # SSL è¯ä¹¦é…ç½® (Certbot ç”Ÿæˆçš„è·¯å¾„) ssl_certificate /etc/letsencrypt/live/www.example.com/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/www.example.com/privkey.pem; # --- ç½‘ç«™ 1 --- location /site1 alias /var/www/site1; # å…³é”®ç‚¹ï¼šä½¿ç”¨ alias æŒ‡å‘å®é™…ç›®å½• index index.html; try_files $uri $uri/ /site1/index.html; # é˜²æ­¢åˆ·æ–° 404 (å¦‚æœæ˜¯å•é¡µåº”ç”¨ SPA) # --- ç½‘ç«™ 2 --- location /site2 alias /var/www/site2; index index.html; try_files $uri $uri/ /site2/index.html; # --- ç½‘ç«™ 3 --- location /site3 alias /var/www/site3; index index.html; try_files $uri $uri/ /site3/index.html; # å»ºè®®ä¿ç•™ä¸€ä¸ª HTTP 80 è·³è½¬åˆ° HTTPS çš„é…ç½®server listen 80; server_name www.example.com; return 301 https://$host$request_uri; ä¿®æ”¹å®Œæˆåï¼Œæµ‹è¯•å¹¶é‡å¯ Nginxï¼š Bash nginx -t # æ£€æŸ¥é…ç½®è¯­æ³•æ˜¯å¦æ­£ç¡®systemctl reload nginx # é‡è½½é…ç½® 4. âš ï¸ æœ€å®¹æ˜“é‡åˆ°çš„å‘ï¼šBase URLï¼ˆèµ„æºè·¯å¾„ï¼‰å½“ä½ æŠŠç½‘é¡µéƒ¨ç½²åœ¨å­è·¯å¾„ï¼ˆå¦‚ /site1ï¼‰ä¸‹æ—¶ï¼ŒHTML ä»£ç é‡Œå¼•ç”¨çš„ CSSã€JS æˆ–å›¾ç‰‡è·¯å¾„éå¸¸å®¹æ˜“å‡ºé”™ï¼Œå¯¼è‡´é¡µé¢æ ·å¼ä¸¢å¤±ï¼ˆç™½å±æˆ–ä¹±ç ï¼‰ã€‚ é”™è¯¯ç¤ºèŒƒï¼šå¦‚æœä½ çš„ HTML å†™çš„æ˜¯ç»å¯¹è·¯å¾„ï¼š HTML link rel=stylesheet href=/style.css è§£å†³æ–¹æ¡ˆ Aï¼šä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆç®€å•é™æ€é¡µï¼‰å¦‚æœä½ çš„ç½‘é¡µåªæ˜¯ç®€å•çš„ HTML æ–‡ä»¶ï¼š HTML link rel=stylesheet href=./style.csslink rel=stylesheet href=style.css è§£å†³æ–¹æ¡ˆ Bï¼šé…ç½® Base Tagï¼ˆæ¨èï¼‰åœ¨ HTML çš„ head éƒ¨åˆ†æ·»åŠ  base æ ‡ç­¾ï¼š HTML head base href=/site1/ link rel=stylesheet href=style.css /head è§£å†³æ–¹æ¡ˆ Cï¼šå‰ç«¯æ¡†æ¶æ‰“åŒ…é…ç½®ï¼ˆVueReactï¼‰å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Vueã€React ç­‰æ¡†æ¶ï¼Œå¿…é¡»åœ¨æ‰“åŒ…å‰ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š Vite (VueReact): ä¿®æ”¹ vite.config.js JavaScript export default defineConfig( base: /site1/, // è¿™é‡Œè¦å’Œ Nginx çš„ location åå­—ä¸€è‡´) Create React App (Webpack): ä¿®æ”¹ package.json JSON homepage: /site1, 5. æ€»ç»“ æœåŠ¡å™¨ç«¯ï¼šä½¿ç”¨ Nginx çš„ location é…åˆ alias æŒ‡ä»¤æ¥åŒºåˆ†ä¸åŒçš„æ–‡ä»¶å¤¹ã€‚ ä»£ç ç«¯ï¼šç¡®ä¿ä½ çš„ç½‘é¡µèµ„æºå¼•ç”¨ï¼ˆCSSJSï¼‰æ˜¯åŸºäºå­è·¯å¾„çš„ï¼ˆå³è®¾ç½® Base URLï¼‰ï¼Œå¦åˆ™æµè§ˆå™¨æ‰¾ä¸åˆ°èµ„æºæ–‡ä»¶ã€‚ æ‚¨ç›®å‰ä½¿ç”¨çš„æ˜¯çº¯é™æ€ HTML è¿˜æ˜¯åƒ VueReact è¿™æ ·çš„å‰ç«¯æ¡†æ¶ï¼Ÿ å¦‚æœæ‚¨å‘Šè¯‰æˆ‘å…·ä½“çš„æŠ€æœ¯æ ˆï¼Œæˆ‘å¯ä»¥å‘Šè¯‰æ‚¨å¦‚ä½•ä¿®æ”¹ä»£ç ä»¥é€‚é…è¿™ç§è·¯å¾„éƒ¨ç½²ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨"]},{"title":"Qt äº‹ä»¶å¤„ç†æœºåˆ¶è¯¦è§£","path":"/2026/01/10/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qt-äº‹ä»¶å¤„ç†/","content":"Qt äº‹ä»¶å¤„ç†æœºåˆ¶è¯¦è§£Qt äº‹ä»¶å¤„ç†æœºåˆ¶æ˜¯æ„å»ºäº¤äº’å¼åº”ç”¨ç¨‹åºçš„åŸºçŸ³ã€‚æœ¬æ–‡ä»äº‹ä»¶ç³»ç»Ÿçš„åº•å±‚åŸç†å‡ºå‘ï¼Œé€æ­¥è®²è§£äº‹ä»¶åˆ†å‘ã€è¿‡æ»¤å’Œå¤„ç†çš„å®Œæ•´æµç¨‹ã€‚ ä¸€ã€QEvent äº‹ä»¶ä½“ç³»1.1 QEvent ç±»æ¦‚è¿°QEvent æ˜¯ Qt æ¡†æ¶ä¸­æ‰€æœ‰äº‹ä»¶ç±»çš„åŸºç±»ï¼Œè´Ÿè´£å°è£…äº‹ä»¶å‚æ•°ã€‚Qt ä¸»äº‹ä»¶å¾ªç¯é€šè¿‡ QCoreApplication::exec() å¯åŠ¨ï¼Œä»äº‹ä»¶é˜Ÿåˆ—è·å–æœ¬åœ°çª—å£ç³»ç»Ÿäº‹ä»¶ï¼Œè½¬æ¢ä¸º QEvent å¯¹è±¡ååˆ†å‘ç»™ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ã€‚ äº‹ä»¶è·å–ä¸åˆ†å‘çš„ä¸¤ç§æ–¹å¼ï¼š æ–¹å¼ å‡½æ•° spontaneous() è¿”å›å€¼ é€‚ç”¨åœºæ™¯ è‡ªåŠ¨å¤„ç† çª—å£ç³»ç»Ÿäº‹ä»¶ true ç”¨æˆ·äº¤äº’äº§ç”Ÿçš„äº‹ä»¶ æ‰‹åŠ¨å‘é€ QApplication::sendEvent() false åŒæ­¥å‘é€ï¼Œç«‹å³å¤„ç† æ‰‹åŠ¨å‘é€ QApplication::postEvent() false å¼‚æ­¥å‘é€ï¼ŒåŠ å…¥äº‹ä»¶é˜Ÿåˆ— QObject é€šè¿‡ event() å‡½æ•°æ¥æ”¶äº‹ä»¶ã€‚å­ç±»å¯é‡å†™æ­¤å‡½æ•°ä»¥å¤„ç†è‡ªå®šä¹‰äº‹ä»¶ã€‚QWidget ç±»å·²é‡è½½ event() æ¥å¤„ç†ç‰¹å®šçš„çª—å£äº‹ä»¶ã€‚ 1.2 QEvent çš„ç»“æ„å±‚æ¬¡åŸºç¡€ QEvent ä»…åŒ…å«äº‹ä»¶ç±»å‹å‚æ•°ï¼Œè€Œå­ç±»æºå¸¦é¢å¤–çš„äº‹ä»¶æè¿°ä¿¡æ¯ï¼š äº‹ä»¶å­ç±» é™„åŠ å‚æ•° QMouseEvent é¼ æ ‡ä½ç½®ã€æŒ‰é’®çŠ¶æ€ QKeyEvent é”®ç ã€ä¿®é¥°é”®çŠ¶æ€ QWheelEvent æ»šè½®å¢é‡ã€æ–¹å‘ QResizeEvent æ–°æ—§å°ºå¯¸ä¿¡æ¯ 1.3 äº‹ä»¶å¤„ç†å™¨çš„è®¾è®¡åŸç†Qt é‡‡ç”¨åˆ†å±‚äº‹ä»¶å¤„ç†æ¶æ„ï¼Œé¿å…å•ä¸€å¤„ç†å™¨çš„è‡ƒè‚¿é—®é¢˜ï¼š flowchart TD A[çª—å£ç³»ç»Ÿäº‹ä»¶] -- B[QCoreApplication::exec] B -- C[äº‹ä»¶è½¬æ¢ä¸º QEvent] C -- D[QObject::event] D -- Eäº‹ä»¶ç±»å‹åˆ†å‘ E --|KeyPress| F[keyPressEvent] E --|MousePress| G[mousePressEvent] E --|Paint| H[paintEvent] E --|å…¶ä»–| I[å¯¹åº”äº‹ä»¶å¤„ç†å™¨] è®¾è®¡ä¼˜åŠ¿ï¼š å„äº‹ä»¶ç±»å‹å¯¹åº”ç‹¬ç«‹çš„äº‹ä»¶å¤„ç†å™¨ï¼ŒèŒè´£å•ä¸€ æ”¯æŒæ·»åŠ è‡ªå®šä¹‰äº‹ä»¶ç±»å‹ï¼Œæ— éœ€ä¿®æ”¹ Qt æºç  å¼€å‘è€…å¯é€‰æ‹©é‡è½½ event() å‡½æ•°æˆ–ç‰¹å®šäº‹ä»¶å¤„ç†å™¨ äº‹ä»¶åˆ†å‘ç¤ºä¾‹ï¼š å½“ QWidget äº§ç”Ÿ QPaintEvent äº‹ä»¶æ—¶ï¼ŒQWidget::event() å°†è¯¥äº‹ä»¶åˆ†å‘ç»™ QWidget::paintEvent() å¤„ç†å™¨å®Œæˆç»‘ã€‚ äºŒã€event() å‡½æ•°ä¸äº‹ä»¶å¤„ç†å™¨2.1 é‡è½½ event() å‡½æ•°é€šè¿‡é‡è½½ event() å‡½æ•°ï¼Œå¯åœ¨äº‹ä»¶åˆ†å‘å‰ç»Ÿä¸€å¤„ç†ç‰¹å®šäº‹ä»¶ã€‚ä»¥ä¸‹ç¤ºä¾‹å®ç° Tab é”®ç¼©è¿›åŠŸèƒ½ï¼š bool MyWidget::event(QEvent *event) if (event-type() == QEvent::KeyPress) QKeyEvent *keyEvent = static_castQKeyEvent*(event); if (keyEvent-key() == Qt::Key_Tab) insertCurrentPosition(\\t); return true; // äº‹ä»¶å·²å¤„ç†ï¼Œé˜»æ­¢ç»§ç»­ä¼ é€’ return QWidget::event(event); // å…¶ä»–äº‹ä»¶ä¼ é€’ç»™çˆ¶ç±»å¤„ç† è¿”å›å€¼å«ä¹‰ï¼š trueï¼šäº‹ä»¶å·²å¤„ç†ï¼Œåœæ­¢ä¼ é€’ falseï¼šäº‹ä»¶æœªå¤„ç†ï¼Œç»§ç»­ä¼ é€’ç»™çˆ¶ç±» 2.2 é‡è½½ç‰¹å®šäº‹ä»¶å¤„ç†å™¨å¯¹äºå•ä¸€äº‹ä»¶ç±»å‹çš„å¤„ç†ï¼Œç›´æ¥é‡è½½å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨æ›´ä¸ºç®€æ´ã€‚ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨ç©ºæ ¼é”®æ›¿ä»£ Tab é”®åˆ‡æ¢ç„¦ç‚¹ï¼š void MyLineEdit::keyPressEvent(QKeyEvent *event) if (event-key() == Qt::Key_Space) focusNextChild(); // åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå­æ§ä»¶ else QLineEdit::keyPressEvent(event); // æœªå¤„ç†çš„äº‹ä»¶äº¤ç»™çˆ¶ç±» é€‰æ‹©å»ºè®®ï¼š åœºæ™¯ æ¨èæ–¹å¼ å¤„ç†å¤šç§äº‹ä»¶ç±»å‹ é‡è½½ event() å¤„ç†å•ä¸€äº‹ä»¶ç±»å‹ é‡è½½ç‰¹å®šäº‹ä»¶å¤„ç†å™¨ äº‹ä»¶é¢„å¤„ç†æ‹¦æˆª é‡è½½ event() ä¸‰ã€äº‹ä»¶è¿‡æ»¤å™¨äº‹ä»¶è¿‡æ»¤å™¨å…è®¸åœ¨äº‹ä»¶åˆ°è¾¾ç›®æ ‡å¯¹è±¡å‰è¿›è¡Œæ‹¦æˆªå¤„ç†ï¼Œæ˜¯å®ç°è·¨æ§ä»¶äº‹ä»¶ç›‘å¬çš„æœ‰æ•ˆæ‰‹æ®µã€‚ 3.1 å®‰è£…äº‹ä»¶è¿‡æ»¤å™¨é€šè¿‡ installEventFilter() ä¸ºç›®æ ‡å¯¹è±¡å®‰è£…è¿‡æ»¤å™¨ï¼š // å¤´æ–‡ä»¶å£°æ˜bool eventFilter(QObject *obj, QEvent *e);// æ„é€ å‡½æ•°ä¸­å®‰è£…Xxx::Xxx() combox = new QComboBox(this); combox-installEventFilter(this); // ä¸º combox æœ¬èº«å®‰è£…è¿‡æ»¤å™¨ combox-view()-installEventFilter(this); // ä¸ºä¸‹æ‹‰è§†å›¾å®‰è£…è¿‡æ»¤å™¨ æ³¨æ„äº‹é¡¹ï¼š ä¸€ä¸ªå¯¹è±¡å¯å®‰è£…å¤šä¸ªäº‹ä»¶è¿‡æ»¤å™¨ï¼Œåå®‰è£…çš„å…ˆæ‰§è¡Œ è¿‡æ»¤å™¨å¯¹è±¡å¿…é¡»ä¸ç›®æ ‡å¯¹è±¡åœ¨åŒä¸€çº¿ç¨‹ 3.2 å®ç° eventFilter() å‡½æ•°äº‹ä»¶è¿‡æ»¤å™¨çš„æ ¸å¿ƒæ˜¯é‡å†™ eventFilter() å‡½æ•°ï¼š bool TimeWindows::eventFilter(QObject *obj, QEvent *e) if (e-type() == QEvent::KeyRelease) QKeyEvent *keyEvent = static_castQKeyEvent *(e); if (obj == combox-view()) if (keyEvent-key() == Qt::Key_Up) handleUpKey(); return true; // äº‹ä»¶å·²å¤„ç† else if (obj == combox) if (keyEvent-key() == Qt::Key_Y) handleYKey(); return true; return QObject::eventFilter(obj, e); // æœªå¤„ç†çš„äº‹ä»¶ç»§ç»­ä¼ é€’ 3.3 äº‹ä»¶è¿‡æ»¤å™¨ vs é‡è½½äº‹ä»¶å¤„ç†å™¨ ç‰¹æ€§ äº‹ä»¶è¿‡æ»¤å™¨ é‡è½½äº‹ä»¶å¤„ç†å™¨ ä½œç”¨èŒƒå›´ å¯ç›‘å¬ä»»æ„å¯¹è±¡ ä»…é™æœ¬å¯¹è±¡ ä¾µå…¥æ€§ æ— éœ€å­ç±»åŒ–ç›®æ ‡æ§ä»¶ éœ€è¦å­ç±»åŒ– é€‚ç”¨åœºæ™¯ è·¨æ§ä»¶ç»Ÿä¸€å¤„ç† å•æ§ä»¶å®šåˆ¶è¡Œä¸º æ€§èƒ½å½±å“ ç•¥é«˜ï¼ˆé¢å¤–å‡½æ•°è°ƒç”¨ï¼‰ è¾ƒä½ å››ã€é”®ç›˜äº‹ä»¶å¤„ç†å¤„ç†é”®ç›˜äº‹ä»¶éœ€åŒ…å«å¤´æ–‡ä»¶ï¼š #include QKeyEvent 4.1 keyPressEvent æŒ‰é”®æŒ‰ä¸‹äº‹ä»¶void Widget::keyPressEvent(QKeyEvent *event) // ç»„åˆé”®æ£€æµ‹ï¼šCtrl + M if (event-modifiers() == Qt::ControlModifier) if (event-key() == Qt::Key_M) handleCtrlM(); return; // æ™®é€šæŒ‰é”®å¤„ç†ï¼ˆé¿å…è‡ªåŠ¨é‡å¤ï¼‰ if (event-key() == Qt::Key_Up) if (event-isAutoRepeat()) return; // â† å¿½ç•¥é•¿æŒ‰äº§ç”Ÿçš„é‡å¤äº‹ä»¶ keyUp = true; else if (event-key() == Qt::Key_Left) if (event-isAutoRepeat()) return; keyLeft = true; else QWidget::keyPressEvent(event); // æœªå¤„ç†çš„äº‹ä»¶äº¤ç»™çˆ¶ç±» isAutoRepeat() è¯´æ˜ï¼š é•¿æŒ‰æŒ‰é”®ä¼šäº§ç”Ÿè¿ç»­çš„æŒ‰ä¸‹äº‹ä»¶ã€‚è‹¥éœ€åŒºåˆ†é¦–æ¬¡æŒ‰ä¸‹å’ŒæŒç»­æŒ‰ä½ï¼Œä½¿ç”¨æ­¤å‡½æ•°è¿‡æ»¤é‡å¤äº‹ä»¶ã€‚ 4.2 keyReleaseEvent æŒ‰é”®é‡Šæ”¾äº‹ä»¶void Widget::keyReleaseEvent(QKeyEvent *event) if (event-key() == Qt::Key_Up) if (event-isAutoRepeat()) return; keyUp = false; // æ ‡è®°æŒ‰é”®å·²é‡Šæ”¾ else if (event-key() == Qt::Key_Left) if (event-isAutoRepeat()) return; keyLeft = false; 4.3 ä½¿ç”¨ switch è¯­å¥å¤„ç†å¤šæŒ‰é”®å½“éœ€è¦å¤„ç†å¤šä¸ªæŒ‰é”®æ—¶ï¼Œä½¿ç”¨ switch è¯­å¥æ›´ä¸ºæ¸…æ™°ï¼š void TimeWindows::keyReleaseEvent(QKeyEvent *e) switch (e-key()) case Qt::Key_Up: handleUp(); break; case Qt::Key_Down: handleDown(); break; case Qt::Key_Left: handleLeft(); break; case Qt::Key_Right: handleRight(); break; default: QWidget::keyReleaseEvent(e); break; äº”ã€é¼ æ ‡äº‹ä»¶å¤„ç†å¤„ç†é¼ æ ‡äº‹ä»¶éœ€åŒ…å«å¤´æ–‡ä»¶ï¼š #include QMouseEvent 5.1 QMouseEvent ç±»æ¦‚è¿°QMouseEvent å¤„ç†é¼ æ ‡æŒ‰é”®çš„ç‚¹å‡»ã€é‡Šæ”¾å’Œç§»åŠ¨æ“ä½œï¼Œé¼ æ ‡æ»šè½®äº‹ä»¶ç”± QWheelEvent å•ç‹¬å¤„ç†ã€‚ é¼ æ ‡äº‹ä»¶è§¦å‘æ¡ä»¶ï¼š äº‹ä»¶ç±»å‹ è§¦å‘æ¡ä»¶ æŒ‰ä¸‹é‡Šæ”¾ é¼ æ ‡æŒ‰é”®çŠ¶æ€æ”¹å˜ ç§»åŠ¨ï¼ˆé»˜è®¤ï¼‰ æŒ‰ä½æŒ‰é”®å¹¶ç§»åŠ¨ ç§»åŠ¨ï¼ˆè¿½è¸ªæ¨¡å¼ï¼‰ é¼ æ ‡æŒ‡é’ˆç§»åŠ¨å³è§¦å‘ å¼€å¯é¼ æ ‡è¿½è¸ªï¼š setMouseTracking(true); // æ— éœ€æŒ‰ä¸‹æŒ‰é”®å³å¯è¿½è¸ªé¼ æ ‡ç§»åŠ¨ 5.2 é¼ æ ‡äº‹ä»¶ä¼ é€’æœºåˆ¶é¼ æ ‡äº‹ä»¶æ²¿æ§ä»¶çˆ¶å­é“¾å‘ä¸Šä¼ é€’ï¼Œç›´åˆ°è¢«æ¥å—ä¸ºæ­¢ï¼š flowchart BT A[å­æ§ä»¶] --|ignore| B[çˆ¶æ§ä»¶] B --|ignore| C[ç¥–çˆ¶æ§ä»¶] C --|accept| D[äº‹ä»¶å¤„ç†å®Œæˆ] style D fill:#4CAF50 ä¼ é€’æ§åˆ¶ï¼š accept()ï¼šæ¥å—äº‹ä»¶ï¼Œåœæ­¢ä¼ é€’ ignore()ï¼šå¿½ç•¥äº‹ä»¶ï¼Œç»§ç»­å‘çˆ¶æ§ä»¶ä¼ é€’ QT::WA_NoMousePropagationï¼šç¦æ­¢äº‹ä»¶å‘ä¸Šä¼ é€’ 5.3 é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶void Widget::mousePressEvent(QMouseEvent *event) if (event-button() == Qt::LeftButton) // å·¦é”®æŒ‰ä¸‹å¤„ç† startDrag(event-pos()); else if (event-button() == Qt::RightButton) // å³é”®æŒ‰ä¸‹å¤„ç† showContextMenu(event-globalPos()); 5.4 é¼ æ ‡ç§»åŠ¨äº‹ä»¶void Widget::mouseMoveEvent(QMouseEvent *event) // ä½¿ç”¨ buttons() è¿›è¡ŒæŒ‰ä½ä¸åˆ¤æ–­ï¼ˆæ³¨æ„æ˜¯å¤æ•°å½¢å¼ï¼‰ if (event-buttons() Qt::LeftButton) // å·¦é”®æ‹–åŠ¨å¤„ç† updateDragPosition(event-pos()); button() vs buttons() åŒºåˆ«ï¼š button()ï¼šè¿”å›è§¦å‘å½“å‰äº‹ä»¶çš„å•ä¸ªæŒ‰é’® buttons()ï¼šè¿”å›å½“å‰æ‰€æœ‰æŒ‰ä¸‹çš„æŒ‰é’®çŠ¶æ€ï¼ˆä½æ©ç ï¼‰ 5.5 é¼ æ ‡é‡Šæ”¾äº‹ä»¶void Widget::mouseReleaseEvent(QMouseEvent *event) if (event-button() == Qt::LeftButton) endDrag(); 5.6 é¼ æ ‡åŒå‡»äº‹ä»¶void Widget::mouseDoubleClickEvent(QMouseEvent *event) if (event-button() == Qt::LeftButton) selectWord(); // åŒå‡»é€‰ä¸­å•è¯ åŒå‡»äº‹ä»¶åºåˆ—ï¼š Press â†’ Release â†’ DoubleClick â†’ Release 5.7 æ»šè½®äº‹ä»¶æ»šè½®äº‹ä»¶ç”± QWheelEvent å¤„ç†ï¼š void Widget::wheelEvent(QWheelEvent *event) if (event-delta() 0) // æ»šè½®å‘ä¸Šï¼ˆè¿œç¦»ç”¨æˆ·ï¼‰ zoomIn(); else // æ»šè½®å‘ä¸‹ï¼ˆæœå‘ç”¨æˆ·ï¼‰ zoomOut(); å…­ã€QMouseEvent å¸¸ç”¨æˆå‘˜å‡½æ•°6.1 åæ ‡è·å–å‡½æ•° å‡½æ•° è¿”å›ç±»å‹ æè¿° pos() QPoint ç›¸å¯¹äºå½“å‰çª—å£çš„æ•´å‹åæ ‡ posF() QPointF ç›¸å¯¹äºå½“å‰çª—å£çš„æµ®ç‚¹å‹åæ ‡ï¼ˆé«˜ç²¾åº¦ï¼‰ x() y() int ç­‰ä»·äº pos().x() pos().y() globalPos() QPoint å±å¹•å…¨å±€åæ ‡ globalX() globalY() int ç­‰ä»·äº globalPos().x() globalPos().y() 6.2 å…¨å±€åæ ‡çš„åº”ç”¨åœºæ™¯æ‹–åŠ¨çª—å£æ—¶æ¨èä½¿ç”¨ globalPos() é˜²æ­¢çª—å£æŠ–åŠ¨ï¼š void Widget::mouseMoveEvent(QMouseEvent *event) if (isDragging) // ä½¿ç”¨å…¨å±€åæ ‡è®¡ç®—çª—å£æ–°ä½ç½® QPoint newPos = event-globalPos() - dragStartOffset; move(newPos); 6.3 åæ ‡è½¬æ¢åœ¨çª—å£åæ ‡ä¸å…¨å±€åæ ‡é—´è½¬æ¢ï¼š QPoint globalPoint = mapToGlobal(localPoint); // çª—å£åæ ‡ â†’ å…¨å±€åæ ‡QPoint localPoint = mapFromGlobal(globalPoint); // å…¨å±€åæ ‡ â†’ çª—å£åæ ‡ å‚è€ƒæ¥æº Qt å®˜æ–¹æ–‡æ¡£ - QEvent Class Qt å®˜æ–¹æ–‡æ¡£ - The Event System Qt å®˜æ–¹æ–‡æ¡£ - QMouseEvent Class Qt å®˜æ–¹æ–‡æ¡£ - QKeyEvent Class","tags":["Qt","äº‹ä»¶å¤„ç†","QEvent","äº‹ä»¶è¿‡æ»¤å™¨","é¼ æ ‡äº‹ä»¶","é”®ç›˜äº‹ä»¶"],"categories":["3.å¼€å‘æ¡†æ¶","Qt","Publish"]},{"title":"Qt ç¼“å†²æ± è®¾è®¡ä¸å®ç°","path":"/2026/01/08/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qt-ç¼“å†²æ± /","content":"Qt ç¼“å†²æ± è®¾è®¡ä¸å®ç°ç¼“å†²æ± ï¼ˆBuffer Poolï¼‰æ˜¯ä¸€ç§å¸¸è§çš„å†…å­˜ç®¡ç†æ¨¡å¼ï¼Œç”¨äºåè°ƒæ•°æ®æºä¸æ•°æ®æ¶ˆè´¹è€…ä¹‹é—´çš„é€Ÿç‡å·®å¼‚ã€‚æœ¬æ–‡é¦–å…ˆé˜è¿°ç¼“å†²æ± çš„åŸºæœ¬æ¦‚å¿µï¼Œéšåæä¾› Qt æ¡†æ¶ä¸‹çš„å…·ä½“å®ç°æ–¹æ¡ˆã€‚ ç¼“å†²æ± åŸºç¡€æ¦‚å¿µæ ¸å¿ƒç»„æˆç¼“å†²æ± ç”±ä»¥ä¸‹å››ä¸ªå…³é”®ç»„ä»¶æ„æˆï¼š ç»„ä»¶ èŒè´£æè¿° ç¼“å†²åŒº å®é™…å­˜å‚¨æ•°æ®çš„å†…å­˜åŒºåŸŸï¼Œæ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æš‚å­˜äºæ­¤ è¯»æŒ‡é’ˆ æŒ‡ç¤ºç¼“å†²åŒºä¸­å½“å‰å¯è¯»å–æ•°æ®çš„å…·ä½“ä½ç½® å†™æŒ‡é’ˆ æŒ‡å‘ç¼“å†²åŒºä¸­èƒ½å¤Ÿå†™å…¥æ–°æ•°æ®çš„ä½ç½® è®¡æ•°å™¨ è®°å½•ç¼“å†²åŒºä¸­å‰©ä½™å¯è¯»æ•°æ®çš„æ•°é‡ä»¥åŠè¿˜å¯å†™å…¥æ•°æ®çš„ç©ºé—´å¤§å° å·¥ä½œåŸç†ç¼“å†²æ± çš„æ•°æ®æµè½¬éµå¾ªä»¥ä¸‹ä¸‰ä¸ªé˜¶æ®µï¼š sequenceDiagram participant Source as æºè®¾å¤‡ participant Buffer as ç¼“å†²æ±  participant Target as ç›®æ ‡è®¾å¤‡ Source-Buffer: 1. å†™å…¥æ•°æ® Note over Buffer: å†™æŒ‡é’ˆç§»åŠ¨br/è®¡æ•°å™¨æ›´æ–°ç©ºé—²ç©ºé—´ Buffer-Target: 2. è¯»å–æ•°æ® Note over Buffer: è¯»æŒ‡é’ˆç§»åŠ¨br/è®¡æ•°å™¨å‡å°‘å¯è¯»æ•°é‡ Note over Buffer: 3. ä¼ è¾“å®Œæˆåbr/é‡ç½®æŒ‡é’ˆå®ç°å¾ªç¯åˆ©ç”¨ é˜¶æ®µä¸€ï¼šæ•°æ®å†™å…¥ç¼“å†²åŒº å½“æºè®¾å¤‡å‘ç›®æ ‡è®¾å¤‡ä¼ è¾“æ•°æ®æ—¶ï¼Œæ•°æ®é¦–å…ˆè¿›å…¥ç¼“å†²åŒºã€‚æ­¤æ—¶å†™æŒ‡é’ˆæŒ‡å‘å¯å†™å…¥çš„ä½ç½®ï¼Œè®¡æ•°å™¨è®°å½•ç¼“å†²åŒºå‰©ä½™ç©ºé—²ç©ºé—´å¤§å°ã€‚ é˜¶æ®µäºŒï¼šç›®æ ‡è®¾å¤‡è¯»å–æ•°æ® ç›®æ ‡è®¾å¤‡ä»ç¼“å†²åŒºè·å–æ•°æ®æ—¶ï¼Œè¯»æŒ‡é’ˆæŒ‡å‘å¯è¯»å–æ•°æ®çš„ä½ç½®ï¼Œè®¡æ•°å™¨åŒæ—¶è®°å½•ç¼“å†²åŒºä¸­è¿˜æœ‰å¤šå°‘å¯è¯»æ•°æ®ã€‚è¯»å–æ“ä½œå®Œæˆåï¼Œè®¡æ•°å™¨å‡å°‘ç›¸åº”æ•°é‡ï¼Œè¯»æŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå¯è¯»æ•°æ®ä½ç½®ã€‚ é˜¶æ®µä¸‰ï¼šå¤„ç†ä¼ è¾“å®Œæˆåçš„æƒ…å†µ æºè®¾å¤‡ä¼ è¾“ç»“æŸåï¼Œè‹¥ç¼“å†²æ± ä¸­ä»æœ‰æœªè¢«è¯»å–çš„æ•°æ®ï¼Œå°†è¯»æŒ‡é’ˆé‡ç½®åˆ°ç¼“å†²åŒºèµ·å§‹ä½ç½®ï¼Œä½¿ç¼“å†²æ± èƒ½å¤Ÿç»§ç»­æ¥æ”¶æ–°çš„æ•°æ®ï¼Œå®ç°å¾ªç¯åˆ©ç”¨ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“çš„è¿è´¯æ€§ã€‚ è®¾è®¡åŠ¨æœºï¼šé€šè¿‡ç¼“å†²æ± æœºåˆ¶ï¼Œæœ‰æ•ˆåè°ƒæºè®¾å¤‡å’Œç›®æ ‡è®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“é€Ÿç‡å·®å¼‚ï¼Œä½¿æ•°æ®ä¼ è¾“è¿‡ç¨‹æ›´åŠ å¹³æ»‘ã€é«˜æ•ˆï¼Œè¿›è€Œæå‡æ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œæ•ˆç‡å’Œæ€§èƒ½è¡¨ç°ã€‚ Qt å®ç°æ–¹æ¡ˆQt æ¡†æ¶æä¾›äº†ä¸°å¯Œçš„å®¹å™¨ç±»å’ŒåŒæ­¥åŸè¯­ï¼Œéå¸¸é€‚åˆå®ç°é«˜æ•ˆçš„ç¼“å†²æ± ã€‚ä»¥ä¸‹ä»‹ç»ä¸¤ç§å®ç°æ–¹å¼ï¼šåŸºç¡€å®ç°ä¸å¤šçº¿ç¨‹å®‰å…¨å®ç°ã€‚ è‡ªå®šä¹‰ç¼“å†²æ± ç±»ç±»ç»“æ„è®¾è®¡ç¼“å†²æ± ç±»çš„æ ¸å¿ƒæˆå‘˜åŒ…æ‹¬ï¼š æ•°æ®å®¹å™¨ï¼šä½¿ç”¨ QVectorQByteArray å­˜å‚¨å­—èŠ‚æ•°ç»„å½¢å¼çš„ç¼“å†²åŒº çŠ¶æ€è¿½è¸ªï¼šä½¿ç”¨ QVectorbool è¡¨ç¤ºæ¯ä¸ªç¼“å†²åŒºçš„å ç”¨çŠ¶æ€ class BufferPool : public QObject Q_OBJECTpublic: explicit BufferPool(int bufferCount, int bufferSize, QObject* parent = nullptr); ~BufferPool() = default; QByteArray* getAvailableBuffer(); void releaseBuffer(QByteArray* buffer);signals: void bufferFull(QByteArray* buffer);private: QVectorQByteArray buffers; QVectorbool bufferUsed;; åˆå§‹åŒ–ç¼“å†²æ± åœ¨æ„é€ å‡½æ•°ä¸­åˆ›å»ºæŒ‡å®šæ•°é‡å’Œå¤§å°çš„ç¼“å†²åŒºï¼Œå¹¶åˆå§‹åŒ–ä½¿ç”¨çŠ¶æ€ï¼š BufferPool::BufferPool(int bufferCount, int bufferSize, QObject* parent) : QObject(parent) buffers.reserve(bufferCount); bufferUsed.reserve(bufferCount); for (int i = 0; i bufferCount; ++i) QByteArray buffer(bufferSize, 0); // â† åˆ›å»ºæŒ‡å®šå¤§å°çš„ç¼“å†²åŒº buffers.append(buffer); bufferUsed.append(false); // â† åˆå§‹çŠ¶æ€ä¸ºæœªä½¿ç”¨ è·å–å¯ç”¨ç¼“å†²åŒºéå†çŠ¶æ€å‘é‡ï¼Œè¿”å›ç¬¬ä¸€ä¸ªæœªä½¿ç”¨çš„ç¼“å†²åŒºï¼š QByteArray* BufferPool::getAvailableBuffer() for (int i = 0; i bufferUsed.size(); ++i) if (!bufferUsed[i]) bufferUsed[i] = true; return buffers[i]; return nullptr; // â† æ— å¯ç”¨ç¼“å†²åŒºæ—¶è¿”å›ç©ºæŒ‡é’ˆ é‡Šæ”¾ç¼“å†²åŒºå°†ç¼“å†²åŒºçŠ¶æ€é‡ç½®ä¸ºæœªä½¿ç”¨ï¼Œä»¥ä¾¿å¤ç”¨ï¼š void BufferPool::releaseBuffer(QByteArray* buffer) int index = buffers.indexOf(*buffer); if (index != -1) bufferUsed[index] = false; æ€§èƒ½æ³¨æ„ï¼šindexOf æ–¹æ³•ä½¿ç”¨å€¼æ¯”è¾ƒæŸ¥æ‰¾ç´¢å¼•ï¼Œå¯¹äºå¤§å‹ç¼“å†²åŒºå¯èƒ½å­˜åœ¨æ€§èƒ½å¼€é”€ã€‚ã€è¡¥å……ã€‘å¯è€ƒè™‘ä½¿ç”¨æŒ‡é’ˆåœ°å€è®¡ç®—ç´¢å¼•ä»¥æå‡æ•ˆç‡ã€‚ ä¿¡å·ä¸æ§½æœºåˆ¶é›†æˆQt çš„ä¿¡å·ä¸æ§½æœºåˆ¶å¯å®ç°ç¼“å†²æ± çŠ¶æ€å˜åŒ–çš„å¼‚æ­¥é€šçŸ¥ï¼Œé€‚ç”¨äºäº‹ä»¶é©±åŠ¨æ¶æ„ã€‚ ä¿¡å·å®šä¹‰å½“ç¼“å†²åŒºå¡«æ»¡æˆ–æœ‰æ–°æ•°æ®éœ€è¦å¤„ç†æ—¶ï¼Œå‘é€ä¿¡å·é€šçŸ¥æ¶ˆè´¹è€…ï¼š signals: void bufferFull(QByteArray* buffer); // ç¼“å†²åŒºå·²æ»¡ï¼Œéœ€è¦å¤„ç† void bufferEmpty(); // æ‰€æœ‰ç¼“å†²åŒºå·²è€—å°½ æ§½å‡½æ•°å¤„ç†æ•°æ®å¤„ç†æ§½å‡½æ•°æ¥æ”¶å·²å¡«æ»¡çš„ç¼“å†²åŒºï¼Œå®Œæˆå¤„ç†åé‡Šæ”¾èµ„æºï¼š void DataProcessor::onBufferFull(QByteArray* buffer) // è§£ææ•°æ®æˆ–å†™å…¥æ–‡ä»¶ processData(*buffer); // å¤„ç†å®Œæˆåé‡Šæ”¾ç¼“å†²åŒº bufferPool-releaseBuffer(buffer); å¤šçº¿ç¨‹å®‰å…¨å®ç°åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼ˆå¦‚ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼‰ï¼Œç¼“å†²æ± å¿…é¡»ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚Qt æä¾› QMutex å’Œ QWaitCondition å®ç°çº¿ç¨‹åŒæ­¥ã€‚ çº¿ç¨‹å®‰å…¨çš„è·å–ä¸é‡Šæ”¾class ThreadSafeBufferPool : public QObject Q_OBJECTpublic: QByteArray* getAvailableBuffer(); void releaseBuffer(QByteArray* buffer);private: QMutex mutex; QWaitCondition bufferAvailable; QVectorQByteArray buffers; QVectorbool bufferUsed;;QByteArray* ThreadSafeBufferPool::getAvailableBuffer() QMutexLocker locker(mutex); // â† RAII é£æ ¼è‡ªåŠ¨åŠ è§£é” for (int i = 0; i bufferUsed.size(); ++i) if (!bufferUsed[i]) bufferUsed[i] = true; return buffers[i]; return nullptr;void ThreadSafeBufferPool::releaseBuffer(QByteArray* buffer) QMutexLocker locker(mutex); int index = buffers.indexOf(*buffer); if (index != -1) bufferUsed[index] = false; bufferAvailable.wakeOne(); // â† å”¤é†’ç­‰å¾…ç¼“å†²åŒºçš„çº¿ç¨‹ æœ€ä½³å®è·µï¼šä½¿ç”¨ QMutexLocker æ›¿ä»£æ‰‹åŠ¨ lock()unlock() è°ƒç”¨ï¼Œç¡®ä¿å¼‚å¸¸æƒ…å†µä¸‹é”ä¹Ÿèƒ½æ­£ç¡®é‡Šæ”¾ï¼Œé¿å…æ­»é”é£é™©ã€‚ å°ç»“ å®ç°æ–¹å¼ é€‚ç”¨åœºæ™¯ å¤æ‚åº¦ åŸºç¡€ç¼“å†²æ± ç±» å•çº¿ç¨‹æ•°æ®å¤„ç†ã€ç®€å•æ•°æ®ç¼“å­˜ ä½ ä¿¡å·æ§½é›†æˆ äº‹ä»¶é©±åŠ¨æ¶æ„ã€GUI åº”ç”¨æ•°æ®æµ ä¸­ å¤šçº¿ç¨‹å®‰å…¨å®ç° ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ã€ç½‘ç»œæ•°æ®æ¥æ”¶ é«˜ ç¼“å†²æ± è®¾è®¡çš„æ ¸å¿ƒåœ¨äºå¹³è¡¡å†…å­˜å ç”¨ä¸ååæ€§èƒ½ã€‚ç¼“å†²åŒºæ•°é‡è¿‡å°‘å¯èƒ½å¯¼è‡´é˜»å¡ï¼Œè¿‡å¤šåˆ™æµªè´¹å†…å­˜ã€‚å®é™…åº”ç”¨ä¸­éœ€æ ¹æ®æ•°æ®æµé€Ÿç‰¹å¾è¿›è¡Œè°ƒä¼˜ã€‚ å‚è€ƒæ¥æº Qt Documentation - QByteArray - å­—èŠ‚æ•°ç»„ç±»å®˜æ–¹æ–‡æ¡£ Qt Documentation - QMutex - äº’æ–¥é”å®˜æ–¹æ–‡æ¡£ Qt Documentation - Threads and QObjects - Qt å¤šçº¿ç¨‹ç¼–ç¨‹æŒ‡å—","tags":["Qt","å¤šçº¿ç¨‹","C++","å†…å­˜ç®¡ç†","ç¼“å†²æ± "],"categories":["3.å¼€å‘æ¡†æ¶","Qt","Publish"]},{"title":"Doxygen é£æ ¼çš„æ³¨é‡Š","path":"/2026/01/04/6-å¼€å‘å·¥å…·-æ•ˆç‡å·¥å…·-Doxygen-é£æ ¼çš„æ³¨é‡Š/","content":"Doxygen é£æ ¼çš„æ³¨é‡Š","categories":["6.å¼€å‘å·¥å…·","æ•ˆç‡å·¥å…·"]},{"title":"qmakeå®Œå…¨æŒ‡å—","path":"/2025/12/30/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qt-Build-QMakeæŒ‡å—/","content":"qmakeæ˜¯Qtå®˜æ–¹æ„å»ºå·¥å…·ï¼Œè´Ÿè´£å°†.proå·¥ç¨‹æ–‡ä»¶è½¬æ¢ä¸ºç‰¹å®šå¹³å°çš„Makefileã€‚ç›¸æ¯”æ‰‹åŠ¨ç¼–å†™Makefileï¼Œqmakeé€šè¿‡å£°æ˜å¼è¯­æ³•è‡ªåŠ¨å¤„ç†å¤´æ–‡ä»¶ä¾èµ–ã€mocé¢„å¤„ç†ã€èµ„æºç¼–è¯‘ç­‰Qtç‰¹æœ‰æµç¨‹ï¼Œå¤§å¹…é™ä½è·¨å¹³å°å¼€å‘çš„é…ç½®å¤æ‚åº¦ã€‚ flowchart LR A[.proæ–‡ä»¶] -- B[qmake] B -- C[Makefile] C -- D[make/nmake] D -- E[å¯æ‰§è¡Œæ–‡ä»¶/åº“] ä¸€ã€é¡¹ç›®æè¿°ä¸åˆ›å»ºé¡¹ç›®é€šè¿‡.proæ–‡ä»¶è¿›è¡Œæè¿°ï¼Œqmakeæ®æ­¤ç”ŸæˆMakefileã€‚ä¸€ä¸ªå…¸å‹çš„é¡¹ç›®æ–‡ä»¶åŒ…å«ï¼š æºæ–‡ä»¶å’Œå¤´æ–‡ä»¶åˆ—è¡¨ Qtæ¨¡å—ä¾èµ– ç¼–è¯‘å™¨é€‰é¡¹ä¸é¢„å¤„ç†å® åº“é“¾æ¥ä¸è·¯å¾„é…ç½® åˆ›å»ºé¡¹ç›®æ–‡ä»¶çš„ä¸‰ç§æ–¹å¼ï¼š æ–¹å¼ é€‚ç”¨åœºæ™¯ æ‰‹åŠ¨ç¼–å†™.proæ–‡ä»¶ ç²¾ç»†æ§åˆ¶é¡¹ç›®é…ç½® Qt Creatoræ–°å»ºé¡¹ç›®å‘å¯¼ å¿«é€Ÿåˆ›å»ºæ ‡å‡†é¡¹ç›®ç»“æ„ qmake -project ä»ç°æœ‰æºç è‡ªåŠ¨ç”Ÿæˆ äºŒã€.proæ–‡ä»¶åŸºç¡€2.1 é¡¹ç›®æ¨¡æ¿é€šè¿‡TEMPLATEå˜é‡æŒ‡å®šé¡¹ç›®ç±»å‹ï¼š æ¨¡æ¿ ç”¨é€” è¾“å‡ºäº§ç‰© app åº”ç”¨ç¨‹åºï¼ˆé»˜è®¤ï¼‰ å¯æ‰§è¡Œæ–‡ä»¶ lib åº“é¡¹ç›® é™æ€åº“åŠ¨æ€åº“ subdirs å¤šé¡¹ç›®ç®¡ç† æ— ç›´æ¥è¾“å‡º vcapp Visual Studioé¡¹ç›® .vcxprojæ–‡ä»¶ aux è¾…åŠ©é¡¹ç›® æ— ç¼–è¯‘äº§ç‰© TEMPLATE = app # è‹¥ä¸æŒ‡å®šï¼Œé»˜è®¤ä¸ºapp 2.2 æ ¸å¿ƒå˜é‡æœ€ç®€.proæ–‡ä»¶ç¤ºä¾‹ï¼š CONFIG += qtHEADERS += hello.hSOURCES += hello.cpp main.cppTARGET = helloworld å¸¸ç”¨å˜é‡é€ŸæŸ¥è¡¨ï¼š å˜é‡ è¯´æ˜ ç¤ºä¾‹ HEADERS å¤´æ–‡ä»¶åˆ—è¡¨ *.h SOURCES æºæ–‡ä»¶åˆ—è¡¨ *.cpp FORMS Qt Designer UIæ–‡ä»¶ *.ui RESOURCES èµ„æºæ–‡ä»¶ *.qrc DEFINES é¢„å¤„ç†å®å®šä¹‰ DEBUG_MODE INCLUDEPATH å¤´æ–‡ä»¶æœç´¢è·¯å¾„ $$PWD/include LIBS é“¾æ¥åº“ -L/path -lname CONFIG ç¼–è¯‘é…ç½®é€‰é¡¹ c++17 warn_on QT Qtæ¨¡å—ä¾èµ– core gui widgets TARGET è¾“å‡ºæ–‡ä»¶å myapp DESTDIR è¾“å‡ºç›®å½• bin/ 2.3 CONFIGé…ç½®é€‰é¡¹CONFIGå˜é‡æ§åˆ¶ç¼–è¯‘è¡Œä¸ºï¼Œå¸¸ç”¨é€‰é¡¹ï¼š æ„å»ºç±»å‹ï¼š debug â€” è°ƒè¯•ç‰ˆæœ¬ï¼ŒåŒ…å«è°ƒè¯•ç¬¦å· release â€” å‘å¸ƒç‰ˆæœ¬ï¼Œå¯ç”¨ä¼˜åŒ– debug_and_release â€” åŒæ—¶ç”Ÿæˆä¸¤ä¸ªç‰ˆæœ¬ åº“ç±»å‹ï¼š staticlib â€” ç”Ÿæˆé™æ€åº“ï¼ˆ.a.libï¼‰ dll â€” ç”ŸæˆåŠ¨æ€åº“ï¼ˆ.so.dllï¼‰ plugin â€” ç”ŸæˆQtæ’ä»¶ ç¼–è¯‘é€‰é¡¹ï¼š c++11 c++14 c++17 c++20 â€” C++æ ‡å‡†ç‰ˆæœ¬ warn_on â€” å¯ç”¨ç¼–è¯‘å™¨è­¦å‘Š warn_off â€” ç¦ç”¨è­¦å‘Š precompile_header â€” å¯ç”¨é¢„ç¼–è¯‘å¤´æ–‡ä»¶ ordered â€” æŒ‰é¡ºåºç¼–è¯‘å­é¡¹ç›®ï¼ˆsubdirsæ¨¡å¼ï¼‰ CONFIG += c++17 warn_on precompile_headerCONFIG -= debug_and_release # â† ç§»é™¤é€‰é¡¹ä½¿ç”¨ -= 2.4 Qtæ¨¡å—ç®¡ç†é€šè¿‡QTå˜é‡å£°æ˜æ¨¡å—ä¾èµ–ï¼š QT += core gui network sql serialport widgets# Qt5èµ·widgetsä»guiåˆ†ç¦»ï¼Œéœ€å…¼å®¹å¤„ç†greaterThan(QT_MAJOR_VERSION, 4): QT += widgets# æ§åˆ¶å°ç¨‹åºä¸éœ€è¦GUIQT -= gui å¸¸ç”¨Qtæ¨¡å—ï¼š æ¨¡å— åŠŸèƒ½ core æ ¸å¿ƒéGUIåŠŸèƒ½ï¼ˆé»˜è®¤åŒ…å«ï¼‰ gui GUIåŸºç¡€ç±»ï¼ˆé»˜è®¤åŒ…å«ï¼‰ widgets ä¼ ç»Ÿæ¡Œé¢æ§ä»¶ network ç½‘ç»œç¼–ç¨‹ sql æ•°æ®åº“è®¿é—® xml XMLå¤„ç† serialport ä¸²å£é€šä¿¡ websockets WebSocketåè®® multimedia éŸ³è§†é¢‘å¤„ç† quick QMLQt Quick ä¸‰ã€è·¯å¾„ä¸æ„å»ºç®¡ç†3.1 å†…ç½®è·¯å¾„å˜é‡qmakeæä¾›å¤šä¸ªè·¯å¾„ç›¸å…³å˜é‡ï¼Œç†è§£å®ƒä»¬å¯¹æ­£ç¡®é…ç½®é¡¹ç›®è‡³å…³é‡è¦ï¼š å˜é‡ å«ä¹‰ ä½¿ç”¨åœºæ™¯ PWD å½“å‰.pro.priæ–‡ä»¶æ‰€åœ¨ç›®å½• å¼•ç”¨ç›¸å¯¹äºé¡¹ç›®æ–‡ä»¶çš„èµ„æº _PRO_FILE_ ä¸»é¡¹ç›®æ–‡ä»¶å®Œæ•´è·¯å¾„ è·å–é¡¹ç›®æ–‡ä»¶å _PRO_FILE_PWD_ ä¸»é¡¹ç›®æ–‡ä»¶æ‰€åœ¨ç›®å½• .priä¸­å¼•ç”¨ä¸»é¡¹ç›®è·¯å¾„ OUT_PWD æ„å»ºè¾“å‡ºç›®å½•ï¼ˆMakefileæ‰€åœ¨ï¼‰ å¼•ç”¨æ„å»ºäº§ç‰© Shadow Buildæ£€æµ‹ï¼š Qt Creatoré»˜è®¤ä½¿ç”¨å½±å­æ„å»ºï¼ˆShadow Buildï¼‰ï¼Œå°†æ„å»ºäº§ç‰©æ”¾åœ¨æºç ç›®å½•å¤–ã€‚æ£€æµ‹æ–¹æ³•ï¼š !equals(_PRO_FILE_PWD_, OUT_PWD) message(å½“å‰ä½¿ç”¨å½±å­æ„å»ºæ¨¡å¼) message(æºç ç›®å½•: $$_PRO_FILE_PWD_) message(æ„å»ºç›®å½•: $$OUT_PWD) è°ƒè¯•è·¯å¾„é…ç½®ï¼š message(PWD = $$PWD)message(OUT_PWD = $$OUT_PWD)message(_PRO_FILE_ = $$_PRO_FILE_)message(_PRO_FILE_PWD_= $$_PRO_FILE_PWD_) 3.2 ä¸­é—´æ–‡ä»¶ç®¡ç†ç¼–è¯‘è¿‡ç¨‹äº§ç”Ÿå¤§é‡ä¸­é—´æ–‡ä»¶ï¼Œåˆç†ç»„ç»‡å¯ä¿æŒé¡¹ç›®æ•´æ´ï¼š MOC_DIR = $$OUT_PWD/temp/moc # mocç”Ÿæˆçš„å…ƒå¯¹è±¡ä»£ç RCC_DIR = $$OUT_PWD/temp/rcc # rccèµ„æºç¼–è¯‘è¾“å‡ºUI_DIR = $$OUT_PWD/temp/ui # uicç”Ÿæˆçš„UIå¤´æ–‡ä»¶OBJECTS_DIR = $$OUT_PWD/temp/obj # ç¼–è¯‘å™¨ç›®æ ‡æ–‡ä»¶(.o/.obj) 3.3 è¾“å‡ºç›®å½•é…ç½®DESTDIRæŒ‡å®šæœ€ç»ˆäº§ç‰©å­˜æ”¾ä½ç½®ï¼š # ç®€å•é…ç½®DESTDIR = $$PWD/bin# æŒ‰æ„å»ºç±»å‹åˆ†ç¦»CONFIG(debug, debug|release) DESTDIR = $$PWD/bin/debug else DESTDIR = $$PWD/bin/release è·¨å¹³å°è¾“å‡ºé…ç½®ç¤ºä¾‹ï¼š IDE_BUILD_TREE = $$PWD/../buildwin32 CONFIG(debug, debug|release) contains(DEFINES, WIN64): DESTDIR = $$IDE_BUILD_TREE/win64_debug else: DESTDIR = $$IDE_BUILD_TREE/win32_debug else contains(DEFINES, WIN64): DESTDIR = $$IDE_BUILD_TREE/win64_release else: DESTDIR = $$IDE_BUILD_TREE/win32_release macx CONFIG(debug, debug|release): DESTDIR = $$IDE_BUILD_TREE/mac_debug else: DESTDIR = $$IDE_BUILD_TREE/mac_releaseunix:!macx DESTDIR = $$IDE_BUILD_TREE/linux_$$QT_ARCH å››ã€åº“æ–‡ä»¶ç®¡ç†4.1 å¤´æ–‡ä»¶è·¯å¾„INCLUDEPATH += $$PWD/include # ç¼–è¯‘å™¨å¤´æ–‡ä»¶æœç´¢è·¯å¾„INCLUDEPATH += $$PWD/../third-party/includeDEPENDPATH += $$PWD/include # ä¾èµ–æ£€æŸ¥è·¯å¾„ï¼ˆå¯é€‰ï¼‰ è®¾è®¡è¯´æ˜ï¼šINCLUDEPATHå½±å“ç¼–è¯‘å™¨-Iå‚æ•°ï¼ŒDEPENDPATHç”¨äºqmakeåˆ†æå¤´æ–‡ä»¶ä¾èµ–å…³ç³»ï¼Œä¸¤è€…é€šå¸¸è®¾ç½®ç›¸åŒå€¼ã€‚ 4.2 é“¾æ¥åº“æ–‡ä»¶LIBSå˜é‡è¯­æ³•éµå¾ªUnixé“¾æ¥å™¨çº¦å®šï¼š # -L æŒ‡å®šåº“æœç´¢è·¯å¾„# -l æŒ‡å®šåº“åç§°ï¼ˆä¸å«libå‰ç¼€å’Œæ‰©å±•åï¼‰LIBS += -L$$PWD/lib -lmylib# æ ¹æ®æ„å»ºç±»å‹é“¾æ¥ä¸åŒç‰ˆæœ¬CONFIG(debug, debug|release) LIBS += -L$$OUT_PWD/lib -lmylib_d else LIBS += -L$$OUT_PWD/lib -lmylib Windowsç‰¹æ®Šå¤„ç†ï¼š win32 # ç›´æ¥æŒ‡å®š.libæ–‡ä»¶ CONFIG(debug, debug|release) LIBS += $$PWD/lib/mylibraryd.lib else LIBS += $$PWD/lib/mylibrary.lib 4.3 è‡ªåŠ¨åº“å‘½åå‡½æ•°å®šä¹‰å¯å¤ç”¨å‡½æ•°å¤„ç†DebugReleaseåº“å‘½åå·®å¼‚ï¼š defineReplace(qtLibraryName) unset(LIBRARY_NAME) LIBRARY_NAME = $$1 CONFIG(debug, debug|release) !debug_and_release|build_pass mac: RET = $$member(LIBRARY_NAME, 0)_debug win32: RET = $$member(LIBRARY_NAME, 0)d isEmpty(RET): RET = $$LIBRARY_NAME return($$RET)# ä½¿ç”¨ç¤ºä¾‹LIBS += -L$$DESTDIR -l$$qtLibraryName(mycomponent) 4.4 ç¬¬ä¸‰æ–¹åº“é›†æˆå®Œæ•´çš„ç¬¬ä¸‰æ–¹åº“é…ç½®æ¨¡æ¿ï¼š # å‡è®¾ç¬¬ä¸‰æ–¹åº“ä½äº $$PWD/../vendor/somelibSOMELIB_ROOT = $$PWD/../vendor/somelibINCLUDEPATH += $$SOMELIB_ROOT/includeDEPENDPATH += $$SOMELIB_ROOT/includewin32 CONFIG(debug, debug|release) LIBS += -L$$SOMELIB_ROOT/lib -somelibd else LIBS += -L$$SOMELIB_ROOT/lib -lsomelib unix LIBS += -L$$SOMELIB_ROOT/lib -lsomelib # è®¾ç½®è¿è¡Œæ—¶åº“æœç´¢è·¯å¾„ QMAKE_RPATHDIR += $$SOMELIB_ROOT/lib äº”ã€æ¡ä»¶ç¼–è¯‘qmakeæä¾›çµæ´»çš„æ¡ä»¶åˆ¤æ–­æœºåˆ¶ï¼Œç”¨äºå¤„ç†å¹³å°å·®å¼‚å’Œå¯é€‰åŠŸèƒ½ã€‚ 5.1 å¹³å°æ¡ä»¶ æ¡ä»¶ åŒ¹é…å¹³å° win32 Windowsï¼ˆå«64ä½ï¼‰ macx macOS unix æ‰€æœ‰Unixç³»ç»Ÿï¼ˆå«macOSå’ŒLinuxï¼‰ linux ä»…Linux android Android ios iOS win32 DEFINES += PLATFORM_WINDOWS LIBS += -luser32 -lgdi32macx DEFINES += PLATFORM_MACOS LIBS += -framework Cocoa ICON = resources/app.icnsunix:!macx DEFINES += PLATFORM_LINUX LIBS += -lX11 å¤åˆæ¡ä»¶ï¼š # éWindowsä¸”émacOSï¼ˆå³Linux/BSDç­‰ï¼‰!win32:!macx message(Building on Linux/Unix platform)# Windows 64ä½win32:contains(QMAKE_TARGET.arch, x86_64) DEFINES += WIN64 5.2 æ¶æ„ä¸ç¼–è¯‘å™¨åˆ¤æ–­# CPUæ¶æ„contains(QT_ARCH, arm64) DEFINES += ARCH_ARM64contains(QT_ARCH, x86_64) DEFINES += ARCH_X64# ç¼–è¯‘å™¨*-g++* QMAKE_CXXFLAGS += -Wextra*-msvc* QMAKE_CXXFLAGS += /W4 5.3 Qtç‰ˆæœ¬åˆ¤æ–­# ç‰ˆæœ¬æ¯”è¾ƒå‡½æ•°greaterThan(QT_MAJOR_VERSION, 4): QT += widgetsgreaterThan(QT_MAJOR_VERSION, 5): QT += core5compat# ç²¾ç¡®ç‰ˆæœ¬æ£€æŸ¥equals(QT_MAJOR_VERSION, 6) greaterThan(QT_MINOR_VERSION, 4) message(Qt 6.5+ detected) # ç‰ˆæœ¬å­—ç¬¦ä¸²åŒ¹é…contains(QT_VERSION, ^6\\\\.) DEFINES += QT6_BUILD 5.4 è‡ªå®šä¹‰æ¡ä»¶é€šè¿‡DEFINESå®šä¹‰ç¼–è¯‘å®ï¼š DEFINES += ENABLE_FEATURE_Xcontains(DEFINES, ENABLE_FEATURE_X) SOURCES += feature_x.cpp HEADERS += feature_x.h C++ä»£ç ä¸­ä½¿ç”¨ï¼š #ifdef ENABLE_FEATURE_X // åŠŸèƒ½Xçš„å®ç°#endif é€šè¿‡CONFIGå®šä¹‰æ„å»ºé€‰é¡¹ï¼š CONFIG += use_opengluse_opengl QT += opengl DEFINES += RENDER_OPENGL else DEFINES += RENDER_SOFTWARE 5.5 DebugReleaseåˆ¤æ–­CONFIG(debug, debug|release) DEFINES += DEBUG_BUILD TARGET = $$TARGET_d LIBS += -L$$PWD/lib -llogger_d else DEFINES += RELEASE_BUILD DEFINES += QT_NO_DEBUG_OUTPUT # ç¦ç”¨qDebugè¾“å‡º å…­ã€å¤šé¡¹ç›®ç®¡ç†å¤§å‹é¡¹ç›®é€šå¸¸æ‹†åˆ†ä¸ºå¤šä¸ªå­æ¨¡å—ï¼Œä½¿ç”¨subdirsæ¨¡æ¿ç»Ÿä¸€ç®¡ç†ã€‚ 6.1 é¡¹ç›®ç»“æ„ç¤ºä¾‹MyProject/â”œâ”€â”€ MyProject.pro # ä¸»é¡¹ç›®æ–‡ä»¶(subdirs)â”œâ”€â”€ app/â”‚ â”œâ”€â”€ app.pro # ä¸»ç¨‹åºâ”‚ â””â”€â”€ main.cppâ”œâ”€â”€ core/â”‚ â”œâ”€â”€ core.pro # æ ¸å¿ƒåº“(é™æ€)â”‚ â”œâ”€â”€ core.hâ”‚ â””â”€â”€ core.cppâ””â”€â”€ plugins/ â”œâ”€â”€ plugins.pro # æ’ä»¶(åŠ¨æ€) â””â”€â”€ myplugin.cpp 6.2 ä¸»é¡¹ç›®æ–‡ä»¶# MyProject.proTEMPLATE = subdirsSUBDIRS += \\ core \\ plugins \\ app# å®šä¹‰ç¼–è¯‘ä¾èµ–é¡ºåºapp.depends = core pluginsplugins.depends = core# æˆ–ä½¿ç”¨orderedä¿è¯é¡ºåºï¼ˆæ•ˆç‡è¾ƒä½ï¼‰# CONFIG += ordered 6.3 é™æ€åº“å­é¡¹ç›®# core/core.proQT -= guiTARGET = coreTEMPLATE = libCONFIG += staticlib c++17DEFINES += CORE_LIBRARYHEADERS += core.h core_global.hSOURCES += core.cpp å¯¼å‡ºå®å®šä¹‰ï¼ˆcore_global.hï¼‰ï¼š #ifndef CORE_GLOBAL_H#define CORE_GLOBAL_H#if defined(CORE_LIBRARY)# define CORE_EXPORT Q_DECL_EXPORT#else# define CORE_EXPORT Q_DECL_IMPORT#endif#endif 6.4 åŠ¨æ€åº“å­é¡¹ç›®# plugins/plugins.proQT -= guiTARGET = mypluginTEMPLATE = libCONFIG += plugin c++17DEFINES += PLUGIN_LIBRARYHEADERS += myplugin.hSOURCES += myplugin.cpp# é“¾æ¥coreåº“INCLUDEPATH += $$PWD/../coreLIBS += -L$$OUT_PWD/../core -lcore 6.5 åº”ç”¨ç¨‹åºå­é¡¹ç›®# app/app.proQT += core gui widgetsTARGET = myappTEMPLATE = appCONFIG += c++17SOURCES += main.cpp mainwindow.cppHEADERS += mainwindow.hFORMS += mainwindow.ui# é“¾æ¥å†…éƒ¨åº“INCLUDEPATH += $$PWD/../coreLIBS += -L$$OUT_PWD/../core -lcore# è®¾ç½®è¿è¡Œæ—¶åº“è·¯å¾„ï¼ˆUnixï¼‰unix: QMAKE_RPATHDIR += $$OUT_PWD/../plugins 6.6 å¸¸è§é—®é¢˜ä¸è§£å†³ é—®é¢˜ åŸå›  è§£å†³æ–¹æ¡ˆ é“¾æ¥æ‰¾ä¸åˆ°åº“ è·¯å¾„é…ç½®é”™è¯¯ ä½¿ç”¨$$OUT_PWDè€Œé$$PWDå¼•ç”¨æ„å»ºäº§ç‰© Windowså¯¼å‡ºç¬¦å·æœªå®šä¹‰ ç¼ºå°‘dllexport ä½¿ç”¨Q_DECL_EXPORTQ_DECL_IMPORTå® ç¼–è¯‘é¡ºåºé”™è¯¯ ä¾èµ–æœªå£°æ˜ ä½¿ç”¨.dependsæ˜ç¡®ä¾èµ–å…³ç³» DebugReleaseåº“æ··ç”¨ å‘½åä¸ä¸€è‡´ ç»Ÿä¸€åº“å‘½åè§„åˆ™ï¼ˆå¦‚debugç‰ˆåŠ dåç¼€ï¼‰ 6.7 ä¼ä¸šçº§ä¾èµ–ç®¡ç†æ–¹æ¡ˆå½“åº“è¢«å¤šä¸ªæ¨¡å—ä¾èµ–æ—¶ï¼Œç¡¬ç¼–ç LIBSè·¯å¾„ä¼šå¯¼è‡´ç»´æŠ¤å›°éš¾ã€‚Qt Creatoré‡‡ç”¨å£°æ˜å¼ä¾èµ–é…ç½®è§£å†³æ­¤é—®é¢˜ï¼šæ¯ä¸ªæ¨¡å—æ‹¥æœ‰ç‹¬ç«‹çš„ä¾èµ–æè¿°æ–‡ä»¶ï¼Œæ„å»ºæ—¶è‡ªåŠ¨è§£æã€‚ ä¾èµ–æè¿°æ–‡ä»¶ç»“æ„ï¼š # welcome_dependencies.priQTC_PLUGIN_NAME = Welcome # æ¨¡å—åç§°QTC_LIB_DEPENDS += \\ # ä¾èµ–çš„åº“ extensionsystem \\ utilsQTC_PLUGIN_DEPENDS += \\ # ä¾èµ–çš„æ’ä»¶ coreplugin è‡ªåŠ¨ä¾èµ–è§£ææœºåˆ¶ï¼š # é€’å½’è§£ææ’ä»¶ä¾èµ–ï¼ˆqtcreator.priæ ¸å¿ƒé€»è¾‘ï¼‰!isEmpty(QTC_PLUGIN_DEPENDS) LIBS *= -L$$IDE_PLUGIN_PATHdone_plugins =for(ever) isEmpty(QTC_PLUGIN_DEPENDS): break() done_plugins += $$QTC_PLUGIN_DEPENDS for(dep, QTC_PLUGIN_DEPENDS) dependencies_file = for(dir, QTC_PLUGIN_DIRS) exists($$dir/$$dep/$$dep_dependencies.pri) dependencies_file = $$dir/$$dep/$$dep_dependencies.pri break() isEmpty(dependencies_file): error(Plugin dependency $$dep not found) include($$dependencies_file) LIBS += -l$$qtLibraryName($$QTC_PLUGIN_NAME) QTC_PLUGIN_DEPENDS = $$unique(QTC_PLUGIN_DEPENDS) QTC_PLUGIN_DEPENDS -= $$unique(done_plugins) # å»é‡åç»§ç»­å¾ªç¯ æ ¸å¿ƒæ€æƒ³ï¼šé€šè¿‡æ— é™å¾ªç¯é€å±‚è§£æä¾èµ–ï¼Œæ¯ä¸ªä¾èµ–æ¨¡å—çš„_dependencies.priè¢«includeåï¼Œè‹¥å£°æ˜äº†æ–°ä¾èµ–åˆ™ç»§ç»­è§£æï¼Œç›´è‡³æ‰€æœ‰ä¾èµ–å¤„ç†å®Œæ¯•ã€‚ åº“ä¾èµ–è§£æåŒç†ï¼š done_libs =for(ever) isEmpty(QTC_LIB_DEPENDS): break() done_libs += $$QTC_LIB_DEPENDS for(dep, QTC_LIB_DEPENDS) include($$PWD/src/libs/$$dep/$$dep_dependencies.pri) LIBS += -l$$qtLibraryName($$QTC_LIB_NAME) QTC_LIB_DEPENDS = $$unique(QTC_LIB_DEPENDS) QTC_LIB_DEPENDS -= $$unique(done_libs) 6.8 Qt Creatorå·¥ç¨‹ç»“æ„è§£æQt Creatoræºç é‡‡ç”¨ä¸‰å±‚æ¶æ„ï¼Œæ˜¯å¤§å‹Qté¡¹ç›®çš„ç»å…¸èŒƒä¾‹ï¼š qtcreator/â”œâ”€â”€ src/â”‚ â”œâ”€â”€ libs/ # å…¬å…±åº“å±‚ï¼ˆåŠ¨æ€åº“ï¼‰â”‚ â”‚ â”œâ”€â”€ aggregation/â”‚ â”‚ â”‚ â””â”€â”€ aggregation_dependencies.priâ”‚ â”‚ â”œâ”€â”€ extensionsystem/â”‚ â”‚ â”‚ â””â”€â”€ extensionsystem_dependencies.priâ”‚ â”‚ â””â”€â”€ utils/â”‚ â”œâ”€â”€ plugins/ # æ’ä»¶å±‚ï¼ˆåŠ¨æ€åº“+æ’ä»¶æ¥å£ï¼‰â”‚ â”‚ â”œâ”€â”€ coreplugin/â”‚ â”‚ â”‚ â””â”€â”€ coreplugin_dependencies.priâ”‚ â”‚ â”œâ”€â”€ welcome/â”‚ â”‚ â””â”€â”€ bookmarks/â”‚ â””â”€â”€ app/ # åº”ç”¨å±‚ï¼ˆä¸»ç¨‹åºå…¥å£ï¼‰â”‚ â””â”€â”€ main.cppâ””â”€â”€ qtcreator.pro # é¡¶å±‚subdirså·¥ç¨‹ ä¾èµ–é…ç½®ç¤ºä¾‹ï¼š # extensionsystem_dependencies.priQTC_LIB_NAME = ExtensionSystemQTC_LIB_DEPENDS += aggregation utils# coreplugin_dependencies.priQTC_PLUGIN_NAME = CoreQTC_LIB_DEPENDS += aggregation extensionsystem utils# bookmarks_dependencies.priQTC_PLUGIN_NAME = BookmarksQTC_LIB_DEPENDS += extensionsystem utilsQTC_PLUGIN_DEPENDS += projectexplorer coreplugin texteditor æœ€ä½³å®è·µæ€»ç»“ï¼š åŸåˆ™ è¯´æ˜ å£°æ˜å¼ä¾èµ– æ¯ä¸ªæ¨¡å—é€šè¿‡_dependencies.priå£°æ˜ä¾èµ–ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™LIBS è‡ªåŠ¨é€’å½’è§£æ æ„å»ºç³»ç»Ÿè‡ªåŠ¨å¤„ç†ä¼ é€’ä¾èµ–ï¼Œæ–°å¢æ¨¡å—åªéœ€åˆ›å»ºæè¿°æ–‡ä»¶ å‘½åçº¦å®š ç»Ÿä¸€æ–‡ä»¶å‘½åï¼ˆæ¨¡å—å_dependencies.priï¼‰ç¡®ä¿è‡ªåŠ¨å‘ç° åˆ†å±‚æ¶æ„ libsï¼ˆåŸºç¡€åº“ï¼‰â†’ pluginsï¼ˆåŠŸèƒ½æ’ä»¶ï¼‰â†’ appï¼ˆå…¥å£ï¼‰æ¸…æ™°åˆ†å±‚ ä¸ƒã€é¢„ç¼–è¯‘å¤´æ–‡ä»¶é¢„ç¼–è¯‘å¤´æ–‡ä»¶ï¼ˆPCHï¼‰å°†ç¨³å®šçš„å¤´æ–‡ä»¶é¢„å…ˆç¼–è¯‘ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œæ˜¾è‘—ç¼©çŸ­å¤§å‹é¡¹ç›®çš„ç¼–è¯‘æ—¶é—´ã€‚ 7.1 å¯ç”¨é…ç½®CONFIG += precompile_headerPRECOMPILED_HEADER = $$PWD/stable.h 7.2 é¢„ç¼–è¯‘å¤´æ–‡ä»¶æ¨¡æ¿stable.hç¤ºä¾‹ï¼š #ifndef STABLE_H#define STABLE_H// ===== Cæ ‡å‡†åº“ =====#include cmath#include cstdlib#include ctime// ===== C++æ ‡å‡†åº“ =====#ifdef __cplusplus#include algorithm#include memory#include string#include vector#include map#include functional// ===== Qtæ ¸å¿ƒæ¨¡å— =====#include QtCore#include QtGui#if QT_VERSION = QT_VERSION_CHECK(5, 0, 0)#include QtWidgets#endif// ===== é¡¹ç›®å…¨å±€å® =====// MSVC UTF-8æ”¯æŒ#ifdef _MSC_VER#if _MSC_VER = 1600#pragma execution_character_set(utf-8)#endif#endif// è°ƒè¯•æ—¥å¿—å®#ifdef QT_DEBUG#define LOG_DEBUG(msg) qDebug() [DEBUG] __FILE__ __LINE__ msg#else#define LOG_DEBUG(msg) qt_noop()#endif#endif // __cplusplus#endif // STABLE_H æ€§èƒ½å»ºè®®ï¼šä»…å°†çœŸæ­£ç¨³å®šä¸”é¢‘ç¹ä½¿ç”¨çš„å¤´æ–‡ä»¶æ”¾å…¥PCHã€‚æ¯æ¬¡ä¿®æ”¹PCHä¼šè§¦å‘å®Œå…¨é‡ç¼–è¯‘ã€‚ å…«ã€å®Œæ•´å·¥ç¨‹æ¨¡æ¿ä»¥ä¸‹æ¨¡æ¿æ•´åˆäº†ç”Ÿäº§ç¯å¢ƒå¸¸ç”¨é…ç½®ï¼š #-------------------------------------------------# é¡¹ç›®åŸºæœ¬ä¿¡æ¯#-------------------------------------------------QT += core gui network sql widgetsgreaterThan(QT_MAJOR_VERSION, 4): QT += widgetsTEMPLATE = appTARGET = MyApplicationVERSION = 1.0.0#-------------------------------------------------# ç¼–è¯‘é€‰é¡¹#-------------------------------------------------CONFIG += c++17 warn_on precompile_headerCONFIG -= debug_and_releaseDEFINES += QT_DEPRECATED_WARNINGSDEFINES += APP_VERSION=\\\\\\$$VERSION\\\\\\# é¢„ç¼–è¯‘å¤´æ–‡ä»¶PRECOMPILED_HEADER = $$PWD/stable.h#-------------------------------------------------# ä¸­é—´æ–‡ä»¶ç›®å½•#-------------------------------------------------MOC_DIR = $$OUT_PWD/generated/mocRCC_DIR = $$OUT_PWD/generated/rccUI_DIR = $$OUT_PWD/generated/uiOBJECTS_DIR = $$OUT_PWD/generated/obj#-------------------------------------------------# è¾“å‡ºç›®å½•#-------------------------------------------------CONFIG(debug, debug|release) DESTDIR = $$PWD/bin/debug TARGET = $$TARGET_d else DESTDIR = $$PWD/bin/release#-------------------------------------------------# å¹³å°ç‰¹å®šé…ç½®#-------------------------------------------------win32 RC_ICONS = resources/app.ico QMAKE_CXXFLAGS_WARN_ON += -wd4819 QMAKE_CXXFLAGS += /FS DEFINES += _CRT_SECURE_NO_WARNINGS WIN32_LEAN_AND_MEANmacx ICON = resources/app.icns QMAKE_MACOSX_DEPLOYMENT_TARGET = 10.14unix:!macx QMAKE_CXXFLAGS += -Wextra -Wpedantic#-------------------------------------------------# æºæ–‡ä»¶#-------------------------------------------------HEADERS += \\ stable.h \\ mainwindow.hSOURCES += \\ main.cpp \\ mainwindow.cppFORMS += \\ mainwindow.uiRESOURCES += \\ resources.qrc ä¹ã€å®ç”¨æŠ€å·§9.1 è°ƒè¯•è¾“å‡ºmessage(========== æ„å»ºä¿¡æ¯ ==========)message(Qtç‰ˆæœ¬: $$QT_VERSION)message(ç›®æ ‡å¹³å°: $$QMAKE_HOST.os)message(CPUæ¶æ„: $$QT_ARCH)message(æºç ç›®å½•: $$_PRO_FILE_PWD_)message(æ„å»ºç›®å½•: $$OUT_PWD)message(è¾“å‡ºç›®å½•: $$DESTDIR)message(==============================) 9.2 æ¡ä»¶åŒ…å«# å­˜åœ¨åˆ™åŒ…å«é…ç½®æ–‡ä»¶exists($$PWD/local.pri) include($$PWD/local.pri)# åŒ…å«å…±äº«é…ç½®include($$PWD/../common.pri) 9.3 æ„å»ºæ—¶é—´æˆ³# ç¼–è¯‘æ—¶æ³¨å…¥æ„å»ºæ—¶é—´win32: BUILD_TIME = $$system(echo %DATE% %TIME%)else: BUILD_TIME = $$system(date +%Y-%m-%d %H:%M:%S)DEFINES += BUILD_TIMESTAMP=\\\\\\$$BUILD_TIME\\\\\\ 9.4 è‡ªå®šä¹‰æ„å»ºæ­¥éª¤# ç¼–è¯‘å‰æ‰§è¡ŒQMAKE_PRE_LINK += echo å¼€å§‹ç¼–è¯‘...# ç¼–è¯‘åæ‰§è¡ŒQMAKE_POST_LINK += $$QMAKE_COPY $$OUT_PWD/config.ini $$DESTDIR# è‡ªå®šä¹‰ç›®æ ‡docs.commands = doxygen $$PWD/DoxyfileQMAKE_EXTRA_TARGETS += docs 9.5 å˜é‡æ“ä½œ# è¿½åŠ å€¼SOURCES += newfile.cpp# ç§»é™¤å€¼SOURCES -= oldfile.cpp# å”¯ä¸€è¿½åŠ ï¼ˆé¿å…é‡å¤ï¼‰LIBS *= -lmylib# æ›¿æ¢å€¼SOURCES ~= s/old/new/g# è·å–ç»å¯¹è·¯å¾„ABSOLUTE_PATH = $$absolute_path(../lib) åã€å‚è€ƒèµ„æ–™Qtå®˜æ–¹æ–‡æ¡£ï¼š æ–‡æ¡£ é“¾æ¥ qmakeå®Œæ•´æ‰‹å†Œ https://doc.qt.io/qt-5/qmake-manual.html é¡¹ç›®æ–‡ä»¶è¯­æ³• https://doc.qt.io/qt-5/qmake-language.html å˜é‡å‚è€ƒ https://doc.qt.io/qt-5/qmake-variable-reference.html å‡½æ•°å‚è€ƒ https://doc.qt.io/qt-5/qmake-function-reference.html æµ‹è¯•å‡½æ•° https://doc.qt.io/qt-5/qmake-test-function-reference.html é¢„ç¼–è¯‘å¤´æ–‡ä»¶ https://doc.qt.io/qt-5/qmake-precompiledheaders.html å¹³å°è¯´æ˜ https://doc.qt.io/qt-5/qmake-platform-notes.html åä¸€ã€å°ç»“qmakeé€šè¿‡å£°æ˜å¼çš„.proè¯­æ³•å®ç°è·¨å¹³å°æ„å»ºç®¡ç†ã€‚æŒæ¡ä»¥ä¸‹æ ¸å¿ƒçŸ¥è¯†ç‚¹å³å¯åº”å¯¹ç»å¤§å¤šæ•°é¡¹ç›®éœ€æ±‚ï¼š é¢†åŸŸ å…³é”®ç‚¹ åŸºç¡€é…ç½® TEMPLATEã€QTã€CONFIGã€HEADERSã€SOURCES è·¯å¾„ç®¡ç† PWDã€OUT_PWDã€DESTDIRã€ä¸´æ—¶æ–‡ä»¶ç›®å½• åº“ç®¡ç† INCLUDEPATHã€LIBSã€-Lä¸-lè¯­æ³• æ¡ä»¶ç¼–è¯‘ å¹³å°åˆ¤æ–­ã€ç‰ˆæœ¬åˆ¤æ–­ã€CONFIGDEFINESæ¡ä»¶ å¤šé¡¹ç›® subdirsæ¨¡æ¿ã€.dependsä¾èµ–ã€é™æ€åº“åŠ¨æ€åº“é…ç½® ä¼˜åŒ–æŠ€å·§ é¢„ç¼–è¯‘å¤´æ–‡ä»¶ã€è‡ªå®šä¹‰å‡½æ•°ã€æ„å»ºåå¤„ç† å‘å±•è¶‹åŠ¿ï¼šQt 6èµ·å®˜æ–¹æ¨èä½¿ç”¨CMakeä½œä¸ºæ„å»ºç³»ç»Ÿï¼Œä½†qmakeä»æ˜¯Qt 5é¡¹ç›®çš„ä¸»æµé€‰æ‹©ï¼Œä¸”åœ¨ç®€å•é¡¹ç›®ä¸­é…ç½®æ›´ç®€æ´ã€‚æ–°é¡¹ç›®å¯è€ƒè™‘é‡‡ç”¨CMakeä»¥è·å¾—æ›´å¥½çš„IDEé›†æˆå’Œç°ä»£C++æ”¯æŒã€‚","tags":["Qt","æ„å»ºç³»ç»Ÿ","é¡¹ç›®ç®¡ç†","qmake"],"categories":["3.å¼€å‘æ¡†æ¶","Qt","Publish"]},{"title":"QTç•Œé¢ä¸é€»è¾‘åˆ†ç¦»","path":"/2025/12/30/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qt-ç•Œé¢ä¸é€»è¾‘åˆ†ç¦»/","content":"QT ç•Œé¢ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»Qt å¼€å‘çš„ä¸€ä¸ªæ ¸å¿ƒç†å¿µï¼šUI å½’ UIï¼Œé€»è¾‘å½’é€»è¾‘ï¼Œåˆ«æ··åœ¨ä¸€èµ·å†™ã€‚ è¿™ä¹ˆåšæœ‰å‡ ä¸ªå®æ‰“å®çš„å¥½å¤„ï¼š äº’ä¸å¹²æ‰°ï¼šæ”¹ç•Œé¢ä¸æ€•æŠŠä¸šåŠ¡æå´©ï¼Œåè¿‡æ¥ä¹Ÿä¸€æ ·ã€‚ å¹¶è¡Œå¼€å‘ï¼šUI å’Œé€»è¾‘èƒ½åˆ†å¤´å¼€å‘ï¼Œæ•ˆç‡ç¿»å€ã€‚ æ˜“äºæµ‹è¯•ï¼šä¸šåŠ¡é€»è¾‘å¯ä»¥å•ç‹¬å†™å•å…ƒæµ‹è¯•ï¼Œä¸ç”¨ä¾èµ–ç•Œé¢ç»„ä»¶ã€‚ å¤ç”¨æ€§å¼ºï¼šç•Œé¢ç»„ä»¶èƒ½å¤ç”¨ï¼Œæ¢è‚¤ä¹Ÿå®¹æ˜“ã€‚ åŸºæœ¬æ¶æ„ä¸€ä¸ªå…¸å‹çš„ç¨‹åºä¸€èˆ¬åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š æ¨¡å— èŒè´£ ç”¨æˆ·ç•Œé¢æ¨¡å—ï¼ˆUIï¼‰ æ¥æ”¶ç”¨æˆ·è¾“å…¥ã€å±•ç¤ºæ•°æ® ä¸šåŠ¡é€»è¾‘æ¨¡å— æ ¹æ®ç”¨æˆ·éœ€æ±‚å¤„ç†æ•°æ® è¿™ä¸¤å—å¿…é¡»è§£è€¦ï¼Œä¸èƒ½è®©ç•Œé¢ä»£ç ç›´æ¥è°ƒä¸šåŠ¡é€»è¾‘ï¼Œä¹Ÿä¸èƒ½è®©ä¸šåŠ¡é€»è¾‘å»æ“ä½œç•Œé¢æ§ä»¶ã€‚ è®¾è®¡åŸåˆ™å¼ºå†…èšã€å¼±è€¦åˆï¼Œè¿™å…­ä¸ªå­—è¦åˆ»è„‘å­é‡Œï¼š å•ä¸€èŒè´£ï¼šæ¯ä¸ªæ¨¡å—åªå¹²ä¸€ä»¶äº‹ã€‚ æ¨¡å—ç»„æˆï¼šæ¨¡å—å†…éƒ¨çš„å­æ¨¡å—åªä¸ºæ•´ä½“çš„å•ä¸€åŠŸèƒ½æœåŠ¡ã€‚ äº¤äº’è§„åˆ™ï¼šæ¨¡å—ä¹‹é—´é€šè¿‡çº¦å®šå¥½çš„æ¥å£äº¤äº’ã€‚ å•å‘ä¾èµ–ï¼šA ä¾èµ– B å¯ä»¥ï¼Œä½† A å’Œ B äº’ç›¸ä¾èµ–å°±æ˜¯è®¾è®¡é—®é¢˜ã€‚ å¾ªç¯ä¾èµ–æ˜¯ç³Ÿç³•è®¾è®¡çš„å…¸å‹æ ‡å¿—ä¹‹ä¸€ï¼Œå¿…é¡»é¿å…ã€‚ ä»€ä¹ˆæ˜¯æ¥å£ï¼Ÿ å¹¿ä¹‰ä¸Šï¼šæ¥å£æ˜¯æ¨¡å—ä¹‹é—´çš„ä¸€ç§â€å¥‘çº¦â€ã€‚ C++ ä¸­ï¼šé€šå¸¸æ˜¯åªåŒ…å«å…¬å¼€çº¯è™šå‡½æ•°çš„æŠ½è±¡ç±»ã€‚ å®ç°åŸåˆ™ï¼šå¿…é¡»æœ‰æ¨¡å—å®ç°å¯¹åº”çš„æ¥å£ã€‚ Qt å¼€å‘çš„ä¸‰ç§æ¨¡å¼æ ¹æ®é¡¹ç›®éœ€æ±‚ï¼Œå¸¸è§çš„å¼€å‘æ¨¡å¼æœ‰ä¸‰ç§ï¼š 1. çº¯ä»£ç æ¨¡å¼ç”¨ QWidget çº¯æ‰‹å†™ç•Œé¢ï¼ŒQSS åšæ ·å¼ï¼ŒC++ å†™é€»è¾‘ã€‚ ä¼˜ç‚¹ï¼šçµæ´»ï¼Œå•¥éƒ½èƒ½æ§åˆ¶ã€‚ ç¼ºç‚¹ï¼šä»£ç é‡å¤§ï¼Œå¤æ‚ç•Œé¢å†™èµ·æ¥ç´¯ã€‚ 2. Qt Designer æ¨¡å¼æ‹–æ§ä»¶ç”»ç•Œé¢ï¼ˆç±»ä¼¼ MFCWinFormï¼‰ï¼Œç”Ÿæˆ .ui æ–‡ä»¶ï¼ŒQSS ç¾åŒ–ï¼ŒC++ å†™é€»è¾‘ã€‚ ç°çŠ¶ï¼šè¿™æ˜¯ç°åœ¨å¤§éƒ¨åˆ†å…¬å¸çš„é€‰æ‹©ï¼Œå¼€å‘æ•ˆç‡é«˜ï¼Œä¸Šæ‰‹ä¹Ÿå¿«ã€‚ 3. QML æ··åˆæ¨¡å¼QML åš UIã€JavaScript å†™äº¤äº’ã€C++ å†™åå°ï¼Œä¸‰ç§è¯­è¨€æ··åˆã€‚ é€‚ç”¨åœºæ™¯ï¼šé€‚åˆåšç°ä»£åŒ–ã€åŠ¨æ•ˆå¤šçš„ç•Œé¢ï¼ˆæ¯”å¦‚ç§»åŠ¨ç«¯æˆ–åµŒå…¥å¼å¤§å±ï¼‰ï¼Œç°åœ¨ç”¨çš„è¶Šæ¥è¶Šå¤šã€‚ åˆ†ç¦»çš„æ ¸å¿ƒæ–¹æ³•1. ä¿¡å·ä¸æ§½ (Signals Slots)Qt çš„æ‹›ç‰Œæœºåˆ¶ï¼Œå¤©ç„¶é€‚åˆåšè§£è€¦ã€‚ ç•Œé¢åªç®¡å‘ä¿¡å·ï¼šç”¨æˆ·ç‚¹äº†æŒ‰é’®ã€è¾“å…¥äº†æ–‡å­—ï¼Œé€»è¾‘å±‚è¿ä¸Šæ§½å‡½æ•°å¤„ç†ã€‚ä¸¤è¾¹ä¸ç›´æ¥è°ƒç”¨ï¼Œé€šè¿‡ä¿¡å·æ§½æ²Ÿé€šã€‚ // ç•Œé¢åªç®¡å‘ä¿¡å·emit calculateClicked(expression);// é€»è¾‘å±‚æˆ–è€…æ§åˆ¶å±‚è¿æ¥connect(ui, CalcUI::calculateClicked, this, CalcLogic::doCalculate); è¿™ç§æœºåˆ¶è¿˜å¤©ç„¶æ”¯æŒè·¨çº¿ç¨‹ï¼Œåšå¼‚æ­¥æ“ä½œæå…¶æ–¹ä¾¿ã€‚ 2. MVC ä¸ MVVM æ¨¡å¼MVC (Model-View-Controller) æ˜¯ç»å…¸çš„åˆ†å±‚æ¶æ„ï¼ŒQt å®˜æ–¹ä¹Ÿéå¸¸æ¨èã€‚ è§’è‰² èŒè´£ Qt ä¸­çš„ä½“ç° Model æ•°æ®å’Œä¸šåŠ¡é€»è¾‘ QAbstractListModel, QAbstractTableModel View ç•Œé¢å±•ç¤º QListView, QTableView Controller åè°ƒ M å’Œ V ä¿¡å·æ§½è¿æ¥ ç‹¬ç«‹çš„æ§åˆ¶å™¨ç±» å…³äº Controller çš„è¡¥å……åœ¨ Qt ç®€å•åº”ç”¨ä¸­ï¼ŒController å¾€å¾€æ˜¯ä¸æ˜æ˜¾çš„ã€‚æˆ‘ä»¬ç»é€šè¿‡ä¿¡å·ä¸æ§½ç›´æ¥è¿æ¥ View å’Œ Modelï¼Œæˆ–è€…åœ¨ View çš„é€»è¾‘é‡Œç®€å•å¤„ç†ä¸€ä¸‹ã€‚ä½†åœ¨å¤æ‚ä¸šåŠ¡ä¸­ï¼Œå»ºè®®æ˜¾å¼å®šä¹‰ä¸€ä¸ª Controller ç±»ï¼ˆæˆ–è€…å« Presenterï¼‰ï¼Œä¸“é—¨è´Ÿè´£å¤„ç† View çš„ä¿¡å·ï¼Œè°ƒç”¨ Model çš„æ¥å£ï¼Œå†æŠŠç»“æœåé¦ˆç»™ Viewã€‚è¿™æ · View å°±å½»åº•æˆäº†â€œå“‘å·´ç»„ä»¶â€ï¼Œåªè´Ÿè´£æ˜¾ç¤ºï¼Œä¸å«ä»»ä½•é€»è¾‘ã€‚ MVVM (Model-View-ViewModel)MVVM å¯ä»¥çœ‹ä½œ MVC çš„å˜ç§ï¼Œç‰¹åˆ«é€‚åˆæ•°æ®é©±åŠ¨çš„ UIã€‚ ViewModelï¼šä½œä¸º View çš„æ›¿èº«ï¼ŒæŒæœ‰æ•°æ®çŠ¶æ€ã€‚View å’Œ ViewModel ä¹‹é—´é€šè¿‡åŒå‘ç»‘å®šï¼ˆQt WebAssembly æˆ– QML ä¸­å¾ˆå¸¸ç”¨ï¼‰è‡ªåŠ¨åŒæ­¥ã€‚ åœ¨ QML å¼€å‘ä¸­ï¼ŒMVVM æ˜¯ä¸»æµæ¨¡å¼ã€‚ MVC ä»£ç ç®€ä¾‹ï¼š // Modelï¼šæä¾›æ•°æ®ï¼Œä¸çŸ¥é“ View çš„å­˜åœ¨class MyModel : public QAbstractListModel // ... å®ç° rowCount, data ç­‰æ ‡å‡†æ¥å£;// Viewï¼šå±•ç¤ºç•Œé¢ï¼Œä¸ä»…é™äº QListViewclass MyView : public QWidget // ... void setModel(QAbstractItemModel *model) m_listView-setModel(model); signals: // View å¹¶ä¸ç›´æ¥æ”¹æ•°æ®ï¼Œè€Œæ˜¯æŠŠç”¨æˆ·æ“ä½œå‘å‡ºå» void itemClicked(const QModelIndex index);;// Controllerï¼šè´Ÿè´£ç»„è£…class MyController : public QObject MyModel *m_model; MyView *m_view;public: MyController(MyModel *m, MyView *v) : m_model(m), m_view(v) // è¿æ¥ View çš„æ“ä½œåˆ°å†…éƒ¨é€»è¾‘ connect(m_view, MyView::itemClicked, this, MyController::handleItemClick); ; 3. æ¥å£æŠ½è±¡ç»™ä¸šåŠ¡é€»è¾‘å®šä¸€ä¸ªçº¯è™šæ¥å£ï¼Œç•Œé¢åªä¾èµ–æ¥å£ï¼Œä¸ç®¡å…·ä½“å®ç°ã€‚ // æ¥å£å®šä¹‰class ICalculator public: virtual bool expression(const QString exp) = 0; virtual QString result() = 0; virtual ~ICalculator() = default;;// ç•Œé¢ç±»åªè®¤æ¥å£class CalcUI ICalculator* m_logic;public: void setLogic(ICalculator* logic) m_logic = logic; void onButtonClick() // ç•Œé¢ä¸çŸ¥é“é€»è¾‘æ˜¯è°å®ç°çš„ï¼ŒåªçŸ¥é“å®ƒèƒ½ç®— expression m_logic-expression(1+1); ; å¥½å¤„ï¼šå“ªå¤©ä½ æƒ³æ¢ä¸ªç®—æ³•åº“ï¼Œæˆ–è€…æŠŠæœ¬åœ°è®¡ç®—æ”¹æˆäº‘ç«¯è®¡ç®—ï¼Œç•Œé¢ä»£ç ä¸€è¡Œéƒ½ä¸ç”¨åŠ¨ã€‚ 4. ç»§æ‰¿å°è£…æœ€åŸºç¡€çš„åšæ³•ï¼šè‡ªå®šä¹‰çª—å£ç±»ç»§æ‰¿ QWidgetï¼Œç•Œé¢åˆå§‹åŒ–å°è£…æˆ initUI() æ–¹æ³•ï¼Œä¸šåŠ¡é€»è¾‘æ”¾å¦ä¸€ä¸ªç±»ã€‚ class MyWindow : public QWidget public: MyWindow(QWidget* parent = nullptr) : QWidget(parent) initUI(); private: void initUI(); // åªç®¡ç•Œé¢å¸ƒå±€; 5. QSS æ ·å¼åˆ†ç¦»æ ·å¼ä»£ç ï¼ˆé¢œè‰²ã€å­—ä½“ã€è¾¹æ¡†ç­‰ï¼‰å†™åˆ°å•ç‹¬çš„ .qss æ–‡ä»¶ï¼Œç¨‹åºè¿è¡Œæ—¶åŠ è½½ã€‚ QFile file(:/styles/dark.qss);file.open(QFile::ReadOnly);qApp-setStyleSheet(file.readAll()); æ¢è‚¤åªè¦æ¢åŠ è½½çš„æ–‡ä»¶ï¼Œä»£ç ä¸ç”¨åŠ¨ã€‚è¿™å’Œ Web å¼€å‘é‡Œçš„ CSS æ˜¯ä¸€æ ·çš„é“ç†ã€‚ å®Œæ•´ç¤ºä¾‹ï¼šå››å±‚æ¶æ„çš„è®¡ç®—å™¨æŠŠä¸Šé¢çš„æ–¹æ³•ç»„åˆèµ·æ¥ï¼Œä¸€ä¸ªå…¸å‹çš„ç”Ÿäº§çº§æ¶æ„ï¼š graph TD UI[QCalculatorUI ç•Œé¢å±‚] --|ä¾èµ–| I[ICalculator æ¥å£å±‚] L[QCalculatorDec é€»è¾‘å±‚] --|å®ç°| I C[QCalculator ç»„è£…å±‚/Controller] --|æŒæœ‰| UI C --|æŒæœ‰| L 1. æ¥å£å±‚å®šä¹‰â€å¥‘çº¦â€ï¼Œä¸åŒ…å«ä»»ä½•å®ç°ã€‚ class ICalculator public: virtual bool expression(const QString exp) = 0; virtual QString result() = 0;; 2. é€»è¾‘å±‚å®ç°å…·ä½“çš„ä¸šåŠ¡ï¼Œå®Œå…¨ä¸å¼•ç”¨ä»»ä½• UI ç›¸å…³çš„åº“ï¼ˆå¦‚ UIKitQtWidgetsï¼‰ï¼Œåªä¾èµ– QtCore æˆ–æ ‡å‡†åº“ã€‚ class QCalculatorDec : public ICalculator QString m_result;public: bool expression(const QString exp) override // è§£æè¡¨è¾¾å¼ã€è®¡ç®—... m_result = 42; return true; QString result() override return m_result; ; 3. ç•Œé¢å±‚åªè´Ÿè´£ç”»å›¾å’Œå“åº”ç”¨æˆ·è¾“å…¥ï¼Œé€šè¿‡æ¥å£è°ƒç”¨åŠŸèƒ½ã€‚ class QCalculatorUI : public QWidget ICalculator* m_calc; // åªä¾èµ–æ¥å£public: void setCalculator(ICalculator* calc) m_calc = calc; void onCalculate() // åªè¦æ¥å£æ²¡å˜ï¼Œè¿™é‡Œæ°¸è¿œå®‰å…¨ if (m_calc-expression(m_input-text())) m_output-setText(m_calc-result()); ; 4. ç»„è£…å±‚ (AppMainController)è´Ÿè´£æŠŠé›¶æ•£çš„éƒ¨ä»¶æ‹¼è£…åœ¨ä¸€èµ·ã€‚ class QCalculator protected: QCalculatorUI* m_ui; QCalculatorDec m_cal; // å…·ä½“çš„é€»è¾‘å®ç°public: QCalculator() m_ui = new QCalculatorUI; // æŠŠé€»è¾‘æ³¨å…¥ç»™ UI m_ui-setCalculator(m_cal); void show() m_ui-show(); ~QCalculator() delete m_ui; ; å°ç»“ æ¥å£æ˜¯å¥‘çº¦ï¼šæ¨¡å—äº¤äº’èµ°æ¥å£ï¼Œåˆ«èµ°åé—¨ã€‚ å•å‘ä¾èµ–ï¼šUI ä¾èµ–é€»è¾‘æ¥å£ï¼Œé€»è¾‘ä¸ä¾èµ– UIã€‚ å¼ºå†…èšã€å¼±è€¦åˆï¼šè¿™æ˜¯ä¸‡é‡‘æ²¹åŸåˆ™ã€‚ åˆšå¼€å§‹å†™å° Demo å¯èƒ½è§‰å¾—è¿™ä¹ˆæ‹†å¾ˆéº»çƒ¦ï¼Œæ²¡å¿…è¦ã€‚ä½†ç­‰ä»£ç è¶…è¿‡å‡ åƒè¡Œï¼Œæˆ–è€…éœ€æ±‚å¼€å§‹é¢‘ç¹å˜æ›´æ—¶ï¼ˆæ¯”å¦‚è€æ¿ä»Šå¤©è¯´è¦æ¢ä¸ªçš®è‚¤ï¼Œæ˜å¤©è¯´ç®—æ³•è¦å‡çº§ï¼‰ï¼Œä½ ä¼šæ„Ÿè°¢å½“åˆåšäº†åˆ†ç¦»çš„è‡ªå·±ã€‚","categories":["3.å¼€å‘æ¡†æ¶","Qt","Publish"]},{"title":"Porkbun åŸŸåè´­ä¹°ä¸é…ç½®æŒ‡å—","path":"/2025/12/29/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-PorkbunåŸŸåé…ç½®æŒ‡å—/","content":"Porkbun åŸŸåè´­ä¹°ä¸é…ç½®è¯¦ç»†æŒ‡å—æœ¬æ–‡æ¡£æ—¨åœ¨ä¸ºæ–°æ‰‹æä¾›è¯¦ç»†çš„æ­¥éª¤ï¼ŒæŒ‡å¯¼å¦‚ä½•åœ¨ Porkbun è´­ä¹°åŸŸåã€é…ç½® DNS è§£æåˆ°æ‚¨çš„æœåŠ¡å™¨ï¼Œå¹¶é…ç½® SSL åŠ å¯†è¯ä¹¦ã€‚ 1. è´­ä¹°åŸŸåPorkbun æ˜¯ä¸€å®¶å£ç¢‘æä½³çš„åŸŸåæ³¨å†Œå•†ï¼Œä»·æ ¼é€æ˜ï¼Œä¸”å…è´¹æä¾› WHOIS éšç§ä¿æŠ¤ã€‚ æ­¥é©Ÿæµç¨‹ è®¿é—®å®˜ç½‘ï¼šæ‰“å¼€ https://porkbun.com/ã€‚ æœç´¢åŸŸåï¼š åœ¨é¦–é¡µå·¨å¤§çš„æœç´¢æ¡†ä¸­ï¼Œè¾“å…¥æ‚¨å¿ƒä»ªçš„åŸŸåï¼ˆä¾‹å¦‚ my-awesome-blog.comï¼‰ã€‚ ç‚¹å‡»æœç´¢å›¾æ ‡ã€‚ é€‰æ‹©åŸŸåï¼š ç³»ç»Ÿä¼šåˆ—å‡ºæœç´¢ç»“æœã€‚å¦‚æœåŸŸåå¯ç”¨ï¼Œä¼šæ˜¾ç¤ºç»¿è‰²çš„ + å·å’Œä»·æ ¼ã€‚ ç‚¹å‡» + å·å°†åŸŸåæ·»åŠ åˆ°è´­ç‰©è½¦ï¼ˆCheckoutï¼‰ã€‚ ç»“è´¦ï¼ˆCheckoutï¼‰ï¼š ç‚¹å‡»å³ä¸Šè§’çš„è´­ç‰©è½¦å›¾æ ‡ï¼Œé€‰æ‹© Checkoutã€‚ æ³¨å†Œç™»å½•è´¦å·ï¼š å¦‚æœæ˜¯æ–°ç”¨æˆ·ï¼Œåœ¨å¼¹å‡ºçš„çª—å£å¡«å†™é‚®ç®±å’Œå¯†ç è¿›è¡Œæ³¨å†Œï¼ˆéœ€éªŒè¯é‚®ç®±ï¼‰ã€‚ è€ç”¨æˆ·ç›´æ¥ç™»å½•ã€‚ ç¡®è®¤è®¢å•ï¼š æ£€æŸ¥å¹´é™ï¼ˆé»˜è®¤ 1 å¹´ï¼‰ã€‚ Auto Renewï¼ˆè‡ªåŠ¨ç»­è´¹ï¼‰ï¼šå»ºè®®å¼€å¯ï¼Œé˜²æ­¢åŸŸåè¿‡æœŸè¢«æŠ¢æ³¨ã€‚ WHOIS Privacyï¼ˆéšç§ä¿æŠ¤ï¼‰ï¼šé»˜è®¤å¼€å¯ï¼ˆå…è´¹ï¼‰ï¼Œå¼ºçƒˆå»ºè®®ä¿æŒå¼€å¯ï¼Œä¿æŠ¤ä¸ªäººä¿¡æ¯ã€‚ æ”¯ä»˜ï¼š ç‚¹å‡» Continue to Billingã€‚ Porkbun æ”¯æŒ **æ”¯ä»˜å® (Alipay)**ã€å¾®ä¿¡æ”¯ä»˜ã€ä¿¡ç”¨å¡ã€PayPal ç­‰å¤šç§æ–¹å¼ã€‚ å¯¹äºå›½å†…ç”¨æˆ·ï¼Œç›´æ¥é€‰æ‹© Alipay æ‰«ç æ”¯ä»˜æœ€æ–¹ä¾¿ã€‚ å®Œæˆï¼šæ”¯ä»˜æˆåŠŸåï¼Œæ‚¨ä¼šæ”¶åˆ°é‚®ä»¶ç¡®è®¤ï¼Œç‚¹å‡»å³ä¸Šè§’ Account - Domain Management å³å¯çœ‹åˆ°åˆšè´­ä¹°çš„åŸŸåã€‚ 2. é…ç½®åŸŸåè§£æ (DNS)è¿™ä¸€æ­¥æ˜¯å°†æ‚¨çš„åŸŸåï¼ˆå¦‚ example.comï¼‰æŒ‡å‘æ‚¨çš„æœåŠ¡å™¨ IP åœ°å€ï¼ˆå¦‚ 123.45.67.89ï¼‰ã€‚ å‡†å¤‡å·¥ä½œ è·å–æ‚¨ VPS æœåŠ¡å™¨çš„ å…¬ç½‘ IP åœ°å€ã€‚ é…ç½®æ­¥éª¤ ç™»å½• Porkbunï¼Œç‚¹å‡»å³ä¸Šè§’ Account - Domain Managementã€‚ æ‰¾åˆ°æ‚¨çš„åŸŸåï¼Œç‚¹å‡»åŸŸåå³ä¾§çš„ Detailsï¼ˆè¯¦æƒ…ï¼‰æŒ‰é’®å±•å¼€èœå•ã€‚ æ‰¾åˆ° DNS RECORDS ä¸€æ ï¼Œç‚¹å‡»ä¸‹æ–¹çš„ Editï¼ˆç¼–è¾‘ï¼‰é“¾æ¥ã€‚ åˆ é™¤é»˜è®¤è®°å½•ï¼ˆå¦‚æœæœ‰ï¼‰ï¼š å¦‚æœçœ‹åˆ°æŒ‡å‘ pixie.porkbun.com æˆ–å…¶ä»–åœè½¦é¡µé¢çš„è®°å½•ï¼Œè¯·ç‚¹å‡»åƒåœ¾æ¡¶å›¾æ ‡åˆ é™¤ï¼Œä»¥å…å†²çªã€‚ æ·»åŠ  A è®°å½•ï¼ˆæŒ‡å‘ä¸»åŸŸåï¼‰ï¼š Type: é€‰æ‹© A - Address record Host: è¾“å…¥ @ ï¼ˆä»£è¡¨ä¸»åŸŸåï¼Œå¦‚ example.comï¼‰ Answer: è¾“å…¥æ‚¨çš„ æœåŠ¡å™¨ IP åœ°å€ TTL: é»˜è®¤å³å¯ï¼ˆ600ï¼‰ ç‚¹å‡» Add æŒ‰é’®ã€‚ æ·»åŠ  CNAME è®°å½•ï¼ˆæŒ‡å‘ www å­åŸŸåï¼Œå¯é€‰ï¼‰ï¼š å¦‚æœæ‚¨å¸Œæœ›ç”¨æˆ·é€šè¿‡ www.example.com ä¹Ÿèƒ½è®¿é—®ï¼š Type: é€‰æ‹© CNAME - Canonical Name record Host: è¾“å…¥ www Answer: è¾“å…¥æ‚¨çš„åŸŸåï¼ˆå¦‚ example.comï¼‰æˆ–ç›´æ¥å¡« @ (è§†ç•Œé¢æç¤ºæ”¯æŒæƒ…å†µï¼ŒPorkbuné€šå¸¸å¡«åŸŸå) ç‚¹å‡» Addã€‚ æç¤ºï¼šDNS ä¿®æ”¹åéœ€è¦ä¸€å®šæ—¶é—´åœ¨å…¨çƒç”Ÿæ•ˆï¼ˆé€šå¸¸å‡ åˆ†é’Ÿåˆ° 1 å°æ—¶ï¼Œæœ€é•¿ 48 å°æ—¶ï¼‰ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ ping example.com å‘½ä»¤æ£€æŸ¥æ˜¯å¦å·²è§£æåˆ°æ‚¨çš„ IPã€‚ 3. é…ç½® SSL åŠ å¯†è¯ä¹¦ä¸ºäº†è®©æ‚¨çš„ç½‘ç«™æ”¯æŒ HTTPSï¼ˆå°é”å¤´æ ‡å¿—ï¼‰ï¼Œä¿è¯æ•°æ®ä¼ è¾“å®‰å…¨ï¼Œéœ€è¦é…ç½® SSL è¯ä¹¦ã€‚ æ–¹æ¡ˆ Aï¼šä½¿ç”¨ Porkbun å…è´¹è¯ä¹¦ï¼ˆæ¨èç”¨äºç‹¬ç«‹ VPSï¼‰Porkbun æä¾›å…è´¹çš„ Letâ€™s Encrypt è¯ä¹¦ï¼Œæ‚¨å¯ä»¥ä¸‹è½½å¹¶åœ¨ NginxApache ä¸­é…ç½®ã€‚ ä¸‹è½½è¯ä¹¦ï¼š åœ¨ Domain Management é¡µé¢ï¼Œç‚¹å‡»åŸŸåå³ä¾§çš„ Detailsã€‚ æ‰¾åˆ° SSL ä¸€æ ã€‚Porkbun åˆ†ä¸º â€œBUNâ€ (Porkbun æ‰˜ç®¡) å’Œ â€œExternalâ€ (å¤–éƒ¨ä¸»æœº)ã€‚ å¦‚æœæ˜¯å¤–éƒ¨ VPSï¼Œç‚¹å‡» SSL å³ä¾§çš„ Download SSL Bundleï¼ˆå¦‚æœè¿˜æ²¡ç”Ÿæˆï¼Œå¯èƒ½éœ€è¦ç­‰å¾…ä¸€ä¸¤ä¸ªå°æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œæˆ–è€…æ‰‹åŠ¨ç‚¹å‡»ç”Ÿæˆï¼‰ã€‚ ä¸‹è½½åè§£å‹ï¼Œæ‚¨ä¼šå¾—åˆ° 4 ä¸ªæ–‡ä»¶ï¼Œä¸»è¦ç”¨åˆ°ï¼š private.key.pem (ç§é’¥) domain.cert.pem (åŸŸåè¯ä¹¦) intermediate.cert.pem (ä¸­é—´è¯ä¹¦) public.key.pem (å…¬é’¥ï¼Œé€šå¸¸ä¸ç”¨å•ç‹¬é…) ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼š ä½¿ç”¨ SSH è¿æ¥åˆ°æœåŠ¡å™¨ã€‚ åˆ›å»ºå­˜æ”¾è¯ä¹¦çš„ç›®å½•ï¼šmkdir -p /etc/nginx/ssl/yourdomain.com å°† private.key.pem å’Œ domain.cert.pem ä¸Šä¼ åˆ°è¯¥ç›®å½•ï¼ˆå¯ä»¥ä½¿ç”¨ SCP æˆ– SFTP å·¥å…·ï¼‰ã€‚ **é…ç½® Web æœåŠ¡å™¨ (ä»¥ Nginx ä¸ºä¾‹)**ï¼š ç¼–è¾‘ Nginx é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸åœ¨ /etc/nginx/sites-available/default æˆ– /etc/nginx/conf.d/your_site.confï¼‰ã€‚ æ·»åŠ  SSL é…ç½®ï¼šserver listen 443 ssl; server_name example.com www.example.com; # æ›¿æ¢ä¸ºæ‚¨çš„åŸŸå # SSL è¯ä¹¦è·¯å¾„ ssl_certificate /etc/nginx/ssl/yourdomain.com/domain.cert.pem; ssl_certificate_key /etc/nginx/ssl/yourdomain.com/private.key.pem; # æ¨èçš„å®‰å…¨è®¾ç½® ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers HIGH:!aNULL:!MD5; location / # æ‚¨çš„åå‘ä»£ç†æˆ–é™æ€æ–‡ä»¶é…ç½® proxy_pass http://127.0.0.1:3000; # å‡è®¾æ‚¨çš„åº”ç”¨è¿è¡Œåœ¨ 3000 ç«¯å£ # å¼ºåˆ¶ HTTP è·³è½¬ HTTPSserver listen 80; server_name example.com www.example.com; return 301 https://$host$request_uri; é‡å¯ Nginxï¼š æ£€æŸ¥é…ç½®ï¼šnginx -t é‡å¯æœåŠ¡ï¼šsystemctl restart nginx æ–¹æ¡ˆ Bï¼šä½¿ç”¨ Cloudflare (æ›´ç®€å•ï¼Œå…¼å…· CDN åŠ é€Ÿ)å¦‚æœæ‚¨ä¸æƒ³æ‰‹åŠ¨ç®¡ç†è¯ä¹¦æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ Cloudflareã€‚ æ³¨å†Œå¹¶ç™»å½• Cloudflareã€‚ ç‚¹å‡» Add a Siteï¼Œè¾“å…¥æ‚¨çš„åŸŸåã€‚ é€‰æ‹© Freeï¼ˆå…è´¹ï¼‰è®¡åˆ’ã€‚ Cloudflare ä¼šæ‰«ææ‚¨ç°æœ‰çš„ DNS è®°å½•ï¼ˆç¡®è®¤åˆšæ‰åœ¨ Porkbun è®¾ç½®çš„ A è®°å½•éƒ½åœ¨ï¼‰ã€‚ **ä¿®æ”¹ Nameservers (NS)**ï¼š Cloudflare ä¼šç»™å‡ºä¸¤ä¸ª Nameserversï¼ˆä¾‹å¦‚ amy.ns.cloudflare.comï¼‰ã€‚ å›åˆ° Porkbun Domain Managementã€‚ ç‚¹å‡» Details - æ‰¾åˆ° AUTHORITATIVE NAMESERVERS - ç‚¹å‡» Editã€‚ å°† Porkbun é»˜è®¤çš„ NS åˆ é™¤ï¼Œå¡«å…¥ Cloudflare æä¾›çš„ä¸¤ä¸ª NS åœ°å€ã€‚ ä¿å­˜ã€‚ å¼€å¯ SSLï¼š åœ¨ Cloudflare åå°ï¼Œç‚¹å‡» SSLTLSã€‚ å°†æ¨¡å¼è®¾ç½®ä¸º Full (å¦‚æœæœåŠ¡å™¨æœ‰è‡ªç­¾åè¯ä¹¦) æˆ– Flexible (å¦‚æœæœåŠ¡å™¨åªå¼€äº† HTTP 80 ç«¯å£)ã€‚ æ³¨æ„ï¼šä¸ºäº†å®‰å…¨ï¼Œå»ºè®®æœåŠ¡å™¨ç«¯å³ä½¿æ²¡æœ‰å…¬ç½‘è¯ä¹¦ï¼Œä¹Ÿæœ€å¥½é…ç½®è‡ªç­¾åè¯ä¹¦å¹¶ä½¿ç”¨ Full æ¨¡å¼ã€‚å¦‚æœå®Œå…¨ä¸æƒ³é…ç½®æœåŠ¡å™¨ SSLï¼Œä½¿ç”¨ Flexible æ¨¡å¼å³å¯å®ç° æµè§ˆå™¨ - Cloudflare (HTTPS) - æœåŠ¡å™¨ (HTTP)ã€‚ å¸¸è§é—®é¢˜ Q: åŸŸåè´­ä¹°åå¤šä¹…èƒ½ç”¨ï¼Ÿ A: è´­ä¹°ç«‹å³æˆåŠŸã€‚DNS è§£æè®¾ç½®åï¼Œé€šå¸¸ 10 åˆ†é’Ÿå†…ç”Ÿæ•ˆï¼Œä¸ªåˆ«åœ°åŒºå¯èƒ½éœ€è¦æ›´ä¹…ã€‚ Q: Porkbun SSL è¯ä¹¦è¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ A: Porkbun çš„è¯ä¹¦æ˜¯ Letâ€™s Encrypt çš„ï¼Œæœ‰æ•ˆæœŸ 90 å¤©ã€‚å¦‚æœæ‚¨ä½¿ç”¨é€šè¿‡ API çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå¦‚ acme.shï¼‰ï¼Œå¯ä»¥è‡ªåŠ¨ç»­æœŸã€‚å¦‚æœæ˜¯æ‰‹åŠ¨ä¸‹è½½ä¸Šä¼ çš„ï¼ˆå¦‚æ–¹æ¡ˆ Aï¼‰ï¼Œæ¯ 3 ä¸ªæœˆé€šè¿‡ Porkbun åå°é‡æ–°ä¸‹è½½å¹¶è¦†ç›–ä¸€æ¬¡ç•¥æ˜¾éº»çƒ¦ã€‚æ¨èé•¿æœŸä½¿ç”¨æ–¹æ¡ˆ B (Cloudflare) æˆ–è€…åœ¨æœåŠ¡å™¨ä¸Šç›´æ¥ä½¿ç”¨ certbot ç”³è¯·è¯ä¹¦å®ç°è‡ªåŠ¨ç»­æœŸã€‚ é™„ï¼šä½¿ç”¨ Certbot åœ¨æœåŠ¡å™¨è‡ªåŠ¨ç”³è¯·è¯ä¹¦ï¼ˆæ›¿ä»£æ–¹æ¡ˆ Aï¼‰å¦‚æœå«Œæ‰‹åŠ¨ä¸‹è½½ä¸Šä¼ éº»çƒ¦ï¼Œå¯ä»¥ç›´æ¥åœ¨ VPS ä¸Šè¿è¡Œï¼š # 1. å®‰è£… snapd (Ubuntu/Debian)sudo apt updatesudo apt install snapdsudo snap install core; sudo snap refresh core# 2. å®‰è£… certbotsudo snap install --classic certbotsudo ln -s /snap/bin/certbot /usr/bin/certbot# 3. è‡ªåŠ¨ç”Ÿæˆ Nginx é…ç½®å¹¶ç”³è¯·è¯ä¹¦sudo certbot --nginx æŒ‰ç…§æç¤ºè¾“å…¥é‚®ç®±ï¼Œé€‰æ‹©åŸŸåï¼ŒCertbot ä¼šè‡ªåŠ¨å¸®æ‚¨ä¿®æ”¹ Nginx é…ç½®å¹¶è®¾ç½®è‡ªåŠ¨ç»­æœŸå®šæ—¶ä»»åŠ¡ã€‚","tags":["Porkbun","åŸŸå","DNS","SSL"],"categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨"]},{"title":"Dedirock ç¾å›½ VPS é€‰è´­è®°å½•ï¼ˆçº½çº¦/æ´›æ‰çŸ¶ï¼‰","path":"/2025/12/23/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-çº½çº¦å’Œæ´›æ‰çŸ¶VPS/","content":"æœ€è¿‘åœ¨æ‰¾ä¾¿å®œçš„ç¾å›½ VPSï¼Œé¢„ç®—æ§åˆ¶åœ¨ä¸€å¹´äºŒåç¾å…ƒä»¥å†…ï¼Œç¿»äº†å‡ ä¸ªè®ºå›åå‘ç° Dedirock è¿™å®¶å‡ºç°é¢‘ç‡æŒºé«˜ã€‚è¿™ç¯‡è®°å½•ä¸€ä¸‹æˆ‘å¯¹ä»–ä»¬ä¸¤æ¬¾å¹´ä»˜å¥—é¤çš„äº†è§£ï¼ŒåŒ…æ‹¬é…ç½®ã€é€‚ç”¨åœºæ™¯å’Œéœ€è¦æ³¨æ„çš„å‘ã€‚ ğŸ’¡ å¦‚æœä½ å·²ç»å†³å®šä¹°äº†ï¼Œç›´æ¥çœ‹å®˜ç½‘ï¼šDedirock VPS å¥—é¤é¡µé¢ æˆ‘ä¸ºä»€ä¹ˆè¦æ‰¾ä¾¿å®œ VPSéœ€æ±‚å…¶å®æŒºç®€å•çš„ï¼š æ”¾ä¸ªäººåšå®¢æˆ–è€…å°å·¥å…· è·‘ç‚¹è½»é‡æœåŠ¡ï¼šå®šæ—¶è„šæœ¬ã€APIã€Bot ä¹‹ç±»çš„ æœ‰ä¸ªå¼€å‘æµ‹è¯•ç¯å¢ƒï¼Œå’Œç”Ÿäº§éš”ç¦»å¼€ ç¾å›½æœºæˆ¿ï¼Œè®¿é—®åŒ—ç¾èµ„æºæ–¹ä¾¿ ä¸»æµ VPS æœåŠ¡å•†åŠ¨ä¸åŠ¨å°± 5 ç¾å…ƒæœˆèµ·æ­¥ï¼Œä¸€å¹´ä¸‹æ¥å…­ä¸ƒåç¾å…ƒï¼Œå¯¹ä¸ªäººé¡¹ç›®æ¥è¯´æœ‰ç‚¹è´µã€‚æ‰€ä»¥åå‡ ç¾å…ƒå¹´ä»˜çš„é€‰é¡¹å°±å¾ˆæœ‰å¸å¼•åŠ›ï¼Œå‰ææ˜¯â€”â€”çœŸçš„èƒ½ç”¨ã€‚ Dedirock çš„å–ç‚¹å°±æ˜¯ä¾¿å®œä½†é è°±ï¼šKVM è™šæ‹ŸåŒ–ã€SSD å­˜å‚¨ã€ç¾å›½æœºæˆ¿ï¼Œè¯¥æœ‰çš„éƒ½æœ‰ã€‚ æ ¸å¿ƒé…ç½®ä¸€è§ˆæœºæˆ¿ä½ç½® æ´›æ‰çŸ¶ï¼šè¥¿æµ·å²¸ï¼Œå¯¹äºšå¤ªè®¿é—®ç›¸å¯¹å‹å¥½ çº½çº¦ï¼šä¸œæµ·å²¸ï¼Œé¢å‘åŒ—ç¾ä¸œéƒ¨å’Œæ¬§æ´²æ›´åˆé€‚ ä¸¤ä¸ªéƒ½æ˜¯ç»å…¸çš„ç¾å›½æœºæˆ¿ä½ç½®ã€‚ è™šæ‹ŸåŒ–KVM è™šæ‹ŸåŒ– + å®Œæ•´ root æƒé™ã€‚æ¯” OpenVZ éš”ç¦»æ€§å¥½ï¼Œæƒ³è£…ä»€ä¹ˆç³»ç»Ÿå’Œè½¯ä»¶éƒ½è¡Œã€‚ ç¡¬ä»¶ SSD å­˜å‚¨ï¼Œè¯»å†™é€Ÿåº¦ä¸æ‹–åè…¿ 1Gbps ç½‘ç»œç«¯å£ï¼ˆå…±äº«å¸¦å®½ï¼‰ æŠ€æœ¯æ”¯æŒ7Ã—24 å·¥å•æ”¯æŒï¼Œä¸€èˆ¬é—®é¢˜èƒ½å¾—åˆ°å“åº”ã€‚ä¸è¿‡æ¯•ç«Ÿæ˜¯ä¾¿å®œå¥—é¤ï¼Œåˆ«æŒ‡æœ›ç§’å›ã€‚ ä¸¤ä¸ªå¥—é¤å¯¹æ¯”Special Saverï¼ˆå…¥é—¨æ¬¾ï¼‰ é…ç½®é¡¹ å‚æ•° å­˜å‚¨ 10 GB SSD å†…å­˜ 768 MB CPU 1 æ ¸ æµé‡ 1 TB æœˆ IPv4 1 ä¸ª ä»·æ ¼ çº¦ $10.18 å¹´ é€‚åˆåœºæ™¯ï¼š å•ä¸ªé™æ€åšå®¢æˆ–å°ç«™ å®šæ—¶ä»»åŠ¡ã€è„šæœ¬æœåŠ¡ æƒ³ä½“éªŒä¸€ä¸‹ç¾å›½ VPS çš„å…¥é—¨ç”¨æˆ· 768 MB å†…å­˜è·‘ä¸ª Hexo åšå®¢æˆ–è€…è½»é‡ API ç»°ç»°æœ‰ä½™ï¼Œå†é‡å°±æœ‰ç‚¹åƒåŠ›äº†ã€‚ Special Economyï¼ˆè¿›é˜¶æ¬¾ï¼‰ é…ç½®é¡¹ å‚æ•° å­˜å‚¨ 20 GB SSD å†…å­˜ 2 GB CPU 1 æ ¸ æµé‡ 2 TB æœˆ IPv4 1 ä¸ª ä»·æ ¼ çº¦ $20.88 å¹´ é€‚åˆåœºæ™¯ï¼š è·‘å¤šä¸ªç«™ç‚¹æˆ–æœåŠ¡ è£… Dockerã€é¢æ¿ä¹‹ç±»ç¨é‡çš„ä¸œè¥¿ æ‰“ç®—é•¿æœŸç”¨ï¼Œéœ€è¦ä¸€ç‚¹ä½™é‡ 2 GB å†…å­˜æ—¥å¸¸ä½¿ç”¨æ¾å¾ˆå¤šï¼Œå¤šå¼€å‡ ä¸ªå®¹å™¨ä¹Ÿä¸å®¹æ˜“ OOMã€‚ æ€ä¹ˆé€‰é€‰ Saver çš„æƒ…å†µï¼š åªè·‘ä¸€ä¸ªå°ç«™ï¼Œéœ€æ±‚æ˜ç¡® é™æ€ç«™æˆ–è€…çº¯ API æœåŠ¡ å°±æƒ³ä¾¿å®œï¼Œå¤Ÿç”¨å°±è¡Œ é€‰ Economy çš„æƒ…å†µï¼š æƒ³åœ¨ä¸€å°æœºå™¨ä¸Šè·‘å¤šä¸ªä¸œè¥¿ åç»­å¯èƒ½ä¼šæ‰©å±• å¤šèŠ±åç¾å…ƒæ¢ä¸ªå®‰å¿ƒ æˆ‘æœ€åé€‰çš„æ˜¯ Economyã€‚è™½ç„¶ç°åœ¨ç”¨ä¸æ»¡ 2 GBï¼Œä½†ä¸‡ä¸€ä»¥åæƒ³åŠ ç‚¹æœåŠ¡ï¼Œä¸ç”¨å†æŠ˜è…¾è¿ç§»ã€‚ é€‚åˆå¹²ä»€ä¹ˆæ¨èç”¨æ³•ï¼š ä¸ªäººåšå®¢ï¼ˆWordPressã€Hexoã€Hugoï¼‰ å°å·¥å…·ï¼ˆçŸ­é“¾æ¥ã€Webhookã€è‡ªåŠ¨åŒ–è„šæœ¬ï¼‰ å¼€å‘æµ‹è¯•ç¯å¢ƒ è½»é‡é¢æ¿ + å°‘é‡ç«™ç‚¹ ä¸å»ºè®®ç”¨æ³•ï¼š é«˜å¹¶å‘æ•°æ®åº“ CPU å¯†é›†å‹ä»»åŠ¡ï¼ˆç¼–è¯‘ã€çˆ¬è™«ï¼‰ å…³é”®ç”Ÿäº§ç¯å¢ƒçš„å”¯ä¸€èŠ‚ç‚¹ ç®€å•è¯´å°±æ˜¯ï¼šè½»é‡æœåŠ¡æ²¡é—®é¢˜ï¼Œé‡æ´»åˆ«æŒ‡æœ›å®ƒã€‚ ä¹°ä¹‹å‰æƒ³æ¸…æ¥šè¿™å‡ ç‚¹ å¹´ä»˜æœ‰é£é™©ä¾¿å®œæ˜¯ä¾¿å®œï¼Œä½†ä¸‡ä¸€ç”¨ä¸ä¸Šæˆ–è€…æœåŠ¡å•†è·‘è·¯ï¼Œé’±å°±æ‰“æ°´æ¼‚äº†ã€‚ç¡®è®¤è‡ªå·±çœŸçš„ä¼šç”¨å†ä¹°ã€‚ å¤‡ä»½è‡ªå·±åšåˆ«æŒ‡æœ›æœåŠ¡å•†å¸®ä½ å¤‡ä»½ã€‚é‡è¦æ•°æ®å®šæœŸåŒæ­¥åˆ°å…¶ä»–åœ°æ–¹ã€‚ æ€§èƒ½é¢„æœŸè¦åˆç†åå‡ ç¾å…ƒä¸€å¹´çš„æœºå™¨ï¼Œä¸å¯èƒ½æœ‰å¤šå¼ºçš„æ€§èƒ½ã€‚å¤Ÿç”¨å°±è¡Œï¼Œåˆ«æ‰›å¤§æµé‡ã€‚ çœ‹æ¸… TOSé‚®ä»¶ç¾¤å‘ã€æŒ–çŸ¿ã€çˆ¬è™«ä¹‹ç±»çš„ç”¨é€”å¤§å¤šç¦æ­¢ï¼Œä¸Šè½¦å‰çœ‹æ¸…è§„åˆ™ã€‚ æ€»ç»“Dedirock è¿™ä¸¤ä¸ªå¥—é¤å®šä½å¾ˆæ¸…æ¥šï¼š Saver Economy ä»·æ ¼ $10.18å¹´ $20.88å¹´ å†…å­˜ 768 MB 2 GB å­˜å‚¨ 10 GB 20 GB æµé‡ 1 TB 2 TB éƒ½æ˜¯ KVM + SSD + ç‹¬ç«‹ IPv4 + ç¾å›½æœºæˆ¿ï¼Œå¯¹ä¸ªäººé¡¹ç›®æ¥è¯´é…ç½®å¤Ÿç”¨ã€‚ å¦‚æœä½ ä¹Ÿåœ¨æ‰¾ä¸€å°ä¾¿å®œçš„ç¾å›½ VPSï¼Œä¸éœ€è¦å¤šå¼ºçš„æ€§èƒ½ï¼Œåªè¦èƒ½ç¨³å®šè·‘ä¸€å¹´ï¼ŒDedirock å¯ä»¥è€ƒè™‘ã€‚ ğŸ‘‰ Dedirock å®˜ç½‘","tags":["VPS","Dedirock","ç¾å›½æœºæˆ¿"],"categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨"]},{"title":"å¦‚ä½•åœ¨windowsç¯å¢ƒä¸­è®¿é—®wslçš„æ–‡ä»¶å¤¹","path":"/2025/12/22/1-å¹³å°ç³»ç»Ÿ-WSL-å¦‚ä½•åœ¨windowsç¯å¢ƒä¸­è®¿é—®wslçš„æ–‡ä»¶å¤¹/","content":"åœ¨ Windows ç¯å¢ƒä¸­è®¿é—® WSLï¼ˆWindows Subsystem for Linuxï¼‰çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ˜¯è®¸å¤šå¼€å‘è€…ã€ç³»ç»Ÿç®¡ç†å‘˜å’Œæ—¥å¸¸ç”¨æˆ·ç»å¸¸éœ€è¦çš„æ“ä½œã€‚WSL æœ¬è´¨ä¸Šæ˜¯åœ¨ Windows å†…è¿è¡Œä¸€ä¸ªè½»é‡çº§çš„ Linux å‘è¡Œç‰ˆï¼ˆå¦‚ Ubuntuã€Debianã€Kali ç­‰ï¼‰ï¼Œå®ƒæ‹¥æœ‰ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿç»“æ„ï¼Œä½†ä¸ Windows ä¸»æœºå…±äº«ç‰©ç†å­˜å‚¨ç©ºé—´ã€‚ç†è§£å…¶æœºåˆ¶å¹¶æŒæ¡æ­£ç¡®çš„è®¿é—®è·¯å¾„ï¼Œèƒ½æå¤§æå‡å·¥ä½œæ•ˆç‡ã€‚ ğŸ” ä¸€ã€WSL æ–‡ä»¶ç³»ç»Ÿçš„ç»“æ„åŸç†WSL çš„æ–‡ä»¶ç³»ç»Ÿå¹¶éä»¥ä¼ ç»Ÿè™šæ‹Ÿæœºæ–¹å¼æŒ‚è½½ç£ç›˜é•œåƒï¼Œè€Œæ˜¯é‡‡ç”¨ 9P åè®®ï¼ˆä¸€ç§ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿåè®®ï¼‰å°† Linux æ ¹æ–‡ä»¶ç³»ç»Ÿæ˜ å°„ä¸º Windows å¯è¯†åˆ«çš„è·¯å¾„ã€‚ä» Windows è§†è§’çœ‹ï¼Œæ¯ä¸ªå·²å®‰è£…çš„ WSL å‘è¡Œç‰ˆéƒ½ä¼šåœ¨ \\\\wsl$ ä¸‹ç”Ÿæˆä¸€ä¸ªç½‘ç»œå…±äº«å…¥å£â€”â€”è¿™å…¶å®æ˜¯ä¸€ä¸ªè™šæ‹Ÿ UNC è·¯å¾„ï¼Œç”± Windows å†…æ ¸é€šè¿‡ WSL é©±åŠ¨åŠ¨æ€è§£æã€‚ ä¾‹å¦‚ï¼š è‹¥ä½ å®‰è£…äº† Ubuntu-22.04ï¼Œåˆ™å…¶æ ¹ç›®å½•å¯é€šè¿‡ \\\\wsl$\\Ubuntu-22.04\\ è®¿é—®ï¼› è‹¥å®‰è£…çš„æ˜¯ Debianï¼Œè·¯å¾„ä¸º \\\\wsl$\\Debian\\ï¼› å¤šä¸ªå‘è¡Œç‰ˆå…±å­˜æ—¶ï¼Œæ¯ä¸ªéƒ½æ‹¥æœ‰å”¯ä¸€åç§°ï¼ˆå¯é€šè¿‡ wsl -l --verbose æŸ¥çœ‹ï¼‰ã€‚ ğŸ’¡ æç¤ºï¼š\\\\wsl$ å¹¶éçœŸå®ç½‘ç»œå…±äº«ï¼Œä¸ä¾èµ–å±€åŸŸç½‘æˆ– SMB æœåŠ¡ï¼Œä»…æ˜¯ Windows å¯¹ WSL å†…æ ¸æ¥å£çš„æŠ½è±¡å°è£…ã€‚å³ä½¿æ–­ç½‘ï¼Œè¯¥è·¯å¾„ä¾ç„¶å¯ç”¨ã€‚ ğŸ–¥ï¸ äºŒã€å››ç§ä¸»æµè®¿é—®æ–¹å¼1. é€šè¿‡èµ„æºç®¡ç†å™¨ç›´æ¥æµè§ˆè¿™æ˜¯æœ€ç›´è§‚çš„æ–¹å¼ï¼š æ‰“å¼€ æ–‡ä»¶èµ„æºç®¡ç†å™¨ï¼ˆWin + Eï¼‰ï¼› åœ¨åœ°å€æ è¾“å…¥ï¼š \\\\wsl$\\Ubuntu-22.04\\ ï¼ˆè¯·å°† Ubuntu-22.04 æ›¿æ¢ä¸ºä½ å®é™…çš„å‘è¡Œç‰ˆåç§°ï¼‰ æŒ‰å›è½¦ï¼Œå³å¯è¿›å…¥ Linux æ ¹ç›®å½• /ï¼› è¿›å…¥ /home/ç”¨æˆ·å/ å¯çœ‹åˆ°ä½ çš„ä¸»ç›®å½•ï¼ˆå¦‚ /home/alice/ï¼‰ï¼› æ³¨æ„ï¼šWindows ä¸å…è®¸ç›´æ¥ä¿®æ”¹æŸäº› Linux ç‰¹æœ‰æ–‡ä»¶ï¼ˆå¦‚ç¬¦å·é“¾æ¥ã€æƒé™ä½ä¸º 0700 çš„ç›®å½•ï¼‰ï¼Œè‹¥å°è¯•ç¼–è¾‘ .bashrc æˆ– ~/.ssh/configï¼Œå»ºè®®ç”¨ WSL ç»ˆç«¯æ“ä½œï¼Œé¿å…ç ´åæ–‡ä»¶å…ƒæ•°æ®ã€‚ âœ… å®ä¾‹ï¼šä½ æƒ³æŸ¥çœ‹ WSL ä¸­çš„ ~/Projects/web-app/src/index.jsï¼Œåªéœ€åœ¨èµ„æºç®¡ç†å™¨åœ°å€æ è¾“å…¥ï¼š\\\\wsl$\\Ubuntu-22.04\\home\\alice\\Projects\\web-app\\src\\index.jsç„¶ååŒå‡»æ‰“å¼€ï¼ˆé»˜è®¤ç”¨è®°äº‹æœ¬ï¼‰ï¼Œä½†æ›´æ¨èç”¨ VS Code æ‰“å¼€ï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚ 2. é€šè¿‡å‘½ä»¤è¡Œå¿«é€Ÿè·³è½¬åœ¨ Windows PowerShell æˆ– CMD ä¸­ï¼Œå¯ç›´æ¥ä½¿ç”¨ explorer.exe å‘½ä»¤æ‰“å¼€æŒ‡å®šè·¯å¾„ï¼š # æ‰“å¼€å½“å‰ç”¨æˆ·çš„ home ç›®å½•explorer.exe \\\\wsl$\\Ubuntu-22.04\\home\\$env:USERNAME# æ‰“å¼€ root ç”¨æˆ·çš„ /etc ç›®å½•ï¼ˆéœ€æ³¨æ„ï¼šæ™®é€šç”¨æˆ·æ— æƒå†™å…¥ï¼‰explorer.exe \\\\wsl$\\Ubuntu-22.04\\etc âš ï¸ æ³¨æ„ï¼š$env:USERNAME æ˜¯ Windows å½“å‰ç™»å½•ç”¨æˆ·åï¼Œä¸ä¸€å®šç­‰äº WSL ä¸­çš„ç”¨æˆ·åã€‚ä¾‹å¦‚ä½ åœ¨ Windows ç™»å½•åä¸º Aliceï¼Œä½†åœ¨ Ubuntu ä¸­åˆ›å»ºçš„ç”¨æˆ·æ˜¯ devuserï¼Œé‚£ä¹ˆ WSL çš„ home è·¯å¾„æ˜¯ /home/devuser/ï¼Œå¯¹åº” Windows è·¯å¾„ä¸º \\\\wsl$\\Ubuntu-22.04\\home\\devuser\\ â€”â€” ä¸èƒ½é  $env:USERNAME è‡ªåŠ¨æ¨å¯¼ï¼Œå¿…é¡»ç¡®è®¤ WSL ç”¨æˆ·åã€‚ éªŒè¯æ–¹æ³•ï¼šåœ¨ WSL ç»ˆç«¯æ‰§è¡Œï¼š whoami # è¾“å‡ºå½“å‰ Linux ç”¨æˆ·åpwd # æŸ¥çœ‹å½“å‰è·¯å¾„ 3. åœ¨ VS Code ä¸­æ— ç¼é›†æˆVS Code å¯¹ WSL æ”¯æŒæä½³ï¼Œæ¨èç”¨äºå¼€å‘åœºæ™¯ï¼š å®‰è£… Remote - WSL æ‰©å±•ï¼› æ‰“å¼€å‘½ä»¤é¢æ¿ï¼ˆCtrl+Shift+Pï¼‰ï¼Œè¾“å…¥ WSL: New Windowï¼› VS Code ä¼šå¯åŠ¨ä¸€ä¸ªå®Œå…¨è¿è¡Œåœ¨ WSL ç¯å¢ƒä¸­çš„å®ä¾‹ï¼Œæ­¤æ—¶ï¼š å·¦ä¾§æ–‡ä»¶æ ‘æ˜¾ç¤ºçš„æ˜¯ /home/devuser/ï¼ˆLinux è·¯å¾„ï¼‰ï¼› ç»ˆç«¯å†… pwd è¾“å‡º /home/devuser/projectï¼› ä¿å­˜æ–‡ä»¶æ—¶ï¼Œç›´æ¥å†™å…¥ WSL æ–‡ä»¶ç³»ç»Ÿï¼Œä¸ä¼šç»è¿‡ Windows å±‚è½¬æ¢ï¼Œé¿å…æ¢è¡Œç¬¦ï¼ˆCRLFLFï¼‰æˆ–æƒé™ä¸¢å¤±é—®é¢˜ã€‚ ğŸŒŸ é«˜çº§æŠ€å·§ï¼šåœ¨ Windows ä¸­å³é”®ä»»æ„æ–‡ä»¶å¤¹ â†’ â€œåœ¨ VS Code ä¸­æ‰“å¼€â€ï¼Œè‹¥è¯¥æ–‡ä»¶å¤¹ä½äº \\\\wsl$\\... è·¯å¾„ä¸‹ï¼ŒVS Code ä¼šè‡ªåŠ¨è¯†åˆ«ä¸º WSL ç¯å¢ƒå¹¶å¯ç”¨ Remote æ¨¡å¼ã€‚ 4. é€šè¿‡ç½‘ç»œé©±åŠ¨å™¨æ˜ å°„è‹¥éœ€é¢‘ç¹è®¿é—®æŸ WSL å‘è¡Œç‰ˆçš„ç‰¹å®šç›®å½•ï¼ˆå¦‚ /var/www/htmlï¼‰ï¼Œå¯å°†å…¶æ˜ å°„ä¸ºç½‘ç»œé©±åŠ¨å™¨ï¼š æ‰“å¼€ PowerShellï¼ˆç®¡ç†å‘˜æƒé™éå¿…éœ€ï¼‰ï¼š net use Z: \\\\wsl$\\Ubuntu-22.04\\var\\www\\html æ­¤æ—¶ Z: ç›˜å³æŒ‡å‘ WSL çš„ Web æ ¹ç›®å½•ï¼› å¯åœ¨èµ„æºç®¡ç†å™¨ä¸­æ°¸ä¹…ä¿ç•™æ­¤æ˜ å°„ï¼ˆé‡å¯åå¤±æ•ˆï¼Œéœ€åŠ  /persistent:yes å‚æ•°ï¼‰ï¼š net use Z: \\\\wsl$\\Ubuntu-22.04\\var\\www\\html /persistent:yes ğŸ“Œ æ³¨æ„ï¼šnet use æ˜ å°„çš„é©±åŠ¨å™¨æ— æ³•åœ¨ WSL å†…éƒ¨åå‘è®¿é—®ï¼ˆå³ Linux ä¸èƒ½çœ‹åˆ° Z:ï¼‰ï¼Œå®ƒä»…æ˜¯ Windows å•å‘æ¡¥æ¥ã€‚ âš ï¸ ä¸‰ã€å¸¸è§é™·é˜±ä¸é¿å‘æŒ‡å— é—®é¢˜ åŸå›  è§£å†³æ–¹æ¡ˆ â€œæ‰¾ä¸åˆ°ç½‘ç»œè·¯å¾„â€ WSL æœªè¿è¡Œæˆ–å‘è¡Œç‰ˆåç§°é”™è¯¯ å…ˆåœ¨ PowerShell æ‰§è¡Œ wsl -l --verboseï¼Œç¡®è®¤çŠ¶æ€ä¸º Runningï¼›æ£€æŸ¥å¤§å°å†™ä¸ç©ºæ ¼ï¼ˆå¦‚ Ubuntu-22.04 â‰  ubuntu-22.04ï¼‰ æ–‡ä»¶ä¿®æ”¹åæƒé™é”™ä¹± Windows ç”¨è®°äº‹æœ¬Notepad++ ç›´æ¥ç¼–è¾‘ Linux æ–‡ä»¶ æ”¹ç”¨ WSL ç»ˆç«¯æ“ä½œï¼Œæˆ–ä½¿ç”¨æ”¯æŒ Unix æ¢è¡Œç¬¦çš„ç¼–è¾‘å™¨ï¼ˆå¦‚ VS Codeã€Sublime Textï¼‰å¹¶è®¾ç½® core.autocrlf = inputï¼ˆGit åœºæ™¯ï¼‰ ç¬¦å·é“¾æ¥æ˜¾ç¤ºä¸ºæ™®é€šæ–‡ä»¶ Windows èµ„æºç®¡ç†å™¨ä¸è§£æ Linux ç¬¦å·é“¾æ¥ åœ¨ WSL ä¸­ç”¨ ls -l æŸ¥çœ‹çœŸå®é“¾æ¥ç›®æ ‡ï¼›æˆ–ç”¨ PowerShell æ‰§è¡Œ Get-ChildItem -Force æŸ¥çœ‹é“¾æ¥å±æ€§ è®¿é—® /mnt/c/ æ—¶å¡é¡¿ WSL é€šè¿‡ drvfs æŒ‚è½½ Windows åˆ†åŒºï¼Œå¤§é‡å°æ–‡ä»¶è¯»å†™æ€§èƒ½è¾ƒå·® é¿å…åœ¨ /mnt/c/Users/... ä¸‹è¿è¡Œ npm install æˆ– git cloneï¼›ä¼˜å…ˆå°†é¡¹ç›®æ”¾åœ¨ WSL åŸç”Ÿè·¯å¾„ï¼ˆå¦‚ ~/projectï¼‰ ğŸ“Š æ€§èƒ½å‚è€ƒï¼ˆå®æµ‹äº Windows 11 + WSL2 + SSDï¼‰ï¼š è¯»å– 10,000 ä¸ªå°æ–‡ä»¶ï¼ˆå¹³å‡ 1KBï¼‰ï¼š åœ¨ WSL åŸç”Ÿè·¯å¾„ï¼šçº¦ 1.2 ç§’ åœ¨ /mnt/c/Users/...ï¼šçº¦ 8.7 ç§’ åœ¨ \\\\wsl$\\... è·¯å¾„ä¸‹é€šè¿‡èµ„æºç®¡ç†å™¨ï¼šçº¦ 15 ç§’ï¼ˆå›  Explorer é¢å¤–è§£æå…ƒæ•°æ®ï¼‰ ğŸ” å››ã€å®‰å…¨ä¸æƒé™è¯´æ˜WSL çš„æ–‡ä»¶æƒé™æ¨¡å‹åŸºäº Linux çš„ uid/gidï¼Œè€Œ Windows æ— æ­¤æ¦‚å¿µã€‚å½“é€šè¿‡ \\\\wsl$ è®¿é—®æ—¶ï¼š Windows ä¼šå°†æ–‡ä»¶æƒé™â€œé™çº§â€ä¸º NTFS ACLï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰ï¼Œä½†ä¸ä¿ç•™åŸå§‹ Linux æƒé™ï¼› ä¾‹å¦‚ï¼šLinux ä¸­ chmod 700 ~/.ssh çš„ç§é’¥ï¼Œåœ¨ Windows ä¸‹ä»å¯è¢«å…¶ä»–ç”¨æˆ·è¯»å–ï¼ˆé™¤éæ‰‹åŠ¨è®¾ç½® NTFS æƒé™ï¼‰ï¼› æ•æ„Ÿæ–‡ä»¶ï¼ˆå¦‚ ~/.ssh/id_rsaï¼‰å¼ºçƒˆå»ºè®®ä»…åœ¨ WSL å†…éƒ¨æ“ä½œï¼Œé¿å…é€šè¿‡ Windows èµ„æºç®¡ç†å™¨æš´éœ²ã€‚ éªŒè¯æ–¹å¼ï¼šåœ¨ WSL ä¸­æ‰§è¡Œï¼š ls -ld ~/.ssh ~/.ssh/id_rsa è¾“å‡ºåº”ç±»ä¼¼ï¼š drwx------ 2 devuser devuser 4096 Jun 10 14:30 .ssh-r-------- 1 devuser devuser 2610 Jun 10 14:30 id_rsa è‹¥åœ¨ Windows ä¸­å³é”®è¯¥æ–‡ä»¶ â†’ å±æ€§ â†’ å®‰å…¨ï¼Œä½ ä¼šå‘ç°â€œç‰¹æ®Šæƒé™â€ä¸­æ— æ˜ç¡®é™åˆ¶â€”â€”è¿™å°±æ˜¯é£é™©æ‰€åœ¨ã€‚ âœ… äº”ã€ç»ˆæå»ºè®®ï¼šæŒ‰åœºæ™¯é€‰æ‹©æœ€ä½³è·¯å¾„ ä½¿ç”¨åœºæ™¯ æ¨èæ–¹å¼ ç†ç”± å¿«é€ŸæŸ¥çœ‹é…ç½®æ–‡ä»¶ èµ„æºç®¡ç†å™¨ \\\\wsl$\\distro\\... æ— éœ€å¼€ç»ˆç«¯ï¼Œé€‚åˆä¸´æ—¶æŸ¥é˜… ç¼–è¾‘ä»£ç è„šæœ¬ VS Code + Remote-WSL ä¿æŒ LF æ¢è¡Œã€æ­£ç¡®æƒé™ã€é›†æˆç»ˆç«¯ æ‰¹é‡å¤åˆ¶æ–‡ä»¶åˆ° Windows cp /home/user/docs/*.pdf /mnt/c/Users/Alice/Downloads/ åˆ©ç”¨ /mnt/c/ åŒå‘äº’é€šæ€§ é•¿æœŸç»´æŠ¤æœåŠ¡å™¨é¡¹ç›® å°†é¡¹ç›®æ”¾åœ¨ ~/workspace/ï¼Œå¹¶é€šè¿‡ \\\\wsl$ æ˜ å°„ä¸ºç½‘ç»œé©±åŠ¨å™¨ é¿å…è·¨ç³»ç»Ÿè·¯å¾„æ··æ·†ï¼Œæé«˜ç¨³å®šæ€§ æŒæ¡ä»¥ä¸Šæ–¹æ³•åï¼Œä½ ä¸ä»…èƒ½è‡ªç”±ç©¿æ¢­äº Windows ä¸ WSL ä¹‹é—´ï¼Œæ›´èƒ½è§„é¿å¸¸è§é™·é˜±ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ä¸ç³»ç»Ÿå®‰å…¨ã€‚è®°ä½ï¼šWSL çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ Linux çš„ï¼Œä¸æ˜¯ Windows çš„å»¶ä¼¸â€”â€”å°Šé‡å…¶è®¾è®¡é€»è¾‘ï¼Œæ‰èƒ½çœŸæ­£å‘æŒ¥åŒç³»ç»ŸååŒçš„å¨åŠ›ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","WSL"]},{"title":"ROSåŸºç¡€ç¬”è®°","path":"/2025/12/16/3-å¼€å‘æ¡†æ¶-ROS-ROSåŸºç¡€ç¬”è®°/","content":"åŸºç¡€æ¦‚å¿µNodesèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹å¯ä»¥ä¸åŒä¸€è¿›ç¨‹ä¸åŒè¿›ç¨‹ä¸åŒè®¾å¤‡ä¸Šçš„èŠ‚ç‚¹è¿›è¡Œé€šè®¯ï¼ŒèŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥é€šè¿‡åˆ†å¸ƒå¼å‘ç°è¿‡ç¨‹ (distributed discovery process) å»ºç«‹ã€‚ èŠ‚ç‚¹å¯ä»¥å……å½“è®¢é˜…è€…å‘å¸ƒè€…æœåŠ¡ serveræœåŠ¡ clientaction serveraction client Discoveryå‘ç°ï¼Œé€šè¿‡ ROS2 çš„åº•å±‚ä¸­é—´ä»¶è‡ªåŠ¨å®Œæˆçš„ã€‚ ç¨³å®šçš„è¿æ¥ä¾èµ–äº Quality of Service å¯åŠ¨æ—¶ï¼Œå‘å…·æœ‰ç›¸åŒ ROS_DOMAIN_ID çš„å…¶ä»–èŠ‚ç‚¹å¹¿æ’­ å®šæœŸå¹¿æ’­è‡ªèº«å­˜åœ¨ ç¦»çº¿è­¦æŠ¥ Interfaceæ¥å£ï¼Œé€šå¸¸ä½¿ç”¨ä¸‰ç§ç±»å‹çš„æ¥å£è¿›è¡Œé€šè®¯ï¼šTopicServiceAction .msg æè¿°æ¶ˆæ¯çš„å„ä¸ªå­—æ®µ .srv æè¿°æœåŠ¡ï¼Œè¯·æ±‚å’Œå“åº”ç»„æˆ .action æè¿°æ“ä½œï¼Œç”±ç›®æ ‡ goalï¼Œç»“æœ result å’Œåé¦ˆ feedback ç»„æˆ TopicèŠ‚ç‚¹é—´å‘é€æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå…¶ä»–èŠ‚ç‚¹å¯ä»¥è®¢é˜… Topic å¹¶æ¥æ”¶æ¶ˆæ¯ã€‚.msg æ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œfield å’Œ constant ä»»ä½•ç‰¹å®šä¸»é¢˜å¯ä»¥æœ‰é›¶ä¸ªæˆ–å¤šä¸ªå‘å¸ƒè€…å’Œé›¶ä¸ªæˆ–å¤šä¸ªè®¢é˜…è€… åŒ¿åçš„ å¼ºç±»å‹çš„ filed å®šä¹‰æ–¹å¼ fieldtype1 fieldname1 (defaultvalue) å†…ç½®æ•°æ®ç±»å‹å¯ä»¥å®šä¹‰æ•°ç»„ é»˜è®¤å€¼ constant å¸¸é‡åå¿…é¡»å¤§å†™ constanttype CONSTANTNAME=constantvalue Service å®¢æˆ·ç«¯ç­‰å¾…æœåŠ¡å™¨è¿›è¡Œç®€å•çš„è®¡ç®—å¹¶è¿”å›ç»“æœï¼Œéœ€è¦å¿«é€Ÿå“åº” .msg æ–‡ä»¶ç”±è¯·æ±‚å’Œå“åº”æ¶ˆæ¯ç±»å‹ç»„æˆï¼Œä¸¤è€…ä¹‹é—´ç”¨ --- åˆ†å‰² ä»»ä½•ä¸¤ä¸ªä»¥ --- è¿æ¥çš„ .msg æ–‡ä»¶å‡æ„æˆåˆæ³•çš„æœåŠ¡æè¿°ã€‚ service é€šè¿‡ service name è¯†åˆ« æ¯ä¸€ä¸ª service name åªèƒ½å¯¹åº”ä¸€ä¸ª service serverï¼Œå¯ä»¥å¯¹åº”ä»»æ„æ•°é‡çš„ service client #å¼•ç”¨åŒä¸€è½¯ä»¶åŒ…ä¸­çš„æ¶ˆæ¯ï¼Œåˆ™ä¸èƒ½æåŠè½¯ä»¶åŒ…åç§°# request constantsint8 FOO=1int8 BAR=2# request fieldsint8 foobaranother_pkg/AnotherMessage msg---# response constantsuint32 SECRET=123456# response fieldsanother_pkg/YetAnotherMessage valCustomMessageDefinedInThisPackage valueuint32 an_integer Action Action æ˜¯ä¸€ç§è€—æ—¶çš„è¯·æ±‚å“åº”é€šè®¯ Action å¯ä»¥é•¿æ—¶é—´è¿è¡Œï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­æä¾›åé¦ˆï¼Œå¹¶ä¸”å¯ä»¥è¢«ä¸­æ–­ eg æœºå™¨äººçš„é«˜çº§çŠ¶æ€æœºå¯èƒ½ä¼šè°ƒç”¨ä¸€ä¸ªåŠ¨ä½œæ¥æŒ‡ç¤ºå¯¼èˆªå­ç³»ç»Ÿå‰å¾€æŸä¸ªèˆªç‚¹ï¼Œå¯¼èˆªå­ç³»ç»Ÿå¯ä»¥æä¾›å½“å‰è¡Œè¿›è·ç¦»çš„åé¦ˆï¼Œè€Œé«˜çº§çŠ¶æ€æœºå¯ä»¥é€‰æ‹©å–æ¶ˆæˆ–æŠ¢å å‰å¾€è¯¥èˆªç‚¹çš„è·¯çº¿ request_type request_fieldname---response_type response_fieldname---feedback_type feedback_fieldname Parameter å‚æ•°çš„å£°æ˜å‘¨æœŸå’ŒèŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸç»‘å®š å‚æ•°å¯»å€æ–¹å¼ï¼šèŠ‚ç‚¹åç§°èŠ‚ç‚¹å‘½åç©ºé—´å‚æ•°åç§°å‚æ•°å‘½åç©ºé—´ å‚æ•°ç”±é”®å€¼å’Œæè¿°ç¬¦ç»„æˆ ç”¨äºé…ç½®ç®—æ³•ã€ç¡¬ä»¶å‚æ•°ã€è¡Œä¸ºå¼€å…³ç­‰ å‚æ•°å£°æ˜ é»˜è®¤æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹å£°æ˜å…¶ç”Ÿå‘½å‘¨æœŸå†…çš„æ‰€æœ‰å‚æ•°ã€‚ å‚æ•°ç±»å‹ å‚æ•°å›è°ƒ å¯ä»¥æ³¨å†Œä¸‰ç§ä¸åŒç±»å‹çš„å›è°ƒå‡½æ•°ï¼Œåœ¨å‚æ•°å‘ç”Ÿå˜åŒ–æ—¶è¿›è¡Œé€šçŸ¥ å‚æ•°äº¤äº’ å‚æ•°åˆå§‹å€¼è®¾å®š è¿è¡ŒèŠ‚ç‚¹æ—¶é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æˆ– yaml æ–‡ä»¶è®¾å®šåˆå§‹å‚æ•°å€¼ å¯åŠ¨èŠ‚ç‚¹æ—¶é€šè¿‡å¯åŠ¨å·¥å…·è®¾ç½®å‚æ•°åˆå§‹å€¼ èŠ‚ç‚¹è¿è¡Œæ—¶æ“ä½œå‚æ•°å€¼ ros2 param ROS2 å‘½ä»¤è¡Œå·¥å…·The source code for theÂ ros2Â command is available atÂ https://github.com/ros2/ros2cli. action: Introspectinteract with ROS actions æ£€æŸ¥äº¤äº’ ROS åŠ¨ä½œ bag: Recordplay a rosbag è®°å½•æ’­æ”¾ rosbag component: Manage component containers ç®¡ç†ç»„ä»¶å®¹å™¨ daemon: Introspectconfigure the ROS 2 daemon æ£€æŸ¥é…ç½® ROS2 å®ˆæŠ¤è¿›ç¨‹ doctor: Check ROS setup for potential issues æ£€æŸ¥ ROS é…ç½®æ½œåœ¨é—®é¢˜ interface: Show information about ROS interfaces æ˜¾ç¤º ROS æ¥å£ä¿¡æ¯ launch: Runintrospect a launch file è¿è¡Œæ£€æŸ¥å¯åŠ¨æ–‡ä»¶ lifecycle: Introspectmanage nodes with managed lifecycles æ£€æŸ¥ç®¡ç†å—æ§ç”Ÿå‘½å‘¨æœŸèŠ‚ç‚¹ multicast: Multicast debugging commands å¤šæ’­è°ƒè¯•å‘½ä»¤ node: Introspect ROS nodes æ£€æŸ¥ ROS èŠ‚ç‚¹ param: Introspectconfigure parameters on a node æ£€æŸ¥é…ç½®èŠ‚ç‚¹å‚æ•° pkg: Introspect ROS packages æ£€æŸ¥ ROS è½¯ä»¶åŒ… plugin: Introspect ROS plugins æ£€æŸ¥ ROS æ’ä»¶ run: Run ROS nodes è¿è¡Œ ROS èŠ‚ç‚¹ security: Configure security settings é…ç½®å®‰å…¨è®¾ç½® service: Introspectcall ROS services æ£€æŸ¥è°ƒç”¨ ROS æœåŠ¡ test: Run a ROS launch test è¿è¡Œ ROS å¯åŠ¨æµ‹è¯• topic: Introspectpublish ROS topics æ£€æŸ¥å‘å¸ƒ ROS ä¸»é¢˜ trace: Tracing tools to get information on ROS nodes execution (only available on Linux) wtf: An alias forÂ doctor doctor åˆ«å ROS å®ˆæŠ¤è¿›ç¨‹ å®ˆæŠ¤è¿›ç¨‹ä½¿ç”¨ 127.0.0.1 è¿›è¡Œé€šè®¯ï¼Œä½¿ç”¨ ROS_DOMAIN_ID ç¯å¢ƒå˜é‡ä½œä¸ºç«¯å£å·åç§»é‡ ä¸åŒçš„ ROS_DOAMIN_ID å¯¼è‡´ä¸åŒçš„å®ˆæŠ¤å®ä¾‹è¿è¡Œåœ¨ä¸åŒçš„ç«¯å£ä¸Š å¯åŠ¨ ROS2 ç”±è®¸å¤šèŠ‚ç‚¹ç»„æˆï¼ŒèŠ‚ç‚¹è¿è¡Œåœ¨ä¸åŒçš„è¿›ç¨‹æœºå™¨ä¸Š launch system æ—¨åœ¨é€šè¿‡å•ä¸ªå‘½ä»¤è¿è¡Œå¤šä¸ªèŠ‚ç‚¹ æè¿°ç³»ç»Ÿé…ç½®ï¼Œç„¶åæŒ‰æè¿°å¯åŠ¨èŠ‚ç‚¹ ç³»ç»Ÿé…ç½®åŒ…æ‹¬è¦è¿è¡Œçš„ç¨‹åºï¼Œè¿è¡Œä½ç½®ï¼Œä¼ é€’å‚æ•° è´Ÿè´£ç›‘æ§å·²å¯åŠ¨è¿›ç¨‹çŠ¶æ€ï¼ŒæŠ¥å‘Šå’Œå“åº”è¿›ç¨‹çŠ¶æ€å˜åŒ–","categories":["3.å¼€å‘æ¡†æ¶","ROS"]},{"title":"ASP.NETç¨‹åºå¼€å‘èŒƒä¾‹å®å…¸(C#)ç¬¬2ç« æºç å®æˆ˜æ•™ç¨‹","path":"/2025/11/28/2-ç¼–ç¨‹è¯­è¨€-CSharp-ASP-NETç¨‹åºå¼€å‘èŒƒä¾‹å®å…¸-C-ç¬¬2ç« æºç å®æˆ˜æ•™ç¨‹/","content":"1. ASP.NET åŸºç¡€æ¦‚å¿µASP.NET æ˜¯ä¸€ç§ç”¨äºæ„å»º Web åº”ç”¨ç¨‹åºçš„å¼€æºæ¡†æ¶ï¼Œå®ƒåŸºäº Microsoft.NET Frameworkã€‚å®ƒæä¾›äº†ä¸€ç»„åŠŸèƒ½å¼ºå¤§çš„å·¥å…·å’ŒæœåŠ¡ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿå¿«é€Ÿè½»æ¾åœ°åˆ›å»ºäº¤äº’å¼ã€å¯æ‰©å±•ä¸”å®‰å…¨çš„ Web åº”ç”¨ç¨‹åºã€‚ ASP.NET åº”ç”¨ç¨‹åºç”±ä¸€ç³»åˆ—é¡µé¢ç»„æˆï¼Œè¿™äº›é¡µé¢åŒ…å« HTMLã€CSS å’ŒæœåŠ¡å™¨ç«¯ä»£ç ã€‚æœåŠ¡å™¨ç«¯ä»£ç ä½¿ç”¨ C# ç¼–å†™ï¼Œå¹¶ä½¿ç”¨ ASP.NET ç¼–è¯‘å™¨ç¼–è¯‘æˆä¸­é—´è¯­è¨€ (IL)ã€‚IL ç„¶åç”±å…¬å…±è¯­è¨€è¿è¡Œæ—¶ (CLR) æ‰§è¡Œï¼ŒCLR æ˜¯.NET Framework çš„ä¸€éƒ¨åˆ†ã€‚ 2. ç½‘é¡µåˆ›å»º2.1 ASP.NET é¡µé¢ç»“æ„ASP.NET é¡µé¢ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š HTML æ ‡è®°ï¼š å®šä¹‰é¡µé¢çš„å¸ƒå±€å’Œå†…å®¹ã€‚ ASP.NET æŒ‡ä»¤ï¼š æ§åˆ¶é¡µé¢è¡Œä¸ºï¼Œä¾‹å¦‚ %@ Page % æŒ‡ä»¤æŒ‡å®šé¡µé¢è¯­è¨€å’Œä»£ç éšè—æ–‡ä»¶ã€‚ æœåŠ¡å™¨æ§ä»¶ï¼š åŠ¨æ€ç”Ÿæˆ HTML å†…å®¹çš„æ§ä»¶ï¼Œä¾‹å¦‚ Label å’Œ TextBox ã€‚ 2.2 ASP.NET é¡µé¢ç”Ÿå‘½å‘¨æœŸASP.NET é¡µé¢ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€ä¸ªå¤„ç†è¯·æ±‚å¹¶ç”Ÿæˆå“åº”çš„è¿‡ç¨‹ï¼Œå®ƒåŒ…æ‹¬ä»¥ä¸‹é˜¶æ®µï¼š åˆå§‹åŒ–ï¼š åˆ›å»ºé¡µé¢å®ä¾‹å¹¶åŠ è½½è§†å›¾çŠ¶æ€ã€‚ åŠ è½½ï¼š ä»è¯·æ±‚ä¸­åŠ è½½æ§ä»¶å¹¶åˆå§‹åŒ–å®ƒä»¬ã€‚ éªŒè¯ï¼š éªŒè¯æ§ä»¶è¾“å…¥å¹¶æ‰§è¡ŒéªŒè¯å™¨ã€‚ äº‹ä»¶å¤„ç†ï¼š å¤„ç†é¡µé¢äº‹ä»¶ï¼Œä¾‹å¦‚æŒ‰é’®å•å‡»ã€‚ å‘ˆç°ï¼š å°†é¡µé¢å‘ˆç°ä¸º HTMLã€‚ å¸è½½ï¼š é‡Šæ”¾é¡µé¢èµ„æºå¹¶ä¿å­˜è§†å›¾çŠ¶æ€ã€‚ 2.3 Master Page å’Œç”¨æˆ·æ§ä»¶Master Page å®šä¹‰ç½‘ç«™çš„å…¬å…±å¸ƒå±€å’Œå¯¼èˆªã€‚ å­é¡µé¢ç»§æ‰¿ Master Page çš„å¸ƒå±€å’ŒåŠŸèƒ½ã€‚ ç”¨æˆ·æ§ä»¶ å¯é‡ç”¨çš„æ§ä»¶ï¼Œå¯ä»¥åŒ…å« HTML æ ‡è®°ã€æœåŠ¡å™¨æ§ä»¶å’Œä»£ç ã€‚ å¯ä»¥æ·»åŠ åˆ°å¤šä¸ªé¡µé¢ä¸­ï¼Œæä¾›ä¸€è‡´çš„ UI å’ŒåŠŸèƒ½ã€‚ ä»£ç ç¤ºä¾‹ï¼š // Master Page%@ Master Language=C# AutoEventWireup=true CodeBehind=Site.master.cs Inherits=WebApplication1.SiteMaster %htmlhead titleMaster Page/title/headbody form runat=server asp:ContentPlaceHolder ID=MainContent runat=server /asp:ContentPlaceHolder /form/body/html// å­é¡µé¢%@ Page 3. æœåŠ¡å™¨æ§ä»¶3.1 æœåŠ¡å™¨æ§ä»¶æ¦‚è¿°æœåŠ¡å™¨æ§ä»¶æ˜¯ ASP.NET ä¸­ç”¨æ¥åˆ›å»ºåŠ¨æ€ç½‘é¡µå†…å®¹çš„æ§ä»¶ã€‚å®ƒä»¬ä¸ HTML æ§ä»¶ç±»ä¼¼ï¼Œä½†å…·æœ‰æ›´å¤šåŠŸèƒ½ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œä»£ç ã€‚ æœåŠ¡å™¨æ§ä»¶æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š å£°æ˜æ€§ï¼šæœåŠ¡å™¨æ§ä»¶åœ¨ ASP.NET é¡µé¢ä¸­ä»¥å£°æ˜æ–¹å¼å®šä¹‰ï¼Œè€Œä¸æ˜¯åœ¨ä»£ç ä¸­åˆ›å»ºã€‚ å¯ç¼–ç¨‹ï¼šæœåŠ¡å™¨æ§ä»¶å¯ä»¥åŒ…å«ä»£ç ï¼Œåœ¨é¡µé¢åŠ è½½æˆ–å…¶ä»–äº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œã€‚ çŠ¶æ€ç»´æŠ¤ï¼šæœåŠ¡å™¨æ§ä»¶å¯ä»¥ç»´æŠ¤çŠ¶æ€ï¼Œå³ä½¿é¡µé¢è¢«é‡æ–°åŠ è½½ã€‚ 3.2 å¸¸è§çš„æœåŠ¡å™¨æ§ä»¶ASP.NET æä¾›äº†å¹¿æ³›çš„æœåŠ¡å™¨æ§ä»¶ï¼Œç”¨äºå„ç§å¸¸è§ä»»åŠ¡ï¼ŒåŒ…æ‹¬ï¼š æ§ä»¶ ç”¨é€” Label æ˜¾ç¤ºæ–‡æœ¬ TextBox è¾“å…¥æ–‡æœ¬ Button æäº¤è¡¨å•æˆ–æ‰§è¡Œæ“ä½œ DropDownList ä»é€‰é¡¹åˆ—è¡¨ä¸­é€‰æ‹©å€¼ GridView æ˜¾ç¤ºå’Œç¼–è¾‘æ•°æ® DetailsView æ˜¾ç¤ºå•ä¸ªæ•°æ®é¡¹ FormView æ˜¾ç¤ºå’Œç¼–è¾‘å•ä¸ªæ•°æ®é¡¹ 3.3 è‡ªå®šä¹‰æœåŠ¡å™¨æ§ä»¶é™¤äº†å†…ç½®çš„æœåŠ¡å™¨æ§ä»¶ï¼Œè¿˜å¯ä»¥åˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰æœåŠ¡å™¨æ§ä»¶ã€‚è¿™å…è®¸å¼€å‘äººå‘˜åˆ›å»ºæ»¡è¶³ç‰¹å®šéœ€æ±‚çš„æ§ä»¶ã€‚ åˆ›å»ºè‡ªå®šä¹‰æœåŠ¡å™¨æ§ä»¶æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š åˆ›å»ºä¸€ä¸ªæ´¾ç”Ÿè‡ª `System.Web.UI.Control` ç±»çš„ç±»ã€‚ åœ¨ç±»ä¸­å®ç°æ‰€éœ€çš„åŠŸèƒ½ã€‚ å°†æ§ä»¶æ³¨å†Œåˆ° ASP.NET è¿è¡Œæ—¶ã€‚ public class MyCustomControl : System.Web.UI.Control // å®ç°æ‰€éœ€çš„åŠŸèƒ½... protected override void Render(HtmlTextWriter writer) // æ¸²æŸ“æ§ä»¶... ç„¶åï¼Œå¯ä»¥åœ¨ ASP.NET é¡µé¢ä¸­ä½¿ç”¨è‡ªå®šä¹‰æ§ä»¶ï¼š uc:MyCustomControl runat=server /html ä»£ç ç¤ºä¾‹ä»¥ä¸‹ä»£ç ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨æœåŠ¡å™¨æ§ä»¶ï¼š asp:Label ID=Label1 runat=server Text=Hello World! /asp:Button ID=Button1 runat=server Text=Click Me OnClick=Button1_Click / protected void Button1_Click(object sender, EventArgs e) Label1.Text = Button clicked!;html åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ Label1 æœåŠ¡å™¨æ§ä»¶ç”¨äºæ˜¾ç¤ºæ–‡æœ¬ï¼Œè€Œ Button1 æœåŠ¡å™¨æ§ä»¶ç”¨äºæäº¤è¡¨å•å¹¶æ‰§è¡Œ Button1_Click äº‹ä»¶å¤„ç†ç¨‹åºã€‚ 4. æ•°æ®ç»‘å®š4.1 æ•°æ®ç»‘å®šæ¦‚è¿°æ•°æ®ç»‘å®šæ˜¯ä¸€ç§æŠ€æœ¯ï¼Œå®ƒå…è®¸ ASP.NET é¡µé¢ä¸æ•°æ®æºï¼ˆå¦‚æ•°æ®åº“ã€å¯¹è±¡æˆ– XML æ–‡ä»¶ï¼‰è¿›è¡Œäº¤äº’ã€‚é€šè¿‡æ•°æ®ç»‘å®šï¼Œé¡µé¢å¯ä»¥åŠ¨æ€åœ°æ˜¾ç¤ºã€ç¼–è¾‘å’Œæ›´æ–°æ•°æ®ï¼Œè€Œæ— éœ€æ‰‹åŠ¨ç¼–å†™ä»£ç æ¥æ“ä½œæ•°æ®ã€‚ 4.2 æ•°æ®æºå’Œæ•°æ®ç»‘å®šæ§ä»¶æ•°æ®æºæ•°æ®æºæ˜¯åŒ…å«æ•°æ®çš„å¯¹è±¡æˆ–æ–‡ä»¶ã€‚ASP.NET æ”¯æŒå¤šç§æ•°æ®æºï¼ŒåŒ…æ‹¬ï¼š SQL Server æ•°æ®åº“ Oracle æ•°æ®åº“ XML æ–‡ä»¶ å¯¹è±¡é›†åˆ Web æœåŠ¡ æ•°æ®ç»‘å®šæ§ä»¶æ•°æ®ç»‘å®šæ§ä»¶æ˜¯ ASP.NET æ§ä»¶ï¼Œç”¨äºå°†æ•°æ®æºä¸­çš„æ•°æ®æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šã€‚å¸¸è§çš„ç”¨äºæ•°æ®ç»‘å®šçš„æ§ä»¶åŒ…æ‹¬ï¼š GridView ï¼šæ˜¾ç¤ºæ•°æ®è¡¨ä¸­çš„æ•°æ® ListView ï¼šæ˜¾ç¤ºå¯è‡ªå®šä¹‰çš„åˆ—è¡¨æ•°æ® Repeater ï¼šæ˜¾ç¤ºå¯é‡å¤çš„æ•°æ®é¡¹ DataList ï¼šæ˜¾ç¤ºå¯è‡ªå®šä¹‰çš„æ•°æ®åˆ—è¡¨ 4.3 æ•°æ®ç»‘å®šè¡¨è¾¾å¼æ•°æ®ç»‘å®šè¡¨è¾¾å¼ç”¨äºæŒ‡å®šæ•°æ®æºä¸­çš„æ•°æ®é¡¹ä¸æ•°æ®ç»‘å®šæ§ä»¶ä¸­çš„æ§ä»¶ä¹‹é—´çš„å…³ç³»ã€‚è¡¨è¾¾å¼ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š %# DataBinder.Eval(Container, FieldName) % å…¶ä¸­ï¼š Container æ˜¯åŒ…å«æ•°æ®ç»‘å®šæ§ä»¶çš„å®¹å™¨æ§ä»¶ FieldName æ˜¯æ•°æ®æºä¸­çš„å­—æ®µåç§° ä¾‹å¦‚ï¼Œä»¥ä¸‹è¡¨è¾¾å¼å°† GridView ä¸­çš„ Name å­—æ®µç»‘å®šåˆ° Label æ§ä»¶ï¼š asp:Label ID=NameLabel runat=server Text=%# DataBinder.Eval(Container, Name) % / 4.4 æ•°æ®ç»‘å®šç¤ºä¾‹ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨æ•°æ®ç»‘å®šæ˜¾ç¤ºæ•°æ®åº“æ•°æ®çš„ç¤ºä¾‹ï¼š protected void Page_Load(object sender, EventArgs e) // åˆ›å»ºä¸€ä¸ªæ•°æ®æº SqlDataSource dataSource = new SqlDataSource(); dataSource.ConnectionString = Data Source=localhost;Initial Catalog=MyDatabase;Integrated Security=True; dataSource.SelectCommand = SELECT * FROM Customers; // å°†æ•°æ®æºç»‘å®šåˆ° GridView GridView1.DataSource = dataSource; GridView1.DataBind();csharp asp:GridView ID=GridView1 runat=server AutoGenerateColumns=true /html åœ¨é¡µé¢åŠ è½½æ—¶ï¼Œ Page_Load äº‹ä»¶å¤„ç†ç¨‹åºåˆ›å»ºäº†ä¸€ä¸ª SqlDataSource å¯¹è±¡ï¼Œå¹¶å°†å…¶é…ç½®ä¸ºä»æ•°æ®åº“ä¸­é€‰æ‹©æ•°æ®ã€‚ç„¶åï¼Œå°†æ•°æ®æºç»‘å®šåˆ° GridView æ§ä»¶ï¼Œå¹¶ä¸” GridView ä¼šè‡ªåŠ¨ç”Ÿæˆåˆ—æ¥æ˜¾ç¤ºæ•°æ®ã€‚ 4.5 æ•°æ®ç»‘å®šæ¨¡å¼ASP.NET æ”¯æŒä¸¤ç§æ•°æ®ç»‘å®šæ¨¡å¼ï¼š å•å‘æ•°æ®ç»‘å®š ï¼šæ•°æ®æºä¸­çš„æ›´æ”¹ä¸ä¼šè‡ªåŠ¨åæ˜ åœ¨æ•°æ®ç»‘å®šæ§ä»¶ä¸­ã€‚ åŒå‘æ•°æ®ç»‘å®š ï¼šæ•°æ®æºä¸­çš„æ›´æ”¹ä¼šè‡ªåŠ¨åæ˜ åœ¨æ•°æ®ç»‘å®šæ§ä»¶ä¸­ï¼Œåä¹‹äº¦ç„¶ã€‚ åŒå‘æ•°æ®ç»‘å®š é€šå¸¸ç”¨äºå…è®¸ç”¨æˆ·ç¼–è¾‘å’Œæ›´æ–°æ•°æ®ã€‚ 4.6 æ•°æ®ç»‘å®šæ€§èƒ½ä¼˜åŒ–æ•°æ®ç»‘å®šå¯ä»¥å½±å“é¡µé¢çš„æ€§èƒ½ã€‚ä¸ºäº†ä¼˜åŒ–æ•°æ®ç»‘å®šæ€§èƒ½ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æŠ€å·§ï¼š ä½¿ç”¨æ•°æ®ç¼“å­˜ ï¼šå°†æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œä»¥é¿å…æ¯æ¬¡è¯·æ±‚éƒ½ä»æ•°æ®æºä¸­è·å–æ•°æ®ã€‚ ä½¿ç”¨åˆ†é¡µ ï¼šå°†æ•°æ®åˆ†æˆè¾ƒå°çš„å—ï¼Œä»¥é¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®ã€‚ ä½¿ç”¨è™šæ‹ŸåŒ– ï¼šåªåŠ è½½å½“å‰å¯è§çš„æ•°æ®ï¼Œä»¥å‡å°‘å†…å­˜æ¶ˆè€—ã€‚ ä½¿ç”¨å»¶è¿ŸåŠ è½½ ï¼šåªåœ¨éœ€è¦æ—¶åŠ è½½æ•°æ®ï¼Œä»¥æé«˜é¡µé¢åŠ è½½é€Ÿåº¦ã€‚ 5. ç”¨æˆ·äº¤äº’5.1 è¡¨å•å¤„ç†è¡¨å•å¤„ç†æ¦‚è¿°è¡¨å•æ˜¯ç”¨æˆ·ä¸ ASP.NET åº”ç”¨ç¨‹åºäº¤äº’çš„ä¸»è¦æ–¹å¼ä¹‹ä¸€ã€‚é€šè¿‡è¡¨å•ï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥æ•°æ®ã€æäº¤è¯·æ±‚å¹¶è§¦å‘ç‰¹å®šæ“ä½œã€‚ASP.NET æä¾›äº†å¼ºå¤§çš„è¡¨å•å¤„ç†åŠŸèƒ½ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿè½»æ¾å¤„ç†ç”¨æˆ·æäº¤çš„æ•°æ®ã€‚ è¡¨å•æ§ä»¶ASP.NET æä¾›äº†å„ç§è¡¨å•æ§ä»¶ï¼ŒåŒ…æ‹¬æ–‡æœ¬æ¡†ã€æŒ‰é’®ã€å•é€‰æŒ‰é’®å’Œå¤é€‰æ¡†ã€‚è¿™äº›æ§ä»¶å…è®¸ ç”¨æˆ·è¾“å…¥ ä¸åŒç±»å‹çš„æ•°æ®ï¼Œä¾‹å¦‚æ–‡æœ¬ã€æ•°å­—å’Œå¸ƒå°”å€¼ã€‚ è¡¨å•æäº¤å½“ç”¨æˆ·æäº¤è¡¨å•æ—¶ï¼ŒASP.NET ä¼šå°†è¡¨å•æ•°æ®å‘é€åˆ°æœåŠ¡å™¨ã€‚è¡¨å•æ•°æ®å­˜å‚¨åœ¨ Request.Form é›†åˆä¸­ã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨æ­¤é›†åˆè®¿é—®ç”¨æˆ·æäº¤çš„æ•°æ®ã€‚ è¡¨å•å¤„ç†ä»£ç è¡¨å•å¤„ç†ä»£ç é€šå¸¸å†™åœ¨ä»£ç åˆ†ç¦»æ–‡ä»¶ä¸­ã€‚å½“è¡¨å•æäº¤æ—¶ï¼ŒASP.NET ä¼šè°ƒç”¨ä»£ç åˆ†ç¦»æ–‡ä»¶ä¸­çš„ Page_Load äº‹ä»¶å¤„ç†ç¨‹åºã€‚åœ¨ Page_Load äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼Œå¼€å‘äººå‘˜å¯ä»¥è®¿é—®è¡¨å•æ•°æ®å¹¶æ‰§è¡Œå¿…è¦çš„å¤„ç†ã€‚ è¡¨å•éªŒè¯è¡¨å•éªŒè¯æ˜¯ç¡®ä¿ç”¨æˆ·è¾“å…¥æœ‰æ•ˆæ•°æ®çš„å…³é”®æ­¥éª¤ã€‚ASP.NET æä¾›äº†å„ç§éªŒè¯æ§ä»¶ï¼Œä¾‹å¦‚ RequiredFieldValidator å’Œ RegularExpressionValidator ã€‚è¿™äº›æ§ä»¶å…è®¸å¼€å‘äººå‘˜éªŒè¯ç”¨æˆ·è¾“å…¥æ˜¯å¦ç¬¦åˆç‰¹å®šè§„åˆ™ã€‚ 5.2 éªŒè¯å’Œé”™è¯¯å¤„ç†éªŒè¯æ¦‚è¿°éªŒè¯æ˜¯ç¡®ä¿ç”¨æˆ·è¾“å…¥æœ‰æ•ˆæ•°æ®çš„è¿‡ç¨‹ã€‚ASP.NET æä¾›äº†å„ç§éªŒè¯æ§ä»¶ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿè½»æ¾éªŒè¯ç”¨æˆ·è¾“å…¥ã€‚ éªŒè¯æ§ä»¶ASP.NET éªŒè¯æ§ä»¶åŒ…æ‹¬ï¼š RequiredFieldValidator ï¼šéªŒè¯å­—æ®µæ˜¯å¦å·²å¡«å†™ã€‚ RegularExpressionValidator ï¼šéªŒè¯å­—æ®µæ˜¯å¦ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚ CompareValidator ï¼šéªŒè¯å­—æ®µæ˜¯å¦ä¸å¦ä¸€ä¸ªå­—æ®µåŒ¹é…ã€‚ RangeValidator ï¼šéªŒè¯å­—æ®µæ˜¯å¦åœ¨æŒ‡å®šèŒƒå›´å†…ã€‚ é”™è¯¯å¤„ç†å½“éªŒè¯å¤±è´¥æ—¶ï¼ŒASP.NET ä¼šæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ ValidationSummary æ§ä»¶æ¥æ˜¾ç¤ºæ‰€æœ‰éªŒè¯é”™è¯¯çš„æ‘˜è¦ã€‚ 5.3 å®¢æˆ·è„šæœ¬å’Œ AJAXå®¢æˆ·è„šæœ¬æ¦‚è¿°å®¢æˆ·è„šæœ¬æ˜¯åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰æ‰§è¡Œçš„ JavaScript ä»£ç ã€‚ASP.NET æä¾›äº† ClientScriptManager ç±»ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿè½»æ¾æ³¨å†Œå’Œæ‰§è¡Œå®¢æˆ·è„šæœ¬ã€‚ AJAX æ¦‚è¿°AJAXï¼ˆå¼‚æ­¥ JavaScript å’Œ XMLï¼‰æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œå…è®¸ Web åº”ç”¨ç¨‹åºåœ¨ä¸é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢çš„æƒ…å†µä¸‹ä¸æœåŠ¡å™¨è¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚ASP.NET æä¾›äº† ScriptManager ç±»ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿè½»æ¾å®ç° AJAX åŠŸèƒ½ã€‚ å®¢æˆ·è„šæœ¬å’Œ AJAX çš„ä¼˜ç‚¹å®¢æˆ·è„šæœ¬å’Œ AJAX æä¾›äº†ä»¥ä¸‹ä¼˜ç‚¹ï¼š æé«˜å“åº”é€Ÿåº¦ï¼šé€šè¿‡åœ¨å®¢æˆ·ç«¯å¤„ç†è¯·æ±‚ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨è¯·æ±‚çš„æ•°é‡ï¼Œä»è€Œæé«˜å“åº”é€Ÿåº¦ã€‚ å¢å¼ºç”¨æˆ·ä½“éªŒï¼šAJAX å…è®¸åº”ç”¨ç¨‹åºåœ¨ä¸é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢çš„æƒ…å†µä¸‹æ›´æ–°éƒ¨åˆ†å†…å®¹ï¼Œä»è€Œå¢å¼ºç”¨æˆ·ä½“éªŒã€‚ å‡å°‘æœåŠ¡å™¨è´Ÿè½½ï¼šé€šè¿‡åœ¨å®¢æˆ·ç«¯å¤„ç†è¯·æ±‚ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨è´Ÿè½½ã€‚ 6. çŠ¶æ€ç®¡ç†**çŠ¶æ€ç®¡ç†æ˜¯ ASP.NET åº”ç”¨ç¨‹åºä¸­è‡³å…³é‡è¦çš„æ¦‚å¿µï¼Œå®ƒå…è®¸åº”ç”¨ç¨‹åºåœ¨è¯·æ±‚ä¹‹é—´ä¿ç•™ä¿¡æ¯ã€‚æœ¬ç« å°†æ¢è®¨ ASP.NET ä¸­å¯ç”¨çš„å„ç§çŠ¶æ€ç®¡ç†æŠ€æœ¯ï¼ŒåŒ…æ‹¬ ViewStateã€ Session ã€Cookies å’Œç¼“å­˜ã€‚ 6.1 çŠ¶æ€ç®¡ç†æ¦‚è¿°åœ¨ ASP.NET åº”ç”¨ç¨‹åºä¸­ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œè¿™æ„å‘³ç€å½“ç”¨æˆ·æäº¤è¡¨å•æˆ–å¯¼èˆªåˆ°æ–°é¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨å°†é‡æ–°åˆ›å»ºåº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚ä¸ºäº†åœ¨è¯·æ±‚ä¹‹é—´ä¿ç•™ä¿¡æ¯ï¼Œåº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨çŠ¶æ€ç®¡ç†æŠ€æœ¯ã€‚ çŠ¶æ€ç®¡ç†æŠ€æœ¯å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š æœåŠ¡å™¨ç«¯çŠ¶æ€ç®¡ç†ï¼š ä¿¡æ¯å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œä¾‹å¦‚ ViewState å’Œ Sessionã€‚ å®¢æˆ·ç«¯ç«¯çŠ¶æ€ç®¡ç†ï¼š ä¿¡æ¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ä¸Šï¼Œä¾‹å¦‚ Cookies å’Œç¼“å­˜ã€‚ 6.2 ViewState å’Œ SessionViewState å’Œ Session æ˜¯ ASP.NET ä¸­æœ€å¸¸ç”¨çš„æœåŠ¡å™¨ç«¯çŠ¶æ€ç®¡ç†æŠ€æœ¯ã€‚ ViewStateViewState æ˜¯ä¸€ä¸ªéšè—å­—æ®µï¼Œå®ƒå­˜å‚¨é¡µé¢æ§ä»¶çš„çŠ¶æ€ä¿¡æ¯ã€‚å½“é¡µé¢å›å‘æ—¶ï¼ŒViewState æ•°æ®ä¼šè‡ªåŠ¨è¿˜åŸåˆ°æ§ä»¶ä¸­ã€‚è¿™ä½¿å¾—æ§ä»¶å¯ä»¥ä¿ç•™å…¶å€¼ï¼Œå³ä½¿é¡µé¢è¢«é‡æ–°åŠ è½½ã€‚ ä»£ç ç¤ºä¾‹ï¼š protected void Page_Load(object sender, EventArgs e) if (!IsPostBack) // é¡µé¢é¦–æ¬¡åŠ è½½ ViewState[Name] = John Doe; else // é¡µé¢å›å‘ string name = ViewState[Name].ToString(); csharp å‚æ•°è¯´æ˜ï¼š ViewState[Name] ï¼šè·å–æˆ–è®¾ç½® ViewState ä¸­åä¸º â€œNameâ€ çš„å€¼ã€‚ SessionSession å¯¹è±¡å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œå®ƒå…è®¸åº”ç”¨ç¨‹åºåœ¨ç”¨æˆ·ä¼šè¯æœŸé—´ä¿ç•™ä¿¡æ¯ã€‚ä¼šè¯æ•°æ®åœ¨ä¼šè¯è¿‡æœŸä¹‹å‰ä¸€ç›´å¯ç”¨ï¼Œå³ä½¿ç”¨æˆ·å¯¼èˆªåˆ°ä¸åŒçš„é¡µé¢ã€‚ ä»£ç ç¤ºä¾‹ï¼š protected void Page_Load(object sender, EventArgs e) if (!IsPostBack) // é¡µé¢é¦–æ¬¡åŠ è½½ Session[Cart] = new ListProduct(); else // é¡µé¢å›å‘ ListProduct cart = (ListProduct)Session[Cart]; csharp å‚æ•°è¯´æ˜ï¼š Session[Cart] ï¼šè·å–æˆ–è®¾ç½® Session ä¸­åä¸º â€œCartâ€ çš„å€¼ã€‚ 6.3 Cookies å’Œç¼“å­˜Cookies å’Œç¼“å­˜æ˜¯å®¢æˆ·ç«¯ç«¯çŠ¶æ€ç®¡ç†æŠ€æœ¯ã€‚ CookiesCookies æ˜¯å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸Šçš„å°æ–‡æœ¬æ–‡ä»¶ã€‚å®ƒä»¬ç”¨äºåœ¨å®¢æˆ·ç«¯ä¿ç•™ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·é¦–é€‰é¡¹æˆ–ç™»å½•çŠ¶æ€ã€‚ ä»£ç ç¤ºä¾‹ï¼š Response.Cookies[Language].Value = en-US;csharp å‚æ•°è¯´æ˜ï¼š Response.Cookies[Language] ï¼šè·å–æˆ–è®¾ç½®åä¸º â€œLanguageâ€ çš„ Cookieã€‚ ç¼“å­˜ç¼“å­˜æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒå…è®¸åº”ç”¨ç¨‹åºå°†æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜ä¸­ã€‚è¿™å¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒå¯ä»¥é¿å…ä»æ•°æ®åº“æˆ–å…¶ä»–æ•°æ®æºé‡å¤æ£€ç´¢æ•°æ®ã€‚ ä»£ç ç¤ºä¾‹ï¼š Cache[Products] = GetProducts();csharp å‚æ•°è¯´æ˜ï¼š Cache[Products] ï¼šè·å–æˆ–è®¾ç½® Cache ä¸­åä¸º â€œProductsâ€ çš„å€¼ã€‚ 7. ä»£ç åˆ†ç¦»7.1 ä»£ç åˆ†ç¦»æ¦‚è¿°ä»£ç åˆ†ç¦»æ˜¯ä¸€ç§å°† ASP.NET é¡µé¢ä¸­çš„ä»£ç ä¸æ ‡è®°åˆ†ç¦»çš„æŠ€æœ¯ã€‚å®ƒæœ‰åŠ©äºæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§ï¼Œå¹¶å…è®¸å¼€å‘äººå‘˜ä½¿ç”¨æ›´å…·è¡¨è¾¾æ€§çš„è¯­è¨€ï¼ˆä¾‹å¦‚ C#ï¼‰æ¥ç¼–å†™ä»£ç ã€‚ 7.2 Code-Behind æ–‡ä»¶Code-Behind æ–‡ä»¶æ˜¯ä¸€ä¸ª C# ç±»æ–‡ä»¶ï¼Œå®ƒåŒ…å«ä¸ ASP.NET é¡µé¢å…³è”çš„ä»£ç ã€‚è¯¥æ–‡ä»¶é€šå¸¸ä¸ ASP.NET é¡µé¢å…·æœ‰ç›¸åŒçš„æ–‡ä»¶åï¼Œä½†å…·æœ‰.cs æ‰©å±•åã€‚ä¾‹å¦‚ï¼Œå¦‚æœ ASP.NET é¡µé¢åä¸º Default.aspxï¼Œåˆ™ Code-Behind æ–‡ä»¶å°†åä¸º Default.aspx.csã€‚ Code-Behind æ–‡ä»¶ä¸­çš„ä»£ç å¯ä»¥è®¿é—® ASP.NET é¡µé¢ä¸­çš„æ§ä»¶å’Œå±æ€§ï¼Œå¹¶å¯ä»¥å¤„ç†äº‹ä»¶ã€‚è¿™å…è®¸å¼€å‘äººå‘˜å°†ä¸šåŠ¡é€»è¾‘ä¸æ ‡è®°åˆ†ç¦»ï¼Œä»è€Œä½¿é¡µé¢æ›´æ˜“äºç»´æŠ¤å’Œç†è§£ã€‚ 7.3 MVC æ¶æ„MVCï¼ˆæ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼‰æ¶æ„æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒå°†åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘ã€è¡¨ç¤ºå±‚å’Œæ§åˆ¶å±‚åˆ†ç¦»ã€‚åœ¨ MVC æ¶æ„ä¸­ï¼Œæ¨¡å‹è´Ÿè´£ç®¡ç†åº”ç”¨ç¨‹åºçš„æ•°æ®ï¼Œè§†å›¾è´Ÿè´£å‘ˆç°æ•°æ®ï¼Œæ§åˆ¶å™¨è´Ÿè´£å¤„ç†ç”¨æˆ·è¾“å…¥å¹¶åè°ƒæ¨¡å‹å’Œè§†å›¾ä¹‹é—´çš„äº¤äº’ã€‚ ASP.NET MVC æ˜¯ MVC æ¶æ„çš„ä¸€ä¸ªå®ç°ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªè½»é‡çº§çš„æ¡†æ¶ï¼Œç”¨äºæ„å»º Web åº”ç”¨ç¨‹åºã€‚ASP.NET MVC åº”ç”¨ç¨‹åºç”±ä»¥ä¸‹ç»„ä»¶ç»„æˆï¼š æ¨¡å‹ï¼š åŒ…å«åº”ç”¨ç¨‹åºæ•°æ®çš„ç±»ã€‚ è§†å›¾ï¼š ç”¨äºå‘ˆç°æ•°æ®çš„ Razor è§†å›¾æˆ– ASPX é¡µé¢ã€‚ æ§åˆ¶å™¨ï¼š å¤„ç†ç”¨æˆ·è¯·æ±‚å¹¶åè°ƒæ¨¡å‹å’Œè§†å›¾ä¹‹é—´çš„äº¤äº’ã€‚ MVC æ¶æ„æœ‰åŠ©äºæé«˜åº”ç”¨ç¨‹åºçš„å¯æµ‹è¯•æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚å®ƒè¿˜å…è®¸å¼€å‘äººå‘˜ä½¿ç”¨æ›´å…·è¡¨è¾¾æ€§çš„è¯­è¨€ï¼ˆä¾‹å¦‚ C#ï¼‰æ¥ç¼–å†™ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶ä½¿ç”¨æ›´ç®€å•çš„è¯­è¨€ï¼ˆä¾‹å¦‚ HTMLï¼‰æ¥ç¼–å†™è¡¨ç¤ºå±‚ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"Wed Nov 26 2025 00:00:00 GMT+0000 (Coordinated Universal Time)","path":"/2025/11/27/2-ç¼–ç¨‹è¯­è¨€-CSharp-Csharpé¢è¯•é¢˜/","content":"1ã€ç»´æŠ¤æ•°æ®åº“çš„å®Œæ•´æ€§ã€ä¸€è‡´æ€§ï¼Œä½ å–œæ¬¢ç”¨è§¦å‘å™¨è¿˜æ˜¯è‡ªå†™ä¸šåŠ¡é€»è¾‘ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿä¼˜å…ˆé€‰æ‹©è‡ªå†™ä¸šåŠ¡é€»è¾‘ï¼Œå¤æ‚åœºæ™¯è¾…åŠ©è§¦å‘å™¨ï¼Œæ ¸å¿ƒåŸå› æ˜¯ã€Œå¯ç»´æŠ¤æ€§ã€å’Œã€Œçµæ´»æ€§ã€ï¼š ã€Œè‡ªå†™ä¸šåŠ¡é€»è¾‘ã€çš„ä¼˜åŠ¿ï¼š é€æ˜æ€§å¼ºï¼šé€»è¾‘åœ¨åº”ç”¨ä»£ç ä¸­ï¼Œè°ƒè¯•ã€æ’æŸ¥é—®é¢˜ç›´è§‚ï¼ˆæ¯”å¦‚æ—¥å¿—å¯è·Ÿè¸ªï¼‰ï¼› ä½è€¦åˆï¼šä¸ä¾èµ–æ•°æ®åº“ç‰¹æ€§ï¼Œæ¢æ•°æ®åº“ï¼ˆå¦‚ MySQLâ†’PostgreSQLï¼‰æ—¶è¿ç§»æˆæœ¬ä½ï¼› çµæ´»æ‰©å±•ï¼šå¤æ‚ä¸šåŠ¡ï¼ˆå¦‚è·¨ç³»ç»Ÿæ ¡éªŒã€å…³è”ç¬¬ä¸‰æ–¹æ¥å£ï¼‰å¯ç›´æ¥é›†æˆï¼Œè§¦å‘å™¨éš¾ä»¥å®ç°ï¼› ä¾¿äºæµ‹è¯•ï¼šå¯é€šè¿‡å•å…ƒæµ‹è¯•è¦†ç›–é€»è¾‘ï¼Œè§¦å‘å™¨æµ‹è¯•éœ€ä¾èµ–æ•°æ®åº“ç¯å¢ƒã€‚ ã€Œè§¦å‘å™¨ã€çš„é€‚ç”¨åœºæ™¯ï¼š å¼ºåˆ¶åº•å±‚çº¦æŸï¼ˆå¦‚è·¨è¡¨æ•°æ®åŒæ­¥ã€æ—¥å¿—è‡ªåŠ¨è®°å½•ï¼‰ï¼Œé¿å…åº”ç”¨å±‚é—æ¼ï¼› ç®€å•è§„åˆ™ï¼ˆå¦‚æ›´æ–°æ—¶é—´è‡ªåŠ¨å¡«å……ã€å­—æ®µå€¼è”åŠ¨ä¿®æ”¹ï¼‰ï¼Œå‡å°‘é‡å¤ä»£ç ã€‚ æ€»ç»“ï¼šè§¦å‘å™¨æ˜¯ã€Œæ•°æ®åº“çº§åˆ«çš„å…œåº•æ–¹æ¡ˆã€ï¼Œä¸šåŠ¡é€»è¾‘æ˜¯ã€Œåº”ç”¨çº§åˆ«çš„æ ¸å¿ƒæ–¹æ¡ˆã€ï¼Œä¼˜å…ˆç”¨ä¸šåŠ¡é€»è¾‘ä¿è¯ä»£ç å¯ç»´æŠ¤æ€§ï¼Œä»…åœ¨éœ€è¦å¼ºåˆ¶çº¦æŸæ—¶ç”¨è§¦å‘å™¨ã€‚ 2ã€ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿä»€ä¹ˆæ˜¯é”ï¼Ÿäº‹åŠ¡ å®šä¹‰ï¼šæ•°æ®åº“ä¸­ä¸€ç»„ä¸å¯åˆ†å‰²çš„ SQL æ“ä½œé›†åˆï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¤±è´¥ï¼ˆå›æ»šï¼‰ï¼Œæ ¸å¿ƒæ˜¯ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚ æ ¸å¿ƒç‰¹æ€§ï¼ˆACIDï¼‰ï¼š åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šæ“ä½œä¸å¯æ‹†åˆ†ï¼› ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šæ‰§è¡Œå‰åæ•°æ®ç¬¦åˆä¸šåŠ¡è§„åˆ™ï¼ˆå¦‚è½¬è´¦åæ€»é‡‘é¢ä¸å˜ï¼‰ï¼› éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šå¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œç›¸äº’ä¸å¹²æ‰°ï¼› æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šäº‹åŠ¡æäº¤åï¼Œæ•°æ®å˜æ›´æ°¸ä¹…ç”Ÿæ•ˆã€‚ é” å®šä¹‰ï¼šæ•°æ®åº“ä¸ºä¿è¯äº‹åŠ¡éš”ç¦»æ€§ï¼Œé˜²æ­¢å¹¶å‘è¯»å†™å†²çªçš„æœºåˆ¶ï¼ˆæœ¬è´¨æ˜¯èµ„æºå ç”¨æƒçš„æ§åˆ¶ï¼‰ã€‚ æ ¸å¿ƒä½œç”¨ï¼šè§£å†³å¹¶å‘é—®é¢˜ï¼ˆè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ï¼‰ï¼ŒæŒ‰ç²’åº¦å¯åˆ†ä¸ºã€Œè¡¨é”ã€ã€Œè¡Œé”ã€ã€Œé¡µé”ã€ï¼›æŒ‰ç±»å‹å¯åˆ†ä¸ºï¼š æ‚²è§‚é”ï¼šå‡è®¾å†²çªå¿…ç„¶å‘ç”Ÿï¼Œç›´æ¥é”å®šèµ„æºï¼ˆå¦‚ select ... for updateï¼‰ï¼› ä¹è§‚é”ï¼šå‡è®¾å†²çªä¸å‘ç”Ÿï¼Œé€šè¿‡ç‰ˆæœ¬å· æ—¶é—´æˆ³æ ¡éªŒï¼ˆå¦‚ where version = ?ï¼‰ã€‚ 3ã€ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿç´¢å¼• å®šä¹‰ï¼šæ•°æ®åº“ä¸­ä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡çš„ã€Œæ•°æ®ç»“æ„ã€ï¼ˆä¸»æµæ˜¯ B + æ ‘ï¼Œå“ˆå¸Œç´¢å¼•ç”¨äºç­‰å€¼æŸ¥è¯¢ï¼‰ï¼Œæœ¬è´¨æ˜¯å¯¹è¡¨ä¸­ä¸€åˆ—æˆ–å¤šåˆ—æ•°æ®æ’åºåçš„ â€œå¿«é€ŸæŸ¥æ‰¾ç›®å½•â€ã€‚ ä¼˜ç‚¹ æå‡æŸ¥è¯¢æ•ˆç‡ï¼šé¿å…å…¨è¡¨æ‰«æï¼Œé€šè¿‡ç´¢å¼•ç›´æ¥å®šä½æ•°æ®ï¼Œå°¤å…¶é€‚åˆ where æ¡ä»¶ã€join å…³è”ã€order by æ’åºåœºæ™¯ï¼› é™ä½ IO å¼€é”€ï¼šB + æ ‘ç»“æ„å°†æ•°æ®å±‚çº§å‹ç¼©ï¼ˆé€šå¸¸ 3-4 å±‚ï¼‰ï¼Œä¸€æ¬¡æŸ¥è¯¢åªéœ€ 3-4 æ¬¡ç£ç›˜ IOï¼› è¾…åŠ©çº¦æŸï¼šå”¯ä¸€ç´¢å¼•å¯ä¿è¯å­—æ®µå”¯ä¸€æ€§ï¼Œæ›¿ä»£éƒ¨åˆ†ä¸šåŠ¡æ ¡éªŒï¼› åŠ é€Ÿèšåˆè®¡ç®—ï¼šsumã€Œcountã€Œmax ç­‰èšåˆå‡½æ•°å¯é€šè¿‡ç´¢å¼•ç›´æ¥è·å–ç»“æœï¼Œæ— éœ€éå†å…¨è¡¨ã€‚ ï¼ˆè¡¥å……ï¼šç´¢å¼•ç¼ºç‚¹æ˜¯å ç”¨å­˜å‚¨ç©ºé—´ï¼Œä¸”æ’å…¥ æ›´æ–° åˆ é™¤æ—¶éœ€ç»´æŠ¤ç´¢å¼•ï¼Œä¼šé™ä½å†™æ“ä½œæ•ˆç‡ï¼Œéœ€åˆç†è®¾è®¡ï¼‰ 4ã€è§†å›¾æ˜¯ä»€ä¹ˆï¼Ÿæ¸¸æ ‡æ˜¯ä»€ä¹ˆï¼Ÿè§†å›¾ï¼ˆViewï¼‰ å®šä¹‰ï¼šåŸºäº SQL æŸ¥è¯¢ç»“æœé›†çš„ã€Œè™šæ‹Ÿè¡¨ã€ï¼Œä»…å­˜å‚¨æŸ¥è¯¢é€»è¾‘ï¼ˆä¸å­˜å‚¨å®é™…æ•°æ®ï¼‰ï¼Œæ•°æ®éšåŸè¡¨åŠ¨æ€å˜åŒ–ã€‚ æ ¸å¿ƒç”¨é€”ï¼šç®€åŒ–å¤æ‚æŸ¥è¯¢ï¼ˆå°†å¤šè¡¨å…³è”é€»è¾‘å°è£…ä¸ºè§†å›¾ï¼‰ã€éšè—æ•æ„Ÿå­—æ®µï¼ˆå¦‚åªæš´éœ²ç”¨æˆ·å§“åï¼Œéšè—æ‰‹æœºå·ï¼‰ã€æ§åˆ¶æƒé™ï¼ˆæˆäºˆè§†å›¾è®¿é—®æƒï¼Œä¸æš´éœ²åŸè¡¨ç»“æ„ï¼‰ã€‚ æ¸¸æ ‡ï¼ˆCursorï¼‰ å®šä¹‰ï¼šæ•°æ®åº“ä¸­å¤„ç†ç»“æœé›†çš„ã€ŒæŒ‡é’ˆã€ï¼Œç”¨äºé€æ¡è¯»å–æŸ¥è¯¢ç»“æœé›†çš„è¡Œæ•°æ®ï¼Œæ”¯æŒå¯¹å•è¡Œæ•°æ®çš„å•ç‹¬æ“ä½œã€‚ é€‚ç”¨åœºæ™¯ï¼šå¤æ‚é€è¡Œå¤„ç†ï¼ˆå¦‚æ‰¹é‡æ›´æ–°æ—¶éœ€åˆ¤æ–­æ¯è¡Œæ•°æ®é€»è¾‘ï¼‰ï¼Œä½†æ•ˆç‡è¾ƒä½ï¼ˆéœ€é¢‘ç¹ä¸æ•°æ®åº“äº¤äº’ï¼‰ï¼Œéå¿…è¦ä¸æ¨èä½¿ç”¨ï¼ˆä¼˜å…ˆç”¨ SQL æ‰¹é‡æ“ä½œæ›¿ä»£ï¼‰ã€‚ 5ã€ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿå­˜å‚¨è¿‡ç¨‹ å®šä¹‰ï¼šé¢„ç¼–è¯‘åå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ã€ŒSQL è¯­å¥é›†åˆã€ï¼Œå¯æ¥æ”¶å‚æ•°ã€åŒ…å«é€»è¾‘åˆ¤æ–­ï¼ˆifã€Œloopï¼‰ï¼Œæ”¯æŒé‡å¤è°ƒç”¨ã€‚ ä¼˜ç‚¹ æ‰§è¡Œæ•ˆç‡é«˜ï¼šé¢„ç¼–è¯‘ä¸€æ¬¡ï¼Œåç»­è°ƒç”¨æ— éœ€é‡æ–°è§£æ SQLï¼› å°è£…å¤æ‚é€»è¾‘ï¼šå°†å¤šæ­¥ SQL æ“ä½œï¼ˆå¦‚æŸ¥è¯¢ + æ›´æ–° + æ’å…¥ï¼‰å°è£…ä¸ºä¸€ä¸ªè¿‡ç¨‹ï¼Œç®€åŒ–åº”ç”¨å±‚ä»£ç ï¼› å‡å°‘ç½‘ç»œä¼ è¾“ï¼šåº”ç”¨å±‚åªéœ€ä¼ é€’è°ƒç”¨å‚æ•°ï¼ˆè€Œéå¤§é‡ SQL è¯­å¥ï¼‰ï¼Œé™ä½ç½‘ç»œå¼€é”€ï¼› å®‰å…¨æ€§é«˜ï¼šå¯é€šè¿‡æƒé™æ§åˆ¶åªå…è®¸è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œä¸ç›´æ¥æ“ä½œè¡¨ï¼Œé¿å… SQL æ³¨å…¥ï¼› ä»£ç å¤ç”¨ï¼šå¤šä¸ªåº”ç”¨ æ¨¡å—å¯å…±äº«åŒä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼Œå‡å°‘é‡å¤å¼€å‘ã€‚ 6ã€ä»€ä¹ˆæ˜¯è§¦å‘å™¨ï¼Ÿ å®šä¹‰ï¼šæ•°æ®åº“ä¸­ã€Œè‡ªåŠ¨æ‰§è¡Œçš„ç‰¹æ®Šå­˜å‚¨è¿‡ç¨‹ã€ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ï¼Œç”±ç‰¹å®šäº‹ä»¶ï¼ˆinsertã€Œupdateã€Œdeleteï¼‰è§¦å‘ã€‚ æ ¸å¿ƒè¦ç´ ï¼š è§¦å‘äº‹ä»¶ï¼šå¯¹è¡¨ è§†å›¾çš„ DML æ“ä½œï¼ˆéƒ¨åˆ†æ•°æ®åº“æ”¯æŒ DDL è§¦å‘ï¼‰ï¼› è§¦å‘æ—¶æœºï¼šbeforeï¼ˆæ“ä½œå‰æ‰§è¡Œï¼Œå¦‚æ•°æ®æ ¡éªŒï¼‰ã€afterï¼ˆæ“ä½œåæ‰§è¡Œï¼Œå¦‚æ—¥å¿—è®°å½•ï¼‰ï¼› è§¦å‘å¯¹è±¡ï¼šé€šå¸¸æ˜¯è¡¨ï¼ˆè§†å›¾è§¦å‘éœ€ç‰¹å®šæ•°æ®åº“æ”¯æŒï¼‰ã€‚ ç”¨é€”ï¼šç»´æŠ¤æ•°æ®å®Œæ•´æ€§ï¼ˆå¦‚çº§è”æ›´æ–°å…³è”è¡¨æ•°æ®ï¼‰ã€è‡ªåŠ¨è®°å½•æ—¥å¿—ï¼ˆå¦‚æ“ä½œå®¡è®¡æ—¥å¿—ï¼‰ã€æ•°æ®åŒæ­¥ï¼ˆå¦‚è·¨è¡¨æ•°æ®å¤åˆ¶ï¼‰ã€‚ 7ã€C# ä¸­çš„å§”æ‰˜æ˜¯ä»€ä¹ˆï¼Ÿäº‹ä»¶æ˜¯ä¸æ˜¯ä¸€ç§å§”æ‰˜ï¼Ÿå§”æ‰˜ï¼ˆDelegateï¼‰ å®šä¹‰ï¼šC# ä¸­ã€Œç±»å‹å®‰å…¨çš„å‡½æ•°æŒ‡é’ˆã€ï¼Œæœ¬è´¨æ˜¯ä¸€ç§å¼•ç”¨ç±»å‹ï¼Œç”¨äºå°è£…å…·æœ‰ç›¸åŒç­¾åï¼ˆå‚æ•°åˆ—è¡¨ + è¿”å›å€¼ç±»å‹ï¼‰çš„æ–¹æ³•ã€‚ æ ¸å¿ƒä½œç”¨ï¼šå®ç°æ–¹æ³•çš„ â€œé—´æ¥è°ƒç”¨â€ å’Œ â€œå›è°ƒæœºåˆ¶â€ï¼Œè§£è€¦è°ƒç”¨è€…ä¸è¢«è°ƒç”¨è€…ï¼ˆå¦‚å¤šçº¿ç¨‹ä¸­ä¼ é€’æ‰§è¡Œæ–¹æ³•ã€äº‹ä»¶é€šçŸ¥ï¼‰ã€‚ äº‹ä»¶ï¼ˆEventï¼‰ ç»“è®ºï¼šäº‹ä»¶æ˜¯ä¸€ç§ç‰¹æ®Šçš„å§”æ‰˜å®ä¾‹ï¼Œæ˜¯å§”æ‰˜çš„ â€œå®‰å…¨å°è£…ç‰ˆæœ¬â€ã€‚ æ ¸å¿ƒåŒºåˆ«ï¼š å§”æ‰˜ï¼šå¯åœ¨ç±»å¤–éƒ¨ç›´æ¥è°ƒç”¨ï¼ˆdelegateInstance()ï¼‰ã€èµ‹å€¼ï¼ˆdelegateInstance = æ–¹æ³•ï¼‰ï¼› äº‹ä»¶ï¼šä»…å…è®¸åœ¨ç±»å†…éƒ¨è§¦å‘ï¼ˆInvoke()ï¼‰ï¼Œå¤–éƒ¨åªèƒ½é€šè¿‡ += è®¢é˜…ã€-= å–æ¶ˆè®¢é˜…ï¼Œæ— æ³•ç›´æ¥è°ƒç”¨æˆ–èµ‹å€¼ï¼Œä¿è¯å°è£…æ€§å’Œå®‰å…¨æ€§ã€‚ å…³ç³»ï¼šäº‹ä»¶åŸºäºå§”æ‰˜å®ç°ï¼Œéµå¾ª â€œå‘å¸ƒ - è®¢é˜…â€ æ¨¡å¼ï¼ˆå‘å¸ƒè€…è§¦å‘äº‹ä»¶ï¼Œè®¢é˜…è€…å“åº”äº‹ä»¶ï¼‰ã€‚ 8ã€æ¦‚è¿°ä¸‰å±‚ç»“æ„ä½“ç³»ä¸‰å±‚ç»“æ„æ˜¯è½¯ä»¶æ¶æ„çš„ã€Œåˆ†å±‚è®¾è®¡æ¨¡å¼ã€ï¼Œæ ¸å¿ƒæ˜¯ã€Œè§£è€¦ã€ï¼Œå°†ç³»ç»Ÿåˆ†ä¸º 3 å±‚ï¼ˆé€šå¸¸å«å®ä½“å±‚è¾…åŠ©æ•°æ®ä¼ é€’ï¼‰ï¼š å±‚çº§ æ ¸å¿ƒèŒè´£ ç¤ºä¾‹æ“ä½œ UI å±‚ï¼ˆè¡¨ç¤ºå±‚ï¼‰ ç”¨æˆ·äº¤äº’ï¼šå±•ç¤ºæ•°æ®ã€æ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œä¸å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œä»…è°ƒç”¨ BLL å±‚ WinForm è¡¨å•ã€Web é¡µé¢ï¼ˆASP.NETï¼‰ BLL å±‚ï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰ æ ¸å¿ƒå±‚ï¼šå¤„ç†ä¸šåŠ¡è§„åˆ™ã€æ•°æ®éªŒè¯ã€é€»è¾‘åˆ¤æ–­ï¼Œåè°ƒ UI å±‚ä¸ DAL å±‚çš„æ•°æ®æµè½¬ ç™»å½•æ ¡éªŒã€è®¢å•è®¡ç®—ã€æƒé™åˆ¤æ–­ DAL å±‚ï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰ æ•°æ®äº¤äº’ï¼šä»…è´Ÿè´£ä¸æ•°æ®åº“çš„ CRUD æ“ä½œï¼ˆæŸ¥è¯¢ã€æ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘ select * from Usersã€insert into Orders Model å±‚ï¼ˆå®ä½“å±‚ï¼‰ æ•°æ®è½½ä½“ï¼šå®šä¹‰å®ä½“ç±»ï¼ˆå¦‚ Userã€ŒOrderï¼‰ï¼Œæ˜ å°„æ•°æ®åº“è¡¨æˆ–ä¸šåŠ¡å¯¹è±¡ï¼Œç”¨äºå±‚é—´æ•°æ®ä¼ é€’ public class User public int Id get; set; public string Name get; set; ä¼˜ç‚¹ï¼šä»£ç å¤ç”¨ã€æ˜“ç»´æŠ¤ï¼ˆä¿®æ”¹æŸå±‚ä¸å½±å“å…¶ä»–å±‚ï¼‰ã€ä¾¿äºæµ‹è¯•ï¼ˆå¯å•ç‹¬æµ‹è¯• BLL å±‚ï¼‰ã€‚ 9ã€ä»€ä¹ˆæ˜¯è£…ç®±å’Œæ‹†ç®±ï¼Ÿä»€ä¹ˆæ˜¯é‡è½½ï¼Ÿè£…ç®±ï¼ˆBoxingï¼‰ä¸æ‹†ç®±ï¼ˆUnboxingï¼‰ è£…ç®±ï¼šå°†ã€Œå€¼ç±»å‹ã€ï¼ˆå¦‚ intã€Œboolã€Œstructï¼‰è½¬æ¢ä¸ºã€Œå¼•ç”¨ç±»å‹ã€ï¼ˆobject æˆ–å…¶æ´¾ç”Ÿç±»ï¼‰çš„è¿‡ç¨‹ã€‚åŸç†ï¼šåœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œå¤åˆ¶å€¼ç±»å‹çš„å†…å®¹åˆ°å †ä¸­ï¼Œè¿”å›å †å†…å­˜åœ°å€ï¼ˆå¼•ç”¨ï¼‰ï¼Œæœ‰æ€§èƒ½å¼€é”€ã€‚ç¤ºä¾‹ï¼šint a = 10; object b = a;ï¼ˆa æ˜¯å€¼ç±»å‹ï¼Œb æ˜¯å¼•ç”¨ç±»å‹ï¼‰ æ‹†ç®±ï¼šå°†ã€Œå¼•ç”¨ç±»å‹ã€ï¼ˆå¿…é¡»æ˜¯è£…ç®±åçš„å€¼ç±»å‹ï¼‰è½¬æ¢ä¸ºã€Œå€¼ç±»å‹ã€çš„è¿‡ç¨‹ã€‚åŸç†ï¼šå…ˆæ ¡éªŒç±»å‹å…¼å®¹æ€§ï¼ˆå¦‚ä¸èƒ½å°†è£…ç®±çš„ int æ‹†ä¸º stringï¼‰ï¼Œå†ä»å †ä¸­å¤åˆ¶æ•°æ®åˆ°æ ˆä¸Šï¼Œæœ‰æ€§èƒ½å¼€é”€ã€‚ç¤ºä¾‹ï¼šobject b = 10; int a = (int)b; é‡è½½ï¼ˆOverloadï¼‰ å®šä¹‰ï¼šåœ¨ã€ŒåŒä¸€ä¸ªç±»ä¸­ã€ï¼Œæ–¹æ³•åç›¸åŒï¼Œä½†ã€Œå‚æ•°åˆ—è¡¨ä¸åŒã€ï¼ˆå‚æ•°ä¸ªæ•°ã€ç±»å‹ã€é¡ºåºä¸åŒï¼‰çš„æ–¹æ³•å®šä¹‰ã€‚ æ ¸å¿ƒè§„åˆ™ï¼š ä¸è¿”å›å€¼ç±»å‹ã€è®¿é—®ä¿®é¥°ç¬¦æ— å…³ï¼› ç¼–è¯‘å™¨é€šè¿‡ â€œå‚æ•°åŒ¹é…â€ ç¡®å®šè°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼› ç¤ºä¾‹ï¼špublic int Add(int a, int b) å’ŒÂ public double Add(double a, double b) æ˜¯é‡è½½ã€‚ 10ã€æ¦‚è¿°åºåˆ—åŒ– å®šä¹‰ï¼šå°†å¯¹è±¡çš„ã€ŒçŠ¶æ€ä¿¡æ¯ã€ï¼ˆå±æ€§ã€å­—æ®µå€¼ï¼‰è½¬æ¢ä¸ºã€Œå¯å­˜å‚¨ ä¼ è¾“çš„æ ¼å¼ã€ï¼ˆå¦‚äºŒè¿›åˆ¶ã€XMLã€JSONï¼‰çš„è¿‡ç¨‹ï¼›åä¹‹ï¼Œå°†è¯¥æ ¼å¼è¿˜åŸä¸ºå¯¹è±¡çš„è¿‡ç¨‹ç§°ä¸ºã€Œååºåˆ—åŒ–ã€ã€‚ æ ¸å¿ƒç”¨é€”ï¼š å¯¹è±¡æŒä¹…åŒ–ï¼šå°†å¯¹è±¡ä¿å­˜åˆ°æ–‡ä»¶ã€æ•°æ®åº“ï¼ˆå¦‚æ¸¸æˆå­˜æ¡£ã€é…ç½®å­˜å‚¨ï¼‰ï¼› ç½‘ç»œä¼ è¾“ï¼šè·¨è¿›ç¨‹ã€è·¨æœåŠ¡å™¨ä¼ é€’å¯¹è±¡ï¼ˆå¦‚æ¥å£è°ƒç”¨ä¸­ä¼ é€’ JSON æ•°æ®ï¼‰ã€‚ å¸¸è§åºåˆ—åŒ–ç±»å‹ï¼š äºŒè¿›åˆ¶åºåˆ—åŒ–ï¼šé«˜æ•ˆã€ç´§å‡‘ï¼Œä»…æ”¯æŒ.NET å¹³å°ï¼ˆéœ€æ ‡è®° [Serializable] ç‰¹æ€§ï¼‰ï¼› XML åºåˆ—åŒ–ï¼šæ˜“è¯»ã€è·¨å¹³å°ï¼Œé€‚åˆç»“æ„åŒ–æ•°æ®ï¼› JSON åºåˆ—åŒ–ï¼šè½»é‡ã€é€šç”¨ï¼Œå¹¿æ³›ç”¨äº HTTP æ¥å£ï¼ˆå¦‚ Newtonsoft.Jsonã€System.Text.Jsonï¼‰ã€‚ 11ã€UDP å’Œ TCP è¿æ¥æœ‰ä½•å¼‚åŒï¼Ÿç›¸åŒç‚¹ å‡ä¸º TCPIP åè®®æ ˆçš„ã€Œä¼ è¾“å±‚åè®®ã€ï¼Œç”¨äºå®ç°ç«¯åˆ°ç«¯çš„æ•°æ®ä¼ è¾“ã€‚ æ ¸å¿ƒå·®å¼‚ï¼ˆè¡¨æ ¼æ›´æ¸…æ™°ï¼‰ å¯¹æ¯”ç»´åº¦ TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰ UDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰ è¿æ¥æ€§ é¢å‘è¿æ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼Œå››æ¬¡æŒ¥æ‰‹æ–­å¼€ï¼‰ æ— è¿æ¥ï¼ˆç›´æ¥å‘é€æ•°æ®ï¼Œæ— éœ€å»ºç«‹ æ–­å¼€è¿æ¥ï¼‰ å¯é æ€§ å¯é ï¼ˆé‡ä¼ ä¸¢å¤±æ•°æ®åŒ…ã€æ’åºã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ï¼‰ ä¸å¯é ï¼ˆæ— é‡ä¼ æœºåˆ¶ï¼Œå¯èƒ½ä¸¢åŒ…ã€ä¹±åºã€é‡å¤ï¼‰ æ•ˆç‡ å¼€é”€å¤§ï¼ˆéœ€ç»´æŠ¤è¿æ¥çŠ¶æ€ã€æ ¡éªŒä¿¡æ¯ï¼‰ï¼Œæ•ˆç‡ä½ å¼€é”€å°ï¼ˆä»…åŒ…å«æº ç›®çš„ç«¯å£ã€æ•°æ®é•¿åº¦ã€æ ¡éªŒå’Œï¼‰ï¼Œæ•ˆç‡é«˜ æ•°æ®è¾¹ç•Œ å­—èŠ‚æµï¼ˆæ— è¾¹ç•Œï¼Œéœ€åº”ç”¨å±‚å®šä¹‰åˆ†éš”ç¬¦ï¼‰ æ•°æ®æŠ¥ï¼ˆæœ‰è¾¹ç•Œï¼Œä¸€æ¬¡å‘é€ä¸€ä¸ªå®Œæ•´æ•°æ®æŠ¥ï¼‰ é€‚ç”¨åœºæ™¯ éœ€å¯é ä¼ è¾“çš„åœºæ™¯ï¼ˆHTTPHTTPSã€FTPã€é‚®ä»¶ã€æ–‡ä»¶ä¼ è¾“ï¼‰ å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆè§†é¢‘ éŸ³é¢‘ç›´æ’­ã€DNSã€æ¸¸æˆã€ç‰©è”ç½‘ï¼‰ 12ã€åˆ†åº“ã€åˆ†è¡¨åº”ç”¨åœºæ™¯ï¼Ÿä»¥åŠå¸¦æ¥çš„é—®é¢˜ï¼Ÿä¸€ã€åº”ç”¨åœºæ™¯ï¼ˆæ ¸å¿ƒè§¦å‘æ¡ä»¶ï¼šæ•°æ®é‡ å¹¶å‘é‡è¾¾åˆ°ç“¶é¢ˆï¼‰ æ•°æ®é‡è¿‡å¤§ï¼š å•è¡¨æ•°æ®é‡è¶… 1000 ä¸‡è¡Œï¼ˆæŸ¥è¯¢å…¨è¡¨æ‰«ææ…¢ï¼Œç´¢å¼•ç»´æŠ¤æˆæœ¬é«˜ï¼‰ï¼› å•åº“å­˜å‚¨è¶… 50GBï¼ˆå¤‡ä»½ æ¢å¤è€—æ—¶ï¼Œç£ç›˜ IO å‹åŠ›å¤§ï¼‰ã€‚ å¹¶å‘é‡è¿‡é«˜ï¼šå•åº“è¿æ¥æ•°ä¸Šé™ï¼ˆå¦‚ MySQL é»˜è®¤ 151ï¼‰æ— æ³•æ»¡è¶³é«˜å¹¶å‘è¯·æ±‚ï¼ˆå¦‚ç§’æ€ã€å³°å€¼ QPS è¶… 1 ä¸‡ï¼‰ã€‚ ä¸šåŠ¡æ‹†åˆ†éœ€æ±‚ï¼šæŒ‰ä¸šåŠ¡æ¨¡å—å‚ç›´æ‹†åˆ†ï¼ˆå¦‚ç”µå•†ç³»ç»Ÿæ‹†åˆ†ä¸ºç”¨æˆ·åº“ã€è®¢å•åº“ã€å•†å“åº“ï¼‰ï¼Œé™ä½æ¨¡å—è€¦åˆã€‚ äºŒã€åˆ†åº“åˆ†è¡¨ç±»å‹ å‚ç›´åˆ†åº“ åˆ†è¡¨ï¼šæŒ‰ã€Œä¸šåŠ¡ å­—æ®µã€æ‹†åˆ†ï¼ˆå¦‚ç”¨æˆ·è¡¨æ‹†ä¸ºç”¨æˆ·åŸºæœ¬ä¿¡æ¯è¡¨ã€ç”¨æˆ·è¯¦æƒ…è¡¨ï¼‰ï¼› æ°´å¹³åˆ†åº“ åˆ†è¡¨ï¼šæŒ‰ã€Œæ•°æ®è¡Œã€æ‹†åˆ†ï¼ˆå¦‚è®¢å•è¡¨æŒ‰ç”¨æˆ· ID å“ˆå¸Œæ‹†åˆ° 10 ä¸ªåˆ†è¡¨ï¼ŒæŒ‰æ—¶é—´èŒƒå›´æ‹†åˆ°ä¸åŒå¹´ä»½çš„åˆ†è¡¨ï¼‰ã€‚ ä¸‰ã€å¸¦æ¥çš„é—®é¢˜ åˆ†å¸ƒå¼äº‹åŠ¡ï¼šè·¨åº“ è·¨è¡¨æ“ä½œéš¾ä»¥ä¿è¯ ACIDï¼ˆå¦‚è®¢å•åˆ›å»ºåŒæ—¶æ‰£å‡åº“å­˜ï¼Œæ¶‰åŠè®¢å•åº“å’Œåº“å­˜åº“ï¼‰ï¼› è·¨åº“æŸ¥è¯¢å¤æ‚ï¼šå¤šè¡¨ joinã€åˆ†é¡µï¼ˆå¦‚æŸ¥è¯¢ â€œæ‰€æœ‰ç”¨æˆ·è¿‘ 3 ä¸ªæœˆçš„è®¢å•â€ï¼‰éœ€èšåˆå¤šä¸ªåˆ†åº“ åˆ†è¡¨ç»“æœï¼› å…¨å±€ ID ç”Ÿæˆï¼šéœ€ä¿è¯åˆ†åº“ åˆ†è¡¨ä¸­ ID çš„å”¯ä¸€æ€§ï¼ˆä¸èƒ½ç”¨è‡ªå¢ä¸»é”®ï¼‰ï¼› æ•°æ®è¿ç§»ä¸æ‰©å®¹ï¼šæ–°å¢åˆ†åº“ åˆ†è¡¨æ—¶éœ€é‡æ–°åˆ†é…æ•°æ®ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡ä¸å¯ç”¨ï¼› è¿ç»´æˆæœ¬å¢åŠ ï¼šå¤šåº“å¤šè¡¨çš„ç›‘æ§ã€å¤‡ä»½ã€æ•…éšœæ’æŸ¥éš¾åº¦æå‡ï¼› ä¸€è‡´æ€§é—®é¢˜ï¼šç¼“å­˜ä¸æ•°æ®åº“ã€å„åˆ†è¡¨æ•°æ®åŒæ­¥å¯èƒ½å‡ºç°ä¸ä¸€è‡´ã€‚ 13ã€å…¬å¸ç»„ç»‡æ¶æ„æ•°æ®åº“è®¾è®¡ï¼ˆç¤ºæ„ï¼‰æ ¸å¿ƒè®¾è®¡ã€Œæ ‘å½¢éƒ¨é—¨ç»“æ„ã€å’Œã€Œå‘˜å·¥ - éƒ¨é—¨ - ä¸Šçº§ã€å…³è”ï¼Œ3 å¼ æ ¸å¿ƒè¡¨å³å¯ï¼š 1. éƒ¨é—¨è¡¨ï¼ˆDepartmentsï¼‰ å­—æ®µå ç±»å‹ è¯´æ˜ dept_id int éƒ¨é—¨ IDï¼ˆä¸»é”®ï¼Œè‡ªå¢ï¼‰ dept_name varchar(50) éƒ¨é—¨åç§°ï¼ˆå¦‚ â€œæŠ€æœ¯éƒ¨â€ï¼‰ parent_dept_id int çˆ¶éƒ¨é—¨ IDï¼ˆè‡ªå…³è”ï¼Œé¡¶çº§éƒ¨é—¨ä¸º 0ï¼‰ manager_id int éƒ¨é—¨è´Ÿè´£äºº IDï¼ˆå¤–é”®å…³è”å‘˜å·¥è¡¨ï¼‰ create_time datetime éƒ¨é—¨åˆ›å»ºæ—¶é—´ remark varchar(200) å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰ 2. å‘˜å·¥è¡¨ï¼ˆEmployeesï¼‰ å­—æ®µå ç±»å‹ è¯´æ˜ emp_id int å‘˜å·¥ IDï¼ˆä¸»é”®ï¼Œè‡ªå¢ï¼‰ emp_name varchar(20) å‘˜å·¥å§“å gender tinyint æ€§åˆ«ï¼ˆ1 ç”·ï¼Œ2 å¥³ï¼‰ position_id int èŒä½ IDï¼ˆå¤–é”®å…³è”èŒä½è¡¨ï¼‰ dept_id int æ‰€å±éƒ¨é—¨ IDï¼ˆå¤–é”®å…³è”éƒ¨é—¨è¡¨ï¼‰ superior_id int ç›´æ¥ä¸Šçº§ IDï¼ˆè‡ªå…³è”ï¼Œæ— ä¸Šçº§ä¸º 0ï¼‰ entry_time datetime å…¥èŒæ—¶é—´ phone varchar(11) æ‰‹æœºå·ï¼ˆå¯é€‰ï¼‰ status tinyint çŠ¶æ€ï¼ˆ1 åœ¨èŒï¼Œ2 ç¦»èŒï¼‰ 3. èŒä½è¡¨ï¼ˆPositionsï¼‰ å­—æ®µå ç±»å‹ è¯´æ˜ position_id int èŒä½ IDï¼ˆä¸»é”®ï¼Œè‡ªå¢ï¼‰ position_name varchar(30) èŒä½åç§°ï¼ˆå¦‚ â€œåç«¯å¼€å‘å·¥ç¨‹å¸ˆâ€â€œéƒ¨é—¨ç»ç†â€ï¼‰ remark varchar(200) èŒä½æè¿°ï¼ˆå¯é€‰ï¼‰ æ ¸å¿ƒå…³è”ï¼šéƒ¨é—¨æ ‘å½¢ç»“æ„é€šè¿‡ parent_dept_id è‡ªå…³è”ï¼›å‘˜å·¥ä¸éƒ¨é—¨é€šè¿‡ dept_id å…³è”ï¼›å‘˜å·¥æ±‡æŠ¥å…³ç³»é€šè¿‡ superior_id è‡ªå…³è”ã€‚ 14ã€ä¸¤æ•°ä¹‹å’Œï¼ˆç¼–ç¨‹é¢˜ï¼‰é¢˜ç›®åˆ†æ è¦æ±‚ï¼šåœ¨æ•°ç»„ä¸­æ‰¾åˆ°å’Œä¸ºç›®æ ‡å€¼çš„ä¸¤ä¸ªä¸åŒå…ƒç´ ï¼Œè¿”å›å…¶å€¼ï¼ˆé¢˜ç›®ç¤ºä¾‹è¾“å‡º [2,5]ï¼Œé¡ºåºä¸å½±å“ï¼‰ã€‚ æ ¸å¿ƒæ€è·¯ï¼šç”¨ã€Œå“ˆå¸Œè¡¨ã€ä¼˜åŒ–æ—¶é—´å¤æ‚åº¦ï¼ˆæš´åŠ›æšä¸¾ O (nÂ²)â†’å“ˆå¸Œè¡¨ O (n)ï¼‰ï¼Œéå†æ•°ç»„æ—¶è®°å½•å·²è®¿é—®å…ƒç´ ï¼Œå¿«é€ŸåŒ¹é…ç›®æ ‡å·®å€¼ã€‚ C# å®ç°ä»£ç csharp è¿è¡Œ using System;using System.Collections.Generic;public class Solution public int[] TwoSum(int[] nums, int target) // å“ˆå¸Œè¡¨ï¼škey=æ•°ç»„å…ƒç´ å€¼ï¼Œvalue=å…ƒç´ ç´¢å¼•ï¼ˆæ­¤å¤„ä»…éœ€åˆ¤æ–­å­˜åœ¨æ€§ï¼Œå¯ç®€åŒ–ä¸ºå­˜å‚¨å€¼ï¼‰ Dictionaryint, int visited = new Dictionaryint, int(); foreach (int num in nums) int complement = target - num; // ç›®æ ‡å·®å€¼ // è‹¥å“ˆå¸Œè¡¨ä¸­å­˜åœ¨å·®å€¼ï¼Œç›´æ¥è¿”å›ç»“æœ if (visited.ContainsKey(complement)) return new int[] complement, num ; // è‹¥ä¸å­˜åœ¨ï¼Œå°†å½“å‰å…ƒç´ åŠ å…¥å“ˆå¸Œè¡¨ï¼ˆé¿å…é‡å¤ä½¿ç”¨åŒä¸€å…ƒç´ ï¼‰ if (!visited.ContainsKey(num)) visited.Add(num, 1); // é¢˜ç›®å‡è®¾å­˜åœ¨å”¯ä¸€è§£ï¼Œæ­¤å¤„æ— éœ€å¤„ç†æ— ç»“æœæƒ…å†µ return new int[0]; // æµ‹è¯•ä»£ç public class Program public static void Main() int[] nums = 8, 2, 6, 5, 4, 1, 3 ; int target = 7; Solution solution = new Solution(); int[] result = solution.TwoSum(nums, target); Console.WriteLine($[string.Join(, , result)]); // è¾“å‡ºï¼š[2, 5] æ€è·¯è§£é‡Š éå†æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´  numï¼Œè®¡ç®—ç›®æ ‡å·®å€¼ complement = target - numï¼› æ£€æŸ¥å“ˆå¸Œè¡¨ä¸­æ˜¯å¦å­˜åœ¨ complementï¼šå­˜åœ¨åˆ™è¯´æ˜æ‰¾åˆ°ä¸¤ä¸ªæ•°ï¼ˆcomplement å’Œ numï¼‰ï¼Œè¿”å›ç»“æœï¼› è‹¥ä¸å­˜åœ¨ï¼Œå°†å½“å‰ num åŠ å…¥å“ˆå¸Œè¡¨ï¼ˆé¿å…åç»­é‡å¤åŒ¹é…è‡ªèº«ï¼‰ï¼› æ—¶é—´å¤æ‚åº¦ O (n)ï¼ˆä»…éå†ä¸€æ¬¡æ•°ç»„ï¼‰ï¼Œç©ºé—´å¤æ‚åº¦ O (n)ï¼ˆå“ˆå¸Œè¡¨å­˜å‚¨æœ€å¤š n-1 ä¸ªå…ƒç´ ï¼‰ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"è®°å½•ç±»å‹record","path":"/2025/11/26/2-ç¼–ç¨‹è¯­è¨€-CSharp-è®°å½•ç±»å‹record/","content":"C# è®°å½•ç±»å‹ï¼ˆrecordï¼‰ï¼šä¸å¯å˜æ•°æ®è½½ä½“çš„æ ¸å¿ƒè§£æï¼ˆé¢å‘ C++ ç¨‹åºå‘˜ï¼‰C# 9.0 å¼•å…¥çš„Â è®°å½•ç±»å‹ï¼ˆrecordï¼‰Â æ˜¯ä¸€ç§ä¸“é—¨ç”¨äºÂ å­˜å‚¨ä¸å¯å˜æ•°æ®Â çš„å¼•ç”¨ç±»å‹ï¼ˆé»˜è®¤ï¼‰ï¼Œæ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯ï¼šç®€åŒ– â€œä»…æ‰¿è½½æ•°æ®ã€æ— éœ€å¤æ‚è¡Œä¸ºâ€ çš„åœºæ™¯ï¼ˆå¦‚ DTOã€é…ç½®æ•°æ®ã€æŸ¥è¯¢ç»“æœï¼‰ï¼Œè‡ªåŠ¨å®ç°å€¼ç›¸ç­‰æ€§ã€å“ˆå¸Œç ã€å­—ç¬¦ä¸²æ ¼å¼åŒ–ç­‰åŸºç¡€åŠŸèƒ½ â€”â€” æ— éœ€æ‰‹åŠ¨é‡å†™Â Equalsã€GetHashCodeã€==Â ç­‰æ–¹æ³•ã€‚ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼Œrecord å¯ç±»æ¯”ä¸ºÂ â€œå¸¦è‡ªåŠ¨å®ç°çš„ä¸å¯å˜ struct + å€¼è¯­ä¹‰â€Â çš„ç»„åˆï¼Œä½†æœ¬è´¨æ˜¯å¼•ç”¨ç±»å‹ï¼ˆé»˜è®¤ï¼‰ï¼Œä¸”æ¯” C++ çš„Â structÂ æ›´ç®€æ´ï¼ˆè‡ªåŠ¨å®ç°æ•°æ®ç›¸å…³æ–¹æ³•ï¼‰ã€æ¯”Â std::tupleÂ æ›´æ˜“è¯»ï¼ˆæœ‰æ˜ç¡®æˆå‘˜åï¼‰ã€æ¯”æ‰‹åŠ¨å®ç°çš„ä¸å¯å˜ç±»æ›´é«˜æ•ˆï¼ˆç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆåº•å±‚ä»£ç ï¼‰ã€‚ ä¸€ã€æ ¸å¿ƒå®šä¹‰ï¼šrecord æ˜¯ä»€ä¹ˆï¼Ÿ1. æœ¬è´¨ï¼šä¸å¯å˜æ•°æ®è½½ä½“ æ ¸å¿ƒå®šä½ï¼šç”¨äºå­˜å‚¨ â€œåªè¯»æ•°æ®â€ï¼Œå¼ºè°ƒÂ å€¼è¯­ä¹‰ï¼ˆValue Semanticsï¼‰ï¼ˆç›¸ç­‰æ€§åŸºäºæˆå‘˜å€¼ï¼Œè€Œéå¼•ç”¨åœ°å€ï¼‰ï¼› é»˜è®¤ç‰¹æ€§ï¼š ä¸å¯å˜æ€§ï¼šæˆå‘˜é»˜è®¤æ˜¯Â init-onlyÂ å±æ€§ï¼ˆä»…å…è®¸æ„é€ æ—¶æˆ–å¯¹è±¡åˆå§‹åŒ–å™¨èµ‹å€¼ï¼Œä¹‹åä¸å¯ä¿®æ”¹ï¼‰ï¼› è‡ªåŠ¨å®ç°ï¼šç¼–è¯‘å™¨è‡ªåŠ¨ç”ŸæˆÂ Equalsã€GetHashCodeã€==ã€!=ã€ToString()Â æ–¹æ³•ï¼ˆåŸºäºæ‰€æœ‰æˆå‘˜å€¼ï¼‰ï¼› æ•°æ®å¯¼å‘ï¼šæ— é»˜è®¤è¡Œä¸ºæ–¹æ³•ï¼Œä»…èšç„¦æ•°æ®å­˜å‚¨å’Œæ•°æ®ç›¸å…³æ“ä½œï¼ˆå¦‚éç ´åæ€§ä¿®æ”¹Â withÂ è¡¨è¾¾å¼ï¼‰ã€‚ 2. ä¸ C++ ç±»ä¼¼ç±»å‹çš„ç±»æ¯” C# ç±»å‹ æ ¸å¿ƒç‰¹æ€§ C++ ç±»ä¼¼å®ç° æ ¸å¿ƒå·®å¼‚ recordï¼ˆé»˜è®¤ï¼‰ å¼•ç”¨ç±»å‹ã€ä¸å¯å˜ã€å€¼ç›¸ç­‰æ€§ structÂ +Â constÂ æˆå‘˜ + æ‰‹åŠ¨é‡è½½Â == C++Â structÂ æ˜¯å€¼ç±»å‹ï¼Œéœ€æ‰‹åŠ¨å®ç°ç›¸ç­‰æ€§ record class æ˜¾å¼å¼•ç”¨ç±»å‹ã€ä¸å¯å˜ã€å€¼ç›¸ç­‰æ€§ classÂ +Â constÂ æˆå‘˜ + æ‰‹åŠ¨é‡è½½æ–¹æ³• C++ ç±»é»˜è®¤æ˜¯å¼•ç”¨è¯­ä¹‰ï¼Œéœ€æ‰‹åŠ¨å®ç°å€¼ç›¸ç­‰ record struct å€¼ç±»å‹ã€ä¸å¯å˜ å¯å˜ã€å€¼ç›¸ç­‰æ€§ structÂ +Â constÂ æˆå‘˜ï¼ˆC++11+ï¼‰ C# è‡ªåŠ¨å®ç°æ‰€æœ‰æ•°æ®æ–¹æ³•ï¼ŒC++ éœ€æ‰‹åŠ¨å†™ std::tuple åŒ¿åæ•°æ®è½½ä½“ã€å€¼è¯­ä¹‰ std::tuplestring, intï¼ˆC++11+ï¼‰ C# record æœ‰æ˜ç¡®æˆå‘˜åï¼Œå¯è¯»æ€§æ›´é«˜ äºŒã€æ ¸å¿ƒç‰¹æ€§ï¼šrecord ä¸ºä»€ä¹ˆå¥½ç”¨ï¼Ÿ1. ä¸å¯å˜æ€§ï¼ˆé»˜è®¤ï¼‰ï¼šinit-only å±æ€§record çš„æˆå‘˜é»˜è®¤æ˜¯Â initÂ è®¿é—®å™¨ï¼ˆè€ŒéÂ setï¼‰ï¼Œå…è®¸Â æ„é€ æ—¶èµ‹å€¼Â æˆ–Â å¯¹è±¡åˆå§‹åŒ–å™¨èµ‹å€¼ï¼Œä½†èµ‹å€¼åæ— æ³•ä¿®æ”¹ â€”â€” ç¡®ä¿æ•°æ®ä¸€æ—¦åˆ›å»ºå°±ä¸å¯å˜ï¼Œé¿å…æ„å¤–ä¿®æ”¹å¯¼è‡´çš„ bugã€‚ è¯­æ³•ç¤ºä¾‹ï¼šåŸºç¡€ record å®šä¹‰csharp è¿è¡Œ // å®šä¹‰ recordï¼ˆé»˜è®¤æ˜¯ record classï¼Œå¼•ç”¨ç±»å‹ï¼‰public record Cat( string Name, // è‡ªåŠ¨ç”Ÿæˆ init-only å±æ€§ï¼ˆpublicï¼‰ int Age, // ä½ç½®å‚æ•°ï¼šæŒ‰é¡ºåºå¯¹åº”æ„é€ å‡½æ•°å‚æ•° DateTime BirthDate);// ç”¨æ³•ï¼šåˆ›å»º record å¯¹è±¡ï¼ˆä¸¤ç§æ–¹å¼ï¼‰// æ–¹å¼1ï¼šä½ç½®æ„é€ å‡½æ•°ï¼ˆæŒ‰å‚æ•°é¡ºåºèµ‹å€¼ï¼Œç®€æ´ï¼‰var cat1 = new Cat(Fritz, 3, new DateTime(2022, 1, 1));// æ–¹å¼2ï¼šå¯¹è±¡åˆå§‹åŒ–å™¨ï¼ˆæ˜¾å¼æŒ‡å®šæˆå‘˜åï¼Œçµæ´»ï¼‰var cat2 = new Cat( Name: Boots, Age: 2, BirthDate: new DateTime(2023, 5, 15));// ä»¥ä¸‹ä»£ç ç¼–è¯‘æŠ¥é”™ï¼šinit-only å±æ€§æ— æ³•ä¿®æ”¹// cat1.Name = New Name; // é”™è¯¯ï¼šCat.Name åªæœ‰ init è®¿é—®å™¨ï¼Œæ—  set C++ å¯¹æ¯”ï¼šæ‰‹åŠ¨å®ç°ä¸å¯å˜ structC# record ä¸€è¡Œä»£ç å®ç°çš„ä¸å¯å˜ç‰¹æ€§ï¼ŒC++ éœ€æ‰‹åŠ¨å®šä¹‰Â constÂ æˆå‘˜å’Œæ„é€ å‡½æ•°ï¼š cpp è¿è¡Œ // C++ æ‰‹åŠ¨å®ç°ç±»ä¼¼ record çš„ä¸å¯å˜ structstruct Cat const std::string Name; const int Age; const std::chrono::system_clock::time_point BirthDate; // å¿…é¡»æ‰‹åŠ¨å†™æ„é€ å‡½æ•°ï¼ˆæ— é»˜è®¤æ„é€ ï¼‰ Cat(std::string name, int age, std::chrono::system_clock::time_point birthDate) : Name(std::move(name)), Age(age), BirthDate(birthDate) // è¿˜éœ€æ‰‹åŠ¨é‡è½½ ==ã€!=ã€hash ç­‰æ–¹æ³•ï¼ˆå¦åˆ™æ˜¯æµ…æ‹·è´æ¯”è¾ƒï¼‰ bool operator==(const Cat other) const return Name == other.Name Age == other.Age BirthDate == other.BirthDate; ; å¯è§ C# record æå¤§ç®€åŒ–äº†ä¸å¯å˜æ•°æ®ç±»å‹çš„å®šä¹‰ã€‚ 2. è‡ªåŠ¨å®ç°å€¼ç›¸ç­‰æ€§ï¼šåŸºäºæˆå‘˜å€¼æ¯”è¾ƒclass çš„ç›¸ç­‰æ€§é»˜è®¤æ˜¯Â å¼•ç”¨ç›¸ç­‰ï¼ˆæ¯”è¾ƒå†…å­˜åœ°å€ï¼‰ï¼Œè€Œ record çš„ç›¸ç­‰æ€§æ˜¯Â å€¼ç›¸ç­‰ï¼ˆæ¯”è¾ƒæ‰€æœ‰æˆå‘˜çš„å€¼ï¼‰â€”â€” ç¼–è¯‘å™¨è‡ªåŠ¨é‡å†™Â Equals(object)ã€Equals(TSelf)ã€GetHashCode()Â ä»¥åŠÂ ==Â å’ŒÂ !=Â è¿ç®—ç¬¦ã€‚ ç¤ºä¾‹ï¼šrecord çš„å€¼ç›¸ç­‰æ€§csharp è¿è¡Œ var cat1 = new Cat(Fritz, 3, new DateTime(2022, 1, 1));var cat2 = new Cat(Fritz, 3, new DateTime(2022, 1, 1));var cat3 = new Cat(Boots, 2, new DateTime(2023, 5, 15));// 1. == è¿ç®—ç¬¦ï¼šæ¯”è¾ƒæˆå‘˜å€¼ï¼ˆè€Œéå¼•ç”¨ï¼‰Console.WriteLine(cat1 == cat2); // è¾“å‡º trueï¼ˆå€¼ç›¸ç­‰ï¼‰Console.WriteLine(cat1 == cat3); // è¾“å‡º falseï¼ˆå€¼ä¸åŒï¼‰// 2. å¼•ç”¨æ¯”è¾ƒï¼šéœ€ç”¨ ReferenceEqualsConsole.WriteLine(ReferenceEquals(cat1, cat2)); // è¾“å‡º falseï¼ˆä¸åŒå¯¹è±¡ï¼Œå¼•ç”¨ä¸åŒï¼‰// 3. GetHashCodeï¼šç›¸åŒå€¼çš„ record å“ˆå¸Œç ç›¸åŒConsole.WriteLine(cat1.GetHashCode() == cat2.GetHashCode()); // è¾“å‡º true C++ å¯¹æ¯”ï¼šæ‰‹åŠ¨é‡è½½ è¿ç®—ç¬¦C++ çš„Â structclassÂ é»˜è®¤ä¸æ”¯æŒå€¼ç›¸ç­‰æ¯”è¾ƒï¼Œéœ€æ‰‹åŠ¨é‡è½½Â ==Â å’ŒÂ !=ï¼Œä¸”éœ€ç¡®ä¿æ‰€æœ‰æˆå‘˜éƒ½å‚ä¸æ¯”è¾ƒï¼ˆå®¹æ˜“é—æ¼ï¼‰ï¼š cpp è¿è¡Œ // C++ éœ€æ‰‹åŠ¨å®ç° ==ï¼Œå¦åˆ™æ¯”è¾ƒçš„æ˜¯å†…å­˜åœ°å€ï¼ˆå€¼ç±»å‹ struct é™¤å¤–ï¼‰bool operator==(const Cat lhs, const Cat rhs) return lhs.Name == rhs.Name lhs.Age == rhs.Age lhs.BirthDate == rhs.BirthDate;bool operator!=(const Cat lhs, const Cat rhs) return !(lhs == rhs); è€Œ C# record è‡ªåŠ¨å®Œæˆè¿™ä¸€åˆ‡ï¼Œä¸”ä¸ä¼šé—æ¼æˆå‘˜ã€‚ 3. è‡ªåŠ¨ç”Ÿæˆ ToString ()ï¼šæ¸…æ™°çš„å­—ç¬¦ä¸²è¡¨ç¤ºrecord è‡ªåŠ¨é‡å†™Â ToString()Â æ–¹æ³•ï¼Œè¾“å‡ºæ‰€æœ‰æˆå‘˜çš„åç§°å’Œå€¼ï¼ˆæ ¼å¼ï¼šç±»å‹å æˆå‘˜1 = å€¼1, æˆå‘˜2 = å€¼2, ... ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨å®ç°è°ƒè¯•å‹å¥½çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–ã€‚ ç¤ºä¾‹ï¼šToString () è‡ªåŠ¨æ ¼å¼åŒ–csharp è¿è¡Œ var cat = new Cat(Fritz, 3, new DateTime(2022, 1, 1));Console.WriteLine(cat.ToString());// è¾“å‡ºï¼šCat Name = Fritz, Age = 3, BirthDate = 2022/1/1 0:00:00 C++ å¯¹æ¯”ï¼šæ‰‹åŠ¨å®ç° operatorC++ éœ€æ‰‹åŠ¨é‡è½½Â operatorÂ æ‰èƒ½å®ç°ç±»ä¼¼æ•ˆæœï¼š cpp è¿è¡Œ #include iostreamstd::ostream operator(std::ostream os, const Cat cat) os Cat Name = cat.Name , Age = cat.Age , BirthDate = ... ; // è¿˜éœ€å¤„ç†æ—¶é—´æ ¼å¼åŒ– return os;// ä½¿ç”¨Cat cat(Fritz, 3, std::chrono::system_clock::now());std::cout cat std::endl; C# record æ— éœ€ä»»ä½•é¢å¤–ä»£ç ï¼Œç›´æ¥è·å¾—è°ƒè¯•å‹å¥½çš„å­—ç¬¦ä¸²è¾“å‡ºã€‚ 4. éç ´åæ€§ä¿®æ”¹ï¼šwith è¡¨è¾¾å¼ï¼ˆæ ¸å¿ƒç‰¹æ€§ï¼‰ä¸å¯å˜å¯¹è±¡çš„ç—›ç‚¹æ˜¯ â€œä¿®æ”¹éƒ¨åˆ†æˆå‘˜éœ€åˆ›å»ºæ–°å¯¹è±¡â€ï¼Œrecord æä¾›Â withÂ è¡¨è¾¾å¼ï¼Œå¯Â åŸºäºåŸæœ‰å¯¹è±¡åˆ›å»ºæ–°å¯¹è±¡ï¼Œä»…ä¿®æ”¹æŒ‡å®šæˆå‘˜ï¼ˆå…¶ä½™æˆå‘˜å¤åˆ¶åŸæœ‰å€¼ï¼‰ï¼Œè¯­æ³•ç®€æ´ä¸”ä¿æŒä¸å¯å˜æ€§ã€‚ ç¤ºä¾‹ï¼šwith è¡¨è¾¾å¼ä¿®æ”¹ recordcsharp è¿è¡Œ var cat1 = new Cat(Fritz, 3, new DateTime(2022, 1, 1));// with è¡¨è¾¾å¼ï¼šåˆ›å»ºæ–°å¯¹è±¡ï¼Œä¿®æ”¹ Name å’Œ Ageï¼Œä¿ç•™ BirthDatevar cat2 = cat1 with Name = Fritz Jr., Age = 4 ;Console.WriteLine(cat1.ToString()); // è¾“å‡ºåŸå¯¹è±¡ï¼šCat Name = Fritz, Age = 3, ... Console.WriteLine(cat2.ToString()); // è¾“å‡ºæ–°å¯¹è±¡ï¼šCat Name = Fritz Jr., Age = 4, ... Console.WriteLine(cat1 == cat2); // è¾“å‡º falseï¼ˆå€¼ä¸åŒï¼‰ C++ å¯¹æ¯”ï¼šæ‰‹åŠ¨å¤åˆ¶æ„é€  + ä¿®æ”¹C++ æ— Â withÂ è¡¨è¾¾å¼ï¼Œéœ€é€šè¿‡å¤åˆ¶æ„é€ å‡½æ•°åˆ›å»ºæ–°å¯¹è±¡ï¼Œå†æ‰‹åŠ¨ä¿®æ”¹æˆå‘˜ï¼ˆä½†å› ä¸å¯å˜ï¼Œéœ€é‡æ–°æ„é€ ï¼‰ï¼š cpp è¿è¡Œ // C++ ä¸å¯å˜ struct éœ€é‡æ–°æ„é€ æ–°å¯¹è±¡Cat cat1(Fritz, 3, std::chrono::system_clock::from_time_t(...));// å¤åˆ¶åŸæœ‰æˆå‘˜ï¼Œä¿®æ”¹æŒ‡å®šå­—æ®µï¼ˆéœ€æ‰‹åŠ¨ä¼ é€’æ‰€æœ‰æœªä¿®æ”¹æˆå‘˜ï¼‰Cat cat2( Fritz Jr., // æ–° Name 4, // æ–° Age cat1.BirthDate // ä¿ç•™åŸæœ‰ BirthDate); å½“ record æˆå‘˜è¾ƒå¤šæ—¶ï¼ŒC# çš„Â withÂ è¡¨è¾¾å¼ä¼˜åŠ¿æå…¶æ˜æ˜¾ï¼ˆæ— éœ€ä¼ é€’æœªä¿®æ”¹æˆå‘˜ï¼‰ã€‚ ä¸‰ã€record çš„ä¸‰ç§ç±»å‹ï¼ˆC# 10+ æ”¯æŒï¼‰C# 10.0 æ‰©å±•äº† record ç±»å‹ï¼Œæ”¯æŒä¸‰ç§å˜ä½“ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒåœºæ™¯ï¼ˆå€¼ç±»å‹ å¼•ç”¨ç±»å‹ã€ä¸å¯å˜ å¯å˜ï¼‰ï¼š ç±»å‹ æœ¬è´¨ç±»å‹ ä¸å¯å˜æ€§ ç›¸ç­‰æ€§è¯­ä¹‰ é€‚ç”¨åœºæ™¯ C++ ç±»æ¯” recordï¼ˆé»˜è®¤ï¼‰ å¼•ç”¨ç±»å‹ ä¸å¯å˜ï¼ˆinitï¼‰ å€¼ç›¸ç­‰ å¤æ‚æ•°æ®è½½ä½“ï¼ˆå¦‚ DTOã€é…ç½®ï¼‰ classÂ +Â constÂ æˆå‘˜ + æ‰‹åŠ¨é‡è½½ record class å¼•ç”¨ç±»å‹ ä¸å¯å˜ï¼ˆinitï¼‰ å€¼ç›¸ç­‰ æ˜¾å¼å£°æ˜å¼•ç”¨ç±»å‹ recordï¼ˆä¸ record struct åŒºåˆ†ï¼‰ åŒ recordï¼ˆé»˜è®¤ï¼‰ record struct å€¼ç±»å‹ å¯é€‰ï¼ˆinitsetï¼‰ å€¼ç›¸ç­‰ è½»é‡çº§æ•°æ®è½½ä½“ï¼ˆå¦‚åæ ‡ã€ç‚¹ã€çŸ­æœŸæ•°æ®ï¼‰ structÂ +Â constÂ æˆå‘˜ï¼ˆä¸å¯å˜ï¼‰æˆ–æ™®é€šÂ structï¼ˆå¯å˜ï¼‰ 1. record structï¼ˆå€¼ç±»å‹ recordï¼‰ æœ¬è´¨æ˜¯å€¼ç±»å‹ï¼ˆå­˜å‚¨åœ¨æ ˆä¸Šï¼Œå¤åˆ¶æ—¶æ·±æ‹·è´æˆå‘˜ï¼‰ï¼› æ”¯æŒä¸å¯å˜ï¼ˆinitï¼‰æˆ–å¯å˜ï¼ˆsetï¼‰ï¼Œé»˜è®¤ä¸å¯å˜ï¼› è‡ªåŠ¨å®ç°å€¼ç›¸ç­‰æ€§ã€ToString()ã€GetHashCode()ã€‚ ç¤ºä¾‹ï¼šrecord struct å®šä¹‰ä¸ä½¿ç”¨csharp è¿è¡Œ // å®šä¹‰å€¼ç±»å‹ recordï¼ˆrecord structï¼‰public record struct Point(int X, int Y); // ä¸å¯å˜ï¼ˆinit-onlyï¼‰// å¯å˜ record structï¼ˆæ˜¾å¼ç”¨ setï¼‰public record struct MutablePoint(int X, int Y) // æ˜¾å¼å®šä¹‰ set è®¿é—®å™¨ï¼Œæ”¯æŒä¿®æ”¹ public int X get; set; = X; public int Y get; set; = Y;// ç”¨æ³•var p1 = new Point(10, 20);var p2 = new Point(10, 20);Console.WriteLine(p1 == p2); // è¾“å‡º trueï¼ˆå€¼ç›¸ç­‰ï¼‰var mp = new MutablePoint(5, 5);mp.X = 10; // å…è®¸ä¿®æ”¹ï¼ˆå›  X æœ‰ set è®¿é—®å™¨ï¼‰Console.WriteLine(mp); // è¾“å‡ºï¼šMutablePoint X = 10, Y = 5 2. å…³é”®åŒºåˆ«ï¼šrecord vs class vs struct ç‰¹æ€§ recordï¼ˆé»˜è®¤ï¼‰ class struct record struct ç±»å‹è¯­ä¹‰ å¼•ç”¨ç±»å‹ å¼•ç”¨ç±»å‹ å€¼ç±»å‹ å€¼ç±»å‹ é»˜è®¤ä¸å¯å˜æ€§ æ˜¯ï¼ˆinitï¼‰ å¦ï¼ˆsetï¼‰ å¦ï¼ˆsetï¼‰ æ˜¯ï¼ˆinitï¼‰ ç›¸ç­‰æ€§è¯­ä¹‰ å€¼ç›¸ç­‰ å¼•ç”¨ç›¸ç­‰ å€¼ç›¸ç­‰ å€¼ç›¸ç­‰ è‡ªåŠ¨å®ç°æ–¹æ³• æ˜¯ï¼ˆ!ToString ç­‰ï¼‰ å¦ï¼ˆéœ€æ‰‹åŠ¨é‡å†™ï¼‰ å¦ï¼ˆéœ€æ‰‹åŠ¨é‡å†™ï¼‰ æ˜¯ é€‚ç”¨åœºæ™¯ å¤æ‚ä¸å¯å˜æ•°æ® æœ‰çŠ¶æ€ã€æœ‰è¡Œä¸º è½»é‡çº§å¯å˜æ•°æ® è½»é‡çº§ä¸å¯å˜æ•°æ® å››ã€å®é™…åº”ç”¨åœºæ™¯ï¼ˆrecord è¯¥æ€ä¹ˆç”¨ï¼Ÿï¼‰1. æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆDTOï¼‰ï¼šæœ€æ ¸å¿ƒåœºæ™¯DTO ç”¨äºè·¨å±‚ è·¨æœåŠ¡ä¼ è¾“æ•°æ®ï¼ˆå¦‚ API æ¥å£è¯·æ±‚ å“åº”ã€æ•°æ®åº“æŸ¥è¯¢ç»“æœï¼‰ï¼Œé€šå¸¸ä»…éœ€å­˜å‚¨æ•°æ®ï¼Œæ— éœ€å¤æ‚è¡Œä¸º â€”â€”record å®Œç¾é€‚é…ï¼Œæ— éœ€æ‰‹åŠ¨å®ç°ç›¸ç­‰æ€§å’Œåºåˆ—åŒ–æ”¯æŒã€‚ ç¤ºä¾‹ï¼šAPI å“åº” DTOcsharp è¿è¡Œ // æ¥å£å“åº” DTOï¼ˆä¸å¯å˜ï¼Œè‡ªåŠ¨æ”¯æŒå€¼ç›¸ç­‰å’Œåºåˆ—åŒ–ï¼‰public record CatResponseDto( string Id, string Name, int Age, string Breed, DateTime CreatedAt);// æ§åˆ¶å™¨è¿”å› DTO[ApiController][Route(api/cats)]public class CatController : ControllerBase [HttpGet(id)] public async TaskActionResultCatResponseDto GetCat(string id) // ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ® var cat = await _catRepository.GetByIdAsync(id); // è½¬æ¢ä¸º DTOï¼ˆä¸å¯å˜ï¼Œé¿å…åç»­ä¿®æ”¹ï¼‰ return new CatResponseDto( cat.Id, cat.Name, cat.Age, cat.Breed, cat.CreatedAt ); 2. é…ç½®æ•°æ®ï¼šä¸å¯å˜é…ç½®åº”ç”¨é…ç½®ï¼ˆå¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€ç¬¬ä¸‰æ–¹ API å¯†é’¥ï¼‰é€šå¸¸æ˜¯åªè¯»çš„ï¼Œç”¨ record å­˜å‚¨å¯é¿å…ç¨‹åºè¿è¡Œæ—¶è¢«æ„å¤–ä¿®æ”¹ã€‚ csharp è¿è¡Œ // é…ç½® recordï¼ˆä¸å¯å˜ï¼‰public record AppConfig( string ConnectionString, string ApiKey, int TimeoutMs);// åŠ è½½é…ç½®var config = new AppConfig( ConnectionString: Server=.;Database=Test;..., ApiKey: sk-123456, TimeoutMs: 5000);// æ— æ³•ä¿®æ”¹é…ç½®ï¼ˆinit-onlyï¼‰// config.ApiKey = sk-654321; // ç¼–è¯‘æŠ¥é”™ 3. LINQ æŸ¥è¯¢ç»“æœï¼šä¸´æ—¶æ•°æ®è½½ä½“LINQ æŸ¥è¯¢è¿”å›çš„ä¸´æ—¶æ•°æ®ï¼ˆå¦‚æŠ•å½±ç»“æœï¼‰ï¼Œç”¨ record å¯ç›´æ¥æ¥æ”¶ï¼Œæ— éœ€å®šä¹‰é¢å¤–çš„ç±» structã€‚ csharp è¿è¡Œ // ä» Cat åˆ—è¡¨æŸ¥è¯¢â€œåç§°+å¹´é¾„â€æŠ•å½±var catInfos = cats .Where(c = c.Age 2) .Select(c = new record(string Name, int Age)(c.Name, c.Age)) // åŒ¿å recordï¼ˆC# 10+ æ”¯æŒï¼‰ .ToList();// æˆ–æå‰å®šä¹‰å‘½å recordpublic record CatInfo(string Name, int Age);var catInfos = cats.Select(c = new CatInfo(c.Name, c.Age)).ToList(); 4. è½»é‡çº§å€¼ç±»å‹æ•°æ®ï¼šrecord structå¦‚åæ ‡ã€å°ºå¯¸ã€æ—¶é—´åŒºé—´ç­‰è½»é‡çº§æ•°æ®ï¼Œç”¨ record struct å­˜å‚¨ï¼ˆå€¼ç±»å‹ï¼Œæ€§èƒ½æ›´é«˜ï¼‰ã€‚ csharp è¿è¡Œ // æ—¶é—´åŒºé—´ï¼ˆå€¼ç±»å‹ recordï¼‰public record struct TimeRange(DateTime StartTime, DateTime EndTime) // å¯æ·»åŠ è®¡ç®—å±æ€§ï¼ˆrecord æ”¯æŒè‡ªå®šä¹‰æˆå‘˜ï¼‰ public TimeSpan Duration = EndTime - StartTime;// ç”¨æ³•var range = new TimeRange( StartTime: new DateTime(2025, 1, 1), EndTime: new DateTime(2025, 1, 2));Console.WriteLine(range.Duration.TotalHours); // è¾“å‡º 24 äº”ã€å¸¸è§è¯¯åŒºä¸é¿å‘æŒ‡å—1. è¯¯åŒº 1ï¼šrecord æ˜¯ struct çš„ â€œå‡çº§ç‰ˆâ€ é”™è¯¯è®¤çŸ¥ï¼šrecord å’Œ struct åŠŸèƒ½é‡å ï¼Œrecord å¯æ›¿ä»£ structï¼› æ­£ç¡®é€»è¾‘ï¼š record é»˜è®¤æ˜¯å¼•ç”¨ç±»å‹ï¼ˆå­˜å‚¨åœ¨å †ä¸Šï¼‰ï¼Œstruct æ˜¯å€¼ç±»å‹ï¼ˆæ ˆä¸Šï¼‰ï¼› record å¼ºè°ƒä¸å¯å˜æ€§å’Œå€¼ç›¸ç­‰æ€§ï¼Œstruct é»˜è®¤å¯å˜ï¼› è½»é‡çº§æ•°æ®ï¼ˆå¦‚Â Pointï¼‰ç”¨ record struct æˆ– structï¼Œå¤æ‚æ•°æ®ï¼ˆå¦‚Â Catï¼‰ç”¨ recordã€‚ 2. è¯¯åŒº 2ï¼šrecord å®Œå…¨ä¸å¯å˜ é”™è¯¯è®¤çŸ¥ï¼šrecord æ‰€æœ‰æˆå‘˜éƒ½ä¸èƒ½ä¿®æ”¹ï¼› æ­£ç¡®é€»è¾‘ï¼š é»˜è®¤ä¸å¯å˜ï¼ˆæˆå‘˜æ˜¯Â init-onlyï¼‰ï¼Œä½†å¯æ˜¾å¼å®šä¹‰Â setÂ è®¿é—®å™¨å®ç°å¯å˜ï¼› è‹¥ record åŒ…å«å¼•ç”¨ç±»å‹æˆå‘˜ï¼ˆå¦‚Â Liststringï¼‰ï¼Œrecord ä»…ä¿è¯ â€œæˆå‘˜å¼•ç”¨ä¸å¯å˜â€ï¼Œä½†å¼•ç”¨å¯¹è±¡å†…éƒ¨å¯ä¿®æ”¹ï¼š csharp è¿è¡Œ public record Cat(string Name, Liststring Hobbies);var cat = new Cat(Fritz, new Liststring Sleep, Eat );// cat.Hobbies = new Liststring(); // ç¼–è¯‘æŠ¥é”™ï¼ˆHobbies æ˜¯ init-onlyï¼‰cat.Hobbies.Add(Play); // å…è®¸ï¼Hobbies æ˜¯ Listï¼Œå†…éƒ¨å¯ä¿®æ”¹Console.WriteLine(string.Join(, , cat.Hobbies)); // è¾“å‡ºï¼šSleep, Eat, Play è§£å†³æ–¹æ¡ˆï¼šè‹¥éœ€å®Œå…¨ä¸å¯å˜ï¼Œå¼•ç”¨ç±»å‹æˆå‘˜åº”è¿”å›åªè¯»åŒ…è£…ï¼ˆå¦‚Â IReadOnlyListstringï¼‰ã€‚ 3. è¯¯åŒº 3ï¼šrecord ä¸èƒ½æœ‰è‡ªå®šä¹‰æˆå‘˜ é”™è¯¯è®¤çŸ¥ï¼šrecord åªèƒ½å®šä¹‰è‡ªåŠ¨å±æ€§ï¼Œä¸èƒ½æ·»åŠ æ–¹æ³• è®¡ç®—å±æ€§ï¼› æ­£ç¡®é€»è¾‘ï¼šrecord æ”¯æŒæ·»åŠ è‡ªå®šä¹‰æ–¹æ³•ã€è®¡ç®—å±æ€§ã€æ„é€ å‡½æ•°ç­‰ï¼Œä»…è‡ªåŠ¨å®ç°æ•°æ®ç›¸å…³æ–¹æ³•ã€‚ csharp è¿è¡Œ public record Cat(string Name, int Age) // è®¡ç®—å±æ€§ public string LifeStage = Age 2 ? Kitten : Adult; // è‡ªå®šä¹‰æ–¹æ³• public string Greet() = $Hello, Im Name, a LifeStage!;// ç”¨æ³•var cat = new Cat(Fritz, 3);Console.WriteLine(cat.LifeStage); // è¾“å‡ºï¼šAdultConsole.WriteLine(cat.Greet()); // è¾“å‡ºï¼šHello, Im Fritz, a Adult! 4. è¯¯åŒº 4ï¼šwith è¡¨è¾¾å¼æ˜¯ â€œä¿®æ”¹åŸæœ‰å¯¹è±¡â€ é”™è¯¯è®¤çŸ¥ï¼šwithÂ è¡¨è¾¾å¼ä¼šä¿®æ”¹åŸæœ‰ record å¯¹è±¡ï¼› æ­£ç¡®é€»è¾‘ï¼šwithÂ è¡¨è¾¾å¼æ˜¯Â éç ´åæ€§ä¿®æ”¹ï¼Œä¼šåˆ›å»ºæ–°å¯¹è±¡ï¼ŒåŸæœ‰å¯¹è±¡ä¿æŒä¸å˜ï¼ˆç¬¦åˆä¸å¯å˜æ€§è®¾è®¡ï¼‰ã€‚ 5. è¯¯åŒº 5ï¼šrecord struct ä¸€å®šæ¯” record æ€§èƒ½å¥½ äº‹å®ï¼šrecord struct æ˜¯å€¼ç±»å‹ï¼Œé€‚åˆ â€œå°æ•°æ®ã€çŸ­æœŸä½¿ç”¨ã€é¢‘ç¹å¤åˆ¶â€ åœºæ™¯ï¼› è‹¥æ•°æ®é‡å¤§ï¼ˆå¦‚é•¿å­—ç¬¦ä¸²ã€å¤æ‚å¼•ç”¨ç±»å‹æˆå‘˜ï¼‰ï¼Œrecord struct çš„å¤åˆ¶æˆæœ¬ï¼ˆæ·±æ‹·è´ï¼‰ä¼šé«˜äº recordï¼ˆå¼•ç”¨å¤åˆ¶ï¼‰ï¼Œæ­¤æ—¶åº”é€‰ recordã€‚ å…­ã€ä¸ C++ æ ¸å¿ƒå·®å¼‚æ€»ç»“ ç‰¹æ€§ C# record C++ ç±»ä¼¼å®ç° æ ¸å¿ƒä¼˜åŠ¿ï¼ˆC#ï¼‰ ä¸å¯å˜æ€§å®ç° å…³é”®å­—Â initÂ è‡ªåŠ¨æ”¯æŒ constÂ æˆå‘˜ + æ‰‹åŠ¨æ„é€ å‡½æ•° è¯­æ³•ç®€æ´ï¼Œæ— éœ€æ‰‹åŠ¨é™åˆ¶ä¿®æ”¹ å€¼ç›¸ç­‰æ€§ ç¼–è¯‘å™¨è‡ªåŠ¨ç”ŸæˆÂ ==!= æ‰‹åŠ¨é‡è½½Â operator==operator!= æ— é—æ¼æˆå‘˜ï¼Œå‡å°‘å‡ºé”™æ¦‚ç‡ å­—ç¬¦ä¸²æ ¼å¼åŒ– è‡ªåŠ¨é‡å†™Â ToString() æ‰‹åŠ¨é‡è½½Â operator è°ƒè¯•å‹å¥½ï¼Œæ— éœ€ç¼–å†™æ ¼å¼åŒ–ä»£ç  éç ´åæ€§ä¿®æ”¹ withÂ è¡¨è¾¾å¼ä¸€é”®å®ç° å¤åˆ¶æ„é€  + æ‰‹åŠ¨ä¿®æ”¹æˆå‘˜ ä»£ç ç®€æ´ï¼Œæ— éœ€ä¼ é€’æ‰€æœ‰æœªä¿®æ”¹æˆå‘˜ å¼•ç”¨ å€¼ç±»å‹çµæ´»åˆ‡æ¢ recordï¼ˆå¼•ç”¨ï¼‰record structï¼ˆå€¼ï¼‰ classï¼ˆå¼•ç”¨ï¼‰structï¼ˆå€¼ï¼‰ ç»Ÿä¸€è¯­æ³•ï¼Œæ•°æ®æ–¹æ³•è‡ªåŠ¨å®ç° æ€»ç»“å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼Œç†è§£ record çš„æ ¸å¿ƒæ˜¯ï¼š record æ˜¯Â â€œæ•°æ®ä¼˜å…ˆâ€ çš„ç±»å‹ï¼Œä¸“ä¸ºå­˜å‚¨ä¸å¯å˜æ•°æ®è®¾è®¡ï¼Œè‡ªåŠ¨å®ç°å€¼ç›¸ç­‰æ€§ã€å­—ç¬¦ä¸²æ ¼å¼åŒ–ç­‰åŸºç¡€åŠŸèƒ½ï¼Œé¿å…é‡å¤ä»£ç ï¼› æ ¸å¿ƒä»·å€¼æ˜¯Â ç®€æ´æ€§å’Œå®‰å…¨æ€§ï¼šä¸€è¡Œä»£ç å®šä¹‰ä¸å¯å˜æ•°æ®ç±»å‹ï¼Œæ— éœ€æ‰‹åŠ¨é‡å†™Â Equalsã€ToString()Â ç­‰æ–¹æ³•ï¼Œä¸”ä¸å¯å˜æ€§é¿å…æ„å¤–ä¿®æ”¹ï¼› ä¸‰ç§å˜ä½“é€‚é…ä¸åŒåœºæ™¯ï¼š å¤æ‚ä¸å¯å˜æ•°æ®ï¼ˆDTOã€é…ç½®ï¼‰ï¼šç”¨ recordï¼ˆé»˜è®¤ï¼Œå¼•ç”¨ç±»å‹ï¼‰ï¼› è½»é‡çº§ä¸å¯å˜æ•°æ®ï¼ˆåæ ‡ã€æ—¶é—´åŒºé—´ï¼‰ï¼šç”¨ record structï¼ˆå€¼ç±»å‹ï¼‰ï¼› æœ‰çŠ¶æ€ã€æœ‰å¤æ‚è¡Œä¸ºï¼šä»ç”¨ classï¼› ä¸ C++ å¯¹æ¯”ï¼šrecord ç›¸å½“äº â€œC++ structclass + è‡ªåŠ¨å®ç°çš„ç›¸ç­‰æ€§ æ ¼å¼åŒ– ä¸å¯å˜æ€§â€ï¼Œå¼€å‘æ•ˆç‡æé«˜ï¼Œæ— éœ€å…³æ³¨åº•å±‚ç»†èŠ‚ã€‚ record æ˜¯ C# å¯¹ â€œæ•°æ®è½½ä½“ç±»å‹â€ çš„ä¼˜åŒ–ï¼Œè§£å†³äº† C++ ä¸­ â€œæ‰‹åŠ¨å®ç°ä¸å¯å˜æ•°æ®ç±»å‹ç¹çã€æ˜“å‡ºé”™â€ çš„ç—›ç‚¹ï¼Œè®©å¼€å‘è€…èšç„¦æ•°æ®æœ¬èº«è€Œéåº•å±‚æ–¹æ³•å®ç° â€”â€” è¿™ä¹Ÿæ˜¯ C# æ¯” C++ æ›´é€‚åˆå¿«é€Ÿå¼€å‘æ•°æ®å¯†é›†å‹åº”ç”¨çš„åŸå› ä¹‹ä¸€ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"å¹¶å‘é›†åˆ","path":"/2025/11/26/2-ç¼–ç¨‹è¯­è¨€-CSharp-å¹¶å‘é›†åˆ/","content":"C# å¹¶å‘é›†åˆï¼šçº¿ç¨‹å®‰å…¨çš„é«˜æ•ˆæ•°æ®å®¹å™¨ï¼ˆé¢å‘ C++ ç¨‹åºå‘˜ï¼‰C# çš„Â å¹¶å‘é›†åˆï¼ˆConcurrent Collectionsï¼‰Â æ˜¯Â System.Collections.ConcurrentÂ å‘½åç©ºé—´ä¸‹çš„çº¿ç¨‹å®‰å…¨æ•°æ®ç»“æ„ï¼Œæ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯ï¼šç®€åŒ–å¤šçº¿ç¨‹åœºæ™¯ä¸‹çš„å…±äº«æ•°æ®è®¿é—®ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™é”é€»è¾‘ï¼ˆå¦‚Â lockã€Monitorï¼‰ï¼ŒåŒæ—¶é€šè¿‡ç»†ç²’åº¦é”ã€æ— é”ç®—æ³•ç­‰ä¼˜åŒ–ï¼Œå¹³è¡¡çº¿ç¨‹å®‰å…¨å’Œæ€§èƒ½ â€”â€” å®Œç¾è§£å†³äº† C++ ä¸­ â€œå®¹å™¨ + æ‰‹åŠ¨é”â€ æ¨¡å¼çš„ç¹çã€æ˜“é”™é—®é¢˜ã€‚ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼ŒC# å¹¶å‘é›†åˆå¯ç±»æ¯”ä¸ºÂ â€œC++ å®¹å™¨ + std::mutexstd::shared_mutex + åŸå­æ“ä½œâ€ çš„å°è£…ç‰ˆï¼Œä½†æ›´ç®€æ´ï¼ˆæ— éœ€æ‰‹åŠ¨ç®¡ç†é”ç”Ÿå‘½å‘¨æœŸï¼‰ã€æ›´é«˜æ•ˆï¼ˆå†…ç½®ä¼˜åŒ–çš„åŒæ­¥æœºåˆ¶ï¼‰ã€æ›´å®‰å…¨ï¼ˆé¿å…æ­»é”ã€æ•°æ®ç«äº‰ç­‰ä½çº§é”™è¯¯ï¼‰ã€‚C++ éœ€æ‰‹åŠ¨ç»„åˆå®¹å™¨ä¸åŒæ­¥åŸè¯­ï¼Œè€Œ C# ç›´æ¥æä¾› â€œå¼€ç®±å³ç”¨â€ çš„çº¿ç¨‹å®‰å…¨é›†åˆã€‚ ä¸€ã€æ ¸å¿ƒå‰æï¼šä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘é›†åˆï¼Ÿå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œæ™®é€šé›†åˆï¼ˆå¦‚Â ListTã€DictionaryTKey, TValueï¼‰ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ â€”â€” å¤šçº¿ç¨‹åŒæ—¶è¯»å†™ä¼šå¯¼è‡´Â æ•°æ®ç«äº‰ï¼ˆData Raceï¼‰ï¼Œè¡¨ç°ä¸ºæ•°æ®é”™ä¹±ã€ç´¢å¼•è¶Šç•Œã€ç¨‹åºå´©æºƒç­‰æœªå®šä¹‰è¡Œä¸ºã€‚ 1. æ™®é€šé›†åˆçš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ˆåä¾‹ï¼‰csharp è¿è¡Œ // æ™®é€š ListT å¤šçº¿ç¨‹å†™å…¥ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰var list = new Listint();// 10ä¸ªçº¿ç¨‹åŒæ—¶æ·»åŠ å…ƒç´ Parallel.For(0, 1000, i = list.Add(i));Console.WriteLine(list.Count); // è¾“å‡ºå¯èƒ½å°äº1000ï¼ˆæ•°æ®ä¸¢å¤±ï¼‰ï¼Œç”šè‡³ç¨‹åºå´©æºƒ 2. C++ ä¸­çš„ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆï¼ˆç¹çä¸”æ˜“é”™ï¼‰C++ æ— å†…ç½®å¹¶å‘é›†åˆï¼Œéœ€æ‰‹åŠ¨ç»„åˆ â€œå®¹å™¨ + é”â€ å®ç°çº¿ç¨‹å®‰å…¨ï¼Œä»£ç å†—ä½™ä¸”æ˜“å‡ºé”™ï¼ˆå¦‚å¿˜è®°è§£é”ã€é”ç²’åº¦ä¸å½“å¯¼è‡´æ­»é”ï¼‰ï¼š cpp è¿è¡Œ #include vector#include mutex#include threadstd::vectorint list;std::mutex mtx; // æ‰‹åŠ¨åˆ›å»ºäº’æ–¥é”void AddItem(int i) std::lock_guardstd::mutex lock(mtx); // æ‰‹åŠ¨åŠ é” list.push_back(i); // ä¸´ç•ŒåŒºæ“ä½œ // é”è‡ªåŠ¨é‡Šæ”¾ï¼ˆlock_guard ææ„ï¼‰int main() std::vectorstd::thread threads; for (int i = 0; i 1000; ++i) threads.emplace_back(AddItem, i); for (auto t : threads) t.join(); return 0; 3. C# å¹¶å‘é›†åˆçš„ä¼˜åŠ¿ æ— éœ€æ‰‹åŠ¨é”ï¼šå†…éƒ¨å°è£…åŒæ­¥æœºåˆ¶ï¼ˆç»†ç²’åº¦é”ã€æ— é”ç®—æ³•ï¼‰ï¼Œå¼€å‘è€…æ— éœ€å…³æ³¨é”é€»è¾‘ï¼› é«˜æ€§èƒ½ï¼šé¿å…å…¨å±€é”çš„ç«äº‰å¼€é”€ï¼ˆå¦‚Â ConcurrentDictionaryÂ ç”¨åˆ†æ®µé”ï¼ŒConcurrentBagÂ ç”¨çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼‰ï¼› å®‰å…¨ APIï¼šæä¾›Â TryXXXÂ ç³»åˆ—æ–¹æ³•ï¼ˆå¦‚Â TryDequeueã€TryAddï¼‰ï¼Œé¿å…å¹¶å‘æ“ä½œä¸­çš„å¼‚å¸¸ï¼› åŸç”Ÿé›†æˆï¼šæ”¯æŒÂ CancellationTokenã€å¼‚æ­¥æ“ä½œç­‰ C# ç‰¹æ€§ï¼Œé€‚é…ç°ä»£å¹¶å‘ç¼–ç¨‹åœºæ™¯ã€‚ äºŒã€æ ¸å¿ƒæ¦‚å¿µï¼šå¹¶å‘é›†åˆçš„è®¾è®¡åŸåˆ™1. çº¿ç¨‹å®‰å…¨å®šä¹‰C# å¹¶å‘é›†åˆçš„ â€œçº¿ç¨‹å®‰å…¨â€ æŒ‡ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œä¸ä¼šå‡ºç°æ•°æ®æŸåï¼Œä¸”æ“ä½œç»“æœç¬¦åˆé¢„æœŸâ€”â€” ä½†ä¸ä¿è¯ â€œåŸå­æ€§å¤åˆæ“ä½œâ€ï¼ˆå¦‚ â€œæ£€æŸ¥æ˜¯å¦å­˜åœ¨ â†’ ä¸å­˜åœ¨åˆ™æ·»åŠ â€ éœ€é¢å¤–é”ï¼‰ã€‚ 2. åŒæ­¥æœºåˆ¶ä¼˜åŒ–ï¼ˆå¯¹æ¯” C++ æ‰‹åŠ¨é”ï¼‰ åŒæ­¥æ–¹å¼ åŸç† C++ ç±»æ¯” é€‚ç”¨åœºæ™¯ ç»†ç²’åº¦é” å°†é›†åˆæ‹†åˆ†å¤šä¸ªç‰‡æ®µï¼Œæ¯ä¸ªç‰‡æ®µç‹¬ç«‹åŠ é”ï¼ˆå¦‚Â ConcurrentDictionaryÂ æ‹†åˆ†ä¸º 16 ä¸ªæ®µï¼‰ std::vectorstd::mutexÂ + åˆ†æ®µé” è¯»å¤šå†™å°‘ã€é«˜é¢‘è®¿é—®çš„é›†åˆ æ— é”ç®—æ³• åŸºäº CASï¼ˆCompare-And-Swapï¼‰åŸå­æ“ä½œï¼Œæ— é”ç«äº‰ï¼ˆå¦‚Â ConcurrentQueueÂ çš„é“¾è¡¨å®ç°ï¼‰ std::atomicÂ + CAS æ“ä½œ é«˜å¹¶å‘ã€çŸ­æ“ä½œçš„é›†åˆï¼ˆé˜Ÿåˆ—ã€æ ˆï¼‰ çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆTLSï¼‰ æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤æœ¬åœ°ç¼“å­˜ï¼Œæ‰¹é‡åˆå¹¶åˆ°å…¨å±€é›†åˆï¼ˆå¦‚Â ConcurrentBagï¼‰ thread_localÂ å®¹å™¨ + å…¨å±€åˆå¹¶ å¤šçº¿ç¨‹æ·»åŠ ã€éšæœºè®¿é—®çš„æ— åºé›†åˆ é˜»å¡é” æ“ä½œå¤±è´¥æ—¶é˜»å¡çº¿ç¨‹ï¼ˆå¦‚Â BlockingCollectionï¼‰ std::mutexÂ +Â std::condition_variable ç”Ÿäº§è€… - æ¶ˆè´¹è€…æ¨¡å¼ 3. å…³é”® API è®¾è®¡å¹¶å‘é›†åˆé¿å…ä½¿ç”¨æ™®é€šé›†åˆçš„ â€œä¿®æ”¹å³æŠ›å¼‚å¸¸â€ APIï¼ˆå¦‚Â Queue.DequeueÂ ç©ºé˜Ÿåˆ—æŠ›å¼‚å¸¸ï¼‰ï¼Œè€Œæ˜¯æä¾›Â TryXXXÂ æ–¹æ³•ï¼ˆè¿”å›Â boolÂ è¡¨ç¤ºæ“ä½œæˆåŠŸä¸å¦ï¼‰ï¼Œæ›´é€‚é…å¹¶å‘åœºæ™¯ï¼š æ™®é€šé›†åˆ API å¹¶å‘é›†åˆæ›¿ä»£ API ä¼˜åŠ¿ Queue.Dequeue() ConcurrentQueue.TryDequeue(out T result) ç©ºé˜Ÿåˆ—æ—¶è¿”å›Â falseï¼Œä¸æŠ›å¼‚å¸¸ Stack.Pop() ConcurrentStack.TryPop(out T result) ç©ºæ ˆæ—¶è¿”å›Â falseï¼Œä¸æŠ›å¼‚å¸¸ Dictionary.Add() ConcurrentDictionary.TryAdd(TKey, TValue) é”®å·²å­˜åœ¨æ—¶è¿”å›Â falseï¼Œä¸æŠ›å¼‚å¸¸ ä¸‰ã€å¸¸ç”¨å¹¶å‘é›†åˆè¯¦è§£ï¼ˆåœºæ™¯ + ç¤ºä¾‹ + C++ å¯¹æ¯”ï¼‰C# æä¾› 5 ä¸ªæ ¸å¿ƒå¹¶å‘é›†åˆï¼Œè¦†ç›–é˜Ÿåˆ—ã€æ ˆã€æ— åºé›†åˆã€å­—å…¸ã€é˜»å¡é˜Ÿåˆ—åœºæ™¯ï¼Œä»¥ä¸‹é€ä¸€è§£æï¼š 1. ConcurrentQueueï¼šçº¿ç¨‹å®‰å…¨çš„å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰é˜Ÿåˆ—æ ¸å¿ƒå®šä½é€‚ç”¨äºÂ ç”Ÿäº§è€… - æ¶ˆè´¹è€…æ¨¡å¼ï¼ˆå¦‚ä»»åŠ¡é˜Ÿåˆ—ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼ŒåŸºäºæ— é”é“¾è¡¨å®ç°ï¼Œé«˜å¹¶å‘ä¸‹æ€§èƒ½ä¼˜äº â€œQueueTÂ +Â lockâ€ã€‚ æ ¸å¿ƒ API API æ–¹æ³• ä½œç”¨ void Enqueue(T item) å…¥é˜Ÿï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ bool TryDequeue(out T result) å‡ºé˜Ÿï¼ˆç©ºé˜Ÿåˆ—è¿”å›Â falseï¼‰ bool TryPeek(out T result) æŸ¥çœ‹é˜Ÿé¦–ï¼ˆä¸åˆ é™¤ï¼Œç©ºé˜Ÿåˆ—è¿”å›Â falseï¼‰ int Count å½“å‰å…ƒç´ ä¸ªæ•°ï¼ˆè¿‘ä¼¼å€¼ï¼Œå¹¶å‘ä¸‹ä¸ä¿è¯ç²¾ç¡®ï¼‰ C# ç¤ºä¾‹ï¼šç”Ÿäº§è€… - æ¶ˆè´¹è€…æ¨¡å¼csharp è¿è¡Œ using System.Collections.Concurrent;using System.Threading.Tasks;// åˆ›å»ºå¹¶å‘é˜Ÿåˆ—ï¼ˆæ— ç•Œé˜Ÿåˆ—ï¼‰var queue = new ConcurrentQueueint();const int ProducerCount = 2; // 2ä¸ªç”Ÿäº§è€…const int ConsumerCount = 3; // 3ä¸ªæ¶ˆè´¹è€…const int ItemCount = 100; // æ¯ä¸ªç”Ÿäº§è€…ç”Ÿäº§100ä¸ªå…ƒç´ // ç”Ÿäº§è€…ï¼šå…¥é˜Ÿasync Task ProducerAsync(int id, CancellationToken ct) for (int i = 0; i ItemCount !ct.IsCancellationRequested; i++) int item = id * 1000 + i; queue.Enqueue(item); Console.WriteLine($ç”Ÿäº§è€…idï¼šå…¥é˜Ÿ item); await Task.Delay(10); // æ¨¡æ‹Ÿç”Ÿäº§è€—æ—¶ // æ¶ˆè´¹è€…ï¼šå‡ºé˜Ÿasync Task ConsumerAsync(int id, CancellationToken ct) while (!ct.IsCancellationRequested) if (queue.TryDequeue(out int item)) Console.WriteLine($æ¶ˆè´¹è€…idï¼šå‡ºé˜Ÿ item); await Task.Delay(15); // æ¨¡æ‹Ÿæ¶ˆè´¹è€—æ—¶ else // é˜Ÿåˆ—ç©ºæ—¶çŸ­æš‚ç­‰å¾…ï¼Œé¿å…å¿™ç­‰ await Task.Delay(50); // æ‰§è¡Œå¹¶å‘æ“ä½œusing var cts = new CancellationTokenSource(3000); // 3ç§’åå–æ¶ˆvar producerTasks = Enumerable.Range(0, ProducerCount) .Select(id = ProducerAsync(id, cts.Token));var consumerTasks = Enumerable.Range(0, ConsumerCount) .Select(id = ConsumerAsync(id, cts.Token));await Task.WhenAll(producerTasks);Console.WriteLine(æ‰€æœ‰ç”Ÿäº§è€…å®Œæˆï¼Œç­‰å¾…æ¶ˆè´¹è€…å¤„ç†å‰©ä½™å…ƒç´ ...);await Task.Delay(1000); // ç»™æ¶ˆè´¹è€…æ—¶é—´å¤„ç†å‰©ä½™å…ƒç´ cts.Cancel(); // å–æ¶ˆæ¶ˆè´¹è€…await Task.WhenAll(consumerTasks);Console.WriteLine($æœ€ç»ˆé˜Ÿåˆ—å‰©ä½™å…ƒç´ ï¼šqueue.Count); C++ å¯¹æ¯”ï¼šæ‰‹åŠ¨å®ç°çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—C++ éœ€ç”¨Â std::queueÂ +Â std::mutexÂ +Â std::condition_variableÂ å®ç°ï¼Œä»£ç ç¹çä¸”æ˜“å‡ºé”™ï¼š cpp è¿è¡Œ #include queue#include mutex#include condition_variable#include thread#include iostreamtemplate typename Tclass ConcurrentQueue private: std::queueT _queue; mutable std::mutex _mtx; std::condition_variable _cv;public: void Enqueue(T item) std::lock_guardstd::mutex lock(_mtx); _queue.push(std::move(item)); _cv.notify_one(); // é€šçŸ¥ç­‰å¾…çš„æ¶ˆè´¹è€… bool TryDequeue(T result, std::chrono::milliseconds timeout = std::chrono::milliseconds(0)) std::unique_lockstd::mutex lock(_mtx); if (timeout.count() == 0) if (_queue.empty()) return false; else // è¶…æ—¶ç­‰å¾… if (!_cv.wait_for(lock, timeout, [this]() return !_queue.empty(); )) return false; result = std::move(_queue.front()); _queue.pop(); return true; ;// ç”¨æ³•ï¼ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…ï¼‰ConcurrentQueueint queue;void Producer(int id) for (int i = 0; i 100; ++i) int item = id * 1000 + i; queue.Enqueue(item); std::cout ç”Ÿäº§è€… id ï¼šå…¥é˜Ÿ item std::endl; std::this_thread::sleep_for(std::chrono::milliseconds(10)); void Consumer(int id) int item; while (queue.TryDequeue(item, std::chrono::milliseconds(500))) std::cout æ¶ˆè´¹è€… id ï¼šå‡ºé˜Ÿ item std::endl; std::this_thread::sleep_for(std::chrono::milliseconds(15)); int main() std::vectorstd::thread producers; std::vectorstd::thread consumers; for (int i = 0; i 2; ++i) producers.emplace_back(Producer, i); for (int i = 0; i 3; ++i) consumers.emplace_back(Consumer, i); for (auto t : producers) t.join(); for (auto t : consumers) t.join(); return 0; é€‚ç”¨åœºæ™¯ ä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¦‚åå°ä»»åŠ¡è°ƒåº¦ï¼‰ï¼› æ¶ˆæ¯ä¼ é€’ï¼ˆå¦‚å¤šçº¿ç¨‹é—´çš„æ¶ˆæ¯é€šä¿¡ï¼‰ï¼› æ—¥å¿—æ”¶é›†ï¼ˆå¤šä¸ªçº¿ç¨‹å†™å…¥æ—¥å¿—ï¼Œå•çº¿ç¨‹è¾“å‡ºï¼‰ã€‚ 2. ConcurrentStackï¼šçº¿ç¨‹å®‰å…¨çš„åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰æ ˆæ ¸å¿ƒå®šä½é€‚ç”¨äºÂ æ ˆå¼æ•°æ®å…±äº«ï¼ˆå¦‚è°ƒç”¨æ ˆã€ç¼“å­˜æ ˆï¼‰ï¼ŒåŸºäºæ— é”ç®—æ³•å®ç°ï¼Œæ”¯æŒæ‰¹é‡å‹æ ˆ å¼¹æ ˆï¼ˆPushRangeTryPopRangeï¼‰ï¼Œæå‡æ‰¹é‡æ“ä½œæ€§èƒ½ã€‚ æ ¸å¿ƒ API API æ–¹æ³• ä½œç”¨ void Push(T item) å‹æ ˆï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ bool TryPop(out T result) å¼¹æ ˆï¼ˆç©ºæ ˆè¿”å›Â falseï¼‰ void PushRange(T[] items) æ‰¹é‡å‹æ ˆï¼ˆæ¯”å¤šæ¬¡ Push é«˜æ•ˆï¼‰ int TryPopRange(T[] items) æ‰¹é‡å¼¹æ ˆï¼ˆè¿”å›æˆåŠŸå¼¹æ ˆçš„å…ƒç´ ä¸ªæ•°ï¼‰ C# ç¤ºä¾‹ï¼šæ‰¹é‡æ“ä½œæ ˆcsharp è¿è¡Œ var stack = new ConcurrentStackint();// æ‰¹é‡å‹æ ˆï¼ˆ100ä¸ªå…ƒç´ ï¼‰stack.PushRange(Enumerable.Range(0, 100).ToArray());Console.WriteLine($æ ˆä¸­å…ƒç´ æ•°ï¼šstack.Count); // è¾“å‡º ~100ï¼ˆå¹¶å‘ä¸‹è¿‘ä¼¼ï¼‰// æ‰¹é‡å¼¹æ ˆï¼ˆæœ€å¤š50ä¸ªå…ƒç´ ï¼‰var buffer = new int[50];int poppedCount = stack.TryPopRange(buffer);Console.WriteLine($æˆåŠŸå¼¹æ ˆ poppedCount ä¸ªå…ƒç´ ); // è¾“å‡º 50Console.WriteLine($å¼¹æ ˆçš„å‰5ä¸ªå…ƒç´ ï¼šstring.Join(, , buffer.Take(5))); // è¾“å‡º 99, 98, 97, 96, 95 C++ å¯¹æ¯”ï¼šæ‰‹åŠ¨å®ç°çº¿ç¨‹å®‰å…¨æ ˆC++ éœ€ç”¨Â std::stackÂ +Â std::mutexï¼Œæ‰¹é‡æ“ä½œéœ€æ‰‹åŠ¨å¾ªç¯ï¼Œæ•ˆç‡è¾ƒä½ï¼š cpp è¿è¡Œ template typename Tclass ConcurrentStack private: std::stackT _stack; mutable std::mutex _mtx;public: void Push(T item) std::lock_guardstd::mutex lock(_mtx); _stack.push(std::move(item)); bool TryPop(T result) std::lock_guardstd::mutex lock(_mtx); if (_stack.empty()) return false; result = std::move(_stack.top()); _stack.pop(); return true; void PushRange(const std::vectorT items) std::lock_guardstd::mutex lock(_mtx); for (auto item : items) _stack.push(std::move(item)); ; é€‚ç”¨åœºæ™¯ ç¼“å­˜ç³»ç»Ÿï¼ˆå¦‚æœ€è¿‘æœ€å°‘ä½¿ç”¨ç¼“å­˜ LRU çš„æ ˆå®ç°ï¼‰ï¼› é€’å½’ä»»åŠ¡æ‹†åˆ†ï¼ˆå¦‚å¤šçº¿ç¨‹é€’å½’è®¡ç®—ï¼Œä»»åŠ¡æ ˆå…±äº«ï¼‰ï¼› æ‰¹é‡æ•°æ®å¤„ç†ï¼ˆéœ€æŒ‰é¡ºåºé€†åºå¤„ç†ï¼‰ã€‚ 3. ConcurrentBagï¼šçº¿ç¨‹å®‰å…¨çš„æ— åºé›†åˆæ ¸å¿ƒå®šä½é€‚ç”¨äºÂ å¤šçº¿ç¨‹æ·»åŠ ã€éšæœºè®¿é—®Â çš„æ— åºåœºæ™¯ï¼ˆå¦‚ä¸´æ—¶æ•°æ®é›†åˆã€ç»“æœæ±‡æ€»ï¼‰ï¼ŒåŸºäº â€œçº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆTLSï¼‰+ å…¨å±€åˆå¹¶â€ å®ç° â€”â€” æ¯ä¸ªçº¿ç¨‹ä¼˜å…ˆè®¿é—®æœ¬åœ°ç¼“å­˜ï¼Œå‡å°‘é”ç«äº‰ï¼Œæ€§èƒ½ä¼˜äºÂ ConcurrentListï¼ˆC# æ— å†…ç½®Â ConcurrentListï¼‰ã€‚ æ ¸å¿ƒç‰¹æ€§ æ— åºæ€§ï¼šä¸ä¿è¯å…ƒç´ é¡ºåºï¼ˆéå†é¡ºåºä¸ç¡®å®šï¼‰ï¼› é‡å¤å…ƒç´ ï¼šå…è®¸æ·»åŠ é‡å¤å…ƒç´ ï¼› é«˜æ•ˆæ·»åŠ ï¼šå¤šçº¿ç¨‹æ·»åŠ æ—¶ï¼Œä¼˜å…ˆå†™å…¥æœ¬åœ° TLS ç¼“å­˜ï¼Œå‡ ä¹æ— é”ç«äº‰ï¼› éšæœºè®¿é—®ï¼šTryTakeÂ éšæœºè·å–å¹¶åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼ˆé FIFOLIFOï¼‰ã€‚ æ ¸å¿ƒ API API æ–¹æ³• ä½œç”¨ void Add(T item) æ·»åŠ å…ƒç´ ï¼ˆçº¿ç¨‹å®‰å…¨ï¼Œé«˜æ•ˆï¼‰ bool TryTake(out T result) éšæœºè·å–å¹¶åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼ˆç©ºé›†åˆè¿”å›Â falseï¼‰ bool TryPeek(out T result) éšæœºæŸ¥çœ‹ä¸€ä¸ªå…ƒç´ ï¼ˆä¸åˆ é™¤ï¼‰ IEnumerableT ToArray() è½¬ä¸ºæ•°ç»„ï¼ˆå¿«ç…§ï¼Œå¹¶å‘ä¸‹å¯èƒ½åŒ…å«é‡å¤å…ƒç´ ï¼‰ C# ç¤ºä¾‹ï¼šå¤šçº¿ç¨‹ç»“æœæ±‡æ€»csharp è¿è¡Œ var bag = new ConcurrentBagint();// 5ä¸ªçº¿ç¨‹åŒæ—¶æ·»åŠ ç»“æœParallel.For(0, 5, threadId = for (int i = 0; i 20; i++) bag.Add(threadId * 100 + i); // æ¯ä¸ªçº¿ç¨‹æ·»åŠ 20ä¸ªå…ƒç´  );Console.WriteLine($é›†åˆå¤§å°ï¼šbag.Count); // è¾“å‡º 100Console.WriteLine($å‰10ä¸ªå…ƒç´ ï¼ˆæ— åºï¼‰ï¼šstring.Join(, , bag.Take(10))); // é¡ºåºä¸ç¡®å®š// éå†å¹¶ç§»é™¤æ‰€æœ‰å…ƒç´ while (bag.TryTake(out int item)) Console.Write($item ); C++ å¯¹æ¯”ï¼šæ‰‹åŠ¨å®ç°æ— åºå¹¶å‘é›†åˆC++ éœ€ç”¨Â std::vectorÂ +Â std::shared_mutexï¼ˆè¯»å¤šå†™å°‘ï¼‰ï¼Œä½†å¤šçº¿ç¨‹æ·»åŠ æ—¶é”ç«äº‰ä¸¥é‡ï¼š cpp è¿è¡Œ template typename Tclass ConcurrentBag private: std::vectorT _data; mutable std::shared_mutex _mtx;public: void Add(T item) std::unique_lockstd::shared_mutex lock(_mtx); _data.push_back(std::move(item)); bool TryTake(T result) std::unique_lockstd::shared_mutex lock(_mtx); if (_data.empty()) return false; // éšæœºå–æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆé«˜æ•ˆï¼‰ result = std::move(_data.back()); _data.pop_back(); return true; ; é€‚ç”¨åœºæ™¯ å¤šçº¿ç¨‹ä»»åŠ¡ç»“æœæ±‡æ€»ï¼ˆå¦‚å¹¶è¡Œè®¡ç®—çš„ä¸­é—´ç»“æœï¼‰ï¼› ä¸´æ—¶æ•°æ®å­˜å‚¨ï¼ˆæ— éœ€é¡ºåºï¼Œä»…éœ€æ·»åŠ å’Œéšæœºè®¿é—®ï¼‰ï¼› é«˜å¹¶å‘å†™å…¥ã€ä½é¢‘ç‡è¯»å–çš„åœºæ™¯ã€‚ 4. ConcurrentDictionaryTKey, TValueï¼šçº¿ç¨‹å®‰å…¨çš„é”®å€¼å¯¹é›†åˆæ ¸å¿ƒå®šä½é€‚ç”¨äºÂ å¤šçº¿ç¨‹è¯»å†™çš„é”®å€¼å¯¹å­˜å‚¨ï¼ˆå¦‚ç¼“å­˜ã€é…ç½®è¡¨ï¼‰ï¼ŒåŸºäº â€œåˆ†æ®µé”ï¼ˆSegment Lockï¼‰â€ å®ç° â€”â€” å°†å­—å…¸æ‹†åˆ†ä¸º 16 ä¸ªç‹¬ç«‹ç‰‡æ®µï¼Œæ¯ä¸ªç‰‡æ®µæœ‰è‡ªå·±çš„é”ï¼Œä¸åŒç‰‡æ®µçš„æ“ä½œå¯å¹¶å‘æ‰§è¡Œï¼Œå¤§å¹…æå‡è¯»å¤šå†™å°‘åœºæ™¯çš„æ€§èƒ½ã€‚ æ ¸å¿ƒä¼˜åŠ¿ï¼ˆå¯¹æ¯” C++Â std::mapÂ +Â std::mutexï¼‰ åˆ†æ®µé”ï¼šé¿å…å…¨å±€é”ç«äº‰ï¼Œå¹¶å‘æ€§èƒ½æå‡ 10~100 å€ï¼› åŸå­å¤åˆæ“ä½œï¼šæä¾›Â AddOrUpdateã€GetOrAddÂ ç­‰åŸå­æ–¹æ³•ï¼Œæ— éœ€æ‰‹åŠ¨åŠ é”ï¼› å®‰å…¨éå†ï¼šæšä¸¾æ—¶ä¸ä¼šæŠ›å‡ºÂ InvalidOperationExceptionï¼ˆæ™®é€šÂ DictionaryÂ éå†ä¸­ä¿®æ”¹ä¼šæŠ›å¼‚å¸¸ï¼‰ã€‚ æ ¸å¿ƒ API API æ–¹æ³• ä½œç”¨ bool TryAdd(TKey key, TValue value) æ·»åŠ é”®å€¼å¯¹ï¼ˆé”®å·²å­˜åœ¨è¿”å›Â falseï¼‰ bool TryGetValue(TKey key, out TValue value) è·å–å€¼ï¼ˆé”®ä¸å­˜åœ¨è¿”å›Â falseï¼‰ bool TryRemove(TKey key, out TValue value) ç§»é™¤é”®å€¼å¯¹ï¼ˆé”®ä¸å­˜åœ¨è¿”å›Â falseï¼‰ TValue GetOrAdd(TKey key, FuncTKey, TValue valueFactory) åŸå­æ“ä½œï¼šè·å–å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ TValue AddOrUpdate(TKey key, FuncTKey, TValue addValueFactory, FuncTKey, TValue, TValue updateValueFactory) åŸå­æ“ä½œï¼šæ·»åŠ æˆ–æ›´æ–°ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ C# ç¤ºä¾‹ï¼šç¼“å­˜åœºæ™¯ï¼ˆGetOrAdd åŸå­æ“ä½œï¼‰csharp è¿è¡Œ // å¹¶å‘å­—å…¸ä½œä¸ºç¼“å­˜ï¼ˆé”®ï¼šç”¨æˆ·IDï¼Œå€¼ï¼šç”¨æˆ·ä¿¡æ¯ï¼‰var userCache = new ConcurrentDictionaryint, string();// æ¨¡æ‹Ÿ10ä¸ªçº¿ç¨‹åŒæ—¶æŸ¥è¯¢ç¼“å­˜Parallel.For(0, 10, threadId = for (int userId = 1; userId = 5; userId++) // åŸå­æ“ä½œï¼šå­˜åœ¨åˆ™è¿”å›ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºï¼ˆé¿å…ç¼“å­˜ç©¿é€ï¼‰ string userInfo = userCache.GetOrAdd( key: userId, valueFactory: id = $ç”¨æˆ·idçš„ä¿¡æ¯ï¼ˆçº¿ç¨‹threadIdåˆ›å»ºï¼‰ ); Console.WriteLine($çº¿ç¨‹threadIdï¼šuserInfo); );// è¾“å‡ºè¯´æ˜ï¼šåŒä¸€ç”¨æˆ·IDçš„ä¿¡æ¯ä»…åˆ›å»ºä¸€æ¬¡ï¼ˆåŸå­æ“ä½œä¿è¯ï¼‰ C++ å¯¹æ¯”ï¼šæ‰‹åŠ¨å®ç°åˆ†æ®µé”å­—å…¸C++ éœ€æ‰‹åŠ¨æ‹†åˆ†ç‰‡æ®µã€ç®¡ç†å¤šä¸ªé”ï¼Œä»£ç æå…¶ç¹çï¼š cpp è¿è¡Œ template typename K, typename V, size_t SegmentCount = 16class ConcurrentDictionary private: struct Segment std::unordered_mapK, V map; std::mutex mtx; ; std::arraySegment, SegmentCount _segments; size_t GetSegmentIndex(const K key) const std::hashK hasher; return hasher(key) % SegmentCount; public: V GetOrAdd(const K key, std::functionV(const K) valueFactory) auto segment = _segments[GetSegmentIndex(key)]; std::lock_guardstd::mutex lock(segment.mtx); auto it = segment.map.find(key); if (it != segment.map.end()) return it-second; V value = valueFactory(key); segment.map.emplace(key, value); return value; ; é€‚ç”¨åœºæ™¯ ç¼“å­˜ç³»ç»Ÿï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ç¼“å­˜ã€é…ç½®ç¼“å­˜ï¼‰ï¼› å…±äº«çŠ¶æ€å­˜å‚¨ï¼ˆå¦‚å¤šçº¿ç¨‹å…±äº«çš„è®¡æ•°å™¨ã€çŠ¶æ€è¡¨ï¼‰ï¼› é«˜å¹¶å‘é”®å€¼å¯¹æŸ¥è¯¢ï¼ˆå¦‚ API æ¥å£çš„å‚æ•°æ˜ å°„ï¼‰ã€‚ 5. BlockingCollectionï¼šæ”¯æŒé˜»å¡çš„å¹¶å‘é›†åˆï¼ˆç”Ÿäº§è€… - æ¶ˆè´¹è€…ç»ˆææ–¹æ¡ˆï¼‰æ ¸å¿ƒå®šä½BlockingCollectionTÂ æ˜¯Â â€œå¹¶å‘é›†åˆçš„åŒ…è£…å™¨â€ï¼Œå¯åŒ…è£…Â ConcurrentQueueã€ConcurrentStackÂ ç­‰ï¼Œæä¾›Â é˜»å¡æ“ä½œÂ å’ŒÂ è¾¹ç•Œé™åˆ¶ï¼ˆè®¾ç½®æœ€å¤§å®¹é‡ï¼‰ï¼Œæ˜¯ç”Ÿäº§è€… - æ¶ˆè´¹è€…æ¨¡å¼çš„ â€œç»ˆæè§£å†³æ–¹æ¡ˆâ€â€”â€” æ— éœ€æ‰‹åŠ¨å¤„ç†é˜Ÿåˆ—ç©º æ»¡æ—¶çš„é˜»å¡é€»è¾‘ã€‚ æ ¸å¿ƒç‰¹æ€§ é˜»å¡æ“ä½œï¼šTake()Â é˜»å¡ç›´åˆ°æœ‰å…ƒç´ ï¼ŒAdd()Â é˜»å¡ç›´åˆ°é˜Ÿåˆ—æœ‰ç©ºé—²ç©ºé—´ï¼ˆè®¾ç½®è¾¹ç•Œæ—¶ï¼‰ï¼› è¾¹ç•Œé™åˆ¶ï¼šå¯è®¾ç½®æœ€å¤§å®¹é‡ï¼ˆå¦‚Â new BlockingCollectionint(100)ï¼Œé˜Ÿåˆ—æ»¡æ—¶Â Add()Â é˜»å¡ï¼‰ï¼› æ”¯æŒå–æ¶ˆï¼šé›†æˆÂ CancellationTokenï¼Œå¯éšæ—¶å–æ¶ˆé˜»å¡æ“ä½œï¼› å¤šç”Ÿäº§è€… å¤šæ¶ˆè´¹è€…ï¼šå¤©ç„¶æ”¯æŒå¤šä¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¹¶å‘æ“ä½œã€‚ æ ¸å¿ƒ API API æ–¹æ³• ä½œç”¨ void Add(T item, CancellationToken ct) æ·»åŠ å…ƒç´ ï¼ˆé˜Ÿåˆ—æ»¡æ—¶é˜»å¡ï¼Œæ”¯æŒå–æ¶ˆï¼‰ T Take(CancellationToken ct) ç§»é™¤å…ƒç´ ï¼ˆé˜Ÿåˆ—ç©ºæ—¶é˜»å¡ï¼Œæ”¯æŒå–æ¶ˆï¼‰ bool TryAdd(T item, int millisecondsTimeout) å°è¯•æ·»åŠ ï¼ˆè¶…æ—¶è¿”å›Â falseï¼‰ bool TryTake(out T result, int millisecondsTimeout) å°è¯•ç§»é™¤ï¼ˆè¶…æ—¶è¿”å›Â falseï¼‰ void CompleteAdding() æ ‡è®° â€œæ·»åŠ å®Œæˆâ€ï¼Œæ¶ˆè´¹è€…Â Take()Â å®Œå…ƒç´ åè¿”å› C# ç¤ºä¾‹ï¼šæœ‰è¾¹ç•Œçš„ç”Ÿäº§è€… - æ¶ˆè´¹è€…csharp è¿è¡Œ // åŒ…è£… ConcurrentQueueï¼Œè®¾ç½®æœ€å¤§å®¹é‡ä¸º 10ï¼ˆé˜Ÿåˆ—æ»¡æ—¶ç”Ÿäº§è€…é˜»å¡ï¼‰var blockingQueue = new BlockingCollectionint(new ConcurrentQueueint(), boundedCapacity: 10);const int ProducerCount = 2;const int ConsumerCount = 2;const int ItemPerProducer = 50;// ç”Ÿäº§è€…ï¼šæ·»åŠ å…ƒç´ ï¼ˆé˜Ÿåˆ—æ»¡æ—¶é˜»å¡ï¼‰async Task ProducerAsync(int id, CancellationToken ct) for (int i = 0; i ItemPerProducer; i++) int item = id * 1000 + i; blockingQueue.Add(item, ct); // é˜Ÿåˆ—æ»¡æ—¶é˜»å¡ Console.WriteLine($ç”Ÿäº§è€…idï¼šæ·»åŠ  itemï¼Œå½“å‰é˜Ÿåˆ—å¤§å°ï¼šblockingQueue.Count); await Task.Delay(5); // æ¶ˆè´¹è€…ï¼šç§»é™¤å…ƒç´ ï¼ˆé˜Ÿåˆ—ç©ºæ—¶é˜»å¡ï¼‰async Task ConsumerAsync(int id, CancellationToken ct) try while (!ct.IsCancellationRequested) int item = blockingQueue.Take(ct); // é˜Ÿåˆ—ç©ºæ—¶é˜»å¡ Console.WriteLine($æ¶ˆè´¹è€…idï¼šç§»é™¤ itemï¼Œå½“å‰é˜Ÿåˆ—å¤§å°ï¼šblockingQueue.Count); await Task.Delay(10); // æ¶ˆè´¹è€—æ—¶æ›´é•¿ï¼Œé˜Ÿåˆ—å¯èƒ½æ»¡ catch (OperationCanceledException) Console.WriteLine($æ¶ˆè´¹è€…idï¼šå–æ¶ˆæ“ä½œ); // æ‰§è¡Œusing var cts = new CancellationTokenSource(2000);var producerTasks = Enumerable.Range(0, ProducerCount).Select(id = ProducerAsync(id, cts.Token));var consumerTasks = Enumerable.Range(0, ConsumerCount).Select(id = ConsumerAsync(id, cts.Token));await Task.WhenAll(producerTasks);blockingQueue.CompleteAdding(); // æ ‡è®°æ·»åŠ å®ŒæˆConsole.WriteLine(æ‰€æœ‰ç”Ÿäº§è€…å®Œæˆï¼Œç­‰å¾…æ¶ˆè´¹è€…å¤„ç†å‰©ä½™å…ƒç´ ...);await Task.WhenAll(consumerTasks);Console.WriteLine($æœ€ç»ˆé˜Ÿåˆ—å¤§å°ï¼šblockingQueue.Count); // è¾“å‡º 0 C++ å¯¹æ¯”ï¼šæ‰‹åŠ¨å®ç°é˜»å¡é˜Ÿåˆ—C++ éœ€ç”¨Â std::queueÂ +Â std::mutexÂ +Â std::condition_variableï¼Œè¾¹ç•Œé™åˆ¶éœ€æ‰‹åŠ¨åˆ¤æ–­ï¼š cpp è¿è¡Œ template typename Tclass BlockingQueue private: std::queueT _queue; mutable std::mutex _mtx; std::condition_variable _notEmpty; std::condition_variable _notFull; size_t _capacity;public: BlockingQueue(size_t capacity) : _capacity(capacity) void Add(T item, std::stop_token st) std::unique_lockstd::mutex lock(_mtx); // é˜Ÿåˆ—æ»¡æ—¶ç­‰å¾…ï¼Œæ”¯æŒå–æ¶ˆ _notFull.wait(lock, st, [this]() return _queue.size() _capacity; ); if (st.stop_requested()) return; _queue.push(std::move(item)); _notEmpty.notify_one(); T Take(std::stop_token st) std::unique_lockstd::mutex lock(_mtx); // é˜Ÿåˆ—ç©ºæ—¶ç­‰å¾…ï¼Œæ”¯æŒå–æ¶ˆ _notEmpty.wait(lock, st, [this]() return !_queue.empty(); ); if (st.stop_requested()) throw std::runtime_error(Canceled); T result = std::move(_queue.front()); _queue.pop(); _notFull.notify_one(); return result; ; é€‚ç”¨åœºæ™¯ æœ‰ç•Œç”Ÿäº§è€… - æ¶ˆè´¹è€…æ¨¡å¼ï¼ˆå¦‚çº¿ç¨‹æ± ä»»åŠ¡è°ƒåº¦ã€æ¶ˆæ¯é˜Ÿåˆ—é™æµï¼‰ï¼› å¤šçº¿ç¨‹é—´çš„åŒæ­¥æ•°æ®ä¼ è¾“ï¼ˆå¦‚ä¸»çº¿ç¨‹ä¸åå°çº¿ç¨‹çš„é€šä¿¡ï¼‰ï¼› éœ€è¦é˜»å¡ç­‰å¾…çš„å¹¶å‘åœºæ™¯ï¼ˆé¿å…å¿™ç­‰æµªè´¹ CPUï¼‰ã€‚ å››ã€ä¸ C++ å¹¶å‘å®¹å™¨çš„æ ¸å¿ƒå·®å¼‚å¯¹æ¯” ç‰¹æ€§ C# å¹¶å‘é›†åˆ C++ å¹¶å‘æ–¹æ¡ˆï¼ˆå®¹å™¨ + åŒæ­¥åŸè¯­ï¼‰ æ ¸å¿ƒä¼˜åŠ¿ï¼ˆC#ï¼‰ çº¿ç¨‹å®‰å…¨å°è£… å†…ç½®åŒæ­¥æœºåˆ¶ï¼Œæ— éœ€æ‰‹åŠ¨é” éœ€æ‰‹åŠ¨ç»„åˆå®¹å™¨ + mutexcondition_variable å‡å°‘æ­»é”ã€æ•°æ®ç«äº‰ç­‰ä½çº§é”™è¯¯ å¹¶å‘æ€§èƒ½ ç»†ç²’åº¦é”ã€æ— é”ç®—æ³•ã€TLS ä¼˜åŒ– å…¨å±€é”ä¸ºä¸»ï¼Œæ€§èƒ½ä¾èµ–æ‰‹åŠ¨ä¼˜åŒ– é«˜å¹¶å‘åœºæ™¯ä¸‹æ€§èƒ½æ›´ä¼˜ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒä¼˜ API è®¾è®¡ TryXXX æ–¹æ³•ã€åŸå­å¤åˆæ“ä½œï¼ˆGetOrAddï¼‰ éœ€æ‰‹åŠ¨å®ç°åŸå­æ“ä½œï¼ŒAPI ç¹ç å¼€å‘æ•ˆç‡é«˜ï¼Œé€‚é…å¹¶å‘åœºæ™¯çš„ API æ›´å‹å¥½ é˜»å¡æ“ä½œæ”¯æŒ BlockingCollection åŸç”Ÿæ”¯æŒ éœ€æ‰‹åŠ¨ç”¨ condition_variable å®ç° æ— éœ€å…³æ³¨é˜»å¡ å”¤é†’é€»è¾‘ï¼Œä»£ç æ›´ç®€æ´ å–æ¶ˆæœºåˆ¶é›†æˆ åŸç”Ÿæ”¯æŒ CancellationToken éœ€æ‰‹åŠ¨ç»“åˆ stop_tokenatomic å–æ¶ˆé€»è¾‘ç»Ÿä¸€ï¼Œé€‚é…å¼‚æ­¥ å¤šçº¿ç¨‹åœºæ™¯ éå†å®‰å…¨æ€§ æšä¸¾æ—¶å¯ä¿®æ”¹ï¼Œæ— å¼‚å¸¸ éå†ä¸­ä¿®æ”¹å¯èƒ½å¯¼è‡´æœªå®šä¹‰è¡Œä¸º éå†æ“ä½œæ›´å®‰å…¨ï¼Œæ— éœ€é¢å¤–é”ä¿æŠ¤ äº”ã€å¸¸è§è¯¯åŒºä¸é¿å‘æŒ‡å—1. è¯¯åŒº 1ï¼šå¹¶å‘é›†åˆæ˜¯ â€œç»å¯¹çº¿ç¨‹å®‰å…¨â€ï¼ˆæ”¯æŒæ‰€æœ‰å¤åˆæ“ä½œï¼‰ é”™è¯¯è®¤çŸ¥ï¼šConcurrentDictionaryÂ çš„Â ContainsKeyÂ +Â AddÂ æ˜¯åŸå­æ“ä½œï¼› æ­£ç¡®é€»è¾‘ï¼šå¹¶å‘é›†åˆä»…ä¿è¯Â å•ä¸ª API çº¿ç¨‹å®‰å…¨ï¼Œå¤åˆæ“ä½œï¼ˆå¦‚ â€œæ£€æŸ¥ â†’ ä¿®æ”¹â€ï¼‰éœ€é¢å¤–é”ï¼š csharp è¿è¡Œ // é”™è¯¯ï¼šå¤åˆæ“ä½œéåŸå­ï¼Œå¯èƒ½å‡ºç°é‡å¤æ·»åŠ if (!concurrentDict.ContainsKey(key)) concurrentDict.TryAdd(key, value); // å¤šçº¿ç¨‹ä¸‹å¯èƒ½é‡å¤æ·»åŠ // æ­£ç¡®ï¼šç”¨åŸå­æ–¹æ³• GetOrAddï¼ˆæˆ–æ‰‹åŠ¨åŠ é”ï¼‰concurrentDict.GetOrAdd(key, value); // åŸå­æ“ä½œï¼Œæ— é‡å¤æ·»åŠ é£é™© 2. è¯¯åŒº 2ï¼šå¹¶å‘é›†åˆæ€§èƒ½ä¸€å®šæ¯” â€œæ™®é€šé›†åˆ + lockâ€ å¥½ é”™è¯¯è®¤çŸ¥ï¼šæ‰€æœ‰åœºæ™¯ä¸‹å¹¶å‘é›†åˆéƒ½æ›´é«˜æ•ˆï¼› æ­£ç¡®é€»è¾‘ï¼š å•çº¿ç¨‹åœºæ™¯ï¼šæ™®é€šé›†åˆæ€§èƒ½ä¼˜äºå¹¶å‘é›†åˆï¼ˆæ— åŒæ­¥å¼€é”€ï¼‰ï¼› ä½å¹¶å‘åœºæ™¯ï¼šæ™®é€šé›†åˆ + lock å¯èƒ½æ›´é«˜æ•ˆï¼ˆå¹¶å‘é›†åˆçš„åŒæ­¥ä¼˜åŒ–æœ‰å›ºå®šå¼€é”€ï¼‰ï¼› é«˜å¹¶å‘åœºæ™¯ï¼šå¹¶å‘é›†åˆä¼˜åŠ¿æ˜æ˜¾ï¼ˆç»†ç²’åº¦é” æ— é”ç®—æ³•å‡å°‘ç«äº‰ï¼‰ã€‚ 3. è¯¯åŒº 3ï¼šBlockingCollection åªèƒ½åŒ…è£… ConcurrentQueue é”™è¯¯è®¤çŸ¥ï¼šBlockingCollectionÂ ä»…æ”¯æŒé˜Ÿåˆ—ï¼› æ­£ç¡®é€»è¾‘ï¼šå¯åŒ…è£…ä»»ä½•å®ç°Â IProducerConsumerCollectionTÂ çš„é›†åˆï¼ˆå¦‚Â ConcurrentStackã€ConcurrentBagï¼‰ï¼Œç”šè‡³è‡ªå®šä¹‰é›†åˆï¼š csharp è¿è¡Œ // åŒ…è£… ConcurrentStackï¼Œå®ç°é˜»å¡æ ˆvar blockingStack = new BlockingCollectionint(new ConcurrentStackint());blockingStack.Add(1);int item = blockingStack.Take(); // é˜»å¡ç›´åˆ°æœ‰å…ƒç´  4. è¯¯åŒº 4ï¼šConcurrentBag æ˜¯ â€œçº¿ç¨‹å®‰å…¨çš„ Listâ€ é”™è¯¯è®¤çŸ¥ï¼šConcurrentBagÂ æ”¯æŒç´¢å¼•è®¿é—®ï¼Œé¡ºåºéå†ï¼› æ­£ç¡®é€»è¾‘ï¼šConcurrentBagÂ æ˜¯æ— åºé›†åˆï¼Œæ— ç´¢å¼•è®¿é—® APIï¼Œéå†é¡ºåºä¸ç¡®å®š â€”â€” è‹¥éœ€æœ‰åºè®¿é—®ï¼Œåº”ä½¿ç”¨Â ConcurrentQueueÂ æˆ–Â BlockingCollectionÂ + è‡ªå®šä¹‰æœ‰åºå®¹å™¨ã€‚ 5. è¯¯åŒº 5ï¼šå¿½ç•¥ CancellationToken çš„ä½¿ç”¨ é”™è¯¯åœºæ™¯ï¼šé˜»å¡æ“ä½œï¼ˆå¦‚Â BlockingCollection.Take()ï¼‰æœªä¼ å…¥Â CancellationTokenï¼Œå¯¼è‡´æ— æ³•å–æ¶ˆï¼› æ­£ç¡®åšæ³•ï¼šæ‰€æœ‰é˜»å¡æ“ä½œéƒ½åº”ä¼ å…¥Â CancellationTokenï¼Œé¿å…çº¿ç¨‹æ— æ³•é€€å‡ºï¼š csharp è¿è¡Œ // æ­£ç¡®ï¼šæ”¯æŒå–æ¶ˆçš„é˜»å¡æ“ä½œtry int item = blockingQueue.Take(cts.Token); catch (OperationCanceledException) // å¤„ç†å–æ¶ˆé€»è¾‘ 6. è¯¯åŒº 6ï¼šConcurrentDictionary çš„ Count æ˜¯ç²¾ç¡®å€¼ é”™è¯¯è®¤çŸ¥ï¼šconcurrentDict.CountÂ èƒ½è·å–å®æ—¶ç²¾ç¡®çš„å…ƒç´ ä¸ªæ•°ï¼› æ­£ç¡®é€»è¾‘ï¼šå¹¶å‘é›†åˆçš„Â CountÂ æ˜¯Â è¿‘ä¼¼å€¼ï¼ˆé«˜å¹¶å‘ä¸‹ï¼Œç»Ÿè®¡æ—¶å…ƒç´ å¯èƒ½è¢«æ·»åŠ  åˆ é™¤ï¼‰â€”â€” è‹¥éœ€ç²¾ç¡®è®¡æ•°ï¼Œéœ€æ‰‹åŠ¨åŠ é”ï¼š csharp è¿è¡Œ // ç²¾ç¡®è®¡æ•°ï¼ˆéœ€é¢å¤–é”ï¼Œå½±å“æ€§èƒ½ï¼‰lock (countLock) int exactCount = concurrentDict.Count; å…­ã€æœ€ä½³å®è·µï¼ˆé¢å‘ C++ ç¨‹åºå‘˜çš„è¿ç§»å»ºè®®ï¼‰ æ”¾å¼ƒ â€œå®¹å™¨ + æ‰‹åŠ¨é”â€ çš„æ€ç»´ï¼šä¼˜å…ˆä½¿ç”¨ C# å†…ç½®å¹¶å‘é›†åˆï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†é”ç”Ÿå‘½å‘¨æœŸå’ŒåŒæ­¥é€»è¾‘ï¼› æŒ‰åœºæ™¯é€‰æ‹©åˆé€‚çš„é›†åˆï¼š ç”Ÿäº§è€… - æ¶ˆè´¹è€…ï¼ˆFIFOï¼‰ï¼šConcurrentQueueÂ +Â BlockingCollectionï¼ˆæœ‰ç•Œï¼‰ï¼› ç”Ÿäº§è€… - æ¶ˆè´¹è€…ï¼ˆLIFOï¼‰ï¼šConcurrentStackÂ +Â BlockingCollectionï¼› æ— åºç»“æœæ±‡æ€»ï¼šConcurrentBagï¼› é”®å€¼å¯¹ç¼“å­˜ æŸ¥è¯¢ï¼šConcurrentDictionaryï¼› æœ‰ç•Œé˜»å¡åœºæ™¯ï¼šç›´æ¥ç”¨Â BlockingCollectionï¼› ä¼˜å…ˆä½¿ç”¨åŸå­å¤åˆæ“ä½œï¼šå¦‚Â ConcurrentDictionary.GetOrAddã€AddOrUpdateï¼Œé¿å…æ‰‹åŠ¨ç»„åˆå¤šä¸ª APIï¼› é˜»å¡æ“ä½œå¿…ä¼  CancellationTokenï¼šç¡®ä¿çº¿ç¨‹èƒ½å“åº”å–æ¶ˆï¼Œé¿å…èµ„æºæ³„æ¼ï¼› é¿å…è¿‡åº¦ä½¿ç”¨å¹¶å‘é›†åˆï¼šå•çº¿ç¨‹æˆ–ä½å¹¶å‘åœºæ™¯ï¼Œæ™®é€šé›†åˆï¼ˆListTã€DictionaryTKey, TValueï¼‰æ€§èƒ½æ›´ä¼˜ï¼› ä¸ä¾èµ– Count å±æ€§çš„ç²¾ç¡®æ€§ï¼šé«˜å¹¶å‘ä¸‹ï¼ŒCount ä»…ä½œå‚è€ƒï¼Œæ— éœ€è¿½æ±‚ç²¾ç¡®å€¼ï¼› **è‡ªå®šä¹‰å¹¶å‘é›†åˆæ—¶å®ç° IProducerConsumerCollection**ï¼šå¯è¢«Â BlockingCollectionÂ åŒ…è£…ï¼Œå¤ç”¨é˜»å¡ è¾¹ç•ŒåŠŸèƒ½ã€‚ æ€»ç»“C# å¹¶å‘é›†åˆçš„æ ¸å¿ƒä»·å€¼æ˜¯Â â€œçº¿ç¨‹å®‰å…¨ + é«˜æ€§èƒ½ + å¼€å‘é«˜æ•ˆâ€ï¼Œå¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼š å®ƒæ˜¯ C++ ä¸­ â€œå®¹å™¨ + åŒæ­¥åŸè¯­â€ çš„å°è£…å‡çº§ï¼Œæ— éœ€å…³æ³¨é”ç»†èŠ‚ï¼Œå‡å°‘å‡ºé”™æ¦‚ç‡ï¼› æ ¸å¿ƒé›†åˆåˆ†å·¥æ˜ç¡®ï¼Œè¦†ç›–é˜Ÿåˆ—ã€æ ˆã€å­—å…¸ã€æ— åºé›†åˆã€é˜»å¡åœºæ™¯ï¼Œæ»¡è¶³ç»å¤§å¤šæ•°å¹¶å‘éœ€æ±‚ï¼› ä¸ C++ ç›¸æ¯”ï¼ŒC# å¹¶å‘é›†åˆåŸç”Ÿæ”¯æŒå–æ¶ˆæœºåˆ¶ã€å¼‚æ­¥æ“ä½œã€åŸå­å¤åˆæ“ä½œï¼Œæ›´é€‚é…ç°ä»£å¹¶å‘ç¼–ç¨‹ï¼› å…³é”®æ˜¯ â€œæŒ‰åœºæ™¯é€‰å¯¹é›†åˆâ€ï¼Œé¿å…æ»¥ç”¨ â€”â€” å•çº¿ç¨‹ç”¨æ™®é€šé›†åˆï¼Œé«˜å¹¶å‘ç”¨å¹¶å‘é›†åˆï¼Œé˜»å¡åœºæ™¯ç”¨Â BlockingCollectionã€‚ C# å¹¶å‘é›†åˆè®©å¤šçº¿ç¨‹ç¼–ç¨‹ä» â€œæ‰‹åŠ¨æ§é”çš„ç¹çæ˜“é”™â€ èµ°å‘ â€œå¼€ç®±å³ç”¨çš„å®‰å…¨é«˜æ•ˆâ€ï¼Œè¿™ä¹Ÿæ˜¯ C# æ¯” C++ æ›´é€‚åˆå¿«é€Ÿå¼€å‘å¹¶å‘åº”ç”¨çš„æ ¸å¿ƒåŸå› ä¹‹ä¸€ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"SIMD æŒ‡ä»¤","path":"/2025/11/26/2-ç¼–ç¨‹è¯­è¨€-CSharp-SIMD-æŒ‡ä»¤/","content":"C# SIMD æŒ‡ä»¤ï¼šä½é—¨æ§›é«˜æ€§èƒ½å¹¶è¡Œè®¡ç®—ï¼ˆé¢å‘ C++ ç¨‹åºå‘˜ï¼‰C# ä¸­çš„Â SIMDï¼ˆSingle Instruction, Multiple Dataï¼‰Â æ˜¯åŸºäºÂ System.NumericsÂ å‘½åç©ºé—´çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œæ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯ï¼šè®©å¼€å‘è€…æ— éœ€æ‰‹åŠ¨ç¼–å†™æ±‡ç¼–çº§æŒ‡ä»¤ï¼Œå°±èƒ½åˆ©ç”¨ CPU çš„å‘é‡å¯„å­˜å™¨ï¼ˆå¦‚ SSEAVXï¼‰ï¼Œå¯¹æ‰¹é‡æ•°æ®æ‰§è¡Œ â€œå•æŒ‡ä»¤å¤šæ•°æ®â€ å¹¶è¡Œè¿ç®—â€”â€” å¤§å¹…æå‡æ•°å€¼è®¡ç®—ã€ä¿¡å·å¤„ç†ã€å›¾åƒå¤„ç†ç­‰å¯†é›†å‹ä»»åŠ¡çš„æ€§èƒ½ã€‚ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼ŒC# SIMD å¯ç±»æ¯”ä¸ºÂ â€œC++ ç¡¬ä»¶ intrinsicsï¼ˆå¦‚ SSEAVX æŒ‡ä»¤ï¼‰æˆ– C++20Â std::simdÂ çš„å®‰å…¨ç®€åŒ–ç‰ˆâ€ï¼šå®ƒå±è”½äº†åº•å±‚ç¡¬ä»¶ç»†èŠ‚ï¼ˆå¦‚å¯„å­˜å™¨å®½åº¦ã€æŒ‡ä»¤é›†å·®å¼‚ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†å†…å­˜å¯¹é½ã€æŒ‡ä»¤é›†åˆ†æ”¯ï¼ŒåŒæ—¶ä¿æŒæ¥è¿‘ C++ åŸç”Ÿ SIMD çš„æ€§èƒ½ï¼Œä¸”ç±»å‹å®‰å…¨ã€å¼€å‘æ•ˆç‡æé«˜ã€‚ ä¸€ã€æ ¸å¿ƒå‰æï¼šSIMD æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ1. åŸºç¡€æ¦‚å¿µï¼šSIMD çš„æ ¸å¿ƒæ€æƒ³CPU çš„æ™®é€šæŒ‡ä»¤ä¸€æ¬¡åªèƒ½å¤„ç† 1 ä¸ªæ•°æ®ï¼ˆå¦‚Â a + bÂ ä»…è®¡ç®—ä¸¤ä¸ªæ•´æ•°ä¹‹å’Œï¼‰ï¼Œè€Œ SIMD æŒ‡ä»¤èƒ½ä¸€æ¬¡å¤„ç†Â å¤šä¸ªåŒç±»å‹æ•°æ®ï¼ˆå¦‚åŒæ—¶è®¡ç®— 4 å¯¹æ•´æ•°ä¹‹å’Œï¼‰â€”â€” æœ¬è´¨æ˜¯åˆ©ç”¨ CPU çš„ â€œå‘é‡å¯„å­˜å™¨â€ï¼ˆå¦‚ 128 ä½ SSE å¯„å­˜å™¨ã€256 ä½ AVX å¯„å­˜å™¨ï¼‰ï¼Œå°†æ‰¹é‡æ•°æ®æ‰“åŒ…åå¹¶è¡Œè¿ç®—ã€‚ ç¤ºä¾‹å¯¹æ¯”ï¼ˆæ•°ç»„å…ƒç´ ç¿»å€ï¼‰ï¼š æ™®é€šè®¡ç®—ï¼ˆä¸²è¡Œï¼‰ï¼šå¾ªç¯éå†æ•°ç»„ï¼Œé€ä¸ªå…ƒç´  Ã—2ï¼ˆ1000 ä¸ªå…ƒç´ éœ€ 1000 æ¬¡è¿ç®—ï¼‰ï¼› SIMD è®¡ç®—ï¼ˆå¹¶è¡Œï¼‰ï¼šå°†æ•°ç»„æŒ‰å‘é‡å®½åº¦æ‰“åŒ…ï¼ˆå¦‚ 256 ä½ AVX å¯æ‰“åŒ… 8 ä¸ª intï¼‰ï¼Œä¸€æ¬¡æŒ‡ä»¤å®Œæˆ 8 ä¸ªå…ƒç´  Ã—2ï¼ˆ1000 ä¸ªå…ƒç´ ä»…éœ€ï½125 æ¬¡è¿ç®—ï¼‰ã€‚ 2. C# SIMD çš„ä¾èµ–ä¸æ”¯æŒ å‘½åç©ºé—´ï¼šusing System.Numerics;ï¼ˆ.NET Core 2.0+NET 5+ å†…ç½®ï¼Œæ— éœ€é¢å¤–å¼•ç”¨ï¼‰ï¼› æ”¯æŒçš„ CPU æŒ‡ä»¤é›†ï¼šè‡ªåŠ¨é€‚é… SSE2ã€SSE4.1ã€AVXã€AVX2ã€AVX-512 ç­‰ï¼ˆæ— éœ€æ‰‹åŠ¨åˆ¤æ–­ CPU å‹å·ï¼‰ï¼› æ”¯æŒçš„æ•°æ®ç±»å‹ï¼šintã€floatã€doubleã€byteÂ ç­‰åŸºå…ƒç±»å‹ï¼Œä»¥åŠè‡ªå®šä¹‰å‘é‡ç±»å‹ï¼ˆVector2Vector3Vector4Â ç­‰ï¼‰ã€‚ 3. ä¸ C++ SIMD çš„æ ¸å¿ƒå·®å¼‚ï¼ˆå…¥é—¨è®¤çŸ¥ï¼‰ ç‰¹æ€§ C# SIMD C++ SIMD å®ç° æ ¸å¿ƒä¼˜åŠ¿ï¼ˆC#ï¼‰ åº•å±‚ä¾èµ– System.NumericsÂ å°è£…ï¼Œè‡ªåŠ¨é€‚é…æŒ‡ä»¤é›† ç¡¬ä»¶ intrinsicsï¼ˆå¦‚Â immintrin.hï¼‰æˆ– C++20Â std::simd æ— éœ€å…³æ³¨ CPU æŒ‡ä»¤é›†ï¼Œè·¨å¹³å°å…¼å®¹ å†…å­˜å¯¹é½ è‡ªåŠ¨å¤„ç†ï¼ˆå‘é‡ç±»å‹é»˜è®¤å¯¹é½ï¼‰ éœ€æ‰‹åŠ¨ç”¨Â __declspec(align)Â æˆ–Â alignasÂ ä¿è¯å¯¹é½ é¿å…å¯¹é½é”™è¯¯å¯¼è‡´çš„å´©æºƒ æ€§èƒ½ä¸‹é™ ç±»å‹å®‰å…¨ å¼ºç±»å‹æ£€æŸ¥ï¼ˆVectorTÂ æ³›å‹çº¦æŸï¼‰ è£¸æŒ‡é’ˆæ“ä½œ + intrinsicsï¼Œæ˜“å‡ºç°ç±»å‹é”™è¯¯ ç¼–è¯‘æ—¶æ’æŸ¥é”™è¯¯ï¼Œé¿å…å†…å­˜è¶Šç•Œ ç±»å‹ä¸åŒ¹é… å¼€å‘æ•ˆç‡ ç®€æ´ APIï¼ˆå¦‚Â Vector.AddÂ ç›´æ¥å¹¶è¡ŒåŠ æ³•ï¼‰ éœ€è°ƒç”¨ç‰¹å®š intrinsicsï¼ˆå¦‚Â _mm_add_epi32ï¼‰ ä¸€è¡Œä»£ç å®ç°å¹¶è¡Œè¿ç®—ï¼Œæ— éœ€è®°å¤æ‚æŒ‡ä»¤å äºŒã€æ ¸å¿ƒç±»å‹ï¼šC# SIMD çš„ä¸¤å¤§ä¸»åŠ›C# SIMD æä¾›ä¸¤ç±»æ ¸å¿ƒç±»å‹ï¼Œè¦†ç›– â€œåŠ¨æ€é•¿åº¦å‘é‡â€ å’Œ â€œå›ºå®šé•¿åº¦å‘é‡â€ åœºæ™¯ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œå¯„å­˜å™¨ï¼š 1. Vectorï¼šåŠ¨æ€é•¿åº¦å‘é‡ï¼ˆæ¨èä¼˜å…ˆä½¿ç”¨ï¼‰ æ ¸å¿ƒç‰¹æ€§ï¼šå‘é‡é•¿åº¦ç”± CPU å‘é‡å¯„å­˜å™¨å®½åº¦å†³å®šï¼ˆå¦‚ 128 ä½ SSE å¯„å­˜å™¨ä¸‹ï¼ŒVectorintÂ é•¿åº¦ä¸º 4ï¼ŒVectorfloatÂ é•¿åº¦ä¸º 4ï¼›256 ä½ AVX å¯„å­˜å™¨ä¸‹ï¼Œé•¿åº¦ä¸º 8ï¼‰ï¼› ä¼˜åŠ¿ï¼šæœ€å¤§åŒ–åˆ©ç”¨ CPU ç¡¬ä»¶èƒ½åŠ›ï¼Œæ— éœ€ä¿®æ”¹ä»£ç å³å¯é€‚é…ä¸åŒæ¶æ„ï¼ˆå¦‚ä» AVX å‡çº§åˆ° AVX-512 æ—¶ï¼Œå‘é‡é•¿åº¦è‡ªåŠ¨ç¿»å€ï¼‰ï¼› çº¦æŸï¼šTÂ å¿…é¡»æ˜¯ blittable ç±»å‹ï¼ˆåŸºå…ƒç±»å‹ã€æ— å¼•ç”¨æˆå‘˜çš„ç»“æ„ä½“ï¼‰ã€‚ ç¤ºä¾‹ï¼šVector å®ç°æ•°ç»„å¹¶è¡Œç¿»å€csharp è¿è¡Œ using System.Numerics;void SimdArrayDouble(int[] input, int[] output) // ç¡®ä¿è¾“å…¥è¾“å‡ºæ•°ç»„é•¿åº¦ä¸€è‡´ if (input.Length != output.Length) throw new ArgumentException(); int vectorLength = Vectorint.Count; // åŠ¨æ€è·å–å‘é‡é•¿åº¦ï¼ˆå¦‚ AVX ä¸‹ä¸º 8ï¼‰ int i = 0; // SIMD å¹¶è¡Œå¤„ç†ï¼šä¸€æ¬¡å¤„ç† vectorLength ä¸ªå…ƒç´  for (; i = input.Length - vectorLength; i += vectorLength) Vectorint vInput = new Vectorint(input, i); // ä»æ•°ç»„åç§» i å¤„åŠ è½½ vectorLength ä¸ªå…ƒç´  Vectorint vOutput = vInput * 2; // å¹¶è¡Œç¿»å€ï¼ˆä¸€æ¬¡æŒ‡ä»¤å¤„ç† 8 ä¸ª intï¼‰ vOutput.CopyTo(output, i); // å°†ç»“æœå†™å›è¾“å‡ºæ•°ç»„ // å¤„ç†å‰©ä½™å…ƒç´ ï¼ˆä¸è¶³ä¸€ä¸ªå‘é‡é•¿åº¦çš„éƒ¨åˆ†ï¼Œä¸²è¡Œå¤„ç†ï¼‰ for (; i input.Length; i++) output[i] = input[i] * 2; // è°ƒç”¨int[] input = Enumerable.Range(1, 1000).ToArray();int[] output = new int[input.Length];SimdArrayDouble(input, output);Console.WriteLine(string.Join(, , output.Take(10))); // è¾“å‡ºï¼š2, 4, 6, 8, 10, 12, 14, 16, 18, 20 C++ å¯¹æ¯”ï¼šAVX intrinsics å®ç°æ•°ç»„ç¿»å€C++ éœ€æ‰‹åŠ¨è°ƒç”¨ AVX æŒ‡ä»¤ï¼ˆ_mm256_loadu_si256_mm256_mullo_epi32_mm256_storeu_si256ï¼‰ï¼Œä¸”éœ€å¤„ç†å¯„å­˜å™¨é•¿åº¦ã€å†…å­˜å¯¹é½ï¼š cpp è¿è¡Œ #include immintrin.h#include vectorvoid SimdArrayDouble(const std::vectorint input, std::vectorint output) if (input.size() != output.size()) throw std::invalid_argument(); const int vectorLength = 8; // AVX 256 ä½å¯„å­˜å™¨ï¼Œæ¯ä¸ª int 4 å­—èŠ‚ â†’ 8 ä¸ªå…ƒç´  size_t i = 0; // SIMD å¹¶è¡Œå¤„ç† for (; i = input.size() - vectorLength; i += vectorLength) // åŠ è½½ 8 ä¸ª int åˆ° AVX å¯„å­˜å™¨ï¼ˆ_mm256_loadu_si256 æ”¯æŒéå¯¹é½å†…å­˜ï¼‰ __m256i vInput = _mm256_loadu_si256((__m256i*)input[i]); // å¹¶è¡Œç¿»å€ï¼ˆ8 ä¸ª int åŒæ—¶ Ã—2ï¼‰ __m256i vOutput = _mm256_mullo_epi32(vInput, _mm256_set1_epi32(2)); // ç»“æœå†™å›æ•°ç»„ _mm256_storeu_si256((__m256i*)output[i], vOutput); // å¤„ç†å‰©ä½™å…ƒç´  for (; i input.size(); i++) output[i] = input[i] * 2; å¯è§ C# æ— éœ€å…³æ³¨Â __m256iÂ ç­‰å¯„å­˜å™¨ç±»å‹å’ŒæŒ‡ä»¤åï¼ŒVectorTÂ è‡ªåŠ¨å°è£…æ‰€æœ‰ç»†èŠ‚ã€‚ 2. å›ºå®šé•¿åº¦å‘é‡ç±»å‹ï¼ˆVector2Vector3Vector4 ç­‰ï¼‰ æ ¸å¿ƒç‰¹æ€§ï¼šé•¿åº¦å›ºå®šï¼ˆå¦‚Â Vector2Â å« 2 ä¸ªÂ floatï¼ŒVector4Â å« 4 ä¸ªÂ floatï¼‰ï¼Œé€‚åˆå›¾å½¢å­¦ã€çº¿æ€§ä»£æ•°ç­‰åœºæ™¯ï¼ˆå¦‚ 2D3D åæ ‡ã€é¢œè‰² RGBAï¼‰ï¼› ä¼˜åŠ¿ï¼šAPI ç›´è§‚ï¼ˆæ”¯æŒÂ +-*/Â è¿ç®—ç¬¦é‡è½½ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†å‘é‡é•¿åº¦ï¼› é€‚ç”¨åœºæ™¯ï¼š3D æ¸²æŸ“ã€ç‰©ç†å¼•æ“ã€ä¿¡å·å¤„ç†ï¼ˆå¦‚éŸ³é¢‘é‡‡æ ·ï¼‰ã€‚ ç¤ºä¾‹ï¼šVector3 å®ç° 3D å‘é‡è¿ç®—ï¼ˆç‚¹ç§¯ å‰ç§¯ï¼‰csharp è¿è¡Œ using System.Numerics;// 3D å‘é‡å®šä¹‰ï¼ˆx,y,zï¼‰Vector3 v1 = new Vector3(1.0f, 2.0f, 3.0f);Vector3 v2 = new Vector3(4.0f, 5.0f, 6.0f);// å¹¶è¡ŒåŠ æ³•ï¼ˆx1+x2, y1+y2, z1+z2 åŒæ—¶è®¡ç®—ï¼‰Vector3 sum = v1 + v2; // ç»“æœï¼š(5.0f, 7.0f, 9.0f)// å¹¶è¡Œä¹˜æ³•ï¼ˆæ ‡é‡ä¹˜æ³•ï¼Œx*2, y*2, z*2 åŒæ—¶è®¡ç®—ï¼‰Vector3 scaled = v1 * 2.0f; // ç»“æœï¼š(2.0f, 4.0f, 6.0f)// ç‚¹ç§¯ï¼ˆx1*x2 + y1*y2 + z1*z2ï¼ŒSIMD å¹¶è¡Œè®¡ç®—åæ±‚å’Œï¼‰float dotProduct = Vector3.Dot(v1, v2); // ç»“æœï¼š1*4 + 2*5 + 3*6 = 32.0f// å‰ç§¯ï¼ˆ3D å‘é‡å‚ç›´å‘é‡ï¼ŒSIMD å¹¶è¡Œè®¡ç®—ï¼‰Vector3 crossProduct = Vector3.Cross(v1, v2); // ç»“æœï¼š(2*6-3*5, 3*4-1*6, 1*5-2*4) = (-3.0f, 6.0f, -3.0f)Console.WriteLine($Sum: sum); // è¾“å‡ºï¼šSum: (5, 7, 9)Console.WriteLine($Dot Product: dotProduct); // è¾“å‡ºï¼š32 C++ å¯¹æ¯”ï¼šGLM åº“å®ç°å‘é‡è¿ç®—ï¼ˆC++ å¸¸ç”¨æ–¹æ¡ˆï¼‰C++ é€šå¸¸ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ GLMï¼‰å®ç°å›ºå®šé•¿åº¦å‘é‡è¿ç®—ï¼Œå¦åˆ™éœ€æ‰‹åŠ¨è°ƒç”¨ intrinsicsï¼š cpp è¿è¡Œ #include glm/glm.hpp#include iostreamint main() glm::vec3 v1(1.0f, 2.0f, 3.0f); glm::vec3 v2(4.0f, 5.0f, 6.0f); glm::vec3 sum = v1 + v2; glm::vec3 scaled = v1 * 2.0f; float dotProduct = glm::dot(v1, v2); glm::vec3 crossProduct = glm::cross(v1, v2); std::cout Sum: ( sum.x , sum.y , sum.z ) std::endl; return 0; C# æ— éœ€ä¾èµ–ç¬¬ä¸‰æ–¹åº“ï¼ŒSystem.NumericsÂ å†…ç½®å›ºå®šé•¿åº¦å‘é‡ç±»å‹ï¼Œä¸” API ä¸ GLM é«˜åº¦ä¸€è‡´ã€‚ ä¸‰ã€æ ¸å¿ƒç‰¹æ€§ï¼šC# SIMD çš„ä¼˜åŠ¿ä¸èƒ½åŠ›è¾¹ç•Œ1. è‡ªåŠ¨å‘é‡åŒ–ä¸ç¡¬ä»¶é€‚é… C# SIMD ä¼šæ ¹æ®è¿è¡Œæ—¶ CPU æ”¯æŒçš„æŒ‡ä»¤é›†ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜å‘é‡é•¿åº¦ï¼ˆå¦‚åœ¨ AVX-512 CPU ä¸Šï¼ŒVectorintÂ é•¿åº¦ä¸º 16ï¼‰ï¼› æ— éœ€æ‰‹åŠ¨ç¼–å†™å¤šæŒ‡ä»¤é›†åˆ†æ”¯ä»£ç ï¼ˆå¦‚ C++ ä¸­éœ€ç”¨Â #ifdef __AVX2__Â åŒºåˆ† SSEAVXï¼‰ï¼Œä»£ç ä¸€æ¬¡ç¼–å†™ï¼Œè·¨å¹³å°è‡ªåŠ¨é€‚é…ã€‚ ç¤ºä¾‹ï¼šæ£€æµ‹ CPU å‘é‡æ”¯æŒcsharp è¿è¡Œ // æ£€æµ‹å½“å‰ CPU æ”¯æŒçš„ SIMD æŒ‡ä»¤é›†Console.WriteLine($æ”¯æŒ SSE2: Vector.IsHardwareAccelerated); // æ‰€æœ‰ç°ä»£ CPU å‡æ”¯æŒï¼Œè¿”å› trueConsole.WriteLine($Vectorint é•¿åº¦: Vectorint.Count); // AVX ä¸‹è¾“å‡º 8ï¼ŒAVX-512 ä¸‹è¾“å‡º 16Console.WriteLine($Vectorfloat é•¿åº¦: Vectorfloat.Count); // AVX ä¸‹è¾“å‡º 8ï¼ŒAVX-512 ä¸‹è¾“å‡º 16 2. å®Œæ•´çš„ç®—æœ¯ é€»è¾‘è¿ç®—æ”¯æŒVectorTÂ å’Œå›ºå®šé•¿åº¦å‘é‡ç±»å‹æ”¯æŒæ‰€æœ‰åŸºç¡€è¿ç®—ï¼Œä¸”å‡ä¸º SIMD å¹¶è¡Œæ‰§è¡Œï¼š ç®—æœ¯è¿ç®—ï¼š+ã€-ã€*ã€/ã€%ã€++ã€--ï¼› é€»è¾‘è¿ç®—ï¼šã€|ã€^ã€~ï¼› æ¯”è¾ƒè¿ç®—ï¼š==ã€!=ã€ã€ã€=ã€=ï¼ˆè¿”å›æ©ç å‘é‡ï¼‰ï¼› æ•°å­¦å‡½æ•°ï¼šMathF.Sinï¼ˆéœ€ .NET 6+ï¼ŒSIMD å¹¶è¡Œè®¡ç®—å¤šä¸ªæ­£å¼¦å€¼ï¼‰ã€Vector.Dotï¼ˆç‚¹ç§¯ï¼‰ã€Vector.Crossï¼ˆå‰ç§¯ï¼‰ã€‚ ç¤ºä¾‹ï¼šSIMD å¹¶è¡Œæ¯”è¾ƒä¸æ©ç æ“ä½œcsharp è¿è¡Œ int[] arr1 = 1, 3, 5, 7, 9, 11, 13, 15 ;int[] arr2 = 2, 3, 4, 7, 8, 11, 12, 16 ;bool[] result = new bool[arr1.Length];Vectorint v1 = new Vectorint(arr1);Vectorint v2 = new Vectorint(arr2);// SIMD å¹¶è¡Œæ¯”è¾ƒï¼šæ¯ä¸ªå…ƒç´ é€ä¸€æ¯”è¾ƒï¼Œè¿”å›æ©ç å‘é‡ï¼ˆç›¸ç­‰ä¸ºå…¨1ï¼Œå¦åˆ™ä¸º0ï¼‰Vectorint equalMask = Vector.Equals(v1, v2); // ç»“æœï¼š(0, -1, 0, -1, 0, -1, 0, 0)ï¼ˆint å…¨1 ä¸º -1ï¼‰// æ©ç å‘é‡è½¬æ¢ä¸º bool æ•°ç»„for (int i = 0; i Vectorint.Count; i++) result[i] = equalMask[i] != 0;Console.WriteLine(string.Join(, , result)); // è¾“å‡ºï¼šFalse, True, False, True, False, True, False, False 3. ç±»å‹å®‰å…¨ä¸å†…å­˜å®‰å…¨ C# SIMD ç¦æ­¢è£¸æŒ‡é’ˆæ“ä½œï¼Œæ‰€æœ‰å‘é‡åŠ è½½ å­˜å‚¨å‡é€šè¿‡Â new VectorT(array, offset)Â å’ŒÂ CopyTo(array, offset)Â å®Œæˆï¼Œè‡ªåŠ¨æ£€æŸ¥æ•°ç»„è¾¹ç•Œï¼› é¿å… C++ ä¸­å› æŒ‡é’ˆè¶Šç•Œã€ç±»å‹ä¸åŒ¹é…å¯¼è‡´çš„æœªå®šä¹‰è¡Œä¸ºï¼ˆå¦‚å°†Â floatÂ æ•°æ®åŠ è½½åˆ°Â intÂ å‘é‡å¯„å­˜å™¨ï¼‰ã€‚ 4. èƒ½åŠ›è¾¹ç•Œï¼šä¸æ”¯æŒçš„åœºæ™¯ é blittable ç±»å‹ï¼šVectorTÂ ä¸æ”¯æŒå¼•ç”¨ç±»å‹ï¼ˆå¦‚Â stringï¼‰ã€å«å¼•ç”¨æˆå‘˜çš„ç»“æ„ä½“ï¼› å¤æ‚æ•°å­¦å‡½æ•°ï¼šéƒ¨åˆ†é«˜çº§å‡½æ•°ï¼ˆå¦‚Â tanã€logï¼‰æ—  SIMD åŠ é€Ÿï¼ˆ.NET 6+ æ‰©å±•äº†éƒ¨åˆ†å‡½æ•°ï¼Œéœ€æ‰‹åŠ¨ç¡®è®¤ï¼‰ï¼› è‡ªå®šä¹‰æŒ‡ä»¤ï¼šæ— æ³•ç›´æ¥è°ƒç”¨ç‰¹å®šç¡¬ä»¶æŒ‡ä»¤ï¼ˆå¦‚ AVX-512 çš„Â VPERMÂ ç½®æ¢æŒ‡ä»¤ï¼‰ï¼Œéœ€é€šè¿‡Â System.Runtime.IntrinsicsÂ å‘½åç©ºé—´ï¼ˆ.NET Core 3.0+ï¼‰å®ç°ï¼ˆç±»ä¼¼ C++ intrinsicsï¼‰ã€‚ å››ã€å®é™…åº”ç”¨åœºæ™¯ï¼ˆC++ ç¨‹åºå‘˜å…±é¸£åœºæ™¯ï¼‰1. æ•°å€¼è®¡ç®—ï¼ˆçŸ©é˜µä¹˜æ³•ã€çº¿æ€§ä»£æ•°ï¼‰åœºæ™¯ï¼šæœºå™¨å­¦ä¹ ã€ç§‘å­¦è®¡ç®—ã€ç‰©ç†å¼•æ“ä¸­ï¼ŒçŸ©é˜µ å‘é‡è¿ç®—å æ¯”æé«˜ï¼ŒSIMD å¯å¤§å¹…æå‡æ€§èƒ½ã€‚ C# ç¤ºä¾‹ï¼šSIMD åŠ é€ŸçŸ©é˜µä¹˜æ³•ï¼ˆ2x2 çŸ©é˜µï¼‰csharp è¿è¡Œ using System.Numerics;// 2x2 çŸ©é˜µä¹˜æ³•ï¼ˆSIMD å¹¶è¡Œè®¡ç®—æ¯ä¸ªå…ƒç´ ï¼‰Matrix4x4 MultiplyMatrix2x2(Matrix4x4 a, Matrix4x4 b) // çŸ©é˜µ a çš„è¡Œå‘é‡ï¼ˆSIMD æ‰“åŒ…ï¼‰ Vector4 aRow0 = new Vector4(a.M11, a.M12, 0, 0); Vector4 aRow1 = new Vector4(a.M21, a.M22, 0, 0); // çŸ©é˜µ b çš„åˆ—å‘é‡ï¼ˆSIMD æ‰“åŒ…ï¼‰ Vector4 bCol0 = new Vector4(b.M11, b.M21, 0, 0); Vector4 bCol1 = new Vector4(b.M12, b.M22, 0, 0); // ç‚¹ç§¯è®¡ç®—ï¼ˆSIMD å¹¶è¡Œï¼‰ float m11 = Vector4.Dot(aRow0, bCol0); float m12 = Vector4.Dot(aRow0, bCol1); float m21 = Vector4.Dot(aRow1, bCol0); float m22 = Vector4.Dot(aRow1, bCol1); return new Matrix4x4( m11, m12, 0, 0, m21, m22, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1 );// è°ƒç”¨Matrix4x4 a = new Matrix4x4(1, 2, 0, 0, 3, 4, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);Matrix4x4 b = new Matrix4x4(5, 6, 0, 0, 7, 8, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);Matrix4x4 result = MultiplyMatrix2x2(a, b);Console.WriteLine($Result: result.M11, result.M12 result.M21, result.M22);// è¾“å‡ºï¼š// 19, 22// 43, 50 C++ å¯¹æ¯”ï¼šAVX intrinsics çŸ©é˜µä¹˜æ³•C++ éœ€æ‰‹åŠ¨æ‰“åŒ…å‘é‡ã€è°ƒç”¨ç‚¹ç§¯æŒ‡ä»¤ï¼Œä»£ç ç¹çï¼š cpp è¿è¡Œ #include immintrin.h__m256 MultiplyMatrix2x2(__m256 a, __m256 b) __m256 aRow0 = _mm256_setr_ps(a[0], a[1], 0, 0, 0, 0, 0, 0); __m256 bCol0 = _mm256_setr_ps(b[0], b[4], 0, 0, 0, 0, 0, 0); float m11 = _mm256_dot_ps(aRow0, bCol0).m256_f32[0]; // å…¶ä½™å…ƒç´ ç±»ä¼¼... return _mm256_setr_ps(m11, m12, 0, 0, m21, m22, 0, 0); 2. å›¾åƒå¤„ç†ï¼ˆåƒç´ æ‰¹é‡æ“ä½œï¼‰åœºæ™¯ï¼šå›¾åƒæ»¤æ³¢ã€äº®åº¦è°ƒæ•´ã€æ ¼å¼è½¬æ¢ï¼ˆå¦‚ RGB è½¬ç°åº¦å›¾ï¼‰ï¼Œéœ€éå†æ¯ä¸ªåƒç´ ï¼ŒSIMD å¯å¹¶è¡Œå¤„ç†å¤šä¸ªåƒç´ ã€‚ C# ç¤ºä¾‹ï¼šSIMD åŠ é€Ÿ RGB è½¬ç°åº¦å›¾csharp è¿è¡Œ using System.Numerics;// RGB è½¬ç°åº¦å›¾ï¼ˆå…¬å¼ï¼šç°åº¦ = R*0.299 + G*0.587 + B*0.114ï¼‰void RgbToGrayscale(byte[] rgbData, byte[] grayData, int width, int height) // æ¯ä¸ªåƒç´  3 å­—èŠ‚ï¼ˆRã€Gã€Bï¼‰ï¼Œæ€»åƒç´ æ•° = width * height int pixelCount = width * height; int vectorLength = Vectorfloat.Count; int i = 0; // SIMD å¹¶è¡Œå¤„ç†ï¼šä¸€æ¬¡å¤„ç† vectorLength ä¸ªåƒç´ ï¼ˆæ¯ä¸ªåƒç´  3 å­—èŠ‚ â†’ 3*vectorLength å­—èŠ‚ï¼‰ for (; i = pixelCount - vectorLength; i += vectorLength) // åŠ è½½ vectorLength ä¸ª Rã€Gã€B é€šé“ï¼ˆåˆ†åˆ«æ‰“åŒ…ä¸º 3 ä¸ªå‘é‡ï¼‰ Vectorfloat r = new Vectorfloat(rgbData, i * 3); Vectorfloat g = new Vectorfloat(rgbData, i * 3 + vectorLength); Vectorfloat b = new Vectorfloat(rgbData, i * 3 + 2 * vectorLength); // å¹¶è¡Œè®¡ç®—ç°åº¦å€¼ï¼ˆSIMD ä¹˜æ³•+åŠ æ³•ï¼‰ Vectorfloat gray = r * 0.299f + g * 0.587f + b * 0.114f; // è½¬æ¢ä¸º byte å¹¶å†™å›ç»“æœæ•°ç»„ for (int j = 0; j vectorLength; j++) grayData[i + j] = (byte)Math.Clamp(gray[j], 0, 255); // å¤„ç†å‰©ä½™åƒç´ ï¼ˆä¸²è¡Œï¼‰ for (; i pixelCount; i++) byte r = rgbData[i * 3]; byte g = rgbData[i * 3 + 1]; byte b = rgbData[i * 3 + 2]; grayData[i] = (byte)(r * 0.299f + g * 0.587f + b * 0.114f); 3. ä¿¡å·å¤„ç†ï¼ˆéŸ³é¢‘ ä¼ æ„Ÿå™¨æ•°æ®æ»¤æ³¢ï¼‰åœºæ™¯ï¼šéŸ³é¢‘é™å™ªã€ä¼ æ„Ÿå™¨æ•°æ®å¹³æ»‘ï¼ˆå¦‚ç§»åŠ¨å¹³å‡æ»¤æ³¢ï¼‰ï¼Œéœ€å¯¹æ‰¹é‡é‡‡æ ·æ•°æ®æ‰§è¡Œç®—æœ¯è¿ç®—ã€‚ C# ç¤ºä¾‹ï¼šSIMD åŠ é€Ÿç§»åŠ¨å¹³å‡æ»¤æ³¢csharp è¿è¡Œ using System.Numerics;// ç§»åŠ¨å¹³å‡æ»¤æ³¢ï¼ˆçª—å£å¤§å° = 3ï¼‰void MovingAverageFilter(float[] input, float[] output) if (input.Length != output.Length || input.Length 3) return; int vectorLength = Vectorfloat.Count; int i = 1; // SIMD å¹¶è¡Œå¤„ç†ï¼šä¸€æ¬¡è®¡ç®— vectorLength ä¸ªæ»¤æ³¢ç»“æœ for (; i = input.Length - vectorLength - 1; i += vectorLength) // åŠ è½½å½“å‰çª—å£çš„ 3 ç»„æ•°æ®ï¼ˆinput[i-1], input[i], input[i+1]ï¼‰ Vectorfloat prev = new Vectorfloat(input, i - 1); Vectorfloat curr = new Vectorfloat(input, i); Vectorfloat next = new Vectorfloat(input, i + 1); // å¹¶è¡Œè®¡ç®—å¹³å‡å€¼ï¼ˆ(prev + curr + next) / 3ï¼‰ Vectorfloat avg = (prev + curr + next) / 3.0f; avg.CopyTo(output, i); // å¤„ç†é¦–å°¾å’Œå‰©ä½™å…ƒç´ ï¼ˆä¸²è¡Œï¼‰ output[0] = input[0]; for (; i input.Length - 1; i++) output[i] = (input[i - 1] + input[i] + input[i + 1]) / 3.0f; output[input.Length - 1] = input[input.Length - 1]; 4. æ•°æ®åŠ å¯†ï¼ˆæ‰¹é‡å¼‚æˆ–è¿ç®—ï¼‰åœºæ™¯ï¼šç®€å•åŠ å¯† è§£å¯†ã€æ•°æ®æ ¡éªŒï¼ˆå¦‚ CRC32ï¼‰ï¼Œéœ€å¯¹æ‰¹é‡å­—èŠ‚æ‰§è¡Œå¼‚æˆ–è¿ç®—ï¼ŒSIMD å¯å¹¶è¡Œå¤„ç†å¤šä¸ªå­—èŠ‚ã€‚ C# ç¤ºä¾‹ï¼šSIMD åŠ é€Ÿæ‰¹é‡å¼‚æˆ–åŠ å¯†csharp è¿è¡Œ using System.Numerics;// æ‰¹é‡å¼‚æˆ–åŠ å¯†ï¼ˆkey ä¸ºåŠ å¯†å¯†é’¥ï¼Œé•¿åº¦ä¸ Vectorbyte.Count ä¸€è‡´ï¼‰void SimdXorEncrypt(byte[] data, byte[] key) if (key.Length != Vectorbyte.Count) throw new ArgumentException(å¯†é’¥é•¿åº¦å¿…é¡»ä¸å‘é‡é•¿åº¦ä¸€è‡´); int vectorLength = Vectorbyte.Count; int i = 0; // SIMD å¹¶è¡Œå¼‚æˆ–ï¼šä¸€æ¬¡å¤„ç† vectorLength ä¸ªå­—èŠ‚ for (; i = data.Length - vectorLength; i += vectorLength) Vectorbyte vData = new Vectorbyte(data, i); Vectorbyte vKey = new Vectorbyte(key); Vectorbyte vEncrypted = vData ^ vKey; // å¹¶è¡Œå¼‚æˆ– vEncrypted.CopyTo(data, i); // å¤„ç†å‰©ä½™å­—èŠ‚ï¼ˆä¸²è¡Œï¼‰ for (; i data.Length; i++) data[i] ^= key[i % key.Length]; // è°ƒç”¨byte[] data = System.Text.Encoding.UTF8.GetBytes(Hello, SIMD XOR Encrypt!);byte[] key = new byte[Vectorbyte.Count];Random.Shared.NextBytes(key); // ç”Ÿæˆéšæœºå¯†é’¥SimdXorEncrypt(data, key);Console.WriteLine(åŠ å¯†åï¼š + Convert.ToBase64String(data));// è§£å¯†ï¼ˆå¼‚æˆ–ä¸¤æ¬¡å³å¯ï¼‰SimdXorEncrypt(data, key);Console.WriteLine(è§£å¯†åï¼š + System.Text.Encoding.UTF8.GetString(data)); äº”ã€å¸¸è§è¯¯åŒºä¸é¿å‘æŒ‡å—1. è¯¯åŒº 1ï¼šSIMD ä¸€å®šæ¯”ä¸²è¡Œå¿« é”™è¯¯è®¤çŸ¥ï¼šä»»ä½•åœºæ™¯ä¸‹ SIMD éƒ½èƒ½æå‡æ€§èƒ½ï¼› æ­£ç¡®é€»è¾‘ï¼š å°æ•°æ®é‡åœºæ™¯ï¼šSIMD æœ‰åˆå§‹åŒ– æ‰“åŒ… å­˜å‚¨çš„å›ºå®šå¼€é”€ï¼Œå¯èƒ½æ¯”ä¸²è¡Œæ…¢ï¼ˆå¦‚æ•°ç»„é•¿åº¦ 32ï¼‰ï¼› éè¿ç»­å†…å­˜ï¼šè‹¥æ•°æ®ä¸è¿ç»­ï¼ˆå¦‚é“¾è¡¨ï¼‰ï¼Œéœ€é¢‘ç¹åŠ è½½æ•°æ®ï¼ŒSIMD ä¼˜åŠ¿æ¶ˆå¤±ï¼› ä¼˜åŒ–å»ºè®®ï¼šä»…å¯¹ â€œå¤§æ•°æ®é‡ + è¿ç»­å†…å­˜ + ç®€å•è¿ç®—â€ åœºæ™¯ä½¿ç”¨ SIMDï¼ˆå¦‚æ•°ç»„é•¿åº¦ â‰¥ 1024ï¼‰ã€‚ 2. è¯¯åŒº 2ï¼šVector.Count æ˜¯å›ºå®šå€¼ é”™è¯¯è®¤çŸ¥ï¼šVectorint.CountÂ æ°¸è¿œæ˜¯ 4ï¼ˆSSE å¯„å­˜å™¨ï¼‰ï¼› æ­£ç¡®é€»è¾‘ï¼šVectorT.CountÂ ç”± CPU å‘é‡å¯„å­˜å™¨å®½åº¦å†³å®šï¼ˆå¦‚ AVX ä¸‹ä¸º 8ï¼ŒAVX-512 ä¸‹ä¸º 16ï¼‰ï¼Œéœ€åœ¨è¿è¡Œæ—¶åŠ¨æ€è·å–ï¼Œä¸å¯ç¡¬ç¼–ç ã€‚ 3. è¯¯åŒº 3ï¼šå¿½ç•¥å†…å­˜å¯¹é½ é”™è¯¯è®¤çŸ¥ï¼šVectorTÂ åŠ è½½ å­˜å‚¨æ— éœ€å…³æ³¨å†…å­˜å¯¹é½ï¼› æ­£ç¡®é€»è¾‘ï¼š æ•°ç»„åœ¨ C# ä¸­é»˜è®¤æ˜¯å†…å­˜å¯¹é½çš„ï¼ˆå¦‚Â new int[8]Â å¯¹é½åˆ° 16 å­—èŠ‚ï¼‰ï¼Œä½†æ‰‹åŠ¨åˆ†é…éå¯¹é½å†…å­˜ï¼ˆå¦‚Â Marshal.AllocHGlobalï¼‰ä¼šå¯¼è‡´ SIMD æ€§èƒ½ä¸‹é™ï¼ˆCPU éœ€é¢å¤–å¤„ç†å¯¹é½ï¼‰ï¼› ä¼˜åŒ–å»ºè®®ï¼šç”¨Â System.Buffers.ArrayPoolTÂ åˆ†é…å¯¹é½å†…å­˜ï¼Œé¿å…æ‰‹åŠ¨åˆ†é…éå¯¹é½å†…å­˜ã€‚ 4. è¯¯åŒº 4ï¼šå¿˜è®°å¤„ç†å‰©ä½™å…ƒç´  é”™è¯¯ç”¨æ³•ï¼šä»…ç”¨ SIMD å¾ªç¯å¤„ç†ï¼Œæœªå¤„ç† â€œæ•°ç»„é•¿åº¦ä¸æ˜¯å‘é‡é•¿åº¦å€æ•°â€ çš„å‰©ä½™å…ƒç´ ï¼› åæœï¼šæ•°ç»„å°¾éƒ¨å…ƒç´ æœªè¢«å¤„ç†ï¼Œå¯¼è‡´æ•°æ®é”™è¯¯ï¼› æ­£ç¡®åšæ³•ï¼šSIMD å¾ªç¯åæ·»åŠ ä¸²è¡Œå¾ªç¯ï¼Œå¤„ç†å‰©ä½™å…ƒç´ ï¼ˆå¦‚ç¤ºä¾‹ä¸­Â iÂ ä» SIMD å¾ªç¯ç»“æŸä½ç½®ç»§ç»­éå†ï¼‰ã€‚ 5. è¯¯åŒº 5ï¼šæ··ç”¨ä¸åŒç±»å‹çš„å‘é‡è¿ç®— é”™è¯¯ç”¨æ³•ï¼šå°†Â floatÂ æ•°æ®åŠ è½½åˆ°Â intÂ å‘é‡ï¼Œæˆ–æ‰§è¡Œä¸å…¼å®¹çš„è¿ç®—ï¼ˆå¦‚Â Vectorint + Vectorfloatï¼‰ï¼› åæœï¼šç¼–è¯‘æŠ¥é”™æˆ–è¿è¡Œæ—¶ç±»å‹è½¬æ¢å¼€é”€ï¼ŒæŠµæ¶ˆ SIMD ä¼˜åŠ¿ï¼› æ­£ç¡®åšæ³•ï¼šç¡®ä¿å‘é‡ç±»å‹ä¸æ•°æ®ç±»å‹ä¸€è‡´ï¼Œé¿å…è·¨ç±»å‹è¿ç®—ã€‚ 6. è¯¯åŒº 6ï¼šè¿‡åº¦ä¾èµ– SIMDï¼Œå¿½ç•¥å…¶ä»–ä¼˜åŒ– é”™è¯¯è®¤çŸ¥ï¼šåªè¦ç”¨äº† SIMDï¼Œæ€§èƒ½å°±åˆ°é¡¶äº†ï¼› æ­£ç¡®é€»è¾‘ï¼šSIMD éœ€é…åˆå…¶ä»–ä¼˜åŒ–ï¼ˆå¦‚å†…å­˜é¢„å–ã€å¤šçº¿ç¨‹å¹¶è¡Œã€å¾ªç¯å±•å¼€ï¼‰ï¼Œæ‰èƒ½æœ€å¤§åŒ–æ€§èƒ½ï¼š csharp è¿è¡Œ // é…åˆå¤šçº¿ç¨‹ï¼ˆParallel.Forï¼‰+ SIMDï¼Œè¿›ä¸€æ­¥æå‡æ€§èƒ½Parallel.For(0, input.Length / vectorLength, i = int offset = i * vectorLength; Vectorint vInput = new Vectorint(input, offset); Vectorint vOutput = vInput * 2; vOutput.CopyTo(output, offset);); å…­ã€ä¸ C++ SIMD çš„æ ¸å¿ƒå·®å¼‚æ€»ç»“ ç‰¹æ€§ C# SIMD C++ SIMDï¼ˆintrinsicsstd::simdï¼‰ æ ¸å¿ƒä¼˜åŠ¿ï¼ˆC#ï¼‰ æ ¸å¿ƒä¼˜åŠ¿ï¼ˆC++ï¼‰ å¼€å‘é—¨æ§› ä½ï¼ˆAPI ç®€æ´ï¼Œæ— éœ€ç¡¬ä»¶çŸ¥è¯†ï¼‰ é«˜ï¼ˆéœ€è®°æŒ‡ä»¤åã€å¤„ç†å¯„å­˜å™¨ å¯¹é½ï¼‰ å¿«é€Ÿä¸Šæ‰‹ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘ æè‡´çµæ´»ï¼Œå¯å®šåˆ¶åº•å±‚æŒ‡ä»¤ ç¡¬ä»¶é€‚é… è‡ªåŠ¨é€‚é…ï¼ˆè¿è¡Œæ—¶æ£€æµ‹æŒ‡ä»¤é›†ï¼‰ æ‰‹åŠ¨é€‚é…ï¼ˆç¼–è¯‘æ—¶åˆ†æ”¯ æŒ‡ä»¤é›†å®ï¼‰ è·¨å¹³å°æ— éœ€ä¿®æ”¹ä»£ç  å¯é’ˆå¯¹ç‰¹å®š CPU ä¼˜åŒ–ï¼Œæ€§èƒ½æé™æ›´é«˜ ç±»å‹å®‰å…¨ å¼ºç±»å‹æ£€æŸ¥ï¼Œæ— è£¸æŒ‡é’ˆ å¼±ç±»å‹ï¼ˆintrinsics ä¾èµ–æŒ‡é’ˆï¼‰ é¿å…å†…å­˜è¶Šç•Œ ç±»å‹é”™è¯¯ å¯ç›´æ¥æ“ä½œå†…å­˜ï¼Œé€‚é…ç‰¹æ®Šåœºæ™¯ æ€§èƒ½å¼€é”€ è½»å¾®ï¼ˆè‡ªåŠ¨æ‰“åŒ… å­˜å‚¨ï¼‰ æå°ï¼ˆæ‰‹åŠ¨æ§åˆ¶æŒ‡ä»¤ï¼Œæ— é¢å¤–å¼€é”€ï¼‰ å¤šæ•°åœºæ™¯æ€§èƒ½æ¥è¿‘ C++ï¼Œå¼€å‘æ•ˆç‡æ›´é«˜ æè‡´æ€§èƒ½ï¼Œé€‚åˆè¶…ç®— å®æ—¶ç³»ç»Ÿ é«˜çº§åŠŸèƒ½æ”¯æŒ æœ‰é™ï¼ˆæ— è‡ªå®šä¹‰æŒ‡ä»¤ï¼‰ å…¨é¢ï¼ˆæ”¯æŒæ‰€æœ‰ç¡¬ä»¶æŒ‡ä»¤ï¼‰ æ»¡è¶³ç»å¤§å¤šæ•°åœºæ™¯éœ€æ±‚ å¯è°ƒç”¨ç‰¹æ®ŠæŒ‡ä»¤ï¼ˆå¦‚ AVX-512 é«˜çº§åŠŸèƒ½ï¼‰ ä¸ƒã€æœ€ä½³å®è·µï¼ˆé¢å‘ C++ ç¨‹åºå‘˜çš„è¿ç§»å»ºè®®ï¼‰ ä¼˜å…ˆä½¿ç”¨ Vector è€Œéå›ºå®šé•¿åº¦å‘é‡ï¼šåŠ¨æ€é•¿åº¦å‘é‡èƒ½æœ€å¤§åŒ–åˆ©ç”¨ CPU ç¡¬ä»¶ï¼Œæ— éœ€é€‚é…ä¸åŒæŒ‡ä»¤é›†ï¼› ç¡®ä¿æ•°æ®è¿ç»­ä¸”å¯¹é½ï¼šä½¿ç”¨æ•°ç»„ï¼ˆè€Œéé“¾è¡¨ï¼‰å­˜å‚¨æ•°æ®ï¼Œé¿å…æ‰‹åŠ¨åˆ†é…éå¯¹é½å†…å­˜ï¼› å¤„ç†å‰©ä½™å…ƒç´ ï¼šSIMD å¾ªç¯åå¿…é¡»ä¸²è¡Œå¤„ç†ä¸è¶³ä¸€ä¸ªå‘é‡é•¿åº¦çš„å…ƒç´ ï¼› ç»“åˆå¤šçº¿ç¨‹ï¼šSIMD æ˜¯ â€œå•çº¿ç¨‹å¹¶è¡Œâ€ï¼Œé…åˆÂ Parallel.ForÂ æˆ–Â TaskÂ å¤šçº¿ç¨‹ï¼Œå¯è¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼› é¿å…å°æ•°æ®é‡ä½¿ç”¨ï¼šä»…å¯¹å¤§æ•°æ®é‡ï¼ˆæ•°ç»„é•¿åº¦ â‰¥ 1024ï¼‰æˆ–é«˜é¢‘æ‰§è¡Œçš„ä»£ç ä½¿ç”¨ SIMDï¼› ç”¨ System.Runtime.Intrinsics å®ç°é«˜çº§éœ€æ±‚ï¼šè‹¥éœ€è°ƒç”¨ç‰¹å®šç¡¬ä»¶æŒ‡ä»¤ï¼ˆå¦‚ AVX-512ï¼‰ï¼Œå¯ä½¿ç”¨ .NET Core 3.0+ æä¾›çš„Â System.Runtime.Intrinsics.X86Â å‘½åç©ºé—´ï¼ˆç±»ä¼¼ C++ intrinsicsï¼‰ï¼› æ€§èƒ½æµ‹è¯•éªŒè¯ï¼šä½¿ç”¨Â BenchmarkDotNetÂ å¯¹æ¯” SIMD ä¸ä¸²è¡Œä»£ç çš„æ€§èƒ½ï¼Œé¿å…ç›²ç›®ä½¿ç”¨ã€‚ æ€»ç»“å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼ŒC# SIMD çš„æ ¸å¿ƒä»·å€¼æ˜¯Â â€œä½é—¨æ§›é«˜æ€§èƒ½â€ï¼š å®ƒå±è”½äº†åº•å±‚ç¡¬ä»¶ç»†èŠ‚ï¼ˆå¯„å­˜å™¨ã€æŒ‡ä»¤é›†ã€å†…å­˜å¯¹é½ï¼‰ï¼Œæ— éœ€åƒ C++ é‚£æ ·ç¼–å†™å¤æ‚çš„ intrinsics ä»£ç ï¼Œå°±èƒ½åˆ©ç”¨ SIMD å¹¶è¡Œè®¡ç®—ï¼› æ ¸å¿ƒç±»å‹ï¼ˆVectorTã€Vector234ï¼‰API ç®€æ´ç›´è§‚ï¼Œæ”¯æŒè¿ç®—ç¬¦é‡è½½å’Œå¸¸ç”¨æ•°å­¦å‡½æ•°ï¼Œå¼€å‘æ•ˆç‡è¿œè¶… C++ï¼› æ€§èƒ½æ¥è¿‘ C++ åŸç”Ÿ SIMDï¼Œåœ¨æ•°å€¼è®¡ç®—ã€å›¾åƒå¤„ç†ã€ä¿¡å·å¤„ç†ç­‰åœºæ™¯ä¸­ï¼Œèƒ½å¤§å¹…æå‡ä»£ç è¿è¡Œé€Ÿåº¦ï¼› ç±»å‹å®‰å…¨å’Œè‡ªåŠ¨ç¡¬ä»¶é€‚é…ï¼Œé¿å…äº† C++ ä¸­å¸¸è§çš„å†…å­˜è¶Šç•Œã€æŒ‡ä»¤é›†ä¸å…¼å®¹ç­‰é—®é¢˜ã€‚ C# SIMD ä¸æ˜¯ â€œæ›¿ä»£ C++ SIMDâ€ï¼Œè€Œæ˜¯ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§ â€œæ— éœ€å…³æ³¨åº•å±‚â€ çš„é«˜æ€§èƒ½å¹¶è¡Œæ–¹æ¡ˆ â€”â€” è®©ä½ åœ¨å¿«é€Ÿå¼€å‘çš„åŒæ—¶ï¼Œä¸ç‰ºç‰²æ€§èƒ½ã€‚å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼Œè¿ç§»åˆ° C# SIMD åªéœ€è½¬å˜ â€œæ‰‹åŠ¨æ§åˆ¶åº•å±‚â€ çš„æ€ç»´ï¼Œèšç„¦ä¸šåŠ¡é€»è¾‘å³å¯ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"Roslyn API","path":"/2025/11/26/2-ç¼–ç¨‹è¯­è¨€-CSharp-Roslyn-API/","content":"C# Roslyn APIï¼šç¼–è¯‘å™¨å³æœåŠ¡ï¼ˆé¢å‘ C++ ç¨‹åºå‘˜ï¼‰C# çš„Â Roslyn APIÂ æ˜¯ .NET å¹³å°çš„ â€œç¼–è¯‘å™¨å³æœåŠ¡ï¼ˆCompiler-as-a-Serviceï¼‰â€ æ¡†æ¶ï¼Œæ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯ï¼šå°† C#VB.NETÂ ç¼–è¯‘å™¨çš„æ ¸å¿ƒèƒ½åŠ›ï¼ˆè¯­æ³•è§£æã€è¯­ä¹‰åˆ†æã€ä»£ç ç”Ÿæˆã€é‡æ„ï¼‰æš´éœ²ä¸ºå¯ç¼–ç¨‹ APIï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿç›´æ¥æ“ä½œä»£ç çš„è¯­æ³•ç»“æ„ã€åˆ†æè¯­ä¹‰å«ä¹‰ã€ç”Ÿæˆ ä¿®æ”¹ä»£ç ï¼Œç”šè‡³è‡ªå®šä¹‰ç¼–è¯‘å™¨è¡Œä¸ºã€‚ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼ŒRoslyn API å¯ç±»æ¯”ä¸ºÂ â€œC++ Clang LibTooling + LibASTMatchers + ClangFormat çš„é›†æˆåŒ–ã€é«˜æ˜“ç”¨ç‰ˆâ€â€”â€” ä½†æ— éœ€é¢å¯¹ Clang AST çš„å¤æ‚æŒ‡é’ˆæ“ä½œã€ç¼–è¯‘é€‰é¡¹é…ç½®ï¼Œä¹Ÿæ— éœ€æ‰‹åŠ¨å¤„ç†å†…å­˜ç®¡ç†ï¼ŒåŒæ—¶æ·±åº¦é›†æˆ C# ç”Ÿæ€ï¼ˆå¦‚ Visual Studio æ’ä»¶ã€.NET é¡¹ç›®ï¼‰ï¼Œå¼€å‘æ•ˆç‡è¿œè¶… C++ çš„ç¼–è¯‘å™¨å·¥å…·é“¾ã€‚ ä¸€ã€æ ¸å¿ƒå®šä½ï¼šRoslyn æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ1. æ‰“ç ´ â€œç¼–è¯‘å™¨é»‘ç›’â€ä¼ ç»Ÿç¼–è¯‘å™¨ï¼ˆå¦‚ C++ çš„ Clangã€MSVCï¼‰æ˜¯ â€œè¾“å…¥ä»£ç  â†’ è¾“å‡ºäºŒè¿›åˆ¶â€ çš„é»‘ç›’ï¼Œå¼€å‘è€…æ— æ³•å¹²é¢„ä¸­é—´è¿‡ç¨‹ï¼›è€Œ Roslyn å°†ç¼–è¯‘å™¨æ‹†è§£ä¸ºÂ â€œè¯­æ³•è§£æ â†’ è¯­ä¹‰åˆ†æ â†’ ä»£ç ç”Ÿæˆâ€Â ä¸‰ä¸ªå¯ç¼–ç¨‹é˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æä¾› API ä¾›å¼€å‘è€…è°ƒç”¨ï¼š è¯­æ³•è§£æï¼šå°†æºä»£ç å­—ç¬¦ä¸²è½¬ä¸ºç»“æ„åŒ–çš„ â€œè¯­æ³•æ ‘ï¼ˆSyntax Treeï¼‰â€ï¼› è¯­ä¹‰åˆ†æï¼šåŸºäºè¯­æ³•æ ‘ï¼Œè§£æå˜é‡ç±»å‹ã€å‡½æ•°å¼•ç”¨ã€å‘½åç©ºé—´ç­‰ â€œè¯­ä¹‰ä¿¡æ¯â€ï¼› ä»£ç ç”Ÿæˆï¼šå°†è¯­æ³•æ ‘ è¯­ä¹‰æ¨¡å‹è½¬ä¸º IL å­—èŠ‚ç ï¼ˆæˆ–å›è½¬ä¸ºæºä»£ç ï¼‰ã€‚ 2. ä¸ C++ ç¼–è¯‘å™¨å·¥å…·é“¾çš„æ ¸å¿ƒå·®å¼‚ ç‰¹æ€§ C# Roslyn API C++ ç¼–è¯‘å™¨å·¥å…·é“¾ï¼ˆClang LibToolingï¼‰ æ ¸å¿ƒä¼˜åŠ¿ï¼ˆRoslynï¼‰ æ ¸å¿ƒå®šä½ ç¼–è¯‘å™¨å³æœåŠ¡ï¼ˆå¯ç¼–ç¨‹ã€é›†æˆåŒ–ï¼‰ ç¼–è¯‘å™¨æ’ä»¶ç”Ÿæ€ï¼ˆåˆ†æ•£ã€éœ€æ‰‹åŠ¨é›†æˆï¼‰ ç»Ÿä¸€ API è¦†ç›–è§£æ åˆ†æ ç”Ÿæˆ é‡æ„ï¼Œæ— éœ€æ‹¼æ¥å·¥å…· è¯­æ³•æ ‘æ“ä½œ å¼ºç±»å‹è¯­æ³•æ ‘ï¼ˆSyntaxNodeÂ æ´¾ç”Ÿç±»ï¼‰ï¼Œæ”¯æŒä¿®æ”¹ è£¸æŒ‡é’ˆæ“ä½œ AST èŠ‚ç‚¹ï¼Œå†…å­˜éœ€æ‰‹åŠ¨ç®¡ç† ç±»å‹å®‰å…¨ï¼Œæ”¯æŒ immutable èŠ‚ç‚¹ä¿®æ”¹ï¼ˆé¿å…å‰¯ä½œç”¨ï¼‰ è¯­ä¹‰åˆ†æ å†…ç½®Â SemanticModelï¼Œä¸€é”®è·å–ç±»å‹ å¼•ç”¨ ç¬¦å· éœ€æ‰‹åŠ¨è°ƒç”¨ Clang è¯­ä¹‰åˆ†ææ¥å£ï¼Œé…ç½®å¤æ‚ è¯­ä¹‰ä¿¡æ¯è‡ªåŠ¨å…³è”ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†ä¾èµ–è§£æ é¡¹ç›®æ”¯æŒ å†…ç½®Â WorkspaceÂ ç®¡ç†é¡¹ç›® è§£å†³æ–¹æ¡ˆï¼Œè‡ªåŠ¨è§£æå¼•ç”¨ éœ€æ‰‹åŠ¨é…ç½®ç¼–è¯‘æ•°æ®åº“ï¼ˆcompile_commands.jsonï¼‰ æ— éœ€æ‰‹åŠ¨å¤„ç†é¡¹ç›®ä¾èµ–ã€ç¼–è¯‘é€‰é¡¹ï¼Œå¼€ç®±å³ç”¨ ä»£ç ç”Ÿæˆ é‡æ„ å†…ç½®é‡æ„ APIï¼ˆé‡å‘½åã€æå–æ–¹æ³•ï¼‰ã€ä»£ç ç”Ÿæˆå™¨ éœ€æ‰‹åŠ¨å®ç°é‡æ„é€»è¾‘ï¼Œä»£ç ç”Ÿæˆä¾èµ–å¤–éƒ¨å·¥å…· åŸç”Ÿæ”¯æŒä»£ç ä¿®æ”¹ä¸å›å†™ï¼Œé‡æ„é€»è¾‘ç»å¾®è½¯éªŒè¯ ç”Ÿæ€é›†æˆ æ— ç¼é›†æˆ Visual StudioVS Codeã€.NET é¡¹ç›® éœ€æ‰‹åŠ¨é›†æˆåˆ° IDE æˆ–æ„å»ºæµç¨‹ å¯ç›´æ¥å¼€å‘ IDE æ’ä»¶ã€ä»£ç åˆ†æå™¨ï¼Œç”Ÿæ€æˆç†Ÿ 3. Roslyn API çš„æ ¸å¿ƒç”¨é€”ï¼ˆC++ ç¨‹åºå‘˜å…±é¸£åœºæ™¯ï¼‰ ä»£ç åˆ†æï¼šé™æ€æ£€æŸ¥ä»£ç è§„èŒƒï¼ˆå¦‚ç¦æ­¢é­”æ³•æ•°ã€å¼ºåˆ¶æ¥å£æ³¨é‡Šï¼‰â†’ ç±»æ¯” C++ çš„ Clang-Tidyï¼› ä»£ç é‡æ„ï¼šæ‰¹é‡é‡å‘½åå˜é‡ã€æå–é‡å¤ä»£ç ä¸ºæ–¹æ³• â†’ ç±»æ¯” C++ çš„ Clang-Refactorï¼› ä»£ç ç”Ÿæˆï¼šæ ¹æ®é…ç½®è‡ªåŠ¨ç”Ÿæˆé‡å¤ä»£ç ï¼ˆå¦‚ ORM å®ä½“ã€RPC æ¥å£ï¼‰â†’ ç±»æ¯” C++ çš„ Protobuf ç¼–è¯‘å™¨ã€Qt MOCï¼› è‡ªå®šä¹‰è¯Šæ–­ï¼šåœ¨ IDE ä¸­å®æ—¶æç¤ºè‡ªå®šä¹‰é”™è¯¯ï¼ˆå¦‚ â€œç¦æ­¢ä½¿ç”¨Â ArrayListï¼Œè¯·ç”¨Â ListTâ€ï¼‰â†’ ç±»æ¯” C++ çš„ Clang è‡ªå®šä¹‰è¯Šæ–­ï¼› è¯­è¨€æ‰©å±•ï¼šå®ç° C# è¯­æ³•ç³–ï¼ˆå¦‚è‡ªå®šä¹‰å±æ€§è‡ªåŠ¨ç”Ÿæˆä»£ç ï¼‰â†’ ç±»æ¯” C++ çš„å®ã€Clang æ’ä»¶æ‰©å±•è¯­æ³•ï¼› ä»£ç æ ¼å¼åŒ–ï¼šè‡ªå®šä¹‰ä»£ç é£æ ¼ï¼ˆå¦‚æ‹¬å·æ¢è¡Œã€å‘½åè§„èŒƒï¼‰â†’ ç±»æ¯” C++ çš„ Clang-Formatã€‚ äºŒã€æ ¸å¿ƒæ¦‚å¿µï¼šRoslyn çš„ä¸‰å¤§æ”¯æŸ±Roslyn çš„æ‰€æœ‰åŠŸèƒ½éƒ½åŸºäºä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œç†è§£å®ƒä»¬å°±èƒ½æŒæ¡ Roslyn çš„ä½¿ç”¨æ¡†æ¶ï¼š 1. è¯­æ³•æ ‘ï¼ˆSyntax Treeï¼‰ï¼šä»£ç çš„ â€œç»“æ„éª¨æ¶â€è¯­æ³•æ ‘æ˜¯ Roslyn æœ€åŸºç¡€çš„æ¦‚å¿µï¼Œå®ƒå°†æºä»£ç å­—ç¬¦ä¸²è§£æä¸ºÂ ç»“æ„åŒ–çš„ã€å¯éå†çš„èŠ‚ç‚¹æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªè¯­æ³•å…ƒç´ ï¼ˆå¦‚å˜é‡å£°æ˜ã€å‡½æ•°è°ƒç”¨ã€å¾ªç¯è¯­å¥ï¼‰ã€‚ æ ¸å¿ƒç‰¹æ€§ï¼š æ— æ­§ä¹‰ï¼šè¯­æ³•æ ‘å®Œå…¨å¯¹åº”æºä»£ç çš„è¯­æ³•ç»“æ„ï¼Œä¸ä¾èµ–è¯­ä¹‰ï¼ˆå¦‚å˜é‡ç±»å‹ã€å‡½æ•°æ˜¯å¦å­˜åœ¨ï¼‰ï¼› Immutableï¼ˆä¸å¯å˜ï¼‰ï¼šè¯­æ³•èŠ‚ç‚¹åˆ›å»ºåæ— æ³•ä¿®æ”¹ï¼Œä¿®æ”¹éœ€é€šè¿‡ â€œåˆ›å»ºæ–°èŠ‚ç‚¹æ›¿æ¢æ—§èŠ‚ç‚¹â€ å®ç°ï¼ˆé¿å…å‰¯ä½œç”¨ï¼‰ï¼› å¸¦ä½ç½®ä¿¡æ¯ï¼šæ¯ä¸ªèŠ‚ç‚¹åŒ…å«æºä»£ç ä¸­çš„èµ·å§‹ä½ç½®ã€é•¿åº¦ã€è¡Œå·åˆ—å·ï¼ˆä¾¿äºå®šä½ä»£ç ï¼‰ã€‚ ç±»æ¯” C++ï¼šç±»ä¼¼ Clang çš„Â ASTContextÂ å’ŒÂ StmtDeclÂ èŠ‚ç‚¹ï¼Œä½† Roslyn çš„è¯­æ³•æ ‘æ˜¯Â å¼ºç±»å‹Â çš„ï¼ˆå¦‚Â VariableDeclarationSyntaxÂ å¯¹åº”å˜é‡å£°æ˜ã€InvocationExpressionSyntaxÂ å¯¹åº”å‡½æ•°è°ƒç”¨ï¼‰ï¼Œæ— éœ€åƒ Clang é‚£æ ·é€šè¿‡Â dyn_castÂ è½¬æ¢èŠ‚ç‚¹ç±»å‹ã€‚ ç¤ºä¾‹ï¼šç®€å•è¯­æ³•æ ‘ç»“æ„ï¼ˆè§£æÂ int x = 10;ï¼‰plaintext CompilationUnitSyntaxï¼ˆæ ¹èŠ‚ç‚¹ï¼šæ•´ä¸ªæ–‡ä»¶ï¼‰â””â”€â”€ MemberDeclarationSyntaxï¼ˆæˆå‘˜å£°æ˜ï¼‰ â””â”€â”€ LocalDeclarationStatementSyntaxï¼ˆå±€éƒ¨å˜é‡å£°æ˜è¯­å¥ï¼‰ â”œâ”€â”€ VariableDeclarationSyntaxï¼ˆå˜é‡å£°æ˜ï¼‰ â”‚ â”œâ”€â”€ TypeSyntaxï¼ˆç±»å‹ï¼šintï¼‰ â”‚ â”‚ â””â”€â”€ PredefinedTypeSyntaxï¼ˆé¢„å®šä¹‰ç±»å‹ï¼šintï¼‰ â”‚ â””â”€â”€ VariableDeclaratorSyntaxï¼ˆå˜é‡å®šä¹‰ï¼šx = 10ï¼‰ â”‚ â”œâ”€â”€ IdentifierNameSyntaxï¼ˆå˜é‡åï¼šxï¼‰ â”‚ â””â”€â”€ EqualsValueClauseSyntaxï¼ˆèµ‹å€¼è¡¨è¾¾å¼ï¼‰ â”‚ â””â”€â”€ LiteralExpressionSyntaxï¼ˆå­—é¢é‡ï¼š10ï¼‰ â””â”€â”€ SemicolonTokenï¼ˆåˆ†å·ï¼‰ 2. è¯­ä¹‰æ¨¡å‹ï¼ˆSemantic Modelï¼‰ï¼šä»£ç çš„ â€œå«ä¹‰è§£é‡Šâ€è¯­æ³•æ ‘ä»…æè¿° â€œä»£ç ç»“æ„â€ï¼Œè€Œè¯­ä¹‰æ¨¡å‹ï¼ˆSemanticModelï¼‰è´Ÿè´£è§£æ â€œä»£ç å«ä¹‰â€â€”â€” åŸºäºè¯­æ³•æ ‘å’Œé¡¹ç›®å¼•ç”¨ï¼Œæä¾›å˜é‡ç±»å‹ã€å‡½æ•°ç­¾åã€å¼•ç”¨å…³ç³»ã€å‘½åç©ºé—´ç­‰è¯­ä¹‰ä¿¡æ¯ã€‚ æ ¸å¿ƒèƒ½åŠ›ï¼š è§£æç¬¦å·ï¼ˆISymbolï¼‰ï¼šè·å–å˜é‡ã€å‡½æ•°ã€ç±»å‹çš„å…ƒä¿¡æ¯ï¼ˆå¦‚Â xÂ çš„ç±»å‹æ˜¯Â intï¼ŒConsole.WriteLineÂ æ˜¯é™æ€æ–¹æ³•ï¼‰ï¼› ç»‘å®šè¡¨è¾¾å¼ï¼ˆBindingResultï¼‰ï¼šåˆ¤æ–­è¡¨è¾¾å¼çš„ç±»å‹ï¼ˆå¦‚Â x + 10Â çš„ç±»å‹æ˜¯Â intï¼‰ï¼› æŸ¥æ‰¾å¼•ç”¨ï¼ˆFindReferencesAsyncï¼‰ï¼šæ‰¾åˆ°å˜é‡ å‡½æ•°åœ¨ä»£ç ä¸­çš„æ‰€æœ‰å¼•ç”¨ï¼› ç±»å‹æ¨æ–­ï¼šè§£ææ³›å‹ç±»å‹å‚æ•°ï¼ˆå¦‚Â var list = new Listint()Â ä¸­Â listÂ çš„ç±»å‹ï¼‰ã€‚ ç±»æ¯” C++ï¼šç±»ä¼¼ Clang çš„Â SemaÂ ç»„ä»¶ï¼ˆè¯­ä¹‰åˆ†æå™¨ï¼‰ï¼Œä½† Roslyn çš„Â SemanticModelÂ å°è£…æ›´ç®€æ´ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†ç±»å‹æŸ¥æ‰¾ã€å¼•ç”¨è§£æç­‰åº•å±‚é€»è¾‘ã€‚ 3. å·¥ä½œåŒºï¼ˆWorkspaceï¼‰ï¼šä»£ç çš„ â€œé¡¹ç›®å®¹å™¨â€å·¥ä½œåŒºï¼ˆWorkspaceï¼‰æ˜¯ Roslyn ç®¡ç†ä»£ç é¡¹ç›®çš„æ ¸å¿ƒå®¹å™¨ï¼Œå®ƒåŒ…å«ï¼š è§£å†³æ–¹æ¡ˆï¼ˆSolutionï¼‰ï¼šå¤šä¸ªé¡¹ç›®çš„é›†åˆï¼› é¡¹ç›®ï¼ˆProjectï¼‰ï¼šå•ä¸ª .NET é¡¹ç›®ï¼ŒåŒ…å«æºä»£ç æ–‡ä»¶ã€å¼•ç”¨ï¼ˆNuGet é¡¹ç›®å¼•ç”¨ï¼‰ã€ç¼–è¯‘é€‰é¡¹ï¼› æ–‡æ¡£ï¼ˆDocumentï¼‰ï¼šå•ä¸ªæºä»£ç æ–‡ä»¶ï¼ˆå¯¹åº”è¯­æ³•æ ‘å’Œè¯­ä¹‰æ¨¡å‹ï¼‰ã€‚ æ ¸å¿ƒä»·å€¼ï¼š è‡ªåŠ¨è§£æé¡¹ç›®ä¾èµ–ï¼ˆå¦‚é¡¹ç›®å¼•ç”¨ã€NuGet åŒ…ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ç¼–è¯‘é€‰é¡¹ï¼› æ”¯æŒè·¨æ–‡ä»¶è¯­ä¹‰åˆ†æï¼ˆå¦‚æŸ¥æ‰¾é¡¹ç›®ä¸­æŸä¸ªå‡½æ•°çš„æ‰€æœ‰å¼•ç”¨ï¼‰ï¼› å¯ä¿®æ”¹é¡¹ç›® æ–‡æ¡£ï¼ˆå¦‚æ·»åŠ æ–‡ä»¶ã€ä¿®æ”¹ä»£ç ï¼‰ï¼Œå¹¶è‡ªåŠ¨åŒæ­¥è¯­æ³•æ ‘å’Œè¯­ä¹‰æ¨¡å‹ã€‚ ç±»æ¯” C++ï¼šç±»ä¼¼ Clang çš„Â compile_commands.jsonï¼ˆç¼–è¯‘æ•°æ®åº“ï¼‰+ CMake é¡¹ç›®ç®¡ç†ï¼Œä½† Roslyn çš„Â WorkspaceÂ æ˜¯å¯ç¼–ç¨‹çš„ï¼Œå¯åŠ¨æ€ä¿®æ”¹é¡¹ç›®ç»“æ„ï¼Œè€Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤ç¼–è¯‘æ•°æ®åº“ã€‚ ä¸‰ã€æ ¸å¿ƒç±»å‹ä¸ API åˆ†å±‚Roslyn API åˆ†ä¸ºÂ ä½çº§ APIï¼ˆè¯­æ³•æ ‘ è¯­ä¹‰æ¨¡å‹ï¼‰å’ŒÂ é«˜çº§ APIï¼ˆå·¥ä½œåŒºï¼‰ï¼Œåˆ†åˆ«é€‚é…ä¸åŒåœºæ™¯ï¼š 1. ä½çº§ APIï¼ˆè½»é‡çº§åœºæ™¯ï¼‰ æ ¸å¿ƒå‘½åç©ºé—´ï¼šMicrosoft.CodeAnalysis.CSharpï¼ˆC# è¯­æ³•ç›¸å…³ï¼‰ï¼› æ ¸å¿ƒç±»å‹ï¼š CSharpSyntaxTreeï¼šC# è¯­æ³•æ ‘ï¼Œé€šè¿‡Â CSharpSyntaxTree.ParseText()Â ä»å­—ç¬¦ä¸²è§£æï¼› CSharpCompilationï¼šç¼–è¯‘å•å…ƒï¼Œç”¨äºç”Ÿæˆè¯­ä¹‰æ¨¡å‹ï¼ˆéœ€é…ç½®å¼•ç”¨å’Œç¼–è¯‘é€‰é¡¹ï¼‰ï¼› SemanticModelï¼šè¯­ä¹‰æ¨¡å‹ï¼Œé€šè¿‡Â compilation.GetSemanticModel(syntaxTree)Â è·å–ï¼› SyntaxNodeï¼šè¯­æ³•èŠ‚ç‚¹åŸºç±»ï¼ˆæ‰€æœ‰è¯­æ³•å…ƒç´ çš„çˆ¶ç±»ï¼Œå¦‚Â VariableDeclarationSyntaxï¼‰ï¼› SyntaxTokenï¼šè¯­æ³•æ ‡è®°ï¼ˆå¦‚å…³é”®å­—ã€æ ‡è¯†ç¬¦ã€è¿ç®—ç¬¦ï¼Œå¦‚Â intã€xã€=ï¼‰ã€‚ é€‚ç”¨åœºæ™¯ï¼š å•æ–‡ä»¶ä»£ç è§£æ åˆ†æï¼ˆå¦‚è§£æä¸€æ®µä»£ç å­—ç¬¦ä¸²ï¼Œæ£€æŸ¥è¯­æ³•é”™è¯¯ï¼‰ï¼› è½»é‡çº§ä»£ç ç”Ÿæˆï¼ˆå¦‚æ ¹æ®æ¨¡æ¿ç”Ÿæˆå•ä¸ªä»£ç æ–‡ä»¶ï¼‰ã€‚ 2. é«˜çº§ APIï¼ˆé¡¹ç›®çº§åœºæ™¯ï¼‰ æ ¸å¿ƒå‘½åç©ºé—´ï¼šMicrosoft.CodeAnalysisï¼ˆå·¥ä½œåŒºç›¸å…³ï¼‰ï¼› æ ¸å¿ƒç±»å‹ï¼š AdhocWorkspaceï¼šä¸´æ—¶å·¥ä½œåŒºï¼ˆç”¨äºåŠ¨æ€åˆ›å»ºé¡¹ç›® æ–‡æ¡£ï¼Œæ— å®é™…è§£å†³æ–¹æ¡ˆæ–‡ä»¶ï¼‰ï¼› MSBuildWorkspaceï¼šMSBuild å·¥ä½œåŒºï¼ˆåŠ è½½ç°æœ‰ .sln.csproj é¡¹ç›®ï¼Œæ”¯æŒçœŸå®é¡¹ç›®åˆ†æï¼‰ï¼› SolutionProjectDocumentï¼šé¡¹ç›®ç»“æ„ç›¸å…³ç±»å‹ï¼› ISymbolï¼šç¬¦å·åŸºç±»ï¼ˆå¦‚Â IFieldSymbolÂ å­—æ®µç¬¦å·ã€IMethodSymbolÂ æ–¹æ³•ç¬¦å·ï¼‰ã€‚ é€‚ç”¨åœºæ™¯ï¼š é¡¹ç›®çº§ä»£ç åˆ†æï¼ˆå¦‚åˆ†ææ•´ä¸ªè§£å†³æ–¹æ¡ˆçš„ä»£ç è§„èŒƒï¼‰ï¼› è·¨æ–‡ä»¶é‡æ„ï¼ˆå¦‚é‡å‘½åé¡¹ç›®ä¸­æ‰€æœ‰å¼•ç”¨çš„å˜é‡ï¼‰ï¼› IDE æ’ä»¶å¼€å‘ï¼ˆå¦‚ Visual Studio æ‰©å±•ï¼Œéœ€æ“ä½œçœŸå®é¡¹ç›®ï¼‰ã€‚ å››ã€å®æˆ˜ç¤ºä¾‹ï¼šRoslyn API æ ¸å¿ƒç”¨æ³•ï¼ˆé¢å‘ C++ ç¨‹åºå‘˜ï¼‰ä»¥ä¸‹ç¤ºä¾‹è¦†ç›– Roslyn æœ€å¸¸ç”¨åœºæ™¯ï¼Œæ¯ä¸ªç¤ºä¾‹éƒ½å¯¹æ¯” C++ å®ç°çš„å¤æ‚åº¦ï¼Œçªå‡º Roslyn çš„ä¼˜åŠ¿ï¼š ç¤ºä¾‹ 1ï¼šè§£æä»£ç å­—ç¬¦ä¸²ï¼Œç”Ÿæˆè¯­æ³•æ ‘ï¼ˆä½çº§ APIï¼‰åœºæ™¯ï¼šè§£æä¸€æ®µ C# ä»£ç ï¼Œéå†è¯­æ³•æ ‘ï¼Œæ‰¾åˆ°æ‰€æœ‰å˜é‡å£°æ˜ã€‚ csharp è¿è¡Œ using Microsoft.CodeAnalysis;using Microsoft.CodeAnalysis.CSharp;using Microsoft.CodeAnalysis.CSharp.Syntax;// 1. æºä»£ç å­—ç¬¦ä¸²string code = @using System;namespace RoslynDemo class Program static void Main() int x = 10; string y = hello; var z = new Listint(); ;// 2. è§£æä¸ºè¯­æ³•æ ‘ï¼ˆç±»æ¯” C++ Clang AST è§£æï¼‰CSharpSyntaxTree syntaxTree = CSharpSyntaxTree.ParseText(code);// 3. éå†è¯­æ³•æ ‘ï¼ŒæŸ¥æ‰¾æ‰€æœ‰å˜é‡å£°æ˜ï¼ˆç±»æ¯” C++ Clang AST éå†ï¼‰var variableDeclarations = syntaxTree.GetRoot() .DescendantNodes() .OfTypeLocalDeclarationStatementSyntax();// 4. è¾“å‡ºå˜é‡ä¿¡æ¯foreach (var declaration in variableDeclarations) // è·å–å˜é‡ç±»å‹ï¼ˆè¯­æ³•å±‚é¢ï¼Œå¦‚ intã€stringã€varï¼‰ string typeName = declaration.Declaration.Type.ToString(); // è·å–å˜é‡åï¼ˆå¦‚ xã€yã€zï¼‰ string variableName = declaration.Declaration.Variables.First().Identifier.Text; Console.WriteLine($å˜é‡å£°æ˜ï¼štypeName variableName);// è¾“å‡ºç»“æœï¼š// å˜é‡å£°æ˜ï¼šint x// å˜é‡å£°æ˜ï¼šstring y// å˜é‡å£°æ˜ï¼švar z C++ å¯¹æ¯”ï¼šClang AST éå†C++ éœ€æ‰‹åŠ¨åˆå§‹åŒ– Clang ä¸Šä¸‹æ–‡ã€è§£æä»£ç ã€éå† ASTï¼Œä»£ç ç¹çä¸”éœ€å¤„ç†å†…å­˜ï¼š cpp è¿è¡Œ #include clang/AST/ASTConsumer.h#include clang/AST/RecursiveASTVisitor.h#include clang/Frontend/CompilerInstance.h#include clang/Frontend/FrontendAction.h#include clang/Tooling/Tooling.h// è‡ªå®šä¹‰ AST è®¿é—®å™¨ï¼ˆæŸ¥æ‰¾å˜é‡å£°æ˜ï¼‰class VarVisitor : public clang::RecursiveASTVisitorVarVisitor public: bool VisitVarDecl(clang::VarDecl* decl) if (decl-isLocalVarDecl()) // å±€éƒ¨å˜é‡ llvm::outs() å˜é‡å£°æ˜ï¼š decl-getType().getAsString() decl-getNameAsString() ; return true; ;class VarConsumer : public clang::ASTConsumer public: void HandleTranslationUnit(clang::ASTContext ctx) override VarVisitor visitor; visitor.TraverseDecl(ctx.getTranslationUnitDecl()); ;class VarAction : public clang::ASTFrontendAction public: std::unique_ptrclang::ASTConsumer CreateASTConsumer( clang::CompilerInstance, llvm::StringRef) override return std::make_uniqueVarConsumer(); ;int main() std::string code = R(#include vectorusing namespace std;int main() int x = 10; string y = hello; auto z = vectorint(); return 0;); // è§£æä»£ç ï¼ˆéœ€é…ç½®ç¼–è¯‘é€‰é¡¹ï¼Œå¦‚ -std=c++17ï¼‰ clang::tooling::runToolOnCode(std::make_uniqueVarAction(), code, test.cpp, clang++, -std=c++17, -I/usr/include/c++/11); return 0; å¯è§ Roslyn æ— éœ€é…ç½®ç¼–è¯‘é€‰é¡¹ã€æ— éœ€è‡ªå®šä¹‰è®¿é—®å™¨ï¼Œå‡ è¡Œä»£ç å³å¯å®Œæˆè¯­æ³•æ ‘éå†ã€‚ ç¤ºä¾‹ 2ï¼šè¯­ä¹‰åˆ†æï¼ˆè·å–å˜é‡çœŸå®ç±»å‹ï¼‰åœºæ™¯ï¼šè§£æÂ var z = new Listint()Â ä¸­Â zÂ çš„çœŸå®ç±»å‹ï¼ˆListintï¼‰ï¼Œè€Œéè¯­æ³•å±‚é¢çš„Â varã€‚ csharp è¿è¡Œ using Microsoft.CodeAnalysis;using Microsoft.CodeAnalysis.CSharp;using Microsoft.CodeAnalysis.CSharp.Syntax;string code = @using System.Collections.Generic;namespace RoslynDemo class Program static void Main() var z = new Listint(); ;// 1. è§£æè¯­æ³•æ ‘CSharpSyntaxTree syntaxTree = CSharpSyntaxTree.ParseText(code);// 2. é…ç½®ç¼–è¯‘ï¼ˆæ·»åŠ å¿…è¦å¼•ç”¨ï¼Œå¦‚ System.Collections.Genericï¼‰MetadataReference[] references = new[] // å¼•ç”¨ mscorlibï¼ˆ.NET åŸºç¡€åº“ï¼‰ MetadataReference.CreateFromFile(typeof(object).Assembly.Location), // å¼•ç”¨ System.Collections.Genericï¼ˆListT æ‰€åœ¨åº“ï¼‰ MetadataReference.CreateFromFile(typeof(List).Assembly.Location);// 3. åˆ›å»ºç¼–è¯‘å•å…ƒï¼Œç”Ÿæˆè¯­ä¹‰æ¨¡å‹ï¼ˆç±»æ¯” C++ Clang Semaï¼‰CSharpCompilation compilation = CSharpCompilation.Create( assemblyName: RoslynDemo, syntaxTrees: new[] syntaxTree , references: references, options: new CSharpCompilationOptions(OutputKind.ConsoleApplication));SemanticModel semanticModel = compilation.GetSemanticModel(syntaxTree);// 4. æŸ¥æ‰¾å˜é‡å£°æ˜ï¼Œè·å–çœŸå®ç±»å‹var varDeclaration = syntaxTree.GetRoot() .DescendantNodes() .OfTypeLocalDeclarationStatementSyntax() .First(d = d.Declaration.Variables.First().Identifier.Text == z);// è·å–å˜é‡ç¬¦å·ï¼ˆè¯­ä¹‰å±‚é¢çš„å˜é‡ä¿¡æ¯ï¼‰VariableDeclaratorSyntax varDeclarator = varDeclaration.Declaration.Variables.First();ISymbol varSymbol = semanticModel.GetDeclaredSymbol(varDeclarator);// è·å–çœŸå®ç±»å‹ï¼ˆListintï¼‰string realType = varSymbol.Type.ToString();Console.WriteLine($var z çš„çœŸå®ç±»å‹ï¼šrealType); // è¾“å‡ºï¼šSystem.Collections.Generic.Listint C++ å¯¹æ¯”ï¼šClang è¯­ä¹‰åˆ†æC++ éœ€æ‰‹åŠ¨è°ƒç”¨Â clang::SemaÂ çš„æ¥å£ï¼Œè§£æÂ autoÂ ç±»å‹ï¼Œä»£ç å¤æ‚åº¦è¿œè¶… Roslynï¼š cpp è¿è¡Œ // å»¶ç»­ç¤ºä¾‹ 1 çš„ä»£ç ï¼Œä¿®æ”¹ VarVisitorï¼šbool VisitVarDecl(clang::VarDecl* decl) if (decl-isLocalVarDecl() decl-getType().isAutoType()) // è§£æ auto ç±»å‹ï¼ˆéœ€ Sema ä¸Šä¸‹æ–‡ï¼‰ clang::QualType realType = decl-getDesugaredType(ctx); llvm::outs() auto z çš„çœŸå®ç±»å‹ï¼š realType.getAsString() ; return true; ç¤ºä¾‹ 3ï¼šä¿®æ”¹ä»£ç ï¼ˆæ›¿æ¢å˜é‡åï¼Œä½çº§ APIï¼‰åœºæ™¯ï¼šå°†å˜é‡Â xÂ é‡å‘½åä¸ºÂ countï¼Œç”Ÿæˆä¿®æ”¹åçš„ä»£ç ï¼ˆRoslyn è¯­æ³•æ ‘ä¸å¯å˜ï¼Œéœ€åˆ›å»ºæ–°èŠ‚ç‚¹æ›¿æ¢æ—§èŠ‚ç‚¹ï¼‰ã€‚ csharp è¿è¡Œ using Microsoft.CodeAnalysis;using Microsoft.CodeAnalysis.CSharp;using Microsoft.CodeAnalysis.CSharp.Syntax;string code = @int x = 10; Console.WriteLine(x);;// 1. è§£æè¯­æ³•æ ‘CSharpSyntaxTree syntaxTree = CSharpSyntaxTree.ParseText(code);CompilationUnitSyntax root = syntaxTree.GetRoot() as CompilationUnitSyntax;// 2. æŸ¥æ‰¾æ‰€æœ‰å˜é‡ x çš„å¼•ç”¨ï¼ˆè¯­æ³•å±‚é¢ï¼‰var xIdentifiers = root.DescendantNodes() .OfTypeIdentifierNameSyntax() .Where(id = id.Identifier.Text == x);// 3. æ›¿æ¢å˜é‡åä¸º countï¼ˆåˆ›å»ºæ–°èŠ‚ç‚¹ï¼Œæ›¿æ¢æ—§èŠ‚ç‚¹ï¼‰CompilationUnitSyntax newRoot = root.ReplaceNodes( nodes: xIdentifiers, computeReplacementNode: (oldNode, _) = oldNode.WithIdentifier(SyntaxFactory.Identifier(count)));// 4. ç”Ÿæˆä¿®æ”¹åçš„ä»£ç string modifiedCode = newRoot.NormalizeWhitespace().ToFullString();Console.WriteLine(modifiedCode); // è¾“å‡ºï¼šint count = 10; Console.WriteLine(count); C++ å¯¹æ¯”ï¼šClang AST ä¿®æ”¹C++ éœ€æ‰‹åŠ¨åˆ›å»ºæ–°çš„Â VarDeclÂ èŠ‚ç‚¹ï¼Œæ›¿æ¢æ—§èŠ‚ç‚¹ï¼Œä¸”éœ€å¤„ç†å†…å­˜ç®¡ç†ï¼Œææ˜“å‡ºé”™ï¼š cpp è¿è¡Œ // Clang AST ä¿®æ”¹ç¤ºä¾‹ï¼ˆç®€åŒ–ç‰ˆï¼‰clang::VarDecl* newDecl = clang::VarDecl::Create( ctx, decl-getDeclContext(), decl-getLocation(), decl-getLocation(), clang::IdentifierInfo::get(count, ctx.Idents), decl-getType(), decl-getTypeSourceInfo(), decl-getStorageClass());// æ›¿æ¢æ—§èŠ‚ç‚¹ï¼ˆéœ€æ“ä½œ AST ä¸Šä¸‹æ–‡ï¼Œå¤æ‚ä¸”æ˜“å†…å­˜æ³„æ¼ï¼‰ ç¤ºä¾‹ 4ï¼šé¡¹ç›®çº§åˆ†æï¼ˆæŸ¥æ‰¾è§£å†³æ–¹æ¡ˆä¸­å‡½æ•°çš„æ‰€æœ‰å¼•ç”¨ï¼Œé«˜çº§ APIï¼‰åœºæ™¯ï¼šåŠ è½½ç°æœ‰ .sln é¡¹ç›®ï¼ŒæŸ¥æ‰¾Â Program.MainÂ æ–¹æ³•çš„æ‰€æœ‰å¼•ç”¨ï¼ˆè·¨æ–‡ä»¶ï¼‰ã€‚ csharp è¿è¡Œ using Microsoft.CodeAnalysis;using Microsoft.CodeAnalysis.CSharp;using Microsoft.CodeAnalysis.FindSymbols;using Microsoft.CodeAnalysis.MSBuild;// 1. åŠ è½½è§£å†³æ–¹æ¡ˆï¼ˆéœ€å®‰è£… Microsoft.CodeAnalysis.MSBuild åŒ…ï¼‰string solutionPath = @C:\\YourProject\\YourSolution.sln;using MSBuildWorkspace workspace = MSBuildWorkspace.Create();Solution solution = await workspace.OpenSolutionAsync(solutionPath);// 2. æ‰¾åˆ°ç›®æ ‡é¡¹ç›®å’Œæ–‡æ¡£ï¼ˆProgram.csï¼‰Project project = solution.Projects.First(p = p.Name == YourProject);Document programDoc = project.Documents.First(d = d.Name == Program.cs);// 3. è·å–è¯­æ³•æ ‘å’Œè¯­ä¹‰æ¨¡å‹SyntaxTree syntaxTree = await programDoc.GetSyntaxTreeAsync();SemanticModel semanticModel = await programDoc.GetSemanticModelAsync();// 4. æŸ¥æ‰¾ Main æ–¹æ³•çš„ç¬¦å·var mainMethod = syntaxTree.GetRoot() .DescendantNodes() .OfTypeMethodDeclarationSyntax() .First(m = m.Identifier.Text == Main m.Modifiers.Any(SyntaxKind.StaticKeyword));IMethodSymbol mainSymbol = semanticModel.GetDeclaredSymbol(mainMethod);// 5. æŸ¥æ‰¾æ‰€æœ‰å¼•ç”¨ï¼ˆè·¨æ–‡ä»¶ï¼‰IEnumerableReferencedSymbol references = await SymbolFinder.FindReferencesAsync( mainSymbol, solution, cancellationToken: CancellationToken.None);// 6. è¾“å‡ºå¼•ç”¨ä½ç½®foreach (var referencedSymbol in references) foreach (var location in referencedSymbol.Locations) if (location.IsInSource) var lineSpan = location.SourceTree.GetLineSpan(location.SourceSpan); Console.WriteLine($å¼•ç”¨ä½ç½®ï¼šlocation.SourceTree.FilePathï¼Œè¡Œ lineSpan.StartLinePosition.Line + 1); C++ å¯¹æ¯”ï¼šClang è·¨æ–‡ä»¶å¼•ç”¨æŸ¥æ‰¾C++ éœ€ç”Ÿæˆå…¨é¡¹ç›®çš„ç¼–è¯‘æ•°æ®åº“ï¼Œå†ç”¨Â clang::tooling::FindReferencesActionï¼Œä¸”ä»…æ”¯æŒå•æ–‡ä»¶å¼•ç”¨ï¼Œè·¨æ–‡ä»¶éœ€æ‰‹åŠ¨éå†æ‰€æœ‰æ–‡ä»¶ï¼Œå¤æ‚åº¦æé«˜ï¼š cpp è¿è¡Œ // Clang è·¨æ–‡ä»¶å¼•ç”¨æŸ¥æ‰¾ï¼ˆç®€åŒ–ç‰ˆï¼‰int main() std::vectorstd::string files = file1.cpp, file2.cpp, file3.cpp ; clang::tooling::ClangTool tool(clang::tooling::FixedCompilationDatabase::loadFromFile(compile_commands.json).get(), files); // æŸ¥æ‰¾ main å‡½æ•°çš„å¼•ç”¨ï¼ˆéœ€æ‰‹åŠ¨æŒ‡å®šç¬¦å·ï¼Œè·¨æ–‡ä»¶éœ€éå†æ‰€æœ‰æ–‡ä»¶ï¼‰ return tool.run(clang::tooling::newFrontendActionFactoryVarAction().get()); ç¤ºä¾‹ 5ï¼šä»£ç ç”Ÿæˆï¼ˆåŠ¨æ€ç”Ÿæˆ ORM å®ä½“ç±»ï¼‰åœºæ™¯ï¼šæ ¹æ®æ•°æ®åº“è¡¨ç»“æ„ï¼Œè‡ªåŠ¨ç”Ÿæˆ C# å®ä½“ç±»ï¼ˆç±»æ¯” C++ çš„ Protobuf ä»£ç ç”Ÿæˆï¼‰ã€‚ csharp è¿è¡Œ using Microsoft.CodeAnalysis;using Microsoft.CodeAnalysis.CSharp;using Microsoft.CodeAnalysis.CSharp.Syntax;// æ¨¡æ‹Ÿæ•°æ®åº“è¡¨ç»“æ„var table = new Name = User, Columns = new List(string Name, string Type) (Id, int), (UserName, string), (Age, int), (Email, string) ;// 1. ç”Ÿæˆå‘½åç©ºé—´NamespaceDeclarationSyntax ns = SyntaxFactory.NamespaceDeclaration(SyntaxFactory.IdentifierName(RoslynGenerated)) .AddUsings(SyntaxFactory.UsingDirective(SyntaxFactory.IdentifierName(System))) .AddMembers( // 2. ç”Ÿæˆç±» SyntaxFactory.ClassDeclaration(table.Name) .AddModifiers(SyntaxFactory.Token(SyntaxKind.PublicKeyword)) .AddMembers( // 3. ç”Ÿæˆå±æ€§ï¼ˆå¯¹åº”è¡¨åˆ—ï¼‰ table.Columns.Select(col = SyntaxFactory.PropertyDeclaration( type: SyntaxFactory.ParseTypeName(col.Type), identifier: SyntaxFactory.Identifier(col.Name) ) .AddModifiers(SyntaxFactory.Token(SyntaxKind.PublicKeyword)) .AddAccessorListAccessors( // getter SyntaxFactory.AccessorDeclaration(SyntaxKind.GetAccessorDeclaration) .WithSemicolonToken(SyntaxFactory.Token(SyntaxKind.SemicolonToken)), // setter SyntaxFactory.AccessorDeclaration(SyntaxKind.SetAccessorDeclaration) .WithSemicolonToken(SyntaxFactory.Token(SyntaxKind.SemicolonToken)) ) ).ToArray() ) );// 4. ç”Ÿæˆæ ¹èŠ‚ç‚¹ï¼Œæ ¼å¼åŒ–ä»£ç CompilationUnitSyntax root = SyntaxFactory.CompilationUnit() .AddMembers(ns) .NormalizeWhitespace();// 5. è¾“å‡ºç”Ÿæˆçš„ä»£ç string generatedCode = root.ToFullString();Console.WriteLine(generatedCode); ç”Ÿæˆçš„ä»£ç ç»“æœï¼šcsharp è¿è¡Œ using System;namespace RoslynGenerated public class User public int Id get; set; public string UserName get; set; public int Age get; set; public string Email get; set; C++ å¯¹æ¯”ï¼šProtobuf ä»£ç ç”ŸæˆC++ éœ€ç¼–å†™ Protobuf å®šä¹‰æ–‡ä»¶ï¼ˆ.protoï¼‰ï¼Œå†é€šè¿‡Â protocÂ ç¼–è¯‘å™¨ç”Ÿæˆä»£ç ï¼Œè€Œ Roslyn å¯ç›´æ¥ç”¨ C# ä»£ç åŠ¨æ€ç”Ÿæˆï¼Œæ— éœ€ä¸­é—´æ–‡ä»¶ï¼Œçµæ´»æ€§æ›´é«˜ã€‚ äº”ã€å¸¸è§è¯¯åŒºä¸é¿å‘æŒ‡å—1. è¯¯åŒº 1ï¼šè¯­æ³•æ ‘èŠ‚ç‚¹å¯ç›´æ¥ä¿®æ”¹ é”™è¯¯è®¤çŸ¥ï¼šSyntaxNodeÂ å¯é€šè¿‡èµ‹å€¼ä¿®æ”¹ï¼ˆå¦‚Â variableDeclaration.Identifier.Text = countï¼‰ï¼› æ­£ç¡®é€»è¾‘ï¼šRoslyn è¯­æ³•èŠ‚ç‚¹æ˜¯Â Immutableï¼ˆä¸å¯å˜ï¼‰Â çš„ï¼Œä¿®æ”¹éœ€é€šè¿‡Â ReplaceNodesWithXXXÂ æ–¹æ³•åˆ›å»ºæ–°èŠ‚ç‚¹ï¼Œæ›¿æ¢æ—§èŠ‚ç‚¹ï¼ˆé¿å…å¤šçº¿ç¨‹è®¿é—®å†²çªå’Œå‰¯ä½œç”¨ï¼‰ã€‚ 2. è¯¯åŒº 2ï¼šå¿½ç•¥å¼•ç”¨é…ç½®ï¼Œå¯¼è‡´è¯­ä¹‰åˆ†æå¤±è´¥ é”™è¯¯åœºæ™¯ï¼šè§£æÂ ListintÂ æ—¶ï¼Œæœªæ·»åŠ Â System.Collections.GenericÂ å¼•ç”¨ï¼Œè¯­ä¹‰æ¨¡å‹æ— æ³•è¯†åˆ«Â ListTï¼› é¿å‘ï¼šä½¿ç”¨ä½çº§ API æ—¶ï¼Œéœ€æ‰‹åŠ¨æ·»åŠ å¿…è¦çš„å…ƒæ•°æ®å¼•ç”¨ï¼ˆMetadataReferenceï¼‰ï¼›ä½¿ç”¨é«˜çº§ APIï¼ˆMSBuildWorkspaceï¼‰æ—¶ï¼Œä¼šè‡ªåŠ¨åŠ è½½é¡¹ç›®å¼•ç”¨ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ã€‚ 3. è¯¯åŒº 3ï¼šæ··æ·†è¯­æ³•å±‚é¢å’Œè¯­ä¹‰å±‚é¢çš„ â€œå¼•ç”¨â€ é”™è¯¯è®¤çŸ¥ï¼šè¯­æ³•æ ‘ä¸­æ‰¾åˆ°Â IdentifierNameSyntax(x)Â å°±æ˜¯å˜é‡Â xÂ çš„å¼•ç”¨ï¼› æ­£ç¡®é€»è¾‘ï¼šè¯­æ³•å±‚é¢ä»…åŒ¹é…åç§°ï¼Œè¯­ä¹‰å±‚é¢éœ€é€šè¿‡Â semanticModel.GetSymbolInfo(identifier).SymbolÂ ç¡®è®¤æ˜¯å¦æŒ‡å‘ç›®æ ‡å˜é‡ï¼ˆå¦‚å­˜åœ¨åŒåå˜é‡æ—¶ï¼Œè¯­æ³•åŒ¹é…ä¼šè¯¯åˆ¤ï¼‰ã€‚ 4. è¯¯åŒº 4ï¼šMSBuildWorkspace æ— æ³•åŠ è½½ .NET Core.NET 5+ é¡¹ç›® é”™è¯¯åŸå› ï¼šMSBuildWorkspaceÂ éœ€å®‰è£…å¯¹åº”ç‰ˆæœ¬çš„ MSBuildï¼ˆå¦‚ .NET 6 é¡¹ç›®éœ€ MSBuild 17.0+ï¼‰ï¼› é¿å‘ï¼š å®‰è£…Â Microsoft.Build.RuntimeÂ NuGet åŒ…ï¼› ç¡®ä¿ç¯å¢ƒå˜é‡Â MSBuildSDKsPathÂ æŒ‡å‘ .NET SDK çš„ SDKs ç›®å½•ï¼ˆå¦‚Â C:\\Program Files\\dotnet\\sdk\\6.0.400\\Sdksï¼‰ã€‚ 5. è¯¯åŒº 5ï¼šè¿‡åº¦ä½¿ç”¨ä½çº§ API å¤„ç†é¡¹ç›®çº§åœºæ™¯ é”™è¯¯åœºæ™¯ï¼šç”¨Â CSharpSyntaxTreeÂ è§£æå¤šä¸ªæ–‡ä»¶ï¼Œæ‰‹åŠ¨å¤„ç†æ–‡ä»¶é—´å¼•ç”¨ï¼› é¿å‘ï¼šé¡¹ç›®çº§åœºæ™¯ï¼ˆè·¨æ–‡ä»¶åˆ†æã€å¼•ç”¨è§£æï¼‰ä¼˜å…ˆä½¿ç”¨Â MSBuildWorkspaceÂ æˆ–Â AdhocWorkspaceï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†ä¾èµ–å…³ç³»ã€‚ å…­ã€ä¸ C++ ç±»ä¼¼å·¥å…·çš„å¯¹æ¯”æ€»ç»“ ç‰¹æ€§ C# Roslyn API C++ Clang LibTooling C++ ProtobufQt MOC æ ¸å¿ƒç”¨é€” ä»£ç è§£æ åˆ†æ é‡æ„ ç”Ÿæˆ ä»£ç åˆ†æ é‡æ„ ä»£ç ç”Ÿæˆï¼ˆåºåˆ—åŒ– æ¡†æ¶é€‚é…ï¼‰ é¡¹ç›®æ”¯æŒ è‡ªåŠ¨åŠ è½½è§£å†³æ–¹æ¡ˆ é¡¹ç›®ï¼Œè§£æå¼•ç”¨ éœ€æ‰‹åŠ¨é…ç½®ç¼–è¯‘æ•°æ®åº“ï¼Œè·¨æ–‡ä»¶æ”¯æŒå¼± ä»…æ”¯æŒå•ä¸€æ–‡ä»¶ç”Ÿæˆï¼Œæ— é¡¹ç›®ä¾èµ–ç®¡ç† æ˜“ç”¨æ€§ å¼ºç±»å‹ APIï¼Œæ— éœ€å†…å­˜ç®¡ç†ï¼Œæ–‡æ¡£å®Œå–„ è£¸æŒ‡é’ˆæ“ä½œï¼ŒAPI å¤æ‚ï¼Œæ–‡æ¡£é›¶æ•£ éœ€ç¼–å†™å®šä¹‰æ–‡ä»¶ï¼Œç”Ÿæˆé€»è¾‘å›ºå®šï¼Œçµæ´»æ€§ä½ ä»£ç ä¿®æ”¹ æ”¯æŒè¯­æ³•æ ‘ä¿®æ”¹ä¸å›å†™ï¼Œå®‰å…¨æ— å‰¯ä½œç”¨ éœ€æ‰‹åŠ¨åˆ›å»ºæ–° AST èŠ‚ç‚¹ï¼Œæ˜“å†…å­˜æ³„æ¼ ä¸æ”¯æŒä¿®æ”¹ç°æœ‰ä»£ç ï¼Œä»…ç”Ÿæˆæ–°ä»£ç  ç”Ÿæ€é›†æˆ æ— ç¼é›†æˆ Visual StudioVS Codeã€.NET ç”Ÿæ€ éœ€æ‰‹åŠ¨é›†æˆåˆ° IDE æ„å»ºæµç¨‹ï¼Œç”Ÿæ€åˆ†æ•£ é›†æˆåˆ°æ„å»ºæµç¨‹ï¼Œä½†æ—  IDE å®æ—¶æ”¯æŒ ä¸ƒã€æœ€ä½³å®è·µï¼ˆé¢å‘ C++ ç¨‹åºå‘˜çš„è¿ç§»å»ºè®®ï¼‰ æŒ‰åœºæ™¯é€‰æ‹© API å±‚çº§ï¼š å•æ–‡ä»¶è§£æ è½»é‡çº§ç”Ÿæˆï¼šç”¨ä½çº§ APIï¼ˆCSharpSyntaxTreeï¼‰ï¼› é¡¹ç›®çº§åˆ†æ é‡æ„ IDE æ’ä»¶ï¼šç”¨é«˜çº§ APIï¼ˆMSBuildWorkspaceï¼‰ã€‚ ä¼˜å…ˆä½¿ç”¨é«˜çº§ API å¤„ç†é¡¹ç›®ï¼šé¿å…æ‰‹åŠ¨é…ç½®å¼•ç”¨å’Œç¼–è¯‘é€‰é¡¹ï¼Œå‡å°‘é‡å¤å·¥ä½œã€‚ åˆ©ç”¨ Roslyn çš„ Immutable ç‰¹æ€§ï¼šä¿®æ”¹ä»£ç æ—¶ï¼Œé€šè¿‡åˆ›å»ºæ–°èŠ‚ç‚¹æ›¿æ¢æ—§èŠ‚ç‚¹ï¼Œé¿å…å‰¯ä½œç”¨ã€‚ å€ŸåŠ©è¯­æ³•ç”Ÿæˆå™¨ç®€åŒ–ä»£ç ç”Ÿæˆï¼šä½¿ç”¨Â SyntaxFactoryÂ ç”Ÿæˆä»£ç ï¼Œè€Œéæ‹¼æ¥å­—ç¬¦ä¸²ï¼ˆé¿å…è¯­æ³•é”™è¯¯ï¼Œæ”¯æŒæ ¼å¼åŒ–ï¼‰ã€‚ è°ƒè¯•è¯­æ³•æ ‘ï¼šä½¿ç”¨Â syntaxTree.GetRoot().ToString()Â è¾“å‡ºå®Œæ•´è¯­æ³•æ ‘ï¼Œæˆ–ç”¨ Visual Studio çš„ â€œè¯­æ³•å¯è§†åŒ–å·¥å…·â€ æŸ¥çœ‹èŠ‚ç‚¹ç»“æ„ã€‚ å‚è€ƒå®˜æ–¹ç¤ºä¾‹ï¼šRoslyn å®˜æ–¹æä¾›å¤§é‡ç¤ºä¾‹ï¼ˆRoslyn Samplesï¼‰ï¼Œè¦†ç›–åˆ†æã€é‡æ„ã€ç”Ÿæˆç­‰åœºæ™¯ã€‚ æ€»ç»“å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼ŒRoslyn API çš„æ ¸å¿ƒä»·å€¼æ˜¯Â â€œå°†ç¼–è¯‘å™¨èƒ½åŠ›å¯ç¼–ç¨‹åŒ–ï¼Œä¸”æ— éœ€å…³æ³¨åº•å±‚ç»†èŠ‚â€ï¼š å®ƒæ‰“ç ´äº† C++ ç¼–è¯‘å™¨ â€œé»‘ç›’â€ çš„å±€é™ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿç›´æ¥æ“ä½œä»£ç çš„ç»“æ„å’Œå«ä¹‰ï¼Œå®ç°ä»£ç åˆ†æã€é‡æ„ã€ç”Ÿæˆç­‰é«˜çº§åŠŸèƒ½ï¼› ä¸ C++ çš„ Clang LibTooling ç›¸æ¯”ï¼ŒRoslyn API æ›´ç®€æ´ã€ç±»å‹å®‰å…¨ã€æ— éœ€å†…å­˜ç®¡ç†ï¼Œä¸”é¡¹ç›®æ”¯æŒæ›´å®Œå–„ï¼› ä¸ C++ çš„ä»£ç ç”Ÿæˆå·¥å…·ï¼ˆå¦‚ Protobufï¼‰ç›¸æ¯”ï¼ŒRoslyn æ›´çµæ´»ï¼Œæ”¯æŒåŠ¨æ€ä¿®æ”¹ç°æœ‰ä»£ç ï¼Œè€Œéä»…ç”Ÿæˆæ–°ä»£ç ï¼› æ ¸å¿ƒåœºæ™¯åŒ…æ‹¬é™æ€ä»£ç åˆ†æã€è‡ªåŠ¨åŒ–é‡æ„ã€ä»£ç ç”Ÿæˆã€IDE æ’ä»¶å¼€å‘ï¼Œè¿™äº›åœºæ™¯åœ¨ C++ ä¸­éœ€å¤šä¸ªå·¥å…·æ‹¼æ¥å®ç°ï¼Œè€Œ Roslyn ç”¨ä¸€å¥— API å³å¯å®Œæˆã€‚ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼Œè¿ç§»åˆ° Roslyn API åªéœ€è½¬å˜ â€œç¼–è¯‘å™¨æ˜¯é»‘ç›’â€ çš„æ€ç»´ï¼Œå°†ä»£ç è§†ä¸º â€œå¯ç¼–ç¨‹çš„è¯­æ³•æ ‘å’Œè¯­ä¹‰æ¨¡å‹â€ï¼Œå³å¯å¿«é€Ÿåˆ©ç”¨ Roslyn å®ç°å¤æ‚çš„ä»£ç è‡ªåŠ¨åŒ–å·¥å…·ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"å†…å­˜ç®¡ç†","path":"/2025/11/26/2-ç¼–ç¨‹è¯­è¨€-CSharp-å†…å­˜ç®¡ç†/","content":"C# å†…å­˜ç®¡ç†ï¼šè‡ªåŠ¨ GC ä¸æ‰‹åŠ¨è¾…åŠ©çš„å®Œæ•´æŒ‡å—ï¼ˆé¢å‘ C++ ç¨‹åºå‘˜ï¼‰C# çš„å†…å­˜ç®¡ç†æ ¸å¿ƒæ˜¯Â â€œè‡ªåŠ¨åƒåœ¾å›æ”¶ï¼ˆGCï¼‰ä¸ºä¸»ï¼Œæ‰‹åŠ¨è¾…åŠ©ä¸ºè¾…â€â€”â€” æ‰˜ç®¡å†…å­˜ï¼ˆå¼•ç”¨ç±»å‹å¯¹è±¡ï¼‰ç”± .NET åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰è‡ªåŠ¨åˆ†é…å’Œå›æ”¶ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨Â deleteï¼›éæ‰˜ç®¡å†…å­˜ï¼ˆå¦‚æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ã€COM å¯¹è±¡ï¼‰éœ€æ‰‹åŠ¨ç®¡ç†ï¼ˆé€šè¿‡Â IDisposableÂ ç­‰æœºåˆ¶ï¼‰ã€‚ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™æ˜¯ä¸ C++ æ‰‹åŠ¨å†…å­˜ç®¡ç†ï¼ˆnewdelete æ™ºèƒ½æŒ‡é’ˆï¼‰çš„æ ¸å¿ƒå·®å¼‚ï¼šC# è§£æ”¾äº† â€œæ‰‹åŠ¨é‡Šæ”¾å†…å­˜â€ çš„è´Ÿæ‹…ï¼ŒåŒæ—¶é€šè¿‡æ˜ç¡®çš„è§„åˆ™é¿å…å†…å­˜æ³„æ¼ï¼Œå¹³è¡¡äº†å¼€å‘æ•ˆç‡å’Œå®‰å…¨æ€§ã€‚ ä¸€ã€æ ¸å¿ƒå‰æï¼šC# çš„å†…å­˜åˆ†åŒºï¼ˆä¸ C++ å¯¹æ¯”ï¼‰C# ç¨‹åºè¿è¡Œæ—¶å†…å­˜åˆ†ä¸ºÂ æ ˆï¼ˆStackï¼‰ã€æ‰˜ç®¡å †ï¼ˆManaged Heapï¼‰ã€éæ‰˜ç®¡å †ï¼ˆUnmanaged Heapï¼‰Â ä¸‰å¤§åŒºåŸŸï¼Œä¸ C++ çš„å†…å­˜æ¨¡å‹æ—¢æœ‰ç›¸ä¼¼æ€§ï¼Œä¹Ÿæœ‰å…³é”®å·®å¼‚ï¼š å†…å­˜åŒºåŸŸ å­˜å‚¨å†…å®¹ åˆ†é… å›æ”¶æœºåˆ¶ C++ ç±»æ¯” æ ¸å¿ƒå·®å¼‚ æ ˆï¼ˆStackï¼‰ 1. å€¼ç±»å‹å®ä¾‹ï¼ˆstructã€intã€boolÂ ç­‰ï¼‰ï¼›2. å¼•ç”¨ç±»å‹çš„å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰ï¼›3. æ–¹æ³•å‚æ•°ã€å±€éƒ¨å˜é‡ è‡ªåŠ¨åˆ†é…ï¼ˆå‹æ ˆï¼‰ã€è‡ªåŠ¨å›æ”¶ï¼ˆå‡ºæ ˆï¼‰ï¼›é€Ÿåº¦æå¿«ï¼Œå¤§å°æœ‰é™ åŒ C++ æ ˆï¼ˆå­˜å‚¨å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°ï¼‰ æ— å·®å¼‚ï¼Œå‡éµå¾ª â€œå…ˆè¿›åå‡ºâ€ åŸåˆ™ æ‰˜ç®¡å †ï¼ˆManaged Heapï¼‰ å¼•ç”¨ç±»å‹å®ä¾‹ï¼ˆclassã€recordã€stringÂ ç­‰ï¼‰ è‡ªåŠ¨åˆ†é…ï¼ˆnewÂ å…³é”®å­—ï¼‰ã€è‡ªåŠ¨å›æ”¶ï¼ˆGCï¼‰ï¼›å¤§å°çµæ´»ï¼Œéœ€ GC æ‰«æ C++ å †ï¼ˆnewÂ åˆ†é…çš„å¯¹è±¡ï¼‰ C++ éœ€æ‰‹åŠ¨Â deleteï¼ŒC# ç”± GC è‡ªåŠ¨å›æ”¶ éæ‰˜ç®¡å †ï¼ˆUnmanaged Heapï¼‰ éæ‰˜ç®¡èµ„æºï¼ˆæ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ã€COM å¯¹è±¡ã€unsafeÂ ä»£ç åˆ†é…çš„å†…å­˜ï¼‰ æ‰‹åŠ¨åˆ†é…ï¼ˆå¦‚Â Marshal.AllocHGlobalï¼‰ã€æ‰‹åŠ¨å›æ”¶ï¼ˆå¦‚Â Marshal.FreeHGlobalï¼‰ åŒ C++ å †ï¼ˆéæ‰˜ç®¡éƒ¨åˆ†ï¼‰ ä¸¤è€…å‡éœ€æ‰‹åŠ¨ç®¡ç†ï¼Œå¦åˆ™å†…å­˜æ³„æ¼ å…³é”®æ¦‚å¿µæ¾„æ¸… å€¼ç±»å‹ vs å¼•ç”¨ç±»å‹çš„å­˜å‚¨å·®å¼‚ï¼ˆC# æ ¸å¿ƒåŸºç¡€ï¼Œç›´æ¥å½±å“å†…å­˜ç®¡ç†ï¼‰ï¼š csharp è¿è¡Œ // 1. å€¼ç±»å‹ï¼ˆstructï¼‰ï¼šå®ä¾‹å­˜å‚¨åœ¨æ ˆä¸Šï¼ˆå±€éƒ¨å˜é‡ï¼‰æˆ–æ‰˜ç®¡å †ï¼ˆä½œä¸º class å­—æ®µæ—¶ï¼‰struct Point public int X; public int Y; Point p1 = new Point X = 10, Y = 20 ; // p1 å®ä¾‹åœ¨æ ˆä¸Šï¼ˆå±€éƒ¨å˜é‡ï¼‰// 2. å¼•ç”¨ç±»å‹ï¼ˆclassï¼‰ï¼šå®ä¾‹å­˜å‚¨åœ¨æ‰˜ç®¡å †ï¼Œå˜é‡å­˜å‚¨â€œå¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰â€ï¼ˆæ ˆä¸Šï¼‰class Cat public string Name; Cat cat1 = new Cat Name = Fritz ; // cat1ï¼ˆå¼•ç”¨ï¼‰åœ¨æ ˆä¸Šï¼ŒCat å®ä¾‹åœ¨æ‰˜ç®¡å † C++ ç±»æ¯”ç†è§£ï¼š cpp è¿è¡Œ // C++ ä¸­æ— â€œæ‰˜ç®¡å †â€æ¦‚å¿µï¼Œæ‰€æœ‰å †å¯¹è±¡éœ€æ‰‹åŠ¨é‡Šæ”¾struct Point int X; int Y; ;Point p1 = 10, 20; // æ ˆä¸Šï¼ˆåŒ C#ï¼‰Cat* cat1 = new CatFritz; // å †ä¸Šåˆ†é…ï¼ˆåŒ C# æ‰˜ç®¡å †ï¼‰ï¼Œä½†éœ€æ‰‹åŠ¨ deletedelete cat1; // C++ å¿…é¡»æ‰‹åŠ¨é‡Šæ”¾ï¼ŒC# æ— éœ€ äºŒã€è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼šåƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰å·¥ä½œåŸç†C# çš„ GC æ˜¯ .NET è¿è¡Œæ—¶ï¼ˆCLRï¼‰çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£Â è‡ªåŠ¨å›æ”¶æ‰˜ç®¡å †ä¸Š â€œæ— å¼•ç”¨â€ çš„å¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚å…¶å·¥ä½œæœºåˆ¶å¯ç±»æ¯”ä¸º â€œè‡ªåŠ¨æ¸…ç†æˆ¿é—´çš„æ¸…æ´å·¥â€â€”â€” å®šæœŸæ‰«ææˆ¿é—´ï¼ˆæ‰˜ç®¡å †ï¼‰ï¼ŒæŠŠæ²¡äººç”¨çš„ç‰©å“ï¼ˆæ— å¼•ç”¨å¯¹è±¡ï¼‰æ¸…ç†æ‰ã€‚ 1. GC çš„æ ¸å¿ƒç›®æ ‡ å›æ”¶ â€œä¸å¯è¾¾â€ å¯¹è±¡ï¼šå³æ²¡æœ‰ä»»ä½•å¼•ç”¨æŒ‡å‘çš„æ‰˜ç®¡å¯¹è±¡ï¼› é¿å…å†…å­˜ç¢ç‰‡ï¼šå›æ”¶åæ•´ç†æ‰˜ç®¡å †ï¼Œå°†å­˜æ´»å¯¹è±¡ç´§å‡‘æ’åˆ—ï¼› å¹³è¡¡æ€§èƒ½ï¼šGC è¿è¡Œæ—¶ä¼šæš‚åœåº”ç”¨çº¿ç¨‹ï¼ˆâ€œStop-The-Worldï¼ŒSTWâ€ï¼‰ï¼Œä½†ä¼šé€šè¿‡ä¼˜åŒ–ï¼ˆå¦‚åˆ†ä»£å›æ”¶ï¼‰æœ€å°åŒ–æš‚åœæ—¶é—´ã€‚ 2. å…³é”®æœ¯è¯­ï¼šå¯¹è±¡çš„ â€œå¯è¾¾æ€§â€GC ä»…å›æ”¶Â ä¸å¯è¾¾å¯¹è±¡ï¼Œåˆ¤æ–­æ ‡å‡†æ˜¯ï¼šå¯¹è±¡æ˜¯å¦èƒ½é€šè¿‡ â€œæ ¹å¼•ç”¨â€ï¼ˆRoot Referenceï¼‰è®¿é—®åˆ°ã€‚æ ¹å¼•ç”¨åŒ…æ‹¬ï¼š å…¨å±€å˜é‡ã€é™æ€å˜é‡ï¼› æ–¹æ³•æ ˆä¸Šçš„å±€éƒ¨å˜é‡ã€å‚æ•°ï¼› CPU å¯„å­˜å™¨ä¸­çš„å¼•ç”¨ï¼› è¢«å…¶ä»–å¯è¾¾å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡ã€‚ ç¤ºä¾‹ï¼š csharp è¿è¡Œ Cat cat1 = new Cat Name = Fritz ; // cat1 æ˜¯æ ¹å¼•ç”¨ï¼ˆæ ˆä¸Šå±€éƒ¨å˜é‡ï¼‰ï¼ŒCat å®ä¾‹å¯è¾¾Cat cat2 = cat1; // cat2 ä¹ŸæŒ‡å‘è¯¥å®ä¾‹ï¼Œä»å¯è¾¾cat1 = null; // ç§»é™¤ä¸€ä¸ªå¼•ç”¨ï¼Œcat2 ä»æŒ‡å‘ï¼Œå®ä¾‹ä»å¯è¾¾cat2 = null; // ç§»é™¤æœ€åä¸€ä¸ªå¼•ç”¨ï¼Œå®ä¾‹ä¸å¯è¾¾ï¼ˆGC ä¼šå›æ”¶ï¼‰ 3. åˆ†ä»£å›æ”¶ï¼ˆGC çš„æ ¸å¿ƒä¼˜åŒ–ï¼‰GC é‡‡ç”¨Â åˆ†ä»£å›æ”¶ï¼ˆGenerational GCï¼‰Â ç­–ç•¥ï¼ŒåŸºäº â€œå¤§å¤šæ•°å¯¹è±¡å­˜æ´»æ—¶é—´çŸ­â€ çš„ç»Ÿè®¡è§„å¾‹ï¼Œå°†æ‰˜ç®¡å †å¯¹è±¡åˆ†ä¸º 3 ä»£ï¼ˆ0 ä»£ã€1 ä»£ã€2 ä»£ï¼‰ï¼Œä¼˜å…ˆå›æ”¶çŸ­å­˜æ´»å¯¹è±¡ï¼Œå‡å°‘æ‰«æèŒƒå›´ï¼š ä»£æ¬¡ å­˜å‚¨å¯¹è±¡ å›æ”¶é¢‘ç‡ å›æ”¶æˆæœ¬ 0 ä»£ æ–°åˆ†é…çš„å¯¹è±¡ï¼ˆæœªè¢«å›æ”¶è¿‡ï¼‰ æœ€é«˜ï¼ˆé¢‘ç¹ï¼‰ æœ€ä½ï¼ˆæ‰«æèŒƒå›´å°ï¼‰ 1 ä»£ 0 ä»£å›æ”¶åå­˜æ´»çš„å¯¹è±¡ï¼ˆâ€œè¿‡æ¸¡ä»£â€ï¼‰ ä¸­ç­‰ ä¸­ç­‰ 2 ä»£ 1 ä»£å›æ”¶åå­˜æ´»çš„å¯¹è±¡ï¼ˆé•¿å­˜æ´»å¯¹è±¡ï¼‰ æœ€ä½ï¼ˆç½•è§ï¼‰ æœ€é«˜ï¼ˆæ‰«æèŒƒå›´å¤§ï¼‰ åˆ†ä»£å›æ”¶æµç¨‹ï¼ˆç®€åŒ–ï¼‰ï¼š æ–°å¯¹è±¡åˆ†é…åˆ° 0 ä»£ï¼› 0 ä»£å†…å­˜å æ»¡æ—¶ï¼Œè§¦å‘ 0 ä»£å›æ”¶ï¼šæ ‡è®°ä¸å¯è¾¾å¯¹è±¡ â†’ å›æ”¶å†…å­˜ â†’ æ•´ç†å­˜æ´»å¯¹è±¡åˆ° 1 ä»£ï¼› 1 ä»£å†…å­˜å æ»¡æ—¶ï¼Œè§¦å‘ 1 ä»£å›æ”¶ï¼ˆåŒæ—¶æ‰«æ 0 ä»£ï¼‰ï¼Œå­˜æ´»å¯¹è±¡è¿›å…¥ 2 ä»£ï¼› 2 ä»£å†…å­˜å æ»¡æ—¶ï¼Œè§¦å‘ â€œå®Œå…¨å›æ”¶â€ï¼ˆæ‰«ææ‰€æœ‰ä»£ï¼‰ï¼Œè¿™æ˜¯æœ€è€—æ—¶çš„ GC æ“ä½œã€‚ 4. GC è§¦å‘æ—¶æœº è‡ªåŠ¨è§¦å‘ï¼š0 ä»£ 1 ä»£ 2 ä»£å†…å­˜å æ»¡ï¼› æ‰‹åŠ¨è§¦å‘ï¼šè°ƒç”¨Â GC.Collect()ï¼ˆä¸æ¨èï¼Œé™¤éç‰¹æ®Šåœºæ™¯ï¼‰ï¼› ç³»ç»Ÿè§¦å‘ï¼šç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼ŒCLR ä¼šè§¦å‘ GCã€‚ æ³¨æ„ï¼šC++ æ—  GCï¼Œéœ€æ‰‹åŠ¨é€šè¿‡Â deleteunique_ptrshared_ptrÂ ç®¡ç†å †å†…å­˜ï¼Œè€Œ C# æ— éœ€å¹²é¢„ GC è§¦å‘ï¼ˆæ‰‹åŠ¨è°ƒç”¨Â GC.Collect()Â ä¼šç ´ååˆ†ä»£ä¼˜åŒ–ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼‰ã€‚ ä¸‰ã€å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹çš„å†…å­˜è¡¨ç°ï¼ˆé¿å‘æ ¸å¿ƒï¼‰C++ ç¨‹åºå‘˜å®¹æ˜“æ··æ·† C# ä¸­å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„å†…å­˜å­˜å‚¨ï¼Œè¿™é‡Œç”¨å…·ä½“ç¤ºä¾‹å¯¹æ¯”ï¼Œæ˜ç¡®å·®å¼‚ï¼š 1. å€¼ç±»å‹çš„å†…å­˜è¡¨ç° å±€éƒ¨å˜é‡ï¼šå­˜å‚¨åœ¨æ ˆä¸Šï¼Œæ–¹æ³•æ‰§è¡Œå®Œæ¯•åè‡ªåŠ¨å‡ºæ ˆå›æ”¶ï¼› ä½œä¸ºå¼•ç”¨ç±»å‹å­—æ®µï¼šå­˜å‚¨åœ¨æ‰˜ç®¡å †ï¼ˆéšå¼•ç”¨ç±»å‹å®ä¾‹ä¸€èµ·åˆ†é…å’Œå›æ”¶ï¼‰ï¼› èµ‹å€¼è¡Œä¸ºï¼šå¤åˆ¶æ•´ä¸ªå®ä¾‹ï¼ˆæ·±æ‹·è´ï¼‰ã€‚ ç¤ºä¾‹ï¼š csharp è¿è¡Œ struct Point public int X; public int Y; Point p1 = new Point X = 10, Y = 20 ;Point p2 = p1; // å¤åˆ¶æ•´ä¸ªå®ä¾‹ï¼ˆæ ˆä¸Šæ•°æ®æ‹·è´ï¼‰p2.X = 30; // ä¿®æ”¹ p2 ä¸å½±å“ p1Console.WriteLine(p1.X); // è¾“å‡º 10ï¼ˆp1 æœªå˜ï¼‰Console.WriteLine(p2.X); // è¾“å‡º 30ï¼ˆp2 å·²æ”¹ï¼‰ C++ ç±»æ¯”ï¼šä¸ C++ çš„Â structÂ å®Œå…¨ä¸€è‡´ï¼ˆå€¼è¯­ä¹‰ï¼Œèµ‹å€¼æ‹·è´ï¼‰ã€‚ 2. å¼•ç”¨ç±»å‹çš„å†…å­˜è¡¨ç° å®ä¾‹å­˜å‚¨åœ¨æ‰˜ç®¡å †ï¼Œå˜é‡å­˜å‚¨ â€œå¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰â€ï¼› èµ‹å€¼è¡Œä¸ºï¼šå¤åˆ¶å¼•ç”¨ï¼ˆæµ…æ‹·è´ï¼‰ï¼Œä¸¤ä¸ªå˜é‡æŒ‡å‘åŒä¸€ä¸ªå®ä¾‹ï¼› å›æ”¶æ—¶æœºï¼šå½“æ‰€æœ‰å¼•ç”¨éƒ½æ–­å¼€ï¼ˆæŒ‡å‘Â nullÂ æˆ–è¶…å‡ºä½œç”¨åŸŸï¼‰ï¼Œå®ä¾‹å˜ä¸ºä¸å¯è¾¾ï¼Œç­‰å¾… GC å›æ”¶ã€‚ ç¤ºä¾‹ï¼š csharp è¿è¡Œ class Cat public string Name; Cat cat1 = new Cat Name = Fritz ;Cat cat2 = cat1; // å¤åˆ¶å¼•ç”¨ï¼ˆæ ˆä¸ŠæŒ‡é’ˆæ‹·è´ï¼‰ï¼Œä¸¤è€…æŒ‡å‘åŒä¸€ä¸ªæ‰˜ç®¡å †å®ä¾‹cat2.Name = Boots; // ä¿®æ”¹ cat2 ä¼šå½±å“ cat1Console.WriteLine(cat1.Name); // è¾“å‡º Bootsï¼ˆåŒä¸€å®ä¾‹ï¼‰Console.WriteLine(cat2.Name); // è¾“å‡º Boots C++ ç±»æ¯”ï¼š cpp è¿è¡Œ class Cat public: string Name; ;Cat* cat1 = new CatFritz;Cat* cat2 = cat1; // å¤åˆ¶æŒ‡é’ˆï¼ˆåŒ C# å¼•ç”¨æ‹·è´ï¼‰cat2-Name = Boots; // ä¸¤è€…æŒ‡å‘åŒä¸€å®ä¾‹ï¼Œcat1-Name ä¹Ÿå˜ä¸º Bootsdelete cat1; // C++ éœ€æ‰‹åŠ¨é‡Šæ”¾ï¼ŒC# æ— éœ€ 3. å¸¸è§è¯¯åŒºï¼šstring æ˜¯å¼•ç”¨ç±»å‹ï¼Œä½†æœ‰ â€œå€¼è¯­ä¹‰â€stringÂ æ˜¯ C# ä¸­çš„ç‰¹æ®Šå¼•ç”¨ç±»å‹ï¼š å®ä¾‹å­˜å‚¨åœ¨æ‰˜ç®¡å †ï¼Œå˜é‡å­˜å‚¨å¼•ç”¨ï¼› ä½†Â stringÂ æ˜¯Â ä¸å¯å˜çš„ï¼ˆä¿®æ”¹æ—¶ä¼šåˆ›å»ºæ–°å®ä¾‹ï¼Œè€Œéä¿®æ”¹åŸå®ä¾‹ï¼‰ï¼Œè¡¨ç°å‡ºå€¼è¯­ä¹‰ï¼š csharp è¿è¡Œ string s1 = Hello;string s2 = s1; // å¤åˆ¶å¼•ç”¨ï¼ŒæŒ‡å‘åŒä¸€ä¸ªå®ä¾‹s2 = s2 + World; // ä¸å¯å˜ï¼šåˆ›å»ºæ–°å®ä¾‹ï¼Œs2 æŒ‡å‘æ–°å®ä¾‹ï¼Œs1 ä»æŒ‡å‘åŸå®ä¾‹Console.WriteLine(s1); // è¾“å‡º Helloï¼ˆåŸå®ä¾‹æœªå˜ï¼‰Console.WriteLine(s2); // è¾“å‡º Hello Worldï¼ˆæ–°å®ä¾‹ï¼‰ C++ ç±»æ¯”ï¼šç±»ä¼¼Â std::stringï¼ˆä¸å¯å˜è¯­ä¹‰ï¼‰ï¼Œä½†Â std::stringÂ æ˜¯å€¼ç±»å‹ï¼ˆå­˜å‚¨åœ¨æ ˆ å †ï¼Œå–å†³äºå®ç°ï¼‰ï¼Œè€Œ C#Â stringÂ æ˜¯å¼•ç”¨ç±»å‹ï¼ˆå­˜å‚¨åœ¨æ‰˜ç®¡å †ï¼‰ã€‚ å››ã€æ‰‹åŠ¨å†…å­˜ç®¡ç†ï¼šéæ‰˜ç®¡èµ„æºçš„é‡Šæ”¾GC ä»…è´Ÿè´£Â æ‰˜ç®¡å†…å­˜ï¼ˆå¼•ç”¨ç±»å‹å®ä¾‹ï¼‰çš„å›æ”¶ï¼Œæ— æ³•å¤„ç†Â éæ‰˜ç®¡èµ„æºï¼ˆå¦‚æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ã€COM å¯¹è±¡ã€unsafeÂ ä»£ç åˆ†é…çš„å†…å­˜ï¼‰â€”â€” è¿™äº›èµ„æºéœ€æ‰‹åŠ¨é‡Šæ”¾ï¼Œå¦åˆ™ä¼šå¯¼è‡´èµ„æºæ³„æ¼ï¼ˆå³ä½¿è¿›ç¨‹é€€å‡ºï¼Œä¹Ÿå¯èƒ½æ®‹ç•™ç³»ç»Ÿèµ„æºå ç”¨ï¼‰ã€‚ C# æä¾›ä¸¤ç§æ ¸å¿ƒæœºåˆ¶å¤„ç†éæ‰˜ç®¡èµ„æºï¼š**IDisposableÂ æ¥å£**ï¼ˆæ¨èï¼‰å’ŒÂ ææ„å‡½æ•°ï¼ˆFinalizerï¼‰ï¼ˆå…œåº•ï¼‰ã€‚ 1. IDisposable æ¥å£ï¼ˆæ¨èæ–¹æ¡ˆï¼‰IDisposableÂ æ˜¯ .NET ä¸­é‡Šæ”¾éæ‰˜ç®¡èµ„æºçš„æ ‡å‡†æ¥å£ï¼Œæ ¸å¿ƒæ˜¯Â Dispose()Â æ–¹æ³• â€”â€” æ‰‹åŠ¨è°ƒç”¨è¯¥æ–¹æ³•é‡Šæ”¾èµ„æºï¼Œé…åˆÂ usingÂ è¯­å¥å¯è‡ªåŠ¨è°ƒç”¨ï¼ˆé¿å…é—æ¼ï¼‰ã€‚ æ ¸å¿ƒç”¨æ³•ï¼šå®ç° IDisposablecsharp è¿è¡Œ // ç®¡ç†éæ‰˜ç®¡èµ„æºçš„ç±»ï¼ˆå¦‚æ–‡ä»¶æ“ä½œï¼‰public class FileHandler : IDisposable // éæ‰˜ç®¡èµ„æºï¼ˆå¦‚æ–‡ä»¶å¥æŸ„ï¼Œè¿™é‡Œç”¨ IntPtr æ¨¡æ‹Ÿï¼‰ private IntPtr _fileHandle; // æ‰˜ç®¡èµ„æºï¼ˆå¯é€‰ï¼‰ private StreamReader _reader; // æ ‡è®°æ˜¯å¦å·²é‡Šæ”¾ï¼ˆé¿å…é‡å¤é‡Šæ”¾ï¼‰ private bool _disposed = false; // æ„é€ å‡½æ•°ï¼šåˆ†é…éæ‰˜ç®¡èµ„æº public FileHandler(string filePath) // æ¨¡æ‹Ÿæ‰“å¼€æ–‡ä»¶ï¼Œè·å–æ–‡ä»¶å¥æŸ„ï¼ˆéæ‰˜ç®¡èµ„æºï¼‰ _fileHandle = Marshal.AllocHGlobal(4); // æ‰‹åŠ¨åˆ†é…éæ‰˜ç®¡å†…å­˜ _reader = new StreamReader(filePath); // æ‰˜ç®¡èµ„æº // å®ç° IDisposableï¼šæ‰‹åŠ¨é‡Šæ”¾èµ„æº public void Dispose() Dispose(true); // å‘ŠçŸ¥ GCï¼šæ— éœ€è°ƒç”¨ææ„å‡½æ•°ï¼ˆèµ„æºå·²æ‰‹åŠ¨é‡Šæ”¾ï¼‰ GC.SuppressFinalize(this); // æ ¸å¿ƒé‡Šæ”¾é€»è¾‘ï¼ˆåˆ†ç¦»æ‰˜ç®¡/éæ‰˜ç®¡èµ„æºé‡Šæ”¾ï¼‰ protected virtual void Dispose(bool disposing) if (_disposed) return; // 1. é‡Šæ”¾æ‰˜ç®¡èµ„æºï¼ˆä»…å½“ disposing ä¸º true æ—¶ï¼Œå³æ‰‹åŠ¨è°ƒç”¨ Dispose()ï¼‰ if (disposing) _reader?.Dispose(); // é‡Šæ”¾æ‰˜ç®¡èµ„æºï¼ˆStreamReader å®ç°äº† IDisposableï¼‰ // 2. é‡Šæ”¾éæ‰˜ç®¡èµ„æºï¼ˆæ— è®º disposing æ˜¯ true/falseï¼Œéƒ½å¿…é¡»é‡Šæ”¾ï¼‰ if (_fileHandle != IntPtr.Zero) Marshal.FreeHGlobal(_fileHandle); // æ‰‹åŠ¨é‡Šæ”¾éæ‰˜ç®¡å†…å­˜ _fileHandle = IntPtr.Zero; _disposed = true; // ææ„å‡½æ•°ï¼ˆFinalizerï¼‰ï¼šå…œåº•é‡Šæ”¾éæ‰˜ç®¡èµ„æºï¼ˆé˜²æ­¢æœªè°ƒç”¨ Dispose()ï¼‰ ~FileHandler() Dispose(false); // disposing = falseï¼šä»…é‡Šæ”¾éæ‰˜ç®¡èµ„æº æ­£ç¡®ä½¿ç”¨ï¼šusing è¯­å¥ï¼ˆè‡ªåŠ¨è°ƒç”¨ Dispose ()ï¼‰usingÂ è¯­å¥æ˜¯ C# ä¸­ä½¿ç”¨Â IDisposableÂ ç±»å‹çš„æœ€ä½³å®è·µ â€”â€” ä¼šè‡ªåŠ¨åœ¨ä»£ç å—ç»“æŸåè°ƒç”¨Â Dispose()ï¼Œå³ä½¿å‘ç”Ÿå¼‚å¸¸ï¼š csharp è¿è¡Œ // æ–¹å¼1ï¼šusing ä»£ç å—ï¼ˆé€‚åˆå¤šè¯­å¥ï¼‰using (var fileHandler = new FileHandler(test.txt)) // æ“ä½œæ–‡ä»¶ Console.WriteLine(fileHandler.ReadContent()); // è‡ªåŠ¨è°ƒç”¨ fileHandler.Dispose()// æ–¹å¼2ï¼šusing å£°æ˜ï¼ˆC# 8.0+ï¼Œç®€æ´ï¼‰using var fileHandler = new FileHandler(test.txt);Console.WriteLine(fileHandler.ReadContent());// ä»£ç å—ç»“æŸï¼ˆå¦‚æ–¹æ³•è¿”å›ï¼‰æ—¶è‡ªåŠ¨è°ƒç”¨ Dispose() 2. ææ„å‡½æ•°ï¼ˆFinalizerï¼‰ï¼šå…œåº•æœºåˆ¶ææ„å‡½æ•°æ˜¯ C# ä¸­çš„ â€œfinalizerâ€ï¼Œè¯­æ³•æ˜¯Â ~ç±»å()ï¼Œä½œç”¨æ˜¯Â å…œåº•é‡Šæ”¾éæ‰˜ç®¡èµ„æºâ€”â€” å½“å¼€å‘è€…å¿˜è®°è°ƒç”¨Â Dispose()Â æ—¶ï¼ŒGC ä¼šåœ¨å›æ”¶å¯¹è±¡å‰è°ƒç”¨ææ„å‡½æ•°ã€‚ å…³é”®æ³¨æ„äº‹é¡¹ï¼š ä»…ç”¨äºé‡Šæ”¾éæ‰˜ç®¡èµ„æºï¼Œä¸å¯é‡Šæ”¾æ‰˜ç®¡èµ„æºï¼ˆGC ä¼šè‡ªåŠ¨å›æ”¶ï¼‰ï¼› ææ„å‡½æ•°ç”± GC è°ƒç”¨ï¼Œè°ƒç”¨æ—¶æœºä¸ç¡®å®šï¼ˆå¯èƒ½å»¶è¿Ÿå¾ˆä¹…ï¼‰ï¼› å®ç°Â IDisposableÂ æ—¶ï¼Œéœ€é…åˆÂ GC.SuppressFinalize(this)Â é¿å…é‡å¤é‡Šæ”¾ï¼ˆæ‰‹åŠ¨Â Dispose()Â åï¼Œæ— éœ€å†è°ƒç”¨ææ„å‡½æ•°ï¼‰ã€‚ C++ å¯¹æ¯”ï¼šææ„å‡½æ•°çš„å·®å¼‚ ç‰¹æ€§ C# ææ„å‡½æ•°ï¼ˆFinalizerï¼‰ C++ ææ„å‡½æ•° è°ƒç”¨æ—¶æœº GC å›æ”¶å¯¹è±¡å‰ï¼ˆæ—¶æœºä¸ç¡®å®šï¼‰ å¯¹è±¡é”€æ¯æ—¶ï¼ˆæ ˆå¯¹è±¡å‡ºæ ˆã€å †å¯¹è±¡Â deleteï¼‰ ä½œç”¨ å…œåº•é‡Šæ”¾éæ‰˜ç®¡èµ„æº é‡Šæ”¾æ‰€æœ‰èµ„æºï¼ˆæ‰˜ç®¡ éæ‰˜ç®¡ï¼‰ è¯­æ³• ~ç±»å()ï¼ˆæ— å‚æ•°ã€æ— è¿”å›å€¼ï¼‰ ~ç±»å()ï¼ˆå¯é‡è½½ï¼Œæ”¯æŒå‚æ•°ï¼Ÿä¸ï¼ŒC++ ææ„æ— å‚æ•°ï¼‰ ä¸ GC å…³ç³» ä¾èµ– GC è°ƒç”¨ ä¸ä¾èµ– GCï¼ˆæ‰‹åŠ¨ç®¡ç†ï¼‰ 3. å¸¸è§éæ‰˜ç®¡èµ„æºåœºæ™¯ æ–‡ä»¶æ“ä½œï¼šFileStreamã€StreamReaderï¼ˆå·²å®ç°Â IDisposableï¼‰ï¼› ç½‘ç»œè¿æ¥ï¼šSocketã€HttpClientï¼ˆå·²å®ç°Â IDisposableï¼‰ï¼› COM å¯¹è±¡ï¼šå¦‚ Windows ç³»ç»Ÿç»„ä»¶ï¼ˆéœ€é€šè¿‡Â Marshal.ReleaseComObject()Â é‡Šæ”¾ï¼‰ï¼› unsafeÂ ä»£ç ï¼šæ‰‹åŠ¨åˆ†é…çš„éæ‰˜ç®¡å†…å­˜ï¼ˆMarshal.AllocHGlobalï¼‰ã€‚ äº”ã€å†…å­˜æ³„æ¼ï¼šåŸå› ä¸è§£å†³æ–¹æ¡ˆï¼ˆC++ ç¨‹åºå‘˜æ˜“è¸©å‘ç‚¹ï¼‰C# è™½æœ‰ GCï¼Œä½†ä»å¯èƒ½å‡ºç°å†…å­˜æ³„æ¼ â€”â€” æœ¬è´¨æ˜¯ â€œæ‰˜ç®¡å¯¹è±¡è¢«æ„å¤–ä¿æŒå¼•ç”¨ï¼Œå¯¼è‡´ GC æ— æ³•å›æ”¶â€ï¼Œæˆ– â€œéæ‰˜ç®¡èµ„æºæœªæ‰‹åŠ¨é‡Šæ”¾â€ã€‚ä»¥ä¸‹æ˜¯å¸¸è§æ³„æ¼åœºæ™¯åŠè§£å†³æ–¹æ¡ˆï¼š 1. åœºæ™¯ 1ï¼šé•¿ç”Ÿå‘½å‘¨æœŸå¼•ç”¨æ„å¤–æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ ç¤ºä¾‹ï¼šé™æ€é›†åˆå­˜å‚¨ä¸´æ—¶å¯¹è±¡ï¼ŒæœªåŠæ—¶ç§»é™¤ï¼› csharp è¿è¡Œ // é™æ€é›†åˆï¼ˆå…¨å±€ç”Ÿå‘½å‘¨æœŸï¼‰æŒæœ‰ Cat å®ä¾‹ï¼Œå¯¼è‡´å®ä¾‹æ— æ³•å›æ”¶public static ListCat GlobalCatList = new ListCat();public void AddTempCat() var cat = new Cat Name = Temp ; GlobalCatList.Add(cat); // é™æ€é›†åˆæŒæœ‰å¼•ç”¨ï¼Œcat å®ä¾‹æ°¸è¿œå¯è¾¾ï¼ˆå†…å­˜æ³„æ¼ï¼‰ è§£å†³æ–¹æ¡ˆï¼šä¸´æ—¶å¯¹è±¡ä½¿ç”¨åï¼Œä»é™æ€é›†åˆä¸­ç§»é™¤å¼•ç”¨ï¼ˆGlobalCatList.Remove(cat)ï¼‰ã€‚ 2. åœºæ™¯ 2ï¼šæœªé‡Šæ”¾éæ‰˜ç®¡èµ„æºï¼ˆæœªè°ƒç”¨ Dispose ()ï¼‰ ç¤ºä¾‹ï¼šä½¿ç”¨Â FileStreamÂ æœªç”¨Â usingï¼Œä¸”æœªæ‰‹åŠ¨Â Dispose()ï¼› csharp è¿è¡Œ // é”™è¯¯ï¼šæœªé‡Šæ”¾ FileStreamï¼ˆéæ‰˜ç®¡èµ„æºæ³„æ¼ï¼‰public void ReadFileBad() var stream = new FileStream(test.txt, FileMode.Open); var reader = new StreamReader(stream); string content = reader.ReadToEnd(); // æœªè°ƒç”¨ stream.Dispose() æˆ– reader.Dispose() è§£å†³æ–¹æ¡ˆï¼šå§‹ç»ˆç”¨Â usingÂ è¯­å¥åŒ…è£¹Â IDisposableÂ ç±»å‹ï¼Œæˆ–æ‰‹åŠ¨è°ƒç”¨Â Dispose()ã€‚ 3. åœºæ™¯ 3ï¼šäº‹ä»¶è®¢é˜…æœªå–æ¶ˆ ç¤ºä¾‹ï¼šçŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡è®¢é˜…é•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„äº‹ä»¶ï¼Œæœªå–æ¶ˆè®¢é˜…ï¼› csharp è¿è¡Œ public class Publisher public event Action OnEvent; public class Subscriber public Subscriber(Publisher publisher) publisher.OnEvent += HandleEvent; // é•¿ç”Ÿå‘½å‘¨æœŸå‘å¸ƒè€…var publisher = new Publisher();// çŸ­ç”Ÿå‘½å‘¨æœŸè®¢é˜…è€…ï¼ˆåˆ›å»ºåæœªå–æ¶ˆè®¢é˜…ï¼‰var subscriber = new Subscriber(publisher);subscriber = null; // è®¢é˜…è€…å¼•ç”¨ç½®ç©ºï¼Œä½†å‘å¸ƒè€…çš„äº‹ä»¶ä»æŒæœ‰è®¢é˜…è€…å¼•ç”¨ï¼ˆæ³„æ¼ï¼‰ è§£å†³æ–¹æ¡ˆï¼šè®¢é˜…è€…é”€æ¯å‰å–æ¶ˆäº‹ä»¶è®¢é˜…ï¼ˆpublisher.OnEvent -= HandleEventï¼‰ã€‚ 4. åœºæ™¯ 4ï¼šCOM å¯¹è±¡æœªé‡Šæ”¾ ç¤ºä¾‹ï¼šè°ƒç”¨ COM å¯¹è±¡ï¼ˆå¦‚ Excel åº”ç”¨ï¼‰åï¼Œæœªé‡Šæ”¾ COM å¼•ç”¨ï¼› csharp è¿è¡Œ // é”™è¯¯ï¼šCOM å¯¹è±¡æœªé‡Šæ”¾ï¼ˆéæ‰˜ç®¡èµ„æºæ³„æ¼ï¼‰public void UseExcelBad() dynamic excel = Activator.CreateInstance(Type.GetTypeFromProgID(Excel.Application)); excel.Visible = true; // æœªé‡Šæ”¾ COM å¯¹è±¡ è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨Â Marshal.ReleaseComObject()Â é‡Šæ”¾ COM å¼•ç”¨ï¼š csharp è¿è¡Œ public void UseExcelGood() dynamic excel = Activator.CreateInstance(Type.GetTypeFromProgID(Excel.Application)); try excel.Visible = true; finally Marshal.ReleaseComObject(excel); // é‡Šæ”¾ COM å¯¹è±¡ excel = null; 5. åœºæ™¯ 5ï¼šé—­åŒ…æ•è·æ„å¤–å¼•ç”¨ ç¤ºä¾‹ï¼šLambda è¡¨è¾¾å¼é—­åŒ…æ•è·å±€éƒ¨å˜é‡ï¼Œå¯¼è‡´å˜é‡æ‰€åœ¨å¯¹è±¡æ— æ³•å›æ”¶ï¼› csharp è¿è¡Œ public class MyClass public Action MyAction get; set; public MyClass() // é—­åŒ…æ•è· thisï¼ˆMyClass å®ä¾‹ï¼‰ MyAction = () = Console.WriteLine(this.GetType().Name); var myObj = new MyClass();var action = myObj.MyAction;myObj = null; // è™½ç½®ç©ºï¼Œä½† action ä»æŒæœ‰ myObj å¼•ç”¨ï¼ˆæ³„æ¼ï¼‰ è§£å†³æ–¹æ¡ˆï¼šé¿å…é—­åŒ…æ•è·ä¸å¿…è¦çš„å¼•ç”¨ï¼Œæˆ–åœ¨ä½¿ç”¨åé‡Šæ”¾Â actionÂ å¼•ç”¨ï¼ˆaction = nullï¼‰ã€‚ å…­ã€ä¸ C++ å†…å­˜ç®¡ç†çš„æ ¸å¿ƒå·®å¼‚æ€»ç»“ ç‰¹æ€§ C# å†…å­˜ç®¡ç† C++ å†…å­˜ç®¡ç† æ ¸å¿ƒä¼˜åŠ¿ï¼ˆC#ï¼‰ æ‰˜ç®¡å†…å­˜ç®¡ç† è‡ªåŠ¨ GC åˆ†é… å›æ”¶ï¼ˆæ— éœ€Â deleteï¼‰ æ‰‹åŠ¨Â newdeleteÂ æˆ–æ™ºèƒ½æŒ‡é’ˆ é¿å…å†…å­˜æ³„æ¼ã€åŒé‡é‡Šæ”¾ç­‰ä½çº§é”™è¯¯ éæ‰˜ç®¡å†…å­˜ç®¡ç† IDisposableÂ +Â usingÂ æ‰‹åŠ¨é‡Šæ”¾ ææ„å‡½æ•° + æ‰‹åŠ¨Â delete è¯­æ³•ç»Ÿä¸€ï¼ŒusingÂ è‡ªåŠ¨é‡Šæ”¾ï¼Œå‡å°‘é—æ¼ å†…å­˜æ³„æ¼é£é™© ä¸»è¦æ¥è‡ª â€œæ„å¤–å¼•ç”¨â€â€œæœªé‡Šæ”¾éæ‰˜ç®¡èµ„æºâ€ ä¸»è¦æ¥è‡ª â€œå¿˜è®°Â deleteâ€â€œåŒé‡é‡Šæ”¾â€ æ³„æ¼åœºæ™¯æ›´æ˜ç¡®ï¼Œæ’æŸ¥å·¥å…·æ›´ä¸°å¯Œï¼ˆå¦‚ VS å†…å­˜åˆ†æå™¨ï¼‰ æ€§èƒ½å¼€é”€ GC æš‚åœï¼ˆSTWï¼‰+ åˆ†ä»£å›æ”¶ä¼˜åŒ– æ—  GC å¼€é”€ï¼Œä½†æ‰‹åŠ¨ç®¡ç†æˆæœ¬é«˜ å¼€å‘æ•ˆç‡é«˜ï¼ŒGC ä¼˜åŒ–åæ€§èƒ½æ¥è¿‘ C++ï¼ˆå¤šæ•°åœºæ™¯ï¼‰ çµæ´»æ€§ æ‰˜ç®¡å †å— GC çº¦æŸï¼Œéæ‰˜ç®¡å †çµæ´» å † æ ˆå®Œå…¨æ‰‹åŠ¨æ§åˆ¶ï¼Œçµæ´»æ€§æé«˜ å¹³è¡¡çµæ´»æ€§å’Œå®‰å…¨æ€§ï¼Œæ— éœ€å…³æ³¨åº•å±‚å†…å­˜ç»†èŠ‚ ä¸ƒã€æœ€ä½³å®è·µï¼ˆé¢å‘ C++ ç¨‹åºå‘˜çš„è¿ç§»å»ºè®®ï¼‰ æ”¾å¼ƒ â€œæ‰‹åŠ¨é‡Šæ”¾æ‰˜ç®¡å†…å­˜â€ çš„æ€ç»´ï¼šæ— éœ€åƒ C++ é‚£æ ·å…³æ³¨Â deleteï¼Œäº¤ç»™ GC å³å¯ï¼› **æ‰€æœ‰Â IDisposableÂ ç±»å‹å¿…ç”¨Â using**ï¼šæ–‡ä»¶ã€ç½‘ç»œã€COM å¯¹è±¡ç­‰éæ‰˜ç®¡èµ„æºï¼Œç”¨Â usingÂ è‡ªåŠ¨é‡Šæ”¾ï¼Œé¿å…æ³„æ¼ï¼› é¿å…é™æ€é›†åˆæ»¥ç”¨ï¼šé™æ€é›†åˆæ˜¯ â€œå†…å­˜æ³„æ¼é‡ç¾åŒºâ€ï¼Œä¸´æ—¶å¯¹è±¡ä½¿ç”¨ååŠ¡å¿…ç§»é™¤å¼•ç”¨ï¼› äº‹ä»¶è®¢é˜…å¿…å–æ¶ˆï¼šçŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡è®¢é˜…é•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡äº‹ä»¶æ—¶ï¼Œéœ€åœ¨é”€æ¯å‰å–æ¶ˆè®¢é˜…ï¼› **æ…ç”¨Â GC.Collect()**ï¼šæ‰‹åŠ¨è§¦å‘ GC ä¼šç ´ååˆ†ä»£ä¼˜åŒ–ï¼Œä»…åœ¨ç‰¹æ®Šåœºæ™¯ï¼ˆå¦‚å¤§å¯¹è±¡é‡Šæ”¾åï¼‰ä½¿ç”¨ï¼› å€¼ç±»å‹ vs å¼•ç”¨ç±»å‹é€‰æ‹©ï¼š è½»é‡çº§æ•°æ®ï¼ˆå¦‚Â Pointã€TimeRangeï¼‰ï¼šç”¨Â structÂ æˆ–Â record structï¼ˆæ ˆå­˜å‚¨ï¼Œé€Ÿåº¦å¿«ï¼‰ï¼› å¤æ‚æ•°æ®ï¼ˆå¦‚Â Catã€DTOï¼‰ï¼šç”¨Â classÂ æˆ–Â recordï¼ˆæ‰˜ç®¡å †å­˜å‚¨ï¼Œæ”¯æŒå¤šæ€ï¼‰ï¼› é¿å…Â unsafeÂ ä»£ç ï¼šé™¤éå¿…é¡»ï¼ˆå¦‚è°ƒç”¨ C åº“ï¼‰ï¼Œå¦åˆ™ä¸ä½¿ç”¨éæ‰˜ç®¡å†…å­˜ï¼ˆunsafeã€MarshalÂ åˆ†é…ï¼‰ã€‚ æ€»ç»“C# å†…å­˜ç®¡ç†çš„æ ¸å¿ƒæ˜¯Â â€œè‡ªåŠ¨ä¸ºä¸»ï¼Œæ‰‹åŠ¨ä¸ºè¾…â€ï¼š æ‰˜ç®¡å†…å­˜ï¼ˆå¼•ç”¨ç±»å‹ï¼‰ï¼šç”± GC è‡ªåŠ¨åˆ†é… å›æ”¶ï¼Œåˆ†ä»£å›æ”¶æœºåˆ¶å¹³è¡¡æ€§èƒ½å’Œå†…å­˜å ç”¨ï¼› éæ‰˜ç®¡èµ„æºï¼šéœ€é€šè¿‡Â IDisposableÂ æ¥å£æ‰‹åŠ¨é‡Šæ”¾ï¼ŒusingÂ è¯­å¥æ˜¯æœ€ä½³å®è·µï¼› ä¸ C++ å¯¹æ¯”ï¼šC# è§£æ”¾äº†æ‰‹åŠ¨å†…å­˜ç®¡ç†çš„è´Ÿæ‹…ï¼Œé¿å…äº†Â deleteÂ é—æ¼ã€åŒé‡é‡Šæ”¾ç­‰é—®é¢˜ï¼Œä½†éœ€å…³æ³¨ â€œå¼•ç”¨å¯è¾¾æ€§â€ å’Œ â€œéæ‰˜ç®¡èµ„æºé‡Šæ”¾â€ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼› æ ¸å¿ƒåŸåˆ™ï¼šä¿¡ä»» GCï¼Œä½†ä¸ä¾èµ– GC å¤„ç†éæ‰˜ç®¡èµ„æºï¼›éµå¾ªÂ IDisposableÂ è§„èŒƒï¼Œåˆç†é€‰æ‹©å€¼ç±»å‹ å¼•ç”¨ç±»å‹ã€‚ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼ŒC# å†…å­˜ç®¡ç†çš„æ ¸å¿ƒæ˜¯ â€œè½¬å˜æ€ç»´â€â€”â€” ä» â€œæ‰‹åŠ¨æ§åˆ¶æ¯ä¸€å—å†…å­˜â€ åˆ° â€œå…³æ³¨èµ„æºç”Ÿå‘½å‘¨æœŸå’Œå¼•ç”¨å¯è¾¾æ€§â€ï¼Œè®©ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶å¸®ä½ å¤„ç†é‡å¤çš„å†…å­˜ç®¡ç†å·¥ä½œï¼Œèšç„¦ä¸šåŠ¡é€»è¾‘ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"è¡¨è¾¾å¼æ ‘","path":"/2025/11/26/2-ç¼–ç¨‹è¯­è¨€-CSharp-è¡¨è¾¾å¼æ ‘/","content":"C# è¡¨è¾¾å¼æ ‘ï¼ˆExpression Treeï¼‰ï¼šä»£ç å³æ•°æ®çš„æ ¸å¿ƒæœºåˆ¶ï¼ˆé¢å‘ C++ ç¨‹åºå‘˜ï¼‰C# ä¸­çš„è¡¨è¾¾å¼æ ‘ï¼ˆExpression Treeï¼‰Â æ˜¯ä¸€ç§æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰Â æ•°æ®ç»“æ„ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯å°† C# ä»£ç ä¸­çš„ã€Œè¡¨è¾¾å¼ï¼ˆè€Œéè¯­å¥ï¼‰ã€è¡¨ç¤ºä¸ºå¯éå†ã€å¯ä¿®æ”¹ã€å¯æ‰§è¡Œçš„å¯¹è±¡æ¨¡å‹ â€”â€” ç®€å•è¯´ï¼Œå°±æ˜¯æŠŠ â€œä»£ç â€ æœ¬èº«å½“ä½œ â€œæ•°æ®â€ æ¥å¤„ç†ï¼ˆå¦‚è§£æä»£ç é€»è¾‘ã€åŠ¨æ€ä¿®æ”¹ä»£ç ã€åŠ¨æ€æ‰§è¡Œä»£ç ï¼‰ã€‚ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™æ˜¯ C# ç‹¬æœ‰çš„æ ¸å¿ƒç‰¹æ€§ï¼ˆC++ æ— å†…ç½®æ”¯æŒï¼‰ï¼Œå¯ç±»æ¯”ä¸ºã€Œæ‰‹åŠ¨æ„å»ºçš„ AST + åå°„æ‰§è¡Œã€çš„å°è£…ç‰ˆ â€”â€” æ— éœ€æ‰‹åŠ¨è§£æè¯­æ³•ã€ç»´æŠ¤è¯­æ³•æ ‘èŠ‚ç‚¹ï¼ŒC# ç¼–è¯‘å™¨å’ŒÂ System.Linq.ExpressionsÂ åº“å·²å¸®ä½ å®Œæˆåº•å±‚å®ç°ï¼Œè®©ä½ èšç„¦ â€œæ“ä½œä»£ç æ•°æ®â€ è€Œé â€œæ„å»ºè¯­æ³•æ ‘â€ã€‚ ä¸€ã€æ ¸å¿ƒå®šä¹‰ï¼šè¡¨è¾¾å¼æ ‘æ˜¯ä»€ä¹ˆï¼Ÿ1. æœ¬è´¨ï¼šä»£ç çš„ â€œæ•°æ®åŒ–è¡¨ç¤ºâ€ æ™®é€š C# ä»£ç ï¼ˆå¦‚Â x = x.Name == Fritzï¼‰ç¼–è¯‘åä¼šç”ŸæˆÂ IL æŒ‡ä»¤ï¼ˆç›´æ¥å¯æ‰§è¡Œï¼‰ï¼› è¡¨è¾¾å¼æ ‘åˆ™æ˜¯å°†è¿™æ®µä»£ç ç¼–è¯‘ä¸ºÂ å¯¹è±¡æ ‘ç»“æ„ï¼ˆè€Œé ILï¼‰ï¼Œæ¯ä¸ªå¯¹è±¡ä»£è¡¨è¡¨è¾¾å¼çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå¦‚å‚æ•°Â xã€å±æ€§Â Nameã€å¸¸é‡Â Fritzã€ç›¸ç­‰è¿ç®—Â ==ï¼‰ã€‚ è¿™ç§ â€œæ•°æ®åŒ–â€ è®©ä»£ç å…·å¤‡ä»¥ä¸‹èƒ½åŠ›ï¼š éå†ï¼šæŸ¥çœ‹è¡¨è¾¾å¼çš„é€»è¾‘ç»“æ„ï¼ˆå¦‚è§£æÂ x.Name == FritzÂ æ˜¯ â€œå‚æ•° x çš„ Name å±æ€§ä¸å¸¸é‡ Fritz æ¯”è¾ƒç›¸ç­‰â€ï¼‰ï¼› ä¿®æ”¹ï¼šåŠ¨æ€è°ƒæ•´è¡¨è¾¾å¼é€»è¾‘ï¼ˆå¦‚æŠŠÂ ==Â æ”¹ä¸ºÂ !=ï¼ŒæŠŠÂ FritzÂ æ”¹ä¸ºÂ Bootsï¼‰ï¼› æ‰§è¡Œï¼šå°†è¡¨è¾¾å¼æ ‘ç¼–è¯‘ä¸ºå¯æ‰§è¡Œä»£ç ï¼ˆè½¬æˆå§”æ‰˜ï¼‰ï¼Œè¿è¡Œåå¾—åˆ°ç»“æœã€‚ 2. å…³é”®åŒºåˆ†ï¼šè¡¨è¾¾å¼æ ‘ vs æ™®é€šå§”æ‰˜æœ€å®¹æ˜“æ··æ·†çš„æ˜¯ã€Œè¡¨è¾¾å¼æ ‘ Lambdaã€å’Œã€Œå§”æ‰˜ Lambdaã€ï¼Œä¸¤è€…å†™æ³•ç›¸ä¼¼ï¼Œä½†æœ¬è´¨å®Œå…¨ä¸åŒï¼š ç‰¹æ€§ è¡¨è¾¾å¼æ ‘ï¼ˆExpressionFuncTï¼‰ æ™®é€šå§”æ‰˜ï¼ˆFuncTï¼‰ æœ¬è´¨ æ•°æ®ç»“æ„ï¼ˆASTï¼‰ï¼Œè¡¨ç¤ºä»£ç é€»è¾‘ æ–¹æ³•æŒ‡é’ˆ å›è°ƒï¼Œç›´æ¥æŒ‡å‘å¯æ‰§è¡Œä»£ç  ç¼–è¯‘ç»“æœ ç”Ÿæˆè¡¨è¾¾å¼æ ‘èŠ‚ç‚¹å¯¹è±¡ï¼ˆæ—  IL æ‰§è¡ŒæŒ‡ä»¤ï¼‰ ç”Ÿæˆ IL æŒ‡ä»¤ï¼ˆç›´æ¥å¯æ‰§è¡Œï¼‰ æ ¸å¿ƒèƒ½åŠ› éå†ã€ä¿®æ”¹ã€è§£æé€»è¾‘ï¼ˆä»£ç å³æ•°æ®ï¼‰ æ‰§è¡Œä»£ç ï¼ˆä»…èƒ½è°ƒç”¨ï¼Œæ— æ³•è§£æé€»è¾‘ï¼‰ è½¬æ¢å…³ç³» å¯é€šè¿‡Â Compile()Â è½¬ä¸ºå§”æ‰˜æ‰§è¡Œ ä¸å¯è½¬ä¸ºè¡¨è¾¾å¼æ ‘ï¼ˆå·²ç¼–è¯‘ä¸º ILï¼Œæ— æ³•è¿˜åŸè¯­æ³•æ ‘ï¼‰ é€‚ç”¨åœºæ™¯ åŠ¨æ€æŸ¥è¯¢ï¼ˆLINQ to SQLï¼‰ã€è§£æä»£ç é€»è¾‘ å›è°ƒå‡½æ•°ã€å¼‚æ­¥æ“ä½œã€äº‹ä»¶å¤„ç† è¯­æ³•ç¤ºä¾‹ï¼šè¡¨è¾¾å¼æ ‘ vs å§”æ‰˜csharp è¿è¡Œ class Cat public string Name get; set; public int Age get; set; // 1. æ™®é€šå§”æ‰˜ Lambdaï¼ˆç¼–è¯‘ä¸º ILï¼Œç›´æ¥å¯æ‰§è¡Œï¼‰FuncCat, bool isFritzDelegate = cat = cat.Name == Fritz;bool result1 = isFritzDelegate(new Cat Name = Fritz ); // ç›´æ¥æ‰§è¡Œï¼Œè¿”å› true// 2. è¡¨è¾¾å¼æ ‘ Lambdaï¼ˆç¼–è¯‘ä¸ºè¡¨è¾¾å¼æ ‘å¯¹è±¡ï¼Œä»£è¡¨ä»£ç é€»è¾‘ï¼‰ExpressionFuncCat, bool isFritzExpr = cat = cat.Name == Fritz;// æ­¤æ—¶ isFritzExpr æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œä¸æ˜¯å¯æ‰§è¡Œä»£ç // bool result2 = isFritzExpr(new Cat Name = Fritz ); // ç¼–è¯‘æŠ¥é”™ï¼šä¸èƒ½ç›´æ¥è°ƒç”¨// éœ€å…ˆç¼–è¯‘ä¸ºå§”æ‰˜ï¼Œå†æ‰§è¡ŒFuncCat, bool compiledDelegate = isFritzExpr.Compile();bool result2 = compiledDelegate(new Cat Name = Fritz ); // æ‰§è¡Œï¼Œè¿”å› true äºŒã€è¡¨è¾¾å¼æ ‘çš„æ ¸å¿ƒåŸç†1. è¡¨è¾¾å¼æ ‘çš„ç»“æ„ï¼šèŠ‚ç‚¹ç±»å‹ï¼ˆExpressionï¼‰è¡¨è¾¾å¼æ ‘ç”±Â System.Linq.Expressions.ExpressionÂ ç±»åŠå…¶æ´¾ç”Ÿç±»æ„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯¹åº”ä¸€ç§è¡¨è¾¾å¼ç±»å‹ï¼Œæ ¸å¿ƒèŠ‚ç‚¹ç±»å‹å¦‚ä¸‹ï¼ˆç±»æ¯” C++ çš„ AST èŠ‚ç‚¹ï¼‰ï¼š èŠ‚ç‚¹ç±»å‹ ä½œç”¨ ç¤ºä¾‹è¡¨è¾¾å¼ å¯¹åº” C++ ç±»æ¯” ParameterExpression è¡¨ç¤ºå‡½æ•°å‚æ•°ï¼ˆå¦‚Â cat = ...Â ä¸­çš„Â catï¼‰ catï¼ˆFuncCat, boolÂ çš„å‚æ•°ï¼‰ AST ä¸­çš„å‚æ•°èŠ‚ç‚¹ MemberExpression è¡¨ç¤ºå±æ€§ å­—æ®µè®¿é—®ï¼ˆå¦‚Â cat.Nameï¼‰ cat.Name AST ä¸­çš„æˆå‘˜è®¿é—®èŠ‚ç‚¹ ConstantExpression è¡¨ç¤ºå¸¸é‡ï¼ˆå¦‚Â Fritzã€3ï¼‰ Fritz AST ä¸­çš„å¸¸é‡èŠ‚ç‚¹ BinaryExpression è¡¨ç¤ºäºŒå…ƒè¿ç®—ï¼ˆå¦‚Â ==ã€+ã€ï¼‰ cat.Name == Fritz AST ä¸­çš„äºŒå…ƒè¿ç®—èŠ‚ç‚¹ LambdaExpression è¡¨ç¤º Lambda è¡¨è¾¾å¼ï¼ˆå¦‚Â cat = cat.Name == Fritzï¼‰ å®Œæ•´ Lambda è¡¨è¾¾å¼ AST ä¸­çš„æ ¹èŠ‚ç‚¹ï¼ˆLambda è¡¨è¾¾å¼ï¼‰ 2. è¡¨è¾¾å¼æ ‘çš„åˆ›å»ºæ–¹å¼æœ‰ä¸¤ç§æ ¸å¿ƒåˆ›å»ºæ–¹å¼ï¼Œå®é™…å¼€å‘ä¸­ä¼˜å…ˆç”¨ã€ŒLambda è½¬æ¢ã€ï¼ˆç®€æ´é«˜æ•ˆï¼‰ï¼Œã€Œæ‰‹åŠ¨æ„å»ºã€ä»…ç”¨äºç†è§£åº•å±‚ç»“æ„æˆ–åŠ¨æ€ç”Ÿæˆå¤æ‚è¡¨è¾¾å¼ã€‚ ï¼ˆ1ï¼‰æ–¹å¼ 1ï¼šLambda è¡¨è¾¾å¼è½¬æ¢ï¼ˆæ¨èï¼‰ç›´æ¥ç”¨Â ExpressionFunc...Â æˆ–Â ExpressionAction...Â æ¥æ”¶ Lambda è¡¨è¾¾å¼ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸ºè¡¨è¾¾å¼æ ‘ï¼ˆæ— éœ€æ‰‹åŠ¨æ„å»ºèŠ‚ç‚¹ï¼‰ã€‚ csharp è¿è¡Œ // 1. æ— å‚æ•°ã€æœ‰è¿”å›å€¼çš„è¡¨è¾¾å¼æ ‘ExpressionFuncstring greetExpr = () = Hello Expression Tree;// 2. å•å‚æ•°ã€è¿”å› bool çš„è¡¨è¾¾å¼æ ‘ï¼ˆæŸ¥è¯¢æ¡ä»¶ï¼‰ExpressionFuncCat, bool ageExpr = cat = cat.Age 3 cat.Name.StartsWith(F);// 3. å¤šå‚æ•°ã€æ— è¿”å›å€¼çš„è¡¨è¾¾å¼æ ‘ï¼ˆAction ç±»å‹ï¼‰ExpressionActionCat, string setNameExpr = (cat, newName) = cat.Name = newName; ï¼ˆ2ï¼‰æ–¹å¼ 2ï¼šæ‰‹åŠ¨æ„å»ºèŠ‚ç‚¹ï¼ˆç†è§£åº•å±‚ï¼‰é€šè¿‡Â System.Linq.Expressions.ExpressionÂ ç±»çš„é™æ€æ–¹æ³•ï¼ˆå¦‚Â Parameterã€Propertyã€Constantã€EqualÂ ç­‰ï¼‰æ‰‹åŠ¨åˆ›å»ºèŠ‚ç‚¹ï¼Œç»„è£…æˆè¡¨è¾¾å¼æ ‘ â€”â€” è¿™å¯¹åº” C++ ä¸­ â€œæ‰‹åŠ¨å®šä¹‰ AST èŠ‚ç‚¹ç±» + æ„å»ºè¯­æ³•æ ‘â€ çš„è¿‡ç¨‹ã€‚ ç¤ºä¾‹ï¼šæ‰‹åŠ¨æ„å»ºÂ cat = cat.Name == FritzÂ è¡¨è¾¾å¼æ ‘ csharp è¿è¡Œ // 1. åˆ›å»ºå‚æ•°èŠ‚ç‚¹ï¼šcatï¼ˆç±»å‹ä¸º Catï¼‰ParameterExpression catParam = Expression.Parameter(typeof(Cat), cat);// 2. åˆ›å»ºæˆå‘˜è®¿é—®èŠ‚ç‚¹ï¼šcat.Nameï¼ˆè®¿é—® cat å‚æ•°çš„ Name å±æ€§ï¼‰MemberExpression nameProp = Expression.Property(catParam, nameof(Cat.Name));// 3. åˆ›å»ºå¸¸é‡èŠ‚ç‚¹ï¼šFritzConstantExpression fritzConst = Expression.Constant(Fritz, typeof(string));// 4. åˆ›å»ºäºŒå…ƒè¿ç®—èŠ‚ç‚¹ï¼šcat.Name == Fritzï¼ˆç›¸ç­‰è¿ç®—ï¼‰BinaryExpression equalExpr = Expression.Equal(nameProp, fritzConst);// 5. åˆ›å»º Lambda è¡¨è¾¾å¼æ ‘ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰ï¼šå‚æ•°ä¸º catParamï¼Œä¸»ä½“ä¸º equalExprExpressionFuncCat, bool finalExpr = Expression.LambdaFuncCat, bool( equalExpr, // è¡¨è¾¾å¼ä¸»ä½“ catParam // è¡¨è¾¾å¼å‚æ•°);// éªŒè¯ï¼šç¼–è¯‘æ‰§è¡ŒFuncCat, bool compiled = finalExpr.Compile();bool result = compiled(new Cat Name = Fritz ); // è¿”å› true 3. è¡¨è¾¾å¼æ ‘çš„æ ¸å¿ƒæ“ä½œï¼ˆ1ï¼‰éå†è¡¨è¾¾å¼æ ‘ï¼ˆè§£æé€»è¾‘ï¼‰é€šè¿‡é€’å½’éå†è¡¨è¾¾å¼æ ‘çš„èŠ‚ç‚¹ï¼Œå¯è§£æä»£ç é€»è¾‘ï¼ˆå¦‚ ORM æ¡†æ¶è§£ææŸ¥è¯¢æ¡ä»¶ã€è§„åˆ™å¼•æ“è§£æä¸šåŠ¡è§„åˆ™ï¼‰ã€‚ ç¤ºä¾‹ï¼šéå†Â cat = cat.Name == FritzÂ å¹¶æ‰“å°èŠ‚ç‚¹ç»“æ„ csharp è¿è¡Œ void TraverseExpression(Expression expr, int depth = 0) // æ‰“å°èŠ‚ç‚¹ç±»å‹å’Œå†…å®¹ï¼ˆç¼©è¿›è¡¨ç¤ºå±‚çº§ï¼‰ string indent = new string( , depth * 2); Console.WriteLine($indentèŠ‚ç‚¹ç±»å‹ï¼šexpr.NodeTypeï¼Œç±»å‹ï¼šexpr.Type); // é€’å½’éå†å­èŠ‚ç‚¹ switch (expr) case LambdaExpression lambda: // Lambda èŠ‚ç‚¹ï¼šéå†å‚æ•°å’Œä¸»ä½“ foreach (var param in lambda.Parameters) TraverseExpression(param, depth + 1); TraverseExpression(lambda.Body, depth + 1); break; case BinaryExpression binary: // äºŒå…ƒè¿ç®—èŠ‚ç‚¹ï¼šéå†å·¦ã€å³æ“ä½œæ•° TraverseExpression(binary.Left, depth + 1); TraverseExpression(binary.Right, depth + 1); break; case MemberExpression member: // æˆå‘˜è®¿é—®èŠ‚ç‚¹ï¼šéå†å®ä¾‹ï¼ˆå¦‚ catï¼‰ TraverseExpression(member.Expression, depth + 1); Console.WriteLine($new string( , (depth + 1) * 2)æˆå‘˜åï¼šmember.Member.Name); break; case ParameterExpression param: // å‚æ•°èŠ‚ç‚¹ï¼šæ‰“å°å‚æ•°å Console.WriteLine($new string( , (depth + 1) * 2)å‚æ•°åï¼šparam.Name); break; case ConstantExpression constant: // å¸¸é‡èŠ‚ç‚¹ï¼šæ‰“å°å¸¸é‡å€¼ Console.WriteLine($new string( , (depth + 1) * 2)å¸¸é‡å€¼ï¼šconstant.Value); break; // è°ƒç”¨éå†TraverseExpression(finalExpr); è¾“å‡ºç»“æœï¼ˆæ¸…æ™°å±•ç¤ºè¡¨è¾¾å¼æ ‘ç»“æ„ï¼‰ï¼š plaintext èŠ‚ç‚¹ç±»å‹ï¼šLambdaï¼Œç±»å‹ï¼šSystem.Func`2[Cat,System.Boolean] èŠ‚ç‚¹ç±»å‹ï¼šParameterï¼Œç±»å‹ï¼šCat å‚æ•°åï¼šcat èŠ‚ç‚¹ç±»å‹ï¼šEqualï¼Œç±»å‹ï¼šSystem.Boolean èŠ‚ç‚¹ç±»å‹ï¼šMemberAccessï¼Œç±»å‹ï¼šSystem.String èŠ‚ç‚¹ç±»å‹ï¼šParameterï¼Œç±»å‹ï¼šCat å‚æ•°åï¼šcat æˆå‘˜åï¼šName èŠ‚ç‚¹ç±»å‹ï¼šConstantï¼Œç±»å‹ï¼šSystem.String å¸¸é‡å€¼ï¼šFritz ï¼ˆ2ï¼‰ä¿®æ”¹è¡¨è¾¾å¼æ ‘ï¼ˆåŠ¨æ€è°ƒæ•´é€»è¾‘ï¼‰è¡¨è¾¾å¼æ ‘çš„èŠ‚ç‚¹æ˜¯Â ä¸å¯å˜çš„ï¼ˆImmutableï¼‰â€”â€” æ— æ³•ç›´æ¥ä¿®æ”¹ç°æœ‰èŠ‚ç‚¹ï¼Œéœ€é€šè¿‡ã€Œåˆ›å»ºæ–°èŠ‚ç‚¹æ›¿æ¢æ—§èŠ‚ç‚¹ã€çš„æ–¹å¼ä¿®æ”¹é€»è¾‘ï¼ˆç±»ä¼¼ C++ ä¸­ â€œä¸å¯å˜å¯¹è±¡â€ çš„è®¾è®¡ï¼‰ã€‚ ç¤ºä¾‹ï¼šå°†Â cat = cat.Name == FritzÂ æ”¹ä¸ºÂ cat = cat.Name != Boots csharp è¿è¡Œ // å®šä¹‰èŠ‚ç‚¹æ›¿æ¢å™¨ï¼ˆç»§æ‰¿ ExpressionVisitorï¼Œé‡å†™èŠ‚ç‚¹å¤„ç†æ–¹æ³•ï¼‰class ExpressionModifier : ExpressionVisitor private readonly string _oldConst; private readonly string _newConst; private readonly ExpressionType _newNodeType; public ExpressionModifier(string oldConst, string newConst, ExpressionType newNodeType) _oldConst = oldConst; _newConst = newConst; _newNodeType = newNodeType; // é‡å†™äºŒå…ƒè¿ç®—èŠ‚ç‚¹å¤„ç†ï¼ˆæ›¿æ¢ == ä¸º !=ï¼‰ protected override Expression VisitBinary(BinaryExpression node) if (node.NodeType == ExpressionType.Equal) // åˆ›å»ºæ–°çš„äºŒå…ƒè¿ç®—èŠ‚ç‚¹ï¼ˆæ›¿æ¢èŠ‚ç‚¹ç±»å‹ï¼‰ return Expression.MakeBinary( _newNodeType, // æ–°èŠ‚ç‚¹ç±»å‹ï¼šNotEqual node.Left, // ä¿ç•™å·¦æ“ä½œæ•°ï¼ˆcat.Nameï¼‰ Visit(node.Right) // é€’å½’å¤„ç†å³æ“ä½œæ•°ï¼ˆæ›¿æ¢å¸¸é‡ï¼‰ ); return base.VisitBinary(node); // é‡å†™å¸¸é‡èŠ‚ç‚¹å¤„ç†ï¼ˆæ›¿æ¢ Fritz ä¸º Bootsï¼‰ protected override Expression VisitConstant(ConstantExpression node) if (node.Value is string str str == _oldConst) return Expression.Constant(_newConst, typeof(string)); return base.VisitConstant(node); // æ‰§è¡Œä¿®æ”¹var modifier = new ExpressionModifier(Fritz, Boots, ExpressionType.NotEqual);Expression modifiedExpr = modifier.Visit(finalExpr);// è½¬æ¢ä¸º Lambda è¡¨è¾¾å¼æ ‘å¹¶æ‰§è¡ŒExpressionFuncCat, bool newExpr = (ExpressionFuncCat, bool)modifiedExpr;FuncCat, bool newCompiled = newExpr.Compile();bool result1 = newCompiled(new Cat Name = Fritz ); // è¿”å› trueï¼ˆFritz != Bootsï¼‰bool result2 = newCompiled(new Cat Name = Boots ); // è¿”å› falseï¼ˆBoots != Bootsï¼‰ ï¼ˆ3ï¼‰æ‰§è¡Œè¡¨è¾¾å¼æ ‘ï¼ˆç¼–è¯‘ä¸ºå§”æ‰˜ï¼‰è¡¨è¾¾å¼æ ‘æœ¬èº«æ˜¯æ•°æ®ç»“æ„ï¼Œæ— æ³•ç›´æ¥æ‰§è¡Œï¼Œéœ€é€šè¿‡Â Compile()Â æ–¹æ³•å°†å…¶ç¼–è¯‘ä¸ºå§”æ‰˜ï¼ˆå¦‚Â FuncTã€ActionTï¼‰ï¼Œå†è°ƒç”¨å§”æ‰˜æ‰§è¡Œã€‚ csharp è¿è¡Œ // è¡¨è¾¾å¼æ ‘ â†’ å§”æ‰˜ï¼ˆç¼–è¯‘è¿‡ç¨‹æœ‰è½»å¾®æ€§èƒ½å¼€é”€ï¼Œå»ºè®®ç¼“å­˜ç¼–è¯‘ç»“æœï¼‰FuncCat, bool compiled = newExpr.Compile();// æ‰§è¡Œå§”æ‰˜ï¼ˆæ€§èƒ½ä¸ç›´æ¥è°ƒç”¨æ™®é€šå‡½æ•°ä¸€è‡´ï¼‰for (int i = 0; i 1000; i++) compiled(new Cat Name = $Cat_i ); æ³¨æ„ï¼šCompile()Â ä¼šç”Ÿæˆ IL ä»£ç å¹¶åŠ¨æ€åˆ›å»ºå§”æ‰˜ï¼Œé¦–æ¬¡ç¼–è¯‘æœ‰æ€§èƒ½å¼€é”€ï¼ˆæ¯«ç§’çº§ï¼‰ï¼Œä½†åç»­è°ƒç”¨å§”æ‰˜çš„æ€§èƒ½ä¸æ™®é€šå‡½æ•°æ— å·®å¼‚ â€”â€” é«˜é¢‘æ‰§è¡Œåœºæ™¯å»ºè®®ç¼“å­˜ç¼–è¯‘åçš„å§”æ‰˜ã€‚ ä¸‰ã€æ ¸å¿ƒç”¨é€”ï¼šè¡¨è¾¾å¼æ ‘èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿè¡¨è¾¾å¼æ ‘çš„æ ¸å¿ƒä»·å€¼æ˜¯ã€ŒåŠ¨æ€å¤„ç†ä»£ç é€»è¾‘ã€ï¼Œä»¥ä¸‹æ˜¯å®é™…å¼€å‘ä¸­æœ€å¸¸ç”¨çš„åœºæ™¯ï¼Œå¯¹æ¯” C++ çš„å®ç°æ–¹å¼æ›´æ˜“ç†è§£ï¼š 1. åŠ¨æ€æŸ¥è¯¢ï¼ˆLINQ to SQLEF Core æ ¸å¿ƒï¼‰è¿™æ˜¯è¡¨è¾¾å¼æ ‘æœ€ç»å…¸çš„ç”¨é€”ï¼šORM æ¡†æ¶ï¼ˆå¦‚ EF Coreã€LINQ to SQLï¼‰é€šè¿‡è§£æè¡¨è¾¾å¼æ ‘ï¼Œå°† C# æŸ¥è¯¢é€»è¾‘ï¼ˆå¦‚Â cat = cat.Age 3ï¼‰è½¬æ¢ä¸º SQL è¯­å¥ï¼ˆå¦‚Â SELECT * FROM Cats WHERE Age 3ï¼‰ã€‚ ç¤ºä¾‹ï¼šEF Core ä¸­çš„è¡¨è¾¾å¼æ ‘æŸ¥è¯¢ csharp è¿è¡Œ // è¡¨è¾¾å¼æ ‘ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ExpressionFuncCat, bool queryExpr = cat = cat.Age 3 cat.Name.Contains(F);// EF Core è§£æè¡¨è¾¾å¼æ ‘ï¼Œç”Ÿæˆ SQLï¼šSELECT * FROM Cats WHERE Age 3 AND Name LIKE %F%var cats = dbContext.Cats.Where(queryExpr).ToList(); C++ ç±»æ¯”ï¼šC++ æ— å†…ç½®æ”¯æŒï¼Œéœ€æ‰‹åŠ¨ç¼–å†™ SQL å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆæ˜“å‡ºé”™ï¼‰ï¼Œæˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹ ORM æ¡†æ¶ï¼ˆå¦‚ Qt SQLã€Drogon ORMï¼‰é€šè¿‡å® æ¨¡æ¿è§£ææŸ¥è¯¢æ¡ä»¶ â€”â€” è¿œä¸å¦‚ C# è¡¨è¾¾å¼æ ‘ç›´è§‚ã€ç±»å‹å®‰å…¨ã€‚ 2. åŠ¨æ€æ„å»ºä»£ç ï¼ˆè§„åˆ™å¼•æ“ é…ç½®åŒ–é€»è¾‘ï¼‰å½“ä¸šåŠ¡é€»è¾‘éœ€è¦é€šè¿‡é…ç½®åŠ¨æ€è°ƒæ•´ï¼ˆè€Œéç¡¬ç¼–ç ï¼‰æ—¶ï¼Œè¡¨è¾¾å¼æ ‘å¯åŠ¨æ€æ„å»ºæ‰§è¡Œé€»è¾‘ã€‚ä¾‹å¦‚ï¼šè§„åˆ™å¼•æ“æ¥æ”¶é…ç½®çš„ â€œæ¡ä»¶è¡¨è¾¾å¼â€ï¼ˆå¦‚Â score 90 level == 5ï¼‰ï¼ŒåŠ¨æ€æ„å»ºè¡¨è¾¾å¼æ ‘å¹¶æ‰§è¡Œã€‚ C++ ç±»æ¯”ï¼šéœ€æ‰‹åŠ¨è§£æé…ç½®å­—ç¬¦ä¸²ï¼ˆå¦‚ç”¨ Boost.Spirit ç¼–å†™è¯­æ³•è§£æå™¨ï¼‰ï¼Œæ‰‹åŠ¨æ„å»º AST å¹¶æ‰§è¡Œ â€”â€” å¼€å‘æˆæœ¬é«˜ã€ç»´æŠ¤å¤æ‚ï¼Œè€Œ C# è¡¨è¾¾å¼æ ‘å¯ç›´æ¥å°†é…ç½®é€»è¾‘è½¬ä¸º Lambda è¡¨è¾¾å¼æ ‘ï¼Œæ— éœ€æ‰‹åŠ¨è§£æã€‚ 3. è§£æè¡¨è¾¾å¼é€»è¾‘ï¼ˆä»£ç åˆ†æ åºåˆ—åŒ–ï¼‰ä¾‹å¦‚ï¼šåºåˆ—åŒ–æŸ¥è¯¢æ¡ä»¶ï¼ˆå°†Â cat = cat.Name == FritzÂ åºåˆ—åŒ–ä¸º JSON å­˜å‚¨ï¼Œåç»­ååºåˆ—åŒ–ä¸ºè¡¨è¾¾å¼æ ‘æ‰§è¡Œï¼‰ã€ä»£ç åˆ†æå·¥å…·ï¼ˆéå†è¡¨è¾¾å¼æ ‘æ£€æŸ¥ä»£ç è§„èŒƒï¼‰ã€‚ C++ ç±»æ¯”ï¼šéœ€æ‰‹åŠ¨ç»´æŠ¤ AST åºåˆ—åŒ– ååºåˆ—åŒ–é€»è¾‘ï¼Œæˆ–ä½¿ç”¨ Clang ç­‰ç¼–è¯‘å™¨å‰ç«¯å·¥å…·è§£æä»£ç  â€”â€” é—¨æ§›æé«˜ï¼Œè€Œ C# è¡¨è¾¾å¼æ ‘å¯ç›´æ¥éå†èŠ‚ç‚¹ã€åºåˆ—åŒ–èŠ‚ç‚¹ä¿¡æ¯ã€‚ 4. æ›¿ä»£åå°„ï¼ˆé«˜æ€§èƒ½åŠ¨æ€è°ƒç”¨ï¼‰åå°„ï¼ˆReflectionï¼‰å¯åŠ¨æ€è°ƒç”¨å¯¹è±¡æˆå‘˜ï¼Œä½†æ€§èƒ½è¾ƒä½ï¼›è¡¨è¾¾å¼æ ‘ç¼–è¯‘åæ‰§è¡Œçš„æ€§èƒ½æ¥è¿‘ç›´æ¥è°ƒç”¨ï¼Œä¸”ç±»å‹å®‰å…¨ï¼ˆç¼–è¯‘æ—¶æ ¡éªŒå‚æ•°ç±»å‹ï¼‰ã€‚ ç¤ºä¾‹ï¼šç”¨è¡¨è¾¾å¼æ ‘åŠ¨æ€è®¾ç½®å¯¹è±¡å±æ€§ï¼ˆæ›¿ä»£åå°„Â PropertyInfo.SetValueï¼‰ csharp è¿è¡Œ // åŠ¨æ€æ„å»ºï¼š(T obj, object value) = obj.Property = (PropertyType)valueExpressionActionT, object BuildSetPropertyExpressionT(string propertyName) // å‚æ•°1ï¼šobjï¼ˆT ç±»å‹ï¼‰ ParameterExpression objParam = Expression.Parameter(typeof(T), obj); // å‚æ•°2ï¼švalueï¼ˆobject ç±»å‹ï¼Œéœ€è½¬æ¢ä¸ºå±æ€§ç±»å‹ï¼‰ ParameterExpression valueParam = Expression.Parameter(typeof(object), value); // å±æ€§èŠ‚ç‚¹ï¼šobj.Property PropertyInfo prop = typeof(T).GetProperty(propertyName); MemberExpression propExpr = Expression.Property(objParam, prop); // ç±»å‹è½¬æ¢èŠ‚ç‚¹ï¼š(PropertyType)valueï¼ˆå¤„ç†å€¼ç±»å‹è£…ç®±/æ‹†ç®±ï¼‰ UnaryExpression convertExpr = Expression.Convert(valueParam, prop.PropertyType); // èµ‹å€¼èŠ‚ç‚¹ï¼šobj.Property = (PropertyType)value BinaryExpression assignExpr = Expression.Assign(propExpr, convertExpr); // æ„å»º Lambda è¡¨è¾¾å¼æ ‘ return Expression.LambdaActionT, object(assignExpr, objParam, valueParam);// ä½¿ç”¨ï¼šåŠ¨æ€è®¾ç½® Cat.Name å±æ€§var setNameExpr = BuildSetPropertyExpressionCat(Name);ActionCat, object setName = setNameExpr.Compile();var cat = new Cat();setName(cat, Fritz); // ç­‰ä»·äº cat.Name = FritzConsole.WriteLine(cat.Name); // è¾“å‡º Fritz æ€§èƒ½å¯¹æ¯”ï¼šè¡¨è¾¾å¼æ ‘ç¼–è¯‘åæ‰§è¡Œæ€§èƒ½ â‰ˆ ç›´æ¥è°ƒç”¨ï¼Œæ¯”åå°„Â SetValueÂ å¿« 10-100 å€ï¼ˆé«˜é¢‘åœºæ™¯å·®è·æ›´æ˜æ˜¾ï¼‰ã€‚ å››ã€ä¸ C++ çš„æ ¸å¿ƒå·®å¼‚ï¼ˆå…³é”®è¿ç§»ç‚¹ï¼‰C++ æ— å†…ç½®è¡¨è¾¾å¼æ ‘æ”¯æŒï¼Œéœ€é€šè¿‡æ‰‹åŠ¨å®ç°æˆ–ç¬¬ä¸‰æ–¹åº“æ¨¡æ‹Ÿç±»ä¼¼æ•ˆæœï¼Œä¸¤è€…å·®å¼‚æ˜¾è‘—ï¼š ç‰¹æ€§ C# è¡¨è¾¾å¼æ ‘ C++ ç±»ä¼¼å®ç°æ–¹æ¡ˆ æ ¸å¿ƒå·®å¼‚ è¯­æ³•æ”¯æŒ ç¼–è¯‘å™¨å†…ç½®æ”¯æŒï¼ˆLambda è‡ªåŠ¨è½¬è¡¨è¾¾å¼æ ‘ï¼‰ æ— å†…ç½®æ”¯æŒï¼Œéœ€æ‰‹åŠ¨å®ç° AST C# é›¶æˆæœ¬æ„å»ºï¼ŒC++ å¼€å‘æˆæœ¬æé«˜ èŠ‚ç‚¹ç®¡ç† System.Linq.ExpressionsÂ åº“æä¾›å®Œæ•´èŠ‚ç‚¹ç±»å‹ éœ€è‡ªå®šä¹‰ AST èŠ‚ç‚¹ç±»ï¼ˆå¦‚ BinaryNodeã€ConstantNodeï¼‰ C# å¼€ç®±å³ç”¨ï¼ŒC++ éœ€æ‰‹åŠ¨ç»´æŠ¤èŠ‚ç‚¹ç»“æ„ æ‰§è¡Œæ–¹å¼ Compile()Â è½¬å§”æ‰˜ï¼Œæ€§èƒ½æ¥è¿‘ç›´æ¥è°ƒç”¨ æ‰‹åŠ¨éå† AST æ‰§è¡Œï¼Œæˆ–é€šè¿‡ JIT åº“ï¼ˆå¦‚ LLVMï¼‰ç”Ÿæˆæœºå™¨ç  C# ç®€å•é«˜æ•ˆï¼ŒC++ éœ€å¤„ç†æ‰§è¡Œç»†èŠ‚ ç±»å‹å®‰å…¨ ç¼–è¯‘æ—¶æ ¡éªŒè¡¨è¾¾å¼ç±»å‹ï¼ˆå¦‚å‚æ•°ç±»å‹åŒ¹é…ï¼‰ æ‰‹åŠ¨æ ¡éªŒç±»å‹ï¼ˆæ˜“å‡ºé”™ï¼‰ C# ç±»å‹å®‰å…¨ï¼ŒC++ æ˜“å‡ºç°ç±»å‹é”™è¯¯ é€‚ç”¨åœºæ™¯ ORM æŸ¥è¯¢ã€è§„åˆ™å¼•æ“ã€åŠ¨æ€ä»£ç  éœ€æ‰‹åŠ¨å®ç° AST çš„åœºæ™¯ï¼ˆå¦‚ç¼–è¯‘å™¨ã€è§„åˆ™å¼•æ“ï¼‰ C# èšç„¦ä¸šåŠ¡é€»è¾‘ï¼ŒC++ éœ€å…³æ³¨åº•å±‚å®ç° æ ¸å¿ƒç±»æ¯”æ€»ç»“C# è¡¨è¾¾å¼æ ‘ â‰ˆ C++ ä¸­çš„ã€Œè‡ªå®šä¹‰ AST ç±» + åå°„æ‰§è¡Œ + è¯­æ³•è§£æå™¨ã€çš„é›†æˆå°è£… â€”â€”C# æŠŠè¿™äº›å¤æ‚çš„åº•å±‚å·¥ä½œå…¨éƒ¨éšè—ï¼Œè®©ä½ ç”¨ç®€æ´çš„è¯­æ³•æ“ä½œ â€œä»£ç æ•°æ®â€ï¼Œè€Œ C++ éœ€ä»é›¶æ­å»ºæ•´ä¸ªä½“ç³»ã€‚ äº”ã€å¸¸è§è¯¯åŒºä¸é¿å‘æŒ‡å—1. è¯¯åŒº 1ï¼šè¡¨è¾¾å¼æ ‘æ”¯æŒä»»æ„ä»£ç ï¼ˆå¦‚å¾ªç¯ã€æ¡ä»¶è¯­å¥ï¼‰ é”™è¯¯è®¤çŸ¥ï¼šExpressionFunc...Â å¯æ¥æ”¶ä»»æ„ Lambda ä»£ç ï¼› æ­£ç¡®é€»è¾‘ï¼šè¡¨è¾¾å¼æ ‘ä»…æ”¯æŒã€Œè¡¨è¾¾å¼ï¼ˆExpressionï¼‰ã€ï¼Œä¸æ”¯æŒã€Œè¯­å¥ï¼ˆStatementï¼‰ã€ï¼ˆå¦‚Â ifã€forã€whileã€èµ‹å€¼è¯­å¥ç­‰ï¼‰ã€‚ä¾‹å¦‚ï¼š csharp è¿è¡Œ // ç¼–è¯‘æŠ¥é”™ï¼šLambda åŒ…å«è¯­å¥ï¼ˆif è¯­å¥ï¼‰ï¼Œæ— æ³•è½¬ä¸ºè¡¨è¾¾å¼æ ‘ExpressionFuncCat, string badExpr = cat = if (cat.Age 3) return Adult; return Kitten;; è§£å†³æ–¹æ¡ˆï¼šå¤æ‚é€»è¾‘éœ€æ‹†åˆ†ä¸ºè¡¨è¾¾å¼ç»„åˆï¼ˆå¦‚Â ConditionÂ èŠ‚ç‚¹ï¼‰ï¼Œæˆ–ç›´æ¥ç”¨å§”æ‰˜ã€‚ 2. è¯¯åŒº 2ï¼šè¡¨è¾¾å¼æ ‘å¯ç›´æ¥ä¿®æ”¹ç°æœ‰èŠ‚ç‚¹ é”™è¯¯è®¤çŸ¥ï¼šç›´æ¥ä¿®æ”¹Â BinaryExpression.NodeTypeÂ å³å¯æ”¹å˜è¿ç®—é€»è¾‘ï¼› æ­£ç¡®é€»è¾‘ï¼šè¡¨è¾¾å¼æ ‘èŠ‚ç‚¹æ˜¯Â ä¸å¯å˜çš„ï¼Œéœ€é€šè¿‡Â ExpressionVisitorÂ åˆ›å»ºæ–°èŠ‚ç‚¹æ›¿æ¢æ—§èŠ‚ç‚¹ï¼ˆå¦‚å‰æ–‡ â€œä¿®æ”¹è¡¨è¾¾å¼æ ‘â€ ç¤ºä¾‹ï¼‰ã€‚ 3. è¯¯åŒº 3ï¼šç¼–è¯‘è¡¨è¾¾å¼æ ‘æ— æ€§èƒ½å¼€é”€ äº‹å®ï¼šCompile()Â æ–¹æ³•ä¼šåŠ¨æ€ç”Ÿæˆ IL ä»£ç å¹¶åˆ›å»ºå§”æ‰˜ï¼Œé¦–æ¬¡ç¼–è¯‘æœ‰æ¯«ç§’çº§å¼€é”€ï¼› å»ºè®®ï¼šé«˜é¢‘æ‰§è¡Œåœºæ™¯ï¼ˆå¦‚å¾ªç¯ä¸­è°ƒç”¨ï¼‰éœ€ç¼“å­˜ç¼–è¯‘åçš„å§”æ‰˜ï¼Œé¿å…é‡å¤ç¼–è¯‘ã€‚ 4. è¯¯åŒº 4ï¼šè¡¨è¾¾å¼æ ‘å¯æ›¿ä»£å§”æ‰˜ é”™è¯¯ç”¨æ³•ï¼šæ‰€æœ‰åœºæ™¯éƒ½ç”¨è¡¨è¾¾å¼æ ‘ï¼Œè¿½æ±‚ â€œåŠ¨æ€æ€§â€ï¼› æ­£ç¡®é€»è¾‘ï¼šä»…å½“éœ€è¦ã€Œè§£æ ä¿®æ”¹ä»£ç é€»è¾‘ã€æ—¶ç”¨è¡¨è¾¾å¼æ ‘ï¼›è‹¥ä»…éœ€ â€œåŠ¨æ€æ‰§è¡Œä»£ç â€ï¼Œç”¨å§”æ‰˜æ›´é«˜æ•ˆï¼ˆæ— ç¼–è¯‘å¼€é”€ï¼‰ã€‚ å…­ã€æ€»ç»“å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼Œç†è§£è¡¨è¾¾å¼æ ‘çš„æ ¸å¿ƒæ˜¯ï¼š è¡¨è¾¾å¼æ ‘çš„æœ¬è´¨æ˜¯ã€Œä»£ç å³æ•°æ®ã€â€”â€” å°† C# è¡¨è¾¾å¼è¡¨ç¤ºä¸ºå¯éå†ã€å¯ä¿®æ”¹ã€å¯æ‰§è¡Œçš„ AST æ•°æ®ç»“æ„ï¼› æ ¸å¿ƒä»·å€¼æ˜¯ã€ŒåŠ¨æ€å¤„ç†ä»£ç é€»è¾‘ã€â€”â€” æ— éœ€æ‰‹åŠ¨è§£æè¯­æ³•ã€ç»´æŠ¤ ASTï¼Œç®€åŒ– ORM æŸ¥è¯¢ã€è§„åˆ™å¼•æ“ã€åŠ¨æ€ä»£ç ç­‰åœºæ™¯ï¼› ä¸ C++ çš„å·®å¼‚ï¼šC# å†…ç½®æ”¯æŒï¼Œå¼€å‘æ•ˆç‡æé«˜ï¼›C++ éœ€æ‰‹åŠ¨å®ç° ASTï¼Œä»…é€‚åˆåº•å±‚æ¡†æ¶å¼€å‘ï¼› ä½¿ç”¨åŸåˆ™ï¼šã€Œèƒ½ä¸ç”¨åˆ™ä¸ç”¨ï¼Œéœ€åŠ¨æ€è§£æ ä¿®æ”¹æ—¶å¿…ç”¨ã€â€”â€” é¿å…æ»¥ç”¨ç¼–è¯‘å¼€é”€å’Œå¤æ‚æ€§ã€‚ è¡¨è¾¾å¼æ ‘æ˜¯ C# åŠ¨æ€ç¼–ç¨‹çš„ â€œç‹ç‰Œç‰¹æ€§â€ï¼Œå…¶è®¾è®¡ç›®æ ‡æ˜¯ï¼šè®©å¼€å‘è€…ç”¨é™æ€ç±»å‹çš„å®‰å…¨æ€§ï¼Œå®ç°åŠ¨æ€ä»£ç çš„çµæ´»æ€§â€”â€” è¿™ä¹Ÿæ˜¯ C# æ¯” C++ æ›´é€‚åˆå¿«é€Ÿå¼€å‘åŠ¨æ€åœºæ™¯ï¼ˆå¦‚ Web æ¡†æ¶ã€ORMã€è§„åˆ™å¼•æ“ï¼‰çš„æ ¸å¿ƒåŸå› ä¹‹ä¸€ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"dynamic å˜é‡","path":"/2025/11/26/2-ç¼–ç¨‹è¯­è¨€-CSharp-dynamic-å˜é‡/","content":"C# dynamic å˜é‡ï¼šåŠ¨æ€ç±»å‹çš„æ ¸å¿ƒè§£æï¼ˆé¢å‘ C++ ç¨‹åºå‘˜ï¼‰C# ä¸­çš„Â dynamicÂ æ˜¯Â åŠ¨æ€ç±»å‹å…³é”®å­—ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯ï¼šè®©å˜é‡çš„ç±»å‹æ£€æŸ¥ä» â€œç¼–è¯‘æ—¶â€ æ¨è¿Ÿåˆ° â€œè¿è¡Œæ—¶â€â€”â€” ç¼–è¯‘å™¨ä¸å†éªŒè¯è¯¥å˜é‡çš„æˆå‘˜ï¼ˆå±æ€§ã€æ–¹æ³•ï¼‰æ˜¯å¦å­˜åœ¨ï¼Œè€Œæ˜¯åœ¨ç¨‹åºæ‰§è¡Œæ—¶é€šè¿‡ DLRï¼ˆåŠ¨æ€è¯­è¨€è¿è¡Œæ—¶ï¼ŒDynamic Language Runtimeï¼‰åŠ¨æ€è§£æã€‚ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼ŒdynamicÂ æ˜¯ C# é™æ€ç±»å‹ä½“ç³»ä¸­çš„ â€œç‰¹ä¾‹â€ï¼ˆC++ æ˜¯çº¯é™æ€ç±»å‹è¯­è¨€ï¼Œæ— ç›´æ¥ç­‰ä»·å…³é”®å­—ï¼‰ï¼Œå¯ç±»æ¯”ä¸ºÂ â€œå¸¦ç±»å‹å®‰å…¨æ ¡éªŒçš„Â void*â€Â æˆ–Â â€œC++17Â std::anyÂ çš„åŠ¨æ€è°ƒç”¨å¢å¼ºç‰ˆâ€ï¼Œä½†æ¯”Â void*Â å®‰å…¨ï¼ˆè¿è¡Œæ—¶ç±»å‹æ ¡éªŒï¼‰ã€æ¯”Â std::anyÂ çµæ´»ï¼ˆæ”¯æŒç›´æ¥è°ƒç”¨æˆå‘˜ï¼‰ã€‚ ä¸€ã€æ ¸å¿ƒå®šä¹‰ï¼šdynamic å˜é‡æ˜¯ä»€ä¹ˆï¼Ÿ æœ¬è´¨ï¼šdynamicÂ æ˜¯ä¸€ç§ â€œç¼–è¯‘æ—¶å ä½ç¬¦ç±»å‹â€ï¼Œå˜é‡çš„å®é™…ç±»å‹ä»…åœ¨è¿è¡Œæ—¶ç¡®å®šï¼› æ ¸å¿ƒç‰¹æ€§ï¼š ç¼–è¯‘æ—¶ä¸åšç±»å‹æ£€æŸ¥ï¼šè°ƒç”¨Â dynamicÂ å˜é‡çš„ä»»æ„æˆå‘˜ï¼ˆå³ä½¿ä¸å­˜åœ¨ï¼‰ï¼Œç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ï¼› è¿è¡Œæ—¶åŠ¨æ€ç»‘å®šï¼šé€šè¿‡ DLR è§£æå˜é‡çš„å®é™…ç±»å‹ï¼ŒæŸ¥æ‰¾å¯¹åº”çš„æˆå‘˜ï¼ˆå±æ€§ æ–¹æ³•ï¼‰ï¼Œæ‰¾ä¸åˆ°åˆ™æŠ›å‡ºÂ RuntimeBinderExceptionï¼› å…¼å®¹æ‰€æœ‰ç±»å‹ï¼šå¯èµ‹å€¼ä»»æ„ç±»å‹ï¼ˆå€¼ç±»å‹ã€å¼•ç”¨ç±»å‹ã€è‡ªå®šä¹‰ç±»ç­‰ï¼‰ï¼Œä¸”æ”¯æŒéšå¼è½¬æ¢ï¼ˆæ— éœ€å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼‰ã€‚ è¯­æ³•ç¤ºä¾‹ï¼šdynamic å˜é‡çš„åŸºæœ¬ç”¨æ³•csharp è¿è¡Œ // 1. å£°æ˜ dynamic å˜é‡ï¼ˆç¼–è¯‘æ—¶æ— ç±»å‹çº¦æŸï¼‰dynamic value;// 2. èµ‹å€¼å­—ç¬¦ä¸²ç±»å‹value = Hello Dynamic;Console.WriteLine(value.Length); // è¿è¡Œæ—¶è§£æï¼šstring æœ‰ Length å±æ€§ â†’ è¾“å‡º 13// 3. èµ‹å€¼æ•´æ•°ç±»å‹ï¼ˆæ— éœ€è½¬æ¢ï¼Œç›´æ¥é‡æ–°èµ‹å€¼ï¼‰value = 123;Console.WriteLine(value + 456); // è¿è¡Œæ—¶è§£æï¼šint æ”¯æŒ + è¿ç®— â†’ è¾“å‡º 579// 4. èµ‹å€¼è‡ªå®šä¹‰ Cat ç±»å‹value = new Cat Name = Fritz, Age = 3 ;Console.WriteLine(value.Name); // è¿è¡Œæ—¶è§£æï¼šCat æœ‰ Name å±æ€§ â†’ è¾“å‡º Fritz// 5. è°ƒç”¨ä¸å­˜åœ¨çš„æˆå‘˜ï¼ˆç¼–è¯‘ä¸æŠ¥é”™ï¼Œè¿è¡Œæ—¶æŠ›å¼‚å¸¸ï¼‰// Console.WriteLine(value.NonExistentMethod()); // è¿è¡Œæ—¶æŠ›å‡º RuntimeBinderException äºŒã€dynamic ä¸å…¶ä»–ç±»å‹çš„æ ¸å¿ƒåŒºåˆ«ï¼ˆå…³é”®æ¾„æ¸…ï¼‰C# ä¸­Â dynamicÂ å®¹æ˜“ä¸Â varã€objectÂ æ··æ·†ï¼Œå°¤å…¶æ˜¯å¯¹ä¹ æƒ¯é™æ€ç±»å‹çš„ C++ ç¨‹åºå‘˜ï¼Œéœ€æ˜ç¡®ä¸‰è€…å·®å¼‚ï¼š ç±»å‹ ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ è¿è¡Œæ—¶ç±»å‹ æˆå‘˜è°ƒç”¨æ–¹å¼ æ ¸å¿ƒç”¨é€” C++ ç±»æ¯” dynamic æ—  åŠ¨æ€ç¡®å®š åŠ¨æ€ç»‘å®šï¼ˆDLRï¼‰ ç®€åŒ–åŠ¨æ€åœºæ™¯ï¼ˆåå°„ã€è·¨è¯­è¨€äº¤äº’ï¼‰ å¸¦ DLR çš„Â std::anyÂ + åŠ¨æ€è°ƒç”¨ var æœ‰ï¼ˆç±»å‹æ¨æ–­ï¼‰ ç¼–è¯‘æ—¶ç¡®å®š é™æ€ç»‘å®š ç®€åŒ–ç±»å‹å£°æ˜ï¼ˆé¿å…å†—é•¿ç±»å‹åï¼‰ autoÂ å…³é”®å­—ï¼ˆç±»å‹æ¨æ–­ï¼‰ object æœ‰ï¼ˆä»… object æˆå‘˜ï¼‰ ç¼–è¯‘æ—¶ä¸º object éœ€å¼ºåˆ¶è½¬æ¢ åå°„ é€šç”¨ç±»å‹å®¹å™¨ï¼ˆå…¼å®¹æ‰€æœ‰ç±»å‹ï¼‰ void*ï¼ˆä½†ç±»å‹å®‰å…¨ï¼‰ã€std::any å…³é”®å¯¹æ¯”ç¤ºä¾‹csharp è¿è¡Œ // 1. varï¼šç¼–è¯‘æ—¶æ¨æ–­ç±»å‹ä¸º stringï¼ˆé™æ€ç±»å‹ï¼‰var varStr = Hello Var;// varStr.Length â†’ åˆæ³•ï¼ˆç¼–è¯‘æ—¶å·²çŸ¥æ˜¯ stringï¼‰// varStr.NonExistent() â†’ ç¼–è¯‘æŠ¥é”™ï¼ˆé™æ€æ£€æŸ¥ï¼‰// 2. objectï¼šç¼–è¯‘æ—¶ç±»å‹ä¸º objectï¼ˆä»…æ”¯æŒ object çš„æˆå‘˜ï¼Œå¦‚ ToString()ï¼‰object objStr = Hello Object;// Console.WriteLine(objStr.Length); â†’ ç¼–è¯‘æŠ¥é”™ï¼ˆobject æ—  Length å±æ€§ï¼‰// éœ€å¼ºåˆ¶è½¬æ¢æ‰èƒ½è°ƒç”¨ string æˆå‘˜Console.WriteLine(((string)objStr).Length); // åˆæ³•ï¼ˆæ˜¾å¼è½¬æ¢ï¼‰// 3. dynamicï¼šç¼–è¯‘æ—¶æ— æ£€æŸ¥ï¼Œè¿è¡Œæ—¶åŠ¨æ€è§£ædynamic dynStr = Hello Dynamic;Console.WriteLine(dynStr.Length); // è¿è¡Œæ—¶è§£æï¼Œåˆæ³• ä¸ C++ æ ¸å¿ƒå·®å¼‚ C++ æ— Â dynamicÂ ç­‰ä»·å…³é”®å­—ï¼šC++ æ˜¯çº¯é™æ€ç±»å‹è¯­è¨€ï¼Œæ‰€æœ‰ç±»å‹æ£€æŸ¥å¿…é¡»åœ¨ç¼–è¯‘æ—¶å®Œæˆï¼ˆautoÂ æ˜¯ç¼–è¯‘æ—¶ç±»å‹æ¨æ–­ï¼Œä»å±äºé™æ€ç±»å‹ï¼‰ï¼› C++ éœ€æ‰‹åŠ¨å®ç° â€œåŠ¨æ€æ•ˆæœâ€ï¼šè‹¥è¦å®ç°ç±»ä¼¼Â dynamicÂ çš„åŠŸèƒ½ï¼Œéœ€ç»“åˆÂ std::anyÂ + ç±»å‹è½¬æ¢ + è™šå‡½æ•° å‡½æ•°æŒ‡é’ˆï¼Œä»£ç ç¹çä¸”æ— åŠ¨æ€æˆå‘˜è°ƒç”¨æ”¯æŒã€‚ ä¸‰ã€dynamic çš„æ ¸å¿ƒåŸç†ï¼šDLR åŠ¨æ€ç»‘å®šdynamicÂ å˜é‡çš„ â€œåŠ¨æ€ç‰¹æ€§â€ ä¾èµ– .NET çš„Â DLRï¼ˆåŠ¨æ€è¯­è¨€è¿è¡Œæ—¶ï¼‰ï¼Œå…¶åº•å±‚å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š ç¼–è¯‘æ—¶ï¼šç¼–è¯‘å™¨å°†Â dynamicÂ å˜é‡æ ‡è®°ä¸º â€œåŠ¨æ€ç±»å‹â€ï¼Œä¸å¯¹å…¶æˆå‘˜è°ƒç”¨åšä»»ä½•æ ¡éªŒï¼Œç”Ÿæˆå ä½ç¬¦ä»£ç ï¼› è¿è¡Œæ—¶ï¼š DLR è·å–Â dynamicÂ å˜é‡çš„å®é™…ç±»å‹ï¼ˆå¦‚Â stringã€Catï¼‰ï¼› æŸ¥æ‰¾è¯¥ç±»å‹æ˜¯å¦å­˜åœ¨è¢«è°ƒç”¨çš„æˆå‘˜ï¼ˆå±æ€§ æ–¹æ³•ï¼‰ï¼› è‹¥å­˜åœ¨ï¼šæ‰§è¡Œæˆå‘˜ï¼ˆç±»ä¼¼é™æ€ç»‘å®šçš„æ•ˆæœï¼‰ï¼› è‹¥ä¸å­˜åœ¨ï¼šæŠ›å‡ºÂ RuntimeBinderExceptionï¼ˆè¿è¡Œæ—¶ç»‘å®šå¼‚å¸¸ï¼‰ï¼› æ€§èƒ½å¼€é”€ï¼šåŠ¨æ€ç»‘å®šæ¯”é™æ€ç»‘å®šï¼ˆå¦‚Â varã€æ™®é€šç±»å‹ï¼‰å¤šä¸€å±‚ DLR è§£æï¼Œæ€§èƒ½ç•¥ä½ï¼ˆä½†å¤§å¤šæ•°åœºæ™¯å¯å¿½ç•¥ï¼‰ã€‚ åŸç†ç±»æ¯”ï¼ˆC++ è§†è§’ï¼‰dynamicÂ çš„è¿è¡Œæ—¶ç»‘å®šï¼Œç±»ä¼¼ C++ ä¸­ â€œé€šè¿‡Â typeidÂ è·å–ç±»å‹ä¿¡æ¯ + æ‰‹åŠ¨æŸ¥æ‰¾æˆå‘˜â€ï¼Œä½† DLR å·²å°è£…æ‰€æœ‰åº•å±‚æ“ä½œï¼š cpp è¿è¡Œ // C++ æ¨¡æ‹Ÿ dynamic æ•ˆæœï¼ˆç¹çï¼Œä»…ç¤ºæ„ï¼‰std::any value = std::string(Hello);// è¿è¡Œæ—¶è·å–å®é™…ç±»å‹if (value.type() == typeid(std::string)) // æ˜¾å¼è½¬æ¢åè°ƒç”¨æˆå‘˜ std::cout std::any_caststd::string(value).size() std::endl; else if (value.type() == typeid(int)) std::cout std::any_castint(value) + 10 std::endl;// è‹¥è¦æ”¯æŒä»»æ„æˆå‘˜è°ƒç”¨ï¼Œéœ€æ‰‹åŠ¨ç»´æŠ¤æˆå‘˜æ˜ å°„è¡¨ï¼Œæå…¶å¤æ‚ è€Œ C# çš„Â dynamicÂ ç›´æ¥ç®€åŒ–ä¸ºÂ value.Lengthï¼Œæ— éœ€æ‰‹åŠ¨ç±»å‹åˆ¤æ–­å’Œè½¬æ¢ â€”â€” è¿™æ˜¯Â dynamicÂ çš„æ ¸å¿ƒä»·å€¼ã€‚ å››ã€dynamic çš„é€‚ç”¨åœºæ™¯ï¼ˆä»€ä¹ˆæ—¶å€™è¯¥ç”¨ï¼Ÿï¼‰dynamicÂ ä¸æ˜¯ â€œé“¶å¼¹â€ï¼Œä»…é€‚åˆç‰¹å®šåŠ¨æ€åœºæ™¯ï¼Œæ»¥ç”¨ä¼šå¯¼è‡´ç±»å‹å®‰å…¨ç¼ºå¤±ã€è°ƒè¯•å›°éš¾ã€‚ä»¥ä¸‹æ˜¯æ¨èä½¿ç”¨çš„åœºæ™¯ï¼š 1. ç®€åŒ–åå°„è°ƒç”¨ï¼ˆæœ€å¸¸ç”¨åœºæ™¯ï¼‰C# åå°„ï¼ˆReflectionï¼‰ç”¨äºåŠ¨æ€è®¿é—®ç±»çš„æˆå‘˜ï¼ˆå¦‚ç§æœ‰æ–¹æ³•ã€åŠ¨æ€åŠ è½½çš„ç±»ï¼‰ï¼Œä½†åŸç”Ÿåå°„ä»£ç å†—é•¿ã€ç¹çï¼›dynamicÂ å¯å°†åå°„è°ƒç”¨ç®€åŒ–ä¸º â€œç›´æ¥æˆå‘˜è°ƒç”¨â€ã€‚ ç¤ºä¾‹ï¼šåå°„ vs dynamic è°ƒç”¨å‡è®¾å­˜åœ¨è‡ªå®šä¹‰ç±»Â Catï¼Œéœ€åŠ¨æ€è°ƒç”¨å…¶Â SayHelloÂ æ–¹æ³•ï¼š csharp è¿è¡Œ class Cat public string Name get; set; public void SayHello(string message) Console.WriteLine($Name: message); // æ–¹å¼1ï¼šåŸç”Ÿåå°„ï¼ˆç¹çï¼‰Type catType = typeof(Cat);object catObj = Activator.CreateInstance(catType);// è®¾ç½®å±æ€§catType.GetProperty(Name).SetValue(catObj, Fritz);// è°ƒç”¨æ–¹æ³•catType.GetMethod(SayHello).Invoke(catObj, new object[] Meow! );// æ–¹å¼2ï¼šdynamic ç®€åŒ–åå°„ï¼ˆç®€æ´ï¼‰dynamic dynamicCat = Activator.CreateInstance(typeof(Cat));dynamicCat.Name = Fritz; // ç›´æ¥èµ‹å€¼å±æ€§ï¼ˆåº•å±‚ä»æ˜¯åå°„ï¼‰dynamicCat.SayHello(Meow!); // ç›´æ¥è°ƒç”¨æ–¹æ³•ï¼ˆåº•å±‚ä»æ˜¯åå°„ï¼‰ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™ç›¸å½“äº â€œè‡ªåŠ¨å°è£…åå°„é€»è¾‘â€ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨Â GetPropertyInvokeÂ ç­‰æ–¹æ³•ã€‚ 2. å¤„ç†åŠ¨æ€æ•°æ®ï¼ˆå¦‚ JSONã€XML ååºåˆ—åŒ–ï¼‰å½“ JSONXML æ•°æ®ç»“æ„ä¸å›ºå®šï¼ˆå¦‚ç¬¬ä¸‰æ–¹æ¥å£è¿”å›çš„åŠ¨æ€å­—æ®µï¼‰ï¼Œæˆ–æ— éœ€å®šä¹‰å®ä½“ç±»æ—¶ï¼ŒdynamicÂ å¯ç›´æ¥è§£ææ•°æ®ï¼Œæ— éœ€æ˜¾å¼ç±»å‹æ˜ å°„ã€‚ ç¤ºä¾‹ï¼šNewtonsoft.Json åŠ¨æ€è§£æ JSONcsharp è¿è¡Œ using Newtonsoft.Json;// JSON å­—ç¬¦ä¸²ï¼ˆå­—æ®µå¯èƒ½åŠ¨æ€å˜åŒ–ï¼‰string json = @Name:Fritz,Age:3,Nickname:Little Tiger;// åŠ¨æ€ååºåˆ—åŒ–ï¼ˆæ— éœ€å®šä¹‰ Cat ç±»ï¼‰dynamic dynamicCat = JsonConvert.DeserializeObject(json);// ç›´æ¥è®¿é—®å­—æ®µï¼ˆè¿è¡Œæ—¶è§£æï¼‰Console.WriteLine(dynamicCat.Name); // è¾“å‡º FritzConsole.WriteLine(dynamicCat.Age); // è¾“å‡º 3Console.WriteLine(dynamicCat.Nickname); // è¾“å‡º Little Tiger C++ ä¸­éœ€æ‰‹åŠ¨è§£æ JSON é”®å€¼å¯¹ï¼ˆå¦‚Â nlohmann::json[Name]ï¼‰ï¼Œè€ŒÂ dynamicÂ è®©è®¿é—®æ›´è‡ªç„¶ã€‚ 3. è·¨è¯­è¨€ è·¨å¹³å°äº¤äº’ï¼ˆå¦‚ COM å¯¹è±¡ã€Python äº¤äº’ï¼‰ COM å¯¹è±¡ï¼ˆå¦‚ Windows ç³»ç»Ÿç»„ä»¶ï¼‰ï¼šä¼ ç»Ÿè°ƒç”¨éœ€é€šè¿‡Â InvokeÂ æ–¹æ³•ï¼ŒdynamicÂ å¯ç›´æ¥è°ƒç”¨å…¶æˆå‘˜ï¼› è·¨è¯­è¨€äº¤äº’ï¼ˆå¦‚ C# è°ƒç”¨ Python è„šæœ¬ï¼‰ï¼šPython æ˜¯åŠ¨æ€è¯­è¨€ï¼ŒdynamicÂ å¯æ— ç¼æ¥æ”¶ Python è¿”å›çš„åŠ¨æ€å¯¹è±¡ï¼Œç›´æ¥è°ƒç”¨å…¶æ–¹æ³•ã€‚ ç¤ºä¾‹ï¼šè°ƒç”¨ COM å¯¹è±¡ï¼ˆç®€åŒ–ç‰ˆï¼‰csharp è¿è¡Œ // å¼•ç”¨ Windows COM ç»„ä»¶ï¼ˆå¦‚ Excel åº”ç”¨ï¼‰dynamic excel = Activator.CreateInstance(Type.GetTypeFromProgID(Excel.Application));excel.Visible = true; // ç›´æ¥è®¾ç½® COM å¯¹è±¡å±æ€§dynamic workbook = excel.Workbooks.Add(); // ç›´æ¥è°ƒç”¨ COM å¯¹è±¡æ–¹æ³•dynamic worksheet = workbook.ActiveSheet;worksheet.Cells[1, 1] = Hello Excel; // ç›´æ¥æ“ä½œå•å…ƒæ ¼ 4. ç®€åŒ–æ³›å‹ä¸­çš„ç±»å‹è½¬æ¢å½“æ³›å‹ç±»å‹å¤æ‚ï¼Œä¸”ç±»å‹è½¬æ¢é¢‘ç¹æ—¶ï¼ŒdynamicÂ å¯é¿å…å¤šå±‚å¼ºåˆ¶è½¬æ¢ï¼Œç®€åŒ–ä»£ç ï¼ˆéœ€è°¨æ…ä½¿ç”¨ï¼Œé¿å…ç±»å‹å®‰å…¨é—®é¢˜ï¼‰ã€‚ ç¤ºä¾‹ï¼šæ³›å‹ç±»å‹è½¬æ¢ç®€åŒ–csharp è¿è¡Œ // å¤æ‚æ³›å‹ç±»å‹Dictionarystring, ListCat catDictionary = new Dictionarystring, ListCat();catDictionary[Pets] = new ListCat new Cat Name = Fritz ;// æ–¹å¼1ï¼šæ˜¾å¼è½¬æ¢ï¼ˆç¹çï¼‰ListCat cats1 = ((Dictionarystring, ListCat)catDictionary)[Pets];Cat cat1 = cats1[0];// æ–¹å¼2ï¼šdynamic ç®€åŒ–ï¼ˆç®€æ´ï¼‰dynamic dynamicDict = catDictionary;Cat cat2 = dynamicDict[Pets][0]; // ç›´æ¥é“¾å¼è®¿é—®ï¼Œæ— éœ€æ˜¾å¼è½¬æ¢ äº”ã€dynamic çš„å¸¸è§è¯¯åŒºä¸é£é™©ï¼ˆé¿å‘æŒ‡å—ï¼‰1. è¯¯åŒº 1ï¼šdynamic æ˜¯ â€œå¼±ç±»å‹â€ï¼Œç±»ä¼¼ PythonJavaScript å˜é‡ é”™è¯¯è®¤çŸ¥ï¼šdynamicÂ å®Œå…¨æ— ç±»å‹çº¦æŸï¼› æ­£ç¡®é€»è¾‘ï¼šdynamicÂ æ˜¯ â€œå»¶è¿Ÿç±»å‹æ£€æŸ¥â€ï¼Œä»æœ‰ç±»å‹å®‰å…¨ â€”â€” è¿è¡Œæ—¶è‹¥æˆå‘˜ä¸å­˜åœ¨ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆå¼±ç±»å‹è¯­è¨€ä¼šé™é»˜å¤±è´¥æˆ–è¿”å›Â undefinedï¼‰ã€‚ 2. è¯¯åŒº 2ï¼šdynamic æ€§èƒ½å’Œé™æ€ç±»å‹æ— å·®å¼‚ äº‹å®ï¼šdynamicÂ æ¯æ¬¡æˆå‘˜è°ƒç”¨éƒ½éœ€ DLR è¿è¡Œæ—¶è§£æï¼Œæ€§èƒ½æ¯”é™æ€ç±»å‹ï¼ˆvarã€æ™®é€šç±»å‹ï¼‰ä½çº¦ 10-100 å€ï¼ˆå…·ä½“å–å†³äºè°ƒç”¨é¢‘ç‡ï¼‰ï¼› å»ºè®®ï¼šæ€§èƒ½æ•æ„Ÿåœºæ™¯ï¼ˆå¦‚é«˜é¢‘å¾ªç¯ã€è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼‰é¿å…ä½¿ç”¨Â dynamicã€‚ 3. è¯¯åŒº 3ï¼šdynamic å¯æ›¿ä»£æ³›å‹ æ¥å£ é”™è¯¯ç”¨æ³•ï¼šç”¨Â dynamicÂ æ›¿ä»£æ³›å‹ï¼Œè¿½æ±‚ â€œä¸‡èƒ½ç±»å‹â€ï¼› é£é™©ï¼šæ³›å‹ æ¥å£æ˜¯ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨ï¼Œä¸”æœ‰æ˜ç¡®çº¦æŸï¼›dynamicÂ æ— çº¦æŸï¼Œæ˜“å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ï¼Œä¸”ä»£ç å¯è¯»æ€§å·®ã€‚ 4. æ ¸å¿ƒé£é™©ï¼šè°ƒè¯•å›°éš¾ + è¿è¡Œæ—¶å¼‚å¸¸ ç¼–è¯‘æ—¶æ— æç¤ºï¼šè°ƒç”¨ä¸å­˜åœ¨çš„æˆå‘˜ï¼ˆå¦‚Â dynamicCat.NonExistentMethod()ï¼‰ï¼Œç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ï¼Œéœ€è¿è¡Œæ—¶æ‰èƒ½å‘ç°ï¼› è°ƒè¯•ä¸ç›´è§‚ï¼šæ–­ç‚¹è°ƒè¯•æ—¶ï¼ŒdynamicÂ å˜é‡çš„å®é™…ç±»å‹å’Œæˆå‘˜éœ€æ‰‹åŠ¨æŸ¥çœ‹ï¼Œæ— æ³•åƒé™æ€ç±»å‹é‚£æ ·ç›´æ¥æ˜¾ç¤ºã€‚ 5. é¿å‘å»ºè®® ä¼˜å…ˆé™æ€ç±»å‹ï¼šèƒ½ç”¨Â var æ³›å‹ æ¥å£è§£å†³çš„ï¼Œç»ä¸ä½¿ç”¨Â dynamicï¼› å¿…è¦æ—¶åŠ ç±»å‹æ£€æŸ¥ï¼šä¸ç¡®å®šÂ dynamicÂ å˜é‡ç±»å‹æ—¶ï¼Œç”¨Â isasÂ å…³é”®å­—åšè¿è¡Œæ—¶æ ¡éªŒï¼š csharp è¿è¡Œ dynamic value = GetDynamicValue();if (value is Cat cat) cat.SayHello(Meow!); // ç±»å‹å®‰å…¨çš„è°ƒç”¨ æ•è·è¿è¡Œæ—¶å¼‚å¸¸ï¼šdynamicÂ æˆå‘˜è°ƒç”¨å¯èƒ½æŠ›Â RuntimeBinderExceptionï¼Œéœ€ç”¨Â try-catchÂ å¤„ç†ï¼š csharp è¿è¡Œ try dynamicCat.NonExistentMethod();catch (RuntimeBinderException ex) Console.WriteLine($æˆå‘˜ä¸å­˜åœ¨ï¼šex.Message); å…­ã€ä¸ C++ ç±»ä¼¼ç‰¹æ€§çš„å¯¹æ¯”ï¼ˆå¸®åŠ©è¿ç§»ç†è§£ï¼‰C++ æ— Â dynamicÂ å…³é”®å­—ï¼Œä½†æœ‰éƒ¨åˆ†ç‰¹æ€§å¯å®ç°ç±»ä¼¼æ•ˆæœï¼Œå¯¹æ¯”å¦‚ä¸‹ï¼š ç‰¹æ€§ C# dynamic C++ ç±»ä¼¼å®ç° æ ¸å¿ƒå·®å¼‚ åŠ¨æ€ç±»å‹å®¹å™¨ dynamicÂ å¯èµ‹å€¼ä»»æ„ç±»å‹ std::anyï¼ˆC++17+ï¼‰ std::anyÂ éœ€æ˜¾å¼è½¬æ¢ï¼Œæ— åŠ¨æ€æˆå‘˜è°ƒç”¨ ç±»å‹æ¨æ–­ æ— ï¼ˆè¿è¡Œæ—¶ç¡®å®šç±»å‹ï¼‰ autoÂ å…³é”®å­— autoÂ æ˜¯ç¼–è¯‘æ—¶æ¨æ–­ï¼Œé™æ€ç±»å‹ åŠ¨æ€æˆå‘˜è°ƒç”¨ ç›´æ¥è°ƒç”¨ï¼ˆDLR è§£æï¼‰ è™šå‡½æ•° +Â dynamic_cast ä»…æ”¯æŒè™šå‡½æ•°ï¼Œéœ€æ‰‹åŠ¨è½¬æ¢ç±»å‹ åå°„åŠŸèƒ½ åº•å±‚ä¾èµ–åå°„ï¼Œè¯­æ³•ç®€æ´ typeidÂ + æ‰‹åŠ¨åå°„ï¼ˆç¹çï¼‰ C++ æ— å†…ç½®åå°„ï¼Œéœ€ç¬¬ä¸‰æ–¹åº“æ”¯æŒ ç±»å‹å®‰å…¨ è¿è¡Œæ—¶ç±»å‹æ ¡éªŒï¼ˆæŠ›å¼‚å¸¸ï¼‰ void*ï¼ˆæ— ç±»å‹å®‰å…¨ï¼‰std::anyï¼ˆæ˜¾å¼è½¬æ¢ï¼‰ void*Â é£é™©é«˜ï¼Œstd::anyÂ ç›¸å¯¹å®‰å…¨ æ€»ç»“å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼Œç†è§£Â dynamicÂ çš„æ ¸å¿ƒæ˜¯ï¼š dynamicÂ æ˜¯ C# é™æ€ç±»å‹ä½“ç³»çš„ â€œè¡¥å……â€ï¼Œè€Œé â€œæ›¿ä»£â€â€”â€” ç”¨äºè§£å†³é™æ€ç±»å‹éš¾ä»¥å¤„ç†çš„åŠ¨æ€åœºæ™¯ï¼ˆåå°„ã€åŠ¨æ€æ•°æ®ã€è·¨è¯­è¨€äº¤äº’ï¼‰ï¼› æœ¬è´¨æ˜¯ â€œè¿è¡Œæ—¶ç±»å‹ç»‘å®š + è‡ªåŠ¨åå°„å°è£…â€ï¼Œæ¯” C++ çš„Â std::anyvoid*Â æ›´çµæ´»ï¼Œä½†æ¯”é™æ€ç±»å‹ï¼ˆvar æ³›å‹ï¼‰æ€§èƒ½ä½ã€ç±»å‹å®‰å…¨å¼±ï¼› ä½¿ç”¨åŸåˆ™ï¼šèƒ½ä¸ç”¨åˆ™ä¸ç”¨ï¼Œå¿…é¡»ç”¨æ—¶éœ€åŠ ç±»å‹æ£€æŸ¥å’Œå¼‚å¸¸å¤„ç†ï¼Œé¿å…æ»¥ç”¨å¯¼è‡´ä»£ç ç»´æŠ¤å›°éš¾ã€‚ dynamicÂ çš„è®¾è®¡ç›®æ ‡æ˜¯ï¼šç”¨ç®€æ´çš„è¯­æ³•è§£å†³å¤æ‚çš„åŠ¨æ€åœºæ™¯ï¼Œè®©å¼€å‘è€…æ— éœ€å…³æ³¨åº•å±‚çš„åå°„ ç±»å‹è½¬æ¢ç»†èŠ‚ï¼Œèšç„¦ä¸šåŠ¡é€»è¾‘ â€”â€” è¿™ä¹Ÿæ˜¯ C# æ¯” C++ æ›´ â€œå¼€ç®±å³ç”¨â€ çš„ä½“ç°ä¹‹ä¸€ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"åå˜å’Œé€†å˜","path":"/2025/11/26/2-ç¼–ç¨‹è¯­è¨€-CSharp-åå˜å’Œé€†å˜/","content":"C# åå˜ä¸é€†å˜ï¼šæ³›å‹ç±»å‹å…¼å®¹çš„æ ¸å¿ƒæœºåˆ¶ï¼ˆé¢å‘ C++ ç¨‹åºå‘˜ï¼‰C# ä¸­çš„åå˜ï¼ˆCovarianceï¼‰Â å’Œé€†å˜ï¼ˆContravarianceï¼‰Â æ˜¯é’ˆå¯¹Â æ³›å‹æ¥å£ å§”æ‰˜Â çš„ç‰¹æ€§ï¼Œæ ¸å¿ƒç›®çš„æ˜¯Â åœ¨ç±»å‹å®‰å…¨çš„å‰æä¸‹ï¼Œæ”¯æŒæ³›å‹ç±»å‹çš„éšå¼è½¬æ¢â€”â€” ç®€å•è¯´ï¼Œå°±æ˜¯è®©Â IFooå­ç±»Â å’ŒÂ IFooçˆ¶ç±»Â ä¹‹é—´èƒ½åˆç†å…¼å®¹ï¼Œè§£å†³é»˜è®¤æ³›å‹ â€œä¸å˜æ€§â€ å¯¼è‡´çš„çµæ´»æ€§ä¸è¶³é—®é¢˜ã€‚ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™æ˜¯ C# æ³›å‹ç‹¬æœ‰çš„ç‰¹æ€§ï¼ˆC++ æ¨¡æ¿æ— ç›´æ¥å¯¹åº”ï¼Œä½†å¯ç±»æ¯” C++ å‡½æ•°æŒ‡é’ˆçš„ç±»å‹å…¼å®¹è§„åˆ™ã€C++20Â conceptsÂ çš„çº¦æŸé€»è¾‘ï¼‰ï¼Œå…¶è®¾è®¡æ ¸å¿ƒæ˜¯ â€œç±»å‹å®‰å…¨ä¼˜å…ˆâ€ï¼šæ‰€æœ‰åå˜ é€†å˜è½¬æ¢éƒ½å¿…é¡»ç»è¿‡ç¼–è¯‘å™¨éªŒè¯ï¼Œç¡®ä¿ä¸ä¼šå‡ºç°ç±»å‹è½¬æ¢å¼‚å¸¸ï¼ˆå¦‚å°†Â DogÂ å­˜å…¥Â ListCatï¼‰ã€‚ ä¸€ã€å…ˆææ‡‚ï¼šé»˜è®¤æ³›å‹æ˜¯ â€œä¸å˜çš„â€ï¼ˆä¸ºä»€ä¹ˆéœ€è¦åå˜ é€†å˜ï¼Ÿï¼‰åœ¨ç†è§£åå˜ é€†å˜å‰ï¼Œå¿…é¡»å…ˆæ˜ç¡®ï¼šC# æ³›å‹é»˜è®¤æ˜¯Â ä¸å˜çš„ï¼ˆInvariantï¼‰â€”â€” å³Â ListCatï¼ˆå­ç±»æ³›å‹ï¼‰å’ŒÂ ListAnimalï¼ˆçˆ¶ç±»æ³›å‹ï¼‰ä¹‹é—´æ²¡æœ‰ä»»ä½•éšå¼è½¬æ¢å…³ç³»ï¼Œå³ä½¿Â CatÂ æ˜¯Â AnimalÂ çš„å­ç±»ã€‚ ç¤ºä¾‹ï¼šé»˜è®¤ä¸å˜çš„é—®é¢˜å‡è®¾å­˜åœ¨ç»§æ‰¿å…³ç³»ï¼šCat : Animalï¼ˆCatÂ æ˜¯Â AnimalÂ çš„å­ç±»ï¼‰ï¼š csharp è¿è¡Œ class Animal class Cat : Animal class Dog : Animal // ä»¥ä¸‹ä»£ç å‡ç¼–è¯‘æŠ¥é”™ï¼ˆé»˜è®¤æ³›å‹ä¸å˜ï¼‰ListCat cats = new ListCat();// ListAnimal animals = cats; // æŠ¥é”™ï¼šæ— æ³•å°† ListCat éšå¼è½¬æ¢ä¸º ListAnimal// ListCat cats2 = new ListAnimal(); // æŠ¥é”™ï¼šæ— æ³•å°† ListAnimal éšå¼è½¬æ¢ä¸º ListCat ä¸ºä»€ä¹ˆé»˜è®¤ä¸å˜ï¼Ÿï¼ˆç±»å‹å®‰å…¨çš„å¿…ç„¶è¦æ±‚ï¼‰å¦‚æœå…è®¸Â ListCat â†’ ListAnimalÂ çš„éšå¼è½¬æ¢ï¼Œä¼šå‡ºç°ä¸¥é‡çš„ç±»å‹å®‰å…¨é—®é¢˜ï¼š csharp è¿è¡Œ // å‡è®¾å…è®¸è¿™ç§è½¬æ¢ï¼ˆå®é™…ç¼–è¯‘æŠ¥é”™ï¼‰ListCat cats = new ListCat();ListAnimal animals = cats; // éæ³•è½¬æ¢ï¼ˆå‡è®¾åˆæ³•ï¼‰// å‘ animals ä¸­æ·»åŠ  Dogï¼ˆAnimal çš„å­ç±»ï¼Œçœ‹ä¼¼åˆç†ï¼‰animals.Add(new Dog()); // æ­¤æ—¶ cats åˆ—è¡¨ä¸­æ··å…¥äº† Dogï¼Œç ´åç±»å‹ä¸€è‡´æ€§// åç»­ä» cats ä¸­è¯»å–æ—¶ï¼Œä¼šæŠ›å‡º InvalidCastExceptionï¼ˆCat ä¸èƒ½å¼ºè½¬ Dogï¼‰Cat cat = cats[0]; // ç¾éš¾ï¼åˆ—è¡¨é‡Œå®é™…æ˜¯ Dog æ­£æ˜¯ä¸ºäº†é¿å…è¿™ç§ â€œç±»å‹æ±¡æŸ“â€ï¼ŒC# é»˜è®¤ç¦æ­¢æ³›å‹ç±»å‹çš„ç›´æ¥è½¬æ¢ â€”â€” ä½†è¿™ä¹Ÿå¸¦æ¥äº†çµæ´»æ€§é—®é¢˜ï¼šæœ‰äº›åœºæ™¯ä¸‹ï¼ŒListCatÂ ç¡®å® â€œå¯ä»¥å½“ä½œâ€ListAnimalÂ ä½¿ç”¨ï¼ˆæ¯”å¦‚åªè¯»å–å…ƒç´ ï¼Œä¸ä¿®æ”¹ï¼‰ï¼Œæ­¤æ—¶é»˜è®¤ä¸å˜å°±æ˜¾å¾—è¿‡äºä¸¥æ ¼ã€‚ åå˜å’Œé€†å˜çš„æ ¸å¿ƒä½œç”¨ï¼šåœ¨ â€œä¸ç ´åç±»å‹å®‰å…¨â€ çš„ç‰¹å®šåœºæ™¯ä¸‹ï¼Œå…è®¸æ³›å‹ç±»å‹çš„éšå¼è½¬æ¢ã€‚ äºŒã€åå˜ï¼ˆCovarianceï¼‰ï¼šå­ç±»æ³›å‹ â†’ çˆ¶ç±»æ³›å‹ï¼ˆout å…³é”®å­—ï¼‰1. æ ¸å¿ƒå®šä¹‰åå˜æ˜¯æŒ‡ï¼šæ³›å‹æ¥å£ å§”æ‰˜æ”¯æŒä» â€œå­ç±»æ³›å‹â€ éšå¼è½¬æ¢ä¸º â€œçˆ¶ç±»æ³›å‹â€ï¼ˆè½¬æ¢æ–¹å‘ä¸ç±»ç»§æ‰¿æ–¹å‘ä¸€è‡´ï¼šCat â†’ AnimalÂ â†’Â IFooCat â†’ IFooAnimalï¼‰ã€‚ æ ‡è®°ï¼šæ¥å£ç”¨Â outÂ å…³é”®å­—ä¿®é¥°æ³›å‹å‚æ•°ï¼ˆå¦‚Â IEnumerableout Tï¼‰ï¼› æ ¸å¿ƒçº¦æŸï¼šæ³›å‹å‚æ•°Â TÂ åªèƒ½ä½œä¸ºÂ æ–¹æ³•çš„è¿”å›å€¼ åªè¯»å±æ€§ï¼ˆä¸èƒ½ä½œä¸ºæ–¹æ³•å‚æ•°ï¼‰â€”â€” ç¡®ä¿ â€œåªå‡ºä¸è¿›â€ï¼Œé¿å…ç±»å‹æ±¡æŸ“ã€‚ 2. å…¸å‹ç¤ºä¾‹ï¼šIEnumerableout Tï¼ˆC# å†…ç½®åå˜æ¥å£ï¼‰IEnumerableTÂ æ˜¯ C# æœ€å¸¸ç”¨çš„åå˜æ¥å£ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼ˆç®€åŒ–ï¼‰ï¼š csharp è¿è¡Œ // out æ ‡è®° T ä¸ºåå˜ç±»å‹å‚æ•°public interface IEnumerableout T // T ä»…ä½œä¸ºè¿”å›å€¼ï¼ˆGetEnumerator() è¿”å› IEnumeratorTï¼Œå…¶ Current å±æ€§æ˜¯ Tï¼‰ IEnumeratorT GetEnumerator(); æ­£å› ä¸ºÂ TÂ æ˜¯åå˜çš„ï¼Œæ‰€ä»¥ä»¥ä¸‹è½¬æ¢æ˜¯åˆæ³•çš„ï¼š csharp è¿è¡Œ ListCat cats = new ListCat new Cat() ;// åˆæ³•ï¼šIEnumerableCat â†’ IEnumerableAnimalï¼ˆåå˜è½¬æ¢ï¼‰IEnumerableAnimal animals = cats;// éå† animalsï¼šåªèƒ½è¯»å–ï¼ˆIEnumerable æ—  Add æ–¹æ³•ï¼‰ï¼Œä¸ä¼šæ±¡æŸ“åŸåˆ—è¡¨foreach (Animal animal in animals) Console.WriteLine(animal.GetType().Name); // è¾“å‡º Catï¼Œç±»å‹å®‰å…¨ 3. åå˜çš„ç±»å‹å®‰å…¨ä¿éšœï¼šoutÂ å…³é”®å­—çš„æ„ä¹‰outÂ å…³é”®å­—å¼ºåˆ¶çº¦æŸï¼šæ³›å‹å‚æ•°Â TÂ åªèƒ½ â€œå‘å¤–è¾“å‡ºâ€ï¼ˆè¿”å›å€¼ åªè¯»å±æ€§ï¼‰ï¼Œä¸èƒ½ â€œå‘å†…è¾“å…¥â€ï¼ˆæ–¹æ³•å‚æ•°ï¼‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œåå˜è½¬æ¢åæ— æ³•ä¿®æ”¹åŸé›†åˆï¼ˆå¦‚æ·»åŠ Â Dogï¼‰ï¼Œè‡ªç„¶ä¸ä¼šå‡ºç°ç±»å‹æ±¡æŸ“ã€‚ å¦‚æœå°è¯•åœ¨åå˜æ¥å£ä¸­ç”¨Â TÂ ä½œä¸ºå‚æ•°ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™ï¼š csharp è¿è¡Œ // ç¼–è¯‘æŠ¥é”™ï¼šåå˜ç±»å‹å‚æ•° T ä¸èƒ½ä½œä¸ºæ–¹æ³•å‚æ•°public interface IFooout T void Add(T item); // é”™è¯¯ï¼šT æ˜¯åå˜ç±»å‹ï¼Œä¸èƒ½ä½œä¸ºè¾“å…¥å‚æ•° T GetItem(); // åˆæ³•ï¼šT ä½œä¸ºè¿”å›å€¼ 4. å§”æ‰˜çš„åå˜ï¼šFuncout TResultå§”æ‰˜ä¹Ÿæ”¯æŒåå˜ï¼Œå…¸å‹ä¾‹å­æ˜¯Â FuncTResultï¼ˆæ— å‚æ•°ã€è¿”å›Â TResultÂ çš„å§”æ‰˜ï¼‰ï¼š csharp è¿è¡Œ // å®šä¹‰ï¼šFuncout TResultï¼ˆTResult æ˜¯åå˜ç±»å‹å‚æ•°ï¼‰public delegate TResult Funcout TResult();// å­ç±»è¿”å›å€¼çš„å§”æ‰˜FuncCat getCat = () = new Cat();// åˆæ³•ï¼šFuncCat â†’ FuncAnimalï¼ˆåå˜è½¬æ¢ï¼‰FuncAnimal getAnimal = getCat;Animal animal = getAnimal(); // è¿”å› Catï¼Œç±»å‹å®‰å…¨ï¼ˆCat æ˜¯ Animal çš„å­ç±»ï¼‰ ä¸‰ã€é€†å˜ï¼ˆContravarianceï¼‰ï¼šçˆ¶ç±»æ³›å‹ â†’ å­ç±»æ³›å‹ï¼ˆin å…³é”®å­—ï¼‰1. æ ¸å¿ƒå®šä¹‰é€†å˜æ˜¯æŒ‡ï¼šæ³›å‹æ¥å£ å§”æ‰˜æ”¯æŒä» â€œçˆ¶ç±»æ³›å‹â€ éšå¼è½¬æ¢ä¸º â€œå­ç±»æ³›å‹â€ï¼ˆè½¬æ¢æ–¹å‘ä¸ç±»ç»§æ‰¿æ–¹å‘ç›¸åï¼šAnimal â†’ CatÂ â†’Â IFooAnimal â†’ IFooCatï¼‰ã€‚ æ ‡è®°ï¼šæ¥å£ç”¨Â inÂ å…³é”®å­—ä¿®é¥°æ³›å‹å‚æ•°ï¼ˆå¦‚Â IComparerin Tï¼‰ï¼› æ ¸å¿ƒçº¦æŸï¼šæ³›å‹å‚æ•°Â TÂ åªèƒ½ä½œä¸ºÂ æ–¹æ³•çš„è¾“å…¥å‚æ•°ï¼ˆä¸èƒ½ä½œä¸ºè¿”å›å€¼ åªè¯»å±æ€§ï¼‰â€”â€” ç¡®ä¿ â€œåªè¿›ä¸å‡ºâ€ï¼Œé¿å…ç±»å‹ä¸åŒ¹é…ã€‚ 2. å…¸å‹ç¤ºä¾‹ï¼šIComparerin Tï¼ˆC# å†…ç½®é€†å˜æ¥å£ï¼‰IComparerTÂ æ˜¯ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„æ¥å£ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼ˆç®€åŒ–ï¼‰ï¼š csharp è¿è¡Œ // in æ ‡è®° T ä¸ºé€†å˜ç±»å‹å‚æ•°public interface IComparerin T // T ä»…ä½œä¸ºè¾“å…¥å‚æ•°ï¼ˆæ¯”è¾ƒä¸¤ä¸ª T ç±»å‹å¯¹è±¡ï¼‰ int Compare(T x, T y); å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ¯”è¾ƒÂ AnimalÂ å¹´é¾„çš„æ¯”è¾ƒå™¨ï¼Œç”±äºÂ TÂ æ˜¯é€†å˜çš„ï¼Œå®ƒå¯ä»¥ç›´æ¥ç”¨äºæ¯”è¾ƒÂ Catï¼ˆå­ç±»ï¼‰ï¼š csharp è¿è¡Œ // å®ç° IComparerAnimalï¼šæ¯”è¾ƒä¸¤ä¸ª Animal çš„å¹´é¾„ï¼ˆå‡è®¾ Animal æœ‰ Age å±æ€§ï¼‰class AnimalAgeComparer : IComparerAnimal public int Compare(Animal x, Animal y) return x.Age.CompareTo(y.Age); // åˆ›å»ºçˆ¶ç±»æ³›å‹çš„æ¯”è¾ƒå™¨IComparerAnimal animalComparer = new AnimalAgeComparer();// åˆæ³•ï¼šIComparerAnimal â†’ IComparerCatï¼ˆé€†å˜è½¬æ¢ï¼‰IComparerCat catComparer = animalComparer;// ç”¨ catComparer æ¯”è¾ƒä¸¤ä¸ª Catï¼ˆç±»å‹å®‰å…¨ï¼šCat æ˜¯ Animal çš„å­ç±»ï¼Œæ¯”è¾ƒé€»è¾‘å®Œå…¨é€‚ç”¨ï¼‰Cat cat1 = new Cat Age = 3 ;Cat cat2 = new Cat Age = 5 ;int result = catComparer.Compare(cat1, cat2); // è¿”å› -1ï¼ˆ3 5ï¼‰ 3. é€†å˜çš„ç±»å‹å®‰å…¨ä¿éšœï¼šinÂ å…³é”®å­—çš„æ„ä¹‰inÂ å…³é”®å­—å¼ºåˆ¶çº¦æŸï¼šæ³›å‹å‚æ•°Â TÂ åªèƒ½ â€œå‘å†…è¾“å…¥â€ï¼ˆæ–¹æ³•å‚æ•°ï¼‰ï¼Œä¸èƒ½ â€œå‘å¤–è¾“å‡ºâ€ï¼ˆè¿”å›å€¼ï¼‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œçˆ¶ç±»çš„å¤„ç†é€»è¾‘ï¼ˆå¦‚æ¯”è¾ƒÂ AnimalÂ å¹´é¾„ï¼‰å®Œå…¨é€‚ç”¨äºå­ç±»ï¼ˆCatï¼‰ï¼Œä¸ä¼šå‡ºç°ç±»å‹ä¸åŒ¹é…ã€‚ å¦‚æœå°è¯•åœ¨é€†å˜æ¥å£ä¸­ç”¨Â TÂ ä½œä¸ºè¿”å›å€¼ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼š csharp è¿è¡Œ // ç¼–è¯‘æŠ¥é”™ï¼šé€†å˜ç±»å‹å‚æ•° T ä¸èƒ½ä½œä¸ºè¿”å›å€¼public interface IFooin T T GetItem(); // é”™è¯¯ï¼šT æ˜¯é€†å˜ç±»å‹ï¼Œä¸èƒ½ä½œä¸ºè¿”å›å€¼ void Process(T item); // åˆæ³•ï¼šT ä½œä¸ºè¾“å…¥å‚æ•° 4. å§”æ‰˜çš„é€†å˜ï¼šActionin Tå§”æ‰˜çš„é€†å˜å…¸å‹ä¾‹å­æ˜¯Â ActionTï¼ˆæ¥æ”¶Â TÂ ç±»å‹å‚æ•°ã€æ— è¿”å›å€¼çš„å§”æ‰˜ï¼‰ï¼š csharp è¿è¡Œ // å®šä¹‰ï¼šActionin Tï¼ˆT æ˜¯é€†å˜ç±»å‹å‚æ•°ï¼‰public delegate void Actionin T(T obj);// çˆ¶ç±»å‚æ•°çš„å§”æ‰˜ï¼šå¤„ç† AnimalActionAnimal feedAnimal = (animal) = Console.WriteLine($å–‚é£Ÿ animal.GetType().Name);// åˆæ³•ï¼šActionAnimal â†’ ActionCatï¼ˆé€†å˜è½¬æ¢ï¼‰ActionCat feedCat = feedAnimal;// è°ƒç”¨å§”æ‰˜ï¼šä¼ å…¥ Catï¼ˆç±»å‹å®‰å…¨ï¼ŒCat æ˜¯ Animal çš„å­ç±»ï¼‰feedCat(new Cat()); // è¾“å‡ºï¼šå–‚é£Ÿ Cat å››ã€åå˜ä¸é€†å˜çš„æ ¸å¿ƒè§„åˆ™ï¼ˆé¿å‘å…³é”®ï¼‰1. æ ‡è®°è§„åˆ™ï¼šout åå˜ï¼Œin é€†å˜ ç‰¹æ€§ å…³é”®å­— è½¬æ¢æ–¹å‘ æ³›å‹å‚æ•°ä½¿ç”¨çº¦æŸ å…¸å‹ä¾‹å­ åå˜ out å­ç±»æ³›å‹ â†’ çˆ¶ç±»æ³›å‹ ä»…ä½œä¸ºè¿”å›å€¼ åªè¯»å±æ€§ IEnumerableã€Func é€†å˜ in çˆ¶ç±»æ³›å‹ â†’ å­ç±»æ³›å‹ ä»…ä½œä¸ºæ–¹æ³•å‚æ•° IComparerã€Action ä¸å˜ æ—  æ— éšå¼è½¬æ¢ å¯ä½œä¸ºå‚æ•° è¿”å›å€¼ Listã€DictionaryTKey,TValue 2. é€‚ç”¨èŒƒå›´ï¼šä»…æ”¯æŒæ¥å£å’Œå§”æ‰˜åå˜ é€†å˜Â åªé€‚ç”¨äºæ³›å‹æ¥å£å’Œæ³›å‹å§”æ‰˜ï¼Œæ³›å‹ç±»ï¼ˆå¦‚Â ListTã€DictionaryTï¼‰å’Œæ³›å‹ç»“æ„ä½“ä¸æ”¯æŒæ˜¾å¼åå˜ é€†å˜ï¼ˆé»˜è®¤ä¸å˜ï¼‰ã€‚ æ¯”å¦‚Â ListTÂ ä¸èƒ½æ ‡è®°ä¸ºåå˜ï¼Œå› ä¸ºå®ƒçš„Â Add(T)Â æ–¹æ³•å…è®¸ä¿®æ”¹é›†åˆï¼ˆT ä½œä¸ºå‚æ•°ï¼‰ï¼Œthis[int index]Â æ—¢å¯ä»¥è¯»ï¼ˆè¿”å› Tï¼‰ä¹Ÿå¯ä»¥å†™ï¼ˆæ¥æ”¶ Tï¼‰ï¼Œä¸ç¬¦åˆÂ outÂ æˆ–Â inÂ çš„çº¦æŸã€‚ 3. ç±»å‹é™åˆ¶ï¼šä»…æ”¯æŒå¼•ç”¨ç±»å‹åå˜ é€†å˜çš„è½¬æ¢åªæ”¯æŒå¼•ç”¨ç±»å‹ï¼Œå€¼ç±»å‹ï¼ˆå¦‚Â intã€DateTimeï¼‰ä¸æ”¯æŒã€‚ä¾‹å¦‚ï¼š csharp è¿è¡Œ IEnumerableint ints = new Listint();// IEnumerableobject objs = ints; // ç¼–è¯‘æŠ¥é”™ï¼šå€¼ç±»å‹ä¸æ”¯æŒåå˜è½¬æ¢ åŸå› ï¼šå€¼ç±»å‹åœ¨æ³›å‹ä¸­ä¼šè¢« â€œå…·ä½“åŒ–â€ï¼ˆå¦‚Â ListintÂ å’ŒÂ ListobjectÂ æ˜¯å®Œå…¨ç‹¬ç«‹çš„ç±»å‹ï¼Œæ— ç»§æ‰¿å…³ç³»ï¼‰ï¼Œè€Œå¼•ç”¨ç±»å‹çš„æ³›å‹å®ä¾‹å…±äº«ç›¸åŒçš„æ¥å£ç»“æ„ã€‚ 4. ç±»å‹å®‰å…¨ï¼šç¼–è¯‘å™¨å¼ºåˆ¶æ ¡éªŒæ‰€æœ‰åå˜ é€†å˜è½¬æ¢éƒ½ç”±ç¼–è¯‘å™¨éªŒè¯ï¼Œç¡®ä¿ä¸ä¼šå‡ºç°è¿è¡Œæ—¶ç±»å‹å¼‚å¸¸ã€‚æ ¸å¿ƒé€»è¾‘æ˜¯ï¼š åå˜ï¼ˆoutï¼‰ï¼šåªèƒ½ â€œè¯»â€ï¼ˆè¿”å›å€¼ï¼‰ï¼Œä¸èƒ½ â€œå†™â€ï¼ˆå‚æ•°ï¼‰â†’ ä¸ä¼šæ±¡æŸ“åŸé›†åˆï¼› é€†å˜ï¼ˆinï¼‰ï¼šåªèƒ½ â€œå†™â€ï¼ˆå‚æ•°ï¼‰ï¼Œä¸èƒ½ â€œè¯»â€ï¼ˆè¿”å›å€¼ï¼‰â†’ çˆ¶ç±»é€»è¾‘é€‚ç”¨äºå­ç±»ã€‚ äº”ã€ä¸ C++ çš„ç±»æ¯”ï¼ˆå¸®åŠ©ç†è§£ï¼‰C++ æ²¡æœ‰ç›´æ¥çš„ â€œåå˜ é€†å˜â€ å…³é”®å­—ï¼Œä½†å­˜åœ¨ç±»ä¼¼çš„ç±»å‹å…¼å®¹åœºæ™¯ï¼Œå¯ä½œä¸ºç±»æ¯”ï¼š 1. åå˜ç±»æ¯”ï¼šC++ å‡½æ•°æŒ‡é’ˆçš„è¿”å›å€¼åå˜C++ ä¸­ï¼Œå‡½æ•°æŒ‡é’ˆçš„è¿”å›å€¼æ”¯æŒ â€œå­ç±»â†’çˆ¶ç±»â€ çš„åå˜ï¼ˆä¸ C# åå˜ä¸€è‡´ï¼‰ï¼š cpp è¿è¡Œ class Animal ;class Cat : public Animal ;// çˆ¶ç±»è¿”å›å€¼çš„å‡½æ•°æŒ‡é’ˆtypedef Animal* (*FuncAnimal)();// å­ç±»è¿”å›å€¼çš„å‡½æ•°Cat* CreateCat() return new Cat(); // åˆæ³•ï¼šFuncCat â†’ FuncAnimalï¼ˆè¿”å›å€¼åå˜ï¼Œä¸ C# åå˜é€»è¾‘ä¸€è‡´ï¼‰FuncAnimal func = CreateCat;Animal* animal = func(); // å®‰å…¨ï¼ŒCat* å¯éšå¼è½¬æ¢ä¸º Animal* 2. é€†å˜ç±»æ¯”ï¼šC++ å‡½æ•°æŒ‡é’ˆçš„å‚æ•°é€†å˜C++ ä¸­ï¼Œå‡½æ•°æŒ‡é’ˆçš„å‚æ•°æ”¯æŒ â€œçˆ¶ç±»â†’å­ç±»â€ çš„é€†å˜ï¼ˆä¸ C# é€†å˜ä¸€è‡´ï¼‰ï¼š cpp è¿è¡Œ // å­ç±»å‚æ•°çš„å‡½æ•°æŒ‡é’ˆtypedef void (*FuncCat)(Cat*);// çˆ¶ç±»å‚æ•°çš„å‡½æ•°void FeedAnimal(Animal* animal) /* å¤„ç†é€»è¾‘ */ // åˆæ³•ï¼šFuncAnimal â†’ FuncCatï¼ˆå‚æ•°é€†å˜ï¼Œä¸ C# é€†å˜é€»è¾‘ä¸€è‡´ï¼‰FuncCat func = FeedAnimal;func(new Cat()); // å®‰å…¨ï¼ŒCat* å¯éšå¼è½¬æ¢ä¸º Animal* 3. æ ¸å¿ƒå·®å¼‚ C#ï¼šé€šè¿‡Â out/inÂ å…³é”®å­—æ˜¾å¼æ ‡è®°åå˜ é€†å˜ï¼Œä»…é€‚ç”¨äºæ³›å‹æ¥å£ å§”æ‰˜ï¼Œç¼–è¯‘å™¨ä¸¥æ ¼æ ¡éªŒï¼› C++ï¼šæ— æ˜¾å¼æ ‡è®°ï¼Œé€šè¿‡å‡½æ•°æŒ‡é’ˆ æˆå‘˜å‡½æ•°æŒ‡é’ˆçš„ç±»å‹å…¼å®¹è§„åˆ™éšå¼æ”¯æŒï¼Œé€‚ç”¨äºå‡½æ•°ç±»å‹ï¼Œæ— æ³›å‹å±‚é¢çš„ç›´æ¥å¯¹åº”ã€‚ å…­ã€å®é™…å¼€å‘ä¸­çš„åº”ç”¨åœºæ™¯1. åå˜ï¼šå¤šæ€é›†åˆçš„åªè¯»è®¿é—®å½“ä½ éœ€è¦å°† â€œå­ç±»é›†åˆâ€ å½“ä½œ â€œçˆ¶ç±»é›†åˆâ€ åªè¯»éå†ï¼ˆå¦‚å±•ç¤ºæ‰€æœ‰åŠ¨ç‰©ï¼Œä¸ç®¡æ˜¯çŒ«è¿˜æ˜¯ç‹—ï¼‰æ—¶ï¼Œåå˜æ¥å£ï¼ˆIEnumerableTï¼‰æ˜¯å…³é”®ï¼š csharp è¿è¡Œ // å‡è®¾å­˜åœ¨å¤šä¸ª Animal å­ç±»ListCat cats = new ListCat();ListDog dogs = new ListDog();// åå˜è½¬æ¢ï¼šç»Ÿä¸€è½¬ä¸º IEnumerableAnimalIEnumerableAnimal allAnimals = cats.ConcatAnimal(dogs);foreach (var animal in allAnimals) Console.WriteLine(animal.GetType().Name); // å®‰å…¨éå†æ‰€æœ‰åŠ¨ç‰© 2. é€†å˜ï¼šé€šç”¨å¤„ç†é€»è¾‘çš„å¤ç”¨å½“ä½ æœ‰ä¸€ä¸ª â€œå¤„ç†çˆ¶ç±»â€ çš„é€»è¾‘ï¼Œæƒ³å¤ç”¨å®ƒå¤„ç†æ‰€æœ‰å­ç±»æ—¶ï¼Œé€†å˜æ¥å£ å§”æ‰˜èƒ½å‡å°‘é‡å¤ä»£ç ï¼š csharp è¿è¡Œ // é€šç”¨å¤„ç† Animal çš„é€»è¾‘void PrintAnimalInfo(Animal animal) Console.WriteLine($Name: animal.Name, Age: animal.Age);// é€†å˜å§”æ‰˜ï¼šActionAnimal â†’ ActionCatActionCat printCatInfo = PrintAnimalInfo;ActionDog printDogInfo = PrintAnimalInfo;// å¤ç”¨åŒä¸€é€»è¾‘å¤„ç†ä¸åŒå­ç±»printCatInfo(new Cat Name = Fritz, Age = 3 );printDogInfo(new Dog Name = Buddy, Age = 2 ); 3. è‡ªå®šä¹‰åå˜ é€†å˜æ¥å£å½“ä½ è®¾è®¡é€šç”¨ç»„ä»¶æ—¶ï¼Œå¯é€šè¿‡Â out/inÂ æ ‡è®°æ³›å‹æ¥å£ï¼Œæå‡çµæ´»æ€§ï¼š csharp è¿è¡Œ // åå˜æ¥å£ï¼šä»…è¿”å›æ•°æ®ï¼ˆåªè¯»ï¼‰public interface IDataReaderout T T ReadData();// é€†å˜æ¥å£ï¼šä»…å¤„ç†æ•°æ®ï¼ˆåªå†™ï¼‰public interface IDataProcessorin T void ProcessData(T data);// ä½¿ç”¨ç¤ºä¾‹ï¼šå­ç±»æ•°æ® reader å¯è½¬ä¸ºçˆ¶ç±» readerIDataReaderCat catReader = new CatDataReader();IDataReaderAnimal animalReader = catReader; // åå˜è½¬æ¢// çˆ¶ç±»æ•°æ® processor å¯è½¬ä¸ºå­ç±» processorIDataProcessorAnimal animalProcessor = new AnimalDataProcessor();IDataProcessorCat catProcessor = animalProcessor; // é€†å˜è½¬æ¢ æ€»ç»“åå˜å’Œé€†å˜çš„æ ¸å¿ƒæ˜¯Â â€œåœ¨ç±»å‹å®‰å…¨çš„å‰æä¸‹ï¼Œæå‡æ³›å‹æ¥å£ å§”æ‰˜çš„çµæ´»æ€§â€ï¼š åå˜ï¼ˆoutï¼‰ï¼šå­ç±»æ³›å‹ â†’ çˆ¶ç±»æ³›å‹ï¼Œä»…æ”¯æŒè¿”å›å€¼ï¼Œé€‚ç”¨äº â€œåªè¯»â€ åœºæ™¯ï¼ˆå¦‚éå†ï¼‰ï¼› é€†å˜ï¼ˆinï¼‰ï¼šçˆ¶ç±»æ³›å‹ â†’ å­ç±»æ³›å‹ï¼Œä»…æ”¯æŒå‚æ•°ï¼Œé€‚ç”¨äº â€œé€šç”¨å¤„ç†â€ åœºæ™¯ï¼ˆå¤ç”¨çˆ¶ç±»é€»è¾‘ï¼‰ï¼› ä¸å˜ï¼šé»˜è®¤è¡Œä¸ºï¼Œæ³›å‹ç±» ç»“æ„ä½“å‡ä¸ºä¸å˜ï¼Œæ”¯æŒè¯»å†™æ“ä½œï¼Œä½†æ— éšå¼è½¬æ¢ï¼› ä¸ C++ ç±»æ¯”ï¼šç±»ä¼¼å‡½æ•°æŒ‡é’ˆçš„ç±»å‹å…¼å®¹è§„åˆ™ï¼Œä½† C# æ˜¯æ³›å‹å±‚é¢çš„æ˜¾å¼ç‰¹æ€§ï¼Œæ›´å®‰å…¨ã€æ›´æ˜“å¤ç”¨ã€‚ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼Œæ— éœ€çº ç»“åº•å±‚å®ç°ï¼Œè®°ä½æ ¸å¿ƒï¼šout æ˜¯ â€œè¾“å‡ºâ€ï¼ˆåå˜ï¼‰ï¼Œin æ˜¯ â€œè¾“å…¥â€ï¼ˆé€†å˜ï¼‰ï¼Œä¸€åˆ‡è½¬æ¢éƒ½ä»¥ç±»å‹å®‰å…¨ä¸ºå‰æâ€”â€” ç¼–è¯‘å™¨ä¼šå¸®ä½ æ ¡éªŒï¼Œåªè¦ä¸è¿åÂ out/inÂ çš„çº¦æŸï¼Œå°±èƒ½æ”¾å¿ƒä½¿ç”¨ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"åºåˆ—åŒ–ä¸ååºåˆ—åŒ–","path":"/2025/11/26/2-ç¼–ç¨‹è¯­è¨€-CSharp-åºåˆ—åŒ–ä¸ååºåˆ—åŒ–/","content":"åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼šC# è¯¦ç»†è§£æï¼ˆé¢å‘ C++ ç¨‹åºå‘˜ï¼‰åºåˆ—åŒ–ï¼ˆSerializationï¼‰å’Œååºåˆ—åŒ–ï¼ˆDeserializationï¼‰æ˜¯Â æ•°æ®æ ¼å¼è½¬æ¢ä¸çŠ¶æ€æŒä¹…åŒ–Â çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ï¼šå°†å†…å­˜ä¸­çš„ â€œæ´»å¯¹è±¡â€ï¼ˆå¦‚Â CatÂ å®ä¾‹ï¼‰ä¸ â€œå¯å­˜å‚¨ å¯ä¼ è¾“çš„å­—èŠ‚æµ æ–‡æœ¬â€ ç›¸äº’è½¬æ¢ï¼Œè§£å†³æ•°æ®åœ¨å­˜å‚¨ï¼ˆå¦‚æ–‡ä»¶ï¼‰Â æˆ–ä¼ è¾“ï¼ˆå¦‚ç½‘ç»œï¼‰Â ä¸­çš„å…¼å®¹æ€§é—®é¢˜ã€‚ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼ŒC# çš„åºåˆ—åŒ–æœºåˆ¶æ¯” C++ æ›´æˆç†Ÿï¼ˆå†…ç½®å¤šç§åºåˆ—åŒ–åº“ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†å†…å­˜å¸ƒå±€ã€æŒ‡é’ˆå¼•ç”¨ç­‰åº•å±‚ç»†èŠ‚ â€”â€” ä½†æ ¸å¿ƒæ€æƒ³ä¸ C++ ä¸€è‡´ï¼ˆå¦‚ C++ ç”¨Â protobufnlohmann::jsonÂ å®ç°çš„åºåˆ—åŒ–ï¼‰ã€‚ ä¸€ã€æ ¸å¿ƒå®šä¹‰ï¼šåºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ˜¯ä»€ä¹ˆï¼Ÿ1. åºåˆ—åŒ–ï¼ˆSerializationï¼‰ æœ¬è´¨ï¼šå°†Â å†…å­˜ä¸­çš„å¯¹è±¡ï¼ˆObjectï¼‰Â â†’Â ç»“æ„åŒ–æ•°æ®æ ¼å¼ï¼ˆå¦‚ JSON æ–‡æœ¬ã€XML æ–‡æœ¬ã€äºŒè¿›åˆ¶å­—èŠ‚æµï¼‰ã€‚ æ ¸å¿ƒç›®çš„ï¼š æŒä¹…åŒ–å­˜å‚¨ï¼šå°†å¯¹è±¡çŠ¶æ€ä¿å­˜åˆ°æ–‡ä»¶ æ•°æ®åº“ï¼ˆå¦‚æŠŠÂ CatÂ å®ä¾‹å­˜ä¸º JSON æ–‡ä»¶ï¼Œä¸‹æ¬¡å¯åŠ¨ç¨‹åºå¯æ¢å¤ï¼‰ï¼› è·¨è¿›ç¨‹ è·¨å¹³å°ä¼ è¾“ï¼šå°†å¯¹è±¡è½¬ä¸ºé€šç”¨æ ¼å¼ï¼ˆå¦‚ JSONï¼‰ï¼Œé€šè¿‡ç½‘ç»œå‘é€ç»™å…¶ä»–ç¨‹åºï¼ˆå¦‚ C# åç«¯â†’Java å‰ç«¯ã€C# å®¢æˆ·ç«¯â†’C# æœåŠ¡ç«¯ï¼‰ã€‚ å…³é”®è¦æ±‚ï¼šéœ€ä¿å­˜å¯¹è±¡çš„ â€œæ ¸å¿ƒçŠ¶æ€â€ï¼ˆå¦‚å­—æ®µ å±æ€§å€¼ï¼‰ï¼Œæ— éœ€ä¿å­˜å¯¹è±¡çš„æ–¹æ³•ã€å†…å­˜åœ°å€ç­‰ä¸´æ—¶ä¿¡æ¯ã€‚ 2. ååºåˆ—åŒ–ï¼ˆDeserializationï¼‰ æœ¬è´¨ï¼šå°†Â ç»“æ„åŒ–æ•°æ®æ ¼å¼ï¼ˆå¦‚ JSONXML äºŒè¿›åˆ¶ï¼‰â†’Â å†…å­˜ä¸­çš„å¯¹è±¡ã€‚ æ ¸å¿ƒç›®çš„ï¼šæ¢å¤å¯¹è±¡çŠ¶æ€ï¼ˆå¦‚ä» JSON æ–‡ä»¶è¯»å–æ•°æ®ï¼Œé‡å»ºÂ CatÂ å®ä¾‹ï¼Œç»§ç»­ä½¿ç”¨è¯¥å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼‰ã€‚ å…³é”®è¦æ±‚ï¼šéœ€ç¡®ä¿æ•°æ®æ ¼å¼ä¸å¯¹è±¡ç±»å‹åŒ¹é…ï¼Œå¦åˆ™ä¼šæŠ›å‡ºè§£æå¼‚å¸¸ï¼ˆå¦‚ JSON å­—æ®µä¸å¯¹è±¡å±æ€§åä¸åŒ¹é…ï¼‰ã€‚ 3. é€šä¿—ç±»æ¯”ï¼ˆç”Ÿæ´»åœºæ™¯ï¼‰ åºåˆ—åŒ–ï¼šæŠŠä¸€å°ç»„è£…å¥½çš„ç”µè„‘ï¼ˆå†…å­˜ä¸­çš„å¯¹è±¡ï¼‰æ‹†è§£æˆæ ‡å‡†åŒ–é›¶ä»¶ï¼ˆJSON äºŒè¿›åˆ¶ï¼‰ï¼Œæ–¹ä¾¿è£…ç®±è¿è¾“ï¼ˆå­˜å‚¨ ä¼ è¾“ï¼‰ï¼› ååºåˆ—åŒ–ï¼šæŠŠè¿è¾“æ¥çš„é›¶ä»¶ï¼ˆç»“æ„åŒ–æ•°æ®ï¼‰é‡æ–°ç»„è£…æˆå¯ä½¿ç”¨çš„ç”µè„‘ï¼ˆå†…å­˜ä¸­çš„å¯¹è±¡ï¼‰ã€‚ äºŒã€ä¸ºä»€ä¹ˆéœ€è¦åºåˆ—åŒ–ï¼Ÿï¼ˆè§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼‰å†…å­˜ä¸­çš„å¯¹è±¡æ˜¯ â€œä¸´æ—¶çš„â€ï¼ˆç¨‹åºé€€å‡º è¿›ç¨‹ç»ˆæ­¢åæ¶ˆå¤±ï¼‰ï¼Œä¸” â€œå¹³å°ç›¸å…³â€ï¼ˆä¸åŒè¯­è¨€ ç³»ç»Ÿçš„å¯¹è±¡å†…å­˜å¸ƒå±€ä¸åŒï¼‰ã€‚æ²¡æœ‰åºåˆ—åŒ–æ—¶ï¼Œä¼šé¢ä¸´ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š æ— æ³•æŒä¹…åŒ–ï¼šæƒ³æŠŠÂ CatÂ å®ä¾‹çš„Â Name=Fritzã€Age=3Â ä¿å­˜åˆ°æ–‡ä»¶ï¼Œç›´æ¥å†™å†…å­˜åœ°å€æ¯«æ— æ„ä¹‰ï¼ˆä¸‹æ¬¡å¯åŠ¨ç¨‹åºå†…å­˜åœ°å€å·²å˜æ›´ï¼‰ï¼› æ— æ³•è·¨å¹³å°ä¼ è¾“ï¼šC# ç¨‹åºçš„Â CatÂ å¯¹è±¡å†…å­˜å¸ƒå±€ä¸ Java ç¨‹åºä¸åŒï¼Œç›´æ¥å‘é€å­—èŠ‚æµä¼šå¯¼è‡´å¯¹æ–¹æ— æ³•è§£æã€‚ åºåˆ—åŒ–é€šè¿‡ â€œä¸­é—´æ ¼å¼â€ è§£å†³è¿™äº›é—®é¢˜ï¼š ä¸­é—´æ ¼å¼ï¼ˆå¦‚ JSONï¼‰æ˜¯å¹³å°æ— å…³ã€è¯­è¨€æ— å…³çš„é€šç”¨æ ¼å¼ï¼› åºåˆ—åŒ–ï¼šå¯¹è±¡â†’ä¸­é—´æ ¼å¼ï¼ˆæ¶ˆé™¤å¹³å°å·®å¼‚ï¼‰ï¼› ååºåˆ—åŒ–ï¼šä¸­é—´æ ¼å¼â†’å¯¹è±¡ï¼ˆæ¢å¤å¹³å°ç›¸å…³çš„å¯¹è±¡ï¼‰ã€‚ ä¸‰ã€C# ä¸­å¸¸è§çš„åºåˆ—åŒ–æ ¼å¼ï¼ˆå¯¹æ¯” C++ï¼‰C# å†…ç½®å¤šç§åºåˆ—åŒ–åº“ï¼Œæ”¯æŒä¸åŒæ ¼å¼ï¼Œé€‰æ‹©æ—¶éœ€æƒè¡¡ â€œå¯è¯»æ€§ã€ä½“ç§¯ã€é€Ÿåº¦ã€å…¼å®¹æ€§â€ã€‚ä»¥ä¸‹æ˜¯ä¸»æµæ ¼å¼çš„å¯¹æ¯”ï¼ˆç»“åˆ C++ ç±»æ¯”ï¼‰ï¼š åºåˆ—åŒ–æ ¼å¼ æ ¸å¿ƒç‰¹ç‚¹ C# å®ç°åº“ C++ ç±»ä¼¼å®ç° é€‚ç”¨åœºæ™¯ JSON æ–‡æœ¬æ ¼å¼ï¼Œäººç±»å¯è¯»ï¼Œä½“ç§¯ä¸­ç­‰ï¼Œé€Ÿåº¦è¾ƒå¿« System.Text.Jsonï¼ˆ.NET Core 3.0+ å†…ç½®ï¼‰ã€Newtonsoft.Jsonï¼ˆJson.NETï¼Œç¬¬ä¸‰æ–¹ï¼‰ nlohmann::jsonã€RapidJSON ç½‘ç»œä¼ è¾“ï¼ˆAPI æ¥å£ï¼‰ã€é…ç½®æ–‡ä»¶ã€æ—¥å¿—å­˜å‚¨ XML æ–‡æœ¬æ ¼å¼ï¼Œç»“æ„åŒ–å¼ºï¼Œä½“ç§¯å¤§ï¼Œå…¼å®¹æ€§å¥½ System.Xml.Serializationï¼ˆå†…ç½®ï¼‰ TinyXMLã€PugiXML ä¼ ç»Ÿç³»ç»Ÿé›†æˆã€é…ç½®æ–‡ä»¶ã€SOAP åè®® äºŒè¿›åˆ¶ äºŒè¿›åˆ¶æµï¼Œä¸å¯è¯»ï¼Œä½“ç§¯æœ€å°ï¼Œé€Ÿåº¦æœ€å¿« BinaryFormatterï¼ˆå†…ç½®ï¼Œä¸æ¨èï¼‰ã€Protobuf-Netï¼ˆç¬¬ä¸‰æ–¹ï¼Œæ¨èï¼‰ Protobufã€FlatBuffers é«˜æ€§èƒ½ä¼ è¾“ï¼ˆå¦‚æ¸¸æˆæœåŠ¡å™¨ï¼‰ã€æœ¬åœ°æŒä¹…åŒ–ï¼ˆéœ€åŠ å¯†ï¼‰ å…¶ä»–ï¼ˆå¦‚ MessagePackï¼‰ äºŒè¿›åˆ¶ + ç±» JSON ç»“æ„ï¼Œé€Ÿåº¦å¿«ã€ä½“ç§¯å° MessagePack-CSharpï¼ˆç¬¬ä¸‰æ–¹ï¼‰ msgpack-c é«˜æ€§èƒ½è·¨å¹³å°ä¼ è¾“ å…³é”®é€‰å‹å»ºè®®ï¼ˆC# æœ€ä½³å®è·µï¼‰ ä¼˜å…ˆé€‰Â JSONï¼ˆSystem.Text.Jsonï¼‰ï¼šå…¼é¡¾å¯è¯»æ€§ã€é€Ÿåº¦å’Œå…¼å®¹æ€§ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯ï¼ˆAPIã€é…ç½®æ–‡ä»¶ï¼‰ï¼› é«˜æ€§èƒ½åœºæ™¯é€‰Â Protobufï¼ˆProtobuf-Netï¼‰ï¼šäºŒè¿›åˆ¶æ ¼å¼ï¼Œä½“ç§¯æ¯” JSON å° 30%-50%ï¼Œé€Ÿåº¦å¿« 2-5 å€ï¼› é¿å…ç”¨Â BinaryFormatterï¼šå­˜åœ¨ä¸¥é‡å®‰å…¨æ¼æ´ï¼ˆå¯è¢«æ³¨å…¥æ¶æ„ä»£ç ï¼‰ï¼Œä¸”åºåˆ—åŒ–ç»“æœä¸ .NET ç‰ˆæœ¬å¼ºç»‘å®šï¼ˆè·¨ç‰ˆæœ¬ä¸å…¼å®¹ï¼‰ã€‚ å››ã€åºåˆ—åŒ– ååºåˆ—åŒ–çš„æ ¸å¿ƒåŸç†ï¼ˆC# è§†è§’ï¼‰C# çš„åºåˆ—åŒ–åº“ï¼ˆå¦‚ System.Text.Jsonï¼‰æœ¬è´¨æ˜¯ â€œåå°„ + æ ¼å¼è§£æâ€ çš„ç»„åˆï¼Œæ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š 1. åºåˆ—åŒ–æµç¨‹ï¼ˆå¯¹è±¡â†’æ•°æ®ï¼‰plaintext å¯¹è±¡ â†’ åå°„è¯»å–æˆå‘˜ï¼ˆå­—æ®µ/å±æ€§ï¼‰â†’ è½¬æ¢ä¸ºä¸­é—´æ•°æ®ç»“æ„ï¼ˆé”®å€¼å¯¹ï¼‰â†’ æŒ‰ç›®æ ‡æ ¼å¼ï¼ˆJSON/XMLï¼‰åºåˆ—åŒ– â†’ è¾“å‡ºï¼ˆæ–‡ä»¶/ç½‘ç»œæµï¼‰ åå°„ï¼ˆReflectionï¼‰ï¼šåºåˆ—åŒ–åº“é€šè¿‡åå°„è·å–å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ï¼ˆå¦‚ç±»åã€å±æ€§åã€å±æ€§å€¼ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™å­—æ®µæ˜ å°„ä»£ç ï¼› æˆå‘˜ç­›é€‰ï¼šé»˜è®¤åªåºåˆ—åŒ–Â å…¬å…±æˆå‘˜ï¼ˆpublic å­—æ®µ å±æ€§ï¼‰ï¼Œç§æœ‰æˆå‘˜ï¼ˆprivateï¼‰éœ€é€šè¿‡é…ç½®å¯ç”¨ï¼› ç±»å‹è½¬æ¢ï¼šè‡ªåŠ¨å°† C# ç±»å‹ï¼ˆintstringDateTimeï¼‰è½¬ä¸ºç›®æ ‡æ ¼å¼çš„å¯¹åº”ç±»å‹ï¼ˆå¦‚ JSON ä¸­Â DateTimeÂ è½¬ä¸ºå­—ç¬¦ä¸²Â 2025-11-27ï¼‰ã€‚ 2. ååºåˆ—åŒ–æµç¨‹ï¼ˆæ•°æ®â†’å¯¹è±¡ï¼‰plaintext è¾“å…¥ï¼ˆæ–‡ä»¶/ç½‘ç»œæµï¼‰â†’ æŒ‰ç›®æ ‡æ ¼å¼è§£æ â†’ å¾—åˆ°ä¸­é—´æ•°æ®ç»“æ„ï¼ˆé”®å€¼å¯¹ï¼‰â†’ åå°„åˆ›å»ºå¯¹è±¡ â†’ èµ‹å€¼ç»™æˆå‘˜ â†’ è¿”å›å¯¹è±¡ ç±»å‹åŒ¹é…ï¼šè§£æåçš„é”®åéœ€ä¸å¯¹è±¡çš„å±æ€§ å­—æ®µåä¸€è‡´ï¼ˆæˆ–é€šè¿‡ç‰¹æ€§é…ç½®æ˜ å°„ï¼‰ï¼Œå¦åˆ™æ— æ³•èµ‹å€¼ï¼› ç±»å‹è½¬æ¢ï¼šè‡ªåŠ¨å°†ç›®æ ‡æ ¼å¼çš„ç±»å‹è½¬ä¸º C# ç±»å‹ï¼ˆå¦‚ JSON å­—ç¬¦ä¸²Â 3Â è½¬ä¸ºÂ intÂ 3ï¼‰ï¼› å¯¹è±¡åˆ›å»ºï¼šé€šè¿‡åå°„è°ƒç”¨å¯¹è±¡çš„æ— å‚æ„é€ å‡½æ•°ï¼ˆè‹¥æ²¡æœ‰åˆ™æŠ¥é”™ï¼Œéœ€é…ç½®æ”¯æŒæœ‰å‚æ„é€ ï¼‰ã€‚ 3. ä¸ C++ çš„æ ¸å¿ƒå·®å¼‚ C++ åºåˆ—åŒ–ï¼šéœ€æ‰‹åŠ¨å®šä¹‰å­—æ®µæ˜ å°„ï¼ˆå¦‚Â protobufÂ çš„Â .protoÂ æ–‡ä»¶ï¼‰ï¼Œæ— å†…ç½®åå°„ï¼ˆéœ€ç¬¬ä¸‰æ–¹åº“æ”¯æŒï¼‰ï¼Œéœ€æ‰‹åŠ¨å¤„ç†æŒ‡é’ˆ å¼•ç”¨ï¼ˆé¿å…åºåˆ—åŒ–é‡æŒ‡é’ˆï¼‰ï¼› C# åºåˆ—åŒ–ï¼šå†…ç½®åå°„ï¼Œè‡ªåŠ¨å­—æ®µæ˜ å°„ï¼Œæ— éœ€å…³å¿ƒæŒ‡é’ˆï¼ˆå¼•ç”¨ç±»å‹ä¼šè¢«åºåˆ—åŒ–å…¶çŠ¶æ€ï¼Œè€Œéå†…å­˜åœ°å€ï¼‰ï¼Œæ›´ç®€æ´ä½†çµæ´»æ€§ç•¥ä½ã€‚ äº”ã€C# å®æ“ï¼šä¸»æµåºåˆ—åŒ–åº“çš„ä½¿ç”¨ç¤ºä¾‹ä»¥ä¸‹ä»¥Â System.Text.Jsonï¼ˆå®˜æ–¹æ¨èï¼‰å’ŒÂ Protobuf-Netï¼ˆé«˜æ€§èƒ½ï¼‰ä¸ºä¾‹ï¼Œç»“åˆä¹‹å‰çš„Â CatÂ ç±»ï¼Œæ¼”ç¤ºå®Œæ•´çš„åºåˆ—åŒ– ååºåˆ—åŒ–æµç¨‹ã€‚ å‡†å¤‡å·¥ä½œï¼šå®šä¹‰å¯åºåˆ—åŒ–çš„ç±»csharp è¿è¡Œ // å¯åºåˆ—åŒ–çš„ Cat ç±»ï¼ˆå…¬å…±å±æ€§ï¼Œæ— å‚æ„é€ å‡½æ•°ï¼‰public class Cat // å…¬å…±å±æ€§ï¼ˆé»˜è®¤ä¼šè¢«åºåˆ—åŒ–ï¼‰ public string Name get; set; public int Age get; set; public DateTime BirthDate get; set; // ç§æœ‰å­—æ®µï¼ˆé»˜è®¤ä¸ä¼šè¢«åºåˆ—åŒ–ï¼Œéœ€é…ç½®å¯ç”¨ï¼‰ private string _nickname; // æ„é€ å‡½æ•°ï¼ˆååºåˆ—åŒ–éœ€æ— å‚æ„é€ ï¼Œè‹¥æœ‰æœ‰å‚æ„é€ éœ€ä¿ç•™æ— å‚ï¼‰ public Cat() public Cat(string name, int age, DateTime birthDate, string nickname) Name = name; Age = age; BirthDate = birthDate; _nickname = nickname; // è¾…åŠ©æ–¹æ³•ï¼šæ‰“å°å¯¹è±¡çŠ¶æ€ public override string ToString() return $Name: Name, Age: Age, BirthDate: BirthDate:yyyy-MM-dd, Nickname: _nickname; 1. ç¤ºä¾‹ 1ï¼šSystem.Text.Jsonï¼ˆJSON åºåˆ—åŒ–ï¼Œå®˜æ–¹å†…ç½®ï¼‰ï¼ˆ1ï¼‰åºåˆ—åŒ–ï¼šCat å¯¹è±¡â†’JSON å­—ç¬¦ä¸² æ–‡ä»¶csharp è¿è¡Œ using System.Text.Json;using System.IO;// 1. åˆ›å»ºå†…å­˜ä¸­çš„å¯¹è±¡var cat = new Cat( name: Fritz, age: 3, birthDate: new DateTime(2022, 1, 1), nickname: Little Tiger // ç§æœ‰å­—æ®µï¼Œé»˜è®¤ä¸åºåˆ—åŒ–);// 2. é…ç½®åºåˆ—åŒ–é€‰é¡¹ï¼ˆå¯é€‰ï¼šå¦‚å¿½ç•¥ç©ºå€¼ã€ç¾åŒ–æ ¼å¼ã€åºåˆ—åŒ–ç§æœ‰å­—æ®µï¼‰var serializeOptions = new JsonSerializerOptions WriteIndented = true, // ç¾åŒ– JSON æ ¼å¼ï¼ˆä¾¿äºé˜…è¯»ï¼‰ IncludeFields = true, // åºåˆ—åŒ–ç§æœ‰å­—æ®µï¼ˆé»˜è®¤å…³é—­ï¼‰ IgnoreNullValues = true // å¿½ç•¥å€¼ä¸º null çš„æˆå‘˜;// 3. åºåˆ—åŒ–å¯¹è±¡â†’JSON å­—ç¬¦ä¸²string jsonString = JsonSerializer.Serialize(cat, serializeOptions);Console.WriteLine(JSON åºåˆ—åŒ–ç»“æœï¼š);Console.WriteLine(jsonString);// 4. åºåˆ—åŒ–å¯¹è±¡â†’JSON æ–‡ä»¶ï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼‰await File.WriteAllTextAsync(cat.json, jsonString); åºåˆ—åŒ–è¾“å‡ºï¼ˆcat.jsonï¼‰json Name: Fritz, Age: 3, BirthDate: 2022-01-01T00:00:00, _nickname: Little Tiger // ç§æœ‰å­—æ®µå·²åºåˆ—åŒ–ï¼ˆå›  IncludeFields=trueï¼‰ ï¼ˆ2ï¼‰ååºåˆ—åŒ–ï¼šJSON å­—ç¬¦ä¸² æ–‡ä»¶â†’Cat å¯¹è±¡csharp è¿è¡Œ // 1. ä»æ–‡ä»¶è¯»å– JSON æ•°æ®string jsonFromFile = await File.ReadAllTextAsync(cat.json);// 2. é…ç½®ååºåˆ—åŒ–é€‰é¡¹ï¼ˆå¯é€‰ï¼šå¦‚å…è®¸æ³¨é‡Šã€å¿½ç•¥å¤§å°å†™ï¼‰var deserializeOptions = new JsonSerializerOptions AllowTrailingCommas = true, // å…è®¸ JSON æœ«å°¾æœ‰é€—å· IgnoreCase = true, // å¿½ç•¥é”®åå¤§å°å†™ï¼ˆå¦‚ JSON ä¸­ name å¯åŒ¹é…å¯¹è±¡ Nameï¼‰ IncludeFields = true // ååºåˆ—åŒ–åˆ°ç§æœ‰å­—æ®µ;// 3. ååºåˆ—åŒ– JSONâ†’Cat å¯¹è±¡Cat catFromJson = JsonSerializer.DeserializeCat(jsonFromFile, deserializeOptions);// 4. ä½¿ç”¨ååºåˆ—åŒ–åçš„å¯¹è±¡Console.WriteLine( ååºåˆ—åŒ–åçš„å¯¹è±¡ï¼š);Console.WriteLine(catFromJson.ToString());// è¾“å‡ºï¼šName: Fritz, Age: 3, BirthDate: 2022-01-01, Nickname: Little Tiger 2. ç¤ºä¾‹ 2ï¼šProtobuf-Netï¼ˆäºŒè¿›åˆ¶åºåˆ—åŒ–ï¼Œé«˜æ€§èƒ½ï¼‰Protobufï¼ˆProtocol Buffersï¼‰æ˜¯ Google å¼€å‘çš„äºŒè¿›åˆ¶åºåˆ—åŒ–æ ¼å¼ï¼Œä½“ç§¯å°ã€é€Ÿåº¦å¿«ï¼Œé€‚åˆé«˜æ€§èƒ½åœºæ™¯ã€‚C# ä¸­éœ€é€šè¿‡ NuGet å®‰è£…Â Protobuf-NetÂ åº“ï¼ˆå®‰è£…å‘½ä»¤ï¼šInstall-Package Protobuf-Netï¼‰ã€‚ ï¼ˆ1ï¼‰ä¿®æ”¹ç±»ï¼šæ·»åŠ  Protobuf ç‰¹æ€§ï¼ˆæŒ‡å®šå­—æ®µç¼–å·ï¼‰Protobuf éœ€é€šè¿‡å­—æ®µç¼–å·ï¼ˆè€Œéå­—æ®µåï¼‰åŒ¹é…æ•°æ®ï¼Œå› æ­¤éœ€ç»™ç±»å’Œæˆå‘˜æ·»åŠ Â [ProtoContract]Â å’ŒÂ [ProtoMember]Â ç‰¹æ€§ï¼š csharp è¿è¡Œ using ProtoBuf; // éœ€å¼•å…¥ Protobuf-Net å‘½åç©ºé—´// æ ‡è®°ä¸º Protobuf å¯åºåˆ—åŒ–[ProtoContract]public class Cat [ProtoMember(1)] // å­—æ®µç¼–å·ï¼ˆå¿…é¡»å”¯ä¸€ï¼Œç”¨äºååºåˆ—åŒ–åŒ¹é…ï¼‰ public string Name get; set; [ProtoMember(2)] public int Age get; set; [ProtoMember(3)] public DateTime BirthDate get; set; [ProtoMember(4)] // ç§æœ‰å­—æ®µéœ€æ˜¾å¼æ ‡è®° private string _nickname; public Cat() // ååºåˆ—åŒ–éœ€æ— å‚æ„é€  public Cat(string name, int age, DateTime birthDate, string nickname) Name = name; Age = age; BirthDate = birthDate; _nickname = nickname; public override string ToString() return $Name: Name, Age: Age, BirthDate: BirthDate:yyyy-MM-dd, Nickname: _nickname; ï¼ˆ2ï¼‰åºåˆ—åŒ–ï¼šCat å¯¹è±¡â†’äºŒè¿›åˆ¶æµ æ–‡ä»¶csharp è¿è¡Œ using ProtoBuf;using System.IO;// 1. åˆ›å»ºå¯¹è±¡var cat = new Cat(Fritz, 3, new DateTime(2022, 1, 1), Little Tiger);// 2. åºåˆ—åŒ–å¯¹è±¡â†’äºŒè¿›åˆ¶æ–‡ä»¶using (var stream = File.Create(cat.protobuf)) Serializer.Serialize(stream, cat); // åºåˆ—åŒ–åˆ°æµConsole.WriteLine(Protobuf åºåˆ—åŒ–å®Œæˆï¼ˆæ–‡ä»¶ï¼šcat.protobufï¼‰);// æ³¨æ„ï¼šäºŒè¿›åˆ¶æ–‡ä»¶ä¸å¯è¯»ï¼Œéœ€ååºåˆ—åŒ–åæ‰èƒ½æŸ¥çœ‹å†…å®¹ ï¼ˆ3ï¼‰ååºåˆ—åŒ–ï¼šäºŒè¿›åˆ¶æ–‡ä»¶â†’Cat å¯¹è±¡csharp è¿è¡Œ // 1. ä»äºŒè¿›åˆ¶æ–‡ä»¶ååºåˆ—åŒ–using (var stream = File.OpenRead(cat.protobuf)) Cat catFromProto = Serializer.DeserializeCat(stream); // ååºåˆ—åŒ– // 2. ä½¿ç”¨å¯¹è±¡ Console.WriteLine( Protobuf ååºåˆ—åŒ–åçš„å¯¹è±¡ï¼š); Console.WriteLine(catFromProto.ToString()); // è¾“å‡ºï¼šName: Fritz, Age: 3, BirthDate: 2022-01-01, Nickname: Little Tiger æ ¼å¼å¯¹æ¯”ï¼ˆJSON vs Protobufï¼‰ æ–‡ä»¶å¤§å°ï¼šcat.jsonï¼ˆçº¦ 150 å­—èŠ‚ï¼‰vsÂ cat.protobufï¼ˆçº¦ 40 å­—èŠ‚ï¼‰â†’ Protobuf ä½“ç§¯å° 70%ï¼› é€Ÿåº¦ï¼šProtobuf åºåˆ—åŒ– ååºåˆ—åŒ–é€Ÿåº¦æ¯” JSON å¿« 2-5 å€ï¼ˆå°¤å…¶æ˜¯å¤§æ•°æ®é‡åœºæ™¯ï¼‰ï¼› å¯è¯»æ€§ï¼šJSON äººç±»å¯è¯»ï¼ŒProtobuf äºŒè¿›åˆ¶ä¸å¯è¯»ï¼ˆéœ€å·¥å…·è§£æï¼‰ã€‚ å…­ã€å…³é”®æ³¨æ„äº‹é¡¹ï¼ˆé¿å‘æŒ‡å—ï¼‰1. åºåˆ—åŒ–çš„ â€œå¯åºåˆ—åŒ–æˆå‘˜â€ è§„åˆ™ é»˜è®¤ä»…åºåˆ—åŒ–Â å…¬å…±å±æ€§ å­—æ®µï¼ˆprivate æˆå‘˜éœ€é€šè¿‡é…ç½®å¯ç”¨ï¼Œå¦‚ System.Text.Json çš„Â IncludeFields=trueã€Protobuf-Net çš„Â [ProtoMember]ï¼‰ï¼› é™æ€æˆå‘˜ï¼ˆstaticï¼‰ã€å¸¸é‡ï¼ˆconstï¼‰ä¸ä¼šè¢«åºåˆ—åŒ–ï¼ˆå®ƒä»¬å±äºç±»ï¼Œè€Œéå¯¹è±¡å®ä¾‹ï¼‰ï¼› å¾ªç¯å¼•ç”¨ä¼šå¯¼è‡´åºåˆ—åŒ–å¤±è´¥ï¼ˆå¦‚Â CatÂ æœ‰Â OwnerÂ å±æ€§ï¼ŒOwnerÂ åˆæœ‰Â CatÂ å±æ€§ï¼Œäº’ç›¸å¼•ç”¨ï¼‰â†’ éœ€é…ç½®å¿½ç•¥å¾ªç¯å¼•ç”¨ï¼ˆå¦‚ System.Text.Json çš„Â ReferenceHandler = ReferenceHandler.IgnoreCyclesï¼‰ã€‚ 2. ååºåˆ—åŒ–çš„ â€œå¯¹è±¡åˆ›å»ºâ€ è§„åˆ™ å¿…é¡»æœ‰Â æ— å‚æ„é€ å‡½æ•°ï¼ˆå¦åˆ™ååºåˆ—åŒ–åº“æ— æ³•åˆ›å»ºå¯¹è±¡ï¼Œä¼šæŠ›å‡ºÂ InvalidOperationExceptionï¼‰ï¼› è‹¥ç±»æœ‰æœ‰å‚æ„é€ å‡½æ•°ï¼Œéœ€ä¿ç•™æ— å‚æ„é€ ï¼ˆå¯è®¾ä¸ºÂ privateï¼Œä½†éƒ¨åˆ†åº“è¦æ±‚Â publicï¼‰ï¼› å­—æ®µ å±æ€§ååŒ¹é…ï¼šé»˜è®¤å¤§å°å†™æ•æ„Ÿï¼ˆå¦‚ JSON ä¸­ â€œnameâ€ æ— æ³•åŒ¹é…å¯¹è±¡ â€œNameâ€ï¼‰ï¼Œå¯é€šè¿‡é…ç½®å¿½ç•¥å¤§å°å†™ï¼ˆSystem.Text.Json çš„Â IgnoreCase=trueï¼‰ã€‚ 3. ç‰ˆæœ¬å…¼å®¹æ€§ï¼ˆå¯¹è±¡ç±»ä¿®æ”¹åå¦‚ä½•å…¼å®¹æ—§æ•°æ®ï¼‰å®é™…å¼€å‘ä¸­ï¼Œå¯¹è±¡ç±»å¯èƒ½ä¼šä¿®æ”¹ï¼ˆå¦‚æ–°å¢å­—æ®µã€åˆ é™¤å­—æ®µï¼‰ï¼Œéœ€ç¡®ä¿æ–°ç±»èƒ½ååºåˆ—åŒ–æ—§æ•°æ®ï¼š æ–°å¢å­—æ®µï¼šæ—§æ•°æ®ä¸­æ— è¯¥å­—æ®µâ†’ååºåˆ—åŒ–åå­—æ®µä¸ºé»˜è®¤å€¼ï¼ˆå¦‚Â intÂ ä¸º 0ï¼ŒstringÂ ä¸ºÂ nullï¼‰ï¼Œéœ€ç¡®ä¿é»˜è®¤å€¼ä¸å½±å“é€»è¾‘ï¼› åˆ é™¤å­—æ®µï¼šæ—§æ•°æ®ä¸­æœ‰è¯¥å­—æ®µâ†’ååºåˆ—åŒ–æ—¶ä¼šå¿½ç•¥è¯¥å­—æ®µï¼ˆæ— æŠ¥é”™ï¼‰ï¼› å­—æ®µé‡å‘½åï¼šéœ€é€šè¿‡ç‰¹æ€§é…ç½®æ˜ å°„ï¼ˆå¦‚ System.Text.Json çš„Â [JsonPropertyName(oldName)]ã€Protobuf-Net çš„Â [ProtoMember(1, Name = oldName)]ï¼‰ã€‚ 4. å®‰å…¨æ€§é—®é¢˜ é¿å…ååºåˆ—åŒ–Â ä¸å¯ä¿¡æ•°æ®ï¼ˆå¦‚ç½‘ç»œä¸Šçš„æœªçŸ¥ JSON äºŒè¿›åˆ¶ï¼‰â†’ å¯èƒ½å­˜åœ¨æ³¨å…¥æ”»å‡»ï¼ˆå¦‚ BinaryFormatter çš„ååºåˆ—åŒ–æ¼æ´ï¼Œå·²è¢«å¤šä¸ªé»‘å®¢åˆ©ç”¨ï¼‰ï¼› æ¨èç”¨Â System.Text.JsonÂ æˆ–Â Protobuf-Netï¼ˆå®‰å…¨æ€§æ›´é«˜ï¼‰ï¼Œç¦ç”¨ BinaryFormatterï¼ˆ.NET 5+ å·²æ ‡è®°ä¸ºè¿‡æ—¶ï¼‰ã€‚ 5. æ€§èƒ½ä¼˜åŒ–å»ºè®® å°æ•°æ®é‡ éœ€å¯è¯»æ€§ï¼šç”¨ System.Text.Jsonï¼› å¤§æ•°æ®é‡ é«˜æ€§èƒ½ï¼šç”¨ Protobuf-Netï¼› é¿å…é¢‘ç¹åºåˆ—åŒ– ååºåˆ—åŒ–ï¼šå¯ç¼“å­˜åºåˆ—åŒ–ç»“æœï¼ˆå¦‚å°†é…ç½®æ–‡ä»¶ååºåˆ—åŒ–åç¼“å­˜åˆ°å†…å­˜ï¼Œæ— éœ€æ¯æ¬¡è¯»å–éƒ½ååºåˆ—åŒ–ï¼‰ï¼› å…³é—­ä¸å¿…è¦çš„åŠŸèƒ½ï¼šå¦‚ System.Text.Json çš„Â WriteIndented=trueï¼ˆç¾åŒ–æ ¼å¼ï¼‰ä¼šé™ä½æ€§èƒ½ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­ã€‚ ä¸ƒã€ä¸ C++ åºåˆ—åŒ–çš„æ ¸å¿ƒå·®å¼‚æ€»ç»“ ç‰¹æ€§ C# åºåˆ—åŒ– C++ åºåˆ—åŒ– å†…ç½®æ”¯æŒ æœ‰ï¼ˆSystem.Text.Jsonã€XmlSerializerï¼‰ æ— ï¼ˆéœ€ç¬¬ä¸‰æ–¹åº“ï¼šprotobufã€nlohmann::jsonï¼‰ åå°„ä¾èµ– ä¾èµ–åå°„ï¼ˆè‡ªåŠ¨å­—æ®µæ˜ å°„ï¼‰ æ— åå°„ï¼ˆéœ€æ‰‹åŠ¨å®šä¹‰æ˜ å°„ï¼Œå¦‚ .proto æ–‡ä»¶ï¼‰ æŒ‡é’ˆ å¼•ç”¨å¤„ç† è‡ªåŠ¨å¤„ç†å¼•ç”¨ç±»å‹ï¼ˆåºåˆ—åŒ–çŠ¶æ€ï¼Œéå†…å­˜åœ°å€ï¼‰ éœ€æ‰‹åŠ¨å¤„ç†ï¼ˆé¿å…åºåˆ—åŒ–é‡æŒ‡é’ˆã€å¾ªç¯å¼•ç”¨ï¼‰ æ˜“ç”¨æ€§ é«˜ï¼ˆä¸€è¡Œä»£ç å®Œæˆåºåˆ—åŒ– ååºåˆ—åŒ–ï¼‰ ä¸­ï¼ˆéœ€ç¼–å†™æ˜ å°„ä»£ç  é…ç½®æ–‡ä»¶ï¼‰ çµæ´»æ€§ ä¸­ï¼ˆå—åå°„å’Œåº“é™åˆ¶ï¼‰ é«˜ï¼ˆå¯è‡ªå®šä¹‰å†…å­˜å¸ƒå±€ã€åºåˆ—åŒ–é€»è¾‘ï¼‰ æ ¸å¿ƒç±»æ¯”ï¼š C# çš„Â System.Text.JsonÂ â‰ˆ C++ çš„Â nlohmann::jsonï¼ˆJSON åºåˆ—åŒ–ï¼Œæ˜“ç”¨æ€§ä¼˜å…ˆï¼‰ï¼› C# çš„Â Protobuf-NetÂ â‰ˆ C++ çš„Â protobufï¼ˆäºŒè¿›åˆ¶åºåˆ—åŒ–ï¼Œæ€§èƒ½ä¼˜å…ˆï¼‰ï¼› ä¸¤è€…çš„æ ¸å¿ƒç›®æ ‡ä¸€è‡´ï¼šå®ç°å¯¹è±¡çŠ¶æ€çš„æŒä¹…åŒ–å’Œè·¨å¹³å°ä¼ è¾“ï¼Œåªæ˜¯ C# å°è£…æ›´å½»åº•ï¼ŒC++ æ›´çµæ´»ä½†éœ€æ›´å¤šæ‰‹åŠ¨æ“ä½œã€‚ æ€»ç»“åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„æ ¸å¿ƒä»·å€¼æ˜¯Â â€œæ‰“ç ´æ•°æ®çš„â€˜å†…å­˜ä¸´æ—¶æ€§â€™å’Œâ€˜å¹³å°ç›¸å…³æ€§â€™â€ï¼š åºåˆ—åŒ–ï¼šå¯¹è±¡â†’é€šç”¨æ ¼å¼ï¼ˆè§£å†³å­˜å‚¨ ä¼ è¾“é—®é¢˜ï¼‰ï¼› ååºåˆ—åŒ–ï¼šé€šç”¨æ ¼å¼â†’å¯¹è±¡ï¼ˆæ¢å¤ä½¿ç”¨ä»·å€¼ï¼‰ï¼› C# ä¸­æ¨èæ–¹æ¡ˆï¼š å¤§å¤šæ•°åœºæ™¯ï¼šSystem.Text.Jsonï¼ˆJSON æ ¼å¼ï¼Œå†…ç½®ã€æ˜“ç”¨ã€å…¼å®¹ï¼‰ï¼› é«˜æ€§èƒ½åœºæ™¯ï¼šProtobuf-Netï¼ˆäºŒè¿›åˆ¶æ ¼å¼ï¼Œä½“ç§¯å°ã€é€Ÿåº¦å¿«ï¼‰ï¼› å…³é”®é¿å‘ç‚¹ï¼šç¡®ä¿æ— å‚æ„é€ å‡½æ•°ã€å¤„ç†å¾ªç¯å¼•ç”¨ã€å…³æ³¨ç‰ˆæœ¬å…¼å®¹æ€§ã€é¿å…ååºåˆ—åŒ–ä¸å¯ä¿¡æ•°æ®ã€‚ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼Œæ— éœ€çº ç»“åº•å±‚å®ç°ï¼ˆå¦‚å†…å­˜å¸ƒå±€ã€æŒ‡é’ˆï¼‰ï¼Œåªéœ€å…³æ³¨ â€œå“ªäº›æˆå‘˜è¦åºåˆ—åŒ–â€â€œé€‰æ‹©å“ªç§æ ¼å¼â€ï¼ŒC# çš„åºåˆ—åŒ–åº“ä¼šå¸®ä½ æå®šå‰©ä¸‹çš„ä¸€åˆ‡ â€”â€” è¿™ä¹Ÿæ˜¯ C# æ¯” C++ æ›´é«˜æ•ˆçš„åœ°æ–¹ä¹‹ä¸€ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"èµ„æºé‡Šæ”¾","path":"/2025/11/26/2-ç¼–ç¨‹è¯­è¨€-CSharp-èµ„æºé‡Šæ”¾/","content":"C# ä¸­ using è¯­å¥ä¸ IDisposable æ¥å£ï¼šèµ„æºé‡Šæ”¾çš„æ ¸å¿ƒæœºåˆ¶ï¼ˆé¢å‘ C++ ç¨‹åºå‘˜ï¼‰C# ä¸­Â usingÂ è¯­å¥çš„æ ¸å¿ƒä½œç”¨æ˜¯Â è‡ªåŠ¨ç®¡ç†å®ç°äº†Â IDisposableÂ æ¥å£çš„èµ„æºï¼Œç¡®ä¿èµ„æºåœ¨ä½¿ç”¨åè¢«åŠæ—¶ã€å®‰å…¨åœ°é‡Šæ”¾ï¼ˆå³ä½¿å‘ç”Ÿå¼‚å¸¸ï¼‰ã€‚å…¶æœ¬è´¨æ˜¯Â try-finallyÂ ä»£ç å—çš„è¯­æ³•ç³–ï¼Œåº•å±‚ä¾èµ–Â IDisposableÂ æ¥å£çš„Â Dispose()Â æ–¹æ³•å®Œæˆèµ„æºæ¸…ç† â€”â€” è¿™ä¸ C++ çš„Â RAIIï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰Â æ€æƒ³å¼‚æ›²åŒå·¥ï¼Œä½†å®ç°æ–¹å¼ä¸åŒã€‚ ä¸€ã€å…ˆææ‡‚ï¼šä¸ºä»€ä¹ˆéœ€è¦ IDisposableï¼ŸC# çš„åƒåœ¾å›æ”¶ï¼ˆGCï¼‰ä»…è´Ÿè´£å›æ”¶æ‰˜ç®¡èµ„æºï¼ˆå¦‚Â stringã€ListÂ ç­‰ .NET å†…ç½®ç±»å‹ï¼Œå­˜å‚¨åœ¨å †ä¸Šï¼‰ï¼Œä½†æ— æ³•è‡ªåŠ¨é‡Šæ”¾éæ‰˜ç®¡èµ„æºï¼ˆå¦‚æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ã€æ•°æ®åº“è¿æ¥ã€å†…å­˜æŒ‡é’ˆç­‰ï¼Œä¸å— .NET è¿è¡Œæ—¶ç®¡ç†ï¼‰ã€‚ å¦‚æœä¸æ‰‹åŠ¨é‡Šæ”¾éæ‰˜ç®¡èµ„æºï¼Œä¼šå¯¼è‡´èµ„æºæ³„æ¼ï¼ˆå¦‚æ–‡ä»¶è¢«é•¿æœŸå ç”¨ã€ç«¯å£è€—å°½ï¼‰ã€‚å› æ­¤ C# è®¾è®¡äº†Â IDisposableÂ æ¥å£ï¼Œä½œä¸º â€œèµ„æºé‡Šæ”¾â€ çš„æ ‡å‡†å¥‘çº¦ â€”â€” ä»»ä½•éœ€è¦æ‰‹åŠ¨é‡Šæ”¾èµ„æºçš„ç±»å‹ï¼Œéƒ½åº”å®ç°è¯¥æ¥å£ã€‚ 1. IDisposable æ¥å£å®šä¹‰ï¼ˆæç®€ï¼‰csharp è¿è¡Œ public interface IDisposable // å”¯ä¸€æŠ½è±¡æ–¹æ³•ï¼šç”¨äºé‡Šæ”¾èµ„æºï¼ˆæ‰˜ç®¡+éæ‰˜ç®¡ï¼‰ void Dispose(); 2. IDisposable çš„æ ¸å¿ƒèŒè´£ é‡Šæ”¾éæ‰˜ç®¡èµ„æºï¼ˆå¿…é¡»å®ç°ï¼Œè¿™æ˜¯æ¥å£çš„æ ¸å¿ƒç›®çš„ï¼‰ï¼› é‡Šæ”¾æ‰˜ç®¡èµ„æºï¼ˆå¯é€‰ï¼Œå¦‚å…³é—­ä¾èµ–çš„å…¶ä»–Â IDisposableÂ å¯¹è±¡ï¼‰ï¼› æ ‡è®°å¯¹è±¡å·²é‡Šæ”¾ï¼Œé¿å…é‡å¤é‡Šæ”¾æˆ–åç»­æ“ä½œæŠ¥é”™ã€‚ 3. å…¸å‹å®ç°ï¼ˆDispose æ¨¡å¼ï¼‰æ­£ç¡®å®ç°Â IDisposableÂ éœ€éµå¾ª â€œDispose æ¨¡å¼â€ï¼ˆå¤„ç†æ‰˜ç®¡ + éæ‰˜ç®¡èµ„æºï¼Œæ”¯æŒé‡å¤è°ƒç”¨ï¼‰ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼ˆæ¨¡æ‹Ÿæ–‡ä»¶èµ„æºï¼‰ï¼š csharp è¿è¡Œ // å®ç° IDisposable çš„æ–‡ä»¶æ“ä½œç±»public class FileHandler : IDisposable // éæ‰˜ç®¡èµ„æºï¼šæ–‡ä»¶å¥æŸ„ï¼ˆæ¨¡æ‹Ÿï¼‰ private IntPtr _fileHandle; // æ‰˜ç®¡èµ„æºï¼šä¾èµ–çš„å…¶ä»– IDisposable å¯¹è±¡ private StreamReader _reader; // æ ‡è®°æ˜¯å¦å·²é‡Šæ”¾ï¼ˆé¿å…é‡å¤é‡Šæ”¾ï¼‰ private bool _disposed = false; // æ„é€ å‡½æ•°ï¼šè·å–èµ„æºï¼ˆç±»ä¼¼ C++ çš„æ„é€ å‡½æ•°ï¼‰ public FileHandler(string filePath) _fileHandle = OpenFile(filePath); // æ¨¡æ‹Ÿæ‰“å¼€æ–‡ä»¶ï¼Œè·å–å¥æŸ„ _reader = new StreamReader(filePath); // æ‰˜ç®¡èµ„æº // å®ç° IDisposable æ¥å£çš„ Dispose() æ–¹æ³• public void Dispose() // è°ƒç”¨é‡è½½æ–¹æ³•ï¼Œæ ‡è®°â€œå·²æ‰‹åŠ¨é‡Šæ”¾â€ï¼Œæ— éœ€ GC åç»­å¤„ç† Dispose(disposing: true); // å‘Šè¯‰ GCï¼šè¯¥å¯¹è±¡çš„ææ„å‡½æ•°ï¼ˆFinalizerï¼‰æ— éœ€æ‰§è¡Œï¼ˆå·²æ‰‹åŠ¨é‡Šæ”¾èµ„æºï¼‰ GC.SuppressFinalize(this); // æ ¸å¿ƒé‡Šæ”¾é€»è¾‘ï¼ˆprotected è™šæ–¹æ³•ï¼Œæ”¯æŒå­ç±»ç»§æ‰¿ï¼‰ protected virtual void Dispose(bool disposing) if (_disposed) return; // å·²é‡Šæ”¾ï¼Œç›´æ¥è¿”å› // 1. é‡Šæ”¾æ‰˜ç®¡èµ„æºï¼ˆä»…å½“ disposing=true æ—¶ï¼šæ‰‹åŠ¨è°ƒç”¨ Dispose() æˆ– using è§¦å‘ï¼‰ if (disposing) _reader?.Dispose(); // é‡Šæ”¾ StreamReaderï¼ˆæœ¬èº«å®ç° IDisposableï¼‰ // 2. é‡Šæ”¾éæ‰˜ç®¡èµ„æºï¼ˆæ— è®º disposing æ˜¯ true/falseï¼Œå¿…é¡»æ‰§è¡Œï¼‰ CloseFile(_fileHandle); // æ¨¡æ‹Ÿå…³é—­æ–‡ä»¶å¥æŸ„ _fileHandle = IntPtr.Zero; // ç½®ç©ºï¼Œé¿å…é‡æŒ‡é’ˆ _disposed = true; // æ ‡è®°ä¸ºå·²é‡Šæ”¾ // ææ„å‡½æ•°ï¼ˆFinalizerï¼Œå¯é€‰ï¼‰ï¼šé˜²æ­¢ç”¨æˆ·å¿˜è®°è°ƒç”¨ Dispose() æˆ–ä½¿ç”¨ using // ä»…å½“å¯¹è±¡è¢« GC å›æ”¶æ—¶æ‰§è¡Œï¼Œä¸”ä»…é‡Šæ”¾éæ‰˜ç®¡èµ„æºï¼ˆæ‰˜ç®¡èµ„æºå¯èƒ½å·²è¢« GC å›æ”¶ï¼‰ ~FileHandler() Dispose(disposing: false); // æ¨¡æ‹Ÿéæ‰˜ç®¡èµ„æºæ“ä½œï¼ˆè¾…åŠ©æ–¹æ³•ï¼‰ private IntPtr OpenFile(string path) = IntPtr.Zero; private void CloseFile(IntPtr handle) /* é‡Šæ”¾æ–‡ä»¶å¥æŸ„é€»è¾‘ */ å…³é”®è¯´æ˜ï¼ˆå¯¹æ¯” C++ï¼‰ï¼š C++ ç”¨ææ„å‡½æ•°è‡ªåŠ¨é‡Šæ”¾èµ„æºï¼ˆRAIIï¼‰ï¼Œè€Œ C# ææ„å‡½æ•°ï¼ˆFinalizerï¼‰ä»…ä½œä¸º â€œå…œåº•â€ï¼ˆGC è§¦å‘æ—¶æœºä¸ç¡®å®šï¼‰ï¼› C# ç”¨Â IDisposable.Dispose()Â ä½œä¸ºæ˜¾å¼é‡Šæ”¾å…¥å£ï¼ŒusingÂ è¯­å¥åˆ™è‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ï¼ˆç±»ä¼¼ C++ ææ„å‡½æ•°çš„ â€œè‡ªåŠ¨æ‰§è¡Œâ€ æ•ˆæœï¼‰ã€‚ äºŒã€using è¯­å¥ï¼šè‡ªåŠ¨è°ƒç”¨ Dispose () çš„è¯­æ³•ç³–usingÂ è¯­å¥çš„è®¾è®¡ç›®æ ‡æ˜¯ï¼šè®©å¼€å‘è€…æ— éœ€æ‰‹åŠ¨è°ƒç”¨Â Dispose()ï¼Œä¹Ÿæ— éœ€å†™Â try-finallyï¼Œå°±èƒ½ç¡®ä¿èµ„æºé‡Šæ”¾ã€‚ 1. using è¯­å¥çš„ä¸¤ç§å½¢å¼C# æ”¯æŒä¸¤ç§Â usingÂ è¯­æ³•ï¼Œæ ¸å¿ƒé€»è¾‘å®Œå…¨ä¸€è‡´ï¼ˆå‡è°ƒç”¨Â Dispose()ï¼‰ï¼Œä»…ä½œç”¨åŸŸå’Œå†™æ³•ä¸åŒã€‚ ï¼ˆ1ï¼‰using å—ï¼ˆä¼ ç»Ÿå½¢å¼ï¼Œå…¼å®¹æ‰€æœ‰ C# ç‰ˆæœ¬ï¼‰è¯­æ³•ï¼š csharp è¿è¡Œ using (var èµ„æºå¯¹è±¡ = new å®ç°IDisposableçš„ç±»å‹()) // èµ„æºä½¿ç”¨é€»è¾‘// ä»£ç å—ç»“æŸåï¼Œè‡ªåŠ¨è°ƒç”¨ èµ„æºå¯¹è±¡.Dispose() ç¤ºä¾‹ï¼ˆæ–‡ä»¶æ“ä½œï¼‰ï¼š csharp è¿è¡Œ // FileStream å®ç°äº† IDisposableï¼Œç”¨äºæ“ä½œæ–‡ä»¶ï¼ˆéæ‰˜ç®¡èµ„æºï¼šæ–‡ä»¶å¥æŸ„ï¼‰using (var fileStream = new FileStream(test.txt, FileMode.Open))using (var reader = new StreamReader(fileStream)) // æ”¯æŒåµŒå¥— using å— string content = reader.ReadToEnd(); // ä½¿ç”¨èµ„æº Console.WriteLine(content);// ä»£ç å—ç»“æŸåï¼šreader.Dispose() â†’ fileStream.Dispose() è‡ªåŠ¨æ‰§è¡Œï¼Œæ–‡ä»¶å¥æŸ„é‡Šæ”¾ ï¼ˆ2ï¼‰using å£°æ˜ï¼ˆC# 8.0+ æ–°å¢ï¼Œæ›´ç®€æ´ï¼‰è¯­æ³•ï¼š csharp è¿è¡Œ // å£°æ˜æ—¶åŠ  usingï¼Œèµ„æºä½œç”¨åŸŸä¸ºå½“å‰ä»£ç å—ï¼ˆå¦‚æ–¹æ³•ã€if å—ï¼‰using var èµ„æºå¯¹è±¡ = new å®ç°IDisposableçš„ç±»å‹();// èµ„æºä½¿ç”¨é€»è¾‘// ä»£ç å—ç»“æŸæ—¶ï¼ˆå¦‚æ–¹æ³•è¿”å›ã€å¼‚å¸¸é€€å‡ºï¼‰ï¼Œè‡ªåŠ¨è°ƒç”¨ Dispose() ç¤ºä¾‹ï¼ˆæ•°æ®åº“è¿æ¥ï¼‰ï¼š csharp è¿è¡Œ async Task QueryDataAsync() // SqlConnection å®ç° IDisposableï¼Œéæ‰˜ç®¡èµ„æºï¼šæ•°æ®åº“è¿æ¥ using var conn = new SqlConnection(Server=.;Database=Test;Trusted_Connection=True); await conn.OpenAsync(); // æ‰“å¼€è¿æ¥ï¼ˆè·å–èµ„æºï¼‰ using var cmd = new SqlCommand(SELECT * FROM Cats, conn); using var reader = await cmd.ExecuteReaderAsync(); while (await reader.ReadAsync()) Console.WriteLine($Cat: reader[Name]); // æ–¹æ³•ç»“æŸæ—¶ï¼šreader.Dispose() â†’ cmd.Dispose() â†’ conn.Dispose() è‡ªåŠ¨æ‰§è¡Œï¼Œè¿æ¥é‡Šæ”¾ 2. using è¯­å¥çš„æ ¸å¿ƒæ‰§è¡Œæµç¨‹usingÂ è¯­å¥åœ¨ç¼–è¯‘æ—¶ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºÂ try-finallyÂ ä»£ç å—ï¼Œç¡®ä¿Â æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼ŒDispose()Â éƒ½ä¼šè¢«è°ƒç”¨ã€‚ ä»¥ä¼ ç»ŸÂ usingÂ å—ä¸ºä¾‹ï¼š csharp è¿è¡Œ // åŸå§‹ä»£ç using (var resource = new FileHandler(test.txt)) resource.DoSomething(); ç¼–è¯‘åç­‰ä»·ä»£ç ï¼š csharp è¿è¡Œ FileHandler resource = new FileHandler(test.txt);try resource.DoSomething();finally // å…³é”®ï¼šfinally ä¸­ç¡®ä¿ Dispose() å¿…æ‰§è¡Œ if (resource != null) ((IDisposable)resource).Dispose(); // å¼ºåˆ¶è½¬æ¢ä¸º IDisposable è°ƒç”¨æ–¹æ³• å¼‚å¸¸å®‰å…¨éªŒè¯ï¼šå³ä½¿ä½¿ç”¨èµ„æºæ—¶æŠ›å‡ºå¼‚å¸¸ï¼ŒfinallyÂ å—ä»ä¼šæ‰§è¡Œï¼ŒDispose()Â ä¼šè¢«è°ƒç”¨ â€”â€” è¿™æ˜¯Â usingÂ æœ€æ ¸å¿ƒçš„ä»·å€¼ï¼Œé¿å…å¼‚å¸¸å¯¼è‡´èµ„æºæ³„æ¼ã€‚ ä¸‰ã€ä¸ C++ RAII çš„å¯¹æ¯”ï¼ˆå…³é”®å·®å¼‚ï¼‰C++ ç¨‹åºå‘˜ä¹ æƒ¯ç”¨Â RAIIï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰Â ç®¡ç†èµ„æºï¼ˆæ„é€ å‡½æ•°è·å–èµ„æºï¼Œææ„å‡½æ•°é‡Šæ”¾èµ„æºï¼‰ï¼Œè€Œ C# çš„Â using + IDisposableÂ æ˜¯ç±»ä¼¼çš„ â€œèµ„æºè‡ªåŠ¨ç®¡ç†â€ æ–¹æ¡ˆï¼Œä½†è®¾è®¡æ€è·¯æœ‰æœ¬è´¨åŒºåˆ«ï¼š ç‰¹æ€§ C#ï¼ˆusing + IDisposableï¼‰ C++ï¼ˆRAIIï¼‰ æ ¸å¿ƒä¾èµ– IDisposable.Dispose()Â æ–¹æ³• +Â usingÂ è¯­æ³•ç³– ç±»çš„æ„é€ å‡½æ•°ï¼ˆè·å–èµ„æºï¼‰+ ææ„å‡½æ•°ï¼ˆé‡Šæ”¾èµ„æºï¼‰ é‡Šæ”¾æ—¶æœº usingÂ å— å£°æ˜ä½œç”¨åŸŸç»“æŸæ—¶ï¼ˆç«‹å³é‡Šæ”¾ï¼‰ å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶ï¼ˆæ ˆå¯¹è±¡ï¼šä½œç”¨åŸŸç»“æŸï¼›å †å¯¹è±¡ï¼šdeleteÂ æ—¶ï¼‰ å¼‚å¸¸å®‰å…¨æ€§ ä¾èµ–Â finallyÂ å—ï¼Œå¼‚å¸¸æ—¶ä»é‡Šæ”¾ ä¾èµ–ææ„å‡½æ•°ï¼Œå¼‚å¸¸æ—¶ä»ä¼šè°ƒç”¨ï¼ˆæ ˆå¯¹è±¡ï¼‰ é€‚ç”¨èµ„æºç±»å‹ éæ‰˜ç®¡èµ„æºï¼ˆå¿…é¡»ï¼‰ã€æ‰˜ç®¡èµ„æºï¼ˆå¯é€‰ï¼‰ æ‰€æœ‰èµ„æºï¼ˆæ ˆ å †ã€æ‰˜ç®¡ éæ‰˜ç®¡ï¼‰ æ‰‹åŠ¨æ§åˆ¶é‡Šæ”¾ å¯ç›´æ¥è°ƒç”¨Â Dispose()ï¼ˆä¸æ¨èï¼Œæ˜“é—æ¼ï¼‰ æ ˆå¯¹è±¡ä¸å¯æ‰‹åŠ¨é‡Šæ”¾ï¼ˆä½œç”¨åŸŸæ§åˆ¶ï¼‰ï¼Œå †å¯¹è±¡ç”¨Â delete è¯­æ³•ç®€æ´åº¦ éœ€æ˜¾å¼å†™Â usingï¼ˆC# 8.0+ å£°æ˜å¼å·²ç®€åŒ–ï¼‰ éšå¼é‡Šæ”¾ï¼ˆæ— éœ€é¢å¤–ä»£ç ï¼‰ æ ¸å¿ƒç±»æ¯”ï¼š C++ çš„ â€œææ„å‡½æ•°â€ â‰ˆ C# çš„Â Dispose()Â æ–¹æ³•ï¼ˆè´Ÿè´£é‡Šæ”¾èµ„æºï¼‰ï¼› C++ çš„ â€œæ ˆå¯¹è±¡ä½œç”¨åŸŸâ€ â‰ˆ C# çš„Â usingÂ å— å£°æ˜ä½œç”¨åŸŸï¼ˆæ§åˆ¶èµ„æºé‡Šæ”¾æ—¶æœºï¼‰ï¼› ä¸¤è€…çš„æœ€ç»ˆç›®æ ‡ä¸€è‡´ï¼šç¡®ä¿èµ„æºåœ¨ä½¿ç”¨åè¢«åŠæ—¶ã€å®‰å…¨åœ°é‡Šæ”¾ï¼Œé¿å…æ³„æ¼ã€‚ å››ã€å¸¸è§è¯¯åŒºä¸æœ€ä½³å®è·µ1. è¯¯åŒºæ¾„æ¸… âŒ è¯¯åŒº 1ï¼šusingÂ åªèƒ½ç”¨äºæ–‡ä»¶ æ•°æ®åº“ç­‰ â€œå¤§èµ„æºâ€ â†’ æ­£ç¡®ï¼šä»»ä½•å®ç°Â IDisposableÂ çš„ç±»å‹éƒ½å¯ä½¿ç”¨ï¼ˆå¦‚Â Streamã€SqlCommandã€HttpClientã€è‡ªå®šä¹‰çš„Â FileHandlerÂ ç­‰ï¼‰ï¼› âŒ è¯¯åŒº 2ï¼šusingÂ ä¼šè®©å¯¹è±¡è¢« GC å›æ”¶ â†’ æ­£ç¡®ï¼šusingÂ ä»…è°ƒç”¨Â Dispose()Â é‡Šæ”¾èµ„æºï¼Œå¯¹è±¡æœ¬èº«ä»éœ€ç­‰å¾… GC å›æ”¶ï¼ˆä½†èµ„æºå·²é‡Šæ”¾ï¼Œæ— æ³„æ¼é£é™©ï¼‰ï¼› âŒ è¯¯åŒº 3ï¼šå®ç°Â IDisposableÂ å°±å¿…é¡»ç”¨Â usingÂ â†’ æ­£ç¡®ï¼šusingÂ æ˜¯æ¨èæ–¹å¼ï¼Œä¹Ÿå¯æ‰‹åŠ¨è°ƒç”¨Â Dispose()ï¼Œä½†éœ€è‡ªå·±å†™Â try-finallyÂ ç¡®ä¿å¼‚å¸¸å®‰å…¨ï¼› âŒ è¯¯åŒº 4ï¼šusingÂ å¯ç”¨äºéÂ IDisposableÂ å¯¹è±¡ â†’ æ­£ç¡®ï¼šç¼–è¯‘æŠ¥é”™ï¼usingÂ çš„å¯¹è±¡å¿…é¡»å®ç°Â IDisposableï¼ˆæˆ–éšå¼è½¬æ¢ä¸ºÂ IDisposableï¼‰ã€‚ 2. æœ€ä½³å®è·µ ä¼˜å…ˆä½¿ç”¨Â usingÂ å£°æ˜ï¼ˆC# 8.0+ï¼‰ï¼šè¯­æ³•æ›´ç®€æ´ï¼Œä½œç”¨åŸŸæ›´æ¸…æ™°ï¼ˆæ— éœ€åµŒå¥—å¤§æ‹¬å·ï¼‰ï¼› åµŒå¥—Â IDisposableÂ å¯¹è±¡ï¼šå¦‚Â StreamReaderÂ ä¾èµ–Â FileStreamï¼Œå¯åµŒå¥—Â usingï¼ˆæˆ–ç”¨Â usingÂ å£°æ˜è‡ªåŠ¨æŒ‰é¡ºåºé‡Šæ”¾ï¼‰ï¼› è‡ªå®šä¹‰ç±»å‹å®ç°Â IDisposableÂ æ—¶ï¼šä¸¥æ ¼éµå¾ª â€œDispose æ¨¡å¼â€ï¼ˆå¤„ç†æ‰˜ç®¡ + éæ‰˜ç®¡èµ„æºï¼Œæ ‡è®°å·²é‡Šæ”¾ï¼Œæ”¯æŒå­ç±»ç»§æ‰¿ï¼‰ï¼› é¿å…Â usingÂ åŒ…è£¹é•¿æœŸå­˜æ´»çš„èµ„æºï¼šusingÂ ä½œç”¨åŸŸç»“æŸå³é‡Šæ”¾ï¼Œè‹¥èµ„æºéœ€é•¿æœŸä½¿ç”¨ï¼ˆå¦‚å…¨å±€æ•°æ®åº“è¿æ¥ï¼‰ï¼Œä¸åº”æ”¾åœ¨Â usingÂ ä¸­ï¼› æ³¨æ„Â nullÂ å®‰å…¨ï¼šusingÂ å¯å¤„ç†Â nullÂ å¯¹è±¡ï¼ˆç¼–è¯‘åä¼šåˆ¤æ–­Â resource != nullï¼Œä¸ä¼šæŠ¥é”™ï¼‰ã€‚ äº”ã€å…¸å‹åœºæ™¯ç¤ºä¾‹ï¼ˆè¦†ç›–å¸¸è§èµ„æºï¼‰1. æ–‡ä»¶æ“ä½œï¼ˆFileStream + StreamReaderï¼‰csharp è¿è¡Œ // è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè‡ªåŠ¨å…³é—­æ–‡ä»¶å¥æŸ„using var file = new FileStream(data.txt, FileMode.Open, FileAccess.Read);using var reader = new StreamReader(file);string content = reader.ReadToEnd();Console.WriteLine(content);// ä½œç”¨åŸŸç»“æŸï¼šreader.Dispose() â†’ file.Dispose() è‡ªåŠ¨æ‰§è¡Œ 2. æ•°æ®åº“æ“ä½œï¼ˆSqlConnection + SqlCommandï¼‰csharp è¿è¡Œ async Task GetCatsAsync() using var conn = new SqlConnection(Server=localhost;Database=CatDb;Trusted_Connection=True); await conn.OpenAsync(); using var cmd = new SqlCommand(SELECT Name, Age FROM Cats, conn); using var reader = await cmd.ExecuteReaderAsync(); while (await reader.ReadAsync()) Console.WriteLine($Name: reader[Name], Age: reader[Age]); // æ–¹æ³•ç»“æŸï¼šreader â†’ cmd â†’ conn ä¾æ¬¡ Disposeï¼Œè¿æ¥é‡Šæ”¾ 3. ç½‘ç»œè¯·æ±‚ï¼ˆHttpClient æ³¨æ„äº‹é¡¹ï¼‰HttpClientÂ å®ç°äº†Â IDisposableï¼Œä½†ä¸æ¨èæ¯æ¬¡ä½¿ç”¨éƒ½ç”¨Â usingï¼ˆä¼šé¢‘ç¹åˆ›å»º å…³é—­ TCP è¿æ¥ï¼Œå¯¼è‡´ç«¯å£è€—å°½ï¼‰ã€‚æ­£ç¡®ç”¨æ³•æ˜¯ï¼šå•ä¾‹å¤ç”¨Â HttpClientï¼Œæˆ–ä½¿ç”¨Â IHttpClientFactoryï¼ˆ.NET Core 3.1+ï¼‰ï¼š csharp è¿è¡Œ // ä¸æ¨èï¼šé¢‘ç¹ using ä¼šå¯¼è‡´ç«¯å£æ³„æ¼// using var client = new HttpClient(); // var response = await client.GetAsync(https://api/cats);// æ¨èï¼šå•ä¾‹å¤ç”¨public static class HttpClientSingleton public static readonly HttpClient Instance = new HttpClient();// ä½¿ç”¨æ—¶æ— éœ€ usingvar response = await HttpClientSingleton.Instance.GetAsync(https://api/cats); æ€»ç»“C# ä¸­Â usingÂ è¯­å¥ä¸Â IDisposableÂ æ¥å£çš„æ ¸å¿ƒå…³ç³»çš„æ˜¯ï¼š IDisposableÂ æ˜¯ â€œèµ„æºé‡Šæ”¾â€ çš„æ ‡å‡†å¥‘çº¦ï¼Œæä¾›Â Dispose()Â æ–¹æ³•ç”¨äºæ¸…ç†éæ‰˜ç®¡èµ„æºï¼› usingÂ æ˜¯è¯­æ³•ç³–ï¼Œç¼–è¯‘åè½¬ä¸ºÂ try-finallyï¼Œç¡®ä¿Â Dispose()Â å¿…æ‰§è¡Œï¼ˆå³ä½¿å¼‚å¸¸ï¼‰ï¼› æœ¬è´¨æ˜¯ C# ç‰ˆçš„ â€œèµ„æºè‡ªåŠ¨ç®¡ç†æ–¹æ¡ˆâ€ï¼Œç±»ä¼¼ C++ çš„ RAIIï¼Œä½†éœ€æ˜¾å¼ç”¨Â usingÂ æ ‡è®°èµ„æºä½œç”¨åŸŸã€‚ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼Œè®°ä½ä¸€å¥è¯å³å¯ï¼šC# ä¸­ â€œå®ç° IDisposable çš„ç±»å‹â€+â€œusing è¯­å¥â€ â‰ˆ C++ ä¸­ â€œRAII ç±»çš„æ ˆå¯¹è±¡â€ï¼Œéƒ½æ˜¯ä¸ºäº†ç¡®ä¿èµ„æº â€œè‡ªåŠ¨è·å–ã€è‡ªåŠ¨é‡Šæ”¾â€ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"å¼‚æ­¥å‡½æ•°","path":"/2025/11/26/2-ç¼–ç¨‹è¯­è¨€-CSharp-å¼‚æ­¥å‡½æ•°/","content":"C# æ ¸å¿ƒæ¦‚å¿µè¯¦è§£ï¼šasyncawaitTaskyieldï¼ˆé¢å‘ C++ ç¨‹åºå‘˜ï¼‰è¿™å››ä¸ªæ¦‚å¿µæ˜¯ C# ä¸­å¤„ç†å¼‚æ­¥ç¼–ç¨‹å’Œè¿­ä»£ç”Ÿæˆçš„æ ¸å¿ƒï¼Œå…¶ä¸­Â async/await/TaskÂ ä¸‰ä½ä¸€ä½“è§£å†³å¼‚æ­¥é—®é¢˜ï¼ˆç±»æ¯” C++20 åç¨‹ï¼‰ï¼ŒyieldÂ ä¸“æ³¨äºè¿­ä»£å™¨ç”Ÿæˆï¼ˆç±»æ¯” C++20Â std::generatorï¼‰ï¼Œéƒ¨åˆ†åœºæ™¯å¯ç»“åˆä½¿ç”¨ã€‚ä»¥ä¸‹ä»ã€Œå®šä¹‰â†’è¯­æ³•â†’ä½œç”¨â†’C++ ç±»æ¯”â†’å®æˆ˜ç¤ºä¾‹ã€é€ä¸€æ‹†è§£ï¼Œå…¼é¡¾ä¸“ä¸šæ€§å’Œæ˜“ç†è§£æ€§ã€‚ ä¸€ã€asyncï¼šå¼‚æ­¥å‡½æ•°çš„ â€œæ ‡è®°å™¨â€1. æ ¸å¿ƒå®šä¹‰asyncÂ æ˜¯å‡½æ•°ä¿®é¥°ç¬¦ï¼Œç”¨äºæ ‡è®°ä¸€ä¸ªå‡½æ•°ä¸ºã€Œå¼‚æ­¥å‡½æ•°ã€ã€‚å…¶æ ¸å¿ƒä½œç”¨æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼šè¯¥å‡½æ•°å†…éƒ¨å¯èƒ½åŒ…å«Â awaitï¼Œéœ€è¦ç”Ÿæˆ â€œçŠ¶æ€æœºâ€ æ¥ç®¡ç†å‡½æ•°çš„æš‚åœ æ¢å¤ï¼ˆç±»ä¼¼ C++20 åç¨‹çš„çŠ¶æ€æœºè‡ªåŠ¨ç”Ÿæˆï¼‰ã€‚ 2. å…³é”®è§„åˆ™ åªèƒ½ä¿®é¥°å‡½æ•°ï¼ˆåŒ…æ‹¬æ–¹æ³•ã€lambda è¡¨è¾¾å¼ï¼‰ï¼Œä¸èƒ½ä¿®é¥°å˜é‡ ç±»ï¼› å‡½æ•°è¿”å›å€¼åªèƒ½æ˜¯ 3 ç§ç±»å‹ï¼ˆä¸å¯ä¸ºæ™®é€šå€¼ç±»å‹å¦‚Â intCatï¼‰ï¼š Taskï¼šæ— è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ï¼ˆç±»æ¯” C++Â std::futurevoidï¼‰ï¼› TaskTResultï¼šæœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ï¼ˆç±»æ¯” C++Â std::futureTResultï¼‰ï¼› voidï¼šä»…ç”¨äºäº‹ä»¶å¤„ç†ï¼ˆä¸æ¨èï¼Œæ— æ³•ç­‰å¾…ã€æ— æ³•æ•è·å¼‚å¸¸ï¼Œç±»ä¼¼ â€œç«å¹¶å¿˜è®°â€ï¼‰ï¼› å‡½æ•°å†…éƒ¨**å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªÂ await**ï¼ˆå¦åˆ™ç¼–è¯‘å™¨è­¦å‘Šï¼Œå‡½æ•°ä¼šåŒæ­¥æ‰§è¡Œï¼Œå¤±å»å¼‚æ­¥æ„ä¹‰ï¼‰ï¼› å‘½åè§„èŒƒï¼šå¼‚æ­¥å‡½æ•°åå»ºè®®ä»¥Â AsyncÂ ç»“å°¾ï¼ˆå¦‚Â FetchCatAsyncï¼‰ï¼Œä¾¿äºè¯†åˆ«ã€‚ 3. è¯­æ³•ç¤ºä¾‹csharp è¿è¡Œ // æœ‰è¿”å›å€¼çš„å¼‚æ­¥å‡½æ•°async TaskCat FetchCatAsync(string name) ... // æ— è¿”å›å€¼çš„å¼‚æ­¥å‡½æ•°async Task DownloadFileAsync(string url) ... // äº‹ä»¶å¤„ç†ï¼ˆä»…æ­¤å¤„å¯ç”¨ async voidï¼‰async void Button_Click(object sender, EventArgs e) ... 4. C++ ç±»æ¯”asyncÂ ç±»ä¼¼ C++20 åç¨‹çš„ã€Œcoroutine_traitsÂ æ ‡è®°ã€â€”â€” å‘Šè¯‰ç¼–è¯‘å™¨è¯¥å‡½æ•°æ˜¯åç¨‹ï¼Œéœ€è¦ç”ŸæˆçŠ¶æ€æœºæ¥ç®¡ç†æš‚åœ æ¢å¤ï¼Œè€Œéæ™®é€šå‡½æ•°çš„çº¿æ€§æ‰§è¡Œã€‚ 5. æ ¸å¿ƒè¯¯åŒº âŒ è¯¯åŒºï¼šasyncÂ ä¼šè‡ªåŠ¨å¼€å¯æ–°çº¿ç¨‹ â†’ æ­£ç¡®ï¼šasyncÂ ä»…æ ‡è®°å‡½æ•°ä¸ºå¼‚æ­¥ï¼Œæ˜¯å¦å¼€çº¿ç¨‹ç”±å†…éƒ¨ä»»åŠ¡å†³å®šï¼ˆå¦‚Â Task.RunÂ ä¼šå¼€çº¿ç¨‹ï¼ŒIO å¯†é›†å‹ä»»åŠ¡å¦‚ç½‘ç»œè¯·æ±‚ä¸ä¼šï¼‰ï¼› âŒ è¯¯åŒºï¼šæ— Â awaitÂ çš„Â asyncÂ å‡½æ•°æ˜¯å¼‚æ­¥çš„ â†’ æ­£ç¡®ï¼šæ— Â awaitÂ æ—¶ï¼Œå‡½æ•°ä¼šåŒæ­¥æ‰§è¡Œï¼ŒasyncÂ ä»…å¤šä½™ï¼Œè¿˜ä¼šå¢åŠ çŠ¶æ€æœºçš„å¾®å°å¼€é”€ã€‚ äºŒã€awaitï¼šå¼‚æ­¥ä»»åŠ¡çš„ â€œæš‚åœ æ¢å¤å¼€å…³â€1. æ ¸å¿ƒå®šä¹‰awaitÂ æ˜¯è¿ç®—ç¬¦ï¼Œç”¨äºã€Œç­‰å¾…ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼ˆawaitableÂ å¯¹è±¡ï¼Œæ ¸å¿ƒæ˜¯Â Taskï¼‰å®Œæˆã€ã€‚å…¶æ ¸å¿ƒä½œç”¨æ˜¯ï¼š æš‚åœå½“å‰Â asyncÂ å‡½æ•°çš„æ‰§è¡Œï¼Œé‡Šæ”¾å½“å‰çº¿ç¨‹ï¼ˆéé˜»å¡ï¼Œçº¿ç¨‹å¯å¤„ç†å…¶ä»–ä»»åŠ¡ï¼‰ï¼› å½“å¼‚æ­¥ä»»åŠ¡å®Œæˆåï¼Œè‡ªåŠ¨å°†çº¿ç¨‹åˆ‡å›åŸå‡½æ•°ï¼Œæ¢å¤åç»­ä»£ç æ‰§è¡Œï¼› è‡ªåŠ¨æ•è·ä»»åŠ¡ä¸­çš„å¼‚å¸¸ï¼Œåœ¨æ¢å¤æ‰§è¡Œæ—¶æŠ›å‡ºï¼ˆä¾¿äºÂ try/catchÂ å¤„ç†ï¼‰ã€‚ 2. å…³é”®è§„åˆ™ åªèƒ½åœ¨Â asyncÂ å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼ˆåŒ…æ‹¬Â asyncÂ lambdaï¼‰ï¼› æ“ä½œå¯¹è±¡å¿…é¡»æ˜¯ã€ŒawaitableÂ ç±»å‹ã€ï¼ˆæ»¡è¶³ï¼šæœ‰Â GetAwaiter()Â æ–¹æ³•ï¼Œè¿”å›çš„Â AwaiterÂ æœ‰Â IsCompletedÂ å±æ€§å’ŒÂ OnCompletedÂ æ–¹æ³•ï¼‰ï¼ŒC# ä¸­æœ€å¸¸ç”¨çš„æ˜¯Â TaskTaskTResultï¼› awaitÂ ä¼š â€œè§£åŒ…â€Â TaskTResultÂ çš„ç»“æœï¼ˆç›´æ¥å¾—åˆ°Â TResultï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨Â ResultÂ å±æ€§ã€‚ 3. è¯­æ³•ç¤ºä¾‹ï¼ˆç»“åˆå¼‚å¸¸å¤„ç†ï¼‰csharp è¿è¡Œ async Task ProcessCatAsync() try // ç­‰å¾… FetchCatAsync å®Œæˆï¼Œç›´æ¥å¾—åˆ° Cat ç»“æœï¼ˆè§£åŒ… TaskCatï¼‰ Cat cat = await FetchCatAsync(Fritz); Console.WriteLine($è·å–åˆ° Catï¼šcat.Name); catch (HttpRequestException ex) // æ•è·å¼‚æ­¥ä»»åŠ¡ä¸­çš„å¼‚å¸¸ï¼ˆæ— éœ€æ‰‹åŠ¨æ£€æŸ¥ Task.Exceptionï¼‰ Console.WriteLine($å¼‚æ­¥è¯·æ±‚å¤±è´¥ï¼šex.Message); 4. C++ ç±»æ¯”awaitÂ å®Œå…¨ç­‰ä»·äº C++20 åç¨‹çš„Â co_awaitÂ è¿ç®—ç¬¦ â€”â€” æš‚åœåç¨‹ï¼Œç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆåæ¢å¤ï¼Œä¸”åŒæ ·æ”¯æŒéé˜»å¡ã€‚åŒºåˆ«åœ¨äºï¼š C# çš„Â awaitÂ ä»…æ”¯æŒÂ TaskÂ ç­‰å°‘æ•°Â awaitableÂ ç±»å‹ï¼Œå°è£…æ›´å½»åº•ï¼› C++ çš„Â co_awaitÂ å¯è‡ªå®šä¹‰Â awaitableÂ ç±»å‹ï¼Œçµæ´»æ€§æ›´é«˜ï¼Œä½†éœ€æ‰‹åŠ¨å®ç°ã€‚ 5. æ ¸å¿ƒåŒºåˆ«ï¼šawait vs é˜»å¡ç­‰å¾…ï¼ˆTask.Wait ()Resultï¼‰ æ–¹å¼ ç‰¹æ€§ é€‚ç”¨åœºæ™¯ await Task éé˜»å¡ï¼Œé‡Šæ”¾çº¿ç¨‹ å¼‚æ­¥æµç¨‹ï¼ˆæ¨èï¼‰ Task.Wait() é˜»å¡å½“å‰çº¿ç¨‹ åŒæ­¥ä»£ç ä¸­å¼ºåˆ¶ç­‰å¾… Task.Result é˜»å¡å½“å‰çº¿ç¨‹ï¼ŒæŠ›å‡ºå¼‚å¸¸ åŒæ­¥ä»£ç ä¸­è·å–ç»“æœ ç¤ºä¾‹å¯¹æ¯”ï¼š csharp è¿è¡Œ // é”™è¯¯ï¼šåŒæ­¥å‡½æ•°ä¸­ç”¨ awaitï¼ˆç¼–è¯‘æŠ¥é”™ï¼‰void SyncFunction() // await FetchCatAsync(Fritz); // æŠ¥é”™ï¼šä¸èƒ½åœ¨é async å‡½æ•°ä¸­ç”¨ await TaskCat task = FetchCatAsync(Fritz); task.Wait(); // é˜»å¡çº¿ç¨‹ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆ Cat cat = task.Result; // é˜»å¡çº¿ç¨‹ï¼Œè·å–ç»“æœï¼ˆå¼‚å¸¸ç›´æ¥æŠ›å‡ºï¼‰ ä¸‰ã€Taskï¼šå¼‚æ­¥ä»»åŠ¡çš„ â€œè½½ä½“â€1. æ ¸å¿ƒå®šä¹‰TaskÂ æ˜¯ C# å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼ˆTAPï¼‰çš„æ ¸å¿ƒç±»å‹ï¼Œä»£è¡¨ä¸€ä¸ªã€Œæ­£åœ¨æ‰§è¡Œæˆ–å¾…æ‰§è¡Œçš„å¼‚æ­¥ä»»åŠ¡ã€ã€‚å¯ç†è§£ä¸ºï¼š ä»»åŠ¡çš„ â€œçŠ¶æ€å®¹å™¨â€ï¼šåŒ…å«ä»»åŠ¡çŠ¶æ€ï¼ˆæœªå®Œæˆ å·²å®Œæˆ å·²å–æ¶ˆ å¤±è´¥ï¼‰ï¼› ç»“æœçš„ â€œå­˜å‚¨å®¹å™¨â€ï¼šTaskTResultÂ å­˜å‚¨ä»»åŠ¡å®Œæˆåçš„è¿”å›å€¼ï¼› å¼‚å¸¸çš„ â€œæ•è·å®¹å™¨â€ï¼šä»»åŠ¡æ‰§è¡Œä¸­çš„å¼‚å¸¸ä¼šè¢«æ•è·ï¼Œç­‰å¾…Â awaitÂ æˆ–Â ResultÂ æ—¶æŠ›å‡ºã€‚ 2. æ ¸å¿ƒåˆ†ç±» ç±»å‹ ç”¨é€” C++ ç±»æ¯” Task æ— è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ std::futurevoid TaskTResult æœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ std::futureTResult ValueTask è½»é‡çº§æ— è¿”å›å€¼ä»»åŠ¡ std::coroutine_handle ValueTaskT è½»é‡çº§æœ‰è¿”å›å€¼ä»»åŠ¡ è‡ªå®šä¹‰è½»é‡åç¨‹ç»“æœ æ³¨ï¼šValueTaskÂ æ˜¯ .NET Core 2.1+ æ–°å¢ï¼Œç”¨äºä¼˜åŒ– â€œä»»åŠ¡å¤§æ¦‚ç‡å¿«é€Ÿå®Œæˆâ€ çš„åœºæ™¯ï¼ˆå¦‚ç¼“å­˜æŸ¥è¯¢ï¼‰ï¼Œé¿å…Â TaskÂ çš„å †åˆ†é…å¼€é”€ï¼Œä½¿ç”¨æ–¹å¼ä¸Â TaskÂ ä¸€è‡´ã€‚ 3. æ ¸å¿ƒç”¨æ³•ï¼ˆ1ï¼‰åˆ›å»º Task æ–¹å¼ 1ï¼šé€šè¿‡Â asyncÂ å‡½æ•°è¿”å›ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼š csharp è¿è¡Œ TaskCat catTask = FetchCatAsync(Fritz); // async å‡½æ•°ç›´æ¥è¿”å› Task æ–¹å¼ 2ï¼šé€šè¿‡Â Task.RunÂ åŒ…è£…åŒæ­¥ä»£ç ï¼ˆCPU å¯†é›†å‹ä»»åŠ¡ï¼‰ï¼š csharp è¿è¡Œ // æŠŠåŒæ­¥è®¡ç®—æŠ›åˆ°çº¿ç¨‹æ± æ‰§è¡Œï¼Œè¿”å› TaskintTaskint calcTask = Task.Run(() = HeavyCalculation(10, 20)); æ–¹å¼ 3ï¼šæ‰‹åŠ¨åˆ›å»ºï¼ˆä¸æ¨èï¼Œéœ€æ‰‹åŠ¨æ§åˆ¶å®Œæˆï¼‰ï¼š csharp è¿è¡Œ TaskCompletionSourceCat tcs = new TaskCompletionSourceCat();tcs.SetResult(new Cat(Fritz, 3)); // æ‰‹åŠ¨æ ‡è®°ä»»åŠ¡å®Œæˆï¼Œè®¾ç½®ç»“æœTaskCat catTask = tcs.Task; ï¼ˆ2ï¼‰ç­‰å¾… Task å®Œæˆ å•ä¸ªä»»åŠ¡ï¼šç”¨Â awaitï¼ˆéé˜»å¡ï¼‰æˆ–Â Wait()ï¼ˆé˜»å¡ï¼‰ï¼› å¤šä¸ªä»»åŠ¡ï¼šç”¨Â Task.WhenAllï¼ˆç­‰å¾…æ‰€æœ‰å®Œæˆï¼‰æˆ–Â Task.WhenAnyï¼ˆç­‰å¾…ä»»æ„ä¸€ä¸ªå®Œæˆï¼‰ï¼š csharp è¿è¡Œ // å¹¶è¡Œæ‰§è¡Œ3ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œæ€»è€—æ—¶â‰ˆæœ€é•¿ä»»åŠ¡æ—¶é—´ï¼ˆéå åŠ ï¼‰TaskCat task1 = FetchCatAsync(Fritz);TaskCat task2 = FetchCatAsync(Boots);TaskCat task3 = FetchCatAsync(Milo);// ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œè¿”å›ç»“æœæ•°ç»„ï¼ˆéé˜»å¡ï¼‰Cat[] cats = await Task.WhenAll(task1, task2, task3);// ç­‰å¾…ä»»æ„ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼Œè¿”å›å…ˆå®Œæˆçš„ä»»åŠ¡ï¼ˆéé˜»å¡ï¼‰TaskCat completedTask = await Task.WhenAny(task1, task2, task3);Cat firstCat = await completedTask; ï¼ˆ3ï¼‰è·å–ä»»åŠ¡ç»“æœ await TaskTï¼šéé˜»å¡ï¼Œç›´æ¥è§£åŒ…ç»“æœï¼ˆæ¨èï¼‰ï¼› TaskT.Resultï¼šé˜»å¡ï¼Œç›´æ¥è·å–ç»“æœï¼ˆå¼‚å¸¸æŠ›å‡ºï¼‰ï¼› TaskT.GetAwaiter().GetResult()ï¼šé˜»å¡ï¼Œæ€§èƒ½ç•¥ä¼˜ï¼ˆå¼‚å¸¸æŠ›å‡ºï¼Œæ—  AggregateException åŒ…è£…ï¼‰ã€‚ 4. ä¸çº¿ç¨‹çš„å…³ç³»ï¼ˆå…³é”®æ¾„æ¸…ï¼‰ âŒ è¯¯åŒºï¼šTask çº¿ç¨‹ â†’ æ­£ç¡®ï¼šTaskÂ æ˜¯ â€œä»»åŠ¡â€ï¼Œçº¿ç¨‹æ˜¯ â€œæ‰§è¡Œè½½ä½“â€ï¼› IO å¯†é›†å‹ä»»åŠ¡ï¼ˆç½‘ç»œ æ–‡ä»¶ æ•°æ®åº“ï¼‰ï¼šTaskÂ æ‰§è¡Œæ—¶ä¸å ç”¨çº¿ç¨‹ï¼ˆç­‰å¾… IO å“åº”æ—¶çº¿ç¨‹è¢«é‡Šæ”¾ï¼‰ï¼› CPU å¯†é›†å‹ä»»åŠ¡ï¼ˆè®¡ç®— æ’åºï¼‰ï¼šTaskÂ éœ€é€šè¿‡Â Task.RunÂ æŠ›åˆ°çº¿ç¨‹æ± ï¼Œå ç”¨çº¿ç¨‹æ‰§è¡Œã€‚ 5. C++ ç±»æ¯”æ€»ç»“ C# æ¦‚å¿µ C++ ç­‰ä»· ç±»ä¼¼æ¦‚å¿µ æ ¸å¿ƒå·®å¼‚ Task std::futurestd::task C# Task æ”¯æŒæ›´å¤šå¼‚æ­¥æ“ä½œï¼ˆå¦‚ WhenAllï¼‰ Task.Run std::async(std::launch::async) å‡ä¸ºå¼€å¯çº¿ç¨‹æ± çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ await Task co_await std::future C# å°è£…æ›´ç®€æ´ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†åç¨‹ å››ã€yieldï¼šè¿­ä»£å™¨çš„ â€œç”Ÿæˆå™¨â€1. æ ¸å¿ƒå®šä¹‰yieldÂ æ˜¯è¿­ä»£å™¨è¯­æ³•ç³–ï¼Œç”¨äºç®€åŒ–ã€Œæšä¸¾åºåˆ—ï¼ˆIEnumerableTï¼‰çš„ç”Ÿæˆã€ã€‚å…¶æ ¸å¿ƒä½œç”¨æ˜¯ï¼š æ— éœ€æ‰‹åŠ¨å®ç°Â IEnumerableTÂ çš„Â GetEnumerator()Â æ–¹æ³•å’ŒÂ IEnumeratorTÂ æ¥å£ï¼› ç”¨Â yield returnÂ æš‚åœè¿­ä»£å™¨ï¼Œè¿”å›å½“å‰å…ƒç´ ï¼› ç”¨Â yield breakÂ ç»ˆæ­¢è¿­ä»£å™¨ï¼ˆå¯é€‰ï¼‰ã€‚ ç®€å•è¯´ï¼šyieldÂ è®©ä½ ç”¨ â€œçº¿æ€§ä»£ç â€ ç”Ÿæˆ â€œæŒ‰éœ€åŠ è½½â€ çš„åºåˆ—ï¼Œé¿å…ä¸€æ¬¡æ€§åˆ›å»ºæ•´ä¸ªé›†åˆï¼ˆèŠ‚çœå†…å­˜ï¼‰ã€‚ 2. å…³é”®è§„åˆ™ åªèƒ½ç”¨äºæ–¹æ³• å±æ€§ getterï¼Œä¸”è¿”å›å€¼å¿…é¡»æ˜¯Â IEnumerableÂ æˆ–Â IEnumeratorï¼ˆæ³›å‹ éæ³›å‹å‡å¯ï¼‰ï¼› å‡½æ•°å†…éƒ¨ä¸èƒ½æœ‰Â try-catchÂ åŒ…è£¹Â yield returnï¼ˆä½†å¯åœ¨Â yield returnÂ ä¹‹å¤–ç”¨ï¼‰ï¼› è¿­ä»£å™¨æ˜¯ â€œå»¶è¿Ÿæ‰§è¡Œâ€ çš„ï¼šåªæœ‰å½“è°ƒç”¨è€…éå†åºåˆ—ï¼ˆå¦‚Â foreachï¼‰æ—¶ï¼Œå‡½æ•°æ‰ä¼šæ‰§è¡Œï¼Œä¸”æ¯æ¬¡Â foreachÂ è¿­ä»£è§¦å‘ä¸€æ¬¡Â yield returnã€‚ 3. è¯­æ³•ç¤ºä¾‹ï¼ˆç”Ÿæˆ Cat åºåˆ—ï¼‰csharp è¿è¡Œ // ç”¨ yield ç”Ÿæˆ IEnumerableCat åºåˆ—ï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼‰IEnumerableCat GenerateCatSequence(int count) for (int i = 0; i count; i++) // æš‚åœè¿­ä»£å™¨ï¼Œè¿”å›å½“å‰ Catï¼ˆæ¯æ¬¡ foreach è¿­ä»£è·å–ä¸€ä¸ªï¼‰ yield return new Cat($Cat_i, i + 1); // å¯é€‰ï¼šyield break; // æå‰ç»ˆæ­¢è¿­ä»£// è°ƒç”¨è¿­ä»£å™¨ï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼‰void UseCatSequence() // æ­¤æ—¶ GenerateCatSequence æœªæ‰§è¡Œ IEnumerableCat cats = GenerateCatSequence(3); // éå†åºåˆ—æ—¶ï¼Œè¿­ä»£å™¨æ‰æ‰§è¡Œï¼ˆæ¯æ¬¡å¾ªç¯è§¦å‘ä¸€æ¬¡ yield returnï¼‰ foreach (Cat cat in cats) Console.WriteLine($Cat: cat.Name, cat.Age); 4. æ‰§è¡Œæµç¨‹æ‹†è§£ è°ƒç”¨Â GenerateCatSequence(3)ï¼šè¿”å›Â IEnumerableCatï¼Œå‡½æ•°ä½“æœªæ‰§è¡Œï¼› è¿›å…¥Â foreachÂ å¾ªç¯ï¼šè§¦å‘è¿­ä»£å™¨æ‰§è¡Œï¼Œåˆ°Â yield return new Cat(...)Â æš‚åœï¼Œè¿”å›ç¬¬ä¸€ä¸ªÂ Catï¼› å¾ªç¯ç»§ç»­ï¼šè¿­ä»£å™¨ä»æš‚åœå¤„æ¢å¤ï¼Œæ‰§è¡ŒÂ i++ï¼Œåˆ°Â yield returnÂ æš‚åœï¼Œè¿”å›ç¬¬äºŒä¸ªÂ Catï¼› å¾ªç¯ç»“æŸï¼šè¿­ä»£å™¨æ‰§è¡Œå®Œæ¯•ï¼Œåºåˆ—ç”Ÿæˆå®Œæˆã€‚ 5. å¼‚æ­¥è¿­ä»£å™¨ï¼ˆyield + asyncï¼‰C# 8.0+ æ”¯æŒã€Œå¼‚æ­¥è¿­ä»£å™¨ã€ï¼Œç”¨Â async IEnumerableTÂ ç»“åˆÂ yield returnï¼Œç”Ÿæˆå¼‚æ­¥åºåˆ—ï¼ˆæŒ‰éœ€åŠ è½½å¼‚æ­¥æ•°æ®ï¼‰ã€‚è¯­æ³•åªéœ€æ·»åŠ Â asyncï¼Œè¿”å›Â IAsyncEnumerableTï¼š csharp è¿è¡Œ // å¼‚æ­¥è¿­ä»£å™¨ï¼šæŒ‰éœ€å¼‚æ­¥è·å– Cat åºåˆ—ï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼Œæ¯æ¬¡è¿­ä»£å¼‚æ­¥è¯·æ±‚ä¸€ä¸ªï¼‰async IAsyncEnumerableCat FetchCatSequenceAsync(int count) for (int i = 0; i count; i++) // ç»“åˆ awaitï¼šå¼‚æ­¥è·å–å•ä¸ª Catï¼ˆéé˜»å¡ï¼‰ Cat cat = await FetchCatAsync($Cat_i); // æš‚åœå¼‚æ­¥è¿­ä»£å™¨ï¼Œè¿”å›å½“å‰ Cat yield return cat; // è°ƒç”¨å¼‚æ­¥è¿­ä»£å™¨ï¼ˆç”¨ await foreachï¼‰async Task UseAsyncCatSequence() // å¼‚æ­¥éå†ï¼šæ¯æ¬¡è¿­ä»£ç­‰å¾…ä¸€ä¸ª Cat å¼‚æ­¥è·å–å®Œæˆ await foreach (Cat cat in FetchCatSequenceAsync(3)) Console.WriteLine($å¼‚æ­¥è·å–åˆ°ï¼šcat.Name); 6. C++ ç±»æ¯”yieldÂ ç­‰ä»·äº C++20 çš„Â std::generatorï¼ˆæˆ–è‡ªå®šä¹‰è¿­ä»£å™¨ï¼‰â€”â€” ç®€åŒ–åºåˆ—ç”Ÿæˆï¼Œå®ç°å»¶è¿ŸåŠ è½½ã€‚åŒºåˆ«åœ¨äºï¼š C# çš„Â yieldÂ æ˜¯è¯­æ³•ç³–ï¼Œæ— éœ€æ‰‹åŠ¨å®ç°è¿­ä»£å™¨æ¥å£ï¼› C++ çš„Â std::generatorÂ æ˜¯æ¨¡æ¿ç±»ï¼Œéœ€ç»“åˆÂ co_yieldï¼ˆåç¨‹ï¼‰ä½¿ç”¨ï¼Œçµæ´»æ€§æ›´é«˜ã€‚ 7. é€‚ç”¨åœºæ™¯ ç”Ÿæˆå¤§å‹åºåˆ—ï¼ˆå¦‚ 100 ä¸‡æ¡æ•°æ®ï¼‰ï¼šå»¶è¿ŸåŠ è½½ï¼Œé¿å…ä¸€æ¬¡æ€§å ç”¨å¤§é‡å†…å­˜ï¼› æŒ‰éœ€ç”Ÿæˆæ•°æ®ï¼ˆå¦‚åˆ†é¡µæŸ¥è¯¢æ•°æ®åº“ï¼‰ï¼šéå†åˆ°ç¬¬ N é¡µæ‰æŸ¥è¯¢ç¬¬ N é¡µæ•°æ®ï¼› å¼‚æ­¥æŒ‰éœ€åŠ è½½ï¼ˆå¦‚æ»šåŠ¨åŠ è½½åˆ—è¡¨ï¼‰ï¼šç”¨Â async IAsyncEnumerableTÂ å®ç° â€œæ»šåŠ¨ä¸€æ¬¡ï¼Œå¼‚æ­¥è¯·æ±‚ä¸€æ¬¡â€ã€‚ äº”ã€å››å¤§æ¦‚å¿µçš„å…³è”ä¸åŒºåˆ«1. æ ¸å¿ƒå…³è” async/awaitÂ ä¾èµ–Â Taskï¼šasyncÂ å‡½æ•°è¿”å›Â Taskï¼ŒawaitÂ ç­‰å¾…Â Taskï¼Œä¸‰è€…å…±åŒæ„æˆ C# å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒï¼› yieldÂ å¯ä¸Â asyncÂ ç»“åˆï¼šé€šè¿‡Â async IAsyncEnumerableTÂ ç”Ÿæˆå¼‚æ­¥åºåˆ—ï¼Œæ­¤æ—¶Â yield returnÂ æš‚åœå¼‚æ­¥è¿­ä»£å™¨ï¼ŒawaitÂ ç”¨äºå¼‚æ­¥è·å–æ•°æ®ï¼› æœ¬è´¨éƒ½æ˜¯è¯­æ³•ç³–ï¼šasync/awaitÂ å°è£…åç¨‹çŠ¶æ€æœºï¼ŒyieldÂ å°è£…è¿­ä»£å™¨æ¥å£ï¼ŒTaskÂ å°è£…å¼‚æ­¥ä»»åŠ¡çŠ¶æ€ã€‚ 2. æ ¸å¿ƒåŒºåˆ« æ¦‚å¿µ æ ¸å¿ƒç”¨é€” æ˜¯å¦ä¾èµ–å¼‚æ­¥ è¿”å›å€¼ç±»å‹é™åˆ¶ async æ ‡è®°å¼‚æ­¥å‡½æ•°ï¼Œç”ŸæˆçŠ¶æ€æœº æ˜¯ TaskTaskvoid await ç­‰å¾…å¼‚æ­¥ä»»åŠ¡ï¼Œéé˜»å¡ æ˜¯ æ— ï¼ˆè§£åŒ… Task ç»“æœï¼‰ Task æ‰¿è½½å¼‚æ­¥ä»»åŠ¡çš„çŠ¶æ€ ç»“æœ æ˜¯ æ— ï¼ˆè‡ªèº«æ˜¯ç±»å‹ï¼‰ yield ç”Ÿæˆè¿­ä»£åºåˆ—ï¼Œå»¶è¿ŸåŠ è½½ å¦ï¼ˆå¯ç»“åˆï¼‰ IEnumerableIAsyncEnumerable å…­ã€å¸¸è§è¯¯åŒºä¸æœ€ä½³å®è·µ1. è¯¯åŒºæ€»ç»“ âŒÂ asyncÂ æ˜¯å¤šçº¿ç¨‹ â†’ æ­£ç¡®ï¼šasyncÂ æ˜¯å¼‚æ­¥æ ‡è®°ï¼Œçº¿ç¨‹ç”±ä»»åŠ¡ç±»å‹å†³å®šï¼› âŒÂ TaskÂ ä¸€å®šå ç”¨çº¿ç¨‹ â†’ æ­£ç¡®ï¼šIO å¯†é›†å‹ Task ä¸å ç”¨çº¿ç¨‹ï¼ŒCPU å¯†é›†å‹éœ€Â Task.Runï¼› âŒÂ yieldÂ æ˜¯å¼‚æ­¥ â†’ æ­£ç¡®ï¼šyieldÂ æ˜¯åŒæ­¥è¿­ä»£å™¨ï¼Œä»…Â async IAsyncEnumerableTÂ æ˜¯å¼‚æ­¥ï¼› âŒÂ awaitÂ å¯åœ¨åŒæ­¥å‡½æ•°ä¸­ä½¿ç”¨ â†’ æ­£ç¡®ï¼šawaitÂ åªèƒ½åœ¨Â asyncÂ å‡½æ•°ä¸­ä½¿ç”¨ã€‚ 2. æœ€ä½³å®è·µ å¼‚æ­¥ä»»åŠ¡ä¼˜å…ˆç”¨Â async TaskTï¼Œé¿å…Â async voidï¼ˆé™¤äº‹ä»¶å¤„ç†ï¼‰ï¼› IO å¯†é›†å‹ä»»åŠ¡ï¼ˆç½‘ç»œ æ–‡ä»¶ æ•°æ®åº“ï¼‰ç›´æ¥ç”¨Â async/awaitï¼Œæ— éœ€Â Task.Runï¼› CPU å¯†é›†å‹ä»»åŠ¡ç”¨Â Task.RunÂ æŠ›åˆ°çº¿ç¨‹æ± ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼› ç”Ÿæˆå¤§å‹ æŒ‰éœ€åºåˆ—ç”¨Â yieldï¼Œå¼‚æ­¥æŒ‰éœ€åºåˆ—ç”¨Â async IAsyncEnumerableTï¼› å¤šä»»åŠ¡å¹¶è¡Œç”¨Â Task.WhenAllï¼Œé¿å…é€ä¸ªÂ awaitï¼ˆæµªè´¹å¹¶è¡Œæ—¶é—´ï¼‰ã€‚ æ€»ç»“å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼ŒæŒæ¡è¿™å››ä¸ªæ¦‚å¿µçš„æ ¸å¿ƒæ˜¯ï¼š async/await/Task C++20 åç¨‹ï¼ˆco_await/co_returnï¼‰+Â std::futureï¼Œå°è£…æ›´å½»åº•ï¼Œä½¿ç”¨æ›´ç®€æ´ï¼› yield C++20Â std::generatorÂ +Â co_yieldï¼Œç®€åŒ–è¿­ä»£å™¨ç”Ÿæˆï¼Œæ”¯æŒå»¶è¿ŸåŠ è½½ï¼› å¼‚æ­¥é—®é¢˜æ‰¾Â async/await/Taskï¼Œè¿­ä»£ç”Ÿæˆé—®é¢˜æ‰¾Â yieldï¼Œå¼‚æ­¥è¿­ä»£æ‰¾Â async + yieldã€‚ å®ƒä»¬çš„è®¾è®¡ç›®æ ‡éƒ½æ˜¯ï¼šç”¨ç®€æ´çš„è¯­æ³•ï¼Œè§£å†³å¤æ‚çš„åº•å±‚é—®é¢˜ï¼ˆåç¨‹çŠ¶æ€æœºã€è¿­ä»£å™¨æ¥å£ã€å¼‚æ­¥ä»»åŠ¡ç®¡ç†ï¼‰ï¼Œè®©å¼€å‘è€…èšç„¦ä¸šåŠ¡é€»è¾‘ï¼Œè€Œéåº•å±‚å®ç°ã€‚ è¯´æ˜ä¸€ä¸‹ using è¯­å¥å®ç°äº† IDisposable æ¥å£ï¼Œç¡®ä¿èµ„æºè¢«é‡Šæ”¾","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"Csharp async å‡½æ•°ä¸ C++ å¼‚æ­¥æ–¹æ¡ˆå¯¹æ¯”","path":"/2025/11/26/2-ç¼–ç¨‹è¯­è¨€-CSharp-Csharp-async-å‡½æ•°ä¸-C-å¼‚æ­¥æ–¹æ¡ˆå¯¹æ¯”/","content":"C# async å‡½æ•°ä¸ C++ å¼‚æ­¥æ–¹æ¡ˆå¯¹æ¯”C# ä¸­çš„ async å‡½æ•°ï¼ˆé¢å‘ C++ ç¨‹åºå‘˜ï¼‰async å‡½æ•°æ˜¯ C# å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼ˆTAPï¼ŒTask-based Asynchronous Patternï¼‰çš„æ ¸å¿ƒï¼Œç›®çš„æ˜¯ç”¨åŒæ­¥çš„ä»£ç é£æ ¼å†™å¼‚æ­¥é€»è¾‘ï¼Œé¿å…å›è°ƒåœ°ç‹±ï¼ˆCallback Hellï¼‰ï¼ŒåŒæ—¶ä¸é˜»å¡çº¿ç¨‹ï¼ˆå°¤å…¶é€‚åˆ IO å¯†é›†å‹åœºæ™¯ï¼Œå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ï¼‰ã€‚ å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼Œå¯ç±»æ¯”ä¸ºã€ŒC++20 åç¨‹çš„è¯­æ³•ç³–å¢å¼ºç‰ˆã€â€”â€” æœ¬è´¨æ˜¯åŸºäºã€Œä»»åŠ¡ï¼ˆTaskï¼‰ã€çš„åç¨‹ï¼Œé€šè¿‡ async/await å…³é”®å­—ç®€åŒ–å¼‚æ­¥æµç¨‹ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†åç¨‹çš„æš‚åœæ¢å¤ã€‚ ä¸€ã€æ ¸å¿ƒåŸºç¡€ï¼šasync å‡½æ•°çš„ 3 ä¸ªå…³é”®è§„åˆ™1. å£°æ˜è¯­æ³•å‡½æ•°å¿…é¡»ç”¨ async ä¿®é¥°ç¬¦æ ‡è®°ï¼Œä¸”è¿”å›å€¼åªèƒ½æ˜¯ä»¥ä¸‹ 3 ç§ï¼ˆä¸èƒ½æ˜¯æ™®é€šç±»å‹å¦‚ intCatï¼‰ï¼š Taskï¼šæ— è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ï¼ˆç±»æ¯” C++ çš„ std::futurevoidï¼‰ï¼› TaskTResultï¼šæœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ï¼ˆç±»æ¯” C++ çš„ std::futureTResultï¼‰ï¼› voidï¼šä»…ç”¨äºäº‹ä»¶å¤„ç†ï¼ˆä¸æ¨èï¼Œæ— æ³•ç­‰å¾…å®Œæˆã€æ— æ³•æ•è·å¼‚å¸¸ï¼Œç±»ä¼¼â€œç«å¹¶å¿˜è®°â€ï¼‰ã€‚ç¤ºä¾‹ï¼ˆå¯¹æ¯” C++ï¼‰ï¼š åœºæ™¯ C# async å‡½æ•° C++ ç­‰ä»·æ€è·¯ï¼ˆfutureåç¨‹ï¼‰ æ— è¿”å›å€¼å¼‚æ­¥ä»»åŠ¡ async Task DownloadFileAsync(string url) std::futurevoid DownloadFile(string url) æœ‰è¿”å›å€¼å¼‚æ­¥ä»»åŠ¡ async Taskstring GetDataAsync() std::futurestring GetData() äº‹ä»¶å¤„ç†ï¼ˆç‰¹æ®Šï¼‰ async void ButtonClickHandler(object sender, EventArgs e) æ— ç›´æ¥ç­‰ä»·ï¼ˆC++ äº‹ä»¶é€šå¸¸ç”¨å›è°ƒï¼‰ 2. å¿…é¡»æ­é… await ä½¿ç”¨async å‡½æ•°å†…éƒ¨å¿…é¡»æœ‰è‡³å°‘ä¸€ä¸ª await è¡¨è¾¾å¼ï¼ˆå¦åˆ™ç¼–è¯‘å™¨ä¼šè­¦å‘Šï¼Œä¸”å‡½æ•°ä¼šåŒæ­¥æ‰§è¡Œï¼Œå¤±å»å¼‚æ­¥æ„ä¹‰ï¼‰ã€‚ await çš„ä½œç”¨ï¼šæš‚åœå½“å‰ async å‡½æ•°çš„æ‰§è¡Œï¼Œé‡Šæ”¾çº¿ç¨‹å»å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œç›´åˆ°ç­‰å¾…çš„å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œå†æ¢å¤å‡½æ•°åç»­é€»è¾‘ï¼ˆå…¨ç¨‹ä¸é˜»å¡çº¿ç¨‹ï¼‰ã€‚ 3. è°ƒç”¨è§„åˆ™è°ƒç”¨ async å‡½æ•°æ—¶ï¼Œä¸ä¼šç«‹å³æ‰§è¡Œå‡½æ•°ä½“ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ª TaskTaskTResult å¯¹è±¡ï¼ˆç±»æ¯” C++ çš„ std::futureï¼‰ï¼Œéœ€é€šè¿‡ä»¥ä¸‹æ–¹å¼ç­‰å¾…ç»“æœï¼š ç”¨ await ç­‰å¾…ï¼ˆåªèƒ½åœ¨å¦ä¸€ä¸ª async å‡½æ•°ä¸­ä½¿ç”¨ï¼‰ï¼› ç”¨ Task.Wait()Task.Result é˜»å¡ç­‰å¾…ï¼ˆä¸æ¨èï¼Œä¼šæŠµæ¶ˆå¼‚æ­¥ä¼˜åŠ¿ï¼Œç±»ä¼¼ C++ çš„ future.get()ï¼‰ã€‚ äºŒã€æ‰§è¡Œæµç¨‹ï¼šasyncawait åˆ°åº•åœ¨åšä»€ä¹ˆï¼Ÿç”¨ä¸€ä¸ªå®é™…ç¤ºä¾‹æ‹†è§£æµç¨‹ï¼Œå¸®åŠ©ç†è§£ã€Œéé˜»å¡ã€çš„æœ¬è´¨ï¼š ç¤ºä¾‹ä»£ç ï¼ˆå¼‚æ­¥è·å–æ•°æ®å¹¶å¤„ç†ï¼‰// æœ‰è¿”å›å€¼çš„ async å‡½æ•°ï¼šå¼‚æ­¥è·å– Cat æ•°æ®ï¼ˆæ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ï¼Œè€—æ—¶2ç§’ï¼‰async TaskCat FetchCatAsync(string name) Console.WriteLine(å¼€å§‹è¯·æ±‚ Cat æ•°æ®...); // await æš‚åœå‡½æ•°ï¼Œé‡Šæ”¾çº¿ç¨‹ï¼ˆçº¿ç¨‹å¯å»å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œå¦‚ UI ç‚¹å‡»ï¼‰ string data = await HttpGetAsync($https://api/cat?name=name); // å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œæ¢å¤æ‰§è¡Œï¼šè§£ææ•°æ®ä¸º Cat å¯¹è±¡ Cat cat = JsonConvert.DeserializeObjectCat(data); return cat; // è¿”å› TaskCatï¼Œç»“æœä¼šå­˜å…¥ Task ä¸­// è°ƒç”¨ async å‡½æ•°ï¼ˆéœ€åœ¨å¦ä¸€ä¸ª async å‡½æ•°ä¸­ï¼‰async Task ProcessCatAsync() // è°ƒç”¨ async å‡½æ•°ï¼Œè¿”å› TaskCatï¼ˆæœªæ‰§è¡Œå®Œï¼‰ TaskCat catTask = FetchCatAsync(Fritz); // å¯å¹¶è¡Œæ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼ˆçº¿ç¨‹æœªè¢«é˜»å¡ï¼‰ Console.WriteLine(ç­‰å¾…æ•°æ®æ—¶ï¼Œçº¿ç¨‹å¤„ç†å…¶ä»–äº‹æƒ…...); // await ç­‰å¾…ä»»åŠ¡å®Œæˆï¼Œè·å–ç»“æœï¼ˆæ­¤æ—¶è‹¥ä»»åŠ¡æœªå®Œæˆï¼Œå‡½æ•°æš‚åœï¼‰ Cat cat = await catTask; // ä»»åŠ¡å®Œæˆåï¼Œç»§ç»­æ‰§è¡Œåç»­é€»è¾‘ Console.WriteLine($è·å–åˆ° Catï¼šcat.Name, cat.Age);// å…¥å£è°ƒç”¨ï¼ˆå¦‚ Main å‡½æ•°ï¼ŒC# 7.1+ æ”¯æŒ async Mainï¼‰async static Task Main(string[] args) await ProcessCatAsync(); // ç­‰å¾…å¼‚æ­¥æµç¨‹å®Œæˆ æµç¨‹æ‹†è§£ï¼ˆå¯¹åº” C++ æ€ç»´ï¼‰ è°ƒç”¨ FetchCatAsync(Fritz)ï¼šè¿”å› TaskCatï¼Œå‡½æ•°ä½“å¼€å§‹æ‰§è¡Œï¼Œæ‰“å°ã€Œå¼€å§‹è¯·æ±‚ Cat æ•°æ®â€¦ã€ï¼› æ‰§è¡Œ await HttpGetAsync(...)ï¼š HttpGetAsync æ˜¯å¼‚æ­¥ IO æ“ä½œï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œä¼šç«‹å³è¿”å›ä¸€ä¸ª Taskstringï¼› await è§¦å‘ã€Œæš‚åœã€ï¼šFetchCatAsync å‡½æ•°åœæ­¢æ‰§è¡Œï¼Œé‡Šæ”¾å½“å‰çº¿ç¨‹ï¼ˆçº¿ç¨‹å¯å»å¤„ç† ProcessCatAsync ä¸­çš„ã€Œç­‰å¾…æ•°æ®æ—¶ï¼Œçº¿ç¨‹å¤„ç†å…¶ä»–äº‹æƒ…â€¦ã€ï¼Œæˆ–å…¶ä»– UI æ“ä½œï¼‰ï¼› å¼‚æ­¥ IO å®Œæˆåï¼ˆ2 ç§’åï¼‰ï¼š ç³»ç»Ÿè‡ªåŠ¨å°†çº¿ç¨‹åˆ‡å› FetchCatAsyncï¼Œç»§ç»­æ‰§è¡Œã€Œè§£æ JSON ä¸º Catã€ï¼Œè¿”å› catï¼› catTask çŠ¶æ€å˜ä¸ºã€Œå®Œæˆã€ï¼Œawait catTask å¾—åˆ° cat å¯¹è±¡ï¼› ProcessCatAsync ç»§ç»­æ‰§è¡Œï¼Œæ‰“å°ç»“æœã€‚ **æ ¸å¿ƒåŒºåˆ«äº C++**ï¼šC++ éœ€æ‰‹åŠ¨ç”¨ co_await ç»“åˆ promisefuture ç®¡ç†æš‚åœæ¢å¤ï¼Œè€Œ C# çš„ async/await å°è£…äº†è¿™ä¸€åˆ‡ï¼Œä»£ç æ›´ç®€æ´ã€‚ ä¸‰ã€å…³é”®ç‰¹æ€§ï¼šä¸ C++ å¼‚æ­¥æ–¹æ¡ˆçš„æ ¸å¿ƒå·®å¼‚1. éé˜»å¡ vs é˜»å¡ C# async å‡½æ•°ï¼šawait æ—¶é‡Šæ”¾çº¿ç¨‹ï¼ˆçº¿ç¨‹å¯å¤„ç†å…¶ä»–ä»»åŠ¡ï¼‰ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯ï¼ˆå¦‚ Web æœåŠ¡å™¨ã€UI ç¨‹åºï¼‰ï¼› C++ ä¼ ç»Ÿå¼‚æ­¥ï¼ˆå›è°ƒfutureï¼‰ï¼šfuture.get() ä¼šé˜»å¡çº¿ç¨‹ï¼Œç›´åˆ°ç»“æœè¿”å›ï¼ˆè‹¥è¦éé˜»å¡ï¼Œéœ€æ‰‹åŠ¨å†™å›è°ƒé“¾æˆ–ç”¨ C++20 åç¨‹ï¼‰ã€‚ 2. å¼‚å¸¸å¤„ç†async å‡½æ•°çš„å¼‚å¸¸ä¼šè¢«æ•è·å¹¶å­˜å‚¨åœ¨ Task ä¸­ï¼Œéœ€é€šè¿‡ await æˆ– Task.Exception è·å–ï¼ˆç±»æ¯” C++ çš„ future.get() æŠ›å‡ºå¼‚å¸¸ï¼‰ï¼š try Cat cat = await FetchCatAsync(InvalidName); // è‹¥è¯·æ±‚å¤±è´¥ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸catch (HttpRequestException ex) Console.WriteLine($å¼‚æ­¥è¯·æ±‚å¤±è´¥ï¼šex.Message); è€Œ C++ ä¸­ï¼Œfuture.get() ä¼šç›´æ¥æŠ›å‡ºå¼‚æ­¥æ“ä½œä¸­çš„å¼‚å¸¸ï¼Œå¤„ç†æ–¹å¼ç±»ä¼¼ã€‚ 3. å¹¶è¡Œå¼‚æ­¥è‹¥éœ€åŒæ—¶æ‰§è¡Œå¤šä¸ªå¼‚æ­¥ä»»åŠ¡ï¼ˆç±»æ¯” C++ çš„ std::when_allï¼‰ï¼Œå¯ç”¨ Task.WhenAllï¼š // åŒæ—¶è¯·æ±‚3ä¸ª Cat æ•°æ®ï¼ˆå¹¶è¡Œæ‰§è¡Œï¼Œæ€»è€—æ—¶â‰ˆ2ç§’ï¼Œè€Œé 2+2+2=6ç§’ï¼‰TaskCat task1 = FetchCatAsync(Fritz);TaskCat task2 = FetchCatAsync(Boots);TaskCat task3 = FetchCatAsync(Milo);// ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œè¿”å›ç»“æœæ•°ç»„Cat[] cats = await Task.WhenAll(task1, task2, task3); 4. ä¸ C++20 åç¨‹çš„å¯¹æ¯” ç‰¹æ€§ C# asyncawait C++20 åç¨‹ è¯­æ³•ç®€æ´åº¦ æé«˜ï¼ˆè¯­æ³•ç³–å°è£…å®Œæ•´ï¼‰ è¾ƒç¹çï¼ˆéœ€æ‰‹åŠ¨å®ç° promiseã€awaitable ç­‰ï¼‰ çº¿ç¨‹æ¨¡å‹ åŸºäº .NET çº¿ç¨‹æ± ï¼ˆè‡ªåŠ¨è°ƒåº¦ï¼‰ éœ€æ‰‹åŠ¨ç»‘å®šçº¿ç¨‹æ± æˆ–è‡ªå®šä¹‰è°ƒåº¦å™¨ é€‚ç”¨åœºæ™¯ IO å¯†é›†å‹ï¼ˆä¼˜å…ˆï¼‰ã€CPU å¯†é›†å‹ï¼ˆéœ€é…åˆ Task.Runï¼‰ IO å¯†é›†å‹ã€CPU å¯†é›†å‹å‡å¯ï¼ˆä½†éœ€æ›´å¤šæ‰‹åŠ¨é…ç½®ï¼‰ è¿”å›å€¼ç±»å‹ å›ºå®šä¸º TaskTaskvoid å¯è‡ªå®šä¹‰è¿”å›ç±»å‹ï¼ˆéœ€æ»¡è¶³åç¨‹è¦æ±‚ï¼‰ å››ã€å¸¸è§è¯¯åŒºï¼ˆC++ ç¨‹åºå‘˜æ˜“è¸©å‘ï¼‰1. è¯¯ä»¥ä¸ºã€Œasync å¤šçº¿ç¨‹ã€ é”™è¯¯è®¤çŸ¥ï¼šasync å‡½æ•°ä¼šè‡ªåŠ¨å¼€å¯æ–°çº¿ç¨‹ï¼› æ­£ç¡®é€»è¾‘ï¼šasync æ˜¯ã€Œå¼‚æ­¥ã€ï¼Œä¸æ˜¯ã€Œå¤šçº¿ç¨‹ã€ã€‚await æ—¶çº¿ç¨‹è¢«é‡Šæ”¾ï¼Œè€Œéåˆ›å»ºæ–°çº¿ç¨‹ï¼ˆCPU å¯†é›†å‹ä»»åŠ¡éœ€ç”¨ Task.Run æ˜¾å¼å¼€å¯çº¿ç¨‹ï¼Œç±»æ¯” C++ çš„ std::async(std::launch::async)ï¼‰ã€‚ CPU å¯†é›†å‹ä»»åŠ¡ç¤ºä¾‹ï¼ˆå¦‚å¤æ‚è®¡ç®—ï¼‰ï¼š // ç”¨ Task.Run å°† CPU å¯†é›†å‹ä»»åŠ¡æŠ›åˆ°çº¿ç¨‹æ± ï¼ˆç±»ä¼¼ C++ çš„ std::async å¼€å¯æ–°çº¿ç¨‹ï¼‰async Taskint HeavyCalculationAsync(int a, int b) // ç”¨ Task.Run åŒ…è£…åŒæ­¥è®¡ç®—é€»è¾‘ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ return await Task.Run(() = Thread.Sleep(1000); // æ¨¡æ‹Ÿè€—æ—¶è®¡ç®—ï¼ˆåŒæ­¥ï¼‰ return a * b; ); 2. æ»¥ç”¨ async void async void æ— æ³•ç­‰å¾…å®Œæˆï¼Œæ— æ³•æ•è·å¼‚å¸¸ï¼ˆé™¤äº†äº‹ä»¶å¤„ç†ï¼‰ï¼Œæ¯”å¦‚ï¼š // é”™è¯¯ç¤ºä¾‹ï¼šæ™®é€šå‡½æ•°ç”¨ async voidasync void BadAsyncFunction() await FetchCatAsync(Fritz);// è°ƒç”¨åæ— æ³•ç­‰å¾…ï¼Œå¼‚å¸¸ä¼šç›´æ¥å´©æºƒç¨‹åºBadAsyncFunction(); æ­£ç¡®åšæ³•ï¼šç”¨ async Task æ›¿ä»£ï¼Œè°ƒç”¨æ—¶ç”¨ await ç­‰å¾…ï¼š async Task GoodAsyncFunction() ... await GoodAsyncFunction(); // å¯ç­‰å¾…ã€å¯æ•è·å¼‚å¸¸ 3. å¿˜è®° await å¼‚æ­¥ä»»åŠ¡è°ƒç”¨ async å‡½æ•°åä¸ awaitï¼Œä¼šå¯¼è‡´ä»»åŠ¡åœ¨åå°æ‰§è¡Œï¼Œä¸»çº¿ç¨‹å¯èƒ½æå‰é€€å‡ºï¼š // é”™è¯¯ï¼šæœª awaitï¼Œä¸»çº¿ç¨‹å¯èƒ½åœ¨ FetchCatAsync å®Œæˆå‰é€€å‡ºTaskCat catTask = FetchCatAsync(Fritz);Console.WriteLine(ç¨‹åºç»“æŸ); // å¯èƒ½å…ˆæ‰“å°ï¼ŒCat æ•°æ®è¿˜æ²¡è·å–åˆ° äº”ã€å®é™…åœºæ™¯ç¤ºä¾‹ï¼šå®Œæ•´å¼‚æ­¥æµç¨‹ç»“åˆä¹‹å‰çš„ Cat ç±»ï¼Œå®ç°ã€Œå¼‚æ­¥è·å– Cat æ•°æ® â†’ å¼‚æ­¥æ›´æ–° Cat å¹´é¾„ â†’ åŒæ­¥æ‰“å°ç»“æœã€ï¼š class Cat public string Name get; set; public int Age get; set; // æ¨¡æ‹Ÿå¼‚æ­¥ç½‘ç»œè¯·æ±‚ï¼ˆIO å¯†é›†å‹ï¼‰async Taskstring HttpGetAsync(string url) // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ 1 ç§’ï¼ˆä¸é˜»å¡çº¿ç¨‹ï¼‰ await Task.Delay(1000); return $\\Name\\:\\Fritz\\,\\Age\\:3; // æ¨¡æ‹Ÿ JSON å“åº”// å¼‚æ­¥è·å– Catï¼ˆæœ‰è¿”å›å€¼ï¼‰async TaskCat FetchCatAsync(string name) Console.WriteLine($[DateTime.Now:HH:mm:ss] å¼€å§‹è¯·æ±‚ name çš„æ•°æ®...); string json = await HttpGetAsync($https://api/cat?name=name); Cat cat = System.Text.Json.JsonSerializer.DeserializeCat(json); Console.WriteLine($[DateTime.Now:HH:mm:ss] æ•°æ®è¯·æ±‚å®Œæˆ...); return cat;// å¼‚æ­¥æ›´æ–° Cat å¹´é¾„ï¼ˆæ— è¿”å›å€¼ï¼‰async Task UpdateCatAgeAsync(Cat cat, int newAge) Console.WriteLine($[DateTime.Now:HH:mm:ss] å¼€å§‹æ›´æ–°å¹´é¾„...); // æ¨¡æ‹Ÿæ•°æ®åº“å¼‚æ­¥æ›´æ–°ï¼ˆIO å¯†é›†å‹ï¼‰ await Task.Delay(500); cat.Age = newAge; Console.WriteLine($[DateTime.Now:HH:mm:ss] å¹´é¾„æ›´æ–°å®Œæˆ...);// ä¸»å¼‚æ­¥æµç¨‹async Task MainAsync() // 1. å¼‚æ­¥è·å– Cat Cat cat = await FetchCatAsync(Fritz); // 2. å¼‚æ­¥æ›´æ–°å¹´é¾„ await UpdateCatAgeAsync(cat, 4); // 3. åŒæ­¥æ‰“å°ç»“æœ Console.WriteLine($[DateTime.Now:HH:mm:ss] æœ€ç»ˆç»“æœï¼šcat.Name, cat.Age);// ç¨‹åºå…¥å£ï¼ˆC# 7.1+ æ”¯æŒ async Mainï¼‰async static Task Main(string[] args) await MainAsync(); è¾“å‡ºç»“æœï¼ˆä½“ç°å¼‚æ­¥éé˜»å¡ï¼‰[14:30:00] å¼€å§‹è¯·æ±‚ Fritz çš„æ•°æ®...[14:30:01] æ•°æ®è¯·æ±‚å®Œæˆ...[14:30:01] å¼€å§‹æ›´æ–°å¹´é¾„...[14:30:01] å¹´é¾„æ›´æ–°å®Œæˆ...[14:30:01] æœ€ç»ˆç»“æœï¼šFritz, 4 æ€»ç»“å¯¹ C++ ç¨‹åºå‘˜æ¥è¯´ï¼ŒæŒæ¡ C# async å‡½æ•°çš„æ ¸å¿ƒæ˜¯ï¼š async æ ‡è®°å‡½æ•°ä¸ºå¼‚æ­¥ï¼Œawait æš‚åœå¹¶é‡Šæ”¾çº¿ç¨‹ï¼ˆéé˜»å¡ï¼‰ï¼› å¼‚æ­¥ä»»åŠ¡çš„ç»“æœé€šè¿‡ TaskT æ‰¿è½½ï¼Œè°ƒç”¨æ—¶å¿…é¡» awaitï¼ˆå¦åˆ™å¤±å»å¼‚æ­¥æ„ä¹‰ï¼‰ï¼› é€‚åˆ IO å¯†é›†å‹åœºæ™¯ï¼ˆç½‘ç»œã€æ–‡ä»¶ã€æ•°æ®åº“ï¼‰ï¼ŒCPU å¯†é›†å‹éœ€é…åˆ Task.Runï¼› ç±»æ¯” C++20 åç¨‹ï¼Œä½†è¯­æ³•æ›´ç®€æ´ï¼Œçº¿ç¨‹è°ƒåº¦æ›´è‡ªåŠ¨åŒ–ã€‚æ ¸å¿ƒä¼˜åŠ¿ï¼šç”¨åŒæ­¥ä»£ç çš„å¯è¯»æ€§ï¼Œå®ç°å¼‚æ­¥éé˜»å¡çš„æ€§èƒ½ï¼Œå½»åº•å‘Šåˆ«å›è°ƒé“¾çš„æ··ä¹±ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"é¢å‘C++ç¨‹åºå‘˜çš„CSharpæ•™ç¨‹","path":"/2025/11/26/2-ç¼–ç¨‹è¯­è¨€-CSharp-é¢å‘C-ç¨‹åºå‘˜çš„CSharpæ•™ç¨‹/","content":"é¢å‘ C++ç¨‹åºå‘˜çš„ C#æ•™ç¨‹C# å¤§è‡´å¯ä»¥çœ‹ä½œæ˜¯ C++ å’Œ Java çš„ç»“åˆä½“ã€‚å…¶æ ¸å¿ƒæ¦‚å¿µæ˜¯å¼•ç”¨ç±»å‹ï¼ˆReference Typesï¼‰ã€‚è¿™ä¸€ç‰¹æ€§å€Ÿé‰´è‡ª Javaï¼Œå¦‚ä»Šå·²è¢«å¤šç§ä¸»æµè¯­è¨€é‡‡ç”¨ï¼Œå€¼å¾—æ·±å…¥ç†è§£ã€‚å®ƒæ˜¯ä¸€å¥—å·§å¦™çš„æœºåˆ¶ï¼Œæ”¯æŒéšå¼æŒ‡é’ˆå’Œå †å†…å­˜ä½¿ç”¨ï¼Œå¹¶ä¸”å®ç°äº†è‡ªåŠ¨åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ã€‚ C# æ¯” C++ æ›´å†—é•¿ï¼Œæ·»åŠ å’Œä¿®æ”¹å°å‹åŠŸèƒ½æ—¶æ›´é¡ºæ‰‹ï¼Œä½†æ•´ä½“é£æ ¼éš¾ä»¥æ˜ç¡®ç•Œå®šã€‚ç¬¬ä¸€éƒ¨åˆ†ä»‹ç» C# ä¸­çš„è¯­æ³•å·®å¼‚ä¸è¯­æ³•ç³–ï¼Œç¬¬äºŒéƒ¨åˆ†è®²è§£å¼•ç”¨ç±»å‹ï¼Œç¬¬ä¸‰éƒ¨åˆ†åˆ™ä»‹ç»é‚£äº›ç†è§£å¼•ç”¨ç±»å‹åæ‰åˆç†çš„æ›´å¤šå·®å¼‚ä¸è¯­æ³•ç³–ã€‚æœ€åç¬¬å››éƒ¨åˆ†æ˜¯å…³äº C# ç¼–ç¨‹æ–‡åŒ–çš„ä¸€äº›è¯´æ˜ã€‚ 1 ä¸ C++çš„ç»†å¾®å·®å¼‚1.1 æ‚é¡¹ ç§»é™¤äº† if(n=3) è¿™ç±»é—®é¢˜ã€‚C# ä¸å…è®¸ä»»ä½•ç±»å‹éšå¼è½¬æ¢ä¸º boolï¼Œå› æ­¤ä¼šå°†å…¶è§†ä¸ºè¯­æ³•é”™è¯¯ã€‚ä½ éœ€è¦å°†æ‰€æœ‰ if(n) æ›¿æ¢ä¸º if(n!=0)ï¼Œä¸è¿‡è¿™å¹¶ä¸ç®—éº»çƒ¦ã€‚ ä½† if(b=true) ä»ç„¶æ˜¯å¯æ€•çš„é€»è¾‘é”™è¯¯ï¼Œä¸”æŒ‡é’ˆä»ä¼šéšå¼å°†ç©ºéç©ºè½¬æ¢ä¸ºçœŸå‡ï¼šif(ptr) ç­‰ä»·äº if(ptr!=null)ã€‚ ç±»å‹è½¬æ¢è¯­æ³•ç›¸åï¼Œç±»å‹å¿…é¡»æ”¾åœ¨æ‹¬å·å†…ï¼šä½¿ç”¨ (int)n è€Œé int(n)ã€‚é£æ ¼å€Ÿé‰´è‡ª Javaã€‚ char ç±»å‹å  2 å­—èŠ‚ï¼ˆé‡‡ç”¨ UTF-16 ç¼–ç æ ¼å¼ï¼ŒåŸºæœ¬å…¼å®¹ ASCIIï¼‰ã€‚ è‹¥éœ€è¦å°† char[] ç”¨ä½œå­—èŠ‚æ•°ç»„ï¼ŒC# æä¾›äº† byte ç±»å‹ã€‚ ç‚¹å·ï¼ˆ.ï¼‰å…¼å…·ä½œç”¨åŸŸè§£æè¿ç®—ç¬¦çš„åŠŸèƒ½ã€‚C++ ä¸­çš„ c1.age = Cat::maxAge åœ¨ C# ä¸­å†™æˆ c1.age = Cat.maxAgeã€‚ æ›´æç«¯çš„ä¾‹å­ï¼šCat::primeCat.age ä¼šå˜æˆ Cat.primeCat.ageã€‚è®¾è®¡åˆè¡·æ˜¯è®©åˆå­¦è€…åªéœ€å­¦ä¹ ä¸€ä¸ªâ€œå±äºâ€è¿ç®—ç¬¦ã€‚ åŒå†’å·è¿ç®—ç¬¦å¹¶æœªè¢«ç§»é™¤ï¼Œè€Œæ˜¯è¢«é‡æ–°ç”¨é€”åŒ–ã€‚global:: å¯ä»¥ä½œä¸ºè·¯å¾„çš„èµ·å§‹éƒ¨åˆ†ã€‚å¦‚æœä½ æƒ³äº†è§£å®ƒï¼Œå®ƒè¢«ç§°ä¸ºå‘½åç©ºé—´åˆ«åé™å®šç¬¦ã€‚ æ²¡æœ‰ typedefã€‚ä½† using å…³é”®å­—è¢«é‡è½½ï¼Œå¯å®ç°æœ‰é™çš„ç±»å‹å®šä¹‰åŠŸèƒ½ï¼š using intList = System.Collections.Generic.Listint;ï¼ˆæ³¨æ„æ­¤å¤„ä½¿ç”¨ç‚¹å·è¿›è¡Œä½œç”¨åŸŸè§£æï¼‰ã€‚ä½†è¿™ç§å®šä¹‰ä»…åœ¨å½“å‰æ–‡ä»¶æœ‰æ•ˆï¼Œä¸”ä¸èƒ½ç”¨äºåŸºæœ¬ç±»å‹ï¼šusing tailLen t = int; ä¼šæŠ¥é”™ã€‚å¥‡æ€ªçš„æ˜¯ï¼Œå‡½æ•°æŒ‡é’ˆæœ‰ä¸“é—¨çš„ç±»å‹å®šä¹‰è¯­æ³•ï¼ˆdelegateï¼‰ã€‚ ä¸æ”¯æŒå®ã€‚#define sqr(x) (x*x) æ˜¯ä¸å…è®¸çš„ã€‚ ä½¿ç”¨æœªåˆå§‹åŒ–å˜é‡ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚ç¼–è¯‘å™¨å¯¹æ­¤æ£€æŸ¥éå¸¸ä¸¥æ ¼ï¼Œæœ‰æ—¶ç”šè‡³ä¼šåœ¨æ— æ³•è·Ÿä¸Šä½ çš„é€»è¾‘æ—¶ï¼Œè¯¯åˆ¤å˜é‡æœªåˆå§‹åŒ–ã€‚ ç±»ä¼¼åœ°ï¼Œå°†å¯èƒ½æœªåˆå§‹åŒ–çš„å˜é‡ä¼ é€’ç»™å‡½æ•°ã€ä¼ é€’åŒ…å«æœªåˆå§‹åŒ–å­—æ®µçš„ç»“æ„ä½“ï¼Œéƒ½ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯â€”â€”æ— è®ºå‡½æ•°æ˜¯å¦ä¼šä½¿ç”¨è¿™äº›å˜é‡å­—æ®µã€‚å…¶ç›®çš„æ˜¯ç¡®ä¿ C# ç¨‹åºæ°¸è¿œä¸ä¼šè¯»å–æ— æ•ˆçš„åƒåœ¾å€¼ï¼Œä¹Ÿä¸ä¼šå› æ­¤å‡ºç°éš¾ä»¥å¤ç°çš„é—´æ­‡æ€§é”™è¯¯ã€‚ var n = 8; æˆ– var w = cow; ä¼šè‡ªåŠ¨æ¨æ–­ç±»å‹ï¼Œç±»ä¼¼ C++ çš„ autoã€‚ æœ¬è´¨ä¸Šç¼–è¯‘å™¨ä¼šå°† var æ›¿æ¢ä¸ºå…·ä½“ç±»å‹ï¼Œä¸”è¯¥ç±»å‹å¿…é¡»èƒ½è¢«ç«‹å³ç¡®å®šã€‚ç†è®ºä¸Šè¿™æ˜¯ä¸ªå°ä¼—ç‰¹æ€§ï¼Œä½†åœ¨ C# ä»£ç ä¸­å´è¢«å¤§é‡ä½¿ç”¨ï¼Œç”šè‡³æ¯«æ— æ„ä¹‰åœ°æ›¿æ¢çŸ­ç±»å‹åã€‚ å‘½åç©ºé—´ä¸­åªèƒ½åŒ…å«ç±»å’Œæšä¸¾ï¼Œä¸èƒ½åŒ…å«å˜é‡æˆ–å‡½æ•°ã€‚ ä½ éœ€è¦å°†è¿™äº›å˜é‡å‡½æ•°å®šä¹‰ä¸ºé™æ€æˆå‘˜ï¼Œæ”¾åœ¨ä¸€ä¸ªâ€œå ä½ç±»â€ä¸­ã€‚ class stringFuncs // å ä½ç±» public static string bestWord; public static int compareSomehow(string w1, string w2) {â€¦ } } æ³¨æ„ï¼Œä½¿ç”¨æ—¶ä»é€šè¿‡ç‚¹å·è®¿é—®ï¼šstringFuncs.bestWord â€œcowâ€;ã€‚ using æŒ‡ä»¤çš„ä½¿ç”¨å—åˆ°é™åˆ¶ï¼šåªèƒ½æ”¾åœ¨æ–‡ä»¶é¡¶éƒ¨ï¼Œä¸”ä¸èƒ½æŒ‡å®šå‘½åç©ºé—´ä¸­çš„å•ä¸ªæˆå‘˜ã€‚ æœ€å¤šåªèƒ½å†™æˆ using System.Collections.Generic;ï¼Œæ— æ³•ç›´æ¥æŒ‡å®š LinkedListã€‚ using å¯ç”¨äºå‘½åç©ºé—´æˆ–ç±»ï¼Œä½†å¼•ç”¨ç±»æ—¶éœ€è¦é¢å¤–æ·»åŠ  static å…³é”®å­—ï¼šusing static stringFuncs;ã€‚ è¡¥å……è¯´æ˜ï¼šusing è¿˜æœ‰ç¬¬ä¸‰ç§å®Œå…¨ä¸åŒçš„ç”¨é€”â€”â€”using ä»£ç å—ã€‚å½“ä»£ç å—æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œä¼šç«‹å³è°ƒç”¨å¯¹è±¡çš„ææ„å‡½æ•°ï¼ˆç”¨äºèµ„æºé‡Šæ”¾ï¼‰ã€‚ æ²¡æœ‰æŒä¹…åŒ–å±€éƒ¨å˜é‡ï¼š void A() static int n=0; ... è¿™ç§å†™æ³•ä¸å­˜åœ¨ã€‚è¿™å…¶å®ä¸ç®—é—®é¢˜â€”â€”C# é¼“åŠ±ä½ ç¼–å†™å°å‹ç±»ï¼Œç”¨æˆå‘˜å˜é‡ä½œä¸ºæŒä¹…åŒ–å­˜å‚¨ã€‚ C# æ”¯æŒä¸ C++ ç±»ä¼¼çš„æŒ‡é’ˆç”¨æ³•ï¼Œä½†åªèƒ½åœ¨â€œä¸å®‰å…¨æ¨¡å¼ï¼ˆUnSafe modeï¼‰â€ä¸‹ä½¿ç”¨ï¼Œè€Œå¤§å¤šæ•°è¿è¡Œç¯å¢ƒå¹¶ä¸æ”¯æŒä¸å®‰å…¨æ¨¡å¼ã€‚å› æ­¤ï¼Œå®é™…ä¸Š C# ä¸­æ²¡æœ‰æ˜¾å¼æŒ‡é’ˆï¼Œç›¸å…³åŠŸèƒ½ç”±å¼•ç”¨ç±»å‹æ›¿ä»£ã€‚ æ•°ç»„çš„å˜åŒ–ï¼š æ–¹æ‹¬å·æ˜¯ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸€ç‚¹éå¸¸ä¾¿æ·ï¼Œç¤ºä¾‹ï¼š int[] A, B; // ä¸¤ä¸ª int ç±»å‹æ•°ç»„ int[] func_takeArray_returnArray(int[] A) ... // å‚æ•°å’Œè¿”å›å€¼åŒç†ï¼š æ•°ç»„è‡ªå¸¦é•¿åº¦ä¿¡æ¯ï¼šé€šè¿‡ Length æˆå‘˜å‡½æ•°è·å–ã€‚æ— éœ€å†æ‰‹åŠ¨ä¼ é€’ ã€‚ ç´¢å¼•èŒƒå›´æ£€æŸ¥ï¼šè‹¥ A[n] è®¿é—®è¶Šç•Œï¼Œä¼šæŠ›å‡ºè¿è¡Œæ—¶é”™è¯¯ã€‚æˆ‘çŸ¥é“ï¼Œè¿™è®©è¯­è¨€çœ‹èµ·æ¥åƒæ˜¯ç»™åˆå­¦è€…ç”¨çš„ï¼Œä½†å®é™…ç¼–å†™å¿«é€ŸåŸå‹ä»£ç æ—¶å¾ˆå®ç”¨â€”â€”ä½ å¯ä»¥éšæ„ä½¿ç”¨æ•°ç»„ï¼Œå³ä½¿å‡ºé”™ä¹Ÿä¼šå¾—åˆ°æ¸…æ™°çš„å¼‚å¸¸ä¿¡æ¯å’Œå †æ ˆè·Ÿè¸ªã€‚ é™¤äº† [][] äº¤é”™æ•°ç»„ï¼Œè¿˜æ”¯æŒçŸ©å½¢å¤šç»´æ•°ç»„ã€‚ äº¤é”™æ•°ç»„çš„è¯­æ³•ä¸ C++ ç›¸åã€‚å®ƒå¹¶éç®€å•çš„â€œæ•°ç»„çš„æ•°ç»„â€ç»„åˆï¼Œè€Œæ˜¯æœ‰é¢å¤–è§„åˆ™ï¼Œå¿…é¡»ä»å·¦åˆ°å³å£°æ˜ã€‚ å†ä¸¾ä¸€ä¸ªç¤ºä¾‹ï¼ˆæºè‡ª StackExchangeï¼‰ï¼Œæ›´æ¸…æ™°åœ°è¯´æ˜è¿™ç§â€œä»å·¦åˆ°å³â€è§„åˆ™ï¼š //`int[][,]` è¡¨ç¤ºâ€œä¸€ä¸ªæ•°ç»„ï¼Œå…¶å…ƒç´ æ˜¯çŸ©å½¢äºŒç»´æ•°ç»„â€ï¼šint[][,] A = new int[4][,]; // è¯­æ³•ç¡®å®åç›´è§‰Console.WriteLine(A.Length); // 4A[0] = new int[4,9];A[1] = new int[5,2]; // ä»ä¸ºäº¤é”™æ•°ç»„ï¼Œå„å­æ•°ç»„é•¿åº¦å¯ä¸åŒ å‡½æ•°è°ƒç”¨æ—¶å¯é€‰æ‹©æ€§åœ°æŒ‡å®šå‚æ•°åã€‚max(3,4) å’Œ max(x:3, y:4) å®Œå…¨ç­‰ä»·ã€‚æœ‰æ—¶ç”¨äºè‡ªæ³¨é‡Šä»£ç ï¼Œæˆ–çµæ´»è°ƒæ•´å‚æ•°é¡ºåºï¼Œå®é™…ç”¨é€”æ˜¯åœ¨ä¼—å¤šå¯é€‰å‚æ•°ä¸­åªæŒ‡å®šéƒ¨åˆ†ï¼š void A(int cats, int dogs) ... A(dogs:5, cats:2); // ç­‰ä»·äº A(2,5)ï¼Œæ³¨æ„ dogs å…ˆä¼ å…¥void doStuff(int a=0, int b=0, int c=0, int d=0) ... doStuff(d:5); // aã€bã€c ä½¿ç”¨é»˜è®¤å€¼ï¼Œä»…æŒ‡å®š d å‡½æ•°æŒ‡é’ˆçš„å·¥ä½œæ–¹å¼ä¸ C++ å¤§è‡´ç›¸åŒã€‚ä»¥ä¸‹ä»£ç å£°æ˜ ff ä¸ºæŒ‡å‘â€œæ¥æ”¶ä¸¤ä¸ª string å‚æ•°ã€è¿”å› int çš„å‡½æ•°â€çš„æŒ‡é’ˆï¼Œæ³¨æ„è¿”å›ç±»å‹åœ¨æœ«å°¾è€Œéå¼€å¤´ï¼Œä¸”ä½¿ç”¨ System.Func è€Œé C++ é£æ ¼çš„ System::Funcã€‚ä½¿ç”¨æ–¹å¼ç›¸åŒï¼Œä½†æ— éœ€ï¼ˆä¹Ÿä¸èƒ½ï¼‰æ·»åŠ å¼•ç”¨ï¼ˆï¼‰æˆ–è§£å¼•ç”¨ï¼ˆ*ï¼‰è¿ç®—ç¬¦ï¼š æ— è¿”å›å€¼æ—¶ï¼ŒSystem.Func ä¸é€‚ç”¨ï¼ˆä¸èƒ½å†™ string,string,voidï¼‰ï¼Œæ­¤æ—¶éœ€ä½¿ç”¨ System.Actionâ€”â€”å®ƒä¸ System.Func åŠŸèƒ½ä¸€è‡´ï¼Œåªæ˜¯é»˜è®¤è¿”å›ç±»å‹ä¸º void æ— è¾“å…¥å‚æ•°æ—¶ï¼Œçœç•¥å°–æ‹¬å·ï¼šSystem.Action f3; è¡¨ç¤ºæ— å‚æ— è¿”å›å€¼çš„å‡½æ•°æŒ‡é’ˆã€‚ è¿˜æœ‰ä¸€ç§æ—§è¯­æ³•ï¼Œéœ€å…ˆé€šè¿‡ delegate å®šä¹‰ç±»å‹åˆ«åï¼ˆç±»ä¼¼ typedefï¼‰ï¼šä¸¤ç§æ–¹å¼å®Œå…¨äº’é€šã€‚æ­£å› è¿™ç§æ—§è¯­æ³•ï¼ŒC# ä¸­çš„å‡½æ•°æŒ‡é’ˆä¹Ÿè¢«ç§°ä¸ºâ€œå§”æ‰˜ï¼ˆdelegateï¼‰â€ã€‚ delegate int strCmp_t(string x, string y); strCmp_t ff;System.Funcstring, string, int ff; // ç­‰ä»·äº C++ çš„ int (*f)(string,string);ff = charsInCommon; // å°†å‡½æ•°èµ‹å€¼ç»™ ff x = ff(cow, wookie); // å¯èƒ½è¿”å› ow å¯¹åº”çš„é•¿åº¦System.Actionint f2; æ”¯æŒåŒ¿åå‡½æ•°ï¼ˆç§°ä¸º Lambda è¡¨è¾¾å¼ï¼Œä½†å¹¶éä¸¥æ ¼æ„ä¹‰ä¸Šçš„ Lambdaâ€”â€”ä¸æ”¯æŒä¸Šä¸‹æ–‡æ•è·ï¼‰ã€‚å‡½æ•°ä½“è¯­æ³•ä¸æ™®é€šå‡½æ•°ä¸€è‡´ã€‚å‚æ•°éƒ¨åˆ†æ— éœ€æŒ‡å®šç±»å‹ï¼ˆç¼–è¯‘å™¨å¯è‡ªåŠ¨æ¨æ–­ï¼‰ï¼Œè¿”å›ç±»å‹ä¹Ÿä¼šè‡ªåŠ¨æ¨æ–­ã€‚= æ˜¯åŒ¿åå‡½æ•°çš„å…³é”®å­—ã€‚è‹¥å‡½æ•°ä½“ä»…å«å•ä¸ªè¿”å›è¯­å¥ï¼Œå¯çœç•¥ return å’Œå¤§æ‹¬å·ã€‚è¿˜æœ‰ä¸€ç§ä½¿ç”¨ delegate å…³é”®å­—çš„è¿‡æ—¶è¯­æ³•ï¼Œæ— ä½¿ç”¨å¿…è¦ï¼Œä½†ä»å¯èƒ½åœ¨æ—§ä»£ç ä¸­è§åˆ°ã€‚ gg = (x,y) = return x*2 - y; ;gg = (x,y) = x*2 - y; C++ æ¨¡æ¿å‡½æ•°çš„åŠŸèƒ½åœ¨ C# ä¸­è¢«æ‹†åˆ†ä¸ºä¸¤ä¸ªç‰¹æ€§ï¼š æ³›å‹ï¼ˆgenericsï¼‰ï¼šè¯­æ³•ç±»ä¼¼ C++ æ¨¡æ¿ï¼Œä½†ä¸æ”¯æŒâ€œé¸­å­ç±»å‹â€â€”â€”å‡½æ•°ä½“ä¸­åªèƒ½å‡è®¾ç±»å‹æ”¯æŒèµ‹å€¼è¿ç®—ç¬¦ï¼ˆ=ï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶ã€‚ä½ å¯ä»¥æŒ‡å®šç±»å‹å¿…é¡»æ˜¯ç±»ï¼ˆwhere T : classï¼‰ï¼Œæ­¤æ—¶å‡½æ•°ä½“å¯ä½¿ç”¨ == è¿›è¡ŒæŒ‡é’ˆæ¯”è¾ƒï¼Œä½†ä»ä¸å¤Ÿå®ç”¨ã€‚ æœ€ç»ˆå¯é™åˆ¶è¾“å…¥ç±»å‹ä¸ºæŸä¸ªç±»çš„å­ç±»ï¼ˆwhere T : Animalï¼‰ï¼Œä¾‹å¦‚ä» Animals åˆ—è¡¨ä¸­ç­›é€‰ Dog æˆ– Catï¼šT aa = Animals[i] as T;ã€‚æ˜¾ç„¶ï¼ŒC++ æ¨¡æ¿å‡½æ•°çš„è®¸å¤šå®ç”¨åŠŸèƒ½åœ¨æ³›å‹ä¸­æ— æ³•å®ç°ã€‚ dynamic å…³é”®å­—ï¼šå°†å˜é‡æ ‡è®°ä¸ºåŠ¨æ€ç±»å‹ï¼Œç±»ä¼¼æ¨¡æ¿ç±»å‹ bool longEnough(dynamic n) return n.Length 10; ã€‚é™åˆ¶æ˜¯ï¼šæ— æ³•ç®€æ´åœ°å¼ºåˆ¶ä¸¤ä¸ªè¾“å…¥å‚æ•°ä¸ºåŒä¸€ç±»å‹ï¼Œä¹Ÿæ— æ³•ç›´æ¥å£°æ˜è¯¥ç±»å‹çš„å±€éƒ¨å˜é‡ï¼ˆæ®è¯´å¯é€šè¿‡ typeof è§„é¿ï¼Œä½†è¾ƒä¸ºç¹çï¼‰ã€‚ ä¸å…è®¸ç”¨å†…éƒ¨ä½œç”¨åŸŸå˜é‡éšè—å¤–éƒ¨ä½œç”¨åŸŸå˜é‡ã€‚æ˜ç¡®æ¥è¯´ï¼Œè¿™æ˜¯å°†ä¸è‰¯ç¼–ç¨‹é£æ ¼ç›´æ¥åˆ—ä¸ºé”™è¯¯ã€‚int i = 8;for(int i=0; i10; i++) // C# æŠ¥é”™ï¼šå†…éƒ¨ i éšè—å¤–éƒ¨ i æœ‰é™çš„â€œçœŸæ­£å¼•ç”¨å˜é‡â€ï¼šä¸å…è®¸ int n = C[i].age;ã€‚ä½†å¯å£°æ˜ ref int nï¼Œä¸”åªèƒ½é€šè¿‡â€œæŒ‰å¼•ç”¨è¿”å›â€çš„å‡½æ•°èµ‹å€¼ã€‚æ³¨æ„å¿…é¡»æ·»åŠ æ‰€æœ‰å†—ä½™çš„ ref å…³é”®å­—ã€‚é™åˆ¶æ˜¯ï¼šè¢«å¼•ç”¨çš„å¯¹è±¡å¿…é¡»åœ¨å †ä¸Šï¼ˆä½†å¯ä»¥æ˜¯ç±»ä¸­çš„å€¼ç±»å‹ï¼Œä¾‹å¦‚ Cat ä¸­çš„ ageï¼‰ã€‚ // é€šè¿‡æŒ‰å¼•ç”¨è¿”å›å‡½æ•°èµ‹å€¼å¼•ç”¨å˜é‡ ref int n = ref getAgeRef(c1); // ç­‰ä»·äº C++ çš„ int n = c1.age; // æŒ‰å¼•ç”¨è¿”å›å‡½æ•°çš„å®šä¹‰ ref int getAgeRef(Cat cc) ref return cc.age; æ²¡æœ‰å¤´æ–‡ä»¶æˆ–å‡½æ•°åŸå‹ã€‚ä½†ä¹Ÿæ— éœ€è¿™äº›â€”â€”C# ç¯å¢ƒä¼šè‡ªåŠ¨æ‰«ææ‰€æœ‰æ–‡ä»¶æŸ¥æ‰¾ä¾èµ–ã€‚ å®¹å™¨ç±»ï¼š List æ›¿ä»£ C++ çš„ Vectorï¼ŒåŸºäºæ•°ç»„å®ç°ã€‚å¥‡æ€ªçš„æ˜¯ï¼Œå®ƒåŒ…å«éƒ¨åˆ†æ—¶é—´å¤æ‚åº¦ä¸º O(n) çš„æˆå‘˜å‡½æ•°ï¼Œä¸”æ²¡æœ‰ pop_back æ–¹æ³•ã€‚ LinkedList å¯¹åº” C++ çš„é“¾è¡¨ç±»ã€‚ å“ˆå¸Œè¡¨æ˜ å°„ç±»è¢«é‡å‘½åä¸º Dictionaryï¼ˆå¯¹åº” C++ çš„ unordered_mapï¼‰ã€‚ ArrayList æ˜¯ Java é£æ ¼çš„æ—§ç‰ˆæ··åˆç±»å‹æ•°ç»„ï¼Œå­˜å‚¨ Object ç±»å‹ï¼ˆæ‰€æœ‰ç±»å‹çš„åŸºç±»ï¼‰ï¼Œä¸æ¨èä½¿ç”¨ã€‚ foreach å¾ªç¯è¯­æ³•ç³–ï¼šå¯éå†æ•°ç»„å’Œå¤§å¤šæ•°å®¹å™¨ï¼šé€‚ç”¨äºä»»ä½•æ”¯æŒå¤–éƒ¨è¿­ä»£å™¨çš„ç±»å‹ï¼ˆå®é™…ä¸Šæ˜¯å®ç°äº†æ ‡å‡†â€œå‘å‰è¿­ä»£å™¨â€æ¥å£çš„ç±»å‹ï¼‰ã€‚ åºåˆ—åŒ–ï¼ˆSerializationï¼‰ï¼šæ— éœ€å¤æ‚æ“ä½œï¼Œä»»ä½•ç±»éƒ½å¯åºåˆ—åŒ–ä¸º XML æ ¼å¼ï¼Œä¹‹åå†ååºåˆ—åŒ–æ¢å¤ã€‚é€šå¸¸å›¾å½¢ç•Œé¢ï¼ˆGUIï¼‰å¼€å‘ä¸­ä¼šç”¨åˆ°è¿™ä¸€ç‰¹æ€§ã€‚æ ‡å‡†åºåˆ—åŒ–å‡è®¾å­—æ®µæ˜¯ç®€å•çš„â€œè‡ªæœ‰æ•°æ®â€ï¼Œä¼šé€’å½’åºåˆ—åŒ–æ‰€æœ‰åµŒå¥—æ•°æ®ã€‚è‹¥æ•°æ®ç»“æ„åŒ…å«æŒ‡é’ˆï¼Œåˆ™éœ€è¦é¢å¤–å¤§é‡å·¥ä½œã€‚ åå°„ï¼ˆReflectionï¼‰ï¼šç±»çš„ GetMethods æ–¹æ³•ä¼šè¿”å›æ‰€æœ‰å‡½æ•°çš„ç­¾åå’Œåç§°ï¼ˆåŒ…æ‹¬ç§æœ‰å‡½æ•°ï¼‰ï¼Œä¹‹åå¯é€šè¿‡è¿™äº›å¥æŸ„è°ƒç”¨å‡½æ•°ã€‚é€‚ç”¨äºä¸€äº›ç‰¹æ®Šåœºæ™¯ï¼šä¾‹å¦‚ä¸ºä»»ä½•ç±»å¿«é€Ÿåˆ¶ä½œå¯è§†åŒ–ç¼–è¾‘å™¨ï¼Œæˆ–è°ƒç”¨ç¼–è¯‘æ—¶æœªçŸ¥çš„ç±»ã€‚æœ‰æ—¶ä½ ä¼šçœ‹åˆ°ä»£ç â€œè¿è§„â€è®¿é—®ç§æœ‰å˜é‡å‡½æ•°â€”â€”å®ƒä»¬æ­£æ˜¯é€šè¿‡åå°„å®ç°çš„ã€‚åå°„å¯¹å®ç°å·²çŸ¥åŠŸèƒ½æ²¡æœ‰å¸®åŠ©ã€‚ 1.2 ç±»ç»“æ„ä½“ã€ç»§æ‰¿å·®å¼‚ ç»“æ„ä½“ï¼ˆstructï¼‰å’Œç±»ï¼ˆclassï¼‰çš„é»˜è®¤è®¿é—®ä¿®é¥°ç¬¦æ˜¯ privateï¼Œä¸” public ä¸ä¼šâ€œç»§æ‰¿ä¼ é€’â€â€”â€”å¿…é¡»ä¸ºæ¯ä¸ªæˆå‘˜æ˜¾å¼æ·»åŠ  publicã€‚çº¯æ•°æ®ç»“æ„ä½“çš„å†™æ³•ç»§æ‰¿è‡ª Java çš„è®¾è®¡ï¼šè‰¯å¥½çš„é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰åº”è®©å¼€å‘è€…â€œè´¹åŠ›â€æ‰èƒ½æš´éœ²ç ´åå°è£…çš„å…¬å…±å˜é‡ã€‚ public struct Dog public string name; public int age; // è‹¥ä¸åŠ ç¬¬äºŒä¸ª publicï¼Œage ä¼šæ˜¯ private ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡éƒ½ä¼šè¢«è‡ªåŠ¨åˆå§‹åŒ–ï¼ˆæœ¬è´¨ä¸Šæ˜¯é»˜è®¤æ„é€ å‡½æ•°çš„ä½œç”¨ï¼‰ï¼Œä½†åªè¦ä½ è‡ªå®šä¹‰äº†ä»»ä½•æ„é€ å‡½æ•°ï¼Œç³»ç»Ÿå°±ä¸ä¼šå†è‡ªåŠ¨ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°ã€‚ç±»çš„æˆå‘˜å˜é‡å¯åœ¨å®šä¹‰æ—¶æŒ‡å®šåˆå§‹å€¼ï¼Œç¼–è¯‘å™¨ä¼šç§˜å¯†å°†è¿™äº›åˆå§‹åŒ–é€»è¾‘æ³¨å…¥åˆ°æ‰€æœ‰æ„é€ å‡½æ•°ï¼ˆåŒ…æ‹¬é»˜è®¤æ„é€ å‡½æ•°ï¼‰ä¸­ã€‚ç¤ºä¾‹ï¼š public class Spot public int n; // ä»…åœ¨é»˜è®¤æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ä¸º 0 public int x = 99; // ä»»ä½•æ„é€ å‡½æ•°éƒ½ä¼šæ‰§è¡Œ x=99 public string w = getNextName(); // ç”šè‡³å¯ä»¥è°ƒç”¨å‡½æ•°ï¼ŒåŒæ ·åœ¨æ„é€ å‡½æ•°ä¸­æ‰§è¡Œ ç»§æ‰¿ä¸­çš„åŠ¨æ€è½¬æ¢ä½¿ç”¨ baseClass as subclass è¯­æ³•ã€‚ç¤ºä¾‹ï¼š Animal aa; // Cat çš„çˆ¶ç±» Cat cc = aa as Cat; if(cc != null) // ç¡®è®¤ aa æ˜¯ Cat ç±»å‹ ä¸æ”¯æŒç±»çš„å¤šé‡ç»§æ‰¿ã€‚å€Ÿé‰´è‡ª Java çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šå¯å®ç°ä»»æ„æ•°é‡çš„â€œæ¥å£ï¼ˆinterfaceï¼‰â€ã€‚æ¥å£æ˜¯çº¯å¥‘çº¦ï¼Œæœ¬è´¨ä¸Šæ˜¯åªåŒ…å«æŠ½è±¡è™šå‡½æ•°ï¼ˆ=0 å‡½æ•°ï¼‰çš„æŠ½è±¡ç±»ï¼š // C++ ç‰ˆæœ¬ class Worker public: virtual int doWork() = 0; // ç­‰ä»·çš„ C# ç‰ˆæœ¬ interface Worker int doWork(); // éšå¼ä¸º publicã€virtual å’Œ abstract æ¥å£ä»…èƒ½è¦æ±‚å®ç°è™šå‡½æ•°ï¼Œä¸èƒ½åŒ…å«è‡ªèº«çš„å˜é‡ï¼Œä¹Ÿä¸èƒ½æä¾›ä»»ä½•å®ç”¨ä»£ç ï¼ˆæ— é»˜è®¤å®ç°ã€æ— è¾…åŠ©å‡½æ•°ï¼‰ã€‚C# é£æ ¼è¦æ±‚æ¥å£åä»¥å¤§å†™ I å¼€å¤´ï¼ˆå¦‚ IWorkerï¼‰ã€‚è¿™å¯èƒ½è®©äººè¯¯ä»¥ä¸ºæ¥å£ç±»å‹å’Œç±»ç±»å‹çš„æŒ‡é’ˆä¸å¯äº’æ¢ï¼Œä½†å®é™…ä¸Šå®ƒä»¬å®Œå…¨å…¼å®¹â€”â€”æ¥å£ç±»å‹å¯åƒå…¶ä»–çˆ¶ç±»ä¸€æ ·å£°æ˜å˜é‡æˆ–ä½œä¸ºå‚æ•°ã€‚ç”±äºä»…èƒ½ç»§æ‰¿ä¸€ä¸ªå®é™…ç±»ï¼Œè°ƒç”¨çˆ¶ç±»æˆå‘˜çš„è¯­æ³•è¢«ç®€åŒ–ï¼šç”¨ base.cost() æ›¿ä»£ C++ çš„ animal::cost()ã€‚ï¼ˆæ— éœ€è®¿é—®ç»§æ‰¿çš„æ¥å£æˆå‘˜ï¼Œå› ä¸ºæ¥å£æ²¡æœ‰å¯è®¿é—®çš„å…·ä½“å†…å®¹ã€‚ï¼‰è™šå‡½æ•°çš„å£°æ˜éœ€è¦é¢å¤–ä¸€æ­¥ï¼šçˆ¶ç±»ä¸­åœ¨å‡½æ•°å‰æ·»åŠ  virtualï¼ˆè¡¨ç¤ºè¯¥å‡½æ•°å¯è¢«é‡å†™ï¼‰ï¼Œå­ç±»ä¸­å¿…é¡»åœ¨é‡å†™å‡½æ•°å‰æ·»åŠ  overrideï¼š class Animal // çˆ¶ç±»ï¼Œæ— ç‰¹æ®Šä¹‹å¤„ public virtual void eat() // å…³é”®ï¼šæ ‡è®°ä¸ºå¯è™šå‡½æ•° public virtual void sleep() // åŒç† class Cat : Animal public override void eat() ... // æ ‡è®°ä¸ºè™šå‡½æ•°é‡å†™ public void sleep() ... // Cat.sleep ä¸æ˜¯è™šå‡½æ•° å­ç±»ä¸­æœªé‡å†™çš„å‡½æ•°åº”æ·»åŠ  new å…³é”®å­—ï¼ˆè¡¨ç¤ºéšè—çˆ¶ç±»å‡½æ•°ï¼‰ï¼Œä½†è¿™æ˜¯é»˜è®¤è¡Œä¸ºï¼Œå› æ­¤å¾ˆå°‘æœ‰äººæ˜¾å¼æ·»åŠ ã€‚ new å…³é”®å­—è¢«ç”¨äºå®Œå…¨ä¸åŒçš„ç”¨é€”ï¼ˆæ—¢ç”¨äºåˆ›å»ºå¯¹è±¡ï¼Œä¹Ÿç”¨äºéšè—çˆ¶ç±»å‡½æ•°ï¼‰ã€‚ è¿™å¹¶éå®ç”¨ç‰¹æ€§â€”â€”å»ºè®®æ‰€æœ‰éœ€è¦é‡å†™çš„å‡½æ•°éƒ½æ˜¾å¼æ·»åŠ  overrideã€‚ å®˜æ–¹è®¾è®¡ç†ç”±ï¼šå‡è®¾ Cat.eat æœ€åˆæ˜¯å­ç±»ä¸­çš„æ™®é€šå‡½æ•°ï¼Œä¹‹åçˆ¶ç±» Animal ç‹¬ç«‹æ·»åŠ äº† virtual eat å‡½æ•°ã€‚è¯¥è§„åˆ™å¯å¸®åŠ©å‘ç°ï¼šæ—§çš„ Cat.eat å¯èƒ½ä¸æ»¡è¶³ Animal.eat çš„åç½®æ¡ä»¶ï¼Œå› æ­¤ä¸åº”è¢«é‡å†™ã€‚ æ²¡æœ‰å‹å…ƒå‡½æ•°ï¼ˆfriend functionsï¼‰ã€‚ æ‰©å±•æ–¹æ³•ï¼ˆExtension methodsï¼‰ï¼šçº¯ç²¹çš„è¯­æ³•ç³–â€”â€”æœ¬è´¨æ˜¯æ™®é€šå‡½æ•°ï¼Œä½†è°ƒç”¨æ–¹å¼ç±»ä¼¼æˆå‘˜å‡½æ•°ã€‚å®ƒæ— æ³•è®¿é—®ç§æœ‰å˜é‡ï¼Œä¹Ÿä¸èƒ½æ˜¯è™šå‡½æ•°â€”â€”é™¤è°ƒç”¨è¯­æ³•å¤–ï¼Œä¸æ™®é€šå‡½æ•°å®Œå…¨ä¸€è‡´ã€‚å®šä¹‰æ—¶éœ€åœ¨ç¬¬ä¸€ä¸ªå‚æ•°å‰æ·»åŠ  thisã€‚è°ƒç”¨æ–¹å¼ï¼šc1.passTime(4);ã€‚å”¯ä¸€ç”¨é€”æ˜¯å…è®¸é€šè¿‡â€œå¯¹è±¡.æ–¹æ³•åâ€çš„æ–¹å¼è°ƒç”¨ï¼Œæ–¹ä¾¿åœ¨ IDE ä¸­é€šè¿‡ä¸‹æ‹‰åˆ—è¡¨æŸ¥æ‰¾ã€‚æ³¨æ„ï¼šå‚æ•°åˆ—è¡¨ä¸­çš„ this æ˜¯å…³é”®å­—çš„åˆä¸€æ¬¡å¤ç”¨ã€‚ // ç¬¬ä¸€ä¸ªå‚æ•° this Cat ä½¿å…¶æˆä¸º Cat çš„æ‰©å±•æ–¹æ³• public static void passTime(this Cat c, int days) ... // æ¨¡æ‹Ÿç¡è§‰ã€è¿›é£Ÿç­‰é€»è¾‘ // æ³¨æ„ï¼šä»…èƒ½è®¿é—® Cat çš„å…¬å…±æˆå‘˜ å±æ€§ï¼ˆPropertiesï¼‰ï¼šç®€åŒ– gettersetter æ–¹æ³•å¯¹çš„ç¼–å†™ã€‚ä½¿ç”¨æ—¶å®Œå…¨åƒè®¿é—®å˜é‡ï¼Œæ— éœ€ n = c1.getYears(); å’Œ c1.setYears(4);ï¼Œç›´æ¥ n = c1.years; å’Œ c1.years = 4;ã€‚ å±æ€§çš„ä½¿ç”¨éå¸¸æ™®éï¼Œè¢«è§†ä¸ºå®šä¹‰ç®€å•å˜é‡çš„â€œæ ‡å‡†æ–¹å¼â€ã€‚ç³»ç»Ÿä¼šä¸ºå·¦å€¼ï¼ˆèµ‹å€¼æ“ä½œï¼‰è°ƒç”¨ setï¼Œä¸ºå…¶ä»–åœºæ™¯è°ƒç”¨ getã€‚ æ— é€»è¾‘çš„ç©º gettersetter æä¸ºå¸¸è§ï¼Œå› æ­¤æœ‰ä¸“é—¨çš„â€œè‡ªåŠ¨å±æ€§ï¼ˆauto-propertiesï¼‰â€ class Cat public int monthsOld; public int years // åŸºäº monthsOld å®ç°çš„ get/set get return monthsOld / 12; // è¯»å–æ—¶è°ƒç”¨ // èµ‹å€¼æ—¶è°ƒç”¨ï¼Œvalue æ˜¯å…³é”®å­— set if(value 0) value = 0; monthsOld = value * 12; class Cat int _age; // ç§æœ‰åå¤‡å˜é‡ public int age get return _age; set _age = value; //è‡ªåŠ¨ç”Ÿæˆéšè—çš„åå¤‡å˜é‡å’Œä¸Šè¿°ç©ºé€»è¾‘ä»£ç public int age get; set; 2 å¼•ç”¨ç±»å‹è¿™æ˜¯ C# ä¸ C++ æœ€æ ¸å¿ƒçš„å·®å¼‚ï¼Œå€Ÿé‰´è‡ª Javaã€‚å…¶è®¾è®¡ç›®æ ‡æ˜¯ï¼šéšè—æŒ‡é’ˆå’Œå †æ ˆçš„ç»†èŠ‚ï¼Œä¸ºæŒ‡é’ˆå’ŒéæŒ‡é’ˆä½¿ç”¨æä¾›ç»Ÿä¸€è¯­æ³•ï¼Œå¹¶æ”¯æŒè‡ªåŠ¨åƒåœ¾å›æ”¶ã€‚ 2.1 å·¥ä½œåŸç† ç±»å‹åˆ†ä¸ºä¸¤ç±»ï¼šä¸èƒ½ä½¿ç”¨æŒ‡é’ˆçš„ç±»å‹ï¼Œå’Œå¿…é¡»ä½¿ç”¨æŒ‡é’ˆçš„ç±»å‹ã€‚ ç¬¬ä¸€ç±»å¾ˆç®€å•ï¼šåŸºæœ¬ç±»å‹ï¼ˆintã€floatã€stringã€charã€bool ç­‰ï¼‰æ°¸è¿œä¸èƒ½æœ‰æŒ‡é’ˆâ€”â€”C# ä¸­ä¸å­˜åœ¨æŒ‡å‘è¿™äº›ç±»å‹çš„æŒ‡é’ˆã€‚ ç¬¬äºŒç±»ç§°ä¸ºå¼•ç”¨ç±»å‹ï¼ˆReference Typesï¼‰ï¼ŒåŒ…æ‹¬æ‰€æœ‰è‡ªå®šä¹‰ç±»ã€‚å®ƒä»¬åªèƒ½æ˜¯æŒ‡é’ˆï¼Œä¸”åªèƒ½é€šè¿‡ new åœ¨å †ä¸Šåˆ›å»ºâ€”â€”æ— æ³•åƒ C++ é‚£æ ·ç›´æ¥å£°æ˜ç±»çš„å®ä¾‹ã€‚æ­£å› ä¸ºè¿™ä¸€é™åˆ¶ï¼Œè¯­è¨€å¯ä»¥ç®€åŒ–å…¶ä½¿ç”¨ï¼šæ— éœ€é¢å¤–è¯­æ³•å£°æ˜ä¸ºæŒ‡é’ˆï¼Œä¸”ä¼šè‡ªåŠ¨è§£å¼•ç”¨ã€‚ Cat c1; // è‡ªåŠ¨è¢«è§†ä¸ºæŒ‡é’ˆï¼ˆå¼•ç”¨ï¼‰ c1 = new Cat(); // åˆ›å»ºå¯ç”¨ Cat çš„æ ‡å‡†æ–¹å¼ c1.name = fritz; // è‡ªåŠ¨è§£å¼•ç”¨ c1 Cat c1 = new Cat(); æœ¬è´¨æ˜¯å †å†…å­˜åˆ†é…ï¼Œçœ‹ä¼¼å¼€é”€è¾ƒå¤§ï¼Œä½†ç”±äºè‡ªåŠ¨åƒåœ¾å›æ”¶ï¼ŒC# å¼€å‘è€…æ— éœ€å…³å¿ƒå †å†…å­˜çš„ç®¡ç†ç»†èŠ‚ã€‚æœ¯è¯­è¯´æ˜ï¼šc1 è¢«ç§°ä¸ºâ€œå¼•ç”¨ï¼ˆreferenceï¼‰â€ã€‚ å› ä¸º Cat æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‰€ä»¥æ‰€æœ‰æŒ‡å‘ Cat çš„æŒ‡é’ˆéƒ½å«å¼•ç”¨ã€‚å…³äºè¯¥æœºåˆ¶çš„å‡ ç‚¹è§‚å¯Ÿï¼š æŒ‡é’ˆæ°¸è¿œä¸èƒ½æŒ‡å‘æ ˆæ•°æ®ã€‚æ ˆä¸Šåªèƒ½å­˜å‚¨â€œå€¼ç±»å‹â€ï¼Œä¸”æ— æ³•åˆ›å»ºæŒ‡å‘å€¼ç±»å‹çš„æŒ‡é’ˆã€‚ æ²¡æœ‰å–åœ°å€ï¼ˆï¼‰ã€è§£å¼•ç”¨ï¼ˆ*ï¼‰æˆ–ç®­å¤´ï¼ˆ-ï¼‰è¿ç®—ç¬¦ã€‚è¿™äº›è¿ç®—ç¬¦åœ¨æ™®é€šç±»å‹ä¸­è¢«ç¦ç”¨ï¼Œåœ¨å¼•ç”¨ç±»å‹ä¸­åˆ™é€šè¿‡éšå¼æ–¹å¼å®ç°ã€‚ å³ä½¿ä¸éœ€è¦ï¼Œä¹Ÿå¿…é¡»ä½¿ç”¨æŒ‡é’ˆå’Œ newã€‚å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬æƒ³è¦çš„æ˜¯ C++ ä¸­â€œè‡ªåŠ¨å­˜å‚¨æœŸâ€çš„ Catï¼Œä½† C# å¼ºåˆ¶æˆ‘ä»¬å£°æ˜å †ä¸Š Cat çš„æŒ‡é’ˆã€‚å› æ­¤ï¼ŒC# ç¨‹åºä¼šäº§ç”Ÿå¤§é‡çœ‹ä¼¼â€œæ— æ„ä¹‰â€çš„åƒåœ¾ã€‚ä» C++ å¼€å‘è€…çš„è§†è§’æ¥çœ‹ï¼ŒC# çš„å†…å­˜ç®¡ç†ä¼¼ä¹å®Œå…¨æ²¡æœ‰ç« æ³•ã€‚ æ²¡æœ‰äºŒçº§æŒ‡é’ˆï¼ˆCat**ï¼‰ã€‚è‹¥éœ€ç±»ä¼¼åŠŸèƒ½ï¼Œéœ€åˆ›å»ºä¸€ä¸ªåŒ…å«å•ä¸ªå¼•ç”¨ç±»å‹æˆå‘˜çš„å°å‹ç±»ã€‚ æ²¡æœ‰é”€æ¯ï¼ˆdestroyï¼‰å‘½ä»¤ã€‚å¥½å¤„æ˜¯ä¸ä¼šå‡ºç°æ‚¬ç©ºæŒ‡é’ˆâ€”â€”åƒåœ¾å›æ”¶å™¨ä¼šå®šæœŸé€šè¿‡â€œå¯è¾¾æ€§åˆ†æâ€å›æ”¶å†…å­˜ï¼šåªè¦æœ‰æŒ‡é’ˆæŒ‡å‘æŸä¸ªå¯¹è±¡ï¼Œå®ƒå°±ä¸ä¼šè¢«é”€æ¯ã€‚ é™¤è¯­æ³•ç®€åŒ–å¤–ï¼Œå¼•ç”¨æœ¬è´¨ä¸Šå°±æ˜¯æŒ‡é’ˆï¼šå¯ä»¥ä¸º nullï¼Œèµ‹å€¼ï¼ˆ=ï¼‰æ˜¯æŒ‡é’ˆèµ‹å€¼ï¼Œç›¸ç­‰åˆ¤æ–­ï¼ˆ==ï¼‰æ˜¯æŒ‡é’ˆæ¯”è¾ƒï¼š Cat c1 = null; c1.name = Boots; // å´©æºƒï¼ˆç©ºå¼•ç”¨å¼‚å¸¸ï¼‰ if(c1 != null) c1.name = Boots; // æ ‡å‡†ç©ºæŒ‡é’ˆæ£€æŸ¥ Cat c1 = new Cat(), c2 = new Cat(); if(c1 == c2) Console.WriteLine(falseï¼šæŒ‡å‘ä¸åŒå†…å­˜); c2 = c1; // æŒ‡é’ˆèµ‹å€¼ï¼Œç°åœ¨ä¸¤è€…æŒ‡å‘åŒä¸€ä¸ª Cat å°†ç±»å˜é‡ä¼ é€’ç»™å‡½æ•°æ—¶ï¼Œæœ¬è´¨æ˜¯æŒ‰å€¼ä¼ é€’æŒ‡é’ˆï¼š void catFunction(Cat c1) c1.name = Squeeky; // é€šè¿‡æŒ‡é’ˆä¿®æ”¹å…±äº«å¯¹è±¡ c1 = null; // ä»…ä¿®æ”¹æœ¬åœ°çš„ c1 æŒ‡é’ˆå‰¯æœ¬ è¿”å›ç±»å¯¹è±¡æœ¬è´¨æ˜¯è¿”å›æŒ‡é’ˆã€‚ä»¥ä¸‹å‡½æ•°è¿”å›æŒ‡å‘åŸå§‹ c1 æˆ– c2 çš„æŒ‡é’ˆï¼š Cat longestName(Cat c1, Cat c2) if(c1.name.Length c2.name.Length) return c1; else return c2; ç±»ä¸­çš„æˆå‘˜å˜é‡è‹¥ä¸ºå¼•ç”¨ç±»å‹ï¼Œæœ¬è´¨ä¹Ÿæ˜¯æŒ‡é’ˆï¼Œè¿™å®¹æ˜“è®©äººæ··æ·†ã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ä¸­ï¼Œc åˆå§‹ä¸º nullï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºå®ä¾‹ï¼š class Home Cat c; // åˆå§‹ä¸º nullï¼Œéœ€æ‰‹åŠ¨æ‰§è¡Œ c = new Cat(); ... æ ‡å‡†é“¾è¡¨èŠ‚ç‚¹çš„å†™æ³•å¯èƒ½è®©äººæ„Ÿåˆ°å¥‡æ€ªï¼šnext çœ‹ä¼¼æ˜¯åµŒå¥—çš„ CatListï¼Œä½†å®é™…ä¸Šæ˜¯æŒ‡é’ˆï¼š class CatList public Cat c; // å®é™…å­˜å‚¨çš„ Cat å¯¹è±¡ public CatList next; // ä»…ä¸ºæŒ‡é’ˆï¼ˆå¼•ç”¨ï¼‰ é˜…è¯»å¼•ç”¨ç±»å‹ä»£ç çš„å…³é”®æŠ€å·§æ˜¯ï¼šåœ¨è„‘ä¸­æ˜ç¡®åŒºåˆ†â€œæ™®é€šå˜é‡â€å’Œâ€œæŒ‡é’ˆâ€ã€‚ Cat c1 = new Cat(); // è§†ä¸ºâ€œå®é™…çš„ Cat å¯¹è±¡â€ï¼Œc1 è¢«è®¤ä¸ºæ˜¯â€œç»‘å®šçš„â€ Cat c2 = c1; // c2 è¢«ç”¨ä½œæŒ‡å‘è¯¥ Cat çš„æŒ‡é’ˆ å¦ä¸€ä¸ªä¾‹å­ï¼šC++ ä¸­å¯ç”¨ VectorCat* ç­›é€‰ VectorCat ä¸­çš„éƒ¨åˆ†å…ƒç´ ï¼Œä½† C# ä¸­ä¸¤è€…éƒ½ç”¨ ListCatï¼Œå› æ­¤éœ€è¦é€šè¿‡ä¸Šä¸‹æ–‡åˆ¤æ–­å“ªäº›æ˜¯ä½œä¸ºæŒ‡é’ˆä½¿ç”¨çš„ã€‚ 2.2 ä½œä¸ºå¼•ç”¨ç±»å‹çš„æ•°ç»„ C# æ•°ç»„æ˜¯å¼•ç”¨ç±»å‹ã€‚æ•°ç»„å˜é‡æœ¬è´¨æ˜¯æŒ‡å‘å †ä¸Šå®é™…æ•°ç»„çš„é const æŒ‡é’ˆã€‚ä¸æ”¯æŒæŒ‡é’ˆè¿ç®—â€”â€”B æ°¸è¿œä¸èƒ½æŒ‡å‘ A çš„ä¸­é—´ä½ç½®ã€‚åˆæ³•çš„ C# æ•°ç»„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ int[] A = new int[maxCows]; // æ³¨æ„ï¼šä½¿ç”¨å¸¸é‡æ— ä¼˜åŠ¿ï¼Œå› ä¸ºæ•°ç»„å§‹ç»ˆåœ¨å †ä¸ŠåŠ¨æ€åˆ†é… int[] B = A; // B æŒ‡å‘ A if(A == B) // æŒ‡é’ˆæ¯”è¾ƒï¼Œç»“æœä¸º true A = null; B = null; // ç¬¬ 1 è¡Œåˆ›å»ºçš„æ•°ç»„ç°åœ¨å¯è¢«åƒåœ¾å›æ”¶ 2.3 ç»“æ„ä½“ä¸å¼•ç”¨ç±»å‹ Java ç­‰è¯­è¨€ä»…æ”¯æŒç±»ä½œä¸ºå¼•ç”¨ç±»å‹ï¼Œè¯¥æœºåˆ¶å®Œå…¨å¯ç”¨ã€‚C# é¢å¤–å¢åŠ äº†ä¸€ä¸ªä¸å¿…è¦çš„å¤æ‚æ€§ï¼šstruct å…³é”®å­—å®šä¹‰å€¼ç±»å‹ç±»ã€‚ç¤ºä¾‹ï¼š struct Point public double x, y; Point p1; // ç»ˆäºæœ‰äº†æ™®é€šçš„æ ˆå˜é‡ p1.x = 5; // ç›´æ¥è®¿é—®ï¼Œæ— éœ€ new è¿™çœ‹ä¼¼å¾ˆæ–¹ä¾¿â€”â€”å¯ä»¥åƒ C++ é‚£æ ·ä½¿ç”¨æ ˆä¸Šçš„ç®€å•å¯¹è±¡ã€‚ä½†ç”±äºæ˜¯å€¼ç±»å‹ï¼Œæ°¸è¿œä¸èƒ½åˆ›å»ºæŒ‡å‘å®ƒçš„æŒ‡é’ˆï¼ˆè¿™ä¹Ÿæ„å‘³ç€ç»“æ„ä½“ä¸èƒ½æœ‰è™šå‡½æ•°ï¼‰ã€‚å®é™…å¼€å‘ä¸­ï¼Œclass æ˜¯é¦–é€‰ç±»å‹â€”â€”ä»»ä½•å¯èƒ½éœ€è¦æŒ‡é’ˆçš„åœºæ™¯éƒ½åº”ä½¿ç”¨ classã€‚å°†å¯¹è±¡å®šä¹‰ä¸º struct è¢«è§†ä¸ºä¸€ç§â€œä¸ºè¿½æ±‚æ€§èƒ½è€Œå†’é£é™©ã€æ˜“å‡ºé”™çš„åšæ³•â€ã€‚æ³¨æ„ï¼šç»“æ„ä½“çš„é»˜è®¤è®¿é—®ä¿®é¥°ç¬¦ä»æ˜¯ privateã€‚ èµ‹å€¼ï¼ˆ=ï¼‰æ˜¯æˆå‘˜çº§æµ…æ‹·è´ï¼Œç›¸ç­‰åˆ¤æ–­ï¼ˆ==ï¼‰æ˜¯æˆå‘˜çº§æ¯”è¾ƒã€‚ç»“æ„ä½“ä¸ç±»çš„å¯¹æ¯”ç¤ºä¾‹ï¼šCatTracker åŒ…å«ä¸€ä¸ªå¼•ç”¨ç±»å‹å’Œä¸€ä¸ªå€¼ç±»å‹ï¼š class CatTracker public Cat c; // æŒ‡é’ˆï¼ˆå¼•ç”¨ï¼‰ public Point spot; // å†…åµŒå€¼ç±»å‹ public CatTracker() spot.x = 0; spot.y = 0; // ç›´æ¥èµ‹å€¼ï¼Œå®‰å…¨ c = new Cat(); // å¼•ç”¨ç±»å‹å¿…é¡»æ‰‹åŠ¨åˆ›å»ºå®ä¾‹ c.age = 4; ... åˆ›å»º CatTracker ct = new CatTracker(); æ—¶ï¼Œå †ä¸Šä¼šåˆ›å»ºä¸€ä¸ª CatTracker å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«å†…åµŒçš„ Point spot å’ŒæŒ‡å‘ Cat c çš„æŒ‡é’ˆï¼ˆc ç”± CatTracker æŒæœ‰ï¼‰ã€‚ç»“æ„ä½“çš„ä¸€ä¸ªå¥‡æ€ªè¯­æ³•ï¼šæ„é€ å‡½æ•°å¿…é¡»ä½¿ç”¨å†—ä½™çš„ newã€‚ Point p1; p1.x = 6; p1.y = 8; // åˆæ³•ï¼Œä½†ä¹Ÿå¯å†™æˆï¼š p1 = new Point(); // ä»…å°† xã€y åˆå§‹åŒ–ä¸º 0ï¼Œå¹¶éå †åˆ†é… è¿™ä¹‹æ‰€ä»¥å¯è¡Œï¼Œæ˜¯å› ä¸ºç»“æ„ä½“æ°¸è¿œä¸èƒ½åœ¨å †ä¸Šåˆ›å»ºâ€”â€”new åœ¨è¿™é‡Œå®Œå…¨å¤šä½™ã€‚è®¾è®¡ç›®çš„æ˜¯è®©åˆå­¦è€…æ— éœ€åŒºåˆ† Thing æ˜¯ç±»è¿˜æ˜¯ç»“æ„ä½“ï¼Œéƒ½èƒ½ä½¿ç”¨ Thing t = new Thing(); åˆå§‹åŒ–ï¼Œä¸¤ç§æƒ…å†µä¸‹ t éƒ½ä¼šè¢«æ­£ç¡®è®¾ç½®ã€‚ ç»“æ„ä½“çš„æœ€åä¸€ä¸ªé—®é¢˜æ˜¯â€œç©¿é€èµ‹å€¼å¤±æ•ˆâ€ã€‚å‡è®¾ c.p.x = 7; ä¸­ï¼Œc é€šè¿‡ get å±æ€§è¿”å› pï¼ˆC# å¼€å‘è€…é€šå¸¸ä½¿ç”¨å±æ€§è€Œéç›´æ¥æš´éœ²å­—æ®µï¼‰ã€‚è‹¥ Point æ˜¯ç±»ï¼Œè¿™æ²¡é—®é¢˜â€”â€”get è¿”å›æŒ‡é’ˆï¼Œå¯ç›´æ¥ä¿®æ”¹åŸå§‹å¯¹è±¡ï¼›ä½†å¦‚æœ Point æ˜¯ç»“æ„ä½“ï¼Œget ä¼šè¿”å› p çš„å‰¯æœ¬ï¼Œå¯¹ x çš„èµ‹å€¼åªä¼šä¿®æ”¹å‰¯æœ¬ï¼ŒåŸå§‹å¯¹è±¡ä¸ä¼šå˜åŒ–ã€‚ 3 æ‚é¡¹ç‰¹æ€§å¼•ç”¨ä¼ é€’ C# æ”¯æŒæ ‡å‡†çš„æŒ‰å¼•ç”¨ä¼ é€’ï¼ˆpass-by-referenceï¼‰ï¼Œåˆ†ä¸ºâ€œä»…è¾“å‡ºâ€å’Œâ€œè¾“å…¥è¾“å‡ºâ€ä¸¤ç§ä¸“é—¨å½¢å¼ã€‚ç”¨ ref æ›¿ä»£äº† C++ çš„ ï¼Œä¸”è°ƒç”¨æ—¶å¿…é¡»ä¸ºå˜é‡æ·»åŠ  ref ä¿®é¥°ã€‚è®¾è®¡åˆè¡·æ˜¯è®©è°ƒç”¨è€…æ˜ç¡®çŸ¥é“å‚æ•°ä¼šè¢«ä¿®æ”¹ï¼ˆä½†å®é™…ä½œç”¨æœ‰é™ï¼‰ã€‚ void swap(ref int x, ref int y) ... // ä¸¤ä¸ªå‚æ•°å‡æŒ‰å¼•ç”¨ä¼ é€’ swap(ref num1, ref num2); // è°ƒç”¨æ—¶å¿…é¡»æ·»åŠ  ref å…³é”®å­— ä»…è¾“å‡ºå½¢å¼ç”¨ out æ›¿ä»£ refï¼ˆå£°æ˜å’Œè°ƒç”¨æ—¶éƒ½éœ€æ›¿æ¢ï¼‰ï¼Œå¹¶ä¿®æ”¹äº†é”™è¯¯è§„åˆ™ï¼š å®å‚æœªåˆå§‹åŒ–ä¸ä¼šæŠ¥é”™ï¼ˆæ­£å¸¸æƒ…å†µä¸‹è¿™æ˜¯ç¼–è¯‘é”™è¯¯ï¼‰ï¼› å‡½æ•°å†…å¿…é¡»ä¸ºè¯¥å‚æ•°èµ‹å€¼ï¼› å‡½æ•°å†…å°è¯•è¯»å–è¯¥å‚æ•°ä¼šæŠ¥é”™ã€‚ æ ¸å¿ƒç”¨æ³•å°±æ˜¯è¿™äº›ï¼Œä½†ä»æ–‡åŒ–è§’åº¦çœ‹ï¼ŒæŒ‰å¼•ç”¨ä¼ é€’å±äºé«˜çº§è¯é¢˜ã€‚ä¸€æ–¹é¢ï¼Œå‡ ä¹æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯æŒ‰æŒ‡é’ˆä¼ é€’çš„ï¼Œæ— éœ€æŒ‰å¼•ç”¨ä¼ é€’ï¼š void fixCat(Cat c) if(c.age 0) c.age = 0; // é€šè¿‡æŒ‡é’ˆä¿®æ”¹ï¼Œå®Œå…¨æœ‰æ•ˆ å¦ä¸€æ–¹é¢ï¼Œæœ¯è¯­å®¹æ˜“æ··æ·†â€”â€”C# å¼€å‘è€…ä»ä¸€å¼€å§‹å°±å°† Cat c1 ç§°ä¸ºâ€œå¼•ç”¨â€ï¼Œå› æ­¤â€œæŒ‰å¼•ç”¨ä¼ é€’å¼•ç”¨ç±»å‹â€â€œæŒ‰å¼•ç”¨ä¼ é€’å€¼ç±»å‹â€ç­‰è¡¨è¿°éå¸¸ç»•å£ã€‚å¾®è½¯å®˜æ–¹æ–‡æ¡£æ›¾ä¸€åº¦é”™è¯¯åœ°å£°ç§°â€œæ‰€æœ‰ç±»éƒ½æ˜¯æŒ‰å¼•ç”¨ä¼ é€’çš„â€ã€‚ LINQ åº“å®ƒåŒ…å«ä¸€äº› SQL é£æ ¼çš„å‡½æ•°ï¼Œå¯ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼Œæ— éœ€é¢å¤– APIï¼›è¿˜æä¾›äº†ä¸€å¥—å®Œå…¨å†—ä½™ã€åŠŸèƒ½æ›´å¼±çš„ SQL é£æ ¼è¯­æ³•ï¼ˆç¤ºä¾‹æºè‡ªå¾®è½¯æ–‡æ¡£ï¼‰ï¼š var q = from c in customers where c.City == Raleigh select c; æ­¤å¤–ï¼Œå‘½åç©ºé—´ä¸­è¿˜æ— ç†ç”±åœ°åŒ…å«äº†å¸¸è§çš„åˆ—è¡¨æŸ¥è¯¢å‡½æ•°â€”â€”ä¾‹å¦‚â€œè¿”å›æ‰€æœ‰æ»¡è¶³è°“è¯çš„å…ƒç´ â€ç­‰ã€‚ä½†è¿™äº›å‡½æ•°éƒ½ä¸èƒ½ä¿®æ”¹åŸå§‹åˆ—è¡¨ï¼Œä¸”å¤§å¤šæ•°ä¼šåˆ›å»ºå»¶è¿Ÿè®¡ç®—çš„å¯¹è±¡â€”â€”é€šå¸¸éœ€è¦åœ¨æœ«å°¾æ·»åŠ  .ToArray() æˆ– .ToList() æ‰èƒ½ç«‹å³è·å–ç»“æœã€‚ 4 ç¼–ç¨‹æ–‡åŒ– ä»–ä»¬çƒ­è¡·äºæ–°ç‰¹æ€§ï¼Œè¿™å¯¹ä¸€é—¨å•†ä¸šè¯­è¨€æ¥è¯´å¾ˆå¥‡æ€ªã€‚éœ€æ³¨æ„ï¼šä½ å¯èƒ½ä¼šçœ‹åˆ°å¯¹æŸä¸ªâ€œå¾®ä¸è¶³é“çš„è¯­æ³•ç³–â€çš„çƒ­çƒˆè¿½æ§ã€‚ å®˜æ–¹æ–‡æ¡£æ˜¯å¾®è½¯çš„ C# ç½‘ç«™ã€‚è¯¥æ–‡æ¡£å¾ˆå¤šåœ°æ–¹ä¸å®Œæ•´ï¼Œä½†è¿™ä¼¼ä¹è¢«è®¤ä¸ºæ˜¯å¯æ¥å—çš„ã€‚ ç½‘ä¸Šæ™®éè®¤ä¸ºâ€œåªæœ‰æ ‡è®°ä¸º interface çš„æ‰æ˜¯æ¥å£â€ï¼Œâ€œåªæœ‰æ ‡è®°ä¸º getset çš„æ‰æ˜¯è®¿é—®å™¨â€ã€‚ä»–ä»¬å¯¹â€œéšè—æˆå‘˜å˜é‡â€çš„ç†è§£éå¸¸å­—é¢åŒ–ï¼šä¸€ä¸ªç§æœ‰ int åŠ ç©ºå®ç°çš„ getset å°±è¢«è§†ä¸ºâ€œéšè—â€ã€‚å› æ­¤ï¼Œå½“ä½ çœ‹åˆ°æŸäº›å…³äº C# è®¾è®¡çš„è¨€è®ºè§‰å¾—å¥‡æ€ªæ—¶ï¼Œä¸å¦¨æ€è€ƒï¼šâ€œè¿™ä¸ªäººæ˜¯å¦ä¸ç†è§£é¢å‘å¯¹è±¡ç¼–ç¨‹é¦–å…ˆæ˜¯ä¸€ç§æ¦‚å¿µï¼Œå…¶æ¬¡æ‰æ˜¯å®ç°ï¼Ÿâ€ ç‰¹æ€§æ·˜æ±°é€Ÿåº¦å¿«äºè°·æ­Œç´¢å¼•æ›´æ–°é€Ÿåº¦ã€‚ä½ ç»å¸¸ä¼šå‘ç°é«˜æ’åçš„æœç´¢ç»“æœæŒ‡å‘ä¸ç®—å¤ªæ—§çš„é¡µé¢ï¼Œå´åœ¨è®²è§£ä¸¤ä¸ªç‰ˆæœ¬å‰çš„ç¹çç‰¹æ€§ã€‚ä½œè€…è‡ªå·±ä¹Ÿå¯èƒ½æ··æ·†â€”â€”éƒ¨åˆ†è®²è§£å½“å‰ç‰¹æ€§çš„é¡µé¢ä¸­ï¼Œä»£ç ä»æ··åˆäº†è¿‡æ—¶è¯­æ³•ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"classå’Œstructçš„å¼‚åŒ","path":"/2025/11/24/2-ç¼–ç¨‹è¯­è¨€-CSharp-classå’Œstructçš„å¼‚åŒ/","content":"åœ¨ C# ä¸­ï¼Œclassï¼ˆç±»ï¼‰å’Œ structï¼ˆç»“æ„ä½“ï¼‰æ˜¯ä¸¤ç§æ ¸å¿ƒçš„è‡ªå®šä¹‰ç±»å‹ï¼Œæœ¬è´¨åŒºåˆ«æ˜¯ï¼šclass æ˜¯å¼•ç”¨ç±»å‹ï¼Œstruct æ˜¯å€¼ç±»å‹ã€‚ å°ï¼ˆå°ºå¯¸å°ï¼‰ã€é™ï¼ˆä¸å¯å˜ï¼‰ã€ç®€ï¼ˆæ— ç»§æ‰¿å¤šæ€ï¼‰â†’ structï¼› å¤§ï¼ˆå°ºå¯¸å¤§ï¼‰ã€åŠ¨ï¼ˆå¯å˜ï¼‰ã€æ‚ï¼ˆéœ€ç»§æ‰¿å¤šæ€nullï¼‰â†’ classã€‚ ä¸€ã€ç›¸åŒç‚¹ï¼ˆå…±æ€§ç‰¹æ€§ï¼‰class å’Œ struct ä½œä¸ºè‡ªå®šä¹‰ç±»å‹ï¼Œå…·å¤‡ä»¥ä¸‹å…±åŒèƒ½åŠ›ï¼š å¯åŒ…å« å­—æ®µã€å±æ€§ã€æ–¹æ³•ã€æ„é€ å‡½æ•°ã€ç´¢å¼•å™¨ã€äº‹ä»¶ ç­‰æˆå‘˜ï¼› å¯å®ç° ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ï¼ˆæ”¯æŒæ¥å£å¤šæ€ï¼‰ï¼› å¯å®šä¹‰ æ³›å‹ç‰ˆæœ¬ï¼ˆå¦‚ ListT æ˜¯æ³›å‹ç±»ï¼ŒNullableT æ˜¯æ³›å‹ç»“æ„ä½“ï¼‰ï¼› æ”¯æŒ æˆå‘˜è®¿é—®æ§åˆ¶ï¼ˆpublicprivateprotected ç­‰ï¼‰ï¼› å¯åŒ…å« é™æ€æˆå‘˜ï¼ˆé™æ€å­—æ®µã€é™æ€æ–¹æ³•ã€é™æ€æ„é€ å‡½æ•°ï¼‰ã€‚ ç¤ºä¾‹ï¼šclass å’Œ struct éƒ½èƒ½å®ç°æ¥å£ã€å®šä¹‰æˆå‘˜ // å…¬å…±æ¥å£ public interface IMeasurable double GetValue(); // ç»“æ„ä½“å®ç°æ¥å£ public struct Celsius : IMeasurable public double Value get; public Celsius(double value) = Value = value; public double GetValue() = Value; // ç±»å®ç°æ¥å£ public class Temperature : IMeasurable public double Value get; set; public Temperature(double value) = Value = value; public double GetValue() = Value; äºŒã€æ ¸å¿ƒå·®å¼‚ä»¥ä¸‹æ˜¯äºŒè€…æœ€å…³é”®çš„åŒºåˆ«ï¼Œç”¨è¡¨æ ¼æ¸…æ™°æ€»ç»“ï¼Œå†é€ä¸€å±•å¼€è¯´æ˜ï¼š å¯¹æ¯”ç»´åº¦ structï¼ˆå€¼ç±»å‹ï¼‰ classï¼ˆå¼•ç”¨ç±»å‹ï¼‰ ç±»å‹æœ¬è´¨ å€¼ç±»å‹ï¼ˆValue Typeï¼‰ å¼•ç”¨ç±»å‹ï¼ˆReference Typeï¼‰ å­˜å‚¨ä½ç½® æ ˆï¼ˆStackï¼‰æˆ–åµŒå…¥åˆ°å¼•ç”¨ç±»å‹ï¼ˆå †ï¼‰ä¸­ å †ï¼ˆHeapï¼‰ï¼ˆå¯¹è±¡æ•°æ®ï¼‰+ æ ˆï¼ˆå¼•ç”¨åœ°å€ï¼‰ å†…å­˜åˆ†é…å›æ”¶ åˆ†é…å¿«ï¼ˆæ ˆè‡ªåŠ¨å¼¹æ ˆï¼‰ï¼Œæ— åƒåœ¾å›æ”¶ï¼ˆGCï¼‰å‹åŠ› åˆ†é…æ…¢ï¼ˆå †éœ€ GC ç®¡ç†ï¼‰ï¼Œå¤§å¯¹è±¡å¯èƒ½è§¦å‘ GC èµ‹å€¼è¡Œä¸º å¤åˆ¶æ•´ä¸ªå¯¹è±¡çš„æ‰€æœ‰å­—æ®µï¼ˆå€¼æ‹·è´ï¼‰ å¤åˆ¶å¼•ç”¨åœ°å€ï¼ˆå¼•ç”¨æ‹·è´ï¼Œå¯¹è±¡æ•°æ®å…±äº«ï¼‰ é»˜è®¤æ„é€ å‡½æ•° ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆæ— å‚æ„é€ ï¼ˆä¸å¯åˆ é™¤ï¼‰ï¼Œä¸èƒ½è‡ªå®šä¹‰æ— å‚æ„é€ ï¼ˆC# 10+ å…è®¸ä¸º struct å®šä¹‰æ— å‚æ„é€ ï¼‰ æ— é»˜è®¤æ— å‚æ„é€ ï¼ˆéœ€æ‰‹åŠ¨å®šä¹‰ï¼Œå¦åˆ™ä¸èƒ½æ— å‚å®ä¾‹åŒ–ï¼‰ ç»§æ‰¿ç‰¹æ€§ å¯†å°ï¼ˆsealedï¼Œä¸å¯ç»§æ‰¿å…¶ä»– structclassï¼‰ï¼Œä»…èƒ½å®ç°æ¥å£ å¯ç»§æ‰¿å…¶ä»– classï¼ˆå•ç»§æ‰¿ï¼‰ã€å®ç°æ¥å£ï¼Œæ”¯æŒå¤šæ€ null æ”¯æŒ ä¸èƒ½ç›´æ¥ä¸º nullï¼Œéœ€ç”¨å¯ç©ºå€¼ç±»å‹ï¼ˆstruct?ï¼‰ å¯ç›´æ¥èµ‹å€¼ nullï¼ˆè¡¨ç¤ºæ— å¼•ç”¨å¯¹è±¡ï¼‰ ç›¸ç­‰æ€§æ¯”è¾ƒï¼ˆé»˜è®¤ï¼‰ é€å­—æ®µå€¼æ¯”è¾ƒï¼ˆValueType.Equalsï¼‰ å¼•ç”¨åœ°å€æ¯”è¾ƒï¼ˆobject.ReferenceEqualsï¼‰ ææ„å‡½æ•° ä¸æ”¯æŒï¼ˆæ—  GC å›æ”¶ç¯èŠ‚ï¼‰ æ”¯æŒï¼ˆç”¨äºé‡Šæ”¾éæ‰˜ç®¡èµ„æºï¼Œæ­é… IDisposableï¼‰ è£…ç®±æ‹†ç®± è½¬æ¢ä¸º object æ—¶è§¦å‘è£…ç®±ï¼ˆæ€§èƒ½å¼€é”€ï¼‰ æ— éœ€è£…ç®±ï¼ˆæœ¬èº«æ˜¯ object å­ç±»ï¼‰ èµ‹å€¼è¡Œä¸ºï¼ˆå€¼æ‹·è´ vs å¼•ç”¨æ‹·è´ï¼‰ structï¼šå€¼æ‹·è´ï¼ˆå¤åˆ¶æ•´ä¸ªå¯¹è±¡ï¼‰ public struct Point public int X get; set; public int Y get; set; // ç¤ºä¾‹ï¼šèµ‹å€¼æ—¶å¤åˆ¶æ•´ä¸ªå¯¹è±¡ Point p1 = new Point X = 10, Y = 20 ; Point p2 = p1; // å€¼æ‹·è´ï¼šp2 æ˜¯ p1 çš„å®Œæ•´å‰¯æœ¬ï¼Œä¿®æ”¹ p2 ä¸å½±å“ p1 p2.X = 100; Console.WriteLine(p1.X); // è¾“å‡º 10ï¼ˆp1 æœªå˜ï¼‰ Console.WriteLine(p2.X); // è¾“å‡º 100ï¼ˆp2 ç‹¬ç«‹ä¿®æ”¹ï¼‰ classï¼šå¼•ç”¨æ‹·è´ï¼ˆå¤åˆ¶åœ°å€ï¼Œå…±äº«æ•°æ®ï¼‰ public class PointClass public int X get; set; public int Y get; set; // ç¤ºä¾‹ï¼šèµ‹å€¼æ—¶å¤åˆ¶å¼•ç”¨åœ°å€PointClass pc1 = new PointClass X = 10, Y = 20 ; PointClass pc2 = pc1; // å¼•ç”¨æ‹·è´ï¼špc1 å’Œ pc2 æŒ‡å‘å †ä¸­åŒä¸€ä¸ªå¯¹è±¡ pc2.X = 100; Console.WriteLine(pc1.X); // è¾“å‡º 100ï¼ˆpc1 è¢«é—´æ¥ä¿®æ”¹ï¼‰ Console.WriteLine(pc2.X); // è¾“å‡º 100ï¼ˆåŒä¸€å¯¹è±¡ï¼‰ ç»§æ‰¿ä¸å¤šæ€ structï¼š å¤©ç”Ÿæ˜¯ sealedï¼ˆå¯†å°ï¼‰çš„ï¼Œä¸èƒ½ç»§æ‰¿å…¶ä»– struct æˆ– classï¼ˆé¿å…å€¼ç±»å‹ç»§æ‰¿å¯¼è‡´çš„å†…å­˜å¸ƒå±€å¤æ‚ï¼‰ï¼› ä»…èƒ½å®ç°æ¥å£ï¼ˆå®ç°æ¥å£æ—¶ä¼šè§¦å‘è£…ç®±ï¼Œå› ä¸ºæ¥å£æ˜¯å¼•ç”¨ç±»å‹ï¼‰ï¼› ä¸èƒ½ç”¨ virtualoverride ä¿®é¥°æˆå‘˜ï¼ˆæ— ç»§æ‰¿ï¼Œæ— éœ€å¤šæ€ï¼‰ã€‚ classï¼š æ”¯æŒ å•ç»§æ‰¿ï¼ˆåªèƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼‰ï¼Œå¯å¤šå±‚ç»§æ‰¿ï¼› æ”¯æŒå®ç°å¤šä¸ªæ¥å£ï¼Œæ”¯æŒ virtualoverride å®ç°å¤šæ€ï¼› å¯è¢«æ ‡è®°ä¸º sealed ç¦æ­¢ç»§æ‰¿ã€‚ ç¤ºä¾‹ï¼šclass çš„ç»§æ‰¿ä¸å¤šæ€ public class Animal public virtual void Speak() = Console.WriteLine(åŠ¨ç‰©å«); public class Dog : Animal // ç»§æ‰¿ Animal public override void Speak() = Console.WriteLine(æ±ªæ±ªå«); // é‡å†™çˆ¶ç±»æ–¹æ³• Animal dog = new Dog(); dog.Speak(); // è¾“å‡º æ±ªæ±ªå«ï¼ˆå¤šæ€ç”Ÿæ•ˆï¼‰ ç›¸ç­‰æ€§æ¯”è¾ƒï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ structï¼šé»˜è®¤è°ƒç”¨ ValueType.Equalsï¼Œè¿›è¡Œ é€å­—æ®µå€¼æ¯”è¾ƒï¼ˆåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„æ‰€æœ‰å­—æ®µæ˜¯å¦å®Œå…¨ç›¸åŒï¼‰ï¼› classï¼šé»˜è®¤è°ƒç”¨ object.ReferenceEqualsï¼Œè¿›è¡Œ å¼•ç”¨åœ°å€æ¯”è¾ƒï¼ˆåˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦æŒ‡å‘å †ä¸­åŒä¸€ä¸ªå¯¹è±¡ï¼‰ã€‚ ç¤ºä¾‹ï¼šé»˜è®¤ç›¸ç­‰æ€§æ¯”è¾ƒ // structï¼šå€¼æ¯”è¾ƒ Point p1 = new Point X = 10, Y = 20 ; Point p2 = new Point X = 10, Y = 20 ; Console.WriteLine(p1.Equals(p2)); // è¾“å‡º Trueï¼ˆå­—æ®µå®Œå…¨ç›¸åŒï¼‰ // classï¼šå¼•ç”¨æ¯”è¾ƒ PointClass pc1 = new PointClass X = 10, Y = 20 ; PointClass pc2 = new PointClass X = 10, Y = 20 ; Console.WriteLine(pc1.Equals(pc2)); // è¾“å‡º Falseï¼ˆæŒ‡å‘ä¸åŒå¯¹è±¡ï¼‰ Console.WriteLine(ReferenceEquals(pc1, pc2)); // è¾“å‡º Falseï¼ˆå¼•ç”¨åœ°å€ä¸åŒï¼‰ æ³¨æ„ï¼šæ— è®ºæ˜¯ class è¿˜æ˜¯ structï¼Œéƒ½å¯é‡å†™ Equals æ–¹æ³•å’Œ == è¿ç®—ç¬¦ï¼Œè‡ªå®šä¹‰ç›¸ç­‰æ€§é€»è¾‘ï¼ˆå¦‚ class æŒ‰å­—æ®µæ¯”è¾ƒï¼‰ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"è½¬æ¢å¼æ“ä½œç¬¦","path":"/2025/11/24/2-ç¼–ç¨‹è¯­è¨€-CSharp-è½¬æ¢å¼æ“ä½œç¬¦/","content":"åœ¨ C# ä¸­ï¼Œè½¬æ¢å¼æ“ä½œç¬¦ï¼ˆConversion Operatorsï¼‰ å…è®¸ä½ ä¸ºè‡ªå®šä¹‰ç±»å‹ï¼ˆç±»ç»“æ„ä½“ï¼‰å®šä¹‰ä¸å…¶ä»–ç±»å‹ï¼ˆå€¼ç±»å‹ã€å¼•ç”¨ç±»å‹ã€å…¶ä»–è‡ªå®šä¹‰ç±»å‹ï¼‰çš„è½¬æ¢è§„åˆ™ï¼Œè®©ç±»å‹è½¬æ¢æ›´ç›´è§‚ã€ç¬¦åˆä¸šåŠ¡é€»è¾‘ï¼Œæ— éœ€ä¾èµ–é¢å¤–çš„ ToXxx() æ–¹æ³•ã€‚ ä¸€ã€æ ¸å¿ƒæ¦‚å¿µè½¬æ¢æ“ä½œç¬¦æœ¬è´¨æ˜¯ç”¨æˆ·å®šä¹‰çš„è½¬æ¢ï¼ˆUser-Defined Conversionsï¼‰ï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š éšå¼è½¬æ¢ï¼ˆimplicitï¼‰ï¼šå®‰å…¨ã€æ— æ•°æ®ä¸¢å¤±é£é™©ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€æ‰‹åŠ¨å¼ºåˆ¶è½¬æ¢ã€‚ æ˜¾å¼è½¬æ¢ï¼ˆexplicitï¼‰ï¼šå¯èƒ½å­˜åœ¨æ•°æ®ä¸¢å¤±ã€æ ¼å¼é”™è¯¯ç­‰é£é™©ï¼Œå¿…é¡»é€šè¿‡å¼ºåˆ¶è½¬æ¢ç¬¦ (ç›®æ ‡ç±»å‹) è§¦å‘ï¼Œç¼–è¯‘å™¨ä¼šæç¤ºæ½œåœ¨é£é™©ã€‚ è½¬æ¢æ“ä½œç¬¦çš„æ ¸å¿ƒç›®æ ‡ï¼šè®©è‡ªå®šä¹‰ç±»å‹åƒåŸºç¡€ç±»å‹ï¼ˆå¦‚ intã€doubleï¼‰ä¸€æ ·æ”¯æŒè‡ªç„¶çš„ç±»å‹è½¬æ¢ã€‚ äºŒã€éšå¼è½¬æ¢æ“ä½œç¬¦ï¼ˆimplicitï¼‰1. è¯­æ³•æ ¼å¼public static implicit operator ç›®æ ‡ç±»å‹(æºç±»å‹ æºå¯¹è±¡å‚æ•°) // è½¬æ¢é€»è¾‘ï¼ˆå¿…é¡»å®‰å…¨ï¼Œæ— å¼‚å¸¸ã€æ— æ•°æ®ä¸¢å¤±ï¼‰ return ç›®æ ‡ç±»å‹çš„å®ä¾‹; å¿…é¡»æ˜¯ public staticï¼ˆä¸å¯çœç•¥ï¼‰ï¼› operator æ˜¯å…³é”®å­—ï¼Œæ ‡è®°è¿™æ˜¯è½¬æ¢æ“ä½œç¬¦ï¼› æºç±»å‹ï¼šå¯ä»¥æ˜¯å½“å‰è‡ªå®šä¹‰ç±»å‹ï¼ˆå¦‚ Celsius è½¬ doubleï¼‰ï¼Œæˆ–å…¶ä»–ç±»å‹ï¼ˆå¦‚ double è½¬ Celsiusï¼‰ï¼› ç›®æ ‡ç±»å‹ï¼šè½¬æ¢åå¾—åˆ°çš„ç±»å‹ã€‚ 2. ç‰¹ç‚¹ å®‰å…¨ä¼˜å…ˆï¼šè½¬æ¢é€»è¾‘ä¸­ä¸èƒ½æŠ›å¼‚å¸¸ã€ä¸èƒ½ä¸¢å¤±æ•°æ®ï¼ˆå¦åˆ™è¿åéšå¼è½¬æ¢çš„è®¾è®¡åŸåˆ™ï¼‰ï¼› è‡ªåŠ¨æ‰§è¡Œï¼šæ— éœ€æ‰‹åŠ¨å†™å¼ºåˆ¶è½¬æ¢ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨è§¦å‘ã€‚ 3. é€‚ç”¨åœºæ™¯ è‡ªå®šä¹‰ç±»å‹ä¸åŸºç¡€ç±»å‹çš„â€œå®‰å…¨æ˜ å°„â€ï¼ˆå¦‚ Temperature è½¬ doubleï¼‰ï¼› ä¸¤ä¸ªè‡ªå®šä¹‰ç±»å‹é—´çš„æ— é£é™©è½¬æ¢ï¼ˆå¦‚ Celsius è½¬ Fahrenheit çš„æ•°å€¼è®¡ç®—ï¼‰ã€‚ 4. ç¤ºä¾‹æ‘„æ°åº¦ä¸æ•°å€¼åæ°åº¦çš„éšå¼è½¬æ¢ // æ‘„æ°åº¦ç»“æ„ä½“ public struct Celsius public double Value get; public Celsius(double value) = Value = value; // éšå¼è½¬æ¢ï¼šCelsius - doubleï¼ˆç›´æ¥è¿”å›æ¸©åº¦å€¼ï¼Œå®‰å…¨æ— ä¸¢å¤±ï¼‰ public static implicit operator double(Celsius c) = c.Value; // éšå¼è½¬æ¢ï¼šCelsius - Fahrenheitï¼ˆé€šè¿‡å…¬å¼è®¡ç®—ï¼Œæ— æ•°æ®ä¸¢å¤±ï¼‰ public static implicit operator Fahrenheit(Celsius c) double fahrenheit = c.Value * 9 / 5 + 32; return new Fahrenheit(fahrenheit); // åæ°åº¦ç»“æ„ä½“ public struct Fahrenheit public double Value get; public Fahrenheit(double value) = Value = value; // éšå¼è½¬æ¢ï¼šFahrenheit - double public static implicit operator double(Fahrenheit f) = f.Value; // ä½¿ç”¨ç¤ºä¾‹ Celsius roomTemp = new Celsius(25); double tempValue = roomTemp; // éšå¼è½¬æ¢ä¸º doubleï¼ˆç»“æœï¼š25.0ï¼‰ Fahrenheit fTemp = roomTemp; // éšå¼è½¬æ¢ä¸º Fahrenheitï¼ˆç»“æœï¼š77.0ï¼‰ Console.WriteLine($roomTemp.ValueÂ°C = tempValueï¼ˆæ•°å€¼ï¼‰); Console.WriteLine($roomTemp.ValueÂ°C = fTemp.ValueÂ°F); ä¸‰ã€æ˜¾å¼è½¬æ¢æ“ä½œç¬¦ï¼ˆexplicitï¼‰1. è¯­æ³•æ ¼å¼public static explicit operator ç›®æ ‡ç±»å‹(æºç±»å‹ æºå¯¹è±¡å‚æ•°) // è½¬æ¢é€»è¾‘ï¼ˆå¯å¤„ç†é£é™©ï¼Œå…è®¸æŠ›å¼‚å¸¸ï¼‰ return ç›®æ ‡ç±»å‹çš„å®ä¾‹; è¯­æ³•ä¸éšå¼è½¬æ¢ä¸€è‡´ï¼Œä»…å…³é”®å­—æ”¹ä¸º explicitã€‚ 2. ç‰¹ç‚¹ å…è®¸é£é™©ï¼šè½¬æ¢é€»è¾‘ä¸­å¯å¤„ç†æ•°æ®ä¸¢å¤±ã€æ ¼å¼æ ¡éªŒï¼Œå¿…è¦æ—¶æŠ›å¼‚å¸¸ï¼› æ‰‹åŠ¨è§¦å‘ï¼šå¿…é¡»ç”¨ (ç›®æ ‡ç±»å‹) å¼ºåˆ¶è½¬æ¢ï¼Œæ˜ç¡®å‘ŠçŸ¥ç¼–è¯‘å™¨â€œå·²çŸ¥é£é™©â€ã€‚ 3. é€‚ç”¨åœºæ™¯ åŸºç¡€ç±»å‹é—´çš„é£é™©è½¬æ¢ï¼ˆå¦‚ double è½¬ intï¼Œå¯èƒ½ä¸¢å¤±å°æ•°ï¼‰ï¼› è‡ªå®šä¹‰ç±»å‹çš„æ ¡éªŒè½¬æ¢ï¼ˆå¦‚ int è½¬ PositiveIntï¼Œéœ€æ ¡éªŒæ­£æ•°ï¼‰ï¼› åå‘è½¬æ¢ï¼ˆå¦‚ Fahrenheit è½¬ Celsiusï¼Œè™½è®¡ç®—ç²¾ç¡®ï¼Œä½†éœ€æ˜ç¡®æ„å›¾ï¼‰ã€‚ 4. ç¤ºä¾‹int è½¬æ­£æ•´æ•°ï¼ˆPositiveIntï¼‰ public class PositiveInt public int Value get; // æ„é€ å‡½æ•°æ ¡éªŒï¼šä»…å…è®¸æ­£æ•° public PositiveInt(int value) if (value = 0) throw new ArgumentOutOfRangeException(nameof(value), å¿…é¡»æ˜¯æ­£æ•°); Value = value; // æ˜¾å¼è½¬æ¢ï¼šint - PositiveIntï¼ˆé£é™©ï¼šint å¯èƒ½ä¸ºè´Ÿï¼Œéœ€æ ¡éªŒï¼‰ public static explicit operator PositiveInt(int i) return new PositiveInt(i); // è§¦å‘æ„é€ å‡½æ•°çš„æ ¡éªŒé€»è¾‘ // éšå¼è½¬æ¢ï¼šPositiveInt - intï¼ˆå®‰å…¨ï¼šValue å·²ç¡®ä¿æ˜¯æ­£æ•°ï¼‰ public static implicit operator int(PositiveInt pi) = pi.Value; // ä½¿ç”¨ç¤ºä¾‹ int validNum = 100; PositiveInt pi1 = (PositiveInt)validNum; // æ˜¾å¼è½¬æ¢ï¼ŒæˆåŠŸï¼ˆç»“æœï¼š100ï¼‰ int num1 = pi1; // éšå¼è½¬æ¢ï¼ŒæˆåŠŸï¼ˆç»“æœï¼š100ï¼‰ int invalidNum = -5; try PositiveInt pi2 = (PositiveInt)invalidNum; // æ˜¾å¼è½¬æ¢ï¼ŒæŠ›å¼‚å¸¸ catch (ArgumentOutOfRangeException ex) Console.WriteLine(ex.Message); // è¾“å‡ºï¼šå¿…é¡»æ˜¯æ­£æ•° å››ã€æ ¸å¿ƒè§„åˆ™ä¸é™åˆ¶è½¬æ¢æ“ä½œç¬¦æœ‰ä¸¥æ ¼çš„è¯­æ³•å’Œé€»è¾‘é™åˆ¶ï¼Œè¿åä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼š **å¿…é¡»æ˜¯ public static**ï¼šä¸èƒ½æ˜¯å®ä¾‹æ–¹æ³•ã€è™šæ–¹æ³•ï¼ˆvirtualï¼‰æˆ–é‡å†™ï¼ˆoverrideï¼‰ï¼› ä¸èƒ½é‡å®šä¹‰é¢„å®šä¹‰è½¬æ¢ï¼šæ¯”å¦‚ä¸èƒ½é‡æ–°å®šä¹‰ int è½¬ longã€string è½¬ object ç­‰ç³»ç»Ÿå·²æœ‰çš„è½¬æ¢ï¼› åŒä¸€æ–¹å‘ä»…å…è®¸ä¸€ç§è½¬æ¢ï¼šä¸èƒ½åŒæ—¶å®šä¹‰â€œA éšå¼è½¬ Bâ€å’Œâ€œA æ˜¾å¼è½¬ Bâ€ï¼Œä¼šå¯¼è‡´ç¼–è¯‘æ­§ä¹‰ï¼› éšå¼è½¬æ¢å¿…é¡»å®‰å…¨ï¼šé€»è¾‘ä¸­ä¸èƒ½æŠ›å¼‚å¸¸ã€ä¸èƒ½ä¸¢å¤±æ•°æ®ï¼ˆå¦åˆ™ä¼šè®©è°ƒç”¨è€…æ„å¤–å‡ºé”™ï¼‰ï¼› é¿å…å¾ªç¯è½¬æ¢ï¼šæ¯”å¦‚ A éšå¼è½¬ Bï¼ŒB åˆéšå¼è½¬ Aï¼Œä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯æˆ–è¿è¡Œæ—¶æ­§ä¹‰ï¼› **å¼•ç”¨ç±»å‹éœ€å¤„ç† null**ï¼šå¦‚æœæºç±»å‹æ˜¯å¼•ç”¨ç±»å‹ï¼ˆclassï¼‰ï¼Œè½¬æ¢é€»è¾‘ä¸­è¦é¿å… NullReferenceExceptionï¼ˆå¦‚ä¸‹ç¤ºä¾‹ï¼‰ï¼š public class MyString public string Value get; public MyString(string value) = Value = value ?? throw new ArgumentNullException(); // éšå¼è½¬æ¢ï¼šMyString - stringï¼ˆå¤„ç† null æºå¯¹è±¡ï¼‰ public static implicit operator string(MyString ms) = ms?.Value; // ä½¿ç”¨ï¼šæºå¯¹è±¡ä¸º null æ—¶ä¸ä¼šæŠ›å¼‚å¸¸ MyString ms = null; string s = ms; // s ä¸º nullï¼Œæ— å¼‚å¸¸ äº”ã€å¸¸è§ä½¿ç”¨åœºæ™¯ è‡ªå®šä¹‰å€¼ç±»å‹ï¼ˆç»“æ„ä½“ï¼‰ï¼šå¦‚åæ ‡ï¼ˆPointï¼‰ã€é‡‘é¢ï¼ˆMoneyï¼‰ã€æ¸©åº¦ï¼ˆTemperatureï¼‰ï¼Œéœ€ä¸ intdouble æˆ–å…¶ä»–è‡ªå®šä¹‰ç±»å‹è½¬æ¢ï¼› ä¸šåŠ¡å¯¹è±¡ç®€åŒ–ï¼šå¦‚ UserIdï¼ˆå­—ç¬¦ä¸²åŒ…è£…ç±»ï¼‰ä¸ string è½¬æ¢ï¼Œé¿å…ç›´æ¥ä½¿ç”¨åŸå§‹ç±»å‹å¯¼è‡´çš„æ ¼å¼é”™è¯¯ï¼› ç±»å‹é€‚é…ï¼šå¦‚ç¬¬ä¸‰æ–¹åº“çš„ç±»å‹ä¸è‡ªå®šä¹‰ä¸šåŠ¡ç±»å‹çš„è½¬æ¢ï¼Œè®©ä»£ç æ›´ç®€æ´ã€‚ å…­ã€æ³¨æ„äº‹é¡¹ é¿å…æ»¥ç”¨éšå¼è½¬æ¢ï¼šå¦‚æœè½¬æ¢å­˜åœ¨æ½œåœ¨é£é™©ï¼ˆå³ä½¿æ¦‚ç‡ä½ï¼‰ï¼Œä¼˜å…ˆç”¨æ˜¾å¼è½¬æ¢ï¼Œè®©è°ƒç”¨è€…æ˜ç¡®é£é™©ï¼› è½¬æ¢é€»è¾‘è¦å•ä¸€ï¼šè½¬æ¢æ“ä½œç¬¦ä»…è´Ÿè´£â€œç±»å‹è½¬æ¢â€ï¼Œä¸å»ºè®®åœ¨å…¶ä¸­åŒ…å«å¤æ‚ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚æ•°æ®æŒä¹…åŒ–ã€ç½‘ç»œè¯·æ±‚ï¼‰ï¼› å¼‚å¸¸è¯´æ˜ï¼šæ˜¾å¼è½¬æ¢è‹¥å¯èƒ½æŠ›å¼‚å¸¸ï¼Œéœ€åœ¨æ³¨é‡Šæˆ–æ–‡æ¡£ä¸­è¯´æ˜å¼‚å¸¸ç±»å‹ï¼ˆå¦‚ ArgumentOutOfRangeExceptionï¼‰ï¼› ä¸ as è¿ç®—ç¬¦åŒºåˆ†ï¼šas ä»…é€‚ç”¨äºå¼•ç”¨ç±»å‹ï¼Œå®‰å…¨è½¬æ¢å¤±è´¥è¿”å› nullï¼›æ˜¾å¼è½¬æ¢æ“ä½œç¬¦å¯ç”¨äºå€¼ç±»å‹ï¼Œå¤±è´¥å¯èƒ½æŠ›å¼‚å¸¸ã€‚ æ€»ç»“è½¬æ¢å¼æ“ä½œç¬¦æ˜¯ C# ä¸­è‡ªå®šä¹‰ç±»å‹è½¬æ¢çš„æ ¸å¿ƒç‰¹æ€§ï¼Œæ ¸å¿ƒä»·å€¼æ˜¯è®©ç±»å‹è½¬æ¢æ›´è‡ªç„¶ã€ä»£ç æ›´ç®€æ´ï¼š éšå¼è½¬æ¢ï¼šå®‰å…¨ã€è‡ªåŠ¨ï¼Œé€‚ç”¨äºæ— é£é™©åœºæ™¯ï¼› æ˜¾å¼è½¬æ¢ï¼šæœ‰é£é™©ã€æ‰‹åŠ¨ï¼Œé€‚ç”¨äºéœ€æ ¡éªŒæˆ–å¯èƒ½ä¸¢å¤±æ•°æ®çš„åœºæ™¯ï¼› éµå¾ªâ€œå®‰å…¨ä¼˜å…ˆã€é€»è¾‘å•ä¸€â€åŸåˆ™ï¼Œé¿å…è¿åè§„åˆ™å¯¼è‡´çš„ç¼–è¯‘é”™è¯¯æˆ–è¿è¡Œæ—¶æ„å¤–ã€‚ é€šè¿‡åˆç†ä½¿ç”¨è½¬æ¢æ“ä½œç¬¦ï¼Œå¯è®©è‡ªå®šä¹‰ç±»å‹å…·å¤‡ä¸åŸºç¡€ç±»å‹ä¸€è‡´çš„æ˜“ç”¨æ€§ï¼ŒåŒæ—¶ä¿è¯ä¸šåŠ¡é€»è¾‘çš„ä¸¥è°¨æ€§ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"C sharpå…¥é—¨ç¬”è®°","path":"/2025/11/17/2-ç¼–ç¨‹è¯­è¨€-CSharp-C-sharpå…¥é—¨ç¬”è®°/","content":"é‡è¦åŠŸèƒ½ å¸ƒå°”æ¡ä»¶ è‡ªåŠ¨åƒåœ¾å›æ”¶ æ ‡å‡†åº“ ç»„ä»¶ç‰ˆæœ¬ å±æ€§ äº‹ä»¶ å§”æ‰˜ å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡ä»£ä¸€ç»„å…·æœ‰ç»Ÿä¸€å‡½æ•°å‚æ•°å’Œè¿”å›ç±»å‹çš„å‡½æ•° äº‹ä»¶ç®¡ç† æ³›å‹ å°†æ•°æ®ç±»å‹ä¹Ÿä½œä¸ºå‚æ•°è¿›è¡Œä½¿ç”¨ ç´¢å¼•å™¨ æ¡ä»¶ç¼–è¯‘ å¤šçº¿ç¨‹ LINQ lambda è¡¨è¾¾å¼ åå°„ ä»£ç† å¤šæ€ åŒä¸€ç§è¡Œä¸ºçš„ä¸åŒå“åº”æ–¹å¼ï¼Œåˆ†ä¸ºé™æ€å’ŒåŠ¨æ€ .NET æ¡†æ¶C# æ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œè€Œ .NET æ˜¯ä¸€ä¸ªå¼€å‘å¹³å°å’Œè¿è¡Œæ—¶ç¯å¢ƒï¼Œ.Net æ¡†æ¶ç”±ä¸€ä¸ªå·¨å¤§çš„ä»£ç åº“ç»„æˆã€‚åŒ…å«ï¼š è¿è¡Œæ—¶ï¼ˆCLRï¼šCommon Language Runtimeï¼‰ ç®¡ç†å†…å­˜ï¼ˆåƒåœ¾å›æ”¶ï¼‰ ç®¡ç†çº¿ç¨‹ æ‰§è¡Œ IL ä¸­é—´è¯­è¨€ æä¾›ç±»åº“ åŸºç±»åº“ï¼ˆBCLï¼‰ æ–‡ä»¶è¯»å†™ï¼ˆSystem.IOï¼‰ ç½‘ç»œé€šä¿¡ï¼ˆSystem.Netï¼‰ å®¹å™¨ï¼ˆListã€Dictionaryï¼‰ åå°„ï¼ˆReflectionï¼‰å¼€å‘æ¡†æ¶ ASP.NETï¼ˆåš Webï¼‰ WinFormsã€WPFã€MAUIï¼ˆåšæ¡Œé¢ GUIï¼‰ Entity Frameworkï¼ˆåšæ•°æ®åº“ï¼‰ ç¨‹åºç»“æ„ å‘½ä»¤ç©ºé—´ namespace ï¼ˆç”¨äºåˆ†ç±»ä»£ç å¹¶é¿å…ç±»åã€æ¥å£åå†²çªï¼Œå¯ä»¥åµŒå¥—ï¼‰ ä½¿ç”¨ using å…³é”®å­— ä½¿ç”¨ . å…¨é¥°åç§° å‡½æ•°å…¥å£ Mainï¼ˆé¡¶çº§è¯­å¥ï¼‰ Class æ–¹æ³• Class å±æ€§æ•°æ®æˆå‘˜ å˜é‡ä½œç”¨åŸŸ å±€éƒ¨å˜é‡ å…¨å±€å˜é‡ static å˜é‡ æ•°æ®ç±»å‹ å€¼ç±»å‹ å¼•ç”¨ç±»å‹ æŒ‡å‘å†…å­˜ä½ç½®ï¼Œä¸åŒ…å«å­˜å‚¨åœ¨å˜é‡ä¸­çš„å®é™…æ•°æ®ï¼ŒåŒ…å«å¯¹å˜é‡çš„å¼•ç”¨ object ç±»å‹ dynamic ç±»å‹ï¼ˆåœ¨è¿è¡Œæ—¶æ¨æ–­å˜é‡çš„ç±»å‹ï¼‰ string ç±»å‹ æŒ‡é’ˆç±»å‹ å¸¸é‡ï¼ˆconstï¼‰ class ç±»å‹ï¼ˆtypeof (ç±»å˜é‡)è¿”å› class ç±»å‹ï¼‰ å¯ç©ºç±»å‹ï¼ˆå€¼å¼•ç”¨ï¼‰ ? è®©å€¼ç±»å‹å¯ä»¥ä¸ºÂ nullã€‚ int? x; Nullableint x = null;// é»˜è®¤å€¼ä¸º null ?? å½“å·¦ä¾§çš„å€¼ä¸º null æ—¶ï¼Œ?? è¿”å›å³ä¾§çš„é»˜è®¤å€¼ int result = i ?? 0; ç±»å‹è½¬æ¢ éšå¼ç±»å‹è½¬æ¢ ç¼–è¯‘å™¨è‡ªåŠ¨è¿›è¡Œï¼Œä»å°çš„æ•°æ®èŒƒå›´åˆ°å¤§çš„æ•°æ®èŒƒå›´ï¼Œä¸ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œä¾‹å¦‚ä»å°çš„æ•´æ•°ç±»å‹è½¬æ¢ä¸ºå¤§çš„æ•´æ•°ç±»å‹ï¼Œä»æ´¾ç”Ÿç±»è½¬æ¢ä¸ºåŸºç±» æ˜¾å¼ç±»å‹è½¬æ¢ éœ€è¦è¿›è¡Œç±»å‹è½¬æ¢çš„å…¼å®¹æ€§æ£€æŸ¥å’Œç±»å‹è½¬æ¢çš„å®‰å…¨æ€§æ£€æŸ¥ æ“ä½œç¬¦ is åˆ¤æ–­ æ“ä½œç¬¦ as å®‰å…¨ç±»å‹è½¬æ¢ï¼ˆè½¬æ¢å¤±è´¥ä¸º nullï¼‰ è‡ªå®šä¹‰ç±»å‹è½¬æ¢ å…³é”®å­— implicit éšå¼è½¬æ¢ å…³é”®å­— explicit æ˜¾å¼è½¬æ¢ æ•°ç»„ å£°æ˜ int[] array; åˆå§‹åŒ– array = new int[10]; èµ‹å€¼ array[0] = 1; è®¿é—® array[0]; å¤šç»´æ•°ç»„ int[,,] array;//ä¸‰ç»´æ•°ç»„ äº¤é”™æ•°ç»„ int[][] array = new int[5][]; array[0] = new int[2]; ä¼ é€’æ•°ç»„ç»™å‡½æ•° å‚æ•°æ•°ç»„ params å…³é”®å­— Array ç±» è¯­å¥åˆ¤æ–­ if è¯­å¥ switch è¯­å¥ ?. ç”¨äºè®¿é—®æˆå‘˜ï¼ˆå±æ€§ã€æ–¹æ³•ã€å­—æ®µï¼‰a?.fun()ï¼Œä¸å­˜åœ¨ fun()åˆ™è¿”å› null ?[] ç”¨äºè®¿é—®ç´¢å¼•å™¨æˆ–æ•°ç»„å…ƒç´  array?[10] ?: æ¡ä»¶åˆ¤æ–­ Exp1 ? Exp2 : Exp3; å¾ªç¯ while forforeach doâ€¦while break continue æ–¹æ³• é€’å½’è°ƒç”¨ å‚æ•°ä¼ é€’ å€¼ä¼ é€’ å¼•ç”¨ä¼ é€’ï¼ˆrefï¼‰ è¾“å‡ºä¼ é€’ï¼ˆoutï¼‰ æ‰©å±•æ–¹æ³• ï¼Œå¿…é¡»æ˜¯é™æ€çš„ï¼Œå¿…é¡»åœ¨é™æ€ç±»ä¸­å®šä¹‰ å°è£… publicï¼šæ‰€æœ‰å¯¹è±¡éƒ½å¯ä»¥è®¿é—®ï¼› privateï¼šå¯¹è±¡æœ¬èº«åœ¨å¯¹è±¡å†…éƒ¨å¯ä»¥è®¿é—®ï¼› protectedï¼šåªæœ‰è¯¥ç±»å¯¹è±¡åŠå…¶å­ç±»å¯¹è±¡å¯ä»¥è®¿é—® internalï¼šåŒä¸€ä¸ªç¨‹åºé›†ï¼ˆexe æˆ– dllï¼‰çš„å¯¹è±¡å¯ä»¥è®¿é—®ï¼› protected internalï¼šè®¿é—®é™äºå½“å‰ç¨‹åºé›†æˆ–æ´¾ç”Ÿè‡ªåŒ…å«ç±»çš„ç±»å‹ã€‚ ç»§æ‰¿ ä¸€ä¸ªç±»å¯ä»¥ç»§æ‰¿è‡ªå¦ä¸€ä¸ªç±»ï¼Œè¢«ç§°ä¸ºåŸºç±»ï¼ˆçˆ¶ç±»ï¼‰å’Œæ´¾ç”Ÿç±»ï¼ˆå­ç±»ï¼‰ ä¸€ä¸ªç±»å¯ä»¥ç»§æ‰¿å¤šä¸ªæ¥å£ï¼Œä½†åªèƒ½ç»§æ‰¿è‡ªä¸€ä¸ªç±»ã€‚ å…³é”®å­— baseï¼Œè°ƒç”¨åŸºç±»çš„æ„é€ å‡½æ•°å’Œæ–¹æ³• å¤šæ€ å¤šæ€å°±æ˜¯åŒä¸€ä¸ªæ¥å£ï¼Œä½¿ç”¨ä¸åŒçš„å®ä¾‹è€Œæ‰§è¡Œä¸åŒæ“ä½œ overload åœ¨é™æ€å¤šæ€æ€§ä¸­ï¼Œå‡½æ•°çš„å“åº”æ˜¯åœ¨ç¼–è¯‘æ—¶å‘ç”Ÿçš„ã€‚ å‡½æ•°é‡è½½ï¼ŒåŒä¸€ä¸ªèŒƒå›´å†…å¯¹ç›¸åŒçš„å‡½æ•°åæœ‰å¤šä¸ªå®šä¹‰ï¼ˆå‚æ•°ç±»å‹æˆ–ä¸ªæ•°ä¸åŒï¼Œä¸è¿”å›ç±»å‹æ— å…³ï¼‰ æ“ä½œç¬¦é‡è½½ï¼ŒpublicÂ staticÂ BoxÂ operator+Â (Box b, Box c) override åœ¨åŠ¨æ€å¤šæ€æ€§ä¸­ï¼Œå‡½æ•°çš„å“åº”æ˜¯åœ¨è¿è¡Œæ—¶å‘ç”Ÿçš„ã€‚ abstract æŠ½è±¡ç±» abstractÂ classÂ Shape virtual å½“æœ‰ä¸€ä¸ªå®šä¹‰åœ¨ç±»ä¸­çš„å‡½æ•°éœ€è¦åœ¨ç»§æ‰¿ç±»ä¸­å®ç°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è™šæ–¹æ³• ç±»å’Œç»“æ„ç»“æ„ä½“ ç»“æ„å¯å¸¦æœ‰æ–¹æ³•ã€å­—æ®µã€ç´¢å¼•ã€å±æ€§ã€è¿ç®—ç¬¦æ–¹æ³•å’Œäº‹ä»¶ï¼Œç”¨äºè¡¨ç¤ºè½»é‡çº§æ•°æ®ã€‚ ç»“æ„å¯å®šä¹‰æ„é€ å‡½æ•°ï¼Œä½†ä¸èƒ½å®šä¹‰ææ„å‡½æ•°ã€‚ä½†ä¸èƒ½ä¸ºç»“æ„å®šä¹‰æ— å‚æ„é€ å‡½æ•°ã€‚æ— å‚æ„é€ å‡½æ•°(é»˜è®¤)æ˜¯è‡ªåŠ¨å®šä¹‰çš„ï¼Œä¸”ä¸èƒ½è¢«æ”¹å˜ã€‚ ç»“æ„ä¸èƒ½ç»§æ‰¿å…¶ä»–çš„ç»“æ„æˆ–ç±»ï¼Œä¹Ÿä¸èƒ½ä½œä¸ºå…¶ä»–ç»“æ„æˆ–ç±»çš„åŸºç¡€ç»“æ„ï¼ˆä¸èƒ½è¢«ç»§æ‰¿ï¼‰ã€‚ ç»“æ„å¯ä»¥ç»§æ‰¿æ¥å£ï¼Œå¯å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ã€‚ ç»“æ„æˆå‘˜ä¸èƒ½æŒ‡å®šä¸º abstractã€virtual æˆ– protectedã€‚ å½“ä½¿ç”¨Â NewÂ æ“ä½œç¬¦åˆ›å»ºä¸€ä¸ªç»“æ„å¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨é€‚å½“çš„æ„é€ å‡½æ•°æ¥åˆ›å»ºç»“æ„ã€‚ä¸ç±»ä¸åŒï¼Œç»“æ„å¯ä»¥ä¸ä½¿ç”¨ New æ“ä½œç¬¦å³å¯è¢«å®ä¾‹åŒ–ã€‚å¦‚æœä¸ä½¿ç”¨ New æ“ä½œç¬¦ï¼Œåªæœ‰åœ¨æ‰€æœ‰çš„å­—æ®µéƒ½è¢«åˆå§‹åŒ–ä¹‹åï¼ˆæ˜¾ç¤ºèµ‹å€¼ï¼Œé˜²æ­¢æœªåˆå§‹åŒ–çš„å­—æ®µä½¿ç”¨ï¼‰ï¼Œå­—æ®µæ‰è¢«èµ‹å€¼ï¼Œå¯¹è±¡æ‰è¢«ä½¿ç”¨ã€‚ ç»“æ„å˜é‡é€šå¸¸åˆ†é…åœ¨æ ˆä¸Šï¼Œè¿™ä½¿å¾—å®ƒä»¬çš„åˆ›å»ºå’Œé”€æ¯é€Ÿåº¦æ›´å¿«ã€‚ä½†æ˜¯ï¼Œå¦‚æœå°†ç»“æ„ç”¨ä½œç±»çš„å­—æ®µï¼Œä¸”è¿™ä¸ªç±»æ˜¯å¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆç»“æ„å°†å­˜å‚¨åœ¨å †ä¸Šã€‚ ç»“æ„é»˜è®¤æƒ…å†µä¸‹æ˜¯å¯å˜çš„ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥ä¿®æ”¹å®ƒä»¬çš„å­—æ®µã€‚ä½†æ˜¯ï¼Œå¦‚æœç»“æ„å®šä¹‰ä¸ºåªè¯»ï¼Œé‚£ä¹ˆå®ƒçš„å­—æ®µå°†æ˜¯ä¸å¯å˜çš„ã€‚ ç±» æ„é€ å‡½æ•°ä¸ç±»çš„åç§°å®Œå…¨ç›¸åŒï¼Œå®ƒæ²¡æœ‰ä»»ä½•è¿”å›ç±»å‹ã€‚ ææ„å‡½æ•°åœ¨ç±»çš„åç§°å‰åŠ ä¸Š ~ï¼Œæ— è¿”å›å€¼ï¼Œå‚æ•°ã€‚ææ„å‡½æ•°ç”¨äºåœ¨ç»“æŸç¨‹åºï¼ˆæ¯”å¦‚å…³é—­æ–‡ä»¶ã€é‡Šæ”¾å†…å­˜ç­‰ï¼‰ä¹‹å‰é‡Šæ”¾èµ„æºã€‚ææ„å‡½æ•°ä¸èƒ½ç»§æ‰¿æˆ–é‡è½½ é™æ€æˆå‘˜ï¼Œå£°æ˜ä¸€ä¸ªç±»æˆå‘˜ä¸ºé™æ€æ—¶ï¼Œæ„å‘³ç€æ— è®ºæœ‰å¤šå°‘ä¸ªç±»çš„å¯¹è±¡è¢«åˆ›å»ºï¼Œåªä¼šæœ‰ä¸€ä¸ªè¯¥é™æ€æˆå‘˜çš„å‰¯æœ¬ï¼Œå¯ä»¥é€šè¿‡ç›´æ¥è°ƒç”¨ç±»è€Œä¸éœ€è¦åˆ›å»ºç±»çš„å®ä¾‹æ¥è·å– åŒºåˆ«å€¼ç±»å‹ vs å¼•ç”¨ç±»å‹ï¼š ç»“æ„æ˜¯å€¼ç±»å‹ï¼ˆValue Typeï¼‰ï¼šÂ åœ¨æ ˆä¸Šåˆ†é…å†…å­˜ã€‚ä¼ é€’ç»™æ–¹æ³•æˆ–èµ‹å€¼æ—¶ï¼Œæ‰§è¡Œæ·±æ‹·è´ã€‚ ç±»æ˜¯å¼•ç”¨ç±»å‹ï¼ˆReference Typeï¼‰ï¼šÂ åœ¨å †ä¸Šåˆ†é…å†…å­˜ã€‚ä¼ é€’ç»™æ–¹æ³•æˆ–èµ‹å€¼æ—¶ï¼Œæ‰§è¡Œæµ…æ‹·è´ ç»§æ‰¿å’Œå¤šæ€æ€§ï¼š ç»“æ„ä¸èƒ½ç»§æ‰¿ï¼šÂ ç»“æ„ä¸èƒ½ç»§æ‰¿å…¶ä»–ç»“æ„æˆ–ç±»ï¼Œä¹Ÿä¸èƒ½ä½œä¸ºå…¶ä»–ç»“æ„æˆ–ç±»çš„åŸºç±»ã€‚ ç±»æ”¯æŒç»§æ‰¿ï¼šÂ ç±»æ”¯æŒç»§æ‰¿å’Œå¤šæ€æ€§ï¼Œå¯ä»¥é€šè¿‡æ´¾ç”Ÿæ–°ç±»æ¥æ‰©å±•ç°æœ‰ç±»çš„åŠŸèƒ½ã€‚ é»˜è®¤æ„é€ å‡½æ•°ï¼š ç»“æ„ä¸èƒ½æœ‰æ— å‚æ•°çš„æ„é€ å‡½æ•° ç±»å¯ä»¥æœ‰æ— å‚æ•°çš„æ„é€ å‡½æ•° èµ‹å€¼è¡Œä¸ºï¼š ç±»å‹ä¸ºç±»çš„å˜é‡åœ¨èµ‹å€¼æ—¶å­˜å‚¨çš„æ˜¯å¼•ç”¨ï¼Œå› æ­¤ä¸¤ä¸ªå˜é‡æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚ ç»“æ„å˜é‡åœ¨èµ‹å€¼æ—¶ä¼šå¤åˆ¶æ•´ä¸ªç»“æ„ï¼Œå› æ­¤æ¯ä¸ªå˜é‡éƒ½æœ‰è‡ªå·±çš„ç‹¬ç«‹å‰¯æœ¬ã€‚ ä¼ é€’æ–¹å¼ï¼š ç±»å¯¹è±¡åœ¨æ–¹æ³•è°ƒç”¨æ—¶é€šè¿‡å¼•ç”¨ä¼ é€’ï¼Œåœ¨æ–¹æ³•ä¸­å¯¹å¯¹è±¡æ‰€åšçš„æ›´æ”¹ä¼šå½±å“åˆ°åŸå§‹å¯¹è±¡ã€‚ ç»“æ„å¯¹è±¡é€šè¿‡å€¼ä¼ é€’ï¼Œä¼ é€’çš„æ˜¯ç»“æ„çš„å‰¯æœ¬ã€‚åœ¨æ–¹æ³•ä¸­å¯¹ç»“æ„æ‰€åšçš„æ›´æ”¹ä¸å½±å“åŸå§‹å¯¹è±¡ å¯ç©ºæ€§ï¼š ç»“æ„ä½“æ˜¯å€¼ç±»å‹ï¼Œä¸èƒ½ç›´æ¥è®¾ç½®ä¸ºÂ nullï¼š å¯ä»¥ä½¿ç”¨Â NullableTÂ æˆ–ç§°ä¸ºÂ T?Â çš„å¯ç©ºç±»å‹ ç±»æ˜¯å¼•ç”¨ç±»å‹ï¼Œå¯ä¸º null æ€§èƒ½å’Œå†…å­˜åˆ†é…ï¼š ç»“æ„é€šå¸¸æ›´è½»é‡ï¼šÂ å€¼ç±»å‹ä¸”åœ¨æ ˆä¸Šåˆ†é…å†…å­˜ï¼Œæ¯”ç±»æ›´è½»é‡ï¼Œé€‚ç”¨äºç®€å•çš„æ•°æ®è¡¨ç¤ºã€‚ ç±»å¯èƒ½æœ‰æ›´å¤šå¼€é”€ï¼šÂ ç”±äºç±»æ˜¯å¼•ç”¨ç±»å‹ï¼Œå¯èƒ½æ¶‰åŠæ›´å¤šçš„å†…å­˜å¼€é”€å’Œç®¡ç†ã€‚ æ¥å£ æ¥å£å®šä¹‰ interface IMyInterface å¦‚æœä¸€ä¸ªæ¥å£ç»§æ‰¿å…¶ä»–æ¥å£ï¼Œé‚£ä¹ˆå®ç°ç±»æˆ–ç»“æ„å°±éœ€è¦å®ç°æ‰€æœ‰æ¥å£çš„æˆå‘˜ å¼‚å¸¸å¤„ç† tryï¼šä¸€ä¸ª try å—æ ‡è¯†äº†ä¸€ä¸ªå°†è¢«æ¿€æ´»çš„ç‰¹å®šçš„å¼‚å¸¸çš„ä»£ç å—ã€‚åè·Ÿä¸€ä¸ªæˆ–å¤šä¸ª catch å—ã€‚ catchï¼šç¨‹åºé€šè¿‡å¼‚å¸¸å¤„ç†ç¨‹åºæ•è·å¼‚å¸¸ã€‚catch å…³é”®å­—è¡¨ç¤ºå¼‚å¸¸çš„æ•è·ã€‚ finallyï¼šfinally å—ç”¨äºæ‰§è¡Œç»™å®šçš„è¯­å¥ï¼Œä¸ç®¡å¼‚å¸¸æ˜¯å¦è¢«æŠ›å‡ºéƒ½ä¼šæ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸ç®¡æ˜¯å¦å‡ºç°å¼‚å¸¸æ–‡ä»¶éƒ½è¦è¢«å…³é—­ã€‚ throwï¼šå½“é—®é¢˜å‡ºç°æ—¶ï¼Œç¨‹åºæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚ä½¿ç”¨ throw å…³é”®å­—æ¥å®Œæˆã€‚ ç”¨æˆ·è‡ªå®šä¹‰çš„å¼‚å¸¸ç±»æ˜¯æ´¾ç”Ÿè‡ªÂ ApplicationExceptionÂ ç±»ï¼Œeg publicÂ classÂ TempIsZeroException:Â ApplicationException publicÂ TempIsZeroException(stringÂ message):Â base(message) //ä½¿ç”¨æ—¶throwÂ (newÂ TempIsZeroException(Zero Temperature found)); æ–‡ä»¶ IO System.IO å‘½åç©ºé—´æœ‰å„ç§ä¸åŒçš„ç±»ï¼Œç”¨äºæ‰§è¡Œå„ç§æ–‡ä»¶æ“ä½œï¼Œå¦‚åˆ›å»ºå’Œåˆ é™¤æ–‡ä»¶ã€è¯»å–æˆ–å†™å…¥æ–‡ä»¶ï¼Œå…³é—­æ–‡ä»¶ç­‰ æ–‡æœ¬æ–‡ä»¶ StreamReader å’Œ StreamWriter äºŒè¿›åˆ¶æ–‡ä»¶ BinaryReader å’Œ BinaryWriter æ–‡ä»¶å’Œç›®å½• FileInfo å’Œ DirectoryInfo ç‰¹æ€§ ç”¨äºæ·»åŠ å…ƒæ•°æ®ï¼Œé™„åŠ åˆ°ä»£ç ä¸Šçš„æè¿°ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªç±»ï¼Œç»§æ‰¿è‡ª System.Attribute å¯ä»¥é™„åŠ åˆ°ç±»ã€æ–¹æ³•ã€å±æ€§ã€å­—æ®µç­‰ è¯­æ³• [attribute(positional_parameters, name_parameter = value, ...)]element å¸¸ç”¨ç‰¹æ€§ //1.ç¼–è¯‘å™¨æ§åˆ¶[Obsolete] æ ‡è®°æ–¹æ³•æˆ–ç±»è¿‡æ—¶ï¼Œç¼–è¯‘å™¨æç¤º\t[Obsolete( message, //æè¿°é¡¹ç›®ä¸ºä»€ä¹ˆè¿‡æ—¶ä»¥åŠè¯¥æ›¿ä»£ä½¿ç”¨ä»€ä¹ˆ iserror //å¦‚æœè¯¥å€¼ä¸º trueï¼Œç¼–è¯‘å™¨åº”æŠŠè¯¥é¡¹ç›®çš„ä½¿ç”¨å½“ä½œerrorï¼Œé»˜è®¤ä¸ºwarning\t)][Conditional]\tç±»å’Œæ–¹æ³•çš„æ¡ä»¶ç¼–è¯‘ç‰¹æ€§\t[Conditional(DEBUG)] //ä»…åœ¨Debugæ¡ä»¶ä¸‹ç¼–è¯‘//2.åºåˆ—åŒ–å’Œååºåˆ—åŒ–[Serializable]\tæ ‡è®°ç±»å¯è¢«åºåˆ—åŒ–[NonSerialized]\tæ ‡è®°å­—æ®µä¸å‚ä¸åºåˆ—åŒ–//3.åå°„è·å–æ–¹æ³•æè¿°ï¼Œæƒé™ç­‰//4.æ¡†æ¶çº¦å®š[Route] [HttpGet]//5.å¤–éƒ¨è°ƒç”¨[DllImport] è°ƒç”¨å¤–éƒ¨ DLL å‡½æ•°//6.è‡ªå®šä¹‰[AttributeUsage]\tå®šä¹‰è‡ªå®šä¹‰ç‰¹æ€§çš„ä½¿ç”¨èŒƒå›´\t[AttributeUsage( //å®šä¹‰ç‰¹æ€§æ—¶ï¼Œå¯ä»¥æ§åˆ¶ç‰¹æ€§çš„ä½¿ç”¨èŒƒå›´å’Œè¡Œä¸ºAttributeUsage validon, //AttributeTargetså¯ä»¥ä¿®é¥°çš„ç›®æ ‡ï¼ˆClassã€Methodã€Propertyâ€¦ï¼‰ AllowMultiple=allowmultiple, //boolï¼Œæ˜¯å¦å…è®¸åŒä¸€ä¸ªç›®æ ‡å¤šæ¬¡ä½¿ç”¨ç‰¹æ€§ Inherited=inherited //boolï¼Œæ´¾ç”Ÿç±»æ˜¯å¦ç»§æ‰¿ç‰¹æ€§\t)] åå°„ åœºæ™¯ æè¿° åŠ¨æ€åˆ›å»ºå¯¹è±¡ é…ç½®é©±åŠ¨ç±»å®ä¾‹åŒ– å‘ç°ç±»å‹ æ’ä»¶ç³»ç»Ÿã€è‡ªåŠ¨æ³¨å†Œã€IOC å»¶è¿Ÿç»‘å®šæ–¹æ³• è„šæœ¬ã€åŠ¨æ€è°ƒç”¨ å±æ€§è¯»å†™ JSONORMåºåˆ—åŒ–å™¨ Attribute é©±åŠ¨ MVCã€æµ‹è¯•æ¡†æ¶ã€DI åŠ è½½ DLL æ’ä»¶ç³»ç»Ÿ æ„é€ å‡½æ•°ä¾èµ–æ³¨å…¥ IOC å®¹å™¨ Reflection.Emit è¿è¡Œæ—¶ç”Ÿæˆç±»å‹ã€AOPã€ä»£ç† å…ƒæ•°æ®ï¼Œç¨‹åºæœ¬èº«ä¹Ÿæ˜¯æ•°æ®ï¼Œæœ‰å…³ç¨‹åºåŠå…¶ç±»å‹çš„æ•°æ®è¢«ç§°ä¸ºå…ƒæ•°æ® ç‰¹æ€§æ˜¯å…ƒæ•°æ®çš„ä¸€ç§ å…ƒæ•°æ®ä¿å­˜åœ¨ç¨‹åºçš„ç¨‹åºé›†ä¸­ Type ç±»è·å–ä¸€ä¸ªç±»çš„ public æˆå‘˜ åå°„ï¼šä¸€ä¸ªè¿è¡Œçš„ç¨‹åºæŸ¥çœ‹æœ¬èº«çš„å…ƒæ•°æ®æˆ–å…¶ä»–æ•°æ®é›†ä¸­çš„å…ƒæ•°æ®çš„è¡Œä¸º åå°„æŒ‡ç¨‹åºå¯ä»¥è®¿é—®ã€æ£€æµ‹å’Œä¿®æ”¹å®ƒæœ¬èº«çŠ¶æ€æˆ–è¡Œä¸ºçš„ä¸€ç§èƒ½åŠ›ã€‚ åœ¨è¿è¡Œæ—¶æŸ¥çœ‹ç‰¹æ€§ï¼ˆattributeï¼‰ä¿¡æ¯ã€‚ å®¡æŸ¥é›†åˆä¸­çš„å„ç§ç±»å‹ï¼Œä»¥åŠå®ä¾‹åŒ–è¿™äº›ç±»å‹ã€‚ å»¶è¿Ÿç»‘å®šçš„æ–¹æ³•å’Œå±æ€§ï¼ˆpropertyï¼‰ã€‚ åœ¨è¿è¡Œæ—¶åˆ›å»ºæ–°ç±»å‹ï¼Œç„¶åä½¿ç”¨è¿™äº›ç±»å‹æ‰§è¡Œä¸€äº›ä»»åŠ¡ã€‚ //é€šè¿‡åå°„å®ç°ç±»å‹å®¡æŸ¥å’Œå®ä¾‹åŒ–//è·å–ç¨‹åºé›†ä¸­æ‰€æœ‰çš„ç±»å‹var allTypes = Assembly.GetExecutingAssembly().GetTypes();//æ ¹æ®æŒ‡å®šçš„æ¡ä»¶è·å–ç±»å‹var pluginTypes = allTypes .Where(t = t.IsClass !t.IsAbstract typeof(IPlugin).IsAssignableFrom(t) t.GetCustomAttributePluginAttribute() != null t.GetConstructor(Type.EmptyTypes) != null );//åˆ›å»ºä¸€ä¸ªå®ä¾‹åˆ—è¡¨ListIPlugin plugins = new ListIPlugin();//æ ¹æ®è·å–åˆ°çš„ç±»å‹åˆ›å»ºå®ä¾‹foreach (var type in pluginTypes) var instance = (IPlugin)Activator.CreateInstance(type); plugins.Add(instance); //å»¶è¿Ÿç»‘å®šï¼Œæ ¹æ®å­—ç¬¦ä¸²åå­—ï¼Œåœ¨è¿è¡Œæ—¶æ‰¾åˆ°ä¸€ä¸ªç±»å‹çš„æ–¹æ³•è°ƒç”¨æˆ–å±æ€§è¯»å†™//å®šä¹‰ä¸€ä¸ªç±»public class MyClass public string Name get; set; public void Hello(string msg) Console.WriteLine($Name: msg); //è·å–ç±»çš„æˆå‘˜var type = typeof(MyClass);// å®ä¾‹åŒ–è¿™ä¸ªç±»var obj = Activator.CreateInstance(type);// è®¾ç½®å±æ€§ï¼ˆå»¶è¿Ÿç»‘å®šï¼‰var prop = type.GetProperty(Name);prop.SetValue(obj, ChatGPT);// è°ƒç”¨æ–¹æ³•ï¼ˆå»¶è¿Ÿç»‘å®šï¼‰var method = type.GetMethod(Hello);method.Invoke(obj, new object[] ä½ å¥½ï¼ ); //è¿è¡Œæ—¶åˆ›å»ºæ–°ç±»å‹å¹¶ä½¿ç”¨//åŠ¨æ€ç”Ÿæˆç±»ï¼ˆTypeBuilderï¼‰å’Œæ–¹æ³•ï¼ˆILGeneratorï¼‰//è¿è¡Œæ—¶åˆ›å»ºä¸€ä¸ªç±»ï¼šDynamicPerson:ä¸€ä¸ªå­—æ®µstring Name ä¸€ä¸ªæ–¹æ³•SayHello()//1. åˆ›å»ºç¨‹åºé›†å’Œæ¨¡å—var assemblyName = new AssemblyName(DynamicAssembly); var assemblyBuilder = AssemblyBuilder.DefineDynamicAssembly( assemblyName, AssemblyBuilderAccess.Run); var moduleBuilder = assemblyBuilder.DefineDynamicModule(MainModule);`//2. åˆ›å»ºæ–°ç±»å‹ ç±»var typeBuilder = moduleBuilder.DefineType(DynamicPerson, TypeAttributes.Public | TypeAttributes.Class);//3. æ·»åŠ å­—æ®µvar fieldBuilder = typeBuilder.DefineField(Name, typeof(string), FieldAttributes.Public);//4. æ·»åŠ æ–¹æ³•var methodBuilder = typeBuilder.DefineMethod(SayHello, MethodAttributes.Public, returnType: typeof(void), parameterTypes: Type.EmptyTypes);//5. ç”¨ IL ç¼–å†™æ–¹æ³•è¡Œä¸ºï¼švar il = methodBuilder.GetILGenerator(); il.EmitWriteLine(Hello from DynamicPerson!); // return il.Emit(OpCodes.Ret);//6. åˆ›å»ºæœ€ç»ˆç±»å‹var dynamicPersonType = typeBuilder.CreateType();//ä½¿ç”¨è¿™ä¸ªè¿è¡Œæ—¶åˆ›å»ºçš„ç±»//1. åˆ›å»ºå®ä¾‹var obj = Activator.CreateInstance(dynamicPersonType);//2. è®¾ç½®å­—æ®µdynamicPersonType.GetField(Name).SetValue(obj, Alice);//3. è°ƒç”¨æ–¹æ³•dynamicPersonType.GetMethod(SayHello).Invoke(obj, null);//è¿è¡Œè¾“å‡º`Hello from DynamicPerson!`//åœ¨ç¨‹åºè¿è¡Œä»¥ååˆ›å»ºäº†ä¸€ä¸ªç±»ï¼šclass DynamicPerson public string Name; public void SayHello() Console.WriteLine(Hello from DynamicPerson!); å±æ€§ ç±»å’Œç»“æ„ä½“ä¸­ç”¨äºå°è£…æ•°æ®çš„æˆå‘˜ï¼Œçœ‹ä½œæ˜¯å¯¹å­—æ®µçš„åŒ…è£…ï¼Œéšè—å­—æ®µçš„å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œé€šå¸¸ç”± get å’Œ set è®¿é—®å™¨ç»„æˆ åªè¯»å±æ€§ï¼Œçœç•¥ set è®¿é—®å™¨ åªå†™å±æ€§ï¼Œçœç•¥ get è®¿é—®å™¨ get å’Œ set ä¸­å¯ä»¥åŒ…å«è‡ªå®šä¹‰é€»è¾‘ï¼Œeg. å¯ä»¥å¢åŠ æ•°æ®éæ³•æ ¡éªŒ throw new ArgumentException(Name cannot be empty.); æŠ½è±¡å±æ€§ï¼ŒæŠ½è±¡ç±»å¯æ‹¥æœ‰æŠ½è±¡å±æ€§ï¼Œè¿™äº›å±æ€§åº”åœ¨æ´¾ç”Ÿç±»ä¸­è¢«å®ç° //æŠ½è±¡ç±»publicÂ abstractÂ classÂ Person //æŠ½è±¡å±æ€§\tpublicÂ abstractÂ stringÂ Name get;Â set; publicÂ abstractÂ intÂ Age get;Â set; //ç»§æ‰¿è‡ªæŠ½è±¡ç±»classÂ StudentÂ :Â Person // å£°æ˜è‡ªåŠ¨å®ç°çš„å±æ€§ publicÂ stringÂ Code get;Â set; =Â N.A; //å®ç°æŠ½è±¡å±æ€§\tpublicÂ overrideÂ stringÂ Name get;Â set; =Â N.A; publicÂ overrideÂ intÂ Age get;Â set; =Â 0; publicÂ overrideÂ stringÂ ToString() returnÂ $Code = Code, Name = Name, Age = Age; public class Rectangle\tprivate int wid; //ä¾èµ–å­—æ®µ public int Width get returnÂ wid; set widÂ =Â value; //çœç•¥å†™æ³• public int Height get; set; public int Area //å±æ€§æ˜¯å¯ä»¥è®¡ç®—çš„ï¼Œä¸ä¾èµ–äºå­—æ®µ get return Width * Height; ç´¢å¼•å™¨ å…è®¸ä¸€ä¸ªå¯¹è±¡å¯ä»¥åƒæ•°ç»„ä¸€æ ·ä½¿ç”¨ä¸‹æ ‡çš„æ–¹å¼è¿›è¡Œè®¿é—® ç´¢å¼•å™¨å®šä¹‰çš„æ—¶å€™ä¸å¸¦æœ‰åç§°ï¼Œä½†å¸¦æœ‰Â thisÂ å…³é”®å­—ï¼Œå®ƒæŒ‡å‘å¯¹è±¡å®ä¾‹ å°†ä¸€ä¸ªç±»å®šä¹‰ä¸ºä¸€ä¸ªç´¢å¼•å™¨æ—¶ï¼Œè¯¥ç±»çš„è¡Œä¸ºåƒä¸€ä¸ªæ•°ç»„ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡ä¸‹æ ‡è®¿é—®ç±»çš„æˆå‘˜ ç´¢å¼•å™¨çš„ç”Ÿå‘½ç±»ä¼¼äºå±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ get å’Œ set æ¥å®šä¹‰ç´¢å¼•å™¨ï¼Œå±æ€§è¿”å›è®¾ç½®ä¸€ä¸ªç‰¹å®šæˆå‘˜æ•°æ®ï¼Œç´¢å¼•å™¨è¿”å›è®¾ç½®å¯¹è±¡å®ä¾‹çš„ä¸€ä¸ªç‰¹å®šå€¼ element-type this[int index] // get è®¿é—®å™¨ get // è¿”å› index æŒ‡å®šçš„å€¼ // set è®¿é—®å™¨ set // è®¾ç½® index æŒ‡å®šçš„å€¼ é‡è½½ç´¢å¼•å™¨ç´¢å¼•å™¨ï¼ˆIndexerï¼‰å¯è¢«é‡è½½ã€‚ç´¢å¼•å™¨å£°æ˜çš„æ—¶å€™ä¹Ÿå¯å¸¦æœ‰å¤šä¸ªå‚æ•°ï¼Œä¸”æ¯ä¸ªå‚æ•°å¯ä»¥æ˜¯ä¸åŒçš„ç±»å‹ã€‚æ²¡æœ‰å¿…è¦è®©ç´¢å¼•å™¨å¿…é¡»æ˜¯æ•´å‹çš„ã€‚C# å…è®¸ç´¢å¼•å™¨å¯ä»¥æ˜¯å…¶ä»–ç±»å‹ï¼Œä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²ç±»å‹ã€‚ using System;namespace IndexerApplication class IndexedNames private string[] namelist = new string[size]; static public int size = 10; public IndexedNames() for (int i = 0; i size; i++) namelist[i] = N. A.; public int this[string name] get int index = 0; while(index size) if (namelist[index] == name) return index; index++; return index; static void Main(string[] args) IndexedNames names = new IndexedNames(); names[0] = Zara; names[1] = Riz; names[2] = Nuha; names[3] = Asif; names[4] = Davinder; names[5] = Sunil; names[6] = Rubic; // ä½¿ç”¨å¸¦æœ‰ int å‚æ•°çš„ç¬¬ä¸€ä¸ªç´¢å¼•å™¨ for (int i = 0; i IndexedNames.size; i++) Console.WriteLine(names[i]); // ä½¿ç”¨å¸¦æœ‰ string å‚æ•°çš„ç¬¬äºŒä¸ªç´¢å¼•å™¨ Console.WriteLine(names[Nuha]); Console.ReadKey(); å§”æ‰˜ ç±»å‹å®‰å…¨çš„å‡½æ•°æŒ‡é’ˆï¼Œåªæœ‰åŒ¹é…çš„æ–¹æ³•æ‰å¯ä»¥èµ‹å€¼ç»™å§”æ‰˜ï¼Œèµ‹å€¼åå…è®¸å°†æ–¹æ³•ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œå¸®åŠ©å®ç°äº‹ä»¶é©±åŠ¨çš„ç¼–ç¨‹ã€å›è°ƒæœºåˆ¶å’Œå‡½æ•°å¼ç¼–ç¨‹é£æ ¼ å­˜æœ‰å¯¹æŸä¸ªæ–¹æ³•çš„å¼•ç”¨çš„å¼•ç”¨ç±»å‹å˜é‡ï¼Œå¯åœ¨è¿è¡Œæ—¶è¢«æ”¹å˜ ç”¨äºäº‹ä»¶å¤„ç†ï¼Œå›è°ƒå‡½æ•°ï¼ŒLINQ ç­‰æ“ä½œ æ‰€æœ‰çš„å§”æ‰˜éƒ½ç»§æ‰¿è‡ª System.Delegate ç±» å§”æ‰˜å¯¹è±¡éœ€è¦é€šè¿‡ new å…³é”®å­—è¿›è¡Œåˆ›å»º å§”æ‰˜å¯¹è±¡å¯ä»¥é€šè¿‡ + è¿›è¡Œåˆå¹¶ï¼Œé€šè¿‡ - ç§»é™¤å§”æ‰˜ï¼Œåªç”¨åŒç±»å‹çš„å§”æ‰˜å¯ä»¥åˆå¹¶ å§”æ‰˜çš„å¤šæ’­ï¼Œä¸€ä¸ªå§”æ‰˜è¢«è°ƒç”¨æ—¶è¦è°ƒç”¨çš„æ–¹æ³•çš„è°ƒç”¨åˆ—è¡¨ï¼Œå¤šæ’­å§”æ‰˜ï¼ˆMulticast Delegateï¼‰è°ƒç”¨é¡ºåºæ˜¯ä¸¥æ ¼æŒ‰ç…§æ·»åŠ é¡ºåºæ‰§è¡Œçš„ å§”æ‰˜å¸¸å¸¸å’Œäº‹ä»¶ä¸€èµ·ä½¿ç”¨ï¼Œäº‹ä»¶æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å§”æ‰˜ äº‹ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå°è£…äº†å§”æ‰˜çš„ç±»å‹ï¼Œç”¨äºå“åº”ç¨‹åºä¸­çš„æŸäº›æ“ä½œ å¼‚æ­¥è°ƒç”¨ï¼šå¯ä»¥å°†å§”æ‰˜ä¸ BeginInvoke å’Œ EndInvoke æ–¹æ³•ä¸€èµ·ä½¿ç”¨ï¼Œè¿›è¡Œå¼‚æ­¥è°ƒç”¨ å¯ä»¥ç”¨åŒ¿åæ–¹æ³•å’Œ lambda è¡¨è¾¾å¼åˆ›å»ºå§”æ‰˜ //å£°æ˜ä¸€ä¸ªå§”æ‰˜delegate int NumberChanger(int n);namespace DelegateAppl class TestDelegate static int num = 10; public static int AddNum(int p) num += p; return num; public static int MultNum(int p) num *= p; return num; static void Main(string[] args) // åˆ›å»ºå§”æ‰˜å®ä¾‹ NumberChanget nc; NumberChanger nc1 = new NumberChanger(AddNum); NumberChanger nc2 = new NumberChanger(MultNum); nc = nc1; nc += nc2; // ä½¿ç”¨å§”æ‰˜å¯¹è±¡è°ƒç”¨æ–¹æ³• nc(5);//è¾“å‡º75 å§”æ‰˜ä½œä¸ºå‚æ•°ä¼ é€’ using System;using System.IO;namespace DelegateAppl class PrintString static FileStream fs; static StreamWriter sw; // å§”æ‰˜å£°æ˜ public delegate void printString(string s); // è¯¥æ–¹æ³•æ‰“å°åˆ°æ§åˆ¶å° public static void WriteToScreen(string str) Console.WriteLine(The String is: 0, str); // è¯¥æ–¹æ³•æ‰“å°åˆ°æ–‡ä»¶ public static void WriteToFile(string s) fs = new FileStream(c:\\\\message.txt, FileMode.Append, FileAccess.Write); sw = new StreamWriter(fs); sw.WriteLine(s); sw.Flush(); sw.Close(); fs.Close(); // è¯¥æ–¹æ³•æŠŠå§”æ‰˜ä½œä¸ºå‚æ•°ï¼Œå¹¶ä½¿ç”¨å®ƒè°ƒç”¨æ–¹æ³• public static void sendString(printString ps) ps(Hello World); static void Main(string[] args) printString ps1 = new printString(WriteToScreen); printString ps2 = new printString(WriteToFile); sendString(ps1); sendString(ps2); Console.ReadKey(); å§”æ‰˜ç±»å‹ ç³»ç»Ÿå†…ç½®å§”æ‰˜å¯ä»¥çœå»å£°æ˜ï¼Œç®€åŒ–è¯­æ³• è‡ªå®šä¹‰å§”æ‰˜ public delegate void MyPrintDelegate(string x);//åŒ¿åæ–¹å¼åˆ›å»ºå§”æ‰˜MyPrintDelegate d = (s) = Console.WriteLine($s); Actionï¼šä»£è¡¨ä¸è¿”å›å€¼çš„æ–¹æ³•ã€‚å¯ä»¥æ¥å—æœ€å¤š 16 ä¸ªå‚æ•°ã€‚ Actionstring printMessage = Console.WriteLine;printMessage(Hello); Funcï¼šä»£è¡¨æœ‰è¿”å›å€¼çš„æ–¹æ³•ã€‚æœ€å¤šæ¥å— 16 ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¾“å…¥å‚æ•°ï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯è¿”å›å€¼ç±»å‹ã€‚ Funcint, int, int add = (x, y) = x + y;Console.WriteLine(add(3, 4)); // è¾“å‡º 7 Predicateï¼šä»£è¡¨è¿”å› bool å€¼çš„æ–¹æ³•ï¼Œé€šå¸¸ç”¨äºæ¡ä»¶åˆ¤æ–­ã€‚ Predicateint isEven = x = x % 2 == 0;Console.WriteLine(isEven(4)); // è¾“å‡º True äº‹ä»¶ å£°æ˜å§”æ‰˜ å®šä¹‰äº‹ä»¶å°†ä½¿ç”¨çš„å§”æ‰˜ç±»å‹ï¼Œå§”æ‰˜æ˜¯ä¸€ä¸ªå‡½æ•°ç­¾å å£°æ˜äº‹ä»¶ ä½¿ç”¨ event å…³é”®å­—å£°æ˜ä¸€ä¸ªäº‹ä»¶ è§¦å‘äº‹ä»¶ åœ¨é€‚å½“çš„æ—¶å€™è°ƒç”¨äº‹ä»¶ï¼Œé€šçŸ¥æ‰€æœ‰è®¢é˜…è€… è®¢é˜…å’Œå–æ¶ˆè®¢é˜…äº‹ä»¶ å…¶ä»–ç±»å¯ä»¥é€šè¿‡ += å’Œ -= è®¢é˜…å’Œå–æ¶ˆè®¢é˜…äº‹ä»¶ event æ˜¯ä¸€ç§æˆå‘˜ï¼Œç”¨äºå°†ç‰¹å®šçš„äº‹ä»¶é€šçŸ¥å‘é€ç»™è®¢é˜…è€…ï¼Œå…è®¸ä¸€ä¸ªå¯¹è±¡å°†çŠ¶æ€çš„å˜åŒ–é€šçŸ¥å…¶ä»–å¯¹è±¡ï¼Œè€Œä¸éœ€è¦çŸ¥é“è¿™äº›å¯¹è±¡çš„å®ç°ç»†èŠ‚ï¼ŒC#ä¸­ä½¿ç”¨äº‹ä»¶æœºåˆ¶å®ç°çº¿ç¨‹é—´çš„é€šè®¯ äº‹ä»¶åœ¨ç±»ä¸­å£°æ˜ä¸”ç”Ÿæˆï¼Œé€šè¿‡ä½¿ç”¨åŒä¸€ä¸ªç±»æˆ–å…¶ä»–ç±»ä¸­çš„å§”æ‰˜ä¸äº‹ä»¶å¤„ç†ç¨‹åºç›¸å…³è”ï¼ŒåŒ…å«äº‹ä»¶çš„ç±»ç”¨äºå‘å¸ƒäº‹ä»¶ï¼Œç§°ä¸ºå‘å¸ƒå™¨ã€‚å…¶ä»–æ¥å—è¯¥äº‹ä»¶çš„ç±»ç§°ä¸ºè®¢é˜…å™¨ å‘å¸ƒå™¨æ˜¯ä¸€ä¸ªåŒ…å«äº‹ä»¶å’Œå§”æ‰˜å®šä¹‰çš„å¯¹è±¡ï¼Œäº‹ä»¶å’Œå§”æ‰˜ä¹‹é—´çš„è”ç³»ä¹Ÿå®šä¹‰åœ¨è¿™ä¸ªå¯¹è±¡ä¸­ã€‚å‘å¸ƒå™¨ç±»çš„å¯¹è±¡è°ƒç”¨è¿™ä¸ªäº‹ä»¶ï¼Œå¹¶é€šçŸ¥å…¶ä»–å¯¹è±¡ è®¢é˜…å™¨æ˜¯ä¸€ä¸ªæ¥å—äº‹ä»¶å¹¶æä¾›äº‹ä»¶å¤„ç†ç¨‹åºçš„å¯¹è±¡ï¼Œåœ¨å‘å¸ƒå™¨ç±»ä¸­çš„å§”æ‰˜è°ƒç”¨è®¢é˜…å™¨ç±»ä¸­çš„æ–¹æ³•ï¼ˆäº‹ä»¶å¤„ç†ç¨‹åºï¼‰ namespace EventSub // å‘å¸ƒè€…ç±» class MyPublisher // 1. åœ¨ç±»çš„å†…éƒ¨å£°æ˜äº‹ä»¶ï¼Œé¦–å…ˆéœ€è¦å£°æ˜äº‹ä»¶å…³è”çš„å§”æ‰˜ç±»å‹ public delegate void EventSlot(string s); // 2. ä½¿ç”¨eventå…³é”®å­—å£°æ˜äº‹ä»¶,è¯¥äº‹ä»¶åœ¨ç”Ÿæˆçš„æ—¶å€™ä¼šè°ƒç”¨å§”æ‰˜ public event EventSlot MessageReceivedEvent; // è§¦å‘äº‹ä»¶çš„æ–¹æ³•ï¼ˆé€šå¸¸ç”¨ protected virtual å°è£…ï¼Œä¾¿äºå­ç±»é‡å†™ï¼‰ public void TriggerEvent(string s) // ç©ºå€¼åˆ¤æ–­ï¼šç¡®ä¿æœ‰è®¢é˜…è€…æ‰è§¦å‘ï¼ˆé¿å… NullReferenceExceptionï¼‰ MessageReceivedEvent?.Invoke(s); // è®¢é˜…è€…ç±» class MySubscriber // è®¢é˜…è€…çš„å¤„ç†æ–¹æ³•ï¼ˆç­¾åå¿…é¡»å’Œå§”æ‰˜å®Œå…¨åŒ¹é…ï¼‰ public void OnMessageReceived(string s) Console.WriteLine(è®¢é˜…è€…æ”¶åˆ°æ¶ˆæ¯ï¼š0, s); //åˆ›å»ºåŒ…å« Main æ–¹æ³•çš„ç±»ï¼ˆå…¥å£æ–¹æ³•å¿…é¡»åœ¨ç±»ä¸­ï¼‰ public class Program public static void Main() // å®ä¾‹åŒ–å‘å¸ƒè€…å’Œè®¢é˜…è€… MyPublisher pub = new MyPublisher(); MySubscriber sub = new MySubscriber(); // è®¢é˜…äº‹ä»¶ï¼šå°†è®¢é˜…è€…çš„æ–¹æ³•ç»‘å®šåˆ°äº‹ä»¶ä¸Š pub.MessageReceivedEvent += sub.OnMessageReceived; // è§¦å‘äº‹ä»¶ pub.TriggerEvent(hello); é›†åˆ ä¸“é—¨ç”¨äºæ•°æ®å­˜å‚¨å’Œæ£€ç´¢çš„ç±» æ³›å‹é›†åˆæ˜¯ç±»å‹å®‰å…¨ã€é«˜æ€§èƒ½çš„é¦–é€‰é›†åˆï¼Œæ ¸å¿ƒä¼˜åŠ¿æ˜¯ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ï¼ˆé¿å…ç±»å‹è½¬æ¢é”™è¯¯ï¼‰ã€æ— éœ€è£…ç®±æ‹†ç®±ï¼ˆæå‡æ€§èƒ½ï¼‰ã€æ˜ç¡®å…ƒç´ ç±»å‹ï¼ˆå¢å¼ºä»£ç å¯è¯»æ€§ï¼‰ List åˆ—è¡¨ new Listint(); Dictionary å­—å…¸ new DictionaryTKey,TValue(); ArrayList åŠ¨æ€æ•°ç»„ï¼Œå¤§å°å¯å˜ï¼Œé€šè¿‡ç´¢å¼•è®¿é—® Hashtable å“ˆå¸Œè¡¨ï¼Œé€šè¿‡é”®å€¼å¯¹è®¿é—® SortedList æ’åºåˆ—è¡¨ï¼Œä½¿ç”¨ç´¢å¼•å’Œé”®å€¼å¯¹è¿›è¡Œè®¿é—®ï¼Œæ˜¯æ•°ç»„å’Œå“ˆå¸Œçš„ç»„åˆ Stack æ ˆï¼Œåè¿›å…ˆå‡º Queue é˜Ÿåˆ—ï¼Œå…ˆè¿›å…ˆå‡º BitArray äºŒè¿›åˆ¶æ•°ç»„ BitArray bits = new BitArray(8, false); éšæœºè®¿é—®é¢‘ç¹ â†’ é€‰Â ListTÂ æˆ–Â DictionaryTKey,TValueï¼› é¢‘ç¹æ’å…¥ åˆ é™¤ï¼ˆéé¦–å°¾ï¼‰â†’ é€‰Â LinkedListTï¼› å»é‡æˆ–é›†åˆè¿ç®— â†’ é€‰Â HashSetTÂ æˆ–Â SortedSetTï¼› å¤šçº¿ç¨‹åœºæ™¯ â†’ é€‰Â System.Collections.ConcurrentÂ ä¸‹çš„é›†åˆã€‚ æ³›å‹ å…è®¸å»¶è¿Ÿç¼–å†™ç±»æˆ–æ–¹æ³•ä¸­çš„æ•°æ®ç±»å‹ æœ‰åŠ©äºä»£ç å¤ç”¨ï¼Œç±»å‹å®‰å…¨å’Œæé«˜æ€§èƒ½ åˆ›å»ºæ³›å‹é›†åˆ åˆ›å»ºæ³›å‹æ¥å£ï¼Œæ³›å‹ç±»ï¼Œæ³›å‹æ–¹æ³•ï¼Œæ³›å‹äº‹ä»¶ï¼Œæ³›å‹å§”æ‰˜ å¯¹æ³›å‹ç±»è¿›è¡Œçº¦æŸä»¥è®¿é—®ç‰¹å®šæ•°æ®ç±»å‹çš„æ–¹æ³• æ³›å‹æ•°æ®ç±»å‹ä¸­çš„ç±»å‹ä¿¡æ¯å¯ä»¥åœ¨è¿è¡Œä¸­ç”¨åå°„è·å– //æ³›å‹æ¥å£interface ISwapInterfaceT//æ³›å‹ç±»class SwapClassT//æ³›å‹æ–¹æ³•voidÂ SwapFunctionT(T lhs,Â T rhs)//æ³›å‹å§”æ‰˜delegate T SwapDelegateT(T lhs,Â T rhs)//æ³›å‹äº‹ä»¶event SwapDelegateT SwapEvent; åŒ¿åæ–¹æ³•//å§”æ‰˜delegate(parameters) statement; //lambdaè¡¨è¾¾å¼(parameters) = expression// æˆ–(parameters) = statement; //ä½¿ç”¨åŒ¿åæ–¹æ³•åˆ›å»ºå§”æ‰˜å®ä¾‹ NumberChanger ncÂ =Â delegate(intÂ x) Console.WriteLine(Anonymous Method: 0, x); ;//ä½¿ç”¨ lambda è¡¨è¾¾å¼åˆ›å»ºå§”æ‰˜å®ä¾‹ NumberChanger ncÂ =Â xÂ =Â Console.WriteLine($Lambda Expression: x);//å‘äº‹ä»¶å¤„ç†ç¨‹åºä¸­æ·»åŠ åŒ¿åæ–¹æ³•//å‘å¸ƒå™¨ä¸­éœ€è¦æœ‰äº‹ä»¶çš„å®šä¹‰å’Œäº‹ä»¶çš„è§¦å‘ Button buttonÂ =Â newÂ Button(); button.ClickÂ +=Â delegateÂ (objectÂ sender, EventArgs e) Console.WriteLine(Button clicked!); ; ä¸å®‰å…¨ä»£ç æŒ‡çš„æ˜¯ä½¿ç”¨äº†æŒ‡é’ˆå˜é‡çš„ä»£ç å—ã€‚ç”±äº C#ä¸­å£°æ˜çš„å˜é‡åœ¨å†…å­˜ä¸­çš„å­˜å‚¨å—åƒåœ¾å›æ”¶å™¨ç®¡ç†ï¼›å› æ­¤ä¸€ä¸ªå˜é‡ï¼ˆä¾‹å¦‚ä¸€ä¸ªå¤§æ•°ç»„ï¼‰æœ‰å¯èƒ½åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è¢«ç§»åŠ¨åˆ°å†…å­˜ä¸­çš„å…¶ä»–ä½ç½®ã€‚å¦‚æœä¸€ä¸ªå˜é‡çš„å†…å­˜åœ°å€ä¼šå˜åŒ–ï¼Œé‚£ä¹ˆæŒ‡é’ˆä¹Ÿå°±æ²¡æœ‰æ„ä¹‰äº†ã€‚è§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨ fixed å…³é”®å­—æ¥å›ºå®šå˜é‡ä½ç½®ä¸ç§»åŠ¨ã€‚ static unsafe void Main(string[] args) fixed(int *ptr = int[5]) stackalloc åœ¨ unsafe ä¸å®‰å…¨ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ stackalloc åœ¨å †æ ˆä¸Šåˆ†é…å†…å­˜ï¼Œå› ä¸ºåœ¨å †æ ˆä¸Šåˆ†é…çš„å†…å­˜ä¸å—å†…å­˜ç®¡ç†å™¨ç®¡ç†ï¼Œå› æ­¤å…¶ç›¸åº”çš„æŒ‡é’ˆä¸éœ€è¦å›ºå®šã€‚ static unsafe void Main(string[] args) int *ptr = stackalloc int[1] ; å¤šçº¿ç¨‹ çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸå¼€å§‹äº System.Threading.Thread ç±»çš„å¯¹è±¡è¢«åˆ›å»ºæ—¶ ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶ï¼Œä¸»çº¿ç¨‹è‡ªåŠ¨åˆ›å»ºã€‚ä½¿ç”¨Â ThreadÂ ç±»åˆ›å»ºçš„çº¿ç¨‹è¢«ä¸»çº¿ç¨‹çš„å­çº¿ç¨‹è°ƒç”¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Thread ç±»çš„Â CurrentThreadÂ å±æ€§è®¿é—®çº¿ç¨‹ã€‚ çº¿ç¨‹æ˜¯é€šè¿‡æ‰©å±• Thread ç±»åˆ›å»ºçš„ã€‚æ‰©å±•çš„ Thread ç±»è°ƒç”¨Â Start()Â æ–¹æ³•æ¥å¼€å§‹å­çº¿ç¨‹çš„æ‰§è¡Œ Thread ç±»æä¾›äº†å„ç§ç®¡ç†çº¿ç¨‹çš„æ–¹æ³•ï¼Œsleep Abort()Â æ–¹æ³•ç”¨äºé”€æ¯çº¿ç¨‹ã€‚é€šè¿‡æŠ›å‡ºÂ threadabortexceptionÂ åœ¨è¿è¡Œæ—¶ä¸­æ­¢çº¿ç¨‹ã€‚è¿™ä¸ªå¼‚å¸¸ä¸èƒ½è¢«æ•è·ï¼Œå¦‚æœæœ‰Â finallyÂ å—ï¼Œæ§åˆ¶ä¼šè¢«é€è‡³Â finallyÂ å—ã€‚ using System;using System.Threading;namespace MultithreadingApplication class ThreadCreationProgram public static void CallToChildThread() try Console.WriteLine(Child thread starts); // è®¡æ•°åˆ° 10 for (int counter = 0; counter = 10; counter++) Thread.Sleep(500); Console.WriteLine(counter); Console.WriteLine(Child Thread Completed); catch (ThreadAbortException e) Console.WriteLine(Thread Abort Exception); finally Console.WriteLine(Couldnt catch the Thread Exception); static void Main(string[] args) //1.æ³¨å†Œçº¿ç¨‹å…¥å£å‡½æ•° ThreadStart childref = new ThreadStart(CallToChildThread); Console.WriteLine(In Main: Creating the Child thread); //2.åˆ›å»ºçº¿ç¨‹ Thread childThread = new Thread(childref); //3.å¯åŠ¨çº¿ç¨‹ childThread.Start(); //4.åœæ­¢ä¸»çº¿ç¨‹ä¸€æ®µæ—¶é—´ Thread.Sleep(2000); //5.ä¸­æ­¢å­çº¿ç¨‹ Console.WriteLine(In Main: Aborting the Child thread); childThread.Abort(); Console.ReadKey();","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"C Sharp for C++ programmers","path":"/2025/11/17/2-ç¼–ç¨‹è¯­è¨€-CSharp-C-Sharp-for-C-programmers/","content":"ç›®æ ‡å¬ä¼—ï¼šç²¾é€š C++ çš„å¼€å‘è€…æˆ–ç†Ÿæ‚‰åº•å±‚æ¦‚å¿µçš„ç¨‹åºå‘˜ï¼Œæƒ³å¿«é€Ÿç†è§£ C# çš„è¯­ä¹‰ã€å†…å­˜æ¨¡å‹ã€è¯­è¨€ç‰¹æ€§ä»¥åŠä¸ C++ åœ¨è®¾è®¡ä¸å®è·µä¸Šçš„ä¸»è¦å·®å¼‚ã€‚ ä¸ºä½• C++ ç¨‹åºå‘˜è¦å­¦ C#ï¼šç°ä»£åº”ç”¨ï¼ˆä¾‹å¦‚ä¼ä¸šåç«¯ã€æ¡Œé¢äº‘æœåŠ¡ã€å·¥å…·ã€GUIï¼‰å¾ˆå¤šä½¿ç”¨ .NETC#ï¼›ç†è§£ C# æœ‰åŠ©äºè·¨è¯­è¨€åä½œã€è¿ç§»é—ç•™ç³»ç»Ÿæˆ–åœ¨ä¸åŒç”Ÿæ€ä¸­åšç³»ç»Ÿè®¾è®¡ã€‚ é‡ç‚¹ï¼šè¯­è¨€åŸºæœ¬è¯­æ³•ã€ç±»å‹ç³»ç»Ÿã€å†…å­˜å¯¹è±¡æ¨¡å‹ï¼ˆGC vs RAIIï¼‰ã€æ‰€æœ‰æƒç”Ÿå‘½å‘¨æœŸã€å¹¶å‘ï¼ˆasyncawaitï¼‰ä¸å¸¸è§è¯¯åŒºã€‚ 1. è¯¦ç»†å†…å®¹æ‹†è§£ï¼ˆæŒ‰ä¸»é¢˜åˆ†æ®µï¼‰1.1 åŸºç¡€è¯­æ³•ä¸ç¨‹åºç»“æ„ å‘½åç©ºé—´ä¸å¼•ç”¨ï¼ˆusingï¼‰ï¼šC# ä½¿ç”¨ using å¼•å…¥å‘½åç©ºé—´ï¼ˆä¸åŒäº C++ çš„ using namespace çš„ä¸€äº›æ½œåœ¨å‰¯ä½œç”¨ï¼‰ã€‚æ¨èç¤ºä¾‹ï¼š using System;namespace MyApp class Program static void Main(string[] args) Console.WriteLine(Hello, C#); å…¥å£ç‚¹ï¼šstatic void Main(string[] args)ï¼ˆæˆ– Task Main æ”¯æŒ async ä¸»å‡½æ•°ï¼‰ã€‚ ç±»å‹å£°æ˜ï¼šclassã€structã€interfaceã€‚C# çš„ struct æ˜¯å€¼ç±»å‹ï¼ˆç±»ä¼¼ C++ çš„ struct ä½†è¯­ä¹‰æ›´æ¥è¿‘æœ‰å€¼è¯­ä¹‰çš„ç±»å‹ä¸”æœ‰å¤åˆ¶è¯­ä¹‰é™åˆ¶ï¼‰ã€‚ 1.2 ç±»å‹ç³»ç»Ÿï¼šå€¼ç±»å‹ vs å¼•ç”¨ç±»å‹ å€¼ç±»å‹ï¼ˆvalue typesï¼‰ï¼šå¦‚ int, double, struct â€”â€” å­˜åœ¨æ ˆä¸Šæˆ–ç›´æ¥å†…åµŒåœ¨åŒ…å«ç±»å‹ä¸­ï¼Œèµ‹å€¼ä¸ºå¤åˆ¶ã€‚ å¼•ç”¨ç±»å‹ï¼ˆreference typesï¼‰ï¼šå¦‚ class, string â€”â€” å­˜å‚¨åœ¨å †ä¸Šï¼Œå˜é‡ä¿å­˜å¼•ç”¨ï¼ˆæŒ‡é’ˆå¼è¯­ä¹‰ï¼‰ï¼Œç”±åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚ å­—ç¬¦ä¸²ï¼ˆstringï¼‰ï¼šä¸å¯å˜ï¼ˆimmutableï¼‰ï¼Œå¸¸è§è¯¯åŒºï¼šC++ å­—ç¬¦ä¸²å¯å˜ä½† C# string ä¿®æ”¹ä¼šäº§ç”Ÿæ–°å®ä¾‹ã€‚ ç¤ºä¾‹å¯¹æ¯”ï¼ˆC++ vs C#ï¼‰ï¼š // C++std::string s = hi;std::string t = s; // å¤åˆ¶æˆ–çŸ­æš‚å…±äº«ï¼ˆä¾å®ç°ï¼‰ // C#string s = hi;string t = s; // å¼•ç”¨ç›¸åŒä¸å¯å˜å­—ç¬¦ä¸² 1.3 å†…å­˜ç®¡ç†ä¸ç”Ÿå‘½å‘¨æœŸï¼šGC vs RAII åƒåœ¾å›æ”¶ï¼ˆGCï¼‰ï¼šC# ä¾èµ– .NET çš„ GC ç®¡ç†å¤§å¤šæ•°å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼›ç¨‹åºå‘˜ä¸è´Ÿè´£æ˜¾å¼é‡Šæ”¾æ™®é€šå¯¹è±¡ã€‚ éæ‰˜ç®¡èµ„æºï¼šä½¿ç”¨ IDisposable æ¥å£ä¸ using è¯­å¥åšç¡®å®šæ€§é‡Šæ”¾ï¼ˆç±»ä¼¼ C++ çš„ RAII æ¨¡å¼ï¼Œä½†é€šè¿‡æ¥å£ + usingï¼‰ã€‚ç¤ºä¾‹ï¼š using(var stream = new FileStream(file.txt, FileMode.Open)) // ä½¿ç”¨ stream // é€€å‡º using æ—¶è°ƒç”¨ stream.Dispose() Finalizerï¼ˆææ„å™¨ï¼‰ï¼šC# æ”¯æŒ ~ClassName() ä½œä¸ºæœ€ç»ˆåŒ–å™¨ï¼Œä½†ä¸ä¿è¯ç«‹å³æ‰§è¡Œï¼Œé€šå¸¸ä¸æ¨èç›´æ¥ä¾èµ– finalizer æ¥ç®¡ç†éæ‰˜ç®¡èµ„æºï¼ˆåº”ä½¿ç”¨ Dispose æ¨¡å¼ï¼‰ã€‚ å¯¹ C++ ç¨‹åºå‘˜çš„æç¤ºï¼šä¸è¦æœŸå¾…ææ„å™¨åƒ C++ destructor é‚£æ ·ç«‹å³è¿è¡Œï¼›åº”å®ç°å¹¶è°ƒç”¨ Disposeusing åšåŠæ—¶é‡Šæ”¾ã€‚ 1.4 å¯ç©ºæ€§ä¸ç©ºå¼•ç”¨å®‰å…¨ï¼ˆnullï¼‰ å¼•ç”¨ç±»å‹å¯ä¸º nullï¼ˆå†å²ä¸Šå¯¼è‡´â€œnull å¼•ç”¨å¼‚å¸¸â€ï¼‰ã€‚åœ¨æ–°ç‰ˆ C# ä¸­å¼•å…¥å¯ç©ºå¼•ç”¨ç±»å‹ï¼ˆnullable reference typesï¼‰æ¥æä¾›é™æ€è­¦å‘Šï¼Œè¯­æ³•å¦‚ string? è¡¨ç¤ºå¯ä¸ºç©º, string è¡¨ç¤ºéç©ºï¼ˆéœ€åœ¨é¡¹ç›®ä¸­å¯ç”¨ï¼‰ã€‚ å€¼ç±»å‹çš„å¯ç©ºï¼ˆNullable int?ï¼‰ï¼šä¾‹å¦‚ int? x = null;ã€‚ å¯¹ C++ ç¨‹åºå‘˜ï¼šæ³¨æ„ C# çš„ç©ºè¡Œä¸ºä»¥åŠç©ºæ£€æŸ¥å·¥å…·ï¼Œå †ä¸Šå¼•ç”¨çš„ç©ºè®¿é—®ä¼šæŠ›å‡º NullReferenceExceptionã€‚ 1.5 å¯¹è±¡æ¨¡å‹ã€ç»§æ‰¿ä¸å¤šæ€ ç»§æ‰¿ä¸è™šæ–¹æ³•ï¼šC# é»˜è®¤æ–¹æ³•ä¸æ˜¯è™šçš„ï¼›éœ€æ˜¾å¼ä½¿ç”¨ virtual overrideã€‚sealed ç”¨äºç¦æ­¢ç»§æ‰¿æˆ–é‡å†™ã€‚ æ¥å£ï¼ˆinterfaceï¼‰ä¸æŠ½è±¡ç±»ï¼šæ¥å£åªå£°æ˜æˆå‘˜ï¼ˆç°åœ¨æ”¯æŒé»˜è®¤å®ç°ï¼‰ï¼Œæ¯” C++ çš„çº¯è™šåŸºç±»æ›´æ˜“ç”¨ã€‚ æ‰©å±•æ–¹æ³•ï¼ˆextension methodsï¼‰ï¼šå¯ä¸ºå·²æœ‰ç±»å‹â€œæ·»åŠ â€é™æ€æ–¹æ³•æ ·å¼çš„è¯­æ³•ç³–ï¼ˆä¸æ”¹å˜åŸç±»å‹ï¼‰ã€‚ 1.6 å€¼è¯­ä¹‰ã€æ‹·è´ä¸å¼•ç”¨ä¼ é€’ï¼ˆref out inï¼‰ é»˜è®¤ä¼ å‚æ˜¯æŒ‰å€¼ï¼ˆå¯¹å¼•ç”¨ç±»å‹ä¼ é€’çš„æ˜¯å¼•ç”¨å‰¯æœ¬ï¼‰ã€‚ **ref out in**ï¼šC# æä¾›æŒ‰å¼•ç”¨ä¼ é€’å‚æ•°çš„å…³é”®å­—ï¼ˆç±»ä¼¼ C++ çš„å¼•ç”¨æŒ‡é’ˆå‚æ•°ï¼‰ï¼Œref è¡¨ç¤ºä¼ å…¥ä¼ å‡ºï¼Œout è¡¨ç¤ºæ–¹æ³•ä¼šèµ‹å€¼ï¼Œin ç”¨äºä¼ é€’åªè¯»å¼•ç”¨ä»¥é¿å…å¤åˆ¶ï¼ˆé€‚ç”¨äºå¤§å‹ structï¼‰ã€‚ç¤ºä¾‹ï¼š void Swap(ref int a, ref int b) int t = a; a = b; b = t; 1.7 æ³›å‹ï¼ˆGenericsï¼‰ vs æ¨¡æ¿ï¼ˆTemplatesï¼‰ C# æ³›å‹ï¼šåœ¨è¿è¡Œæ—¶æœ‰ç±»å‹ä¿¡æ¯ï¼ˆé€šè¿‡ JIT æ³›å‹å®ç°ï¼‰ï¼Œè¯­æ³•ç®€æ´ ListT, DictionaryTKey, TValueã€‚ä¸ C++ æ¨¡æ¿ç›¸æ¯”ï¼Œä¸æ”¯æŒåŸºäºç±»å‹å‚æ•°çš„ç¼–è¯‘æ—¶ä»£ç ç”Ÿæˆï¼ˆæ²¡æœ‰æ¨¡æ¿å…ƒç¼–ç¨‹é‚£æ ·çš„ Turing-complete ç¼–è¯‘æœŸè®¡ç®—ï¼‰ï¼Œä½†æ³›å‹æ›´æ˜“ç”¨ä¸”ç±»å‹å®‰å…¨ã€‚ çº¦æŸï¼ˆwhereï¼‰ï¼šå¯ä»¥çº¦æŸæ³›å‹å‚æ•°ï¼ˆwhere T : class, where T : new() ç­‰ï¼‰ã€‚ æ€§èƒ½ï¼šå€¼ç±»å‹æ³›å‹ä¼šäº§ç”Ÿè£…ç®±éè£…ç®±å·®å¼‚ï¼Œä½† .NET åœ¨ JIT æ—¶ä¼šä¸ºå€¼ç±»å‹æ³›å‹ç”Ÿæˆå…·ä½“å®ç°ä»¥é¿å…è£…ç®±ï¼ˆä¸ C++ æ¨¡æ¿ä¸åŒä½†ä¹Ÿåšä¼˜åŒ–ï¼‰ã€‚ 1.8 å§”æ‰˜ï¼ˆdelegateï¼‰ã€äº‹ä»¶ï¼ˆeventï¼‰ä¸å‡½æ•°å¼é£æ ¼ å§”æ‰˜ï¼šç±»å‹å®‰å…¨çš„å‡½æ•°æŒ‡é’ˆï¼Œå¸¸ç”¨äºå›è°ƒã€‚ äº‹ä»¶ï¼šåŸºäºå§”æ‰˜çš„è§‚å¯Ÿè€…æ¨¡å¼å°è£…ï¼Œç”¨ event å…³é”®å­—å®šä¹‰å¹¶åœ¨ç±»å†…éƒ¨è§¦å‘ã€‚ Lambda ä¸ LINQï¼šC# å¹¿æ³›ä½¿ç”¨ Lambda è¡¨è¾¾å¼ä¸ LINQï¼ˆè¯­è¨€é›†æˆæŸ¥è¯¢ï¼‰ï¼Œè¿™å¯¹ä¹ æƒ¯äº STL ç®—æ³•çš„ C++ ç¨‹åºå‘˜éå¸¸æœ‰å¸®åŠ©ä½†è¯­æ³•æ›´é«˜é˜¶ã€‚ç¤ºä¾‹ï¼š var evens = numbers.Where(n = n % 2 == 0).Select(n = n * 2); 1.9 å¼‚æ­¥ç¼–ç¨‹ï¼ˆasync awaitï¼‰ asyncawait æ¨¡å‹ï¼šC# çš„å¼‚æ­¥æ˜¯ç¼–è¯‘å™¨çº§åˆ«æ”¯æŒçš„åç¨‹æ ·å¼ï¼Œé€šè¿‡ Task TaskT è¡¨ç¤ºå¼‚æ­¥æ“ä½œï¼›await ä¼šæš‚åœå½“å‰ä»»åŠ¡å¹¶åœ¨å¼‚æ­¥å®Œæˆåç»§ç»­ã€‚ å¯¹æ¯” C++ coroutinesï¼šC# çš„ asyncawait æ›´ä¸ºç®€å•ç›´æ¥ï¼Œå…¸å‹ç”¨äº IO å¯†é›†å‹ä»»åŠ¡ã€‚æ¼”è®²å¤§æ¦‚ç‡æ¼”ç¤ºå¼‚æ­¥æ–¹æ³•çš„å†™æ³•ä¸é”™è¯¯ç”¨æ³•ï¼ˆä¾‹å¦‚å¿˜è®° await å¯¼è‡´ fire-and-forgetï¼‰ã€‚ç¤ºä¾‹ï¼š async Taskint FetchAsync() var response = await httpClient.GetAsync(url); return await response.Content.ReadAsStringAsync(); 1.10 å¼‚å¸¸å¤„ç† å¼‚å¸¸ç±»å‹ä¸æŠ›å‡ºï¼šC# ä½¿ç”¨ trycatchfinallyï¼Œæ‰€æœ‰å¼‚å¸¸ä¸ºå¼•ç”¨ç±»å‹ï¼ˆæ´¾ç”Ÿè‡ª System.Exceptionï¼‰ã€‚æ²¡æœ‰åƒ Java çš„å—æ£€å¼‚å¸¸æœºåˆ¶ï¼ˆC# åªæœ‰éå—æ£€å¼‚å¸¸ï¼‰ã€‚ èµ„æºæ¸…ç†ï¼šæ¨èä½¿ç”¨ using æˆ– try/finally æ¥ç¡®ä¿èµ„æºé‡Šæ”¾ã€‚ 1.11 æ€§èƒ½ä¸äº’æ“ä½œï¼ˆPInvoke unsafeï¼‰ æ€§èƒ½è€ƒé‡ï¼šGC å¸¦æ¥æš‚åœç‚¹ï¼ˆå°¤å…¶åœ¨é«˜åˆ†é…åœºæ™¯ï¼‰ï¼Œéœ€æ³¨æ„çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ã€åˆ†ä»£æ”¶é›†åŠå¤§å¯¹è±¡å †ï¼ˆLOHï¼‰ã€‚ é¿å…é¢‘ç¹åˆ†é…ï¼šä½¿ç”¨å¯¹è±¡æ± ï¼ˆArrayPoolT ç­‰ï¼‰ã€ç»“æ„ä½“ï¼ˆstructï¼‰å’Œ SpanT MemoryT æ¥å‡å°‘åˆ†é…ä¸æ‹·è´ã€‚ unsafe ä¸æŒ‡é’ˆï¼šC# æ”¯æŒ unsafe ä»£ç å—ä¸æŒ‡é’ˆï¼Œå¿…è¦æ—¶å¯ç”¨ä»¥åšé«˜æ€§èƒ½ã€ä½å»¶è¿Ÿä»£ç ï¼ˆä½†åº”è°¨æ…ï¼Œå¤±å»äº†æ‰˜ç®¡å®‰å…¨ï¼‰ã€‚ PInvoke ä¸äº’æ“ä½œï¼šC# å¯ä»¥é€šè¿‡ PInvoke è°ƒç”¨åŸç”Ÿ DLLï¼ˆCC++ï¼‰ï¼Œæˆ–é€šè¿‡ C++CLI æ··ç¼–æ¡¥æ¥å¤æ‚åœºæ™¯ã€‚ç¤ºä¾‹ï¼š [DllImport(kernel32.dll)]static extern IntPtr GetCurrentProcess(); 1.12 æ–°ç‰¹æ€§ è¯­è¨€ç³–ï¼ˆè¿‘å¹´æ¥çš„äº®ç‚¹ï¼‰ è®°å½•ç±»å‹ï¼ˆrecordï¼‰ï¼šç”¨äºä¸å¯å˜æ•°æ®ç»“æ„å¹¶è‡ªåŠ¨å®ç°å€¼ç›¸ç­‰ï¼ˆvalue equalityï¼‰ã€‚ æ¨¡å¼åŒ¹é…ï¼ˆpattern matchingï¼‰ï¼šæ›´å¼ºå¤§çš„ switchis è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…ã€‚ é¡¶çº§è¯­å¥ï¼ˆTop-level statementsï¼‰ï¼šç®€åŒ–å°å‹ç¨‹åºï¼ˆæ— éœ€æ˜¾å¼ Main å‡½æ•°ï¼‰ã€‚ Nullable reference typesï¼ˆä¸Šæ–‡æè¿‡ï¼‰å¸®åŠ©é™æ€å‘ç°ç©ºå¼•ç”¨é£é™©ã€‚ è¿™äº›ç‰¹æ€§åœ¨æ¼”è®²ä¸­å¯èƒ½ä»¥ç¤ºä¾‹å±•ç¤ºå¹¶ä¸ C++ ç­‰ä»·åŠŸèƒ½åšå¯¹æ¯”ï¼ˆä¾‹å¦‚ record vs struct-likeaggregate typesï¼Œpattern matching vs std::visitvariant ç­‰ï¼‰ã€‚ 1.13 å¸¸è§é”™è¯¯ä¸åæ¨¡å¼ï¼ˆæ¼”è®²é€šå¸¸ä¼šå¼ºè°ƒï¼‰ ä¾èµ– finalizer è€Œä¸æ˜¯ Disposeï¼›å¿½è§† using å—ã€‚ åœ¨æ€§èƒ½æ•æ„Ÿè·¯å¾„é¢‘ç¹åˆ†é…çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡è€Œé€ æˆ GC å‹åŠ›ã€‚ è¯¯ç”¨ async voidï¼ˆä»…äº‹ä»¶å¤„ç†å™¨å¯ç”¨ï¼‰ï¼Œåº”å°½é‡ä½¿ç”¨ async TaskTaskTã€‚ å¿½è§† virtualoverride è¯­ä¹‰å¯¼è‡´å¤šæ€è¡Œä¸ºä¸ C++ æœŸæœ›ä¸ä¸€è‡´ã€‚ 2. ä»£ç ç¤ºä¾‹å¯¹ç…§ï¼ˆæ‘˜å–è‹¥å¹²å…¸å‹å¯¹æ¯”ï¼‰2.1 ç±»æ„é€ ææ„// C++class Foo public: Foo() /* ctor */ ~Foo() /* dtor */ // deterministic; // C#class Foo : IDisposable public Foo() /* ctor */ public void Dispose() /* deterministic cleanup */ ~Foo() /* finalizer â€” non-deterministic */ 2.2 æ³›å‹ vs æ¨¡æ¿å¯¹ç…§// C++ æ¨¡æ¿templatetypename TT max(T a, T b) return a b ? b : a; // C# æ³›å‹T MaxT(T a, T b) where T : IComparableT return a.CompareTo(b) 0 ? b : a; 2.3 å¼‚æ­¥å¯¹æ¯”ï¼ˆç¤ºä¾‹ï¼‰async Taskstring GetAsync() var resp = await client.GetAsync(url); return await resp.Content.ReadAsStringAsync(); 3. è¿ç§»äº’æ“ä½œå»ºè®®ï¼ˆç»™ C++ ç¨‹åºå‘˜çš„å®é™…å»ºè®®ï¼‰ é€æ­¥è¿ç§»ï¼šå…ˆå­¦ C# æ ¸å¿ƒ idiomsï¼ˆusingã€IDisposableã€asyncawaitã€LINQï¼‰ï¼Œå†é‡æ„æ¨¡å—ã€‚ äº’æ“ä½œç­–ç•¥ï¼šä½¿ç”¨ PInvoke æˆ– C++CLI æ„å»ºæ¡¥æ¥å±‚ï¼Œæˆ–è€…é€šè¿‡ RESTIPC å°† C++ æœåŠ¡ä¸ C# æœåŠ¡è§£è€¦ã€‚ æ€§èƒ½åŸºå‡†ï¼šåœ¨å…³é”®è·¯å¾„åšåŸºå‡†ï¼ˆBenchmarkDotNetï¼‰ï¼›æ¯”è¾ƒ GC è¡Œä¸ºã€å†…å­˜ä¸å»¶è¿Ÿã€‚ å·¥å…·é“¾ï¼šç†Ÿæ‚‰ Visual Studio dotnet CLI NuGetã€‚æ¨èå­¦ä¼šç”¨ dotnet çš„é¡¹ç›®æ–‡ä»¶ *.csprojã€è°ƒè¯•ã€profilingï¼ˆä¾‹å¦‚ PerfView dotnet-traceï¼‰å·¥å…·ã€‚ 4. ç»“è®ºä¸æ¼”è®²å»ºè®®è¦ç‚¹ï¼ˆé¢å‘ C++ ç¨‹åºå‘˜ï¼‰ C# æ˜¯ä¸€é—¨ç°ä»£ã€å®‰å…¨ç”Ÿäº§åŠ›é«˜çš„è¯­è¨€ï¼Œé€‚åˆå¿«é€Ÿæ„å»ºæœåŠ¡ä¸šåŠ¡é€»è¾‘ä¸ UI åº”ç”¨ã€‚ C# ä¸ C++ åœ¨å†…å­˜ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸Šæœ‰æ ¹æœ¬ä¸åŒï¼ˆGC vs RAIIï¼‰â€”â€”ç†è§£è¿™ä¸€ç‚¹æ˜¯å­¦ä¹  C# çš„å…³é”®ã€‚ å­¦ä¼š IDisposableã€usingã€async/awaitã€LINQã€æ³›å‹ä¸å§”æ‰˜äº‹ä»¶åï¼ŒC++ ç¨‹åºå‘˜èƒ½å¾ˆå¿«æˆä¸ºé«˜æ•ˆçš„ C# å¼€å‘è€…ã€‚ æ€§èƒ½æ•æ„Ÿåœºæ™¯éœ€è¦å…³æ³¨åˆ†é…ç­–ç•¥ã€SpanTMemoryTã€å¯¹è±¡æ± ä¸ unsafeï¼ˆå¿…è¦æ—¶ï¼‰ã€‚ æ¼”è®²é€šè¿‡å¯¹æ¯”ã€ç¤ºä¾‹ä¸å¸¸è§è¯¯åŒºè®²è§£ï¼Œå¸®åŠ© C++ å¼€å‘è€…å»ºç«‹æ­£ç¡®çš„ C# å¿ƒæ™ºæ¨¡å‹ï¼ˆmental modelï¼‰ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","CSharp"]},{"title":"ä¾èµ–çš„package","path":"/2025/07/23/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-åšå®¢-ä¾èµ–çš„package/","content":"hexo Hexo æ ¸å¿ƒæ¡†æ¶ï¼Œæä¾›åšå®¢ç”Ÿæˆã€ç®¡ç†çš„åŸºç¡€åŠŸèƒ½ hexo-auto-category è‡ªåŠ¨åˆ†ç±»æ’ä»¶ï¼Œæ ¹æ®æ–‡ç« è·¯å¾„æˆ–æ ‡ç­¾è‡ªåŠ¨ç”Ÿæˆåˆ†ç±»ç»“æ„ hexo-deployer-git Git éƒ¨ç½²å·¥å…·ï¼Œå°†ç”Ÿæˆçš„é™æ€æ–‡ä»¶æ¨é€åˆ° GitHub Pages ç­‰å¹³å° hexo-generator-archive ç”Ÿæˆæ–‡ç« å½’æ¡£é¡µé¢ï¼ˆæŒ‰æ—¶é—´æ—¥æœŸç»„ç»‡ï¼‰ hexo-generator-category ç”Ÿæˆåˆ†ç±»é¡µé¢åŠåˆ†ç±»å¯¼èˆªåŠŸèƒ½ hexo-generator-index ç”Ÿæˆåšå®¢é¦–é¡µï¼Œå±•ç¤ºæœ€æ–°æ–‡ç« åˆ—è¡¨ hexo-generator-searchdb ç”Ÿæˆæœ¬åœ°æœç´¢æ•°æ®åº“ï¼Œæ”¯æŒç«™å†…æ–‡ç« æœç´¢ hexo-generator-tag ç”Ÿæˆæ ‡ç­¾é¡µé¢åŠæ ‡ç­¾äº‘åŠŸèƒ½ hexo-related-popular-posts ç›¸å…³æ–‡ç« æ¨èæ’ä»¶ï¼ŒåŸºäºæ ‡ç­¾æˆ–å†…å®¹ç›¸å…³æ€§å±•ç¤ºæ¨èæ–‡ç«  hexo-renderer-ejs EJS æ¨¡æ¿å¼•æ“æ¸²æŸ“å™¨ï¼Œè§£æä¸»é¢˜ä¸­çš„ .ejs æ¨¡æ¿æ–‡ä»¶ hexo-renderer-marked Markdown æ¸²æŸ“å™¨ï¼Œå°† .md æ–‡ç« è½¬æ¢ä¸º HTML hexo-renderer-stylus Stylus æ ·å¼æ¸²æŸ“å™¨ï¼Œè§£æä¸»é¢˜ä¸­çš„ .styl æ ·å¼æ–‡ä»¶ hexo-server æœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼Œæä¾›å®æ—¶é¢„è§ˆåŠŸèƒ½ï¼ˆ hexo server å‘½ä»¤ï¼‰ hexo-theme-landscape Hexo é»˜è®¤ä¸»é¢˜ï¼Œæä¾›åŸºç¡€åšå®¢é¡µé¢å¸ƒå±€å’Œæ ·å¼","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨","åšå®¢"]},{"title":"ä¸€äº›RTOS","path":"/2025/07/22/5-åµŒå…¥å¼å¼€å‘-RTOS-ä¸€äº›RTOS/","content":"å…³äº OSç›®å‰ 3568 çš„æ“ä½œç³»ç»Ÿä¸ºåµŒå…¥å¼ Linuxï¼Œè¯¥æ“ä½œç³»ç»Ÿä¸ºåˆ†æ—¶æ“ä½œç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡æ‰“è¡¥ä¸çš„å½¢å¼æˆä¸ºå®æ—¶æ“ä½œç³»ç»Ÿï¼Œå…·ä½“å‚æ•°æ˜¯å¦ç¬¦åˆæœ‰å¾…éªŒè¯ 3568 å®æ—¶æ“ä½œç³»ç»ŸéªŒè¯é¡µé¢ https://www.forlinx.net/industrial-news/real-time-system-test-on-rk3568-sbc-437.html å…¶ä»– RTOS3.1 [DDC-i] Deos(https://www.ddci.com/products_deos_do_178c_arinc_653 ) Deosâ„¢ æ˜¯ DDC-I çš„å®‰å…¨å…³é”®å‹æ—¶é—´å’Œç©ºé—´åˆ†åŒºå®æ—¶æ“ä½œç³»ç»Ÿ (RTOS)ï¼Œå·²æ ¹æ®èˆªç©ºç”µå­åº”ç”¨ DO-178CED-12C è®¾è®¡ä¿è¯ A çº§ (DAL A) æŒ‡å—è¿›è¡Œäº†éªŒè¯ï¼Œæ”¯æŒ ARINC 653 APEXï¼Œé€Ÿç‡å•è°ƒè°ƒåº¦ (RMS)ï¼Œé’ˆå¯¹æœªæ¥æœºè½½èƒ½åŠ›ç¯å¢ƒ (FACEâ„¢) å®‰å…¨æ‰©å±•å’Œå®‰å…¨åŸºç¡€é…ç½®æ–‡ä»¶ã€‚ Deos æ˜¯ç¬¬ä¸€ä¸ªè·å¾— FACE æŠ€æœ¯æ ‡å‡† 3.1 ç‰ˆ OSS ä¸€è‡´æ€§è®¤è¯çš„ RTOSã€‚å®‰å…¨æ‰©å±•é…ç½®æ–‡ä»¶å¢åŠ äº†å¯¹ TCPIP é€šä¿¡ã€å¤šè¿›ç¨‹æ”¯æŒå’Œæ‰©å±• POSIX åŠŸèƒ½ï¼ˆ80 ä¸ªé¢å¤–åŠŸèƒ½ï¼‰çš„æ”¯æŒï¼Œæ˜¯å®‰å…¨åŸºç¡€å’Œå®‰å…¨é…ç½®æ–‡ä»¶æ‰€éœ€åŠŸèƒ½çš„è¶…é›†ã€‚ 3.2 [Green Hills Software] Integrity RTOS( https://www.ghs.com/products/safety_critical/integrity_178_tump.html ) INTEGRITY-178 tuMP å®æ—¶æ“ä½œç³»ç»Ÿ (RTOS) æ˜¯ä¸–ç•Œé¢†å…ˆçš„å¤šæ ¸ RTOSï¼Œé€‚ç”¨äºå®‰å…¨å’Œå®‰ä¿å…³é”®å‹åº”ç”¨ã€‚ Green Hills Software ç›¸ä¿¡å®‰å…¨ä¸ä¿éšœæ˜¯é½å¤´å¹¶è¿›çš„ï¼ŒINTEGRITY-178 tuMP æ˜¯å¤šæ ¸å¤„ç†å™¨çš„ç»Ÿä¸€è§£å†³æ–¹æ¡ˆã€‚ INTEGRITY-178 å’Œ INTEGRITY-178 tuMP æ˜¯å·²é€šè¿‡ 80 å¤šä¸ªæœºè½½ç³»ç»Ÿæœ€é«˜çº§åˆ«æœºè½½å®‰å…¨ (DO-178BC DAL A) å’Œå®‰å…¨ (SKKPEAL 6+) è®¤è¯çš„ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚ INTEGRITY-178 tuMP æ˜¯ç¬¬ä¸€ä¸ªç»è¿‡è®¤è¯ç¬¦åˆæœ€æ–°æœªæ¥æœºè½½èƒ½åŠ›ç¯å¢ƒ (FACEâ„¢) æŠ€æœ¯æ ‡å‡† 3.0 ç‰ˆçš„æ“ä½œç³»ç»Ÿï¼Œå¹¶ä¸”é€šè¿‡äº†å®‰å…¨åŸºç¡€å’Œå®‰å…¨é…ç½®æ–‡ä»¶çš„è®¤è¯ã€‚ INTEGRITY-178 tuMP æ˜¯ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªæˆä¸º DO-178C å’Œ CAST-32A å¤šæ ¸è®¤è¯ä¸€éƒ¨åˆ†çš„ RTOSã€‚ 3.3 [Lynx Software] LynxOS( https://www.lynx.com/products/lynxos-178-do-178c-certified-posix-rtos ) LynxOS-178 æ˜¯ä¸€æ¬¾å•†ç”¨ç°æˆ (COTS) RTOSï¼Œæ”¯æŒ x86ã€Arm å’Œ PowerPC å¹³å°ã€‚å®ƒåŸºäºå¼€æ”¾æ ‡å‡†ï¼Œä¸“ä¸ºæ»¡è¶³å®‰å…¨å…³é”®å‹å®æ—¶ç³»ç»Ÿä¸­å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹åº”ç”¨ç¨‹åºçš„ä¸¥æ ¼éœ€æ±‚è€Œè®¾è®¡ï¼Œé€šè¿‡å®æ—¶è¿›ç¨‹ã€åº”ç”¨ç¨‹åºå’Œåº”ç”¨ç¨‹åºä¹‹é—´ä¸¥æ ¼çš„ç¡¬ä»¶å¼ºåˆ¶éš”ç¦»æ¥æä¾›å®‰å…¨ä¿éšœã€‚ RTOS å†…æ ¸æœåŠ¡å’Œé©±åŠ¨ç¨‹åºã€‚ 3.4 [SYSGO]PikeOS(https://www.sysgo.com/ ) RTOS ä»¥åŠå¸¦æœ‰åˆ†ç¦»å†…æ ¸ç¡¬å®æ—¶æ“ä½œç³»ç»Ÿçš„ 1 ç±»è™šæ‹Ÿæœºç›‘è§†å™¨ å¼ºå¤§çš„æ—¶é—´å’Œèµ„æºåˆ†åŒº å…±äº«å†…å­˜ã€å›¾å½¢å’ŒéŸ³é¢‘ï¼ˆå–å†³äº BSPï¼‰ æ”¯æŒ OpenGLï¼ŒOpenCL ç¬¦åˆ MILS è·å¾— DO-178Cã€EN 50218ã€EN 50657ã€IEC 61508ã€ISO 26262ã€IEC 62304 å®‰å…¨è®¤è¯ è·å¾— CC EAL 5+å’Œ Airbus SAR å®‰å…¨è®¤è¯ æ”¯æŒå¤šæ ¸å¤„ç†å™¨ éƒ¨åˆ† BSP çš„ç¡¬ä»¶è™šæ‹ŸåŒ–ã€å›¾å½¢å’ŒéŸ³é¢‘å…±äº« å¯è®¤è¯çš„ CIP å’Œ CFS åŸºäº Eclipse çš„ IDE CODEO å¤§å‹è½¯ä»¶å’Œç¡¬ä»¶ä½“ç³» 3.5 [CoreAVI](https://coreavi.com/ ) 3.6 WindRiver","categories":["5.åµŒå…¥å¼å¼€å‘","RTOS"]},{"title":"OpenCVä¸»æ¨¡å—","path":"/2025/07/22/3-å¼€å‘æ¡†æ¶-OpenCV-OpenCVä¸»æ¨¡å—/","content":"OpenCV æ¨¡å—è¯¦è§£æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼ˆcore æ¨¡å—ï¼‰æ ¸å¿ƒåŠŸèƒ½æ¨¡å—æ˜¯ OpenCV çš„åŸºç¡€ï¼ŒåŒ…å«äº†æ‰€æœ‰å…¶ä»–æ¨¡å—æ‰€éœ€çš„åŸºæœ¬å·¥å…·ï¼Œç±»ä¼¼äºä¸€ä¸ªæ”¯æ’‘æ•´ä¸ª OpenCV çš„åŸºçŸ³ã€‚è¿™ä¸ªæ¨¡å—ä¸­å®šä¹‰äº†å¤§é‡çš„åŸºæœ¬æ•°æ®ç»“æ„ã€å¸¸é‡å’Œå‡½æ•°ï¼Œè¿™äº›åœ¨ OpenCV çš„å…¶ä»–æ¨¡å—ä¸­éƒ½ä¼šç”¨åˆ°ã€‚ ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œè¿™ä¸ªæ¨¡å—ä¸­æœ€é‡è¦çš„ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„å°±æ˜¯ Mat ç±»ã€‚Mat ç±»æ˜¯ OpenCV ä¸­è¡¨ç¤ºçŸ©é˜µçš„æ•°æ®ç»“æ„ï¼Œä¸ä»…å¯ä»¥å­˜å‚¨å›¾åƒæ•°æ®ï¼Œè¿˜èƒ½å¤„ç†å„ç§ç±»å‹çš„çŸ©é˜µè¿ç®—ã€‚å‡ ä¹æ¯ä¸€ä¸ª OpenCV ç¨‹åºéƒ½ä¼šæ¶‰åŠåˆ° Mat ç±»çš„ä½¿ç”¨ï¼š // è¯»å–å›¾åƒå¹¶å­˜å‚¨åˆ° Mat ä¸­Mat image = imread(image.jpg);// æ˜¾ç¤ºå›¾åƒimshow(Image, image); æ­¤å¤–ï¼Œcore æ¨¡å—ä¸­è¿˜åŒ…å«äº†ä¸çŸ©é˜µè¿ç®—ç›¸å…³çš„åŠŸèƒ½ï¼Œä¾‹å¦‚çŸ©é˜µçš„åŠ å‡ä¹˜é™¤ã€è½¬ç½®ã€ç‰¹å¼‚å€¼åˆ†è§£ç­‰æ“ä½œã€‚ä¾‹å¦‚ï¼š Mat A = Mat::ones(3, 3, CV_8UC1);Mat B = Mat::zeros(3, 3, CV_8UC1);Mat C = A + B; // çŸ©é˜µç›¸åŠ  å›¾åƒå¤„ç†æ¨¡å—ï¼ˆimgproc æ¨¡å—ï¼‰å›¾åƒå¤„ç†æ¨¡å—åŒ…å«äº†å¤§é‡å¸¸ç”¨çš„å›¾åƒå¤„ç†ç®—æ³•ï¼Œè¿™äº›ç®—æ³•å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯¹å›¾åƒè¿›è¡Œæ»¤æ³¢ã€å˜æ¢ã€è¾¹ç¼˜æ£€æµ‹ç­‰æ“ä½œã€‚è¿™äº›åŠŸèƒ½å¯¹äºå®ç°å›¾åƒå¢å¼ºã€å»å™ªã€å½¢çŠ¶è¯†åˆ«ç­‰ä»»åŠ¡è‡³å…³é‡è¦ã€‚ ä¾‹å¦‚ï¼Œimgproc æ¨¡å—ä¸­å¸¸è§çš„ç®—æ³•åŒ…æ‹¬ï¼š é«˜æ–¯æ»¤æ³¢ï¼ˆGaussianBlurï¼‰ï¼šç”¨äºå¹³æ»‘å¤„ç†ï¼Œå‡å°‘å™ªå£°ã€‚ GaussianBlur(image, blurred_image, Size(5,5), 0); ä¸­å€¼æ»¤æ³¢ï¼ˆmedianBlurï¼‰ï¼šç”¨äºå»é™¤æ¤’ç›å™ªå£°ã€‚ medianBlur(image, smoothed_image, 5); è¾¹ç¼˜æ£€æµ‹ï¼ˆCannyï¼‰ï¼šç”¨äºæ£€æµ‹å›¾åƒä¸­çš„è¾¹ç¼˜ã€‚ Canny(image, edges, 50, 150); å›¾åƒé˜ˆå€¼åŒ–ï¼ˆthresholdï¼‰ï¼šç”¨äºåˆ†å‰²å›¾åƒã€‚ threshold(image, thresh, 127, 255, THRESH_BINARY); å›¾åƒå˜æ¢ï¼šä¾‹å¦‚éœå¤«å˜æ¢ï¼ˆç”¨äºç›´çº¿ã€åœ†ç­‰å½¢çŠ¶çš„æ£€æµ‹ï¼‰ã€å‚…é‡Œå¶å˜æ¢ï¼ˆç”¨äºé¢‘åŸŸåˆ†æç­‰ï¼‰ è¿™äº›ç®—æ³•ä¸ä»…å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä»å›¾åƒä¸­æå–æœ‰ç”¨çš„ä¿¡æ¯ï¼Œè¿˜å¯ä»¥ä¸ºåç»­çš„é«˜çº§è§†è§‰ä»»åŠ¡ï¼ˆå¦‚ç‰©ä½“è¯†åˆ«ã€åœºæ™¯ç†è§£ï¼‰å¥ å®šåŸºç¡€ã€‚ äºŒç»´ç‰¹å¾æ¡†æ¶æ¨¡å—ï¼ˆfeatures2d æ¨¡å—ï¼‰äºŒç»´ç‰¹å¾æ¡†æ¶æ¨¡å—æä¾›äº†ç”¨äºç‰¹å¾æ£€æµ‹å’ŒåŒ¹é…çš„å„ç§ç®—æ³•ï¼Œä¸»è¦ç”¨äºå›¾åƒé…å‡†ã€ç‰©ä½“è¯†åˆ«å’Œè·Ÿè¸ªç­‰ä»»åŠ¡ã€‚è¿™ä¸ªæ¨¡å—æ˜¯å®ç°å„ç§æœºå™¨è§†è§‰ç®—æ³•çš„åŸºçŸ³ã€‚è¿™ä¸ªæ¨¡å—ä¸­åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªå…³é”®åŠŸèƒ½ï¼š ç‰¹å¾æ£€æµ‹ï¼ˆFeature Detectionï¼‰: è§’ç‚¹æ£€æµ‹ï¼ˆgoodFeaturesToTrackï¼‰ï¼šç”¨äºæ£€æµ‹å›¾åƒä¸­çš„è§’ç‚¹ã€‚ goodFeaturesToTrack(gray_image, corners, 1000, 0.01, 10); SIFTï¼ˆScale-Invariant Feature Transformï¼‰ï¼šç”¨äºæ£€æµ‹å°ºåº¦ä¸å˜çš„ç‰¹å¾ç‚¹ã€‚ SIFT sift;sift.detect(gray_image, keypoints); ç‰¹å¾æè¿°ï¼ˆFeature Descriptionï¼‰: SIFT æè¿°ç¬¦ï¼šç”¨äºæè¿°å„ä¸ªç‰¹å¾ç‚¹çš„å±€éƒ¨ç‰¹å¾ã€‚ sift.compute(gray_image, keypoints, descriptors); SURFï¼ˆSpeeded Up Robust Featuresï¼‰ï¼šä¸€ç§æ›´å¿«çš„ç‰¹å¾æ£€æµ‹å’Œæè¿°ç®—æ³•ã€‚ ç‰¹å¾åŒ¹é…ï¼ˆFeature Matchingï¼‰: Brute-Force Matcherï¼šé€šè¿‡æš´åŠ›æœç´¢å®ç°ç‰¹å¾åŒ¹é…ã€‚ BFMatcher matcher(NORM_HAMMING);matcher.match(descriptors1, descriptors2, matches); è¿™äº›åŠŸèƒ½å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°å›¾åƒé…å‡†ã€ç‰©ä½“è¯†åˆ«ã€å›¾åƒæ‹¼æ¥ç­‰ä»»åŠ¡ã€‚ è§†é¢‘æ¨¡å—ï¼ˆvideo æ¨¡å—ï¼‰è§†é¢‘æ¨¡å—åŒ…å«äº†å¤„ç†è§†é¢‘æ•°æ®çš„å„ç§ç®—æ³•ï¼ŒåŒ…æ‹¬äº†è¿åŠ¨ä¼°è®¡ã€èƒŒæ™¯å·®åˆ†ã€ç‰©ä½“è·Ÿè¸ªç­‰åŠŸèƒ½ã€‚è¿™äº›ç®—æ³•åœ¨è§†é¢‘åˆ†æã€å®æ—¶å¤„ç†ç­‰åœºæ™¯ä¸­éå¸¸é‡è¦ã€‚ å…·ä½“æ¥è¯´ï¼Œè¿™ä¸ªæ¨¡å—åŒ…å«ä»¥ä¸‹å‡ ä¸ªä¸»è¦åŠŸèƒ½ï¼š è¿åŠ¨ä¼°è®¡ï¼ˆOptical Flowï¼‰: Horn-Schunck æ–¹æ³•ï¼šç”¨äºè®¡ç®—è§†é¢‘ä¸­å„ç‚¹çš„è¿åŠ¨å‘é‡ã€‚ calcOpticalFlowFarneback(prev_gray, curr_gray, flow, 0.5, 3, 15, 3, 5, 1.2, 0); Lucas-Kanade æ–¹æ³•ï¼šç”¨äºè·Ÿè¸ªç‰¹å®šç‚¹çš„è¿åŠ¨ã€‚ calcOpticalFlowPyrLK(prev_gray, curr_gray, prev_corners, next_corners); èƒŒæ™¯å·®åˆ†ï¼ˆBackground Subtractionï¼‰: å‡å€¼èƒŒæ™¯æ¨¡å‹ï¼š background_diff = abs(image - background_model); é«˜æ–¯æ··åˆæ¨¡å‹ï¼ˆGMMï¼‰ï¼š bgsegm.createBackgroundSubtractorGMG();fgMask = bgsegm.apply(image); è·Ÿè¸ªï¼ˆTrackingï¼‰: å¡å°”æ›¼æ»¤æ³¢å™¨ï¼ˆKalman Filterï¼‰ï¼šç”¨äºä¼°è®¡ç‰©ä½“çš„ä½ç½®ã€‚ ç²’å­æ»¤æ³¢å™¨ï¼ˆParticle Filterï¼‰ï¼šç”¨äºè·Ÿè¸ªå¤šç›®æ ‡æˆ–å¤æ‚è¿åŠ¨çš„ç‰©ä½“ã€‚ è¿™äº›åŠŸèƒ½åœ¨æ™ºèƒ½ç›‘æ§ã€è§†é¢‘ç†è§£ã€è‡ªåŠ¨é©¾é©¶ç­‰é¢†åŸŸæœ‰å¹¿æ³›åº”ç”¨ã€‚","categories":["3.å¼€å‘æ¡†æ¶","OpenCV"]},{"title":"åˆ«å†ç”¨ system() äº†ï¼Qt QProcess æ‰æ˜¯è°ƒç”¨å¤–éƒ¨ç¨‹åºçš„ç‹é“","path":"/2025/07/19/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qt-QProcessè¿›ç¨‹äº¤äº’/","content":"åœ¨æ¡Œé¢åº”ç”¨å¼€å‘ä¸­ï¼Œè°ƒç”¨å¤–éƒ¨ç¨‹åºæ˜¯ç»‘å®šä¸å¼€çš„éœ€æ±‚ï¼šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€è°ƒç”¨ FFmpeg è½¬ç ã€å¯åŠ¨ Git æ“ä½œâ€¦â€¦å¾ˆå¤šå¼€å‘è€…ä¹ æƒ¯ç”¨ system(command) ä¸€è¡Œè§£å†³ï¼Œå´ä¸çŸ¥é“è¿™ç§å†™æ³•ä¼šé˜»å¡æ•´ä¸ªçº¿ç¨‹ï¼Œè®© GUI ç•Œé¢å¡æˆ PPTã€‚ Qt æä¾›çš„ QProcess ç±»æ‰æ˜¯æ­£è§£â€”â€”å¼‚æ­¥éé˜»å¡ã€åŒå‘æ•°æ®æµã€è·¨å¹³å°å…¼å®¹ï¼Œæœ¬æ–‡å¸¦ä½ ä»é›¶æŒæ¡è¿™ä¸€åˆ©å™¨ã€‚ ä¸€ã€QProcess æ ¸å¿ƒæ¦‚å¿µ1.1 ä¸ºä»€ä¹ˆé€‰æ‹© QProcessQProcess ç»§æ‰¿è‡ª QIODeviceï¼Œè¿™æ„å‘³ç€å®ƒå°†å¤–éƒ¨è¿›ç¨‹æŠ½è±¡ä¸ºå¯è¯»å†™çš„ IO è®¾å¤‡â€”â€”ä¸æ“ä½œæ–‡ä»¶ã€ç½‘ç»œå¥—æ¥å­—çš„æ–¹å¼å®Œå…¨ä¸€è‡´ã€‚ å¯¹æ¯”ç»´åº¦ system() QProcess æ‰§è¡Œæ–¹å¼ åŒæ­¥é˜»å¡ å¼‚æ­¥éé˜»å¡ è¾“å‡ºæ•è· ä¸æ”¯æŒ å®Œæ•´æ”¯æŒ stdoutstderr è¾“å…¥äº¤äº’ ä¸æ”¯æŒ æ”¯æŒå†™å…¥ stdin è¿›ç¨‹æ§åˆ¶ æ—  å¯æš‚åœã€ç»ˆæ­¢ã€è·å–é€€å‡ºç  è·¨å¹³å° å‘½ä»¤éœ€æ‰‹åŠ¨é€‚é… Qt è‡ªåŠ¨å¤„ç†å‚æ•°è½¬ä¹‰ åº•å±‚å®ç°ï¼šUnixLinux ä¸ŠåŸºäº fork() + exec()ï¼ŒWindows ä¸Šä½¿ç”¨ CreateProcess() APIï¼Œå¯¹å¼€å‘è€…å®Œå…¨é€æ˜[^1]ã€‚ 1.2 æ•°æ®æµæ¨¡å‹ç†è§£ QProcess çš„å…³é”®åœ¨äºææ¸…æ¥šè¯»å†™æ–¹å‘ï¼š graph LR subgraph ä½ çš„ Qt åº”ç”¨ A[QProcess::write] -- B[stdin] C[stdout] -- D[QProcess::read] E[stderr] -- F[QProcess::readAllStandardError] end subgraph å¤–éƒ¨è¿›ç¨‹ B -- G[ç¨‹åºå¤„ç†] G -- C G -- E end å†™å…¥ QProcess æ•°æ®è¿›å…¥å¤–éƒ¨ç¨‹åºçš„æ ‡å‡†è¾“å…¥ ä» QProcess è¯»å– è·å–å¤–éƒ¨ç¨‹åºçš„æ ‡å‡†è¾“å‡ºé”™è¯¯ [!IMPORTANT]å¾ˆå¤šåˆå­¦è€…æåè¯»å†™æ–¹å‘ã€‚è®°ä½ï¼šä½ æ˜¯åœ¨â€å–‚æ•°æ®â€ç»™å¤–éƒ¨ç¨‹åºï¼ŒåŒæ—¶â€æ”¶é›†â€å®ƒçš„äº§å‡ºã€‚ 1.3 å¹³å°æ”¯æŒä¸æ”¯æŒçš„å¹³å°ï¼šVxWorksã€iOSã€tvOSã€watchOSã€UWP[^1]ã€‚è¿™äº›å¹³å°å› æ“ä½œç³»ç»Ÿé™åˆ¶æ— æ³•æä¾›æ ‡å‡†è¿›ç¨‹æœºåˆ¶ã€‚ æ¡Œé¢å¹³å°ï¼ˆWindowsã€macOSã€Linuxï¼‰å…¨é¢æ”¯æŒï¼Œæ”¾å¿ƒä½¿ç”¨ã€‚ äºŒã€è¿›ç¨‹å¯åŠ¨æ–¹å¼2.1 ä¸¤ç§å¯åŠ¨é£æ ¼ä¸€ä½“åŒ–æ–¹å¼â€”â€”ç¨‹åºè·¯å¾„å’Œå‚æ•°ä¸€æ¬¡ä¼ å…¥ï¼š QProcess process;process.start(notepad.exe, QStringList() C:\\\\temp\\\\readme.txt); åˆ†ç¦»å¼æ–¹å¼â€”â€”å…ˆé…ç½®åå¯åŠ¨ï¼š QProcess process;process.setProgram(notepad.exe);process.setArguments(C:\\\\temp\\\\readme.txt);process.start(); // æˆ– process.open() ä¸¤ç§æ–¹å¼åŠŸèƒ½ç›¸åŒï¼Œåˆ†ç¦»å¼æ›´é€‚åˆéœ€è¦åŠ¨æ€é…ç½®å‚æ•°çš„åœºæ™¯ã€‚ 2.2 å‚æ•°ä¼ é€’çš„æ­£ç¡®å§¿åŠ¿Qt ä½¿ç”¨ QStringList å­˜å‚¨å‚æ•°ï¼Œè‡ªåŠ¨å¤„ç†ç©ºæ ¼å’Œå¼•å·é—®é¢˜ï¼š // å‚æ•°åŒ…å«ç©ºæ ¼ï¼ŸQt è‡ªåŠ¨å¤„ç†QStringList args;args --input C:\\\\Program Files\\\\data.txt;// å®é™…æ‰§è¡Œ: program --input C:\\Program Files\\data.txt [!WARNING]è‡´å‘½é™·é˜±ï¼šä½¿ç”¨ write() å‘è¿›ç¨‹å‘é€å‘½ä»¤æ—¶ï¼Œå¿…é¡»æ‰‹åŠ¨æ·»åŠ æ¢è¡Œç¬¦ï¼ Windows: process.write(dir\\r ); LinuxmacOS: process.write(ls ); äº¤äº’å¼ç¨‹åºä»¥æ¢è¡Œç¬¦åˆ¤æ–­å‘½ä»¤ç»“æŸï¼Œç¼ºå°‘å®ƒå‘½ä»¤æ ¹æœ¬ä¸ä¼šæ‰§è¡Œã€‚ 2.3 è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸstateDiagram-v2 [*] -- NotRunning: åˆ›å»ºå®ä¾‹ NotRunning -- Starting: start() è°ƒç”¨ Starting -- Running: å¯åŠ¨æˆåŠŸ Running -- NotRunning: æ­£å¸¸é€€å‡º Running -- NotRunning: å¼‚å¸¸å´©æºƒ NotRunning -- [*] å…³é”®ä¿¡å·ï¼š ä¿¡å· è§¦å‘æ—¶æœº å‚æ•° started() è¿›ç¨‹æˆåŠŸå¯åŠ¨ æ—  finished(int, ExitStatus) è¿›ç¨‹ç»“æŸ é€€å‡ºç  + æ­£å¸¸å´©æºƒçŠ¶æ€ errorOccurred(ProcessError) å‘ç”Ÿé”™è¯¯ é”™è¯¯ç±»å‹æšä¸¾ connect(process, QProcess::finished, [](int exitCode, QProcess::ExitStatus status) if (status == QProcess::NormalExit) qDebug() æ­£å¸¸é€€å‡ºï¼Œé€€å‡ºç : exitCode; else qDebug() è¿›ç¨‹å´©æºƒ; ); ä¸‰ã€è¾“å‡ºé€šé“ç®¡ç†3.1 åŒé€šé“ç‹¬ç«‹è¯»å–å¤–éƒ¨è¿›ç¨‹æœ‰ä¸¤ä¸ªè¾“å‡ºé€šé“ï¼š stdoutï¼šæ­£å¸¸è¾“å‡ºï¼ˆç¨‹åºè¿è¡Œç»“æœï¼‰ stderrï¼šé”™è¯¯è¾“å‡ºï¼ˆè­¦å‘Šã€å¼‚å¸¸ä¿¡æ¯ï¼‰ åˆ†åˆ«è¯»å–ï¼š connect(process, QProcess::readyReadStandardOutput, []() qDebug() stdout: process.readAllStandardOutput(););connect(process, QProcess::readyReadStandardError, []() qDebug() stderr: process.readAllStandardError();); 3.2 é€šé“åˆå¹¶ä¸è½¬å‘åˆå¹¶æ¨¡å¼â€”â€”stdout å’Œ stderr ç»Ÿä¸€è¯»å–ï¼š process.setProcessChannelMode(QProcess::MergedChannels);process.start(myapp.exe);// å…¨éƒ¨ä» readAllStandardOutput() è·å– è½¬å‘æ¨¡å¼â€”â€”è¾“å‡ºç›´æ¥ä¼ é€’ç»™çˆ¶è¿›ç¨‹ï¼š process.setProcessChannelMode(QProcess::ForwardedOutputChannel);// å¤–éƒ¨è¿›ç¨‹çš„ stdout ç›´æ¥æ‰“å°åˆ°æ§åˆ¶å° [!TIP]GUI åº”ç”¨æ…ç”¨è½¬å‘æ¨¡å¼ï¼Œé”™è¯¯ä¿¡æ¯ä¼šâ€æ¶ˆå¤±â€åœ¨æ§åˆ¶å°è€Œéæ˜¾ç¤ºç»™ç”¨æˆ·ã€‚ 3.3 æ•°æ®è¯»å–ç­–ç•¥å¯¹æ¯” æ–¹å¼ é€‚ç”¨åœºæ™¯ æ˜¯å¦é˜»å¡ ä¿¡å·æ§½ï¼ˆæ¨èï¼‰ GUI åº”ç”¨ å¦ waitForReadyRead() åå°çº¿ç¨‹ã€CLI å·¥å…· æ˜¯ è½®è¯¢ bytesAvailable() ç‰¹æ®Šåœºæ™¯ å–å†³äºå®ç° // ã€æ¨èã€‘ä¿¡å·æ§½æ–¹å¼connect(process, QProcess::readyReadStandardOutput, []() handleOutput(process.readAllStandardOutput()););// ã€é˜»å¡ã€‘åŒæ­¥ç­‰å¾…process.waitForReadyRead(5000); // æœ€å¤šç­‰5ç§’QByteArray data = process.readAll(); å››ã€ç¯å¢ƒä¸ç›®å½•é…ç½®4.1 è®¾ç½®ç¯å¢ƒå˜é‡QProcessEnvironment env = QProcessEnvironment::systemEnvironment();env.insert(PATH, env.value(PATH) + :/usr/local/bin);env.insert(MY_CONFIG, /etc/app.conf);env.remove(UNWANTED_VAR);process.setProcessEnvironment(env); [!CAUTION]setProcessEnvironment() ä¼šå®Œå…¨æ›¿æ¢å­è¿›ç¨‹ç¯å¢ƒã€‚å¦‚éœ€ç»§æ‰¿çˆ¶è¿›ç¨‹å˜é‡ï¼Œå¿…é¡»å…ˆè°ƒç”¨ systemEnvironment() è·å–åŸºç¡€ç¯å¢ƒã€‚ 4.2 è®¾ç½®å·¥ä½œç›®å½•process.setWorkingDirectory(C:\\\\output);process.start(converter.exe); // converter å°†åœ¨ C:\\output ä¸‹è¿è¡Œ QNX å¹³å°ç‰¹ä¾‹ï¼šè®¾ç½®å·¥ä½œç›®å½•å¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹çŸ­æš‚å†»ç»“[^2]ã€‚ 4.3 çª—å£å®šä½ï¼ˆGUI ç¨‹åºï¼‰Qt 5 åº”ç”¨å¯é€šè¿‡ -qwindowgeometry å‚æ•°æŒ‡å®šåˆå§‹çª—å£ä½ç½®ï¼š process.start(myguiapp, -qwindowgeometry, 100,100,800,600);// çª—å£å·¦ä¸Šè§’ (100,100)ï¼Œå°ºå¯¸ 800x600 äº”ã€åŒæ­¥ä¸å¼‚æ­¥ç¼–ç¨‹5.1 åŒæ­¥ APIï¼ˆé˜»å¡å¼ï¼‰é€‚ç”¨äºåå°çº¿ç¨‹æˆ– CLI å·¥å…·ï¼š QProcess gzip;gzip.start(gzip, -c);if (!gzip.waitForStarted()) return false;gzip.write(Hello Qt!);gzip.closeWriteChannel(); // â† å¿…é¡»å…³é—­ï¼Œå¦åˆ™ gzip æŒç»­ç­‰å¾…è¾“å…¥if (!gzip.waitForFinished(30000)) // 30ç§’è¶…æ—¶ gzip.kill(); return false;QByteArray compressed = gzip.readAll(); [!WARNING]ç»å¯¹ç¦æ­¢åœ¨ä¸»çº¿ç¨‹è°ƒç”¨ waitFor*() ç³»åˆ—å‡½æ•°â€”â€”ç•Œé¢ä¼šå®Œå…¨å†»ç»“ï¼ 5.2 å¼‚æ­¥æ¨¡å¼ï¼ˆæ¨èï¼‰GUI åº”ç”¨çš„æ ‡å‡†åšæ³•ï¼š class ProcessController : public QObject Q_OBJECTpublic: void run(const QString cmd) connect(m_proc, QProcess::readyReadStandardOutput, this, ProcessController::onOutput); connect(m_proc, QProcess::finished, this, ProcessController::onFinished); m_proc.start(cmd); signals: void outputReady(const QString text); void completed(int exitCode);private slots: void onOutput() emit outputReady(QString::fromLocal8Bit(m_proc.readAll())); void onFinished(int code, QProcess::ExitStatus status) emit completed(status == QProcess::NormalExit ? code : -1); private: QProcess m_proc;; 5.3 è¶…æ—¶ä¸ä¼˜é›…é€€å‡º// è®¾ç½®è¶…æ—¶if (!process.waitForFinished(30000)) // å…ˆå°è¯•ä¼˜é›…é€€å‡º process.terminate(); if (!process.waitForFinished(5000)) // å¼ºåˆ¶ç»ˆæ­¢ process.kill(); terminate() å‘é€ç»ˆæ­¢ä¿¡å·ï¼Œå…è®¸è¿›ç¨‹ä¿å­˜çŠ¶æ€ï¼›kill() ç«‹å³å¼ºæ€ï¼Œå¯èƒ½å¯¼è‡´èµ„æºæ³„æ¼ã€‚ å…­ã€è·¨å¹³å°å®æˆ˜6.1 Windows å†…éƒ¨å‘½ä»¤é™·é˜±dirã€typeã€copy ç­‰ä¸æ˜¯ç‹¬ç«‹ç¨‹åºï¼Œæ˜¯ cmd.exe çš„å†…ç½®å‘½ä»¤[^3]ã€‚å¿…é¡»é€šè¿‡ cmd æ‰§è¡Œï¼š // âŒ é”™è¯¯ï¼šæ‰¾ä¸åˆ° dir.exeprocess.start(dir);// âœ… æ­£ç¡®process.start(cmd, /c, dir C:\\\\); å‚æ•° å«ä¹‰ /c æ‰§è¡Œå®Œå‘½ä»¤åé€€å‡º /k æ‰§è¡Œåä¿æŒçª—å£ å¤šæ¡å‘½ä»¤ç”¨ æˆ– è¿æ¥ï¼š process.start(cmd, /c, cd /d D: dir echo Done); 6.2 LinuxmacOS ç®¡é“ä¸é‡å®šå‘Qt æ— æ³•ç›´æ¥è¯†åˆ« |ã€ã€ ç­‰ Shell ç‰¹æ®Šå­—ç¬¦ï¼Œå¿…é¡»é€šè¿‡ bash è§£é‡Šï¼š // âŒ é”™è¯¯ï¼šQt ä¼šå¯»æ‰¾åä¸º ps -ef | grep main çš„ç¨‹åºprocess.start(ps -ef | grep main);// âœ… æ­£ç¡®process.start(bash, -c, ps -ef | grep main);// é‡å®šå‘process.start(bash, -c, ls -la listing.txt); 6.3 è·¨å¹³å°å·¥å…·ç±»class CrossPlatformProcess : public QObject Q_OBJECTpublic: bool execute(const QString command, int timeoutMs = 30000) m_stdout.clear(); m_stderr.clear();#ifdef Q_OS_WIN m_process.start(cmd, /c, command);#else m_process.start(bash, -c, command);#endif if (!m_process.waitForStarted()) m_error = å¯åŠ¨å¤±è´¥; return false; if (!m_process.waitForFinished(timeoutMs)) m_error = æ‰§è¡Œè¶…æ—¶; m_process.kill(); return false; m_stdout = m_process.readAllStandardOutput(); m_stderr = m_process.readAllStandardError(); return m_process.exitStatus() == QProcess::NormalExit; QByteArray standardOutput() const return m_stdout; QByteArray standardError() const return m_stderr; QString lastError() const return m_error; private: QProcess m_process; QByteArray m_stdout, m_stderr; QString m_error;; ä½¿ç”¨ç¤ºä¾‹ï¼š CrossPlatformProcess proc;if (proc.execute(git status)) qDebug() proc.standardOutput(); else qDebug() Error: proc.lastError(); ä¸ƒã€æœ€ä½³å®è·µæ¸…å• GUI åº”ç”¨å¿…é¡»ä½¿ç”¨å¼‚æ­¥æ¨¡å¼â€”â€”ä¿¡å·æ§½å¤„ç†è¾“å‡ºï¼Œç»ä¸è°ƒç”¨ waitFor*() å§‹ç»ˆæ£€æŸ¥è¿”å›å€¼â€”â€”start() åæ£€æŸ¥ waitForStarted() æˆ–è¿æ¥ errorOccurred() ä¿¡å· åˆç†è®¾ç½®è¶…æ—¶â€”â€”é˜²æ­¢å¤–éƒ¨è¿›ç¨‹æŒ‚èµ·å¯¼è‡´ç¨‹åºå¡æ­» å¹³å°æ¡ä»¶ç¼–è¯‘â€”â€”#ifdef Q_OS_WIN åŒºåˆ†å‘½ä»¤è§£é‡Šå™¨ å®‰å…¨è€ƒè™‘â€”â€”æ°¸è¿œä¸è¦å°†ç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥è¿›å‘½ä»¤ï¼Œä½¿ç”¨å‚æ•°åˆ—è¡¨ä¼ é€’ èµ„æºæ¸…ç†â€”â€”è¶…æ—¶åå…ˆ terminate()ï¼Œå† kill()ï¼Œç¡®ä¿é‡Šæ”¾èµ„æº å‚è€ƒæ¥æº[^1]: Qt Documentation - QProcess Platform Notes[^2]: Qt Documentation - QProcess and QNX Working Directory[^3]: CSDN - Qtæ‰§è¡ŒWindowså‘½ä»¤è¡Œæ–¹å¼","tags":["qt","qprocess","cpp","è¿›ç¨‹é€šä¿¡","è·¨å¹³å°å¼€å‘","ç³»ç»Ÿç¼–ç¨‹"],"categories":["3.å¼€å‘æ¡†æ¶","Qt","Publish"]},{"title":"C++ä¸­çš„friend class ç”¨æ³•æ€»ç»“-CSDNåšå®¢","path":"/2025/07/19/2-ç¼–ç¨‹è¯­è¨€-CPP-C-ä¸­çš„friend-class-ç”¨æ³•æ€»ç»“-CSDNåšå®¢/","content":"Friend Classesï¼ˆå‹å…ƒç±»ï¼‰C++ä¸­çš„ friend å…³é”®å­—å…¶å®åšè¿™æ ·çš„äº‹æƒ…ï¼šåœ¨ä¸€ä¸ªç±»ä¸­æŒ‡æ˜å…¶ä»–çš„ç±»ï¼ˆæˆ–è€…ï¼‰å‡½æ•°èƒ½å¤Ÿç›´æ¥è®¿é—®è¯¥ç±»ä¸­çš„ private å’Œ protected æˆå‘˜ã€‚ ä½ å¯ä»¥è¿™æ ·æ¥æŒ‡æ˜ï¼š friend class aClass; æ³¨æ„ï¼šfriend åœ¨ç±»ä¸­çš„å£°æ˜å¯ä»¥å† publicã€protected å’Œ private çš„å¦‚ä½•ä¸€ä¸ªæ§åˆ¶åŸŸä¸­ï¼Œè€Œä¸å½±å“å…¶æ•ˆæœã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨ protected åŸŸä¸­æœ‰è¿™æ ·çš„å£°æ˜ï¼Œé‚£ä¹ˆ aClass ç±»åŒæ ·å¯ä»¥è®¿é—®è¯¥ç±»çš„ private æˆå‘˜ã€‚ è¿™æœ‰ä¸€ä¸ªä¾‹å­ï¼š class Nodeprivate:int data;int key;//...friend class BinaryTree; // class BinaryTree can now access data directly; è¿™æ · BinaryTree å°±å¯ä»¥ç›´æ¥è®¿é—® Node ä¸­çš„ private çš„æˆå‘˜äº†ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š class BinaryTreeprivate:Node *root;int find(int key);;int BinaryTree::find(int key)// check root for NULL...if(root-key == key)// no need to go through an accessor functionreturn root-data;// perform rest of find Friend Functionsï¼ˆå‹å…ƒå‡½æ•°ï¼‰å‹å…ƒå‡½æ•°å’Œå‹å…ƒç±»çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œå®ƒå…è®¸ä¸€ä¸ªå‡½æ•°ä¸éœ€è¦é€šè¿‡å…¶ public æ¥å£å°±èƒ½å¤Ÿè®¿é—®åˆ°ç±»ä¸­çš„ private å’Œ protected æˆå‘˜å˜é‡ã€‚ ä½ å¯ä»¥è¿™æ ·å»å£°æ˜ï¼š friend return_type class_name::function(args); è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­ï¼š class Node private: int data; int key; // ... friend int BinaryTree::find(); // Only BinaryTrees find function has access; è¿™æ · find æ–¹æ³•å°±å¯ä»¥ç›´æ¥è®¿é—® Node ä¸­çš„ç§æœ‰æˆå‘˜å˜é‡äº†ï¼Œè€Œ BinaryTree ä¸­çš„å…¶ä»–çš„æ–¹æ³•å»ä¸èƒ½å¤Ÿç›´æ¥çš„è®¿é—® Node çš„æˆå‘˜å˜é‡ã€‚ï¼ˆè¿™å°±æ˜¯å‹å…ƒç±»å’Œå‹å…ƒå‡½æ•°çš„åŒºåˆ«ï¼‰ C++ä¸­çš„å‹å…ƒæœºåˆ¶å…è®¸ç±»çš„éå…¬æœ‰æˆå‘˜è¢«ä¸€ä¸ªç±»æˆ–è€…å‡½æ•°è®¿é—®ï¼Œå‹å…ƒæŒ‰ç±»å‹åˆ†ä¸ºä¸‰ç§ï¼šæ™®é€šéç±»æˆå‘˜å‡½æ•°ä½œä¸ºå‹å…ƒ,ç±»çš„æˆå‘˜å‡½æ•°ä½œä¸ºå‹å…ƒï¼Œç±»ä½œä¸ºå‹å…ƒã€‚ å‹å…ƒçš„å†…å®¹å‹å…ƒåŒ…æ‹¬å‹å…ƒçš„å£°æ˜ä»¥åŠå‹å…ƒçš„å®šä¹‰ã€‚å‹å…ƒçš„å£°æ˜é»˜è®¤ä¸ºäº† externï¼Œå°±æ˜¯è¯´å‹å…ƒç±»æˆ–è€…å‹å…ƒå‡½æ•°çš„ä½œç”¨åŸŸå·²ç»æ‰©å±•åˆ°äº†åŒ…å«è¯¥ç±»å®šä¹‰çš„ä½œç”¨åŸŸï¼Œæ‰€ä»¥å³ä¾¿æˆ‘ä»¬åœ¨ç±»çš„å†…éƒ¨å®šä¹‰å‹å…ƒå‡½æ•°ä¹Ÿæ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚ 2 æ™®é€šçš„éæˆå‘˜å‡½æ•°å‹å…ƒè¿™ç±»å‹å…ƒå‡½æ•°é€šå¸¸æ˜¯æ“ä½œç¬¦ï¼Œä¾‹å¦‚è¾“å…¥è¾“å‡ºæ“ä½œç¬¦.ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š //OpeClass.h#pragma onceclass OpeClassfriend int func(const OpeClass xx);public:OpeClass(void);OpeClass(int x,int y);~OpeClass(void);private:int width;int height;; //OpeClass.cpp#include OpeClass.hOpeClass::OpeClass(void)width = 50;height = 50;OpeClass::OpeClass(int x,int y):width(x),height(y)OpeClass::~OpeClass(void)int func(const OpeClass xx)return xx.height \\* xx.width; //main.cpp#include OpeClass.h#include iostreamusing namespace std;void main()OpeClass XO;coutfunc(XO);system(pause); 3 ç±»ä½œä¸ºå‹å…ƒç±»ä½œä¸ºå‹å…ƒéœ€è¦æ³¨æ„çš„æ˜¯å‹å…ƒç±»å’ŒåŸå§‹ç±»ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»ï¼Œå¦‚æœåœ¨å‹å…ƒç±»ä¸­å®šä¹‰çš„å‡½æ•°ä½¿ç”¨åˆ°äº†åŸå§‹ç±»çš„ç§æœ‰å˜é‡ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨å‹å…ƒç±»å®šä¹‰çš„æ–‡ä»¶ä¸­åŒ…å«åŸå§‹ç±»å®šä¹‰çš„å¤´æ–‡ä»¶ã€‚ä½†æ˜¯åœ¨åŸå§‹ç±»çš„å®šä¹‰ä¸­ï¼ˆåŒ…å«å‹å…ƒç±»å£°æ˜çš„é‚£ä¸ªç±»ï¼‰ï¼Œå°±ä¸éœ€è¦åŒ…å«å‹å…ƒç±»çš„å¤´æ–‡ä»¶ï¼Œä¹Ÿä¸éœ€è¦åœ¨ç±»å®šä¹‰å‰å»å£°æ˜å‹å…ƒç±»ï¼Œå› ä¸ºå‹å…ƒç±»çš„å£°æ˜è‡ªèº«å°±æ˜¯ä¸€ç§å£°æ˜ï¼ˆå®ƒæŒ‡æ˜å¯ä»¥åœ¨ç±»å¤–æ‰¾åˆ°å‹å…ƒç±»ï¼‰ï¼Œç¤ºä¾‹ç¨‹åºå¦‚ä¸‹æ‰€ç¤ºï¼š //A.h#pragma once#include iostreamusing namespace std;class Afriend class B;public:~A(void);static void func()cout This is in A endl;private:A();static const A Test;; //A.cpp#include A.hconst A A::Test = A();A::~A(void) //B.h#pragma once#include C.hclass Bpublic:B(void);~B(void);void func(C c);; //B.cpp#include B.h#include A.h#include C.h#include iostreamusing namespace std;B::B(void)B::~B(void)void B::func(C c)cout This is in B endl;A::Test.func();c.func(A::Test); //C.h#pragma onceclass A;class Cpublic:C(void);~C(void);void func(const A a);; //C.cpp#include C.h#include iostreamusing namespace std;C::C(void)C::~C(void)void C::func(const A a)cout This is in C endl; //main.cpp#include A.h#include B.h#include C.h#include iostreamusing namespace std;void main()B b;C c;b.func(c);system(pause); 4 ç±»æˆå‘˜å‡½æ•°ä½œä¸ºå‹å…ƒå‡½æ•°è¿™ä¸ªç¨å¾®æœ‰ç‚¹å¤æ‚ï¼Œå› ä¸ºä½ è¦ç±»æˆå‘˜å‡½æ•°ä½œä¸ºå‹å…ƒï¼Œä½ åœ¨å£°æ˜å‹å…ƒçš„æ—¶å€™è¦ç”¨ç±»é™å®šç¬¦ï¼Œæ‰€ä»¥å¿…é¡»å…ˆå®šä¹‰åŒ…å« s å‹å…ƒå‡½æ•°çš„ç±»ï¼Œä½†æ˜¯åœ¨å®šä¹‰å‹å…ƒçš„å‡½æ•°æ—¶å€™ï¼Œåˆå¿…é¡»äº‹å…ˆå®šä¹‰åŸå§‹ç±»ã€‚é€šå¸¸çš„åšæ³•å…ˆå®šä¹‰åŒ…å«å‹å…ƒå‡½æ•°çš„ç±»ï¼Œå†å®šä¹‰åŸå§‹ç±»ï¼Œè¿™ä¸ªé¡ºåºä¸èƒ½ä¹±ã€‚(å¦‚æœæ˜¯å‹å…ƒç±»ï¼Œåˆ™æ²¡æœ‰è¿™ç§è¿™ç§å¿…é¡»)å¦‚ä¸‹é¢æ‰€ç¤ºï¼š //B.h#pragma onceclass A;class Bpublic:B(void);~B(void);int func(A xx);; //A.h#pragma once#include B.hclass Afriend int B::func(A xx);public:A(void):mx(20),my(30)~A(void)private:int mx;int my;; //B.cpp#include B.h#include A.hB::B(void)B::~B(void)int B::func(A xx)return xx.mx \\* xx.my; //main.cpp#include A.h#include B.h#include iostreamusing namespace std;void main()A a;B b;coutb.func(a)endl;system(pause); 5 å‹å…ƒä¸å…·æœ‰ç›¸äº’æ€§ï¼Œåªå…·æœ‰å•é¡¹æ€§ è‹¥ç±» B æ˜¯ç±» A çš„å‹å…ƒï¼Œç±» A ä¸ä¸€å®šæ˜¯ç±» B çš„å‹å…ƒï¼Œè¦çœ‹åœ¨ç±»ä¸­æ˜¯å¦æœ‰ç›¸åº”çš„å£°æ˜ã€‚ 6 å‹å…ƒä¸èƒ½è¢«ç»§æ‰¿B æ˜¯ A çš„å‹å…ƒç±»ï¼ŒC æ˜¯ B çš„å­ç±»ï¼Œæ¨ä¸å‡º C æ˜¯ A çš„å‹å…ƒ 7 å‹å…ƒä¸å…·æœ‰ä¼ é€’æ€§B æ˜¯ A çš„å‹å…ƒï¼ŒC æ˜¯ B çš„å‹å…ƒï¼Œæ¨ä¸å‡º C æ˜¯ A çš„å‹å…ƒ 8 ç›¸äº’ä¸ºå‹å…ƒçš„ç±»è¿™ä¸ªå…¶å®æ²¡ä»€ä¹ˆå¥½æ³¨æ„çš„ï¼Œä¸‹é¢æ˜¯å®ä¾‹ï¼Œç±» Aï¼Œç±» B äº’ä¸ºå‹å…ƒ //A.h#pragma onceclass Afriend class B;public:A(void);~A(void);int funa(B b);private:int mx;int my;; //A.cpp#include A.h#include B.hA::A(void)mx = 10;my = 10;A::~A(void)int A::funa(B b)return b.mb \\* b.mc; //B.h#pragma onceclass Bfriend class A;public:B(void);~B(void);int funb(A a);private:int mb;int mc;; //B.cpp#include B.h#include A.hB::B(void)mb = 20;mc = 20;B::~B(void)int B::funb(A a)return a.mx \\*a.my; //main.cpp#include A.h#include B.h#include iostreamusing namespace std;void main()A a;B b;couta.funa(b)endl;coutb.funb(a)endl;system(pause); 9 å¦‚æœæƒ³è¦æŒ‡å®šä¸¤ä¸ªç±»éƒ½æœ‰æˆå‘˜å‡½æ•°ä½œä¸ºå¯¹æ–¹çš„å‹å…ƒï¼Œé‚£ä¹ˆå¿…é¡»ç¬¬ 2 ä¸ªç±»æ˜¯ç¬¬ä¸€ä¸ªç±»çš„å‹å…ƒ//A.h#pragma once// class B is a friend class of Aclass Afriend class B;public:A(void):ma(10),mb(20)~A(void)int funa(B b);private:int ma;int mb;; //B.h#pragma once#include A.h// As function funa is a friend function of Bclass Bfriend int A::funa(B b);public:B(void);~B(void);int funb(A a);int func(A a);private:int mx;int my;; //A.cpp#include A.h#include B.hint A::funa(B b)return b.mx \\* b.my; //B.cpp#include B.hB::B(void):mx(12),my(15)B::~B(void)int B::funb(A a)return a.ma + a.mb;int B::func(A a)return a.ma \\* a.mb; //main.cpp#include A.h#include B.h#include iostreamusing namespace std;void main()A a;B b;couta.funa(b)endl;coutb.funb(a)endl;coutb.func(a)endl;","categories":["2.ç¼–ç¨‹è¯­è¨€","CPP"]},{"title":"Qt å®šæ—¶å™¨å®Œå…¨æŒ‡å—ï¼šQTimer ä»å…¥é—¨åˆ°ç²¾é€š","path":"/2025/07/19/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qt-QTimerå®šæ—¶å™¨/","content":"æ ¸å¿ƒæ¦‚å¿µQt çš„å®šæ—¶å™¨ç³»ç»ŸåŸºäºäº‹ä»¶å¾ªç¯æœºåˆ¶è¿ä½œã€‚QObject ä½œä¸ºæ‰€æœ‰ Qt å¯¹è±¡çš„åŸºç±»ï¼Œæä¾›äº†åŸºç¡€çš„å®šæ—¶å™¨æ”¯æŒã€‚å®šæ—¶å™¨é€šè¿‡å‘¨æœŸæ€§è§¦å‘äº‹ä»¶æ¥æ‰§è¡Œé¢„å®šæ“ä½œï¼Œå…¶å·¥ä½œä¾èµ–äºåº”ç”¨ç¨‹åºçš„äº‹ä»¶å¾ªç¯æ­£å¸¸è¿è¡Œã€‚ äº‹ä»¶å¾ªç¯ä¾èµ–å®šæ—¶å™¨äº‹ä»¶åªæœ‰åœ¨äº‹ä»¶å¾ªç¯è¿è¡Œæ—¶æ‰èƒ½ä¼ é€’ã€‚å¿…é¡»è°ƒç”¨ QCoreApplication::exec() å¯åŠ¨äº‹ä»¶å¾ªç¯åï¼Œå®šæ—¶å™¨æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚å½“åº”ç”¨ç¨‹åºå¿™äºå¤„ç†å…¶ä»–äº‹ä»¶æ—¶ï¼Œå®šæ—¶å™¨è§¦å‘å¯èƒ½ä¼šå»¶è¿Ÿâ€”â€”å®šæ—¶å™¨çš„å‡†ç¡®æ€§å–å†³äºåº”ç”¨ç¨‹åºçš„å“åº”ç²’åº¦ã€‚ å®šæ—¶å™¨ç”Ÿå‘½å‘¨æœŸä½¿ç”¨ QObject::startTimer() å¯åŠ¨å®šæ—¶å™¨æ—¶ï¼š ä»¥æ¯«ç§’ä¸ºå•ä½æŒ‡å®šè§¦å‘é—´éš” è¿”å›å”¯ä¸€çš„æ•´æ•°å®šæ—¶å™¨ ID å®šæ—¶å™¨æŒç»­è§¦å‘ç›´åˆ°æ˜¾å¼è°ƒç”¨ QObject::killTimer() ç»ˆæ­¢ int timerId = startTimer(1000); // å¯åŠ¨å®šæ—¶å™¨ï¼Œæ¯ 1000ms è§¦å‘ä¸€æ¬¡// ... ä½¿ç”¨å®šæ—¶å™¨ ...killTimer(timerId); // ç»ˆæ­¢å®šæ—¶å™¨ QTimer åŸºç¡€ç”¨æ³•QTimer æ˜¯ Qt æä¾›çš„é«˜çº§å®šæ—¶å™¨ APIï¼Œç»§æ‰¿è‡ª QObjectï¼Œé€šè¿‡ä¿¡å·æ§½æœºåˆ¶æä¾›ç®€æ´çš„ç¼–ç¨‹æ¥å£ã€‚ æ ‡å‡†ä½¿ç”¨æ¨¡å¼QTimer *timer = new QTimer(this);connect(timer, QTimer::timeout, this, MyClass::onTimeout);timer-start(1000); // æ¯ 1000ms è§¦å‘ä¸€æ¬¡ å…³é”®ç‚¹è¯´æ˜ï¼š å°† QTimer åˆ›å»ºä¸ºå½“å‰å¯¹è±¡çš„å­å¯¹è±¡ï¼Œåˆ©ç”¨ Qt çš„å¯¹è±¡æ ‘è‡ªåŠ¨ç®¡ç†å†…å­˜ timeout() ä¿¡å·åœ¨æ¯æ¬¡å®šæ—¶å™¨è¶…æ—¶æ—¶å‘å‡º start(interval) è®¾ç½®é—´éš”å¹¶å¯åŠ¨å®šæ—¶å™¨ å•æ¬¡å®šæ—¶å™¨å¯¹äºåªéœ€æ‰§è¡Œä¸€æ¬¡çš„å»¶æ—¶æ“ä½œï¼Œæ¨èä½¿ç”¨é™æ€æ–¹æ³•ï¼š QTimer::singleShot(200, this, MyClass::delayedAction); æ‰§è¡Œå 200ms è°ƒç”¨ delayedAction() æ§½å‡½æ•°ã€‚ä¹Ÿå¯é€šè¿‡å®ä¾‹æ–¹æ³•å®ç°ï¼š timer-setSingleShot(true);timer-start(200); é›¶é—´éš”å®šæ—¶å™¨interval å±æ€§é»˜è®¤å€¼ä¸º 0ã€‚è¶…æ—¶é—´éš”ä¸º 0 çš„å®šæ—¶å™¨ä¼šåœ¨äº‹ä»¶é˜Ÿåˆ—ä¸­æ‰€æœ‰å¾…å¤„ç†äº‹ä»¶å¤„ç†å®Œæ¯•åç«‹å³è¶…æ—¶ï¼Œé€‚ç”¨äºéœ€è¦æŒç»­å¤„ç†ä½†åˆè¦ä¿æŒ UI å“åº”çš„åœºæ™¯ï¼š QTimer *timer = new QTimer(this);connect(timer, QTimer::timeout, this, MyClass::processOneItem);timer-start(); // interval é»˜è®¤ä¸º 0 [!TIP]é›¶é—´éš”å®šæ—¶å™¨å¯ç”¨äºåˆ†ç‰‡å¤„ç†å¤§é‡æ•°æ®ï¼Œè®© UI ä¿æŒå“åº”ã€‚ä½†éšç€å¤šçº¿ç¨‹æŠ€æœ¯çš„æ™®åŠï¼Œæ­¤æ¨¡å¼æ­£é€æ¸è¢« QThread æ›¿ä»£ã€‚ å¤šçº¿ç¨‹ç¯å¢ƒçº¿ç¨‹äº²å’Œæ€§è§„åˆ™Qt ä½¿ç”¨çº¿ç¨‹äº²å’Œæ€§ï¼ˆThread Affinityï¼‰ ç¡®å®šç”±å“ªä¸ªçº¿ç¨‹å‘å‡º timeout() ä¿¡å·ã€‚æ ¸å¿ƒè§„åˆ™ï¼š æ“ä½œ çº¿ç¨‹è¦æ±‚ åˆ›å»ºå®šæ—¶å™¨ ä»»æ„çº¿ç¨‹ å¯åŠ¨åœæ­¢å®šæ—¶å™¨ å¿…é¡»åœ¨å®šæ—¶å™¨æ‰€å±çº¿ç¨‹ æ¥æ”¶ timeout ä¿¡å· ç”±å®šæ—¶å™¨æ‰€å±çº¿ç¨‹å‘å‡º [!CAUTION]ä¸èƒ½ä»å…¶ä»–çº¿ç¨‹å¯åŠ¨æˆ–åœæ­¢å®šæ—¶å™¨ã€‚è¿åæ­¤è§„åˆ™å°†å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚ é GUI çº¿ç¨‹ä¸­ä½¿ç”¨åœ¨é GUI çº¿ç¨‹ä¸­ä½¿ç”¨å®šæ—¶å™¨ï¼Œéœ€å¯åŠ¨è¯¥çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯ï¼š class WorkerThread : public QThread void run() override QTimer timer; connect(timer, QTimer::timeout, this, WorkerThread::doWork); timer.start(1000); exec(); // å¯åŠ¨çº¿ç¨‹äº‹ä»¶å¾ªç¯ â† å…³é”®æ­¥éª¤ ; å®šæ—¶å™¨ç²¾åº¦ä¸ç±»å‹å®šæ—¶å™¨ç²¾åº¦å—åº•å±‚æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶å½±å“ï¼Œå¯é€šè¿‡ Qt::TimerType æšä¸¾æ§åˆ¶ç²¾åº¦çº§åˆ«ã€‚ ç²¾åº¦ç±»å‹å¯¹æ¯” ç±»å‹ ç²¾åº¦ç›®æ ‡ é€‚ç”¨åœºæ™¯ Qt::PreciseTimer æ¯«ç§’çº§ç²¾åº¦ åŠ¨ç”»ã€å®æ—¶å¤„ç† Qt::CoarseTimer Â±5% è¯¯å·®èŒƒå›´ å¸¸è§„ä¸šåŠ¡é€»è¾‘ Qt::VeryCoarseTimer ç§’çº§ç²¾åº¦ï¼ˆå››èˆäº”å…¥ï¼‰ è¶…æ—¶æ£€æµ‹ã€å¿ƒè·³ å¹³å°ç‰¹æ€§UNIX ç³»ç»Ÿï¼ˆLinuxã€macOSã€iOSï¼‰ï¼š PreciseTimer ä¿æŒæ¯«ç§’ç²¾åº¦ CoarseTimer ä¼šè‡ªåŠ¨å¯¹é½ç›¸è¿‘è§¦å‘æ—¶é—´çš„å®šæ—¶å™¨ï¼Œå‡å°‘ CPU å”¤é†’æ¬¡æ•°ä»¥é™ä½åŠŸè€— Windows ç³»ç»Ÿï¼š PreciseTimer ä½¿ç”¨å¤šåª’ä½“å®šæ—¶å™¨ï¼ˆMultimedia Timerï¼‰ CoarseTimer å’Œ VeryCoarseTimer ä½¿ç”¨æ ‡å‡† Windows å®šæ—¶å™¨ ç²¾åº¦é™åˆ¶ å¹³å° å…¸å‹ç²¾åº¦ Windows 2000 15 æ¯«ç§’ ç°ä»£ LinuxmacOS 1 æ¯«ç§’ é—´éš”ä¸Šé™ï¼š ç”±æœ‰ç¬¦å·æ•´æ•°çš„æ¯«ç§’æ•°å†³å®šï¼Œçº¦ä¸º 24.8 å¤©ã€‚ [!IMPORTANT]ç³»ç»Ÿç¹å¿™æ—¶ï¼Œæ‰€æœ‰ç±»å‹å®šæ—¶å™¨éƒ½å¯èƒ½å»¶è¿Ÿè§¦å‘ã€‚Qt ä¿è¯å³ä½¿é”™è¿‡å¤šæ¬¡è¶…æ—¶ä¹Ÿåªå‘å‡ºä¸€æ¬¡ timeout ä¿¡å·ï¼Œéšåæ¢å¤æ­£å¸¸é—´éš”ã€‚ æ›¿ä»£æ–¹æ¡ˆå¯¹æ¯”é™¤ QTimer å¤–ï¼ŒQt è¿˜æä¾›å…¶ä»–å®šæ—¶å™¨å®ç°æ–¹å¼ã€‚ QObject::startTimer()ç›´æ¥ä½¿ç”¨ QObject çš„åº•å±‚å®šæ—¶å™¨æ¥å£ï¼š class MyWidget : public QWidget protected: void timerEvent(QTimerEvent *event) override if (event-timerId() == m_timerId) // å¤„ç†å®šæ—¶äº‹ä»¶ private: int m_timerId = startTimer(1000);; ä¼˜ç‚¹ï¼š è½»é‡çº§ï¼Œæ— éœ€é¢å¤–å¯¹è±¡ç¼ºç‚¹ï¼š ä¸æ”¯æŒå•æ¬¡å®šæ—¶å™¨ã€æ— ä¿¡å·æ§½æœºåˆ¶ QBasicTimerä»‹äº QTimer å’Œ startTimer() ä¹‹é—´çš„æŠ˜ä¸­æ–¹æ¡ˆï¼š class MyWidget : public QWidget QBasicTimer m_timer;protected: void timerEvent(QTimerEvent *event) override if (event-timerId() == m_timer.timerId()) // å¤„ç†å®šæ—¶äº‹ä»¶ public: void startWork() m_timer.start(1000, this); ; ä¼˜ç‚¹ï¼š æ¯” startTimer() æ›´æ˜“ç®¡ç†ç¼ºç‚¹ï¼š ä»éœ€æ‰‹åŠ¨å¤„ç† timerEvent() æ–¹æ¡ˆé€‰æ‹©æŒ‡å—flowchart TD A[éœ€è¦å®šæ—¶å™¨åŠŸèƒ½] -- Béœ€è¦ä¿¡å·æ§½? B --|æ˜¯| C[QTimer] B --|å¦| Då·²æœ‰ QObject å­ç±»? D --|æ˜¯| Eè¿½æ±‚æè‡´æ€§èƒ½? D --|å¦| C E --|æ˜¯| F[QBasicTimer] E --|å¦| C å®æˆ˜ç¤ºä¾‹ï¼šæ¨¡æ‹Ÿæ—¶é’Ÿä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨ QTimer æ¯ç§’åˆ·æ–°æ—¶é’Ÿæ˜¾ç¤ºï¼š class AnalogClock : public QWidget Q_OBJECTpublic: AnalogClock(QWidget *parent = nullptr) : QWidget(parent) QTimer *timer = new QTimer(this); connect(timer, QTimer::timeout, this, QOverload::of(QWidget::update)); timer-start(1000); // æ¯ç§’åˆ·æ–° resize(200, 200); protected: void paintEvent(QPaintEvent *) override // ç»˜åˆ¶æ—¶é’Ÿè¡¨ç›˜å’ŒæŒ‡é’ˆ // ... ; è®¾è®¡è¦ç‚¹ï¼š å®šæ—¶å™¨ä½œä¸ºå­å¯¹è±¡è‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ ä½¿ç”¨ update() è§¦å‘é‡ç»˜è€Œéç›´æ¥ç»˜åˆ¶ 1000ms é—´éš”è¶³ä»¥æ»¡è¶³ç§’é’ˆæ˜¾ç¤ºéœ€æ±‚ å°ç»“ è¦ç‚¹ è¯´æ˜ äº‹ä»¶å¾ªç¯ å®šæ—¶å™¨ä¾èµ–äº‹ä»¶å¾ªç¯ï¼Œæ— å¾ªç¯åˆ™ä¸å·¥ä½œ çº¿ç¨‹å®‰å…¨ å¿…é¡»åœ¨å®šæ—¶å™¨æ‰€å±çº¿ç¨‹å¯åœ ç²¾åº¦æ§åˆ¶ ä¸‰çº§ç²¾åº¦ç±»å‹é€‚åº”ä¸åŒåœºæ™¯ æ›¿ä»£æ–¹æ¡ˆ QBasicTimer è½»é‡ä½†åŠŸèƒ½å—é™ èµ„æºç®¡ç† åˆ©ç”¨å¯¹è±¡æ ‘æœºåˆ¶è‡ªåŠ¨é‡Šæ”¾ [!NOTE]éƒ¨åˆ†æ“ä½œç³»ç»Ÿå¯¹å®šæ—¶å™¨æ•°é‡æœ‰é™åˆ¶ï¼ŒQt å†…éƒ¨ä¼šå°è¯•è§„é¿è¿™äº›é™åˆ¶ã€‚åœ¨é«˜é¢‘å®šæ—¶å™¨åœºæ™¯ä¸‹ï¼Œå»ºè®®æµ‹è¯•ç›®æ ‡å¹³å°çš„å®é™…è¡¨ç°ã€‚ å‚è€ƒæ¥æº Qt å®˜æ–¹æ–‡æ¡£ - QTimer Class - QTimer å®Œæ•´ API å‚è€ƒ Qt å®˜æ–¹æ–‡æ¡£ - Timers - Qt å®šæ—¶å™¨æœºåˆ¶æ¦‚è¿° Qt å®˜æ–¹æ–‡æ¡£ - Qt::TimerType - å®šæ—¶å™¨ç²¾åº¦ç±»å‹æšä¸¾è¯´æ˜","tags":["Qt","QTimer","å®šæ—¶å™¨","äº‹ä»¶å¾ªç¯","å¤šçº¿ç¨‹"],"categories":["3.å¼€å‘æ¡†æ¶","Qt","Publish"]},{"title":"CANaerospace - Wikipedia","path":"/2025/07/09/4-é€šè®¯åè®®-CAN-CANaerospace-Wikipedia/","content":"CANaerospace is a higher layer protocol based on Controller Area Network (CAN) which has been developed by Stock Flight Systems in 1998 for aeronautical applications. BackgroundCANaerospace supports airborne systems employing the Line-replaceable unit (LRU) concept to share data across CAN and ensures interoperability between CAN LRUs by defining CAN physical layer characteristics, network layers, communication mechanisms, data types and aeronautical axis systems. CANaerospace is an open source project, was initiated to standardize the interface between CAN LRUs on the system level. CANaerospace is continuously being developed further and has also been published by NASA as the Advanced General Aviation Transport Experiments Databus Standard [^1] in 2001. It found widespread use in aeronautical research worldwide. A major research aircraft that employs several CANaerospace networks for real-time computer interconnection is the Stratospheric Observatory for Infrared Astronomy (SOFIA), a Boeing 747SP with a 2.5m astronomic telescope. CANaerospace is also frequently used in flight simulation and connects entire aircraft cockpits (i.e. in Eurofighter Typhoon simulators) to the simulation host computers. In Italy CANaerospace is used as UAV data bus technology.[^2] Furthermore, CANaerospace serves as communication network in several general aviation avionics systems. The CANaerospace interface definition closes the gap between the ISOOSI layer 1 and 2 CAN protocol (which is implemented in the CAN controller itself) and the specific requirements of distributed systems in aircraft. It may be used as a primary or ancillary avionics network and was designed to meet the following requirements: Democratic network: CANaerospace does not require any masterslave relationships between LRUs or a â€œbus controllerâ€, thereby avoiding a potential single source of failure. Every node in the network has the same rights for participation in the bus traffic. Self-identifying message format: Each CANaerospace message contains information about the type of the data and the transmitting node. This allows the data to be unambiguously recognized at each receiving node. Continuous Message Numbering: Each CANaerospace message contains a continuously incremented number which allows coherent processing of messages in the receiving stations. Message Status Code: Each CANaerospace message contains information about the integrity of the data is conveying. This allows receiving stations to evaluate the quality of the received data and to react accordingly. Emergency Event Signaling: CANaerospace defines a mechanism that allows each node to transmit information about exception or error situations. This information can be used by other stations to determine the network health. Node Service Interface: As an enhancement to CAN, CANaerospace provides a means for individual stations on the network to communicate with each other using connection-oriented and connectionless services. Predefined CAN Identifier Assignment: CANaerospace offers a predefined identifier assignment list for normal operation data. In addition to the predefined list, user-defined identifier assignment lists may be used. Ease of Implementation: The amount of code to implement CANaerospace is very little by design in order to minimize the effort for testing and certification of flight safety critical systems. Openness to Extensions: All CANaerospace definitions are extendable to provide flexibility for future enhancements and to allow adaptions to the requirements of specific applications. Free Availability: No cost whatsoever apply for the use of CANaerospace. The specification can be downloaded from the Internet [^3] Physical interfaceTo ensure interoperability and reliable communication, CANaerospace specifies the electrical characteristics, bus transceiver requirements and data rates with the corresponding tolerances based on ISO 11898. The bit timing calculation (baud rate accuracy, sample point definition) and robustness to electromagnetic interference are given special emphasis. Also addressed are CAN connector, wiring considerations and design guidelines to maximize electromagnetic compatibility. Communication layersThe Bosch CAN specification itself allows messages being transmitted both periodically and aperiodically but does not cover issues like data representation, node addressing or connection-oriented protocols. CAN is entirely based on Anyone-to-Many (ATM) communication which means that CAN messages are always received by all stations in the network. The advantage of the CAN concept is inherent data consistency between all stations, the drawback is that it does not allow node addressing which is the basis for Peer-to-Peer (PTP) communication. Using CAN networks in aeronautical applications, however, demands a standard targeted to the specific requirements of airborne systems which implies that communication between individual stations in the network must be possible to enable the required degree of system monitoring. Consequently, CANaerospace defines additional ISOOSI layer 3, 4 and 6 functions to support node addressing and unified ATMPTP communication mechanisms. PTP communication allows to set up clientserver interactions between individual stations in the network either temporarily or permanently. More than one of these interactions may be in effect at any given time and each node may be client for one operation and server for another at the same time. This CANaerospace mechanism is called â€œNode Service Conceptâ€ and allows i.e. to distribute system functions over several stations in the network or to control dynamic system reconfiguration in case of failure. The Node Service concept supports both connection-oriented and connectionless interactions like with TCPIP and UDPIP for Ethernet. Enabling both ATM and PTP communication for CAN requires the introduction of independent network layers to isolate the different types of communication. This is realized for CANaerospace by forming CAN identifier groups as shown in Figure 1. The resulting structure creates Logical Communication Channels (LCCs) and assigns a specific communication type (ATM, PTP) to each of the LCCs. User-defined LCCs provide the necessary freedom for designers and allow the implementation of CANaerospace according to the needs of specific applications. Figure 1: Logical Communication Channels for CANaerospace As a side effect, the CAN identifier groups in Figure 1 affect the priority of the message transmission in case of bus arbitration. The communication channels are therefore arranged according to their relative importance: Emergency Event Data Channel (EED): This communication channel is used for messages which require immediate action (i.e. system degradation or reconfiguration) and have to be transmitted with very high priority. Emergency Event Data uses ATM communication exclusively. HighLow Priority Node Service Data Channel (NSHNSL): These communication channels are used for clientserver interactions using PTP communication. The corresponding services may be of the connection-oriented as well as the connectionless type. NSHNSL may also be used to support test and maintenance functions. Normal Operation Data Channel (NOD): This communication channel is used for the transmission of the data which is generated during normal system operation and described in the CANaerospace identifier assignment list. These messages may be transmitted periodically or aperiodically as well as synchronously or asynchronously. All messages which cannot be assigned to other communication channels shall use this channel. HighLow Priority User-Defined Data Channel (UDHUDL): This channel is dedicated to communication which cannot, due to their specific characteristics, be assigned other channels without violating the CANaerospace specification. As long as the defined identifier range is used, the message content and the communication type (ATM, PTP) for these channels may be specified by the system designer. To ensure interoperability it is highly recommended that the use of these channels is minimized. Debug Service Data Channel (DSD): This channel is dedicated to messages which are used temporarily for development and test purposes only and are not transmitted during normal operation. As long as the defined identifier range is used, the message content and the communication type (ATM, PTP) for these channels may be specified by the system designer. Data representationThe majority of the real-time control systems used in aeronautics employ â€œ big endian â€œ processor architectures. This data representation was therefore specified for CANaerospace as well. With big endian data representation, the most significant bit of any datum is arranged leftmost and transmitted first on CANaerospace as shown in Figure 2. Figure 2: â€œBig Endianâ€ Data Representation for CANaerospace CANaerospace uses a self-identifying message format which is realized by structuring the message payload as shown in Figure 3. This structure defines a 4-byte message header and a 4-byte parameter section. Figure 3: CANaerospace Self-Identifying Message Format On first sight the use of 50% of the CAN message payload for purposes other than transmitting operational data may seem like a waste of bandwidth. However, the CANaerospace message header delivers valuable information which would require the use of message payload bytes also when realized otherwise: The header allows receiving stations to analyze received messages immediately with respect to origin, data type, integrity and creation time. To accomplish this, no further information except the knowledge of the CAN identifier assignment for the particular system is needed. The message header bytes have the following meaning: Node-ID: For ATM communication (EED, NOD), the Node Identifier specifies the transmitting node. For PTP communication (NSH, NSL) it specifies the addressed node (client, server). For PTP communication, Node_ID â€œ0â€ is used to address all stations in the network (multicast). Data Type: The Data Type specifies how the payload of the message shall be interpreted with respect to its data type (i.e. floating-point data or number of bytes in case of integer data). The corresponding data type code is taken from the CANaerospace data type list which allows also user-defined data type definitions. Service Code: For Normal Operation Data (NOD) the Service Code delivers information about the integrity of the parameter transmitted with the message. This may be the result of a continuous sensor built-in test, the current validity flag of a navigation signal or other parameter specific information. In case of PTP communication the Service Code specifies the service for the corresponding clientserver interaction. Message Code: For Normal Operation Data (NOD) the Message Code is incremented by one for each message with a particular CAN identifier by the transmitting node. After reaching the value of 255, the Message Code rolls over to zero. This allows receiving stations to determine missing or delayed messages and to react accordingly. Concerning PTP communication (NSH, NSL) the Message Code is used in conjunction with the Service Code to specify the service for the corresponding clientserver interaction in more detail. The above information contained in the CANaerospace message header contains important information to determine the integrity of the parameters for the use in flight safety critical systems and supports system redundancy. Additionally, it significantly improves the interoperability between LRUs of different vendors and allows the monitoring of CANaerospace networks concerning the status of the LRUs attached to it. For further interoperability, CANaerospace defines aerospace specific axis systems with the corresponding sign conventions and physical units. Together with the predefined identifier assignment list, these definitions describe the traffic in a CANaerospace network unambiguously. The CANaerospace Standard Identifier Assignment List reserves the CAN identifiers between 300 and 1799 and assigns parameters to them as shown in the excerpt of this list (Figure 4). Figure 4: Excerpt from the Standard Identifier Assignment List of CANaerospace V 1.7 System designers may use self-defined identifier assignment lists. The mandatory â€œNode Identification Serviceâ€ which each CANaerospace LRU has to respond to allows to scan the network for attached LRUs and their identifier assignment list code to avoid inconsistencies. The CANaerospace Standard Identifier Assignment List as well as the lists for data types and units provide user-defined sections which may be used by system designers to expand these lists according to their needs. Bandwidth managementAn essential characteristic of all flight safety critical systems is that their behavior has to be precisely defined, analyzed and tested to meet formal certification requirements. This characteristic is often misinterpreted as timing determinism but is in fact predictability. The degree of precision required for timing is specific to each application and has to be quantified by system analysis. The ultimate target to be reached, however, is that it may be demonstrated to certification authorities (i.e. FAA, EASA) that a safety critical system behaves predictably under foreseeable circumstances. Using CANaerospace, this predictability may be achieved. CANaerospace sets forth a concept of managing the available bandwidth of a multi-drop CAN network to ensure predictable behavior for ATM and PTP communication which is called Time Triggered Bus Scheduling. Time Triggered Bus Scheduling is based on a limitation of the number of CAN messages that any node in the network may transmit within a minor time frame. The minor time frame is defined during initial system design. The maximum number of messages transmitted within one minor time frame may differ from node to node and contain growth potential if granted by system design. It is crucial to the Time Triggered Bus Scheduling concept that every node in the network adheres to its transmission schedule at all times when generating network traffic. It is neither required nor prohibited, however, that nodes in the network synchronize to other nodes concerning their message transmission order or transmission times. CAN error frames may lead to unpredictable behavior if the bandwidth is consumed by error frames resulting from faults of the network or the nodes attached to it. Therefore, CANaerospace recommends to limit the bandwidth usage to 50% of the maximum bandwidth so that unpredictability is mitigated. While Time Triggered Bus Scheduling requires margins and does not optimize network bandwidth usage, it provides a safe and straightforward approach to build certifiable (predictable) systems. For ensuring this under fault conditions the system designer has to define the behaviour under these conditions (error frames and avoidance of priority inversion).[^4] Applying the Time Triggered Bus Scheduling concept, it may be demonstrated that a CANaerospace network behaves predictably. Shown in Figure 5 is the transmission schedule of a CANaerospace network with two nodes transmitting their messages asynchronously, in alternating order and at random times within their minor time frames (worst-case scenario). This example utilizes 50% of the maximum bandwidth. Figure 5: Simplified CANaerospace Transmission Scheme Using Time Triggered Bus Scheduling, no message in this transmission schedule has a latency exceeding 50% of one minor time frame plus the duration of the longest message. Time Triggered Bus Scheduling reduces the effect of message priority due to the fact that the nodes on the network are required to meter their message transmissions. Local oscillator tolerances and lack of time synchronization between the nodes will result in minor time frames drifting away from each other. This does not adversely affect message latencies as long as the duration of the minor time frame in all nodes matches closely. To ensure predictability, all aperiodic messages must be included in the bandwidth management calculations. Time Triggered Bus Scheduling ensures adequate flexibility for increasing network traffic during the lifetime of the system if growth potential is planned. As an example, system design will allow nodes to be integrated into the network without affecting the existing nodes. Furthermore, the predictable behavior enforced by Time Triggered Bus Scheduling allows systems with different criticality levels to coexist on the same network. External links CANaerospace homepage Stock Flight Systems ARINC-825 Tutorial (video) from Excalibur Systems Inc. References[^1]: â€œNASA AGATE Data Bus Specificationâ€. NASA. [^2]: Short overview of CAN-based avionics protocols on www.avionics-networking.com [^3]: â€œCANaerospace Specificationâ€ (PDF). Stock Flight Systems. [^4]: â€œApplication Note AN-ION-1-0104â€ (PDF). CAN-based Protocols in Avionics. 7 May 2010. Archived from the original (PDF) on 7 October 2011. Retrieved 7 May 2010.","categories":["4.é€šè®¯åè®®","CAN"]},{"title":"Stock Flight Systems å…¬å¸","path":"/2025/07/09/5-åµŒå…¥å¼å¼€å‘-èˆªç”µç³»ç»Ÿ-Stock-Flight-Systems-å…¬å¸/","content":"Stockâ€¯Flightâ€¯Systems æ˜¯ä¸€å®¶ä¸“æ³¨äºèˆªç©ºç”µå­å’Œæœºè½½æ€»çº¿é€šä¿¡æŠ€æœ¯çš„ä¸“ä¸šå…¬å¸ï¼Œæˆç«‹äº 1993 å¹´ï¼Œæ€»éƒ¨ä½äºå¾·å›½ï¼ˆBergFarchachï¼‰ï¼Œåœ¨ç¾å›½ï¼ˆå‡¤å‡°åŸï¼‰å’Œæ¬§æ´²å‡è®¾æœ‰åŠäº‹å¤„ã€‚ CANaerospace åè®®å‘æ˜è€… 1998 å¹´ï¼ŒStockâ€¯Flightâ€¯Systems é¦–æ¬¡æå‡ºå¹¶æŒç»­ç»´æŠ¤ CANaerospaceâ€”â€”ä¸€ä¸ªåŸºäº CANï¼ˆController Area Networkï¼‰çš„é«˜å±‚èˆªç©ºé€šä¿¡åè®®ï¼Œç”¨äºå®šä¹‰ç‰©ç†å±‚ç‰¹æ€§ã€ç½‘ç»œå±‚ä¸é€šä¿¡æœºåˆ¶ï¼Œç¡®ä¿æœºè½½å¯äº’æ¢å•å…ƒï¼ˆLRUï¼‰ä¹‹é—´çš„æ•°æ®äº’æ“ä½œæ€§ã€‚è¯¥åè®®å·²è¢« NASA é‡‡çº³ä¸º AGATE æ•°æ®æ€»çº¿æ ‡å‡†ï¼Œå¹¶å¹¿æ³›åº”ç”¨äºå¤šç§èˆªç©ºç ”ç©¶å¹³å°ï¼ˆä¾‹å¦‚ SOFIA å¤©æ–‡è§‚æµ‹æœºï¼‰(en.wikipedia.org, epicos.com)ã€‚ Engine Management Unit (EMU) å¼•æ“ç®¡ç†å•å…ƒ Stockâ€¯Flightâ€¯Systems å¼€å‘äº†ä¸€ç³»åˆ— EMU äº§å“ï¼Œèƒ½å¤Ÿé€šè¿‡ CANaerospace æ¥å£ä¸ Rotaxã€Lycoming ç­‰å‘åŠ¨æœºçš„ç”µå­æ§åˆ¶å•å…ƒï¼ˆECUï¼‰é€šä¿¡ï¼Œæä¾›ï¼š å®æ—¶å‘åŠ¨æœºå‚æ•°ç›‘æ§ï¼ˆè½¬é€Ÿã€æ¸©åº¦ã€å‹åŠ›ç­‰ï¼‰ æ•…éšœä¸çŠ¶æ€è­¦å‘Šæ˜¾ç¤º æ•°æ®è®°å½•ä¸åœé£ååˆ†æï¼ˆå…è´¹ EMDS è½¯ä»¶æ”¯æŒ Google Earth åœ°ç†æ˜ å°„ï¼‰ ä¸ MTâ€¯Propeller åˆä½œçš„å•æ†èºæ—‹æ¡¨å˜è·æ§åˆ¶ç³»ç»Ÿé›†æˆï¼Œå®ç°ç±»ä¼¼æ±½è½¦å¤šæ¡£ä½çš„æ¡¨è·è‡ªåŠ¨è°ƒèŠ‚(rotaxnews.net, generalaviationnews.com)ã€‚ Network Extended Control System (NECSPowerNECS) åŸºäº PowerPC çš„æ¨¡å—åŒ–æœºè½½è®¡ç®—æœºç³»ç»Ÿï¼Œæä¾›å¤šç§ IO æ¥å£ï¼ˆæ¨¡æ‹Ÿé‡ã€æ•°å­—é‡ã€æ•°æ®æ€»çº¿ï¼‰ï¼Œå¯é€šè¿‡ CANbus äº’è”å¤šè¾¾å‡ ç™¾å°å•å…ƒã€‚PowerNECS å¹¿æ³›åº”ç”¨äºé«˜å¯é æ€§èˆªç©ºå’Œç©ºé—´ä»»åŠ¡ï¼ŒåŒ…æ‹¬æ‚¬æŒ‚äºé«˜ç©ºæ°”çƒçš„å¤ªé˜³è§‚æµ‹æœ›è¿œé•œâ€œSunriseâ€é¡¹ç›®(epicos.com)ã€‚ Telemetry Interface System (TIS) ä¸åˆä½œä¼™ä¼´ ICSï¼ˆInnovative Controlâ€¯Systemsï¼‰è”åˆæ¨å‡ºçš„ 19â€³ æœºæ¶å¼é¥æµ‹æ¥å£ç³»ç»Ÿï¼Œå¯å°† Honeywell ASCBã€ARINC 429825 ç­‰å¤šç§æ€»çº¿ä¿¡å·é›†ä¸­åˆ° PC å¹³å°è¿›è¡Œå®æ—¶ç›‘æ§ä¸è®°å½•(stockflightsystems.com)ã€‚ ARINCâ€¯825 æ€»çº¿æŠ€æœ¯ é™¤äº† CANaerospaceï¼ŒStockâ€¯Flightâ€¯Systems è¿˜ç§¯æå‚ä¸ ARINCâ€¯825ï¼ˆåŸºäº CAN çš„èˆªç©ºæ•°æ®æ€»çº¿æ ‡å‡†ï¼‰çš„åˆ¶å®šä¸æ”¯æŒï¼Œå¹¶åœ¨å¤šä¸ªæœºè½½ç³»ç»Ÿé¡¹ç›®ä¸­é›†æˆä¸æ¨å¹¿è¿™ä¸€è§„èŒƒã€‚ è½¯ä»¶ä¸æœåŠ¡ EMDSï¼ˆEngine Management Debriefing Stationï¼‰ï¼šå…è´¹æä¾›ç»™ EMU ç”¨æˆ·ï¼Œç”¨äºè¯¦ç»†çš„å‘åŠ¨æœºè¿è¡Œæ•°æ®åˆ†æã€æ•…éšœè¯Šæ–­ä¸é£è¡Œæ—¥å¿—å›æ”¾ å®šåˆ¶å¼€å‘ã€ç³»ç»Ÿé›†æˆã€æŠ€æœ¯æ”¯æŒä¸åŸ¹è®­æœåŠ¡ï¼Œè¦†ç›–ä»æ¦‚å¿µè®¾è®¡åˆ°é£è¡Œè¯•éªŒçš„å…¨æµç¨‹ ç»¼ä¸Šï¼ŒStockâ€¯Flightâ€¯Systems é€šè¿‡å…¶æ ¸å¿ƒé¡¹ç›®â€”â€”CANaerospace åè®®ã€EMU å¼•æ“ç®¡ç†ç³»ç»Ÿã€NECS æ¨¡å—åŒ–æ§åˆ¶å¹³å°å’Œ TIS é¥æµ‹æ¥å£ç³»ç»Ÿâ€”â€”ä¸ºé€šç”¨èˆªç©ºä¸èˆªå¤©é¢†åŸŸæä¾›äº†ä»ç¡¬ä»¶åˆ°åº•å±‚é€šä¿¡åè®®çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","èˆªç”µç³»ç»Ÿ"]},{"title":"Traeæˆ–VSCodeä¸‹Qtç¯å¢ƒçš„é…ç½®","path":"/2025/07/01/3-å¼€å‘æ¡†æ¶-Qt-å…¶ä»–å¹³å°-Traeæˆ–VSCodeä¸‹Qtç¯å¢ƒçš„é…ç½®/","content":"å®‰è£…å¿…è¦å·¥å…·åœ¨å¼€å§‹é…ç½®ä¹‹å‰ï¼Œè¯·ç¡®ä¿å®‰è£…äº†ä»¥ä¸‹å·¥å…·ï¼š Qtï¼šQt æ˜¯æ„å»º GUI åº”ç”¨çš„æ ¸å¿ƒæ¡†æ¶ã€‚ä¸‹è½½å¹¶å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Qtï¼Œå…·ä½“ä¸‹è½½åœ°å€å¯å‚è€ƒ Qt å®˜æ–¹ç½‘ç«™ã€‚ CMakeï¼šä» Qt 6 å¼€å§‹ï¼ŒCMake æˆä¸ºé»˜è®¤çš„æ„å»ºå·¥å…·ã€‚ä¸‹è½½ CMake çš„å…·ä½“ç‰ˆæœ¬ï¼Œå¯è®¿é—® CMake å®˜æ–¹ç½‘ç«™ã€‚ å®Œæˆå®‰è£…åï¼Œç¡®ä¿è¿™äº›å·¥å…·å·²æ­£ç¡®æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­ï¼Œä»¥ä¾¿åœ¨åç»­æ­¥éª¤ä¸­æ­£ç¡®è¯†åˆ«ã€‚ é…ç½® Trae å¼€å‘ç¯å¢ƒæ­¥éª¤ 1ï¼šå®‰è£…æ‰©å±•æ’ä»¶ æ‰“å¼€ Cursor æˆ– VS Codeã€‚ è¿›å…¥æ’ä»¶å¸‚åœºï¼Œå®‰è£…ä»¥ä¸‹å¿…è¦æ’ä»¶ï¼š CC++ æ’ä»¶ï¼šä¸º CC++ å¼€å‘æä¾›è¯­æ³•æ”¯æŒå’Œä»£ç è¡¥å…¨åŠŸèƒ½ã€‚ Qt Configureï¼šç”¨äºé…ç½® Qt å¼€å‘ç¯å¢ƒã€‚ Qt Toolsï¼šæä¾› Qt ç›¸å…³å·¥å…·çš„æ”¯æŒã€‚ CMakeï¼šç”¨äº CMake æ„å»ºç³»ç»Ÿçš„æ”¯æŒã€‚ CMake Toolsï¼šè¾…åŠ© CMake çš„æ„å»ºè¿‡ç¨‹ã€‚ å¦‚æœæŸäº›æ’ä»¶åœ¨é»˜è®¤çš„æ’ä»¶å¸‚åœºä¸­æ‰¾ä¸åˆ°ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹æ‰©å±•å¸‚åœºåœ°å€æ¥è§£å†³ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š æ‰“å¼€ç”¨æˆ·è®¾ç½®ï¼ˆå¿«æ·é”® Ctrl + ,ï¼‰ã€‚ åœ¨æœç´¢æ è¾“å…¥ application.extensionMarketUrlã€‚ ä¿®æ”¹ extensionMarketUrl ä¸º https://marketplace.visualstudio.com/_apis/public/galleryã€‚ æ­¥éª¤ 2ï¼šè®¾ç½® Qt å®‰è£…è·¯å¾„ æ‰“å¼€å‘½ä»¤é¢æ¿ï¼ˆå¿«æ·é”® Ctrl + Shift + Pï¼‰ã€‚ è¾“å…¥ Set Qt Dirï¼Œç„¶åé€‰æ‹© Qt å®‰è£…çš„ä¸»ç›®å½•ï¼Œä¾‹å¦‚ D:\\Qt\\5.14.2ã€‚ æ­¥éª¤ 3ï¼šåˆ›å»ºæ–° Qt é¡¹ç›® å†æ¬¡æ‰“å¼€å‘½ä»¤é¢æ¿ï¼Œè¾“å…¥ New Qt Projectã€‚ æ ¹æ®æç¤ºè¾“å…¥é¡¹ç›®åç§°ï¼Œé€‰æ‹©é€‚ç”¨çš„é¡¹ç›®å¥—ä»¶ã€‚ é€‰æ‹©ä½¿ç”¨ CMake æˆ– qmake ä½œä¸ºæ„å»ºå·¥å…·ï¼Œå¹¶æ ¹æ®é¡¹ç›®éœ€æ±‚é€‰æ‹©æ˜¯å¦åŒ…å« UI ç»„ä»¶ã€‚ é…ç½® CMakeåœ¨ä½¿ç”¨ CMake å·¥å…·æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°ç¼–è¯‘ä¿¡æ¯ç¼ºå¤±çš„é—®é¢˜ã€‚æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œé…ç½®ï¼š æ‰“å¼€å‘½ä»¤é¢æ¿ï¼Œè¾“å…¥ Select CMake Kitï¼Œé€‰æ‹©åˆé€‚çš„ CMake å¥—ä»¶ã€‚ åœ¨è®¾ç½®ä¸­æ‰¾åˆ° CMake è·¯å¾„ï¼Œå¡«å†™ CMake çš„å®‰è£…è·¯å¾„ï¼Œä¾‹å¦‚ D:\\Qt\\cmake-3.31.6\\bin\\cmake.exeã€‚ åº”ç”¨é…ç½®åï¼Œé‡æ–°æ„å»ºé¡¹ç›®ä»¥ç¡®ä¿é…ç½®ç”Ÿæ•ˆã€‚ ä¸‹è½½ CMake çš„å…·ä½“ç‰ˆæœ¬å¯å‚è€ƒ CMake å®˜æ–¹ä¸‹è½½é¡µé¢ã€‚ é…ç½® Qt Configureè¿›å…¥ Qt configure æ’ä»¶çš„è®¾ç½®ç•Œé¢ï¼Œåˆ†åˆ«è¾“å…¥ MingwPath ä¸º D:\\Qt\\Qt5.14.2\\Tools\\mingw730_64ï¼ŒQtDir ä¸º d:\\Qt\\Qt5.14.2ï¼ŒQt Kit Dir ä¸º D:\\Qt\\Qt5.14.2\\Tools\\mingw730_64ï¼Œå¹¶å°†è®¾ç½®åº”ç”¨åˆ°æ‰€æœ‰ é…ç½®è°ƒè¯•ç¯å¢ƒä¸ºäº†ç¡®ä¿é¡¹ç›®çš„è°ƒè¯•åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œéœ€è¦åœ¨ .vscode/launch.json æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š version: 0.2.0, configurations: [ name: QtBuild, type: cppdbg, request: launch, program: $command:cmake.launchTargetPath, args: [], stopAtEntry: false, cwd: $workspaceRoot, environment: [ name: PATH, value: d:/Qt/Qt5.14.2/5.14.2/mingw73_64/bin ], externalConsole: false, miDebuggerPath: D:/Qt/Qt5.14.2/Tools/mingw730_64/bin/gdb.exe ] è¿™ä¸ªé…ç½®â€™: æŒ‡å®šäº†è°ƒè¯•ç¨‹åºçš„è·¯å¾„ã€‚ è®¾ç½®äº†ç¯å¢ƒå˜é‡ PATHï¼Œç¡®ä¿è°ƒè¯•å™¨èƒ½å¤Ÿæ‰¾åˆ°å¿…è¦çš„å·¥å…·ã€‚ æŒ‡å®šäº† GDB è°ƒè¯•å™¨çš„è·¯å¾„ã€‚ å…¶ä»– æ— æ³•æ‰¾åˆ°ç¼–è¯‘ä¿¡æ¯ï¼šè¯·ç¡®ä¿ CMake è·¯å¾„é…ç½®æ­£ç¡®ï¼Œå¹¶ä¸”é¡¹ç›®å·²ç»æˆåŠŸç”Ÿæˆã€‚ launch.json é…ç½®é”™è¯¯ï¼šæ£€æŸ¥ program å’Œ miDebuggerPath æ˜¯å¦æ­£ç¡®æŒ‡å‘ Qt å®‰è£…ç›®å½•ä¸‹çš„ç›¸åº”æ–‡ä»¶ã€‚","categories":["3.å¼€å‘æ¡†æ¶","Qt","AI for Qt"]},{"title":"æ ‡å‡†IOå‡½æ•°","path":"/2025/06/13/1-å¹³å°ç³»ç»Ÿ-Linux-IO-æ ‡å‡†IOå‡½æ•°/","content":"è¿™äº›å‡½æ•°é™¤ mktemp å¤–çš„å¤´æ–‡ä»¶éƒ½æ˜¯ stdio.h å‡½æ•°åˆ†ç±»åŸºæœ¬æ“ä½œ:fclose, fopen, freopenfread, fwriteè¯»å†™ä½ç½®ç›¸å…³å‡½æ•°:fseek, fsetpos, rewindfgetpos, ftellfeofè¯»å–å’Œå†™å…¥:fgetc, fgets, getc, getchar, gets, ungetcfputc, fputs, putc, putchar, putsæ–‡ä»¶æµæŒ‡é’ˆå’Œæ–‡ä»¶æè¿°è¯ç›¸äº’è½¬æ¢:fdopen, filenoè®¾ç½®ç¼“å†²åŒº:setbuf, setbuffer, setlinebuf, setvbufå»ºç«‹ä¸´æ—¶æ–‡ä»¶:mktemp, tmpfileå…¶ä»–:fflushclearerr clearerr: æ¸…é™¤æ–‡ä»¶æµçš„é”™è¯¯æ——æ ‡å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: void clearerr(FILE *stream); è¯´æ˜: clearerr()æ¸…é™¤å‚æ•° stream æŒ‡å®šçš„æ–‡ä»¶æµæ‰€ä½¿ç”¨çš„é”™è¯¯æ——æ ‡. fclose: å…³é—­æ–‡ä»¶å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: int fclose(FILE *stream); è¯´æ˜: fclose()ç”¨æ¥å…³é—­å…ˆå‰ fopen()æ‰“å¼€çš„æ–‡ä»¶. æ­¤åŠ¨ä½œä¼šè®©ç¼“å†²åŒºå†…çš„æ•°æ®å†™å…¥æ–‡ä»¶ä¸­, å¹¶é‡Šæ”¾ç³»ç»Ÿæ‰€æä¾›çš„æ–‡ä»¶èµ„æº. è‹¥æˆåŠŸåˆ™è¿”å› 0, æœ‰é”™è¯¯å‘ç”Ÿæ—¶åˆ™è¿”å› EOF å¹¶æŠŠé”™è¯¯ä»£ç å­˜åˆ° errno. EBADF è¡¨ç¤ºå‚æ•° stream éå·²æ‰“å¼€çš„æ–‡ä»¶. fdopen: å°†æ–‡ä»¶æè¿°è¯è½¬åŒ–ä¸ºæ–‡ä»¶æŒ‡é’ˆå¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: FILE *fdopen(int fildes, const char *mode); è¯´æ˜: fdopen()ä¼šå°†å‚æ•° fildes çš„æ–‡ä»¶æè¿°è¯, è½¬æ¢ä¸ºå¯¹åº”çš„æ–‡ä»¶æŒ‡é’ˆåè¿”å›. å‚æ•° mode å­—ç¬¦ä¸²åˆ™ä»£è¡¨è¿™æ–‡ä»¶æŒ‡é’ˆçš„æµå½¢æ€, æ­¤å½¢æ€å¿…é¡»å’ŒåŸå…ˆæ–‡ä»¶æè¿°è¯è¯»å†™æ¨¡å¼ç›¸åŒ. å…³äº mode å­—ç¬¦ä¸²æ ¼å¼è¯·å‚è€ƒ fopen(). è‹¥æˆåŠŸåˆ™è¿”å›æŒ‡å‘è¯¥æµçš„æ–‡ä»¶æŒ‡é’ˆ, å¤±è´¥åˆ™è¿”å› NULL, å¹¶æŠŠé”™è¯¯ä»£ç å­˜åˆ° errno. feof: æ£€æŸ¥æ–‡ä»¶æµæ˜¯å¦è¯»åˆ°äº†æ–‡ä»¶å°¾å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰:int feof(FILE *stream); è¯´æ˜: feof()ç”¨æ¥æ£€æµ‹æ˜¯å¦è¯»åˆ°äº†æ–‡ä»¶å°¾, å‚æ•° steam ä¸º fopen()æ‰€è¿”å›çš„æ–‡ä»¶æŒ‡é’ˆ. å¦‚æœå·²åˆ°æ–‡ä»¶å°¾åˆ™è¿”å›é 0 å€¼, å…¶ä»–æƒ…å†µè¿”å› 0. fflush: æ›´æ–°ç¼“å†²åŒºå¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: int fflush(FILE *stream); è¯´æ˜: fflush()ä¼šå¼ºè¿«å°†ç¼“å†²åŒºå†…çš„æ•°æ®å†™å›å‚æ•° stream æŒ‡å®šçš„æ–‡ä»¶ä¸­. å¦‚æœå‚æ•° stream ä¸º NULL, fflush()ä¼šå°†æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶æ•°æ®æ›´æ–°. æˆåŠŸè¿”å› 0, å¤±è´¥è¿”å› EOF, é”™è¯¯ä»£ç å­˜äº errno ä¸­. EBADF å‚æ•° stream æŒ‡å®šçš„æ–‡ä»¶æœªè¢«æ‰“å¼€, æˆ–æ‰“å¼€çŠ¶æ€ä¸ºåªè¯». å…¶å®ƒé”™è¯¯ä»£ç å‚è€ƒ write(). fgetc: ç”±æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: int fgetc(FILE *stream); è¯´æ˜: fgetc()ç”¨æ¥ä»å‚æ•° stream æ‰€æŒ‡çš„æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦, è¯»å–ä½ç½®åŠ  1. æˆåŠŸä¼šè¿”å›è¯»å–åˆ°çš„å­—ç¬¦, è‹¥è¯»åˆ°æ–‡ä»¶å°¾è€Œæ— æ•°æ®å¯è¯»æ—¶è¿”å› EOF. fgetpos: è¯»å–æ–‡ä»¶æµçš„è¯»å–ä½ç½®å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: int fgetpos(FILE *stream, fpos_t *pos); è¯´æ˜: fgetpos()å’Œ ftell()ä¸€æ ·éƒ½æ˜¯ç”¨æ¥å–å¾—æ–‡ä»¶æµç›®å‰çš„è¯»å†™ä½ç½®. å‚æ•° stream ä¸ºå·²æ‰“å¼€çš„æ–‡ä»¶æŒ‡é’ˆ. è¯»å†™ä½ç½®ä¼šåˆ©ç”¨å‚æ•° pos æŒ‡é’ˆè¿”å›. æˆåŠŸè¿”å› 0, æœ‰é”™è¯¯è¿”å›-1, é”™è¯¯ä»£ç å­˜äº errno ä¸­. fgets: è¯»å–æ–‡ä»¶ä¸­çš„ä¸€ä¸ªå­—ç¬¦ä¸²å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: char *fgets(char *s, int size, FILE *stream); è¯´æ˜: fgets()ç”¨æ¥ä»å‚æ•° stream æ‰€æŒ‡çš„æ–‡ä»¶å†…è¯»å…¥å­—ç¬¦å¹¶å­˜åˆ°å‚æ•° s æ‰€æŒ‡çš„å†…å­˜ç©ºé—´ä¸­, ç›´åˆ°å‡ºç°æ¢è¡Œå­—ç¬¦, è¯»åˆ°æ–‡ä»¶å°¾æˆ–æ˜¯å·²è¯»äº† size-1 ä¸ªå­—ç¬¦ä¸ºæ­¢, æœ€åä¼šåŠ ä¸Š NULL ä½œä¸ºå­—ç¬¦ä¸²ç»“æŸ. æˆåŠŸè¿”å› s æŒ‡é’ˆ, é”™è¯¯è¿”å› NULL. flieno: è¿”å›æ–‡ä»¶æµæ‰€ä½¿ç”¨çš„æ–‡ä»¶æè¿°è¯å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: int fileno(FILE *stream); è¯´æ˜: fileno()ç”¨æ¥å–å¾—å‚æ•° stream æŒ‡å®šçš„æ–‡ä»¶æµæ‰€ä½¿ç”¨çš„æ–‡ä»¶æè¿°è¯. è¿”å›å–å¾—çš„æ–‡ä»¶æè¿°è¯. fopen: æ‰“å¼€æ–‡ä»¶å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: FILE *fopen(const char *path, const char *mode); è¯´æ˜: å‚æ•° path å­—ç¬¦ä¸²åŒ…å«æ¬²æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„åŠæ–‡ä»¶å, å‚æ•° mode å­—ç¬¦ä¸²åˆ™ä»£è¡¨ç€æµå½¢æ€. mode æœ‰ä¸‹åˆ—å‡ ç§å½¢æ€å­—ç¬¦ä¸²: r æ‰“å¼€åªè¯»æ–‡ä»¶, è¯¥æ–‡ä»¶å¿…é¡»å­˜åœ¨. r+ æ‰“å¼€å¯è¯»å†™çš„æ–‡ä»¶, è¯¥æ–‡ä»¶å¿…é¡»å­˜åœ¨. w æ‰“å¼€åªå†™æ–‡ä»¶, è‹¥æ–‡ä»¶å­˜åœ¨åˆ™æ–‡ä»¶é•¿åº¦æ¸…ä¸º 0, å³è¯¥æ–‡ä»¶å†…å®¹ä¼šæ¶ˆå¤±. è‹¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™å»ºç«‹è¯¥æ–‡ä»¶. w+ æ‰“å¼€å¯è¯»å†™æ–‡ä»¶, è‹¥æ–‡ä»¶å­˜åœ¨åˆ™æ–‡ä»¶é•¿åº¦æ¸…ä¸ºé›¶, å³è¯¥æ–‡ä»¶å†…å®¹ä¼šæ¶ˆå¤±. è‹¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™å»ºç«‹è¯¥æ–‡ä»¶. a ä»¥é™„åŠ çš„æ–¹å¼æ‰“å¼€åªå†™æ–‡ä»¶. è‹¥æ–‡ä»¶ä¸å­˜åœ¨, åˆ™ä¼šå»ºç«‹è¯¥æ–‡ä»¶, å¦‚æœæ–‡ä»¶å­˜åœ¨, å†™å…¥çš„æ•°æ®ä¼šè¢«åŠ åˆ°æ–‡ä»¶å°¾, å³æ–‡ä»¶åŸå…ˆçš„å†…å®¹ä¼šè¢«ä¿ç•™. a+ ä»¥é™„åŠ æ–¹å¼æ‰“å¼€å¯è¯»å†™çš„æ–‡ä»¶. è‹¥æ–‡ä»¶ä¸å­˜åœ¨, åˆ™ä¼šå»ºç«‹è¯¥æ–‡ä»¶, å¦‚æœæ–‡ä»¶å­˜åœ¨, å†™å…¥çš„æ•°æ®ä¼šè¢«åŠ åˆ°æ–‡ä»¶å°¾å, å³æ–‡ä»¶åŸå…ˆçš„å†…å®¹ä¼šè¢«ä¿ç•™.ä¸Šè¿°çš„å½¢æ€å­—ç¬¦ä¸²éƒ½å¯ä»¥å†åŠ ä¸€ä¸ª b å­—ç¬¦, å¦‚ rbã€w+b æˆ– abï¼‹ç­‰ç»„åˆ, åŠ å…¥ b å­—ç¬¦ç”¨æ¥å‘Šè¯‰å‡½æ•°åº“æ‰“å¼€çš„æ–‡ä»¶ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶, è€Œéçº¯æ–‡å­—æ–‡ä»¶. ä¸è¿‡åœ¨ POSIX ç³»ç»Ÿ, åŒ…å« Linux éƒ½ä¼šå¿½ç•¥è¯¥å­—ç¬¦. ç”± fopen()æ‰€å»ºç«‹çš„æ–°æ–‡ä»¶ä¼šå…·æœ‰ S_IRUSR|S_IWUSR|S_IRGRP|S_IWGRP|S_IROTH|S_IWOTH(0666)æƒé™, æ­¤æ–‡ä»¶æƒé™ä¹Ÿä¼šå‚è€ƒ umask å€¼. æ–‡ä»¶æ‰“å¼€æˆåŠŸ, è¿”å›æŒ‡å‘è¯¥æµçš„æ–‡ä»¶æŒ‡é’ˆ. è‹¥æœæ–‡ä»¶æ‰“å¼€å¤±è´¥åˆ™è¿”å› NULL, å¹¶æŠŠé”™è¯¯ä»£ç å­˜åœ¨ errno ä¸­.é™„åŠ è¯´æ˜: ä¸€èˆ¬è€Œè¨€, å¼€æ–‡ä»¶åä¼šä½œä¸€äº›æ–‡ä»¶è¯»å–æˆ–å†™å…¥çš„åŠ¨ä½œ, è‹¥å¼€æ–‡ä»¶å¤±è´¥, æ¥ä¸‹æ¥çš„è¯»å†™åŠ¨ä½œä¹Ÿæ— æ³•é¡ºåˆ©è¿›è¡Œ, æ‰€ä»¥åœ¨ fopen()åè¯·ä½œé”™è¯¯åˆ¤æ–­åŠå¤„ç†. fputc: å°†ä¸€æŒ‡å®šå­—ç¬¦å†™å…¥æ–‡ä»¶å†…å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰:int fputc(int c, FILE *stream); è¯´æ˜: fputc ä¼šå°†å‚æ•° c è½¬æ¢ä¸º unsigned char åå†™å…¥å‚æ•° stream æŒ‡å®šçš„æ–‡ä»¶ä¸­. è‹¥æˆåŠŸè¿”å›å†™å…¥çš„å­—ç¬¦å³å‚æ•° c, å¤±è´¥è¿”å› EOF. fputs: å°†ä¸€æŒ‡å®šå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶å†…å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: int fputs(const char *s, FILE *stream); è¯´æ˜: fputs()ç”¨æ¥å°†å‚æ•° s æ‰€æŒ‡çš„å­—ç¬¦ä¸²å†™å…¥åˆ°å‚æ•° stream æ‰€æŒ‡çš„æ–‡ä»¶å†…. è‹¥æˆåŠŸè¿”å›å†™å…¥å­—ç¬¦ä¸ªæ•°, å¤±è´¥è¿”å› EOF. fread: ä»æ–‡ä»¶æµè¯»å–æ•°æ®å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: size_t fread(void *ptr, size_t size, size_t nmemb, FILE *stream); è¯´æ˜: fread()ç”¨æ¥ä»æ–‡ä»¶æµä¸­è¯»å–æ•°æ®.å‚æ•° stream ä¸ºå·²æ‰“å¼€çš„æ–‡ä»¶æŒ‡é’ˆ, å‚æ•° ptr æŒ‡å‘æ¬²å­˜æ”¾è¯»å–è¿›æ¥çš„æ•°æ®ç©ºé—´, å‚æ•° size ä¸ºæ¯ä¸€é¡¹æ•°æ®çš„å¤§å°, å‚æ•° nmemb è¡¨ç¤ºè¦è¯»å–çš„æ•°æ®é¡¹ä¸ªæ•°. fread()è¿”å›å®é™…è¯»å–åˆ°çš„æ•°æ®é¡¹ä¸ªæ•°, å¦‚æœæ¯”å‚æ•° nmemb å°, å¿…é¡»ç”¨ feof()æˆ– ferror()æ¥ç¡®å®šå‘ç”Ÿäº†ä»€ä¹ˆæƒ…å†µ. fwrite: å°†æ•°æ®å†™å…¥æ–‡ä»¶æµä¸­å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: size_t fwrite(const void *ptr, size_t size, size_t nmemb, FILE *stream); è¯´æ˜: fwrite()ç”¨æ¥å‘æ–‡ä»¶æµä¸­å†™å…¥æ•°æ®.å‚æ•° stream ä¸ºå·²æ‰“å¼€çš„æ–‡ä»¶æŒ‡é’ˆ, å‚æ•° ptr æŒ‡å‘æ¬²å­˜å†™å…¥çš„æ•°æ®ç©ºé—´, å‚æ•° size ä¸ºæ¯ä¸€é¡¹æ•°æ®çš„å¤§å°, å‚æ•° nmemb è¡¨ç¤ºè¦è¯»å–çš„æ•°æ®é¡¹ä¸ªæ•°. fwrite()è¿”å›å®é™…å†™å…¥çš„æ•°æ®é¡¹ä¸ªæ•°. freopen: å…³é—­åŸæ–‡ä»¶, æ‰“å¼€æ–°æ–‡ä»¶å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: FILE *freopen(cosnt char *path, const char *mode, FILE *stream); è¯´æ˜: å‚æ•° path å­—ç¬¦ä¸²åŒ…å«æ¬²æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„åŠæ–‡ä»¶å, å‚æ•° mode è¯·å‚è€ƒ fopen()è¯´æ˜. å‚æ•° stream ä¸ºå·²æ‰“å¼€çš„æ–‡ä»¶æŒ‡é’ˆ. freopen()ä¼šå°†åŸ stream æ‰€æ‰“å¼€çš„æ–‡ä»¶æµå…³é—­, ç„¶åæ‰“å¼€å‚æ•° path çš„æ–‡ä»¶. æ–‡ä»¶æ‰“å¼€æˆåŠŸ, è¿”å›æŒ‡å‘è¯¥æµçš„æ–‡ä»¶æŒ‡é’ˆ. è‹¥æœæ–‡ä»¶æ‰“å¼€å¤±è´¥åˆ™è¿”å› NULL, å¹¶æŠŠé”™è¯¯ä»£ç å­˜åœ¨ errno ä¸­. fseek: ç§»åŠ¨æ–‡ä»¶æµçš„è¯»å†™ä½ç½®å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: int fseek(FILE *stream, long offset, int whence); è¯´æ˜: fseek()ç”¨æ¥ç§»åŠ¨æ–‡ä»¶æµçš„è¯»å†™ä½ç½®. å‚æ•° stream ä¸ºå·²æ‰“å¼€çš„æ–‡ä»¶æŒ‡é’ˆ, å‚æ•° offset ä¸ºæ ¹æ®å‚æ•° whence æ¥ç§»åŠ¨è¯»å†™ä½ç½®çš„ä½ç§»æ•°. å‚æ•° whence ä¸ºä¸‹åˆ—å…¶ä¸­ä¸€ç§: SEEK_SET ä»è·æ–‡ä»¶å¼€å¤´ offset ä½ç§»é‡ä¸ºæ–°çš„è¯»å†™ä½ç½®. SEEK_CUR ä»¥ç›®å‰çš„è¯»å†™ä½ç½®å¾€åå¢åŠ  offset ä¸ªä½ç§»é‡. SEEK_END å°†è¯»å†™ä½ç½®æŒ‡å‘æ–‡ä»¶å°¾åå†å¢åŠ  offset ä¸ªä½ç§»é‡.å½“ whence å€¼ä¸º SEEK_CUR æˆ– SEEK_END æ—¶, å‚æ•° offset å…è®¸è´Ÿå€¼çš„å‡ºç°. ä¸‹åˆ—æ˜¯è¾ƒç‰¹åˆ«çš„ä½¿ç”¨æ–¹å¼ï¼š1)æ¬²å°†è¯»å†™ä½ç½®ç§»åŠ¨åˆ°æ–‡ä»¶å¼€å¤´æ—¶ï¼šfseek(FILE *stream, 0, SEEK_SET); 2)æ¬²å°†è¯»å†™ä½ç½®ç§»åŠ¨åˆ°æ–‡ä»¶å°¾æ—¶ï¼šfseek(FILE *stream, 0, SEEK_END); å½“è°ƒç”¨æˆåŠŸæ—¶åˆ™è¿”å› 0, è‹¥æœ‰é”™è¯¯åˆ™è¿”å›-1, errno ä¼šå­˜æ”¾é”™è¯¯ä»£ç .é™„åŠ è¯´æ˜: fseek()ä¸åƒ lseek()ä¼šè¿”å›è¯»å†™ä½ç½®, å› æ­¤å¿…é¡»ä½¿ç”¨ ftell()æ¥å–å¾—ç›®å‰è¯»å†™çš„ä½ç½®. fsetpos: ç§»åŠ¨æ–‡ä»¶æµçš„è¯»å†™ä½ç½®å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: int fsetpos(FILE *stream, fpos_t *pos); è¯´æ˜: fsetpos()å’Œ fseek()ä¸€æ ·éƒ½æ˜¯ç”¨æ¥ç§»åŠ¨æ–‡ä»¶æµçš„è¯»å†™ä½ç½®. å‚æ•° stream ä¸ºå·²æ‰“å¼€çš„æ–‡ä»¶æŒ‡é’ˆ, å‚æ•° pos ä¸ºæ¬²ç§»åŠ¨åˆ°çš„è¯»å†™ä½ç½®. å½“è°ƒç”¨æˆåŠŸæ—¶åˆ™è¿”å› 0, è‹¥æœ‰é”™è¯¯åˆ™è¿”å›-1, errno ä¼šå­˜æ”¾é”™è¯¯ä»£ç . ftell: å–å¾—æ–‡ä»¶æµçš„è¯»å–ä½ç½®å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰:long ftell(FILE *stream); è¯´æ˜: ftell()ç”¨æ¥å–å¾—æ–‡ä»¶æµç›®å‰çš„è¯»å†™ä½ç½®. å‚æ•° stream ä¸ºå·²æ‰“å¼€çš„æ–‡ä»¶æŒ‡é’ˆ. å½“è°ƒç”¨æˆåŠŸæ—¶åˆ™è¿”å›ç›®å‰çš„è¯»å†™ä½ç½®, è‹¥æœ‰é”™è¯¯åˆ™è¿”å›-1, errno ä¼šå­˜æ”¾é”™è¯¯ä»£ç . é”™è¯¯ä»£ç  EBADF è¡¨ç¤ºå‚æ•°æ— æ•ˆæˆ–å¯ç§»åŠ¨è¯»å†™ä½ç½®çš„æ–‡ä»¶æµ. getc: ç”±æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: int getc(FILE *stream); è¯´æ˜: getc()ç”¨æ¥ä»å‚æ•° stream æ‰€æŒ‡çš„æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦, è¯»å–ä½ç½®åŠ  1. æˆåŠŸä¼šè¿”å›è¯»å–åˆ°çš„å­—ç¬¦, è‹¥è¯»åˆ°æ–‡ä»¶å°¾è€Œæ— æ•°æ®å¯è¯»æ—¶è¿”å› EOF. è™½ç„¶ getc()å’Œ fgetc()ä½œç”¨ç›¸åŒ, ä½† getc()ä¸ºå®å®šä¹‰, éçœŸæ­£çš„å‡½æ•°è°ƒç”¨. getchar: ç”±æ ‡å‡†è¾“å…¥è®¾å¤‡è¯»å…¥ä¸€ä¸ªå­—ç¬¦å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: int getchar(void);è¯´æ˜: getchar()ç”¨æ¥ä»æ ‡å‡†è¾“å…¥è®¾å¤‡ä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦. ç„¶åå°†è¯¥å­—ç¬¦ä» unsigned char è½¬æ¢æˆ int åè¿”å›. æˆåŠŸä¼šè¿”å›è¯»å–åˆ°çš„å­—ç¬¦, æœ‰é”™è¯¯è¿”å› EOF. getchar()ä¸ºå®å®šä¹‰, ç”± getc(stdin)å®å®šä¹‰. gets: ç”±æ ‡å‡†è¾“å…¥è®¾å¤‡è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: char *gets(char *s); è¯´æ˜: gets()ç”¨æ¥ä»æ ‡å‡†è®¾å¤‡è¯»å…¥å­—ç¬¦å¹¶å­˜åˆ°å‚æ•° s æ‰€æŒ‡çš„å†…å­˜ç©ºé—´, ç›´åˆ°å‡ºç°æ¢è¡Œå­—ç¬¦æˆ–è¯»åˆ°æ–‡ä»¶å°¾ä¸ºæ­¢, æœ€ååŠ ä¸Š NULL ä½œä¸ºå­—ç¬¦ä¸²ç»“æŸ. è‹¥æˆåŠŸåˆ™è¿”å› s æŒ‡é’ˆ, è¿”å› NULL åˆ™è¡¨ç¤ºæœ‰é”™è¯¯å‘ç”Ÿ.é™„åŠ è¯´æ˜: ç”±äº gets()æ— æ³•çŸ¥é“å­—ç¬¦ä¸² s çš„å¤§å°, å¿…é¡»é‡åˆ°æ¢è¡Œå­—ç¬¦æˆ–æ–‡ä»¶å°¾æ‰ä¼šç»“æŸè¾“å…¥, å› æ­¤å®¹æ˜“é€ æˆç¼“å†²æº¢å‡ºçš„å®‰å…¨æ€§é—®é¢˜. å»ºè®®ä½¿ç”¨ fgets()å–ä»£. mktemp: äº§ç”Ÿå”¯ä¸€çš„ä¸´æ—¶æ–‡ä»¶åå¤´æ–‡ä»¶: stdlib.hå‡½æ•°å®šä¹‰: char *mktemp(char *template); è¯´æ˜: mktempï¼ˆï¼‰ç”¨æ¥äº§ç”Ÿå”¯ä¸€çš„ä¸´æ—¶æ–‡ä»¶å. å‚æ•° template æ‰€æŒ‡çš„æ–‡ä»¶åç§°å­—ç¬¦ä¸²ä¸­æœ€åå…­ä¸ªå­—ç¬¦å¿…é¡»æ˜¯ XXXXXX. äº§ç”Ÿåçš„æ–‡ä»¶åä¼šå­˜æ”¾åœ¨å­—ç¬¦ä¸²æŒ‡é’ˆå‚æ•° template ä¸­. è‹¥è°ƒç”¨æˆåŠŸæŒ‡å‘è¯¥æµçš„æ–‡ä»¶åæŒ‡é’ˆå°±ä¼šè¢«è¿”å›. å¤±è´¥åˆ™è¿”å› NULL, å¹¶æŠŠé”™è¯¯ä»£ç å­˜åœ¨ errno ä¸­.é™„åŠ è¯´æ˜: å‚æ•° template æ‰€æŒ‡çš„æ–‡ä»¶åç§°å­—ç¬¦ä¸²å¿…é¡»å£°æ˜ä¸ºæ•°ç»„, å¦‚ char template[]â€template-XXXXXXâ€, ä¸å¯ç”¨ char *templateâ€template-XXXXXXâ€. putc: å°†ä¸€ä¸ªæŒ‡å®šå­—ç¬¦å†™å…¥æ–‡ä»¶ä¸­å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: int putc(int c, FILE *stream); è¯´æ˜: putc()ä¼šå°†å‚æ•° c è½¬ä¸º unsigned char åå†™å…¥å‚æ•° stream æŒ‡å®šçš„æ–‡ä»¶ä¸­. putc()ä¼šè¿”å›å†™å…¥æˆåŠŸçš„å­—ç¬¦, å³å‚æ•° c. è‹¥è¿”å› EOF åˆ™ä»£è¡¨å†™å…¥å¤±è´¥. è™½ç„¶ putc()ä¸ fputc()ä½œç”¨ç›¸åŒ, ä½† putc()ä¸ºå®å®šä¹‰, éçœŸæ­£çš„å‡½æ•°è°ƒç”¨. putchar: å°†æŒ‡å®šçš„å­—ç¬¦å†™åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: int putchar(int c); è¯´æ˜: putchar()ç”¨æ¥å°†å‚æ•° c å­—ç¬¦å†™åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡. putchar()ä¼šè¿”å›è¾“å‡ºæˆåŠŸçš„å­—ç¬¦, å³å‚æ•° c. è‹¥è¿”å› EOF åˆ™ä»£è¡¨è¾“å‡ºå¤±è´¥. putchar()ä¸ºå®å®šä¹‰, ç”± putc(c, stdout)å®å®šä¹‰. puts: å°†æŒ‡å®šçš„å­—ç¬¦ä¸²å†™åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: int puts(const char *s); è¯´æ˜: puts()ç”¨æ¥å°†å‚æ•° s å­—ç¬¦ä¸²å†™åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡. puts()è‹¥æˆåŠŸè¿”å›å†™å‡ºçš„å­—ç¬¦ä¸ªæ•°, è‹¥è¿”å› EOF åˆ™ä»£è¡¨è¾“å‡ºå¤±è´¥. rewind: é‡è®¾æ–‡ä»¶æµçš„è¯»å†™ä½ç½®ä¸ºæ–‡ä»¶å¼€å¤´å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: void rewind(FILE *stream); è¯´æ˜: rewind()ç”¨æ¥æŠŠæ–‡ä»¶æµçš„è¯»å†™ä½ç½®ç§»è‡³æ–‡ä»¶å¼€å¤´. å‚æ•° stream ä¸ºå·²æ‰“å¼€çš„æ–‡ä»¶æŒ‡é’ˆ. æ­¤å‡½æ•°ç›¸å½“äºè°ƒç”¨ fseek(stream, 0, SEEK_SET). setbuf: è®¾ç½®æ–‡ä»¶æµçš„ç¼“å†²åŒºå¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: void setbuf(FILE *stream, char *buf); è¯´æ˜: åœ¨æ‰“å¼€æ–‡ä»¶æµå, è¯»å–å†…å®¹ä¹‹å‰, è°ƒç”¨ setbuf()å¯ä»¥ç”¨æ¥è®¾ç½®æ–‡ä»¶æµçš„ç¼“å†²åŒº. å‚æ•° stream ä¸ºæŒ‡å®šçš„æ–‡ä»¶æµ, å‚æ•° buf æŒ‡å‘è‡ªå®šçš„ç¼“å†²åŒºèµ·å§‹åœ°å€. å¦‚æœå‚æ•° buf ä¸º NULL æŒ‡é’ˆ, åˆ™ä¸ºæ— ç¼“å†² IO. setbuf()ç›¸å½“äºè°ƒç”¨: setvbuf(stream, buf, buf?_IOFBF:_IONBF, BUFSIZ); setbuffer: è®¾ç½®æ–‡ä»¶æµçš„ç¼“å†²åŒºå¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: void setbuffer(FILE *stream, char *buf, size_t size); è¯´æ˜: åœ¨æ‰“å¼€æ–‡ä»¶æµå, è¯»å–å†…å®¹ä¹‹å‰, è°ƒç”¨ setbuffer()å¯ä»¥ç”¨æ¥è®¾ç½®æ–‡ä»¶æµçš„ç¼“å†²åŒº. å‚æ•° stream ä¸ºæŒ‡å®šçš„æ–‡ä»¶æµ, å‚æ•° buf æŒ‡å‘è‡ªå®šçš„ç¼“å†²åŒºèµ·å§‹åœ°å€, å‚æ•° size ä¸ºç¼“å†²åŒºå¤§å°. setlinebuf: è®¾ç½®æ–‡ä»¶æµçš„ç¼“å†²åŒºä¸ºçº¿æ€§ç¼“å†²åŒºå¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: void setlinebuf(FILE *stream); è¯´æ˜: setlinebuf()ç”¨æ¥è®¾ç½®æ–‡ä»¶æµä»¥æ¢è¡Œä¸ºä¾æ®çš„æ— ç¼“å†² IO. ç›¸å½“äºè°ƒç”¨: setvbuf(stream, (char *)NULL, _IOLBF, 0); setvbuf: è®¾ç½®æ–‡ä»¶æµçš„ç¼“å†²åŒºå¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰:int setvbuf(FILE *stream, char *buf, int mode, size_t size); è¯´æ˜: åœ¨æ‰“å¼€æ–‡ä»¶æµå, è¯»å–å†…å®¹ä¹‹å‰, è°ƒç”¨ setvbuf()å¯ä»¥ç”¨æ¥è®¾ç½®æ–‡ä»¶æµçš„ç¼“å†²åŒº. å‚æ•° stream ä¸ºæŒ‡å®šçš„æ–‡ä»¶æµ, å‚æ•° buf æŒ‡å‘è‡ªå®šçš„ç¼“å†²åŒºèµ·å§‹åœ°å€, å‚æ•° size ä¸ºç¼“å†²åŒºå¤§å°, å‚æ•° mode æœ‰ä¸‹åˆ—å‡ ç§ï¼š _IONBF æ— ç¼“å†² IO _IOLBF ä»¥æ¢è¡Œä¸ºä¾æ®çš„æ— ç¼“å†² IO _IOFBF å®Œå…¨æ— ç¼“å†² IO. å¦‚æœå‚æ•° buf ä¸º NULL æŒ‡é’ˆ, åˆ™ä¸ºæ— ç¼“å†² IO. tmpfile: å»ºç«‹ä¸´æ—¶æ–‡ä»¶å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: FILE *tmpfile(void); è¯´æ˜: tmpfile()ç”¨æ¥å»ºç«‹ä¸´æ—¶æ–‡ä»¶. å…¶å»ºç«‹çš„ä¸´æ—¶æ–‡ä»¶çš„ç›®å½•ç”±usrincludestdio.h ä¸­å®šä¹‰çš„ P_tmpdir(tmp)æ¥å†³å®š. è¯¥ä¸´æ—¶æ–‡ä»¶å»ºç«‹åä¼šä»¥å¯è¯»å†™æ¨¡å¼æ‰“å¼€, å¹¶å°†æ–‡ä»¶æŒ‡é’ˆè¿”å›. è‹¥æ–‡ä»¶æ‰“å¼€å¤±è´¥åˆ™è¿”å› NULL, å¹¶æŠŠé”™è¯¯ä»£ç å­˜åœ¨ errno ä¸­. é”™è¯¯ä»£ç : EACCES æ— æ³•å»ºç«‹ä¸´æ—¶æ–‡ä»¶. EEXIST ä¸´æ—¶æ–‡ä»¶å·²å­˜åœ¨. EMFILE å·²è¾¾åˆ°è¿›ç¨‹å¯åŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æ•°ä¸Šé™. ENFILE å·²è¾¾åˆ°ç³»ç»Ÿå¯åŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æ•°ä¸Šé™. ungetc: å°†ä¸€æŒ‡å®šå­—ç¬¦å†™å›æ–‡ä»¶æµä¸­å¤´æ–‡ä»¶: stdio.hå‡½æ•°å®šä¹‰: int ungetc(int c, FILE *stream); è¯´æ˜: ungetc()å°†å‚æ•° c å­—ç¬¦å†™å›å‚æ•° stream æ‰€æŒ‡å®šçš„æ–‡ä»¶æµ. è¿™ä¸ªå†™å›çš„å­—ç¬¦ä¼šç”±ä¸‹ä¸€ä¸ªè¯»å–æ–‡ä»¶æµçš„å‡½æ•°å–å¾—. æˆåŠŸè¿”å› c å­—ç¬¦, è‹¥æœ‰é”™è¯¯è¿”å› EOF.","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","IO"]},{"title":"å¯å˜å‚æ•°å‡½æ•°è¯¦è§£","path":"/2025/06/13/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-å‡½æ•°-å¯å˜å‚æ•°å‡½æ•°è¯¦è§£/","content":"å¯å˜å‚æ•°å‡½æ•°å¯å˜å‚æ•°å‡½æ•°ï¼ˆVariable Arguments Functionsï¼‰ï¼Œä¹Ÿç§°ä¸ºå‚æ•°ä¸ªæ•°å¯å˜çš„å‡½æ•°ï¼Œæ˜¯æŒ‡åœ¨å‡½æ•°å®šä¹‰æ—¶ï¼Œå‚æ•°æ•°é‡å¯ä»¥ç¡®å®šæˆ–ä¸ç¡®å®šçš„å‡½æ•°ã€‚å®ƒä»¬å…è®¸å‡½æ•°æ¥å—ä¸åŒæ•°é‡çš„å‚æ•°ï¼Œè¿™åœ¨æŸäº›ç¼–ç¨‹åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ã€‚ å‡½æ•°åŸå‹å¯å˜å‚æ•°å‡½æ•°çš„åŸå‹é€šå¸¸å†™æˆä»¥ä¸‹å½¢å¼ï¼š type VarArgFunc(type fixed_arg1, type fixed_arg2, â€¦); å‚æ•°ç»“æ„å‡½æ•°å‚æ•°å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š å›ºå®šå‚æ•°ï¼šæ•°é‡å›ºå®šçš„å‚æ•°ï¼Œå…¶å£°æ˜æ–¹å¼ä¸æ™®é€šå‡½æ•°å‚æ•°ç›¸åŒã€‚ å¯é€‰å‚æ•°ï¼šæ•°é‡ä¸å›ºå®šçš„å‚æ•°ï¼Œä½¿ç”¨ ... è¡¨ç¤ºã€‚ å‡½æ•°è‡³å°‘éœ€è¦ä¸€ä¸ªå›ºå®šå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°åœ¨åç»­å¤„ç†ä¸­èµ·ç€å…³é”®ä½œç”¨ã€‚ ç¤ºä¾‹ï¼šprintf å‡½æ•°printf æ˜¯æ ‡å‡†åº“ä¸­æœ€å¸¸ç”¨çš„å¯å˜å‚æ•°å‡½æ•°ä¹‹ä¸€ï¼Œå…¶åŸå‹ä¸ºï¼š int printf(const char* format, ...); format æ˜¯å›ºå®šå‚æ•°ï¼Œè¡¨ç¤ºæ ¼å¼å­—ç¬¦ä¸²ã€‚ ... è¡¨ç¤ºåç»­å‚æ•°æ•°é‡å’Œç±»å‹å‡å¯å˜ã€‚ ç¤ºä¾‹ä»£ç ï¼š // åªè¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²printf(Hello, World!);// è¾“å‡ºæ•´æ•° iprintf(%d, i);// è¾“å‡ºå­—ç¬¦ä¸² sprintf(%s, s);// æ ¼å¼åŒ–è¾“å‡ºprintf(æ•°å­—æ˜¯ %dï¼Œå­—ç¬¦ä¸²æ˜¯:%s, i, s); printf å‡½æ•°é€šè¿‡åˆ†æ format å­—ç¬¦ä¸²æ¥ç¡®å®šåç»­å‚æ•°çš„ä¸ªæ•°å’Œç±»å‹ã€‚ å®ç°åŸç†åœ¨ C è¯­è¨€ä¸­ï¼Œå¯å˜å‚æ•°å‡½æ•°çš„å®ç°ä¾èµ–äº stdarg.h å¤´æ–‡ä»¶ä¸­çš„ va_list ç³»åˆ—å®ã€‚è¿™äº›å®å¸®åŠ©æˆ‘ä»¬è®¿é—®å‡½æ•°å‚æ•°å †æ ˆã€‚ stdarg.h å¤´æ–‡ä»¶å…¸å‹çš„å®ç°æ–¹å¼å¦‚ä¸‹ï¼š #include stdarg.hint VarArgFunc(int fixed_arg, ...) va_list pArgs; // å®šä¹‰ç”¨äºå­˜å‚¨å‚æ•°åœ°å€çš„æŒ‡é’ˆ va_start(pArgs, fixed_arg); // åˆå§‹åŒ– pArgsæŒ‡é’ˆï¼Œä½¿å…¶æŒ‡å‘ç¬¬ä¸€ä¸ªå¯å˜å‚æ•° // access variable arguments int arg = va_arg(pArgs, int); // è·å–ä¸‹ä¸€ä¸ªå¯å˜å‚æ•° va_end(pArgs); // ç»“æŸå¯å˜å‚æ•°çš„å¤„ç† å®çš„ä½œç”¨ **va_list**ï¼šå®šä¹‰ä¸€ä¸ªæŒ‡é’ˆç±»å‹ï¼Œç”¨äºå­˜å‚¨å‚æ•°åœ°å€ã€‚è¯¥æŒ‡é’ˆåªæ˜¯ä¸€ä¸ªéå†å‚æ•°åˆ—è¡¨çš„æ¸¸æ ‡ã€‚ **va_start**ï¼šåˆå§‹åŒ– va_list æŒ‡é’ˆï¼Œä½¿å…¶æŒ‡å‘ç¬¬ä¸€ä¸ªå¯å˜å‚æ•°ã€‚ void va_start(va_list arg_ptr, prev_param); arg_ptr: va_list ç±»å‹çš„æŒ‡é’ˆã€‚ prev_param: æœ€åä¸€ä¸ªå›ºå®šå‚æ•°ã€‚ **va_arg**ï¼šè·å–å½“å‰çš„å¯å˜å‚æ•°ï¼Œå¹¶å°†æŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå‚æ•°ã€‚ type va_arg(va_list arg_ptr, type); type: æœŸæœ›çš„ç±»å‹ã€‚ è¿”å›å€¼ä¸ºæŒ‡å®šç±»å‹çš„å½“å‰å‚æ•°ã€‚ **va_end**ï¼šç»“æŸå¯¹å¯å˜å‚æ•°çš„å¤„ç†ï¼Œå¹¶å°†æŒ‡é’ˆç½®ä¸ºæ— æ•ˆã€‚ void va_end(va_list arg_ptr); æ³¨æ„ï¼šå¿…é¡»åœ¨æ¯æ¬¡ä½¿ç”¨ va_start åè°ƒç”¨ va_endï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼æˆ–å…¶ä»–é”™è¯¯ã€‚ å†…å­˜å¸ƒå±€åœ¨å †æ ˆä¸­ï¼Œå›ºå®šå‚æ•°å’Œå¯å˜å‚æ•°æ˜¯æŒ‰ç…§è°ƒç”¨é¡ºåºä¾æ¬¡å­˜å‚¨çš„ã€‚va_start åˆå§‹åŒ–æŒ‡é’ˆåï¼Œva_arg ä¼šæ ¹æ®ç±»å‹çš„å¤§å°ç§»åŠ¨æŒ‡é’ˆã€‚ ç¤ºä¾‹ï¼š int VarArgFunc(int fixed_arg, ...) va_list pArgs; va_start(pArgs, fixed_arg); // åˆå§‹åŒ–æŒ‡é’ˆåˆ°ç¬¬ä¸€ä¸ªå¯å˜å‚æ•° int arg1 = va_arg(pArgs, int); // è·³è¿‡ int å¤§å° float arg2 = va_arg(pArgs, float); // è·³è¿‡ float å¤§å° va_end(pArgs); va_arg æ ¹æ®ç±»å‹æ¨è¿›æŒ‡é’ˆï¼Œå› æ­¤ ç±»å‹å¿…é¡»ä¸å®é™…å‚æ•°ç±»å‹åŒ¹é…ã€‚ å®ç°ç»†èŠ‚ç¼–è¯‘å™¨å®ç°å·®å¼‚å˜å‚å‡½æ•°çš„å®ç°å¯èƒ½å› å¹³å°å’Œç¼–è¯‘å™¨è€Œå¼‚ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…¸å‹å®ç°ï¼š System V Unix#include varargs.h // æ—©æœŸç‰ˆæœ¬void va_start(va_list arg_ptr); ANSI C æ ‡å‡†#include stdarg.hvoid va_start(va_list arg_ptr, prev_param); ç°ä»£ä»£ç åº”ä½¿ç”¨ ANSI C çš„ va_start å®šä¹‰ï¼Œä»¥æé«˜ç§»æ¤æ€§ã€‚ GCC å®ç°GCC ä½¿ç”¨å†…ç½®å‡½æ•°å®ç°å˜å‚å®ï¼Œä¾‹å¦‚ï¼š #define va_start(v,l) __builtin_va_start(v,l) è¿™ä½¿å¾— GCC èƒ½å¤Ÿæ›´å¥½åœ°é€‚é…ä¸åŒå¹³å°ã€‚ å¯å˜å‚æ•°å‡½æ•°çš„å±€é™æ€§ ç±»å‹ä¸å®‰å…¨ï¼šæ²¡æœ‰ç±»å‹æ£€æŸ¥ï¼Œå¯¼è‡´å¯èƒ½å‡ºç°ç±»å‹ä¸åŒ¹é…çš„é”™è¯¯ã€‚ ä¸ªæ•°ä¸ç¡®å®šæ€§ï¼šå‡½æ•°å†…éƒ¨æ— æ³•ç›´æ¥åˆ¤æ–­å‚æ•°æ•°é‡ï¼Œéœ€è¦é¢å¤–çš„é€»è¾‘æ¥ç¡®å®šéå†ç»ˆæ­¢æ¡ä»¶ã€‚ å¹³å°ä¾èµ–æ€§ï¼šå˜å‚å‡½æ•°çš„å®ç°ç»†èŠ‚å› å¹³å°è€Œå¼‚ï¼Œç§»æ¤ä»£ç æ—¶éœ€è¦æ³¨æ„ã€‚ å®é™…åº”ç”¨1. printf å‡½æ•°æ—printf ä½¿ç”¨æ ¼å¼å­—ç¬¦ä¸²æ¥æ¨å¯¼å‚æ•°ç±»å‹ï¼Œä¾‹å¦‚ï¼š // æ ¼å¼å­—ç¬¦ä¸²æŒ‡ç¤ºåç»­å‚æ•°ç±»å‹int result = printf(%d + %f = %lf, int_arg, float_arg, double_arg); 2. è‡ªå®šä¹‰å˜å‚å‡½æ•°ä»¥ä¸‹æ˜¯ä¸€ä¸ªè®¡ç®—å¹³å‡å€¼çš„å˜å‚å‡½æ•°ï¼š #include stdarg.h#include stddef.hdouble average(int count, ...) va_list pArgs; va_start(pArgs, count); double sum = 0.0; for (int i = 0; i count; i++) sum += va_arg(pArgs, double); va_end(pArgs); return sum / count; è°ƒç”¨ç¤ºä¾‹ï¼š // è®¡ç®—3ä¸ªæ•°çš„å¹³å‡å€¼double avg = average(3, 1.0, 2.0, 3.0); 3. ç±»å‹æ¨å¯¼æœºåˆ¶ä¸ºäº†å…‹æœç±»å‹ä¸å®‰å…¨æ€§ï¼Œå¯ä»¥è®¾è®¡ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š æ ¼å¼å­—ç¬¦ä¸²ï¼šå¦‚ printfï¼Œé€šè¿‡è§£ææ ¼å¼å­—ç¬¦ä¸²æ¥ç¡®å®šå‚æ•°ç±»å‹ã€‚ æ˜¾å¼ç±»å‹æ ‡è®°ï¼šåœ¨å›ºå®šå‚æ•°ä¸­æ·»åŠ ç±»å‹ä¿¡æ¯ï¼Œä¾‹å¦‚æŒ‡å‘ç±»å‹æšä¸¾çš„æŒ‡é’ˆã€‚ çº¦å®šä¼˜å…ˆï¼š caller å’Œ callee äº‹å…ˆçº¦å®šå‚æ•°é¡ºåºå’Œç±»å‹ã€‚ æœ€ä½³å®è·µ æ•°é‡ç¡®å®šï¼š ä¸ºå‚æ•°æ•°é‡è®¾ç½®æ˜¾å¼é™åˆ¶ï¼Œæˆ–ç”¨ç‰¹æ®Šå€¼ï¼ˆå¦‚ -1ï¼‰è¡¨ç¤ºç»“æŸã€‚ ç±»å‹å®‰å…¨ï¼š å°½å¯èƒ½ä½¿ç”¨æ ¼å¼å­—ç¬¦ä¸²æˆ–ç±»å‹æ ‡è®°æ¥æ¨å¯¼å‚æ•°ç±»å‹ã€‚ é¿å…å¯„å­˜å™¨å˜é‡ï¼š ä¿è¯å›ºå®šå‚æ•°ä¸æ˜¯å¯„å­˜å™¨å˜é‡ï¼Œå› ä¸º va_start éœ€è¦å›ºå®šå‚æ•°çš„å†…å­˜åœ°å€ã€‚ æ­£ç¡®åˆå§‹åŒ–å’Œç»ˆæ­¢ï¼š ç¡®ä¿æ¯æ¬¡è°ƒç”¨ va_start å‡åœ¨å¯¹åº”çš„ va_end ä¹‹åã€‚ æé†’å’Œæ–‡æ¡£ï¼š ä½¿ç”¨ __attribute__((sentinel)) æˆ– Similar å®ï¼Œå¸®åŠ©ç¼–è¯‘å™¨æ£€æµ‹é”™è¯¯ã€‚ åœ¨å‡½æ•°æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜å˜å‚çš„ç±»å‹å’Œçº¦æŸæ¡ä»¶ã€‚ æ€»ç»“å¯å˜å‚æ•°å‡½æ•°ä¸º C è¯­è¨€å¸¦æ¥äº†çµæ´»æ€§ï¼Œä½†ä¹Ÿä¼´éšç€ç±»å‹å®‰å…¨å’Œå¹³å°å…¼å®¹æ€§æ–¹é¢çš„æŒ‘æˆ˜ã€‚æ­£ç¡®ä½¿ç”¨å˜å‚åŠŸèƒ½éœ€è¦ï¼š äº†è§£å®ç°ç»†èŠ‚å’Œå±€é™æ€§ã€‚ æä¾›é¢å¤–çš„å…ƒæ•°æ®ï¼ˆå¦‚æ ¼å¼å­—ç¬¦ä¸²ï¼‰ã€‚ éµå¾ªå¹³å°æ— å…³çš„ç¼–ç¨‹è§„èŒƒã€‚ æ…é‡ä½¿ç”¨ï¼Œä»¥é¿å…æ½œåœ¨çš„ type mismatch Errorsã€‚ 2 å˜å‚å‡½æ•°ä»£ç ç¤ºä¾‹æœ¬èŠ‚æä¾›å¤šä¸ªéµå¾ª ANSI C æ ‡å‡†çš„ç®€å•å¯å˜å‚æ•°å‡½æ•°ç¤ºä¾‹ï¼Œè¿™äº›ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨æ ‡å‡†åº“çš„å˜å‚å‡½æ•°æœºåˆ¶ä»¥åŠå¦‚ä½•åœ¨å®é™…ç¼–ç¨‹ä¸­çµæ´»åº”ç”¨å˜å‚æŠ€æœ¯ã€‚æ¯ä¸ªç¤ºä¾‹éƒ½å°½å¯èƒ½æä¾›æ¸…æ™°çš„åŠŸèƒ½è¯´æ˜ã€ä»£ç ç¤ºä¾‹å’Œè°ƒç”¨æ–¹å¼ï¼Œå¹¶å¯¹å…¶å®ç°åŸç†è¿›è¡Œäº†è¯¦ç»†è¯´æ˜ï¼Œä¾¿äºè¯»è€…ç†è§£å’Œåº”ç”¨ã€‚ é€šè¿‡è¿™äº›ç¤ºä¾‹å¯ä»¥çœ‹å‡ºï¼Œå˜å‚å‡½æ•°åœ¨å¤„ç†åŠ¨æ€å‚æ•°ä¸ªæ•°æˆ–ç±»å‹æ—¶éå¸¸æœ‰ç”¨ï¼Œä½†åœ¨ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„å…¶æ½œåœ¨çš„ä¸ç¨³å®šæ€§å’Œæœ‰é™æ€§ã€‚ ã€ç¤ºä¾‹ 1ã€‘æœ€åŸºç¡€çš„æ•´å‹å˜å‚å‡½æ•°åŠŸèƒ½è¯´æ˜å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªæ•´å‹å›ºå®šå‚æ•°å’Œä¸€ä¸ªæ•´å‹å¯å˜å‚æ•°ï¼Œå¹¶æ‰“å°è¿™ä¸¤ä¸ªå‚æ•°å€¼ã€‚è°ƒç”¨æ—¶è‹¥æœªä¼ å…¥å¯å˜å‚æ•°ï¼Œå¯èƒ½ä¼šå¼•å‘ä¸ç¡®å®šçš„è¾“å‡ºã€‚ æ³¨æ„äº‹é¡¹ å˜å‚å‡½æ•°æ— æ³•çŸ¥é“å¯å˜å‚æ•°çš„ä¸ªæ•°ï¼Œå› æ­¤è°ƒç”¨æ—¶éœ€é€šè¿‡æŸç§æ–¹å¼ï¼ˆå¦‚å›ºå®šå‚æ•°ï¼Œç»“æŸæ ‡è®°æˆ–ä¸Šä¸‹æ–‡çº¦å®šï¼‰æŒ‡ç¤ºå˜å‚çš„æ•°é‡æˆ–èŒƒå›´ã€‚ æœ¬ç¤ºä¾‹ä»…æ˜¯æœ€åŸºç¡€çš„å˜å‚å‡½æ•°ï¼Œè‹¥æƒ³å®‰å…¨ç¨³å¦¥åœ°ä½¿ç”¨å˜å‚å‡½æ•°ï¼Œåº”å‚è€ƒéšåçš„æ›´å®Œå–„çš„ç¤ºä¾‹ã€‚ å®ç°ä»£ç #include stdarg.h#include stdio.hvoid IntegerVarArgFunc(int i, ...) va_list pArgs; va_start(pArgs, i); int j = va_arg(pArgs, int); va_end(pArgs); printf(i=%d, j=%d , i, j); è°ƒç”¨æ–¹å¼åŠå…¶è¾“å‡º1.è°ƒç”¨æ–¹å¼ï¼šIntegerVarArgFunc(10); è¾“å‡ºï¼ši=10, j=6803972ï¼ˆj çš„å€¼æ˜¯å †æ ˆä¸Šçš„éšæœºå€¼ï¼Œå®é™…ç»“æœä¸ç¡®å®šï¼‰ 2.è°ƒç”¨æ–¹å¼ï¼šIntegerVarArgFunc(10, 20); è¾“å‡ºï¼ši=10, j=20ï¼ˆç¬¦åˆé¢„æœŸï¼‰ 3.è°ƒç”¨æ–¹å¼ï¼šIntegerVarArgFunc(10, 20, 30); è¾“å‡ºï¼ši=10, j=20ï¼ˆå¤šä½™çš„å‚æ•°è¢«å¿½ç•¥ï¼‰ å®ç°åŸç†è¯´æ˜åœ¨ç¬¬ä¸€ä¸ªè°ƒç”¨ä¸­ï¼Œåªä¼ å…¥äº†ä¸€ä¸ªå›ºå®šå‚æ•°ï¼Œè€Œå‡½æ•°å°è¯•è·å–ç¬¬äºŒä¸ªæ•´å‹å‚æ•°å€¼æ—¶ï¼Œå®é™…ä¸Šè¯»å–çš„æ˜¯å †æ ˆä¸Šçš„éšæœºå€¼ã€‚è¿™ç§æƒ…å†µä¸‹è¾“å‡ºæ˜¯ä¸ç¡®å®šçš„ï¼Œå¯èƒ½å¼•å‘è¯¯ç”¨çš„é”™è¯¯ã€‚è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å˜å‚å‡½æ•°çš„åŸºç¡€ç»“æ„ï¼Œä½†ä¹Ÿæ˜ç¡®äº†å¦‚æœæ²¡èƒ½æ­£ç¡®çº¦å®šå˜å‚èŒƒå›´æ—¶çš„æ½œåœ¨é—®é¢˜ã€‚ ã€ç¤ºä¾‹ 2ã€‘åŸºäºå›ºå®šå‚æ•°æŒ‡å®šå˜å‚ä¸ªæ•°çš„å‡½æ•°åŠŸèƒ½è¯´æ˜é€šè¿‡å›ºå®šå‚æ•°æŒ‡å®šå¯å˜å‚æ•°çš„ä¸ªæ•°ï¼Œå¾ªç¯æ‰“å°æ‰€æœ‰å˜å‚å€¼ã€‚ å®ç°ä»£ç #include stdarg.h#include stdio.hvoid ParseVarArgByNum(int num, ...) va_list pArgs; va_start(pArgs, num); int value; for (int i = 0; i num; i++) value = va_arg(pArgs, int); printf(The %dth Argument: %d , i+1, value); va_end(pArgs); è°ƒç”¨æ–¹å¼åŠå…¶è¾“å‡ºè°ƒç”¨æ–¹å¼ï¼šParseVarArgByNum(3, 11, 22, 33); è¾“å‡ºï¼š The 1th Argument: 11The 2th Argument: 22The 3th Argument: 33 å®ç°è¦ç‚¹ å›ºå®šå‚æ•°æŒ‡å®šäº†å˜å‚çš„ä¸ªæ•°ï¼Œç¡®ä¿äº†è¯»å–çš„å˜å‚æ•°é‡æ­£ç¡®ã€‚ æ¯ä¸ªå˜å‚å€¼éƒ½æ˜¯æŒ‰å›ºå®šç±»å‹ï¼ˆæœ¬ä¾‹ä¸­ä¸º intï¼‰è¯»å–ï¼Œè¿™åœ¨å‚æ•°ç±»å‹å·²çŸ¥ç¡®å®šæ—¶éå¸¸æœ‰ç”¨ã€‚ ã€ç¤ºä¾‹ 3ã€‘åŸºäºç»“æŸæ ‡è®°çš„å˜å‚å‡½æ•°åŠŸèƒ½è¯´æ˜å‡½æ•°é€šè¿‡æœ€åä¸€ä¸ªå‚æ•°ä¼ é€’ç‰¹å®šçš„ç»“æŸæ ‡è®°ï¼Œå¾ªç¯è·å–å˜å‚ç›´åˆ°é‡åˆ°è¯¥æ ‡è®°ã€‚ å®ç°ä»£ç #include stdarg.h#include stdio.hvoid ParseVarArgByEnd(int dwStart, ...) va_list pArgs; va_start(pArgs, dwStart); int dwArgIdx = 0; int dwArgVal = dwStart; while (dwArgVal != -1) // -1 ä½œä¸ºå˜å‚ç»“æŸçš„æ ‡è®° ++dwArgIdx; printf(The %dth Argument: %d , dwArgIdx, dwArgVal); dwArgVal = va_arg(pArgs, int); // è·å–ä¸‹ä¸€ä¸ªå˜å‚å€¼ va_end(pArgs); è°ƒç”¨æ–¹å¼åŠå…¶è¾“å‡ºè°ƒç”¨æ–¹å¼ï¼šParseVarArgByEnd(44, 55, -1); è¾“å‡ºï¼š The 1th Argument: 44The 2th Argument: 55 å®ç°è¦ç‚¹ ä½¿ç”¨ -1 ä½œä¸ºå˜å‚ç»“æŸçš„æ ‡è®°ï¼Œæ˜ç¡®ç»ˆæ­¢å¾ªç¯çš„æ¡ä»¶ã€‚ è¿™ç§æœºåˆ¶åœ¨å‚æ•°ä¸ªæ•°ä¸ç¡®å®šä½†éœ€æŒ‰ç…§ä¸€å®šé¡ºåºå¤„ç†å‰æ‰€æœ‰å‚æ•°æ—¶éå¸¸æœ‰ç”¨ã€‚ åœ¨å®é™…åº”ç”¨ä¸­åº”ç¡®ä¿æ‰€æœ‰è°ƒç”¨ä¸€è‡´åœ°ä½¿ç”¨ç›¸åŒçš„ç»“æŸæ ‡è®°ã€‚ ã€ç¤ºä¾‹ 4ã€‘å¢å¼ºç‰ˆçš„å˜å‚æ•°ç±»å‹å‡½æ•°åŠŸèƒ½è¯´æ˜é€šè¿‡æšä¸¾å®šä¹‰å¯èƒ½å‡ºç°çš„å‚æ•°ç±»å‹ï¼Œåœ¨å˜å‚åˆ—è¡¨ä¸­æ˜¾å¼æŒ‡å®šæ¯ä¸ªå‚æ•°çš„ç±»å‹ï¼Œå¹¶åˆ†åˆ«å¤„ç†ã€‚ å®ç°ä»£ç #include stdarg.h#include stdio.h#include string.h// å®šä¹‰å‚æ•°ç±»å‹çš„æšä¸¾typedef enum INT_TYPE, STR_TYPE, CHAR_TYPE E_VAR_TYPE;void ParseVarArgType(int argc, ...) va_list pArgs; va_start(pArgs, argc); for (int i = 0; i argc; i++) int type = va_arg(pArgs, E_VAR_TYPE); switch (type) case INT_TYPE: int valore = va_arg(pArgs, int); printf(The %dth Argument: %d , i+1, valore); break; case STR_TYPE: char* str = va_arg(pArgs, char*); printf(The %dth Argument: %s , i+1, str); break; case CHAR_TYPE: char c = va_arg(pArgs, int); // å› ä¸ºcharåœ¨va_argä¸­ä¼šæå‡ä¸ºint printf(The %dth Argument: %c , i+1, c); break; default: // å¤„ç†æœªçŸ¥ç±»å‹ï¼Œä¾‹å¦‚å¿½ç•¥æˆ–è®°å½•é”™è¯¯ break; va_end(pArgs); è°ƒç”¨æ–¹å¼åŠå…¶è¾“å‡ºè°ƒç”¨æ–¹å¼ï¼šParseVarArgType(3, CHAR_TYPE, A, STR_TYPE, HelloWorld, INT_TYPE, 123); è¾“å‡ºï¼š The 1th Argument: AThe 2th Argument: HelloWorldThe 3th Argument: 123 å®ç°è¦ç‚¹ æšä¸¾ç±»å‹(E_VAR_TYPE)å®šä¹‰äº†å¯å˜å‚æ•°å¯èƒ½çš„ç±»å‹ã€‚ æ¯æ¬¡å¾ªç¯è¯»å–ä¸€ä¸ªç±»å‹ï¼Œç„¶åæ ¹æ®ç±»å‹è¯»å–å¯¹åº”çš„å‚æ•°å€¼å¹¶è¿›è¡Œå¤„ç†ã€‚ è¿™ç§æ–¹æ³•åœ¨å‚æ•°ç±»å‹å¤šæ ·ä½†åˆå·²çŸ¥çš„æƒ…å†µä¸‹éå¸¸çµæ´»ï¼Œå¯ä»¥æ˜¾å¼åœ°å¤„ç†æ¯ä¸ªå‚æ•°ã€‚ éœ€è¦æ˜ç¡®çº¦å®šå‚æ•°ä¼ é€’çš„é¡ºåºå’Œç±»å‹ã€‚ ã€ç¤ºä¾‹ 5ã€‘å®ç°ç®€æ˜“çš„ MyPrintf å‡½æ•°åŠŸèƒ½è¯´æ˜å®ç°ä¸€ä¸ªç±»ä¼¼ printf å‡½æ•°ï¼Œæ”¯æŒ %dã€%cã€%b å’Œ %% å››ç§æ ¼å¼ã€‚ å®ç°ä»£ç #include stdarg.h#include stdio.h#include string.h#include stdint.h#define BOOL int // å½“æ²¡æœ‰ bool ç±»å‹æ—¶ä½¿ç”¨ int ä»£æ›¿// å°†æ•´æ•°å€¼è½¬æ¢ä¸ºç‰¹å®šè¿›åˆ¶çš„å­—ç¬¦ä¸²char* MyItoa(int iValue, char* pszResBuf, unsigned int uiRadix) if (NULL == pszResBuf) return Nil; if (uiRadix 2 || uiRadix 36) pszResBuf[0] = \\0; return pszResBuf; const char* digits = 0123456789abcdefghijklmnopqrstuvwxyz; char *pStr = pszResBuf; int i; if (uiRadix == 10 iValue 0) *pStr++ = -; iValue = -iValue; do i = iValue % uiRadix; *pStr++ = digits[i]; iValue /= uiRadix; while (iValue != 0); *pStr-- = \\0; // åè½¬å­—ç¬¦ä¸²çš„å‡†å¤‡ while (pszResBuf pStr) char tmp = *pszResBuf; *pszResBuf++ = *pStr; *pStr-- = tmp; return pszResBuf;void MyPrintf(const char* pszFmt, ...) va_list pArgs; va_start(pArgs, pszFmt); for (; *pszFmt != \\0; pszFmt++) if (*pszFmt != %) putchar(*pszFmt); continue; if (pszFmt[1] == %) putchar(%); pszFmt++; continue; switch (*++pszFmt) case d: printf(%d, va_arg(pArgs, int)); break; case c: printf(%c, (char)va_arg(pArgs, int)); break; case b: int value = va_arg(pArgs, int); char buffer[ sizeof(int)*8 +1 ] = 0; MyItoa(value, buffer, 2); printf(%s, buffer); break; default: break; va_end(pArgs); è°ƒç”¨æ–¹å¼åŠå…¶è¾“å‡ºè°ƒç”¨æ–¹å¼ï¼šMyPrintf(Binary string of number %d is = %b! , 9999, 9999); è¾“å‡ºï¼š Binary string of number 9999 is = 10011100001111! å®ç°è¦ç‚¹ MyPrintf å®ç°äº†è‡ªå®šä¹‰æ ¼å¼åŒ–è¾“å‡ºï¼Œæ”¯æŒéƒ¨åˆ†æ ¼å¼å­—ç¬¦ä¸²çš„å¤„ç†ã€‚ MyItoa å‡½æ•°è´Ÿè´£å°†æ•´æ•°è½¬æ¢ä¸ºä¸åŒè¿›åˆ¶çš„å­—ç¬¦ä¸²ã€‚ é€šè¿‡è‡ªå®šä¹‰å¤„ç†ç®€åŒ–äº†æ ¼å¼åŒ–è¾“å‡ºæµç¨‹ï¼ŒåŒæ—¶ä¹Ÿä¿ç•™äº†éƒ¨åˆ†æ ‡å‡†åº“çš„åŠŸèƒ½ã€‚ è¯¥å®ç°å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚æ‰©å±•æ›´å¤šçš„æ ¼å¼åŒ–é€‰é¡¹ã€‚ ã€ç¤ºä¾‹ 6ã€‘é€šè¿‡æ•°ç»„æ¨¡æ‹Ÿå¯å˜å‚æ•°å‡½æ•°åŠŸèƒ½åŠŸèƒ½è¯´æ˜é€šè¿‡ä½¿ç”¨æ•°ç»„æ¥å®ç°ç±»ä¼¼å¯å˜å‚æ•°å‡½æ•°çš„åŠŸèƒ½ï¼Œç‰¹åˆ«é€‚ç”¨äºå‚æ•°ç±»å‹å’Œæ•°é‡å·²çŸ¥çš„æƒ…å†µã€‚ å®ç°ä»£ç #include stdarg.h#include stdio.h#define VAR_ARG_MAX_NUM 10#define VAR_ARG_MAX_LEN 20// å®šä¹‰å‚æ•°ç±»å‹çš„æšä¸¾typedef enum CHAR_TYPE, STR_TYPE E_VAR_TYPE;typedef struct E_VAR_TYPE eArgType; char aucArgVal[VAR_ARG_MAX_LEN]; VAR_ARG_ENTRY;typedef struct unsigned char ucArgNum; VAR_ARG ENTRY aucVarArg[VAR_ARG_MAX_NUM]; VAR_ARG_LIST;void ParseStructArrayArg(VAR_ARG_LIST* ptVarArgList) for (int i = 0; i ptVarArgList-ucArgNum; i++) E_VAR_TYPE eType = ptVarArgList-aucVarArg[i].eArgType; switch (eType) case CHAR_TYPE: printf(The %dth Argument: %c , i+1, *ptVarArgList-aucVarArg[i].aucArgVal); break; case STR_TYPE: printf(The %dth Argument: %s , i+1, ptVarArgList-aucVarArg[i].aucArgVal); break; default: break; è°ƒç”¨æ–¹å¼åŠå…¶è¾“å‡ºVAR_ARG_LIST tVarArgList = 2, CHAR_TYPE, H, STR_TYPE, TEST;ParseStructArrayArg(tVarArgList); è¾“å‡ºï¼š The 1th Argument: HThe 2th Argument: TEST å®ç°è¦ç‚¹ ä½¿ç”¨ç»“æ„ä½“æ•°ç»„æ¥å°è£…å‚æ•°åŠå…¶ç±»å‹ã€‚ è¯¥æ–¹æ³•é€‚ç”¨äºå‚æ•°ç±»å‹å’Œæ•°é‡å·²çŸ¥ä¸”æ•°é‡æœ‰é™çš„åœºåˆã€‚ ä¸»è°ƒå‡½æ•°ä¸è¢«è°ƒå‡½æ•°éƒ½éœ€è¦æå‰çº¦å®šå¥½ç»“æ„ä½“çš„æ ¼å¼å’Œä½¿ç”¨æ–¹å¼ã€‚ å¦‚éå¿…è¦ï¼Œä¸å»ºè®®ä½¿ç”¨å˜å‚å‡½æ•°ï¼šè™½ç„¶å˜å‚å‡½æ•°æä¾›äº†æå¤§çš„çµæ´»æ€§å’Œä¾¿åˆ©æ€§ï¼Œä½†å®ƒä»¬çš„æ½œåœ¨ç¼ºç‚¹è¾ƒå¤šï¼ŒåŒ…æ‹¬ï¼š ç±»å‹ä¸å®‰å…¨æ€§ï¼šå˜å‚å‡½æ•°æ— æ³•è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œå¯èƒ½å¯¼è‡´å€¼ä¼ é€’é”™è¯¯æˆ–å€¼è§£é‡Šé”™è¯¯ã€‚ å‚æ•°æ•°é‡ä¸ç¡®å®šæ€§ï¼šé™¤éç”¨ç‰¹å®šçš„æ–¹æ³•ï¼ˆå¦‚ä¸Šè¿°çš„å›ºå®šå‚æ•°æˆ–ç»“æŸæ ‡è®°ï¼‰æŒ‡æ˜å‚æ•°æ•°é‡ï¼Œå¦åˆ™å‡½æ•°æ— æ³•ç¡®å®šå‚æ•°çš„æ•°é‡ã€‚ ç»´æŠ¤æ€§è¾ƒå·®ï¼šè°ƒç”¨è€…å’Œå®ç°è€…éœ€è¦ä¸¥æ ¼åŒæ­¥å¯¹å˜å‚çš„ä½¿ç”¨æ–¹å¼ï¼Œå¦åˆ™å®¹æ˜“å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ã€‚ ä»€ä¹ˆæ—¶å€™é€‰æ‹©å˜å‚å‡½æ•°ï¼š æ—¥å¿—æˆ–è¾“å‡ºå‡½æ•°ï¼šå¦‚ printf è¿™ç±»å‡½æ•°éœ€è¦æ”¯æŒçµæ´»çš„æ ¼å¼åŒ–è¾“å‡ºã€‚ æ„é€ å‡½æ•°æˆ–åˆå§‹åŒ–å‡½æ•°ï¼šå½“éœ€è¦åˆå§‹åŒ–ç»“æ„ä½“çš„ä¸åŒå­—æ®µæ—¶ï¼Œå˜å‚å‡½æ•°å¯ä»¥éå¸¸æ–¹ä¾¿ã€‚ å…¼å®¹æ—§æœ‰ä»£ç ï¼šå½“éœ€è¦ä¸ C æ ‡å‡†åº“å‡½æ•°æ¥å£å…¼å®¹æ—¶ï¼Œå¯èƒ½éœ€è¦å®ç°å˜å‚å‡½æ•°ã€‚ æ›¿ä»£æ–¹æ¡ˆï¼šåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ›¿ä»£å˜å‚å‡½æ•°ï¼š ä¼ é€’å‚æ•°æ•°ç»„ï¼šå¦‚æœå‚æ•°ç±»å‹ä¸€è‡´ï¼Œå¯ä»¥ä¼ é€’æ•°ç»„ã€‚ ç»“æ„ä½“å‚æ•°ï¼šå°†å‚æ•°åŒ…è£…åœ¨ç»“æ„ä½“ä¸­ï¼Œæ˜ç¡®åœ°ä¼ é€’æ‰€æœ‰å‚æ•°ã€‚ å‡½æ•°é‡è½½ï¼šé€šè¿‡å‡½æ•°é‡è½½ä¸åŒå‚æ•°ç‰ˆæœ¬ï¼Œæä¾›ç±»å‹å®‰å…¨çš„å¤šç§è°ƒç”¨æ–¹å¼ã€‚ æ€»ä¹‹ï¼Œå˜å‚å‡½æ•°åœ¨ç‰¹å®šåœºåˆéå¸¸æœ‰ç”¨ï¼Œä½†åœ¨ç±»å‹å®‰å…¨å’Œç»´æŠ¤æ€§è¦æ±‚é«˜çš„åœºåˆï¼Œåº”å°½é‡é€‰æ‹©æ›´å—æ§çš„å‚æ•°ä¼ é€’æ–¹å¼ã€‚ 3 å˜å‚å‡½æ•°æ³¨æ„äº‹é¡¹åœ¨ç¼–ç¨‹ä¸­ä½¿ç”¨å¯å˜å‚æ•°å‡½æ•°æ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ä»¥ä¸‹é—®é¢˜ï¼Œä»¥ç¡®ä¿ç¨‹åºçš„ç¨³å®šæ€§å’Œæ­£ç¡®æ€§ã€‚ 1. ç¼–è¯‘å™¨çš„åŸå‹æ£€æŸ¥ä¸å¤Ÿä¸¥æ ¼ é—®é¢˜æè¿°ï¼šç¼–è¯‘å™¨å¯¹å˜å‚å‡½æ•°çš„å‚æ•°æ£€æŸ¥ä¸å¤Ÿä¸¥æ ¼ï¼Œå¯èƒ½å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ã€‚ ç¤ºä¾‹à¸±à¸ˆgroupByï¼šä½¿ç”¨ printf å‡½æ•°æ—¶ï¼Œå¦‚æœæ ¼å¼å­—ç¬¦ä¸²ä¸å®é™…å‚æ•°ç±»å‹ä¸åŒ¹é…ï¼Œå¯èƒ½å¼•å‘ç¨‹åºå´©æºƒã€‚ è§£å†³æ–¹æ³•ï¼šç¡®ä¿ä¼ é€’çš„å˜å‚æ•°ç›®å’Œç±»å‹ä¸å‡½æ•°æœŸæœ›çš„ä¸€è‡´ã€‚ä½¿ç”¨ GCC çš„ attribute æœºåˆ¶å¯ä»¥åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ ¼å¼æ£€æŸ¥ï¼Œä¾‹å¦‚ï¼š void OmciLog(LOG_TYPE eLogType, const char *pFmt, ...) __attribute__((format(printf,2,3))); è¿™ä¼šåœ¨è°ƒç”¨ OmciLog(LOG_PON, %s, 1) æ—¶ç”Ÿæˆè­¦å‘Šã€‚ 2. va_arg å®çš„ä½¿ç”¨é™åˆ¶ ä¸å¯æŒ‡å®šçš„ç±»å‹ï¼šcharã€signed charã€unsigned charã€shortã€unsigned shortã€float ç­‰ç±»å‹ã€‚ åŸå› ï¼šè¿™äº›ç±»å‹ä¼šè¢«é»˜è®¤æå‡ï¼Œä¾‹å¦‚ char æå‡ä¸º intï¼Œfloat æå‡ä¸º doubleã€‚ è§£å†³æ–¹æ³•ï¼šåœ¨ä½¿ç”¨ va_arg æ—¶ï¼ŒæŒ‡å®šå¯¹åº”çš„æå‡ç±»å‹ï¼Œå¦‚ä½¿ç”¨ double ä»£æ›¿ floatï¼š double dVar = va_arg(ap, double);float fVar = (float)va_arg(ap, double); 3. å‡½æ•°æŒ‡é’ˆä½œä¸ºå˜å‚ é—®é¢˜ï¼šç›´æ¥ä½¿ç”¨å‡½æ•°æŒ‡é’ˆå¯èƒ½å¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚ è§£å†³æ–¹æ³•ï¼šä½¿ç”¨ typedef å®šä¹‰å‡½æ•°æŒ‡é’ˆç±»å‹ï¼Œä¾‹å¦‚ï¼š typedef int (*pFunc)();int (*pf)() = va_arg(ap, pFunc);pf(); 4. å¯å˜å‚æ•°çš„ä¼ é€’ é™åˆ¶ï¼šæ— æ³•ç›´æ¥ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ã€‚ è§£å†³æ–¹æ³•ï¼šå°†å˜å‚åˆ—è¡¨è½¬æ¢ä¸º va_list ç±»å‹åå†ä¼ é€’ï¼š INT32S OmciLog(E_LOG_TYPE eLogType, const CHAR *pszFmt, ...) va_list pArgs; va_start(pArgs, pszFmt); INT32S dwRetVal = vsnprintf(aucLogBuf, sizeof(aucLogBuf), pszFmt, pArgs); va_end(pArgs); return dwRetVal; 5. æŒ‰é¡ºåºè®¿é—®å˜å‚ é™åˆ¶ï¼šå¿…é¡»æŒ‰é¡ºåºé€ä¸ªè®¿é—®ï¼Œä¸èƒ½è·³è¿‡æˆ–ä¸­æ–­ã€‚ ç¤ºä¾‹ï¼šæ­£ç¡®çš„ä½¿ç”¨æ–¹å¼æ˜¯ä»ç¬¬ä¸€ä¸ªå˜å‚å¼€å§‹ï¼Œä¾æ¬¡å¤„ç†ï¼Œç›´åˆ°ç»“æŸã€‚ 6. è‡³å°‘å®šä¹‰ä¸€ä¸ªå›ºå®šå‚æ•° è¦æ±‚ï¼šANSI C è¦æ±‚å˜å‚å‡½æ•°è‡³å°‘æœ‰ä¸€ä¸ªå›ºå®šå‚æ•°ã€‚ ç¤ºä¾‹ï¼švoid func(...) æ˜¯éæ³•çš„ï¼Œæ­£ç¡®å®šä¹‰åº”ä¸º void func(int, ...)ã€‚ 7. æ›¿ä»£æ–¹æ³• ç»“æ„ä½“æ•°ç»„ï¼šé€‚ç”¨äºå›ºå®šæ•°é‡çš„å‚æ•°ã€‚ å›è°ƒå‡½æ•°ï¼šå¢å¼ºçµæ´»æ€§å’Œå¯è¯»æ€§ï¼Œä¾‹å¦‚ä½¿ç”¨æ¯”è¾ƒå‡½æ•°ä½œä¸ºå‚æ•°ã€‚ C++ç‰¹æ€§ï¼šåˆ©ç”¨å¤šæ€æ€§æˆ–æ¨¡æ¿æ›¿ä»£å˜å‚å‡½æ•°ã€‚ é€šè¿‡äº†è§£è¿™äº›æ³¨æ„äº‹é¡¹ï¼Œå¯ä»¥æ›´å®‰å…¨åœ°ä½¿ç”¨å¯å˜å‚æ•°å‡½æ•°ï¼Œé¿å…å¸¸è§é”™è¯¯ï¼Œæé«˜ä»£ç çš„ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","å‡½æ•°"]},{"title":"æ ‡å‡†IO","path":"/2025/06/13/1-å¹³å°ç³»ç»Ÿ-Linux-IO-æ ‡å‡†IO/","content":"è¯»å†™å‡½æ•°è¯»å†™å‡½æ•°åˆ†ç±»ä¸‰ç±»è¯»å†™å‡½æ•° è¡Œç¼“å­˜å‡½æ•°ï¼šé‡åˆ°æ–°è¡Œç¬¦ ( ) æˆ–å†™æ»¡ç¼“å­˜æ—¶è°ƒç”¨ç³»ç»Ÿè°ƒç”¨å‡½æ•° è¯»å‡½æ•°ï¼šfgets,Â getc,Â getchar,Â fscanf å†™å‡½æ•°ï¼šfputs,Â puts,Â printf æ— ç¼“å­˜å‡½æ•°ï¼šç”¨æˆ·è°ƒç”¨å‡½æ•°æ—¶ç›´æ¥å°†å†…å®¹å†™å…¥å†…æ ¸ å…¨ç¼“å­˜å‡½æ•°ï¼šå†™æ»¡ç¼“å­˜åè°ƒç”¨ç³»ç»Ÿè°ƒç”¨å‡½æ•° è¯»å‡½æ•°ï¼šfread å†™å‡½æ•°ï¼šfwrite è¡Œç¼“å­˜è¯»å†™å‡½æ•°fgets å‡½æ•° åŸå‹ï¼šchar* fgets(char* s, int size, FILE *stream) å‚æ•°ï¼š sï¼šç¼“å­˜åœ°å€ï¼Œç”¨äºå­˜å‚¨è¯»å–çš„å†…å®¹ sizeï¼šè¯»å–çš„å­—èŠ‚æ•° streamï¼šæ–‡ä»¶æµ è¿”å›å€¼ï¼šæˆåŠŸè¿”å›ç¼“å­˜åœ°å€ sï¼Œæ–‡ä»¶ç»“å°¾æˆ–å‡ºé”™è¿”å› NULL åŠŸèƒ½ï¼šä»æ–‡ä»¶æµä¸­è¯»å–å­—ç¬¦ä¸²åˆ°ç¼“å­˜ï¼Œæœ€å¤šè¯»å– size-1 ä¸ªå­—ç¬¦ï¼Œä¼šä¿ç•™æ¢è¡Œç¬¦ fputs å‡½æ•° åŸå‹ï¼šint fputs(const char* s, FILE *stream) å‚æ•°ï¼š sï¼šè¦å†™å…¥çš„å­—ç¬¦ä¸² streamï¼šæ–‡ä»¶æµ è¿”å›å€¼ï¼šæˆåŠŸè¿”å›éè´Ÿå€¼ï¼Œå‡ºé”™è¿”å› EOF(-1) åŠŸèƒ½ï¼šå°†å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶æµï¼Œä¸è‡ªåŠ¨æ·»åŠ æ¢è¡Œç¬¦ï¼Œå…³é—­æ–‡ä»¶å‰ä¼šåˆ·æ–°ç¼“å­˜ fclose å‡½æ•° åŸå‹ï¼šint fclose(FILE *stream) è¿”å›å€¼ï¼šæˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› EOF å¹¶è®¾ç½® errno åŠŸèƒ½ï¼šå…³é—­æ–‡ä»¶æµï¼Œåˆ·æ–°ç¼“å­˜å¹¶é‡Šæ”¾è‡ªåŠ¨åˆ†é…çš„ç¼“å­˜ fread å’Œ fwrite å‡½æ•°int main(int argc, char **argv) FILE *fp; fp = fopen(argv[1],w+); char writebuf[] = Hello linux ; char readbuf[128] = 0; if( fp == NULL ) printf(open file %s fail ,argv[1]); exit(0); printf(open file %s success ,argv[1]); //å¦‚æœç”¨ä¸€ä¸ªæ–‡ä»¶æµæŒ‡é’ˆå»æ“ä½œè¯»å’Œå†™ï¼Œå¿…é¡»å°†æ–‡ä»¶æµæŒ‡é’ˆfseekåˆ°åˆšå¼€å§‹æ“ä½œçš„åœ°æ–¹ fwrite(writebuf,sizeof(char),sizeof(writebuf),fp); //ä»ç¼“å­˜åŒºä¸­å†™å…¥åˆ°fpä¸­ fseek(fp,-13,SEEK_CUR); // rewind(fp); fread(readbuf,sizeof(char),sizeof(readbuf),fp); //ä»fpä¸­è¯»å–åˆ°readbufä¸­ printf(readbuf: %s ,readbuf); fclose(fp); return 0; åˆ·æ–°ç¼“å­˜å‡½æ•°fflush å‡½æ•° åŸå‹ï¼šint fflush(FILE *stream) åŠŸèƒ½ï¼šå¼ºåˆ¶å°†åº“å‡½æ•°ç¼“å­˜ä¸­çš„å†…å®¹å†™å…¥å†…æ ¸ åº”ç”¨åœºæ™¯ï¼šéœ€è¦ç«‹å³å†™å…¥æ•°æ®è€Œä¸ç­‰å¾…ç¼“å­˜æ¡ä»¶æ»¡è¶³æ—¶ #include stdio.hint main() FILE * stream1, * stream2; char test[] = This is a test; char res[20]; // å†™æ–¹å¼æ‰“å¼€æ–‡ä»¶å¹¶å†™å…¥å†…å®¹ stream1 = fopen(test.txt, w); if (stream1 != NULL) fwrite(test, sizeof(char), strlen(test), stream1); // å°†ç¼“å†²åŒºå†…å®¹å†™å…¥æ–‡ä»¶ fflush(stream1); fclose(stream1); // è¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶å¹¶è¯»å–å†…å®¹ stream2 = fopen(test.txt, r); if (stream2 != NULL) if (fread(res, sizeof(char), strlen(test), stream2)) printf(%s , res); else printf(è¯»å–é”™è¯¯! ); fclose(stream2); return 0; è°ƒæ•´è¯»å†™ä½ç½®æŒ‡é’ˆå‡½æ•°fseek å‡½æ•° åŸå‹ï¼šint fseek(FILE *stream, long offset, int whence) å‚æ•°ï¼š offsetï¼šåç§»é‡ whenceï¼šèµ·å§‹ä½ç½®ï¼ˆSEEK_SETã€SEEK_CURã€SEEK_ENDï¼‰ è¿”å›å€¼ï¼šæˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1 åŠŸèƒ½ï¼šè®¾ç½®æ–‡ä»¶ä½ç½®æŒ‡é’ˆï¼Œä¸ lseek å‚æ•°ç›¸åŒä½†è¿”å›å€¼ä¸åŒ #include stdio.hint main() FILE * stream; stream = fopen(example.txt, r); if (stream != NULL) // ç§»åŠ¨åˆ°æ–‡ä»¶å¤´åç¬¬5ä¸ªå­—ç¬¦çš„ä½ç½® fseek(stream, 5, SEEK_SET); // è·å–å½“å‰è¯»å†™ä½ç½® printf(å½“å‰ä½ç½®: %ld , ftell(stream)); // å°†ä½ç½®é‡ç½®åˆ°æ–‡ä»¶å¤´ rewind(stream); // è·å–é‡æ–°ç½®ä½åçš„ä½ç½® printf(é‡ç½®åä½ç½®: %ld , ftell(stream)); // å…³é—­æ–‡ä»¶ fclose(stream); return 0; rewind å‡½æ•° åŸå‹ï¼švoid rewind(FILE *stream) åŠŸèƒ½ï¼šå°†æ–‡ä»¶ä½ç½®æŒ‡é’ˆé‡ç½®åˆ°æ–‡ä»¶å¼€å¤´ ç­‰ä»·äºï¼š(void)fseek(stream, 0, SEEK_SET) #include stdio.hint main() FILE * stream; char buffer[20]; stream = fopen(example.txt, r); if (stream != NULL) // è¯»å–éƒ¨åˆ†å†…å®¹ fread(buffer, 1, 5, stream); printf(ç¬¬1æ¬¡è¯»å–å†…å®¹: %s , buffer); // å°†è¯»å†™ä½ç½®é‡ç½®åˆ°æ–‡ä»¶å¤´ rewind(stream); // å†æ¬¡è¯»å–å†…å®¹ fread(buffer, 1, 5, stream); printf(é‡ç½®åè¯»å–å†…å®¹: %s , buffer); // å…³é—­æ–‡ä»¶ fclose(stream); return 0; ftell å‡½æ•° åŸå‹ï¼šlong ftell(FILE *stream) è¿”å›å€¼ï¼šè¿”å›å½“å‰æ–‡ä»¶ä½ç½®æŒ‡é’ˆå€¼ åŠŸèƒ½ï¼šè·å–æ–‡ä»¶ä½ç½®æŒ‡é’ˆçš„å½“å‰ä½ç½® #include stdio.hint main() FILE * stream; stream = fopen(example.txt, r); if (stream != NULL) // å°†è¯»å†™ä½ç½®ç§»åŠ¨åˆ°ç¬¬10ä¸ªå­—ç¬¦ fseek(stream, 10, SEEK_SET); printf(å½“å‰ä½ç½®: %ld , ftell(stream)); // å…³é—­æ–‡ä»¶ fclose(stream); return 0; gets å’Œ puts å‡½æ•°gets å‡½æ•° åŸå‹ï¼šchar* gets(char *s) é£é™©ï¼šæ— æ³•æŒ‡å®šç¼“å­˜é•¿åº¦ï¼Œå¯èƒ½å¯¼è‡´ç¼“å†²åŒºæº¢å‡º é™åˆ¶ï¼šåªèƒ½ä»æ ‡å‡†è¾“å…¥è¯»å–ï¼Œä¸å­˜å‚¨æ¢è¡Œç¬¦ puts å‡½æ•° åŸå‹ï¼šint puts(const char *s) ç‰¹ç‚¹ï¼šåªèƒ½å‘æ ‡å‡†è¾“å‡ºå†™å…¥ï¼Œè¾“å‡ºæ—¶è‡ªåŠ¨æ·»åŠ æ¢è¡Œç¬¦ ä¸ fgetsfputs çš„åŒºåˆ« å‡½æ•° è¾“å…¥ è¾“å‡ºèŒƒå›´ æ¢è¡Œç¬¦å¤„ç† ç¼“å­˜é•¿åº¦é™åˆ¶ gets æ ‡å‡†è¾“å…¥ ä¸å­˜å‚¨æ¢è¡Œç¬¦ æ—  fgets ä»»æ„æ–‡ä»¶æµ å­˜å‚¨æ¢è¡Œç¬¦ æœ‰ puts æ ‡å‡†è¾“å‡º è‡ªåŠ¨æ·»åŠ æ¢è¡Œç¬¦ æ—  fputs ä»»æ„æ–‡ä»¶æµ ä¸æ·»åŠ æ¢è¡Œç¬¦ï¼ŒåŸæ ·è¾“å‡º æœ‰ æ ¼å¼åŒ–è¯»å†™å‡½æ•°fprintf å‡½æ•° åŸå‹ï¼šint fprintf(FILE *stream, const char *format, ...) åŠŸèƒ½ï¼šæŒ‰æ ¼å¼å‘æ–‡ä»¶æµå†™å…¥æ•°æ® ç¤ºä¾‹ï¼š #include stdio.hint main(int argc, char **argv) FILE *fp = fopen(argv[1], w+); if (NULL == fp) printf(open fail ); return -1; fprintf(fp, open %s success, i=%d , argv[1], 10); fclose(fp); return 0; è¾“å‡ºç»“æœï¼šopen triumph success, i=10 sprintf å‡½æ•° åŸå‹ï¼šint sprintf(char *str, const char *format, ...) åŠŸèƒ½ï¼šæŒ‰æ ¼å¼å°†æ•°æ®å†™å…¥å­—ç¬¦ä¸² ç¤ºä¾‹ï¼š #include stdio.hint main() int i = 10; char buf[128] = 0; sprintf(buf, i=%d , i); printf(buf=%s, buf); return 0; è¾“å‡ºç»“æœï¼šbuf=i=10 å•å­—ç¬¦è¯»å†™å‡½æ•°fgetc å‡½æ•° åŸå‹ï¼šint fgetc(FILE *stream) è¿”å›å€¼ï¼šæˆåŠŸè¿”å›è¯»å–çš„å­—ç¬¦ï¼Œæ–‡ä»¶ç»“å°¾æˆ–å‡ºé”™è¿”å› EOF åŠŸèƒ½ï¼šä»æ–‡ä»¶æµä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦ fputc å‡½æ•° åŸå‹ï¼šint fputc(int c, FILE *stream) è¿”å›å€¼ï¼šæˆåŠŸè¿”å›å†™å…¥çš„å­—ç¬¦ï¼Œå‡ºé”™è¿”å› EOF åŠŸèƒ½ï¼šå‘æ–‡ä»¶æµä¸­å†™å…¥ä¸€ä¸ªå­—ç¬¦ ç¼“å­˜ç‰¹æ€§ï¼šéè¡Œç¼“å­˜å‡½æ•°ï¼Œéœ€æ‰‹åŠ¨è°ƒç”¨ fflush æˆ– fclose åˆ·æ–° æ–‡ä»¶çŠ¶æ€åˆ¤æ–­å‡½æ•°feof å‡½æ•° åŸå‹ï¼šint feof(FILE *stream) è¿”å›å€¼ï¼šæ–‡ä»¶ç»“æŸè¿”å›é 0ï¼Œå¦åˆ™è¿”å› 0 åŠŸèƒ½ï¼šåˆ¤æ–­æ˜¯å¦åˆ°è¾¾æ–‡ä»¶ç»“å°¾ #include stdio.hint main() FILE * fp; int ch; fp = fopen(example.txt, r); if (fp != NULL) while ((ch = fgetc(fp)) != EOF) if (feof(fp)) printf(å·²åˆ°è¾¾æ–‡ä»¶æœ«å°¾ ); break; printf(%c, ch); fclose(fp); return 0; ferror å‡½æ•° åŸå‹ï¼šint ferror(FILE *stream) è¿”å›å€¼ï¼šè¯»å†™é”™è¯¯è¿”å›é 0ï¼Œå¦åˆ™è¿”å› 0 åŠŸèƒ½ï¼šåˆ¤æ–­æ˜¯å¦å‘ç”Ÿè¯»å†™é”™è¯¯ã€‚æ£€æµ‹æµä¸Šçš„é”™è¯¯ã€‚å³ï¼šæ£€æŸ¥æ–‡ä»¶åœ¨ä½¿ç”¨å„ç§è¾“å…¥è¾“å‡ºå‡½æ•°è¿›è¡Œè¯»å†™æ—¶æ˜¯å¦å‡ºé”™ã€‚å½“è¾“å…¥è¾“å‡ºå‡½æ•°å¯¹æ–‡ ä»¶è¿›è¡Œè¯»å†™æ—¶å‡ºé”™ï¼Œæ–‡ä»¶å°±ä¼šäº§ç”Ÿé”™è¯¯æ ‡å¿—ã€‚åº”ç”¨è¿™ä¸ªå‡½æ•°ï¼Œå°±å¯ä»¥æ£€æŸ¥å‡º fp æ‰€æŒ‡å‘çš„æ–‡ä»¶æ“ä½œæ˜¯å¦ å‡ºé”™ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯å¦æœ‰é”™è¯¯æ ‡å¿— clearerr å‡½æ•° åŸå‹ï¼švoid clearerr(FILE *stream) åŠŸèƒ½ï¼šæ¸…é™¤æ–‡ä»¶æµçš„é”™è¯¯çŠ¶æ€ã€‚å¤ä½é”™è¯¯æ ‡å¿—ï¼Œå³ï¼šä½¿ fp æ‰€æŒ‡å‘çš„æ–‡ä»¶ä¸­çš„é”™è¯¯æ ‡å¿—å’Œæ–‡ä»¶ç»“æŸæ ‡å¿—ç½® 0ã€‚å½“è¾“å…¥è¾“å‡ºå‡½æ•°å¯¹æ–‡ä»¶è¿›è¡Œ è¯»å†™å‡ºé”™æ—¶ï¼Œæ–‡ä»¶å°±ä¼šè‡ªåŠ¨äº§ç”Ÿé”™è¯¯æ ‡å¿—ï¼Œè¿™æ ·ä¼šå½±å“ç¨‹åºå¯¹æ–‡ä»¶çš„åç»­æ“ä½œã€‚clearerr å‡½æ•°å°±æ˜¯è¦å¤ ä½è¿™äº›é”™è¯¯æ ‡å¿—ï¼Œä¹Ÿå°±æ˜¯ä½¿ fp æ‰€æŒ‡å‘çš„æ–‡ä»¶çš„é”™è¯¯æ ‡å¿—å’Œæ–‡ä»¶ç»“æŸæ ‡å¿—ç½® 0ï¼Œä»è€Œä½¿æ–‡ä»¶æ¢å¤æ­£å¸¸ã€‚ int main()\tFILE *fp;\tchar ch;\tfp = fopen(test.txt, w);\tch = fgetc(fp);\tif(ferror(fp)) //æŠ¥é”™å°è¯•ä»ä¸€ä¸ªåªå†™æ–‡ä»¶ä¸­è¯»å–æ•°æ® perror(error); clearerr(fp); fclose(fp);\treturn 0; ç¼“å­˜æœºåˆ¶å®éªŒéªŒè¯setbufï¼ˆè®¾ç½®æ–‡ä»¶æµçš„ç¼“å†²åŒºï¼‰ åŠŸèƒ½ï¼šè®¾ç½®æ–‡ä»¶æµçš„ç¼“å†²åŒºã€‚ è¡¨å¤´æ–‡ä»¶ï¼š#include stdio.h å‡½æ•°å®šä¹‰ï¼š void setbuf(FILE *stream, char *buf); å‡½æ•°è¯´æ˜ï¼š streamï¼šæ–‡ä»¶æµæŒ‡é’ˆã€‚ bufï¼šç¼“å†²åŒºé¦–åœ°å€ã€‚ å¦‚æœ buf ä¸º NULLï¼Œåˆ™è®¾ç½®ä¸ºæ— ç¼“å†²ã€‚ ç¤ºä¾‹ï¼š #include stdio.hint main() FILE *fp; char buf[BUFSIZ]; // æ‰“å¼€æ–‡ä»¶ fp = fopen(test.txt, r); if (fp == NULL) perror(fopen); return 1; // è®¾ç½®ç¼“å†²åŒº setbuf(fp, buf); // ä½¿ç”¨ç¼“å†²åŒºè¯»å–å†…å®¹ while (fgets(buf, sizeof(buf), fp)) printf(%s, buf); // å…³é—­æ–‡ä»¶ fclose(fp); return 0; setbufferï¼ˆè®¾ç½®æ–‡ä»¶æµçš„ç¼“å†²åŒºå¤§å°ï¼‰ åŠŸèƒ½ï¼šè®¾ç½®æ–‡ä»¶æµçš„ç¼“å†²åŒºå¤§å°ã€‚ è¡¨å¤´æ–‡ä»¶ï¼š#include stdio.h å‡½æ•°å®šä¹‰ï¼š void setbuffer(FILE *stream, char *buf, size_t size); å‡½æ•°è¯´æ˜ï¼š streamï¼šæ–‡ä»¶æµæŒ‡é’ˆã€‚ bufï¼šç¼“å†²åŒºé¦–åœ°å€ã€‚ sizeï¼šç¼“å†²åŒºå¤§å°ã€‚ fputc éè¡Œç¼“å­˜éªŒè¯ ç°è±¡ï¼šæœªè°ƒç”¨ fflush æˆ– fclose æ—¶ï¼Œfputc å†™å…¥çš„æ•°æ®ä¸ä¼šç«‹å³ä¿å­˜åˆ°æ–‡ä»¶ ç»“è®ºï¼šfputc ä¸å±äºè¡Œç¼“å­˜å‡½æ•°ï¼Œéœ€æ‰‹åŠ¨åˆ·æ–°ç¼“å­˜ æ–‡ä»¶æŒ‡é’ˆæ“ä½œç¤ºä¾‹ åœºæ™¯ï¼šå†™å…¥å­—ç¬¦åä½¿ç”¨ rewind é‡ç½®æŒ‡é’ˆå†è¯»å– ä»£ç ï¼š fputc(a, fp);rewind(fp);int ret = fgetc(fp);printf(ret=%c , ret); è¾“å‡ºï¼šret=a å®‰å…¨æ³¨æ„äº‹é¡¹ gets å‡½æ•°é£é™©ï¼šç”±äºæ— æ³•é™åˆ¶è¾“å…¥é•¿åº¦ï¼Œå¯èƒ½å¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œå»ºè®®ä½¿ç”¨ fgets æ›¿ä»£ ç¼“å­˜åˆ·æ–°æ—¶æœºï¼šè‹¥æœªå†™æ»¡ç¼“å­˜ä¸”æ— æ¢è¡Œç¬¦ï¼Œæ•°æ®ä¸ä¼šè‡ªåŠ¨å†™å…¥æ–‡ä»¶ï¼Œéœ€æ‰‹åŠ¨è°ƒç”¨ fflush æˆ–ç¡®ä¿ç¨‹åºæ­£å¸¸å…³é—­ä»¥è§¦å‘ fclose åˆ·æ–° fopenï¼ˆæ‰“å¼€æ–‡ä»¶ï¼‰ç›¸å…³å‡½æ•°: open, fcloseè¡¨å¤´æ–‡ä»¶: #include stdio.h å‡½æ•°å®šä¹‰: FILE * fopen(const char * path, const char * mode); å‡½æ•°è¯´æ˜:fopen() ç”¨äºæ‰“å¼€æ–‡ä»¶å¹¶è¿”å›ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆã€‚ å‚æ•°è¯´æ˜: path: åŒ…å«æ–‡ä»¶è·¯å¾„åŠæ–‡ä»¶åçš„å­—ç¬¦ä¸² mode: æŒ‡å®šæ–‡ä»¶çš„æ‰“å¼€æ¨¡å¼ï¼ˆè§ä¸‹è¡¨ï¼‰ æ–‡ä»¶æ‰“å¼€æ¨¡å¼: æ¨¡å¼å­—ç¬¦ä¸² æè¿° r ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œæ–‡ä»¶å¿…é¡»å­˜åœ¨ã€‚ r+ ä»¥å¯è¯»å†™æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œæ–‡ä»¶å¿…é¡»å­˜åœ¨ã€‚ w ä»¥åªå†™æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™é•¿åº¦æ¸…ä¸ºé›¶ï¼›è‹¥ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°æ–‡ä»¶ã€‚ w+ ä»¥å¯è¯»å†™æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œé•¿åº¦æ¸…ä¸ºé›¶ï¼›è‹¥ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°æ–‡ä»¶ã€‚ a ä»¥åªå†™æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œä¸”åœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ å†…å®¹ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°æ–‡ä»¶ã€‚ a+ ä»¥å¯è¯»å†™æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œä¸”åœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ å†…å®¹ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°æ–‡ä»¶ã€‚ æ¨¡å¼å­—ç¬¦ä¸²çš„æ‰©å±•:ä»¥ä¸Šæ¨¡å¼å­—ç¬¦ä¸²å¯ä»¥æ·»åŠ  b å­—ç¬¦ï¼ˆå¦‚ rb, w+b ç­‰ï¼‰ï¼Œä»¥æŒ‡å®šæ‰“å¼€äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä¸è¿‡åœ¨ POSIX ç³»ç»Ÿï¼ˆåŒ…æ‹¬ Linuxï¼‰ä¸­ï¼Œè¿™ä¸ªå­—ç¬¦ä¼šè¢«å¿½ç•¥ã€‚ æ–‡ä»¶æƒé™:ä½¿ç”¨ fopen() æ‰“å¼€çš„æ–°æ–‡ä»¶é»˜è®¤æƒé™ä¸º 0666ï¼ˆå³ S_IRUSR|S_IWUSR|S_IRGRP|S_IWGRP|S_IROTH|S_IWOTHï¼‰ï¼Œå®é™…æƒé™ä¼šå‚è€ƒå½“å‰ umask å€¼ã€‚ è¿”å›å€¼: æˆåŠŸï¼šè¿”å›æ–‡ä»¶æŒ‡é’ˆ FILE * å¤±è´¥ï¼šè¿”å› NULLï¼Œé”™è¯¯ä»£ç å­˜å…¥ errno é™„åŠ è¯´æ˜: æ‰“å¼€æ–‡ä»¶ååº”ç«‹å³è¿›è¡Œé”™è¯¯æ£€æŸ¥ï¼Œå› å¼€æ–‡ä»¶å¤±è´¥ä¼šå¯¼è‡´åç»­è¯»å†™æ“ä½œæ— æ³•è¿›è¡Œã€‚ æ–‡ä»¶æŒ‡é’ˆç”¨äºåç»­çš„è¯»å†™æ“ä½œï¼Œéœ€åœ¨å…³é—­æ–‡ä»¶å‰ç¡®ä¿æ‰€æœ‰ç¼“å†²åŒºæ•°æ®å·²åˆ·æ–°åˆ°ç£ç›˜ã€‚ ç¤ºä¾‹: #include stdio.hint main() FILE * fp; fp = fopen(example.txt, a+); if (fp == NULL) return -1; fclose(fp); return 0; fcloseï¼ˆå…³é—­æ–‡ä»¶ï¼‰ç›¸å…³å‡½æ•°: close, fflush, fopen, setbufè¡¨å¤´æ–‡ä»¶: #include stdio.h å‡½æ•°å®šä¹‰: int fclose(FILE * stream); å‡½æ•°è¯´æ˜:fclose() ç”¨äºå…³é—­ä¹‹å‰ç”± fopen() æ‰“å¼€çš„æ–‡ä»¶ã€‚å…³é—­æ—¶ä¼šè‡ªåŠ¨å°†ç¼“å†²åŒºå†…å®¹å†™å…¥æ–‡ä»¶ï¼Œå¹¶é‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚ å‚æ•°è¯´æ˜: stream: æ–‡ä»¶æŒ‡é’ˆ è¿”å›å€¼: æˆåŠŸï¼šè¿”å› 0 å¤±è´¥ï¼šè¿”å› EOFï¼Œé”™è¯¯ä»£ç å­˜å…¥ errno é”™è¯¯ä»£ç : EBADF: å‚æ•° stream éå·²æ‰“å¼€çš„æ–‡ä»¶ ç¤ºä¾‹: #include stdio.hint main() FILE * stream; stream = fopen(example.txt, w); if (stream != NULL) fclose(stream); return 0; fcntl (æ–‡ä»¶æè¿°ç¬¦æ“ä½œ)fcntl å‡½æ•°æä¾›äº†ç”¨äºæ“ä½œæ–‡ä»¶æè¿°ç¬¦çš„å„ç§åŠŸèƒ½ã€‚å®ƒå…è®¸ä½ æ§åˆ¶æ–‡ä»¶é”å®šã€æ ‡å¿—å’Œå…¶ä»–ç‰¹å®šäºæè¿°ç¬¦çš„è®¾ç½®ã€‚æ­¤å‡½æ•°å¤šåŠŸèƒ½ï¼Œé€šè¿‡ä¸åŒçš„å‘½ä»¤æ”¯æŒå¤šç§æ“ä½œã€‚ è¦ä½¿ç”¨ fcntlï¼ŒåŒ…å«ä»¥ä¸‹å¤´æ–‡ä»¶ï¼š #include fcntl.h æ ¹æ®æ“ä½œçš„ä¸åŒï¼Œå‡½æ•°å¯ä»¥ä»¥ä¸‰ç§æ–¹å¼è°ƒç”¨ï¼š int fcntl(int fd, int cmd); int fcntl(int fd, int cmd, long arg); int fcntl(int fd, int cmd, struct flock *lock); F_DUPFD ä» arg å¼€å§‹ï¼Œæœç´¢æœ€å°çš„æœªä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¹¶å¤åˆ¶æè¿°ç¬¦ fdã€‚ æˆåŠŸæ—¶è¿”å›æ–°çš„æè¿°ç¬¦ã€‚ ç¤ºä¾‹ï¼š int new_fd = fcntl(fd, F_DUPFD, 0); å°† F_DUPFD ä¸ dup2() ç»“åˆä½¿ç”¨å¯¹äºç†è§£å…¶è¡Œä¸ºè‡³å…³é‡è¦ã€‚ F_GETFD ä»æ–‡ä»¶æè¿°ç¬¦ä¸­æ£€ç´¢ close-on-exec æ ‡å¿—ã€‚ ä½¿ç”¨æ–¹å¼ï¼š int flags = fcntl(fd, F_GETFD); å¦‚æœ FD_CLOEXEC ä½ä¸º 0ï¼Œæ–‡ä»¶åœ¨ exec() å‡½æ•°è°ƒç”¨åä¿æŒæ‰“å¼€çŠ¶æ€ã€‚ F_SETFD æ ¹æ® arg æŒ‡å®šçš„å€¼è®¾ç½® close-on-exec æ ‡å¿—ã€‚ ç¤ºä¾‹ï¼š fcntl(fd, F_SETFD, FD_CLOEXEC); åœ¨ä½¿ç”¨ exec() ç®¡ç†æ–‡ä»¶æè¿°ç¬¦å¯è§æ€§æ—¶è‡³å…³é‡è¦ã€‚ F_GETFL ä» open() å‚æ•°ä¸­æ£€ç´¢æ–‡ä»¶çŠ¶æ€æ ‡å¿—ã€‚ ä½¿ç”¨æ–¹å¼ï¼š int flags = fcntl(fd, F_GETFL); æä¾›æœ‰å…³å½“å‰æ–‡ä»¶è®¿é—®æ¨¡å¼çš„ä¿¡æ¯ã€‚ F_SETFL ä¿®æ”¹æ–‡ä»¶çŠ¶æ€æ ‡å¿—ã€‚åªæœ‰ O_APPENDã€O_NONBLOCK å’Œ O_ASYNC å¯ä»¥æ›´æ”¹ã€‚ ä¿®æ”¹æ ‡å¿—ï¼š fcntl(fd, F_SETFL, O_APPEND); F_GETLK, F_SETLK, F_SETLKW è¿™äº›å‘½ä»¤ä½¿ç”¨ flock ç»“æ„ç®¡ç†æ–‡ä»¶é”å®šã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„ç»“æ„è¯´æ˜ã€‚ struct flock å®šä¹‰äº†é”å®šçš„åŒºåŸŸå’Œç±»å‹ï¼š struct flock short l_type; // é”ç±»å‹: F_RDLCK, F_WRLCK, F_UNLCK short l_whence; // é”å®šèµ·å§‹ä½ç½®: SEEK_SET, SEEK_CUR, SEEK_END off_t l_start; // é”å®šåŒºåŸŸçš„èµ·å§‹ä½ç½® off_t l_len; // é”å®šåŒºåŸŸçš„é•¿åº¦ pid_t l_pid; // é”æ‰€æœ‰è€…çš„è¿›ç¨‹ ID; æˆåŠŸæ—¶è¿”å› 0ï¼›å¤±è´¥æ—¶è¿”å› -1ï¼Œå¹¶è®¾ç½® errnoã€‚ flock (æ–‡ä»¶é”å®šè§£é”)flock å‡½æ•°ç”¨äºåœ¨æ•´ä¸ªæ–‡ä»¶ä¸Šåº”ç”¨æˆ–ç§»é™¤é”å®šã€‚ä¸ fcntl ä¸åŒï¼Œå®ƒä¸æ”¯æŒåŸºäºåŒºåŸŸçš„é”å®šã€‚ åŒ…å« flock æ‰€éœ€çš„å¤´æ–‡ä»¶ï¼š #include sys/file.h int flock(int fd, int operation); fd: æ–‡ä»¶æè¿°ç¬¦ã€‚ operation: é”æ“ä½œç±»å‹ã€‚ LOCK_SH: å…±äº«é”ï¼Œå…è®¸å¤šä¸ªè¿›ç¨‹è¿›è¡Œè¯»å–ã€‚ LOCK_EX: æ’ä»–é”ï¼Œåªå…è®¸ä¸€ä¸ªè¿›ç¨‹è¿›è¡Œå†™å…¥ã€‚ LOCK_UN: é‡Šæ”¾é”å®šã€‚ LOCK_NB: éé˜»å¡ï¼›å¦‚æœé”å®šå¤±è´¥ï¼Œç«‹å³è¿”å›ã€‚ 0 è¡¨ç¤ºæˆåŠŸï¼›-1 è¡¨ç¤ºå¤±è´¥ï¼Œå¹¶è®¾ç½® errnoã€‚ int fd = open(file.txt, O_RDWR);// è·å–æ’ä»–é”flock(fd, LOCK_EX);// æ‰§è¡Œæ–‡ä»¶æ“ä½œ// é‡Šæ”¾é”flock(fd, LOCK_UN);close(fd); æ³¨æ„:æ…ç”¨æ­¤å‡½æ•°ï¼Œå› ä¸å½“é”å®šå¯èƒ½å¯¼è‡´ç«æ€æ¡ä»¶ã€‚ fsetposï¼šå®šä½æµä¸Šçš„æ–‡ä»¶æŒ‡é’ˆå‡½æ•° å¤´æ–‡ä»¶ #include stdio.h å‡½æ•°åŸå‹ int fsetpos(FILE *fp, const fpos_t *pos); å‡½æ•°åŠŸèƒ½fsetpos å‡½æ•°ç”¨äºå°†æ–‡ä»¶æŒ‡é’ˆé‡æ–°å®šä½åˆ°ç”± pos æŒ‡å®šçš„ä½ç½®ã€‚å®ƒä¸ fgetpos å‡½æ•°çš„åŠŸèƒ½ç›¸åï¼šfgetpos ç”¨äºè·å–å½“å‰æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®ï¼Œè€Œ fsetpos åˆ™ç”¨äºè®¾ç½®æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œpos çš„å€¼æ˜¯ä¸€ä¸ªå†…éƒ¨æ ¼å¼ï¼Œä»…ç”± fgetpos å’Œ fsetpos ä½¿ç”¨ã€‚ å‚æ•°: FILE *fp: æ–‡ä»¶æŒ‡é’ˆï¼Œè¡¨ç¤ºè¦æ“ä½œçš„æ–‡ä»¶æµã€‚ const fpos_t *pos: ä¸€ä¸ªæŒ‡å‘ fpos_t ç±»å‹å˜é‡çš„æŒ‡é’ˆï¼Œå­˜å‚¨äº†æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®ã€‚ è¿”å›å€¼: æˆåŠŸè¿”å› 0ã€‚ å¤±è´¥è¿”å›éé›¶ï¼Œå¹¶è®¾ç½® errnoã€‚ ç¤ºä¾‹ç¨‹åºä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ fsetpos å‡½æ•°é‡æ–°å®šä½æ–‡ä»¶æŒ‡é’ˆå¹¶è¯»å–æ–‡ä»¶å†…å®¹ï¼š #include stdio.h#include stdlib.hvoid main(void) FILE *fp; fpos_t pos; char buffer[50]; /* ä»¥äºŒè¿›åˆ¶è¯»æ¨¡å¼æ‰“å¼€æ–‡ä»¶ */ if ((fp = fopen(test.txt, rb)) == NULL) printf(Trouble opening file ); exit(1); /* è®¾ç½®poså€¼ä¸º10 */ pos = 10; /* ä½¿ç”¨fsetposå‡½æ•°é‡æ–°å®šä½æ–‡ä»¶æŒ‡é’ˆ */ if (fsetpos(fp, pos) != 0) perror(fsetpos error); exit(1); /* ä»æ–°ä½ç½®è¯»å–16ä¸ªå­—ç¬¦åˆ°ç¼“å†²åŒº */ fread(buffer, sizeof(char), 16, fp); printf(16 bytes at byte %ld: %.16s , pos, buffer); fclose(fp); ç¤ºä¾‹è¯´æ˜ æ‰“å¼€æ–‡ä»¶: ä»¥äºŒè¿›åˆ¶è¯»æ¨¡å¼æ‰“å¼€æ–‡ä»¶ test.txtã€‚å‡è®¾æ–‡ä»¶å†…å®¹ä¸ºï¼šâ€This is a test for testing the function of fsetpos.â€ã€‚ è®¾ç½®ä½ç½®: å°† pos è®¾ç½®ä¸º 10ï¼Œè¡¨ç¤ºä»æ–‡ä»¶çš„ç¬¬ 11 ä¸ªå­—èŠ‚å¼€å§‹è¯»å–ï¼ˆå› ä¸ºç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ é‡æ–°å®šä½: ä½¿ç”¨ fsetpos å‡½æ•°å°†æ–‡ä»¶æŒ‡é’ˆé‡æ–°å®šä½åˆ°ç¬¬ 11 ä¸ªå­—èŠ‚ã€‚ è¯»å–å†…å®¹: ä»æ–°ä½ç½®è¯»å– 16 ä¸ªå­—ç¬¦ï¼Œå¾—åˆ°å­—ç¬¦ä¸² test for testingã€‚ è¾“å‡ºç»“æœ: æ‰“å°è¯»å–åˆ°çš„å†…å®¹ã€‚ fgetposï¼šè·å–å½“å‰æ–‡ä»¶æŒ‡é’ˆä½ç½®çš„å‡½æ•° å¤´æ–‡ä»¶ #include stdio.h å‡½æ•°åŸå‹ int fgetpos( FILE *stream, fpos_t *pos ); å‡½æ•°åŠŸèƒ½fgetpos å‡½æ•°ç”¨äºè·å–æ–‡ä»¶æµ stream çš„å½“å‰æ–‡ä»¶æŒ‡é’ˆä½ç½®ï¼Œå¹¶å°†è¯¥ä½ç½®å­˜å‚¨åœ¨ pos æŒ‡å‘çš„ fpos_t ç±»å‹å˜é‡ä¸­ã€‚fgetpos çš„åŠŸèƒ½ä¸ fsetpos ç›¸åï¼šfsetpos ç”¨äºè®¾ç½®æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®ï¼Œè€Œ fgetpos åˆ™ç”¨äºè·å–å½“å‰ä½ç½®ã€‚ å‚æ•°: FILE *stream: æ–‡ä»¶æŒ‡é’ˆï¼Œè¡¨ç¤ºè¦æ“ä½œçš„æ–‡ä»¶æµã€‚ fpos_t *pos: ä¸€ä¸ªæŒ‡å‘ fpos_t ç±»å‹å˜é‡çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶æŒ‡é’ˆçš„å½“å‰ä½ç½®ã€‚ è¿”å›å€¼: æˆåŠŸè¿”å› 0ã€‚ å¤±è´¥è¿”å›éé›¶ï¼Œå¹¶è®¾ç½® errnoã€‚ ç¤ºä¾‹ç¨‹åºä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ fgetpos å‡½æ•°è·å–æ–‡ä»¶æŒ‡é’ˆçš„å½“å‰ä½ç½®ï¼š #include stdio.h#include stdlib.hvoid main(void) FILE *fp; fpos_t pos; /* æ‰“å¼€æ–‡ä»¶å¹¶å†™å…¥å†…å®¹ */ if ((fp = fopen(test.txt, wb+)) == NULL) printf(Trouble opening file ); exit(1); const char *content = This is a test; fwrite(content, sizeof(char), strlen(content), fp); /* è·å–å½“å‰æ–‡ä»¶æŒ‡é’ˆä½ç½® */ if (fgetpos(fp, pos) != 0) perror(fgetpos error); exit(1); printf(The file pointer is at byte %ld , pos); /* é‡ç½®æ–‡ä»¶æŒ‡é’ˆä½ç½® */ if (fseek(fp, 3, SEEK_SET) != 0) perror(fseek error); exit(1); /* å†æ¬¡è·å–æ–‡ä»¶æŒ‡é’ˆä½ç½® */ if (fgetpos(fp, pos) != 0) perror(fgetpos error); exit(1); printf(The file pointer is now at byte %ld , pos); fclose(fp); sscanfï¼šä»ç¼“å†²åŒºä¸­è¯»å–æ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•° å¤´æ–‡ä»¶ #include stdio.h å‡½æ•°åŸå‹ int sscanf(const char *string, const char *format [, argument, ...]); å‡½æ•°åŠŸèƒ½sscanf å‡½æ•°ä» string æŒ‡å®šçš„ç¼“å†²åŒºä¸­è¯»å–æ ¼å¼åŒ–æ•°æ®ï¼Œå¹¶å°†å…¶å­˜å…¥ argument æŒ‡å‘çš„å˜é‡ä¸­ã€‚format æŒ‡å®šäº†æ•°æ®çš„æ ¼å¼ï¼Œè€Œ argument å¿…é¡»æ˜¯ç›¸åº”ç±»å‹çš„æŒ‡é’ˆã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œsscanf ä¸ scanf å’Œ fscanf çš„ä¸åŒä¹‹å¤„åœ¨äºï¼š sscanf ä»å†…å­˜ç¼“å†²åŒºè¯»å–æ•°æ®ã€‚ scanf ä»æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰è¯»å–æ•°æ®ã€‚ fscanf ä»æŒ‡å®šæ–‡ä»¶è¯»å–æ•°æ®ã€‚ è¿”å›å€¼sscanf è¿”å›æˆåŠŸåŒ¹é…å¹¶å­˜å‚¨çš„é¡¹ç›®æ•°ã€‚è¿”å› 0 è¡¨ç¤ºæ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•æ•°æ®ï¼Œè¿”å› EOF è¡¨ç¤ºè¯»å–å¤±è´¥ã€‚ æ³¨æ„ï¼šå¦‚æœè¾“å…¥æ•°æ®ä¸ format ä¸åŒ¹é…ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®å­˜å‚¨åœ¨é”™è¯¯çš„ä½ç½®ï¼Œç”šè‡³å¯¼è‡´ç¨‹åºå´©æºƒã€‚ tmpfileï¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶å‡½æ•° å¤´æ–‡ä»¶ #include stdio.h å‡½æ•°åŸå‹ FILE *tmpfile(void); å‡½æ•°åŠŸèƒ½tmpfile å‡½æ•°åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œå¹¶ä»¥äºŒè¿›åˆ¶è¯»å†™æ¨¡å¼ï¼ˆâ€w+bâ€ï¼‰æ‰“å¼€è¯¥æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åœ¨ç¨‹åºç»“æŸæ—¶è‡ªåŠ¨åˆ é™¤ã€‚ æ³¨æ„ï¼šä¸´æ—¶æ–‡ä»¶æ˜¯åœ¨é»˜è®¤çš„ä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸­åˆ›å»ºçš„ï¼Œè·¯å¾„ç”±ç³»ç»Ÿå†³å®šã€‚ è¿”å›å€¼æˆåŠŸè¿”å› FILE æŒ‡é’ˆï¼Œå¤±è´¥è¿”å› NULLã€‚ tmpnamï¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶åå‡½æ•° å¤´æ–‡ä»¶ #include stdio.h å‡½æ•°åŸå‹ char *tmpnam(char *string); å‡½æ•°åŠŸèƒ½tmpnam å‡½æ•°ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ä¸´æ—¶æ–‡ä»¶åï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ string æŒ‡å‘çš„ç¼“å†²åŒºä¸­ã€‚ æ³¨æ„ï¼štmpnam ä¸ä¼šåˆ›å»ºæ–‡ä»¶ï¼Œå®ƒåªç”Ÿæˆæ–‡ä»¶åã€‚å¦‚æœä»–äººåŒæ—¶è°ƒç”¨ tmpnamï¼Œå¯èƒ½ä¼šç”Ÿæˆç›¸åŒçš„æ–‡ä»¶åã€‚ è¿”å›å€¼æˆåŠŸè¿”å›æŒ‡å‘ string çš„æŒ‡é’ˆï¼Œå¤±è´¥è¿”å› NULLã€‚ ungetcï¼šå°†å­—ç¬¦é€€å›åˆ°è¾“å…¥æµå‡½æ•° å¤´æ–‡ä»¶ #include stdio.h å‡½æ•°åŸå‹ int ungetc(int c, FILE *fp); å‡½æ•°åŠŸèƒ½å°†å­—ç¬¦ c é€€å›åˆ°è¾“å…¥æµ fp ä¸­ï¼Œå¹¶æ¸…é™¤æ–‡ä»¶çš„ç»“æŸæ ‡å¿—ã€‚fp å¯ä»¥æ˜¯æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰æˆ–ç”¨æˆ·æ‰“å¼€çš„æ–‡ä»¶ã€‚ æ³¨æ„ï¼šungetc åªèƒ½å°†ä¸€ä¸ªå­—ç¬¦é€€å›è¾“å…¥æµã€‚å¦‚æœè¿ç»­è°ƒç”¨å¤šæ¬¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºã€‚ è¿”å›å€¼æˆåŠŸè¿”å›å­—ç¬¦ cï¼Œå¤±è´¥è¿”å› EOFã€‚ #include stdio.h#include ctype.hint main(void) int ch; int i = 0; printf(Input a number followed by a character: ); // è¯»å–å­—ç¬¦ç›´åˆ°è¾“å…¥éæ•°å­—æˆ– EOF while ((ch = getchar()) != EOF isdigit(ch)) i = 10 * i + (ch - 0); // å¦‚æœä¸æ˜¯ EOFï¼Œå°†å­—ç¬¦é€€å›åˆ°è¾“å…¥æµ if (ch != EOF) ungetc(ch, stdin); printf(Number = %d, next character = %c , i, getchar()); return 0; è¾“å…¥ç¤ºä¾‹ï¼š 123a è¿è¡Œç»“æœï¼š Number = 123, next character = a freopenï¼ˆé‡æ–°æ‰“å¼€æ–‡ä»¶ï¼‰ åŠŸèƒ½ï¼šé‡æ–°æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶å°†å…¶å…³è”åˆ°å·²æœ‰çš„æ–‡ä»¶æµã€‚ ç›¸å…³å‡½æ•°ï¼šfopen, fclose è¡¨å¤´æ–‡ä»¶ï¼š#include stdio.h å‡½æ•°å®šä¹‰ï¼š FILE *freopen(const char *path, const char *mode, FILE *stream); å‡½æ•°è¯´æ˜ï¼š pathï¼šæ–°æ–‡ä»¶çš„è·¯å¾„åŠæ–‡ä»¶åã€‚ modeï¼šæ‰“å¼€æ¨¡å¼ï¼Œä¸ fopen ç›¸åŒï¼ˆå¦‚ï¼šâ€râ€ã€â€wâ€ã€â€aâ€ ç­‰ï¼‰ã€‚ streamï¼šå·²æ‰“å¼€çš„æ–‡ä»¶æµã€‚ freopen ä¼šå…³é—­åŸ stream æ‰€å…³è”çš„æ–‡ä»¶ï¼Œç„¶åæ‰“å¼€æ–°æ–‡ä»¶ã€‚ è¿”å›å€¼ï¼š æˆåŠŸï¼šè¿”å›æ–°æ–‡ä»¶å…³è”çš„æ–‡ä»¶æŒ‡é’ˆã€‚ å¤±è´¥ï¼šè¿”å› NULLï¼Œå¹¶è®¾ç½® errnoã€‚ æ³¨æ„äº‹é¡¹ï¼š å¿…é¡»åœ¨æ‰“å¼€æ–‡ä»¶æµåã€è¯»å–å†…å®¹ä¹‹å‰è°ƒç”¨ã€‚ å¦‚æœåŸ stream å·²ç»æ‰“å¼€ï¼Œfreopen ä¼šå…ˆå…³é—­å®ƒã€‚ ç¤ºä¾‹ï¼š #include stdio.hint main() FILE *fp;\t// æ‰“å¼€æ–‡ä»¶/etc/passwdä»¥è¯»æ–¹å¼\tfp = fopen(/etc/passwd, r);\tif (fp == NULL) perror(fopen); return 1; // é‡æ–°æ‰“å¼€/etc/groupæ–‡ä»¶ï¼Œå¹¶ä¸fpå…³è”\tfp = freopen(/etc/group, r, fp);\tif (fp == NULL) perror(freopen); return 1; // å…³é—­æ–‡ä»¶\tfclose(fp);\treturn 0; fdopenï¼ˆå°†æ–‡ä»¶æè¿°è¯è½¬ä¸ºæ–‡ä»¶æŒ‡é’ˆï¼‰ åŠŸèƒ½ï¼šå°†æ–‡ä»¶æè¿°è¯è½¬æ¢ä¸ºæ–‡ä»¶æŒ‡é’ˆã€‚ ç›¸å…³å‡½æ•°ï¼šfopen, open, fclose è¡¨å¤´æ–‡ä»¶ï¼š#include stdio.h å‡½æ•°å®šä¹‰ï¼š FILE *fdopen(int fildes, const char *mode); å‡½æ•°è¯´æ˜ï¼š fildesï¼šæ–‡ä»¶æè¿°è¯ã€‚ modeï¼šæ–‡ä»¶æ‰“å¼€æ¨¡å¼ï¼Œä¸ fopen ç›¸åŒã€‚ è¿”å›å€¼ï¼š æˆåŠŸï¼šè¿”å›æ–‡ä»¶æŒ‡é’ˆã€‚ å¤±è´¥ï¼šè¿”å› NULLã€‚ æ³¨æ„äº‹é¡¹ï¼š mode å¿…é¡»ä¸æ–‡ä»¶æè¿°è¯çš„æ‰“å¼€æ¨¡å¼ä¸€è‡´ã€‚ ç¤ºä¾‹ï¼š #include stdio.h#include fcntl.hint main() int fd; FILE *fp; // ä»¥åªå†™æ–¹å¼æ‰“å¼€æ–‡ä»¶ fd = open(test.txt, O_WRONLY); if (fd == -1) perror(open); return 1; // å°†æ–‡ä»¶æè¿°è¯fdè½¬æ¢ä¸ºæ–‡ä»¶æŒ‡é’ˆ fp = fdopen(fd, w); if (fp == NULL) perror(fdopen); return 1; // ä½¿ç”¨fprintfå†™å…¥å†…å®¹ fprintf(fp, Hello, world!); // å…³é—­æ–‡ä»¶ fclose(fp); return 0; filenoï¼ˆè¿”å›æ–‡ä»¶æµçš„æ–‡ä»¶æè¿°ç¬¦ï¼‰ åŠŸèƒ½ï¼šè¿”å›æ–‡ä»¶æµçš„æ–‡ä»¶æè¿°ç¬¦ã€‚ ç›¸å…³å‡½æ•°ï¼šopen, fopen è¡¨å¤´æ–‡ä»¶ï¼š#include stdio.h å‡½æ•°å®šä¹‰ï¼š int fileno(FILE *stream); å‡½æ•°è¯´æ˜ï¼š streamï¼šæ–‡ä»¶æµæŒ‡é’ˆã€‚ è¿”å›å€¼ï¼š æˆåŠŸï¼šè¿”å›æ–‡ä»¶æè¿°ç¬¦ã€‚ å¤±è´¥ï¼šè¿”å› -1ã€‚ ç¤ºä¾‹ï¼š #include stdio.hint main() FILE *fp; int fd; // æ‰“å¼€æ–‡ä»¶ fp = fopen(/etc/passwd, r); if (fp == NULL) perror(fopen); return 1; // è·å–æ–‡ä»¶æè¿°ç¬¦ fd = fileno(fp); printf(File descriptor: %d , fd); // å…³é—­æ–‡ä»¶ fclose(fp); return 0; getcï¼ˆä»æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦ï¼‰ åŠŸèƒ½ï¼šä»æ–‡ä»¶æµä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦ã€‚ ç›¸å…³å‡½æ•°ï¼šfgetc, read, fread è¡¨å¤´æ–‡ä»¶ï¼š#include stdio.h å‡½æ•°å®šä¹‰ï¼š int getc(FILE *stream); å‡½æ•°è¯´æ˜ï¼š streamï¼šæ–‡ä»¶æµæŒ‡é’ˆã€‚ getc æ˜¯å®å®šä¹‰ï¼Œä¸æ˜¯çœŸæ­£çš„å‡½æ•°è°ƒç”¨ã€‚ è¿”å›å€¼ï¼š è¯»å–åˆ°å­—ç¬¦ï¼šè¿”å›å­—ç¬¦ï¼ˆä½œä¸º intï¼‰ã€‚ æ–‡ä»¶æœ«å°¾æˆ–é”™è¯¯ï¼šè¿”å› EOFã€‚ ç¤ºä¾‹ï¼š #include stdio.hint main() FILE *fp; int c; // æ‰“å¼€æ–‡ä»¶ fp = fopen(example.txt, r); if (fp == NULL) perror(fopen); return 1; // è¯»å–å­—ç¬¦ while ((c = getc(fp)) != EOF) printf(%c, c); // å…³é—­æ–‡ä»¶ fclose(fp); return 0; putcï¼ˆå°†å­—ç¬¦å†™å…¥æ–‡ä»¶ï¼‰ åŠŸèƒ½ï¼šå°†å­—ç¬¦å†™å…¥æ–‡ä»¶æµã€‚ ç›¸å…³å‡½æ•°ï¼šfputc, fwrite, fscanf è¡¨å¤´æ–‡ä»¶ï¼š#include stdio.h å‡½æ•°å®šä¹‰ï¼š int putc(int c, FILE *stream); å‡½æ•°è¯´æ˜ï¼š cï¼šè¦å†™å…¥çš„å­—ç¬¦ã€‚ streamï¼šæ–‡ä»¶æµæŒ‡é’ˆã€‚ putc æ˜¯å®å®šä¹‰ï¼Œä¸æ˜¯çœŸæ­£çš„å‡½æ•°è°ƒç”¨ã€‚ è¿”å›å€¼ï¼š æˆåŠŸï¼šè¿”å›å†™å…¥çš„å­—ç¬¦ã€‚ å¤±è´¥ï¼šè¿”å› EOFã€‚ ç¤ºä¾‹ï¼š #include stdio.hint main() FILE *fp; // æ‰“å¼€æ–‡ä»¶ fp = fopen(output.txt, w); if (fp == NULL) perror(fopen); return 1; // å†™å…¥å­—ç¬¦ putc(H, fp); putc(e, fp); putc(l, fp); putc(l, fp); putc(o, fp); // å…³é—­æ–‡ä»¶ fclose(fp); return 0; getcharï¼ˆä»æ ‡å‡†è¾“å…¥è¯»å–å­—ç¬¦ï¼‰ åŠŸèƒ½ï¼šä»æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰è¯»å–ä¸€ä¸ªå­—ç¬¦ã€‚ ç›¸å…³å‡½æ•°ï¼šgetc, fread, fscanf è¡¨å¤´æ–‡ä»¶ï¼š#include stdio.h å‡½æ•°å®šä¹‰ï¼š int getchar(void); å‡½æ•°è¯´æ˜ï¼š getchar æ˜¯å®å®šä¹‰ï¼Œç­‰åŒäº getc(stdin)ã€‚ è¿”å›å€¼ï¼š è¯»å–åˆ°å­—ç¬¦ï¼šè¿”å›å­—ç¬¦ï¼ˆä½œä¸º intï¼‰ã€‚ é”™è¯¯ï¼šè¿”å› EOFã€‚ ç¤ºä¾‹ï¼š #include stdio.hint main() char c; printf(è¯·è¾“å…¥å­—ç¬¦ï¼š); c = getchar(); printf(æ‚¨è¾“å…¥çš„å­—ç¬¦æ˜¯ï¼š%c , c); return 0; putcharï¼ˆå‘æ ‡å‡†è¾“å‡ºå†™å…¥å­—ç¬¦ï¼‰ åŠŸèƒ½ï¼šå°†å­—ç¬¦å†™å…¥æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰ã€‚ ç›¸å…³å‡½æ•°ï¼šputc, fwrite, fscanf è¡¨å¤´æ–‡ä»¶ï¼š#include stdio.h å‡½æ•°å®šä¹‰ï¼š int putchar(int c); å‡½æ•°è¯´æ˜ï¼š cï¼šè¦å†™å…¥çš„å­—ç¬¦ã€‚ putchar æ˜¯å®å®šä¹‰ï¼Œç­‰åŒäº putc(c, stdout)ã€‚ è¿”å›å€¼ï¼š æˆåŠŸï¼šè¿”å›å†™å…¥çš„å­—ç¬¦ã€‚ å¤±è´¥ï¼šè¿”å› EOFã€‚ ç¤ºä¾‹ï¼š #include stdio.hint main() putchar(H); putchar(e); putchar(l); putchar(l); putchar(o); putchar( ); return 0;","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","IO"]},{"title":"æ–‡ä»¶IOå’Œæ ‡å‡†IO","path":"/2025/06/13/1-å¹³å°ç³»ç»Ÿ-Linux-IO-æ–‡ä»¶IOå’Œæ ‡å‡†IO/","content":"æ–‡ä»¶ IOï¼šæ–‡ä»¶ IO ç§°ä¹‹ä¸ºä¸å¸¦ç¼“å­˜çš„ IOï¼ˆunbufferedIO)ã€‚ä¸å¸¦ç¼“å­˜æŒ‡çš„æ˜¯æ¯ä¸ª readï¼Œwrite éƒ½è°ƒç”¨å†…æ ¸ä¸­çš„ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯ä¸€èˆ¬æ‰€è¯´çš„ä½çº§ IOâ€”â€”æ“ä½œç³»ç»Ÿæä¾›çš„åŸºæœ¬ IO æœåŠ¡ï¼Œä¸ os ç»‘å®šï¼Œç‰¹å®šäº linix æˆ– unix å¹³å°ã€‚ æ ‡å‡† IOï¼šæ ‡å‡† IO æ˜¯ ANSIC å»ºç«‹çš„ä¸€ä¸ªæ ‡å‡† IO æ¨¡å‹ï¼Œæ˜¯ä¸€ä¸ªæ ‡å‡†å‡½æ•°åŒ…å’Œ stdio.h å¤´æ–‡ä»¶ä¸­çš„å®šä¹‰ï¼Œå…·æœ‰ä¸€å®šçš„å¯ç§»æ¤æ€§ã€‚æ ‡å‡† IO åº“å¤„ç†å¾ˆå¤šç»†èŠ‚ã€‚ä¾‹å¦‚ç¼“å­˜åˆ†é…ï¼Œä»¥ä¼˜åŒ–é•¿åº¦æ‰§è¡Œ IO ç­‰ã€‚æ ‡å‡†çš„ IO æä¾›äº†ä¸‰ç§ç±»å‹çš„ç¼“å­˜ã€‚ å…¨ç¼“å­˜ï¼šå½“å¡«æ»¡æ ‡å‡† IO ç¼“å­˜åæ‰è¿›è¡Œå®é™…çš„ IO æ“ä½œã€‚ è¡Œç¼“å­˜ï¼šå½“è¾“å…¥æˆ–è¾“å‡ºä¸­é‡åˆ°æ–°è¡Œç¬¦æ—¶ï¼Œæ ‡å‡† IO åº“æ‰§è¡Œ IO æ“ä½œã€‚ ä¸å¸¦ç¼“å­˜ï¼šstderr å°±æ˜¯äº†ã€‚ å‡½æ•° æ ‡å‡† IO æ–‡ä»¶ IO æ‰“å¼€ fopen,freopen,fdopen open å…³é—­ fclose close è¯»å– getc,fgetc,getchar,fgets,gets fread read å†™å…¥ putc,fputc,putchar,fputs,puts, fwrite write éšæœºå­˜å–ï¼šfseek()ã€ftell()å’Œ lseek() åŒºåˆ«æ–‡ä»¶ IO åˆç§°ä¸ºä½çº§ç£ç›˜ IOï¼Œéµå¾ª POSIX ç›¸å…³æ ‡å‡†ã€‚ä»»ä½•å…¼å®¹ POSIX æ ‡å‡†çš„æ“ä½œç³»ç»Ÿä¸Šéƒ½æ”¯æŒæ–‡ä»¶ IOã€‚æ ‡å‡† IO è¢«ç§°ä¸ºé«˜çº§ç£ç›˜ IOï¼Œéµå¾ª ANSIC ç›¸å…³æ ‡å‡†ã€‚åªè¦å¼€å‘ç¯å¢ƒä¸­æœ‰æ ‡å‡† IO åº“ï¼Œæ ‡å‡† IO å°±å¯ä»¥ä½¿ç”¨ã€‚ï¼ˆLinux ä¸­ä½¿ç”¨çš„æ˜¯ GLIBCï¼Œå®ƒæ˜¯æ ‡å‡† C åº“çš„è¶…é›†ã€‚ä¸ä»…åŒ…å« ANSIC ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œè¿˜åŒ…æ‹¬ POSIX æ ‡å‡†ä¸­å®šä¹‰çš„å‡½æ•°ã€‚å› æ­¤ï¼ŒLinux ä¸‹æ—¢å¯ä»¥ä½¿ç”¨æ ‡å‡† IOï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ–‡ä»¶ IOï¼‰ã€‚ é€šè¿‡æ–‡ä»¶ IO è¯»å†™æ–‡ä»¶æ—¶ï¼Œæ¯æ¬¡æ“ä½œéƒ½ä¼šæ‰§è¡Œç›¸å…³ç³»ç»Ÿè°ƒç”¨ã€‚è¿™æ ·å¤„ç†çš„å¥½å¤„æ˜¯ç›´æ¥è¯»å†™å®é™…æ–‡ä»¶ï¼Œåå¤„æ˜¯é¢‘ç¹çš„ç³»ç»Ÿè°ƒç”¨ä¼šå¢åŠ ç³»ç»Ÿå¼€é”€ï¼Œæ ‡å‡† IO å¯ä»¥çœ‹æˆæ˜¯åœ¨æ–‡ä»¶ IO çš„åŸºç¡€ä¸Šå°è£…äº†ç¼“å†²æœºåˆ¶ã€‚å…ˆè¯»å†™ç¼“å†²åŒºï¼Œå¿…è¦æ—¶å†è®¿é—®å®é™…æ–‡ä»¶ï¼Œä»è€Œå‡å°‘äº†ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°ã€‚ æ–‡ä»¶ IO ä¸­ç”¨æ–‡ä»¶æè¿°ç¬¦è¡¨ç°ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼Œå¯ä»¥è®¿é—®ä¸åŒç±»å‹çš„æ–‡ä»¶å¦‚æ™®é€šæ–‡ä»¶ã€è®¾å¤‡æ–‡ä»¶å’Œç®¡é“æ–‡ä»¶ç­‰ã€‚è€Œæ ‡å‡† IO ä¸­ç”¨ FILEï¼ˆæµï¼‰è¡¨ç¤ºä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼Œé€šå¸¸åªç”¨æ¥è®¿é—®æ™®é€šæ–‡ä»¶ ç³»ç»Ÿè°ƒç”¨æ“ä½œç³»ç»Ÿè´Ÿè´£ç®¡ç†å’Œåˆ†é…æ‰€æœ‰çš„è®¡ç®—æœºèµ„æºã€‚ä¸ºäº†æ›´å¥½åœ°æœåŠ¡äºåº”ç”¨ç¨‹åºï¼Œæ“ä½œç³»ç»Ÿæä¾›äº†ä¸€ç»„ç‰¹æ®Š æ¥å£â€”â€”ç³»ç»Ÿè°ƒç”¨ã€‚é€šè¿‡è¿™ç»„æ¥å£ç”¨æˆ·ç¨‹åºå¯ä»¥ä½¿ç”¨æ“ä½œç³»ç»Ÿå†…æ ¸æä¾›çš„å„ç§åŠŸèƒ½ã€‚ä¾‹å¦‚åˆ†é…å†…å­˜ã€ åˆ›å»ºè¿›ç¨‹ã€å®ç°è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ç­‰ã€‚ ä¸ºä»€ä¹ˆä¸å…è®¸ç¨‹åºç›´æ¥è®¿é—®è®¡ç®—æœºèµ„æºï¼Ÿç­”æ¡ˆæ˜¯ä¸å®‰å…¨ã€‚å•ç‰‡æœºå¼€å‘ä¸­ï¼Œç”±äºä¸éœ€è¦æ“ä½œç³»ç»Ÿï¼Œ æ‰€ä»¥å¼€å‘äººå‘˜å¯ä»¥ç¼–å†™ä»£ç ç›´æ¥è®¿é—®ç¡¬ä»¶ã€‚è€Œåœ¨ 32 ä½åµŒå…¥å¼ç³»ç»Ÿä¸­é€šå¸¸éƒ½è¦è¿è¡Œæ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥å¼€å‘ äººå‘˜å¯ä»¥ç¼–å†™ä»£ç ç›´æ¥è®¿é—®ç¡¬ä»¶ã€‚è€Œåœ¨ 32 ä½åµŒå…¥å¼ç³»ç»Ÿä¸­é€šå¸¸éƒ½è¦è¿è¡Œæ“ä½œç³»ç»Ÿï¼Œç¨‹åºè®¿é—®èµ„æºçš„æ–¹ å¼éƒ½å‘ç”Ÿäº†æ”¹å˜ã€‚æ“ä½œç³»ç»ŸåŸºæœ¬ä¸Šéƒ½æ”¯æŒå¤šä»»åŠ¡ï¼Œå³åŒæ—¶å¯ä»¥è¿è¡Œå¤šä¸ªç¨‹åºã€‚å¦‚æœå…è®¸ç¨‹åºç›´æ¥è®¿é—® ç³»ç»Ÿèµ„æºï¼Œè‚¯å®šä¼šå¸¦æ¥å¾ˆå¤šé—®é¢˜ã€‚å› æ­¤ï¼Œæ‰€æœ‰è½¯ç¡¬ä»¶èµ„æºçš„ç®¡ç†å’Œåˆ†é…éƒ½æœ‰æ“ä½œç³»ç»Ÿè´Ÿè´£ã€‚ç¨‹åºè¦è· å–èµ„æºï¼ˆå¦‚åˆ†é…å†…å­˜ï¼Œè¯»å†™ä¸²å£ï¼‰å¿…é¡»ç”±æ“ä½œç³»ç»Ÿæ¥å®Œæˆï¼Œå³ç”¨æˆ·ç¨‹åºå‘æ“ä½œç³»ç»Ÿå‘å‡ºæœåŠ¡è¯·æ±‚ï¼Œæ“ ä½œç³»ç»Ÿæ”¶åˆ°è¯·æ±‚åæ‰§è¡Œç›¸å…³çš„ä»£ç æ¥å¤„ç†ã€‚ ç”¨æˆ·ç¨‹åºå‘æ“ä½œç³»ç»Ÿæå‡ºè¯·æ±‚çš„æ¥å£å°±æ˜¯ç³»ç»Ÿè°ƒç”¨ã€‚æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿéƒ½ä¼šæä¾›ç³»ç»Ÿè°ƒç”¨æ¥å£ï¼Œåª ä¸è¿‡ä¸åŒçš„æ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨æ¥å£å„ä¸ç›¸åŒã€‚Linux ç³»ç»Ÿè°ƒç”¨æ¥å£éå¸¸ç²¾ç®€ï¼Œå®ƒç»§æ‰¿äº† Unix ç³» ç»Ÿè°ƒç”¨ä¸­æœ€åŸºæœ¬çš„å’Œæœ€æœ‰ç”¨çš„éƒ¨åˆ†ã€‚è¿™äº›ç³»ç»Ÿè°ƒç”¨æŒ‰ç…§åŠŸèƒ½å¤§è‡´å¯åˆ†ä¸ºè¿›ç¨‹æ§åˆ¶ã€è¿›ç¨‹é—´é€šä¿¡ã€æ–‡ä»¶ ç³»ç»Ÿæ§åˆ¶ã€å­˜å‚¨ç®¡ç†ã€ç½‘ç»œç®¡ç†ã€å¥—æ¥å­—æ§åˆ¶ã€ç”¨æˆ·ç®¡ç†ç­‰å‡ ç±»ã€‚ åº“å‡½æ•°åº“å‡½æ•°å¯ä»¥è¯´æ˜¯å¯¹ç³»ç»Ÿè°ƒç”¨çš„ä¸€ç§å°è£…ï¼Œå› ä¸ºç³»ç»Ÿè°ƒç”¨æ˜¯é¢å¯¹çš„æ˜¯æ“ä½œç³»ç»Ÿï¼Œç³»ç»ŸåŒ…æ‹¬ Linuxã€ Windows ç­‰ï¼Œå¦‚æœç›´æ¥ç³»ç»Ÿè°ƒç”¨ï¼Œä¼šå½±å“ç¨‹åºçš„ç§»æ¤æ€§ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨äº†åº“å‡½æ•°ï¼Œæ¯”å¦‚è¯´ C åº“ï¼Œè¿™æ · åªè¦ç³»ç»Ÿä¸­å®‰è£…äº† C åº“ï¼Œå°±éƒ½å¯ä»¥ä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œæ¯”å¦‚ printf() scanf()ç­‰ï¼ŒC åº“ç›¸å½“äºå¯¹ç³»ç»Ÿå‡½æ•°è¿›è¡Œ äº†ç¿»è¯‘ï¼Œä½¿æˆ‘ä»¬çš„ APP å¯ä»¥è°ƒç”¨è¿™äº›å‡½æ•° ç”¨æˆ·ç¼–ç¨‹æ¥å£é€šä¿—çš„è§£é‡Šå°±æ˜¯å„ç§åº“ï¼ˆæœ€é‡è¦çš„å°±æ˜¯ C åº“ï¼‰ä¸­çš„å‡½æ•°ã€‚ä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ï¼ŒC åº“ä¸­å® ç°äº†å¾ˆå¤šå‡½æ•°ã€‚è¿™äº›å‡½æ•°å®ç°äº†å¸¸ç”¨çš„åŠŸèƒ½ï¼Œä¾›ç¨‹åºå‘˜è°ƒç”¨ã€‚è¿™æ ·ä¸€æ¥ï¼Œç¨‹åºå‘˜ä¸éœ€è¦è‡ªå·±ç¼–å†™è¿™äº› ä»£ç ï¼Œç›´æ¥è°ƒç”¨åº“å‡½æ•°å°±å¯ä»¥å®ç°åŸºæœ¬åŠŸèƒ½ï¼Œæé«˜äº†ä»£ç çš„å¤ç”¨ç‡ã€‚ä½¿ç”¨ç”¨æˆ·ç¼–ç¨‹æ¥å£è¿˜æœ‰ä¸€ä¸ªå¥½ å¤„ï¼šç¨‹åºå…·æœ‰è‰¯å¥½çš„å¯ç§»æ¤æ€§ã€‚å‡ ä¹æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿä¸Šéƒ½å®ç°äº† C åº“ï¼Œæ‰€ä»¥ç¨‹åºé€šå¸¸åªéœ€è¦é‡æ–°ç¼–è¯‘ä¸€ ä¸‹å°±å¯ä»¥åœ¨å…¶ä»–æ“ä½œç³»ç»Ÿä¸‹è¿è¡Œã€‚ ç”¨æˆ·ç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰åœ¨å®ç°æ—¶ï¼Œé€šå¸¸éƒ½è¦ä¾èµ–ç³»ç»Ÿè°ƒç”¨æ¥å£ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºè¿›ç¨‹çš„ API å‡½æ•° fork()å¯¹ åº”äºå†…æ ¸ç©ºé—´çš„ sys_fork()ç³»ç»Ÿè°ƒç”¨ã€‚å¾ˆå¤š API å‡½æ•°è¥¿äºšæˆ‘å“¦é€šè¿‡å¤šä¸ªç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆå…¶åŠŸèƒ½ã€‚è¿˜æœ‰ä¸€ äº› API å‡½æ•°ä¸è¦è°ƒç”¨ä»»ä½•ç³»ç»Ÿè°ƒç”¨ã€‚ åœ¨ Linux ä¸­ç”¨æˆ·ç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰éµå¾ªäº†åœ¨ Unix ä¸­æœ€æµè¡Œçš„åº”ç”¨ç¼–ç¨‹ç•Œé¢æ ‡å‡†â€”â€”POSIX æ ‡å‡†ã€‚ POSIX æ ‡å‡†æ˜¯ç”± IEEE å’Œ ISOIEC å…±åŒå¼€å‘çš„æ ‡å‡†ç³»ç»Ÿã€‚è¯¥æ ‡å‡†åŸºäºå½“æ—¶æƒ³ç”¨çš„ Unix å®è·µå’Œç»éªŒï¼Œæè¿° äº†æ“ä½œç³»ç»Ÿçš„ç³»ç»Ÿè°ƒç”¨ç¼–ç¨‹æ¥å£ï¼ˆå®é™…ä¸Šå°±æ˜¯ APIï¼‰ï¼Œç”¨äºä¿è¯åº”ç”¨ç¨‹åºå¯ä»¥åœ¨æºä»£ç ä¸€çº§å•†å¤šç§æ“ä½œ ç³»ç»Ÿä¸Šè¿è¡Œã€‚è¿™äº›ç³»ç»Ÿè°ƒç”¨ç¼–ç¨‹æ¥å£ä¸»è¦æ˜¯é€šè¿‡ C åº“ï¼ˆlibc )å®ç°çš„","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","IO"]},{"title":"Qt å®ç°å¾®ç§’çº§å“åº”çš„æŠ€æœ¯æŒ‡å—","path":"/2025/06/03/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qt-é«˜ç²¾åº¦å®šæ—¶å™¨/","content":"åœ¨é€šç”¨æ“ä½œç³»ç»Ÿï¼ˆWindowsLinuxï¼‰ä¸Šå®ç°å¾®ç§’ï¼ˆÎ¼sï¼‰çº§å“åº”æ˜¯ä¸€ä¸ªæå…·æŒ‘æˆ˜æ€§çš„å·¥ç¨‹é—®é¢˜ã€‚æœ¬æ–‡ä»æ“ä½œç³»ç»Ÿè°ƒåº¦æœºåˆ¶ã€Qt äº‹ä»¶å¾ªç¯åŸç†åŠåº•å±‚ç³»ç»Ÿè°ƒç”¨ä¸‰ä¸ªç»´åº¦ï¼Œæ·±å…¥è§£æå¦‚ä½•åœ¨ Qt åº”ç”¨ç¨‹åºä¸­é€¼è¿‘å®æ—¶æ€§èƒ½ã€‚ [!WARNING]å…³äºâ€œå®æ—¶â€çš„å®šä¹‰æ ‡å‡†çš„ Windows 1011 å’Œéå®æ—¶ Linux å†…æ ¸ï¼ˆNon-RTï¼‰æ— æ³•ä¿è¯ç¡¬å®æ—¶ï¼ˆHard Real-timeï¼‰ã€‚è¿™æ„å‘³ç€æ— æ³•ç»å¯¹ä¿è¯æ¯æ¬¡å“åº”éƒ½åœ¨ N å¾®ç§’å†…å®Œæˆã€‚æœ¬æ–‡è®¨è®ºçš„æŠ€æœ¯æ–¹æ¡ˆå±äºè½¯å®æ—¶ï¼ˆSoft Real-Timeï¼‰èŒƒç•´ï¼Œæ—¨åœ¨å°†å»¶è¿Ÿå°½å¯èƒ½é™ä½å¹¶ç»´æŒåœ¨å¯æ§çš„æŠ–åŠ¨èŒƒå›´å†…ã€‚ 1. æ ¸å¿ƒæœºåˆ¶ä¸å»¶è¿Ÿæ¥æºQt çš„æ ¸å¿ƒæ˜¯åŸºäº QEventLoop çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹ã€‚ç†è§£å…¶å·¥ä½œæœºåˆ¶æ˜¯ä¼˜åŒ–çš„å‰æã€‚ 1.1 äº‹ä»¶å¾ªç¯çš„æœ¬è´¨QEventLoop æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª while å¾ªç¯ï¼Œå®ƒè°ƒç”¨ç³»ç»Ÿçš„å¤šè·¯å¤ç”¨ APIï¼ˆWindows ä¸Šçš„ MsgWaitForMultipleObjects æˆ– Linux ä¸Šçš„ select/poll/epollï¼‰ã€‚ 1.2 å»¶è¿Ÿçš„ä¸»è¦æ¥æº ç³»ç»Ÿè°ƒåº¦ç²’åº¦ï¼ˆScheduling Quantumï¼‰Windows é»˜è®¤çš„æ—¶é—´ç‰‡çº¦ä¸º 15.6msï¼ˆ64Hzï¼‰ã€‚å¦‚æœä¸è°ƒæ•´ç³»ç»Ÿå®šæ—¶å™¨ç²¾åº¦ï¼ŒQTimer çš„æœ€å°åˆ†è¾¨ç‡å°†å—é™äºæ­¤ï¼Œå¯¼è‡´æ— æ³•å®ç°é«˜é¢‘æ§åˆ¶ã€‚ äº‹ä»¶å¾ªç¯å¼€é”€ä»ç³»ç»Ÿå†…æ ¸å”¤é†’çº¿ç¨‹ï¼Œåˆ° Qt åˆ†å‘äº‹ä»¶ï¼ˆProcessEventsï¼‰ï¼Œå†åˆ°æ‰§è¡Œ Slot å‡½æ•°ï¼Œæ•´ä¸ªé“¾è·¯å­˜åœ¨å›ºå®šçš„æ¡†æ¶å¼€é”€ã€‚ å…¶ä»–äº‹ä»¶é˜»å¡å¦‚æœåœ¨åŒä¸€ä¸ªçº¿ç¨‹å¤„ç†è€—æ—¶çš„ GUI æ¸²æŸ“æˆ– IO æ“ä½œï¼Œé«˜ç²¾åº¦å®šæ—¶å™¨ä¼šè¢«è¿«æ’é˜Ÿç­‰å¾…ï¼Œå¯¼è‡´ä¸å¯é¢„æµ‹çš„æŠ–åŠ¨ï¼ˆJitterï¼‰ã€‚ 2. æ“ä½œç³»ç»Ÿçº§è°ƒä¼˜è¦çªç ´æ¯«ç§’çº§é™åˆ¶ï¼Œå¿…é¡»ä¼˜å…ˆå¯¹æ“ä½œç³»ç»Ÿå’Œçº¿ç¨‹ç­–ç•¥è¿›è¡Œè°ƒä¼˜ã€‚ 2.1 Windows å¹³å°è°ƒä¼˜åœ¨ Windows ä¸Šï¼Œå¿…é¡»è°ƒç”¨ Windows API ä¿®æ”¹å…¨å±€å®šæ—¶å™¨åˆ†è¾¨ç‡ï¼Œä»¥è·å¾— 1ms çº§åˆ«çš„åŸºç¡€ç²¾åº¦ã€‚ #include windows.h// åœ¨ç¨‹åºå¯åŠ¨æ—¶è°ƒç”¨void setupWindowsTimer() // å°†ç³»ç»Ÿå®šæ—¶å™¨åˆ†è¾¨ç‡è®¾ç½®ä¸º 1msï¼ˆéƒ¨åˆ†ç¡¬ä»¶æ”¯æŒ 0.5msï¼‰ // æ³¨æ„ï¼šè¿™å°†å¢åŠ  CPU å”¤é†’é¢‘ç‡ï¼Œä»è€Œå¢åŠ åŠŸè€— timeBeginPeriod(1);// ç¨‹åºé€€å‡ºå‰æ¢å¤void cleanupWindowsTimer() timeEndPeriod(1); [!NOTE]å³ä¾¿è®¾ç½®äº† timeBeginPeriod(1)ï¼ŒSleep(1) çš„å®é™…ç¡çœ æ—¶é—´é€šå¸¸ä»ä¼šåœ¨ 1ms åˆ° 2ms ä¹‹é—´æ³¢åŠ¨ï¼Œä½†ç›¸æ¯”é»˜è®¤çš„ 15.6ms å·²æœ‰æ˜¾è‘—æ”¹å–„ã€‚ 2.2 Linux å¹³å°è°ƒä¼˜Linux å¹³å°é€šå¸¸èƒ½æä¾›æ›´å¥½çš„å®æ—¶æ€§ï¼Œå°¤å…¶æ˜¯ç»“åˆ PREEMPT_RT è¡¥ä¸çš„å†…æ ¸ã€‚ å®æ—¶è°ƒåº¦ç­–ç•¥å°†å…³é”®çº¿ç¨‹è®¾ç½®ä¸º SCHED_FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰æˆ– SCHED_RRï¼ˆè½®è½¬ï¼‰ç­–ç•¥ï¼Œå¹¶èµ‹äºˆæœ€é«˜ä¼˜å…ˆçº§ã€‚ # æŸ¥çœ‹å½“å‰ç­–ç•¥chrt -p pid# è®¾ç½®ä¸º FIFO ç­–ç•¥ï¼Œä¼˜å…ˆçº§ 99ï¼ˆæœ€é«˜ï¼‰sudo chrt -f -p 99 pid CPU äº²å’Œæ€§ï¼ˆAffinityï¼‰å°†å…³é”®çº¿ç¨‹ç»‘å®šåˆ°ç‰¹å®š CPU æ ¸å¿ƒï¼Œå¯ä»¥é¿å…çº¿ç¨‹åœ¨æ ¸å¿ƒé—´è¿ç§»å¯¼è‡´çš„ CPU ç¼“å­˜å¤±æ•ˆï¼ˆCache Missï¼‰å’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚ 2.3 Qt çº¿ç¨‹ä¼˜å…ˆçº§è®¾ç½®æ— è®ºåœ¨å“ªä¸ªå¹³å°ï¼Œéƒ½åº”å°†å¤„ç†å¾®ç§’çº§ä»»åŠ¡çš„ QThread ä¼˜å…ˆçº§è°ƒè‡³æœ€é«˜ã€‚ QThread::currentThread()-setPriority(QThread::TimeCriticalPriority); Windows: å¯¹åº” THREAD_PRIORITY_TIME_CRITICALã€‚ Linux: é€šå¸¸å°è¯•è°ƒæ•´ nice å€¼æˆ–å®æ—¶ä¼˜å…ˆçº§ï¼ˆå–å†³äºç”¨æˆ·æƒé™ï¼‰ã€‚ 3. Qt é«˜ç²¾åº¦å®šæ—¶æ–¹æ¡ˆ3.1 æ–¹æ¡ˆ Aï¼šä½¿ç”¨ QChronoTimer (Qt 6.8+)é€‚ç”¨äºé€»è¾‘ç›¸å¯¹ç®€å•ï¼Œä¸éœ€è¦çº³ç§’çº§ä¸¥è‹›æ§åˆ¶ï¼Œä½†éœ€è¦ä¼˜äº 1ms ç²¾åº¦çš„åœºæ™¯ã€‚ Qt 6.8 å¼•å…¥äº† QChronoTimerï¼Œæ”¯æŒ std::chrono::nanosecondsï¼Œå¹¶åœ¨åº•å±‚é€‚é…äº†æ›´é«˜ç²¾åº¦çš„ç³»ç»Ÿå®šæ—¶å™¨ï¼ˆå¦‚ Windows çš„ CreateWaitableTimerExï¼‰ã€‚ #include QChronoTimer// é€‚ç”¨äº Qt 6.8 åŠä»¥ä¸Šç‰ˆæœ¬auto timer = new QChronoTimer(this);timer-setInterval(std::chrono::microseconds(500)); // è®¾å®š 500ustimer-setTimerType(Qt::PreciseTimer);connect(timer, QChronoTimer::timeout, this, []() // æ‰§è¡Œé«˜é¢‘ä»»åŠ¡ // è­¦å‘Šï¼šåˆ‡å‹¿åœ¨æ­¤æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œå¦åˆ™ä¼šå‘ç”Ÿäº‹ä»¶ç§¯å‹);timer-start(); 3.2 æ–¹æ¡ˆ Bï¼šæè‡´ä½å»¶è¿Ÿ (Busy Loop + Sleep)å¯¹äº 100Î¼s çš„æç«¯ä½å»¶è¿Ÿéœ€æ±‚ï¼Œä¾èµ– OS çš„ SleepWait æœºåˆ¶å¾€å¾€ä¸å¯é ã€‚æœ€ç¡¬æ ¸çš„æ–¹å¼æ˜¯ä½¿ç”¨è‡ªæ—‹ç­‰å¾…ï¼ˆBusy Waitï¼‰æˆ–æ··åˆç­‰å¾…ç­–ç•¥ï¼Œå¹¶è¿è¡Œåœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­ã€‚ æ­¤æ–¹æ¡ˆä¼šå ç”¨ä¸€ä¸ªæ ¸å¿ƒ 100% çš„ CPU èµ„æºï¼Œå› æ­¤å¿…é¡»ç»“åˆ CPU äº²å’Œæ€§ç»‘å®šæ ¸å¿ƒã€‚ #include QThread#include QElapsedTimer#include atomicclass MicrosecondWorker : public QThread public: void stop() m_running = false; protected: void run() override // 1. æå‡çº¿ç¨‹ä¼˜å…ˆçº§ setPriority(QThread::TimeCriticalPriority); // 2. åˆå§‹åŒ–é«˜ç²¾åº¦è®¡æ—¶å™¨ QElapsedTimer timer; timer.start(); qint64 lastTime = timer.nsecsElapsed(); const qint64 intervalNs = 500 * 1000; // 500us m_running = true; while (m_running) qint64 currentTime = timer.nsecsElapsed(); // 3. æ£€æŸ¥æ˜¯å¦åˆ°è¾¾æ—¶é—´ç‚¹ if (currentTime - lastTime = intervalNs) performRealtimeTask(); // æ‰§è¡Œå®æ—¶ä»»åŠ¡ lastTime += intervalNs; // ä¿æŒç›¸ä½ï¼Œé¿å…ç´¯ç§¯è¯¯å·® else // 4. æ··åˆç­‰å¾…ç­–ç•¥ qint64 diff = intervalNs - (currentTime - lastTime); if (diff 2000000) // å¦‚æœå‰©ä½™æ—¶é—´ 2ms QThread::msleep(1); // è®©å‡º CPU else // è‡ªæ—‹ç­‰å¾… (Busy Loop) ç”¨äºæœ€åçš„å¾®ç§’çº§ç²¾åº¦ // æ’å…¥ _mm_pause() æŒ‡ä»¤é™ä½ CPU æµæ°´çº¿å‹åŠ›å’ŒåŠŸè€— while (timer.nsecsElapsed() lastTime + intervalNs) // _mm_pause(); // Optional: include emmintrin.h private: std::atomicbool m_running; void performRealtimeTask() // å®æ—¶ä¸šåŠ¡é€»è¾‘ ; 4. æ€§èƒ½æµ‹é‡ä¸éªŒè¯ä¸è¦å‡­æ„Ÿè§‰ä¼˜åŒ–ã€‚åŠ¡å¿…ä½¿ç”¨ QElapsedTimer è¿›è¡Œç²¾ç¡®æµ‹é‡ã€‚å®ƒåœ¨ Windows ä¸Šä½¿ç”¨ QueryPerformanceCounterï¼Œåœ¨ Linux ä¸Šä½¿ç”¨ clock_gettime(CLOCK_MONOTONIC)ï¼Œç²¾åº¦é€šå¸¸åœ¨çº³ç§’çº§ã€‚ QElapsedTimer timer;timer.start();// ... å¾…æµ‹ä»£ç å— ...qint64 ns = timer.nsecsElapsed();qDebug() Operation took ns nanoseconds; æ–¹æ¡ˆå¯¹æ¯”æ•°æ®ä»¥ä¸‹æ˜¯åœ¨æ ‡å‡†ç¡¬ä»¶ä¸Šçš„å…¸å‹æµ‹è¯•ç»“æœå¯¹æ¯”ï¼š æ–¹æ¡ˆ æœ€å°å®šæ—¶å™¨é—´éš” (å®é™…) æŠ–åŠ¨ (Jitter) é€‚ç”¨åœºæ™¯ é»˜è®¤ Windows è®¾ç½® ~15.6 ms é«˜ æ™®é€š GUI åˆ·æ–° timeBeginPeriod(1) ~1.0 ms ä¸­ å¤šåª’ä½“æ’­æ”¾ã€ç®€å•åŠ¨ç”» QChronoTimer (Precise) ~1.0 ms (å— OS é™åˆ¶) ä¸­ é«˜é¢‘å®šæ—¶ä»»åŠ¡ ç‹¬ç«‹çº¿ç¨‹ + Busy Loop 10 us æä½ å·¥ä¸šæ§åˆ¶ã€é«˜é¢‘é‡‡é›† 5. æ€»ç»“ Qt ä¸æ˜¯ RTOSï¼šä¸è¦æŒ‡æœ›ä»æ ‡å‡† Qt è·å¾—ç¡¬å®æ—¶ä¿è¯ã€‚ OS è°ƒä¼˜æ˜¯åŸºç¡€ï¼šWindows ä¸‹çš„ timeBeginPeriod å’Œ Linux ä¸‹çš„ chrtaffinity æ˜¯æå‡å®æ—¶æ€§çš„å¿…è¦æ‰‹æ®µã€‚ Qt 6.8+ å‰ç»ï¼šQChronoTimer æä¾›äº†æ›´ç°ä»£çš„ APIï¼Œä½†ç‰©ç†æé™ä»ç”± OS å†³å®šã€‚ å¾®ç§’çº§å¿…æ€æŠ€ï¼šå¯¹äº 1ms çš„éœ€æ±‚ï¼Œç‹¬ç«‹çº¿ç¨‹ + è‡ªæ—‹ç­‰å¾…æ˜¯å”¯ä¸€å¯é çš„çº¯è½¯ä»¶æ–¹æ¡ˆã€‚ å¦‚æœåº”ç”¨åœºæ™¯ï¼ˆå¦‚é«˜ç²¾è¿åŠ¨æ§åˆ¶ï¼‰å¯¹å®æ—¶æ€§æœ‰ç¡¬æ€§è¦æ±‚ï¼ˆMiss Deadline Failureï¼‰ï¼Œå»ºè®®å°†æ§åˆ¶å›è·¯å‰¥ç¦»åˆ° PLCã€FPGA æˆ–ä¸“ç”¨å®æ—¶æ§åˆ¶å™¨ä¸­ï¼ŒQt ä»…ä½œä¸ºä¸Šä½æœº HMIã€‚ å‚è€ƒæ¥æº Qt Documentation: QElapsedTimer Microsoft Docs: timeBeginPeriod Linux man-pages: chrt","tags":["Qt","RealTime","Performance"],"categories":["3.å¼€å‘æ¡†æ¶","Qt"]},{"title":"ARMæœºå™¨è§†è§‰åº“","path":"/2025/05/21/3-å¼€å‘æ¡†æ¶-OpenCV-ARMæœºå™¨è§†è§‰åº“/","content":"ä»€ä¹ˆæ˜¯ ARM è®¡ç®—æœºè§†è§‰åº“ARM è®¡ç®—æœºè§†è§‰åº“æ˜¯ä¸€ç³»åˆ—é’ˆå¯¹ ARM æ¶æ„ï¼ˆARM CPU å’Œ Mali GPUï¼‰ä¼˜åŒ–çš„ä½çº§è½¯ä»¶åº“ï¼Œä¸“ä¸ºå›¾åƒå¤„ç†ã€è®¡ç®—æœºè§†è§‰å’Œæœºå™¨å­¦ä¹ ç­‰ä»»åŠ¡è®¾è®¡ã€‚è¿™äº›åº“é€šè¿‡é«˜æ•ˆåˆ©ç”¨ ARM æ¶æ„çš„ç‰¹æ€§ï¼Œå¸®åŠ©å¼€å‘è€…åœ¨ ARM åŸºç¡€ä¸Šçš„è®¾å¤‡ä¸Šå®ç°é«˜æ€§èƒ½çš„å¤šåª’ä½“å’Œè®¡ç®—æœºè§†è§‰åº”ç”¨ã€‚è¿™ä¸€åº“æ˜¯å…è´¹ä½¿ç”¨çš„ï¼Œä½†éœ€è¦è·å¾— MIT å¼€æºè®¸å¯è¯ï¼ˆMIT Licenseï¼‰ï¼Œè¯¥è®¸å¯è¯å…è®¸ç”¨æˆ·è‡ªç”±åœ°ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘ä»£ç ï¼Œé€‚ç”¨äºå•†ä¸šå’Œéå•†ä¸šç”¨é€”ã€‚ ä¸»è¦åŠŸèƒ½æ¨¡å—ARM è®¡ç®—æœºè§†è§‰åº“åŒ…å«ä»¥ä¸‹å…³é”®åŠŸèƒ½æ¨¡å—ï¼š åŸºæœ¬è¿ç®—ä¸æ•°å­¦å‡½æ•°æä¾› Various mathematical and binary operation functions for fundamental tasks, å¦‚å‘é‡æ“ä½œå’ŒçŸ©é˜µè¿ç®—ã€‚ é¢œè‰²å¤„ç†åŒ…æ‹¬é¢œè‰²ç©ºé—´è½¬æ¢ï¼ˆå¦‚ RGB åˆ° YUVï¼‰ã€é€šé“æå–å’Œåˆå¹¶ç­‰åŠŸèƒ½ï¼Œå¸¸ç”¨äºå›¾åƒé¢„å¤„ç†é˜¶æ®µã€‚ å·ç§¯æ“ä½œå®ç°äº† Sobel è¿‡æ»¤å™¨ã€Gaussian æ»¤é•œç­‰å¸¸ç”¨çš„å·ç§¯æ ¸ï¼Œç”¨äºè¾¹ç¼˜æ£€æµ‹ã€æ¨¡ç³Šå¤„ç†ç­‰ä»»åŠ¡ã€‚ ç‰¹å¾æ£€æµ‹ä¸è·Ÿè¸ªåŒ…æ‹¬ Canny è¾¹ç¼˜æ£€æµ‹ã€Harris è§’ç‚¹æ£€æµ‹å’Œå…‰æµè®¡ç®—ï¼Œå¹¿æ³›åº”ç”¨äºç›®æ ‡è¯†åˆ«å’Œè¿½è¸ªã€‚ å›¾åƒé‡‘å­—å¡”æä¾› Laplacian é‡‘å­—å¡”ç­‰å¤šå°ºåº¦åˆ†æå·¥å…·ï¼Œç”¨äºç‰¹å¾æå–å’Œå›¾åƒåˆ†è§£ã€‚ HOG ç‰¹å¾æ–¹å‘æ¢¯åº¦ç›´æ–¹å›¾ï¼ˆHOGï¼‰ç”¨äºäººä½“æ£€æµ‹å’Œå§¿æ€è¯†åˆ«ã€‚ SVM æ”¯æŒå‘é‡æœºä¸€ç§ç”¨äºåˆ†ç±»çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œå¸¸ç”¨äºå›¾åƒåˆ†ç±»ä»»åŠ¡ã€‚ çŸ©é˜µä¹˜æ³•åŒ…æ‹¬åŠç²¾åº¦ï¼ˆH) å’Œå•ç²¾åº¦ (SGEMM) ä¸€èˆ¬çŸ©é˜µä¹˜æ³•ï¼Œç”¨äºåŠ é€Ÿæœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ çš„è®¡ç®—ã€‚ å·ç§¯ç¥ç»ç½‘ç»œæ„é€ å—æä¾›å·ç§¯ã€æ¿€æ´»å‡½æ•°ã€å…¨è¿æ¥å±‚ã€å±€éƒ¨è¿æ¥ã€å½’ä¸€åŒ–ã€æ± åŒ–å’Œ Softmax å±‚ç­‰ CNN æ„å»ºæ¨¡å—ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ„å»ºå’Œä¼˜åŒ–ç¥ç»ç½‘ç»œã€‚ ARM è®¡ç®—æœºè§†è§‰åº“çš„ä¼˜åŠ¿1. é«˜æ€§èƒ½ä¸å¯ç§»æ¤æ€§ NEON SIMD åŠ é€ŸARM åº“ä¸­çš„ CPU åŠŸèƒ½é€šè¿‡ NEON SIMD å¼•æ“å®ç°ï¼Œæ”¯æŒå•æŒ‡ä»¤å¤šæ•°æ® (SIMD) æ“ä½œï¼Œæ˜¾è‘—æå‡äº†å¤šåª’ä½“å’Œä¿¡å·å¤„ç†ç®—æ³•çš„æ‰§è¡Œæ•ˆç‡ã€‚å¼€å‘è€…å¯ä»¥é’ˆå¯¹ç›®æ ‡æ¶æ„é‡æ–°ç¼–è¯‘å†…ç½®å‡½æ•°ï¼Œæ”¯æŒ 32 ä½å’Œ 64 ä½ä»£ç ç”Ÿæˆï¼Œä»è€Œå…¼å®¹ä¸åŒæ¶æ„çš„ ARM å¤„ç†å™¨ã€‚ OpenGL è·¨å¹³å°æ”¯æŒGPU ç‰ˆæœ¬åŸºäº OpenGL æ ‡å‡† API å¼€å‘ï¼Œå†…æ ¸ç¨‹åºå¯ä»¥åœ¨å¤šç§ GPU æ¶æ„ä¸Šé«˜æ•ˆè¿è¡Œï¼Œç¡®ä¿ä»£ç çš„å¯ç§»æ¤æ€§ã€‚ 2. ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆARM è®¡ç®—æœºè§†è§‰åº“ä¸æ“ä½œç³»ç»Ÿæ— å…³ï¼Œç›®å‰å·²éƒ¨ç½²åœ¨åŸºäº ARM çš„ Linux ç³»ç»Ÿå’Œ Android ç‰‡ä¸Šç³»ç»Ÿï¼ˆSoCï¼‰ä¸Šï¼Œæ”¯æŒåµŒå…¥å¼è®¾å¤‡ã€ç§»åŠ¨ç»ˆç«¯ç­‰å¤šç§å¹³å°ã€‚ NEON æŠ€æœ¯è§£æNEON æ˜¯ ARM æ¶æ„ä¸­çš„ SIMD å¼•æ“ï¼Œä¸“ä¸ºå¤šåª’ä½“å’Œä¿¡å·å¤„ç†è®¾è®¡ã€‚é€šè¿‡ SIMD æŠ€æœ¯ï¼ŒNEON èƒ½å¤Ÿå¹¶è¡Œå¤„ç†å¤šä¸ªæ•°æ®å…ƒç´ ï¼Œä»è€ŒåŠ é€Ÿä»¥ä¸‹ä»»åŠ¡ï¼š è§†é¢‘è§£ç ä¸ç¼–ç  éŸ³é¢‘å¤„ç† å›¾åƒå¤„ç† æœºå™¨å­¦ä¹ æ¨ç† ä¾‹å¦‚ï¼ŒNEON å¯ä»¥åŠ é€Ÿ H.264H.265 è§†é¢‘è§£ç ã€AAC éŸ³é¢‘è§£ç ï¼Œä»¥åŠå„ç§å›¾åƒå¤„ç†ç®—æ³•ï¼ˆå¦‚é¢œè‰²è½¬æ¢ã€æ»¤é•œåº”ç”¨ç­‰ï¼‰ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚ ä¸»è¦è§†è§‰åº“1. HPCHPCï¼ˆHigh-Performance Computingï¼‰åº“é€šè¿‡æé«˜ä»¿çœŸååé‡ï¼Œä¸ºå·¥ç¨‹å›¢é˜Ÿæä¾›æ›´å¤§çš„è®¾è®¡å’Œä¼˜åŒ–ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œå·¥ç¨‹å¸ˆå¯ä»¥å¹¶è¡Œä»¿çœŸå¤šä¸ªè®¾è®¡æ–¹æ¡ˆï¼Œæå‰å‘ç°æ½œåœ¨é—®é¢˜å¹¶ä¼˜åŒ–è®¾è®¡æ–¹æ¡ˆï¼Œæ˜¾è‘—ç¼©çŸ­å¼€å‘å‘¨æœŸã€‚ 2. Ne10Ne10 æ˜¯ä¸€ä¸ªå¼€æºçš„ã€é’ˆå¯¹ ARM æ¶æ„ä¼˜åŒ–çš„ C åº“ï¼ŒåŒ…å«äº†è®¸å¤šå¸¸ç”¨çš„é«˜æ€§èƒ½è®¡ç®—å‡½æ•°ã€‚å…¶ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š æ•°å­¦è¿ç®—ï¼ˆå¦‚å‘é‡åŠ æ³•ã€ä¹˜æ³•ã€ç‚¹ç§¯ç­‰ï¼‰ çŸ©é˜µæ“ä½œï¼ˆå¦‚çŸ©é˜µä¹˜æ³•ã€è½¬ç½®ç­‰ï¼‰ transformsï¼ˆå¦‚å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ FFTï¼‰ å®ç”¨å·¥å…·ï¼ˆåƒç´ è¿ç®—ã€ç»Ÿè®¡å‡½æ•°ç­‰ï¼‰ å¼€å‘è€…å¯ä»¥ä» GitHub ä¸‹è½½å¹¶é›†æˆ Ne10 åº«ã€‚ 3. Libyuvlibyuv æ˜¯ä¸€ä¸ªä¸“æ³¨äº YUV å›¾åƒç¼©æ”¾å’Œè½¬æ¢çš„å¼€æºé¡¹ç›®ï¼Œå¹¿æ³›åº”ç”¨äºè§†é¢‘ç¼–è§£ç å’Œå›¾åƒå¤„ç†é¢†åŸŸã€‚å®ƒæ”¯æŒï¼š YUV ä¸ RGB ä¹‹é—´çš„äº’ç›¸è½¬æ¢ å›¾åƒç¼©æ”¾ï¼ˆå¦‚ä¸Šé‡‡æ ·ã€ä¸‹é‡‡æ ·ï¼‰ è‰²å½©ç©ºé—´è½¬æ¢ï¼ˆå¦‚ NV12 åˆ° I420ï¼‰ 4. SkiaSkia æ˜¯ Google å¼€å‘çš„é«˜æ€§èƒ½ 2D å›¾å½¢åº“ï¼Œç”¨äº Chromeã€Android ç­‰äº§å“çš„å›¾å½¢æ¸²æŸ“ã€‚å®ƒæ”¯æŒï¼š ä½å›¾å›¾åƒå¤„ç†ï¼ˆå¦‚ alpha åˆæˆã€æŠ—é”¯é½¿ç­‰ï¼‰ çŸ¢é‡å›¾å½¢ç»˜åˆ¶ï¼ˆå¦‚è·¯å¾„ã€æ–‡å­—æ¸²æŸ“ï¼‰ å›¾åƒç¼©æ”¾ä¸å‹ç¼© Skia çš„é«˜æ•ˆæ¸²æŸ“èƒ½åŠ›ä½¿å…¶æˆä¸ºè®¸å¤šåº”ç”¨çš„é¦–é€‰å›¾å½¢å¼•æ“ã€‚ æ€»ä¹‹ï¼ŒARM è®¡ç®—æœºè§†è§‰åº“ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªå¼ºå¤§ä¸”çµæ´»çš„å·¥å…·é›†ï¼Œå¯ä»¥åœ¨ ARM æ¶æ„ä¸Šé«˜æ•ˆå®ç°è®¡ç®—æœºè§†è§‰å’Œæœºå™¨å­¦ä¹ ä»»åŠ¡ã€‚é€šè¿‡ NEON å’Œ OpenGL çš„åŠ é€Ÿï¼Œå¼€å‘è€…èƒ½å¤Ÿè½»æ¾ä¼˜åŒ–ä»£ç å¹¶æ‰©å±•åˆ°å¤šç§å¹³å°ã€‚","categories":["3.å¼€å‘æ¡†æ¶","OpenCV"]},{"title":"Qt æ’ä»¶ç³»ç»Ÿ","path":"/2025/05/21/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qt-æ’ä»¶ç³»ç»Ÿ/","content":"1. ç®€ä»‹Qt Creator çš„æ’ä»¶ç³»ç»Ÿæ˜¯å…¶æ¶æ„çš„æ ¸å¿ƒã€‚æœ¬è´¨ä¸Šï¼ŒQt Creator æ˜¯ä¸€ä¸ªç”±è½»é‡çº§æ ¸å¿ƒï¼ˆCore Pluginï¼‰å’Œä¼—å¤šæ‰©å±•æ’ä»¶ï¼ˆPluginsï¼‰ç»„æˆçš„é›†åˆä½“ã€‚ 1.1 æ’ä»¶æœ¬è´¨ä»æŠ€æœ¯è§’åº¦çœ‹ï¼Œæ’ä»¶æ˜¯ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼ˆWindows ä¸‹ä¸º .dllï¼ŒLinux ä¸‹ä¸º .soï¼‰ã€‚å¼€å‘æ’ä»¶éµå¾ªå®šä¹‰æ¥å£ã€ç»§æ‰¿åŸºç±»ã€ç¼–è¯‘ç”ŸæˆåŠ¨æ€åº“çš„æ ‡å‡†æµç¨‹ã€‚ 1.2 åŸºç¡€åŠ è½½æœºåˆ¶Qt ä½¿ç”¨ QPluginLoader è¿›è¡Œåº•å±‚åŠ è½½ï¼Œé€šè¿‡ qobject_cast å°†å®ä¾‹è½¬æ¢ä¸ºæ ‡å‡†æ¥å£ï¼š // åŠ è½½åŠ¨æ€åº“QPluginLoader loader(pluginName);loader.load();// è½¬æ¢ä¸ºé€šç”¨æ’ä»¶æ¥å£IPlugin *pluginObject = qobject_castIPlugin*(loader.instance());// æˆ–è½¬æ¢ä¸ºç‰¹å®šç±»å‹ï¼Œå¦‚æ ¸å¿ƒæ’ä»¶CorePlugin *pCorePluginObj = qobject_castCorePlugin*(loader.instance()); 2. æ’ä»¶ç³»ç»Ÿæ¶æ„æ•´ä¸ªç”Ÿæ€ç³»ç»Ÿä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šæ’ä»¶ç®¡ç†å™¨ (PluginManager)ã€æ ¸å¿ƒæ’ä»¶ (Core Plugins) å’Œ æ™®é€šæ’ä»¶ã€‚ 2.1 ç»„ä»¶å…³ç³» æ’ä»¶ç®¡ç†å™¨ï¼šè´Ÿè´£æ•´ä¸ªç³»ç»Ÿçš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬åŠ è½½ã€ä¾èµ–è§£æã€åˆå§‹åŒ–å’Œå¸è½½ã€‚ **æ ¸å¿ƒæ’ä»¶ (Core)**ï¼šæä¾›åº”ç”¨ç¨‹åºçš„åŸºç¡€è®¾æ–½ï¼ˆä¸»çª—å£ã€èœå•æ ã€åŠ¨ä½œç®¡ç†å™¨ï¼‰ï¼Œæ˜¯æ‰€æœ‰å…¶ä»–æ’ä»¶çš„æ ¹ä¾èµ–ã€‚ æ™®é€šæ’ä»¶ï¼šå®ç°å…·ä½“çš„ä¸šåŠ¡åŠŸèƒ½ï¼ˆå¦‚ C++ ç¼–è¾‘å™¨ã€Git æ”¯æŒç­‰ï¼‰ï¼Œé€šè¿‡ä¾èµ–æ ¸å¿ƒæ’ä»¶æ‰©å±•åŠŸèƒ½ã€‚ 2.2 æ¶æ„ç¤ºæ„ (C4 Component Diagram)C4Component title Qt Creator Plugin Architecture Container_Boundary(qtconfig, Qt Creator Interface) Component(plugin_manager, PluginManager, C++ System, Manages lifecycle, dependencies, and object pool) Component(core_plugin, Core Plugin, C++ Plugin, Provides MainWindow, Event Loop, ActionManager) Component(ext_system, ExtensionSystem, Library, Base classes IPlugin, PluginSpec) Component_Ext(cpp_editor, C++ Editor, Plugin, Specific functionality) Component_Ext(git_plugin, Git Support, Plugin, Specific functionality) Rel(plugin_manager, ext_system, Uses Definitions) Rel(core_plugin, ext_system, Inherits IPlugin) Rel(cpp_editor, core_plugin, Depends on) Rel(git_plugin, core_plugin, Depends on) Rel(plugin_manager, core_plugin, Loads Initializes) Rel(plugin_manager, cpp_editor, Loads Initializes) 3. æ’ä»¶ç®¡ç†å™¨ (PluginManager) è¯¦è§£æ’ä»¶ç®¡ç†å™¨æ˜¯ç³»ç»Ÿçš„â€œå¤§è„‘â€ï¼Œä¸»è¦è´Ÿè´£å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ã€‚ 3.1 å¯¹è±¡æ± ç®¡ç†PluginManager ç»´æŠ¤äº†ä¸€ä¸ªå…¨å±€çš„å¯¹è±¡æ± ï¼Œç”¨äºæ’ä»¶é—´é€šä¿¡å’Œèµ„æºå…±äº«ã€‚å…¶æ ¸å¿ƒæ˜¯ä¸€ä¸ªå•ä¾‹ç±»ï¼Œåº•å±‚æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š // pluginmanager_p.hclass EXTENSIONSYSTEM_EXPORT PluginManagerPrivate : public QObjectpublic: QHashQString, QListPluginSpec * pluginCategories; QListPluginSpec * pluginSpecs; // æ’ä»¶è§„çº¦åˆ—è¡¨ QListQObject * allObjects; // å…¨å±€å¯¹è±¡æ± ï¼ˆQt Creator 4.10+ å»ºè®®ç”¨ QVectorï¼‰ // ...; 3.2 å¯¹è±¡çš„æ·»åŠ ä¸ç§»é™¤å¯¹è±¡æ± çš„æ“ä½œå¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ **æ·»åŠ å¯¹è±¡ (addObject)**ï¼š è·å–å†™é” (QWriteLocker)ã€‚ æ ¡éªŒå¯¹è±¡æœ‰æ•ˆæ€§åŠé‡å¤æ€§ã€‚ æ·»åŠ åˆ° allObjects åˆ—è¡¨ã€‚ å‘å°„ objectAdded ä¿¡å·ï¼Œä¾›å…¶ä»–æ¨¡å—ï¼ˆå¦‚ ModeManagerï¼‰å“åº”ã€‚ void PluginManagerPrivate::addObject(QObject *obj) QWriteLocker lock(m_lock); // ... (æ£€æŸ¥ä»£ç ) allObjects.append(obj); emit q-objectAdded(obj); **ç§»é™¤å¯¹è±¡ (removeObject)**ï¼šå…ˆå‘å°„ aboutToRemoveObject ä¿¡å·ï¼Œå†åŠ é”ç§»é™¤ï¼Œç¡®ä¿ä¾èµ–è¯¥å¯¹è±¡çš„ç»„ä»¶èƒ½æå‰æ¸…ç†ã€‚ 4. æ’ä»¶è§„çº¦ä¸ä¾èµ–ç³»ç»Ÿæ¯ä¸ªæ’ä»¶ä¸ä»…æ˜¯ä¸€ä¸ªåŠ¨æ€åº“ï¼Œè¿˜åŒ…å«æè¿°å…¶å…ƒæ•°æ®çš„è§„çº¦ (PluginSpec)ã€‚ 4.1 æ’ä»¶æè¿°æ–‡ä»¶ (.json)æ¯ä¸ªæ’ä»¶å¿…é¡»åŒ…å«ä¸€ä¸ª .json å…ƒæ•°æ®æ–‡ä»¶ã€‚é€šè¿‡ Q_PLUGIN_METADATA å®ç»‘å®šï¼š class CorePlugin : public ExtensionSystem::IPlugin Q_OBJECT Q_PLUGIN_METADATA(IID org.qt-project.Qt.QtCreatorPlugin FILE Core.json); Core.json ç¤ºä¾‹ç»“æ„ï¼š Name : Core, Version : $$QTCREATOR_VERSION, Required : true, Vendor : The Qt Company Ltd, Category : Qt Creator, Arguments : [ Name : -theme, Parameter : default|dark ] [!TIP]é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ $$QTCREATOR_VERSION ç­‰å®å˜é‡ï¼Œé…åˆ qmake/cmake æ„å»ºç³»ç»Ÿå®ç°ç‰ˆæœ¬å·çš„è‡ªåŠ¨åŒæ­¥ï¼Œé¿å…ç¡¬ç¼–ç ã€‚ 4.2 ä¾èµ–ç®¡ç† (PluginDependency)ç³»ç»Ÿçš„å¥å£®æ€§ä¾èµ–äºä¸¥æ ¼çš„ä¾èµ–ç®¡ç†ã€‚ä¾èµ–å…³ç³»å®šä¹‰äº†åŠ è½½é¡ºåºï¼š struct PluginDependency enum Type Required, Optional, Test ; QString name; // ä¾èµ–æ’ä»¶å QString version; // ç‰ˆæœ¬è¦æ±‚ Type type; // ä¾èµ–ç±»å‹; è‹¥æ’ä»¶ A ä¾èµ–æ’ä»¶ Bï¼Œåˆ™ B å¿…é¡»åœ¨ A ä¹‹å‰åŠ è½½å¹¶åˆå§‹åŒ–ã€‚ 5. æ’ä»¶åŠ è½½å…¨ç”Ÿå‘½å‘¨æœŸæ’ä»¶åŠ è½½ä¸æ˜¯ç®€å•çš„ load()ï¼Œè€Œæ˜¯ä¸€ä¸ªå¤šé˜¶æ®µçš„çŠ¶æ€æœºè¿‡ç¨‹ã€‚ 5.1 åŠ è½½æµç¨‹ä¸çŠ¶æ€æœºstateDiagram-v2 [*] -- Read : readMetaData() Read -- Resolved : resolveDependencies() Resolved -- Read : Loop for all plugins Resolved -- Loaded : loadPlugins() [Load DLL] Loaded -- Initialized : initialize() [Minimal setup] Initialized -- Running : extensionsInitialized() [Full interactive] Running -- Delayed : nextDelayedInitialize() Delayed -- Running : delayedInitialize() [Background tasks] Running -- Stopped : shutdown() Stopped -- [*] note right of Read Only reads .json metadata No DLL loaded yet end note note right of Initialized Can access dependencies but dependencies might not be full end note 5.2 å…³é”®é˜¶æ®µè§£æ è¯»å–å…ƒæ•°æ® (readMetaData) æ‰«ææ’ä»¶ç›®å½•ã€‚ è¯»å– .json æè¿°æ–‡ä»¶ã€‚ åˆ›å»º PluginSpec å¯¹è±¡ä½†ä¸åŠ è½½åŠ¨æ€åº“ï¼ˆé¢„åŠ è½½ï¼‰ã€‚ è§£å†³ä¾èµ– (resolveDependencies) æ„å»ºä¾èµ–æ ‘ã€‚ æ£€æµ‹å¾ªç¯ä¾èµ–ã€‚ ç¡®å®šåŠ è½½é¡ºåºã€‚ åŠ è½½ (Load) è°ƒç”¨ QPluginLoader::load()ã€‚ å®ä¾‹åŒ– IPlugin æ¥å£å¯¹è±¡ã€‚ çŠ¶æ€è½¬å˜ä¸º PluginSpec::Loadedã€‚ åˆå§‹åŒ– (Initialize) è°ƒç”¨æ’ä»¶çš„ initialize(arguments, errorString)ã€‚ å…³é”®ç‚¹ï¼šæ­¤æ—¶æ’ä»¶å¯ä»¥è®¿é—®å…¶ä¾èµ–æ’ä»¶çš„å…¬å…±æ¥å£ï¼Œä½†ä¸èƒ½å‡è®¾æ‰€æœ‰æ’ä»¶éƒ½å·²åˆå§‹åŒ–ã€‚ çŠ¶æ€è½¬å˜ä¸º PluginSpec::Initializedã€‚ æ‰©å±•åˆå§‹åŒ– (ExtensionsInitialized) è°ƒç”¨ extensionsInitialized()ã€‚ å…³é”®ç‚¹ï¼šæ‰€æœ‰ä¾èµ–æ’ä»¶å‡å·²å®Œæˆ initializeï¼Œå¯ä»¥è¿›è¡Œæ·±åº¦äº¤äº’ï¼ˆå¦‚è®¢é˜…ä¿¡å·ã€æ³¨å†Œå›è°ƒï¼‰ã€‚ çŠ¶æ€è½¬å˜ä¸º PluginSpec::Runningã€‚ å»¶è¿Ÿåˆå§‹åŒ– (DelayedInitialize) å¯¹äºéå…³é”®è·¯å¾„çš„é€»è¾‘ï¼Œæ”¾å…¥å»¶è¿Ÿé˜Ÿåˆ—ï¼Œåœ¨ä¸»å¾ªç¯ç©ºé—²æ—¶æ‰§è¡Œï¼ŒåŠ å¿«å¯åŠ¨é€Ÿåº¦ã€‚ 6. æ ¸å¿ƒæ’ä»¶ (Core Plugin) å®ç°æ ¸å¿ƒæ’ä»¶ï¼ˆCoreï¼‰æ˜¯ç‰¹æ®Šçš„å®¿ä¸»æ’ä»¶ï¼Œå®ƒä¸ä¾èµ–å…¶ä»–æ’ä»¶ï¼Œåè€Œæ˜¯å…¶ä»–æ‰€æœ‰æ’ä»¶çš„åŸºç¡€ã€‚ 6.1 æ ¸å¿ƒèŒè´£ æ³¨å†Œ MimeTypesï¼šå®šä¹‰æ–‡ä»¶ç±»å‹å¤„ç†è§„åˆ™ã€‚ ä¸»é¢˜ç®¡ç†ï¼šåŠ è½½ .creatortheme (ini æ ¼å¼) ä¸»é¢˜æ–‡ä»¶ï¼Œç®¡ç†é¢œè‰²å’Œè°ƒè‰²æ¿ã€‚ **åŠ¨ä½œç®¡ç† (ActionManager)**ï¼šåˆå§‹åŒ–å…¨å±€å‘½ä»¤ç³»ç»Ÿã€‚ **ä¸»çª—å£ (MainWindow)**ï¼šæ„å»º IDE çš„ä¸»éª¨æ¶ã€‚ 6.2 ä¸»çª—å£åˆå§‹åŒ–Core æ’ä»¶çš„ initialize å‡½æ•°å®Œæˆäº† IDE ç•Œé¢çš„æ„å»ºï¼š bool CorePlugin::initialize(const QStringList arguments, QString *errorMessage) // 1. æ³¨å†Œ MimeTypes // 2. åˆå§‹åŒ–ä¸»é¢˜ (Theme) // 3. åˆå§‹åŒ–åŠ¨ä½œç®¡ç†å™¨ new ActionManager(this); // 4. åˆ›å»ºä¸»çª—å£ m_mainWindow = new MainWindow; m_mainWindow-init(errorMessage); return true; 7. UI æ‰©å±•æœºåˆ¶ï¼šèœå•ä¸åŠ¨ä½œQt Creator å°† UI å…ƒç´ ï¼ˆèœå•ã€å·¥å…·æ ï¼‰æŠ½è±¡ä¸ºå¯ç”±ä»»æ„æ’ä»¶æ‰©å±•çš„ç³»ç»Ÿã€‚ 7.1 Action ç³»ç»Ÿç±»å›¾classDiagram class ActionManager +createMenuBar() +registerAction() +actionContainer() class ActionContainer +addMenu() +addAction() class MenuBarActionContainer +menuBar() ActionManager .. ActionContainer : Creates ActionContainer |-- MenuBarActionContainer ActionContainer |-- MenuActionContainer ActionManager -- MainWindow : Manages 7.2 æ‰©å±•èœå•æ å®æˆ˜ä»»æ„æ’ä»¶éƒ½å¯ä»¥é€šè¿‡ ActionManager å‘ä¸»èœå•æ·»åŠ å†…å®¹ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç ã€‚ æ­¥éª¤ 1ï¼šè·å–åˆ›å»ºèœå•å®¹å™¨ // è·å–â€œæ–‡ä»¶â€èœå•å®¹å™¨ActionContainer *mfile = ActionManager::actionContainer(Constants::M_FILE); æ­¥éª¤ 2ï¼šå®šä¹‰ Action å¹¶æ³¨å†Œå‘½ä»¤ // åˆ›å»ºæ ‡å‡†çš„ QActionQAction *m_openAction = new QAction(tr(Open...), this);// æ³¨å†Œä¸º Command (ç®¡ç†å¿«æ·é”®ç­‰)Command *cmd = ActionManager::registerAction(m_openAction, Constants::OPEN);cmd-setDefaultKeySequence(QKeySequence::Open); æ­¥éª¤ 3ï¼šæ·»åŠ åˆ°èœå• // å°† Command æ·»åŠ åˆ°èœå•å®¹å™¨mfile-addAction(cmd, Constants::G_FILE_OPEN); 8. åº”ç”¨ç¨‹åºå¯åŠ¨æµç¨‹ (Main Entry)main.cpp ä¸²è”äº†æ•´ä¸ªåŠ è½½è¿‡ç¨‹ã€‚ 8.1 å¯åŠ¨åºåˆ— ç¯å¢ƒé…ç½®ï¼šåˆå§‹åŒ– QSettingsï¼ˆå…¨å±€ä¸ç”¨æˆ·é…ç½®ï¼‰ã€‚ æ’ä»¶ç®¡ç†å™¨é…ç½®ï¼šè®¾ç½®æ’ä»¶æœç´¢è·¯å¾„ (setPluginPaths) å’Œ IID æ ¡éªŒã€‚ åŠ è½½æ’ä»¶ï¼šæ‰§è¡Œ PluginManager::loadPlugins()ã€‚ å®¹é”™æ£€æŸ¥ï¼š æ£€æŸ¥ Core æ’ä»¶æ˜¯å¦åŠ è½½æˆåŠŸã€‚ æ£€æŸ¥æ˜¯å¦æœ‰æœªæ•è·çš„æ’ä»¶é”™è¯¯ã€‚ // main.cpp ä¼ªä»£ç int main(int argc, char *argv[]) // ... é…ç½®åˆå§‹åŒ– PluginManager pluginManager; PluginManager::setPluginPaths(pluginPaths); // æ ¸å¿ƒåŠ è½½æ­¥éª¤ PluginManager::loadPlugins(); // æ ¸å¿ƒæ’ä»¶å¿…é¡»å­˜åœ¨ä¸”æ— é”™è¯¯ PluginSpec *core = ...; if (!core || core-hasError()) displayError(Could not load Core plugin); return 1; // ... è¿›å…¥äº‹ä»¶å¾ªç¯ return app.exec(); 9. æ‰©å±•è¯é¢˜: æ’ä»¶ç³»ç»Ÿæ¶æ„å¯¹æ¯”ä¸ºäº†æ›´æ·±å…¥ç†è§£ Qt Creator çš„è®¾è®¡å“²å­¦ï¼Œæˆ‘ä»¬å°†å…¶ä¸æµè¡Œçš„ VS Code æ’ä»¶ç³»ç»Ÿåšä¸€å¯¹æ¯”ã€‚ ç‰¹æ€§ Qt Creator VS Code è¯­è¨€ C++ (Native) JavaScriptTypeScript (Web) è¿è¡Œæ¨¡å‹ å…±äº«è¿›ç¨‹ç©ºé—´ (DLL) ç‹¬ç«‹è¿›ç¨‹ (Extension Host) é€šä¿¡æœºåˆ¶ ç›´æ¥æŒ‡é’ˆè°ƒç”¨ ä¿¡å·æ§½ IPC RPC æ€§èƒ½ æé«˜ (ç”±äºæ˜¯åŸç”Ÿè°ƒç”¨) ç•¥ä½ (å— IPC é™åˆ¶) ç¨³å®šæ€§ æ’ä»¶å´©æºƒå¯èƒ½å¯¼è‡´ IDE å´©æºƒ æ’ä»¶å´©æºƒä¸å½±å“ä¸»ç¨‹åº UI æ‰©å±• ActionManager QWidget æ·±åº¦é›†æˆ å—é™å£°æ˜å¼ UI (Tree View, Webview) 9.1 è®¾è®¡å“²å­¦å·®å¼‚ Qt Creator å€¾å‘äºæ€§èƒ½å’Œæ§åˆ¶åŠ›ã€‚ç”±äºæ˜¯ C++ IDEï¼Œå®ƒéœ€è¦å¤„ç†å¤§é‡ç¬¦å·å’Œç´¢å¼•ï¼ŒåŸç”Ÿæ’ä»¶æä¾›äº†æœ€é«˜çš„æ•ˆç‡ã€‚ä½†è¿™ä¹Ÿè¦æ±‚æ’ä»¶å¼€å‘è€…å…·å¤‡è¾ƒé«˜çš„ C++ æ°´å¹³ï¼Œä¸”æ’ä»¶å¼‚å¸¸å¯èƒ½å¯¼è‡´æ•´ä¸ª IDE ä¸ç¨³å®šã€‚ VS Code å€¾å‘äºç¨³å®šæ€§å’Œéš”ç¦»æ€§ã€‚é€šè¿‡å°†æ‰©å±•è¿è¡Œåœ¨ç‹¬ç«‹è¿›ç¨‹ä¸­ï¼Œä¿è¯äº†ä¸»ç•Œé¢çš„å“åº”é€Ÿåº¦ï¼Œå³ä½¿æŸä¸ªæ‰©å±•å¡æ­»ä¹Ÿä¸ä¼šæ‹–å®ç•Œé¢ã€‚ 10. æ€»ç»“Qt Creator çš„æ’ä»¶ç³»ç»Ÿå±•ç¤ºäº†ä¼˜ç§€çš„è½¯ä»¶æ¶æ„åŸåˆ™ï¼š æ¨¡å—åŒ–ï¼šä¸€åˆ‡çš†æ’ä»¶ï¼ŒèŒè´£è¾¹ç•Œæ¸…æ™°ã€‚ å¯æ‰©å±•ï¼šé€šè¿‡ ActionManager å’Œå¯¹è±¡æ± ï¼Œæ’ä»¶å¯ä»¥è½»æ¾æ‰©å±•ä¸»ç¨‹åºåŠŸèƒ½ã€‚ ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šç²¾ç»†çš„åŠ è½½é˜¶æ®µæ§åˆ¶è§£å†³äº†å¤æ‚çš„ä¾èµ–åˆå§‹åŒ–é—®é¢˜ã€‚ ç†è§£è¿™ä¸€å¥—æœºåˆ¶ï¼Œä¸ä»…æœ‰åŠ©äºå¼€å‘ Qt Creator æ’ä»¶ï¼Œå¯¹è®¾è®¡è‡ªå·±çš„å¤§å‹ Qt åº”ç”¨ç¨‹åºæ¶æ„ä¹Ÿæœ‰æé«˜çš„å‚è€ƒä»·å€¼ã€‚ å‚è€ƒæ¥æº QLibrary åŠ è½½åŠ¨æ€åº“åŸç†ï¼šQt Documentation - QLibrary å­—ç¬¦ä¸²å®å®šä¹‰æŠ€å·§ï¼šqmake å¥‡æ·«æŠ€å·§ Qt Creator æºç ä»“åº“ï¼šCode.qt.io"},{"title":"Qtäº¤å‰ç¼–è¯‘åARMæ¿å¯åŠ¨é…ç½®","path":"/2025/05/21/3-å¼€å‘æ¡†æ¶-Qt-Qtäº¤å‰ç¼–è¯‘åARMæ¿å¯åŠ¨é…ç½®/","content":"æœ¬æ¬¡ç§»æ¤å®Œè¿è¡Œçš„ç¨‹åºç•Œé¢ Qt ç¼–å†™å¥½çš„ç¨‹åºåœ¨ linux ç¯å¢ƒä¸­äº¤å‰ç¼–è¯‘å®Œï¼Œåœ¨å¼€å‘æ¿ä¸­çš„ä¸€äº›åˆ—ç¯å¢ƒå˜é‡çš„é…ç½®æ­¥éª¤å¦‚ä¸‹ æ¶‰åŠåˆ°çš„è„šæœ¬è§é™„å½• 1. åœ¨å¼€å‘æ¿ä¸­å»ºç«‹å·¥ç¨‹ç›®å½•mkdir QtProgram 2. æ·»åŠ ç¯å¢ƒå˜é‡ å°†å¯åŠ¨è„šæœ¬æ”¾å…¥ 1 ä¸­å»ºç«‹çš„ç›®å½•ä¸­ï¼Œå³ start_qt.sh å°† qt4-dev è„šæœ¬æ”¾å…¥etc ç›®å½•ä¸­ï¼Œå¹¶åŠ å…¥åˆ°ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ä¸­æ¥ æ·»åŠ å‘½ä»¤ å®Œæˆä¸Šè¿°å‘½ä»¤åé‡æ–°è¥¿ä¸œç³»ç»Ÿ(æ‰§è¡Œ reboot å³å¯) è§£å‹ä» ubuntu ç¼–è¯‘å®Œæˆçš„åŠ¨æ€åº“ï¼ŒæŒ‰ç…§é»˜è®¤è§£å‹è·¯å¾„å³å¯ è§£å‹åä¼šçœ‹åˆ°å¦‚ä¸‹ç»“æ„ å¯åŠ¨è‡ªå·±çš„ Qt ç¨‹åº è¿›å…¥ 1 ä¸­å»ºç«‹çš„ç›®å½•ï¼Œåªéœ€è¦æ‰§è¡Œå¯åŠ¨è„šæœ¬å³å¯ è®¾ç½®å¼€æœºå¯åŠ¨é…ç½®æ–‡ä»¶ qt4.d æ‹·è´åˆ°å¦‚ä¸‹ç›®å½•ä¸­: åœ¨æ‰“å¼€çš„æ–‡ä»¶æœ«å°¾æ·»åŠ å¦‚ä¸‹å¯åŠ¨é…ç½®ï¼Œå³å¯å¼€æœºå¯åŠ¨ï¼Œè¿™é‡Œå…³é—­äº†å‹å–„æ”¯è‡‚è‡ªå¸¦çš„ qtopia ç³»ç»Ÿï¼Œä¸ºäº†ä½¿è¯¥ç³»ç»Ÿå’Œè‡ªå·±çš„ Qt ç¨‹åºè§¦æ‘¸äº§ç”Ÿå½±å“ï¼Œæ•…è¿™é‡Œç¦æ­¢å¯åŠ¨ åœ¨ qt4.d è„šæœ¬æ–‡ä»¶æœ€åï¼Œæ˜¯è‡ªå·±ç¨‹åºå¯åŠ¨çš„è„šæœ¬ Qt ç¨‹åºå­˜æ”¾ç›®å½•ç»“æ„ 3. ä¸€äº›å¯åŠ¨è„šæœ¬qt4_env #!/bin/shif [ -c /dev/input/event0 ]; then INPUT_PATH=/dev/inputelse INPUT_PATH=/devfiexport TSLIB_TSDEVICE=/dev/input/event1export TSLIB_CONFFILE=/etc/ts.confexport TSLIB_PLUGINDIR=/lib/tsexport TSLIB_CALIBFILE=/etc/pointercalexport QTDIR=/usr/local/Trolltech/QtEmbedded-4.8.6-arm/export PATH=$QTDIR/bin:$PATHexport LD_LIBRARY_PATH=$QTDIR/libexport QWS_MOUSE_PROTO=Tslib:$INPUT_PATH/event1#export QWS_MOUSE_PROTO=Tslib:$INPUT_PATH/event1 MouseMan:$INPUT_PATH/mouse1export QWS_KEYBOARD=TTY:/dev/tty1#sync font size with QtDesigner export QWS_DISPLAY=LinuxFB:mmWidth200:0#export QWS_SIZE=480x272export KDEDIR=/opt/kdeexport HOME=/root qt4.d #!/bin/shsource /etc/qt4_envif [ -f etc/pointercal ];then echo use exist pointercal file ...else echo touch screen to create pointercal file ... /bin/ts_calibratefi# if you want run qt4 app at booting system,just add the command line below start_qt.sh #!/bin/shif [ -e /etc/friendlyarm-ts-input.conf ] ; then . /etc/friendlyarm-ts-input.conffitrue $TSLIB_TSDEVICE:=/dev/touchscreenif grep -Ei \\ctp=(1|2|3)\\ /proc/cmdline /dev/null; then TSLIB_CONFFILE=/etc/ts-mt.conf echo -27 13757 -2071768 -9105 -32 34531248 65536 800 480 \\ /etc/pointercal syncelse TSLIB_CONFFILE=/etc/ts.conffiexport TSLIB_TSDEVICEexport TSLIB_CONFFILEexport TSLIB_PLUGINDIR=/usr/lib/tsexport TSLIB_CALIBFILE=/etc/pointercalexport QWS_DISPLAY=:1export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATHexport PATH=/bin:/sbin:/usr/bin/:/usr/sbin:/usr/local/binexport QWS_MOUSE_PROTO=Tslib MouseMan:/dev/input/miceif [ -c $TSLIB_TSDEVICE ]; then if [ ! -s /etc/pointercal ] ; then rm /etc/pointercal /usr/bin/ts_calibrate fielse export QWS_MOUSE_PROTO=MouseMan:/dev/input/micefiexport QTAPP=$PWDexport QTDIR=/usr/local/Trolltech/QtEmbedded-4.8.6-arm/export PATH=$QRDIR/bin:$PATHexport LD_LIBRARY=$QTDIR/libexport QWS_DISPLAY=LinuxFB:mmWidth200:0export QWS_KEYBOARD=TTY:/dev/tty1export KDEDIR=/opt/kdeexport HOME=/root/QtProgram/WifiCarV2 -qws å‚è€ƒæ–‡ç« åœ°å€ï¼š(guoyifei) å‚è€ƒåœ°å€ ä½œè€…:é¹…åµçŸ³æ—¶é—´:2014å¹´9æœˆ11æ—¥22:16:01ç‰ˆæœ¬:V 0.0.1é‚®ç®±:kevinlq@yeah.netç‰ˆæƒ:æœ¬åšå®¢è‹¥æ— ç‰¹åˆ«å£°æ˜ï¼Œå‡å±äºä½œè€…åŸåˆ›æ–‡ç« ï¼Œæ¬¢è¿å¤§å®¶è½¬è½½åˆ†äº«ã€‚ä½†æ˜¯ï¼Œå¸Œæœ›æ‚¨æ³¨æ˜æ¥æºï¼Œå¹¶ç•™ä¸‹åŸæ–‡åœ°å€ï¼Œè¿™æ˜¯å¯¹ä½œè€…æœ€å¤§çš„å°Šé‡ï¼Œä¹Ÿæ˜¯å¯¹çŸ¥è¯†çš„å°Šé‡ã€‚ å¦‚æœæ‚¨å¯¹æœ¬æ–‡æœ‰ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹ç•™è¨€ï¼Œæˆ–è€… Email æˆ‘. æèµ  å¦‚æœè§‰å¾—åˆ†äº«çš„å†…å®¹ä¸é”™ï¼Œå¯ä»¥è¯·ä½œè€…å–æ¯å’–å•¡.","categories":["3.å¼€å‘æ¡†æ¶","Qt"]},{"title":"Qt5.4.2ç§»æ¤åˆ°ARMå¼€å‘æ¿ä¸Š","path":"/2025/05/21/3-å¼€å‘æ¡†æ¶-Qt-Qt5-4-2ç§»æ¤åˆ°ARMå¼€å‘æ¿ä¸Š/","content":"Qt5.4.2 ç§»æ¤åˆ° ARM å¹³å°é…ç½®æ–‡ä»¶ä¿®æ”¹qmake.config æ–‡ä»¶ ## qmake configuration for building with arm-linux-gnueabi-g++#MAKEFILE_GENERATOR = UNIXCONFIG += incrementalQMAKE_INCREMENTAL_STYLE = sublib#add ä¸‹é¢æ—¶è‡ªå·±ä¿®æ”¹æ·»åŠ çš„å†…å®¹QT_QPA_DEFAULT_PLATFORM = linuxfb#QT_QPA_PLATFORM=linuxfb:fb=/dev/fb0QMAKE_CFLAGS_RELEASE += -O2 -march=armv7-aQMAKE_CXXFLAGS_RELEASE += -O2 -march=armv7-ainclude(../common/linux.conf)include(../common/gcc-base-unix.conf)include(../common/g++-unix.conf)# modifications to g++.confQMAKE_CC = arm-linux-gccQMAKE_CXX = arm-linux-g++QMAKE_LINK = arm-linux-g++QMAKE_LINK_SHLIB = arm-linux-g++# modifications to linux.confQMAKE_AR = arm-none-linux-gnueabi-ar cqsQMAKE_OBJCOPY = arm-none-linux-gnueabi-objcopyQMAKE_NM = arm-none-linux-gnueabi-nm -PQMAKE_STRIP = arm-none-linux-gnueabi-stripload(qt_config) ç¼–è¯‘é…ç½®è„šæœ¬!/bin/bash#INSTALL_PATH=/usr/local/Trolltech/QtEmbedded-5.4.2-arm/./configure -v \\ -prefix /usr/local/Trolltech/QtEmbedded-5.4.2-arm \\ -release \\ -make libs \\ -xplatform linux-arm-gnueabi-g++\\ -optimized-qmake \\ -pch \\ -qt-sql-sqlite \\ -qt-zlib \\ -qt-libjpeg \\ -qt-libpng \\ -qt-zlib \\ -tslib \\ -no-opengl\\ -no-sse2 \\ -no-openssl \\ -no-nis \\ -no-cups \\ -no-glib \\ -no-dbus \\ -no-xcb \\ -no-xcursor -no-xfixes -no-xrandr -no-xrender \\ -no-separate-debug-info \\ -nomake examples -nomake tools -nomake tests -no-iconv make -j4 sudo -s make install å‡ºç°çš„é”™è¯¯ the specified systemcompiler is nor supported åŸå› æ˜¯è·¯å¾„å†™é”™äº† é‡æ–°èµ‹äºˆ QMAKESPEC è·¯å¾„(Qt æºç è·¯å¾„) arm-linux-gcc:Command not found è¿™ä¸ªé”™è¯¯å¾ˆæ˜¯æ— å˜å¤´ï¼Œç¼–è¯‘å™¨ç¯å¢ƒæ˜¯è®¾ç½®å¥½çš„ï¼Œç»ˆç«¯è¾“å…¥ arm-linux-gcc -v ä¹Ÿèƒ½æ˜¾ç¤ºå¯¹åº”ç‰ˆæœ¬ï¼Œæ¯æ¬¡ç¼–è¯‘å°±ä¼šå‡ºç°è¿™ä¸ªå¥‡è‘©çš„é”™è¯¯ æ—¢ç„¶äººå®¶æé†’ä½ æ‰¾ä¸åˆ°ï¼Œé‚£è‚¯å®šæ˜¯æ²¡æœ‰é…ç½®å¥½ï¼Œåˆ†æäº†ä¸‹å› ä¸ºæˆ‘çš„ç¯å¢ƒå˜é‡é…ç½®åœ¨äº† kevin ç”¨æˆ·ä¸‹ï¼Œæˆ‘æ‰§è¡Œç¼–è¯‘è„šæœ¬ä½¿ç”¨ sudoï¼Œroot ç”¨æˆ·æ‰¾ä¸åˆ°ï¼Œ æƒ³åˆ°è¿™é‡Œé‡æ–°é…ç½®äº†ä¸‹æœç„¶è§£å†³äº† webkit ç¼–è¯‘é—®é¢˜webkit æ˜¯ä¸ªæ¯”è¾ƒéš¾å•ƒçš„éª¨å¤´ï¼Œç¼–è¯‘æ€»æ˜¯å¤±è´¥ï¼Œæ™šä¸Šä¼šå®¶ç”¨å®¶é‡Œçš„ç”µè„‘è¯•äº†ä¸‹ä¹Ÿæ˜¯ä¸è¡Œï¼Œçœ‹æ¥è¿˜å¾—å¥½å¥½ç ”ç©¶ä¸‹äº† å¦‚æœæ‚¨å¯¹æœ¬æ–‡æœ‰ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹ç•™è¨€ï¼Œæˆ–è€… Email æˆ‘ å¾®ä¿¡å…¬ä¼—å·ï¼šdevstoneï¼Œæ‰«æäºŒç»´ç ç›´æ¥å…³æ³¨","categories":["3.å¼€å‘æ¡†æ¶","Qt"]},{"title":"Qt å®¹å™¨ä¸ QVariant å®Œå…¨æŒ‡å—","path":"/2025/05/21/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qt-å®¹å™¨/","content":"Qt å®¹å™¨ä¸ QVariant å®Œå…¨æŒ‡å—Qt å®¹å™¨ç±»ç›¸æ¯” STL å®¹å™¨æ›´è½»é‡ã€æ›´å®‰å…¨ï¼Œå…·å¤‡éšå¼æ•°æ®å…±äº«ã€å¹³å°æ— å…³æ€§å’Œçº¿ç¨‹å®‰å…¨ç‰¹æ€§ã€‚æœ¬æ–‡ä»å®¹å™¨ç±»å‹ã€è¿­ä»£å™¨åˆ° QVariant ç±»å‹ç³»ç»Ÿï¼Œæä¾›å®Œæ•´çš„æŠ€æœ¯å‚è€ƒã€‚ ä¸€ã€Qt å®¹å™¨æ¦‚è¿°1.1 æ ¸å¿ƒç‰¹æ€§Qt å®¹å™¨ä¸ STL å®¹å™¨çš„ä¸»è¦åŒºåˆ«ï¼š ç‰¹æ€§ Qt å®¹å™¨ STL å®¹å™¨ éšå¼æ•°æ®å…±äº« æ”¯æŒï¼ˆå†™æ—¶å¤åˆ¶ï¼‰ ä¸æ”¯æŒ å¹³å°ä¸€è‡´æ€§ æ‰€æœ‰å¹³å°è¡Œä¸ºä¸€è‡´ å¯èƒ½ä¾èµ–ç¼–è¯‘å™¨å®ç° çº¿ç¨‹å®‰å…¨ åªè¯»æ“ä½œçº¿ç¨‹å®‰å…¨ éœ€æ‰‹åŠ¨åŒæ­¥ å†…å­˜æ•ˆç‡ é’ˆå¯¹å¸¸è§åœºæ™¯ä¼˜åŒ– é€šç”¨å®ç° éšå¼æ•°æ®å…±äº«ï¼ˆå†™æ—¶å¤åˆ¶ï¼‰ï¼š å®¹å™¨ä½œä¸ºå‚æ•°ä¼ é€’æ—¶ä»…å¤åˆ¶æŒ‡é’ˆï¼Œå®é™…æ•°æ®åœ¨ä¿®æ”¹æ—¶æ‰å¤åˆ¶ã€‚è¿™æ¶ˆé™¤äº†ä¼ å€¼çš„æ€§èƒ½é¡¾è™‘ã€‚ 1.2 é¡ºåºå®¹å™¨flowchart LR subgraph é¡ºåºå®¹å™¨ A[QList] -- B[æ•°ç»„å®ç°br/å¿«é€Ÿè¿½åŠ ] C[QVector] -- D[è¿ç»­å†…å­˜br/éšæœºè®¿é—®] E[QLinkedList] -- F[é“¾è¡¨å®ç°br/å¿«é€Ÿæ’å…¥åˆ é™¤] G[QStack] -- H[LIFO åè¿›å…ˆå‡º] I[QQueue] -- J[FIFO å…ˆè¿›å…ˆå‡º] end å®¹å™¨ åº•å±‚å®ç° é€‚ç”¨åœºæ™¯ æ€§èƒ½ç‰¹ç‚¹ QListT æŒ‡é’ˆæ•°ç»„ é€šç”¨åˆ—è¡¨ã€æœ«å°¾è¿½åŠ  å¤´å°¾è¿½åŠ  O(1)ï¼Œä¸­é—´æ’å…¥ O(n) QVectorT è¿ç»­æ•°ç»„ éšæœºè®¿é—®ã€æ•°å€¼è®¡ç®— éšæœºè®¿é—® O(1)ï¼Œæ’å…¥ O(n) QLinkedListT åŒå‘é“¾è¡¨ é¢‘ç¹ä¸­é—´æ’å…¥åˆ é™¤ æ’å…¥åˆ é™¤ O(1)ï¼Œè®¿é—® O(n) QStackT ç»§æ‰¿è‡ª QVector æ’¤é”€é‡åšã€é€’å½’æ¨¡æ‹Ÿ pushpop O(1) QQueueT ç»§æ‰¿è‡ª QList ä»»åŠ¡é˜Ÿåˆ—ã€æ¶ˆæ¯ç¼“å†² enqueuedequeue O(1) ã€è¡¥å……ã€‘Qt 5.15+ å»ºè®®ï¼š QList åœ¨ Qt 6 ä¸­æˆä¸º QVector çš„åˆ«åï¼Œä¸¤è€…ç»Ÿä¸€ä¸ºè¿ç»­å†…å­˜å­˜å‚¨ã€‚æ–°é¡¹ç›®å¯ç›´æ¥ä½¿ç”¨ QListã€‚ 1.3 å…³è”å®¹å™¨ å®¹å™¨ åº•å±‚å®ç° é”®è¦æ±‚ é€‚ç”¨åœºæ™¯ QMapK, V çº¢é»‘æ ‘ æä¾› operator() æœ‰åºéå†ã€èŒƒå›´æŸ¥è¯¢ QHashK, V å“ˆå¸Œè¡¨ æä¾› operator==() å’Œ qHash() å¿«é€ŸæŸ¥æ‰¾ã€é¡ºåºæ— å…³ QMultiMapK, V çº¢é»‘æ ‘ åŒ QMap ä¸€é”®å¤šå€¼ã€æœ‰åºå­˜å‚¨ QMultiHashK, V å“ˆå¸Œè¡¨ åŒ QHash ä¸€é”®å¤šå€¼ã€å¿«é€ŸæŸ¥æ‰¾ QSetT å“ˆå¸Œè¡¨ æä¾› operator==() å’Œ qHash() å”¯ä¸€å…ƒç´ é›†åˆ æ€§èƒ½å¯¹æ¯”ï¼š æ“ä½œ QMap QHash æŸ¥æ‰¾ O(log n) O(1) å¹³å‡ æ’å…¥ O(log n) O(1) å¹³å‡ æœ‰åºéå† æ”¯æŒ ä¸æ”¯æŒ é€‰æ‹©åŸåˆ™ï¼š éœ€è¦æœ‰åºéå†æˆ–èŒƒå›´æŸ¥è¯¢æ—¶é€‰ QMapï¼Œå¦åˆ™ä¼˜å…ˆé€‰ QHash ä»¥è·å¾—æ›´å¿«çš„æŸ¥æ‰¾é€Ÿåº¦ã€‚ 1.4 å®¹å™¨åµŒå¥—Qt å®¹å™¨æ”¯æŒä»»æ„å±‚çº§åµŒå¥—ï¼š QHashQString, QListdouble dataMap; // é”®ä¸ºå­—ç¬¦ä¸²ï¼Œå€¼ä¸ºæµ®ç‚¹æ•°åˆ—è¡¨ ã€ä¿®æ­£ã€‘C++11 å…¼å®¹æ€§ï¼š C++11 åŠä»¥åæ ‡å‡†å·²æ”¯æŒ è¿ç»­ä¹¦å†™ï¼Œæ— éœ€åœ¨æ¨¡æ¿å‚æ•°é—´æ’å…¥ç©ºæ ¼ã€‚Qt 5+ é¡¹ç›®å¯ç›´æ¥ä½¿ç”¨ QListQListint è¯­æ³•ã€‚ äºŒã€å®¹å™¨è¿­ä»£å™¨Qt æä¾›ä¸¤ç§è¿­ä»£å™¨é£æ ¼ï¼Œå„æœ‰é€‚ç”¨åœºæ™¯ã€‚ 2.1 STL é£æ ¼è¿­ä»£å™¨STL é£æ ¼è¿­ä»£å™¨è‡ª Qt 2.0 å¼•å…¥ï¼Œä¸æ ‡å‡†åº“æ¥å£å…¼å®¹ï¼Œæ€§èƒ½æœ€ä¼˜ã€‚ è¿­ä»£å™¨ç±»å‹å±‚æ¬¡ï¼š è¿­ä»£å™¨ç±»å‹ èƒ½åŠ› ä»£è¡¨å®¹å™¨ è¾“å…¥è¿­ä»£å™¨ åªè¯»ã€å•å‘ æµå¼æ•°æ® è¾“å‡ºè¿­ä»£å™¨ åªå†™ã€å•å‘ è¾“å‡ºæµ å‰å‘è¿­ä»£å™¨ è¯»å†™ã€å•å‘ã€å¯å¤šæ¬¡éå† QLinkedList åŒå‘è¿­ä»£å™¨ è¯»å†™ã€åŒå‘ç§»åŠ¨ QMap, QHash éšæœºè®¿é—®è¿­ä»£å™¨ è¯»å†™ã€ä»»æ„è·³è½¬ QList, QVector éå†ä¸ä¿®æ”¹ç¤ºä¾‹ï¼š QVectorint vec = 1, 2, 3, 4, 5;for (QVectorint::iterator it = vec.begin(); it != vec.end(); ++it) *it *= 2; // â† ç›´æ¥ä¿®æ”¹å…ƒç´ // vec = 2, 4, 6, 8, 10 åªè¯»éå†ï¼ˆæ¨èï¼‰ï¼š const QMapQString, int map = getDataMap();for (QMapQString, int::const_iterator it = map.constBegin(); it != map.constEnd(); ++it) qDebug() it.key() : it.value(); 2.2 Java é£æ ¼è¿­ä»£å™¨Java é£æ ¼è¿­ä»£å™¨è‡ª Qt 4 å¼•å…¥ï¼ŒAPI æ›´ç®€æ´ï¼Œä½†æ•ˆç‡ç•¥ä½äº STL é£æ ¼ã€‚ è®¾è®¡ç‰¹ç‚¹ï¼š è¿­ä»£å™¨ä½äºå…ƒç´ ä¹‹é—´ï¼Œè€ŒéæŒ‡å‘å…ƒç´ æœ¬èº«ã€‚ flowchart LR A[| A | B | C | D |] B[â†‘] -- C[è¿­ä»£å™¨ä½ç½®] style A fill:#f9f9f9 å¸¸ç”¨ç±»å‹ï¼š Java é£æ ¼ å¯¹åº”å®¹å™¨ å¯å˜ç‰ˆæœ¬ QListIteratorT QList QMutableListIteratorT QMapIteratorK,V QMap QMutableMapIteratorK,V QHashIteratorK,V QHash QMutableHashIteratorK,V ç¤ºä¾‹ï¼šéå† QList QListQString list = Apple, Banana, Cherry;QListIteratorQString it(list);while (it.hasNext()) qDebug() it.next(); // next() è¿”å›å½“å‰å…ƒç´ å¹¶å‰è¿› 2.3 èŒƒå›´ for å¾ªç¯ä¸ foreachC++11 èŒƒå›´ forï¼ˆæ¨èï¼‰ï¼š QStringList list = A, B, C;for (const QString str : list) qDebug() str; Qt foreach å®ï¼š foreach (const QString str, list) qDebug() str; ã€è¡¥å……ã€‘Qt 5.7+ å»ºè®®ï¼š ä¼˜å…ˆä½¿ç”¨ C++11 èŒƒå›´ for å¾ªç¯ï¼Œforeach å®åœ¨ Qt 6 ä¸­å·²æ ‡è®°ä¸ºåºŸå¼ƒã€‚èŒƒå›´ for æ€§èƒ½æ›´ä¼˜ä¸”è¯­æ³•æ ‡å‡†åŒ–ã€‚ ä¸‰ã€è¿­ä»£å™¨æœ€ä½³å®è·µ3.1 è¿­ä»£æ–¹å¼é€‰æ‹© éœ€æ±‚ æ¨èæ–¹å¼ ä¼˜ç‚¹ ç¼ºç‚¹ ç®€æ´åªè¯»éå† èŒƒå›´ for è¯­æ³•ç®€æ´ã€æ€§èƒ½å¥½ æ— æ³•ä¿®æ”¹å…ƒç´  é«˜æ•ˆè¯»å†™æ“ä½œ STL è¿­ä»£å™¨ æœ€é«˜æ•ˆã€å…¼å®¹ STL ç®—æ³• è¯­æ³•ç•¥å¤æ‚ è¾¹éå†è¾¹åˆ é™¤ STL è¿­ä»£å™¨ + erase å®‰å…¨åˆ é™¤ éœ€æ‰‹åŠ¨ç®¡ç†è¿­ä»£å™¨ API ç®€æ´ä¼˜å…ˆ Java è¿­ä»£å™¨ æ˜“äºç†è§£ æ•ˆç‡è¾ƒä½ 3.2 éå†æ—¶åˆ é™¤å…ƒç´ é”™è¯¯ç¤ºä¾‹ï¼ˆè¿­ä»£å™¨å¤±æ•ˆï¼‰ï¼š // âŒ åˆ é™¤åè¿­ä»£å™¨å¤±æ•ˆï¼Œå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºfor (auto it = map.begin(); it != map.end(); ++it) if (it.value() == remove) map.remove(it.key()); // â† it å·²å¤±æ•ˆ æ­£ç¡®æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ erase è¿”å›å€¼ // âœ“ erase è¿”å›ä¸‹ä¸€ä¸ªæœ‰æ•ˆè¿­ä»£å™¨for (auto it = map.begin(); it != map.end(); ) if (it.value() == remove) it = map.erase(it); // â† è·å–æ–°çš„æœ‰æ•ˆè¿­ä»£å™¨ else ++it; æ­£ç¡®æ–¹æ¡ˆäºŒï¼šæ”¶é›†ååˆ é™¤ // âœ“ å…ˆæ”¶é›†å¾…åˆ é™¤çš„é”®ï¼Œå†ç»Ÿä¸€åˆ é™¤QStringList keysToRemove;for (auto it = map.begin(); it != map.end(); ++it) if (it.value() == remove) keysToRemove it.key(); for (const QString key : keysToRemove) map.remove(key); 3.3 è¿­ä»£å™¨å¤±æ•ˆè§„åˆ™ æ“ä½œ QListQVector QMapQHash QLinkedList æ’å…¥ æ‰€æœ‰è¿­ä»£å™¨å¤±æ•ˆ å…¶ä»–è¿­ä»£å™¨æœ‰æ•ˆ å…¶ä»–è¿­ä»£å™¨æœ‰æ•ˆ åˆ é™¤ è¢«åˆ åŠä¹‹åå¤±æ•ˆ ä»…è¢«åˆ å…ƒç´ å¤±æ•ˆ ä»…è¢«åˆ å…ƒç´ å¤±æ•ˆ æ’åº æ‰€æœ‰è¿­ä»£å™¨å¤±æ•ˆ NA æ‰€æœ‰è¿­ä»£å™¨å¤±æ•ˆ å®‰å…¨åŸåˆ™ï¼š ä¿®æ”¹å®¹å™¨åï¼Œå‡è®¾æ‰€æœ‰ç°æœ‰è¿­ä»£å™¨å‡å·²å¤±æ•ˆï¼Œé‡æ–°è·å–è¿­ä»£å™¨ã€‚ å››ã€QVariant ç±»å‹ç³»ç»ŸQVariant æ˜¯ Qt çš„é€šç”¨ç±»å‹å®¹å™¨ï¼Œå¯å­˜å‚¨ä»»æ„ Qt æ”¯æŒçš„ç±»å‹ï¼Œå¹¿æ³›ç”¨äºå±æ€§ç³»ç»Ÿã€æ•°æ®åº“æ“ä½œå’Œä¿¡å·æ§½å‚æ•°ä¼ é€’ã€‚ 4.1 è®¾è®¡åŠ¨æœºC++ union ç¦æ­¢åŒ…å«å…·æœ‰éé»˜è®¤æ„é€ å‡½æ•°æˆ–ææ„å‡½æ•°çš„ç±»å‹ã€‚è‹¥æ²¡æœ‰ QVariantï¼Œä»¥ä¸‹åœºæ™¯å°†éš¾ä»¥å®ç°ï¼š QObject::property() å±æ€§ç³»ç»Ÿ æ•°æ®åº“å­—æ®µå€¼å­˜å– ä¿¡å·æ§½è·¨ç±»å‹å‚æ•°ä¼ é€’ 4.2 åŸºæœ¬ä½¿ç”¨å­˜å‚¨ä¸è½¬æ¢ï¼š QVariant v(123); // å­˜å‚¨ intint x = v.toInt(); // x = 123v = QVariant(hello); // å­˜å‚¨ QByteArrayv = QVariant(tr(hello)); // å­˜å‚¨ QStringint y = v.toInt(); // y = 0ï¼ˆæ— æ³•è½¬æ¢è¿”å›é»˜è®¤å€¼ï¼‰QString s = v.toString(); // s = hello ç±»å‹æ£€æŸ¥ä¸è½¬æ¢ï¼š QVariant v = 42;if (v.canConvertQString()) QString str = v.toString(); // 42qDebug() v.typeName(); // è¾“å‡º int 4.3 å¤æ‚æ•°æ®ç»“æ„QVariant æ”¯æŒåµŒå¥—å®¹å™¨ï¼Œå¯æ„å»ºä»»æ„å¤æ‚çš„æ•°æ®ç»“æ„ï¼š QVariantMap person;person[name] = Alice;person[age] = 30;person[scores] = QVariantList95, 87, 92;// ç­‰ä»·äº JSON: name: Alice, age: 30, scores: [95, 87, 92] æ€§èƒ½æƒè¡¡ï¼š åµŒå¥— QVariant ç»“æ„çµæ´»å¼ºå¤§ï¼Œä½†æ¯”å¼ºç±»å‹å®¹å™¨æ¶ˆè€—æ›´å¤šå†…å­˜ï¼Œç±»å‹æ£€æŸ¥ä¹Ÿåœ¨è¿è¡Œæ—¶è¿›è¡Œã€‚ 4.4 null å€¼è¯­ä¹‰QVariant æ”¯æŒ null å€¼ï¼Œè¡¨ç¤ºâ€æœ‰ç±»å‹ä½†æ— å€¼â€çš„çŠ¶æ€ï¼š QVariant x; // æ— ç±»å‹æ— å€¼QVariant y(QString()); // QString ç±»å‹ï¼Œnull å€¼QVariant z(QString()); // QString ç±»å‹ï¼Œç©ºå­—ç¬¦ä¸²ï¼ˆé nullï¼‰qDebug() x.isNull(); // trueqDebug() y.isNull(); // trueqDebug() z.isNull(); // false äº”ã€QVariant ä¸ GUI ç±»å‹5.1 ç±»å‹è½¬æ¢é™åˆ¶QVariant å±äº Qt Core æ¨¡å—ï¼Œä¸ç›´æ¥æä¾› Qt GUI ç±»å‹ï¼ˆå¦‚ QColorã€QImageã€QPixmapï¼‰çš„è½¬æ¢å‡½æ•°ã€‚ è·å– GUI ç±»å‹å€¼ï¼š QVariant variant = ...;QColor color = variant.valueQColor(); // ä½¿ç”¨æ¨¡æ¿å‡½æ•°// æˆ–QColor color = qvariant_castQColor(variant); å­˜å‚¨ GUI ç±»å‹å€¼ï¼š QColor color = palette().background().color();QVariant variant = color; // â† è‡ªåŠ¨è½¬æ¢ï¼Œæ— éœ€æ˜¾å¼æ„é€  5.2 canConvert ä¸ convert çš„é™·é˜±canConvert() æŠ¥å‘Šçš„æ˜¯ç±»å‹è½¬æ¢çš„æ½œåœ¨èƒ½åŠ›ï¼Œè€Œéå½“å‰æ•°æ®æ˜¯å¦å¯æˆåŠŸè½¬æ¢ã€‚ QVariant v = hello;qDebug() v.canConvertint(); // trueï¼ˆå­—ç¬¦ä¸²åŸåˆ™ä¸Šå¯è½¬ä¸ºæ•´æ•°ï¼‰qDebug() v.toInt(); // 0ï¼ˆå®é™…è½¬æ¢å¤±è´¥ï¼‰v = 42;qDebug() v.toInt(); // 42ï¼ˆæ•°å­—å­—ç¬¦ä¸²è½¬æ¢æˆåŠŸï¼‰ å®‰å…¨è½¬æ¢æ¨¡å¼ï¼š bool ok;int value = variant.toInt(ok);if (ok) // è½¬æ¢æˆåŠŸï¼Œä½¿ç”¨ value else // è½¬æ¢å¤±è´¥ï¼Œå¤„ç†é”™è¯¯ å…­ã€å®¹å™¨é€‰æ‹©é€ŸæŸ¥è¡¨æ ¹æ®ä½¿ç”¨åœºæ™¯å¿«é€Ÿé€‰æ‹©åˆé€‚çš„å®¹å™¨ï¼š åœºæ™¯ æ¨èå®¹å™¨ ç†ç”± é€šç”¨åˆ—è¡¨ã€æœ«å°¾è¿½åŠ  QList Qt 6 ç»Ÿä¸€å®ç°ï¼Œæ€§èƒ½å‡è¡¡ æ•°å€¼è®¡ç®—ã€éšæœºè®¿é—® QVector è¿ç»­å†…å­˜ï¼Œç¼“å­˜å‹å¥½ é¢‘ç¹ä¸­é—´æ’å…¥åˆ é™¤ QLinkedList O(1) æ’å…¥åˆ é™¤ é”®å€¼æŸ¥æ‰¾ï¼ˆæœ‰åºï¼‰ QMap æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€æœ‰åºéå† é”®å€¼æŸ¥æ‰¾ï¼ˆæ— åºï¼‰ QHash O(1) å¹³å‡æŸ¥æ‰¾ å”¯ä¸€å…ƒç´ é›†åˆ QSet O(1) æŸ¥æ‰¾ã€å»é‡ LIFO æ ˆæ“ä½œ QStack pushpop è¯­ä¹‰æ˜ç¡® FIFO é˜Ÿåˆ—æ“ä½œ QQueue enqueuedequeue è¯­ä¹‰æ˜ç¡® åŠ¨æ€ç±»å‹å­˜å‚¨ QVariant é€šç”¨ç±»å‹å®¹å™¨ å‚è€ƒæ¥æº Qt å®˜æ–¹æ–‡æ¡£ - Container Classes Qt å®˜æ–¹æ–‡æ¡£ - QVariant Class Qt å®˜æ–¹æ–‡æ¡£ - Implicit Sharing Qt å®˜æ–¹æ–‡æ¡£ - STL-Style Iterators","tags":["Qt","å®¹å™¨","QList","QMap","QHash","QVariant","è¿­ä»£å™¨","STL"],"categories":["3.å¼€å‘æ¡†æ¶","Qt","Publish"]},{"title":"è¿›ç¨‹é—´é€šä¿¡ æ¶ˆæ¯é˜Ÿåˆ—","path":"/2025/05/10/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-è¿›ç¨‹é—´é€šä¿¡-æ¶ˆæ¯é˜Ÿåˆ—/","content":"æ¦‚è¿° æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå°±æ˜¯ä¸€äº›æ¶ˆæ¯çš„åˆ—è¡¨ï¼Œç”¨æˆ·å¯ä»¥åœ¨ æ¶ˆæ¯é˜Ÿåˆ— ä¸­æ·»åŠ æ¶ˆæ¯å’Œè¯»å–æ¶ˆæ¯ç­‰ã€‚ä»è¿™ç‚¹ä¸Šçœ‹ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å…·æœ‰ä¸€å®šçš„ FIFO ç‰¹æ€§ï¼Œä½†æ˜¯å®ƒå¯ä»¥å®ç°æ¶ˆæ¯çš„éšæœºæŸ¥è¯¢ï¼Œæ¯” FIFO å…·æœ‰æ›´å¤§çš„ä¼˜åŠ¿ã€‚åŒæ—¶ï¼Œè¿™äº›æ¶ˆæ¯åˆæ˜¯å­˜åœ¨äºå†…æ ¸ä¸­çš„ï¼Œç”±â€œé˜Ÿåˆ— IDâ€æ¥æ ‡è¯†ã€‚ æ¶ˆæ¯é˜Ÿåˆ—çš„å®ç°æ“ä½œ â‘  åˆ›å»ºæˆ–æ‰“å¼€æ¶ˆæ¯é˜Ÿåˆ—ã€‚ä½¿ç”¨çš„å‡½æ•°æ˜¯ msgget()ï¼Œè¿™é‡Œåˆ›å»ºçš„æ¶ˆæ¯é˜Ÿåˆ—çš„æ•°é‡ä¼šå—åˆ°ç³»ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—æ•°é‡çš„é™åˆ¶ã€‚ â‘¡ æ·»åŠ æ¶ˆæ¯ã€‚ä½¿ç”¨çš„å‡½æ•°æ˜¯ msgsnd()ï¼Œå®ƒæŠŠæ¶ˆæ¯æ·»åŠ åˆ°å·²æ‰“å¼€çš„æ¶ˆæ¯é˜Ÿåˆ—æœ«å°¾ã€‚ â‘¢ è¯»å–æ¶ˆæ¯ã€‚ä½¿ç”¨çš„å‡½æ•°æ˜¯ msgrcv()ï¼Œå®ƒæŠŠæ¶ˆæ¯ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–èµ°ï¼Œä¸ FIFO ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œå¯ä»¥å–èµ°æŒ‡å®šçš„æŸä¸€æ¡æ¶ˆæ¯ã€‚ â‘£ æ§åˆ¶æ¶ˆæ¯é˜Ÿåˆ—ã€‚ä½¿ç”¨çš„å‡½æ•°æ˜¯ msgctl()ï¼Œå®ƒå¯ä»¥å®Œæˆå¤šé¡¹åŠŸèƒ½ã€‚ å‡½æ•°æ ¼å¼ åŸºç¡€å®éªŒ åŠŸèƒ½ æœ¬å®éªŒæ„åœ¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œä¸¤ä¸ªè¿›ç¨‹(å‘é€ç«¯å’Œæ¥æ”¶ç«¯)ä¹‹é—´çš„é€šä¿¡ï¼ŒåŒ…æ‹¬æ¶ˆæ¯é˜Ÿåˆ—çš„åˆ›å»ºã€æ¶ˆæ¯å‘é€ä¸è¯»å–ã€æ¶ˆæ¯é˜Ÿåˆ—çš„æ’¤é”€å’Œåˆ é™¤ç­‰å¤šç§æ“ä½œã€‚ æ¶ˆæ¯å‘é€ç«¯è¿›ç¨‹å’Œæ¶ˆæ¯æ¥æ”¶ç«¯è¿›ç¨‹ä¸éœ€è¦é¢å¤–å®ç°è¿›ç¨‹é—´çš„åŒæ­¥ã€‚åœ¨æœ¬å®éªŒä¸­ï¼Œå‘é€ç«¯å‘é€çš„æ¶ˆæ¯ç±»å‹è®¾ç½®ä¸ºè¯¥è¿›ç¨‹çš„è¿›ç¨‹å·ï¼ˆå¯ä»¥å–å…¶ä»–å€¼ï¼‰ï¼Œå› æ­¤æ¥æ”¶ç«¯æ ¹æ®æ¶ˆæ¯ç±»å‹æ¥ç¡®å®šæ¶ˆæ¯å‘é€è€…çš„è¿›ç¨‹å·ã€‚æ³¨æ„è¿™é‡Œä½¿ç”¨äº† ftok()å‡½æ•°ï¼Œå®ƒå¯ä»¥æ ¹æ®ä¸åŒçš„è·¯å¾„å’Œå…³é”®å­—æ¥äº§ç”Ÿæ ‡å‡†çš„ keyã€‚ æºç¨‹åº æœ¬å®éªŒåŒ…æ‹¬ä¸¤ä¸ªæ–‡ä»¶ï¼Œmsgsnd.c æ–‡ä»¶å’Œ msgrcv.c æ–‡ä»¶ã€‚ä¸‹é¢è´´å‡ºè¿™ä¸¤éƒ¨åˆ†çš„ä»£ç ã€‚ msgrcv.c æ–‡ä»¶ msgsnd.c æ–‡ä»¶ æ‰§è¡Œç¨‹åº éœ€è¦å¼€ä¸¤ä¸ªç»ˆç«¯ï¼Œå°†ä¸Šè¿°æ–‡ä»¶ä¸‹è½½åç¼–è¯‘ï¼Œé¦–å…ˆåœ¨ç»ˆç«¯ 1 ä¸Šæ‰§è¡Œ msgrcv åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶ååœ¨ç»ˆç«¯ 2 ä¸Šæ‰§è¡Œ msgsndï¼Œå‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­å‘é€æ¶ˆæ¯ã€‚ ç»ˆç«¯ 1 ç»ˆç«¯ 2 åœ¨ç»ˆç«¯ 2 è¾“å…¥æ¶ˆæ¯å æ­¤æ—¶ç»ˆç«¯ 1 åˆ°è¿™é‡Œï¼Œå®éªŒå·²ç»å®Œäº†ã€‚ ä½†æ˜¯æˆ‘åœ¨åšå®éªŒçš„æ—¶å€™ï¼Œæœ‰ä¸€æ¬¡ï¼Œå…ˆæ‰“å¼€äº† msgsndï¼Œè¾“å…¥äº†æ¶ˆæ¯ï¼Œå¹¶ä¸”è¾“å…¥äº†â€œquitâ€é€€å‡ºäº† msgsnd ç¨‹åºï¼Œç„¶åæ‰“å¼€äº† msgrcvï¼Œå‘ç° msgrcv ä¹Ÿæ¥æ”¶åˆ°äº†åˆšæ‰çš„æ¶ˆæ¯ï¼Œæœ‰ç‚¹æ„æ€ï¼Œå»ºè®®åšä¸€ä¸‹ï¼Œç„¶åæ€è€ƒä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šè¿™æ ·ã€‚ åŒæ—¶ï¼Œä½¿ç”¨å‘½ä»¤ ipcs -q å¯ä»¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„æ¶ˆæ¯é˜Ÿåˆ—çš„ä¿¡æ¯ã€‚ åŸæ–‡åœ°å€ï¼šhttp://blog.csdn.net/mybelief321/article/details/9185625","tags":["clippings"],"categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€"]},{"title":"æ•°ç»„","path":"/2025/05/10/2-ç¼–ç¨‹è¯­è¨€-ç»“æ„ç®—æ³•-æ•°ç»„/","content":"è¿™é‡Œæœ‰ä¸€ä¸ªå¾ªç¯ï¼ŒæŠŠæ•°ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ éƒ½åˆå§‹åŒ–ä¸ºé›¶ #define N_VALUES 5float values[N_VALUES];float *vp;for( vp = values[0]; vp values[N_VALUES]; )\t*vp++ = 0; for è¯­å¥çš„åˆå§‹éƒ¨åˆ†æŠŠ vp æŒ‡å‘æ•°ç»„çš„ç¬¬ 1 ä¸ªå…ƒç´ ã€‚ è¿™ä¸ªä¾‹å­ä¸­çš„æŒ‡é’ˆè¿ç®—æ˜¯ç”¨++æ“ä½œç¬¦å®Œæˆçš„ã€‚å¢åŠ å€¼ 1 ä¸ float çš„é•¿åº¦ç›¸ä¹˜ï¼Œå…¶ç»“æœåŠ åˆ°æŒ‡é’ˆ vp ä¸Šã€‚ ç»è¿‡ç¬¬ 1 æ¬¡å¾ªç¯ä¹‹åï¼ŒæŒ‡é’ˆåœ¨å†…å­˜ä¸­çš„ä½ç½®? ç°åœ¨è€ƒè™‘ä¸‹é¢è¿™ä¸ªå¾ªç¯: for( vp = values[N VALUES]; vp values[0]; )\t*--vp =0; å®ƒå’Œå‰é¢é‚£ä¸ªå¾ªç¯æ‰€æ‰§è¡Œçš„ä»»åŠ¡ç›¸åŒï¼Œä½†æ•°ç»„å…ƒç´ å°†ä»¥ç›¸åçš„æ¬¡åºæ¸…é™¤ã€‚ ä»¬è®© vp æŒ‡å‘æ•°ç»„æœ€åé‚£ä¸ªå…ƒç´ åé¢çš„å†…å­˜ä½ç½®ï¼Œä½†åœ¨å¯¹å®ƒè¿›è¡Œé—´æ¥è®¿é—®ä¹‹å‰å…ˆæ‰§è¡Œè‡ªå‡æ“ä½œã€‚å½“ vp æŒ‡å‘æ•°ç»„ç¬¬ 1 ä¸ªå…ƒç´ æ—¶ï¼Œå¾ªç¯ä¾¿å‘Šç»ˆæ­¢ï¼Œä¸è¿‡è¿™å‘ç”Ÿåœ¨ç¬¬ 1 ä¸ªæ•°ç»„å…ƒç´ è¢«æ¸…é™¤ä¹‹åã€‚ æœ‰äº›äººå¯èƒ½ä¼šåå¯¹åƒ *-vp è¿™æ ·çš„è¡¨è¾¾å¼ï¼Œè§‰å¾—å®ƒçš„å¯è¯»æ€§è¾ƒå·®ã€‚ä½†æ˜¯ï¼Œå¦‚æœå¯¹å…¶è¿›è¡Œâ€ç®€åŒ–â€çœ‹çœ‹è¿™ä¸ªå¾ªç¯ä¼šå‘ç”Ÿä»€ä¹ˆ: for( vp = values[N VALUES - 1]; vp = values[0]; vp-- )\t*vp=0; ç°åœ¨ vp æŒ‡å‘æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå®ƒçš„è‡ªå‡æ“ä½œæ”¾åœ¨ for è¯­çš„è°ƒæ•´éƒ¨åˆ†è¿›è¡Œã€‚è¿™ä¸ªå¾ªç¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œèƒ½å‘ç°å®ƒå—? åœ¨æ•°ç»„ç¬¬ 1 ä¸ªå…ƒç´ è¢«æ¸…é™¤ä¹‹åï¼Œvp çš„å€¼è¿˜å°†å‡å» 1ï¼Œè€Œæ¥ä¸‹å»çš„ä¸€æ¬¡æ¯”è¾ƒè¿ç®—æ˜¯ç”¨äºç»“æŸå¾ªç¯çš„ã€‚ä½†è¿™å°±æ˜¯é—®é¢˜æ‰€åœ¨: æ¯”è¾ƒè¡¨è¾¾å¼ vpvalues[0]çš„å€¼æ˜¯æœªå®šä¹‰çš„ï¼Œå› ä¸º p åˆ°äº†æ•°ç»„çš„è¾¹ç•Œä¹‹å¤–ã€‚æ ‡å‡†å…è®¸æŒ‡å‘æ•°ç»„å…ƒç´ çš„æŒ‡é’ˆä¸æŒ‡å‘æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ åé¢çš„é‚£ä¸ªå†…å­˜ä½ç½®çš„æŒ‡é’ˆè¿›è¡Œæ¯”è¾ƒï¼Œä½†ä¸å…è®¸ä¸æŒ‡å‘æ•°ç»„ç¬¬ 1 ä¸ªå…ƒç´ ä¹‹å‰çš„é‚£ä¸ªå†…å­˜ä½ç½®çš„æŒ‡é’ˆè¿›è¡Œæ¯”è¾ƒ å®é™…ä¸Šï¼Œåœ¨ç»å¤§å¤šæ•° C ç¼–è¯‘å™¨ä¸­ï¼Œè¿™ä¸ªå¾ªç¯å°†é¡ºåˆ©å®Œæˆä»»åŠ¡ã€‚ç„¶è€Œï¼Œè¿˜æ˜¯åº”è¯¥é¿å…ä½¿ç”¨å®ƒï¼Œå› ä¸ºæ ‡å‡†å¹¶ä¸ä¿è¯å®ƒå¯è¡Œã€‚ å¾ªç¯å’Œä½¿ç”¨ä¸‹æ ‡è®¿é—®çš„å¾ªç¯ä¹‹é—´çš„æ•ˆç‡æ¯”è¾ƒ å¦‚æœä¸‹æ ‡å€¼æ˜¯ä»é‚£äº›å·²çŸ¥æ˜¯æ­£ç¡®çš„å€¼è®¡ç®—å¾—æ¥ï¼Œé‚£ä¹ˆå°±æ— éœ€æ£€æŸ¥å®ƒçš„å€¼ã€‚å¦‚æœä¸€ä¸ªç”¨ä½œä¸‹æ ‡çš„å€¼æ˜¯æ ¹æ®æŸç§æ–¹æ³•ä»ç”¨æˆ·è¾“å…¥çš„æ•°æ®äº§ç”Ÿè€Œæ¥çš„ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨å®ƒä¹‹å‰å¿…é¡»è¿›è¡Œæ£€æµ‹ï¼Œç¡®ä¿å®ƒä»¬ä½äºæœ‰æ•ˆçš„èŒƒå›´ä¹‹å†…ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","ç»“æ„ç®—æ³•"]},{"title":"ã€å¤šä¼ æ„Ÿèåˆã€‘ä¼˜è¾¾å­¦åŸå¤šä¼ æ„Ÿèåˆå­¦ä¹ ç¬”è®°ï¼ˆå››ï¼‰â€”â€”å°†æ¿€å…‰é›·è¾¾3Dç‚¹äº‘æ˜ å°„åˆ°ç›¸æœºå›¾åƒï¼ˆä¸‹ï¼‰_kittiæ¿€å…‰é›·è¾¾å’Œç›¸æœºæ˜ å°„-CSDNåšå®¢","path":"/2025/05/10/3-å¼€å‘æ¡†æ¶-OpenCV-ã€å¤šä¼ æ„Ÿèåˆã€‘ä¼˜è¾¾å­¦åŸå¤šä¼ æ„Ÿèåˆå­¦ä¹ ç¬”è®°ï¼ˆå››ï¼‰â€”â€”å°†æ¿€å…‰é›·è¾¾3Dç‚¹äº‘æ˜ å°„åˆ°ç›¸æœºå›¾åƒï¼ˆä¸‹ï¼‰-kittiæ¿€å…‰é›·è¾¾å’Œç›¸æœºæ˜ å°„-CSDNåšå®¢/","content":"å°†æ¿€å…‰é›·è¾¾ 3D ç‚¹äº‘æ˜ å°„åˆ°ç›¸æœºå›¾åƒï¼ˆä¸‹ï¼‰â€”â€”ç¼–ç¨‹å®è·µKITTI æ•°æ®é›†çš„ä¼ æ„Ÿå™¨å®‰è£…é…ç½®åœ¨ ä¸Šä¸€ç¯‡ç¬”è®° ä¸­ï¼Œå¯¹æ¿€å…‰é›·è¾¾ 3D ç‚¹äº‘æ˜ å°„åˆ°ç›¸æœºå›¾åƒçš„åŸç†è¿›è¡Œäº†è¯¦ç»†åˆ†æï¼Œä¸‹é¢è®©æˆ‘ä»¬é¦–å…ˆäº†è§£ä¸€ä¸‹æˆ‘ä»¬ä½¿ç”¨çš„ KITTIæ•°æ®é›† ä¸­çš„ä¼ æ„Ÿå™¨å®‰è£…é…ç½®ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œæ•°æ®é‡‡é›†è½¦ä¸Šå®‰è£…äº†ä¸¤ä¸ªå‰å‘æ‘„åƒå¤´ï¼Œè½¦é¡¶å®‰è£…äº†ä¸€ä¸ª Velodyne æ¿€å…‰é›·è¾¾å’Œä¸€ä¸ªæƒ¯æ€§æµ‹é‡è£…ç½®ï¼ˆå³ IMUï¼Œä¸è¿‡æœ¬è¯¾ç¨‹ä¸­æœªä½¿ç”¨ï¼‰ã€‚å¯¹äº KITTI å®˜ç½‘ä¸‹è½½åˆ°çš„æ‰€æœ‰æ•°æ®é›†åˆï¼Œä½ éƒ½å¯ä»¥æ‰¾åˆ°åŒ…å«ç›¸æœºå†…å‚ã€å¤–å‚çš„æ ¡æ­£æ–‡ä»¶ã€‚ä¸‹é¢å±•ç¤ºäº†æ ¡æ­£æ–‡ä»¶â€calib_velo_to_cam.txtâ€œçš„éƒ¨åˆ†å†…å®¹ï¼Œè¡¨æ˜äº†æ¿€å…‰é›·è¾¾å’Œå·¦æ‘„åƒå¤´çš„ç›¸å¯¹ä½ç½®å…³ç³»ï¼ˆé€‚ç”¨äºæˆ‘ä»¬å³å°†ä½¿ç”¨çš„é«˜é€Ÿå…¬è·¯åœºæ™¯æ•°æ®ï¼‰ï¼š calib_time: 15-Mar-2012 11:37:16R: 7.533745e-03 -9.999714e-01 -6.166020e-04 1.480249e-02 7.280733e-04 -9.998902e-01 9.998621e-01 7.523790e-03 1.480755e-02T: -4.069766e-03 -7.631618e-02 -2.717806e-01â€¦1234567 çŸ©é˜µ R å’Œå‘é‡ T æä¾›ç»™æˆ‘ä»¬äº†ç›¸æœºçš„å¤–å‚ã€‚å½“ç„¶ï¼Œä¸ºäº†å®Œæˆ ä¸‰ç»´ç‚¹äº‘ åˆ°ç›¸æœºå›¾åƒçš„æ˜ å°„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç›¸æœºçš„å†…å‚ã€‚å®ƒä»¬ä¿å­˜åœ¨â€calib_cam_to_cam.txtâ€æ–‡ä»¶ä¸­ï¼Œç›¸å…³å†…å®¹å¦‚ä¸‹ï¼š calib_time: 09-Jan-2012 13:57:47â€¦R_rect_00: 9.999239e-01 9.837760e-03 -7.445048e-03 -9.869795e-03 9.999421e-01 -4.278459e-03 7.402527e-03 4.351614e-03 9.999631e-01P_rect_00: 7.215377e+02 0.000000e+00 6.095593e+02 0.000000e+00 0.000000e+00 7.215377e+02 1.728540e+02 0.000000e+00 0.000000e+00 0.000000e+00 1.000000e+00 0.000000e+00â€¦123456789 çŸ©é˜µ R_rect_00 æ˜¯ä¸€ä¸ª 3*3 çš„ä¿®æ­£æ—‹è½¬çŸ©é˜µï¼Œç”¨äºä½¿ç›¸æœºå›¾åƒå…±é¢ï¼Œä¾‹å¦‚ï¼Œå¯¹é½ç«‹ä½“è§†è§‰å¹³å°çš„å¤šä¸ªæ‘„åƒå¤´ï¼ˆå¯¹äºè¿™è¾† KITTI æ•°æ®é‡‡é›†è½¦ï¼Œæœ‰ä¸¤éƒ¨æ‘„åƒå¤´ï¼‰ï¼Œè¿™å¯ä»¥é€šè¿‡å°†å·¦ä¾§æ‘„åƒå¤´çš„ä¸€è¡Œåƒç´ ç›´æ¥å¯¹é½å³ä¾§æ‘„åƒå¤´çš„å¦ä¸€è¡Œåƒç´ ï¼ˆè€Œä¸æ˜¯ä¸¤æ¡åœ¨ä¸¤ä¸ªç›¸æœºå¹³é¢äº¤å‰çš„å€¾æ–œç›´çº¿ï¼‰ã€‚ç”±äºæˆ‘ä»¬å½“å‰ä¸»è¦è€ƒè™‘ MONOï¼ˆå•é€šé“ï¼‰ç›¸æœºï¼Œå› æ­¤æˆ‘ä»¬å°†ä¸å†æ·±ç©¶ä¸Šè¿°å¯¹é½æ“ä½œçš„åŸºç¡€ç†è®ºâ€”â€”ä½†æ˜¯å¦‚æœä½ å¯¹æ­¤æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œå¯ä»¥æœç´¢â€epipolar geometryâ€ï¼ˆå¯¹æå‡ ä½•ï¼‰è·å–æ›´å¤šç›¸å…³å†…å®¹ã€‚çŸ©é˜µ P_rect_00 åˆ™åŒ…å«äº†ç›¸æœºçš„å†…å‚ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸º $K K K$ ï¼‰ã€‚ä¸‹åˆ—å…¬å¼å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨é½æ¬¡åæ ‡ç³»å°†KITTIæ•°æ®é›†ä¸­çš„æ¿€å…‰é›·è¾¾3Dç‚¹äº‘ `X` æ˜ å°„åˆ°å·¦ä¾§ç›¸æœºçš„2Dç›¸æœºå›¾åƒç‚¹ `Y` ï¼ˆè¿™é‡Œä½¿ç”¨äº†Kitti readme æ–‡ä»¶ä¸­çš„ç¬¦å·ï¼‰ä¸Šã€‚ ç¨‹åºæ‰§è¡Œä¸»è¦æµç¨‹è¦å®ç°å°† KITTI æ•°æ®é›†ä¸­çš„æ¿€å…‰é›·è¾¾ 3D ç‚¹äº‘ X æ˜ å°„åˆ°å·¦ä¾§ç›¸æœºçš„ 2D ç›¸æœºå›¾åƒç‚¹ Y ä¸Šï¼Œåœ¨ç¨‹åºä¸­ä¸»è¦éœ€è¦æ‰§è¡Œä»¥ä¸‹å‡ æ­¥ï¼š éå†è·å–æ¿€å…‰é›·è¾¾ç‚¹äº‘ä¿¡æ¯æ—¶ï¼Œå°†æ¯ä¸ª 3D ç‚¹è½¬æ¢ä¸ºé½æ¬¡åæ ‡ï¼Œå¹¶å­˜å…¥ 4D å˜é‡ X ä¸­ã€‚ åº”ç”¨æ˜ å°„å…¬å¼ï¼Œå°† X æ˜ å°„åˆ°ç›¸æœºçš„å›¾åƒå¹³é¢ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åˆ°å˜é‡ Y ä¸­ã€‚ å°†å˜é‡ Y ä»é½æ¬¡åæ ‡ç³»è½¬æ¢å›æ¬§å‡ é‡Œå¾—åæ ‡ç³»ï¼Œä»è€Œå¾—åˆ°å¯¹åº”çš„å›¾åƒä¸­çš„åƒç´ ä½ç½®ï¼Œå¹¶å°†ç»“æœå­˜å…¥å˜é‡ pt ä¸­ã€‚ å‚è€ƒä»£ç å¦‚ä¸‹ï¼šåŠ è½½å¯¹åº”çš„ç›¸æœºæ•°æ®å’Œæ¿€å…‰é›·è¾¾ç‚¹äº‘æ•°æ®ï¼Œåˆå§‹åŒ–å‰é¢æåˆ°çš„æ˜ å°„ç›¸å…³çŸ©é˜µï¼ˆ OpenCV å½¢å¼çŸ©é˜µï¼‰ï¼šåˆå§‹åŒ–ç”¨äºæ˜¾ç¤ºæ˜ å°„ç»“æœçš„å›¾ç‰‡æ•°æ®ï¼ˆ visImg ç”¨äºæ˜¾ç¤ºåŸå§‹ç›¸æœºå›¾åƒï¼Œ overlay ç”¨äºæ˜¾ç¤ºæ˜ å°„åˆ°ç›¸æœºå›¾åƒä¸Šçš„æ¿€å…‰é›·è¾¾ç‚¹äº‘ï¼‰ï¼Œåˆå§‹åŒ–é½æ¬¡åæ ‡å¯¹è±¡ X å’Œ Y ï¼šéå†æ¿€å…‰é›·è¾¾ç‚¹äº‘ï¼Œå°†å…¶è½¬æ¢åˆ°é½æ¬¡åæ ‡ç³»æ˜ å°„åˆ°ç›¸æœºå›¾åƒå¹³é¢ï¼Œå†è½¬æ¢å›éé½æ¬¡åæ ‡ï¼Œå¾—åˆ°å¯¹åº”çš„åƒç´ ä½ç½® pt ï¼Œå¹¶å°†å…¶ç»˜åˆ¶åœ¨å›¾åƒ overlay ä¸­ï¼ˆæœ€è¿‘å¤„ä¸ºçº¢è‰²ï¼Œæœ€è¿œå¤„ä¸ºç»¿è‰²ï¼‰ã€‚åˆ©ç”¨ OpenCV çš„ cv::addWeighted å‡½æ•° å°† overlay å›¾åƒæŒ‰ç…§ä¸€å®šçš„ä¸é€æ˜åº¦å’ŒåŸå§‹ç›¸æœºå›¾åƒ visImg èåˆå¹¶æ˜¾ç¤ºï¼šèåˆæ˜¾ç¤ºçš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­æ˜ å°„çš„æ¿€å…‰é›·è¾¾ç‚¹äº‘æŒ‰ç…§çºµå‘è·ç¦»çš„è¿œè¿‘ç”¨ä¸åŒçš„é¢œè‰²è¿›è¡Œæ˜¾ç¤ºï¼ˆæœ€è¿‘å¤„ä¸ºçº¢è‰²ï¼Œæœ€è¿œå¤„ä¸ºç»¿è‰²ï¼‰ï¼šä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå¯¹äºæ˜ å°„åˆ°è·¯é¢ä¸Šçš„ç‚¹ï¼Œè¾ƒè¿‘å¤„å‘ˆç°çº¢è‰²ï¼Œè¾ƒè¿œå¤„å‘ˆç°ç»¿è‰²ï¼Œä¸æˆ‘ä»¬çš„é¢„æœŸä¸€è‡´ã€‚ä½†æ˜¯æ˜¾ç„¶ï¼Œå›¾åƒä¸­ä¸ŠåŠéƒ¨åˆ†çš„çº¢è‰²ç‚¹æ˜¯ä¸å¯¹çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å¯¹é›·è¾¾ç‚¹äº‘ä¿¡æ¯è¿›è¡Œä¸€äº›è¿‡æ»¤æ“ä½œï¼Œè¯·çœ‹ä¸‹ä¸€èŠ‚ã€‚ è¿‡æ»¤æ¿€å…‰é›·è¾¾ç‚¹äº‘åœ¨å‰é¢ ç¬¬äºŒèŠ‚çš„è¯¾ç¨‹ ä¸­ï¼Œæˆ‘ä»¬å·²ç»æŒæ¡äº†å¦‚ä½•å°†æ¿€å…‰é›·è¾¾ç‚¹äº‘ä¿¯è§†å›¾æ˜ å°„åˆ°äºŒç»´å›¾åƒä¸Šã€‚è¿™ä¸ªæ˜ å°„è¿‡ç¨‹å®é™…ä¸Šå‡è®¾äº†æˆ‘ä»¬åªå¯¹è‡ªè½¦å‰é¢çš„ç‚¹äº‘æ„Ÿå…´è¶£ã€‚åœ¨ä»£ç ä¸­ï¼Œä¸Šè¿°æ˜ å°„è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š int y = (-xw * imageSize.height / worldSize.height) + imageSize.height;int x = (-yw * imageSize.height / worldSize.height) + imageSize.width / 2;12 é‚£ä¹ˆï¼Œç”±äº Velodyne æ¿€å…‰é›·è¾¾æ˜¯å®‰è£…åœ¨è½¦é¡¶ï¼Œä¸”ä»¥ 10Hz çš„é¢‘ç‡è¿›è¡Œ 360 åº¦æ—‹è½¬ï¼Œå› æ­¤ï¼Œè¿™å°±æ„å‘³ç€å®ƒä¹Ÿèƒ½å¤Ÿæµ‹é‡åˆ°è‡ªè½¦åé¢çš„ 3D ç‚¹äº‘ã€‚è¿™äº›ç‚¹äº‘ä¹ŸåŒ…å«åœ¨æ•°æ®é›†ä¸­ã€‚ä½†æ˜¯å½“æˆ‘ä»¬å°†å…¶æ˜ å°„åˆ°ç›¸æœºå›¾åƒï¼Œå®ƒä»¬ä¹Ÿä¼šå½¢æˆä¸€ä¸ªæœ‰æ•ˆçš„æ˜ å°„å€¼ï¼Œå³ä¾¿è¿™äº›ç‚¹äº‘æ ¹æœ¬æ— æ³•åœ¨è¯¥å‰å‘æ‘„åƒå¤´ä¸­è¢«çœ‹åˆ°ã€‚ è¿™äº›ç‚¹äº‘å…·æœ‰è´Ÿçš„ x å€¼ï¼ˆçºµåæ ‡ï¼‰ ï¼Œè¿™ç›´æ¥å¯¼è‡´äº†å®ƒä»¬æ˜ å°„åˆ°ç›¸æœºå›¾åƒåå‘ˆç°ä¸ºçº¢è‰²ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸€äº›ç‚¹äº‘è¿‡æ»¤æ“ä½œã€‚ ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†è¿›è¡Œç‚¹äº‘è¿‡æ»¤çš„å…·ä½“æ“ä½œï¼Œæ»¤é™¤æ‰äº†ä¸€äº›æ— ç”¨çš„ç‚¹äº‘ï¼Œä¾‹å¦‚ï¼š ä½äºæ¿€å…‰é›·è¾¾åæ–¹ï¼Œä¸”å…·æœ‰è´Ÿçš„ x å€¼ã€‚ åœ¨ x è½´æ–¹å‘ä¸Šè·ç¦»å¤ªè¿œä»¥è‡´è¶…å‡ºäº†æœ€å¤§è·ç¦»ä¸Šé™ã€‚ åœ¨ y è½´æ–¹å‘ä¸Šè·ç¦»å¤ªè¿œä»¥è‡´è¶…å‡ºäº†è‡ªè½¦æ„Ÿå…´è¶£çš„èŒƒå›´ã€‚ è·ç¦»é“è·¯è¡¨é¢å¤ªè¿‘ä»¥è‡´äºå…·æœ‰è´Ÿçš„ z å€¼ã€‚ åå°„ç‡æ¥è¿‘ 0ï¼Œå¯èƒ½å…·æœ‰è¾ƒå¤§çš„æµ‹é‡è¯¯å·®ã€‚ for(auto it=lidarPoints.begin(); it!=lidarPoints.end(); ++it) float maxX = 25.0, maxY = 6.0, minZ = -1.4; if(it-x maxX || it-x 0.0 || abs(it-y) maxY || it-z minZ || it-r0.01 ) continue; // skip to next point 1234567 åœ¨åº”ç”¨äº†ä¸Šè¿°è¿‡æ»¤æ“ä½œåï¼Œç‚¹äº‘æ˜ å°„åˆ°å›¾åƒä¸Šçš„ç»“æœä¼šè¢«è¿‡æ»¤æ‰å¾ˆå¤šçš„æ— ç”¨ç‚¹äº‘ä¿¡æ¯ï¼Œå‘ˆç°çš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å¯¹äºè½¦è¾†ç¢°æ’é¢„è­¦ç­‰åº”ç”¨ï¼Œä¼ æ„Ÿå™¨çš„æµ‹é‡è´¨é‡å›ºç„¶æ˜¯è‡³å…³é‡è¦çš„ï¼Œè€Œè¿‡æ»¤æ­¥éª¤ï¼Œé™¤äº†èƒ½å¤Ÿå¢åŠ å¤„ç†é€Ÿåº¦ï¼Œè¿˜å¯ä»¥å¸®åŠ©æé«˜å¯é æ€§ï¼Œä¹Ÿæ˜¯ä¸å¯æˆ–ç¼ºçš„æ­¥éª¤ã€‚","categories":["3.å¼€å‘æ¡†æ¶","OpenCV"]},{"title":"ARM è°ƒç”¨æ ˆç»“æ„","path":"/2025/05/10/5-åµŒå…¥å¼å¼€å‘-ARMæ¶æ„-ARM-è°ƒç”¨æ ˆç»“æ„/","content":"åˆ†æ ARM æ¶æ„ Linux ç¯å¢ƒä¸­çš„åº”ç”¨æ€ä¸å†…æ ¸æ€è°ƒè¯•æ–¹æ³•æ—¶ï¼Œäº†è§£å‡½æ•°è°ƒç”¨æ ˆçš„ç»“æ„è‡³å…³é‡è¦ã€‚ARM æ¶æ„çš„å‡½æ•°è°ƒç”¨éµå¾ª APCSï¼ˆARM Procedure Call Standardï¼‰è§„åˆ™ï¼Œé€šè¿‡åˆ†æä»¥ä¸‹å®ä¾‹ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ¸…æ™°åœ°ç†è§£ ARM è°ƒç”¨æ ˆçš„ç»„ç»‡æ–¹å¼ã€‚ ç¤ºä¾‹ä»£ç ï¼šint callfunctionA(int aa, int bb, int c, int d, int e, int f) int a = 0; int b = 0; printf(the a is %i, the b is %i , a, b); callfunctionB(); return 0; int main() callfunctionA(1, 2, 3, 4, 5, 6); å¯¹åº”çš„æ±‡ç¼–ä»£ç ï¼š; å‡½æ•° callfunctionA çš„å®ç°ï¼š8480: e92d4800 push fp, lr ; ä¿å­˜å‡½æ•°è°ƒç”¨è€…çš„å †æ ˆæŒ‡é’ˆå’Œé“¾æ¥å¯„å­˜å™¨8484: e28db004 add fp, sp, #4 ; è®¾ç½®å‡½æ•°çš„æ ˆå¸§8488: e24dd018 sub sp, sp, #24 ; åˆ†é…å±€éƒ¨å˜é‡çš„æ ˆç©ºé—´848c: e50b0010 str r0, [fp, #-16] ;ä¿å­˜å‚æ•° aa8490: e50b1014 str r1, [fp, #-20] ;ä¿å­˜å‚æ•° bb8494: e50b2018 str r2, [fp, #-24] ;ä¿å­˜å‚æ•° c8498: e50b301c str r3, [fp, #-28] ;ä¿å­˜å‚æ•° d; åˆå§‹åŒ–å±€éƒ¨å˜é‡ a å’Œ bï¼š849c: e3a03000 mov r3, #0 84a0: e50b3008 str r3, [fp, #-8] ; a = 084a4: e3a03000 mov r3, #0 84a8: e50b300c str r3, [fp, #-12] ; b = 0; è°ƒç”¨ printf å‡½æ•°ï¼š84ac: e59f001c ldr r0, [pc, #28] ; åŠ è½½æ ¼å¼å­—ç¬¦ä¸²çš„åœ°å€84b0: e51b1008 ldr r1, [fp, #-8] ; åŠ è½½å˜é‡ a çš„å€¼84b4: e51b200c ldr r2, [fp, #-12] ; åŠ è½½å˜é‡ b çš„å€¼84b8: ebffff89 bl 82e4 _init+0x20 ; è°ƒç”¨ printf å‡½æ•°; è°ƒç”¨ callfunctionB()ï¼š84bc: ebffffe0 bl 8444 ; è°ƒç”¨ callfunctionB(); è¿”å›ç‚¹ï¼š84c0: e3a03000 mov r3, #0 ; è¿”å›å€¼ 084c4: e1a00003 mov r0, r3 84c8: e24bd004 sub sp, fp, #4 ; æ¢å¤æ ˆæŒ‡é’ˆ84cc: e8bd8800 pop fp, pc ; æ¢å¤ fp å’Œ pc84d0: 000085cc word 0x000085cc ; æ ¼å¼å­—ç¬¦ä¸²çš„åœ°å€ è°ƒç”¨æ ˆåˆ†æï¼š å‡½æ•°è°ƒç”¨å‰çš„å‡†å¤‡å·¥ä½œï¼š int main() callfunctionA(1, 2, 3, 4, 5, 6); å¯¹åº”çš„æ±‡ç¼–ä»£ç ï¼š 8518: e3a03005 mov r3, #5 ; ç¬¬äº”ä¸ªå‚æ•° e851c: e58d3000 str r3, [sp] 8520: e3a03006 mov r3, #6 ; ç¬¬å…­ä¸ªå‚æ•° f8524: e58d3004 str r3, [sp, #4] 8528: e3a00001 mov r0, #1 ; ç¬¬ä¸€ä¸ªå‚æ•° aa852c: e3a01002 mov r1, #2 ; ç¬¬äºŒä¸ªå‚æ•° bb8530: e3a02003 mov r2, #3 ; ç¬¬ä¸‰ä¸ªå‚æ•° c8534: e3a03004 mov r3, #4 ; ç¬¬å››ä¸ªå‚æ•° d8538: ebffffd0 bl 8480 ; è·³è½¬è‡³ callfunctionA å‚æ•°ä¼ é€’è§„åˆ™ï¼š ARM æ¶æ„æŒ‰ç…§ APCS è§„åˆ™ï¼Œå‰å››ä¸ªå‚æ•°ç”± r0-r3 å¯„å­˜å™¨ä¼ é€’ã€‚ è¶…è¿‡å››ä¸ªçš„å‚æ•°ç”±è°ƒç”¨æ ˆä¼ é€’ï¼Œä¸”æ ˆç©ºé—´å¿…é¡» 8 å­—èŠ‚å¯¹é½ã€‚ è°ƒç”¨æ ˆçš„ç»“æ„ï¼š å‚æ•°éƒ¨åˆ†ï¼šå‰å››ä¸ªå‚æ•°é€šè¿‡å¯„å­˜å™¨ä¼ é€’ï¼Œè¶…å‡ºéƒ¨åˆ†é€šè¿‡æ ˆä¼ é€’ã€‚ è¿”å›åœ°å€ï¼šå­˜å‚¨å‡½æ•°è°ƒç”¨çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ã€‚ å±€éƒ¨å˜é‡éƒ¨åˆ†ï¼šå‡½æ•°å†…éƒ¨å˜é‡å­˜å‚¨åœ¨æ ˆä¸­ã€‚ å…·ä½“å®ä¾‹åˆ†æï¼š callfunctionA() è¢«è°ƒç”¨æ—¶ï¼Œå‚æ•° 1ã€2 è¢«ä¿å­˜åœ¨ r0 å’Œ r1 ä¸­ï¼Œå‚æ•° 3ã€4 ä¿å­˜åœ¨ r2 å’Œ r3 ä¸­ã€‚ å‚æ•° 5 å’Œ 6 ç”±äºè¶…è¿‡å››ä¸ªï¼Œä¿å­˜åœ¨è°ƒç”¨æ ˆä¸­ã€‚ å‡½æ•°å†…éƒ¨çš„å±€éƒ¨å˜é‡ a å’Œ b ä¹Ÿè¢«ä¿å­˜åœ¨æ ˆä¸­ã€‚ é€šè¿‡ä»¥ä¸Šåˆ†æï¼Œå¯ä»¥æ¸…æ™°åœ°çœ‹åˆ° ARM è°ƒç”¨æ ˆçš„ç»“æ„å’Œå·¥ä½œåŸç†ã€‚äº†è§£è¿™äº›æœºåˆ¶å¯¹äºè°ƒè¯• ARM æ¶æ„ç¨‹åºå°¤ä¸ºé‡è¦ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","ARMæ¶æ„"]},{"title":"ã€è‡ªåŠ¨é©¾é©¶æŠ€æœ¯ã€‘ä¼˜è¾¾å­¦åŸæ— äººé©¾é©¶å·¥ç¨‹å¸ˆå­¦ä¹ ç¬”è®°ï¼ˆä¸ƒï¼‰â€”â€”è®¡ç®—æœºè§†è§‰åŸºç¡€_è®¡ç®—æœºæ— äººé©¾é©¶è€ƒç‚¹-CSDNåšå®¢","path":"/2025/04/25/3-å¼€å‘æ¡†æ¶-OpenCV-ã€è‡ªåŠ¨é©¾é©¶æŠ€æœ¯ã€‘ä¼˜è¾¾å­¦åŸæ— äººé©¾é©¶å·¥ç¨‹å¸ˆå­¦ä¹ ç¬”è®°ï¼ˆä¸ƒï¼‰â€”â€”è®¡ç®—æœºè§†è§‰åŸºç¡€-è®¡ç®—æœºæ— äººé©¾é©¶è€ƒç‚¹-CSDNåšå®¢/","content":"æœ¬æ–‡æ¦‚è¿°äº†åœ¨æ— äººé©¾é©¶å·¥ç¨‹ä¸­ï¼Œå¦‚ä½•é€šè¿‡é¢œè‰²é€‰æ‹©ã€åŒºåŸŸç­›é€‰ã€Canny è¾¹ç¼˜æ£€æµ‹å’Œéœå¤«å˜æ¢ï¼Œä»è§†è§‰ä¼ æ„Ÿå™¨è·å–çš„å›¾åƒä¸­æå–è½¦é“çº¿ä¿¡æ¯ã€‚ä»é¢œè‰²åŒºåˆ†å¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ°é«˜çº§ç®—æ³•å¦‚ Canny è¾¹ç¼˜æ£€æµ‹å’Œéœå¤«å˜æ¢çš„åº”ç”¨ï¼Œå®ç°æ›´å‡†ç¡®çš„è½¦é“çº¿å®šä½ã€‚ æ‘˜è¦ç”Ÿæˆäº CçŸ¥é“ ï¼Œç”± DeepSeek-R1 æ»¡è¡€ç‰ˆæ”¯æŒï¼Œ å‰å¾€ä½“éªŒ å‰è¨€ æœ¬åšæ–‡ä¸ºç¬”è€…å…³äºä¼˜è¾¾å­¦åŸæ— äººé©¾é©¶å·¥ç¨‹å¸ˆè¯¾ç¨‹ä¸­è®¡ç®—æœºè§†è§‰åŸºç¡€éƒ¨åˆ†çš„å­¦ä¹ ç¬”è®°ï¼Œè¯¥éƒ¨åˆ†ä¸ºå®ç°è½¦é“çº¿ å›¾åƒè¯†åˆ« åŠŸèƒ½çš„åŸºç¡€è¯¾ç¨‹ï¼Œå…³äºæœ¬è¯¾ç¨‹çš„è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ ä¼˜è¾¾å­¦åŸå®˜ç½‘ ã€‚ åœ¨è®¡ç®—æœºè§†è§‰åŸºç¡€çŸ¥è¯†è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†ä¼šå­¦ä¹ ä¸€äº›åŸºç¡€çš„è®¡ç®—æœºè§†è§‰ï¼ˆComputer Visionï¼Œç®€ç§° CVï¼‰æŠ€æœ¯ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨å­¦åˆ°çš„è¿™äº›æŠ€æœ¯ç”¨äºåç»­çš„è½¦é“çº¿æ£€æµ‹ã€‚ é¢œè‰²é€‰æ‹©ï¼ˆColor Selectionï¼‰ç†è®ºåŸºç¡€å¯¹äºè‡ªåŠ¨é©¾é©¶è½¦è¾†æ¥è¯´ï¼Œä»è§†è§‰ä¼ æ„Ÿå™¨å¾—åˆ°çš„å›¾åƒæ•°æ®ä¸­å¾—åˆ°è½¦é“çº¿ä¿¡æ¯æ˜¯ä¸€é¡¹éå¸¸é‡è¦çš„æŠ€èƒ½ã€‚è¦æƒ³ä»ç›¸æœºå›¾åƒä¸­æå–å‡ºè½¦é“çº¿ä¿¡æ¯ï¼Œç¬¬ä¸€æ­¥æˆ‘ä»¬å¯ä»¥é€šè¿‡é¢œè‰²é€‰æ‹©ï¼Œæå–å‡ºæˆ‘ä»¬å¾ˆå¯èƒ½æœ‰ç”¨çš„ä¿¡æ¯ã€‚ ä¸‹å›¾æ˜¯ä¸€å¼ å®‰è£…åœ¨æ±½è½¦ä¸Šçš„å‰å‘ç›¸æœºåœ¨é“è·¯ä¸Šæ‹æ‘„ä¸‹çš„å›¾åƒã€‚ä»å›¾åƒä¸­å¯ä»¥çœ‹å‡ºï¼Œè½¦é“çº¿çš„é¢œè‰²ä¿¡æ¯æ˜¯å¯ä»¥å°†å®ƒå’Œå‘¨å›´ç¯å¢ƒåŒºåˆ†å¼€æ¥çš„æ˜æ˜¾ç‰¹å¾ã€‚å› æ­¤æˆ‘ä»¬é¦–å…ˆæ¥å­¦ä¹ å¦‚ä½•é€šè¿‡ é¢œè‰²é€‰æ‹© å¯¹å›¾åƒä¸Šçš„è½¦é“çº¿ç›¸å…³ä¿¡æ¯è¿›è¡Œæå–ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯¹äºå½©è‰²ç›¸æœºæ‹æ‘„å¾—åˆ°çš„å›¾åƒï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æŒ‰ä¸‹å›¾æ‰€ç¤ºåˆ†æˆä¸‰ä¸ªé¢œè‰²é€šé“ï¼ˆä¸‰åŸºè‰²ï¼‰ï¼šçº¢ï¼ˆRï¼‰ã€ç»¿ï¼ˆGï¼‰ã€è“ï¼ˆBï¼‰ã€‚å›¾åƒä¸­çš„æ¯ä¸ªé¢œè‰²é€šé“ç›¸äº’ç‹¬ç«‹ï¼Œå…¶æ¯ä¸ªåƒç´ ä¸­çš„å€¼å¯ä»¥ä¸º[0,255]ã€‚å½“åƒç´ å€¼ä¸º 0 æ—¶ï¼Œå¯¹åº”çš„åƒç´ å‘ˆç°é»‘è‰²ï¼›å½“åƒç´ å€¼ä¸º 255 æ—¶ï¼Œå¯¹åº”çš„åƒç´ å‘ˆç°è¯¥é€šé“å¯¹åº”çš„é¢œè‰²ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šç”±ä¸Šé¢çš„çŸ¥è¯†å¯çŸ¥ï¼Œå¦‚æœæˆ‘ä»¬ç”¨ [R,G,B] çš„é¡ºåºè¡¨ç¤ºåƒç´ å€¼ï¼Œåˆ™ [0,0,0] å¯¹åº”åƒç´ çš„é»‘è‰²ï¼Œè€Œ [255,255,255] å¯¹åº”åƒç´ çš„ç™½è‰²ã€‚å…³äºæ›´å¤šçš„é¢œè‰²ç»„åˆï¼Œè‹¥æ„Ÿå…´è¶£å¯ä»¥é€šè¿‡ç½‘ç»œä¸Šçš„ åœ¨çº¿é¢œè‰²é€‰æ‹©å™¨å·¥å…· è¿›è¡ŒæŸ¥è¯¢ã€‚ ä»£ç å®è·µä¸‹é¢æˆ‘ä»¬å°†é€šè¿‡ Python ç¼–ç¨‹å®ç°ç®€å•çš„é¢œè‰²é€‰æ‹©ã€‚ æˆ‘ä»¬å°†å¯¹ä¸Šé¢æåˆ°çš„ç›¸æœºå›¾åƒè¿›è¡Œå¤„ç†ï¼ŒåŸå§‹å›¾åƒå¦‚ä¸‹ï¼ˆå¦‚éœ€æµ‹è¯•ç¨‹åºï¼Œå¯åœ¨æµè§ˆå™¨ä¸­ä¿å­˜åˆ°æœ¬åœ°ï¼‰ï¼šPython ä»£ç å¦‚ä¸‹ï¼š # -*- coding: utf-8 -*-#å¯¼å…¥ä¾èµ–åº“import matplotlib.pyplot as pltimport matplotlib.image as mpimgimport numpy as np# åˆ©ç”¨matplotlib.imageè¯»å–å›¾ç‰‡æ•°æ®ï¼Œå¹¶æ‰“å°å‡ºå›¾åƒçš„æ•°æ®ç±»å‹å’Œæ•°æ®ç»´åº¦image = mpimg.imread(test.jpg)print(This image is: ,type(image), # å°†ä¼šè¾“å‡ºclass numpy.ndarray with dimensions:, image.shape) # å°†ä¼šè¾“å‡º(540, 960, 3)# Grab the x and y size and make a copy of the imageysize = image.shape[0] # image heightxsize = image.shape[1] # image width# Note: always make a copy rather than simply using =color_select = np.copy(image)# Define our color selection criteriared_threshold = 200green_threshold = 200blue_threshold = 200# åˆ©ç”¨ä¸Šè¿°ä¸‰ä¸ªé˜ˆå€¼ç”Ÿæˆrgb_thresholdé˜ˆå€¼ ã€‚rgb_threshold = [red_threshold, green_threshold, blue_threshold]# é€‰å‡ºå°äºé˜ˆå€¼çš„åƒç´ å¹¶å°†å®ƒä»¬çš„å€¼ç½®ä¸º0ï¼ˆé»‘è‰²ï¼‰ï¼Œå¯¹å¤§äºç­‰äºé˜ˆå€¼çš„åƒç´ è¿›è¡Œä¿ç•™.# Identify pixels below the thresholdthresholds = (image[:,:,0] rgb_threshold[0]) \\ | (image[:,:,1] rgb_threshold[1]) \\ | (image[:,:,2] rgb_threshold[2])color_select[thresholds] = [0,0,0] # to black# Display the image plt.imshow(color_select)plt.show()# Uncomment the following code if you are running the code locally and wish to save the image# mpimg.imsave(test-after.png, color_select)1234567891011121314151617181920212223242526272829303132333435363738 æœ€ç»ˆï¼Œç¨‹åºä¼šå°†å›¾åƒä¸­å°äºé˜ˆå€¼çš„åƒç´ å…¨éƒ¨ç½®ä¸ºé»‘è‰²ï¼Œä»…ä¿ç•™å¤§äºç­‰äºé˜ˆå€¼çš„åƒç´ å€¼ã€‚ç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹ï¼Œç”±ç»“æœå¯çŸ¥ï¼Œæˆ‘ä»¬é€šè¿‡é¢œè‰²é€‰æ‹©å»é™¤äº†å›¾åƒä¸­å¤§éƒ¨åˆ†å’Œè½¦é“çº¿æ— å…³çš„ä¿¡æ¯ï¼š åŒºåŸŸç­›é€‰ï¼ˆRegion Maskingï¼‰ç†è®ºåŸºç¡€ä¸Šä¸€èŠ‚æˆ‘ä»¬é€šè¿‡ç®€å•çš„é¢œè‰²é€‰æ‹©å¾—åˆ°äº†ä¸Šå›¾æ‰€ç¤ºçš„åŒ…å«è½¦é“çº¿çš„åƒç´ ä¿¡æ¯ï¼Œä¸‹é¢éœ€è¦è¿›ä¸€æ­¥æå–å‡ºå½“å‰è½¦è¾†æ‰€åœ¨çš„è½¦é“çº¿ä¿¡æ¯ã€‚æˆ‘ä»¬æš‚æ—¶å‡è®¾ç›¸æœºä½äºè½¦è¾†æ­£ä¸­ï¼Œä¸”ç›¸æœºè§†è§’ä¸­å¿ƒå¤„äºè½¦è¾†æ­£å‰æ–¹ï¼Œä¸”å½“å‰è½¦é“ä¸ºç›´çº¿è½¦é“ã€‚å› æ­¤å¯¹äºå½“å‰è½¦é“çº¿æå–ï¼Œæˆ‘ä»¬æ„Ÿå…´è¶£çš„å›¾åƒåŒºåŸŸå¦‚ä¸‹å›¾çº¢è‰²åŒºåŸŸæ‰€ç¤ºï¼š ä¸‹é¢æˆ‘ä»¬éœ€è¦å°†æ„Ÿå…´è¶£åŒºåŸŸç­›é€‰ä¸é¢œè‰²é€‰æ‹©ç»“åˆèµ·æ¥ï¼Œå¯¹ç»è¿‡é¢œè‰²é€‰æ‹©å¾—åˆ°çš„åƒç´ ä¿¡æ¯è¿›è¡ŒåŒºåŸŸç­›é€‰ï¼Œå¹¶å°†ç¬¦åˆæ¡ä»¶çš„åƒç´ ç½®ä¸ºçº¢è‰²ï¼Œå³å¯å¾—åˆ°å½“å‰è½¦é“çš„è½¦é“çº¿ä¿¡æ¯ï¼Œå…·ä½“ä»£ç å®ç°è§ä¸‹ä¸€èŠ‚ã€‚ ä»£ç å®è·µPython ä»£ç å¦‚ä¸‹ï¼š # -*- coding: utf-8 -*-#å¯¼å…¥ä¾èµ–åº“import matplotlib.pyplot as pltimport matplotlib.image as mpimgimport numpy as np# åˆ©ç”¨matplotlib.imageè¯»å–å›¾ç‰‡æ•°æ®ï¼Œå¹¶æ‰“å°å‡ºå›¾åƒçš„æ•°æ®ç±»å‹å’Œæ•°æ®ç»´åº¦image = mpimg.imread(test.jpg)print(This image is: ,type(image), # å°†ä¼šè¾“å‡ºclass numpy.ndarray with dimensions:, image.shape) # å°†ä¼šè¾“å‡º(540, 960, 3)# Grab the x and y size and make a copy of the imageysize = image.shape[0] # image heightxsize = image.shape[1] # image width# Note: always make a copy rather than simply using =color_select = np.copy(image)line_image = np.copy(image)# Define our color selection criteriared_threshold = 200green_threshold = 200blue_threshold = 200# åˆ©ç”¨ä¸Šè¿°ä¸‰ä¸ªé˜ˆå€¼ç”Ÿæˆrgb_thresholdé˜ˆå€¼ ã€‚rgb_threshold = [red_threshold, green_threshold, blue_threshold]# Define a triangle region of interest (Note: if you run this code, # Keep in mind the origin (x=0, y=0) is in the upper left in image processingleft_bottom = [0, 539] #ä¸‰è§’åŒºåŸŸçš„å·¦ä¸‹è§’right_bottom = [900, 539] #ä¸‰è§’åŒºåŸŸçš„å³ä¸‹è§’apex = [475, 320] #ä¸‰è§’åŒºåŸŸçš„é¡¶ç‚¹# åˆ©ç”¨polyfitå‡½æ•°æ ¹æ®ç›´çº¿çš„ä¸¤ä¸ªç«¯ç‚¹å¾—åˆ°è¿çº¿ï¼Œè¾“å…¥å‚æ•°â€œ1â€è¡¨ç¤ºæ›²çº¿æœ€é«˜é˜¶æ•°ä¸º1ï¼ˆç›´çº¿ï¼‰# å¾—åˆ°ç›´çº¿ ax+b çš„å‚æ•° aå’Œbfit_left = np.polyfit((left_bottom[0], apex[0]), (left_bottom[1], apex[1]), 1)fit_right = np.polyfit((right_bottom[0], apex[0]), (right_bottom[1], apex[1]), 1)fit_bottom = np.polyfit((left_bottom[0], right_bottom[0]), (left_bottom[1], right_bottom[1]), 1)# é€‰å‡ºä½äºé˜ˆå€¼çš„åƒç´ å¹¶å°†å®ƒä»¬çš„å€¼ç½®ä¸º0ï¼ˆé»‘è‰²ï¼‰ï¼Œå¯¹é«˜äºé˜ˆå€¼çš„åƒç´ è¿›è¡Œä¿ç•™.# Identify pixels below the thresholdcolor_thresholds = (image[:,:,0] rgb_threshold[0]) \\ | (image[:,:,1] rgb_threshold[1]) \\ | (image[:,:,2] rgb_threshold[2])color_select[color_thresholds] = [0,0,0] # to black# Find the region inside the linesXX, YY = np.meshgrid(np.arange(0, xsize), np.arange(0, ysize))region_thresholds = (YY (XX*fit_left[0] + fit_left[1])) \\ (YY (XX*fit_right[0] + fit_right[1])) \\ (YY (XX*fit_bottom[0] + fit_bottom[1]))# Find where image is both colored right and in the region# å°†åŸå›¾ä¸­å¤§äºç­‰äºé¢œè‰²é€‰æ‹©é˜ˆå€¼ä¸”ä½äºæ„Ÿå…´è¶£åŒºåŸŸä¸­çš„åƒç´ è®¾ç½®ä¸ºçº¢è‰²ã€‚line_image[~color_thresholds region_thresholds] = [255,0,0]# Display our two output imagesï¼ˆé‡åˆæ˜¾ç¤ºï¼‰#plt.imshow(color_select)plt.imshow(line_image)plt.show()12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758 ç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Canny è¾¹ç¼˜æ£€æµ‹é—®é¢˜èƒŒæ™¯åŸºäºé¢œè‰²é€‰æ‹©åŸç†æ¥æå–å•ä¸€é¢œè‰²ï¼ˆå¦‚ç™½è‰²ï¼‰çš„è½¦é“çº¿å¯¹äºè‡ªåŠ¨é©¾é©¶æ¥è¯´æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œå› ä¸ºè½¦é“çº¿ä¸æ˜¯åªæœ‰ä¸€ç§é¢œè‰²ï¼Œè€Œä¸”å³ä½¿æ˜¯åŒä¸€é¢œè‰²çš„è½¦é“çº¿ä¹Ÿå¯èƒ½ä¼šå› ä¸ºä¸åŒçš„å…‰çº¿æ¡ä»¶ï¼ˆå¦‚ç™½å¤©ã€å¤œæ™šï¼‰è€Œå…·æœ‰ä¸åŒçš„é¢œè‰²ï¼Œä»è€Œå¯¼è‡´æ£€æµ‹å¤±è´¥ã€‚ ä¸ºäº†è®©æˆ‘ä»¬çš„ ç®—æ³• å¯ä»¥æå–ä»»æ„é¢œè‰²çš„è½¦é“çº¿ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥å¤æ‚çš„è®¡ç®—æœºè§†è§‰æ–¹æ³•ã€‚ åé¢çš„è¯¾ç¨‹æˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»ä¸€äº›è®¡ç®—æœºè§†è§‰æŠ€æœ¯ï¼Œå¹¶ä¸”è®©ä½ ç›´è§‚åœ°è®¤è¯†åˆ°å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æˆ‘ä»¬ä¼šåˆ©ç”¨ OpenCV ä½¿ç”¨è¿™äº›ç®—æ³•ï¼Œå¹¶è¿›ä¸€æ­¥å®ç°è½¦é“çº¿æå–åŠŸèƒ½ã€‚å…³äºè®¡ç®—æœºè§†è§‰æŠ€æœ¯çš„å…¨é¢è®²è§£ï¼Œè¯·å‚è€ƒä¼˜è¾¾å­¦åŸçš„å…è´¹è¯¾ç¨‹ï¼š Introduction to Computer Vision ã€‚åœ¨æœ¬è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Python ç‰ˆæœ¬çš„ OpenCV å®Œæˆè®¡ç®—æœºè§†è§‰ç®—æ³•ç›¸å…³çš„å·¥ä½œã€‚OpenCV è¡¨ç¤ºâ€œOpen-Source Computer Visionâ€ï¼Œå³å¼€æºçš„è®¡ç®—æœºè§†è§‰ã€‚OpenCV åŒ…å«äº†å¤§é‡çš„è®¡ç®—æœºè§†è§‰ç®—æ³• å‡½æ•° åº“å¯ä¾›ä½¿ç”¨ï¼Œå…³äºå…¶è¯¦ç»†ä»‹ç»è¯·ç§»æ­¥ OpenCVå®˜ç½‘ ã€‚ è¦å®‰è£… Python ä¸‹çš„ OpenCV å¯ä»¥åœ¨å‘½ä»¤è¡Œåˆ©ç”¨å¦‚ä¸‹å‘½ä»¤é€šè¿‡æ¸…åé•œåƒæºä¸‹è½½å®‰è£…ï¼špip install opencv-python -i https://pypi.tuna.tsinghua.edu.cn/simple æœ¬èŠ‚ä¸­æˆ‘ä»¬è¦è®²çš„è®¡ç®—æœºè§†è§‰ç®—æ³•æ˜¯ Canny è¾¹ç¼˜æ£€æµ‹ã€‚ Canny è¾¹ç¼˜æ£€æµ‹åŸç†ç®€å•æ¥è¯´ï¼ŒCanndy è¾¹ç¼˜æ£€æµ‹çš„ç®—æ³•åŸç†æ˜¯ï¼š é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†å½©è‰²å›¾åƒè½¬æ¢ä¸º ç°åº¦å›¾åƒ ï¼Œä¹Ÿå°±æ˜¯å°†å½©è‰²å›¾åƒçš„ä¸‰ä¸ªé€šé“è½¬æ¢ä¸ºä¸€ä¸ªé€šé“ï¼Œæ¯ä¸ªåƒç´ å¯¹åº”ä¸€ä¸ª 0 åˆ° 255 çš„æ•´æ•°å€¼ç”¨äºè¡¨ç¤ºç°åº¦å¤§å°ã€‚ ç„¶ååˆ©ç”¨é«˜æ–¯æ»¤æ³¢å™¨å¯¹å›¾åƒè¿›è¡Œé«˜æ–¯æ¨¡ç³Šå»å™ªï¼ˆå…³äºé«˜æ–¯æ¨¡ç³Šï¼Œå¯ä»¥å‚è€ƒ OpenCV gaussianbluræ–‡æ¡£ ï¼‰ã€‚ éšåå¯¹å»å™ªåçš„ç°åº¦å›¾è®¡ç®— æ¢¯åº¦ ï¼ˆgradientï¼‰ï¼Œå¾—åˆ°å›¾åƒä¸­æ¯ä¸ªåƒç´ ç‚¹å¯¹åº”çš„å¼ºåº¦æ¢¯åº¦ã€‚æ¢¯åº¦å€¼ä»£è¡¨äº†è¯¥åƒç´ ç‚¹ä¸å‘¨å›´åƒç´ å€¼çš„å˜åŒ–å…³ç³»ï¼Œå˜åŒ–è¶Šå¤§åˆ™æ¢¯åº¦å€¼è¶Šå¤§ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å›¾åƒä¸­ç‰©ä½“çš„è¾¹ç¼˜é€šå¸¸ä¼šè¡¨ç°å‡ºè¾ƒå¤§çš„æ¢¯åº¦å€¼ã€‚ Canny ç®—æ³•å¯ä»¥ä»æ¢¯åº¦å›¾åƒä¸­æå–å‡ºåƒç´ æ¢¯åº¦å¤§å°å¤„äºä¸€å®šèŒƒå›´çš„è¾¹ç•Œç‚¹é›†åˆï¼Œå¹¶é’ˆå¯¹è¾ƒç²—çš„è¾¹ç¼˜ï¼Œåˆ©ç”¨éæå¤§å€¼æŠ‘åˆ¶ç®—æ³•ï¼Œè¿‡æ»¤æ‰è¾¹ç¼˜é™„è¿‘çš„éƒ¨åˆ†åƒç´ ï¼Œä»è€Œåªä¿ç•™å›¾åƒä¸­ä½äºå®é™…è¾¹ç¼˜çš„è¾ƒç»†çš„è¾¹ç¼˜çº¿ã€‚ å…³äº OpenCV ä¸­ Canny ç®—æ³•çš„è¯¦ç»†åŸç†è¯´æ˜ï¼Œè¯·å‚è€ƒ OpenCV Canny æ–‡æ¡£ ã€‚ æˆ‘ä»¬å³å°†ä½¿ç”¨çš„ OpenCV çš„ Canny ç®—æ³•å‡½æ•°æ¥å£å®šä¹‰å¦‚ä¸‹ï¼šedges=cv2.Canny(image, low_threshold, high_threshold)è¯¥å‡½æ•°èƒ½å¤Ÿåˆ©ç”¨ Canny ç®—æ³•æ£€æµ‹è¾“å…¥å›¾åƒ image ä¸­çš„è¾¹ç¼˜ï¼Œå¹¶å°†å®ƒä»¬æ ‡è®°åœ¨è¾“å‡ºå›¾åƒ edges ä¸­ï¼Œ edges ä¸ image å…·æœ‰ç›¸åŒçš„å°ºå¯¸ã€‚ å…³äº 2 ä¸ªé˜ˆå€¼å‚æ•°ï¼š ä½äºé˜ˆå€¼ low_threshold çš„åƒç´ ç‚¹ä¼šè¢«è®¤ä¸ºä¸æ˜¯è¾¹ç¼˜ã€‚ é«˜äºé˜ˆå€¼ high_threshold çš„åƒç´ ç‚¹ä¼šè¢«è®¤ä¸ºæ˜¯è¾¹ç¼˜ã€‚ åœ¨é˜ˆå€¼ low_threshold å’Œé˜ˆå€¼ high_threshold ä¹‹é—´çš„åƒç´ ç‚¹ï¼Œè‹¥ä¸ç¬¬ 2 æ­¥å¾—åˆ°çš„è¾¹ç¼˜åƒç´ ç‚¹ç›¸é‚»ï¼Œåˆ™è¢«è®¤ä¸ºæ˜¯è¾¹ç¼˜ï¼Œå¦åˆ™è¢«è®¤ä¸ºä¸æ˜¯è¾¹ç¼˜ã€‚ æ³¨æ„ï¼šåœ¨ OpenCV Canny æ–‡æ¡£ ä¸­ï¼Œå»ºè®®é˜ˆå€¼ low_threshold å’Œé˜ˆå€¼ high_threshold çš„æ¯”ç‡åœ¨ 1:2 å’Œ 1:3 ä¹‹é—´ã€‚ å…³äºè¯¥å‡½æ•°çš„å®Œæ•´æ¥å£è¯´æ˜ï¼Œè¯·å‚è€ƒ OpenCV APIæ–‡æ¡£ ã€‚ ä»£ç å®è·µä¸‹é¢æˆ‘ä»¬å°†åˆ©ç”¨ä¸‹é¢è¿™å¹…å›¾åƒå±•ç¤ºå¦‚ä½•åˆ©ç”¨ Canny ç®—æ³•å¯¹å›¾åƒè¿›è¡Œè¾¹ç¼˜æ£€æµ‹ã€‚Python ä»£ç å¦‚ä¸‹ï¼š # -*- coding: utf-8 -*-#å¯¼å…¥ä¾èµ–åº“import matplotlib.pyplot as pltimport matplotlib.image as mpimgimport numpy as npimport cv2# Read in the image and convert to grayscaleimage = mpimg.imread(exit-ramp.jpg)gray = cv2.cvtColor(image, cv2.COLOR_RGB2GRAY)# Define a kernel size for Gaussian smoothing / blurring# Note: this step is optional as cv2.Canny() applies a 5x5 Gaussian internallykernel_size = 5blur_gray = cv2.GaussianBlur(gray,(kernel_size, kernel_size), 0)# Define parameters for Canny and run itlow_threshold = 50high_threshold = 150edges = cv2.Canny(blur_gray, low_threshold, high_threshold)# Display the imageplt.imshow(edges, cmap=Greys_r)123456789101112131415161718192021222324 ç¨‹åºè¿è¡Œå¾—åˆ°çš„è¾¹ç¼˜æ£€æµ‹ç»“æœå¦‚ä¸‹ï¼š éœå¤«å˜æ¢ï¼ˆHough Transformï¼‰æœ¬èŠ‚æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åˆ©ç”¨éœå¤«å˜æ¢ä» Canny è¾¹ç¼˜ä¸­æ‰¾åˆ°è½¦é“çº¿ã€‚ ç›®å‰æˆ‘ä»¬å·²ç»å¾—åˆ°äº† Canny ç®—æ³•æ£€æµ‹åˆ°çš„è¾¹ç¼˜ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ä¸€ç§æ–¹æ³•å°†è¿™äº›ç‚¹ä¸­å‘ˆç°ä¸ºç›´çº¿çš„è½¦é“çº¿æ‰¾å‡ºæ¥ï¼Œè¿™å¯ä»¥é€šè¿‡ éœå¤«å˜æ¢ æ¥å®ç°ã€‚ ç†è®ºåŸºç¡€éœå¤«å˜æ¢çš„ç®—æ³•æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼šç»™å®šä¸€ä¸ªç‰©ä»¶ã€è¦è¾¨åˆ«çš„å½¢çŠ¶çš„ç§ç±»ï¼Œç®—æ³•ä¼šåœ¨å‚æ•°ç©ºé—´(parameter space)ä¸­æ‰§è¡ŒæŠ•ç¥¨æ¥å†³å®šç‰©ä½“çš„å½¢çŠ¶ï¼Œè€Œè¿™æ˜¯ç”±ç´¯åŠ ç©ºé—´(accumulator space)é‡Œçš„å±€éƒ¨æœ€å¤§å€¼(local maximum)æ¥å†³å®šã€‚å…³äºéœå¤«å˜æ¢çš„è¯¦ç»†è¯´æ˜ï¼Œè¯·å‚è€ƒ éœå¤«å˜æ¢-ç™¾åº¦ç™¾ç§‘ ã€‚ å¯¹äºæˆ‘ä»¬éœ€è¦è§£å†³çš„è½¦é“çº¿é—®é¢˜ï¼Œåœ¨å›¾åƒç©ºé—´ï¼ˆ Image Spaceï¼‰ä¸­æˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºç›´çº¿ï¼Œå½¢å¼ä¸ºï¼š $$y = m 0 x + b 0 y=m_0 x+b_0 y=m0â€‹x+b0â€‹ $$ è€Œåœ¨å¯¹åº”çš„éœå¤«ç©ºé—´ï¼ˆHough Spaceï¼Œä¹Ÿå¯ä»¥ç®€å•å°†å…¶ç†è§£ä¸ºâ€œå‚æ•°ç©ºé—´â€ï¼‰ä¸­ï¼Œç›¸åº”çš„ç›´çº¿å¯ä»¥ç›´æ¥ç”¨ $m 0 m_0 m0â€‹$ å’Œ $b 0 b_0 b0â€‹$ çš„ç»„åˆæ¥è¡¨ç¤ºã€‚äºæ˜¯ç»è¿‡éœå¤«å˜æ¢ï¼Œå›¾åƒç©ºé—´ä¸­çš„ä¸€æ¡ç›´çº¿å°†è¢«è½¬æ¢ä¸ºéœå¤«ç©ºé—´ä¸­çš„ä¸€ä¸ªç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ åŒç†ï¼Œæœ‰ï¼š å›¾åƒç©ºé—´ä¸­çš„ç‚¹ $( x , y ) (x,y) (x,y)$ å¯¹åº”éœå¤«ç©ºé—´ä¸‹çš„ç›´çº¿ $b = y âˆ’ x m b=y-xm b=yâˆ’xm$ ã€‚ éœå¤«ç©ºé—´ä¸‹çš„ä¸¤æ¡ç›´çº¿çš„äº¤ç‚¹å¯¹åº”å›¾åƒç©ºé—´ä¸­çš„ä¸€æ¡ç›´çº¿ï¼Œè¯¥ç›´çº¿ä¸Šå­˜åœ¨ä¸¤ä¸ªç‚¹åˆ†åˆ«ä¸éœå¤«ç©ºé—´ä¸­çš„ä¸¤æ¡ç›´çº¿å¯¹åº”ã€‚ å›¾åƒç©ºé—´ä¸­çš„ä¸€æ¡ç›´çº¿çš„å¤šä¸ªç‚¹ï¼Œå¯¹åº”éœå¤«ç©ºé—´ä¸­çš„å¤šæ¡ç›´çº¿ç›¸äº¤äºä¸€ç‚¹ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ã€‚ æˆ‘ä»¬çŸ¥é“ï¼ŒCanny è¾¹ç¼˜æ£€æµ‹å¾—åˆ°çš„ç»“æœæ˜¯å›¾åƒä¸­æ‰€æœ‰è¢«è§†ä¸ºè¾¹ç¼˜çš„ ç‚¹ ï¼Œè¿™äº›ç‚¹ä¹Ÿå°±å¯¹åº”äºéœå¤«ç©ºé—´ä¸­çš„å¤šæ¡ ç›´çº¿ ã€‚è¦æƒ³æå–å‡ºå›¾åƒç©ºé—´ä¸­å¤„äºåŒä¸€ç›´çº¿ä¸Šçš„ç‚¹ï¼Œä¹Ÿå°±æ˜¯éœ€è¦æ‰¾åˆ°éœå¤«ç©ºé—´ä¸­ç›¸äº¤äºä¸€ç‚¹çš„ç›´çº¿ã€‚ ç”±äºç”¨ $y = m x + b y=m x+b y=mx+b$ çš„å½¢å¼è¡¨ç¤ºç›´çº¿ï¼Œä¼šå­˜åœ¨å¹³è¡Œäºyè½´çš„ç›´çº¿æ–œç‡ä¸ºæ— ç©·çš„æƒ…å†µï¼Œå› æ­¤æˆ‘ä»¬é‡‡ç”¨â€œsine Houghâ€ç©ºé—´ç”¨æ¥é¿å…è¿™ä¸€é—®é¢˜ã€‚åœ¨å›¾åƒç©ºé—´ä¸­ï¼Œæˆ‘ä»¬ç”¨ $Ï \\rho Ï$ æ¥è¡¨ç¤ºç›´çº¿åˆ°åŸç‚¹çš„è·ç¦»ï¼Œç”¨ $Î¸ \\theta Î¸$ è¡¨ç¤ºä»xè½´åˆ°ç›´çº¿å‚çº¿çš„è§’åº¦ï¼Œå…·ä½“è¡¨ç¤ºå½¢å¼å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å³åœ¨éœå¤«ç©ºé—´ç”¨å‚æ•° $( Î¸ , Ï ) (\\theta,\\rho) (Î¸,Ï)$ æ¥ä»£æ›¿å‚æ•° $( m , b ) (m,b) (m,b)$ ã€‚ åŸºäºæ­¤ï¼Œå›¾åƒç©ºé—´ä¸­çš„ä¸€ç‚¹å°†å¯¹åº”â€œsine Houghâ€ç©ºé—´ä¸‹çš„ä¸€æ¡æ­£å¼¦æ›²çº¿ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä»£ç å®è·µæˆ‘ä»¬åˆ©ç”¨ OpenCV ä¸­çš„å‡½æ•° HoughLinesP æ¥æå– Canny è¾¹ç¼˜æ£€æµ‹ç»“æœä¸­çš„ç›´çº¿ã€‚è¦å­¦ä¹ å¦‚ä½•ä»å¤´ç¼–å†™éœå¤«å˜æ¢çš„ä»£ç ï¼Œå¯ä»¥å‚è€ƒç½‘ç«™ Understanding Hough Transform With Python ã€‚ è®©æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ OpenCV ä¸­å‡½æ•° HoughLinesP çš„å£°æ˜ï¼š lines = cv2.HoughLinesP(masked_edges, rho, theta, threshold, np.array([]), min_line_length, max_line_gap)12 å…¶ä¸­ï¼Œ masked_edges æ˜¯è¾“å…¥çš„è¾¹ç¼˜å›¾åƒï¼ˆæ¥è‡ª Canny ç®—æ³•è¾“å‡ºï¼‰ï¼Œè¯¥å‡½æ•°çš„è¾“å‡º lines æ˜¯åŒ…å«çº¿æ®µèµ·å§‹ç‚¹ä¿¡æ¯ (x1,y1,x2,y2) çš„æ•°ç»„ã€‚å…¶ä»–å‚æ•°å®šä¹‰äº†æˆ‘ä»¬éœ€è¦çš„æ˜¯ä»€ä¹ˆæ ·çš„çº¿æ®µã€‚é¦–å…ˆï¼Œ rho å’Œ theta åˆ†åˆ«è¡¨ç¤ºéœå¤«å˜æ¢ç®—æ³•ä¸­æ …æ ¼çš„è·ç¦»å’Œè§’åº¦åˆ†è¾¨ç‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨éœå¤«ç©ºé—´ä¸­çš„ $( Î¸ , Ï ) (\\theta,\\rho) (Î¸,Ï)$ åæ ‡ç³»ä¸­å®šä¹‰äº†æ …æ ¼ï¼Œç”¨æ¥è¿‘ä¼¼åŒ–æ±‚è§£ç©ºé—´ä¸­æ›²çº¿çš„äº¤ç‚¹ç­‰ä¿¡æ¯ï¼Œ `rho` çš„å•ä½åº”ä¸ºåƒç´ ï¼Œæœ€å°å€¼ä¸º1ï¼› `theta` çš„å•ä½åº”ä¸ºå¼§åº¦ï¼Œåˆå§‹å€¼é€šå¸¸å¯è®¾ç½®ä¸º1åº¦ï¼ˆpi/180 radï¼‰ã€‚ threshold å‚æ•°æŒ‡å®šç®—æ³•ä¸­æŠ•ç¥¨çš„æœ€å°å€¼ï¼ˆå³ç»™å®šæ …æ ¼ä¸­çš„æ›²çº¿äº¤ç‚¹ä¸ªæ•°ï¼‰ï¼Œåªæœ‰å½“æŸä¸ªæ …æ ¼ä¸­çš„æ›²çº¿äº¤ç‚¹ä¸ªæ•°å¤§äº threshold æ—¶ï¼Œæ‰è®¤ä¸ºå…¶æ˜¯ä¸€æ¡åº”è¯¥è¾“å‡ºçš„çº¿æ®µã€‚ å‚æ•°ä¸­çš„ np.array([]) åªæ˜¯ä¸€ä¸ª placeholderï¼Œä½¿ç”¨æ—¶æ— éœ€ä¿®æ”¹ã€‚å‚æ•° min_line_length æ˜¯ä¸€æ¡è¾“å‡ºçº¿æ®µçš„æœ€å°é•¿åº¦ï¼ˆå•ä½ä¸ºåƒç´ ï¼‰ï¼Œå‚æ•° max_line_gap æ˜¯è¿æ¥ä¸¤ä¸ªç‹¬ç«‹çº¿æ®µæˆä¸ºä¸€æ¡è¾“å‡ºçº¿æ®µçš„æœ€å¤§çº¿æ®µé—´éš”ï¼ˆå•ä½ä¸ºåƒç´ ï¼‰ã€‚ å¦å¤–ï¼Œå‰é¢çš„è¯¾ç¨‹ä¸­æˆ‘ä»¬æ›¾æ‰‹å†™è¿‡ä¸€ä¸ªå›¾åƒä¸­çš„ä¸‰è§’å½¢åŒºåŸŸç­›é€‰ç®—æ³•ï¼Œè¿™ä¸€æ¬¡æˆ‘ä»¬å¯ä»¥ç”¨ OpenCV çš„ cv2.fillPoly() å‡½æ•°æ¥å®ç°å¯¹å››è¾¹å½¢åŒºåŸŸçš„ç­›é€‰ï¼ˆè¯¥å‡½æ•°å…¶å®å¯ä»¥å®ç°å¯¹ä»»æ„å¤æ‚çš„å¤šè¾¹å½¢åŒºåŸŸè¿›è¡Œç­›é€‰ï¼‰ï¼Œå…·ä½“ç”¨æ³•å‚è€ƒä¸‹é¢çš„ä»£ç ã€‚ ä¸‹é¢æ˜¯ Python ä»£ç ï¼Œç¨‹åºæ‰§è¡Œæµç¨‹ä¸»è¦åŒ…æ‹¬ï¼š åŠ è½½å›¾åƒ-ç°åº¦è½¬æ¢-é«˜æ–¯æ¨¡ç³Š-Canny è¾¹ç¼˜æ£€æµ‹-fillPoly ç›®æ ‡åŒºåŸŸç­›é€‰-HoughLinesP ç›´çº¿æå–-ç»“æœå¯è§†åŒ–ã€‚ # -*- coding: utf-8 -*-#å¯¼å…¥ä¾èµ–åº“import matplotlib.pyplot as pltimport matplotlib.image as mpimgimport numpy as npimport cv2# Read in and grayscale the imageimage = mpimg.imread(exit-ramp.jpg)gray = cv2.cvtColor(image,cv2.COLOR_RGB2GRAY)# Define a kernel size and apply Gaussian smoothingkernel_size = 5blur_gray = cv2.GaussianBlur(gray,(kernel_size, kernel_size),0)# Define our parameters for Canny and applylow_threshold = 50high_threshold = 150edges = cv2.Canny(blur_gray, low_threshold, high_threshold)# Next well create a masked edges image using cv2.fillPoly()mask = np.zeros_like(edges) ignore_mask_color = 255 # This time we are defining a four sided polygon to maskimshape = image.shape#vertices = np.array([[(0,imshape[0]),(0, 0), (imshape[1], 0), (imshape[1],imshape[0])]], dtype=np.int32)vertices = np.array([[(0,imshape[0]),(450, 290), (490, 290), (imshape[1],imshape[0])]], dtype=np.int32)cv2.fillPoly(mask, vertices, ignore_mask_color)masked_edges = cv2.bitwise_and(edges, mask)# Define the Hough transform parameters# Make a blank the same size as our image to draw onrho = 2 # distance resolution in pixels of the Hough gridtheta = np.pi/180 # angular resolution in radians of the Hough gridthreshold = 15 # minimum number of votes (intersections in Hough grid cell)min_line_length = 30 #minimum number of pixels making up a linemax_line_gap = 20 # maximum gap in pixels between connectable line segmentsline_image = np.copy(image)*0 # creating a blank to draw lines on# Run Hough on edge detected image# Output lines is an array containing endpoints of detected line segmentslines = cv2.HoughLinesP(masked_edges, rho, theta, threshold, np.array([]), min_line_length, max_line_gap)# Iterate over the output lines and draw lines on a blank imageï¼Œfor line in lines: for x1,y1,x2,y2 in line: cv2.line(line_image,(x1,y1),(x2,y2),(255,0,0),10)# Create a color binary image to combine with line imageï¼ˆå› ä¸ºline_imageä¸ºRGBå›¾åƒï¼‰color_edges = np.dstack((edges, edges, edges)) # Draw the lines on the edge imageã€‚å…¶ä¸­ï¼Œcolor_edgesä¸é€æ˜åº¦0.8ï¼Œline_imageä¸é€æ˜åº¦1.lines_edges = cv2.addWeighted(color_edges, 0.8, line_image, 1, 0) plt.imshow(lines_edges)plt.show()12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758 ç¨‹åºè¿è¡Œåå¾—åˆ°çš„è½¦é“çº¿æå–ç»“æœå¦‚ä¸‹ï¼šç”±ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬é€šè¿‡é€‰å–åˆé€‚çš„ç®—æ³•å‚æ•°ï¼Œä»å›¾åƒä¸­æå–å‡ºäº†å½“å‰è½¦é“çš„è½¦é“çº¿ä¿¡æ¯ã€‚","categories":["3.å¼€å‘æ¡†æ¶","OpenCV"]},{"title":"ã€å¤šä¼ æ„Ÿèåˆã€‘ä¼˜è¾¾å­¦åŸå¤šä¼ æ„Ÿèåˆå­¦ä¹ ç¬”è®°ï¼ˆäº”ï¼‰â€”â€”åˆ©ç”¨YOLOè¿›è¡Œå›¾åƒç›®æ ‡è¯†åˆ«_åŸºäºyolo å›¾åƒ æ¿€å…‰é›·è¾¾ èåˆ-CSDNåšå®¢","path":"/2025/04/25/3-å¼€å‘æ¡†æ¶-OpenCV-ã€å¤šä¼ æ„Ÿèåˆã€‘ä¼˜è¾¾å­¦åŸå¤šä¼ æ„Ÿèåˆå­¦ä¹ ç¬”è®°ï¼ˆäº”ï¼‰â€”â€”åˆ©ç”¨YOLOè¿›è¡Œå›¾åƒç›®æ ‡è¯†åˆ«-åŸºäºyolo-å›¾åƒ-æ¿€å…‰é›·è¾¾-èåˆ-CSDNåšå®¢/","content":"åˆ©ç”¨ YOLO è¿›è¡Œå›¾åƒç›®æ ‡è¯†åˆ«ä¸ºä»€ä¹ˆéœ€è¦ç›®æ ‡æ£€æµ‹ï¼Ÿåœ¨ä¸Šä¸€è¯¾ å°†æ¿€å…‰é›·è¾¾3Dç‚¹äº‘æ˜ å°„åˆ°ç›¸æœºå›¾åƒ ä¸­æˆ‘ä»¬å·²ç»å®ç°äº†å°†æ¿€å…‰é›·è¾¾ 3D ç‚¹äº‘ æ˜ å°„åˆ°ç›¸æœºå›¾åƒä¸­ï¼ˆæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ï¼Œä½†æ˜¯è¦æƒ³è®©æˆ‘ä»¬å¾—åˆ°çš„æ¿€å…‰å’Œç›¸æœºèåˆåçš„ç»“æœæ›´å¥½åœ°æœåŠ¡äºè‡ªåŠ¨é©¾é©¶è½¦è¾†ï¼Œä¾‹å¦‚ï¼Œåº”ç”¨åˆ°å¸¸è§çš„ç¢°è½¬æ—¶é—´ï¼ˆTTCï¼‰ä¼°è®¡ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ç§æŠ€æœ¯æ¥æ£€æµ‹å›¾åƒä¸­çš„è½¦è¾†ç›®æ ‡ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½åˆ†ç¦»å‡ºå›¾åƒä¸­åŒ¹é…çš„å…³é”®ç‚¹ï¼ˆmatched keypointsï¼‰ä»¥åŠæ˜ å°„åœ¨å›¾åƒä¸­çš„æ¿€å…‰é›·è¾¾ç‚¹äº‘ï¼Œå¹¶èƒ½è¿›ä¸€æ­¥å°†å®ƒä»¬ä¸ç‰¹å®šçš„å¯¹è±¡è¿›è¡Œå…³è”ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåˆ©ç”¨å›¾åƒå¤„ç†æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å„ç§ æ£€æµ‹å™¨ ï¼ˆdetectors ï¼‰å’Œ æè¿°å­ ï¼ˆdescriptorsï¼‰æ¥æ£€æµ‹å’ŒåŒ¹é…å›¾åƒä¸­çš„å…³é”®ç‚¹ï¼ˆkeypoints ï¼‰ã€‚ç„¶è€Œï¼Œåœ¨ TTC ä¼°è®¡çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œä¸ºäº†è®¡ç®—è½¦è¾†çš„ç¢°æ’æ—¶é—´ï¼Œæˆ‘ä»¬éœ€è¦åˆ†ç¦»å‡ºè½¦è¾†ç›®æ ‡ä¸Šçš„å…³é”®ç‚¹ï¼Œè¿™æ · TTC ä¼°è®¡å°±ä¸ä¼šå› ä¸ºåŒ…å«äº†å‰æ–¹åœºæ™¯ä¸­è·¯é¢ã€é™æ­¢ç‰©ä½“æˆ–å…¶ä»–è½¦è¾†ä¸Šçš„åŒ¹é…ä¿¡æ¯è€Œå¤±çœŸã€‚å®ç°è¿™ä¸€ç›®çš„çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ç›®æ ‡æ£€æµ‹æ¥è‡ªåŠ¨è¯†åˆ«åœºæ™¯ä¸­çš„è½¦è¾†ã€‚è¿™ç§ ç®—æ³• çš„è¾“å‡ºï¼ˆç†æƒ³æƒ…å†µä¸‹ï¼‰æ˜¯åœºæ™¯ä¸­æ‰€æœ‰å¯¹è±¡å‘¨å›´çš„ä¸€ç»„ 2D è¾¹ç•Œæ¡†ï¼ˆbounding boxesï¼‰ã€‚åŸºäºè¿™äº›è¾¹ç•Œæ¡†ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å°†åŒ¹é…å…³é”®ç‚¹ä¸ç›®æ ‡å¯¹è±¡å…³è”èµ·æ¥ï¼Œä»è€Œè·å¾—ä¸€ä¸ªç¨³å®šçš„ TTC ä¼°è®¡å€¼ã€‚ å¯¹äºæ¿€å…‰é›·è¾¾çš„æµ‹é‡ç»“æœï¼Œå¯ä»¥åº”ç”¨ç›¸åŒçš„åŸç†ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ¿€å…‰é›·è¾¾çš„ 3D ç‚¹äº‘å¯ä»¥é€šè¿‡èšç±»å½¢æˆå•ç‹¬çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ç‚¹äº‘åº“(PCL)ä¸­çš„ç®—æ³•ï¼Œè¿›è¡Œæ¿€å…‰é›·è¾¾ç‚¹äº‘çš„èšç±»å¤„ç†ï¼Œè€Œ PCL åˆ™å¯ä»¥è¢«è¿‘ä¼¼çœ‹ä½œæ˜¯ 3D åº”ç”¨ç¨‹åºçš„ OpenCV åº“ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦ä¸€ç§å°†æ¿€å…‰é›·è¾¾ç‚¹åˆ†èšç±»æˆç›®æ ‡çš„æ–¹æ³•ã€‚æ ¹æ® ä¸Šä¸€èŠ‚çš„è¯¾ç¨‹ ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»æŒæ¡äº†å¦‚ä½•å°†æ¿€å…‰é›·è¾¾ç‚¹æŠ•å°„åˆ°å›¾åƒå¹³é¢ä¸Šï¼Œé‚£ä¹ˆç»™å®šä¸€ç»„å›¾åƒä¸­æ¥è‡ªç›®æ ‡æ£€æµ‹çš„è¾¹ç•Œæ¡†ï¼Œæˆ‘ä»¬è¿™åªéœ€æ£€æŸ¥å®ƒåœ¨æ˜ å°„åˆ°ç›¸æœºå›¾åƒåæ˜¯å¦åœ¨æŸä¸ªè¾¹ç•Œæ¡†ä¸­ï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†ä¸€ä¸ªä¸‰ç»´æ¿€å…‰é›·è¾¾ç‚¹ä¸åœºæ™¯ä¸­çš„ç‰¹å®šç›®æ ‡å…³è”èµ·æ¥ã€‚ æˆ‘ä»¬å°†åœ¨æœ¬èŠ‚åé¢è¯¦ç»†ä»‹ç»è¿™ä¸¤ç§æ–¹æ³•ï¼Œä½†æ˜¯ç°åœ¨ï¼Œè®©æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ç§æ£€æµ‹ç›¸æœºå›¾åƒä¸­ç›®æ ‡çš„æ–¹æ³•â€”â€”è¿™æ˜¯åˆ†ç¦»å‡ºåŒ¹é…å…³é”®ç‚¹å’Œæ¿€å…‰é›·è¾¾ç‚¹äº‘çš„å…ˆå†³æ¡ä»¶ã€‚ä¸‹é¢å°±è®©æˆ‘ä»¬å­¦ä¹ ä¸€ç§â€œ æ£€æµ‹å’Œåˆ†ç±»å¯¹è±¡ â€çš„æ–¹æ³•ã€‚ YOLO ç®€ä»‹æœ¬èŠ‚çš„ç›®çš„æ˜¯ä½¿ä½ èƒ½å¤Ÿå¿«é€Ÿåœ°åˆ©ç”¨ä¸€ä¸ªå¼ºå¤§å’Œå…ˆè¿›çš„å·¥å…·è¿›è¡Œç›®æ ‡æ£€æµ‹ã€‚æœ¬æ–‡çš„ç›®çš„ä¸æ˜¯åœ¨ç†è®ºä¸Šæ·±å…¥ç ”ç©¶è¿™äº›ç®—æ³•çš„å†…éƒ¨å·¥ä½œåŸç†ï¼Œè€Œæ˜¯è®©æ‚¨èƒ½å¤Ÿå¿«é€Ÿå°†ç›®æ ‡æ£€æµ‹é›†æˆåˆ°æœ¬è¯¾ç¨‹çš„ä»£ç æ¡†æ¶ä¸­ã€‚ä¸‹é¢çš„å›¾åƒæ˜¾ç¤ºäº†æˆ‘ä»¬å°†åœ¨æœ¬èŠ‚ä¸­å¼€å‘çš„ä»£ç çš„ç¤ºä¾‹è¾“å‡ºã€‚ YOLOå®˜ç½‘ æ³¨ï¼šä¸Šé¢çš„å›¾ç‰‡æ”¹ç¼–è‡ª å¼€æºé¡¹ç›®æºä»£ç  ä¸åŒäº HOGSVM è¿™æ ·åŸºäºåˆ†ç±»å™¨çš„ç³»ç»Ÿï¼ŒYOLO é’ˆå¯¹æ•´ä¸ªå›¾åƒï¼Œå› æ­¤å…¶é¢„æµ‹å€¼ä¾èµ–äºæ•´ä¸ªå›¾åƒçš„å…¨éƒ¨å†…å®¹ã€‚å®ƒçš„é¢„æµ‹åªç”¨äº†å•å±‚ç½‘ç»œæ¨¡å‹ï¼Œè€Œä¸åƒ R-CNN ç³»ç»Ÿé‚£æ ·ä¾èµ–ä¸Šåƒå±‚ç½‘ç»œæ¨¡å‹ã€‚è¿™ä½¿å¾— YOLO åœ¨è¾“å‡ºç±»ä¼¼é¢„æµ‹ç»“æœçš„æ¡ä»¶ä¸‹ï¼Œå…·æœ‰æå¿«çš„é¢„æµ‹é€Ÿåº¦ã€‚YOLO çš„åˆ›é€ è€…ä¹Ÿæä¾›äº†ä¸€ç³»åˆ—åŸºäº COCOæ•°æ®é›† è¿›è¡Œé¢„è®­ç»ƒå¾—åˆ°çš„æƒé‡ï¼Œä½¿å½“å‰ç‰ˆæœ¬ YOLOv3 èƒ½å¤Ÿè¯†åˆ«å›¾åƒå’Œå›¾åƒä¸­çš„ 80 ç§ä¸åŒç›®æ ‡ã€‚è¿™æ„å‘³ç€ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ YOLOv3 ä½œä¸ºä¸€ä¸ªâ€œå¼€ç®±å³ç”¨çš„â€åˆ†ç±»å™¨ï¼Œæ¥ç›¸å¯¹å‡†ç¡®åœ°æ£€æµ‹å›¾åƒä¸­çš„æ±½è½¦åŠå…¶ä»–ç›®æ ‡ã€‚ YOLOv3 ç›®æ ‡è¯†åˆ«å·¥ä½œæµç¨‹æœ¬èŠ‚ï¼Œæˆ‘ä»¬å°†çœ‹ä¸€ä¸‹é’ˆå¯¹æœ¬è¯¾ç¨‹çš„å›¾åƒæ•°æ®é›†ï¼Œæ‰§è¡Œ YOLO æ‰€éœ€çš„æ­¥éª¤ã€‚ä¸‹é¢æåˆ°çš„å‚æ•°æ˜¯è¯¾ç¨‹ä½œè€…æ¨èçš„ã€‚ä¸‹é¢æ˜¯ä¸»è¦ç®—æ³•æµç¨‹ï¼š é¦–å…ˆï¼Œå›¾åƒè¢«åˆ†æˆ 13 13 åƒç´ çš„æ …æ ¼å•å…ƒã€‚åŸºäºè¾“å…¥å›¾åƒçš„å°ºå¯¸ï¼Œè¿™äº›æ …æ ¼å•å…ƒçš„å°ºå¯¸ä¹Ÿåº”è¯¥ç›¸åº”å˜åŒ–ã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œä¸€ä¸ª 416 416 åƒç´ çš„å›¾åƒï¼Œå¯¹åº”çš„æ …æ ¼å•å…ƒå°ºå¯¸ä¸º 32*32 åƒç´ ã€‚ å¦‚ä¸‹æ–¹åŸç†å›¾æ‰€ç¤ºï¼Œæ¯ä¸ªæ …æ ¼å•å…ƒç”¨äºé¢„æµ‹ä¸€ç³»åˆ—çš„ bounding boxã€‚å¯¹äºæ¯ä¸ª bounding boxï¼Œç½‘ç»œä¹Ÿä¼šé¢„æµ‹è¯¥ box åŒ…å«æŸä¸ªç‰¹å®šç›®æ ‡çš„ç½®ä¿¡åº¦ï¼Œä»¥åŠè¯¥ç›®æ ‡å±äºå“ªç§ç§ç±»çš„æ¦‚ç‡ï¼ˆä¾æ® COCO æ•°æ®é›†ï¼‰ã€‚ æœ€åï¼Œè¿›è¡Œéæå¤§å€¼æŠ‘åˆ¶ ï¼ˆnon-maximum suppressionï¼‰ï¼Œç”¨äºæ’é™¤å…·æœ‰ä½ç½®ä¿¡åº¦çš„ bounding box ä»¥åŠåŒ…å«äº†åŒä¸€ç›®æ ‡çš„å¤šä½™ boxã€‚ ä¸‹é¢è¾ƒä¸ºè¯¦ç»†åœ°å±•ç¤ºäº†ç¨‹åºå·¥ä½œæµç¨‹å¯¹åº”çš„ä»£ç ã€‚æ­¥éª¤ 1:å‚æ•°åˆå§‹åŒ–YOLOv3 é¢„æµ‹çš„æ¯ä¸ª bounding box éƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„ç½®ä¿¡åº¦ã€‚å‚æ•° confThreshold ç”¨äºç§»é™¤ä½ç½®ä¿¡åº¦çš„ bounding boxã€‚ç„¶åï¼Œéæå¤§å€¼æŠ‘åˆ¶ï¼ˆNMSï¼‰ç”¨é‚£ä¸ªä¸ä¿ç•™ bounding boxï¼ŒNMS è¿‡ç¨‹å—å‚æ•° nmsThreshold æ§åˆ¶ã€‚è¾“å…¥å›¾åƒçš„è€Œå¤§å°å—å‚æ•° inpWidth å’Œ inpWidth æ§åˆ¶ï¼ŒYOLO ä½œè€…å°†å…¶å‡è®¾ç½®ä¸º 416ã€‚è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å…¶æ”¹ä¸º 320ï¼ˆæ›´å¿«ï¼‰æˆ– 608ï¼ˆæ›´æ…¢ï¼‰ã€‚æ­¥éª¤ 2ï¼šå‡†å¤‡æ¨¡å‹æ–‡ä»¶ yolov3.weights åŒ…å« YOLO ä½œè€…æä¾›çš„é¢„è®­ç»ƒç½‘ç»œçš„æƒé‡ï¼Œå¯ä»¥é€šè¿‡ æ­¤é“¾æ¥ ä¸‹è½½ã€‚ ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•åŠ è½½æ¨¡å‹æƒé‡ä»¥åŠç›¸å…³çš„æ¨¡å‹é…ç½®ã€‚ // load image from file cv::Mat img = cv::imread(./images/img1.png); // load class names from file string yoloBasePath = ./dat/yolo/; string yoloClassesFile = yoloBasePath + coco.names; string yoloModelConfiguration = yoloBasePath + yolov3.cfg; string yoloModelWeights = yoloBasePath + yolov3.weights; vectorstring classes; ifstream ifs(yoloClassesFile.c_str()); string line; while (getline(ifs, line)) classes.push_back(line); // load neural network cv::dnn::Net net = cv::dnn::readNetFromDarknet(yoloModelConfiguration, yoloModelWeights); net.setPreferableBackend(cv::dnn::DNN_BACKEND_OPENCV); net.setPreferableTarget(cv::dnn::DNN_TARGET_CPU);123456789101112131415161718 åŠ è½½äº†ç½‘ç»œä¹‹åï¼ŒDNN backend è¢«è®¾ç½®ä¸º DNN_BACKEND_OPENCV ã€‚å¦‚æœ OpenCV å·²ç»ç»è¿‡ Intel çš„ Inference å¼•æ“ç¼–è¯‘ï¼Œåˆ™åº”è¯¥å°†å…¶è®¾ç½®ä¸º DNN_BACKEND_INFERENCE_ENGINE ã€‚ åœ¨ä»£ç ä¸­ï¼Œç›®æ ‡è¢«è®¾ç½®ä¸ºäº† CPUï¼Œå¦‚æœè¦ä½¿ç”¨ï¼ˆIntelï¼‰GPUï¼Œåˆ™åº”è¯¥å°† DNN_TARGET_CPU è®¾ç½®ä¸º DNN_TARGET_OPENCL ã€‚** æ­¥éª¤ 3ï¼šä»è¾“å…¥å›¾åƒä¸­ç”Ÿæˆ 4D Blob ** å½“æ•°æ®æµè¿›å…¥ç½‘ç»œæ¨¡å‹ï¼ŒYOLO ä»¥â€œBlobsâ€ä½œä¸ºä¿å­˜ã€é€šä¿¡ã€æ“ä½œä¿¡æ¯çš„åŸºæœ¬å•å…ƒï¼šblob æ˜¯ç”¨äºè®¸å¤šæ¡†æ¶ï¼ˆå¦‚ Caffeï¼‰çš„æ ‡å‡†åºåˆ—ï¼ˆ array ï¼‰å’Œç»Ÿä¸€å­˜å‚¨æ¥å£ã€‚ä¸€ä¸ª Blob æ˜¯ä¸€ä¸ªæä¾›å®é™…æ•°æ®å¤„ç†ã€äº¤äº’ï¼Œä»¥åŠ CPU å’Œ GPU ä¹‹é—´æ•°æ®åŒæ­¥çš„åŒ…è£…å™¨ ï¼ˆwrapperï¼‰ã€‚æ•°å­¦ä¸Šï¼Œä¸€ä¸ª blob æ˜¯ä»¥ C-contiguous æ–¹å¼å­˜å‚¨çš„ä¸€ä¸ª N ç»´åºåˆ—ï¼ŒN æ˜¯æ•°æ®çš„ batch sizeã€‚å¸¸è§çš„ç”¨äºå›¾åƒæ•°æ® batches çš„ blob ç»´åº¦æ˜¯ æ•°é‡ N * é€šé“ C * é«˜åº¦ H * å®½åº¦ Wã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒN æ˜¯æ•°æ®çš„ batch sizeã€‚åˆ©ç”¨ Batch è¿›è¡Œå¤„ç†å¯ä»¥ä½¿æ•°æ®é€šä¿¡å’Œè®¾å¤‡å¤„ç†è·å¾—æ›´å¥½çš„æ•°æ®ååé‡ã€‚å¯¹äºä¸€ä¸ª 256 ä¸ªå›¾åƒçš„è®­ç»ƒ batchï¼ŒN åº”ä¸º 256. C è¡¨ç¤ºç‰¹å¾ç»´åº¦ï¼Œä¾‹å¦‚å¯¹äº RGB å›¾åƒï¼ŒC3ã€‚åœ¨ OpenCV ä¸­ï¼Œblob è¢«å­˜å‚¨ä¸º 4 ç»´ cv::Mat åºåˆ—ï¼ˆarrayï¼‰ï¼Œç»´åº¦é¡ºåºä¸º NCHWã€‚æ›´å¤šå…³äº blob çš„ä¿¡æ¯å¯ä»¥å‚è€ƒï¼š http://caffe.berkeleyvision.org/tutorial/net_layer_blob.htmlä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº† N2ï¼ŒC16 é€šé“ï¼ŒH5, W4 æ—¶çš„ blob æ•°æ®æƒ…å†µã€‚æ³¨ï¼š å›¾ç‰‡æ¥æº åœ¨ä¸€ä¸ª blob æ•°æ®ç»“æ„ä¸­ï¼Œä½ç½®å€¼ï¼ˆn,c,h,wï¼‰å¯ä»¥é€šè¿‡ä¸‹é¢çš„å…¬å¼è¿›è¡Œè®¿é—®ï¼šb (n, c, h, w) ((n * C + c) * H + h) * W + w ä¸‹æ–¹çš„ä»£ç å±•ç¤ºäº†ä»æ–‡ä»¶ä¸­åŠ è½½çš„å›¾åƒæ•°æ®å¦‚ä½•ä¼ é€’ç»™ blobFromImage å‡½æ•°ä»è€Œè½¬æ¢ä¸ºç”¨äº ç¥ç»ç½‘ç»œ çš„è¾“å…¥ blockã€‚åƒç´ å€¼å¯ä»¥é€šè¿‡ä¹˜ä»¥ä¸€ä¸ªç¼©æ”¾å› å­ 1255ï¼Œæ¥å°†åƒç´ å€¼ç¼©æ”¾åˆ°[0,1]èŒƒå›´ã€‚è€Œä¸”ä»£ç ä¸­è¿˜è°ƒæ•´äº†å›¾åƒå°ºå¯¸ä¸ºï¼ˆ416,416,416ï¼‰ï¼Œä»è€Œä½¿å›¾åƒä¸ä¼šè¢«è£å‰ªã€‚ // generate 4D blob from input image cv::Mat blob; double scalefactor = 1/255.0; cv::Size size = cv::Size(416, 416); cv::Scalar mean = cv::Scalar(0,0,0); bool swapRB = false; bool crop = false; cv::dnn::blobFromImage(img, blob, scalefactor, size, mean, swapRB, crop);12345678 æ¥ä¸‹æ¥çš„ä»£ç ä¸­ï¼Œè¾“å‡ºçš„ blob å°†ä¼šä½œä¸ºç¥ç»ç½‘ç»œçš„è¾“å…¥ã€‚ç„¶åï¼Œä¼šæ‰§è¡Œå‰å‘ä¼ é€’ä»è€Œè·å¾—ä¸€ä¸ªé¢„æµ‹çš„ bounding box ä½œä¸ºç½‘ç»œçš„è¾“å‡ºã€‚è¿™äº› box ç»è¿‡åå¤„ç†æ­¥éª¤ï¼Œæ»¤æ‰äº†å…¶ä¸­å…·æœ‰ä½ç½®ä¿¡åº¦çš„éƒ¨åˆ†ã€‚è¯¦ç»†å†…å®¹è¯·è§ä¸‹ä¸€æ­¥éª¤ã€‚æ­¥éª¤ 4ï¼šæ‰§è¡Œç½‘ç»œçš„å‰å‘ä¼ é€’æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¸Šä¸€æ­¥ä¸­è¾“å‡ºçš„ blob ä½œä¸ºç¥ç»ç½‘ç»œçš„è¾“å…¥ã€‚ç„¶åï¼Œæˆ‘ä»¬è¿è¡Œ forward-function å‡½æ•°æ‰§è¡Œç½‘ç»œçš„å‰å‘ä¼ æ’­è¿‡ç¨‹ã€‚ä¸ºäº†å®ç°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šç½‘ç»œçš„æœ€åä¸€å±‚ï¼Œå¹¶æä¾›ç›¸å…³çš„å‡½æ•°å†…éƒ¨åç§°ã€‚è¿™ä¸€æ­¥é€šè¿‡ getUnconnectedOutLayers å‡½æ•°å®Œæˆï¼Œå®ƒä¼šç»™æœªè¿æ¥çš„ç½‘ç»œè¾“å‡ºå±‚æä¾›åå­—ï¼Œä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å…·ä½“å®ç°ï¼š // Get names of output layers vectorcv::String names; vectorint outLayers = net.getUnconnectedOutLayers(); // get indices of output layers, i.e. layers with unconnected outputs vectorcv::String layersNames = net.getLayerNames(); // get names of all layers in the network names.resize(outLayers.size()); for (size_t i = 0; i outLayers.size(); ++i) // Get the names of the output layers in names names[i] = layersNames[outLayers[i] - 1]; // invoke forward propagation through network vectorcv::Mat netOutput; net.setInput(blob); net.forward(netOutput, names);123456789101112131415 å› æ­¤ï¼Œå‰å‘ä¼ æ’­çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯ç¥ç»ç½‘ç»œçš„è¾“å‡ºæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º Cï¼ˆblob ç±»åˆ«ä¸ªæ•°ï¼‰çš„æ•°ç»„ï¼Œæ¯ä¸ªç±»åˆ«çš„å‰å››ä¸ªå€¼åˆ†åˆ«ä¸º bounding box çš„ x ä¸­å¿ƒã€y ä¸­å¿ƒã€å®½åº¦ã€é«˜åº¦ï¼›ç¬¬äº”ä¸ªå€¼è¡¨ç¤ºè¯¥ bounding box åŒ…å«ä¸€ä¸ªç›®æ ‡çš„ç½®ä¿¡åº¦ï¼›å‰©ä½™çš„çŸ©é˜µå…ƒç´ æ˜¯å¯¹åº” coco.cfg æ–‡ä»¶ä¸­æ¯ä¸ªç›®æ ‡ç±»åˆ«çš„ç½®ä¿¡åº¦ã€‚éšåï¼Œåœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†æ¯ä¸ª box éƒ½å…³è”åˆ°äº†ç½®ä¿¡åº¦æœ€é«˜çš„ç›®æ ‡ç±»åˆ«ä¸Šã€‚ ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•éå†ç½‘ç»œç»“æœå¹¶ä¸”å°†å…·æœ‰è¶³å¤Ÿé«˜ç½®ä¿¡åº¦çš„ bounding box èšåˆä¸ºä¸€ä¸ªå‘é‡ã€‚å‡½æ•° cv::minMaxLoc å‹‡äºæ‰¾åˆ°å…ƒç´ ä¸­çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œä»¥åŠå®ƒä»¬åœ¨å‘é‡ä¸­å¯¹åº”çš„ä½ç½®ã€‚ // Scan through all bounding boxes and keep only the ones with high confidence float confThreshold = 0.20; vectorint classIds; vectorfloat confidences; vectorcv::Rect boxes; for (size_t i = 0; i netOutput.size(); ++i) float* data = (float*)netOutput[i].data; for (int j = 0; j netOutput[i].rows; ++j, data += netOutput[i].cols) cv::Mat scores = netOutput[i].row(j).colRange(5, netOutput[i].cols); cv::Point classId; double confidence; // Get the value and location of the maximum score cv::minMaxLoc(scores, 0, confidence, 0, classId); if (confidence confThreshold) cv::Rect box; int cx, cy; cx = (int)(data[0] * img.cols); cy = (int)(data[1] * img.rows); box.width = (int)(data[2] * img.cols); box.height = (int)(data[3] * img.rows); box.x = cx - box.width/2; // left box.y = cy - box.height/2; // top boxes.push_back(box); classIds.push_back(classId.x); confidences.push_back((float)confidence); 1234567891011121314151617181920212223242526272829303132 æ­¥éª¤ 5ï¼šç½‘ç»œè¾“å‡ºçš„åå¤„ç† é€šå¸¸ï¼Œä¸ºäº†é¿å…å¤šä¸ª box å®é™…åŒ…å«äº†åŒä¸€ç›®æ ‡ï¼Œæˆ‘ä»¬ä¼šåˆ©ç”¨éæå¤§å€¼æŠ‘åˆ¶ç®—æ³•ï¼ˆNMSï¼‰æ¥å»é™¤æ‰å¤šä½™çš„ bounding boxï¼Œå¹¶åªä¿ç•™å…·æœ‰æœ€é«˜ç½®ä¿¡åº¦çš„ boxã€‚OpenCV åº“ æä¾›äº†ä¸€ä¸ªç°æˆçš„å‡½æ•°ç”¨äºå®ç°é‡å  bounding box çš„ NMSã€‚è¯¥å‡½æ•°ä¸º NMSBoxes ï¼Œå…¶è°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š // perform non-maxima suppression float nmsThreshold = 0.4; // Non-maximum suppression threshold vectorint indices; cv::dnn::NMSBoxes(boxes, confidences, confThreshold, nmsThreshold, indices);1234 åº”ç”¨äº† NMS æ“ä½œä¹‹åï¼Œå¤šä½™çš„ bounding box å°†è¢«æˆåŠŸç§»é™¤ã€‚ä¸‹å›¾å±•ç¤ºäº†æœ€ååˆ©ç”¨ YOLOv3 è¿›è¡Œå›¾åƒç›®æ ‡è¯†åˆ«çš„æœ€ç»ˆæ•ˆæœï¼š","categories":["3.å¼€å‘æ¡†æ¶","OpenCV"]},{"title":"ã€å¤šä¼ æ„Ÿèåˆã€‘ä¼˜è¾¾å­¦åŸå¤šä¼ æ„Ÿèåˆå­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰â€”â€”å°†æ¿€å…‰é›·è¾¾3Dç‚¹äº‘æ˜ å°„åˆ°ç›¸æœºå›¾åƒï¼ˆä¸Šï¼‰_æ¿€å…‰é›·è¾¾æŠ•å½±åˆ°å›¾åƒ-CSDNåšå®¢","path":"/2025/04/25/3-å¼€å‘æ¡†æ¶-OpenCV-ã€å¤šä¼ æ„Ÿèåˆã€‘ä¼˜è¾¾å­¦åŸå¤šä¼ æ„Ÿèåˆå­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰â€”â€”å°†æ¿€å…‰é›·è¾¾3Dç‚¹äº‘æ˜ å°„åˆ°ç›¸æœºå›¾åƒï¼ˆä¸Šï¼‰-æ¿€å…‰é›·è¾¾æŠ•å½±åˆ°å›¾åƒ-CSDNåšå®¢/","content":"å°†æ¿€å…‰é›·è¾¾ 3D ç‚¹äº‘æ˜ å°„åˆ°ç›¸æœºå›¾åƒï¼ˆä¸Šï¼‰â€”â€”åŸç†åˆ†æé½æ¬¡åæ ‡ç³»ä¸ºäº†å°†æ¿€å…‰é›·è¾¾ 3D ç‚¹äº‘ æ˜ å°„åˆ°ç›¸æœºäºŒç»´å›¾åƒä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ¬ç³»åˆ—æ•™ç¨‹çš„ç¬¬ä¸€ç¯‡ é’ˆå­”ç›¸æœºæ¨¡å‹ ä¸­å¾—åˆ°çš„å¦‚ä¸‹æŠ•å½±å…¬å¼ï¼šé™¤äº†æ„æˆæŠ•å½±å‡ ä½•å…³ç³»çš„æ‘„åƒæœºè‡ªèº«å‚æ•°å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“å…³äºæ‘„åƒæœºå’Œæ¿€å…‰é›·è¾¾åœ¨å…¬å…±å‚è€ƒåæ ‡ç³»ä¸­çš„ç›¸å¯¹ä½ç½®å…³ç³»ã€‚ä»æ¿€å…‰é›·è¾¾åˆ°ç›¸æœºéœ€è¦ç»è¿‡å¹³ç§»å’Œæ—‹è½¬åæ ‡ç³»è½¬æ¢æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›è½¬æ¢æ“ä½œåº”ç”¨åˆ°æ¯ä¸ª 3D ç‚¹ä¸Šã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ ç®€åŒ–ç”¨æ¥è¡¨ç¤ºæ˜ å°„çš„ç¬¦å· ã€‚é€šè¿‡ä½¿ç”¨ çº¿æ€§å˜æ¢ ï¼Œ3D ç‚¹å¯ä»¥ç”¨å‘é‡æ¥è¡¨ç¤ºï¼Œå…¶å¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾å’Œé€è§†æŠ•å½±ç­‰æ“ä½œå¯ä»¥ç”¨ä¸å‘é‡ç›¸ä¹˜çš„çŸ©é˜µè¡¨ç¤ºã€‚æœ‰äº†ä¸Šè¿°æ–¹æ³•ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¦å¾—åˆ°çš„æŠ•å½±æ–¹ç¨‹ä»…å‰©çš„é—®é¢˜æ˜¯å®ƒä»¬æ¶‰åŠåˆ°å…³äº $Z Z Z$ çš„é™¤æ³•ï¼Œè¿™ä½¿å¾—å®ƒä»¬å˜å¾—éçº¿æ€§çš„ï¼Œä»è€Œå½±å“äº†æˆ‘ä»¬æŠŠå®ƒä»¬è½¬æ¢æˆæ›´åŠ æ–¹ä¾¿çš„çŸ©é˜µå‘é‡å½¢å¼ã€‚ é¿å…è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•å°±æ˜¯ æ”¹å˜åæ ‡ç³» ï¼Œä»æœ€åˆçš„æ¬§å‡ é‡Œå¾—åæ ‡ç³»å˜æˆé½æ¬¡åæ ‡ç³»ã€‚åœ¨è¿™ä¸¤ä¸ªåæ ‡ç³»ä¹‹é—´æ¥å›åˆ‡æ¢çš„æ˜¯ä¸€ä¸ªéçº¿æ€§çš„æ“ä½œï¼Œä½†æ˜¯ä¸€æ—¦æˆ‘ä»¬èº«å¤„é½æ¬¡åæ ‡ç³»ä¸­ï¼Œåƒä¸Šé¢ç»™å‡ºçš„æŠ•å½±å˜æ¢å…³ç³»å°±ä¼šå˜æˆçº¿æ€§çš„ï¼Œè¿™æ ·ä¾¿å¯ä»¥ç”¨ç®€å•çš„çŸ©é˜µ-å‘é‡ä¹˜æ³•æ¥è¡¨ç¤ºã€‚ä¸¤ç§åæ ‡ç³»ä¹‹é—´çš„è½¬æ¢å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ åœ¨ $n n n$ ç»´æ¬§å‡ é‡Œå¾·åæ ‡ç³»ä¸­ï¼Œä¸€ä¸ªç‚¹å¯ä»¥ç”±ä¸€ä¸ª $n n n$ ç»´å‘é‡è¡¨ç¤ºã€‚é€šè¿‡ç®€å•åœ°å°†æ•°å­— $1 1 1$ ä½œä¸ºä¸€ä¸ªé¢å¤–çš„åˆ†é‡å°±å¯ä»¥å°†å…¶è½¬æ¢æˆ $( n + 1 ) (n+1) (n+1)$ ç»´é½æ¬¡åæ ‡ã€‚è¯¥å˜æ¢æ—¢å¯ä»¥åº”ç”¨äºå›¾åƒåæ ‡ï¼Œä¹Ÿå¯ä»¥åº”ç”¨äºåœºæ™¯åæ ‡ã€‚ è¦å°†é½æ¬¡åæ ‡è½¬æ¢å›æ¬§å‡ é‡Œå¾—åæ ‡ç³»ï¼Œåªéœ€è¦å»æ‰å‘é‡ä¸­æœ€åä¸€ä¸ªç»´åº¦åæ ‡ï¼Œå¹¶ç”¨å‰ $n n n$ ä¸ªåæ ‡é™¤ä»¥å»æ‰çš„æœ€åä¸€ä¸ªç»´åº¦åæ ‡ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚å¦‚å‰æ‰€è¿°ï¼Œè¿™æ˜¯ä¸€ä¸ªéçº¿æ€§æ“ä½œï¼Œä¸€æ—¦æˆ‘ä»¬å›åˆ°æ¬§å‡ é‡Œå¾·ç©ºé—´ï¼Œå°±ä¼šå¤±å»å°†ä¸åŒå‚æ•°ç²¾ç¡®åœ°åˆ†ç¦»æˆå•ç‹¬çš„çŸ©é˜µåˆ†é‡ï¼ˆå³çº¿æ€§åŒ–è¡¨ç¤ºåæ ‡ç³»æ˜ å°„å…³ç³»ï¼‰çš„èƒ½åŠ›ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç ”ç©¶è¿™äº›çŸ©é˜µåˆ†é‡ã€‚ å†…å‚ï¼ˆIntrinsic Parametersï¼‰ä¸‹é¢æˆ‘ä»¬å°†ç”¨çŸ©é˜µ-å‘é‡çš„å½¢å¼æ¥è¡¨ç¤ºæŠ•å½±æ–¹ç¨‹ï¼šå¯ä»¥çœ‹å‡ºï¼Œç›¸æœºçš„å†…åœ¨å‚æ•°ï¼ˆIntrinsic Parametersï¼Œç®€ç§°å†…å‚ï¼‰è¢«æå–åˆ°ä¸€ä¸ªçŸ©é˜µä¸­ï¼Œè¿™æ ·å¯ä»¥ç”¨ä¸€ç§éå¸¸ç®€æ´çš„æ–¹å¼è¡¨ç¤ºæˆ‘ä»¬çš„é’ˆå­”ç›¸æœº æ¨¡å‹ çš„ä¸€èˆ¬å±æ€§ã€‚æ›´åŠ å¤æ‚çš„ç›¸æœºæ¨¡å‹å±æ€§ï¼Œå¦‚æ­ªæ–œï¼ˆskewnessï¼‰æˆ–å‰ªåˆ‡ï¼ˆshearï¼‰ï¼Œä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°æ·»åŠ ã€‚ ä¸‹é¢ç½‘ç«™ä¸­æä¾›çš„è§†é¢‘åŠ¨ç”»å½¢è±¡åœ°å±•ç¤ºäº†ç›¸æœºçš„å„ä¸ªå†…å‚å¯¹å›¾åƒå¹³é¢ä¸Šç‰©ä½“å¤–è§‚æ˜¾ç¤ºçš„å½±å“ï¼š http://ksimek.github.io/2013/08/13/intrinsic/ ï¼Œè¯¥ç½‘ç«™ä¸­çš„è§†é¢‘åŠ¨ç”»ç¤ºæ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å¤–å‚ï¼ˆExtrinsic Parametersï¼‰åœ¨ä»¥é’ˆå­”ä¸ºä¸­å¿ƒçš„ç›¸æœºåæ ‡ç³»ä¸­ï¼Œä¸‰ç»´ç©ºé—´ä¸­çš„ç‚¹ $P P P$ ä¸äºŒç»´å›¾åƒå¹³é¢ä¸­çš„ç‚¹ $P â€² P Pâ€²$ ä¹‹é—´çš„æ˜ å°„å…³ç³»å·²ç»è¢«æè¿°å‡ºæ¥äº†ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä¸‰ç»´ç©ºé—´ä¸­æ‹¥æœ‰çš„å…³äºç‚¹çš„ä¿¡æ¯éƒ½æ˜¯åœ¨å¦ä¸€ä¸ªåæ ‡ç³»ä¸­ï¼Œä¾‹å¦‚åœ¨è®¸å¤šæ±½è½¦åº”ç”¨ç¨‹åºä¸­å¸¸è§çš„æ±½è½¦åæ ‡ç³»ï¼Œé‚£ä¹ˆæƒ…å†µåˆè¯¥å¦‚ä½•å‘¢?å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè½¦è¾†åæ ‡ç³»åŸç‚¹ä½äºè½¦è¾†åè½´ä¸­ç‚¹ä¸‹æ–¹çš„åœ°é¢ä¸Šï¼Œxè½´æŒ‡å‘è¡Œé©¶æ–¹å‘ã€‚é™¤äº†åæ ‡è½´å‘½åçº¦å®šå¤–ï¼Œä¸‹å›¾ä¸­è¿˜æ˜¾ç¤ºäº†ç»•Xã€Yå’ŒZè½´æ—‹è½¬æ—¶é€šå¸¸ä½¿ç”¨çš„è§’åº¦åç§°ï¼Œå³â€œrollâ€ã€â€œpitchâ€å’Œâ€œyawâ€ã€‚ æˆ‘ä»¬å‡è®¾è¯¥è½¦é…å¤‡äº†æ¿€å…‰é›·è¾¾å’Œç›¸æœºï¼Œå®ƒä»¬éƒ½å°†åœ¨è½¦è¾†åæ ‡ç³»ä¸‹è¿›è¡Œåæ ‡æ ¡å‡†ã€‚ä¸ºäº†å°†åœ¨æ¿€å…‰é›·è¾¾åæ ‡ç³»ä¸­æµ‹é‡åˆ°çš„ç‚¹æŠ•å°„åˆ°ç›¸æœºåæ ‡ç³»ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ˜ å°„æ“ä½œä¸­æ·»åŠ ä¸€ä¸ªé¢å¤–çš„è½¬æ¢ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå°†ç‚¹ä»è½¦è¾†åæ ‡ç³»å…³è”åˆ°ç›¸æœºåæ ‡ç³»ï¼Œåä¹‹äº¦ç„¶ã€‚é€šå¸¸ï¼Œè¿™ç§æ˜ å°„æ“ä½œå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š å¹³ç§»ï¼ˆtranslationï¼‰ã€æ—‹è½¬ï¼ˆrotation ï¼‰å’Œç¼©æ”¾ï¼ˆscalingï¼‰ ã€‚è®©æˆ‘ä»¬ä¾æ¬¡å¯¹å®ƒä»¬è¿›è¡Œåˆ†æï¼šå¹³ç§» ï¼šç”±ä¸‹å›¾å¯è§ï¼Œå¹³ç§»æè¿°äº†ä»ç‚¹ $P â†’ \\overrightarrowP P$ åˆ°æ–°ä½ç½® $P â€² â†’ \\overrightarrowP^ Pâ€²$ çš„çº¿æ€§ç§»åŠ¨ï¼Œè¯¥ç§»åŠ¨å¯ä»¥é€šè¿‡ç»™ $P â†’ \\overrightarrowP^ P$ åŠ ä¸Šä¸€ä¸ªå¹³ç§»å‘é‡ $t â†’ \\overrightarrowt t$ å®ç°ã€‚ åœ¨é½æ¬¡åæ ‡ç³»ä¸­ï¼Œè¿™å¯ä»¥é€šè¿‡è¿æ¥ä¸€ä¸ª $N N N$ ç»´å•ä½çŸ©é˜µ $I I I$ è¿›è¡Œè¡¨ç¤ºï¼Œå…¶ä¸­ Næ˜¯ $P â†’ \\overrightarrowP P$ å’Œ $t â†’ \\overrightarrowt t$ çš„å…ƒç´ ä¸ªæ•°ã€‚è¿™æ ·ï¼Œå¹³ç§»æ“ä½œå°±å˜æˆäº†ä¸€ä¸ªç®€å•çš„çŸ©é˜µ-å‘é‡ä¹˜æ³•ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ ç¼©æ”¾ ï¼šæ—‹è½¬æ“ä½œå¯ä»¥é€šè¿‡ä»¤ $P â†’ \\overrightarrowP P$ ä¹˜ä»¥ä¸€ä¸ªç¼©æ”¾å‘é‡ $s â†’ \\overrightarrows s$ å®ç°ã€‚åœ¨é½æ¬¡åæ ‡ä¸­ï¼Œè¿™ä¹Ÿå¯ä»¥è¡¨ç¤ºä¸ºçŸ©é˜µ-å‘é‡ä¹˜æ³•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ æ—‹è½¬ ï¼šé€†æ—¶é’ˆæ–¹å‘ï¼ˆåœ¨æ•°å­¦ä¸Šä¸ºæ­£ï¼‰æ—‹è½¬å¾—åˆ°çš„ç‚¹ $P â€² â†’ \\overrightarrowP^ Pâ€²$ ï¼Œå¯ä»¥ç”± $P â†’ \\overrightarrowP P$ é€šè¿‡ä¸‹å›¾æ‰€ç¤ºçš„æ–¹å¼å¾—åˆ°ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ—‹è½¬æ“ä½œå¯ä»¥é€šè¿‡ä¹˜ä»¥ä¸€ä¸ª æ—‹è½¬çŸ©é˜µ R æ¥è¡¨ç¤ºã€‚åœ¨ä¸‰ç»´ç©ºé—´ä¸­ï¼Œç‚¹ $P P P$ å¯ä»¥ç”¨ä¸‹å›¾æ‰€ç¤ºçš„æ—‹è½¬çŸ©é˜µè¡¨ç¤ºå›´ç»•ä¸‰ä¸ªåæ ‡è½´çš„æ—‹è½¬ï¼š æ³¨æ„ï¼šå›´ç»•ä¸‰ä¸ªåæ ‡è½´çš„ç‹¬ç«‹çš„æ—‹è½¬å¯ä»¥é€šè¿‡æ—‹è½¬çŸ©é˜µç›¸ä¹˜ç»„åˆæˆä¸€ä¸ª è”åˆæ—‹è½¬çŸ©é˜µ R ï¼š $$R = R z â‹… R y â‹… R x R=R_z \\cdot R_y \\cdot R_x R=Rzâ€‹â‹…Ryâ€‹â‹…Rxâ€‹ $$ é½æ¬¡åæ ‡ç³»çš„ä¸€å¤§ä¼˜åŠ¿å°±æ˜¯åªéœ€è¿æ¥å¤šä¸ªçŸ©é˜µ-å‘é‡ä¹˜æ³•å°±å¯ä»¥è½»æ¾ç»„åˆå¤šç§è½¬æ¢æ“ä½œï¼Œå®ä¹ƒä¸€å¤§åˆ©å™¨ï¼ åŒ…å« $R R R$ å’Œ $t â†’ \\overrightarrowt t$ çš„ç»„åˆçŸ©é˜µåˆè¢«ç§°ä¹‹ä¸º **å¤–å‚çŸ©é˜µ** ï¼Œå› ä¸ºå®ƒæ¨¡æ‹Ÿäº†ç‚¹åœ¨åæ ‡ç³»ä¹‹é—´çš„åæ ‡è½¬æ¢ã€‚ä¸€æ—¦æ¿€å…‰é›·è¾¾åæ ‡ç³»ä¸­çš„ç‚¹è¢«è½¬æ¢åˆ°ç›¸æœºåæ ‡ç³»ä¸­ï¼Œä¸‹é¢å°±éœ€è¦å°†å…¶æ˜ å°„åˆ°ç›¸æœºå›¾åƒå¹³é¢ä¸­ã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬è¿˜è¦é¢å¤–æ·»åŠ ä¹‹å‰è®¨è®ºè¿‡çš„ç›¸æœºå†…å‚çŸ©é˜µ $K K K$ ã€‚åœ¨é½æ¬¡åæ ‡ç³»ä¸‹ï¼Œæˆ‘ä»¬åªéœ€å°†ä¹‹å‰çš„è½¬æ¢ç»“æœä¸å†…å‚çŸ©é˜µç›¸ä¹˜å°±å¯ä»¥å®ç°ã€‚ ç”±æ­¤å¯å¾—ï¼Œå®Œæ•´çš„å°†æ¿€å…‰é›·è¾¾ 3D ç‚¹äº‘æ˜ å°„åˆ°ç›¸æœºå›¾åƒä¸Šæ‰€éœ€çš„åæ ‡è½¬æ¢å…¬å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ³¨æ„ï¼šä¸Šå›¾ä¸­ï¼Œâ€œç¼©æ”¾â€æ“ä½œå·²ç»è¢«é›†æˆåˆ°äº†å†…å‚çŸ©é˜µ $K K K$ ä¸­ï¼ˆå’Œç„¦è·æˆä¸ºç›¸å…³é‡ï¼‰ï¼Œè€Œä¸å†æ˜¯å¤–å‚çŸ©é˜µçš„ä¸€éƒ¨åˆ†ã€‚åœ¨ä¸‹é¢çš„è§†é¢‘ä¸­ï¼Œå±•ç¤ºäº†ç›¸æœºçš„å¤–å‚å¯¹å›¾åƒå¹³é¢ä¸Šç‰©ä½“å¤–è§‚æ˜¾ç¤ºçš„å½±å“ï¼š [http://ksimek.github.io/perspective\\_camera\\_toy.html](http://ksimek.github.io/perspective_camera_toy.html)","categories":["3.å¼€å‘æ¡†æ¶","OpenCV"]},{"title":"ã€å¤šä¼ æ„Ÿèåˆã€‘ä¼˜è¾¾å­¦åŸå¤šä¼ æ„Ÿèåˆå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰â€”â€”å°†æ¿€å…‰é›·è¾¾ç‚¹äº‘ä¿¯è§†å›¾æ˜ å°„åˆ°äºŒç»´å›¾åƒ_å¤šä¼ æ„Ÿå™¨èåˆâ€”â€”æ¿€å…‰é›·è¾¾ç‚¹äº‘æŠ•å½±åˆ°å›¾åƒ-CSDNåšå®¢","path":"/2025/04/25/3-å¼€å‘æ¡†æ¶-OpenCV-ã€å¤šä¼ æ„Ÿèåˆã€‘ä¼˜è¾¾å­¦åŸå¤šä¼ æ„Ÿèåˆå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰â€”â€”å°†æ¿€å…‰é›·è¾¾ç‚¹äº‘ä¿¯è§†å›¾æ˜ å°„åˆ°äºŒç»´å›¾åƒ-å¤šä¼ æ„Ÿå™¨èåˆâ€”â€”æ¿€å…‰é›·è¾¾ç‚¹äº‘æŠ•å½±åˆ°å›¾åƒ-CSDNåšå®¢/","content":"ã€å¤šä¼ æ„Ÿèåˆã€‘ä¼˜è¾¾å­¦åŸå¤šä¼ æ„Ÿèåˆå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰â€”â€”å°†æ¿€å…‰é›·è¾¾ç‚¹äº‘ä¿¯è§†å›¾æ˜ å°„åˆ°äºŒç»´å›¾åƒå°é¾™å°±æ˜¯çˆ±å­¦ä¹  å·²äº 2023-07-24 18:53:11 ä¿®æ”¹ ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œéµå¾ª CC 4.0 BY-SA ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥å’Œæœ¬å£°æ˜ã€‚ æœ¬æ–‡é“¾æ¥ï¼š https://blog.csdn.net/xiaolong361/article/details/104787013 ç‰ˆæƒ æœ¬æ–‡ä»‹ç»å¦‚ä½•å°†æ¿€å…‰é›·è¾¾ç‚¹äº‘ä¿¯è§†å›¾æ˜ å°„åˆ°äºŒç»´å›¾åƒï¼Œæ¶µç›–ç‚¹äº‘æ•°æ®é¢„å¤„ç†ã€åæ ‡æ˜ å°„åŠåœ°é¢æ»¤é™¤æ–¹æ³•ï¼Œæä¾› KITTI æ•°æ®é›†ä¸‹ VelodyneHDL-64E æ¿€å…‰é›·è¾¾æ•°æ®çš„æ˜ å°„å®ä¾‹ã€‚ æ‘˜è¦ç”Ÿæˆäº CçŸ¥é“ ï¼Œç”± DeepSeek-R1 æ»¡è¡€ç‰ˆæ”¯æŒï¼Œ å‰å¾€ä½“éªŒ å°†æ¿€å…‰é›·è¾¾ç‚¹äº‘ä¿¯è§†å›¾æ˜ å°„åˆ°äºŒç»´å›¾åƒç®€ä»‹æœ¬èŠ‚è®²è§£å¦‚ä½•å°†æ¿€å…‰é›·è¾¾ç‚¹äº‘ä¿¯è§†å›¾ï¼ˆä»…è€ƒè™‘æ°´å¹³åæ ‡ï¼‰æ˜ å°„åˆ°äºŒç»´å›¾åƒä¸­ï¼Œå…¶ä¸­æ¶‰åŠåˆ°æ¿€å…‰é›·è¾¾ç‚¹äº‘çš„åœ°é¢éƒ¨åˆ†æ»¤é™¤ï¼Œå’Œä¸åŒåæ ‡èŒƒå›´ä¸‹çš„æ•°æ®çš„ç®€å•æ˜ å°„ã€‚æœ¬æ–‡ä¸»è¦ä¾§é‡æä¾›æ–¹æ³•çš„å‚è€ƒï¼Œä»£ç ä»…ä¾›å‚è€ƒï¼Œå¯æ ¹æ®å®é™…ä½¿ç”¨åœºæ™¯çš„éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚ æœ¬æ–‡ä¸­é‡‡ç”¨çš„æ¿€å…‰é›·è¾¾æ•°æ®æ¥è‡ª KITTI æ•°æ®é›† ï¼Œä½¿ç”¨ Velodyne HDL-64E æ¿€å…‰é›·è¾¾é‡‡é›†å¾—åˆ°ï¼Œè¯¥æ¿€å…‰é›·è¾¾å·¥ä½œé¢‘ç‡ 10Hzï¼Œæ¯ä¸ªå‘¨æœŸå¯ä»¥é‡‡é›†å¤§çº¦ 10 ä¸‡ä¸ªç‚¹ã€‚æ›´å¤šä¿¡æ¯å¯å‚è€ƒ KITTIæ•°æ®é›† çš„ä¼ æ„Ÿå™¨å®‰è£…éƒ¨åˆ†æ–‡æ¡£ï¼š http://www.cvlibs.net/datasets/kitti/setup.php åœ¨ KITTI æ•°æ®é›†ä¸­ï¼Œè¯¥æ¿€å…‰é›·è¾¾ ç‚¹äº‘æ•°æ® å·²ç»å’Œä¸€ä¸ªå‰è§†æ‘„åƒå¤´è¿›è¡Œäº†åŒæ­¥ï¼Œæœ¬æ–‡ä½¿ç”¨çš„æ¿€å…‰é›·è¾¾æ•°æ®é‡‡é›†åˆ°çš„åœºæ™¯è¿‘ä¼¼äºä¸‹æ–¹å›¾ç‰‡æ‰€ç¤ºçš„åœºæ™¯ã€‚ å®ç°æ–¹æ³• é€šè¿‡æ•°æ®æ–‡ä»¶åŠ è½½æ¿€å…‰é›·è¾¾ç‚¹äº‘æ•°æ®ï¼Œæ¥è‡ª Kittiæ•°æ®é›† ã€‚ åˆå§‹åŒ–ç‰¹å®šåƒç´ å¤§å°çš„å›¾ç‰‡ï¼ˆ1000*2000ï¼‰ã€‚ æ ¹æ®éœ€è¦æ˜¾ç¤ºçš„æ¿€å…‰é›·è¾¾ç‚¹äº‘èŒƒå›´å’Œå›¾ç‰‡åƒç´ èŒƒå›´ï¼Œå°†æ¿€å…‰é›·è¾¾ç‚¹äº‘çš„æ¨ªçºµåæ ‡æ˜ å°„åˆ°å›¾ç‰‡çš„ç‰¹å®šåƒç´ ä¸­ï¼Œå…¶ä¸­æ¿€å…‰é›·è¾¾æ‰€å¤„çš„ä¸–ç•Œåæ ‡ç³»éµå¾ªå³æ‰‹ç³»ï¼Œx è½´å¯¹åº”å‰è¿›æ–¹å‘ï¼Œy è½´å¯¹åº”å·¦ä¾§æ¨ªå‘ï¼›è€Œå¯¹äºå›¾åƒåæ ‡ç³»ï¼Œx,y åˆ†åˆ«å¯¹åº”å…¶å›¾åƒçš„è¡Œç´¢å¼•å’Œåˆ—ç´¢å¼•ï¼Œä¸”å›¾åƒå·¦ä¸Šè§’ä¸ºåŸç‚¹ã€‚ å…·ä½“å¤„ç†æ–¹å¼å‚è€ƒå¦‚ä¸‹ä»£ç ï¼š //å‚è€ƒå®šä¹‰ï¼šCvSize cvSize( int width, int height );cv::Size worldSize(10.0,20.0); //å¾…æ˜¾ç¤ºçš„æ¿€å…‰é›·è¾¾ç‚¹äº‘åœ¨ä¸–ç•Œåæ ‡ç³»ä¸‹çš„èŒƒå›´cv::Size imageSize(1000.0,2000.0); //å¾…æ˜¾ç¤ºçš„å›¾ç‰‡çš„åƒç´ èŒƒå›´ï¼ˆä¸ä¸–ç•Œåæ ‡ç³»ç­‰æ¯”ä¾‹ï¼‰...float xw=(*it).x;//ä¸–ç•Œåæ ‡ç³»ä¸‹çš„æ¿€å…‰é›·è¾¾ç‚¹äº‘çºµåæ ‡float yw=(*it).y;//ä¸–ç•Œåæ ‡ç³»ä¸‹çš„æ¿€å…‰é›·è¾¾ç‚¹äº‘æ¨ªåæ ‡ï¼ˆè½¦èº«å·¦ä¾§ä¸ºæ­£ï¼‰// xï¼Œyè¡¨ç¤ºå›¾ç‰‡åæ ‡ç³»ä¸‹çš„åæ ‡ç‚¹ï¼Œåˆ†åˆ«å¯¹åº”å›¾åƒçš„è¡Œç´¢å¼•å’Œåˆ—ç´¢å¼•ã€‚//ï¼ˆå¦‚ç›¸å…³åæ ‡ç³»å¯¹åº”å…³ç³»ä¸åŒï¼Œå¯è¿›è¡Œç›¸åº”è°ƒæ•´ï¼‰int x = (-yw * imageSize.height / worldSize.height) + imageSize.width / 2;int y = (-xw * imageSize.height / worldSize.height) + imageSize.height;12345678910111213 è½¬æ¢åçš„æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š4. å¯æ ¹æ®æ¿€å…‰é›·è¾¾ç›¸å¯¹åœ°é¢çš„å®‰è£…ä½ç½®é«˜åº¦ï¼Œè®¾ç½®æ°å½“çš„é˜ˆå€¼å˜é‡ doulble minZ=-1.40 ï¼Œåªæœ‰è¯¥é˜ˆå€¼ä»¥ä¸Šçš„æ¿€å…‰ç‚¹äº‘æ‰è¿›è¡Œä¸Šè¿°æ˜ å°„æ“ä½œï¼Œä»è€Œè¿‡æ»¤æ‰æ¿€å…‰ç‚¹äº‘ä¸­çš„åœ°é¢åå°„ç›®æ ‡ã€‚æœ€ç»ˆæ˜ å°„åçš„å›¾ç‰‡æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š å‚è€ƒä»£ç å®ç°ä»¥å›¾ç‰‡å½¢å¼æ˜¾ç¤ºæ¿€å…‰é›·è¾¾ç‚¹äº‘ä¿¯è§†å›¾çš„ç›¸å…³å‚è€ƒä»£ç å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ­¤ä¸ºä¼˜è¾¾å­¦åŸæä¾›çš„å‚è€ƒä»£ç ï¼Œæœªç»è¿‡æœ¬äººå®é™…æµ‹è¯•ï¼Œä»…ä¾›å‚è€ƒï¼š","categories":["3.å¼€å‘æ¡†æ¶","OpenCV"]},{"title":"ã€å¤šä¼ æ„Ÿèåˆã€‘ä¼˜è¾¾å­¦åŸå¤šä¼ æ„Ÿèåˆå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰â€”â€”é’ˆå­”ç›¸æœºæ¨¡å‹_ä¼˜è¾¾å­¦åŸä¼ æ„Ÿå™¨èåˆ-CSDNåšå®¢","path":"/2025/04/25/3-å¼€å‘æ¡†æ¶-OpenCV-ã€å¤šä¼ æ„Ÿèåˆã€‘ä¼˜è¾¾å­¦åŸå¤šä¼ æ„Ÿèåˆå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰â€”â€”é’ˆå­”ç›¸æœºæ¨¡å‹-ä¼˜è¾¾å­¦åŸä¼ æ„Ÿå™¨èåˆ-CSDNåšå®¢/","content":"æœ¬æ–‡æ¢è®¨äº†é’ˆå­”ç›¸æœºæ¨¡å‹çš„åŸºæœ¬åŸç†ï¼ŒåŒ…æ‹¬æˆåƒæ¨¡å‹ã€é•œå¤´ä¸å…‰åœˆçš„ä½œç”¨ã€ç•¸å˜ç±»å‹åŠå…¶æ ¡æ­£æ–¹æ³•ã€‚æ­¤å¤–ï¼Œè¿˜ä»‹ç»äº†å›¾åƒä¼ æ„Ÿå™¨çš„å·¥ä½œåŸç†ï¼Œç‰¹åˆ«æ˜¯ CCD ä¸ CMOS æŠ€æœ¯çš„åŒºåˆ«ï¼Œä»¥åŠæ‹œè€³é˜µåˆ—åœ¨è‰²å½©å›¾åƒæ•æ‰ä¸­çš„åº”ç”¨ã€‚ æ‘˜è¦ç”Ÿæˆäº CçŸ¥é“ ï¼Œç”± DeepSeek-R1 æ»¡è¡€ç‰ˆæ”¯æŒï¼Œ å‰å¾€ä½“éªŒ é’ˆå­”ç›¸æœºæ¨¡å‹é’ˆå­”ç›¸æœºæˆåƒæ¨¡å‹é’ˆå­”ç›¸æœºï¼ˆpinhole camera ï¼‰å®ç‰©æ¨¡å‹å¦‚ä¸‹æ‰€ç¤º:å·¦è¾¹çš„æ„Ÿå…‰è¡¨é¢ç§°ä¸º åƒå¹³é¢ ï¼Œè€Œé’ˆå­”ï¼ˆpinholeï¼‰ç§°ä¸º ç›¸æœºä¸­å¿ƒ ã€‚ç›¸æœºä¸­å¿ƒä¸åƒå¹³é¢ä¹‹é—´çš„è·ç¦»ç§°ä¸º ç„¦è· f ã€‚ä¸‰ç»´ä¸–ç•Œä¸­çš„ç›®æ ‡ç‰©ä½“ä¸Šçš„ç‚¹ $P P P$ åˆ©ç”¨ç»è¿‡ç›¸æœºä¸­å¿ƒçš„å…‰çº¿æŠ•å°„å¯ä»¥æ˜ å°„åˆ°åƒå¹³é¢ä¸Šçš„ç‚¹ $P â€² P^ Pâ€²$ ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å…¶ä¸­ï¼Œåœ¨ä¸‰ç»´ç©ºé—´ä¸­ï¼Œåˆ©ç”¨å‡ ä½•è§’åº¦å…³ç³»ï¼Œæ˜ å°„å…³ç³»å¯ä»¥ç”¨ä¸‹åˆ—å…¬å¼è¡¨ç¤ºï¼šåˆ©ç”¨è¿™äº›æ–¹ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®é™…ç‰©ä½“åœ¨ç©ºé—´ä¸­çš„ä¸‰ç»´ä½ç½®ä»¥åŠç›¸æœºçš„ç„¦è·ï¼Œè®¡ç®—å‡ºå®é™…ç‰©ä½“åœ¨æˆåƒå¹³é¢ä¸Šçš„äºŒç»´ä½ç½®ã€‚ä½†æ˜¯ï¼Œè¯·æ³¨æ„å¾—åˆ°çš„åæ ‡ $x â€² x xâ€²$ å’Œ $y â€² y yâ€²$ è¿˜åªæ˜¯â€œ **æµ‹é‡åæ ‡** â€ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„åƒç´ ä½ç½®ã€‚ é’ˆå­”ç›¸æœºå­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œé€šè¿‡é’ˆå­”çš„å…‰çº¿ä¸è¶³ä»¥åœ¨æ„Ÿå…‰ä¼ æ„Ÿå™¨ä¸Šç”Ÿæˆå›¾åƒã€‚å¦‚æœè¦å¢åŠ å…‰çº¿å¯ä»¥ç®€å•é€šè¿‡æ‰©å¤§é’ˆå­”å®ç°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä½†è¿™æ ·ä¼šä½¿ç›®æ ‡å¯¹è±¡åå°„çš„å…‰çº¿ä¸å…¶ä»–éƒ¨åˆ†åå°„çš„å…‰çº¿äº’ç›¸é‡å ï¼Œä»è€Œå¯¼è‡´æˆåƒæ•ˆæœæ¨¡ç³Šï¼šå³ é’ˆå­”å¼€çš„è¶Šå¤§ï¼Œå›¾åƒè¶Šæ˜äº®ï¼Œä½†ä¸æ­¤åŒæ—¶ï¼Œæˆåƒå¹³é¢ä¸Šçš„å¯¹è±¡æ¨¡ç³Šè¶Šä¸¥é‡ ã€‚ è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯ ä½¿ç”¨é•œå¤´ ï¼Œå®ƒèƒ½å¤Ÿæ•æ‰åˆ°ç›®æ ‡ç‰©ä½“åŒä¸€ç‚¹å‘å‡ºçš„å¤šæ¡å…‰çº¿ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹é•œå¤´å’Œå…‰åœˆã€‚ é•œå¤´å’Œå…‰åœˆä¸€ä¸ªé€‚å½“å¤§å°å’Œä½ç½®çš„ é•œå¤´ ï¼ˆé€é•œï¼‰å¯ä»¥å°†ç›®æ ‡ç‰©ä½“ä¸Šç‚¹ $P 1 P_1 P1â€‹$ å‘å‡ºçš„æ‰€æœ‰å…‰çº¿æŠ˜å°„åˆ°åƒå¹³é¢ä¸Šçš„ä¸€ä¸ªç‚¹ $P 1 â€² P_1 P1â€‹â€²$ ä¸Šã€‚ç„¶è€Œï¼Œç©¿è¿‡é€é•œä¸­å¿ƒçš„å…‰çº¿ä¸å‘ç”ŸæŠ˜å°„ï¼Œå®ƒä»¬ä»¥ç›´çº¿ç»§ç»­å‰è¿›ï¼Œç›´åˆ°ä¸æˆåƒå¹³é¢ç›¸äº¤ã€‚ ç‰©ä½“ä¸Šå…¶ä»–è·ç¦»æ›´è¿‘æˆ–æ›´è¿œçš„ç‚¹ï¼Œå¦‚ $P 2 P_2 P2â€‹$ ï¼Œåœ¨åƒå¹³é¢ä¸Šå‡ºç°ç„¦ç‚¹ä¸é›†ä¸­çš„ç°è±¡ï¼Œå› ä¸ºä»å®ƒä»¬å‘å‡ºçš„ä¸€ç»„å…‰çº¿æ— æ³•é€šè¿‡é€é•œæ±‡èšåœ¨ä¸€ä¸ªç‚¹ä¸Šï¼Œè€Œæ˜¯æ±‡èšåœ¨ä¸€ä¸ªç‰¹å®šåŠå¾„çš„åœ†ä¸Šã€‚è¿™ä¸ªæ¨¡ç³Šçš„åœ†é€šå¸¸è¢«ç§°ä¸º **circle of confusion** (COF)ã€‚ä¸ºäº†å‡å°‘æ¨¡ç³Šï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª **å…‰åœˆ** ï¼Œå®ƒæ˜¯ä¸€ä¸ªå’Œé€é•œåŒä¸­å¿ƒçš„å¼€å£ï¼Œé€šå¸¸å¤§å°å¯è°ƒï¼Œç›´æ¥æ”¾åœ¨é•œå¤´åé¢ã€‚ä¸‹å›¾è¯´æ˜äº†åŸç†: æ•å½¢ç•¸å˜å’Œæ¡¶å½¢ç•¸å˜é€šè¿‡å‡å°å…‰åœˆçš„ç›´å¾„ï¼Œç»è¿‡é€é•œå¤–è¾¹ç¼˜çš„å…‰çº¿è¢«é˜»æŒ¡ï¼Œä»è€Œå‡å°äº†æˆåƒå¹³é¢ä¸Š COF çš„å¤§å°ã€‚æ˜¾ç„¶ï¼Œè¾ƒå°çš„å…‰åœˆå¯ä»¥å‡å°‘æ¨¡ç³Šï¼Œä½†ä»£ä»·æ˜¯é™ä½äº†å…‰çº¿æ•åº¦åº¦ã€‚å…‰åœˆè¶Šå¤§ï¼Œåˆ™æ›´å¤šçš„å…‰çº¿ä¼šè¢«æ±‡èšåˆ°æˆåƒåŒºåŸŸï¼Œäº§ç”Ÿ ä¿¡å™ªæ¯”æ›´å¥½ çš„æ›´æ˜äº®çš„å›¾åƒï¼Œç¼ºç‚¹å°±æ˜¯å¯èƒ½å¢å¤§å›¾åƒæ¨¡ç³Šç¨‹åº¦ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•è®¡ç®—ç©ºé—´ä¸­çš„ç‰©ä½“åœ¨å›¾åƒä¸­çš„ä½ç½®å‘¢?ç»™å®šç©ºé—´ä¸­çš„ä¸€ä¸ªä¸‰ç»´ç‚¹ï¼Œå…¶é€šè¿‡é€é•œååœ¨æˆåƒå¹³é¢ä¸Šçš„äºŒç»´ä½ç½®å¯ä»¥ç±»ä¼¼é’ˆå­”ç›¸æœºçš„æ–¹å¼è¿›è¡Œè®¡ç®—ã€‚å®é™…ä¸Šï¼Œé•œå¤´ä¼šç”±äºé•œå¤´ç±»å‹çš„ä¸åŒè€Œå¯¼è‡´å›¾åƒå¤±çœŸã€‚æœ€æ¥è¿‘å®é™…æƒ…å†µçš„ç•¸å˜æˆ‘ä»¬ç§°ä¸ºâ€œå¾„å‘ç•¸å˜â€ã€‚è¿™æ˜¯ç”±äºé€é•œçš„ç„¦è·åœ¨å…¶ç›´å¾„ä¸Šä¸å‡åŒ€é€ æˆçš„ã€‚å› æ­¤ï¼Œé•œå¤´çš„æ”¾å¤§æ•ˆæœå–å†³äºç›¸æœºä¸­å¿ƒ(å…‰è½´)ä¸é€šè¿‡é•œå¤´çš„å…‰çº¿ä¹‹é—´çš„è·ç¦»ã€‚å¦‚æœæ”¾å¤§å€æ•° å¢å¤§ ï¼Œæ‰€äº§ç”Ÿçš„ç•¸å˜æ•ˆåº”ç§°ä¸ºâ€œ æ•å½¢ç•¸å˜ï¼ˆPincushion Distortionï¼‰ â€ï¼›è‹¥æ”¾å¤§å€æ•° å‡å°‘ ï¼Œåˆ™å®ƒè¢«ç§°ä¸ºâ€œ æ¡¶å½¢ç•¸å˜(Barrel Distortion) â€ã€‚å½“ä½¿ç”¨å¹¿è§’é•œå¤´æ—¶ï¼Œé€šå¸¸å°±ä¼šå‘ç”Ÿæ¡¶å½¢ç•¸å˜ã€‚åœ¨ä¸‹é¢çš„å›¾ä¸­ï¼Œè¯´æ˜äº†è¿™ä¸¤ç§ç•¸å˜ç±»å‹ã€‚ å›¾åƒæ ‡å®šå’Œæ ¡å‡†æ¦‚å¿µå½“ä»ç›¸æœºå›¾åƒä¸­æå–ä¿¡æ¯æ—¶ï¼Œè®¸å¤šåº”ç”¨ç¨‹åºéœ€è¦ä»å›¾åƒä¸­è·å–ç›®æ ‡å¯¹è±¡(ä¾‹å¦‚è½¦è¾†)çš„ç©ºé—´ä½ç½®ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œå¿…é¡»å»é™¤æˆ–è‡³å°‘å‡è½»é•œå¤´çš„ç•¸å˜æ•ˆåº”ã€‚è¯¥è¿‡ç¨‹è¢«ç§°ä¹‹ä¸º æ ‡å®šï¼ˆCalibrationï¼‰ ã€‚å¯¹äºæ¯ä¸ªç›¸æœºé•œå¤´é…ç½®ï¼Œå¿…é¡»æ‰§è¡Œä¸€ä¸ªæ ‡å®šç¨‹åºï¼Œä»¥ä¾¿å¯ä»¥è®¡ç®—å‡ºç•¸å˜å‚æ•°ã€‚è¿™é€šå¸¸æ˜¯é€šè¿‡æ‹æ‘„ä¸€ç»„å·²çŸ¥çš„ç‰©ä½“ç…§ç‰‡æ¥å®ç°çš„ï¼Œæ¯”å¦‚å¹³é¢æ£‹ç›˜å›¾æ¡ˆã€‚ä»è¿™äº›å·²çŸ¥çš„å‡ ä½•å›¾å½¢ä¸­å¯ä»¥æ¨å¯¼å‡ºæ‰€æœ‰çš„é•œå¤´å’Œå›¾åƒä¼ æ„Ÿå™¨å‚æ•°ã€‚ä»æ‘„åƒå¤´å›¾åƒä¸­æ¶ˆé™¤ç•¸å˜çš„è¿‡ç¨‹ç§°ä¸º æ ¡å‡†ï¼ˆRectificationï¼‰ ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†æœ¬è¯¾ç¨‹ä¸­è¿›è¡Œå›¾åƒæ ¡æ­£çš„æ ‡å®šè£…ç½®ã€‚å¯ä»¥å¾ˆå®¹æ˜“åœ°çœ‹åˆ°ï¼Œå·¦å³ä¸¤è¾¹çš„ç›´çº¿éƒ½å‡ºç°äº†ä¸¥é‡çš„ç•¸å˜ã€‚ ç„¶è€Œï¼Œå…³äºç•¸å˜æ ¡æ­£çš„ç»†èŠ‚ï¼Œæˆ‘ä»¬ä¸å†è¿™é‡Œè¿›è¡Œæ·±å…¥è®¨è®ºã€‚ç„¶è€Œï¼Œå½“ä½¿ç”¨è‡ªå·±çš„ç›¸æœºè®¾ç½®æ—¶ï¼Œå¦‚æœä»¥ç²¾ç¡®æµ‹é‡æˆ–å¯¹è±¡çš„ç©ºé—´é‡å»ºä¸ºç›®æ ‡ï¼Œé‚£ä¹ˆå¿…é¡»æ‰§è¡Œæ ¡å‡†è¿‡ç¨‹ã€‚ ä¸‰ç»´åæ ‡ç³»åˆ°åƒç´ åæ ‡ç³»çš„è½¬æ¢å¦‚å‰æ‰€è¿°ï¼Œåœ¨ä¸‰ç»´ç©ºé—´ä¸­ï¼Œç‚¹åœ¨åƒå¹³é¢ä¸Šçš„æŠ•å½±ä¸æˆ‘ä»¬åœ¨å®é™…æ•°å­—å›¾åƒä¸­æ‰€çœ‹åˆ°çš„å¹¶ä¸ç›´æ¥å¯¹åº”ï¼Œè€Œå®é™…æ•°å­—å›¾åƒæ˜¯ç”±æˆåƒä¸Šä¸‡çš„åƒç´ ï¼ˆpixelï¼‰ç»„æˆã€‚ä¸ºäº†ç†è§£å›¾åƒæ˜¯å¦‚ä½•ä»¥ç¦»æ•£åƒç´ æ¥è¡¨è¾¾çš„ï¼Œæˆ‘ä»¬éœ€è¦å†æ¬¡ä»”ç»†è§‚å¯Ÿä¸Šè¿°ç›¸æœºæ¨¡å‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ‘„åƒå¤´ä¸­å¿ƒåœ¨ç©ºé—´ä¸­ç‚¹ $O O O$ çš„ä½ç½®ï¼Œå¹¶ä¸”æœ‰è‡ªå·±çš„åæ ‡ç³»ï¼Œå…¶åæ ‡è½´åˆ†åˆ«ä¸º $i i i$ ã€ $j j j$ ã€ $k k k$ ï¼Œå…¶ä¸­ $k k k$ è½´æŒ‡å‘æˆåƒå¹³é¢çš„æ–¹å‘ã€‚ $k k k$ è½´ä¸æˆåƒå¹³é¢ç›¸äº¤çš„ä½ç½®ç‚¹ $C â€² C Câ€²$ ï¼Œç‚¹ $C â€² C Câ€²$ ç§°ä¸ºä¸»ç‚¹ï¼ˆPrincipal Pointï¼‰ï¼Œè¡¨ç¤ºå›¾åƒåæ ‡ç³»çš„ä¸­å¿ƒã€‚ **å°†ç©ºé—´ä¸­çš„ç‚¹ $P P P$ æ˜ å°„åˆ°åƒå¹³é¢åçš„ç¬¬ä¸€æ­¥æ˜¯å‡å»ä¸»ç‚¹åæ ‡ï¼Œè¿™æ ·ç¦»æ•£å›¾åƒå°±æ‹¥æœ‰äº†ä»¥æˆåƒå¹³é¢å·¦ä¸‹è§’ä¸ºä¸­å¿ƒçš„è‡ªå·±çš„åæ ‡ç³»ç»Ÿ** ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ è½¬æ¢è¿‡ç¨‹çš„ç¬¬äºŒæ­¥æ˜¯ä»æµ‹é‡åæ ‡ç³»è½¬æ¢åˆ°åƒç´ åæ ‡ç³»ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡å®šè¿‡ç¨‹æä¾›çš„å‚æ•° $k k k$ å’Œ $l l l$ å®ç°ä»æµ‹é‡å€¼åˆ°åƒç´ çš„è½¬æ¢ï¼Œå¹¶ä¸”è¿™äº›å‚æ•°ä¹Ÿå¾ˆå®¹æ˜“è¢«æ•´åˆåˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ˜ å°„å…¬å¼ä¸­ã€‚æ³¨æ„ï¼šåœ¨å›¾åƒåæ ‡ç³»ä¸­ï¼Œå…¶åæ ‡åŸç‚¹ä½äºå·¦ä¸Šè§’ï¼Œä¸” $y y y$ è½´æ­£æ–¹å‘æŒ‡å‘æ­£ä¸‹æ–¹ï¼Œ $x x x$ è½´æ­£æ–¹å‘æŒ‡å‘æ­£å³æ–¹ã€‚ åœ¨åé¢çš„ç« èŠ‚ï¼Œæˆ‘ä»¬å°†æŠŠæ¿€å…‰é›·è¾¾ 3D ç‚¹äº‘ æ˜ å°„åˆ°æ‘„åƒå¤´å›¾åƒä¸­ã€‚æˆ‘ä»¬å°†åˆ©ç”¨ä¸Šè¿°å…¬å¼å®ç°è¿™ä¸€ç›®æ ‡ã€‚å¦å¤–ï¼Œç„¦è· $f f f$ å’Œ $k k k$ å’Œ $l l l$ çš„ä¹˜ç§¯ï¼ˆä¹Ÿåˆ†åˆ«ç§°ä¹‹ä¸º $Î± \\alpha Î±$ å’Œ $Î² \\beta Î²$ ï¼‰å°†åœ¨ä¸€ä¸ªæ ¡å‡†çŸ©é˜µä¸­è¢«ä½¿ç”¨ï¼Œä»è€Œæå¤§åœ°ç®€åŒ–äº†æ˜ å°„æ“ä½œã€‚ å›¾åƒæ ¡å‡†ä¸­è¿˜æœ‰æœ€åä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨è®¸å¤šåº”ç”¨ä¸­ï¼ˆå¦‚ç‰¹å¾è·Ÿè¸ªï¼‰ï¼Œå¤„ç†åŸå§‹å›¾åƒæ˜¯æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥é¿å…åœ¨æ ¡å‡†å›¾åƒä»¥åŠæ ¡å‡†å›¾åƒååƒç´ è½¬æ¢æ²¡æœ‰å®Œå…¨è½å…¥ç¦»æ•£åƒç´ çš„ä¸­å¿ƒç­‰è¿‡ç¨‹é€ æˆçš„è®¡ç®—è¯¯å·®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå»ºè®®åœ¨æœªä¿®æ”¹çš„åŸå§‹å›¾åƒä¸­å®šä½ç‰¹å¾ï¼Œç„¶åä½¿ç”¨ä¸Šé¢çš„æ–¹ç¨‹å¯¹å¾—åˆ°çš„ç»“æœè¿›è¡Œåæ ‡è½¬æ¢ã€‚å½“ä½¿ç”¨åŸºäºä¸€ç»„è®­ç»ƒæƒé‡çš„ æ·±åº¦å­¦ä¹  æ—¶ï¼Œåœ¨å°†å›¾åƒå¯¼å…¥ç½‘ç»œä¹‹å‰è¿›è¡Œå›¾åƒæ ¡å‡†æ˜¯å¾ˆæœ‰æ„ä¹‰çš„â€”â€”å¦‚æœæˆ‘ä»¬ä½¿ç”¨åŸå§‹å›¾åƒï¼Œç•¸å˜(ä¾‹å¦‚ï¼Œç”±äºä½¿ç”¨é±¼çœ¼é•œå¤´é€ æˆ)å°†ä¼šå¯¼è‡´æ£€æµ‹é”™è¯¯ï¼Œå› ä¸ºè¿™äº›ç½‘ç»œé€šå¸¸æ˜¯åˆ©ç”¨æ— ç•¸å˜çš„å›¾åƒè¿›è¡Œè®­ç»ƒç”Ÿæˆçš„ã€‚ å›¾åƒä¼ æ„Ÿå™¨å’Œæ‹œè€³é˜µåˆ—ï¼ˆBayer Patternï¼‰åœ¨æœ¬èŠ‚ä¸­ï¼Œä½ å°†äº†è§£å…·æœ‰ç‰¹å®šæ³¢é•¿çš„å…‰çº¿æ˜¯å¦‚ä½•è½¬æ¢æˆå¯ä»¥è¿›è¡Œæ•°å­—å­˜å‚¨çš„å½©è‰²åƒç´ çš„ã€‚ å½“ç…§ç›¸æœºæ•æ‰åˆ°å›¾åƒæ—¶ï¼Œå…‰çº¿ä¼šç©¿è¿‡é•œå¤´å¹¶è½åœ¨å›¾åƒä¼ æ„Ÿå™¨ä¸Šã€‚è¿™ç§ä¼ æ„Ÿå™¨ç”±å…‰æ•å…ƒä»¶ç»„æˆï¼Œå®ƒä»¬è®°å½•ç…§åœ¨å®ƒä»¬èº«ä¸Šçš„å…‰çš„æ•°é‡ï¼Œå¹¶å°†å…¶è½¬æ¢æˆç›¸åº”æ•°é‡çš„ç”µå­ã€‚å…‰çº¿è¶Šå¼ºï¼Œäº§ç”Ÿçš„ç”µå­è¶Šå¤šã€‚å½“æ›å…‰æ—¶é—´å®Œæˆåï¼Œç”Ÿæˆçš„ç”µå­è¢«è½¬æ¢æˆç”µå‹ï¼Œæœ€åé€šè¿‡æ•°æ¨¡ï¼ˆADï¼‰è½¬æ¢å™¨è½¬æ¢æˆç¦»æ•£çš„æ•°å­—é‡ã€‚ ç›®å‰ï¼Œæœ‰ä¸¤ç§ä¸»æµçš„å›¾åƒæŠ€æœ¯â€”â€”CCD(ç”µè·è€¦åˆå™¨ä»¶)å’Œ CMOS(äº’è¡¥é‡‘å±æ°§åŒ–ç‰©åŠå¯¼ä½“)ã€‚è¿™ä¸¤ç§æŠ€æœ¯éƒ½æ˜¯å°†ç”µå­è½¬æ¢æˆç”µå‹ï¼Œå¹¶ä¸”å¤©ç”Ÿæ˜¯è‰²ç›²çš„ï¼Œå› ä¸ºå®ƒä»¬æ— æ³•åŒºåˆ†äº§ç”Ÿç”µå­çš„ä¸åŒæ³¢é•¿ã€‚ä¸ºäº†èƒ½å¤Ÿæ˜¾ç¤ºå‡ºè‰²å½©ï¼Œåœ¨æ¯ä¸ªåƒç´ å‰ä¼šæ”¾ç½®å¾®å°çš„æ»¤å…‰è£…ç½®(ä¹Ÿç§°ä¸ºå¾®é€é•œ)ï¼Œè¿™äº›æ»¤å…‰è£…ç½®åªå…è®¸ç‰¹å®šæ³¢é•¿çš„å…‰çº¿é€šè¿‡ã€‚å°†æ³¢é•¿æ˜ å°„åˆ°é¢œè‰²çš„ä¸€ç§å¸¸è§æ–¹æ³•æ˜¯å°†æ»¤é•œè£…ç½®æ’åˆ—æˆ RGB(çº¢ã€ç»¿ã€è“)é˜µåˆ—ï¼Œä»è€Œåªå…è®¸ä¸‰ç§åŸè‰²(çº¢ã€ç»¿ã€è“)å•ç‹¬é€šè¿‡ï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°ä¸‰å¹…å•ç‹¬çš„å›¾åƒâ€”â€”æ¯å¹…å›¾åƒå¯¹åº”ä¸€ç§åŸè‰²ã€‚ é€šè¿‡å„ç§ä¸åŒçš„ç»„åˆï¼ŒRGB å€¼å¯ä»¥äº§ç”Ÿäººçœ¼å¯è§çš„ç»å¤§å¤šæ•°é¢œè‰²ã€‚å½“æ¯ä¸ªç¦»æ•£çš„é¢œè‰²å€¼è¢«ç¼–ç ä¸º 8 ä½(å³ 256 ä¸ªå€¼)æ—¶ï¼Œåˆ©ç”¨â€œRGB æ»¤å…‰å™¨â€åŸç†æ€»å…±å¯ä»¥åˆ›é€ å‡º 1670 ä¸‡ç§ä¸åŒçš„é¢œè‰²ã€‚å…¶ä¸­ï¼Œæœ€å¸¸è§çš„æ’åˆ—â€œRGB æ»¤å…‰å™¨â€çš„æ–¹æ³•æ˜¯ æ‹œè€³é˜µåˆ—ï¼ˆBayer Patternï¼‰ ï¼Œå®ƒå…·æœ‰çº¢ç»¿äº¤æ›¿å’Œè“ç»¿äº¤æ›¿ä¸¤ç§æ»¤å…‰å™¨ç»„åˆã€‚ç”±äºäººçœ¼å¯¹ç»¿è‰²æ¯”å¯¹çº¢è‰²æˆ–è“è‰²æ›´æ•æ„Ÿï¼Œæ‹œè€³é˜µåˆ—çš„ç»¿è‰²æ»¤å…‰å™¨æ•°é‡æ˜¯çº¢è‰²æ»¤å…‰å™¨æˆ–è“è‰²æ»¤å…‰å™¨çš„ä¸¤å€ã€‚åœ¨ è®¡ç®—æœºè§†è§‰ åº”ç”¨ç¨‹åºä¸­ï¼Œå½“å¤„ç†å½©è‰²å›¾åƒæ—¶ï¼ŒRGB ä¸‰ä¸ªå›¾å±‚éƒ½æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚å¦‚æœå¤„ç†èƒ½åŠ›æœ‰é™ï¼Œåˆ™å¯å°†ä¸åŒçš„é€šé“ç»„åˆæˆç°åº¦å›¾åƒã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ OpenCV è®¡ç®—æœºè§†è§‰åº“ ä¸­çš„ cvtColor æ–¹æ³•å®ç° RGB å›¾åƒåˆ°ç°åº¦å›¾åƒçš„è½¬æ¢ï¼Œå…·ä½“çš„è½¬æ¢åŸç†å’Œä½¿ç”¨è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒ OpenCV å®˜æ–¹æ–‡æ¡£ï¼š https://docs.opencv.org/3.1.0/de/d25/imgproc_color_conversions.html CCD vs. CMOSåœ¨ CCD ä¼ æ„Ÿå™¨ä¸­ï¼Œæ¯ä¸ªå›¾åƒå…ƒä»¶ä¸­æ”¶é›†åˆ°çš„ç”µå­é€šè¿‡ä¸€ä¸ªæˆ–å‡ ä¸ªè¾“å‡ºèŠ‚ç‚¹ä»èŠ¯ç‰‡ä¸­ä¼ è¾“å‡ºæ¥ã€‚ç„¶åï¼Œç”µè·è¢«è½¬æ¢æˆç”µå‹ç”µå¹³ï¼Œç»è¿‡ Buffer ç¼“å­˜åä½œä¸ºæ¨¡æ‹Ÿä¿¡å·å‘é€å‡ºå»ã€‚éšåè¯¥ä¿¡å·ä¼šè¢«ä¼ æ„Ÿå™¨å¤–çš„ä¿¡å·æ”¾å¤§å™¨æ”¾å¤§ï¼Œå¹¶åˆ©ç”¨ä¼ æ„Ÿå™¨å¤–çš„ AD è½¬æ¢å™¨å°†å°†æ”¾å¤§åçš„ä¿¡å·è½¬æ¢ä¸ºç¦»æ•£æ•°å­—é‡ã€‚æœ€åˆï¼ŒCCD æŠ€æœ¯ä¸ CMOS ç›¸æ¯”æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œæ¯”å¦‚æ›´é«˜çš„å…‰æ•æ€§å’Œæ›´ä½çš„å™ªå£°ã€‚ç„¶è€Œï¼Œè¿‘å¹´æ¥ï¼Œè¿™äº›å·®å¼‚å‡ ä¹æ¶ˆå¤±äº†ã€‚CCD çš„ä¸»è¦ç¼ºç‚¹æ˜¯ç”Ÿäº§æˆæœ¬é«˜ï¼ŒåŠŸè€—é«˜ï¼ˆæ¯” CMOS å¤§çº¦é«˜ 100 å€ï¼‰ï¼Œè¿™é€šå¸¸ä¼šå¯¼è‡´ç›¸æœºå‘çƒ­é—®é¢˜ã€‚ CMOS ä¼ æ„Ÿå™¨æœ€åˆç”¨äºæœºå™¨è§†è§‰åº”ç”¨ï¼Œä½†ç”±äºå…¶è¾ƒå·®çš„å…‰çµæ•åº¦ï¼Œå¯¼è‡´å›¾åƒè´¨é‡è¾ƒå·®ã€‚ç„¶è€Œï¼Œéšç€ç°ä»£ CMOS ä¼ æ„Ÿå™¨çš„å‘å±•ï¼Œå…¶æˆåƒè´¨é‡å’Œå…‰æ•æ€§éƒ½æœ‰äº†æ˜¾è‘—æé«˜ã€‚CMOS æŠ€æœ¯å…·æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼šä¸åŒäº CCDï¼ŒCMOS èŠ¯ç‰‡é›†æˆäº†æ”¾å¤§å™¨å’Œ AD è½¬æ¢å™¨ï¼Œè¿™å¸¦æ¥äº†å·¨å¤§çš„æˆæœ¬ä¼˜åŠ¿ã€‚å¯¹äº CCDï¼Œè¿™äº›å…ƒå™¨ä»¶å‡ä½äºä¼ æ„Ÿå™¨èŠ¯ç‰‡çš„å¤–éƒ¨ã€‚CMOS ä¼ æ„Ÿå™¨è¿˜å…·æœ‰æ›´å¿«çš„æ•°æ®è¯»å‡ºé€Ÿåº¦ã€æ›´ä½çš„åŠŸè€—ã€æ›´é«˜çš„æŠ—å™ªèƒ½åŠ›å’Œæ›´å°çš„ç³»ç»Ÿå°ºå¯¸ã€‚** åœ¨æ±½è½¦åº”ç”¨ä¸­ï¼Œç”±äºè¿™äº›ä¼˜ç‚¹ï¼Œå‡ ä¹æ‰€æœ‰çš„ç›¸æœºéƒ½ä½¿ç”¨ CMOS ä¼ æ„Ÿå™¨ã€‚** æœ¬è¯¾ç¨‹ä¸­ä½¿ç”¨çš„å¤§éƒ¨åˆ†å›¾åƒåºåˆ—çš„ç›¸æœºè®¾ç½®å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°: http://www.cvlibs.net/datasets/kitti/setup.php","categories":["3.å¼€å‘æ¡†æ¶","OpenCV"]},{"title":"çº¿ç¨‹å®‰å…¨ï¼ˆMT-safeï¼‰çš„å¤šçº¿ç¨‹å¹¶å‘æœåŠ¡å™¨ç¨‹åºå®ä¾‹_mt safe-CSDNåšå®¢","path":"/2025/04/25/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-å¤šçº¿ç¨‹-çº¿ç¨‹å®‰å…¨ï¼ˆMT-safeï¼‰çš„å¤šçº¿ç¨‹å¹¶å‘æœåŠ¡å™¨ç¨‹åºå®ä¾‹-mt-safe-CSDNåšå®¢/","content":"è¯¥ç¨‹åºæ˜¯ä¸€ä¸ª çº¿ç¨‹å®‰å…¨ï¼ˆMT-safeï¼‰çš„å¤šçº¿ç¨‹ å¹¶å‘ æœåŠ¡å™¨å®ä¾‹ã€‚åŒ…æ‹¬æœåŠ¡å™¨ç¨‹åºå’Œå®¢æˆ·ç«¯ç¨‹åºã€‚ç¼–è¯‘åŠè¿è¡Œçš„ç›¸å…³ä¿¡æ¯å¦‚ä¸‹ï¼š åŠŸèƒ½å¦‚ä¸‹:1ã€æœåŠ¡å™¨ç­‰å€™å®¢æˆ·è¿æ¥ï¼Œä¸€æ—¦è¿æ¥æˆåŠŸåˆ™æ˜¾ç¤ºå®¢æˆ·çš„åœ°å€ï¼Œæ¥ç€æ¥æ”¶è¯¥å®¢æˆ·çš„åå­—å¹¶æ˜¾ç¤ºåˆ°å±å¹•ã€‚ç„¶åæ¥æ”¶æ¥è‡ªè¯¥å®¢æˆ·çš„ä¿¡æ¯ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€‚æ¯å½“æ¥æ”¶åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™å¯¹å…¶è¿›è¡Œæ˜¾ç¤ºï¼Œå¹¶å°†æ¥æ”¶åˆ°çš„æ•°æ®ç¿»è½¬ä¹‹åå‘å›å®¢æˆ·ç«¯ã€‚ä¹‹åï¼Œç»§ç»­ç­‰å¾…è¯¥å®¢æˆ·ç«¯çš„ä¿¡æ¯ç›´è‡³è¯¥å®¢æˆ·å…³é—­è¿æ¥ã€‚æœåŠ¡å™¨å…·æœ‰åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·çš„èƒ½åŠ›ã€‚å¹¶ä¸”å¯ä»¥å­˜å‚¨æ¯ä¸ªè¿æ¥å®¢æˆ·æ‰€å‘æ¥çš„æ‰€æœ‰æ•°æ®ï¼Œå½“è¿æ¥ç»ˆæ­¢åï¼ŒæœåŠ¡å™¨å°†æ˜¾ç¤ºå®¢æˆ·çš„åå­—åŠç›¸åº”çš„æ•°æ®ã€‚2ã€å®¢æˆ·ç«¯é¦–å…ˆä¸æœåŠ¡å™¨è¿æ¥ã€‚è¿æ¥æˆåŠŸåï¼Œæ˜¾ç¤ºæˆåŠŸè¿æ¥çš„ä¿¡æ¯ã€‚æ¥ç€æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å®¢æˆ·åå­—ï¼Œå¹¶å°†åå­—å‘é€ç»™æœåŠ¡å™¨ç¨‹åºã€‚ç„¶åæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œå†å°†å­—ç¬¦ä¸²å‘é€ç»™æœåŠ¡å™¨ï¼Œå¹¶æ¥æ”¶æœåŠ¡å™¨ç¨‹åºå‘å›çš„å‘é€æˆåŠŸä¿¡æ¯ã€‚ä¹‹åï¼Œç»§ç»­ç­‰å¾…ç”¨æˆ·è¾“å…¥ç›´è‡³ç”¨æˆ·è¾“å…¥ Ctrl+Dã€‚å½“æ”¶åˆ°ç”¨æˆ·è¾“å…¥ Ctrl+D ä¹‹åï¼Œå®¢æˆ·å…³é—­è¿æ¥å¹¶é€€å‡ºã€‚æœåŠ¡å™¨ç¨‹åºå¦‚ä¸‹ï¼šï¼ˆsrv.cï¼‰ #include stdio.h#include stdlib.h#include string.h#include unistd.h#include sys/types.h#include sys/socket.h#include netinet/in.h#include arpa/inet.h#include pthread.h#define PORT 1234#define BACKLOG 5#define MAXDATASIZE 1000void process_cli(int connfd, struct sockaddr_in client); //å®šä¹‰å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„å‡½æ•°void savedata_r(char* recvbuf,int len,char* cli_data); //å®šä¹‰ä¿å­˜å®¢æˆ·æ•°æ®çš„å‡½æ•°/*çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°*/void *start_routine(void* arg);struct ARG //å®šä¹‰ARGç»“æ„ int connfd; struct sockaddr_in client;;static pthread_key_t key; //å®šä¹‰TSDå…³é”®å­—å˜é‡keystatic pthread_once_t once=PTHREAD_ONCE_INIT; //å®šä¹‰å˜é‡ONCEï¼ŒåˆæŒ‡ä¸ºPTHREAD_ONE_INITstatic void destructor(void *ptr) //å®šä¹‰è§£æå‡½æ•°destructor,åœ¨çº¿ç¨‹é€€å‡ºæ—¶è¯¥è§£æå‡½æ•°è¢«è°ƒç”¨ï¼Œä»¥é‡Šæ”¾ä¸ºTSDåˆ†é…çš„ç©ºé—´ free(ptr);static void getkey_once(void) //å®šä¹‰å‡½æ•°getkey_once(),ä»¥äº§ç”ŸTSDå…³é”®å­— pthread_key_create(key,destructor);typedef struct DATA_THR //å®šä¹‰DATA_THRç»“æ„ï¼Œç”¨äºå­˜å‚¨TSD int index;DATA_THR;main() int listenfd,connfd; pthread_t tid; //å®šä¹‰å­˜æ”¾çº¿ç¨‹IDçš„å˜é‡ struct ARG *arg; struct sockaddr_in server; struct sockaddr_in client; int sin_size; /*åˆ›å»ºTCPå¥—æ¥å­—*/ if ((listenfd =socket(AF_INET, SOCK_STREAM, 0)) == -1) /*å¼‚å¸¸å¤„ç†*/ perror(Creating socket failed.); exit(1); /*è®¾ç½®å¥—æ¥å­—é€‰é¡¹ä¸ºSO_REUSEADDR*/ int opt =SO_REUSEADDR; setsockopt(listenfd,SOL_SOCKET, SO_REUSEADDR, opt, sizeof(opt)); /*ç»‘å®šå¥—æ¥å­—åˆ°ç›¸åº”åœ°å€*/ bzero(server,sizeof(server)); server.sin_family=AF_INET; server.sin_port=htons(PORT); server.sin_addr.s_addr= htonl (INADDR_ANY); if (bind(listenfd,(struct sockaddr *)server, sizeof(server)) == -1) perror(Bind()error.); exit(1); /*ç›‘å¬ç½‘ç»œè¿æ¥*/ if(listen(listenfd,BACKLOG)== -1) perror(listen()error ); exit(1); /*æ¥å—å®¢æˆ·è¿æ¥*/ sin_size=sizeof(client); while(1) if ((connfd =accept(listenfd,(struct sockaddr *)client,sin_size))==-1) perror(accept() error ); exit(1); /*è®¾ç½®æ–°çº¿ç¨‹å‚æ•°*/ arg = (struct ARG *)malloc(sizeof(struct ARG)); arg-connfd =connfd; memcpy((void*)arg-client, client, sizeof(client)); /*ä¸€æ—¦è¿æ¥æˆåŠŸï¼Œäº§ç”Ÿæ–°çš„çº¿ç¨‹æœåŠ¡å®¢æˆ·ï¼Œå¹¶æ‰§è¡Œstart_routineå‡½æ•°*/ if(pthread_create(tid, NULL, start_routine, (void*)arg)) perror(Pthread_create() error); exit(1); close(listenfd);//å…³é—­ç›‘å¬å¥—æ¥å­—void process_cli(int connfd, struct sockaddr_in client) int num; char cli_data[5000]; char recvbuf[MAXDATASIZE], sendbuf[MAXDATASIZE], cli_name[MAXDATASIZE]; /*æ‰“å°è¿æ¥åˆ°çš„å®¢æˆ·ç«¯çš„IPåœ°å€*/ printf(You got a connection from %s. ,inet_ntoa(client.sin_addr) ); /*æ¥æ”¶å®¢æˆ·ç«¯åå­—å¹¶æ‰“å°*/ num = recv(connfd,cli_name, MAXDATASIZE,0); if (num == 0) close(connfd); printf(Client disconnected. ); return; cli_name[num - 1] =\\0; printf(Clients name is %s. ,cli_name); /*æ¥æ”¶å®¢æˆ·å‘æ¥çš„å­—ç¬¦ä¸²å¹¶åšç›¸åº”å¤„ç†*/ while (num =recv(connfd, recvbuf, MAXDATASIZE,0)) recvbuf[num] =\\0; printf(Received client( %s ) message: %s,cli_name, recvbuf); /*ä¿å­˜å®¢æˆ·æ•°æ®*/ savedata_r(recvbuf,num,cli_data); /*ç¿»è½¬å®¢æˆ·æ•°æ®*/ int i; for (i = 0; i num - 1; i++) sendbuf[i] =recvbuf[num-i-2]; sendbuf[num -1] = \\0; /*å°†ç¿»è½¬åçš„æ•°æ®å‘å›å®¢æˆ·ç«¯*/ send(connfd,sendbuf,strlen(sendbuf),0); /*å…³é—­è¿æ¥å¥—æ¥å­—å¹¶æ‰“å°å®¢æˆ·çš„ç›¸å…³ä¿¡æ¯*/ close(connfd); printf(Clinet (%s) closed connect.Users data: %s ,cli_name,cli_data);void *start_routine(void* arg) /*å–å‡ºç›¸åº”å‚æ•°*/ struct ARG *info; info = (struct ARG*)arg; process_cli(info-connfd,info-client); //å¤„ç†å®¢æˆ·è¯·æ±‚ /*é€€å‡ºçº¿ç¨‹*/ free (arg); pthread_exit(NULL);void savedata_r(char* recvbuf,int len,char* cli_data) DATA_THR* data; //çº¿ç¨‹ä¸“ç”¨ä¸ªæ•°æ® pthread_once(once,getkey_once); //è°ƒç”¨getkey_onceå‡½æ•°äº§ç”ŸTSDå…³é”®å­— //è‹¥å½“å‰ç¨‹åºæœªåˆ†é…ç©ºé—´ç»™TSDï¼Œåˆ™åˆ†é…ç©ºé—´å¹¶ä¸TSDå…³é”®å­—ç»‘å®š if((data=(DATA_THR *)pthread_getspecific(key))==NULL) data=(DATA_THR *)calloc(1,sizeof(DATA_THR)); pthread_setspecific(key,data); data-index=0; /*æŠŠæ¥æ”¶åˆ°çš„å®¢æˆ·æ•°æ®æŒ‰å…ˆåæ¬¡åºæ”¾å…¥å®¢æˆ·æ•°æ®ç¼“å†²åŒºï¼ˆcli_dataï¼‰*/ int j; for(j=0; jlen-1;j++) cli_data[data-index++]=recvbuf[j]; cli_data[data-index]=\\0; å®¢æˆ·ç«¯ç¨‹åºå¦‚ä¸‹ï¼šï¼ˆcli.cï¼‰ #includestdio.h#includeunistd.h#includestrings.h#includestring.h#includesys/types.h#includesys/socket.h#includenetinet/in.h#includenetdb.h#includestdlib.h#define PORT 1234#define MAXDATASIZE 100void process(FILE *fp,int socket);char* getMessage(char* sendline,int len,FILE* fp);int main(int argc,char *argv[]) int fd; struct hostent *he; struct sockaddr_in server; if(argc!=2) printf(Usage :%s IP Address ,argv[0]); exit(1); if((he=gethostbyname(argv[1]))==NULL) printf(gethostbyname() error. ); exit(1); if((fd=socket(AF_INET,SOCK_STREAM,0))==-1) perror(socket() error); exit(1); bzero(server,sizeof(server)); server.sin_port=htons(PORT); server.sin_family=AF_INET; server.sin_addr=*((struct in_addr *)he-h_addr); if(connect(fd,(struct sockaddr *)server,sizeof(struct sockaddr))==-1) perror(connect() error); exit(1); process(stdin,fd); close(fd);void process(FILE *fp,int sockfd) int numbytes; char recvline[MAXDATASIZE],sendline[MAXDATASIZE]; printf(Connected to server. ); printf(Input name :); if(fgets(sendline,MAXDATASIZE,fp)==NULL) printf( Exit. ); return; send(sockfd,sendline,strlen(sendline),0); while((getMessage(sendline,MAXDATASIZE,fp))!=NULL) send(sockfd,sendline,strlen(sendline),0); if((numbytes=recv(sockfd,recvline,MAXDATASIZE,0))==0) printf(Server terminated. ); return; recvline[numbytes]=\\0; printf(Server Message :%s ,recvline); printf( Exit. );char *getMessage(char *sendline,int len,FILE *fp) printf(Input string to server:); return(fgets(sendline,MAXDATASIZE,fp)); å¯¹æœåŠ¡å™¨ç¨‹åºå’Œå®¢æˆ·ç«¯ç¨‹åºåˆ†åˆ«è¿›è¡Œç¼–è¯‘ï¼Œç”Ÿæˆåä¸º srv çš„æœåŠ¡å™¨ç¨‹åºå’Œåä¸º cli çš„å®¢æˆ·ç«¯ç¨‹åºï¼š [root@mylinux 2]# gcc -o srv srv.c -lpthread[root@mylinux 2]# gcc -o cli cli.c -lpthread12 æœåŠ¡å™¨ç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹ï¼š [root@mylinux 2]# ./srvYou got a connection from 127.0.0.1. Clients name is client1.Received client( client1 ) message: 1234You got a connection from 127.0.0.1. Clients name is client2.Received client( client2 ) message: abcReceived client( client1 ) message: 5678Clinet (client1) closed connect.Users data: 12345678Received client( client2 ) message: defgClinet (client2) closed connect.Users data: abcdefg123456789 å®¢æˆ· 1 è¿è¡Œç»“æœå¦‚ä¸‹ï¼š [root@mylinux 2]# ./cli 127.0.0.1Connected to server.Input name :client1Input string to server:1234Server Message :4321Input string to server:5678Server Message :8765Input string to server:Exit.123456789 å®¢æˆ· 2 è¿è¡Œç»“æœå¦‚ä¸‹ï¼š [root@mylinux 2]# ./cli 127.0.0.1Connected to server.Input name :client2Input string to server:abcServer Message :cbaInput string to server:defgServer Message :gfedInput string to server:Exit.123456789 ç”±ç»“æœå¯è§ï¼Œè¯¥å®ä¾‹å®ç°äº†çº¿ç¨‹å®‰å…¨ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","å¤šçº¿ç¨‹"]},{"title":"è½¯ä»¶è°ƒè¯•æŠ€æœ¯ï¼ˆ2ï¼‰-- coredumpå¦‚ä½•å®ç°-alloysystem-ChinaUnixåšå®¢","path":"/2025/04/16/6-å¼€å‘å·¥å…·-è°ƒè¯•-è½¯ä»¶è°ƒè¯•æŠ€æœ¯ï¼ˆ2ï¼‰-coredumpå¦‚ä½•å®ç°-alloysystem-ChinaUnixåšå®¢/","content":"æœ€è¿‘åœ¨å·¥ä½œä¸­äº†è§£åˆ°åº”ç”¨è½¯ä»¶åœ¨å´©æºƒçš„æ—¶å€™å¯ä»¥è®¾ç½®ç”Ÿæˆè½¬å­˜æ–‡ä»¶ï¼Œè¿™ä¸ªåŠŸèƒ½å°±æ˜¯ coredumpã€‚ä¸è®ºæ˜¯åº”ç”¨ç¨‹åºå´©æºƒè¿˜æ˜¯ kernel å´©æºƒè½¬å­˜åŠŸèƒ½éƒ½æ˜¯å¾ˆå®ç”¨æŠ€æœ¯ã€‚æœ¬æ–‡æ˜¯æƒ³ä»å®ç°åŸç†è§’åº¦æ¥ç†è§£è¿™ä¸¤é¡¹æŠ€æœ¯å®ç°æ–¹æ³•ã€‚é¦–å…ˆåˆ†æä¸€ä¸‹åº”ç”¨ç¨‹åº coredump çš„å®ç°æ–¹æ³•ã€‚ ä»€ä¹ˆæ¡ä»¶è§¦å‘è½¬å­˜è¿™ä¸ªè½¬å­˜å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºæ”¶åˆ°è‡´å‘½çš„ signalï¼Œåœ¨å¤„ç†è¿™ä¸ª signal çš„æ—¶å€™ä¼šæ‰§è¡Œåº”ç”¨ç¨‹åºçš„è½¬å­˜ï¼Œå¹¶åœ¨ä¹‹åé€€å‡ºæ‰§è¡Œã€‚æœ‰ä¸€ç‚¹å¿…é¡»æ³¨æ„ï¼Œå¦‚æœç”¨æˆ·ç»™è¿™äº›è‡´å‘½ signal å®‰è£…äº†è‡ªå®šä¹‰çš„ handlerï¼Œè½¬å­˜æ˜¯ä¸ä¼šå‘ç”Ÿçš„ã€‚OKï¼Œé‚£ä¹ˆè¿™é‡Œæ€»ç»“å‡ºä¸¤ç‚¹ï¼š1,è‡´å‘½ signal ä¼šå‡ºå‘è½¬å­˜å‘ç”Ÿï¼Œè¿™äº› signal åŒ…æ‹¬å¦‚ä¸‹å†…å®¹ã€‚ 1. 398 #define SIG\\_KERNEL\\_COREDUMP\\_MASK(\\\\2. 399 rt\\_sigmask(SIGQUIT)|rt\\_sigmask(SIGILL)|\\\\3. 400 rt\\_sigmask(SIGTRAP)|rt\\_sigmask(SIGABRT)|\\\\4. 401 rt\\_sigmask(SIGFPE)|rt\\_sigmask(SIGSEGV)|\\\\5. 402 rt\\_sigmask(SIGBUS)|rt\\_sigmask(SIGSYS)|\\\\6. 403 rt\\_sigmask(SIGXCPU)|rt\\_sigmask(SIGXFSZ)|\\\\7. 404 SIGEMT\\_MASK 2,å¦‚æœä¸Šé¢çš„è‡´å‘½ signal è¢«ç”¨æˆ·å®‰è£…äº†è‡ªå®šä¹‰çš„å¤„ç†å‡½æ•°ï¼Œcoredump ä¹Ÿä¸ä¼šå‘ç”Ÿã€‚ 1. 2264if(ka-sa.sa\\_handler!=SIG\\_DFL)2. 2265/\\*Run the handler.\\*/3. 2266 ksig-ka=\\*ka;4. 22675. 2268if(ka-sa.sa\\_flagsSA\\_ONESHOT)6. 2269 ka-sa.sa\\_handler=SIG\\_DFL;7. 22708. 2271 break;/\\*will return non-zerosignrvalue\\*/9. 2272 åœ¨ kernel æŸ¥æ‰¾éœ€è¦å¤„ç†çš„ signal çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šåˆ¤æ–­è¿™ä¸ª signal æ˜¯ä¸æ˜¯é»˜è®¤å¤„ç†æ–¹å¼ï¼Œå¦‚æœæ˜¯é»˜è®¤å¤„ç†æ‰ä¼šç»§ç»­æ‰§è¡Œåˆ° coredump åˆ†æ”¯ï¼Œå¦åˆ™è·³å‡ºæŸ¥æ‰¾ç¯èŠ‚ï¼Œæ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰å¤„ç†æ–¹å¼ã€‚ è§¦å‘ coredump æ‰§è¡Œçš„åˆ†æ”¯ ç‚¹å‡»(æ­¤å¤„)æŠ˜å æˆ–æ‰“å¼€ 1. 2335if(sig\\_kernel\\_coredump(signr))2. 2336if(print\\_fatal\\_signals)3. 2337 print\\_fatal\\_signal(ksig-info.si\\_signo);4. 2338 proc\\_coredump\\_connector(current);5. 2339/\\*6. 2340\\*Ifit was abletodump core,this kills all7. 2341\\*other threadsinthe groupandsynchronizes with8. 2342\\*their demise.Ifwe lost the race with another9. 2343\\*thread getting here,itsetgroup\\_exit\\_code10. 2344\\*firstandour do\\_group\\_exitcallbelow will use11. 2345\\*that valueandignore the one we pass it.12. 2346\\*/13. 2347 do\\_coredump(ksig-info);14. 234815. å°†è‡´å‘½ signal æ‰“å°åˆ°æ§åˆ¶å°çš„ Tipså¦‚æœä½ å¼€å¯å¦‚ä¸‹ proc ç›®å½•ä¸‹çš„ optionï¼Œå°†å¼€å¯æ‰“å°è‡´å‘½ signal åˆ°æ§åˆ¶å°çš„åŠŸèƒ½ã€‚procsyskernelprint-fatal-signals coredump ä¸»è¦æ­¥éª¤å…¶å®å°†è¿™ä¸ªåº”ç”¨ç¨‹åºéƒ½å†™å…¥åˆ°ç£ç›˜çš„è¿‡ç¨‹è‚¯å®šæ˜¯éå¸¸è´Ÿè´£çš„ã€‚è¿™é‡Œæˆ‘ä¸ä¼šæ‰£æ²¡ä¸€ä¸ªç»†èŠ‚ï¼Œæœ‰ä¸€äº›åŸç†æ€§çš„ç»†èŠ‚å¯èƒ½æ¨åˆ°åé¢çš„éƒ¨åˆ†å†è¯¦ç»†å­¦ä¹ å’Œåˆ†æã€‚ä½†æ˜¯ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦äº†è§£å¦‚ä¸‹å‡ ä¸ªå…³äº coredump çš„å…³é”®å¤„ç†æµç¨‹ã€‚1, coredump ä¹‹é—´ï¼Œé¦–å…ˆè¦æ£€æŸ¥çº¿ç¨‹ç»„ä¸­æ‰€æœ‰çº¿ç¨‹æ˜¯ä¸æ˜¯å·²ç»éƒ½è¿›å…¥åˆ°äº†ä¼‘çœ çŠ¶æ€ã€‚æˆ‘ä»¬è¦ coredump å¿…é¡»ä¿è¯æˆ‘ä»¬åœ¨æ‹·è´è¿™ä¸ªè¿›ç¨‹çš„å†…å­˜ç©ºé—´çš„æ—¶å€™è¿›ç¨‹ä¸­çš„æŸäº›çº¿ç¨‹è¿˜åœ¨è¿è¡Œå¹¶æ”¹å†™å†…å­˜ç©ºé—´ã€‚2, å¯¹äºç›´æ¥å°†è¿›ç¨‹å†…å­˜è½¬å­˜åˆ°æ–‡ä»¶çš„æƒ…å†µï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ï¼Œå°±æ˜¯æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶å¼€å§‹å†™å…¥ã€‚3,å¯¹äºåˆ¶å®šäº†ç”¨æˆ·ç©ºé—´è„šæœ¬ï¼Œè¿›è¡Œä¸€äº›å‹ç¼©æ“ä½œçš„æƒ…å†µï¼Œè¿™é‡Œä¼šå¯åŠ¨ä¸€ä¸ªç”¨æˆ·æ€è¿›ç¨‹ï¼Œå¹¶åœ¨ kernel å’Œç”¨æˆ·æ€è¿›ç¨‹ä¹‹é—´å»ºç«‹ä¸€ä¸ªç®¡é“ï¼Œ kernel=========è¯»å‡º===========ç”¨æˆ·æ€è¿›ç¨‹ï¼ˆå‹ç¼©ï¼‰-----------å†™å…¥--------æ–‡ä»¶ å¯¹äºç¬¬ä¸€æ­¥å¤„ç†ï¼Œkernel æƒ³è¿›ç¨‹ç»„ä¸­æ‰€æœ‰çš„çº¿ç¨‹å‘é€ kill signal ä¿¡å·ï¼Œç„¶åç­‰å¾…æ‰€æœ‰è¿›ç¨‹éƒ½ä¸å¤„åœ¨è¿è¡ŒçŠ¶æ€ã€‚å¯¹äºç¬¬äºŒæ­¥ï¼Œå¤„ç†ç›¸å¯¹ç®€å•ï¼Œåªæ˜¯ä¹‹åå¦‚æœæœ‰å…´è¶£è¿˜å¯æ·±å…¥ç ”ç©¶ä¸€ä¸‹ coredump æ–‡ä»¶çš„æ ¼å¼åˆ°åº•æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚ç¬¬ä¸‰æ­¥ï¼Œç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œæ¯”è¾ƒå·§å¦™çš„åœ°æ–¹å°±æ˜¯åœ¨ kernel ä¸­å»ºç«‹äº†ä¸€æ¡ç®¡é“ï¼Œkernel å¤„ç† signal éƒ¨åˆ†å°† coredump å†™å…¥ç®¡é“ï¼Œè€Œæ–°å»ºçš„è¿›ç¨‹ä¸­ç®¡é“çš„å¦å¤–ä¸€ç«¯è¢«è®¾ç½®åˆ°äº†æ ‡å‡†è¾“å…¥ä¸Šé¢ã€‚ å¯¹äºå‹ç¼©è¿›ç¨‹è½¬å­˜çš„æ–¹æ³•æˆ‘ä»¬å¯ä»¥å…´å»ºä¸€ä¸ª shell æ‰§è¡Œæ–‡ä»¶ #!/bin/sh exec gzip - /root/$1.core.$2.gz ç„¶ååœ¨procsyskernelcore_pattern ä¸­å†™å…¥ |/usr/sbin/core\\_helper %e %p","categories":["6.å¼€å‘å·¥å…·","è°ƒè¯•"]},{"title":"è½¯ä»¶è°ƒè¯•æŠ€æœ¯ï¼ˆ1ï¼‰-alloysystem-ChinaUnixåšå®¢","path":"/2025/04/16/6-å¼€å‘å·¥å…·-è°ƒè¯•-è½¯ä»¶è°ƒè¯•æŠ€æœ¯ï¼ˆ1ï¼‰-alloysystem-ChinaUnixåšå®¢/","content":"æˆ‘ä»¬å…ˆçœ‹ä¸€å¼ å›¾ç‰‡ï¼Œå¤§å®¶ä¹Ÿè®¸å¾ˆç†Ÿæ‚‰ï¼Œè¿™æ˜¯ä¸€ä¸ªç©ºæŒ‡é’ˆé”™è¯¯ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªç–‘é—®ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰è§‰å¯Ÿåˆ°ã€‚å¼‚å¸¸çš„åœ°å€æ˜¯â€œdereference at 0000000000000160â€ï¼Œ è¿™ä¸ªåœ°å€æ˜¯ 0x160 çš„ä¸€ä¸ªåœ°å€ã€‚å¯¹äºä¸€èˆ¬çš„æƒ…å†µå¦‚æœæ˜¯ char *pointer = NULL *pointer = c è¿™ä¸ªå‘ç”Ÿå¼‚å¸¸å¿…å®šæ— ç–‘ï¼Œä½†æ˜¯å¦‚æœæ˜¯ char *pointer = (char *)0x160; *pointer = c; è¿™æ ·çš„ä»£ç çœ‹èµ·æ¥æ›´åƒæ˜¯é‡æŒ‡é’ˆé—®é¢˜ï¼Œæ€ä¹ˆå°±ä¸€å®šä¼šå‘ç”Ÿ NULL pointer çš„å¼‚å¸¸å‘¢ï¼Ÿ å…¶å®è¿™ä¸ªé—®é¢˜æ¶‰åŠåˆ°å†…æ ¸ä¸­ page ç®¡ç†ï¼Œå¯¹äºè™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œç”±äº NULL åœ°å€æ˜¯éæ³•åœ°å€ï¼Œåœ¨ 0 åœ°å€è™šæ‹Ÿåœ°å€çš„é¡µè¡¨è®¾ç½®æ—¶ï¼Œåº”è¯¥è®¾ç½®äº†ä¿æŠ¤ï¼Œå½“ç”¨æˆ·è®¿é—® NULL åœ°å€æ—¶ï¼Œå°±ä¼šäº§ç”Ÿå¼‚å¸¸ã€‚ä½†æ˜¯ï¼Œä¸€ä¸ªé¡µè¡¨é¡¹æ˜ å°„çš„ç‰©ç†åœ°å€å¹¶ä¸æ­¢ä¸€ä¸ªåœ°å€ï¼Œè€Œæ˜¯ä¸€ä¸ªé¡µè¡¨å¤§å°ï¼Œå¾ˆå¤šå¹³å°ä¸Šé¢æ˜¯ 4K çš„å¤§å°ï¼Œè¿™å°±æ˜¯è¯´åœ¨ 0 å¼€å§‹çš„ä¸€æ®µåœ°å€ç©ºé—´éƒ½æ˜¯éæ³•åœ°å€ï¼ˆä¸€èˆ¬ 4Kï¼‰ã€‚","categories":["6.å¼€å‘å·¥å…·","è°ƒè¯•"]},{"title":"æŸ¥çœ‹cpuä½¿ç”¨ç‡å·¥å…·æ€»ç»“-alloysystem-ChinaUnixåšå®¢","path":"/2025/04/16/1-å¹³å°ç³»ç»Ÿ-Linux-æŸ¥çœ‹cpuä½¿ç”¨ç‡å·¥å…·æ€»ç»“-alloysystem-ChinaUnixåšå®¢/","content":"æ¦‚è¿°å½“æˆ‘ä»¬é‡åˆ°è½¯ä»¶çš„æ€§èƒ½é—®é¢˜çš„æ—¶å€™ï¼Œéœ€è¦å¯¹ç³»ç»Ÿçš„ CPUï¼Œå†…å­˜ï¼Œç£ç›˜ç­‰æ–¹é¢çš„æ—¶å€™æƒ…å†µè¿›è¡ŒæŸ¥çœ‹ã€‚å…¶ä¸­æŸ¥çœ‹ CPU ä½¿ç”¨æƒ…å†µæ˜¯é¦–è¦ä»»åŠ¡ã€‚æŸ¥çœ‹ CPUï¼Œä¸»è¦æ˜¯å¼„æ¸…æ¥šä¸‹é¢çš„å‡ ä¸ªé—®é¢˜ã€‚ 1. CPU ä½¿ç”¨ç‡æ˜¯ä¸æ˜¯å¾ˆé«˜ 2. å“ªäº›è¿›ç¨‹å’Œå“ªäº›çº¿ç¨‹åœ¨å ç”¨ CPU 3. å ç”¨ CPU çš„ä»»åŠ¡å°†æ—¶é—´æ¶ˆè€—åœ¨ç”¨æˆ·æ€è¿˜æ˜¯å†…æ ¸æ€ã€‚ 4. ç³»ç»Ÿçš„è´Ÿè½½æ—¶å¤šå°‘ï¼Œç³»ç»Ÿ CPU æ˜¯ä¸æ˜¯å·²ç»è¿‡è½½äº†ã€‚ 5. å¦‚ä½•çœ‹åˆ°å ç”¨ CPU çš„ä»»åŠ¡ä¸­æ˜¯å“ªäº›è·¯å¾„çš„ä»£ç åœ¨å ç”¨ CPU ä¸Šé¢çš„äº”ä¸ªæ­¥éª¤æ˜¯ä¸€ç§å¾ˆè‡ªç„¶çš„ï¼Œå¾ªåºæ¸è¿›çš„ï¼Œç”±è¡¨åŠé‡Œçš„æ€è·¯ã€‚åŸºæœ¬ä¸Šå¼„æ¸…æ¥šäº†ä¸Šé¢çš„äº”ä¸ªæ–¹é¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼„æ¸…æ¥š CPU ä½¿ç”¨ç‡é«˜çš„å…·ä½“åŸå› ã€‚å¯¹ä¼˜åŒ–ç¨‹åºèƒ½èµ·åˆ°æŒ‡å¯¼ä½œç”¨ã€‚ æŸ¥çœ‹ CPU ä½¿ç”¨ç‡é¢å¯¹æ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä»¬ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯æŸ¥çœ‹ CPU ä½¿ç”¨ç‡ã€‚æŸ¥çœ‹ CPU ä½¿ç”¨ç‡çš„æ–¹å¼æ˜¯å¤§å®¶éƒ½ç†Ÿæ‚‰çš„ top å‘½ä»¤ï¼Œä½†æ˜¯ top åœ¨å¤šæ ¸ç³»ç»Ÿä¸­æŒ‡ç¤ºçš„æ˜¯æ‰€æœ‰ CPU çš„å¹³å‡ä½¿ç”¨ç‡ï¼Œè¿™ä¸€ç‚¹å¤§å®¶å¿…é¡»ç†è§£ã€‚æ¯”å¦‚è¯´ï¼Œå¯¹äºä¸€ä¸ª 4 æ ¸çš„ç³»ç»Ÿï¼Œå¦‚æœä¸€ä¸ª CPU çš„ä½¿ç”¨ç‡æ˜¯ 100%ï¼Œå…¶å®ƒ CPU éƒ½åœ¨ç©ºé—²çŠ¶æ€ï¼Œä½¿ç”¨ top å‘½ä»¤çœ‹åˆ°çš„ä½¿ç”¨ç‡å¯èƒ½åªæœ‰ 25%ã€‚ å¦ä¸€ä¸ª top å‘½ä»¤å°±æ˜¯ top -H -p pidï¼Œè¿™ä¸ªå‘½ä»¤èƒ½å¤ŸæŸ¥çœ‹æŸä¸€ä¸ªè¿›ç¨‹ä¸‹çš„æ‰€æœ‰çº¿ç¨‹ CPU ä½¿ç”¨ç‡ top -H -p pid ä¸Šé¢çš„è¿™ä¸ªå‘½ä»¤ä¹Ÿå°±æ˜¯æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ä¸‹å“ªäº›çº¿ç¨‹å ç”¨äº†è¾ƒå¤šçš„ CPU top - 15:31:32 up 69 days, 6:09, 35 users, load average: 1.78, 3.36, 3.86Tasks: 3 total, 0 running, 3 sleeping, 0 stopped, 0 zombieCpu(s): 0.0% us, 0.0% sy, 0.0% ni, 99.9% id, 0.0% wa, 0.0% hi, 0.0% siMem: 264037488k total, 261933344k used, 2104144k free, 4541060k buffersSwap: 33554428k total, 1116764k used, 32437664k free, 212254216k cached PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 134 root 20 0 22296 2072 0 S 0.0 0.0 0:00.09 ypbind 139 root 20 0 22296 2072 0 S 0.0 0.0 0:00.00 ypbind 140 root 20 0 22296 2072 0 S 0.0 0.0 0:18.59 ypbind å¦‚ä½•æŸ¥çœ‹è¿›ç¨‹æ¶ˆè€— CPU æ—¶é—´æ˜¯åœ¨ç”¨æˆ·æ€è¿˜æ˜¯å†…æ ¸æ€ç¨‹åºæ¶ˆè€— CPU åŸºæœ¬ä¸Šæœ‰ä¸¤ç§æƒ…å†µ 1. ç¨‹åºåœ¨è¿›è¡Œå¤§é‡çš„è®¡ç®—æ“ä½œï¼Œæ¯”å¦‚åŠ å¯†æ“ä½œç­‰ï¼Œè¿™æ—¶å€™ç¨‹åºä¼šåœ¨ç”¨æˆ·æ€æ¶ˆè€—å¤§é‡çš„ CPU 2. ç¨‹åºåœ¨è¿›è¡Œå¾ˆå¤šçš„ IO è¯·æ±‚ï¼Œæ¯”å¦‚ç½‘ç»œæ”¶å‘æŠ¥æ–‡ï¼Œæˆ–è€…è¯»å†™ç£ç›˜ï¼Œè¿™æ—¶å€™ä¼šæ¶ˆè€—å¤§é‡ CPU åœ¨å†…æ ¸æ€ä¸­ã€‚ æˆ‘ä»¬æœ‰å¦‚ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹è¿›ç¨‹æ¶ˆè€— CPU æ˜¯åœ¨ç”¨æˆ·æ€è¿˜æ˜¯åœ¨å†…æ ¸æ€ vmstat 1 mpstat -P ALL 1 sar -P ALL -u 1 $vmstat 1procs -----------memory---------- ---swap-- -----io---- --system-- ----cpu---- r b swpd free buff cache si so bi bo in cs us sy id wa 0 0 1117164 1847008 4544520 212508872 0 0 11 41 0 0 1 1 98 0 0 0 1117164 1846976 4544520 212508948 0 0 0 12 1864 3419 0 0 100 0 0 0 1117164 1847328 4544520 212508948 0 0 0 12 2210 3792 0 0 100 0 0 0 1117164 1847164 4544520 212508948 0 0 0 12 2293 3657 0 0 100 0 0 0 1117164 1846848 4544520 212508948 0 0 0 12 2946 4963 0 0 99 0 0 0 1117164 1846848 4544520 212508948 0 0 0 38020 1894 2941 0 0 100 0 0 0 1117164 1846972 4544528 212508948 0 0 0 48 401 1272 0 0 100 0 root@localhost:~# mpstat -P ALL 1Linux 3.12.19-rt30 (localhost) 01/09/70 _ppc_ (2 CPU)02:43:11 CPU %usr %nice %sys %iowait %irq %soft %steal %guest %gnice %idle02:43:12 all 97.52 0.00 1.98 0.00 0.00 0.50 0.00 0.00 0.00 0.0002:43:12 0 95.05 0.00 3.96 0.00 0.00 0.99 0.00 0.00 0.00 0.0002:43:12 1 100.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.0002:43:12 CPU %usr %nice %sys %iowait %irq %soft %steal %guest %gnice %idle02:43:13 all 96.98 0.00 3.02 0.00 0.00 0.00 0.00 0.00 0.00 0.0002:43:13 0 93.07 0.00 5.94 0.00 0.00 0.99 0.00 0.00 0.00 0.0002:43:13 1 100.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.0002:43:13 CPU %usr %nice %sys %iowait %irq %soft %steal %guest %gnice %idle02:43:14 all 97.50 0.00 2.50 0.00 0.00 0.00 0.00 0.00 0.00 0.0002:43:14 0 95.00 0.00 5.00 0.00 0.00 0.00 0.00 0.00 0.00 0.0002:43:14 1 100.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 root@localhost:~# sar -P ALL -u 1Linux 3.12.19-rt30 (localhost) 01/09/70 _ppc_ (2 CPU)03:01:04 CPU %user %nice %system %iowait %steal %idle03:01:05 all 97.00 0.00 3.00 0.00 0.00 0.0003:01:05 0 96.00 0.00 4.00 0.00 0.00 0.0003:01:05 1 98.00 0.00 2.00 0.00 0.00 0.0003:01:05 CPU %user %nice %system %iowait %steal %idle03:01:06 all 97.00 0.00 3.00 0.00 0.00 0.0003:01:06 0 95.00 0.00 5.00 0.00 0.00 0.0003:01:06 1 99.00 0.00 1.00 0.00 0.00 0.00 å¦‚ä½•æŸ¥çœ‹ç³»ç»Ÿ CPU çš„è´Ÿè½½ä»ä¸Šé¢çš„å‘½ä»¤å’Œæ–¹æ³•æˆ‘ä»¬å¤§è‡´çŸ¥é“äº†å“ªäº› CPU ä¸Šé¢ï¼Œå“ªäº›è¿›ç¨‹å’Œçº¿ç¨‹æ¶ˆè€—äº†å¤šå°‘ CPUï¼Œå¹¶ä¸”çŸ¥é“æ¶ˆè€— CPU æ˜¯åœ¨ç”¨æˆ·æ€è¿˜æ˜¯åœ¨å†…æ ¸æ€ã€‚æ¥ä¸‹å»æˆ‘ä»¬è¿˜æƒ³çŸ¥é“è¿™ä¹ˆå¤šè¿›ç¨‹åœ¨å¿™ç¢Œçš„è·‘ç€ï¼Œæ˜¯ä¸æ˜¯çœŸçš„è¾¾åˆ°äº†ç³»ç»Ÿçš„æ»¡è½½ç¨‹åº¦å‘¢ï¼Ÿå¯¹çš„ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿçš„è´Ÿè½½ï¼Œæˆ‘ä»¬æœ‰å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½ã€‚ 1. uptime 2. sar -P ALL -q 1 root@localhost:~# sar -P ALL -q 1Linux 3.12.19-rt30 (localhost) 01/09/70 _ppc_ (2 CPU)03:06:06 runq-sz plist-sz ldavg-1 ldavg-5 ldavg-15 blocked03:06:07 12 174 15.86 16.09 15.86 003:06:08 11 174 15.86 16.09 15.86 003:06:09 13 174 15.79 16.07 15.86 003:06:10 13 174 15.79 16.07 15.86 0 ä»ä¸Šé¢å‘½ä»¤çš„ç»“æœæ¥çœ‹ 1. runq-sz è¡¨ç¤ºç³»ç»Ÿä¸­å¯è¿è¡Œçš„ç¨‹åºçº¿ç¨‹æ•°ç›® 2. plist-sz è¡¨ç¤ºç³»ç»Ÿä¸­æ€»å…±çš„è¿›ç¨‹å’Œçº¿ç¨‹æ•°ç›® 3. ldavg-1 è¡¨ç¤ºä¸€åˆ†é’Ÿå†…ç³»ç»Ÿçš„è´Ÿè½½å¤§å°ï¼Œä¹Ÿå¯ä»¥ç†è§£ä½å¹³å‡å¯è¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹æ•°ç›® å¦‚ä½•æŸ¥æ‰¾æ¶ˆè€— CPU çš„ä»£ç OKï¼Œä¸Šé¢çš„æ–¹æ³•ä½¿æˆ‘ä»¬é˜Ÿæ¶ˆè€— CPU çš„ç¨‹åºæœ‰äº†å¤§æ¦‚çš„è®¤è¯†ï¼Œæœ€æœ‰æˆ‘ä»¬è¦åœ¨è¿™ä¸ªç¨‹åºä¸­æ‰¾åˆ°çœŸæ­£å¯¼è‡´ CPU å¿™çš„â€œç½ªé­ç¥¸é¦–â€ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°æœ‰é—®é¢˜çš„ä»£ç å…·ä½“ä½ç½®ï¼Œå®Œæˆè¿™ä¸ªç›®æ ‡çš„æ–¹æ³•æœ‰å¦‚ä¸‹ä¸‰ä¸ªã€‚ 1. perf top -p pid 2. pstack pid 3. ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»çš„ CPU call trace é‡‡æ ·å¹¶ä¸”ç»˜åˆ¶å‡ºç«ç„°å›¾æ¥ï¼Œè¿™ä¸ªæ–¹æ³•æ¯”è¾ƒé‡é‡çº§ï¼Œä½†æ˜¯æ›´åŠ ç›´è§‚å’Œå¯è§†åŒ–ã€‚ å½©è›‹å¦‚ä½•ç”¨ä¸€æ¡å‘½ä»¤å ç”¨ CPU while true; do a=1; done 1 ä¸Šä¸€ç¯‡ï¼š perf profiling åˆ†æç¨‹åºæ€§èƒ½ ä¸‹ä¸€ç¯‡ï¼š linux å†…å­˜æ€§èƒ½è°ƒä¼˜ ç»™ä¸»äººç•™ä¸‹äº›ä»€ä¹ˆå§ï¼~~","categories":["1.å¹³å°ç³»ç»Ÿ","Linux"]},{"title":"linux å†…å­˜æ€§èƒ½è°ƒä¼˜-alloysystem-ChinaUnixåšå®¢","path":"/2025/04/16/1-å¹³å°ç³»ç»Ÿ-Linux-linux-å†…å­˜æ€§èƒ½è°ƒä¼˜-alloysystem-ChinaUnixåšå®¢/","content":"è¦æœ‰æ•ˆç®¡ç†å’Œä¼˜åŒ– Linux å†…å­˜æ€§èƒ½ï¼Œäº†è§£å…¶åº•å±‚ç»“æ„å’Œå¯ç”¨çš„å·¥å…·è‡³å…³é‡è¦ã€‚Linux å†…å­˜ç³»ç»Ÿåˆ’åˆ†ä¸ºè™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€ï¼Œç”± MMU è¿›è¡Œè™šæ‹Ÿåœ°å€æ˜ å°„ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿç©ºé—´ï¼Œé€šå¸¸åˆ’åˆ†ä¸º 4KB çš„é¡µï¼Œå¯ä»¥é€šè¿‡ getconf PAGESIZE ç¡®è®¤ã€‚ å†…å­˜ç®¡ç†ç»“æ„ èŠ‚ç‚¹å’ŒåŒºåŸŸï¼šå†…å­˜æ ¹æ® CPU è®¿é—®é€Ÿåº¦åˆ’åˆ†ä¸ºèŠ‚ç‚¹ï¼Œåœ¨èŠ‚ç‚¹å†…åˆåˆ’åˆ†ä¸ºåŒºåŸŸï¼ˆä¾‹å¦‚ DMAã€NORMALã€HIGHMEMï¼‰ã€‚åŒºåŸŸè´Ÿè´£ç®¡ç†å†…å­˜åŒºåŸŸï¼Œç»´æŠ¤æ´»åŠ¨å’Œéæ´»åŠ¨é¡µè¡¨ï¼Œä»¥ä¾¿äºå†…å­˜å›æ”¶ã€‚ äº¤æ¢æœºåˆ¶å½“å†…å­˜ç´§å¼ æ—¶ï¼ŒLinux å°†åŒ¿åé¡µäº¤æ¢åˆ°ç£ç›˜ã€‚å‘½ä»¤å¦‚ swapon -sã€swapon -a å’Œ swapoff -a ç”¨äºç®¡ç†äº¤æ¢ç©ºé—´çš„ä½¿ç”¨ã€‚äº¤æ¢å€¾å‘æ€§å¯ä»¥é€šè¿‡è°ƒæ•´æ¥ä¼˜åŒ–ç³»ç»Ÿäº¤æ¢çš„ç§¯æç¨‹åº¦ã€‚ ç¼“å­˜ é¡µç¼“å­˜ï¼šå­˜å‚¨æ–‡ä»¶å†…å®¹ä»¥åŠ å¿«è®¿é—®é€Ÿåº¦ã€‚ ç¼“å†²åŒºç¼“å­˜ï¼šç¼“å­˜å¦‚ç›®å½•å’Œå—ç­‰å…ƒæ•°æ®ã€‚ å†…å­˜åˆ†é…Slab åˆ†é…å™¨é«˜æ•ˆåœ°ç®¡ç†å°å†…æ ¸åˆ†é…ï¼Œå‡å°‘äº†å¼€é”€ã€‚å‘½ä»¤ slabtop å’Œ cat /proc/slabinfo ç›‘æ§ Slab ä½¿ç”¨æƒ…å†µï¼Œå…¶ä¸­åŒ…æ‹¬å¦‚ inode ç­‰å†…æ ¸å¯¹è±¡ã€‚ å†…å­˜ç±»å‹å†…å­˜ç”¨äºç”¨æˆ·ç©ºé—´ï¼ˆä»£ç ã€æ•°æ®ã€å †ã€æ ˆï¼‰å’Œå†…æ ¸ç©ºé—´åŠŸèƒ½ã€‚ç”¨æˆ·ç©ºé—´åŒ…æ‹¬æ–‡ä»¶æ˜ å°„å’Œå…±äº«å†…å­˜ã€‚é¡µè¢«åˆ†ç±»ä¸ºå¯å›æ”¶ï¼ˆåŒ¿åã€ç¼“å­˜ï¼‰æˆ–ä¸å¯å›æ”¶ï¼ˆå†…æ ¸åˆ†é…ï¼‰ã€‚ ç›‘æ§å·¥å…· vmstat æ˜¾ç¤ºå†…å­˜ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç©ºé—²ã€ç¼“å†²ã€ç¼“å­˜ã€äº¤æ¢å’Œ IO æŒ‡æ ‡ã€‚ top ç»“åˆ shift + m æŒ‰å†…å­˜æ’åºï¼Œshift + p æŒ‰ CPU æ’åºã€‚ pmap æ˜¾ç¤ºæ¯ä¸ªè¿›ç¨‹çš„è¯¦ç»†å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ ä¼˜åŒ–ç­–ç•¥ ç›‘æ§äº¤æ¢ç©ºé—´ä½¿ç”¨æƒ…å†µï¼šä½¿ç”¨ vmstat æ£€æŸ¥äº¤æ¢æ´»åŠ¨ã€‚é«˜äº¤æ¢ä½¿ç”¨å¯èƒ½è¡¨æ˜å†…å­˜å‹åŠ›ã€‚ è°ƒæ•´äº¤æ¢å€¾å‘æ€§ï¼šä¿®æ”¹ /proc/sys/vm/swappiness æ§åˆ¶äº¤æ¢è¡Œä¸ºã€‚ åŒºåŸŸå›æ”¶ï¼šæ ¹æ®éœ€è¦è°ƒæ•´å¦‚ zone_reclaim_mode ç­‰è®¾ç½®ï¼Œç‰¹åˆ«æ˜¯åœ¨ NUMA ç³»ç»Ÿä¸­ã€‚ åˆ†æç¼“å­˜ï¼šä½¿ç”¨ vmstat å’Œ slabtop ç¡®ä¿ç¼“å­˜å’Œ Slab ä½¿ç”¨æ•ˆç‡ã€‚ åº”ç”¨åˆ†æï¼šä½¿ç”¨å¦‚ top å’Œ pmap è¯†åˆ«å‡ºå†…å­˜å¯†é›†å‹è¿›ç¨‹ã€‚ é€šè¿‡åˆ©ç”¨è¿™äº›å·¥å…·å¹¶ç†è§£å†…å­˜ç®¡ç†ï¼Œä½ å¯ä»¥æœ‰æ•ˆè¯Šæ–­é—®é¢˜å¹¶ä¼˜åŒ–æ€§èƒ½ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux"]},{"title":"linuxè½¯ä¸­æ–­æœºåˆ¶åˆ†æ-alloysystem-ChinaUnixåšå®¢","path":"/2025/04/16/1-å¹³å°ç³»ç»Ÿ-Linux-linuxè½¯ä¸­æ–­æœºåˆ¶åˆ†æ-alloysystem-ChinaUnixåšå®¢/","content":"1. ä¸ºä»€ä¹ˆä½¿ç”¨è½¯ä¸­æ–­åœ¨ç¼–å†™é©±åŠ¨æˆ–å¤„ç†ä¸­æ–­æ—¶ï¼Œç¡¬ä»¶ä¸­æ–­å‘ç”Ÿåï¼Œå†…æ ¸ä¼šæ‰§è¡Œä¸­æ–­å¤„ç†å‡½æ•°ï¼ˆISRï¼‰ã€‚åœ¨ ISR ä¸­ï¼Œç³»ç»Ÿä¼šä¸´æ—¶å…³é—­ä¸­æ–­ä»¥å¤„ç†å½“å‰äº‹ä»¶ã€‚æ­¤æ—¶ï¼Œè‹¥ ISR å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œå¯èƒ½å¯¼è‡´å…¶ä»–ç¡¬ä»¶ä¸­æ–­è¢«å¿½ç•¥ï¼Œé€ æˆæ•°æ®ä¸¢å¤±æˆ–ç³»ç»Ÿå“åº”å˜æ…¢ã€‚ä¸ºæ­¤ï¼ŒLinux å†…æ ¸é‡‡ç”¨äº†ä¸€ç§æœºåˆ¶ï¼Œå°† ISR ä»»åŠ¡åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šå…³é”®éƒ¨åˆ†åœ¨ ISR å†…å¤„ç†ï¼Œå‰©ä½™éƒ¨åˆ†é€šè¿‡è½¯ä¸­æ–­å¼‚æ­¥å¤„ç†ã€‚è½¯ä¸­æ–­å…è®¸ç³»ç»Ÿåœ¨ ISR å®Œæˆåï¼Œé‡æ–°å¯ç”¨ç¡¬ä»¶ä¸­æ–­ï¼ŒåŒæ—¶å°†è¾ƒå¤æ‚çš„ä»»åŠ¡å»¶è¿Ÿå¤„ç†ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½åŠæ—¶å“åº”æ–°ä¸­æ–­ã€‚ 2. ä½•æ—¶è§¦å‘è½¯ä¸­æ–­è½¯ä¸­æ–­çš„è§¦å‘é€šå¸¸å‘ç”Ÿåœ¨ç¡¬ä»¶ä¸­æ–­å¤„ç†å®Œæˆåã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨ ISR å®Œæˆä»»åŠ¡åï¼Œç³»ç»Ÿä¼šè°ƒç”¨ irq_exit()ï¼Œè¯¥å‡½æ•°æ ¹æ®æ¡ä»¶å†³å®šæ˜¯å¦è§¦å‘è½¯ä¸­æ–­å¤„ç†ã€‚ ç¡¬ä»¶ä¸­æ–­å¤„ç†æµç¨‹ä»¥ä¸‹æ˜¯ç¡¬ä»¶ä¸­æ–­å¤„ç†æµç¨‹çš„ç®€è¦è¯´æ˜ï¼š void __exception do_IRQ(unsigned int irq, struct pt_regs *regs) struct pt_regs *old_regs = set_irq_regs(regs); irq_enter(); // å¤„ç†ç¡¬ä»¶ä¸­æ–­ if (irq = NR_IRQS) handle_bad_irq(irq, bad_irq_desc); else generic_handle_irq(irq); // ARMç‰¹æœ‰çš„å¤„ç† irq_finish(irq); irq_exit(); set_irq_regs(old_regs); irq_exit å‡½æ•°irq_exit() è´Ÿè´£è§¦å‘è½¯ä¸­æ–­å¤„ç†ï¼š void irq_exit(void) account_system_vtime(current); trace_hardirq_exit(); sub_preempt_count(IRQ_EXIT_OFFSET); if (!in_interrupt() local_softirq_pending()) invoke_softirq(); // rcu å’Œ timer ç›¸å…³å¤„ç† preempt_enable_no_resched(); å…³é”®æ¡ä»¶ï¼š ä¸åœ¨ç¡¬ä»¶æˆ–è½¯ä¸­æ–­å¤„ç†ä¸­ï¼šé€šè¿‡ in_interrupt() å’Œ preempt_count() æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å¤„äºä¸­æ–­å¤„ç†çŠ¶æ€ã€‚ #define in_interrupt() (irq_count())#define irq_count() (preempt_count() (HARDIRQ_MASK | SOFTIRQ_MASK)) preempt_count ä½¿ç”¨ç‰¹å®šä½è¡¨ç¤ºä¸­æ–­çŠ¶æ€ï¼Œé¿å…è½¯ä¸­æ–­åµŒå¥—ã€‚ å­˜åœ¨å¾…å¤„ç†çš„è½¯ä¸­æ–­ï¼šé€šè¿‡ local_softirq_pending() æ£€æŸ¥æ˜¯å¦æœ‰è½¯ä»¶ä¸­æ–­ç­‰å¾…å¤„ç†ã€‚ è¿™äº›æœºåˆ¶ç¡®ä¿è½¯ä¸­æ–­ä»…åœ¨é€‚å½“æ—¶åˆ»è§¦å‘ï¼Œå¹³è¡¡äº†ç³»ç»Ÿçš„å“åº”æ€§ä¸ç¨³å®šæ€§ã€‚ 3. è½¯ä¸­æ–­çš„å¤„ç†è¿‡ç¨‹__do_softirq å‡½æ•°ä»¥ä¸‹æ˜¯è½¯ä¸­æ–­å¤„ç†çš„ä¸»è¦æµç¨‹ï¼š asmlinkage void __do_softirq(void) struct softirq_action *h; __u32 pending; int max_restart = MAX_SOFTIRQ_RESTART; int cpu; pending = local_softirq_pending(); account_system_vtime(current); __local_bh_disable((unsigned long)__builtin_return_address(0)); trace_softirq_enter(); cpu = smp_processor_id();restart: set_softirq_pending(0); local_irq_enable(); h = softirq_vec; do if (pending 1) int prev_count = preempt_count(); h-action(h); if (unlikely(prev_count != preempt_count())) // ä¸­æ–­è®¡æ•°å¼‚å¸¸å¤„ç† rcu_bh_qsctr_inc(cpu); h++; pending = 1; while (pending); local_irq_disable(); pending = local_softirq_pending(); if (pending --max_restart) goto restart; if (pending) wakeup_softirqd(); trace_softirq_exit(); account_system_vtime(current); __local_bh_enable(); å¤„ç†æµç¨‹è¯´æ˜ åˆå§‹åŒ–å’Œå‡†å¤‡ï¼šè·å–å½“å‰ CPU çš„è½¯ä¸­æ–­çŠ¶æ€ï¼Œç¦ç”¨å†…æ ¸æŠ–.pkiktï¼ˆBottom Halfï¼‰ã€‚ é‡å¯æœºåˆ¶ï¼šä½¿ç”¨ MAX_SOFTIRQ_RESTART æ§åˆ¶æœ€å¤šé‡å¯æ¬¡æ•°ï¼Œé˜²æ­¢æ­»å¾ªç¯ã€‚ å¾ªç¯å¤„ç†è½¯ä¸­æ–­ï¼šéå†æ‰€æœ‰è½¯ä¸­æ–­ä½ï¼Œæ‰§è¡Œå¯¹åº”çš„å¤„ç†å‡½æ•°ã€‚ é‡æ–°å¯ç”¨ä¸­æ–­å’Œæ£€æŸ¥ï¼šåœ¨å¤„ç†å®Œä¸€æ¬¡å¾ªç¯åï¼Œé‡æ–°å¯ç”¨ç¡¬ä»¶ä¸­æ–­ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„è½¯ä¸­æ–­äº§ç”Ÿã€‚ å”¤é†’è½¯ä¸­æ–­å®ˆæŠ¤è¿›ç¨‹ï¼šå¦‚æœä»æœ‰å¾…å¤„ç†çš„è½¯ä¸­æ–­ï¼Œå”¤é†’ softirqd å®ˆæŠ¤è¿›ç¨‹ä»¥ç»§ç»­å¤„ç†ã€‚ è½¯ä¸­æ–­çš„æ„ä¹‰ é˜²æ­¢ä¸­æ–­ä¸¢å¤±ï¼šé€šè¿‡å»¶è¿Ÿå¤„ç†éç´§æ€¥ä»»åŠ¡ï¼Œä¿è¯ç¡¬ä»¶ä¸­æ–­èƒ½åŠæ—¶å“åº”ã€‚ é™ä½ç³»ç»Ÿå»¶è¿Ÿï¼šå…³é”®ä»»åŠ¡åœ¨ ISR å¿«é€Ÿå¤„ç†ï¼Œå‡å°‘ä¸­æ–­ç¦ç”¨æ—¶é—´ï¼Œé™ä½å»¶è¿Ÿã€‚ æå‡ç³»ç»Ÿç¨³å®šæ€§ï¼šæ§åˆ¶è½¯ä¸­æ–­çš„è§¦å‘å’Œå¤„ç†ï¼Œé¿å…åµŒå¥—å’Œæ­»é”ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œã€‚ 1. è½¯ä¸­æ–­çš„å¤„ç†æµç¨‹ä»¥ä¸‹æ˜¯è½¯ä¸­æ–­å¤„ç†çš„è¯¦ç»†æ­¥éª¤ï¼š è·å–è½¯ä¸­æ–­ä½é¦–å…ˆï¼Œç³»ç»Ÿé€šè¿‡è°ƒç”¨ local_softirq_pending å‡½æ•°è·å–å½“å‰ CPU ä¸Š pending çš„è½¯ä¸­æ–­ä½ã€‚ä¸åŒçš„ä½è¡¨ç¤ºä¸åŒçš„è½¯ä¸­æ–­ç±»å‹ï¼Œä¾‹å¦‚ç½‘ç»œæ•°æ®å¤„ç†ã€å®šæ—¶å™¨äº‹ä»¶ç­‰ã€‚å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆæŸ¥çœ‹é‚®ç®±ä¸­çš„ä¿¡ä»¶ï¼Œå†³å®šæ˜¯å¦éœ€è¦å»å¤„ç†ã€‚ ç¦æ­¢è½¯ä¸­æ–­é‡å…¥éšåï¼Œè°ƒç”¨ __local_bh_disable å‡½æ•°å…³é—­æœ¬åœ°è½¯ä¸­æ–­ã€‚è¿™å®é™…ä¸Šæ˜¯é€šè¿‡è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½ï¼ˆ_ scientifically ratedï¼‰ï¼Œæ¥é˜²æ­¢åŒä¸€ CPU ä¸Šçš„å…¶ä»–è½¯ä¸­æ–­å¤„ç†ç¨‹åº(softirq)é‡å…¥ã€‚è¿™ä¸ªæœºåˆ¶ç±»ä¼¼äºæ²¡æœ‰é—¨ç¦ç³»ç»Ÿæ—¶æˆ‘ä»¬ç”¨ä¸€æŠŠæ’é”€é˜²æ­¢åˆ«äººéšä¾¿è¿›å±‹ã€‚ é‡ç½®è½¯ä¸­æ–­æ ‡è®°æ¥ç€ï¼Œé€šè¿‡ set_softirq_pending å‡½æ•°å°†è½¯ä¸­æ–­æ ‡è®°ä½é‡ç½®ä¸º 0ã€‚è¿™é‡Œçš„å…³é”®æ˜¯ï¼šåªæœ‰ç¡¬ä»¶ä¸­æ–­ï¼ˆç¡¬ä»¶äº§ç”Ÿçš„ä¿¡å·ï¼‰æ‰èƒ½é‡æ–°è®¾ç½®è¿™äº›è½¯ä»¶ä¸­æ–­ä½ï¼Œä»è€Œé¿å…åœ¨è½¯ä»¶ä¸­æ–­å¤„ç†è¿‡ç¨‹ä¸­æ— é™åˆ¶åœ°äº§ç”Ÿæ–°çš„è¯·æ±‚ã€‚ é‡æ–°å¯ç”¨ç¡¬ä»¶ä¸­æ–­è¿™ä¸€æ­¥éå¸¸é‡è¦ï¼Œé‡æ–°å¯ç”¨ç¡¬ä»¶ä¸­æ–­ï¼ˆsti æŒ‡ä»¤ï¼‰åï¼Œç³»ç»Ÿå°±å¯ä»¥æ­£å¸¸å“åº”å¤–éƒ¨è®¾å¤‡çš„ä¿¡å·äº†ã€‚ä¾‹å¦‚ï¼Œå½“ç½‘å¡æ¥æ”¶åˆ°æ•°æ®åŒ…æ—¶ï¼Œä¼šé€šè¿‡ç¡¬ä»¶ä¸­æ–­é€šçŸ¥ CPUï¼Œè€Œæˆ‘ä»¬æ²¡æœ‰ç†ç”±é•¿æ—¶é—´é˜»æ­¢è¿™ç§é€šçŸ¥â€”â€”å¦åˆ™æ•°æ®åŒ…å¯èƒ½ä¼šä¸¢å¤±ã€‚ éå†å’Œå¤„ç†è½¯ä¸­æ–­åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥æ¯ä¸€ä½è½¯ä¸­æ–­æ ‡å¿—ã€‚å¦‚æœæŸä¸ªä½è¢«è®¾ç½®ï¼Œå°±è°ƒç”¨å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼ˆä¾‹å¦‚ç½‘ç»œæ•°æ®åŒ…çš„å¤„ç†å‡½æ•° net_rx_actionï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å¢é‡å¼çš„â€”â€”æ¯æ¬¡å¤„ç†ä¸€ä¸ªä¸­æ–­ä½ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰ã€‚åŒæ—¶ï¼Œç¡¬ä»¶ä¸­æ–­åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ˜¯è¢«å…è®¸çš„ï¼Œè¿™å…è®¸è®¾å¤‡éšæ—¶è§¦å‘æ–°çš„ä¸­æ–­ï¼ˆæ¯”å¦‚ç£ç›˜å®Œæˆ IO æ“ä½œéœ€è¦é€šçŸ¥ç³»ç»Ÿï¼‰ï¼Œè€Œä¸ä¼šè¢«ä¸¢å¤±ã€‚è¿™æ ·ï¼Œç³»ç»Ÿæ—¢å“åº”äº†è½¯ä¸­æ–­ï¼Œä¹Ÿä¸ä¼šâ€œå¿½ç•¥â€ç¡¬ä»¶çš„ç´§æ€¥ä¿¡å·ã€‚ å¹³è¡¡ä¸­æ–­å¤„ç†å’Œå…¶ä»–ä»»åŠ¡çš„è¿è¡Œåœ¨å¤„ç†å®Œæ‰€æœ‰å½“å‰ pending çš„è½¯ä¸­æ–­ä¹‹åï¼Œç³»ç»Ÿä¼šå…³é—­ç¡¬ä»¶ä¸­æ–­ï¼Œå†æ¬¡æ£€æŸ¥æ˜¯å¦ä»æœ‰æœªå¤„ç†çš„è½¯ä¸­æ–­ã€‚æ­¤æ—¶éœ€è¦è€ƒè™‘ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š å¦‚æœä»æœ‰æœªå¤„ç†çš„è½¯ä¸­æ–­ï¼Œå¹¶ä¸”åœ¨æœ¬æ¬¡ __do_softirq å‡½æ•°è°ƒç”¨ä¸­å¤„ç†çš„æ¬¡æ•°è¿˜æœªè¶…è¿‡ 10 æ¬¡ï¼ˆé€šè¿‡ cond_resched å‡½æ•°åˆ¤æ–­ï¼‰ï¼Œé‚£ä¹ˆç»§ç»­å¤„ç†è½¯ä¸­æ–­ã€‚ å¦‚æœå·²ç»å¤„ç†äº† 10 æ¬¡ä»ç„¶æœ‰æ›´å¤šè½¯ä¸­æ–­ pendingï¼Œé‚£ä¹ˆä¼šè°ƒç”¨ wakeup_softirqd() å‡½æ•°ï¼Œå”¤é†’ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼ˆksoftirqdï¼‰æ¥ç»§ç»­å¤„ç†å‰©ä½™çš„è½¯ä¸­æ–­ã€‚ è¿™é‡Œçš„â€œ10 æ¬¡â€æ˜¯ä¸€ä¸ªç»éªŒå€¼ï¼Œé˜²æ­¢åœ¨å¤„ç†è½¯ä¸­æ–­æ—¶é•¿æ—¶é—´å ç”¨ CPUï¼Œè€Œå½±å“ç³»ç»Ÿçš„å“åº”æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ CPU ä¸Šä¸€ç›´åœ¨å¤„ç†å¤§é‡çš„ç½‘ç»œæ•°æ®åŒ…ï¼Œå¯èƒ½ä¼šè®©å…¶ä»–ä»»åŠ¡ï¼ˆä¾‹å¦‚ç”¨æˆ·åº”ç”¨ç¨‹åºï¼‰â€œé¥¿æ­»â€ã€‚é€šè¿‡é™åˆ¶æ¬¡æ•°ï¼Œç³»ç»Ÿç¡®ä¿äº†å…¬å¹³æ€§çš„åŒæ—¶ï¼Œä¹Ÿä¿è¯äº†å®æ—¶æ€§çš„éœ€æ±‚ã€‚ 2. è½¯ä¸­æ–­å†…æ ¸çº¿ç¨‹çš„å¤„ç†æœºåˆ¶ä¸ºäº†é¿å…é•¿æ—¶é—´å ç”¨ CPUï¼ŒLinux å¼•å…¥äº†ä¸€ä¸ªå«åš ksoftirqd çš„å†…æ ¸çº¿ç¨‹æ¥å¤„ç†è½¯ä¸­æ–­ã€‚è¿™ä¸ªçº¿ç¨‹ä¼šåœ¨å¿…è¦æ—¶è¢«å”¤é†’ï¼Œä»¥ç¡®ä¿è½¯ä¸­æ–­çš„å®Œæˆã€‚ 1. å†…æ ¸çº¿ç¨‹çš„ä½œç”¨ é¿å…é•¿æ—¶é—´å ç”¨ CPUä¸­æ–­å¤„ç†æ—¶é—´è¿‡é•¿å¯èƒ½å¯¼è‡´ç³»ç»Ÿçš„å“åº”æ—¶é—´å˜å·®ã€‚é€šè¿‡å°†è½¯ä¸­æ–­çš„å¤„ç†ä»»åŠ¡äº¤ç»™å†…æ ¸çº¿ç¨‹ï¼Œå¯ä»¥è®©ä¸­æ–­å¤„ç†åœ¨ä¸åŒçš„ context ä¸­å®Œæˆï¼Œä»è€Œè®©å…¶ä»–ä»»åŠ¡ä¹Ÿæœ‰æœºä¼šè¿è¡Œã€‚ å¤„ç†é‚£äº›åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­æ— æ³•å®Œæˆçš„ä»»åŠ¡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè½¯ä¸­æ–­çš„å¤„ç†æœ‰ä¸¤ç§ contextï¼šä¸€ç§æ˜¯ä¸­æ–­ä¸Šä¸‹æ–‡ï¼Œå¦ä¸€ç§æ˜¯è¿›ç¨‹ä¸Šä¸‹æ–‡ã€‚åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­ï¼ŒæŸäº›æ“ä½œæ˜¯è¢«ç¦æ­¢çš„ï¼Œä¾‹å¦‚ç¡çœ ç­‰å¾… IO æ“ä½œå®Œæˆã€‚è¿™äº›æ“ä½œéœ€è¦åœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­å®Œæˆã€‚å†…æ ¸çº¿ç¨‹æ­£å¥½è¿è¡Œåœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­ï¼Œå¯ä»¥å®Œæˆè¿™äº›æ— æ³•åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­å¤„ç†çš„ä»»åŠ¡ã€‚ ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼šç½‘ç»œæ•°æ®çš„æ¥æ”¶å¤„ç†å½“ç½‘å¡æ¥æ”¶åˆ°æ•°æ®åŒ…æ—¶ï¼Œä¼šè§¦å‘ç¡¬ä»¶ä¸­æ–­ï¼Œä¸­æ–­å¤„ç†ç¨‹åºï¼ˆISRï¼‰ä¼šå°†æ•°æ®è§£åŒ…ï¼Œå¹¶å°†å…¶äº¤ç»™ä¸Šå±‚åè®®æ ˆå¤„ç†ã€‚ä¸ºäº†ä¸åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­å ç”¨å¤ªå¤šæ—¶é—´ï¼Œåè®®æ ˆçš„å¤„ç†ï¼ˆä¾‹å¦‚ TCPIP æ•°æ®çš„å¤„ç†ï¼‰ä¼šé€šè¿‡è½¯ä¸­æ–­çš„æ–¹å¼è¢«å¼‚æ­¥å¤„ç†ã€‚å¦‚æœåœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­å¤„ç†è¿™äº›ä»»åŠ¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶ä»–ä¸­æ–­è¢«å»¶è¿Ÿï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„å“åº”èƒ½åŠ›ã€‚ 2. å†…æ ¸çº¿ç¨‹çš„è¿ä½œæœºåˆ¶ä¸‹é¢æ˜¯ ksoftirqd å†…æ ¸çº¿ç¨‹çš„ä»£ç åŠå…¶åŸç†ï¼š static int ksoftirqd(void *__bind_cpu) set_current_state(TASK_INTERRUPTIBLE); while (!kthread_should_stop()) preempt_disable(); if (!local_softirq_pending()) preempt_enable_no_resched(); schedule(); preempt_disable(); __set_current_state(TASK_RUNNING); while (local_softirq_pending()) if (cpu_is_offline((long)__bind_cpu)) goto wait_to_die; do_softirq(); preempt_enable_no_resched(); cond_resched(); preempt_disable(); rcu_qsctr_inc((long)__bind_cpu); preempt_enable(); set_current_state(TASK_INTERRUPTIBLE); __set_current_state(TASK_RUNNING); return 0;wait_to_die: preempt_enable(); set_current_state(TASK_INTERRUPTIBLE); while (!kthread_should_stop()) schedule(); set_current_state(TASK_INTERRUPTIBLE); __set_current_state(TASK_RUNNING); return 0; è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œä¸»è¦è´Ÿè´£ä»¥ä¸‹å‡ éƒ¨åˆ†çš„å·¥ä½œï¼š æ£€æŸ¥æ˜¯å¦æœ‰å¾…å¤„ç†çš„è½¯ä¸­æ–­å¤–å±‚çš„ while (!kthread_should_stop()) å¾ªç¯ä¼šåœ¨æ²¡æœ‰çº¿ç¨‹åº”è¯¥åœæ­¢æ—¶ç»§ç»­è¿è¡Œã€‚åœ¨æ¯æ¬¡å¾ªç¯å¼€å§‹æ—¶ï¼Œé¦–å…ˆç”¨ preempt_disable() å…³é—­æŠ¢å ï¼Œä½¿å¾—å…¶ä»–è¿›ç¨‹æˆ–ä¸­æ–­ä¸èƒ½æŠ¢å å½“å‰ CPU çš„æ‰§è¡Œæƒé™ã€‚åŒæ—¶ï¼Œé€šè¿‡ local_softirq_pending() å‡½æ•°æ£€æŸ¥å½“å‰ CPU ä¸Šæ˜¯å¦æœ‰ pending çš„è½¯ä¸­æ–­ã€‚ å¦‚æœæ²¡æœ‰è½¯ä¸­æ–­ï¼Œåˆ™è®©å‡º CPUå¦‚æœå½“å‰æ²¡æœ‰ pending çš„è½¯ä¸­æ–­ï¼Œç³»ç»Ÿä¼šè°ƒç”¨ preempt_enable_no_resched() å’Œ schedule() å‡½æ•°ï¼Œè®©å‡º CPU å¼€å§‹è°ƒåº¦å…¶ä»–ä»»åŠ¡ã€‚è¿™æ—¶ï¼Œç³»ç»Ÿä¼šè¿›å…¥ç¡çœ çŠ¶æ€ï¼Œç›´åˆ°æœ‰æ–°çš„è½¯ä¸­æ–­è¢«è§¦å‘ã€‚ å¦‚æœæœ‰è½¯ä¸­æ–­ï¼Œå¼€å§‹å¤„ç†å¦‚æœæœ‰ pending çš„è½¯ä¸­æ–­ï¼Œç³»ç»Ÿä¼šå°†å½“å‰çº¿ç¨‹çš„çŠ¶æ€è®¾ç½®ä¸º TASK_RUNNING å¹¶è¿›å…¥å†…å±‚å¾ªç¯ã€‚å†…å±‚å¾ªç¯ä¸æ–­è°ƒç”¨ do_softirq() å‡½æ•°å¤„ç†è½¯ä¸­æ–­ã€‚ å®šæœŸæ£€æŸ¥æ˜¯å¦éœ€è¦è®©å‡º CPUåœ¨å†…å±‚å¾ªç¯ä¸­ï¼Œæ¯æ¬¡å¤„ç†å®Œä¸€ä¸ªè½¯ä¸­æ–­åï¼Œç³»ç»Ÿä¼šè°ƒç”¨ cond_resched() å‡½æ•°ï¼Œè€ƒè™‘æ˜¯å¦éœ€è¦è®©å‡º CPU ç»™å…¶ä»–ä»»åŠ¡ã€‚è¿™ç§æœºåˆ¶ç±»ä¼¼äºä¸€ä¸ªâ€œç¤¼è²Œçš„:ï¼Œå®ƒä¼šåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹è®©å‡º CPUï¼š å½“å‰çº¿ç¨‹å·²ç»è¿ç»­è¿è¡Œäº†ä¸€æ®µæ—¶é—´ï¼Œè¶…è¿‡æŸä¸ªé˜ˆå€¼ã€‚ ç³»ç»Ÿè´Ÿè½½è¾ƒé«˜ï¼Œæœ‰å…¶ä»–ä»»åŠ¡éœ€è¦è¿è¡Œã€‚ è¿™ä¸ªæœºåˆ¶ä¿è¯äº†å†…æ ¸çº¿ç¨‹åœ¨å¤„ç†è½¯ä¸­æ–­æ—¶è™½ç„¶ä¼šéœ¸å ä¸€å®šçš„ CPU æ—¶é—´ï¼Œä½†ä¹Ÿä¼šä¸»åŠ¨è€ƒè™‘å…¶ä»–ä»»åŠ¡çš„éœ€æ±‚ã€‚ åº”å¯¹ CPU ä¸Šçº¿æˆ–ä¸‹çº¿çš„æƒ…å†µåœ¨å†…å±‚å¾ªç¯ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªå…³é”®çš„æ£€æŸ¥ï¼šif (cpu_is_offline((long)__bind_cpu))ã€‚è¿™æ˜¯ç”¨æ¥é˜²æ­¢å½“å½“å‰ CPU æœª rosisline æ—¶ï¼Œä»ç„¶å°è¯•æ‰§è¡Œè½¯ä¸­æ–­å¤„ç†çš„ã€‚ä¸€ä¸ªå¯èƒ½çš„åœºæ™¯æ˜¯ï¼šåœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œå¦‚æœæŸä¸ª CPU è¢«å…³é—­ï¼ˆä¾‹å¦‚ä¸ºäº†èŠ‚èƒ½ï¼‰ï¼Œç³»ç»Ÿè¿›ç¨‹å¯èƒ½ä¼šè°ƒåº¦åˆ°é”™è¯¯çš„ CPU ä¸Šè¿è¡Œã€‚æ­¤æ—¶ï¼Œçº¿ç¨‹ä¼šè·³åˆ° wait_to_die æ ‡ç­¾ï¼Œç­‰å¾…è¿›ä¸€æ­¥çš„å¤„ç†ã€‚ 3. è½¯ä¸­æ–­è®¾è®¡çš„æ™ºæ…§ä»ä¸Šè¿°çš„æŠ€æœ¯ç»†èŠ‚ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªè®¾è®¡çš„ç²¾å¦™ä¹‹å¤„ã€‚ç³»ç»Ÿåœ¨å¤„ç†è½¯ä¸­æ–­æ—¶ï¼š æ—¢â€œéœ¸é“â€åˆâ€œ pubblicâ€ â€œéœ¸é“â€æ˜¯åœ¨æ¯æ¬¡å¤„ç†è½¯ä¸­æ–­æ—¶ä¼šå…³é—­æŠ¢å ï¼Œé˜²æ­¢å…¶ä»–è¿›ç¨‹æˆ–çº¿ç¨‹æ‰“æ–­å½“å‰çš„å¤„ç†è¿‡ç¨‹ã€‚è¿™æ„å‘³ç€åœ¨åŒä¸€æ—¶åˆ»ï¼Œå…¶ä»–ä»»åŠ¡æ˜¯æ— æ³•è·å¾— CPU æ—¶é—´çš„ã€‚ â€œå…¬å¹³â€ä½“ç°åœ¨ä¸¤ç‚¹ï¼š æ¯æ¬¡å¤„ç†å®Œä¸€ä¸ªè½¯ä¸­æ–­åï¼Œéƒ½ä¼šä¸»åŠ¨è€ƒè™‘æ˜¯å¦éœ€è¦è®©å‡º CPUã€‚ å½“è¿ç»­å¤„ç†æ¬¡æ•°è¶…è¿‡ 10 æ¬¡æ—¶ï¼Œä¸»åŠ¨å”¤é†’å†…æ ¸çº¿ç¨‹ï¼Œè®©è½¯ä¸­æ–­çš„å¤„ç†åœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­å®Œæˆï¼Œä»è€Œè®©å…¶ä»–ä»»åŠ¡ä¹Ÿæœ‰æœºä¼šè¿è¡Œã€‚ â€œçš® nan ç‰‡â€å¼çš„å¤„ç†æ–¹å¼è½¯ä¸­æ–­çš„å¤„ç†é‡‡ç”¨äº†â€œShoot and Passâ€å¼çš„å“²å­¦ï¼šå°½å¿«è®°å½•ä¸‹éœ€è¦å¤„ç†çš„äº‹æƒ…ï¼Œç„¶ååœ¨åˆé€‚çš„æ—¶é—´å’Œåˆé€‚çš„ä¸Šä¸‹æ–‡ä¸­å®Œæˆå¤„ç†ã€‚è¿™ç§æ–¹å¼é¿å…äº†åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­é•¿æ—¶é—´å ç”¨ CPUï¼Œä»è€Œé¿å…äº†å¯¹ç³»ç»Ÿå“åº”æ—¶é—´çš„å½±å“ã€‚ ä»»åŠ¡åˆ†ç¦» å…¶ä¸­ï¼Œä¸­æ–­ä¸Šä¸‹æ–‡è´Ÿè´£åœ¨æœ€å°‘çš„æ—¶é—´å†…å¤„ç†å¿…è¦çš„ä»»åŠ¡ï¼ŒæŠŠå‰©ä½™çš„å·¥ä½œæ¨ç»™å†…æ ¸çº¿ç¨‹å»å¤„ç†ã€‚è¿™ç§æ–¹å¼ä½“ç°äº†â€œåŠæ—¶è¡Œä¹â€ä¸â€œå»¶è¿Ÿå¤„ç†â€çš„å¹³è¡¡ã€‚ å†…æ ¸çº¿ç¨‹åˆ™è´Ÿè´£åœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­å®Œæˆå‰©ä½™çš„ä»»åŠ¡å¤„ç†ã€‚ç”±äºè¿›ç¨‹ä¸Šä¸‹æ–‡å…è®¸ç¡çœ ç­‰å¾…ï¼Œå†…æ ¸çº¿ç¨‹å¯ä»¥å¤„ç†ä¸€äº›éœ€è¦è¾ƒé•¿æ—¶é—´å®Œæˆçš„ä»»åŠ¡ã€‚ 4. å®é™…æ¡ˆä¾‹è§£æï¼šç½‘ç»œæ•°æ®åŒ…çš„å¤„ç†ä»¥ä¸Šçš„è®¾è®¡ç†å¿µåœ¨ç³»ç»Ÿå®ç°ä¸­æœ‰å¾ˆå¤šå®é™…ä¾‹å­ï¼Œæœ€å¸¸è§çš„è«è¿‡äºç½‘ç»œæ•°æ®åŒ…çš„æ¥æ”¶å’Œå¤„ç†è¿‡ç¨‹ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•å¤è¿°ï¼š ç¡¬ä»¶ä¸­æ–­è§¦å‘ï¼š ç½‘å¡æ¥æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…åï¼Œç”¨ç¡¬ä»¶ä¸­æ–­é€šçŸ¥ CPUã€‚ ä¸­æ–­æœåŠ¡ç¨‹åº (ISR) å¤„ç†ï¼š ISR ä»ç½‘å¡ä¸­è¯»å–æ•°æ®åŒ…ï¼Œå¹¶å°†å…¶æ”¾å…¥ç³»ç»Ÿçš„æ¥æ”¶é˜Ÿåˆ—ä¸­ã€‚è¿™äº›å·¥ä½œéœ€è¦å°½å¿«å®Œæˆï¼Œå› ä¸ºéœ€è¦å°½å¿«é‡Šæ”¾ç½‘å¡çš„æ”¶ç”¨ç¯å½¢ç¼“å†²åŒºã€‚ è§¦å‘è½¯ä¸­æ–­ï¼š ISR è°ƒç”¨ tasklet_schedule() æˆ– schedule_softirq() å‡½æ•°ï¼Œè§¦å‘ç›¸åº”çš„è½¯ä¸­æ–­ï¼ˆæ¯”å¦‚ç½‘ç»œæ ¸å¿ƒè½¯ä¸­æ–­ NET_RX_SOFTIRQï¼‰ã€‚ è½¯ä¸­æ–­å¤„ç†ï¼š åœ¨è½¯ä¸­æ–­å¤„ç†å‡½æ•°ä¸­ï¼Œå°†æ•°æ®åŒ…ä»ç½‘ç»œé©±åŠ¨å±‚çš„æ¥æ”¶é˜Ÿåˆ—ä¸­å–å‡ºï¼Œå¹¶äº¤ç»™ç½‘ç»œåè®®æ ˆè¿›è¡Œå¤„ç†ã€‚ é¿å…é•¿æ—¶é—´å ç”¨å¤„ç†ï¼š å¦‚æœåè®®æ ˆçš„å¤„ç†éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œç³»ç»Ÿä¼šåœ¨é€‚å½“çš„æ—¶å€™è®©å‡º CPU ç»™å…¶ä»–ä»»åŠ¡ã€‚ 5. æ€»ç»“ä»è½¯ä¸­æ–­çš„å¤„ç†æœºåˆ¶æˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºï¼š ç³»ç»Ÿè®¾è®¡ä¸­éœ€è¦è€ƒè™‘â€œéœ¸é“â€å’Œâ€œ pubblicâ€çš„å¹³è¡¡ éœ¸é“æ˜¯ä¸ºäº†ä¿è¯å…³é”®ä»»åŠ¡çš„é«˜æ•ˆå¤„ç†ã€‚ å…¬å¹³æ˜¯ä¸ºäº†ä¿è¯æ•´ä½“çš„ç³»ç»Ÿå¥åº·ï¼Œé¿å…å•ä¸€ä»»åŠ¡å ç”¨è¿‡å¤šçš„èµ„æºã€‚ ä»»åŠ¡çš„åˆ†è§£å’Œåˆ†ç¦»æ˜¯é«˜æ•ˆç³»ç»Ÿè®¾è®¡çš„åŸºç¡€ å°†ä¸åŒçš„ä»»åŠ¡æ ¹æ®å…¶ç‰¹ç‚¹åˆ†è§£åˆ°ä¸åŒçš„ Context ä¸­å¤„ç†ï¼Œä¸ä»…å¯ä»¥æé«˜å¤„ç†æ•ˆç‡ï¼Œè¿˜èƒ½ä¿è¯ç³»ç»Ÿçš„å“åº”èƒ½åŠ›ã€‚ ä¸­æ–­ä¸å…¶å¤„ç†ä¹‹é—´çš„â€œéš”ç¦»â€ ä¸€åˆ‡çš„ç›®çš„æ˜¯è®©ä¸­æ–­å°½å¿«è¢«å¤„ç†ï¼ŒåŒæ—¶é¿å…è®©ä¸­æ–­å¤„ç†å½±å“ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚ è¿™äº›è®¾è®¡ç†å¿µåœ¨æˆ‘ä»¬åº”å¯¹ä¸ªäººå’Œå›¢é˜Ÿä»»åŠ¡æ—¶ä¹Ÿæœ‰é‡è¦çš„å€Ÿé‰´æ„ä¹‰ã€‚ä¾‹å¦‚ï¼šåœ¨å›¢é˜Ÿåä½œä¸­ï¼Œæˆ‘ä»¬æ—¢è¦æœ‰â€œéœ¸é“â€çš„æ‰§è¡ŒåŠ›ï¼Œæ¨åŠ¨ä»»åŠ¡çš„å®Œæˆï¼›åŒæ—¶ä¹Ÿè¦æœ‰â€œ å…¬å¹³ GameManager â€ï¼Œè€ƒè™‘å›¢é˜Ÿæˆå‘˜çš„åˆ©ç›Šå’Œæ„Ÿå—ã€‚è¿™æ ·çš„å¹³è¡¡æ‰èƒ½è®©æ•´ä¸ªå›¢é˜Ÿé«˜æ•ˆè€Œå’Œè°åœ°è¿è¡Œã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux"]},{"title":"perf profiling åˆ†æç¨‹åºæ€§èƒ½","path":"/2025/04/16/1-å¹³å°ç³»ç»Ÿ-Linux-perf-profiling-åˆ†æç¨‹åºæ€§èƒ½/","content":"perf profiling åˆ†æç¨‹åºæ€§èƒ½ç¨‹åºæ€§èƒ½åˆ†æåœ¨è®¡ç®—æœºç¨‹åºçš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ€§èƒ½ä¼˜åŒ–è‡³å…³é‡è¦ã€‚perf æ˜¯ Linux ç³»ç»Ÿä¸Šä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºåˆ†æç¨‹åºçš„æ€§èƒ½ã€‚å®ƒé€šè¿‡ä»¥ä¸€å®šé¢‘ç‡é‡‡é›†ç¨‹åºçš„è°ƒç”¨æ ˆï¼ˆcall stackï¼‰ï¼Œç„¶åå¯¹è¿™äº›è°ƒç”¨æ ˆè¿›è¡Œç»Ÿè®¡åˆ†æã€‚å…·ä½“æ¥è¯´ï¼Œperf ä¼šè®°å½•ç¨‹åºåœ¨è¿è¡Œæ—¶æ‰€æ‰§è¡Œçš„å‡½æ•°è°ƒç”¨è·¯å¾„ï¼Œå¹¶é€šè¿‡é‡‡æ ·é¢‘ç‡æ¥æ•æ‰è¿™äº›è·¯å¾„ã€‚å¦‚æœæŸæ®µä»£ç è·¯å¾„åœ¨é‡‡é›†ç»“æœä¸­å‡ºç°å¾—è¶Šé¢‘ç¹ï¼Œè¯´æ˜ç¨‹åºåœ¨è¿™æ®µä»£ç ä¸ŠèŠ±è´¹çš„æ—¶é—´è¶Šå¤šã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿå®šä½åˆ°ç¨‹åºä¸­æœ€å ç”¨èµ„æºçš„éƒ¨åˆ†ï¼Œä»è€Œæ‰¾åˆ°æ€§èƒ½ç“¶é¢ˆå¹¶è¿›è¡Œä¼˜åŒ–ã€‚ perf å‘½ä»¤åœ¨ä½¿ç”¨ perf è¿›è¡Œæ€§èƒ½åˆ†ææ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç”¨åˆ°ä»¥ä¸‹å‡ ä¸ªå‘½ä»¤ï¼š perf record -F 99 -p $(pidof test1) -g -- sleep 300perf report -g --stdio **perf record**ï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºè®°å½•ç¨‹åºçš„æ€§èƒ½æ•°æ®ã€‚ä¸Šè¿°å‘½ä»¤çš„å…·ä½“å‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š -F 99ï¼šæŒ‡å®šé‡‡æ ·é¢‘ç‡ä¸º 99Hzï¼Œå³æ¯ç§’é‡‡æ · 99 æ¬¡ã€‚ -p $(pidof test1)ï¼šæŒ‡å®šè¦åˆ†æçš„è¿›ç¨‹ IDï¼Œè¿™é‡Œä½¿ç”¨ pidof test1 æ¥è·å–ç¨‹åº test1 çš„è¿›ç¨‹ IDã€‚ -gï¼šå¯ç”¨è°ƒç”¨æ ˆçš„è®°å½•ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸ªé‡‡æ ·ç‚¹çš„å‡½æ•°è°ƒç”¨è·¯å¾„ã€‚ -- sleep 300ï¼šæŒ‡å®šé‡‡æ ·æ—¶é—´ä¸º 300 ç§’ï¼Œè¿™æ„å‘³ç€ perf å°†åœ¨æ¥ä¸‹æ¥çš„ 5 åˆ†é’Ÿå†…ä¸€ç›´è®°å½•æ€§èƒ½æ•°æ®ã€‚ **perf report**ï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºæŸ¥çœ‹å·²ç»è®°å½•çš„æ€§èƒ½åˆ†æç»“æœã€‚å‚æ•° -g å¯ç”¨äº†å›¾å½¢åŒ–çš„è°ƒç”¨æ ˆæ˜¾ç¤ºï¼Œä½¿æŠ¥å‘Šæ›´æ˜“è¯»ã€‚ é€šè¿‡è¿™äº›å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥å…¨é¢äº†è§£ç¨‹åºçš„è¿è¡Œæƒ…å†µï¼Œæ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆçš„æ‰€åœ¨ã€‚ ä¾‹å­åˆ†æä¸ºäº†æ›´å¥½åœ°ç†è§£ perf å·¥å…·çš„ä½œç”¨ï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªç¤ºä¾‹ç¨‹åºæ¥è¿›è¡Œåˆ†æã€‚ #include stdio.hint functiona(void) int c = 0; int count = 0; for (c = 1; c 20000; c++) count++; return count;int functionb(void) int c = 0; int count = 0; for (c = 1; c 40000; c++) count++; return count;int main(int argc, char *argv[]) for (;;) functiona(); printf(call function a ); functionb(); printf(call function b ); return 0; ç¼–è¯‘å‘½ä»¤å°†ä¸Šè¿°ç¨‹åºä¿å­˜ä¸º test1.cï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š gcc -g -o test1 test1.c -gï¼šå¯ç”¨è°ƒè¯•ä¿¡æ¯ï¼Œè¿™å°†å¸®åŠ© perf æä¾›æ›´è¯¦ç»†çš„è°ƒç”¨æ ˆä¿¡æ¯ã€‚ æµ‹è¯•è¿‡ç¨‹æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ perf å·¥å…·å¯¹ test1 ç¨‹åºè¿›è¡Œæ€§èƒ½åˆ†æã€‚ å¯åŠ¨ test1 ç¨‹åºï¼š åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå°† test1 æ”¾åœ¨åå°è¿è¡Œï¼š ./test1 /dev/null è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…æ§åˆ¶å°è¾“å‡ºå¹²æ‰°æ€§èƒ½åˆ†æç»“æœã€‚ å¼€å§‹æ€§èƒ½æ•°æ®é‡‡é›†ï¼š ä½¿ç”¨ perf record å‘½ä»¤å¼€å§‹è®°å½•æ€§èƒ½æ•°æ®ï¼š perf record -F 99 -p $(pidof test1) -g -- sleep 300 è¿™ä¸ªå‘½ä»¤å°†åœ¨æ¥ä¸‹æ¥çš„ 300 ç§’å†…ï¼Œæ¯ç§’é‡‡æ · 99 æ¬¡ï¼Œè®°å½• test1 è¿›ç¨‹çš„è°ƒç”¨æ ˆä¿¡æ¯ã€‚ é‡‡é›†æ•°æ®å®Œæˆåç”ŸæˆæŠ¥å‘Šï¼š é‡‡æ ·å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆåˆ†ææŠ¥å‘Šï¼š perf script out.perf è¿™å°†ç”Ÿæˆä¸€ä¸ªæ–‡æœ¬æ ¼å¼çš„æŠ¥å‘Šæ–‡ä»¶ out.perfï¼ŒåŒ…å«é‡‡æ ·ç»“æœçš„è¯¦ç»†ä¿¡æ¯ã€‚ ç”Ÿæˆç«ç„°å›¾ï¼š ä¸ºäº†æ›´ç›´è§‚åœ°æŸ¥çœ‹æ€§èƒ½æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å°† out.perf è½¬æ¢ä¸ºç«ç„°å›¾ï¼ˆFlame Graphï¼‰çš„å½¢å¼ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ stackcollapse-perf.pl è„šæœ¬å°†æ•°æ®æ ¼å¼è½¬æ¢ï¼š ./stackcollapse-perf.pl out.perf out.folded ç„¶åï¼Œä½¿ç”¨ flamegraph.pl ç”Ÿæˆ SVG æ ¼å¼çš„ç«ç„°å›¾ï¼š ./flamegraph.pl out.folded out.svg ç«ç„°å›¾ä»¥å †å æ¡å›¾çš„å½¢å¼å±•ç¤ºäº†å„ä¸ªå‡½æ•°çš„è°ƒç”¨å…³ç³»å’Œæ—¶é—´å æ¯”ï¼Œ giÃºp æˆ‘ä»¬å¿«é€Ÿè¯†åˆ«å‡ºæ€§èƒ½ç“¶é¢ˆæ‰€åœ¨ã€‚ æµ‹è¯•ç»“æœåˆ†æé€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº† test1 ç¨‹åºçš„æ€§èƒ½åˆ†ææŠ¥å‘Šå’Œç«ç„°å›¾ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¯¦ç»†åˆ†æè¿™äº›ç»“æœï¼Œæ‰¾å‡ºç¨‹åºä¸­æœ€å ç”¨èµ„æºçš„éƒ¨åˆ†ã€‚ åˆ†ææ­¥éª¤ æŸ¥çœ‹æ€§èƒ½æŠ¥å‘Šï¼š æ‰“å¼€ out.perf æ–‡ä»¶ï¼ŒæŸ¥æ‰¾é¢‘ç‡æœ€é«˜çš„å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ° functionb å’Œ functiona æ˜¯ä¸¤ä¸ªé«˜é¢‘è°ƒç”¨çš„å‡½æ•°ã€‚ æŸ¥çœ‹è°ƒç”¨æ ˆï¼š åœ¨æ€§èƒ½æŠ¥å‘Šä¸­ï¼Œæ¯ä¸ªé‡‡æ ·ç‚¹éƒ½ä¼šæ˜¾ç¤ºå®Œæ•´çš„è°ƒç”¨æ ˆã€‚é€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°å“ªäº›å‡½æ•°è°ƒç”¨è·¯å¾„å¯¼è‡´äº†é«˜é¢‘ç‡çš„æ‰§è¡Œã€‚ ç«ç„°å›¾åˆ†æï¼š æ‰“å¼€ç”Ÿæˆçš„ out.svg æ–‡ä»¶ï¼Œåœ¨ç«ç„°å›¾ä¸­ï¼š æ¯ä¸ªçŸ©å½¢ä»£è¡¨ä¸€ä¸ªå‡½æ•°ï¼Œå®½åº¦è¡¨ç¤ºè¯¥å‡½æ•°å ç”¨çš„æ—¶é—´æ¯”ä¾‹ã€‚ ä»ä¸‹åˆ°ä¸Šï¼Œå±•ç¤ºçš„æ˜¯è°ƒç”¨æ ˆçš„æ·±åº¦ï¼Œæœ€åº•éƒ¨çš„æ˜¯ä¸»å‡½æ•° mainï¼Œå…¶ä¸Šæ–¹æ˜¯è¢«è°ƒç”¨çš„å‡½æ•° functiona å’Œ functionbã€‚ ç»“æœè§£è¯»é€šè¿‡ perf åˆ†æå·¥å…·çš„å¸®åŠ©ï¼Œæˆ‘ä»¬å‘ç°ï¼š å‡½æ•°è°ƒç”¨é¢‘ç‡ï¼š functionb çš„å¾ªç¯æ¬¡æ•°æ¯” functiona å¤šä¸€å€ï¼ˆ40000 æ¬¡ vs. 20000 æ¬¡ï¼‰ï¼Œå› æ­¤å®ƒåœ¨æ€§èƒ½æŠ¥å‘Šä¸­å‡ºç°çš„é¢‘ç‡æ›´é«˜ã€‚ functionb çš„æ‰§è¡Œæ—¶é—´å ç”¨äº†æ•´ä¸ªç¨‹åºçš„ä¸»è¦éƒ¨åˆ†ï¼Œå¯¼è‡´äº†æ€§èƒ½ç“¶é¢ˆã€‚ èµ„æºæ¶ˆè€—å®šä½ï¼š functionb å†…éƒ¨çš„ç©º count++ å¾ªç¯æ˜¯ä¸»è¦çš„èµ„æºæ¶ˆè€—ç‚¹ã€‚è™½ç„¶ count å˜é‡æœ€ç»ˆæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œä½†å¾ªç¯æœ¬èº«å ç”¨äº†å¤§é‡ CPU æ—¶é—´ã€‚ printf è¯­å¥è™½ç„¶é¢‘ç¹è°ƒç”¨ï¼Œä½†ç”±äºæ¯æ¬¡æ‰§è¡Œæ—¶é—´è¾ƒçŸ­ï¼Œæ‰€ä»¥åœ¨æ€§èƒ½æŠ¥å‘Šä¸­å æ¯”è¾ƒä½ã€‚ ä¼˜åŒ–å»ºè®®åŸºäºä»¥ä¸Šåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥æå‡ºä»¥ä¸‹ä¼˜åŒ–å»ºè®®ï¼š ä¼˜åŒ–å¾ªç¯ä½“ï¼š å‡å°‘å¾ªç¯æ¬¡æ•°ï¼šå¦‚æœåº”ç”¨åœºæ™¯å…è®¸ï¼Œå¯ä»¥é€‚å½“å‡å°‘å¾ªç¯çš„æ¬¡æ•°ã€‚ä¾‹å¦‚ï¼Œå°† functionb çš„å¾ªç¯æ¬¡æ•°ä» 40000 æ¬¡å‡å°‘åˆ° 20000 æ¬¡ã€‚ ç§»é™¤æ— ç”¨ä»£ç ï¼šå»æ‰ count å˜é‡çš„æ— æ•ˆæ“ä½œï¼Œæˆ–è€…å°†å…¶æ”¹å†™ä¸ºæœ‰å®é™…æ„ä¹‰çš„è®¡ç®—ï¼Œä»¥é¿å…ä¸å¿…è¦çš„å¾ªç¯è¿­ä»£ã€‚ // æ”¹è¿›åçš„ functionbint functionb(void) int sum = 0; for (int c = 1; c 20000; c++) sum += c; return sum; å‡å°‘ IO æ“ä½œï¼š åœ¨ä¸»å¾ªç¯ä¸­ï¼Œprintf å‡½æ•°è¢«é¢‘ç¹è°ƒç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚å¯ä»¥è€ƒè™‘å°†æ—¥å¿—è¾“å‡ºå‡å°‘ï¼Œæˆ–è€…ä½¿ç”¨æ›´é«˜æ•ˆçš„æ—¥å¿—è®°å½•æ–¹å¼ã€‚ // æ”¹è¿›åçš„ main å‡½æ•°int main(int argc, char *argv[]) for (int i = 0; i 1000; i++) functiona(); functionb(); return 0; æ³¨æ„ï¼Œä¸Šè¿°æ”¹åŠ¨å·²ç»å»é™¤äº† printf è¯­å¥ï¼Œå¹¶ä¸”é™åˆ¶äº†å¾ªç¯çš„æ¬¡æ•°ï¼Œä»¥å‡å°‘ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—ã€‚ å¹¶è¡Œä¼˜åŒ–ï¼š å¦‚æœç¨‹åºå…è®¸ï¼Œå¯ä»¥è€ƒè™‘å°† functiona å’Œ functionb çš„æ‰§è¡Œå¹¶è¡ŒåŒ–ï¼Œåˆ©ç”¨å¤šæ ¸ CPU çš„ä¼˜åŠ¿æ¥åŠ é€Ÿç¨‹åºè¿è¡Œã€‚ ç¼–è¯‘å™¨ä¼˜åŒ–ï¼š åœ¨ç¼–è¯‘é˜¶æ®µï¼Œå¼€å¯æ›´é«˜çº§çš„ä¼˜åŒ–é€‰é¡¹ï¼Œä¾‹å¦‚ -O3ï¼Œè®©ç¼–è¯‘å™¨å¯¹ç¨‹åºè¿›è¡Œæ›´æ·±å…¥çš„ä¼˜åŒ–ã€‚ gcc -g -O3 -o test1 test1.c æ€»ç»“é€šè¿‡ä½¿ç”¨ perf å·¥å…·ï¼Œæˆ‘ä»¬æˆåŠŸåœ°åˆ†æå¹¶å®šä½äº†ç¤ºä¾‹ç¨‹åºä¸­çš„æ€§èƒ½ç“¶é¢ˆã€‚å…·ä½“æ¥è¯´ï¼Œfunctionb å‡½æ•°ç”±äºå…¶å†…éƒ¨çš„å¤§é‡å¾ªç¯è¿­ä»£ï¼Œæˆä¸ºäº†æ•´ä¸ªç¨‹åºçš„ä¸»è¦èµ„æºæ¶ˆè€—ç‚¹ã€‚é€šè¿‡å‡å°‘å¾ªç¯æ¬¡æ•°ã€ç§»é™¤æ— æ•ˆä»£ç ã€å‡å°‘ IO æ“ä½œä»¥åŠè¿›è¡Œç¼–è¯‘å™¨ä¼˜åŒ–ç­‰æªæ–½ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ•ˆåœ°æå‡ç¨‹åºçš„æ€§èƒ½ã€‚ è¿™ç§æ€§èƒ½åˆ†æçš„æ–¹æ³•ä¸ä»…é€‚ç”¨äºç¤ºä¾‹ç¨‹åºï¼Œä¹Ÿå¯ä»¥æ¨å¹¿åˆ°å®é™…é¡¹ç›®ä¸­ã€‚é€šè¿‡å®šæœŸè¿›è¡Œæ€§èƒ½åˆ†æå¹¶é’ˆå¯¹æ€§åœ°ä¼˜åŒ–å…³é”®ä»£ç æ®µï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾è‘—æé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ï¼Œé™ä½èµ„æºæ¶ˆè€—ï¼Œä»è€Œæå‡æ•´ä½“ç”¨æˆ·ä½“éªŒã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux"]},{"title":"2025-04-14","path":"/2025/04/14/6-å¼€å‘å·¥å…·-æ•ˆç‡å·¥å…·-ä¸€äº›å·¥å…·/","content":"Free Online Document to Markdown Converter - No Sign Up Required | To-Markdown.com https://to-markdown.com/ https://github.com/yuaotian/go-cursor-help ä¸»é¡µ | lm379 https://cloud.lm379.cn/ https://beddystories.com/zh GitHub - LearningCircuitlocal-deep-research: Local Deep Research is an AI-powered assistant that transforms complex questions into comprehensive, cited reports by conducting iterative analysis using any LLM across diverse knowledge sources including academic databases, scientific repositories, web content, and private document collections. https://github.com/LearningCircuit/local-deep-research https://github.com/uxiaohan/ZYCS-IMG å…è´¹çš„åœ¨çº¿æ–‡æ¡£ç¿»è¯‘å™¨â€”â€”ä¿ç•™åŸæ–‡æ¡£çš„æ’ç‰ˆï¼ˆWordã€PDFã€Excelã€Powerpointã€OpenOfficeã€æ–‡æœ¬ï¼‰ https://www.onlinedoctranslator.com/zh-CN/translationform é»‘çŒ«å›¾åºŠ - å…è´¹é«˜é€Ÿå›¾ç‰‡åˆ†äº«å¹³å° https://img.hmvod.cc/ aSim - build and share apps with friends https://asim.sh/ GitHub - yikartAiToEarn: æŠ–éŸ³ï¼Œå°çº¢ä¹¦ï¼Œè§†é¢‘å·ï¼Œå¿«æ‰‹ç­‰å¤šä¸ªè‡ªåª’ä½“å¹³å°çš„ä¸€é”®å‘å¸ƒå·¥å…· https://github.com/yikart/AiToEarn GitHub - xming521WeClone: æ¬¢è¿ starâ­ã€‚ä½¿ç”¨å¾®ä¿¡èŠå¤©è®°å½•å¾®è°ƒå¤§è¯­è¨€æ¨¡å‹ï¼Œä½¿ç”¨å¾®ä¿¡è¯­éŸ³æ¶ˆæ¯â•0.5B å¤§æ¨¡å‹å®ç°é«˜è´¨é‡å£°éŸ³å…‹éš†ï¼Œå¹¶ç»‘å®šåˆ°èŠå¤©æœºå™¨äººï¼Œå®ç°è‡ªå·±çš„æ•°å­—åˆ†èº«ã€‚ æ•°å­—å…‹éš†æ•°å­—åˆ†èº«æ•°å­—æ°¸ç”Ÿå£°éŸ³å…‹éš†LLMå¤§è¯­è¨€æ¨¡å‹å¾®ä¿¡èŠå¤©æœºå™¨äººLoRA https://github.com/xming521/WeClone åŒ»ä¿æŠ¥é”€ç§‘æ™®æŒ‡å— ğŸ“„ğŸ’¡ | åŒ»ä¿æ”¿ç­–å¯¼èˆª https://yibao.233h.com/articles/yibao-jichu.html éšæœºé»‘ si å›¾ç‰‡ API - A å§åˆ†äº« https://www.ahhhhfs.com/69702/ å…è´¹ API - æä¾›å…è´¹æ¥å£è°ƒç”¨å¹³å° https://api.aa1.cn/ GitHub - aingdeskAingDesk: AingDesk æ˜¯ä¸€æ¬¾ç®€å•å¥½ç”¨çš„ AI åŠ©æ‰‹ï¼Œæ”¯æŒçŸ¥è¯†åº“ã€æ¨¡å‹ APIã€åˆ†äº«ã€è”ç½‘æœç´¢ã€æ™ºèƒ½ä½“ï¼Œå®ƒè¿˜åœ¨é£å¿«æˆé•¿ä¸­ã€‚ AingDesk is a simple and easy-to-use AI assistant that supports knowledge bases, model APIs, sharing, internet search, and intelligent agents. It is still growing rapidly. https://github.com/aingdesk/AingDesk PromptUp - Create, Store and Share AI Prompts https://promptup.net/ categories:comments: truedate: 2025-04-14 12:42:38dg-publish: truetags:title: â€œ2025-04-14â€updated: 2025-04-14 16:29:09Online Document to Markdown Converter https://to-markdown.com/ Cursor å…è´¹è¯•ç”¨é‡ç½®å·¥å…· https://github.com/yuaotian/go-cursor-help å…¨çƒç²¾é€‰å„¿ç«¥ç¡å‰æ•…äº‹ https://beddystories.com/zh local-deep-research https://github.com/LearningCircuit/local-deep-research éª¤é›¨é‡å±±å›¾åºŠ https://github.com/uxiaohan/ZYCS-IMG åœ¨çº¿æ–‡æ¡£ç¿»è¯‘å™¨https://www.onlinedoctranslator.com/zh-CN/translationform é»‘çŒ«å›¾åºŠhttps://img.hmvod.cc/ build and share apps with friendshttps://asim.sh/ è‡ªåª’ä½“å¹³å°çš„ä¸€é”®å‘å¸ƒå·¥å…·https://github.com/yikart/AiToEarn GitHub - xming521WeClone: æ¬¢è¿ starâ­ã€‚ä½¿ç”¨å¾®ä¿¡èŠå¤©è®°å½•å¾®è°ƒå¤§è¯­è¨€æ¨¡å‹ï¼Œä½¿ç”¨å¾®ä¿¡è¯­éŸ³æ¶ˆæ¯â•0.5B å¤§æ¨¡å‹å®ç°é«˜è´¨é‡å£°éŸ³å…‹éš†ï¼Œå¹¶ç»‘å®šåˆ°èŠå¤©æœºå™¨äººï¼Œå®ç°è‡ªå·±çš„æ•°å­—åˆ†èº«ã€‚ æ•°å­—å…‹éš†æ•°å­—åˆ†èº«æ•°å­—æ°¸ç”Ÿå£°éŸ³å…‹éš†LLMå¤§è¯­è¨€æ¨¡å‹å¾®ä¿¡èŠå¤©æœºå™¨äººLoRA https://github.com/xming521/WeClone åŒ»ä¿æŠ¥é”€ç§‘æ™®æŒ‡å— ğŸ“„ğŸ’¡ | åŒ»ä¿æ”¿ç­–å¯¼èˆª https://yibao.233h.com/articles/yibao-jichu.html å…è´¹ API - æä¾›å…è´¹æ¥å£è°ƒç”¨å¹³å° https://api.aa1.cn/ GitHub - aingdeskAingDesk: AingDesk æ˜¯ä¸€æ¬¾ç®€å•å¥½ç”¨çš„ AI åŠ©æ‰‹ï¼Œæ”¯æŒçŸ¥è¯†åº“ã€æ¨¡å‹ APIã€åˆ†äº«ã€è”ç½‘æœç´¢ã€æ™ºèƒ½ä½“ï¼Œå®ƒè¿˜åœ¨é£å¿«æˆé•¿ä¸­ã€‚ AingDesk is a simple and easy-to-use AI assistant that supports knowledge bases, model APIs, sharing, internet search, and intelligent agents. It is still growing rapidly. https://github.com/aingdesk/AingDesk PromptUp - Create, Store and Share AI Prompts https://promptup.net/","categories":["6.å¼€å‘å·¥å…·","æ•ˆç‡å·¥å…·"]},{"title":"QMake å’Œ CMake å¯¹æ¯”åŠå®è·µæŒ‡å—","path":"/2025/04/08/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qt-Build-QMakeä¸CMakeå¯¹æ¯”/","content":"QMake å’Œ CMake å¯¹æ¯”åŠå®è·µæŒ‡å—QMake å’Œ CMake éƒ½æ˜¯æ„å»ºç³»ç»Ÿï¼Œè´Ÿè´£å°†æºä»£ç è½¬æ¢ä¸ºå¯æ‰§è¡Œç¨‹åºã€‚ä¸¤è€…çš„æ ¸å¿ƒä½œç”¨ç›¸åŒï¼šæ ¹æ®é¡¹ç›®é…ç½®ç”Ÿæˆé€‚ç”¨äºç‰¹å®šç¼–è¯‘å™¨çš„ Makefileã€‚ ç”¨ä¸€ä¸ªç±»æ¯”æ¥ç†è§£ï¼šæ„å»ºç³»ç»Ÿç±»ä¼¼äºä½œæ›²å®¶ï¼ŒMakefile æ˜¯ä¹è°±ï¼Œç¼–è¯‘å™¨åˆ™æ˜¯æ¼”å¥ä¹ç« çš„ä¹é˜Ÿã€‚QMake å’Œ CMake å°±æ˜¯ä¸¤ä½é£æ ¼ä¸åŒçš„ä½œæ›²å®¶â€”â€”å‰è€…ä¸“æ³¨äº Qt é¢†åŸŸï¼Œåè€…é€šç”¨æ€§æ›´å¼ºã€‚ ä¸€ã€æ ¸å¿ƒç‰¹æ€§å¯¹æ¯”1.1 é€‚ç”¨åœºæ™¯ æ„å»ºç³»ç»Ÿ æœ€ä½³ä½¿ç”¨åœºæ™¯ å…¸å‹é¡¹ç›®ç±»å‹ QMake çº¯ Qt é¡¹ç›®ï¼Œä¸ Qt Creator æ·±åº¦é›†æˆ æ¡Œé¢ GUI åº”ç”¨ã€Qt Quick åº”ç”¨ CMake è·¨å¹³å°æ··åˆé¡¹ç›®ï¼Œéœ€è¦é›†æˆç¬¬ä¸‰æ–¹åº“æˆ–å¤šè¯­è¨€æ¨¡å— å¤§å‹å·¥ç¨‹ã€åµŒå…¥å¼ç³»ç»Ÿã€è·¨è¯­è¨€é¡¹ç›® è®¾è®¡åŠ¨æœºè¯´æ˜ï¼š QMake ç”± Qt å›¢é˜Ÿå¼€å‘ï¼Œç›®æ ‡æ˜¯ç®€åŒ– Qt é¡¹ç›®æ„å»ºï¼Œ.pro æ–‡ä»¶è¯­æ³•ä¸ Qt æ¨¡å—å‘½åé«˜åº¦ä¸€è‡´ CMake æ˜¯é€šç”¨æ„å»ºç³»ç»Ÿï¼Œæ”¯æŒ CC++Fortran ç­‰å¤šç§è¯­è¨€ï¼ŒQt ä» 5.x å¼€å§‹å®˜æ–¹æ”¯æŒ CMakeï¼ŒQt 6 å·²å°† CMake ä½œä¸ºæ¨èæ„å»ºç³»ç»Ÿ [1] 1.2 é…ç½®å¤æ‚åº¦graph LR A[QMake] --|.pro æ–‡ä»¶| B[ç®€æ´ç›´è§‚] C[CMake] --|CMakeLists.txt| D[åŠŸèƒ½å¼ºå¤§ä½†å­¦ä¹ æ›²çº¿é™¡å³­] B -- E[é€‚åˆå¿«é€ŸåŸå‹å¼€å‘] D -- F[é€‚åˆå¤æ‚å·¥ç¨‹ç®¡ç†] QMakeï¼šé€šè¿‡ .pro æ–‡ä»¶å®šä¹‰é¡¹ç›®ï¼Œè¯­æ³•ç®€æ´ï¼Œ5 åˆ†é’Ÿå³å¯ä¸Šæ‰‹ CMakeï¼šéœ€è¦ç†è§£ CMakeLists.txt è¯­æ³•ã€å˜é‡ä½œç”¨åŸŸã€æ¨¡å—ç³»ç»Ÿï¼Œå®Œæ•´æŒæ¡éœ€è¦ 1-2 å‘¨ 1.3 ç¤¾åŒºä¸ç”Ÿæ€ ç»´åº¦ QMake CMake å®˜æ–¹æ”¯æŒ Qt å®˜æ–¹ç»´æŠ¤ Kitware ç»´æŠ¤ï¼ŒQt å®˜æ–¹é€‚é… æ–‡æ¡£è´¨é‡ Qt æ–‡æ¡£é›†æˆï¼Œç¤ºä¾‹ä¸°å¯Œ å®˜æ–¹å‚è€ƒæ‰‹å†Œ + å¤§é‡ç¤¾åŒºæ•™ç¨‹ IDE æ”¯æŒ Qt Creator åŸç”Ÿæ”¯æŒ CLionã€VS Codeã€Visual Studio åŸç”Ÿæ”¯æŒ ç¬¬ä¸‰æ–¹åº“é›†æˆ éœ€æ‰‹åŠ¨é…ç½®è·¯å¾„ é€šè¿‡ find_package è‡ªåŠ¨å®šä½ [!TIP]Qt 6 é¡¹ç›®æ¨èä½¿ç”¨ CMakeã€‚Qt å®˜æ–¹ä» Qt 6 å¼€å§‹å·²å°† CMake ä½œä¸ºé»˜è®¤æ„å»ºç³»ç»Ÿï¼ŒQMake ä»…ä¿ç•™å…¼å®¹æ”¯æŒ [1]ã€‚ äºŒã€CMake æ ¸å¿ƒè¯­æ³•è¯¦è§£CMake é€šè¿‡ CMakeLists.txt æ–‡ä»¶æè¿°æ„å»ºè§„åˆ™ã€‚ä»¥ä¸‹æ˜¯å…³é”®å‘½ä»¤çš„è¯¦ç»†è¯´æ˜ï¼š 2.1 é¡¹ç›®å®šä¹‰å‘½ä»¤cmake_minimum_required(VERSION 3.16) # æŒ‡å®šæœ€ä½ CMake ç‰ˆæœ¬ï¼ˆQt5 è‡³å°‘ 3.10ï¼ŒQt6 è‡³å°‘ 3.16ï¼‰project(MyApp VERSION 1.0.0 LANGUAGES CXX) # å®šä¹‰é¡¹ç›®åç§°ã€ç‰ˆæœ¬ã€è¯­è¨€ 2.2 Qt å…ƒå¯¹è±¡ç³»ç»Ÿé…ç½®Qt ä½¿ç”¨ MOCï¼ˆå…ƒå¯¹è±¡ç¼–è¯‘å™¨ï¼‰ã€UICï¼ˆUI æ–‡ä»¶ç¼–è¯‘å™¨ï¼‰å’Œ RCCï¼ˆèµ„æºæ–‡ä»¶ç¼–è¯‘å™¨ï¼‰å¤„ç†ç‰¹æ®Šæ–‡ä»¶ã€‚CMake æä¾›è‡ªåŠ¨åŒ–æ”¯æŒï¼š set(CMAKE_INCLUDE_CURRENT_DIR ON) # å°†å½“å‰ç›®å½•åŠ å…¥ include è·¯å¾„set(CMAKE_AUTOMOC ON) # è‡ªåŠ¨å¤„ç† Q_OBJECT å®ï¼ˆå¿…éœ€ï¼‰set(CMAKE_AUTOUIC ON) # è‡ªåŠ¨å¤„ç† .ui æ–‡ä»¶set(CMAKE_AUTORCC ON) # è‡ªåŠ¨å¤„ç† .qrc èµ„æºæ–‡ä»¶ è‡ªå®šä¹‰ç”Ÿæˆç›®å½•ï¼ˆé¿å…æ±¡æŸ“æºæ–‡ä»¶ï¼‰ï¼š set(CMAKE_AUTOUIC_DIR $CMAKE_BINARY_DIR/ui) # .ui ç”Ÿæˆçš„ .h æ–‡ä»¶ç›®å½•set(CMAKE_AUTOMOC_DIR $CMAKE_BINARY_DIR/moc) # MOC ç”Ÿæˆçš„ .cpp æ–‡ä»¶ç›®å½•set(CMAKE_AUTORCC_DIR $CMAKE_BINARY_DIR/rcc) # .qrc ç”Ÿæˆçš„ .cpp æ–‡ä»¶ç›®å½•file(MAKE_DIRECTORY $CMAKE_AUTOUIC_DIR $CMAKE_AUTOMOC_DIR $CMAKE_AUTORCC_DIR) [!NOTE]CMake ä¸­å¿…é¡»è®¾ç½® CMAKE_AUTOMOC ON æ‰èƒ½è‡ªåŠ¨å¤„ç† Qt çš„ MOC å…ƒå¯¹è±¡ç¼–è¯‘å™¨ï¼Œå¦åˆ™åŒ…å« Q_OBJECT å®çš„ç±»å°†æ— æ³•æ­£ç¡®ç¼–è¯‘ã€‚ 2.3 ç›®æ ‡æ„å»ºå‘½ä»¤æ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶add_executable($PROJECT_NAME main.cpp widget.cpp) æ·»åŠ åº“æ–‡ä»¶# é™æ€åº“add_library(mylib STATIC lib.cpp)# åŠ¨æ€åº“ï¼ˆå…±äº«åº“ï¼‰add_library(mylib SHARED lib.cpp)# æ¥å£åº“ï¼ˆä»…å¤´æ–‡ä»¶ï¼‰add_library(mylib INTERFACE) æ·»åŠ å­ç›®å½•add_subdirectory(src) # æ·»åŠ  src ç›®å½•ï¼ŒæŸ¥æ‰¾å…¶ä¸­çš„ CMakeLists.txtadd_subdirectory(plugins) # é€’å½’å¤„ç†å­é¡¹ç›® 2.4 ä¾èµ–ç®¡ç†å‘½ä»¤æŸ¥æ‰¾ Qt æ¨¡å—# Qt5 é¡¹ç›®find_package(Qt5 COMPONENTS Core Gui Widgets Network REQUIRED)# Qt5/Qt6 å…¼å®¹å†™æ³•find_package(QT NAMES Qt6 Qt5 COMPONENTS Widgets REQUIRED)find_package(Qt$QT_VERSION_MAJOR COMPONENTS Widgets REQUIRED) é“¾æ¥åº“æ–‡ä»¶target_link_libraries($PROJECT_NAME PRIVATE Qt5::Core Qt5::Gui Qt5::Widgets)# æˆ–ä½¿ç”¨ç‰ˆæœ¬å˜é‡ï¼ˆå…¼å®¹ Qt5/Qt6ï¼‰target_link_libraries($PROJECT_NAME PRIVATE Qt$QT_VERSION_MAJOR::Widgets) 2.5 è·¯å¾„ä¸å˜é‡è®¾ç½®# è®¾ç½® C++ æ ‡å‡†set(CMAKE_CXX_STANDARD 17)set(CMAKE_CXX_STANDARD_REQUIRED ON)# è®¾ç½®è¾“å‡ºç›®å½•set(EXECUTABLE_OUTPUT_PATH $PROJECT_BINARY_DIR/bin)set(LIBRARY_OUTPUT_PATH $PROJECT_BINARY_DIR/lib)# è®¾ç½®æ¨¡å—æœç´¢è·¯å¾„set(CMAKE_MODULE_PATH $CMAKE_MODULE_PATH $CMAKE_SOURCE_DIR/cmake)# æ·»åŠ å¤´æ–‡ä»¶æœç´¢è·¯å¾„ï¼ˆç°ä»£ CMake æ¨èä½¿ç”¨ target_include_directoriesï¼‰target_include_directories($PROJECT_NAME PRIVATE $CMAKE_SOURCE_DIR/include) [!IMPORTANT]ç°ä»£ CMakeï¼ˆ3.0+ï¼‰æ¨èä½¿ç”¨ target_* ç³»åˆ—å‘½ä»¤æ›¿ä»£å…¨å±€å‘½ä»¤ï¼Œå¦‚ç”¨ target_include_directories æ›¿ä»£ include_directoriesï¼Œä»¥å®ç°æ›´å¥½çš„ç›®æ ‡éš”ç¦» [2]ã€‚ ä¸‰ã€ä» QMake è¿ç§»åˆ° CMake3.1 å…¸å‹ QMake é¡¹ç›®æ–‡ä»¶# test.proQT += core networkQT -= guiCONFIG += c++11 consoleCONFIG -= app_bundleTARGET = testTEMPLATE = appSOURCES += \\ main.cpp \\ test_interface.cpp \\ motomanlibrary.cpp \\ processing.cppHEADERS += \\ test_interface.h \\ motomanlibrary.h \\ processing.h 3.2 ç­‰æ•ˆ CMakeLists.txtcmake_minimum_required(VERSION 3.16)project(test VERSION 1.0.0 LANGUAGES CXX)# ============ Qt é…ç½® ============set(CMAKE_INCLUDE_CURRENT_DIR ON)set(CMAKE_AUTOMOC ON)set(CMAKE_AUTORCC ON)set(CMAKE_AUTOUIC ON)find_package(Qt5 COMPONENTS Core Network REQUIRED)# ============ C++ æ ‡å‡† ============set(CMAKE_CXX_STANDARD 11)set(CMAKE_CXX_STANDARD_REQUIRED ON)# ============ æºæ–‡ä»¶å®šä¹‰ ============set(SOURCES main.cpp test_interface.cpp motomanlibrary.cpp processing.cpp)set(HEADERS test_interface.h motomanlibrary.h processing.h)# ============ æ„å»ºç›®æ ‡ ============add_executable($PROJECT_NAME $SOURCES $HEADERS)target_link_libraries($PROJECT_NAME PRIVATE Qt5::Core Qt5::Network)# ============ è¾“å‡ºè·¯å¾„ ============set(EXECUTABLE_OUTPUT_PATH $PROJECT_BINARY_DIR/bin) 3.3 è½¬æ¢å¯¹ç…§è¡¨ QMake è¯­æ³• CMake ç­‰æ•ˆå†™æ³• QT += core network find_package(Qt5 COMPONENTS Core Network REQUIRED) CONFIG += c++11 set(CMAKE_CXX_STANDARD 11) TARGET = test project(test) TEMPLATE = app add_executable(...) TEMPLATE = lib add_library(...) SOURCES += file.cpp set(SOURCES file.cpp) INCLUDEPATH += path target_include_directories(target PRIVATE path) LIBS += -lmylib target_link_libraries(target PRIVATE mylib) å››ã€ç¼–è¯‘ä¸æ„å»ºæµç¨‹4.1 ç¯å¢ƒå‡†å¤‡Windows ç¯å¢ƒå˜é‡é…ç½®å°† Qt çš„ bin ç›®å½•æ·»åŠ åˆ°ç³»ç»Ÿ PATHï¼Œç¡®ä¿å‘½ä»¤è¡Œå·¥å…·å¯ç”¨ï¼š C:\\Qt\\5.15.0\\msvc2019_64\\bin MinGW ç¼–è¯‘å™¨é…ç½®ä½¿ç”¨ MinGW æ—¶éœ€åœ¨ CMake ä¸­æŒ‡å®šç¼–è¯‘å™¨è·¯å¾„ï¼š # å¿…é¡»åœ¨ project() ä¹‹å‰è®¾ç½®set(CMAKE_PREFIX_PATH D:/Qt/Qt5.14.2/5.14.2/mingw73_64)set(CMAKE_MAKE_PROGRAM D:/Qt/Qt5.14.2/Tools/mingw730_64/bin/mingw32-make.exe)set(CMAKE_C_COMPILER D:/Qt/Qt5.14.2/Tools/mingw730_64/bin/gcc.exe)set(CMAKE_CXX_COMPILER D:/Qt/Qt5.14.2/Tools/mingw730_64/bin/g++.exe) æˆ–é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šï¼š cmake . -G MinGW Makefiles \\ -DCMAKE_C_COMPILER=D:/Qt/Qt5.14.2/Tools/mingw730_64/bin/gcc.exe \\ -DCMAKE_CXX_COMPILER=D:/Qt/Qt5.14.2/Tools/mingw730_64/bin/g++.exe \\ -DCMAKE_PREFIX_PATH=D:/Qt/Qt5.14.2/5.14.2/mingw73_64 \\ -DCMAKE_MAKE_PROGRAM=D:/Qt/Qt5.14.2/Tools/mingw730_64/bin/mingw32-make.exe 4.2 æ ‡å‡†æ„å»ºæ­¥éª¤# 1. åˆ›å»ºæ„å»ºç›®å½•ï¼ˆæ¨è out-of-source æ„å»ºï¼‰mkdir build cd build# 2. é…ç½®é¡¹ç›®ï¼ˆç”Ÿæˆ Makefileï¼‰cmake ..# 3. ç¼–è¯‘é¡¹ç›®cmake --build . --parallel 4 # ä½¿ç”¨ 4 ä¸ªå¹¶è¡Œè¿›ç¨‹# æˆ–ä½¿ç”¨ makeï¼ˆä»…é™ Unix ç³»ç»Ÿï¼‰make -j4 4.3 æŒ‡å®šç”Ÿæˆå™¨# ä½¿ç”¨ Ninja ç”Ÿæˆå™¨ï¼ˆæ„å»ºé€Ÿåº¦æ›´å¿«ï¼‰cmake -G Ninja ..# ä½¿ç”¨ Visual Studio ç”Ÿæˆå™¨ï¼ˆWindowsï¼‰cmake -G Visual Studio 17 2022 -A x64 ..# ä½¿ç”¨ MinGW Makefilesï¼ˆWindowsï¼‰cmake -G MinGW Makefiles .. 4.4 å¸¸ç”¨é…ç½®é€‰é¡¹# æŒ‡å®šæ„å»ºç±»å‹cmake -DCMAKE_BUILD_TYPE=Release ..# æŒ‡å®š Qt å®‰è£…è·¯å¾„ï¼ˆå½“ç³»ç»Ÿå­˜åœ¨å¤šä¸ª Qt ç‰ˆæœ¬æ—¶ï¼‰cmake -DCMAKE_PREFIX_PATH=/opt/Qt/5.15.2/gcc_64 ..# æŒ‡å®šå®‰è£…ç›®å½•cmake -DCMAKE_INSTALL_PREFIX=/usr/local .. äº”ã€IDE é›†æˆ5.1 VS Code é›†æˆå¿…éœ€æ‰©å±• **CC++**ï¼šæä¾›ä»£ç é«˜äº®ã€æ™ºèƒ½æ„ŸçŸ¥ã€è°ƒè¯•æ”¯æŒ CMakeï¼šCMakeLists.txt è¯­æ³•é«˜äº® CMake Toolsï¼šé¡¹ç›®é…ç½®ã€æ„å»ºå’Œè°ƒè¯•é›†æˆ é…ç½®æ­¥éª¤ æ‰“å¼€é¡¹ç›®æ–‡ä»¶å¤¹ï¼ˆåŒ…å« CMakeLists.txtï¼‰ VS Code è‡ªåŠ¨æ£€æµ‹ CMake é¡¹ç›®ï¼Œé€‰æ‹© CMake Kitï¼ˆæ¨è Visual Studio 20192022ï¼‰ æŒ‰ F7 æ„å»ºé¡¹ç›®ï¼ŒæŒ‰ Shift+F5 è¿è¡Œï¼ŒæŒ‰ Ctrl+F5 è°ƒè¯• æ™ºèƒ½æ„ŸçŸ¥é—®é¢˜ä¿®å¤Qt ç”Ÿæˆçš„ .ui æ–‡ä»¶å¯¹åº”çš„å¤´æ–‡ä»¶å¯èƒ½æœªè¢«è‡ªåŠ¨åŒ…å«åœ¨ IntelliSense è·¯å¾„ä¸­ï¼Œéœ€æ‰‹åŠ¨æ·»åŠ ï¼š target_include_directories($PROJECT_NAME PRIVATE $CMAKE_BINARY_DIR/$PROJECT_NAME_autogen/include_Debug) 5.2 Qt Creator é›†æˆQt Creator åŸç”Ÿæ”¯æŒ CMake é¡¹ç›®ï¼š é€‰æ‹© æ–‡ä»¶ â†’ æ‰“å¼€æ–‡ä»¶æˆ–é¡¹ç›®ï¼Œé€‰æ‹© CMakeLists.txt é€‰æ‹©æ„å»ºå¥—ä»¶ï¼ˆKitï¼‰ï¼Œç‚¹å‡» é…ç½®é¡¹ç›® ä½¿ç”¨æ ‡å‡†çš„æ„å»ºå’Œè¿è¡ŒæŒ‰é’® å…­ã€å®Œæ•´é¡¹ç›®æ¨¡æ¿6.1 Qt5 Widgets é¡¹ç›®ï¼ˆå…¼å®¹ Qt6ï¼‰cmake_minimum_required(VERSION 3.16)project(MyQtApp VERSION 1.0.0 LANGUAGES CXX)# ============ Qt é…ç½® ============set(CMAKE_INCLUDE_CURRENT_DIR ON)set(CMAKE_AUTOUIC ON)set(CMAKE_AUTOMOC ON)set(CMAKE_AUTORCC ON)set(CMAKE_CXX_STANDARD 17)set(CMAKE_CXX_STANDARD_REQUIRED ON)# å…¼å®¹ Qt5 å’Œ Qt6find_package(QT NAMES Qt6 Qt5 COMPONENTS Widgets REQUIRED)find_package(Qt$QT_VERSION_MAJOR COMPONENTS Widgets REQUIRED)# ============ æºæ–‡ä»¶ ============set(SOURCES main.cpp mainwindow.cpp mainwindow.h mainwindow.ui)# ============ æ„å»ºç›®æ ‡ ============if(ANDROID) add_library($PROJECT_NAME SHARED $SOURCES)else() add_executable($PROJECT_NAME $SOURCES)endif()target_link_libraries($PROJECT_NAME PRIVATE Qt$QT_VERSION_MAJOR::Widgets)# ============ è¾“å‡ºè·¯å¾„ ============set(EXECUTABLE_OUTPUT_PATH $PROJECT_BINARY_DIR/bin) ä¸ƒã€é€‰å‹å»ºè®®flowchart TD A[æ–°å»º Qt é¡¹ç›®] -- Bé¡¹ç›®è§„æ¨¡? B --|å°å‹/åŸå‹| C[QMake] B --|ä¸­å¤§å‹| Dæ˜¯å¦éœ€è¦é›†æˆé Qt åº“? D --|å¦| E[QMake æˆ– CMake å‡å¯] D --|æ˜¯| F[CMake] C -- G[å¿«é€Ÿå¯åŠ¨ï¼ŒQt Creator æœ€ä½³ä½“éªŒ] F -- H[ç»Ÿä¸€æ„å»ºç³»ç»Ÿï¼Œä¾¿äºæŒç»­é›†æˆ] I[å·²æœ‰ Qt é¡¹ç›®] -- Jå½“å‰ä½¿ç”¨? J --|QMake| Kæ˜¯å¦è®¡åˆ’å‡çº§ Qt 6? K --|æ˜¯| L[è¿ç§»åˆ° CMake] K --|å¦| M[ç»§ç»­ä½¿ç”¨ QMake] J --|CMake| N[ç»§ç»­ä½¿ç”¨ CMake] æ€»ç»“ï¼š æ–°é¡¹ç›®ï¼šä¼˜å…ˆé€‰æ‹© CMakeï¼Œå°¤å…¶æ˜¯è®¡åˆ’ä½¿ç”¨ Qt 6 çš„é¡¹ç›® ç°æœ‰ QMake é¡¹ç›®ï¼šè‹¥æ— è¿ç§»å‹åŠ›å¯ç»§ç»­ä½¿ç”¨ï¼Œå‡çº§ Qt 6 æ—¶å†è¿ç§» æ··åˆé¡¹ç›®ï¼šå¿…é¡»ä½¿ç”¨ CMakeï¼Œå¯é€šè¿‡ add_subdirectory é›†æˆå„æ¨¡å—","tags":["CMake","Qt","QMake","æ„å»ºç³»ç»Ÿ","é¡¹ç›®ç®¡ç†"],"categories":["3.å¼€å‘æ¡†æ¶","Qt","Publish"]},{"title":"è™šæ‹Ÿä¸²å£è½¯ä»¶","path":"/2025/04/08/4-é€šè®¯åè®®-ä¸²å£-è™šæ‹Ÿä¸²å£è½¯ä»¶/","content":"ä»¥ä¸‹æ˜¯ Windows ç³»ç»Ÿä¸‹ä¸»æµè™šæ‹Ÿä¸²å£è½¯ä»¶çš„è¯¦ç»†æ¨èåŠä½¿ç”¨æŒ‡å—ï¼Œç»“åˆ 2025 å¹´æœ€æ–°ç‰ˆæœ¬ç‰¹æ€§å’Œå®é™…åº”ç”¨åœºæ™¯æ•´ç†è€Œæˆï¼š ä¸€ã€æ ¸å¿ƒè½¯ä»¶æ¨è1. Virtual Serial Port Driver (VSPD) åŠŸèƒ½ç‰¹æ€§ï¼š ä¼ä¸šçº§æ€§èƒ½ï¼šæ”¯æŒæ— é™è™šæ‹Ÿä¸²å£å¯¹åˆ›å»ºï¼Œæä¾›ç«¯å£åˆ†æµï¼ˆSplittingï¼‰ã€åˆå¹¶ï¼ˆJoiningï¼‰ã€æ†ç»‘ï¼ˆBundlesï¼‰ç­‰é«˜çº§åŠŸèƒ½ï¼Œé€‚ç”¨äºå¤æ‚å·¥ä¸šæ§åˆ¶åœºæ™¯ã€‚ åè®®ä»¿çœŸï¼šæ”¯æŒ RS232422485 ä¿¡å·æ¨¡æ‹Ÿï¼ŒåŒ…æ‹¬ DTRDSRRTSCTS ç­‰ç¡¬ä»¶æµæ§ï¼Œå…¼å®¹ Modbus ç­‰å·¥ä¸šåè®®ã€‚ ç½‘ç»œæ‰©å±•ï¼šå¯é€šè¿‡ TCPIP å°†è™šæ‹Ÿä¸²å£æ˜ å°„åˆ°è¿œç¨‹è®¾å¤‡ï¼Œå®ç°è·¨ç½‘ç»œé€šä¿¡ã€‚ ç‰ˆæœ¬æ›´æ–°ï¼š2024 å¹´ 12 æœˆå‘å¸ƒçš„ 9.0.270 ç‰ˆæœ¬å…¨é¢æ”¯æŒ Windows 11ï¼Œä¼˜åŒ–å¤šçº¿ç¨‹æ•°æ®å¤„ç†èƒ½åŠ›ã€‚ é€‚ç”¨åœºæ™¯ï¼šå·¥ä¸šè‡ªåŠ¨åŒ–æµ‹è¯•ã€åµŒå…¥å¼å¼€å‘ã€å¤šè®¾å¤‡ååŒä»¿çœŸã€‚ ä¸‹è½½ï¼šå®˜æ–¹ç½‘ç«™ 2. Com0com åŠŸèƒ½ç‰¹æ€§ï¼š å¼€æºå…è´¹ï¼šåŸºäº GPL åè®®ï¼Œæ”¯æŒåˆ›å»ºè™šæ‹Ÿä¸²å£å¯¹ï¼Œæ•°æ®é€šè¿‡å†…éƒ¨ç¼“å†²åŒºä¼ è¾“ã€‚ è½»é‡çº§è®¾è®¡ï¼šèµ„æºå ç”¨ä½ï¼Œé€‚åˆå¿«é€Ÿæ­å»ºç®€å•æµ‹è¯•ç¯å¢ƒã€‚ Windows 11 å…¼å®¹æ€§ï¼šéœ€æ‰‹åŠ¨å®‰è£…ï¼ˆä½¿ç”¨ 7-Zip è§£å‹åä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ 64 ä½å®‰è£…ç¨‹åºï¼‰ï¼Œç¤¾åŒºæä¾›è¯¦ç»†é…ç½®æ•™ç¨‹ã€‚ ç‰ˆæœ¬æ›´æ–°ï¼š2025 å¹´æœ€æ–°å¼€æºç‰ˆæœ¬ä¸º 3.0.0.0ï¼Œå•†ä¸šç‰ˆï¼ˆEltima Com0comï¼‰æ”¯æŒæ›´å®Œå–„çš„ä¿¡å·ä»¿çœŸã€‚ é€‚ç”¨åœºæ™¯ï¼šå­¦ç”Ÿå®éªŒã€å°å‹é¡¹ç›®è°ƒè¯•ã€å¿«é€ŸéªŒè¯ä¸²å£é€šä¿¡é€»è¾‘ã€‚ ä¸‹è½½ï¼šSourceForgeå¼€æºç‰ˆ Eltimaå•†ä¸šç‰ˆ ä½†æ˜¯å®‰è£…åä¼šå‡ºç°ä¸²å£ä¸å¯ç”¨çš„æƒ…å†µï¼Œè¿™æ˜¯ç”±äºé©±åŠ¨ä¸å¯¹å¯¼è‡´çš„ï¼Œè§£å†³æ–¹æ³•å°±æ˜¯è·Ÿæ–°é©±åŠ¨ï¼Œå¦‚ä¸‹ https://www.rozenek.com/com0com-problem-with-com-cnca0/ 3. USR-VCOM åŠŸèƒ½ç‰¹æ€§ï¼š ç½‘ç»œæ¡¥æ¥ï¼šå°† TCPIP æˆ– UDP é€šä¿¡æ˜ å°„æˆæœ¬æœºè™šæ‹Ÿä¸²å£ï¼Œæ”¯æŒè¿œç¨‹è®¾å¤‡æ§åˆ¶ã€‚ å¤šæ¨¡å¼æ”¯æŒï¼šæä¾› ServerClientUDP å¹¿æ’­æ¨¡å¼ï¼Œé€‚é…ä¸åŒç½‘ç»œæ¶æ„ã€‚ ç®€å•æ˜“ç”¨ï¼šç•Œé¢ç®€æ´ï¼Œæ”¯æŒä¸€é”®åˆ›å»ºä¸²å£æ˜ å°„ï¼Œé€‚åˆéæŠ€æœ¯äººå‘˜å¿«é€Ÿä¸Šæ‰‹ã€‚ ç‰ˆæœ¬æ›´æ–°ï¼š2024 å¹´ 12 æœˆå‘å¸ƒçš„æœ€æ–°ç‰ˆä¼˜åŒ–äº†ç½‘ç»œå»¶è¿Ÿï¼Œæ”¯æŒ IPv6 åè®®ã€‚ é€‚ç”¨åœºæ™¯ï¼šç‰©è”ç½‘è®¾å¤‡è°ƒè¯•ã€è¿œç¨‹ç›‘æ§ç³»ç»Ÿã€è·¨å¹³å°æ•°æ®äº¤äº’ã€‚ ä¸‹è½½ï¼šåå†›è½¯ä»¶å›­ 4. VSPE (Virtual Serial Port Emulator) åŠŸèƒ½ç‰¹æ€§ï¼š å¯è§†åŒ–é…ç½®ï¼šé€šè¿‡å›¾å½¢ç•Œé¢åˆ›å»ºä¸²å£å¯¹ï¼Œå®æ—¶ç›‘æ§æ•°æ®æµã€‚ è„šæœ¬æ”¯æŒï¼šå¯ç¼–å†™è„šæœ¬è‡ªåŠ¨åŒ–ä¸²å£æ“ä½œï¼Œé€‚åˆæ‰¹é‡æµ‹è¯•ã€‚ è™šæ‹Ÿæœºå…¼å®¹ï¼šå®Œç¾æ”¯æŒ VMwareã€VirtualBox ç­‰è™šæ‹ŸåŒ–ç¯å¢ƒã€‚ ç‰ˆæœ¬æ›´æ–°ï¼š2025 å¹´ 1 æœˆæ›´æ–°çš„ 7.2 ç‰ˆæœ¬å¢å¼ºäº†ä¸ VS Code ç­‰å¼€å‘å·¥å…·çš„é›†æˆã€‚ é€‚ç”¨åœºæ™¯ï¼šè™šæ‹Ÿæœºå¼€å‘ç¯å¢ƒã€è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ã€ä¸²å£åè®®é€†å‘å·¥ç¨‹ã€‚","categories":["4.é€šè®¯åè®®","ä¸²å£"]},{"title":"2025-03-31","path":"/2025/03/31/4-é€šè®¯åè®®-ä¸²å£-ä¸²å£é€šè®¯/","content":"ä¸²å£é€šä¿¡è¯¦è§£ä»€ä¹ˆæ˜¯ä¸²å£é€šä¿¡åœ¨è®¡ç®—æœºé€šä¿¡é¢†åŸŸï¼Œä¿¡æ¯ï¼ˆæ•°æ®ï¼‰çš„ä¼ è¾“å¯ä»¥æ˜¯ä¸€ä½æˆ–å¤šä½æ¯”ç‰¹ã€‚ä¸²è¡Œé€šä¿¡æŒ‡çš„æ˜¯æ¯æ¬¡åªä¼ è¾“ä¸€ä½æ•°æ®çš„æ–¹å¼ã€‚åœ¨ä¸²å£é€šä¿¡ä¸­ï¼Œæ— è®ºæ˜¯å‘é€è¿˜æ˜¯æ¥æ”¶ï¼Œæ¯ä¸ªå­—ï¼ˆå³å­—èŠ‚æˆ–å­—ç¬¦ï¼‰éƒ½æ˜¯é€ä½è¿›è¡Œä¼ è¾“çš„ã€‚æ¯ä¸€ä½æ•°æ®è¦ä¹ˆæ˜¯é€»è¾‘â€˜1â€™ï¼Œè¦ä¹ˆæ˜¯é€»è¾‘â€˜0â€™ã€‚åœ¨ä¸“ä¸šæœ¯è¯­ä¸­ï¼Œé€»è¾‘â€˜1â€™é€šå¸¸ç”¨â€œMarkâ€è¡¨ç¤ºï¼Œè€Œé€»è¾‘â€˜0â€™åˆ™ç”¨â€œSpaceâ€è¡¨ç¤ºã€‚ ä¸²å£æ•°æ®é€Ÿç‡ä¸²å£é€šä¿¡çš„æ•°æ®é€Ÿç‡é€šå¸¸ç”¨bits-per-second (bps) æˆ–è€… baud rate (baud) æ¥è¡¡é‡ã€‚è¿™ä»£è¡¨æ¯ç§’é’Ÿèƒ½å¤Ÿä¼ è¾“å¤šå°‘ä¸ªé€»è¾‘â€˜1â€™å’Œâ€˜0â€™ã€‚å½“æ³¢ç‰¹ç‡è¶…è¿‡ 1000 æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨ Kbps æ¥è¡¨ç¤ºï¼›è€Œå½“æ³¢ç‰¹ç‡è¶…è¿‡ 1000000 æ—¶ï¼Œåˆ™ä¼šä½¿ç”¨ Mbps æ¥è¡¨ç¤ºã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªè®¾å¤‡çš„æ³¢ç‰¹ç‡ä¸º 9600 bpsï¼Œé‚£ä¹ˆå®ƒæ¯ç§’é’Ÿå¯ä»¥ä¼ è¾“ 9600 ä¸ªæ¯”ç‰¹ä½çš„æ•°æ®ã€‚å¦‚æœéœ€è¦ä¼ è¾“ä¸€ä¸ªåŒ…å« 8 ä½çš„å­—èŠ‚ï¼Œåˆ™å¤§çº¦éœ€è¦ 89600 ç§’çš„æ—¶é—´ã€‚ TTL ä¸²å£åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒTTL ç”µå¹³é€æ¸æˆä¸ºä¸€ç§è¶‹åŠ¿ï¼Œå°¤å…¶æ˜¯åœ¨å¾®æ§åˆ¶å™¨å•å…ƒï¼ˆMCUï¼‰ä¸ä¸²å£è½¬æ¥èŠ¯ç‰‡ä¹‹é—´çš„é€šä¿¡ä¸­æ›´ä¸ºå¸¸è§ã€‚TTL ç”µå¹³å®šä¹‰äº†ä¸åŒçš„ç”µå‹å€¼æ¥è¡¨ç¤ºé€»è¾‘çŠ¶æ€ï¼šé€»è¾‘â€˜1â€™å¯¹åº”çš„ç”µå‹å€¼ä¸º+5V æˆ–+3.3V ç­‰ï¼›è€Œé€»è¾‘â€˜0â€™å¯¹åº”çš„ç”µå‹å€¼ä¸º 0Vï¼ˆå³é€»è¾‘åœ°ï¼‰ã€‚è¿™ç§ç”µå¹³æ ‡å‡†ä½¿å¾—ç”µè·¯è®¾è®¡æ›´åŠ ç®€å•å’Œå¯é ã€‚ RS-232 ä¸²å£RS-232 æ˜¯ç”±ç”µå­å·¥ä¸šåä¼šï¼ˆEIAï¼‰å®šä¹‰çš„ä¸€ç§ç”¨äºä¸²è¡Œé€šä¿¡çš„æ ‡å‡†ç”µæ°”æ¥å£ã€‚RS-232 å®é™…ä¸Šæœ‰ä¸‰ç§ä¸åŒçš„ç±»å‹ï¼ˆAã€B å’Œ Cï¼‰ï¼Œæ¯ä¸€ç§ç±»å‹å¯¹äºé€»è¾‘â€˜1â€™å’Œé€»è¾‘â€˜0â€™éƒ½æœ‰ä¸åŒçš„ç”µå‹èŒƒå›´å®šä¹‰ã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„ç±»å‹æ˜¯ RS-232Cï¼Œå®ƒå®šä¹‰äº†é€»è¾‘â€˜1â€™çš„ç”µå‹èŒƒå›´ä¸º-3V-12Vï¼Œè€Œé€»è¾‘â€˜0â€™çš„ç”µå‹èŒƒå›´ä¸º+3V+12Vã€‚ DB-9 æ¥å£åˆ†å¸ƒå›¾ä¸‹é¢æ˜¯ä¸€ä¸ªå¸¸è§çš„ DB-9 æ¥å£åˆ†å¸ƒå›¾ç¤ºä¾‹ï¼š è¯¥æ¥å£åŒ…å«å¤šä¸ªå¼•è„šï¼Œæ¯ä¸ªå¼•è„šéƒ½æœ‰ç‰¹å®šçš„åŠŸèƒ½ï¼š **TXD (Transmit Data)**ï¼šç”¨äºå‘é€æ•°æ®ã€‚ **RXD (Receive Data)**ï¼šç”¨äºæ¥æ”¶æ•°æ®ã€‚ **GND (Ground)**ï¼šæä¾›å…¬å…±æ¥åœ°å‚è€ƒç‚¹ã€‚ å…¶ä»–å¼•è„šå¯èƒ½åŒ…æ‹¬ä¿¡å·åœ°ã€è¯·æ±‚å‘é€ã€æ¸…é™¤å‘é€ç­‰è¾…åŠ©åŠŸèƒ½ã€‚ å…¶ä»–ä¸²å£æ ‡å‡†é™¤äº† RS-232 ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–å‡ ç§å¸¸è§çš„ä¸²è¡Œé€šä¿¡æ ‡å‡†ï¼š RS-422RS-422 ä½¿ç”¨è¾ƒä½çš„ç”µå‹å’Œå·®åˆ†ä¿¡å·æŠ€æœ¯ï¼Œå…è®¸çº¿ç¼†é•¿åº¦è¾¾åˆ°æƒŠäººçš„ 1,000 è‹±å°ºï¼ˆçº¦ 305 ç±³ï¼‰ã€‚è¿™ç§æ ‡å‡†ç‰¹åˆ«é€‚ç”¨äºé•¿è·ç¦»ã€é«˜é€Ÿåº¦çš„æ•°æ®ä¼ è¾“åœºæ™¯ã€‚ RS-485RS-485 æ˜¯ä¸€ç§æ”¹è¿›ç‰ˆçš„ RS-422 æ ‡å‡†ï¼Œåœ¨å¤šç‚¹ç½‘ç»œä¸­è¡¨ç°å°¤ä¸ºå‡ºè‰²ã€‚å®ƒæ”¯æŒå¤šä¸ªè®¾å¤‡åœ¨åŒä¸€æ€»çº¿ä¸Šè¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”å…·æœ‰æ›´å¼ºçš„æŠ—å¹²æ‰°èƒ½åŠ›ã€‚ å¸¸ç”¨ä¸²å£ä¿¡å·å®šä¹‰ GND - é€»è¾‘åœ° ä»æŠ€æœ¯ä¸Šè®²ï¼Œé€»è¾‘æ¥åœ°ä¸æ˜¯ä¿¡å·ï¼Œä½†æ²¡æœ‰å®ƒï¼Œå…¶ä»–ä¿¡å·å°±ä¸èƒ½å·¥ä½œã€‚ä»æ ¹æœ¬ä¸Šè¯´ï¼Œé€»è¾‘åœ°å……å½“ä¸€ä¸ªå‚è€ƒç”µå‹ï¼Œä»è€ŒçŸ¥é“å“ªäº›ç”µå‹ä¸ºæ­£æˆ–è´Ÿã€‚ TXD - å‘é€æ•°æ® RXD - æ¥æ”¶æ•°æ® RTS - è¯·æ±‚å‘é€ RTS è®¾ç½®ä¸ºé€»è¾‘ 0 ç”µå¹³è¡¨ç¤ºå·±æ–¹å‡†å¤‡å¥½æ¥æ”¶æ•°æ®ã€‚ä¸€èˆ¬ä¸ CTS ä¸€èµ·ç”¨äºä¸²å£æµæ§ï¼Œé€šå¸¸è¢«è®¾ç½®ä¸ºé»˜è®¤æœ‰æ•ˆçŠ¶æ€ã€‚ é™¤æµæ§åŠŸèƒ½å¤–ï¼ŒRTS ä¹Ÿå¯ç”¨ä½œé€šç”¨è¾“å‡ºä¿¡å·ï¼Œè¾“å‡ºé«˜ä½ç”µå¹³ã€‚å¸¸ç”¨äºå•ç‰‡æœºå¤ä½æˆ–ä¸²å£ä¸‹è½½ç”µè·¯ã€‚ CTS - æ¸…é™¤å‘é€ CTS ä¿¡å·æ¥æ”¶è‡ªä¸²å£çº¿ç¼†çš„å¦ä¸€ç«¯ã€‚ä¿¡å·çº¿é€»è¾‘ 0 ç”µå¹³è¡¨ç¤ºå·±æ–¹å¯ä»¥å‘é€æ•°æ®ã€‚ä¸€èˆ¬ä¸ RTS ä¸€èµ·ç”¨äºä¸²å£æ•°æ®æµæ§ã€‚ DTR - æ•°æ®ç»ˆç«¯å°±ç»ª DTR ä¿¡å·ç”¨äºé€šçŸ¥å¯¹ç«¯è®¡ç®—æœºæˆ–è®¾å¤‡å·±æ–¹å·²å°±ç»ªï¼ˆé€»è¾‘ 0 ç”µå¹³ï¼‰æˆ–æœªå°±ç»ªï¼ˆé€»è¾‘ 1 ç”µå¹³ï¼‰ã€‚DTR ä¹Ÿå¯ç”¨ä½œé€šç”¨è¾“å‡ºä¿¡å·ï¼Œè¾“å‡ºé«˜ä½ç”µå¹³ã€‚å¸¸ç”¨äºå•ç‰‡æœºå¤ä½æˆ–ä¸²å£ä¸‹è½½ç”µè·¯ã€‚ ä¸²å£æ³¢ç‰¹ç‡ æ³¢ç‰¹ç‡æ˜¯æŒ‡ä¸²å£æ¯ç§’é’Ÿä¼ è¾“çš„ bit æ€»æ•°ï¼Œå¦‚ï¼š9600 æ³¢ç‰¹ç‡ã€‚è¡¨ç¤º 1s ä¼ è¾“ 9600 ä¸ªæ¯”ç‰¹ã€‚1 ä¸ªæ¯”ç‰¹æ‰€éœ€æ—¶é—´ä¸ºï¼š19600 â‰ˆ 0.104ms ä¸²å£å¼‚æ­¥é€šä¿¡ è§£æä¸²å£æ•°æ®éœ€è¦ç¡®å®šä¸€ä¸ªå­—ç¬¦çš„ç»“æŸä¸ä¸‹ä¸€ä¸ªå­—ç¬¦çš„å¼€å§‹ã€‚ ä¸²å£æ•°æ®çº¿ç©ºé—²æ—¶ä¿æŒåœ¨é€»è¾‘ 1 çŠ¶æ€ç›´åˆ°æœ‰å­—ç¬¦å‘é€ã€‚æ¯ä¸ªå­—èŠ‚èµ·å§‹ä½åœ¨å‰ï¼Œå­—èŠ‚çš„æ¯ä¸€ä½ç´§éšå…¶åï¼Œä¸€ä½å¯é€‰æ ¡éªŒä½ä»¥åŠä¸€ä½æˆ–è€…ä¸¤ä½åœæ­¢ä½ã€‚èµ·å§‹ä½å§‹ç»ˆæ˜¯é€»è¾‘ 0ï¼Œé€šçŸ¥å¯¹æ–¹æœ‰æ–°ä¸²å£æ•°æ®å¯ç”¨ã€‚æ•°æ®å¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶ï¼Œå› æ­¤ç§°ä¸ºâ€œå¼‚æ­¥â€ã€‚ å¶æ ¡éªŒï¼šæ•°æ®ä½åŠ ä¸Šæ ¡éªŒä½ä¸­çš„â€œ1â€çš„ä¸ªæ•°ä¿æŒä¸ºå¶æ•°ã€‚ å¥‡æ ¡éªŒï¼šæ•°æ®ä½åŠ ä¸Šæ ¡éªŒä½ä¸­çš„â€œ1â€çš„ä¸ªæ•°ä¿æŒä¸ºå¥‡æ•°ã€‚ ç©ºç™½æ ¡éªŒï¼šä¹Ÿç§° Space æ ¡éªŒï¼Œæ ¡éªŒä½æ°¸è¿œæ˜¯ 0ã€‚ æ ‡å¿—æ ¡éªŒï¼šä¹Ÿç§° Mark æ ¡éªŒï¼Œæ ¡éªŒä½æ°¸è¿œæ˜¯ 1ã€‚ æ— æ ¡éªŒï¼šæ²¡æœ‰æ ¡éªŒä½å­˜åœ¨æˆ–è¢«ä¼ è¾“ã€‚ å‰©ä¸‹çš„ä½ç§°ä½œåœæ­¢ä½ã€‚åœ¨å­—ç¬¦ä¹‹é—´å¯èƒ½ä¼šæœ‰ 1ï¼Œ1.5 æˆ–è€… 2 ä½åœæ­¢ä½å¹¶ä¸”è¿™äº›ä½æ€»ä¸º 1ã€‚å¼‚æ­¥æ•°æ®æ ¼å¼é€šå¸¸è¡¨è¾¾æˆâ€œ8N1â€ï¼Œâ€œ7E1â€ç­‰ã€‚ ä»€ä¹ˆæ˜¯å…¨åŒå·¥å’ŒåŠåŒå·¥ å…¨åŒå·¥æ˜¯æŒ‡è®¾å¤‡å¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œæœ‰ä¸¤ä¸ªç‹¬ç«‹æ•°æ®é€šé“ï¼ˆä¸€è·¯è¾“å…¥ï¼Œä¸€è·¯è¾“å‡ºï¼‰ã€‚ åŠåŒå·¥æ˜¯æŒ‡è®¾å¤‡ä¸èƒ½åŒæ—¶å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œè¿™é€šå¸¸æ„å‘³ç€åªæœ‰ä¸€è·¯å¯ä»¥é€šè®¯ï¼Œå¦‚ RS485 ä¸²å£ã€‚ ä¸²å£æµæ§ åœ¨ä¸¤ä¸ªä¸²å£è®¾å¤‡é—´ä¼ è¾“æ•°æ®æ—¶ç»å¸¸æœ‰å¿…è¦è¿›è¡Œæ•°æ®æµæ§ã€‚è¿™å¯èƒ½æ˜¯å—åˆ°ä¸­é—´ä¸²å£é€šä¿¡çº¿è·¯ã€å…¶ä¸­ä¸€ä¸ªè®¾å¤‡æˆ–è€…å…¶ä»–å­˜å‚¨ä»‹è´¨çš„é™åˆ¶ã€‚å¼‚æ­¥æ•°æ®æµæ§é€šå¸¸ä½¿ç”¨çš„æœ‰ä¸¤ç§æ–¹æ³•ã€‚ ç¬¬ä¸€ç§æ–¹æ³•é€šå¸¸ç§°ä¸ºâ€œè½¯ä»¶â€æµæ§ï¼Œä½¿ç”¨ç‰¹æ®Šå­—ç¬¦å¼€å§‹ï¼ˆXON or DC1ï¼‰æˆ–è€…åœæ­¢ï¼ˆXOFF or DC3ï¼‰æ•°æ®æµã€‚è¿™äº›å­—ç¬¦å®šä¹‰å‚è§ ASCII ç è¡¨ã€‚è¿™äº›ç å€¼åœ¨ä¼ è¾“æ–‡æœ¬ä¿¡æ¯æ—¶å¾ˆæœ‰ç”¨ï¼Œä½†ä¸èƒ½åœ¨æœªç»ç‰¹æ®Šç¼–ç¨‹æ—¶ç”¨äºä¼ è¾“å…¶ä»–ç±»å‹çš„ä¿¡æ¯ã€‚ ç¬¬äºŒç§æ–¹æ³•ç§°ä½œâ€œç¡¬ä»¶â€æµæ§ï¼Œä½¿ç”¨ RTS å’Œ CTS ä¿¡å·çº¿å–ä»£ç‰¹æ®Šå­—ç¬¦ã€‚å½“æ¥æ”¶æ–¹å‡†å¤‡å¥½æ¥æ”¶æ•°æ®æ—¶ä¼šå°† RTS ç½®ä¸ºé€»è¾‘ 0 ä»¥è¯·æ±‚å¯¹æ–¹å‘é€æ•°æ®ï¼Œå½“æœªå‡†å¤‡å¥½æ—¶ç½®ä¸ºé€»è¾‘ 1ï¼Œå› æ­¤å‘é€æ–¹ä¼šé€šè¿‡æ£€æµ‹ CTS ç”µå¹³çŠ¶æ€åˆ¤æ–­æ˜¯å¦å¯ä»¥å‘é€æ•°æ®ã€‚ ä½¿ç”¨ç¡¬ä»¶æµæ§è‡³å°‘éœ€è¦è¿æ¥çš„ä¿¡å·çº¿æœ‰ GNDã€RXDã€TXDã€RTSã€CTSã€‚ ä½¿ç”¨è½¯ä»¶æµæ§åªéœ€è¦ GNDã€RXDã€TXDã€‚ Break ä¿¡å· é€šå¸¸æƒ…å†µä¸‹æ”¶å‘æ•°æ®ä¿¡å·çº¿ä¿æŒåœ¨é€»è¾‘ 1 çŠ¶æ€ç›´åˆ°ä¼ è¾“ä¸€ä¸ªæ–°å­—èŠ‚ã€‚å¦‚æœä¿¡å·æ‹‰ä½è‡³é€»è¾‘ 0 ä¸€æ®µæ—¶é—´ï¼ˆå„å¹³å°å®šä¹‰ä¸åŒï¼Œé€šå¸¸æ˜¯ 14 åˆ° 12 ç§’ï¼‰é‚£ä¹ˆå°±è¯´ä¸€ä¸ª break æ¡ä»¶æ»¡è¶³ã€‚ä¸€ä¸ª break ä¿¡å·æœ‰æ—¶ç”¨äºå¤ä½é€šè®¯æˆ–è€…æ”¹å˜é€šè®¯ç¡¬ä»¶çš„æ“ä½œæ¨¡å¼ï¼Œå¦‚ MODEMã€‚ 1ã€USB_VCP è®¾å¤‡ USB_VCP æ˜¯å±äº USB_CDC ç±»è®¾å¤‡ä¸­çš„ä¸€ç§ï¼Œæ˜¯é€šè¿‡ USB æ¥å£è™šæ‹Ÿä¸²å£å®ç°ä¸²å£é€šè®¯çš„åŠŸèƒ½ã€‚ USB è™šæ‹Ÿä¸²å£ï¼Œç®€ç§° VCPï¼Œæ˜¯ Virtual COM Port çš„ç®€å†™ï¼Œå®ƒæ˜¯åˆ©ç”¨ USB çš„ CDC ç±»æ¥å®ç°çš„ä¸€ç§é€šä¿¡æ¥å£ã€‚ USB è™šæ‹Ÿä¸²å£å±äº USB é€šä¿¡è®¾å¤‡ç±»ã€‚åœ¨ç‰©ç†å±‚é€šè¿‡ USB æ€»çº¿ï¼Œé‡‡ç”¨è™šæ‹Ÿä¸²å£çš„æ–¹å¼ä¸ºä¸»æœºæä¾›ä¸€ä¸ªç‰©ç†ä¸²å£ã€‚åœ¨ç³»ç»Ÿå†…éƒ¨ï¼ŒUSB æ§åˆ¶å™¨æä¾›äº†ä¸€ä¸ªæ‰¹é‡ä¼ è¾“ IN ç«¯ç‚¹å’Œä¸€ä¸ªæ‰¹é‡ä¼ è¾“çš„ OUT ç«¯ç‚¹ï¼Œç”¨äºæ•°æ®çš„æ¥æ”¶å’Œå‘é€ï¼Œæ¨¡æ‹Ÿä¸²å£çš„ RX å’Œ TX çº¿ã€‚å¦å¤– USB æ§åˆ¶å™¨è¿˜æä¾›ä¸­æ–­ IN ç«¯ç‚¹ï¼Œå‘é€å½“å‰ä¸²å£çš„çŠ¶æ€ï¼Œå®ç°å¯¹ä¸²å£ä¼ è¾“çš„æ§åˆ¶ã€‚ä¸²å£è®¾å¤‡çš„æ•°æ®ï¼Œç”±ç³»ç»Ÿçš„ä¸²å£é‡‡é›†ï¼Œåœ¨èŠ¯ç‰‡å†…å®Œæˆ USB åŒ…çš„å°è£…ï¼Œé€šè¿‡ USB æ€»çº¿ä¸Šä¼ è‡³ä¸»æœºï¼Œå†ç”±ç›¸åº”çš„ä¸²å£åº”ç”¨ç¨‹åºè¿›è¡Œå¤„ç†ã€‚å¯¹ç”¨æˆ·æ¥è¯´ï¼Œçœ‹åˆ°çš„æ˜¯åŸºäºä¸²å£çš„æ•°æ®é‡‡é›†å’Œä¼ è¾“ï¼Œè€Œå®é™…ä¸Šå®ç°çš„æ˜¯åŸºäº USB åè®®åŒ…çš„æ•°æ®ä¼ è¾“ã€‚ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ STM32 è‡ªå¸¦çš„ USB åŠŸèƒ½ï¼Œæ¥å®ç°ä¸€ä¸ª USB è™šæ‹Ÿä¸²å£ï¼Œä»è€Œé€šè¿‡ USBï¼Œå®ç°ç”µè„‘ä¸ STM32 çš„æ•°æ®äº’ä¼ ã€‚ä¸Šä½æœºæ— éœ€ç¼–å†™ä¸“é—¨çš„ USB ç¨‹åºï¼Œåªéœ€è¦ä¸€ä¸ªä¸²å£è°ƒè¯•åŠ©æ‰‹å³å¯è°ƒè¯•ï¼Œéå¸¸å®ç”¨ã€‚ æœ¬å®éªŒåˆ©ç”¨ STM32 è‡ªå¸¦çš„ USB åŠŸèƒ½ï¼Œè¿æ¥ç”µè„‘ USBï¼Œè™šæ‹Ÿå‡ºä¸€ä¸ª USB ä¸²å£ï¼Œå®ç°ç”µè„‘å’Œå¼€å‘æ¿çš„æ•°æ®é€šä¿¡ã€‚ 2ã€USB_CDC USB2.0 æ ‡å‡†ä¸‹å®šä¹‰äº†å¾ˆå¤šå­ç±»ï¼Œæœ‰éŸ³é¢‘ç±»ï¼ŒCDC ç±»ï¼ŒHIDï¼Œæ‰“å°ï¼Œå¤§å®¹é‡å­˜å‚¨ç±»ï¼ŒHUBï¼Œæ™ºèƒ½å¡ç­‰ç­‰ï¼Œè¿™äº›åœ¨ usb.org å®˜ç½‘ä¸Šæœ‰å…·ä½“çš„å®šä¹‰ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»é€šä¿¡ç±» CDCã€‚CDC(Communication Device Class)ç±»æ˜¯ USB2.0 æ ‡å‡†ä¸‹çš„ä¸€ä¸ªå­ç±»ï¼Œå®šä¹‰äº†é€šä¿¡ç›¸å…³è®¾å¤‡çš„æŠ½è±¡é›†åˆã€‚ USB çš„ CDC ç±»æ˜¯ USB é€šä¿¡è®¾å¤‡ç±»ï¼ˆCommunication Device Classï¼‰çš„ç®€ç§°ã€‚CDC ç±»æ˜¯ USB ç»„ç»‡å®šä¹‰çš„ä¸€ç±»ä¸“é—¨ç»™å„ç§é€šä¿¡è®¾å¤‡ï¼ˆç”µä¿¡é€šä¿¡è®¾å¤‡å’Œä¸­é€Ÿç½‘ç»œé€šä¿¡è®¾å¤‡ï¼‰ä½¿ç”¨çš„ USB å­ç±»ã€‚æ ¹æ® CDC ç±»æ‰€é’ˆå¯¹é€šä¿¡è®¾å¤‡çš„ä¸åŒï¼ŒCDC ç±»åˆè¢«åˆ†æˆä»¥ä¸‹ä¸åŒçš„æ¨¡å‹ï¼šUSB ä¼ ç»Ÿçº¯ç”µè¯ä¸šåŠ¡ï¼ˆPOTSï¼‰æ¨¡å‹ï¼ŒUSBISDN æ¨¡å‹å’Œ USB ç½‘ç»œæ¨¡å‹ï¼Œå…¶ä¸­ USB ä¼ ç»Ÿçº¯ç”µè¯ä¸šåŠ¡æ¨¡å‹åˆå¯åˆ†ä¸ºç›´çº¿æ§åˆ¶æ¨¡å‹ï¼ˆDirect Line Control Modelï¼‰ã€æŠ½è±¡æ¨¡å‹ã€ç”µè¯æ¨¡å‹ã€‚è™šæ‹Ÿä¸²å£å°±å±äº USB ä¼ ç»Ÿçº¯ç”µè¯ä¸šåŠ¡æ¨¡å‹ä¸‹çš„æŠ½è±¡æ§åˆ¶æ¨¡å‹ã€‚ USB CDC ç±»çš„é€šä¿¡éƒ¨åˆ†ä¸»è¦åŒ…å«ä¸‰éƒ¨åˆ†ï¼šæšä¸¾è¿‡ç¨‹ã€è™šæ‹Ÿä¸²å£æ“ä½œå’Œæ•°æ®é€šä¿¡ã€‚å…¶ä¸­è™šæ‹Ÿä¸²å£æ“ä½œéƒ¨åˆ†å¹¶ä¸ä¸€å®šå¼ºåˆ¶éœ€è¦ï¼Œå› ä¸ºè‹¥è·³è¿‡è¿™äº›è™šæ‹Ÿä¸²å£çš„æ“ä½œï¼Œå®é™…ä¸Š USB ä¾ç„¶æ˜¯å¯ä»¥é€šä¿¡çš„ã€‚ä¹‹æ‰€ä»¥ä¼šæœ‰è™šæ‹Ÿä¸²å£æ“ä½œï¼Œä¸»è¦æ˜¯æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ PC ä½œä¸º Host ç«¯ï¼Œåœ¨ PC ç«¯ä½¿ç”¨ä¸€ä¸ªä¸²å£å·¥å…·æ¥ä¸å…¶è¿›è¡Œé€šä¿¡ï¼ŒPC ç«¯çš„å¯¹åº”é©±åŠ¨å°†å…¶è™šæ‹Ÿæˆä¸€ä¸ªæ™®é€šä¸²å£ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå¯ä»¥æ–¹ä¾¿ PC ç«¯è½¯ä»¶é€šè¿‡æ“ä½œä¸²å£çš„æ–¹å¼æ¥ä¸å…¶è¿›è¡Œé€šä¿¡ï¼Œä½†å®é™…ä¸Šï¼ŒHost ç«¯ä¸ Device ç«¯ç‰©ç†ä¸Šæ˜¯é€šè¿‡ USB æ€»çº¿æ¥è¿›è¡Œé€šä¿¡çš„ï¼Œä¸ä¸²å£æ²¡æœ‰å…³ç³»ï¼Œè¿™ä¸€è™šæ‹ŸåŒ–è¿‡ç¨‹ï¼Œèµ·å†³å®šæ€§ä½œç”¨çš„æ˜¯å¯¹åº”é©±åŠ¨ï¼ŒåŒ…å«å¦‚ä½•å°†æ¯ä¸€æ¡å…·ä½“çš„è™šæ‹Ÿä¸²å£æ“ä½œå¯¹åº”åˆ°å®é™…ä¸Šçš„ USB æ“ä½œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒHost ç«¯ä¸ Device ç«¯çš„ USB é€šä¿¡é€Ÿç‡å¹¶ä¸å—æ‰€è°“çš„ä¸²å£æ³¢ç‰¹ç‡å½±å“ï¼Œå®ƒå°±æ˜¯æ ‡å‡†çš„ USB2.0 å…¨é€Ÿ(12Mbps)é€Ÿåº¦ï¼Œå®é™…é€Ÿç‡å–å†³äºæ€»çº¿çš„å®é™…ä½¿ç”¨ç‡ã€é©±åŠ¨è®¿é—® USB å¤–è®¾æœ‰æ•ˆé€Ÿç‡(ä¸¤è¾¹)ä»¥åŠå¤–éƒ¨ç¯å¢ƒå¯¹é€šä¿¡æœ¬èº«é€ æˆçš„å¹²æ‰°ç‡ç­‰å› ç´ ç»„æˆã€‚ CDC ç±»è½¯ä»¶æ¡†æ¶ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé»„è‰² USB Device Core éƒ¨åˆ†ä¸º USB è®¾å¤‡åº“æ–‡ä»¶,å±äºä¸­é—´ä»¶,å®ƒä¸º USB åè®®æ ˆçš„æ ¸å¿ƒæºæ–‡ä»¶ï¼Œä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹ï¼š USB Device Core ä¸­,Logdebug ä¸ºæ‰“å°è°ƒè¯•å¼€å…³; core ä¸º USB è®¾å¤‡æ ¸å¿ƒ; USB request ä¸­å®šä¹‰äº†æšä¸¾è¿‡ç¨‹ä¸­å„ç§æ ‡å‡†è¯·æ±‚çš„å¤„ç†ï¼› IO request ä¸ºåº•å±‚é’ˆå¯¹ USB é€šä¿¡æ¥å£çš„å°è£…ã€‚ é»„è‰² USB Device Class éƒ¨åˆ†ä¸º USB ç±»æ–‡ä»¶ï¼Œä¹Ÿå±äºä¸­é—´ä»¶,USB è®¾å¤‡åº“ï¼Œç›®å‰ ST DEMO ä¸­æ”¯æŒçš„ç±»æœ‰ HID, Customer HID, CDC, MSC, DFU, Audio, ST æä¾›äº†è¿™äº›ç±»çš„æºç æ¡†æ¶ï¼Œå…¶ä»–çš„ Class æˆ–è€…æ˜¯å¤åˆè®¾å¤‡éœ€è¦è‡ªå·±æ ¹æ®å®é™…éœ€æ±‚æƒ…å†µè¿›è¡Œæ‰©å±•æˆ–å®šåˆ¶ã€‚å¦‚æœç”¨æˆ·éœ€æ±‚åªæ˜¯éœ€è¦ä¸€ä¸ªæ ‡å‡†ç±»ï¼Œæ¯”å¦‚ CDC é€šä¿¡ï¼Œé‚£ä¹ˆæœ€å¥½å°±ä½¿ç”¨ç°æˆçš„ä»£ç ï¼Œä¸éœ€è¦åšä»»ä½•ä¿®æ”¹å°±å¯ä»¥å®ç°è¿™ä¸ª CDC ç±»é€šä¿¡çš„åŠŸèƒ½ã€‚ è“è‰² USB Device HAL Driver ä¸º HAL åº“éƒ¨åˆ†ï¼Œæ˜¯å¯¹ USB å¤–è®¾æ¥å£çš„å°è£…ï¼Œå±äºåº•å±‚é©±åŠ¨ï¼Œä¸éœ€è¦ä¿®æ”¹ï¼Œå®ƒåˆ†ä¸º PCD å’Œ LL Driverï¼ŒPCD å¤„äº LL Driver ä¹‹ä¸Šã€‚ æ´‹çº¢è‰² USB Device Configuration ä¸º USB é…ç½®å°è£…ï¼Œä½äº USB åº•å±‚ HAL å±‚é©±åŠ¨ä¸ä¸­é—´ä»¶ USB åè®®æ ˆä¹‹é—´ï¼Œä¸€æ–¹é¢å‘ä¸Šå±‚(USB è®¾å¤‡åº“)æä¾›å„ç§æ“ä½œè°ƒç”¨æ¥å£ï¼Œå¦ä¸€æ–¹é¢ï¼Œå‘åº•å±‚ USB é©±åŠ¨æä¾›å„ç§å›è°ƒæ¥å£ã€‚æ­£æ˜¯ç”±äºå®ƒçš„å­˜åœ¨ï¼Œä½¿å¾— USB åè®®æ ˆ(USB è®¾å¤‡åº“)ä¸åº•å±‚ç¡¬ä»¶å®Œå…¨åˆ†ç¦»ï¼Œä»è€Œä½¿ USB è®¾å¤‡åº“å…·æœ‰æ›´åŠ å…¼å®¹æ‰€æœ‰ STM32 çš„é€šç”¨æ€§ã€‚USB Device Configuration ä¸ºå¼€æ”¾ç»™ç”¨æˆ·çš„æºæ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„æŸäº›ç‰¹æ®Šéœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤çš„æºæ–‡ä»¶ï¼Œå‡å¦‚æ²¡æœ‰ä»»ä½•ç‰¹æ®Šè¦æ±‚çš„è¯ï¼Œæˆ‘ä»¬ä½¿ç”¨é»˜è®¤å³å¯ã€‚ Application ä¸ºåº”ç”¨å±‚ï¼ŒUSB Device Class æœ‰å¯èƒ½å°†è‡ªå·±å¯¹åº”è¯¥çš„æ“ä½œæ¥å£å°è£…åœ¨ä¸€ä¸ªæ“ä½œæ•°æ®ç»“æ„ä¸­ï¼Œç”±åº”ç”¨æ¥å…·ä½“å®ç°è¿™äº›æ“ä½œï¼Œåœ¨ç³»ç»Ÿåˆå§‹åŒ–æ—¶ï¼Œç”±åº”ç”¨å°†å·²ç»å®šä¹‰å¥½çš„æ“ä½œæ¥å£æ³¨å†Œåˆ°å¯¹åº”çš„ USB ç±»ä¸­ï¼Œæ¯”å¦‚ usbd_cdc_ifï¼Œ å°±è¿™æ ·ï¼Œä½¿å¾—åº”ç”¨å±‚çš„åº”ç”¨ä»£ç ä¸å±äºä¸­é—´ä»¶å±‚çš„ USB åè®®æ ˆåˆ†ç¦»ã€‚åŒæ—¶ï¼ŒUSB åè®®æ ˆä¼šå°†ä¸€äº›å­—ç¬¦ä¸²æè¿°ç¬¦æ”¾åˆ° APP ä¸­ï¼Œå½“ USB åˆå§‹åŒ–æ—¶å°†è¿™äº›å·²ç»å®šä¹‰å¥½çš„å­—ç¬¦ä¸²é€šè¿‡æŒ‡é’ˆåˆå§‹åŒ–åˆ° USB åè®®æ ˆä¸­ï¼Œä»¥ä¾¿åç»­éœ€è¦æ—¶è·å–ã€‚ USB_CDC ç±»è¯¦ç»†å†…å®¹å¯å‚è€ƒã€ŠUSB_CDC ç±»å…¥é—¨åŸ¹è®­ã€‹ã€‚","categories":["4.é€šè®¯åè®®","ä¸²å£"]},{"title":"C++ é“¾æ¥è¿‡ç¨‹ä¸­çš„å‡½æ•°å®ç°é€‰æ‹©","path":"/2025/03/31/6-å¼€å‘å·¥å…·-ç¼–è¯‘é“¾æ¥-C-é“¾æ¥è¿‡ç¨‹ä¸­çš„å‡½æ•°å®ç°é€‰æ‹©/","content":"C++ é“¾æ¥è¿‡ç¨‹ä¸­çš„å‡½æ•°å®ç°é€‰æ‹©åœ¨ C++ å¼€å‘ä¸­ï¼Œå½“ä¸€ä¸ªå‡½æ•°åœ¨å¤´æ–‡ä»¶ä¸­å£°æ˜ï¼Œå¹¶åœ¨ .cpp æ–‡ä»¶å’Œé“¾æ¥çš„åº“æ–‡ä»¶ä¸­éƒ½å®ç°äº†è¯¥å‡½æ•°æ—¶ï¼Œé“¾æ¥å™¨å°†å¦‚ä½•é€‰æ‹©æ­£ç¡®çš„å®ç°æ˜¯ä¸€ä¸ªå…³é”®é—®é¢˜ã€‚ç†è§£è¿™ä¸€è¿‡ç¨‹éœ€è¦æ·±å…¥æ¢è®¨é¢„å¤„ç†ã€ç¼–è¯‘ã€æ±‡ç¼–å’Œé“¾æ¥ç­‰é˜¶æ®µï¼Œç‰¹åˆ«æ˜¯é“¾æ¥é˜¶æ®µçš„ç»†èŠ‚ã€‚ é“¾æ¥é¡ºåºä¸ç¬¦å·è§£æè§„åˆ™é“¾æ¥é¡ºåºçš„å½±å“ ç”¨æˆ·ç›®æ ‡æ–‡ä»¶ä¼˜å…ˆï¼šå¦‚æœç”¨æˆ·çš„ç›®æ ‡æ–‡ä»¶ï¼ˆåŒ…å«å‡½æ•°å®ç°çš„ .cpp æ–‡ä»¶ï¼‰åœ¨é“¾æ¥å‘½ä»¤ä¸­å…ˆäºåº“æ–‡ä»¶å‡ºç°ï¼Œé“¾æ¥å™¨ä¼šä¼˜å…ˆä½¿ç”¨è¯¥ç›®æ ‡æ–‡ä»¶ä¸­çš„ç¬¦å·ã€‚ä¾‹å¦‚ï¼Œåœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®š -o output_file main.o libmylib.a æ—¶ï¼Œmain.o ä¸­çš„å®ç°ä¼šè¢«ä¼˜å…ˆè€ƒè™‘ã€‚æ­¤æ—¶ï¼Œå³ä½¿ libmylib.a ä¸­ä¹ŸåŒ…å«è¯¥å‡½æ•°çš„å®ç°ï¼Œä½†ç”±äºæœªè¢«å¼•ç”¨è€Œä¸ä¼šè¢«é“¾æ¥è¿›æ¥ã€‚ åº“æ–‡ä»¶ä¼˜å…ˆï¼šå¦‚æœåº“æ–‡ä»¶åœ¨é“¾æ¥å‘½ä»¤ä¸­å…ˆäºç”¨æˆ·çš„ç›®æ ‡æ–‡ä»¶å‡ºç°ï¼ˆå¦‚ -o output_file libmylib.a main.oï¼‰ï¼Œä¸”åº“ä¸­çš„å®ç°è¢«æå–ï¼ˆä¾‹å¦‚æŸç›®æ ‡æ–‡ä»¶å¼•ç”¨äº†è¯¥å‡½æ•°ï¼‰ï¼Œåˆ™ç”¨æˆ·åç»­çš„ç›®æ ‡æ–‡ä»¶ä¼šå¼•å‘é‡å¤å®šä¹‰é”™è¯¯ï¼Œå¯¼è‡´é“¾æ¥å¤±è´¥ã€‚è¿™æ˜¯å› ä¸ºé“¾æ¥å™¨å·²ç»ä»åº“ä¸­æå–äº†è¯¥å‡½æ•°çš„å®ç°ï¼Œå¹¶è®¤ä¸ºå·²ç»æ»¡è¶³äº†ç¬¦å·éœ€æ±‚ã€‚ é™æ€åº“çš„æŒ‰éœ€é“¾æ¥ç‰¹æ€§é™æ€åº“ä¸­çš„ç›®æ ‡æ–‡ä»¶ä»…åœ¨è¢«éœ€è¦æ—¶ï¼ˆå³å­˜åœ¨æœªè§£æçš„ç¬¦å·å¼•ç”¨ï¼‰æ‰ä¼šè¢«é“¾æ¥ã€‚è¿™æ„å‘³ç€å¦‚æœç”¨æˆ·çš„ç›®æ ‡æ–‡ä»¶å·²æ»¡è¶³ç¬¦å·éœ€æ±‚ï¼Œå³ä½¿é™æ€åº“ä¸­ä¹ŸåŒ…å«ç›¸åŒçš„å‡½æ•°å®ç°ï¼Œè¿™äº›å®ç°ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚ä¾‹å¦‚ï¼Œåœ¨ä»¥ä¸‹åœºæ™¯ä¸­ï¼š g++ -o myprogram main.cpp -L/path/to/lib -lmylib å¦‚æœ main.cpp ä¸­å·²ç»åŒ…å«äº†æ‰€æœ‰éœ€è¦çš„å‡½æ•°å®ç°ï¼Œåˆ™ libmylib.a ä¸­ç›¸åŒçš„å‡½æ•°å®ç°ä¸ä¼šè¢«ä½¿ç”¨ã€‚ ä¸åŒç±»å‹çš„åº“å¯¹é“¾æ¥çš„å½±å“é™æ€åº“ä¸åŠ¨æ€åº“çš„åŒºåˆ« é™æ€åº“ï¼šå¯¹äºé™æ€åº“ï¼ˆå¦‚ .a æˆ– .libï¼‰ï¼Œé“¾æ¥å™¨åœ¨è§£æç¬¦å·æ—¶ä¼šä¼˜å…ˆä½¿ç”¨ç›®æ ‡æ–‡ä»¶ï¼ˆå³ä½ çš„ .cpp æ–‡ä»¶ï¼‰ä¸­å·²å®šä¹‰çš„é‚£ä¸ªå®ç°ã€‚å¦‚æœ .cpp æ–‡ä»¶ä¸­çš„å®ç°å·²ç»è¢«ç¼–è¯‘è¿›æœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œé‚£ä¹ˆé™æ€åº“ä¸­çš„ç›¸åŒå®ç°å°±ä¸ä¼šè¢«ä½¿ç”¨ã€‚ åŠ¨æ€åº“ï¼šå¯¹äºåŠ¨æ€åº“ï¼ˆå¦‚ .so æˆ– .dllï¼‰ï¼Œç¼–è¯‘æ—¶é“¾æ¥å™¨å¹¶ä¸ä¼šç«‹å³è§£ææ‰€æœ‰ç¬¦å·ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åŠ è½½åŠ¨æ€åº“ã€‚å¦‚æœå¯æ‰§è¡Œæ–‡ä»¶å·²ç»åŒ…å«äº†è¯¥å‡½æ•°çš„å®ç°ï¼Œåˆ™é€šå¸¸ä¼šä½¿ç”¨è¿™ä¸ªå®ç°ï¼Œé™¤éé‡‡ç”¨äº†ç‰¹æ®Šçš„åŠ¨æ€åŠ è½½æˆ–è¦†ç›–æœºåˆ¶ï¼ˆä¾‹å¦‚ä½¿ç”¨ LD_PRELOAD åœ¨ Linux ç³»ç»Ÿä¸Šï¼‰ã€‚ ç¬¦å·çš„å¼ºå¼±å±æ€§åœ¨è®¸å¤šç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ä¸­ï¼Œç¬¦å·å¯ä»¥è¢«æ ‡è®°ä¸ºâ€œå¼ºâ€æˆ–â€œå¼±â€ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°ç¬¦å·éƒ½æ˜¯å¼ºç¬¦å·ã€‚ å¼ºç¬¦å·ä¼˜å…ˆï¼šå¦‚æœ .cpp æ–‡ä»¶ä¸­çš„å®ç°åœ¨ç¼–è¯‘åæˆä¸ºå¼ºç¬¦å·ï¼Œè€Œé™æ€æˆ–åŠ¨æ€åº“ä¸­çš„å®ç°åœ¨ç¼–è¯‘åæ˜¯å¼±ç¬¦å·ï¼Œåˆ™é“¾æ¥å™¨ä¼šä¼˜å…ˆé€‰æ‹©å¼ºç¬¦å·ï¼ˆå³ .cpp æ–‡ä»¶ä¸­çš„å®ç°ï¼‰ã€‚ä¾‹å¦‚ï¼Œåœ¨ GCC ç¼–è¯‘å™¨ä¸­å¯ä»¥é€šè¿‡ __attribute__((weak)) æ¥æ ‡è®°å¼±ç¬¦å·ã€‚ ä¸¤ä¸ªå¼ºç¬¦å·å†²çªï¼šå¦‚æœä¸¤ä¸ªå®ç°åœ¨ç¼–è¯‘åéƒ½æ˜¯å¼ºç¬¦å·ï¼Œåˆ™å¯èƒ½ä¼šåœ¨é“¾æ¥æ—¶äº§ç”Ÿé‡å¤å®šä¹‰é”™è¯¯ã€‚æ­¤æ—¶éœ€è¦é€šè¿‡è°ƒæ•´æºä»£ç æˆ–ä½¿ç”¨ç‰¹å®šçš„ç¼–è¯‘é€‰é¡¹æ¥è§£å†³å†²çªã€‚ å‘½åç©ºé—´ä¸åç§°ä¿®é¥°çš„å½±å“C++ çš„åç§°ä¿®é¥°æœºåˆ¶å¯ä»¥é¿å…ä¸åŒæºä»£ç ä¹‹é—´çš„å‘½åå†²çªã€‚ä¾‹å¦‚ï¼š namespace MyNamespace void myFunction() // å®ç°ç»†èŠ‚ ç”±äºåç§°ä¿®é¥°æœºåˆ¶çš„å­˜åœ¨ï¼Œåœ¨ä¸åŒçš„å‘½åç©ºé—´æˆ–æ²¡æœ‰ä½¿ç”¨ extern C çš„æƒ…å†µä¸‹ï¼Œå³ä½¿ä¸¤ä¸ªæºä»£ç ä¸­æœ‰ç›¸åŒçš„å‡½æ•°åä¹Ÿä¸ä¼šäº§ç”Ÿå†²çªã€‚ç„¶è€Œå¦‚æœæ˜¯ extern C çš„å‡½æ•°ï¼Œåˆ™ç”±äº C è¯­è¨€ä¸æ”¯æŒåç§°ä¿®é¥°æœºåˆ¶è€Œå¯¼è‡´ä¸¤ä¸ªå®ç°åœ¨æœ€ç»ˆç”Ÿæˆçš„ç›®æ ‡ä»£ç ä¸­æœ‰ç›¸åŒçš„åç§°ï¼Œå¹¶å¯èƒ½äº§ç”Ÿå†²çªã€‚ æ€»ç»“åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼š å½“ä½ çš„ .cpp æ–‡ä»¶ä¸­å·²ç»å®ç°äº†è¯¥å‡½æ•°ï¼Œå¹¶ä¸”ä½ æ­£åœ¨ä¸é™æ€åº“è¿›è¡Œå¸¸è§„è¿æ¥æ—¶ï¼Œè¿æ¥å™¨å°†ä¼˜å…ˆé€‰æ‹©ä½ çš„ .cpp æ–‡ä»¶ä¸­çš„å®æ–½ã€‚ å¦‚æœä½ æ­£åœ¨è¿æ¥åˆ°ä¸€ä¸ªåŠ¨æ€å…±äº«å¯¹è±¡ (DSO)ï¼Œå¹¶ä¸”ä½ çš„å¯æ‰§è¡Œç¨‹åºå·²ç»åŒ…å«äº†è¿™ä¸ªåŠŸèƒ½çš„ä¸€ä¸ªå®æ–½ç‰ˆæœ¬ï¼Œåˆ™é€šå¸¸ä¼šä½¿ç”¨è¿™ä¸ªå®æ–½ç‰ˆæœ¬ã€‚ å› æ­¤ï¼Œåœ¨è°ƒç”¨è¯¥åŠŸèƒ½æ—¶é€šå¸¸ä»¥ä½ çš„ .cpp æ–‡ä»¶ä¸­çš„å®æ–½ä¸ºå‡†ã€‚ å¯ä»¥é€šè¿‡ä½¿ç”¨å·¥å…·ï¼ˆå¦‚ Linux ä¸‹çš„ nm å‘½ä»¤æˆ– Windows ä¸‹çš„ dumpbinï¼‰æ£€æŸ¥ç¬¦å·è¡¨ï¼Œä»¥éªŒè¯é“¾æ¥å™¨æœ€ç»ˆä½¿ç”¨çš„æ˜¯å“ªä¸€ä¸ªå®ç°ã€‚","categories":["6.å¼€å‘å·¥å…·","ç¼–è¯‘é“¾æ¥"]},{"title":"å”¤é†’å±å¹•","path":"/2025/03/17/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-å”¤é†’å±å¹•/","content":"å±å¹•å”¤é†’ #change 0 to 4 to go to sleepecho 0 /sys/class/graphics/fb0/blank","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"Qt for Androidä¿®æ”¹åº”ç”¨ç¨‹åºçš„å›¾æ ‡å’Œåç§°","path":"/2025/03/13/3-å¼€å‘æ¡†æ¶-Qt-å…¶ä»–å¹³å°-Qt-for-Androidä¿®æ”¹åº”ç”¨ç¨‹åºçš„å›¾æ ‡å’Œåç§°/","content":"åœ¨ Qt é¡¹ç›®ä¸­æ›´æ”¹ Android åº”ç”¨çš„å›¾æ ‡ä»¥ä¸‹æ˜¯è¯¦ç»†æ­¥éª¤ï¼Œå¸®åŠ©æ‚¨åœ¨ Qt é¡¹ç›®ä¸­æ›´æ”¹ Android åº”ç”¨çš„å›¾æ ‡ã€‚ æ­¥éª¤ 1ï¼šç¼–è¯‘é¡¹ç›®å¹¶æ‰¾åˆ° AndroidManifest.xml æ‰“å¼€æ‚¨çš„ Qt é¡¹ç›®æ–‡ä»¶ï¼ˆ.pro æ–‡ä»¶ï¼‰åœ¨ Qt Creator ä¸­ã€‚ ç‚¹å‡» Qt Creator èœå•æ ä¸­çš„ Buildï¼Œé€‰æ‹© Rebuild project æˆ–æŒ‰ä¸‹ Ctrl + B è¿›è¡Œç¼–è¯‘ã€‚ ç¼–è¯‘å®Œæˆåï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª build æ–‡ä»¶å¤¹ï¼Œåç§°ç±»ä¼¼äº build-YourProject-Android_for_x86_GCC_4_9_Qt_5_5_0-Debugã€‚ æ‰“å¼€è¯¥ build æ–‡ä»¶å¤¹ï¼Œè¿›å…¥ android-build ç›®å½•ã€‚ åœ¨ android-build ç›®å½•ä¸­æ‰¾åˆ° AndroidManifest.xml æ–‡ä»¶ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°å‰ªè´´æ¿æˆ–å¦å­˜ä¸ºã€‚ æ­¥éª¤ 2ï¼šåˆ›å»º android_sources æ–‡ä»¶å¤¹å¹¶æ·»åŠ æ–‡ä»¶ åœ¨æ‚¨çš„ Qt é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ï¼Œå‘½åä¸º android_sourcesã€‚ å°†ä¹‹å‰å¤åˆ¶çš„ AndroidManifest.xml æ–‡ä»¶ç²˜è´´åˆ° android_sources æ–‡ä»¶å¤¹ä¸­ã€‚ ç¡®ä¿å°†æ‚¨çš„åº”ç”¨å›¾æ ‡æ–‡ä»¶ï¼ˆå¦‚ icon_low.pngã€icon_medium.png å’Œ icon_high.pngï¼‰ä¹Ÿæ”¾å…¥ android_sources æ–‡ä»¶å¤¹ä¸­ã€‚å›¾æ ‡æ–‡ä»¶åº”ä¸º PNG æ ¼å¼ï¼Œåˆ†åˆ«å¯¹åº”ä½ã€ä¸­ã€é«˜åˆ†è¾¨ç‡ã€‚ æ­¥éª¤ 3ï¼šå°† AndroidManifest.xml æ·»åŠ åˆ°é¡¹ç›®ä¸­ åœ¨ Qt Creator ä¸­ï¼Œå³é”®ç‚¹å‡»é¡¹ç›®åç§°ï¼Œåœ¨å¼¹å‡ºçš„èœå•ä¸­é€‰æ‹© **Add Existing Filesâ€¦**ã€‚ æµè§ˆåˆ° android_sources æ–‡ä»¶å¤¹ï¼Œé€‰æ‹© AndroidManifest.xml æ–‡ä»¶å¹¶æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚ æ·»åŠ åï¼ŒAndroidManifest.xml ä¼šå‡ºç°åœ¨é¡¹ç›®çš„ Other files éƒ¨åˆ†ã€‚ æ­¥éª¤ 4ï¼šè®¾ç½®åº”ç”¨å›¾æ ‡ åœ¨ Qt Creator ä¸­ï¼ŒåŒå‡» AndroidManifest.xml æ–‡ä»¶ä»¥æ‰“å¼€ Android æ¸…å•ç¼–è¾‘å™¨ã€‚ åœ¨ç¼–è¾‘å™¨ä¸­ï¼Œæ‰¾åˆ° Application icon éƒ¨åˆ†ã€‚ ç‚¹å‡»æ¯ä¸ªå›¾æ ‡ä½ç½®ï¼ˆä½ DPIã€ä¸­ DPIã€é«˜ DPIï¼‰ï¼Œåˆ†åˆ«é€‰æ‹©å¯¹åº”çš„å›¾æ ‡æ–‡ä»¶ï¼š Low DPI: é€‚ç”¨äºæ—§ç‰ˆ Android è®¾å¤‡ï¼Œæ¨èå¤§å°ä¸º 36x36 åƒç´ ã€‚ Medium DPI: é€‚ç”¨äºä¸­ç­‰å±å¹•åˆ†è¾¨ç‡ï¼Œæ¨èå¤§å°ä¸º 48x48 åƒç´ ã€‚ High DPI: é€‚ç”¨äºæ–°ç‰ˆè®¾å¤‡ï¼Œæ¨èå¤§å°ä¸º 72x72 åƒç´ ã€‚ ç¡®ä¿æ‰€æœ‰å›¾æ ‡æ–‡ä»¶å·²æ­£ç¡®è®¾ç½®ã€‚ æ­¥éª¤ 5ï¼šæ›´æ–° .pro æ–‡ä»¶ æ‰“å¼€æ‚¨çš„ Qt é¡¹ç›®æ–‡ä»¶ï¼ˆ.pro æ–‡ä»¶ï¼‰ã€‚ åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œï¼Œå‘Šè¯‰ Qt åŒ…å« Android èµ„æºæ–‡ä»¶çš„ç›®å½•ï¼š ANDROID_PACKAGE_SOURCE_DIR = $$PWD/android_sources ä¿å­˜æ›´æ”¹ã€‚ æ­¥éª¤ 6ï¼šé‡æ–°ç¼–è¯‘é¡¹ç›® å†æ¬¡ç‚¹å‡» Build Rebuild project æˆ–æŒ‰ä¸‹ Ctrl + Bã€‚ ç¼–è¯‘å®Œæˆåï¼Œç”Ÿæˆçš„ APK åŒ…å°†ä½¿ç”¨æ–°çš„å›¾æ ‡ã€‚ é¢å¤–æç¤ºï¼šæ›´æ”¹åº”ç”¨åç§° æ‰“å¼€ AndroidManifest.xml æ–‡ä»¶ã€‚ åœ¨ Application name å’Œ Activity name å­—æ®µä¸­è¾“å…¥æ–°çš„åç§°ã€‚ ä¿å­˜æ›´æ”¹å¹¶é‡æ–°ç¼–è¯‘é¡¹ç›®ã€‚","tags":["clippings"],"categories":["3.å¼€å‘æ¡†æ¶","Qt","å…¶ä»–å¹³å°"]},{"title":"Qt Android","path":"/2025/03/12/3-å¼€å‘æ¡†æ¶-Qt-å…¶ä»–å¹³å°-Qt-Android/","content":"å®‰è£… JDKä¸‹è½½åœ°å€ https://www.openlogic.com/openjdk-downloads å®‰è£… JDKï¼Œç‰ˆæœ¬è‡³å°‘ä¸º 1.6ã€‚å¯ä»¥ä» Oracle å®˜ç½‘è·å–ï¼Œæˆ–è€…åœ¨ Linux ä¸Šä½¿ç”¨ OpenJDKã€‚ apt-get install openjdk-8-jdk å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ 64 ä½ UbuntuDebianï¼Œå¯èƒ½è¿˜éœ€è¦å®‰è£… 32 ä½è¿è¡Œæ—¶ç¯å¢ƒï¼š apt-get install libc6-i386 å®‰è£… Android SDK å’Œ NDKåŸºäºè„šæœ¬çš„ Linux å®‰è£…ä»¥ä¸‹æ˜¯ Debian-based Linux ç³»ç»Ÿä¸Šæ‰€éœ€çš„è½¯ä»¶åŒ…ï¼š apt install build-essential default-jre openjdk-8-jdk-headless android-sdk android-sdk-platform-23 libc6-i386 ä»¥ä¸‹ bash è„šæœ¬å°†ä¸‹è½½ SDK å’Œ NDK ç‰ˆæœ¬ r19cã€‚è¯·åœ¨æ‚¨å¸Œæœ›å®‰è£…åˆ°çš„ç›®å½•ä¸­è¿è¡Œè¯¥è„šæœ¬ï¼Œä¾‹å¦‚ /home/username/android_toolsã€‚ é‡è¦æç¤ºï¼šè¯·ä»¥åç»­ä½¿ç”¨çš„ç”¨æˆ·èº«ä»½è¿è¡Œè¯¥è„šæœ¬ï¼ˆä¸è¦ä½¿ç”¨ sudoï¼‰ã€‚ #!/bin/bashndkVersion=r20bsdkBuildToolsVersion=28.0.3sdkApiLevel=android-28toolsVersion=r26.1.1repository=https://dl.google.com/android/repositorytoolsFile=sdk-tools-linux-4333796.ziptoolsFolder=android-sdk-toolsndkFile=android-ndk-$ndkVersion-linux-x86_64.zipndkFolder=android-ndk-$ndkVersionrm -rf $toolsFolderrm -rf $ndkFolderecho ä» $repository ä¸‹è½½SDKå·¥å…·wget -q $repository/$toolsFileunzip -qq $toolsFile -d $toolsFolderecho ä» $repository ä¸‹è½½NDKwget -q $repository/$ndkFileunzip -qq $ndkFilerm $toolsFilerm $ndkFileecho é…ç½®ç¯å¢ƒexport JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64export PATH=$PATH:$JAVA_HOME/bin# å¯¹äºæŸäº›JDK/JREç‰ˆæœ¬çš„å¯é€‰è§£å†³æ–¹æ¡ˆ#cp $toolsFolder/tools/bin/sdkmanager $toolsFolder/tools/bin/sdkmanager.backup#sed -i s/^DEFAULT_JVM_OPTS.*/DEFAULT_JVM_OPTS=\\-Dcom.android.sdklib.toolsdir=\\$APP_HOME\\ -XX:+IgnoreUnrecognizedVMOptions --add-modules java.se.ee/ \\# $toolsFolder/tools/bin/sdkmanagerecho å®‰è£…SDKåŒ…cd $toolsFolder/tools/binecho y | ./sdkmanager platforms;$sdkApiLevel platform-tools build-tools;$sdkBuildToolsVersion sdkmanager.logecho y | ./sdkmanager --install emulator sdkmanager.logecho y | ./sdkmanager --install system-images;android-21;google_apis;x86 sdkmanager.logecho no | ./avdmanager create avd -n x86emulator -k system-images;android-21;google_apis;x86 -c 2048M -f sdkmanager.logecho é…ç½®å®Œæˆã€‚ä»¥ä¸‹æ˜¯åŒ…å’ŒAVDè®¾å¤‡çš„åˆ—è¡¨ï¼š./sdkmanager --list./avdmanager list avd åŸºäºè„šæœ¬çš„ Windows å®‰è£…å¾…æµ‹è¯•æ•´ç† @echo offset ndkVersion=r20bset sdkBuildToolsVersion=28.0.3set sdkApiLevel=android-28set toolsVersion=r26.1.1set repository=https://dl.google.com/android/repositoryset toolsFile=sdk-tools-windows-4333796.zipset toolsFolder=android-sdk-toolsset ndkFile=android-ndk-%ndkVersion%-windows-x86_64.zipset ndkFolder=android-ndk-%ndkVersion%rem åˆ é™¤SDKå·¥å…·å’ŒNDKæ–‡ä»¶å¤¹rd /s /q %toolsFolder% 2nulrd /s /q %ndkFolder% 2nulecho ä» %repository% ä¸‹è½½SDKå·¥å…·powershell -Command (New-Object Net.WebClient).DownloadFile(%repository%/%toolsFile%, %toolsFile%)echo è§£å‹SDKå·¥å…·powershell -Command Expand-Archive -Path %toolsFile% -DestinationPath %toolsFolder% -Forceecho ä» %repository% ä¸‹è½½NDKpowershell -Command (New-Object Net.WebClient).DownloadFile(%repository%/%ndkFile%, %ndkFile%)echo è§£å‹NDKpowershell -Command Expand-Archive -Path %ndkFile% -DestinationPath . -Forcerem åˆ é™¤ä¸‹è½½çš„å‹ç¼©åŒ…del %toolsFile%del %ndkFile%echo é…ç½®ç¯å¢ƒset JAVA_HOME=C:\\Program Files\\Java\\jdk1.8.0_271set PATH=%PATH%;%JAVA_HOME%\\binrem å®‰è£…SDKåŒ…cd %toolsFolder%\\tools\\binecho å®‰è£…å¹³å°ã€å¹³å°å·¥å…·å’Œæ„å»ºå·¥å…·echo y | sdkmanager platforms;%sdkApiLevel% platform-tools build-tools;%sdkBuildToolsVersion% sdkmanager.logecho å®‰è£…æ¨¡æ‹Ÿå™¨echo y | sdkmanager --install emulator sdkmanager.logecho å®‰è£…ç³»ç»Ÿé•œåƒecho y | sdkmanager --install system-images;android-21;google_apis;x86 sdkmanager.logecho åˆ›å»ºAVDè®¾å¤‡echo no | avdmanager create avd -n x86emulator -k system-images;android-21;google_apis;x86 -c 2048M -f sdkmanager.logecho é…ç½®å®Œæˆã€‚ä»¥ä¸‹æ˜¯åŒ…å’ŒAVDè®¾å¤‡çš„åˆ—è¡¨ï¼šsdkmanager --listavdmanager list avd é…ç½® Qt Creator è¿›å…¥ Tools - Options - Devices - Androidï¼Œå¹¶è®¾ç½®æ­£ç¡®çš„ Javaã€Android SDK å’Œ NDK ç­‰è·¯å¾„ã€‚ä¾‹å¦‚ï¼š JDK ä½ç½®ï¼š/usr/lib/jvm/java-8-openjdk-amd64 Android SDK ä½ç½®ï¼š/home/johnsmith/dev/android-sdk-tools Android NDK ä½ç½®ï¼š/home/johnsmith/dev/android-ndk-r19c åœ¨ Tools - Options - Kits - Qt Versions ä¸­æ·»åŠ æ–°æ„å»ºçš„ Qt ç‰ˆæœ¬ã€‚ ä½¿ç”¨è¯¥ Qt ç‰ˆæœ¬åœ¨ Tools - Options - Kits - Kits ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„ kitï¼ˆæˆ–å…‹éš†ä¸€ä¸ªç°æœ‰çš„é¢„æ„å»º Qt for Android kit å¹¶ä»…æ›´æ”¹ Qt ç‰ˆæœ¬ï¼‰ã€‚ æ­¤æ—¶ï¼Œä½ åº”è¯¥èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªé¡¹ç›®å¹¶ä¸º Android kit é…ç½®å®ƒã€‚ä¸ºäº†æµ‹è¯•ï¼Œè¿›å…¥é¡¹ç›®çš„ Run è®¾ç½®ã€‚åœ¨ Deploy Configuration ä¸‹ï¼Œé€‰ä¸­ Use Qt libraries from the local device é€‰é¡¹ã€‚åŒæ—¶ï¼Œé€‰æ‹© Deploy local Qt libraries radio buttonã€‚","tags":["clippings"],"categories":["3.å¼€å‘æ¡†æ¶","Qt","å…¶ä»–å¹³å°"]},{"title":"Qt Android Linuxç¯å¢ƒé…ç½®","path":"/2025/03/08/3-å¼€å‘æ¡†æ¶-Qt-å…¶ä»–å¹³å°-Qt-Android-Linuxç¯å¢ƒé…ç½®/","content":"ä¸‹è½½ JDK #wget https://download.oracle.com/java/21/latest/jdk-21_linux-x64_bin.tar.gzsudo apt-get install openjdk-8-jdkjava -versionsudo update-alternatives --set java /usr/bin/java ä¸‹è½½ SDK ä¸‹è½½ NDK wget https://dl.google.com/android/repository/android-ndk-r21e-linux-x86_64.zipwget https://dl.google.com/android/repository/android-ndk-r20b-linux-x86_64.zip ä¸‹è½½ open-ssl git clone https://github.com/KDAB/android_openssl.git","categories":["3.å¼€å‘æ¡†æ¶","Qt","å…¶ä»–å¹³å°"]},{"title":"è¿›ç¨‹ä¸Šä¸‹æ–‡","path":"/2025/03/07/1-å¹³å°ç³»ç»Ÿ-Linux-è¿›ç¨‹çº¿ç¨‹-è¿›ç¨‹ä¸Šä¸‹æ–‡/","content":"ä¸Šä¸‹æ–‡ã€è¿›ç¨‹ä¸Šä¸‹æ–‡ã€ä¸­æ–­ä¸Šä¸‹æ–‡ä¸åŸå­ä¸Šä¸‹æ–‡è¯¦è§£ä¸Šä¸‹æ–‡çš„åŸºæœ¬æ¦‚å¿µä¸Šä¸‹æ–‡æ˜¯ä»è‹±æ–‡â€œcontextâ€ç¿»è¯‘è€Œæ¥ï¼Œæ„ä¸ºâ€œç¯å¢ƒâ€ã€‚åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œç‰¹åˆ«æ˜¯æ“ä½œç³»ç»Ÿé¢†åŸŸï¼ŒæŒ‡çš„æ˜¯ç¨‹åºæˆ–è¿›ç¨‹åœ¨æ‰§è¡Œæ—¶æ‰€å¤„çš„ç¯å¢ƒã€‚å…·ä½“æ¥è¯´ï¼Œè¿›ç¨‹çš„ä¸Šä¸‹æ–‡åŒ…æ‹¬ï¼š å¯„å­˜å™¨å˜é‡ï¼šCPU å¯„å­˜å™¨ä¸­çš„å€¼ï¼Œå¦‚ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰ã€æ ˆæŒ‡é’ˆï¼ˆSPï¼‰ç­‰ã€‚ å†…å­˜ä¿¡æ¯ï¼šè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ŒåŒ…æ‹¬ä»£ç æ®µã€æ•°æ®æ®µã€å †æ ˆæ®µç­‰ã€‚ ç³»ç»Ÿèµ„æºï¼šè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ã€ä¿¡å·é‡ã€ç®¡é“ç­‰ã€‚ è¿›ç¨‹çŠ¶æ€ï¼šå°±ç»ªã€è¿è¡Œã€é˜»å¡ã€ç»ˆæ­¢ç­‰çŠ¶æ€ä¿¡æ¯ã€‚ ä¸Šä¸‹æ–‡çš„æ¦‚å¿µæ˜¯æ“ä½œç³»ç»Ÿå®ç°è¿›ç¨‹åˆ‡æ¢å’Œå†…æ ¸æ€ç”¨æˆ·æ€åˆ‡æ¢çš„åŸºç¡€ã€‚ åŸå­æ“ä½œçš„æ¦‚å¿µåŸå­ï¼ˆatomï¼‰æœ¬æ„æ˜¯â€œä¸å¯åˆ†å‰²çš„æœ€å°ç²’å­â€ï¼Œè€ŒåŸå­æ“ä½œï¼ˆatomic operationï¼‰åˆ™æŒ‡â€œä¸å¯è¢«ä¸­æ–­çš„ä¸€ä¸ªæˆ–ä¸€ç³»åˆ—æ“ä½œâ€ã€‚åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒåŸå­æ“ä½œç¡®ä¿åœ¨å¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹ç¯å¢ƒä¸­ï¼Œå…³é”®ä»£ç æ®µåªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹æ‰§è¡Œï¼Œé˜²æ­¢æ•°æ®ä¸ä¸€è‡´æˆ–ç«æ€æ¡ä»¶ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªé€’å¢æ“ä½œï¼ˆi++ï¼‰åœ¨æ±‡ç¼–å±‚é¢é€šå¸¸åˆ†ä¸ºè¯»å–ã€åŠ ä¸€ã€å†™å›ä¸‰ä¸ªæ­¥éª¤ã€‚å¦‚æœåœ¨è¯»å–å’Œå†™å›ä¹‹é—´è¢«ä¸­æ–­ï¼Œå¯èƒ½å¯¼è‡´å¤šä¸ªè¿›ç¨‹è¯»å–åˆ°ç›¸åŒçš„å€¼ï¼Œå¯¼è‡´æœ€ç»ˆç»“æœä¸æ­£ç¡®ã€‚é€šè¿‡åŸå­æ“ä½œï¼Œå¯ä»¥ç¡®ä¿è¿™ä¸‰ä¸ªæ­¥éª¤ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œï¼Œé¿å…ç«æ€æ¡ä»¶ã€‚ ä¸ºä»€ä¹ˆä¼šæœ‰ä¸Šä¸‹æ–‡çš„æ¦‚å¿µï¼Ÿç°ä»£æ“ä½œç³»ç»Ÿçš„ä¸¤ç§ä¸»è¦è¿è¡Œæ¨¡å¼æ˜¯å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ï¼š å†…æ ¸ç©ºé—´ï¼šå†…æ ¸æ¨¡å—è¿è¡Œåœ¨å†…æ ¸ç©ºé—´ï¼Œå…·æœ‰æœ€é«˜æƒé™ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ç¡¬ä»¶èµ„æºã€‚ ç”¨æˆ·ç©ºé—´ï¼šç”¨æˆ·æ€åº”ç”¨ç¨‹åºè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´ï¼Œæƒé™è¾ƒä½ï¼Œæ— æ³•ç›´æ¥è®¿é—®ç¡¬ä»¶èµ„æºã€‚ å½“ç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºéœ€è¦è®¿é—®ç¡¬ä»¶èµ„æºï¼ˆå¦‚è¯»å†™æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ï¼‰æ—¶ï¼Œå¿…é¡»é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›å…¥å†…æ ¸ç©ºé—´ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š ç”¨æˆ·æ€åˆ°å†…æ ¸æ€ï¼šåˆ‡æ¢åˆ°å†…æ ¸ç©ºé—´ï¼Œä½¿ç”¨å†…æ ¸çš„åœ°å€ç©ºé—´å’Œå¯„å­˜å™¨ã€‚ å†…æ ¸æ€åˆ°ç”¨æˆ·æ€ï¼šç³»ç»Ÿè°ƒç”¨å®Œæˆåï¼Œåˆ‡æ¢å›ç”¨æˆ·ç©ºé—´ï¼Œæ¢å¤åŸè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ã€‚ è¿›ç¨‹ä¸Šä¸‹æ–‡è¿›ç¨‹ä¸Šä¸‹æ–‡æ˜¯è¿›ç¨‹æ‰§è¡Œæ—¶çš„ç¯å¢ƒï¼ŒåŒ…æ‹¬ï¼š ç”¨æˆ·çº§ä¸Šä¸‹æ–‡ï¼š ä»£ç æ®µï¼ˆtextï¼‰ æ•°æ®æ®µï¼ˆdataï¼‰ ç”¨æˆ·å †æ ˆï¼ˆuser stackï¼‰ å…±äº«å­˜å‚¨åŒºï¼ˆshared memoryï¼‰ å¯„å­˜å™¨ä¸Šä¸‹æ–‡ï¼š é€šç”¨å¯„å­˜å™¨ï¼ˆå¦‚ EAXã€EBXï¼‰ ç¨‹åºè®¡æ•°å™¨ï¼ˆEIPï¼‰ çŠ¶æ€å¯„å­˜å™¨ï¼ˆEFLAGSï¼‰ æ ˆæŒ‡é’ˆï¼ˆESPï¼‰ ç³»ç»Ÿçº§ä¸Šä¸‹æ–‡ï¼š è¿›ç¨‹æ§åˆ¶å—ï¼ˆtask_structï¼‰ å†…å­˜ç®¡ç†ä¿¡æ¯ï¼ˆmm_structã€vm_area_structã€pgdã€pteï¼‰ å†…æ ¸æ ˆï¼ˆkernel stackï¼‰ å½“æ“ä½œç³»ç»Ÿéœ€è¦åˆ‡æ¢è¿›ç¨‹æ—¶ï¼Œå¿…é¡»ä¿å­˜å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶æ¢å¤ä¸‹ä¸€ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ã€‚è¿™ä¸€è¿‡ç¨‹ç§°ä¸ºè¿›ç¨‹åˆ‡æ¢æˆ–ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ ç¤ºä¾‹ï¼šå‡è®¾è¿›ç¨‹ A æ­£åœ¨è¿è¡Œï¼Œè°ƒåº¦å™¨å†³å®šåˆ‡æ¢åˆ°è¿›ç¨‹ Bã€‚æ“ä½œç³»ç»Ÿä¼šä¿å­˜è¿›ç¨‹ A çš„å¯„å­˜å™¨å€¼ã€å†…å­˜æ˜ å°„ç­‰ä¿¡æ¯ï¼Œå¹¶åŠ è½½è¿›ç¨‹ B çš„ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œè¿›ç¨‹ Bã€‚ ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­æ–­ä¸Šä¸‹æ–‡æ˜¯ç¡¬ä»¶é€šè¿‡ä¸­æ–­ä¿¡å·è§¦å‘ï¼Œå¯¼è‡´å†…æ ¸è°ƒç”¨ä¸­æ–­å¤„ç†ç¨‹åºè¿›å…¥å†…æ ¸ç©ºé—´çš„ç¯å¢ƒã€‚ä¸­æ–­ä¸Šä¸‹æ–‡ä¸»è¦åŒ…æ‹¬ï¼š ç¡¬ä»¶ä¼ é€’çš„å‚æ•°ï¼ˆå¦‚ä¸­æ–­å·ã€é”™è¯¯ç ï¼‰ è¢«ä¸­æ–­è¿›ç¨‹çš„ç¯å¢ƒï¼ˆå¦‚å¯„å­˜å™¨å€¼ï¼‰ ä¸­æ–­å¤„ç†ç¨‹åºé€šå¸¸åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œè¿™ç§ä¸Šä¸‹æ–‡ä¸ä»»ä½•è¿›ç¨‹æ— å…³ã€‚ä¸­æ–­å¤„ç†ç¨‹åºçš„ä¸»è¦ä»»åŠ¡æ˜¯å¤„ç†ç¡¬ä»¶äº‹ä»¶ï¼ˆå¦‚é”®ç›˜æŒ‰é”®ã€ç£ç›˜å®Œæˆï¼‰ï¼Œå¹¶å¯èƒ½å”¤é†’ç­‰å¾…è¯¥äº‹ä»¶çš„è¿›ç¨‹ã€‚ ç¤ºä¾‹ï¼šè¿›ç¨‹ A ç­‰å¾…ç£ç›˜è¯»å–å®Œæˆï¼Œè¿›å…¥ç¡çœ çŠ¶æ€ã€‚ç£ç›˜å®Œæˆè¯»å–åï¼Œç¡¬ä»¶è§¦å‘ä¸­æ–­ï¼Œä¸­æ–­å¤„ç†ç¨‹åºå”¤é†’è¿›ç¨‹ Aã€‚ è¿›ç¨‹ä¸Šä¸‹æ–‡ VS ä¸­æ–­ä¸Šä¸‹æ–‡ ç‰¹æ€§ è¿›ç¨‹ä¸Šä¸‹æ–‡ ä¸­æ–­ä¸Šä¸‹æ–‡ è§¦å‘æ–¹å¼ è¿›ç¨‹è°ƒåº¦æˆ–ç³»ç»Ÿè°ƒç”¨ ç¡¬ä»¶ä¸­æ–­ä¿¡å· ä¸Šä¸‹æ–‡åˆ‡æ¢ éœ€è¦ä¿å­˜å’Œæ¢å¤è¿›ç¨‹çš„æ‰€æœ‰çŠ¶æ€ åªéœ€è¦ä¿å­˜æ¢å¤å¯„å­˜å™¨ å¯æŠ¢å æ€§ å¯ä»¥è¢«å…¶ä»–è¿›ç¨‹æŠ¢å  ä¸å¯è¢«ä¸­æ–­ï¼Œç›´åˆ°å¤„ç†å®Œæˆ è®¿é—®ç”¨æˆ·ç©ºé—´ å…è®¸ ä¸å…è®¸ ç¡çœ  å…è®¸ ä¸å…è®¸ ä¸è¿›ç¨‹å…³è” ä¸ç‰¹å®šè¿›ç¨‹ç›¸å…³ ä¸ç¡¬ä»¶äº‹ä»¶ç›¸å…³ï¼Œä¸ä¾èµ–è¿›ç¨‹ åŸå­ä¸Šä¸‹æ–‡åŸå­ä¸Šä¸‹æ–‡æ˜¯æŒ‡å†…æ ¸å¤„äºä¸å¯ä¸­æ–­ã€ä¸å¯æŠ¢å çš„çŠ¶æ€ï¼Œé€šå¸¸å‡ºç°åœ¨ä»¥ä¸‹æƒ…å†µï¼š ç¡¬ä¸­æ–­å¤„ç†ï¼šä¸­æ–­å¤„ç†ç¨‹åºæ‰§è¡Œæ—¶ï¼ŒCPU æ— æ³•è¢«å…¶ä»–ä¸­æ–­æ‰“æ–­ã€‚ è½¯ä¸­æ–­å¤„ç†ï¼šå¤„ç†å†…æ ¸çš„ä¸€äº›å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚ç½‘ç»œæ•°æ®å¤„ç†ï¼‰ã€‚ æŒæœ‰è‡ªæ—‹é”ï¼šè‡ªæ—‹é”å ç”¨æ—¶ï¼Œå†…æ ¸ç¦æ­¢æŠ¢å ã€‚ åœ¨åŸå­ä¸Šä¸‹æ–‡ä¸­ï¼Œå†…æ ¸ä¸èƒ½ï¼š è®¿é—®ç”¨æˆ·ç©ºé—´è™šæ‹Ÿå†…å­˜ï¼šå› ä¸ºæ²¡æœ‰å…³è”çš„è¿›ç¨‹ä¸Šä¸‹æ–‡ã€‚ è¿›å…¥ç¡çœ çŠ¶æ€ï¼šä¼šå¯¼è‡´ç³»ç»Ÿæ— æ³•å”¤é†’ã€‚ å ç”¨äº’æ–¥ä½“ï¼šå¯èƒ½å¯¼è‡´æ­»é”ã€‚ æ‰§è¡Œè€—æ—¶ä»»åŠ¡ï¼šä¼šå½±å“ç³»ç»Ÿå®æ—¶æ€§ã€‚ ç¤ºä¾‹ï¼šåœ¨ä¸­æ–­å¤„ç†ç¨‹åºä¸­ï¼Œä¸èƒ½è°ƒç”¨ sleep() å‡½æ•°ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚ åŸå­ä¸Šä¸‹æ–‡çš„åˆ¤æ–­å†…æ ¸æä¾›äº†å››ä¸ªå®æ¥åˆ¤æ–­æ˜¯å¦å¤„äºåŸå­ä¸Šä¸‹æ–‡ï¼š in_irq()ï¼šåˆ¤æ–­æ˜¯å¦åœ¨ç¡¬ä¸­æ–­å¤„ç†ä¸­ã€‚ in_softirq()ï¼šåˆ¤æ–­æ˜¯å¦åœ¨è½¯ä¸­æ–­å¤„ç†ä¸­ã€‚ in_interrupt()ï¼šåˆ¤æ–­æ˜¯å¦åœ¨ç¡¬ä¸­æ–­æˆ–è½¯ä¸­æ–­å¤„ç†ä¸­ã€‚ in_atomic()ï¼šåˆ¤æ–­æ˜¯å¦åœ¨åŸå­ä¸Šä¸‹æ–‡ä¸­ï¼ˆåŒ…æ‹¬ç¡¬ä¸­æ–­ã€è½¯ä¸­æ–­æˆ–æŒæœ‰è‡ªæ—‹é”ï¼‰ã€‚ è¿™äº›å®é€šè¿‡æ£€æŸ¥ thread_info-preempt_count çš„å€¼æ¥åˆ¤æ–­ä¸Šä¸‹æ–‡çŠ¶æ€ã€‚preempt_count æ˜¯ä¸€ä¸ªä½æ©ç ï¼Œè®°å½•äº†ç³»ç»Ÿçš„æŠ¢å çŠ¶æ€ã€‚ æ€»ç»“ ä¸Šä¸‹æ–‡æ˜¯æ“ä½œç³»ç»Ÿå®ç°è¿›ç¨‹åˆ‡æ¢å’Œå†…æ ¸æ€ç”¨æˆ·æ€åˆ‡æ¢çš„åŸºç¡€ã€‚ è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸ç‰¹å®šè¿›ç¨‹ç›¸å…³ï¼Œç”¨äºè¿›ç¨‹åˆ‡æ¢ã€‚ ä¸­æ–­ä¸Šä¸‹æ–‡ä¸ç¡¬ä»¶äº‹ä»¶ç›¸å…³ï¼Œç”¨äºå¤„ç†ä¸­æ–­ã€‚ åŸå­ä¸Šä¸‹æ–‡æ˜¯ä¸å¯ä¸­æ–­ã€ä¸å¯æŠ¢å çš„çŠ¶æ€ï¼Œé€šå¸¸å‡ºç°åœ¨ä¸­æ–­å¤„ç†æˆ–æŒæœ‰è‡ªæ—‹é”æ—¶ã€‚ ç†è§£è¿™äº›æ¦‚å¿µæœ‰åŠ©äºæŒæ¡æ“ä½œç³»ç»Ÿçš„å†…æ ¸æœºåˆ¶ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¹¶å‘ã€åŒæ­¥å’Œä¸­æ–­æ—¶ã€‚ è°ˆè®ºè¿›ç¨‹ä¸Šä¸‹æ–‡ ã€ä¸­æ–­ä¸Šä¸‹æ–‡ ã€ åŸå­ä¸Šä¸‹æ–‡ä¹‹å‰ï¼Œæœ‰å¿…è¦è®¨è®ºä¸‹ä¸¤ä¸ªæ¦‚å¿µï¼š a â€“ ä¸Šä¸‹æ–‡ ä¸Šä¸‹æ–‡æ˜¯ä»è‹±æ–‡ context ç¿»è¯‘è¿‡æ¥ï¼ŒæŒ‡çš„æ˜¯ä¸€ç§ç¯å¢ƒã€‚ç›¸å¯¹äºè¿›ç¨‹è€Œè¨€ï¼Œå°±æ˜¯è¿›ç¨‹æ‰§è¡Œæ—¶çš„ç¯å¢ƒï¼› å…·ä½“æ¥è¯´å°±æ˜¯å„ä¸ªå˜é‡å’Œæ•°æ®ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„å¯„å­˜å™¨å˜é‡ã€è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ã€å†…å­˜ä¿¡æ¯ç­‰ã€‚ b â€“ åŸå­ åŸå­ï¼ˆatomï¼‰æœ¬æ„æ˜¯â€œä¸èƒ½è¢«è¿›ä¸€æ­¥åˆ†å‰²çš„æœ€å°ç²’å­â€ï¼Œè€ŒåŸå­æ“ä½œï¼ˆatomic operationï¼‰æ„ ä¸ºâ€ä¸å¯è¢«ä¸­æ–­çš„ä¸€ä¸ªæˆ–ä¸€ç³»åˆ—æ“ä½œâ€ ï¼› ä¸€ã€ä¸ºä»€ä¹ˆä¼šæœ‰ä¸Šä¸‹æ–‡è¿™ç§æ¦‚å¿µ å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´æ˜¯ç°ä»£æ“ä½œç³»ç»Ÿçš„ä¸¤ç§å·¥ä½œæ¨¡å¼ï¼Œå†…æ ¸æ¨¡å—è¿è¡Œåœ¨å†…æ ¸ç©ºé—´ï¼Œè€Œç”¨æˆ·æ€åº”ç”¨ ç¨‹åºè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´ã€‚å®ƒä»¬ä»£è¡¨ä¸åŒçš„çº§åˆ«ï¼Œè€Œå¯¹ç³»ç»Ÿèµ„æºå…·æœ‰ä¸åŒçš„è®¿é—®æƒé™ã€‚å†…æ ¸æ¨¡å—è¿è¡Œåœ¨æœ€ é«˜çº§åˆ«ï¼ˆå†…æ ¸æ€ï¼‰ï¼Œè¿™ä¸ªçº§ä¸‹æ‰€æœ‰çš„æ“ä½œéƒ½å—ç³»ç»Ÿä¿¡ä»»ï¼Œè€Œåº”ç”¨ç¨‹åºè¿è¡Œåœ¨è¾ƒä½çº§åˆ«ï¼ˆç”¨æˆ·æ€ï¼‰ã€‚åœ¨ è¿™ä¸ªçº§åˆ«ï¼Œå¤„ç†å™¨æ§åˆ¶ç€å¯¹ç¡¬ä»¶çš„ç›´æ¥è®¿é—®ä»¥åŠå¯¹å†…å­˜çš„éæˆæƒè®¿é—®ã€‚å†…æ ¸æ€å’Œç”¨æˆ·æ€æœ‰è‡ªå·±çš„å†…å­˜ æ˜ å°„ï¼Œå³è‡ªå·±çš„åœ°å€ç©ºé—´ã€‚ å…¶ä¸­å¤„ç†å™¨æ€»å¤„äºä»¥ä¸‹çŠ¶æ€ä¸­çš„ä¸€ç§ï¼š å†…æ ¸æ€ï¼Œè¿è¡Œäºè¿›ç¨‹ä¸Šä¸‹æ–‡ï¼Œå†…æ ¸ä»£è¡¨è¿›ç¨‹è¿è¡Œäºå†…æ ¸ç©ºé—´ï¼› å†…æ ¸æ€ï¼Œè¿è¡Œäºä¸­æ–­ä¸Šä¸‹æ–‡ï¼Œå†…æ ¸ä»£è¡¨ç¡¬ä»¶è¿è¡Œäºå†…æ ¸ç©ºé—´ï¼› ç”¨æˆ·æ€ï¼Œè¿è¡Œäºç”¨æˆ·ç©ºé—´ã€‚ ç³»ç»Ÿçš„ä¸¤ç§ä¸åŒè¿è¡ŒçŠ¶æ€ï¼Œæ‰æœ‰äº†ä¸Šä¸‹æ–‡çš„æ¦‚å¿µã€‚ç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºï¼Œå¦‚æœæƒ³è¯·æ±‚ç³»ç»ŸæœåŠ¡ï¼Œæ¯”å¦‚ æ“ä½œæŸä¸ªç‰©ç†è®¾å¤‡ï¼Œæ˜ å°„è®¾å¤‡çš„åœ°å€åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¿…é¡»é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥å®ç°ã€‚ï¼ˆç³»ç»Ÿè°ƒç”¨æ˜¯æ“ä½œç³»ç»Ÿ æä¾›ç»™ç”¨æˆ·ç©ºé—´çš„æ¥å£å‡½æ•°ï¼‰ã€‚ é€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºå°±ä¼šè¿›å…¥å†…æ ¸ç©ºé—´ï¼Œç”±å†…æ ¸ä»£è¡¨è¯¥è¿›ç¨‹è¿è¡Œäºå†…æ ¸ç©ºé—´ï¼Œè¿™ å°±æ¶‰åŠåˆ°ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼Œç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´å…·æœ‰ä¸åŒçš„ åœ°å€æ˜ å°„ï¼Œé€šç”¨æˆ–ä¸“ç”¨çš„å¯„å­˜å™¨ç»„ï¼Œè€Œç”¨æˆ· ç©ºé—´çš„è¿›ç¨‹è¦ä¼ é€’å¾ˆå¤šå˜é‡ã€å‚æ•°ç»™å†…æ ¸ï¼Œå†…æ ¸ä¹Ÿè¦ä¿å­˜ç”¨æˆ·è¿›ç¨‹çš„ä¸€äº›å¯„å­˜å™¨ã€å˜é‡ç­‰ï¼Œä»¥ä¾¿ç³»ç»Ÿ è°ƒç”¨ç»“æŸåå›åˆ°ç”¨æˆ· ç©ºé—´ç»§ç»­æ‰§è¡Œï¼Œ äºŒã€è¿›ç¨‹ä¸Šä¸‹æ–‡ æ‰€è°“çš„è¿›ç¨‹ä¸Šä¸‹æ–‡ï¼Œå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼ŒCPU çš„æ‰€æœ‰å¯„å­˜å™¨ä¸­çš„å€¼ã€è¿›ç¨‹çš„çŠ¶æ€ä»¥åŠå † æ ˆä¸Šçš„å†…å®¹ï¼Œå½“å†…æ ¸éœ€è¦åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œå®ƒ éœ€è¦ä¿å­˜å½“å‰è¿›ç¨‹çš„æ‰€æœ‰çŠ¶æ€ï¼Œå³ä¿å­˜å½“å‰è¿›ç¨‹çš„ è¿›ç¨‹ä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿å†æ¬¡æ‰§è¡Œè¯¥è¿›ç¨‹æ—¶ï¼Œèƒ½å¤Ÿæ¢å¤åˆ‡æ¢æ—¶çš„çŠ¶æ€ï¼Œç»§ç»­æ‰§è¡Œã€‚ ä¸€ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:ç”¨æˆ·çº§ä¸Šä¸‹æ–‡ã€å¯„å­˜å™¨ä¸Šä¸‹æ–‡ä»¥åŠç³»ç»Ÿçº§ä¸Šä¸‹æ–‡ã€‚ ç”¨æˆ·çº§ä¸Šä¸‹æ–‡: æ­£æ–‡ã€æ•°æ®ã€ç”¨æˆ·å †æ ˆä»¥åŠå…±äº«å­˜å‚¨åŒºï¼› å¯„å­˜å™¨ä¸Šä¸‹æ–‡: é€šç”¨å¯„å­˜å™¨ã€ç¨‹åºå¯„å­˜å™¨(IP)ã€å¤„ç†å™¨çŠ¶æ€å¯„å­˜å™¨(EFLAGS)ã€æ ˆæŒ‡é’ˆ(ESP)ï¼› ç³»ç»Ÿçº§ä¸Šä¸‹æ–‡: è¿›ç¨‹æ§åˆ¶å— task_structã€å†…å­˜ç®¡ç†ä¿¡æ¯(mm_structã€vm_area_structã€pgdã€ pte)ã€å†…æ ¸æ ˆã€‚ å½“å‘ç”Ÿè¿›ç¨‹è°ƒåº¦æ—¶ï¼Œè¿›è¡Œè¿›ç¨‹åˆ‡æ¢å°±æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢(context switch)ã€‚ æ“ä½œç³»ç»Ÿå¿…é¡»å¯¹ä¸Šé¢æåˆ°çš„å…¨éƒ¨ä¿¡æ¯è¿›è¡Œåˆ‡æ¢ï¼Œæ–°è°ƒåº¦çš„è¿›ç¨‹æ‰èƒ½è¿è¡Œã€‚è€Œç³»ç»Ÿè°ƒç”¨è¿›è¡Œçš„æ˜¯æ¨¡ å¼åˆ‡æ¢(mode switch)ã€‚æ¨¡å¼åˆ‡æ¢ä¸è¿›ç¨‹åˆ‡æ¢æ¯”è¾ƒèµ·æ¥ï¼Œå®¹æ˜“å¾ˆå¤šï¼Œè€Œä¸”èŠ‚çœæ—¶é—´ï¼Œå› ä¸ºæ¨¡å¼åˆ‡æ¢æœ€ ä¸»è¦çš„ä»»åŠ¡åªæ˜¯åˆ‡æ¢è¿›ç¨‹å¯„å­˜å™¨ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ã€‚ è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸»è¦æ˜¯å¼‚å¸¸å¤„ç†ç¨‹åºå’Œå†…æ ¸çº¿ç¨‹ã€‚å†…æ ¸ä¹‹æ‰€ä»¥è¿›å…¥è¿›ç¨‹ä¸Šä¸‹æ–‡æ˜¯å› ä¸ºè¿›ç¨‹è‡ªèº«çš„ä¸€äº› å·¥ä½œéœ€è¦åœ¨å†…æ ¸ä¸­åšã€‚ä¾‹å¦‚ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯ä¸ºå½“å‰è¿›ç¨‹æœåŠ¡çš„ï¼Œå¼‚å¸¸é€šå¸¸æ˜¯å¤„ç†è¿›ç¨‹å¯¼è‡´çš„é”™è¯¯çŠ¶æ€ ç­‰ã€‚æ‰€ä»¥åœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­å¼•ç”¨ current æ˜¯æœ‰æ„ä¹‰çš„ã€‚ ä¸‰ã€ä¸­æ–­ä¸Šä¸‹æ–‡ ç¡¬ä»¶é€šè¿‡è§¦å‘ä¿¡å·ï¼Œå‘ CPU å‘é€ä¸­æ–­ä¿¡å·ï¼Œå¯¼è‡´å†…æ ¸è°ƒç”¨ä¸­æ–­å¤„ç†ç¨‹åºï¼Œè¿›å…¥å†…æ ¸ç©ºé—´ã€‚è¿™ä¸ªè¿‡ ç¨‹ä¸­ï¼Œç¡¬ä»¶çš„ä¸€äº›å˜é‡å’Œå‚æ•°ä¹Ÿè¦ä¼ é€’ç»™å†…æ ¸ï¼Œ å†…æ ¸é€šè¿‡è¿™äº›å‚æ•°è¿›è¡Œä¸­æ–­å¤„ç†ã€‚ æ‰€ä»¥ï¼Œâ€œä¸­æ–­ä¸Šä¸‹æ–‡â€å°±å¯ä»¥ç†è§£ä¸ºç¡¬ä»¶ä¼ é€’è¿‡æ¥çš„è¿™äº›å‚æ•°å’Œå†…æ ¸éœ€è¦ä¿å­˜çš„ä¸€äº›ç¯å¢ƒï¼Œä¸»è¦ æ˜¯è¢«ä¸­æ–­çš„è¿›ç¨‹çš„ç¯å¢ƒã€‚ å†…æ ¸è¿›å…¥ä¸­æ–­ä¸Šä¸‹æ–‡æ˜¯å› ä¸ºä¸­æ–­ä¿¡å·è€Œå¯¼è‡´çš„ä¸­æ–­å¤„ç†æˆ–è½¯ä¸­æ–­ã€‚è€Œä¸­æ–­ä¿¡å·çš„å‘ç”Ÿæ˜¯éšæœºçš„ï¼Œä¸­æ–­ å¤„ç†ç¨‹åºåŠè½¯ä¸­æ–­å¹¶ä¸èƒ½äº‹å…ˆé¢„æµ‹å‘ç”Ÿä¸­æ–­æ—¶å½“å‰è¿è¡Œçš„æ˜¯å“ªä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­å¼•ç”¨ current æ˜¯å¯ä»¥çš„ï¼Œä½†æ²¡æœ‰æ„ä¹‰ã€‚ äº‹å®ä¸Šï¼Œå¯¹äº A è¿›ç¨‹å¸Œæœ›ç­‰å¾…çš„ä¸­æ–­ä¿¡å·ï¼Œå¯èƒ½åœ¨ B è¿›ç¨‹æ‰§è¡ŒæœŸé—´å‘ç”Ÿã€‚ä¾‹å¦‚ï¼ŒA è¿›ç¨‹å¯åŠ¨å†™ç£ç›˜ æ“ä½œï¼ŒA è¿›ç¨‹ç¡çœ å B è¿›ç¨‹åœ¨è¿è¡Œï¼Œå½“ç£ç›˜å†™å®Œåç£ç›˜ä¸­æ–­ä¿¡å·æ‰“æ–­çš„æ˜¯ B è¿›ç¨‹ï¼Œåœ¨ä¸­æ–­å¤„ç†æ—¶ä¼šå”¤é†’ A è¿›ç¨‹ã€‚ å››ã€è¿›ç¨‹ä¸Šä¸‹æ–‡ VS ä¸­æ–­ä¸Šä¸‹æ–‡ å†…æ ¸å¯ä»¥å¤„äºä¸¤ç§ä¸Šä¸‹æ–‡ï¼šè¿›ç¨‹ä¸Šä¸‹æ–‡å’Œä¸­æ–­ä¸Šä¸‹æ–‡ã€‚ åœ¨ç³»ç»Ÿè°ƒç”¨ä¹‹åï¼Œç”¨æˆ·åº”ç”¨ç¨‹åºè¿›å…¥å†…æ ¸ç©ºé—´ï¼Œæ­¤åå†…æ ¸ç©ºé—´é’ˆå¯¹ç”¨æˆ·ç©ºé—´ç›¸åº”è¿›ç¨‹çš„ä»£è¡¨å°±è¿è¡Œ äºè¿›ç¨‹ä¸Šä¸‹æ–‡ã€‚ å¼‚æ­¥å‘ç”Ÿçš„ä¸­æ–­ä¼šå¼•å‘ä¸­æ–­å¤„ç†ç¨‹åºè¢«è°ƒç”¨ï¼Œä¸­æ–­å¤„ç†ç¨‹åºå°±è¿è¡Œäºä¸­æ–­ä¸Šä¸‹æ–‡ã€‚ ä¸­æ–­ä¸Šä¸‹æ–‡å’Œè¿›ç¨‹ä¸Šä¸‹æ–‡ä¸å¯èƒ½åŒæ—¶å‘ç”Ÿã€‚ è¿è¡Œäºè¿›ç¨‹ä¸Šä¸‹æ–‡çš„å†…æ ¸ä»£ç æ˜¯å¯æŠ¢å çš„ï¼Œä½†ä¸­æ–­ä¸Šä¸‹æ–‡åˆ™ä¼šä¸€ç›´è¿è¡Œè‡³ç»“æŸï¼Œä¸ä¼šè¢«æŠ¢å ã€‚å› æ­¤ï¼Œ å†…æ ¸ä¼šé™åˆ¶ä¸­æ–­ä¸Šä¸‹æ–‡çš„å·¥ä½œï¼Œä¸å…è®¸å…¶æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š a â€“ è¿›å…¥ç¡çœ çŠ¶æ€æˆ–ä¸»åŠ¨æ”¾å¼ƒ CPU ç”±äºä¸­æ–­ä¸Šä¸‹æ–‡ä¸å±äºä»»ä½•è¿›ç¨‹ï¼Œå®ƒä¸ current æ²¡æœ‰ä»»ä½•å…³ç³»ï¼ˆå°½ç®¡æ­¤æ—¶ current æŒ‡å‘è¢«ä¸­æ–­çš„è¿› ç¨‹ï¼‰ï¼Œæ‰€ä»¥ä¸­æ–­ä¸Šä¸‹æ–‡ä¸€æ—¦ç¡çœ æˆ–è€…æ”¾å¼ƒ CPUï¼Œå°†æ— æ³•è¢«å”¤é†’ã€‚æ‰€ä»¥ä¹Ÿå«åŸå­ä¸Šä¸‹æ–‡ï¼ˆatomic contextï¼‰ã€‚ b â€“ å ç”¨äº’æ–¥ä½“ ä¸ºäº†ä¿æŠ¤ä¸­æ–­å¥æŸ„ä¸´ç•ŒåŒºèµ„æºï¼Œä¸èƒ½ä½¿ç”¨ mutexesã€‚å¦‚æœè·å¾—ä¸åˆ°ä¿¡å·é‡ï¼Œä»£ç å°±ä¼šç¡çœ ï¼Œä¼šäº§ç”Ÿå’Œ ä¸Šé¢ç›¸åŒçš„æƒ…å†µï¼Œå¦‚æœå¿…é¡»ä½¿ç”¨é”ï¼Œåˆ™ä½¿ç”¨ spinlockã€‚ c â€“ æ‰§è¡Œè€—æ—¶çš„ä»»åŠ¡ ä¸­æ–­å¤„ç†åº”è¯¥å°½å¯èƒ½å¿«ï¼Œå› ä¸ºå†…æ ¸è¦å“åº”å¤§é‡æœåŠ¡å’Œè¯·æ±‚ï¼Œä¸­æ–­ä¸Šä¸‹æ–‡å ç”¨ CPU æ—¶é—´å¤ªé•¿ä¼šä¸¥é‡å½±å“ ç³»ç»ŸåŠŸèƒ½ã€‚åœ¨ä¸­æ–­å¤„ç†ä¾‹ç¨‹ä¸­æ‰§è¡Œè€—æ—¶ä»»åŠ¡æ—¶ï¼Œåº”è¯¥äº¤ç”±ä¸­æ–­å¤„ç†ä¾‹ç¨‹åº•åŠéƒ¨æ¥å¤„ç†ã€‚ d â€“ è®¿é—®ç”¨æˆ·ç©ºé—´è™šæ‹Ÿå†…å­˜ å› ä¸ºä¸­æ–­ä¸Šä¸‹æ–‡æ˜¯å’Œç‰¹å®šè¿›ç¨‹æ— å…³çš„ï¼Œå®ƒæ˜¯å†…æ ¸ä»£è¡¨ç¡¬ä»¶è¿è¡Œåœ¨å†…æ ¸ç©ºé—´ï¼Œæ‰€ä»¥åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡æ— æ³•è®¿ é—®ç”¨æˆ·ç©ºé—´çš„è™šæ‹Ÿåœ°å€ e â€“ ä¸­æ–­å¤„ç†ä¾‹ç¨‹ä¸åº”è¯¥è®¾ç½®æˆ reentrantï¼ˆå¯è¢«å¹¶è¡Œæˆ–é€’å½’è°ƒç”¨çš„ä¾‹ç¨‹ï¼‰ å› ä¸ºä¸­æ–­å‘ç”Ÿæ—¶ï¼Œpreempt å’Œ irq éƒ½è¢« disableï¼Œç›´åˆ°ä¸­æ–­è¿”å›ã€‚æ‰€ä»¥ä¸­æ–­ä¸Šä¸‹æ–‡å’Œè¿›ç¨‹ä¸Šä¸‹æ–‡ä¸ä¸€æ ·ï¼Œ ä¸­æ–­å¤„ç†ä¾‹ç¨‹çš„ä¸åŒå®ä¾‹ï¼Œæ˜¯ä¸å…è®¸åœ¨ SMP ä¸Šå¹¶å‘è¿è¡Œçš„ã€‚ f â€“ ä¸­æ–­å¤„ç†ä¾‹ç¨‹å¯ä»¥è¢«æ›´é«˜çº§åˆ«çš„ IRQ ä¸­æ–­ å¦‚æœæƒ³ç¦æ­¢è¿™ç§ä¸­æ–­ï¼Œå¯ä»¥å°†ä¸­æ–­å¤„ç†ä¾‹ç¨‹å®šä¹‰æˆå¿«é€Ÿå¤„ç†ä¾‹ç¨‹ï¼Œç›¸å½“äºå‘Šè¯‰ CPUï¼Œè¯¥ä¾‹ç¨‹è¿è¡Œæ—¶ï¼Œ ç¦æ­¢æœ¬åœ° CPU ä¸Šæ‰€æœ‰ä¸­æ–­è¯·æ±‚ã€‚è¿™ç›´æ¥å¯¼è‡´çš„ç»“æœæ˜¯ï¼Œç”±äºå…¶ä»–ä¸­æ–­è¢«å»¶è¿Ÿå“åº”ï¼Œç³»ç»Ÿæ€§èƒ½ä¸‹é™ã€‚ äº”ã€åŸå­ä¸Šä¸‹æ–‡ å†…æ ¸çš„ä¸€ä¸ªåŸºæœ¬åŸåˆ™å°±æ˜¯ï¼šåœ¨ä¸­æ–­æˆ–è€…è¯´åŸå­ä¸Šä¸‹æ–‡ä¸­ï¼Œå†…æ ¸ä¸èƒ½è®¿é—®ç”¨æˆ·ç©ºé—´ï¼Œè€Œä¸”å†…æ ¸æ˜¯ä¸ èƒ½ç¡çœ çš„ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå†…æ ¸æ˜¯ä¸èƒ½è°ƒç”¨æœ‰å¯èƒ½å¼•èµ·ç¡çœ çš„ä»»ä½•å‡½æ•°ã€‚ä¸€èˆ¬æ¥è®²åŸå­ä¸Šä¸‹ æ–‡æŒ‡çš„æ˜¯åœ¨ä¸­æ–­æˆ–è½¯ä¸­æ–­ä¸­ï¼Œä»¥åŠåœ¨æŒæœ‰è‡ªæ—‹é”çš„æ—¶å€™ã€‚å†…æ ¸æä¾› äº†å››ä¸ªå®æ¥åˆ¤æ–­æ˜¯å¦å¤„äºè¿™å‡ ç§æƒ… å†µé‡Œï¼š 1. 2. 3. 4. #define in_irq() (hardirq_count()) åœ¨å¤„ç†ç¡¬ä¸­æ–­ä¸­ #define in_softirq() (softirq_count()) åœ¨å¤„ç†è½¯ä¸­æ–­ä¸­ #define in_interrupt() (irq_count()) åœ¨å¤„ç†ç¡¬ä¸­æ–­æˆ–è½¯ä¸­æ–­ä¸­ #define in_atomic() ((preempt_count() ~PREEMPT_ACTIVE) ! 0) åŒ…å«ä»¥ä¸Šæ‰€æœ‰æƒ…å†µ è¿™å››ä¸ªå®æ‰€è®¿é—®çš„ count éƒ½æ˜¯ thread_info-preempt_countã€‚è¿™ä¸ªå˜é‡å…¶å®æ˜¯ä¸€ä¸ªä½æ©ç ã€‚æœ€ä½ 8 ä½è¡¨ç¤ºæŠ¢å è®¡æ•°ï¼Œé€šå¸¸ç”± spin_lockspin_unlock ä¿®æ”¹ï¼Œæˆ–ç¨‹åºå‘˜å¼ºåˆ¶ä¿®æ”¹ï¼ŒåŒæ—¶è¡¨æ˜å†…æ ¸å®¹è®¸çš„æœ€ å¤§æŠ¢å æ·±åº¦æ˜¯ 256ã€‚ 8ï¼15 ä½æ˜¯è½¯ä¸­æ–­è®¡æ•°ï¼Œé€šå¸¸ç”± local_bh_disablelocal_bh_enable ä¿®æ”¹ï¼ŒåŒæ—¶è¡¨æ˜å†…æ ¸å®¹è®¸çš„æœ€å¤§ è½¯ä¸­æ–­æ·±åº¦æ˜¯ 256ã€‚ 16ï¼27 ä½æ˜¯ç¡¬ä¸­æ–­è®¡æ•°ï¼Œé€šå¸¸ç”± enter_irqexit_irq ä¿®æ”¹ï¼ŒåŒæ—¶è¡¨æ˜å†…æ ¸å®¹è®¸çš„æœ€å¤§ç¡¬ä¸­æ–­æ·±åº¦æ˜¯ 4096ã€‚ ç¬¬ 28 ä½æ˜¯ PREEMPT_ACTIVE æ ‡å¿—ã€‚ç”¨ä»£ç è¡¨ç¤ºå°±æ˜¯ï¼š PREEMPT_MASK: 0x000000ff SOFTIRQ_MASK: 0x0000ff00 HARDIRQ_MASK: 0x0fff0000 å‡¡æ˜¯ä¸Šé¢ 4 ä¸ªå®è¿”å› 1 å¾—åˆ°åœ°æ–¹éƒ½æ˜¯åŸå­ä¸Šä¸‹æ–‡ï¼Œæ˜¯ä¸å®¹è®¸å†…æ ¸è®¿é—®ç”¨æˆ·ç©ºé—´ï¼Œä¸å®¹è®¸å†…æ ¸ç¡çœ çš„ï¼Œä¸ å®¹è®¸è°ƒç”¨ä»»ä½•å¯èƒ½å¼•èµ·ç¡çœ çš„å‡½æ•°ã€‚è€Œä¸”ä»£è¡¨ thread_info-preempt_count ä¸æ˜¯ 0ï¼Œè¿™å°±å‘Šè¯‰å†…æ ¸ï¼Œ åœ¨è¿™é‡Œé¢æŠ¢å è¢«ç¦ç”¨ã€‚ ä½† æ˜¯ï¼Œå¯¹äº in_atomic()æ¥è¯´ï¼Œåœ¨å¯ç”¨æŠ¢å çš„æƒ…å†µä¸‹ï¼Œå®ƒå·¥ä½œçš„å¾ˆå¥½ï¼Œå¯ä»¥å‘Šè¯‰å†…æ ¸ç›®å‰æ˜¯å¦æŒæœ‰ è‡ªæ—‹é”ï¼Œæ˜¯å¦ç¦ç”¨æŠ¢å ç­‰ã€‚ä½†æ˜¯ï¼Œåœ¨æ²¡æœ‰å¯ç”¨æŠ¢å çš„æƒ…å†µ ä¸‹ï¼Œspin_lock æ ¹æœ¬ä¸ä¿®æ”¹ preempt_countï¼Œæ‰€ä»¥å³ä½¿å†…æ ¸è°ƒç”¨äº† spin_lockï¼ŒæŒæœ‰äº†è‡ªæ—‹é”ï¼Œin_atomic()ä»ç„¶ä¼šè¿”å› 0ï¼Œé”™è¯¯çš„ å‘Šè¯‰å†…æ ¸ç›®å‰åœ¨éåŸå­ä¸Šä¸‹æ–‡ä¸­ã€‚æ‰€ä»¥å‡¡æ˜¯ä¾èµ– in_atomic()æ¥åˆ¤æ–­æ˜¯å¦åœ¨åŸå­ä¸Šä¸‹æ–‡çš„ä»£ç ï¼Œåœ¨ç¦æŠ¢ å çš„æƒ…å†µä¸‹éƒ½æ˜¯æœ‰é—®é¢˜çš„ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","è¿›ç¨‹çº¿ç¨‹"]},{"title":"æ­»é”","path":"/2025/03/07/1-å¹³å°ç³»ç»Ÿ-Linux-è¿›ç¨‹çº¿ç¨‹-æ­»é”/","content":"æ­»é”1. æ­»é”çš„æ¦‚å¿µåœ¨å¤šé“ç¨‹åºç³»ç»Ÿä¸­ï¼Œå¤šä¸ªè¿›ç¨‹çš„å¹¶å‘æ‰§è¡Œæé«˜äº†ç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡å’Œå¤„ç†èƒ½åŠ›ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æ­»é”é—®é¢˜ã€‚æ­»é”æ˜¯æŒ‡å¤šä¸ªè¿›ç¨‹å› ç«äº‰èµ„æºè€Œé™·å…¥åƒµå±€ï¼Œæ— æ³•æ¨è¿›ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨åˆ™æ°¸è¿œæ— æ³•è§£é™¤ã€‚ 1.1 ç³»ç»Ÿèµ„æºçš„ç«äº‰ç³»ç»Ÿä¸­ä¸å¯å‰¥å¤ºèµ„æºï¼ˆå¦‚ CPUã€å†…å­˜ï¼‰æ•°é‡æœ‰é™ï¼Œå¤šä¸ªè¿›ç¨‹ç«äº‰æ—¶å¯èƒ½å¯¼è‡´æ­»é”ã€‚ä¾‹å¦‚ï¼Œä¸¤ä¸ªè¿›ç¨‹å„å ä¸€å°æ‰“å°æœºï¼Œå„è‡ªç­‰å¾…å¦ä¸€å°ï¼Œå¯¼è‡´åƒµå±€ã€‚å¯å‰¥å¤ºèµ„æºï¼ˆå¦‚ CPU æ—¶é—´ç‰‡ï¼‰ä¸ä¼šå¼•èµ·æ­»é”ã€‚ 1.2 è¿›ç¨‹æ¨è¿›é¡ºåºéæ³•èµ„æºè¯·æ±‚å’Œé‡Šæ”¾é¡ºåºä¸å½“ä¼šå¯¼è‡´æ­»é”ã€‚ä¾‹å¦‚ï¼Œè¿›ç¨‹ A å…ˆè¯·æ±‚èµ„æº 1ï¼Œå†è¯·æ±‚èµ„æº 2ï¼Œè€Œè¿›ç¨‹ B å…ˆè¯·æ±‚èµ„æº 2ï¼Œå†è¯·æ±‚èµ„æº 1ï¼Œè‹¥åŒæ—¶å ç”¨å¯¹æ–¹èµ„æºï¼ŒåŒæ–¹éƒ½æ— æ³•ç»§ç»­ã€‚ 1.3 ä¿¡å·é‡ä½¿ç”¨ä¸å½“è¿›ç¨‹é—´ç›¸äº’ç­‰å¾…æ¶ˆæ¯ä¹Ÿä¼šå¼•å‘æ­»é”ã€‚ä¾‹å¦‚ï¼Œè¿›ç¨‹ A ç­‰å¾…è¿›ç¨‹ B çš„æ¶ˆæ¯ï¼Œè¿›ç¨‹ B åˆç­‰å¾…è¿›ç¨‹ A çš„æ¶ˆæ¯ï¼ŒåŒæ–¹æ°¸è¿œæ— æ³•æ¨è¿›ã€‚ 2. æ­»é”çš„å¿…è¦æ¡ä»¶æ­»é”éœ€åŒæ—¶æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼š äº’æ–¥æ¡ä»¶ï¼šèµ„æºç‹¬å ã€‚ä¾‹å¦‚ï¼Œæ‰“å°æœºåªèƒ½ç”±ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚ ä¸å‰¥å¤ºæ¡ä»¶ï¼šèµ„æºåªèƒ½ç”±å æœ‰è¿›ç¨‹é‡Šæ”¾ã€‚ä¾‹å¦‚ï¼Œè¿›ç¨‹å ç”¨å†…å­˜ç›´åˆ°å®Œæˆã€‚ è¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼šè¿›ç¨‹å æœ‰èµ„æºåˆè¯·æ±‚å…¶ä»–èµ„æºã€‚ä¾‹å¦‚ï¼Œè¿›ç¨‹ A å ç”¨èµ„æº 1ï¼Œè¯·æ±‚èµ„æº 2ã€‚ å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šå½¢æˆèµ„æºå¾ªç¯ç­‰å¾…é“¾ã€‚ä¾‹å¦‚ï¼ŒA ç­‰å¾… B çš„èµ„æºï¼ŒB ç­‰å¾… A çš„èµ„æºã€‚ 3. æ­»é”çš„å¤„ç†ç­–ç•¥3.1 ç ´åæ­»é”æ¡ä»¶ç ´åä»»ä¸€æ¡ä»¶å³å¯é¢„é˜²æ­»é”ï¼š ç ´åäº’æ–¥æ¡ä»¶ï¼šå…è®¸èµ„æºå…±äº«ï¼Œä½†ä¸å¯è¡Œã€‚ ç ´åä¸å‰¥å¤ºæ¡ä»¶ï¼šå…è®¸èµ„æºæŠ¢å ï¼Œä½†å¯èƒ½å¯¼è‡´è¿›ç¨‹å¤±è´¥ã€‚ ç ´åè¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼šä¸€æ¬¡æ€§åˆ†é…æ‰€æœ‰èµ„æºï¼Œé¿å…éƒ¨åˆ†åˆ†é…ã€‚ ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šæŒ‰ç¼–å·é¡ºåºåˆ†é…èµ„æºï¼Œé¿å…å¾ªç¯ã€‚ 3.2 é¢„é˜²æ­»é”åœ¨èµ„æºåˆ†é…å‰æ£€æŸ¥å®‰å…¨æ€§ï¼Œé¿å…è¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼š é¢„å…ˆé™æ€åˆ†é…ï¼šè¿›ç¨‹å¯åŠ¨å‰ä¸€æ¬¡æ€§åˆ†é…æ‰€éœ€èµ„æºï¼Œé¿å…åŠ¨æ€è¯·æ±‚ã€‚ èµ„æºåˆ©ç”¨ç‡ä½ï¼šèµ„æºå¯èƒ½é—²ç½®ï¼Œå¯¼è‡´æµªè´¹å’Œé¥¥é¥¿ã€‚ 4. æ­»é”é¿å…4.1 å®‰å…¨çŠ¶æ€ç³»ç»Ÿèƒ½æŒ‰å®‰å…¨åºåˆ—ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…èµ„æºï¼Œæ»¡è¶³æœ€å¤§éœ€æ±‚åˆ™ä¸ºå®‰å…¨çŠ¶æ€ã€‚å®‰å…¨çŠ¶æ€å¯é¿å…æ­»é”ã€‚ 4.2 é“¶è¡Œå®¶ç®—æ³•æ¨¡æ‹Ÿé“¶è¡Œå®¶è´·æ¬¾ï¼Œç¡®ä¿æ¯æ¬¡åˆ†é…åç³»ç»Ÿå®‰å…¨ï¼š æ•°æ®ç»“æ„ï¼šAvailableã€Maxã€Allocationã€Need çŸ©é˜µã€‚ æ­¥éª¤ï¼š æ£€æŸ¥è¯·æ±‚æ˜¯å¦è¶…è¿‡éœ€æ±‚ã€‚ æ£€æŸ¥èµ„æºæ˜¯å¦è¶³å¤Ÿã€‚ è¯•æ¢åˆ†é…ï¼Œæ›´æ–°æ•°æ®ç»“æ„ã€‚ æ‰§è¡Œå®‰å…¨æ€§ç®—æ³•ï¼Œç¡®è®¤å®‰å…¨åæ­£å¼åˆ†é…ã€‚ 4.3 å®‰å…¨æ€§ç®—æ³•æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å®‰å…¨ï¼š åˆå§‹åŒ– Work ä¸º Availableï¼ŒFinish ä¸º falseã€‚ æ‰¾å‡ºå¯æ»¡è¶³æ¡ä»¶çš„è¿›ç¨‹ï¼Œåˆ†é…èµ„æºï¼Œæ›´æ–° Work å’Œ Finishã€‚ é‡å¤ç›´åˆ°æ‰€æœ‰è¿›ç¨‹å®Œæˆæˆ–æ— æ³•ç»§ç»­ã€‚ 5. æ­»é”æ£€æµ‹å’Œè§£é™¤5.1 æ£€æµ‹é€šè¿‡èµ„æºåˆ†é…å›¾ç®€åŒ–æ£€æµ‹æ­»é”ï¼š æ‰¾å‡ºå¯è¿è¡Œè¿›ç¨‹ï¼Œé‡Šæ”¾èµ„æºã€‚ æ›´æ–°å›¾ï¼Œé‡å¤ç›´åˆ°æ— æ³•ç®€åŒ–ã€‚ è‹¥å›¾ä¸å¯ç®€åŒ–ï¼Œç³»ç»Ÿæ­»é”ã€‚ 5.2 è§£é™¤ä¸€æ—¦æ£€æµ‹åˆ°æ­»é”ï¼Œé‡‡å–æªæ–½ï¼š èµ„æºå‰¥å¤ºæ³•ï¼šæŒ‚èµ·è¿›ç¨‹ï¼ŒæŠ¢å èµ„æºã€‚ è¿›ç¨‹æ’¤é”€æ³•ï¼šæ’¤é”€è¿›ç¨‹ï¼Œé‡Šæ”¾èµ„æºã€‚ è¿›ç¨‹å›é€€æ³•ï¼šå›é€€è¿›ç¨‹åˆ°é¿å…æ­»é”çš„çŠ¶æ€ã€‚ é€šè¿‡ä»¥ä¸Šç­–ç•¥ï¼Œå¯ä»¥æœ‰æ•ˆé¢„é˜²ã€é¿å…å’Œå¤„ç†æ­»é”ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","è¿›ç¨‹çº¿ç¨‹"]},{"title":"åŒæ­¥","path":"/2025/03/07/1-å¹³å°ç³»ç»Ÿ-Linux-è¿›ç¨‹çº¿ç¨‹-åŒæ­¥/","content":"è¿›ç¨‹åŒæ­¥1. è¿›ç¨‹åŒæ­¥çš„åŸºæœ¬æ¦‚å¿µåœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸­ï¼Œè¿›ç¨‹æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œä¸åŒè¿›ç¨‹é—´å­˜åœ¨ç€å¤æ‚çš„ç›¸äº’åˆ¶çº¦å…³ç³»ã€‚ä¸ºäº†åè°ƒè¿™äº›å…³ç³»ï¼Œå®ç°èµ„æºå…±äº«å’Œè¿›ç¨‹åä½œï¼Œé¿å…å†²çªï¼Œå¼•å…¥äº†è¿›ç¨‹åŒæ­¥çš„æ¦‚å¿µã€‚ ï¼ˆ1ï¼‰ ä¸´ç•Œèµ„æºå¤šä¸ªè¿›ç¨‹å¯ä»¥å…±äº«ç³»ç»Ÿèµ„æºï¼Œä½†æŸäº›èµ„æºä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œè¿™äº›èµ„æºç§°ä¸ºä¸´ç•Œèµ„æºã€‚ä¾‹å¦‚ï¼Œæ‰“å°æœºã€ç£ç›˜ç­‰ã€‚è®¿é—®ä¸´ç•Œèµ„æºçš„ä»£ç æ®µç§°ä¸ºä¸´ç•ŒåŒºã€‚ ä¸ºäº†å®‰å…¨è®¿é—®ä¸´ç•Œèµ„æºï¼Œè¿›ç¨‹çš„æ‰§è¡Œåˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š è¿›å…¥åŒºï¼šæ£€æŸ¥æ˜¯å¦èƒ½è¿›å…¥ä¸´ç•ŒåŒºã€‚ ä¸´ç•ŒåŒºï¼šè®¿é—®ä¸´ç•Œèµ„æºçš„ä»£ç ã€‚ é€€å‡ºåŒºï¼šæ¸…é™¤å ç”¨æ ‡å¿—ã€‚ å‰©ä½™åŒºï¼šå…¶ä»–ä»£ç ã€‚ do // è¿›å…¥åŒº entry section(); // ä¸´ç•ŒåŒº critical section(); // é€€å‡ºåŒº exit section(); // å‰©ä½™åŒº remainder section(); while (true); ï¼ˆ2ï¼‰ åŒæ­¥åŒæ­¥æ˜¯è¿›ç¨‹é—´ç›´æ¥åˆ¶çº¦å…³ç³»ï¼Œç”¨äºåè°ƒä»»åŠ¡é¡ºåºã€‚ä¾‹å¦‚ï¼Œç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ä¸­ï¼Œç”Ÿäº§è€…å¿…é¡»åœ¨æ¶ˆè´¹è€…å–ä¹‹å‰ç”Ÿäº§ã€‚ ï¼ˆ3ï¼‰ äº’æ–¥äº’æ–¥æ˜¯è¿›ç¨‹é—´é—´æ¥åˆ¶çº¦å…³ç³»ï¼Œç¡®ä¿ä¸´ç•Œèµ„æºç‹¬å è®¿é—®ã€‚ä¾‹å¦‚ï¼Œæ‰“å°æœºçš„ä½¿ç”¨ã€‚ 2. å®ç°ä¸´ç•ŒåŒºäº’æ–¥çš„åŸºæœ¬æ–¹æ³•é€šè¿‡åœ¨è¿›å…¥åŒºè®¾ç½®æ ‡å¿—ä½ï¼Œæ£€æŸ¥å’Œç­‰å¾…ï¼Œå®ç°äº’æ–¥ã€‚ ï¼ˆ1ï¼‰ ç¡¬ä»¶å®ç°æ–¹æ³•åˆ©ç”¨ç¡¬ä»¶æŒ‡ä»¤å®ç°ä½çº§äº’æ–¥ã€‚ 1. ä¸­æ–­å±è”½æ–¹æ³•åœ¨ä¸´ç•ŒåŒºæ‰§è¡Œæ—¶å±è”½ä¸­æ–­ï¼Œé˜²æ­¢åˆ‡æ¢ã€‚ä¾‹å¦‚ï¼Œå†…æ ¸æ›´æ–°å˜é‡æ—¶ã€‚ ä¼˜ç‚¹ï¼šç®€å•ã€‚ ç¼ºç‚¹ï¼šé™ä½æ•ˆç‡ï¼Œç”¨æˆ·è¿›ç¨‹ä¸å®œä½¿ç”¨ã€‚ 2. ç¡¬ä»¶åŸå­æŒ‡ä»¤æ³•ä½¿ç”¨ TestAndSet å’Œ Swap æŒ‡ä»¤ã€‚ TestAndSet æŒ‡ä»¤ï¼šåŸå­æ“ä½œï¼Œæ£€æŸ¥å¹¶è®¾ç½®æ ‡å¿—ã€‚ Boolean TestAndSet(Boolean *lock) Boolean old = *lock; *lock = true; return old; Swap æŒ‡ä»¤ï¼šäº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼ã€‚ void Swap(Boolean *a, Boolean *b) Boolean temp = *a; *a = *b; *b = temp; ä¼˜ç‚¹ï¼šç®€å•ï¼Œæ”¯æŒå¤šå¤„ç†å™¨ã€‚ ç¼ºç‚¹ï¼šå¿™ç­‰ï¼Œå¯èƒ½å¯¼è‡´é¥¥é¥¿ã€‚ 3. ä¿¡å·é‡ä¿¡å·é‡æ˜¯å¼ºå¤§æœºåˆ¶ï¼Œè§£å†³äº’æ–¥å’ŒåŒæ­¥ã€‚ ï¼ˆ1ï¼‰ æ•´å½¢ä¿¡å·é‡è¡¨ç¤ºèµ„æºæ•°é‡ã€‚ ï¼ˆ2ï¼‰ è®°å½•æ€§ä¿¡å·é‡åŒ…å«èµ„æºè®¡æ•°å’Œç­‰å¾…é˜Ÿåˆ—ã€‚ typedef struct int value; struct process *L; semaphore; Wait æ“ä½œï¼šè¯·æ±‚èµ„æºï¼Œè‹¥ä¸è¶³åˆ™é˜»å¡ã€‚ Signal æ“ä½œï¼šé‡Šæ”¾èµ„æºï¼Œå”¤é†’ç­‰å¾…è¿›ç¨‹ã€‚ ï¼ˆ3ï¼‰ å®ç°åŒæ­¥ä¸äº’æ–¥ åŒæ­¥ï¼šé€šè¿‡ä¿¡å·é‡åè°ƒè¿›ç¨‹é¡ºåºã€‚ äº’æ–¥ï¼šä¿¡å·é‡æ§åˆ¶åŒä¸€èµ„æºçš„è®¿é—®ã€‚ 4. ç®¡ç¨‹ç®¡ç¨‹æ˜¯æ•°æ®ç»“æ„å’Œæ“ä½œç»„æˆçš„è½¯ä»¶æ¨¡å—ï¼Œç®¡ç†å…±äº«æ•°æ®ã€‚ å±€éƒ¨æ•°æ®ï¼šåªèƒ½é€šè¿‡ç®¡ç¨‹å†…è¿‡ç¨‹è®¿é—®ã€‚ äº’æ–¥è®¿é—®ï¼šç¼–è¯‘å™¨è‡ªåŠ¨å¤„ç†ï¼Œé¿å…å†²çªã€‚ 5. ç»å…¸åŒæ­¥é—®é¢˜ï¼ˆ1ï¼‰ ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜å…±äº«ç¼“å†²åŒºï¼Œåè°ƒç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚ è§£å†³æ­¥éª¤ï¼š å…³ç³»åˆ†æï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯åŒæ­¥å…³ç³»ã€‚ æ•´ä½“æ€è·¯ï¼šä½¿ç”¨ä¿¡å·é‡ mutexã€fullã€emptyã€‚ ä¿¡å·é‡è®¾ç½®ï¼š mutexï¼šäº’æ–¥è®¿é—®ï¼Œåˆå€¼ 1ã€‚ fullï¼šå·²æ»¡ç¼“å†²åŒºæ•°ï¼Œåˆå€¼ 0ã€‚ emptyï¼šç©ºç¼“å†²åŒºæ•°ï¼Œåˆå€¼ nã€‚ ï¼ˆ2ï¼‰ è¯»è€…-å†™è€…é—®é¢˜å…è®¸å¤šä¸ªè¯»è€…åŒæ—¶è¯»ï¼Œå†™è€…ç‹¬å ã€‚ è§£å†³æ­¥éª¤ï¼š å…³ç³»åˆ†æï¼šè¯»è€…å’Œå†™è€…äº’æ–¥ã€‚ æ•´ä½“æ€è·¯ï¼šä½¿ç”¨è®¡æ•°å™¨å’Œä¿¡å·é‡ã€‚ ä¿¡å·é‡è®¾ç½®ï¼š countï¼šè®°å½•è¯»è€…æ•°ï¼Œåˆå€¼ 0ã€‚ mutexï¼šäº’æ–¥è®¿é—®è®¡æ•°å™¨ã€‚ rwï¼šè¯»è€…å’Œå†™è€…äº’æ–¥ã€‚ ï¼ˆ3ï¼‰ å“²å­¦å®¶è¿›é¤é—®é¢˜äº”ä½å“²å­¦å®¶äº¤æ›¿æ‹¿ç­·å­ã€‚ è§£å†³æ­¥éª¤ï¼š å…³ç³»åˆ†æï¼šå“²å­¦å®¶ä¸é‚»å±…äº’æ–¥ã€‚ æ•´ä½“æ€è·¯ï¼šé¿å…æ­»é”å’Œé¥¥é¥¿ã€‚ ä¿¡å·é‡è®¾ç½®ï¼š chopsticksï¼šäº”ä¸ªäº’æ–¥ä¿¡å·é‡ã€‚ ï¼ˆ4ï¼‰ å¸çƒŸè€…é—®é¢˜ä¾›åº”è€…æä¾›ææ–™ï¼Œå¸çƒŸè€…åˆ¶ä½œçƒŸã€‚ è§£å†³æ­¥éª¤ï¼š å…³ç³»åˆ†æï¼šä¾›åº”è€…ä¸å¸çƒŸè€…åŒæ­¥ã€‚ æ•´ä½“æ€è·¯ï¼šåè°ƒææ–™ç»„åˆã€‚ ä¿¡å·é‡è®¾ç½®ï¼š offer1ã€offer2ã€offer3ï¼šææ–™ç»„åˆã€‚ finishï¼šäº’æ–¥æŠ½çƒŸã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","è¿›ç¨‹çº¿ç¨‹"]},{"title":"çº¿ç¨‹è°ƒåº¦","path":"/2025/03/07/1-å¹³å°ç³»ç»Ÿ-Linux-è¿›ç¨‹çº¿ç¨‹-çº¿ç¨‹è°ƒåº¦/","content":"2.2 çº¿ç¨‹çš„è°ƒåº¦1. è°ƒåº¦çš„æ¦‚å¿µåœ¨å¤šé“ç¨‹åºç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹çš„æ•°é‡å¾€å¾€å¤šäºå¤„ç†å™¨çš„ä¸ªæ•°ï¼Œè¿›ç¨‹äº‰ç”¨å¤„ç†å™¨çš„æƒ…å†µåœ¨æ‰€éš¾å…ã€‚å¤„ç†å™¨è°ƒåº¦æ˜¯å¯¹å¤„ç†å™¨è¿›è¡Œåˆ†é…ï¼Œå³ä»å°±ç»ªé˜Ÿåˆ—ä¸­æŒ‰ç…§ä¸€å®šçš„ç®—æ³•é€‰æ‹©ä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶å°†å¤„ç†å™¨åˆ†é…ç»™å®ƒè¿è¡Œï¼Œä»¥å®ç°è¿›ç¨‹çš„å¹¶å‘æ‰§è¡Œã€‚ å¤„ç†å™¨è°ƒåº¦æ˜¯å¤šé“ç¨‹åºæ“ä½œç³»ç»Ÿçš„åŸºç¡€ï¼Œæ˜¯æ“ä½œç³»ç»Ÿè®¾è®¡çš„æ ¸å¿ƒé—®é¢˜ã€‚ ä¸€ä¸ªä½œä¸šä»æäº¤å¼€å§‹åˆ°å®Œæˆï¼Œå¾€å¾€è¦ç»å†ä»¥ä¸‹ä¸‰çº§è°ƒåº¦ï¼š ä½œä¸šè°ƒåº¦ä½œä¸šè°ƒåº¦åˆç§°é«˜çº§è°ƒåº¦ã€‚å…¶ä¸»è¦ä»»åŠ¡æ˜¯æŒ‰ä¸€å®šçš„åŸåˆ™ä»å¤–å­˜ä¸Šå¤„äºåå¤‡çŠ¶æ€çš„ä½œä¸šä¸­æŒ‘é€‰ä¸€ä¸ªæˆ–å¤šä¸ªä½œä¸šï¼Œåˆ†é…å†…å­˜ã€è¾“å…¥è¾“å‡ºè®¾å¤‡ç­‰å¿…è¦çš„èµ„æºï¼Œå¹¶å»ºç«‹ç›¸åº”çš„è¿›ç¨‹ï¼Œä½¿å…¶è·å¾—ç«äº‰å¤„ç†å™¨çš„æƒåˆ©ã€‚åœ¨å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿä¸­å¤§å¤šé…æœ‰ä½œä¸šè°ƒåº¦ï¼Œè€Œåœ¨å…¶ä»–ç³»ç»Ÿä¸­é€šå¸¸ä¸éœ€è¦é…ç½®ä½œä¸šè°ƒåº¦ã€‚ä½œä¸šè°ƒåº¦çš„æ‰§è¡Œé¢‘ç‡è¾ƒä½ï¼Œé€šå¸¸ä¸ºå‡ åˆ†é’Ÿä¸€æ¬¡ã€‚ ä¸­çº§è°ƒåº¦ä¸­çº§è°ƒåº¦åˆç§°å†…å­˜è°ƒåº¦ã€‚å¼•å…¥ä¸­çº§è°ƒåº¦æ˜¯ä¸ºäº†æé«˜å†…å­˜åˆ©ç”¨ç‡å’Œç³»ç»Ÿååç‡ã€‚ä¸ºæ­¤ï¼Œåº”å°†é‚£äº›æš‚æ—¶ä¸èƒ½è¿è¡Œçš„è¿›ç¨‹è°ƒè‡³å¤–å­˜ç­‰å¾…ï¼ŒæŠŠæ­¤æ—¶çš„è¿›ç¨‹çŠ¶æ€ç§°ä¸ºæŒ‚èµ·çŠ¶æ€ã€‚å½“å®ƒä»¬å…·å¤‡è¿è¡Œæ¡ä»¶ä¸”å†…å­˜æœ‰ç©ºé—²æ—¶ï¼Œç”±ä¸­çº§è°ƒåº¦å†³å®šå°†å¤–å­˜ä¸Šå…·å¤‡è¿è¡Œæ¡ä»¶çš„å°±ç»ªè¿›ç¨‹é‡æ–°è°ƒå…¥å†…å­˜ï¼Œå¹¶ä¿®æ”¹å…¶çŠ¶æ€ä¸ºå°±ç»ªçŠ¶æ€ï¼ŒæŒ‚åœ¨å°±ç»ªé˜Ÿåˆ—ä¸Šç­‰å¾…ã€‚ è¿›ç¨‹è°ƒåº¦è¿›ç¨‹è°ƒåº¦åˆç§°ä¸ºä½çº§è°ƒåº¦ï¼Œå…¶ä¸»è¦ä»»åŠ¡æ˜¯æŒ‰ç…§æŸç§æ–¹æ³•å’Œç­–ç•¥ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰å–ä¸€ä¸ªè¿›ç¨‹ï¼Œå°†å¤„ç†å™¨åˆ†é…ç»™å®ƒã€‚è¿›ç¨‹è°ƒåº¦æ˜¯æ“ä½œç³»ç»Ÿä¸­æœ€åŸºæœ¬çš„ä¸€ç§è°ƒåº¦ï¼Œåœ¨ä¸€èˆ¬æ“ä½œç³»ç»Ÿä¸­éƒ½ä¸éœ€é…ç½®è¿›ç¨‹è°ƒåº¦ã€‚è¿›ç¨‹è°ƒåº¦çš„é¢‘ç‡å¾ˆé«˜ï¼Œé€šå¸¸ä¸ºå‡ åæ¯«ç§’ä¸€æ¬¡ã€‚ ä½œä¸šè°ƒåº¦ä»å¤–å­˜çš„åå¤‡é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€æ‰¹ä½œä¸šè¿›å…¥å†…å­˜ï¼Œä¸ºå®ƒä»¬å»ºç«‹è¿›ç¨‹ã€‚è¿™äº›è¿›ç¨‹è¢«é€å…¥å°±ç»ªé˜Ÿåˆ—ã€‚è¿›ç¨‹è°ƒåº¦ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰å‡ºä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶å°†å…¶çŠ¶æ€æ”¹ä¸ºè¿è¡ŒçŠ¶æ€ï¼ŒæŠŠ CPU åˆ†é…ç»™å®ƒã€‚ä¸­çº§è°ƒåº¦æ˜¯ä½äºé«˜çº§è°ƒåº¦å’Œä½çº§è°ƒåº¦ä¹‹é—´çš„ä¸€ç§è°ƒåº¦ã€‚ä¸ºäº†æé«˜å†…å­˜çš„åˆ©ç”¨ç‡ï¼Œç³»ç»Ÿå°†é‚£äº›æš‚æ—¶ä¸èƒ½è¿è¡Œçš„è¿›ç¨‹æŒ‚èµ·ã€‚å½“å†…å­˜ç©ºé—´å®½æ¾æ—¶ï¼Œé€šè¿‡ä¸­çº§è°ƒåº¦é€‰æ‹©å…·å¤‡è¿è¡Œæ¡ä»¶çš„è¿›ç¨‹ï¼Œå°†å…¶å”¤é†’ã€‚ 2. è°ƒåº¦çš„æ—¶æœºã€åˆ‡æ¢ä¸è¿‡ç¨‹è¿›ç¨‹è°ƒåº¦å’Œåˆ‡æ¢ç¨‹åºæ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸ç¨‹åºã€‚å½“è¯·æ±‚è°ƒåº¦çš„äº‹ä»¶å‘ç”Ÿåï¼Œæ‰å¯èƒ½ä¼šè¿è¡Œè¿›ç¨‹è°ƒåº¦ç¨‹åºï¼Œå½“è°ƒåº¦äº†æ–°çš„å°±ç»ªè¿›ç¨‹åï¼Œæ‰ä¼šå»è¿›è¡Œè¿›ç¨‹é—´çš„åˆ‡æ¢ã€‚ ç°åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œä¸èƒ½è¿›è¡Œè¿›ç¨‹çš„è°ƒåº¦ä¸åˆ‡æ¢çš„æƒ…å†µæœ‰ä»¥ä¸‹å‡ ç§ï¼š åœ¨å¤„ç†ä¸­æ–­çš„è¿‡ç¨‹ä¸­ä¸­æ–­å¤„ç†è¿‡ç¨‹å¤æ‚ï¼Œåœ¨å®ç°ä¸Šå¾ˆéš¾åšåˆ°ï¼Œè€Œä¸”ä¸­æ–­å¤„ç†æ—¶ç³»ç»Ÿå·¥ä½œçš„ä¸€éƒ¨åˆ†ï¼Œé€»è¾‘ä¸Šä¸å±äºæŸä¸€è¿›ç¨‹ï¼Œä¸åº”è¢«å‰¥å¤ºå¤„ç†å™¨èµ„æºã€‚ è¿›ç¨‹åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸ç¨‹åºä¸´ç•ŒåŒºä¸­è¿›å…¥ä¸´ç•ŒåŒºåï¼Œéœ€è¦ç‹¬å å¼çš„è®¿é—®å…±äº«æ•°æ®ï¼Œç†è®ºä¸Šå¿…é¡»åŠ é”ï¼Œä»¥é˜²æ­¢å…¶ä»–å¹¶è¡Œç¨‹åºçš„è¿›å…¥ï¼Œåœ¨è§£é”å‰ä¸åº”è¯¥åˆ‡æ¢åˆ°å…¶ä»–è¿›ç¨‹ï¼Œä»¥åŠ å¿«è¯¥å…±äº«æ•°æ®çš„é‡Šæ”¾ã€‚ å…¶ä»–éœ€è¦å®Œå…¨å±è”½ä¸­æ–­çš„åŸå­æ“ä½œè¿‡ç¨‹ä¸­å¦‚åŠ é”ã€è§£é”ã€ä¸­æ–­ç°åœºä¿æŠ¤ã€æ¢å¤ç­‰æºè‡ªæ“ä½œã€‚åœ¨åŸå­è¿‡ç¨‹ä¸­ï¼Œè¿ä¸­æ–­éƒ½è¦å±è”½ï¼Œæ›´ä¸åº”è¯¥è¿›è¡Œè¿›ç¨‹çš„åˆ‡æ¢ã€‚ å¦‚æœåœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼•èµ·è°ƒåº¦çš„æ¡ä»¶ï¼Œå¹¶ä¸èƒ½é©¬ä¸Šè¿›è¡Œè°ƒåº¦å’Œåˆ‡æ¢ï¼Œåº”ç½®ç³»ç»Ÿè¯·æ±‚è°ƒåº¦æ ‡å¿—ï¼Œç›´åˆ°ä¸Šè¿°è¿‡ç¨‹ç»“æŸåæ‰èƒ½è¿›è¡Œç›¸åº”çš„è°ƒåº¦å’Œåˆ‡æ¢ã€‚ åº”è¯¥è¿›è¡Œè¿›ç¨‹çš„è°ƒåº¦ä¸åˆ‡æ¢çš„æƒ…å†µæœ‰ï¼š å½“å‘ç”Ÿå¼•èµ·è°ƒåº¦æ¡ä»¶ä¸”å½“å‰è¿›ç¨‹æ— æ³•ç»§ç»­è¿è¡Œä¸‹å»æ—¶å¯ä»¥é©¬ä¸Šè¿›è¡Œè°ƒåº¦ä¸åˆ‡æ¢ã€‚å¦‚æœæ“ä½œç³»ç»Ÿåªåœ¨è¿™ç§æƒ…å†µä¸‹è¿›è¡Œè¿›ç¨‹è°ƒåº¦ï¼Œå°±æ˜¯éå‰¥å¤ºè°ƒåº¦ã€‚ å½“ä¸­æ–­å¤„ç†ç»“æŸåæˆ–è‡ªé™·å¤„ç†ç»“æŸåè¿”å›è¢«ä¸­æ–­è¿›ç¨‹çš„ç”¨æˆ·æ€ç¨‹åºæ‰§è¡Œç°åœºå‰ï¼Œè‹¥ç½®ä¸Šè¯·æ±‚è°ƒåº¦æ ‡å¿—ï¼Œå³å¯é©¬ä¸Šè¿›è¡Œè¿›ç¨‹è°ƒåº¦ä¸åˆ‡æ¢ã€‚å¦‚æœæ“ä½œç³»ç»Ÿæ”¯æŒè¿™ç§æƒ…å†µä¸‹çš„è¿è¡Œè°ƒåº¦ç¨‹åºï¼Œå°±å®ç°äº†å‰¥å¤ºæ–¹å¼çš„è°ƒåº¦ã€‚ è¿›ç¨‹åˆ‡æ¢å¾€å¾€åœ¨è°ƒåº¦å®Œæˆåç«‹åˆ»å‘ç”Ÿï¼Œå®ƒè¦æ±‚ä¿å­˜æºè¿›ç¨‹å½“å‰åˆ‡æ¢ç‚¹çš„å¿åŸä¿¡æ¯ï¼Œæ¢å¤è¢«è°ƒåº¦è¿›ç¨‹çš„ç°åœºä¿¡æ¯ã€‚ç°åœºåˆ‡æ¢æ—¶ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸å°†è¿œè¿‘ç¨‹çš„ç°åœºä¿¡æ¯æ¨å…¥åˆ°å½“å‰è¿›ç¨‹çš„å†…æ ¸å¯¹æˆ˜æ¥ä¿å­˜å®ƒä»¬ï¼Œå¹¶æ›´æ–°å †æ ˆæŒ‡é’ˆã€‚å†…æ ¸å®Œæˆä»æ–°è¿›ç¨‹çš„å†…æ ¸æ ˆä¸­è£…å…¥æ–°è¿›ç¨‹çš„å¿åŸä¿¡æ¯ã€æ›´æ–°å½“å‰è¿è¡Œè¿›ç¨‹ç©ºé—´æŒ‡é’ˆã€é‡è®¾ PC å¯„å­˜å™¨ç­‰ç›¸å…³å·¥ä½œä¹‹åï¼Œå¼€å§‹è¿è¡Œæ–°çš„è¿›ç¨‹ã€‚ 3. è¿›ç¨‹è°ƒåº¦æ–¹å¼æ‰€è°“è¿›ç¨‹è°ƒåº¦æ–¹å¼æ˜¯æŒ‡å½“æŸä¸€ä¸ªè¿›ç¨‹æ­£åœ¨å¤„ç†å™¨ä¸Šæ‰§è¡Œæ—¶ï¼Œè‹¥æœ‰æŸä¸ªæ›´ä¸ºé‡è¦æˆ–ç´§è¿«çš„è¿›ç¨‹éœ€è¦å¤„ç†ï¼Œæ—¢æœ‰ä¼˜å…ˆæƒæ›´é«˜çš„è¿›ç¨‹è¿›å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œæ­¤æ—¶åº”å¦‚ä½•åˆ†é…å¤„ç†å™¨ã€‚é€šå¸¸æœ‰ä»¥ä¸‹ä¸¤ç§è¿›ç¨‹è°ƒåº¦æ–¹å¼ï¼š éå‰¥å¤ºè°ƒåº¦æ–¹å¼éå‰¥å¤ºè°ƒåº¦æ–¹å¼åˆç§°ä¸ºéæŠ¢å è°ƒåº¦æ–¹å¼ï¼Œæ˜¯æŒ‡å½“ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨å¤„ç†å™¨ä¸Šæ‰§è¡Œæ—¶ï¼Œå³ä½¿æœ‰æŸä¸ªæ›´ä¸ºé‡è¦æˆ–ç´§è¿«çš„è¿›ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œä»ç„¶è®©æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°è¯¥è¿›ç¨‹å®Œæˆæˆ–å‘ç”ŸæŸç§äº‹ä»¶è€Œè¿›å…¥é˜»å¡çŠ¶æ€æ—¶ï¼Œæ‰æŠŠå¤„ç†å™¨åˆ†é…ç»™æ›´ä¸ºé‡è¦æˆ–ç´§è¿«çš„è¿›ç¨‹ã€‚ å‰¥å¤ºè°ƒåº¦æ–¹å¼ å‰¥å¤ºè°ƒåº¦æ–¹å¼åˆç§°ä¸ºæŠ¢å æ–¹å¼ï¼Œæ˜¯æŒ‡å½“ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨å¤„ç†å™¨ä¸Šæ‰§è¡Œæ—¶ï¼Œè‹¥æœ‰æŸä¸ªæ›´ä¸ºé‡è¦æˆ–ç´§è¿«çš„è¿›ç¨‹éœ€è¦ä½¿ç”¨å¤„ç†å™¨ï¼Œåˆ™ç«‹å³æš‚åœæ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ï¼Œå°†å¤„ç†å™¨åˆ†é…ç»™è¿™ä¸ªæ›´ä¸ºé‡è¦æˆ–ç´§è¿«çš„è¿›ç¨‹ã€‚ â€œå‰¥å¤ºâ€ä¸æ˜¯ä¸€ç§ä»»æ„æ€§è¡Œä¸ºï¼Œå¿…é¡»éµå¾ªä¸€å®šçš„åŸåˆ™ï¼šä¼˜å…ˆæƒåŸåˆ™ã€çŸ­è¿›ç¨‹ä¼˜å…ˆåŸåˆ™å’Œæ—¶é—´ç‰‡åŸåˆ™ã€‚ 4. è°ƒåº¦çš„åŸºæœ¬å‡†åˆ™ä¸åŒçš„è°ƒåº¦ç®—æ³•å…·æœ‰ä¸åŒçš„ç‰¹æ€§ï¼Œåœ¨é€‰æ‹©è°ƒåº¦ç®—æ³•æ—¶ï¼Œå¿…é¡»è€ƒè™‘ç®—æ³•æ‰€å…·æœ‰çš„ç‰¹æ€§ã€‚ä¸ºäº†æ¯”è¾ƒå¤„ç†å™¨è°ƒåº¦ç®—æ³•çš„æ€§èƒ½ï¼Œäººä»¬æå‡ºå¾ˆå¤šè¯„ä»·å‡†åˆ™ï¼Œä¸‹é¢ä»‹ç»ä¸»è¦çš„å‡ ç§å‡†åˆ™ï¼š CPU åˆ©ç”¨ç‡ CPU æ˜¯è®¡ç®—æœºç³»ç»Ÿä¸­æœ€é‡è¦çš„èµ„æºä¹‹ä¸€ï¼Œæ‰€ä»¥åº”å°½å¯èƒ½ä½¿ CPU ä¿æŒåœ¨å¿™çŠ¶æ€ï¼Œä»¥æé«˜è¿™ä¸€èµ„æºåˆ©ç”¨ç‡æœ€é«˜ã€‚ ç³»ç»Ÿååé‡ ç³»ç»Ÿååé‡è¡¨ç¤ºå•ä½æ—¶é—´å†… CPU å®Œæˆä½œä¸šçš„æ•°é‡ã€‚é•¿ä½œä¸šéœ€è¦æ¶ˆè€—è¾ƒé•¿çš„å¤„ç†å™¨æ—¶é—´ï¼Œå› æ­¤ä¼šé™ä½ç³»ç»Ÿçš„ååé‡ã€‚è€Œå¯¹äºçŸ­ä½œä¸šï¼Œä»–ä»¬æ‰€éœ€è¦æ¶ˆè€—çš„å¤„ç†å™¨æ—¶é—´çŸ­ï¼Œå› æ­¤èƒ½æé«˜ç³»ç»Ÿçš„ååé‡ã€‚è°ƒåº¦ç®—æ³•å’Œæ–¹å¼çš„ä¸åŒï¼Œä¹Ÿä¼šå¯¹ç³»ç»Ÿçš„ååé‡äº§ç”Ÿè¾ƒå¤§çš„å½±å“ã€‚ å‘¨è½¬æ—¶é—´ å‘¨è½¬æ—¶é—´æ˜¯æŒ‡ä»ä½œä¸šæäº¤åˆ°ä½œä¸šå®Œæˆæ‰€ç»å†çš„æ—¶é—´ï¼ŒåŒ…æ‹¬ä½œä¸šç­‰å¾…ã€åœ¨å°±ç»ªé˜Ÿåˆ—ä¸­æ’é˜Ÿã€åœ¨å¤„ç†å™¨ä¸Šè¿è¡Œä»¥åŠè¿›è¡Œè¾“å…¥è¾“å‡ºæ“ä½œæ‰€èŠ±è´¹çš„æ—¶é—´çš„æ€»å’Œã€‚ ä½œä¸šçš„å‘¨è½¬æ—¶é—´ä½œä¸šå®Œæˆæ—¶é—´-ä½œä¸šæäº¤æ—¶é—´ã€‚ ç­‰å¾…æ—¶é—´ ç­‰å¾…æ—¶é—´æ˜¯æŒ‡è¿›ç¨‹å¤„äºç­‰å¤„ç†å™¨çŠ¶æ€æ—¶é—´ä¹‹å’Œï¼Œç­‰å¾…æ—¶é—´è¶Šé•¿ï¼Œç”¨æˆ·æ»¡æ„åº¦è¶Šä½ã€‚å¤„ç†å™¨è°ƒåº¦ç®—æ³•å®é™…ä¸Šå¹¶ä¸å½±å“ä½œä¸šæ‰§è¡Œæˆ–è¾“å…¥è¾“å‡ºæ“ä½œæ—¶é—´ï¼Œåªå½±å“ä½œä¸šåœ¨å°±ç»ªé˜Ÿåˆ—ä¸­ç­‰å¾…æ‰€èŠ±çš„æ—¶é—´ã€‚å› æ­¤ï¼Œè¡¡é‡ä¸€ä¸ªè°ƒåº¦ç®—æ³•ä¼˜åŠ£å¸¸å¸¸åªéœ€ç®€å•åœ°è€ƒå¯Ÿç­‰å¾…æ—¶é—´ã€‚ å“åº”æ—¶é—´ å“åº”æ—¶é—´æ˜¯æŒ‡ä»ç”¨æˆ·æäº¤è¯·æ±‚åˆ°ç³»ç»Ÿé¦–æ¬¡äº§ç”Ÿå“åº”çš„æ—¶é—´ã€‚åœ¨äº¤äº’å¼ç³»ç»Ÿä¸­ï¼Œå‘¨è½¬æ—¶é—´ä¸å¯èƒ½æ˜¯æœ€å¥½çš„è¯„æµ‹å‡†åˆ™ï¼Œä¸€èˆ¬é‡‡ç”¨å“åº”æ—¶é—´ä½œä¸ºè¡¡é‡è°ƒåº¦ç®—æ³•çš„é‡è¦å‡†åˆ™ä¹‹ä¸€ã€‚ä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œè°ƒåº¦ç­–ç•¥åº”å°½é‡é™ä½å“åº”æ—¶é—´ï¼Œä½¿å“åº”æ—¶é—´å¤„åœ¨ç”¨æˆ·èƒ½å¤Ÿæ¥å—çš„èŒƒå›´ä¹‹å†…ã€‚ 5. å…¸å‹çš„è°ƒåº¦ç®—æ³•é€šå¸¸ç³»ç»Ÿçš„è®¾è®¡ç›®æ ‡ä¸åŒï¼Œæ‰€é‡‡ç”¨çš„è°ƒåº¦ç®—æ³•ä¹Ÿä¸åŒã€‚åœ¨æ“ä½œç³»ç»Ÿä¸­å­˜åœ¨å¤šç§è°ƒåº¦ç®—æ³•ï¼Œå…¶ä¸­æœ‰çš„è°ƒåº¦ç®—æ³•é€‚ç”¨äºä½œä¸šè°ƒåº¦ï¼Œæœ‰çš„è°ƒåº¦ç®—æ³•é€‚ç”¨äºè¿›ç¨‹è°ƒåº¦ï¼Œæœ‰çš„è°ƒåº¦ç®—æ³•ä¸¤è€…éƒ½é€‚ç”¨ã€‚ä¸‹é¢ä»‹ç»å‡ ç§å¸¸ç”¨çš„è°ƒåº¦ç®—æ³•ï¼š FCFSï¼ˆå…ˆæ¥å…ˆæœåŠ¡ï¼‰è°ƒåº¦ç®—æ³• ç‰¹ç‚¹ï¼šç®—æ³•ç®€å•ï¼Œä½†æ˜¯æ•ˆç‡ä½ï¼›æœ‰åˆ©äºé•¿ä½œä¸šï¼Œä¸åˆ©äºçŸ­ä½œä¸šï¼›æœ‰åˆ©äº CPU ç¹å¿™å‹ä½œä¸šè€Œä¸åˆ©äº IO ç¹å¿™å‹ä½œä¸šã€‚ SJFï¼ˆçŸ­ä½œä¸šä¼˜å…ˆï¼‰è°ƒåº¦ç®—æ³• çŸ­ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰ä¼˜å…ˆè°ƒåº¦ç®—æ³•æ˜¯æŒ‡å¯¹çŸ­ä½œä¸šæˆ–è¿›ç¨‹ä¼˜å…ˆè°ƒåº¦çš„ç®—æ³•ã€‚çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•æ˜¯ä»åå¤‡é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªæˆ–è‹¥å¹²ä¸ªä¼°è®¡è¿è¡Œæ—¶é—´æœ€çŸ­çš„ä½œä¸šï¼Œå°†å®ƒä»¬æ”¾å…¥å†…å­˜è¿è¡Œã€‚ SJF è°ƒåº¦ç®—æ³•çš„ç¼ºç‚¹ï¼š å¯¹é•¿ä½œä¸šä¸åˆ©ã€‚ å®Œå…¨æœªè€ƒè™‘ä½œä¸šçš„ç´§è¿«ç¨‹åº¦ã€‚ ç”±äºä½œä¸šçš„é•¿çŸ­åªæ ¹æ®ç”¨æˆ·æ‰€æä¾›çš„ä¼°è®¡æ‰§è¡Œæ—¶é—´è€Œå®šçš„ï¼Œè€Œç”¨æˆ·åˆå¯èƒ½ä¼šæœ‰æ„æˆ–æ— æ„åœ°ç¼©çŸ­å…¶ä½œä¸šçš„ä¼°è®¡è¿è¡Œæ—¶é—´ï¼Œè‡´ä½¿è¯¥ç®—æ³•ä¸ä¸€å®šèƒ½çœŸæ­£åšåˆ°çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ã€‚ æ³¨æ„ï¼šSJF è°ƒåº¦ç®—æ³•çš„å¹³å‡ç­‰å¾…æ—¶é—´ã€å¹³å‡å‘¨è½¬æ—¶é—´æœ€å°‘ã€‚ ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³• æ ¹æ®è¿›ç¨‹çš„ä¼˜å…ˆçº§æ¥å†³å®šè°ƒåº¦é¡ºåºã€‚ä¼˜å…ˆçº§å¯ä»¥æ˜¯é™æ€çš„ï¼ˆåœ¨ä½œä¸šæäº¤æ—¶ç¡®å®šï¼‰æˆ–åŠ¨æ€çš„ï¼ˆæ ¹æ®ç³»ç»Ÿæƒ…å†µå˜åŒ–ï¼‰ã€‚ é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³• é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•ä¸»è¦ç”¨äºä½œä¸šè°ƒåº¦ã€‚åŒæ—¶è€ƒè™‘ä»æ¯ä¸ªä½œä¸šçš„ç­‰å¾…æ—¶é—´å’Œä¼°è®¡éœ€è¦è¿è¡Œçš„æ—¶é—´ã€‚ æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³• æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•ä¸»è¦é€‚ç”¨äºåˆ†æ—¶ç³»ç»Ÿã€‚æ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œæ—¶é—´ç‰‡ç»“æŸåè½®è½¬åˆ°ä¸‹ä¸€ä¸ªè¿›ç¨‹ã€‚ å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³• å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•ä¸»è¦æ˜¯æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•å’Œä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•çš„ç»¼åˆå’Œå‘å±•ã€‚é€šè¿‡åŠ¨æ€è°ƒæ•´è¿›ç¨‹ä¼˜å…ˆçº§å’Œæ—¶é—´ç‰‡å¤§å°ï¼Œå¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•å¯ä»¥å…¼é¡¾å¤šæ–¹é¢çš„ç³»ç»Ÿç›®æ ‡ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","è¿›ç¨‹çº¿ç¨‹"]},{"title":"ä¿¡å·é‡","path":"/2025/03/07/1-å¹³å°ç³»ç»Ÿ-Linux-è¿›ç¨‹çº¿ç¨‹-ä¿¡å·é‡/","content":"System V è¿›ç¨‹é—´é€šä¿¡ï¼šä¿¡å·é‡ï¼ˆSemaphoresï¼‰System V ä¿¡å·é‡æ˜¯ä¸€ç§ç”¨äºè¿›ç¨‹é—´åŒæ­¥çš„æœºåˆ¶ï¼Œé€šè¿‡æä¾›ä¸€ç§æ›´é«˜çº§çš„æ–¹å¼æ¥è§£å†³èµ„æºäº‰å¤ºé—®é¢˜ã€‚æœ¬èŠ‚æ·±å…¥æ¢è®¨ System V ä¿¡å·é‡çš„ä½¿ç”¨æ–¹å¼ã€API æ¥å£åŠå…¶åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨åœºæ™¯ã€‚ ä¿¡å·é‡æ¦‚è¿°ä¿¡å·é‡æ˜¯ System V IPC ä¸­æä¾›çš„ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œä¸»è¦ç”¨äºè§£å†³è¿›ç¨‹é—´äº’æ–¥ä¸åŒæ­¥é—®é¢˜ã€‚ç›¸æ¯”äº POSIX çº¿ç¨‹ä¿¡å·é‡ï¼ˆå¦‚ sem_initã€sem_waitã€sem_post å’Œ sem_destroyï¼‰ï¼ŒSystem V ä¿¡å·é‡åœ¨è¿›ç¨‹é—´é€šä¿¡ä¸­æä¾›äº†æ›´å¤æ‚çš„åŠŸèƒ½ã€‚ System V ä¿¡å·é‡æ ¸å¿ƒå‡½æ•° semget åŠŸèƒ½ï¼šåˆå§‹åŒ–æˆ–è·å–ä¿¡å·é‡é›† ç›¸å½“äº POSIX çš„ sem_init semop åŠŸèƒ½ï¼šæ‰§è¡Œ P æ“ä½œæˆ– V æ“ä½œ ç›¸å½“äº POSIX çš„ sem_wait å’Œ sem_post semctl åŠŸèƒ½ï¼šæ§åˆ¶ä¿¡å·é‡é›†ï¼Œä¾‹å¦‚è·å–çŠ¶æ€ã€è®¾ç½®å€¼æˆ–åˆ é™¤ä¿¡å·é‡é›† ç›¸å½“äº POSIX çš„ sem_destroy ä¸»è¦åŒºåˆ« System V ä¿¡å·é‡æ”¯æŒä¸€æ¬¡æ“ä½œå¤šä¸ªä¿¡å·ç¯ï¼ŒåŠŸèƒ½æ›´ä¸ºå¤æ‚ã€‚ ä¿¡å·é‡ API è¯¦è§£semget å‡½æ•°ç”¨é€”ï¼š åˆå§‹åŒ–æˆ–è·å–ä¸€ä¸ªä¿¡å·é‡é›†ã€‚ å‡½æ•°åŸå‹int semget(key_t key, int nsems, int semflg) å‚æ•° å‚æ•°å è¯´æ˜ key ä¿¡å·é‡é›†å…³è”çš„é”®å€¼ï¼Œå¤šä¸ªè¿›ç¨‹å¯ä»¥é€šè¿‡ç›¸åŒçš„ key è®¿é—®åŒä¸€ä¸ªä¿¡å·é‡é›† nsems ä¿¡å·é‡é›†ä¸­åŒ…å«çš„ä¿¡å·ç¯æ•°ç›® semflg ä¿¡å·é‡é›†çš„è®¿é—®æƒé™ï¼Œé€šå¸¸ä¸º IPC_CREAT è¿”å›å€¼ æˆåŠŸï¼š è¿”å›ä¿¡å·é‡é›† ID å¤±è´¥ï¼š è¿”å›-1 ç¤ºä¾‹#include sys/types.h#include sys/ipc.h#include sys/sem.hkey_t key = ftok(pathname, 0); // ä½¿ç”¨ftokè·å–ä¸€ä¸ªé”®å€¼int nsems = 1; // å®šä¹‰ä¸€ä¸ªä¿¡å·ç¯int sem_id = semget(key, nsems, IPC_CREAT | 0666);if (sem_id == -1) perror(semget failed); exit(EXIT_FAILURE); semop å‡½æ•°ç”¨é€”ï¼š å¯¹ä¿¡å·é‡æ‰§è¡Œ P æ“ä½œæˆ– V æ“ä½œã€‚ å‡½æ•°åŸå‹int semop(int semid, struct sembuf *opsptr, size_t nops) å‚æ•° å‚æ•°å è¯´æ˜ semid ä¿¡å·é‡é›† ID opsptr å­˜å‚¨æ“ä½œçš„ sembuf ç»“æ„ä½“æ•°ç»„ nops è¦æ‰§è¡Œçš„æ“ä½œæ•° sembuf ç»“æ„ä½“struct sembuf short sem_num; // è¦æ“ä½œçš„ä¿¡å·ç¯ç¼–å· short sem_op; // æ“ä½œç±»å‹ï¼ˆæ­£æ•°ï¼šVæ“ä½œï¼›è´Ÿæ•°ï¼šPæ“ä½œï¼›0ï¼šç­‰å¾…ä¿¡å·ç¯å€¼ä¸º0ï¼‰ short sem_flg; // æ ‡å¿—ä½ï¼Œå¸¸ç”¨`0`ã€`IPC_NOWAIT`æˆ–`SEM_UNDO`; è¿”å›å€¼ æˆåŠŸï¼š è¿”å› 0 å¤±è´¥ï¼š è¿”å›-1 ç¤ºä¾‹struct sembuf sops[2];int sem_id = ...; // å‡è®¾sem_idå·²åˆå§‹åŒ–// æ“ä½œ1ï¼šç­‰å¾…ä¿¡å·ç¯0å˜ä¸º0sops[0].sem_num = 0;sops[0].sem_op = 0; // ç­‰å¾…åˆ°ä¿¡å·ç¯çš„å€¼å˜ä¸º0sops[0].sem_flg = 0;// æ“ä½œ2ï¼šå¯¹ä¿¡å·ç¯0æ‰§è¡ŒVæ“ä½œsops[1].sem_num = 0;sops[1].sem_op = 1; // å¢åŠ 1ï¼Œé‡Šæ”¾èµ„æºsops[1].sem_flg = 0;if (semop(sem_id, sops, 2) == -1) perror(semop failed); exit(EXIT_FAILURE); æ³¨æ„äº‹é¡¹ SEM_UNDO æ ‡å¿—ï¼šå½“è¿›ç¨‹æ„å¤–ç»ˆæ­¢æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾æ‰€æœ‰è·å¾—çš„ä¿¡å·é‡ã€‚ç¤ºä¾‹ï¼š sops[1].sem_flg = SEM_UNDO; é¿å…æ­»é”ï¼šä½¿ç”¨ sem_flg ä¸º IPC_NOWAIT æ—¶ï¼Œä¼šç«‹å³è¿”å›è€Œä¸ä¼šé˜»å¡ï¼š sops[0].sem_flg = IPC_NOWAIT; semctl å‡½æ•°ç”¨é€”ï¼š æ§åˆ¶ä¿¡å·é‡é›†ï¼Œæ‰§è¡Œå¦‚è·å–çŠ¶æ€ã€è®¾ç½®å€¼ã€åˆ é™¤ä¿¡å·é‡ç­‰æ“ä½œã€‚ å‡½æ•°åŸå‹int semctl(int semid, int semnum, int cmd, ...) å‚æ•° å‚æ•°å è¯´æ˜ semid ä¿¡å·é‡é›† ID semnum è¦æ“ä½œçš„ä¿¡å·ç¯ç¼–å· cmd æ“ä½œå‘½ä»¤ï¼Œå¸¸ç”¨ï¼š - `GETVAL`ï¼šè·å–ä¿¡å·ç¯å€¼ - `SETVAL`ï¼šè®¾ç½®ä¿¡å·ç¯åˆå§‹å€¼ - `IPC_RMID`ï¼šåˆ é™¤ä¿¡å·é‡é›† | è¿”å›å€¼ æˆåŠŸï¼š è¿”å› 0 å¤±è´¥ï¼š è¿”å›-1 ç¤ºä¾‹// è®¾ç½®ä¿¡å·ç¯0çš„å€¼ä¸º3union semun sem_union;sem_union.val = 3;if (semctl(sem_id, 0, SETVAL, sem_union) == -1) perror(semctl failed); exit(EXIT_FAILURE); union semun å®šä¹‰union semun int val; // ç”¨äºSETVAL struct semid_ds *buf; // ç”¨äºIPC_STATå’ŒIPC_SET unsigned short *array; // ç”¨äºGETALLå’ŒSETALL struct seminfo *__buf; // ç”¨äºIPC_INFO; ä½¿ç”¨åœºæ™¯ç¤ºä¾‹ä¿è¯ç¨‹åºåªè¿è¡Œä¸€æ¬¡ä¸€ä¸ªå¸¸è§çš„ä½¿ç”¨åœºæ™¯æ˜¯ç¡®ä¿æŸä¸ªç¨‹åºåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶åªèƒ½è¿è¡Œä¸€æ¬¡ã€‚ #include sys/types.h#include sys/ipc.h#include sys/sem.h#include unistd.hint main() key_t key = ftok(pathname, 0); int sem_id = semget(key, 1, IPC_CREAT | 0666); // ä½¿ç”¨semopè·å–ä¿¡å·é‡ struct sembuf sops; sops.sem_num = 0; sops.sem_op = 0; // ç­‰å¾…ä¿¡å·ç¯å˜ä¸º0 sops.sem_flg = SEM_UNDO; if (semop(sem_id, sops, 1) == 0) // ä¿¡å·ç¯è·å¾—æˆåŠŸï¼Œè¿è¡Œç¨‹åº // ... ä½ ä»¬çš„ä»£ç  ... // é‡Šæ”¾ä¿¡å·ç¯ sops.sem_op = 1; semop(sem_id, sops, 1); else // ä¿¡å·ç¯å·²è¢«å ç”¨ï¼Œå½“å‰ç¨‹åºå·²è¿è¡Œ printf(Program already running! ); return 0; æœ€ä½³å®è·µ åˆå§‹åŒ–ä¿¡å·é‡ï¼šåœ¨ä½¿ç”¨ä¿¡å·é‡ä¹‹å‰ï¼Œå¿…é¡»åˆå§‹åŒ–ä¿¡å·é‡çš„å€¼ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ semctl çš„ SETVAL å‘½ä»¤è®¾ç½®åˆå§‹å€¼ã€‚ é¿å…èµ„æºæ³„æ¼ï¼šä½¿ç”¨ SEM_UNDO æ ‡å¿—ï¼Œç¡®ä¿è¿›ç¨‹æ„å¤–ç»ˆæ­¢æ—¶è‡ªåŠ¨é‡Šæ”¾ä¿¡å·é‡ã€‚ åŠæ—¶æ¸…ç†ï¼šä½¿ç”¨ IPC_RMID å‘½ä»¤åˆ é™¤ä¸å†éœ€è¦çš„ä¿¡å·é‡é›†ã€‚ é€šè¿‡ä»¥ä¸Šè¯¦ç»†ä»‹ç»ï¼Œå¼€å‘è€…å¯ä»¥æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ System V ä¿¡å·é‡ï¼Œè§£å†³è¿›ç¨‹é—´çš„åŒæ­¥é—®é¢˜ã€‚å¦‚æœä½ æœ‰æ›´å¤šé—®é¢˜ï¼Œæ¬¢è¿ç•™è¨€è®¨è®ºã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","è¿›ç¨‹çº¿ç¨‹"]},{"title":"æ¶ˆæ¯é˜Ÿåˆ—","path":"/2025/03/07/1-å¹³å°ç³»ç»Ÿ-Linux-è¿›ç¨‹çº¿ç¨‹-æ¶ˆæ¯é˜Ÿåˆ—/","content":"æ¦‚å¿µæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰çš„æœºåˆ¶ï¼Œå…è®¸è¿›ç¨‹é€šè¿‡å‘é€å’Œæ¥æ”¶æ¶ˆæ¯è¿›è¡Œæ•°æ®äº¤æ¢ã€‚å®ƒæ˜¯å†…æ ¸ä¸­çš„ä¸€ä¸ªé“¾è¡¨ï¼Œæ‰€æœ‰è¿›ç¨‹å¯è§ï¼Œé€šè¿‡æ“ä½œè¯¥é“¾è¡¨å®Œæˆé€šä¿¡ã€‚ ç‰¹ç‚¹ æ¶ˆæ¯é“¾è¡¨ï¼šæ¶ˆæ¯é˜Ÿåˆ—æœ¬è´¨ä¸Šæ˜¯å†…æ ¸ä¸­çš„ä¸€ä¸ªé“¾è¡¨ï¼Œè¿›ç¨‹å¯ä»¥åœ¨å…¶ä¸­æ·»åŠ æˆ–ç§»é™¤æ¶ˆæ¯èŠ‚ç‚¹ã€‚ æ¶ˆæ¯ç±»å‹ï¼šæ”¯æŒä¸åŒæ¶ˆæ¯ç±»å‹ï¼Œè¿›ç¨‹å¯é€‰æ‹©æ€§æ¥æ”¶ç‰¹å®šç±»å‹çš„æ¶ˆæ¯ã€‚ åŸå­æ“ä½œï¼šæ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶æ˜¯åŸå­æ“ä½œï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€‚ å¹¿æ³›åº”ç”¨ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯æœ€å¸¸ç”¨çš„è¿›ç¨‹é€šä¿¡æ–¹å¼ä¹‹ä¸€ã€‚ æ¶ˆæ¯ç»“æ„æ¶ˆæ¯ç»“æ„é€šå¸¸åŒ…å«ä¸¤éƒ¨åˆ†ï¼š struct msgbuf long mtype; // æ¶ˆæ¯ç±»å‹ï¼Œå¿…é¡»å¤§äº0 char mtext[N]; // æ¶ˆæ¯æ­£æ–‡; æ“ä½œå‡½æ•°1. åˆ›å»ºæˆ–æ‰“å¼€æ¶ˆæ¯é˜Ÿåˆ—int msgget(key_t key, int msgflg); å‚æ•°ï¼š keyï¼šæ¶ˆæ¯é˜Ÿåˆ—çš„é”®ï¼Œé€šå¸¸ç”± ftok ç”Ÿæˆã€‚ msgflgï¼šæ ‡å¿—ä½ï¼Œç”¨äºæ§åˆ¶åˆ›å»ºè¡Œä¸ºã€‚ è¿”å›å€¼ï¼š æˆåŠŸï¼šæ¶ˆæ¯é˜Ÿåˆ— ID å¤±è´¥ï¼š-1 2. å‘é€æ¶ˆæ¯int msgsnd(int msqid, const void *msgp, size_t size, int flag); å‚æ•°ï¼š msqidï¼šæ¶ˆæ¯é˜Ÿåˆ— IDã€‚ msgpï¼šæ¶ˆæ¯æŒ‡é’ˆï¼ŒæŒ‡å‘ msgbuf ç»“æ„ã€‚ sizeï¼šæ¶ˆæ¯æ­£æ–‡å¤§å°ã€‚ flagï¼šæ§åˆ¶é˜»å¡è¡Œä¸ºã€‚ è¿”å›å€¼ï¼š æˆåŠŸï¼š0 å¤±è´¥ï¼š-1 3. æ¥æ”¶æ¶ˆæ¯ssize_t msgrcv(int msqid, void *msgp, size_t size, long msgtype, int flag); å‚æ•°ï¼š msqidï¼šæ¶ˆæ¯é˜Ÿåˆ— IDã€‚ msgpï¼šæ¥æ”¶ç¼“å†²åŒºæŒ‡é’ˆã€‚ sizeï¼šæ¥æ”¶ç¼“å†²åŒºå¤§å°ã€‚ msgtypeï¼šæ¥æ”¶æ¶ˆæ¯ç±»å‹ã€‚ flagï¼šæ§åˆ¶é˜»å¡è¡Œä¸ºã€‚ è¿”å›å€¼ï¼š æˆåŠŸï¼šæ¥æ”¶æ¶ˆæ¯é•¿åº¦ å¤±è´¥ï¼š-1 4. æ§åˆ¶æ¶ˆæ¯é˜Ÿåˆ—int msgctl(int msqid, int cmd, struct msqid_ds *buf); å‚æ•°ï¼š msqidï¼šæ¶ˆæ¯é˜Ÿåˆ— IDã€‚ cmdï¼šæ“ä½œå‘½ä»¤ï¼ˆIPC_STATã€IPC_SETã€IPC_RMIDï¼‰ã€‚ bufï¼šæ¶ˆæ¯é˜Ÿåˆ—å±æ€§ç»“æ„æŒ‡é’ˆã€‚ è¿”å›å€¼ï¼š æˆåŠŸï¼š0 å¤±è´¥ï¼š-1 æ¶ˆæ¯é˜Ÿåˆ—ç»“æ„struct msqid_ds struct ipc_perm msg_perm; // æƒé™ä¿¡æ¯ struct msg *msg_first; // é˜Ÿåˆ—ç¬¬ä¸€ä¸ªæ¶ˆæ¯ struct msg *msg_last; // é˜Ÿåˆ—æœ€åä¸€ä¸ªæ¶ˆæ¯ __kernel_time_t msg_stime; // æœ€åå‘é€æ—¶é—´ __kernel_time_t msg_rtime; // æœ€åæ¥æ”¶æ—¶é—´ __kernel_time_t msg_ctime; // æœ€åä¿®æ”¹æ—¶é—´ unsigned long msg_lcbytes; // å¾ªç¯å­—æ®µ unsigned long msg_lqbytes; // å¾ªç¯å­—æ®µ unsigned short msg_cbytes; // å½“å‰é˜Ÿåˆ—å­—èŠ‚æ•° unsigned short msg_qnum; // æ¶ˆæ¯æ•°é‡ unsigned short msg_qbytes; // æœ€å¤§é˜Ÿåˆ—å­—èŠ‚æ•° __kernel_ipc_pid_t msg_lspid; // æœ€åå‘é€è¿›ç¨‹ID __kernel_ipc_pid_t msg_lrpid; // æœ€åæ¥æ”¶è¿›ç¨‹ID; ä¼˜åŠ¿ é¿å…ä¸´ç•ŒåŒºä¿æŠ¤ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ— éœ€é¢å¤–çš„åŒæ­¥æœºåˆ¶ã€‚ é€‰æ‹©æ€§æ¥æ”¶ï¼šé€šè¿‡æ¶ˆæ¯ç±»å‹å®ç°ç²¾å‡†æ¥æ”¶ã€‚ æ¶ˆæ¯å®Œæ•´æ€§ï¼šä¿è¯æ¶ˆæ¯åŸå­æ€§ï¼Œé¿å…æ•°æ®æŸåã€‚ ç¤ºä¾‹å‘é€è¿›ç¨‹ï¼ˆsend.cï¼‰#include stdio.h#include stdlib.h#include sys/types.h#include sys/ipc.h#include sys/msg.h#define MSGKEY 1024#define MSG_SIZE 2048struct msgstru long msgtype; char msgtext[MSG_SIZE];;int main() struct msgstru msgs; int msqid; int msg_type; char str[256]; // è·å–æ¶ˆæ¯é˜Ÿåˆ— msqid = msgget(MSGKEY, IPC_EXCL); if (msqid 0) // åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ— msqid = msgget(MSGKEY, IPC_CREAT | 0666); if (msqid 0) perror(msgget failed); exit(EXIT_FAILURE); while (1) printf(è¾“å…¥æ¶ˆæ¯ç±»å‹ï¼ˆ0ç»“æŸï¼‰ï¼š); scanf(%d, msg_type); if (msg_type == 0) break; printf(è¾“å…¥æ¶ˆæ¯å†…å®¹ï¼š); scanf(%s, str); msgs.msgtype = msg_type; strcpy(msgs.msgtext, str); // å‘é€æ¶ˆæ¯ if (msgsnd(msqid, msgs, sizeof(struct msgstru), IPC_NOWAIT) 0) perror(msgsnd failed); exit(EXIT_FAILURE); // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ— msgctl(msqid, IPC_RMID, NULL); return 0; æ¥æ”¶è¿›ç¨‹ï¼ˆreceive.cï¼‰#include stdio.h#include stdlib.h#include unistd.h#include sys/types.h#include sys/ipc.h#include sys/msg.h#define MSGKEY 1024#define MSG_SIZE 2048struct msgstru long msgtype; char msgtext[MSG_SIZE];;void childproc() struct msgstru msgs; int msgid; int ret_value; while (1) // è·å–æ¶ˆæ¯é˜Ÿåˆ— msgid = msgget(MSGKEY, IPC_EXCL); if (msgid 0) printf(æ¶ˆæ¯é˜Ÿåˆ—ä¸å­˜åœ¨ï¼Œ5ç§’åé‡è¯•... ); sleep(5); continue; // æ¥æ”¶æ¶ˆæ¯ ret_value = msgrcv(msgid, msgs, sizeof(struct msgstru), 0, 0); if (ret_value 0) perror(msgrcv failed); continue; printf(æ¥æ”¶æ¶ˆæ¯ï¼š%sï¼Œè¿›ç¨‹IDï¼š%d , msgs.msgtext, getpid()); int main() int i; pid_t cpid; for (i = 0; i 5; ++i) cpid = fork(); if (cpid == -1) perror(fork failed); exit(EXIT_FAILURE); else if (cpid == 0) childproc(); return 0; æ³¨æ„äº‹é¡¹ æƒé™è®¾ç½®ï¼šç¡®ä¿æ¶ˆæ¯é˜Ÿåˆ—æƒé™ï¼ˆå¦‚ 0666ï¼‰å…è®¸é€‚å½“çš„è®¿é—®ã€‚ é”™è¯¯å¤„ç†ï¼šæ£€æŸ¥å‡½æ•°è¿”å›å€¼ï¼Œå¤„ç†å¯èƒ½çš„é”™è¯¯ã€‚ ç±»å‹åŒ¹é…ï¼šå‘é€å’Œæ¥æ”¶æ—¶ç¡®ä¿ msgtype åŒ¹é…ã€‚ å†…å­˜ç®¡ç†ï¼šé¿å…å†…å­˜æ³„æ¼ï¼Œæ­£ç¡®å¤„ç†æ¥æ”¶ç¼“å†²åŒºã€‚ é€šè¿‡ä»¥ä¸Šè¯¦ç»†è¯´æ˜å’Œç¤ºä¾‹ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„ä½¿ç”¨å’Œä¼˜åŠ¿æ›´åŠ æ¸…æ™°ï¼Œé€‚ç”¨äºéœ€è¦å¯é è¿›ç¨‹é—´é€šä¿¡çš„åœºæ™¯ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","è¿›ç¨‹çº¿ç¨‹"]},{"title":"è¿›ç¨‹é—´é€šè®¯","path":"/2025/03/07/1-å¹³å°ç³»ç»Ÿ-Linux-è¿›ç¨‹çº¿ç¨‹-è¿›ç¨‹é—´é€šè®¯/","content":"è¿›ç¨‹é—´é€šä¿¡è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ ç®¡é“ï¼ˆpipeï¼‰ ç‰¹ç‚¹ï¼šç”¨äºå…·æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡ï¼Œæ•°æ®åœ¨å†…å­˜ä¸­ä¼ è¾“ã€‚ ç‰¹æ€§ï¼šå•å·¥é€šä¿¡ï¼Œæ•°æ®åªèƒ½å•å‘æµåŠ¨ã€‚ åº”ç”¨åœºæ™¯ï¼šå¸¸ç”¨äºçˆ¶å­è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ä¾‹å¦‚ï¼Œçˆ¶è¿›ç¨‹é€šè¿‡ pipe å°†æ•°æ®ä¼ é€’ç»™å­è¿›ç¨‹ã€‚ å‘½åç®¡é“ï¼ˆFIFOï¼‰ ç‰¹ç‚¹ï¼šå¯ç”¨äºä»»æ„è¿›ç¨‹é—´é€šä¿¡ï¼Œæ•°æ®åœ¨å†…å­˜ä¸­ä¼ è¾“ã€‚ ç‰¹æ€§ï¼šåŒå·¥é€šä¿¡ï¼Œéœ€è¦æœ‰æ–‡ä»¶åã€‚ åº”ç”¨åœºæ™¯ï¼šé€‚ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯é€šè¿‡ FIFO å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚ ä¿¡å·ï¼ˆsignalï¼‰ ç‰¹ç‚¹ï¼šå”¯ä¸€çš„å¼‚æ­¥é€šä¿¡æ–¹å¼ã€‚ ç‰¹æ€§ï¼šä¿¡å·æ˜¯äº‹ä»¶é©±åŠ¨çš„ï¼Œç”¨äºé€šçŸ¥è¿›ç¨‹æŸä¸ªäº‹ä»¶çš„å‘ç”Ÿã€‚ åº”ç”¨åœºæ™¯ï¼šå¸¸ç”¨äºå¼‚å¸¸å¤„ç†ã€‚ä¾‹å¦‚ï¼Œæ¥æ”¶ä¸­æ–­ä¿¡å· SIGINT æ—¶ï¼Œè¿›ç¨‹å¯ä»¥é€‰æ‹©ç»ˆæ­¢æˆ–å¤„ç†ã€‚ æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆmsgï¼‰ ç‰¹ç‚¹ï¼šå¸¸ç”¨äºå®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å¼ï¼ŒæŒ‰æ¶ˆæ¯ç±»å‹è®¿é—®ï¼Œå¯æœ‰ä¼˜å…ˆçº§ã€‚ ç‰¹æ€§ï¼šæ¶ˆæ¯é˜Ÿåˆ—å…è®¸è¿›ç¨‹ä»¥æ¶ˆæ¯çš„å½¢å¼å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚ åº”ç”¨åœºæ™¯ï¼šé€‚ç”¨äºéœ€è¦ä¸åŒä¼˜å…ˆçº§å¤„ç†çš„åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œé«˜ä¼˜å…ˆçº§çš„æ¶ˆæ¯å¯ä»¥è¢«ä¼˜å…ˆå¤„ç†ã€‚ å…±äº«å†…å­˜ï¼ˆshmï¼‰ ç‰¹ç‚¹ï¼šæ•ˆç‡æœ€é«˜ï¼Œç›´æ¥è®¿é—®å†…å­˜ã€‚ ç‰¹æ€§ï¼šéœ€è¦åŒæ­¥å’Œäº’æ–¥æœºåˆ¶ï¼Œé˜²æ­¢æ•°æ®ç«æ€ã€‚ åº”ç”¨åœºæ™¯ï¼šé€‚ç”¨äºéœ€è¦é«˜æ•ˆæ•°æ®å…±äº«çš„åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œå¤šä¸ªè¿›ç¨‹åŒæ—¶è¯»å†™åŒä¸€å—å†…å­˜ã€‚ ä¿¡å·é‡ï¼ˆsemï¼‰ ç‰¹ç‚¹ï¼šç”¨äºå®ç°åŒæ­¥å’Œäº’æ–¥ã€‚ ç‰¹æ€§ï¼šä¿¡å·é‡å¯ä»¥æ§åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚ åº”ç”¨åœºæ™¯ï¼šå¸¸ç”¨äºæ§åˆ¶å…±äº«å†…å­˜çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä¿¡å·é‡å®ç°äº’æ–¥é”ã€‚ ç†è§£è¿›ç¨‹é—´é€šä¿¡ Unix è¿›ç¨‹é—´é€šä¿¡çš„å†å² èµ·æºï¼šLinux çš„è¿›ç¨‹é—´é€šä¿¡æ‰‹æ®µä¸»è¦æ¥æºäº Unix å¹³å°ã€‚ System V IPCï¼šç”± ATT çš„è´å°”å®éªŒå®¤å¼€å‘ï¼ŒåŒ…æ‹¬æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·ç¯å’Œå…±äº«å†…å­˜ï¼Œé€šä¿¡å±€é™åœ¨å•ä¸ªè®¡ç®—æœºå†…ã€‚ BSD IPCï¼šç”±åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡å¼€å‘ï¼Œå¼•å…¥äº†åŸºäºå¥—æ¥å£çš„è¿›ç¨‹é—´é€šä¿¡ï¼Œçªç ´äº†å•æœºé™åˆ¶ã€‚ Linuxï¼šç»§æ‰¿äº† System V å’Œ BSD çš„ç‰¹ç‚¹ï¼Œæä¾›äº†ä¸°å¯Œçš„ IPC æœºåˆ¶ã€‚ Unix IPC çš„å‘å±• åˆå§‹ Unix IPCï¼šåŒ…æ‹¬ç®¡é“ã€FIFO å’Œä¿¡å·ã€‚ System V IPCï¼šæ‰©å±•äº†æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·ç¯å’Œå…±äº«å†…å­˜ã€‚ Posix IPCï¼šæä¾›äº† Posix æ¶ˆæ¯é˜Ÿåˆ—ã€Posix ä¿¡å·ç¯å’Œ Posix å…±äº«å†…å­˜ï¼Œå…·æœ‰æ›´å¥½çš„å¯ç§»æ¤æ€§ã€‚ System V IPC å¯¹è±¡ åˆ›å»ºå’Œè®¿é—® IPC å¯¹è±¡ **ftok()**ï¼šç”Ÿæˆ IPC é”®ï¼Œç”¨äºå”¯ä¸€æ ‡è¯† IPC å¯¹è±¡ã€‚ **msg_get()ã€shm_get()ã€sem_get()**ï¼šæ‰“å¼€æˆ–åˆ›å»º IPC é€šé“ã€‚ å‚æ•°ï¼š int idï¼šIPC å¯¹è±¡çš„ IDã€‚ key_t keyï¼šIPC é”®ã€‚ pathnameï¼šç”¨äºç”Ÿæˆ IPC é”®çš„è·¯å¾„åã€‚ IPC å¯¹è±¡æ“ä½œ æ¶ˆæ¯é˜Ÿåˆ—ï¼š msgsnd(): å‘é€æ¶ˆæ¯ã€‚ msgrcv(): æ¥æ”¶æ¶ˆæ¯ã€‚ msgctl(): æ§åˆ¶æ¶ˆæ¯é˜Ÿåˆ—ã€‚ å…±äº«å†…å­˜ï¼š shmat(): æ˜ å°„å…±äº«å†…å­˜ã€‚ shmdt(): å¸è½½å…±äº«å†…å­˜ã€‚ shmctl(): æ§åˆ¶å…±äº«å†…å­˜ã€‚ ä¿¡å·é‡ï¼š semop(): ä¿¡å·é‡æ“ä½œã€‚ semctl(): æ§åˆ¶ä¿¡å·é‡ã€‚ è¿›ç¨‹é—´é€šä¿¡ä¹‹å…±äº«å†…å­˜ å…±äº«å†…å­˜åŸç† ç‰©ç†å†…å­˜æ˜ å°„ï¼šæ“ä½œç³»ç»Ÿæä¾›ä¸€å—ç‰©ç†å†…å­˜ï¼Œæ˜ å°„åˆ°å¤šä¸ªè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ è™šæ‹Ÿå†…å­˜æ˜ å°„ï¼šå¤šä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜æŒ‡å‘åŒä¸€å—ç‰©ç†å†…å­˜ã€‚ æ³¨æ„äº‹é¡¹ åŒæ­¥æœºåˆ¶ï¼šéœ€è¦ä¾é è¿›ç¨‹é—´åŒæ­¥æœºåˆ¶ï¼ˆå¦‚ä¿¡å·é‡ï¼‰ä¿æŠ¤ä¸´ç•Œèµ„æºã€‚ äº’æ–¥æœºåˆ¶ï¼šé˜²æ­¢å¤šè¿›ç¨‹åŒæ—¶æ“ä½œå…±äº«å†…å­˜å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚ å…±äº«å†…å­˜ç¤ºä¾‹ é—®é¢˜ï¼šå¤šä¸ªè¿›ç¨‹åŒæ—¶å†™å…¥å…±äº«å†…å­˜å¯èƒ½å¯¼è‡´æ•°æ®ç«æ€ã€‚ è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ä¿¡å·é‡å®ç°äº’æ–¥ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥è®¿é—®å…±äº«å†…å­˜ã€‚ é€šè¿‡ä»¥ä¸Šè¯¦ç»†è¯´æ˜ï¼Œè¯»è€…å¯ä»¥æ›´å¥½åœ°ç†è§£è¿›ç¨‹é—´é€šä¿¡çš„å„ç§æœºåˆ¶åŠå…¶åº”ç”¨åœºæ™¯ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","è¿›ç¨‹çº¿ç¨‹"]},{"title":"å…±äº«å†…å­˜","path":"/2025/03/07/1-å¹³å°ç³»ç»Ÿ-Linux-è¿›ç¨‹çº¿ç¨‹-å…±äº«å†…å­˜/","content":"åŸç†å…±äº«å†…å­˜æ˜¯ä¸€ç§è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰çš„æœºåˆ¶ï¼Œå…è®¸å¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€å—ç‰©ç†å†…å­˜åŒºåŸŸã€‚æ“ä½œç³»ç»Ÿå°†è¿™å—å†…å­˜æ˜ å°„åˆ°æ¯ä¸ªå‚ä¸è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼Œä»è€Œå®ç°é«˜æ•ˆçš„æ•°æ®äº¤æ¢ã€‚å…·ä½“æ¥è¯´ï¼š ç‰©ç†å†…å­˜åˆ†é…ï¼šæ“ä½œç³»ç»Ÿåœ¨å†…æ ¸é¢„å…ˆç”³è¯·äº†ä¸€éƒ¨åˆ†å†…å­˜ï¼Œä¾›å¤šä¸ªè¿›ç¨‹å…±äº«ã€‚ è™šæ‹Ÿå†…å­˜æ˜ å°„ï¼šæ¯ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜æ˜ å°„è¡¨ä¸­éƒ½æŒ‡å‘è¿™å—ç‰©ç†å†…å­˜ï¼Œå…è®¸è¿›ç¨‹é€šè¿‡è‡ªå·±çš„è™šæ‹Ÿåœ°å€è®¿é—®å…±äº«å†…å­˜ã€‚ é«˜æ•ˆè®¿é—®ï¼šå…±äº«å†…å­˜çš„è®¿é—®é€Ÿåº¦æ¥è¿‘äºè¿›ç¨‹å†…çš„å†…å­˜è®¿é—®ï¼Œå› ä¸ºå®ƒç›´æ¥æ“ä½œç‰©ç†å†…å­˜ï¼Œè€Œæ— éœ€ç»è¿‡å†…æ ¸çš„æ•°æ®å¤åˆ¶ã€‚ æ³¨æ„äº‹é¡¹ åŒæ­¥æœºåˆ¶ï¼šå¤šä¸ªè¿›ç¨‹åŒæ—¶æ“ä½œå…±äº«å†…å­˜æ—¶ï¼Œå¿…é¡»ä½¿ç”¨è¿›ç¨‹é—´åŒæ­¥æœºåˆ¶ï¼ˆå¦‚ä¿¡å·é‡ã€äº’æ–¥é”ï¼‰æ¥ä¿æŠ¤ä¸´ç•Œèµ„æºï¼Œé˜²æ­¢ç«æ€æ¡ä»¶å’Œæ•°æ®ä¸ä¸€è‡´ã€‚ æ•°æ®æ ¼å¼ï¼šå…±äº«å†…å­˜ä¸­çš„æ•°æ®éœ€è¦è‡ªå®šä¹‰æ ¼å¼ï¼Œç¡®ä¿æ‰€æœ‰è¿›ç¨‹ç†è§£å’Œä½¿ç”¨ç›¸åŒçš„æ•°æ®ç»“æ„ã€‚ å…±äº«å†…å­˜åˆ›å»ºä¹‹åï¼Œä¸€ç›´å­˜åœ¨äºå†…æ ¸ä¸­ï¼Œç›´åˆ°è¢«åˆ é™¤æˆ–æˆ–è€…ç³»ç»Ÿå…³é—­å…±äº«å†…å­˜å’Œç®¡é“ä¸ä¸€æ ·ï¼Œè¯»å–åï¼Œå†…å®¹ä»åœ¨å…±äº«å†…å­˜ä¸­ ä¼˜ç‚¹ é€Ÿåº¦å¿«ï¼šå…±äº«å†…å­˜æ˜¯æœ€å¿«çš„ IPC æ–¹æ³•ä¹‹ä¸€ï¼Œé€‚åˆéœ€è¦é¢‘ç¹ã€å¤§é‡æ•°æ®äº¤æ¢çš„åœºæ™¯ã€‚ ç®€å•æ“ä½œï¼šæ— éœ€å¤æ‚çš„æ•°æ®å¤åˆ¶ï¼Œç›´æ¥ä¿®æ”¹å…±äº«å†…å­˜ä¸­çš„æ•°æ®å³å¯å½±å“å…¶ä»–è¿›ç¨‹ã€‚ é«˜æ•ˆå†…å­˜ä½¿ç”¨ï¼šé¿å…äº†æ•°æ®å¤åˆ¶ï¼Œå‡å°‘å†…å­˜å ç”¨å’Œå¤åˆ¶å¼€é”€ã€‚ ç¼ºç‚¹ åŒæ­¥å¤æ‚æ€§ï¼šéœ€è¦é¢å¤–çš„åŒæ­¥æœºåˆ¶ï¼Œå¢åŠ äº†ç¨‹åºçš„å¤æ‚æ€§ã€‚ æ•°æ®æ ¼å¼ç®¡ç†ï¼šå¿…é¡»è‡ªå®šä¹‰æ•°æ®æ ¼å¼ï¼Œç¡®ä¿æ‰€æœ‰è¿›ç¨‹çš„ä¸€è‡´æ€§ã€‚ ç®¡ç†å¤æ‚ï¼šå…±äº«å†…å­˜çš„åˆ›å»ºã€æ˜ å°„ã€åˆ é™¤éœ€è¦æ‰‹åŠ¨ç®¡ç†ï¼Œå®¹æ˜“å¯¼è‡´å†…å­˜æ³„æ¼ã€‚ ipcs â€“m æ˜¾ç¤ºå…±äº«å†…å­˜çš„ä¿¡æ¯ï¼ˆroot æƒé™æ‰èƒ½æ˜¾ç¤ºæ‰€æœ‰çš„å…±äº«å†…å­˜ä¿¡æ¯ï¼‰ ipcrm â€“m shmid åˆ é™¤æŒ‡å®šçš„å…±äº«å†…å­˜ï¼ˆæ²¡äººç”¨æ—¶æ‰è¢«åˆ æ‰ï¼‰ ipcs â€“a æ˜¾ç¤ºæ‰€æœ‰çš„ ipc å¯¹è±¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…±äº«å†…å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·é‡ã€‚ å…±äº«å†…å­˜ APIä»¥ä¸‹æ˜¯ä½¿ç”¨å…±äº«å†…å­˜çš„ä¸»è¦ APIï¼š 1. ftok()ç”Ÿæˆä¸€ä¸ªå…±äº«å†…å­˜çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚ key_t ftok(const char *pathname, int proj_id); å‚æ•°ï¼š pathnameï¼šç”¨äºç”Ÿæˆé”®çš„æ–‡ä»¶è·¯å¾„ã€‚ proj_idï¼šé¡¹ç›®æ ‡è¯†ç¬¦ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå­—ç¬¦ã€‚ ä½œç”¨ï¼šå°†æ–‡ä»¶è·¯å¾„å’Œé¡¹ç›® ID ç»„åˆç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„é”®ï¼Œç±»ä¼¼äºåŸŸåè§£æä¸º IP çš„è¿‡ç¨‹ã€‚ ç¤ºä¾‹ï¼š key_t key = ftok(shared_memory.txt, m); 2. shmget()åˆ›å»ºæˆ–è·å–ä¸€æ®µå…±äº«å†…å­˜ã€‚ int shmget(key_t key, int size, int shmflag); å‚æ•°ï¼š keyï¼šä» ftok() è·å–çš„é”®ï¼Œæˆ– IPC_PRIVATE åˆ›å»ºç§æœ‰æ®µã€‚ sizeï¼šå…±äº«å†…å­˜çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€‚ shmflagï¼šæƒé™æ ‡å¿—ï¼Œç±»ä¼¼æ–‡ä»¶æƒé™ï¼ˆå¦‚ 0666 è¡¨ç¤ºæ‰€æœ‰ç”¨æˆ·è¯»å†™ï¼‰ã€‚ è¿”å›å€¼ï¼šå…±äº«å†…å­˜ IDï¼ˆæˆåŠŸï¼‰æˆ–-1ï¼ˆå¤±è´¥ï¼‰ã€‚ key ä¸º shm äº§ç”Ÿå‰çš„ç´¢å¼•å€¼ï¼Œä¸€èˆ¬å¯ä»¥è®¾ä¸ºï¼šï½ - ftok çš„è¿”å›å€¼ã€‚åªè¦å…¶ä»–è¿›ç¨‹çŸ¥é“ ftok çš„å‚æ•°ï¼Œå³æ–‡ä»¶å’Œå·¥ç¨‹å·å°±å¯ä»¥ç”Ÿæˆç›¸åŒçš„ keyï¼Œä½¿ç”¨å®ƒæ‰¾åˆ°ã€ä½¿ç”¨è¿™å—å…±äº«å†…å­˜ã€‚ï½ - è‡ªå®šä¹‰çš„å€¼ã€‚è‡ªå·±éšä¾¿å®šä¹‰ä¸€ä¸ªï¼Œåªè¦å…¶ä»–è¿›ç¨‹çŸ¥é“è¿™ä¸ªå€¼å°±å¯ä»¥æ‰¾åˆ°å¹¶ä½¿ç”¨è¿™å—å…±äº«å†…å­˜ã€‚ï½- IPC_PRIVATEsizeï¼šè¦ç”³è¯·çš„å…±äº«å†…å­˜åŒºå¤§å°ï¼Œæ³¨æ„å…±äº«å†…å­˜ä¸èƒ½æ— é™å¤§ï¼Œæ¯ä¸ªç³»ç»Ÿå…±äº«å†…å­˜åŒºå¤§å°æ—¶å›ºå®šçš„ï¼Œä½†åœ¨ç³»ç»Ÿä¸­å¯ä»¥é…ç½®ï¼Œé»˜è®¤éƒ½å¤§äº 32MBã€‚shmflg ä¸ºæ ‡è¯†ä½ï¼Œå¯ç”±ä»¥ä¸‹å¸¸ç”¨æ ‡è®°ç»„æˆï½ - IPC_CREAT shmid æ ‡è¯†çš„å…±äº«å†…å­˜åŒºä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå­˜åœ¨åˆ™æ‰“å¼€ã€‚ï½ - IPC_EXCL å’Œ IPC_CREAT åŒæ—¶ä½¿ç”¨ï¼Œshmid æ ‡è¯†çš„å…±äº«å†…å­˜åŒºå­˜åœ¨æ—¶è¿”å›é”™è¯¯ã€‚0600 å¦‚æœå…±äº«å†…å­˜æ—¶æ–°åˆ›å»ºçš„ï¼Œæ ‡è¯†è¯¥å…±äº«å†…å­˜çš„ç”¨æˆ·æƒé™ã€‚ ç¤ºä¾‹ï¼š int shmid = shmget(IPC_PRIVATE, 1024, 0666);if (shmid == -1) perror(shmget failed); exit(EXIT_FAILURE); 3. shmat()å°†å…±äº«å†…å­˜æ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ void *shmat(int shmid, const void *shmaddr, int shmflag); å‚æ•°ï¼š shmidï¼šå…±äº«å†…å­˜ IDã€‚ shmaddrï¼šæ˜ å°„åœ°å€ï¼ŒNULL è¡¨ç¤ºè®©ç³»ç»Ÿè‡ªåŠ¨åˆ†é…ã€‚ shmflagï¼šè®¿é—®æ ‡å¿—ï¼Œå¦‚ SHM_RDONLY åªè¯»ã€‚ è¿”å›å€¼ï¼šæ˜ å°„åçš„åœ°å€ï¼ˆæˆåŠŸï¼‰æˆ– (void *) -1ï¼ˆå¤±è´¥ï¼‰ã€‚ ç¤ºä¾‹ï¼š char *shmaddr = shmat(shmid, NULL, 0);if (shmaddr == (void *) -1) perror(shmat failed); exit(EXIT_FAILURE); 4. shmctl()æ§åˆ¶å’Œç®¡ç†å…±äº«å†…å­˜æ®µã€‚ int shmctl(int shmid, int cmd, struct shmid_ds *buf); å‚æ•°ï¼š shmidï¼šå…±äº«å†…å­˜ IDã€‚ cmdï¼šå‘½ä»¤ï¼Œå¦‚ IPC_STAT è·å–å±æ€§ï¼ŒIPC_SET è®¾ç½®å±æ€§ï¼ŒIPC_RMID åˆ é™¤æ®µã€‚ bufï¼šæŒ‡å‘ shmid_ds ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œç”¨äºè·å–æˆ–è®¾ç½®å±æ€§ã€‚ è¿”å›å€¼ï¼šæˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›-1ã€‚ ç¤ºä¾‹ï¼š if (shmctl(shmid, IPC_RMID, NULL) == -1) perror(shmctl failed); exit(EXIT_FAILURE); 5. shmdt()åˆ†ç¦»å…±äº«å†…å­˜æ®µã€‚ int shmdt(const void *shmaddr); å‚æ•°ï¼š shmaddrï¼šå…±äº«å†…å­˜æ˜ å°„åçš„åœ°å€ã€‚ è¿”å›å€¼ï¼šæˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›-1ã€‚ ç¤ºä¾‹ï¼š if (shmdt(shmaddr) == -1) perror(shmdt failed); exit(EXIT_FAILURE); ä½¿ç”¨æ­¥éª¤1. åˆ›å»ºå…±äº«å†…å­˜ä½¿ç”¨ shmget() åˆ›å»ºå…±äº«å†…å­˜æ®µã€‚ int shmid = shmget(IPC_PRIVATE, 1024, 0666);if (shmid == -1) perror(shmget failed); exit(EXIT_FAILURE); 2. æ˜ å°„å…±äº«å†…å­˜ä½¿ç”¨ shmat() å°†å…±äº«å†…å­˜æ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´ã€‚ char *shmaddr = shmat(shmid, NULL, 0);if (shmaddr == (void *) -1) perror(shmat failed); exit(EXIT_FAILURE); 3. è®¿é—®å…±äº«å†…å­˜åƒæ“ä½œæ™®é€šå†…å­˜ä¸€æ ·è¯»å†™å…±äº«å†…å­˜ã€‚ // å†™å…¥å…±äº«å†…å­˜strcpy(shmaddr, Hello, shared memory!);// è¯»å–å…±äº«å†…å­˜printf(Shared memory contents: %s , shmaddr); 4. åˆ†ç¦»å…±äº«å†…å­˜ä½¿ç”¨ shmdt() åˆ†ç¦»å…±äº«å†…å­˜ã€‚ if (shmdt(shmaddr) == -1) perror(shmdt failed); exit(EXIT_FAILURE); 5. åˆ é™¤å…±äº«å†…å­˜ä½¿ç”¨ shmctl() åˆ é™¤å…±äº«å†…å­˜æ®µã€‚ if (shmctl(shmid, IPC_RMID, NULL) == -1) perror(shmctl failed); exit(EXIT_FAILURE); å®Œæ•´ç¤ºä¾‹ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„å…±äº«å†…å­˜ç¤ºä¾‹ï¼Œå±•ç¤ºäº†åˆ›å»ºã€æ˜ å°„ã€å†™å…¥ã€è¯»å–å’Œæ¸…ç†å…±äº«å†…å­˜çš„è¿‡ç¨‹ï¼š #include stdio.h#include stdlib.h#include string.h#include sys/types.h#include sys/ipc.h#include sys/shm.hint main() int shmid; char *shmaddr; // åˆ›å»ºå…±äº«å†…å­˜æ®µï¼ˆ1024å­—èŠ‚ï¼Œè¯»å†™æƒé™ï¼‰ shmid = shmget(IPC_PRIVATE, 1024, 0666); if (shmid == -1) perror(shmget); exit(EXIT_FAILURE); printf(Shared memory ID: %d , shmid); // æ˜ å°„å…±äº«å†…å­˜æ®µ shmaddr = shmat(shmid, NULL, 0); if (shmaddr == (void *) -1) perror(shmat); exit(EXIT_FAILURE); // å†™å…¥å…±äº«å†…å­˜ char* message = Hello, shared memory!; strcpy(shmaddr, message); printf(Written to shared memory: %s , shmaddr); // åˆ†ç¦»å…±äº«å†…å­˜ if (shmdt(shmaddr) == -1) perror(shmdt); exit(EXIT_FAILURE); // åˆ é™¤å…±äº«å†…å­˜æ®µ if (shmctl(shmid, IPC_RMID, NULL) == -1) perror(shmctl); exit(EXIT_FAILURE); printf(Shared memory segment removed ); return EXIT_SUCCESS; å…³é”®è€ƒè™‘å› ç´  é”™è¯¯å¤„ç†ï¼šå§‹ç»ˆæ£€æŸ¥ API è¿”å›å€¼ï¼Œå¤„ç†å¯èƒ½çš„é”™è¯¯ã€‚ æƒé™ç®¡ç†ï¼šåˆç†è®¾ç½®å…±äº«å†…å­˜æƒé™ï¼Œç¡®ä¿å®‰å…¨æ€§ã€‚ åŒæ­¥æœºåˆ¶ï¼šåœ¨å¤šè¿›ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨ä¿¡å·é‡æˆ–äº’æ–¥é”ä¿æŠ¤å…±äº«å†…å­˜ã€‚ å†…å­˜ç®¡ç†ï¼šåœ¨ä¸å†éœ€è¦æ—¶åŠæ—¶åˆ é™¤å…±äº«å†…å­˜ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚ é€šè¿‡éµå¾ªè¿™äº›æ­¥éª¤å’Œæ³¨æ„äº‹é¡¹ï¼Œä½ å¯ä»¥åœ¨ C è¯­è¨€ç¨‹åºä¸­é«˜æ•ˆã€å®‰å…¨åœ°ä½¿ç”¨å…±äº«å†…å­˜è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ã€‚ çˆ¶å­è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡é€šè¿‡å…±äº«å†…å­˜å®ç°æœ‰äº²ç¼˜å…³ç³»é—´çš„é€šä¿¡é¦–å…ˆåœ¨åˆ›å»ºå…±äº«å†…å­˜å—åœ°å€ï¼Œç„¶ååœ¨åˆ›å»ºå­è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½è¦è°ƒç”¨ shmat è¿›è¡Œåœ°å€æ˜ å°„ï¼Œå¹¶ä¸”æ˜¯åŒä¸€å—æ˜ å°„åœ°å€ã€‚ çˆ¶è¿›ç¨‹å…ˆå†™å…¥ï¼Œç„¶åè°ƒç”¨ kill å‡½æ•°ï¼Œæ­¤æ—¶å­è¿›ç¨‹å¤„äºä¼‘çœ çŠ¶æ€ï¼Œå› ä¸º pause() å‡½æ•°åœ¨ç­‰å¾…çˆ¶è¿›ç¨‹ç»™å­è¿›ç¨‹å‘é€ä¿¡å·ï¼Œç„¶åçˆ¶è¿›ç¨‹ç»™å­è¿›ç¨‹å‘é€ SIGUSR1 ä¿¡å·ï¼Œæ­¤æ—¶ pause() å‡½æ•°è¢«å”¤é†’ï¼Œç„¶åè¯»å–å…±äº«å†…å­˜ä¸­çš„ä¿¡æ¯ã€‚ ç„¶åå­è¿›ç¨‹ç»™çˆ¶è¿›ç¨‹å‘é€ SIGUSR2 ä¿¡å·ï¼Œæ­¤æ—¶çš„çˆ¶è¿›ç¨‹ä¸­çš„ pause() å‡½æ•°è¢«å”¤é†’ï¼Œç„¶ååˆå¯ä»¥å¼€å§‹å‘å…±äº«å†…å­˜ä¸­å†™å…¥ã€‚ ä¸€ç›´å¾ªç¯ã€‚ void myfun(int signum) return;int main(int argc, char **argv) int key; char *p; key = ftok(./triumph.c,a); if(key0) printf(creat key error ); exit(1); printf(creat key success key=%x ,key); int shmid = shmget(IPC_PRIVATE,128,IPC_CREAT|0777); if(shmid0) printf(Creat share memory fail ); exit(1); printf(creat share memory success shmid =%d , shmid); pid_t pid = fork(); if(pid0) //system(ipcrm -m shmid); p = (char *)shmat(shmid,NULL,0); signal(SIGUSR2,myfun); if(p==NULL) printf(parent process: shmat function error ); exit(1); while(1) //write share memory printf(parent process start write share memory : ); fgets(p,128,stdin); kill(pid,SIGUSR1); //child process read data pause(); //wait child process read if(pid==0) signal(SIGUSR1, myfun); p = (char *)shmat(shmid, NULL,0);//child address map if(p==NULL) printf(child process: shmat function error ); exit(1); while(1) pause();// wait parent process write //start read share memory printf(share memory data : %s,p); kill(getppid(),SIGUSR2); shmctl(shmid, IPC_RMID, NULL); system(ipcs -m); return 0; å…±äº«å†…å­˜æ®µä¿¡æ¯ç¤ºä¾‹Shared Memory Segments----key owner perms nattch status0x00000000 229379 700 0 dest0x00000000 262148 300 0 dest...0x00000000 819214 777 128 dest åœ¨å®é™…è¿è¡Œä¸­ï¼Œå…±äº«å†…å­˜æ®µçš„ä¿¡æ¯ä¼šæ ¹æ®å…·ä½“æƒ…å†µæœ‰æ‰€ä¸åŒï¼Œä¸Šè¿°å†…å®¹ä»…ä¸ºç¤ºä¾‹å±•ç¤º ã€‚ å®ç°æ— äº²ç¼˜å…³ç³»ä¹‹é—´çš„é€šä¿¡æœåŠ¡å™¨ç«¯ç¨‹åºstruct mybuf int pid; //4 char buf[124];//124;void myfun(int signum) return;int main(int argc,char **argv) pid_t pid; int shmid; int key; struct mybuf *p; key = ftok(./triumph.c,a); if(key0) printf(creat key error ); exit(1); printf(creat key success key =%x ,key); shmid = shmget(key, 128, IPC_CREAT|0777); if(shmid0) printf(Creat share memory fail ); exit(1); printf(creat share memory success shmid =%d , shmid); system(ipcs -m); signal(SIGUSR2,myfun); p = (struct mybuf *)shmat(shmid,NULL,0); if(p==NULL) printf(parent process:shmat function fail ); return -1; //get client pid p-pid = getpid();//write server pid to share memory pause();//wait client read server pid pid = p-pid; //write while(1) //write share memory printf(parent process start write share memory : ); fgets(p-buf,128,stdin); //pid ==client pid pause(); kill(pid,SIGUSR1);//wait client read å®¢æˆ·ç«¯ç¨‹åºstruct mybuf int pid; char buf[124];//124 ;void myfun(int signum) return;int main(int argc,char **argv) int shmid; pid_t pid; int key; struct mybuf *p; key = ftok(./triumph.c,a); if(key0) printf(creat key error ); exit(1); printf(creat key success key=%x ,key); shmid = shmget(key, 128, IPC_CREAT|0777); if(shmid0) printf(Creat share memory fail ); exit(1); printf(creat share memory success shmid =%d , shmid); system(ipcs -m); signal(SIGUSR1,myfun); p = (struct mybuf *)shmat(shmid, NULL,0); if(p==NULL) printf(parent process:shmat function fail ); return -3; //get server pid //read share memroy pid = p-pid; //write client pid to share memory p-pid = getpid(); //kill signal kill(pid, SIGUSR2); //client start read data from share memory while(1) pause(); //wait server write data to share memory printf(client process receive data from share memory: %s, p-buf); //pid ==server pid kill(pid, SIGUSR2);//server can write share memory é€šä¿¡æµç¨‹è¯´æ˜ é¦–å…ˆåˆ›å»ºä¸€ä¸ªç»“æ„ä½“ï¼Œåœ¨æœåŠ¡å™¨ç«¯å…ˆæŠŠæœåŠ¡å™¨ï¼ˆserver pidï¼‰å‘é€åˆ°å…±äº«å†…å­˜ï¼Œç„¶åç­‰å¾…å®¢æˆ·ç«¯ï¼ˆclient pidï¼‰è¯»å–æœåŠ¡å™¨ç«¯çš„ pid å·ã€‚ å®¢æˆ·ç«¯è¯»å–æœåŠ¡å™¨ç«¯çš„ pid å·åï¼Œå°†å®¢æˆ·ç«¯çš„ pid å·å‘é€ç»™å…±äº«å†…å­˜ï¼Œç„¶åå‘é€ç»™æœåŠ¡å™¨ç«¯ä¸€ä¸ª kill ä¿¡å· SIGUSR2ã€‚æ­¤æ—¶æœåŠ¡å™¨ç«¯å°±å¯ä»¥æ¥å—å®¢æˆ·ç«¯çš„ pid å·ï¼Œæ­¤æ—¶çš„ pid å·æ˜¯å®¢æˆ·ç«¯çš„ pid å·ï¼Œç„¶åæœåŠ¡å™¨ç«¯å¼€å§‹è·å¾—å®¢æˆ·ç«¯çš„ pid å·ï¼Œæ­¤æ—¶ä¸¤è€…å¯ä»¥é€šä¿¡ã€‚ ç„¶åæœåŠ¡å™¨ç«¯å¼€å§‹å‘é€å†…å®¹ï¼Œæ­¤æ—¶çš„å®¢æˆ·ç«¯æ­£åœ¨ç­‰å¾…æœåŠ¡å™¨ç«¯å‘é€ï¼ˆpause()ï¼‰ã€‚æœåŠ¡å™¨ç«¯å¼€å§‹ä» stdin ä¸­è¯»å–æ•°æ®åˆ° p-buf å…±äº«å†…å­˜çš„ç¼“å†²åŒºä¸­ï¼Œç„¶åç»™å®¢æˆ·ç«¯å‘é€ kill ä¿¡å· SIGUSR1ï¼Œå†™å®Œåçš„æœåŠ¡å™¨ç«¯å¤„äº pause()ç­‰å¾…çŠ¶æ€ã€‚ æ­¤æ—¶å®¢æˆ·ç«¯å¼€å§‹è¯»å–æ•°æ®ï¼Œä»å…±äº«å†…å­˜ p-buf ä¸­è¯»å–ï¼Œç„¶åå‘é€ç»™æœåŠ¡å™¨ç«¯ kill ä¿¡å· SIGUSR2ã€‚æ­¤æ—¶æœåŠ¡å™¨ç«¯å¯ä»¥å†™å…¥æ•°æ®ï¼Œå®¢æˆ·ç«¯åˆå¼€å§‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°æœåŠ¡å™¨ç«¯å‘é€ kill ä¿¡å·ï¼Œæ‰å¯ä»¥è¯»å–ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","è¿›ç¨‹çº¿ç¨‹"]},{"title":"ä¸²å£æ•°æ®æ¥æ”¶çŠ¶æ€æœº","path":"/2025/03/05/4-é€šè®¯åè®®-ä¸²å£-ä¸²å£æ•°æ®æ¥æ”¶çŠ¶æ€æœº/","content":"// æ¥æ”¶åˆ°çš„æ•°æ®ç¼“å†²åŒºé¦–å­—èŠ‚rcvdat = RxBuffer1[0];// UART1åè®®è§£æçŠ¶æ€æœºif (uart1_state_machine == 0) // ç­‰å¾…æ¥æ”¶æ•°æ®åŒ…çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ if (rcvdat == 0xFF) // æ¥æ”¶åˆ°åŒ…å¤´ç¬¬ä¸€å­—èŠ‚ï¼Œç§»ä½åˆ°é«˜ä½ res_data.FrameHead |= rcvdat 8; uart1_state_machine = 1; // çŠ¶æ€è½¬ç§»åˆ°æ¥æ”¶åŒ…å¤´ç¬¬äºŒå­—èŠ‚ else uart1_state_machine = 0; // æœªæ¥æ”¶åˆ°åŒ…å¤´ï¼Œä¿æŒå½“å‰çŠ¶æ€ else if (uart1_state_machine == 1) // æ¥æ”¶æ•°æ®åŒ…çš„ç¬¬äºŒä¸ªå­—èŠ‚ if (rcvdat == 0xEF) // æ¥æ”¶åˆ°å®Œæ•´åŒ…å¤´ï¼Œå¡«å……åŒ…å¤´ä½ä½ res_data.FrameHead |= rcvdat; uart1_state_machine = 2; // çŠ¶æ€è½¬ç§»åˆ°æ¥æ”¶æ•°æ®é•¿åº¦ else if (rcvdat == 0xFF) // é‡æ–°æ¥æ”¶åˆ°åŒ…å¤´ç¬¬ä¸€å­—èŠ‚ï¼Œä¿æŒåœ¨å½“å‰çŠ¶æ€ uart1_state_machine = 1; else uart1_state_machine = 0; // æœªæ¥æ”¶åˆ°æœ‰æ•ˆåŒ…å¤´ï¼Œå¤ä½çŠ¶æ€æœº else if (uart1_state_machine == 2) // æ¥æ”¶æ•°æ®é•¿åº¦ res_data.FrameLen = rcvdat; uart1_state_machine = 3; // çŠ¶æ€è½¬ç§»åˆ°æ¥æ”¶CRC else if (uart1_state_machine == 3) // æ¥æ”¶CRCæ ¡éªŒå’Œ res_data.FrameCRC = rcvdat; uart1_state_machine = 4; // çŠ¶æ€è½¬ç§»åˆ°æ¥æ”¶åº”ç­”ç  else if (uart1_state_machine == 4) // æ¥æ”¶åº”ç­”ç /è¯»å†™ç  res_data.FrameACK = rcvdat; uart1_state_machine = 5; // çŠ¶æ€è½¬ç§»åˆ°æ¥æ”¶æ¨¡å—ç  else if (uart1_state_machine == 5) // æ¥æ”¶æ¨¡å—ç  if (rcvdat == 0x01 || rcvdat == 0x02 || rcvdat == 0x03) res_data.FrameModule = rcvdat; uart1_state_machine = 6; // çŠ¶æ€è½¬ç§»åˆ°æ¥æ”¶IDç  else uart1_state_machine = 0; // æ— æ•ˆæ¨¡å—ç ï¼Œå¤ä½çŠ¶æ€æœº else if (uart1_state_machine == 6) // æ¥æ”¶IDç  if (rcvdat = 0x0A) res_data.FrameID = rcvdat; uart1_state_machine = 7; // çŠ¶æ€è½¬ç§»åˆ°æ¥æ”¶å‘½ä»¤ç  else uart1_state_machine = 0; // æ— æ•ˆIDç ï¼Œå¤ä½çŠ¶æ€æœº else if (uart1_state_machine == 7) // æ¥æ”¶å‘½ä»¤ç  if (rcvdat = 0x08) res_data.FrameCMD = rcvdat; uart1_state_machine = 8; // çŠ¶æ€è½¬ç§»åˆ°æ¥æ”¶å­å‘½ä»¤ç  else if (uart1_state_machine == 8) // åˆå§‹åŒ–æ•°æ®é•¿åº¦è®¡æ•°å™¨ uart1_lencnt = 0; if (1) // æ¥æ”¶å­å‘½ä»¤ç  res_data.FrameSubCMD = rcvdat; if (res_data.FrameLen != 0) // æ¸…é™¤ä¸Šæ¬¡æ•°æ®åŒºå†…å®¹ memset(res_data.DataContent, 0x00, sizeof(res_data.DataContent)); uart1_state_machine = 9; // çŠ¶æ€è½¬ç§»åˆ°æ¥æ”¶æ•°æ®å†…å®¹ else res_data.DataContent[0] = NULL; // æ•°æ®åŒºä¸ºç©º uart1_state_machine = 11; // è½¬ç§»åˆ°åŒ…å°¾å¤„ç† else uart1_state_machine = 0; // æ— æ•ˆå­å‘½ä»¤ç ï¼Œå¤ä½çŠ¶æ€æœº else if (uart1_state_machine == 9 || uart1_state_machine == 10) // ä¿å­˜æ¥æ”¶åˆ°çš„æ•°æ® res_data.DataContent[uart1_lencnt++] = rcvdat; if (uart1_lencnt == res_data.FrameLen) // è®¡ç®—CRCæ ¡éªŒå’Œ __IO u8 crc1 = 0; crc1 = u8_CRC_Check(res_data.DataContent, res_data.FrameLen); if (crc1 == res_data.FrameCRC) // CRCæ ¡éªŒé€šè¿‡ï¼Œè½¬ç§»åˆ°åŒ…å°¾å¤„ç† uart1_state_machine = 11; else // CRCæ ¡éªŒå¤±è´¥ï¼Œå¤ä½çŠ¶æ€æœº uart1_state_machine = 0; else // ç»§ç»­æ¥æ”¶æ•°æ® uart1_state_machine = 10; else if (uart1_state_machine == 11) // æ¥æ”¶åŒ…å°¾ç»“æŸç¬¦ if (rcvdat == 0xFE) if (UART1_Rx_Done == 0) uart1_len = 0; res_data.FrameEnd = 0xFE; // è®¾ç½®åŒ…å°¾æ ‡å¿— UART1_Rx_Done = 0xAA; // æ ‡è®°æ•°æ®åŒ…æ¥æ”¶å®Œæˆ UART1_RX_BUF[uart1_len] = res_data; // ä¿å­˜æ¥æ”¶åˆ°çš„æ•°æ®åŒ… uart1_len += 1; // æ›´æ–°æ•°æ®åŒ…è®¡æ•° memset(res_data, 0x00, sizeof(res_data)); // æ¸…é™¤æ•°æ®åŒ…ç»“æ„ä½“ uart1_state_machine = 0; // å¤ä½çŠ¶æ€æœº","categories":["4.é€šè®¯åè®®","ä¸²å£"]},{"title":"ä¸²å£æ•°æ®æ¥æ”¶æŒ‡å®šå¸§åˆ¤æ–­","path":"/2025/03/05/4-é€šè®¯åè®®-ä¸²å£-ä¸²å£æ•°æ®æ¥æ”¶æŒ‡å®šå¸§åˆ¤æ–­/","content":"1. æ¦‚è¿°å®ç°äº†ä¸€ä¸ªä¸²å£æ•°æ®æ¥æ”¶çš„é©±åŠ¨å‡½æ•°ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ¥æ”¶å’Œå¤„ç†é€šè¿‡ä¸²å£å‘é€æ¥çš„æ•°æ®å¸§ã€‚æ•°æ®å¸§å…·æœ‰å›ºå®šçš„å¸§å¤´å’Œå¸§å°¾ç»“æ„ï¼Œæ¥æ”¶å‡½æ•°ä¼šæ£€æµ‹å¸§å¤´ï¼Œè¯»å–å®Œæ•´çš„æ•°æ®å¸§ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€‚ 2. ä»£ç ç»“æ„ä»£ç åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼š SlotDataReady()ï¼šè´Ÿè´£ä»ä¸²å£æ¥æ”¶æ•°æ®ï¼Œæ£€æµ‹å¸§å¤´ï¼Œè¯»å–å®Œæ•´çš„æ•°æ®å¸§ã€‚ slotDealFrame()ï¼šå¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®å¸§ï¼Œæå–ä¿¡æ¯å¹¶è¿›è¡Œåç»­å¤„ç†ã€‚ 3. SlotDataReady() å‡½æ•°åŠŸèƒ½ï¼šæ¥æ”¶ä¸²å£æ•°æ®ï¼Œæ£€æµ‹å¸§å¤´ï¼Œè¯»å–å®Œæ•´çš„æ•°æ®å¸§ã€‚ é€»è¾‘æµç¨‹ï¼š æ£€æµ‹å¸§å¤´ï¼š æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„æ¶ˆæ¯æ¥æ”¶ã€‚ è¯»å–å›ºå®šé•¿åº¦çš„å¸§å¤´æ•°æ®ã€‚ éªŒè¯å¸§å¤´å’Œå¸§å°¾æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœä¸æ­£ç¡®åˆ™ä¸¢å¼ƒè¯¥æ•°æ®ã€‚ è¯»å–å®Œæ•´å¸§ï¼š æ ¹æ®å¸§å¤´ä¸­çš„é•¿åº¦ä¿¡æ¯ï¼Œè®¡ç®—éœ€è¦è¯»å–çš„æ•°æ®é•¿åº¦ã€‚ é€æ¬¡è¯»å–å‰©ä½™æ•°æ®ï¼Œç›´åˆ°è¯»å–å®Œæ•´ä¸€ä¸ªå¸§ã€‚ å¤„ç†æ•°æ®å¸§ï¼š å°†å®Œæ•´çš„æ•°æ®å¸§å‘é€åˆ°æ¶ˆæ¯å¤„ç†æ¨¡å—ã€‚ é‡ç½®æ¥æ”¶çŠ¶æ€ï¼Œå‡†å¤‡æ¥æ”¶ä¸‹ä¸€ä¸ªæ•°æ®å¸§ã€‚ å…³é”®ä»£ç è§£é‡Šï¼š void SerialPortDriver::SlotDataReady() quint8 *getData_p; quint64 unSize; // æœªè¯»å­—èŠ‚æ•° bool bCountinue = false; QByteArray baPacket; do // 1. æ£€æµ‹å¸§å¤´ if (m_bNewCmd) // æœ‰æ–°çš„æ¶ˆæ¯ while (1) // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ•°æ®æ¥è¯»å–å¸§å¤´ if (ComNodeIns-bytesAvailable() FRAME_HEAD_SIZE) break; // è¯»å–å¸§å¤´æ•°æ® m_readData = ComNodeIns-read(FRAME_HEAD_SIZE); getData_p = (quint8 *)(m_readData.data()); // éªŒè¯å¸§å¤´å’Œå¸§å°¾ if (getData_p[0] == MSG_HEAD getData_p[6] == MSG_HEAD_END) // è®¡ç®—éœ€è¦è¯»å–çš„æ•°æ®é•¿åº¦ m_unNeedReadNu = getData_p[4] - FRAME_HEAD_SIZE; m_bNewCmd = false; break; else printf(ERROR: MSG RECEIVE HEADEND FAILED!!! ); // ä¸¢å¼ƒé”™è¯¯æ•°æ® // 2. è¯»å–å®Œæ•´å¸§ unSize = ComNodeIns-bytesAvailable(); if (m_unNeedReadNu 0 m_unNeedReadNu = unSize) // è¯»å–å‰©ä½™æ•°æ® m_readData.append(ComNodeIns-read(m_unNeedReadNu)); else // è¯»å–æ‰€æœ‰å¯ç”¨æ•°æ® m_readData.append(ComNodeIns-read(unSize)); m_unNeedReadNu = m_unNeedReadNu - unSize; break; // 3. å‘é€åˆ°æ¶ˆæ¯å¤„ç†æ¨¡å— baPacket = m_readData; slotDealFrame(baPacket); // é‡ç½®çŠ¶æ€ m_bNewCmd = true; m_unNeedReadNu = 0; // 4. ç»§ç»­è¯»å– if (ComNodeIns-bytesAvailable() FRAME_HEAD_SIZE) bCountinue = true; while (bCountinue); 4. slotDealFrame() å‡½æ•°åŠŸèƒ½ï¼šå¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®å¸§ï¼Œæå–ä¿¡æ¯å¹¶è¿›è¡Œåç»­å¤„ç†ã€‚ é€»è¾‘æµç¨‹ï¼š æå–æ¶ˆæ¯èŠ‚ç‚¹ï¼š å°†æ¥æ”¶åˆ°çš„æ•°æ®è½¬æ¢ä¸ºæ¶ˆæ¯èŠ‚ç‚¹ç»“æ„ä½“ã€‚ CRC æ ¡éªŒï¼š è®¡ç®—æ¥æ”¶æ•°æ®çš„ CRC å€¼ã€‚ å¯¹æ¯”æ•°æ®ä¸­çš„ CRC å€¼ï¼ŒéªŒè¯æ•°æ®å®Œæ•´æ€§ã€‚ æ¶ˆæ¯å¤„ç†ï¼š æ ¹æ®æ¶ˆæ¯ ID ç¡®å®šæ¶ˆæ¯ç±»å‹ã€‚ æ„é€ è¾“å‡ºå­—ç¬¦ä¸²ï¼Œæ‰“å°æ¥æ”¶ä¿¡æ¯ã€‚ é€šè¿‡ä¿¡å·å‘é€æ¶ˆæ¯èŠ‚ç‚¹åˆ°å…¶ä»–æ¨¡å—ã€‚ å…³é”®ä»£ç è§£é‡Šï¼š void SerialPortDriver::slotDealFrame(QByteArray baPacket) do MessageNode dFrame; // æå–æ¶ˆæ¯èŠ‚ç‚¹ MessageNode *fpNew = (MessageNode *)baPacket.data(); dFrame = *fpNew; // CRCæ ¡éªŒ quint8 scrc = CRC_CAL(baPacket); quint8 dcrc = dFrame.frameHeader.datacksum; // CRCæ ¡éªŒå¤±è´¥å¤„ç† // if (dcrc != scrc) // // printf(ERROR: CRC CAL FAILED!!! ); // break; // // ç¡®å®šæ¶ˆæ¯ç±»å‹ QString type = none; switch(dFrame.frameHeader.payloadID) case MSG_IRU: type = iru; break; case MSG_ADU: type = adu; break; case MSG_GPS: type = gps; break; // æ„é€ è¾“å‡ºå­—ç¬¦ä¸²å¹¶æ‰“å° static int index = 0; QString outputStr = [RecvMsg + QString::number(index++) + ] + QDateTime::currentDateTime().toString(HH:mm:ss zzz) + + type; printf(%s , qPrintable(outputStr)); // å‘é€æ¶ˆæ¯èŠ‚ç‚¹ emit sendBlockMsg(dFrame); while (0); 5. ç¤ºä¾‹è¯´æ˜ç¤ºä¾‹ 1ï¼šå¸§å¤´æ£€æµ‹ å‡è®¾æ¥æ”¶åˆ°çš„æ•°æ®å¸§å¤´ä¸ºï¼š[0x55, 0x00, 0x00, 0x01, 0x10, 0x00, 0xAA]ï¼Œå…¶ä¸­ï¼š 0x55 æ˜¯å¸§å¤´æ ‡è¯†ã€‚ 0x10 æ˜¯æ•°æ®é•¿åº¦ï¼ˆ16 bytesï¼‰ã€‚ 0xAA æ˜¯å¸§å°¾æ ‡è¯†ã€‚ ç³»ç»Ÿä¼šæ£€æµ‹åˆ°å¸§å¤´å’Œå¸§å°¾æ­£ç¡®ï¼Œè®¡ç®—éœ€è¦è¯»å–çš„æ•°æ®é•¿åº¦ä¸º 0x10 - FRAME_HEAD_SIZEã€‚ ç¤ºä¾‹ 2ï¼šæ•°æ®è¯»å– å‡è®¾ä¸²å£ç¼“å†²åŒºæœ‰ 20 bytes æ•°æ®ï¼Œå…¶ä¸­å¸§å¤´ 6 bytesï¼Œå‰©ä½™ 14 bytes æ•°æ®ï¼š é¦–å…ˆè¯»å–å¸§å¤´ï¼ŒéªŒè¯æ­£ç¡®ã€‚ è®¡ç®—éœ€è¦è¯»å– 14 bytes æ•°æ®ã€‚ è¯»å–å‰©ä½™ 14 bytesï¼Œå®Œæˆä¸€ä¸ªå®Œæ•´çš„æ•°æ®å¸§ã€‚ ç¤ºä¾‹ 3ï¼šæ¶ˆæ¯å¤„ç† æ¥æ”¶åˆ°çš„æ•°æ®å¸§ç±»å‹ä¸º MSG_GPSï¼Œç³»ç»Ÿä¼šæ‰“å°ï¼š [RecvMsg 0 ] 2023-10-01 12:34:56 +0800 gps å¹¶é€šè¿‡ä¿¡å·å‘é€ dFrame åˆ°å…¶ä»–æ¨¡å—è¿›è¡Œå¤„ç†ã€‚ 6. æ€»ç»“è¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ªå¯é çš„ä¸²å£æ•°æ®æ¥æ”¶å’Œå¤„ç†æœºåˆ¶ï¼Œèƒ½å¤Ÿæ­£ç¡®æ£€æµ‹å’Œå¤„ç†å›ºå®šç»“æ„çš„æ•°æ®å¸§ï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ã€‚é€šè¿‡åˆ†ç¦»æ¥æ”¶å’Œå¤„ç†é€»è¾‘ï¼Œä½¿å¾—ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚","categories":["4.é€šè®¯åè®®","ä¸²å£"]},{"title":"è¯†åˆ«ç…§ç‰‡æ—¶é—´æˆ³å¹¶åˆ†ç±»","path":"/2025/03/05/2-ç¼–ç¨‹è¯­è¨€-Python-è¯†åˆ«ç…§ç‰‡æ—¶é—´æˆ³å¹¶åˆ†ç±»/","content":"# å¯¼å…¥å¿…è¦çš„åº“import osimport timeimport refrom PIL import Imageimport ExifTagsimport subprocessimport exiftoolimport shutil# é…ç½® ExifTool çš„è·¯å¾„ï¼Œç¡®ä¿è„šæœ¬èƒ½å¤Ÿæ‰¾åˆ°è¯¥å·¥å…·EXIFTOOL_PATH = rC:\\Program Portable\\exiftool-13.04_64\\exiftool.exe # æ›¿æ¢ä¸ºä½ çš„å®é™…è·¯å¾„def get_image_time_from_exif(image_path): é€šè¿‡ EXIF å…ƒæ•°æ®è·å–å›¾ç‰‡çš„åŸå§‹æ‹æ‘„æ—¶é—´ EXIFï¼ˆExchangeable Image File Formatï¼‰æ˜¯å›¾ç‰‡æ–‡ä»¶ä¸­å¸¸ç”¨çš„å…ƒæ•°æ®æ ¼å¼ï¼Œé€šå¸¸åŒ…å«æ‹æ‘„æ—¶é—´ã€ç›¸æœºå‹å·ç­‰ä¿¡æ¯ã€‚ è¯¥å‡½æ•°å°è¯•ä»å›¾ç‰‡çš„ EXIF æ•°æ®ä¸­æå– DateTimeOriginal æ ‡ç­¾ï¼Œè¯¥æ ‡ç­¾è®°å½•äº†å›¾ç‰‡çš„åŸå§‹æ‹æ‘„æ—¶é—´ã€‚ try: # æ‰“å¼€å›¾ç‰‡æ–‡ä»¶å¹¶åŠ è½½ EXIF æ•°æ® image = Image.open(image_path) exif_data = image._getexif() if exif_data: # éå† EXIF æ ‡ç­¾ï¼ŒæŸ¥æ‰¾ DateTimeOriginal for tag, value in exif_data.items(): decoded_tag = ExifTags.TAGS.get(tag, tag) if decoded_tag == DateTimeOriginal: # è¿”å›æ ¼å¼åŒ–çš„æ—¥æœŸå­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼š2023-10-01 return value[:10].replace(:, -) except Exception as e: # è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œç»§ç»­æ‰§è¡Œ print(fé€šè¿‡ EXIF è·å–æ—¶é—´å¤±è´¥: e, æ–‡ä»¶è·¯å¾„: image_path) return Nonedef get_image_time_with_exiftool(image_path): ä½¿ç”¨ ExifTool å·¥å…·è·å–å›¾ç‰‡æ—¶é—´ ExifTool æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å…ƒæ•°æ®è¯»å–å·¥å…·ï¼Œå¯ä»¥ä»å„ç§æ–‡ä»¶æ ¼å¼ä¸­æå–è¯¦ç»†çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚ è¯¥å‡½æ•°å°è¯•é€šè¿‡ ExifTool è·å–å¤šä¸ªæ—¶é—´ç›¸å…³çš„æ ‡ç­¾ï¼ŒåŒ…æ‹¬ DateTimeOriginalã€CreateDate ç­‰ã€‚ try: with exiftool.ExifTool() as et: # è·å–å›¾ç‰‡çš„å…ƒæ•°æ® metadata = et.get_metadata(image_path) # æŒ‰ä¼˜å…ˆçº§æŸ¥æ‰¾æ—¶é—´ä¿¡æ¯ for tag in [EXIF:DateTimeOriginal, EXIF:CreateDate, QuickTime:CreateDate]: if tag in metadata: # è¿”å›æ ¼å¼åŒ–çš„æ—¥æœŸå­—ç¬¦ä¸² return metadata[tag][:10].replace(:, -) except Exception as e: print(fé€šè¿‡ ExifTool è·å–æ—¶é—´å¤±è´¥: e, æ–‡ä»¶è·¯å¾„: image_path) return Nonedef get_media_creation_time_with_ffprobe(media_path): ä½¿ç”¨ ffprobe è·å–åª’ä½“æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´ ffprobe æ˜¯ FFmpeg å¥—ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œèƒ½å¤Ÿä»åª’ä½“æ–‡ä»¶ä¸­æå–è¯¦ç»†çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚ è¯¥å‡½æ•°é€šè¿‡ ffprobe æå–è§†é¢‘æˆ–å›¾ç‰‡çš„åˆ›å»ºæ—¶é—´ã€‚ try: # æ„å»º ffprobe å‘½ä»¤ï¼Œæå–åˆ›å»ºæ—¶é—´ command = [ ffprobe, -v, error, -select_streams, v:0, -show_entries, stream_tags=creation_time, -of, default=noprint_wrappers=1:nokey=1, media_path ] # æ‰§è¡Œå‘½ä»¤å¹¶è·å–è¾“å‡º output = subprocess.check_output(command).decode().strip() if output: # æå–æ—¥æœŸéƒ¨åˆ†ï¼Œæ ¼å¼ä¸º YYYY-MM-DD return output[:10] except Exception as e: print(fé€šè¿‡ ffprobe è·å–æ—¶é—´å¤±è´¥: e, æ–‡ä»¶è·¯å¾„: media_path) return Nonedef extract_date_from_filename(file_name): ä»æ–‡ä»¶åä¸­æå–æ—¥æœŸ è¯¥å‡½æ•°å°è¯•ä»æ–‡ä»¶åä¸­åŒ¹é…å¸¸è§çš„æ—¥æœŸæ ¼å¼ï¼Œä¾‹å¦‚ 20231001 æˆ– 2023-10-01ã€‚ date_patterns = [ r\\d4-\\d2-\\d2, # åŒ¹é… YYYY-MM-DD æ ¼å¼ r\\d8 # åŒ¹é… YYYYMMDD æ ¼å¼ ] for pattern in date_patterns: match = re.search(pattern, file_name) if match: date_str = match.group() # å°† YYYYMMDD æ ¼å¼è½¬æ¢ä¸º YYYY-MM-DD if len(date_str) == 8: return fdate_str[:4]-date_str[4:6]-date_str[6:] return date_str return Nonedef get_file_creation_time(file_path): é€šè¿‡æ–‡ä»¶ç³»ç»Ÿè·å–æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´ å½“ä¸Šè¿°æ–¹æ³•éƒ½æ— æ³•è·å–æ—¶é—´æ—¶ï¼Œä½œä¸ºæœ€åçš„å¤‡ç”¨æ–¹æ³•ï¼Œä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿçš„åˆ›å»ºæ—¶é—´ã€‚ try: # è·å–æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´ creation_time = time.ctime(os.path.getctime(file_path)) # å°†æ—¶é—´å­—ç¬¦ä¸²è½¬æ¢ä¸º YYYY-MM-DD æ ¼å¼ return time.strftime(%Y-%m-%d, time.strptime(creation_time, %a %b %d %H:%M:%S %Y)) except Exception as e: print(fé€šè¿‡æ–‡ä»¶ç³»ç»Ÿè·å–æ—¶é—´å¤±è´¥: e, æ–‡ä»¶è·¯å¾„: file_path) return Nonedef get_image_creation_time(image_path): ç»¼åˆå¤šç§æ–¹æ³•è·å–å›¾ç‰‡çš„åˆ›å»ºæ—¶é—´ æŒ‰ç…§ä¼˜å…ˆçº§ä¾æ¬¡å°è¯•å¤šç§æ–¹æ³•ï¼Œç¡®ä¿è·å–åˆ°æœ€å‡†ç¡®çš„åˆ›å»ºæ—¶é—´ã€‚ time_getters = [ get_image_time_from_exif, # 1. é€šè¿‡ EXIF æ•°æ® get_image_time_with_exiftool, # 2. é€šè¿‡ ExifTool get_media_creation_time_with_ffprobe, # 3. é€šè¿‡ ffprobe extract_date_from_filename, # 4. ä»æ–‡ä»¶åæå– get_file_creation_time # 5. æ–‡ä»¶ç³»ç»Ÿåˆ›å»ºæ—¶é—´ ] for method in time_getters: creation_time = method(image_path) if creation_time: return creation_time return Nonedef move_image_to_date_directory(image_path): æ ¹æ®å›¾ç‰‡çš„åˆ›å»ºæ—¶é—´ç§»åŠ¨å›¾ç‰‡åˆ°å¯¹åº”çš„å¹´ä»½å’Œæœˆä»½ç›®å½•ä¸‹ ç›®æ ‡ç›®å½•ç»“æ„ä¸ºï¼šå¹´/æœˆ creation_time = get_image_creation_time(image_path) if creation_time: year, month = creation_time.split(-)[:2] # ç›®æ ‡ç›®å½•è·¯å¾„ target_directory = os.path.join(rC:\\Users\\Administrator\\2024\\08, year, month) # åˆ›å»ºç›®æ ‡ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ if not os.path.exists(target_directory): os.makedirs(target_directory) # ç§»åŠ¨æ–‡ä»¶ shutil.move(image_path, os.path.join(target_directory, os.path.basename(image_path))) print(fç§»åŠ¨æ–‡ä»¶ image_path åˆ° target_directory) else: print(fè·³è¿‡æ–‡ä»¶ï¼šæ— æ³•è·å–åˆ›å»ºæ—¶é—´ï¼Œè·¯å¾„ï¼šimage_path)if __name__ == __main__: # è®¾ç½®ç›®æ ‡ç›®å½• image_dir = rC:\\Users\\Administrator\\2024\\08 # è·å–æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„åª’ä½“æ–‡ä»¶ image_files = [ os.path.join(image_dir, f) for f in os.listdir(image_dir) if f.lower().endswith((.jpg, .png, .jpeg, .heic, .mp4)) ] # å¤„ç†æ¯ä¸ªæ–‡ä»¶ for image_file in image_files: move_image_to_date_directory(image_file)","categories":["2.ç¼–ç¨‹è¯­è¨€","Python"]},{"title":"Qtç¼–è¯‘ä¸è¿è¡Œå¸¸è§é”™è¯¯è§£å†³æ–¹æ¡ˆæ±‡æ€»","path":"/2025/03/05/3-å¼€å‘æ¡†æ¶-Qt-Qtç¼–è¯‘å¸¸è§é”™è¯¯/","content":"Qtç¼–è¯‘ä¸è¿è¡Œå¸¸è§é”™è¯¯è§£å†³æ–¹æ¡ˆæ±‡æ€»åœ¨Qtå¼€å‘è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨æŠ¥é”™ã€é“¾æ¥å¤±è´¥æˆ–è¿è¡Œæ—¶å¼‚å¸¸æ˜¯å¼€å‘è€…å¸¸é‡åˆ°çš„æŒ‘æˆ˜ã€‚æœ¬æ–‡æ±‡æ€»äº†ä»ç¯å¢ƒé…ç½®åˆ°ä»£ç å®ç°çš„å¸¸è§é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½å¹¶ä¿®å¤é—®é¢˜ã€‚ 1. ä¾èµ–åº“ç¼ºå¤±é—®é¢˜1.1 ç¼ºå°‘ OpenGL åº“ (cannot find -lGL)é—®é¢˜æè¿°ç¼–è¯‘æ—¶å‡ºç°å¦‚ä¸‹é”™è¯¯ï¼Œè¡¨æ˜é“¾æ¥å™¨æ‰¾ä¸åˆ° OpenGL åº“ï¼š -1: error: cannot find -lGL: No such file or directory è§£å†³æ–¹æ¡ˆ å®‰è£…å¼€å‘åº“ (UbuntuDebian)sudo apt updatesudo apt install libgl1-mesa-dev æ£€æŸ¥åº“æ–‡ä»¶ç¡®è®¤åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼šfind / -name libGL.so* é…ç½®è·¯å¾„è‹¥åº“å­˜åœ¨ä½†æ‰¾ä¸åˆ°ï¼Œæ·»åŠ è·¯å¾„åˆ°ç¯å¢ƒå˜é‡ï¼š# ä¸´æ—¶ç”Ÿæ•ˆexport LD_LIBRARY_PATH=/path/to/library:$LD_LIBRARY_PATH# æ°¸ä¹…ç”Ÿæ•ˆ (æ·»åŠ åˆ° ~/.bashrc)echo export LD_LIBRARY_PATH=/path/to/library:$LD_LIBRARY_PATH ~/.bashrcsource ~/.bashrc é¡¹ç›®é…ç½® (.pro)åœ¨ .pro æ–‡ä»¶ä¸­æ˜¾å¼æ·»åŠ ï¼šLIBS += -lGL 1.2 ç¼ºå°‘ cURL åº“ (curl/curl.h: No such file)é—®é¢˜æè¿°ç¼–è¯‘æ—¶æç¤ºæ— æ³•æ‰¾åˆ° curl/curl.h å¤´æ–‡ä»¶ï¼š fatal error: curl/curl.h: No such file or directory è§£å†³æ–¹æ¡ˆ å®‰è£…å¼€å‘åº“ UbuntuDebian: sudo apt install libcurl4-openssl-dev CentOSRHEL: sudo yum install libcurl-devel macOS (Homebrew): brew install curl æŒ‡å®šå¤´æ–‡ä»¶è·¯å¾„è‹¥ç¼–è¯‘å™¨ä»æ— æ³•æ‰¾åˆ°ï¼Œå¯æ‰‹åŠ¨æŒ‡å®šè·¯å¾„ï¼š# ç¼–è¯‘å‘½ä»¤ç¤ºä¾‹g++ -I/usr/include/curl ... æˆ–è®¾ç½®ç¯å¢ƒå˜é‡ï¼šexport CPATH=/path/to/curl/include:$CPATH 2. é“¾æ¥ä¸æ„å»ºé”™è¯¯2.1 æœªå®šä¹‰çš„ vtable å¼•ç”¨ (Undefined reference to vtable)é—®é¢˜æè¿°é“¾æ¥é˜¶æ®µæŠ¥é”™ï¼š undefined reference to `vtable for MyClass åŸå› åˆ†æ ç±»å®šä¹‰ä¸­ä½¿ç”¨äº† Q_OBJECT å®ï¼Œä½† Meta-Object Compiler (MOC) æœªè¿è¡Œæˆ–æœªé‡æ–°ç”Ÿæˆ moc_*.cpp æ–‡ä»¶ã€‚ è™šå‡½æ•°æœªå®ç°ï¼ˆå°¤å…¶æ˜¯ææ„å‡½æ•°ï¼‰ã€‚ è§£å†³æ–¹æ¡ˆ æ£€æŸ¥ Q_OBJECT å®ï¼šç¡®ä¿ç»§æ‰¿è‡ª QObject çš„ç±»åŒ…å«è¯¥å®ã€‚ é‡æ–°è¿è¡Œ qmakecmakeï¼š qmake: å³é”®é¡¹ç›® - â€œæ‰§è¡Œ qmakeâ€ (Run qmake) - â€œé‡æ–°æ„å»ºâ€ (Rebuild)ã€‚ CMake: åˆ é™¤ build ç›®å½•ï¼Œé‡æ–°è¿è¡Œ cmake é…ç½®ã€‚ 2.2 æœªè§£æçš„å¤–éƒ¨ç¬¦å· (LNK2019 Undefined Symbol)é—®é¢˜æè¿° Windows (MSVC): error LNK2019: unresolved external symbol ... Linux (GCCClang): undefined reference to ... åŸå› åˆ†æ å‡½æ•°å£°æ˜äº†ä½†æœªå®ç°ã€‚ ä¾èµ–çš„åº“æœªé“¾æ¥ï¼ˆ.lib .a .soï¼‰ã€‚ åº“çš„æ¶æ„ï¼ˆx86x64ï¼‰ä¸é¡¹ç›®ä¸åŒ¹é…ã€‚ è§£å†³æ–¹æ¡ˆ æ£€æŸ¥æŠ¥é”™å‡½æ•°æ˜¯å¦å·²åœ¨ .cpp æ–‡ä»¶ä¸­å®ç°ã€‚ åœ¨ .pro ä¸­ä½¿ç”¨ LIBS += -L/path -lName æ·»åŠ åº“ã€‚ ç¡®è®¤ç¬¬ä¸‰æ–¹åº“çš„ä½æ•°ï¼ˆ32ä½64ä½ï¼‰ä¸ç¼–è¯‘å™¨ä¸€è‡´ã€‚ 2.3 DebugRelease æ¨¡å¼æ··ç”¨é—®é¢˜æè¿°ç¨‹åºè¿è¡Œæ—¶å´©æºƒï¼Œæˆ–å‡ºç°å †ç ´åï¼ˆHeap Corruptionï¼‰é”™è¯¯ï¼Œå¸¸è§äº Windows å¹³å°ã€‚ åŸå› åˆ†æåœ¨ Debug æ¨¡å¼ä¸‹é“¾æ¥äº† Release ç‰ˆæœ¬çš„åº“ï¼ˆæˆ–åä¹‹ï¼‰ã€‚Qt çš„ Debug åº“é€šå¸¸å¸¦ d åç¼€ï¼ˆå¦‚ Qt6Cored.lib vs Qt6Core.libï¼‰ã€‚ è§£å†³æ–¹æ¡ˆåœ¨ .pro æ–‡ä»¶ä¸­åŒºåˆ†é…ç½®ï¼š CONFIG(debug, debug|release) LIBS += -L$$PWD/libs -lmylib_d else LIBS += -L$$PWD/libs -lmylib 3. è¿è¡Œæ—¶ä¸ç¯å¢ƒé—®é¢˜3.1 WSL ä¸­æ–‡ä¹±ç é—®é¢˜æè¿°åœ¨ Windows Subsystem for Linux (WSL) ä¸­è¿è¡Œ GUI ç¨‹åºï¼Œä¸­æ–‡å­—ç¬¦æ˜¾ç¤ºä¸ºæ–¹æ¡†ã€‚ åŸå› åˆ†æWSL é»˜è®¤ç¼ºå°‘ä¸­æ–‡å­—ä½“ï¼Œå¯¼è‡´æ— æ³•æ¸²æŸ“ä¸­æ–‡å­—ç¬¦ã€‚ è§£å†³æ–¹æ¡ˆå€Ÿç”¨ Windows å®¿ä¸»æœºçš„å­—ä½“åº“ï¼š åˆ›å»ºè½¯é“¾æ¥sudo ln -s /mnt/c/Windows/Fonts /usr/share/fonts/windows-fonts åˆ·æ–°å­—ä½“ç¼“å­˜fc-cache -fv (æ³¨ï¼šè‹¥ä»æœ‰ä¹±ç ï¼Œå¯èƒ½éœ€è¦å®‰è£…ä¸­æ–‡è¯­è¨€åŒ…ï¼šsudo apt install language-pack-zh-hans) 3.2 ä¿¡å·æ§½è¿æ¥è¿è¡Œæ—¶è­¦å‘Šé—®é¢˜æè¿°ç¼–è¯‘é€šè¿‡ï¼Œä½†æ§åˆ¶å°è¾“å‡ºï¼š QObject::connect: No such slot ...QObject::connect: No such signal ... åŸå› åˆ†æ ä¿¡å·æˆ–æ§½å‡½æ•°åç§°æ‹¼å†™é”™è¯¯ã€‚ å‚æ•°ç±»å‹ä¸åŒ¹é…ã€‚ ä½¿ç”¨äº†æ—§ç‰ˆ SIGNALSLOT å®ä¸”å‡½æ•°åé”™è¯¯ã€‚ è§£å†³æ–¹æ¡ˆæ¨èä½¿ç”¨ Qt 56 å‡½æ•°æŒ‡é’ˆè¯­æ³•ï¼Œå¯åœ¨ç¼–è¯‘æœŸæ£€æŸ¥é”™è¯¯ï¼š // æ¨èå†™æ³• (ç¼–è¯‘æœŸæ£€æŸ¥)connect(sender, Sender::signalName, receiver, Receiver::slotName);// æ—§å¼å†™æ³• (ä»…è¿è¡Œæ—¶æ£€æŸ¥ï¼Œæ˜“å‡ºé”™)connect(sender, SIGNAL(signalName()), receiver, SLOT(slotName())); 4. ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜4.1 Qt 5 ä¸ Qt 6 æ¨¡å—å·®å¼‚ (Unknown module)é—®é¢˜æè¿°é¡¹ç›®ä» Qt 5 è¿ç§»åˆ° Qt 6 æ—¶ï¼Œæç¤ºæ¨¡å—æ‰¾ä¸åˆ°ï¼Œä¾‹å¦‚ï¼š Project ERROR: Unknown module(s) in QT: webenginewidgets è§£å†³æ–¹æ¡ˆ WebEngine: ç¡®è®¤å·²å®‰è£… Qt WebEngine ç»„ä»¶ã€‚æ³¨æ„ Qt WebEngine ä¸æ”¯æŒ MinGW (éƒ¨åˆ†ç‰ˆæœ¬)ï¼Œé€šå¸¸éœ€è¦ MSVCã€‚ å¤šåª’ä½“: QT += multimedia åœ¨ Qt 6 ä¸­ API æœ‰è¾ƒå¤§å˜åŠ¨ï¼Œéœ€æ£€æŸ¥ä»£ç å…¼å®¹æ€§ã€‚ å®‰è£…æ£€æŸ¥: ä½¿ç”¨ Qt Maintenance Tool ç¡®è®¤å‹¾é€‰äº†å¯¹åº”æ¨¡å—ã€‚ å‚è€ƒæ¥æº Qt Documentation Stack Overflow: Qt Compilation Errors WSL Graphics Support","categories":["3.å¼€å‘æ¡†æ¶","Qt"]},{"title":"WSLé…ç½®","path":"/2025/03/05/1-å¹³å°ç³»ç»Ÿ-WSL-WSLé…ç½®/","content":"å®‰è£… Qt æŠ¥é”™./qt-opensource-linux-x64-5.12.12.run: error while loading shared libraries: libxkbcommon-x11.so.0: cannot open shared object file: No such file or directory å½“ä½ åœ¨è¿è¡Œ ./qt-opensource-linux-x64-5.12.12.run æ—¶å‡ºç° error while loading shared libraries: libxkbcommon-x11.so.0: cannot open shared object file: No such file or directory é”™è¯¯ï¼Œè¿™è¡¨æ˜ç³»ç»Ÿåœ¨è¿è¡Œè¯¥ç¨‹åºæ—¶æ‰¾ä¸åˆ°æ‰€éœ€çš„å…±äº«åº“æ–‡ä»¶ libxkbcommon-x11.so.0ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¯ä»¥è§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•ï¼š å®‰è£…ç¼ºå¤±çš„åº“åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… libxkbcommon-x11 åº“ï¼š sudo apt updatesudo apt install libxkbcommon-x11-0 åˆ›å»ºè½¯é“¾æ¥å¦‚æœç³»ç»Ÿä¸­å­˜åœ¨ç±»ä¼¼ç‰ˆæœ¬çš„åº“æ–‡ä»¶ï¼Œä½†æ–‡ä»¶åä¸å®Œå…¨åŒ¹é…ï¼Œä½ å¯ä»¥å°è¯•åˆ›å»ºè½¯é“¾æ¥ã€‚é¦–å…ˆï¼Œä½¿ç”¨ find å‘½ä»¤æŸ¥æ‰¾ç±»ä¼¼çš„åº“æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š sudo find / -name libxkbcommon-x11.so.* å‡è®¾æ‰¾åˆ°çš„æ–‡ä»¶æ˜¯ libxkbcommon-x11.so.1ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºè½¯é“¾æ¥ï¼š sudo ln -s /path/to/libxkbcommon-x11.so.1 /usr/lib/libxkbcommon-x11.so.0 æ£€æŸ¥åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨äºç³»ç»Ÿä¸­æœ‰æ—¶å€™ï¼Œåº“æ–‡ä»¶å¯èƒ½å·²ç»å­˜åœ¨äºç³»ç»Ÿä¸­ï¼Œä½†ä¸åœ¨ç³»ç»Ÿé»˜è®¤çš„æœç´¢è·¯å¾„é‡Œã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥æ‰¾è¯¥åº“æ–‡ä»¶ï¼š sudo find / -name libxkbcommon-x11.so.0 å¦‚æœæ‰¾åˆ°äº†è¯¥æ–‡ä»¶ï¼Œä½ å¯ä»¥å°†å…¶æ‰€åœ¨çš„ç›®å½•æ·»åŠ åˆ° LD_LIBRARY_PATH ç¯å¢ƒå˜é‡ä¸­ã€‚å‡è®¾æ‰¾åˆ°çš„æ–‡ä»¶è·¯å¾„ä¸º /path/to/libraryï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸´æ—¶æ·»åŠ è¯¥è·¯å¾„ï¼š export LD_LIBRARY_PATH=/path/to/library:$LD_LIBRARY_PATH å¦‚æœä½ å¸Œæœ›æ¯æ¬¡å¯åŠ¨ç³»ç»Ÿæ—¶éƒ½è‡ªåŠ¨æ·»åŠ è¯¥è·¯å¾„ï¼Œå¯ä»¥å°†ä¸Šè¿°å‘½ä»¤æ·»åŠ åˆ° ~/.bashrc æˆ– /etc/profile æ–‡ä»¶ä¸­ã€‚ å¯åŠ¨ Qt å¤±è´¥qt.qpa.plugin: Could not load the Qt platform plugin xcb in even though it was found.This application failed to start because no Qt platform plugin could be initialized. Reinstalling the application may fix this problem.Available platform plugins are: eglfs, linuxfb, minimal, minimalegl, offscreen, vnc, xcb.Aborted (core dumped) å½“ä½ é‡åˆ° qt.qpa.plugin: Could not load the Qt platform plugin xcb in even though it was found. é”™è¯¯æ—¶ï¼Œè¿™è¡¨æ˜ Qt åº”ç”¨ç¨‹åºæ— æ³•åˆå§‹åŒ–æ‰€éœ€çš„ xcb å¹³å°æ’ä»¶ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½çš„è§£å†³åŠæ³•ï¼š 1. å®‰è£…å¿…è¦çš„ä¾èµ–åº“xcb æ’ä»¶ä¾èµ–äºä¸€äº›ç³»ç»Ÿåº“ï¼Œç¡®ä¿è¿™äº›åº“å·²ç»å®‰è£…ï¼š UbuntuDebiansudo apt-get updatesudo apt-get install libxcb-xinerama0 libxcb-xkb1 libxcb-render-util0 libxcb-icccm4 libxcb-image0 libxcb-keysyms1 libxcb-shape0 libxcb-xfixes0 2. è®¾ç½® QT_QPA_PLATFORM_PLUGIN_PATH ç¯å¢ƒå˜é‡æœ‰æ—¶å€™ï¼ŒQt å¯èƒ½æ— æ³•è‡ªåŠ¨æ‰¾åˆ°å¹³å°æ’ä»¶çš„è·¯å¾„ï¼Œä½ å¯ä»¥æ‰‹åŠ¨è®¾ç½® QT_QPA_PLATFORM_PLUGIN_PATH ç¯å¢ƒå˜é‡ã€‚ å…ˆæ‰¾åˆ° xcb æ’ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œé€šå¸¸åœ¨ Qt å®‰è£…ç›®å½•çš„ plugins/platforms ä¸‹ã€‚å‡è®¾ Qt å®‰è£…åœ¨ /opt/Qt5.12.12ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®ç¯å¢ƒå˜é‡ï¼š export QT_QPA_PLATFORM_PLUGIN_PATH=/opt/Qt5.12.12/plugins/platforms ä½ å¯ä»¥å°†ä¸Šè¿°å‘½ä»¤æ·»åŠ åˆ° ~/.bashrc æˆ– ~/.zshrc æ–‡ä»¶ä¸­ï¼Œä½¿å…¶æ¯æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæ•ˆï¼š echo export QT_QPA_PLATFORM_PLUGIN_PATH=/opt/Qt5.12.12/plugins/platforms ~/.bashrcsource ~/.bashrc 3. æ£€æŸ¥æƒé™é—®é¢˜ç¡®ä¿ xcb æ’ä»¶æ–‡ä»¶ä»¥åŠå…¶æ‰€åœ¨ç›®å½•å…·æœ‰æ­£ç¡®çš„æƒé™ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥å’Œä¿®æ”¹æƒé™ï¼š chmod -R 755 /opt/Qt5.12.12/plugins/platforms 4. æ£€æŸ¥ Qt ç‰ˆæœ¬å…¼å®¹æ€§ç¡®ä¿ä½ ä½¿ç”¨çš„ Qt ç‰ˆæœ¬ä¸ç³»ç»Ÿç¯å¢ƒå…¼å®¹ã€‚å¦‚æœ Qt ç‰ˆæœ¬è¿‡æ—§æˆ–è¿‡æ–°ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ’ä»¶åŠ è½½é—®é¢˜ã€‚å°è¯•æ›´æ–°æˆ–é™çº§ Qt åˆ°åˆé€‚çš„ç‰ˆæœ¬ã€‚ 5. æ¸…é™¤ç¼“å­˜æœ‰æ—¶å€™ï¼ŒQt çš„ç¼“å­˜æ–‡ä»¶å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚ä½ å¯ä»¥å°è¯•æ¸…é™¤è¿™äº›ç¼“å­˜æ–‡ä»¶ï¼š rm -rf ~/.cache/Qt* 6. å°è¯•å…¶ä»–å¹³å°æ’ä»¶å¦‚æœ xcb æ’ä»¶ä»ç„¶æ— æ³•åŠ è½½ï¼Œä½ å¯ä»¥å°è¯•ä½¿ç”¨å…¶ä»–å¯ç”¨çš„å¹³å°æ’ä»¶ï¼Œä¾‹å¦‚ offscreenã€‚åœ¨è¿è¡Œ Qt åº”ç”¨ç¨‹åºæ—¶ï¼Œä½¿ç”¨ QT_QPA_PLATFORM ç¯å¢ƒå˜é‡æŒ‡å®šå¹³å°æ’ä»¶ï¼š export QT_QPA_PLATFORM=offscreen./your_qt_application é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ åº”è¯¥èƒ½å¤Ÿè§£å†³ xcb å¹³å°æ’ä»¶åŠ è½½å¤±è´¥çš„é—®é¢˜ã€‚å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œå»ºè®®æ£€æŸ¥ Qt å®‰è£…æ˜¯å¦æ­£ç¡®ï¼Œæˆ–è€…æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","WSL"]},{"title":"QSplitter","path":"/2025/03/05/3-å¼€å‘æ¡†æ¶-Qt-æ§ä»¶-QSplitter/","content":"QSplitterï¼šçµæ´»æ§åˆ¶å­çª—å£å¤§å°çš„ç•Œé¢å…ƒç´ QSplitter æ˜¯ä¸€ç§å¼ºå¤§çš„ç•Œé¢å…ƒç´ ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡æ‹–åŠ¨å­çª—å£ä¹‹é—´çš„è¾¹ç•Œæ¥æ§åˆ¶å®ƒä»¬çš„å¤§å°ã€‚è¿™ç§åŠŸèƒ½ä½¿å¾—ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œçµæ´»è°ƒæ•´ä¸åŒçª—å£çš„æ˜¾ç¤ºæ¯”ä¾‹ï¼Œä»è€Œæå‡æ“ä½œçš„èˆ’é€‚åº¦å’Œæ•ˆç‡ã€‚ 1. å¯æ‹–åŠ¨è¾¹ç•ŒQSplitter çš„æ ¸å¿ƒåŠŸèƒ½åœ¨äºå®ƒæä¾›äº†å¯æ‹–åŠ¨çš„è¾¹ç•Œçº¿ã€‚ç”¨æˆ·åªéœ€ç”¨é¼ æ ‡æŠ“ä½åˆ†éš”çº¿ï¼Œç„¶åå‘å·¦æˆ–å‘å³æ‹–åŠ¨ï¼Œå°±å¯ä»¥è½»æ¾è°ƒæ•´å·¦å³ï¼ˆæˆ–ä¸Šä¸‹ï¼‰ä¸¤ä¸ªå­çª—å£çš„å¤§å°ã€‚è¿™ç§äº¤äº’æ–¹å¼ç›´è§‚ä¸”æ˜“ç”¨ï¼Œéå¸¸é€‚åˆéœ€è¦ç”¨æˆ·è‡ªå®šä¹‰å¸ƒå±€çš„åœºæ™¯ã€‚ 2. æ”¯æŒå¤šä¸ªå­çª—å£é™¤äº†åŸºæœ¬çš„ä¸¤ä¸ªå­çª—å£ï¼ŒQSplitter è¿˜æ”¯æŒåµŒå¥—å¤šä¸ªçª—å£ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªä¸»åˆ†å‰²å™¨ä¸­æ·»åŠ å¤šä¸ªå­åˆ†å‰²å™¨ï¼Œä»è€Œå®ç°æ›´å¤æ‚çš„å¸ƒå±€éœ€æ±‚ã€‚è¿™ç§çµæ´»æ€§ä½¿å¾— QSplitter æˆä¸ºæ„å»ºå¤šçª—å£ç•Œé¢çš„ç†æƒ³é€‰æ‹©ã€‚ 3. ä¿å­˜å’Œæ¢å¤å¸ƒå±€QSplitter æä¾›äº†ä¿å­˜å’Œæ¢å¤å½“å‰çª—å£å¤§å°çš„åŠŸèƒ½ã€‚é€šè¿‡ç¨‹åºåŒ–æ¥å£ï¼Œå¼€å‘è€…å¯ä»¥æ–¹ä¾¿åœ°ä¿å­˜ç”¨æˆ·è°ƒæ•´åçš„å¸ƒå±€ï¼Œå¹¶åœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨æ¢å¤ã€‚è¿™ä¸€ç‰¹æ€§æå¤§åœ°æå‡äº†ç”¨æˆ·ä½“éªŒï¼Œé¿å…äº†æ¯æ¬¡éƒ½éœ€è¦é‡æ–°è°ƒæ•´çª—å£å¤§å°çš„éº»çƒ¦ã€‚ 5. ä¸å…¶ä»–æ§ä»¶çš„ç»“åˆQSplitter å¯ä»¥ä¸å…¶ä»– Qt æ§ä»¶æ— ç¼ç»“åˆã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å°† QTreeWidgetã€QTableWidgetã€QTextEdit ç­‰æ§ä»¶åµŒå…¥åˆ° QSplitter ä¸­ï¼Œæ„å»ºå‡ºåŠŸèƒ½ä¸°å¯Œçš„å¤šçª—å£ç•Œé¢ã€‚è¿™ç§æ¨¡å—åŒ–çš„è®¾è®¡ä½¿å¾—ç•Œé¢æ„å»ºå˜å¾—æ›´åŠ çµæ´»å’Œé«˜æ•ˆã€‚","categories":["3.å¼€å‘æ¡†æ¶","Qt","æ§ä»¶"]},{"title":"pythonç›®å½•ç´¢å¼•","path":"/2025/03/04/2-ç¼–ç¨‹è¯­è¨€-Python-pythonç›®å½•ç´¢å¼•/","content":"åœ¨æ­å»ºä¸€ä¸ªç½‘ç«™æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯å’Œæ¡†æ¶æ¥æ„å»ºå‰ç«¯å’Œåç«¯éƒ¨åˆ†ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¸¸è§çš„ç»„åˆï¼š å‰ç«¯æŠ€æœ¯å’Œæ¡†æ¶ï¼š HTML: ç”¨äºå®šä¹‰ç½‘é¡µçš„ç»“æ„ã€‚ CSS: ç”¨äºç½‘é¡µçš„æ ·å¼å’Œå¸ƒå±€ã€‚ JavaScript: ç”¨äºç½‘é¡µçš„äº¤äº’å’ŒåŠ¨æ€æ•ˆæœã€‚ å¯¹äºå‰ç«¯ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›æµè¡Œçš„å‰ç«¯æ¡†æ¶æ¥ç®€åŒ–å¼€å‘å’Œç®¡ç†çŠ¶æ€ï¼Œä¾‹å¦‚ï¼š React: ç”± Facebook å¼€å‘ï¼Œç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„ JavaScript åº“ã€‚ Vue.js: ä¸€ä¸ªè½»é‡çº§çš„ JavaScript æ¡†æ¶ï¼Œç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢ã€‚ Angular: ç”± Google å¼€å‘ï¼Œç”¨äºæ„å»ºåŠ¨æ€ Web åº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚ åç«¯æŠ€æœ¯å’Œæ¡†æ¶ï¼š Python: ä½œä¸ºåç«¯å¼€å‘è¯­è¨€ï¼Œå¯ä»¥ä½¿ç”¨ Python æ¥å¤„ç†ä¸šåŠ¡é€»è¾‘ã€æ•°æ®å­˜å‚¨ç­‰ã€‚ Web æ¡†æ¶: ç”¨äºç®€åŒ–å¤„ç† HTTP è¯·æ±‚å’Œå“åº”ã€è·¯ç”±ç®¡ç†ç­‰ã€‚ä¸€äº›æµè¡Œçš„ Python Web æ¡†æ¶åŒ…æ‹¬ï¼š Django: ä¸€ä¸ªå¼ºå¤§çš„å…¨æ ˆ Web æ¡†æ¶ï¼Œæä¾›è®¸å¤šå†…ç½®åŠŸèƒ½ã€‚ Flask: ä¸€ä¸ªè½»é‡çº§çš„ Web æ¡†æ¶ï¼Œé€‚åˆæ„å»ºå°å‹åˆ°ä¸­å‹çš„ Web åº”ç”¨ç¨‹åºã€‚ FastAPI: ä¸€ä¸ªå¿«é€Ÿï¼ˆé«˜æ€§èƒ½ï¼‰çš„ Web æ¡†æ¶ï¼Œä¸“æ³¨äº API å¼€å‘ã€‚ å…¶ä»–å¯èƒ½éœ€è¦çš„æŠ€æœ¯å’Œå·¥å…·ï¼š æ•°æ®åº“: å¦‚æœéœ€è¦å­˜å‚¨å’Œç®¡ç†æ•°æ®ï¼Œå¯ä»¥é€‰æ‹©åˆé€‚çš„æ•°æ®åº“ï¼Œå¦‚ MySQLã€PostgreSQLã€SQLite ç­‰ã€‚ RESTful API: å¦‚æœçš„å‰ç«¯å’Œåç«¯éœ€è¦è¿›è¡Œé€šä¿¡ï¼Œè®¾è®¡å’Œå®ç° RESTful API å¯ä»¥æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹å¼ã€‚ ç‰ˆæœ¬æ§åˆ¶: ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼ˆå¦‚ Gitï¼‰æ¥ç®¡ç†ä»£ç ç‰ˆæœ¬å’Œåä½œã€‚ Web æœåŠ¡å™¨: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œéœ€è¦ä¸€ä¸ª Web æœåŠ¡å™¨ï¼ˆå¦‚ Nginxã€Apacheï¼‰æ¥å¤„ç† HTTP è¯·æ±‚ï¼Œå¹¶å°†å®ƒä»¬è½¬å‘ç»™åç«¯åº”ç”¨ç¨‹åºã€‚ éƒ¨ç½²å’Œæ‰˜ç®¡: å°†çš„ç½‘ç«™éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒå¯èƒ½éœ€è¦ä½¿ç”¨äº‘æœåŠ¡ï¼ˆå¦‚ AWSã€Azureã€Herokuï¼‰æˆ–è™šæ‹Ÿä¸“ç”¨æœåŠ¡å™¨ï¼ˆVPSï¼‰ã€‚ å®‰å…¨æ€§: ä¿æŠ¤çš„ç½‘ç«™å…å—å®‰å…¨å¨èƒï¼ŒåŒ…æ‹¬è¾“å…¥éªŒè¯ã€èº«ä»½éªŒè¯ã€æˆæƒç­‰ã€‚ æ€»ä¹‹ï¼Œé€‰æ‹©é€‚åˆé¡¹ç›®éœ€æ±‚å’ŒæŠ€èƒ½æ°´å¹³çš„æŠ€æœ¯å’Œæ¡†æ¶æ˜¯å¾ˆé‡è¦çš„ã€‚è¿™é‡Œæåˆ°çš„åªæ˜¯ä¸€äº›å¸¸è§çš„é€‰æ‹©ï¼Œå®é™…ä¸Šè¿˜æœ‰è®¸å¤šå…¶ä»–æŠ€æœ¯å’Œå·¥å…·å¯ä¾›é€‰æ‹©ã€‚ import osdef generate_index(path): index = ul class=menu for root, dirs, files in os.walk(path):# Create a list item for each folder for dir_name in dirs: index += fliadir_name/aul class=menu for file_name in files: index += flia href=os.path.join(root, dir_name, file_name)file_name/a/li index += /ul/li index += /ul return index# Specify the root directory for indexingroot_directory = ./StudyDocindex_html = generate_index(root_directory)print(index_html)","categories":["2.ç¼–ç¨‹è¯­è¨€","Python"]},{"title":"å¾®ä¿¡åå°æœºå™¨äºº","path":"/2025/03/04/2-ç¼–ç¨‹è¯­è¨€-Python-å¾®ä¿¡åå°æœºå™¨äºº/","content":"åŸºäºå¾®ä¿¡å…¬ä¼—å·åå°çš„å¤¸å…‹ç½‘ç›˜èµ„æºæŸ¥æ‰¾å’Œ OpenAI çš„å›å¤ # å¯¼å…¥å¿…è¦çš„åº“import werobotimport openaifrom openai import OpenAIimport reimport jsonimport requestsimport pandas as pdfrom bs4 import BeautifulSoupfrom functools import partialfrom datetime import datetime, timedelta# å®šä¹‰è¯·æ±‚å¤´ï¼Œæ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—®headers = User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36, Authorization: Bearer token123, Cookie: session=abcdef123456# åˆå§‹åŒ– OpenAI å®¢æˆ·ç«¯client = OpenAI( api_key=*****************************, base_url=*****************************)# åˆå§‹åŒ– WeRoBot å®ä¾‹robot = werobot.WeRoBot()# é…ç½®ç±»ï¼Œè®¾ç½®å¾®ä¿¡å…¬ä¼—å·çš„ç›¸å…³å‚æ•°class RobotConfig(object): HOST = *.*.*.* # ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ PORT = xxxx # ä½¿ç”¨80ç«¯å£ TOKEN = xxxxxxxx # å¾®ä¿¡å…¬ä¼—å·çš„æ¥å…¥å‡­è¯robot.config.from_object(RobotConfig)# å®šä¹‰ç”Ÿæˆå›å¤çš„å‡½æ•°def generate_response(prompt): ç”Ÿæˆå¯¹è¯çš„å›å¤ Args: prompt (str): ç”¨æˆ·è¾“å…¥çš„å†…å®¹ Returns: str: ç”Ÿæˆçš„å›å¤å†…å®¹ messages = [role: user, content: prompt] try: completion = client.chat.completions.create(model=gpt-3.5-turbo, messages=messages) return completion.choices[0].message.content except Exception as e: return fé”™è¯¯ï¼šstr(e)# å®šä¹‰è·å– URL çš„å‡½æ•°def getUrl(url): çˆ¬å–æŒ‡å®š URL å¹¶æå–ç›¸å…³é“¾æ¥ Args: url (str): éœ€è¦çˆ¬å–çš„ URL Returns: str: æå–åˆ°çš„é“¾æ¥ï¼Œæ¢è¡Œåˆ†éš” result = try: response = requests.get(url, headers=headers, timeout=10) if response.status_code == 200: soup = BeautifulSoup(response.content, html.parser) elements = soup.find_all(class_=container) for links in elements: a_tags = links.find_all(a, href=True) for a in a_tags: if a[href].startswith(https://quarkzy.com/): try: response2 = requests.get(a[href], headers=headers, timeout=10) if response2.status_code == 200: soup2 = BeautifulSoup(response2.content, html.parser) b_tags = soup2.find_all(a, href=True) for b in b_tags: if b[href].startswith(https://pan.quark): result += b[href] + \\r except Exception as e: continue else: result = fè¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : response.status_code except Exception as e: result = fè¯·æ±‚é”™è¯¯ï¼šstr(e) return result# å®šä¹‰å¾®ä¿¡æ¶ˆæ¯å¤„ç†å™¨@robot.handlerdef weChatReturn(messages): å¤„ç†å¾®ä¿¡å…¬ä¼—å·çš„æ¶ˆæ¯ Args: messages: å¾®ä¿¡å…¬ä¼—å·çš„æ¶ˆæ¯å¯¹è±¡ Returns: str: å›å¤å†…å®¹ msg = messages.content retMsg = if msg.startswith(å¤¸å…‹): url = https://quarkzy.com/?q= url += msg[3:] retMsg += getUrl(url) else: retMsg += generate_response(msg) return retMsg# ä¸»ç¨‹åºif __name__ == __main__: # æµ‹è¯•ç”Ÿæˆå›å¤ # messages = å¤¸å…‹ çŒç½ªå›¾é‰´ # print(weChatReturn(messages)) robot.run() æ”¹è¿›è¯´æ˜ï¼š æ·»åŠ æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²ï¼šä¸ºæ¯ä¸ªå‡½æ•°æ·»åŠ äº†è¯¦ç»†çš„æ³¨é‡Šï¼Œè¯´æ˜å…¶åŠŸèƒ½ã€å‚æ•°å’Œè¿”å›å€¼ï¼Œæ–¹ä¾¿ä»–äººç†è§£ä»£ç ã€‚ é”™è¯¯å¤„ç†ï¼šåœ¨å…³é”®çš„åœ°æ–¹æ·»åŠ äº† try-except å—ï¼Œå¤„ç†å¯èƒ½çš„å¼‚å¸¸ï¼Œé¿å…ç¨‹åºå› ç½‘ç»œé—®é¢˜æˆ–è§£æé”™è¯¯è€Œå´©æºƒã€‚ ä»£ç ç»“æ„ä¼˜åŒ–ï¼šè°ƒæ•´äº†ä»£ç ç»“æ„ï¼Œä½¿å…¶æ›´ç¬¦åˆ Python çš„ç¼–ç è§„èŒƒï¼Œå¢åŠ äº†ç©ºè¡Œå’Œæ³¨é‡Šï¼Œæé«˜å¯è¯»æ€§ã€‚ å®‰å…¨æç¤ºï¼šæ³¨é‡Šæé†’ç”¨æˆ·æ³¨æ„ä¿æŠ¤ API å¯†é’¥å’Œå…¶ä»–æ•æ„Ÿä¿¡æ¯ã€‚ è¯¦ç»†æ­¥éª¤è¯´æ˜ï¼šåœ¨ä»£ç ä¸­æ·»åŠ äº†è¯¦ç»†çš„æ­¥éª¤è¯´æ˜ï¼Œå¸®åŠ©è¯»è€…ç†è§£æ¯ä¸ªéƒ¨åˆ†çš„åŠŸèƒ½ã€‚ æ·»åŠ  timeout å‚æ•°ï¼šåœ¨ requests.get() ä¸­æ·»åŠ äº† timeout å‚æ•°ï¼Œé¿å…å› ç½‘ç»œå»¶è¿Ÿå¯¼è‡´ç¨‹åºé•¿æ—¶é—´æ— å“åº”ã€‚ ç»“æœå¤„ç†ï¼šåœ¨ getUrl() å‡½æ•°ä¸­ï¼Œç»“æœä»¥æ¢è¡Œåˆ†éš”ï¼Œæ–¹ä¾¿åç»­å¤„ç†å’Œå±•ç¤ºã€‚ å‡½æ•°åˆ†ç¦»ï¼šå°†åŠŸèƒ½åˆ†ç¦»åˆ°ä¸åŒçš„å‡½æ•°ä¸­ï¼Œæé«˜ä»£ç çš„æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤æ€§ã€‚ æ—¥å¿—å’Œè°ƒè¯•ä¿¡æ¯ï¼šåœ¨å…³é”®æ­¥éª¤æ·»åŠ äº†æ‰“å°è¯­å¥ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œæ’æŸ¥é—®é¢˜ã€‚ ä»£ç é£æ ¼ç»Ÿä¸€ï¼šç»Ÿä¸€äº†ä»£ç é£æ ¼ï¼Œéµå¾ª PEP8 ç¼–ç è§„èŒƒï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œä¸€è‡´æ€§ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Python"]},{"title":"åŸºäºLinuxç³»ç»Ÿçš„ARMå¹³å°QTç§»æ¤","path":"/2025/03/02/3-å¼€å‘æ¡†æ¶-Qt-åŸºäºLinuxç³»ç»Ÿçš„ARMå¹³å°QTç§»æ¤/","content":"ç§»æ¤å‰è¿°åœ¨å½“å‰çš„æŠ€æœ¯ç¯å¢ƒä¸­ï¼ŒARM è¡Œä¸šæ­£è“¬å‹ƒå‘å±•ï¼Œè¶Šæ¥è¶Šå¤šçš„è®¾å¤‡é€‰æ‹©ä½¿ç”¨ Linux ä½œä¸ºæ“ä½œç³»ç»Ÿã€‚æœ¬æ–‡å°†ä¸“æ³¨äºåœ¨ ARM å’Œ Linux å¹³å°ä¸‹è¿›è¡Œ Qt çš„ç§»æ¤å’Œç¨‹åºæµ‹è¯•ï¼Œå…¶ä»–ç³»ç»Ÿå¦‚ Windows CE ç­‰å°†ä¸åœ¨è®¨è®ºèŒƒå›´å†…ã€‚ ARM å¼€å‘æ‰€éœ€çš„ç¡¬ä»¶å’Œå¹³å°æ¡ä»¶è¿›è¡Œ ARM å¼€å‘æ—¶ï¼Œå¿…é¡»å…·å¤‡ä»¥ä¸‹ç¡¬ä»¶å’Œå¹³å°æ¡ä»¶ï¼š ARM ç¡¬ä»¶å¼€å‘æ¿ç›®å‰ï¼Œå¸‚åœºä¸Šå¹¿æ³›ä½¿ç”¨çš„å¤„ç†å™¨ä¸»è¦æ˜¯ ARM9 å’Œ ARM11ã€‚è¿™äº›å¼€å‘æ¿é€šå¸¸é…å¤‡äº†å¿…è¦çš„æ¥å£å’ŒåŠŸèƒ½ï¼Œæ–¹ä¾¿å¼€å‘è€…è¿›è¡Œå„ç§å®éªŒå’Œæµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œå¸¸è§çš„å¼€å‘æ¿å¦‚ BeagleBone å’Œ Raspberry Piï¼Œå®ƒä»¬éƒ½åŸºäº ARM æ¶æ„ï¼Œé€‚åˆè¿›è¡ŒåµŒå…¥å¼å¼€å‘ã€‚ Linux ç³»ç»Ÿå†…æ ¸é’ˆå¯¹åµŒå…¥å¼è¡Œä¸šçš„ Linux ç³»ç»Ÿå†…æ ¸æ˜¯å¿…ä¸å¯å°‘çš„ã€‚æ­¤å¤–ï¼Œå¼€å‘è€…è¿˜éœ€è¦åœ¨ PC ä¸Šæ­å»º Linux å¼€å‘ç¯å¢ƒï¼Œå¸¸ç”¨çš„å‘è¡Œç‰ˆåŒ…æ‹¬ Ubuntuã€Red Hat å’Œ CentOS ç­‰ã€‚è¿™äº›ç³»ç»Ÿæä¾›äº†ä¸°å¯Œçš„å¼€å‘å·¥å…·å’Œåº“ï¼Œæ”¯æŒå¼€å‘è€…è¿›è¡Œé«˜æ•ˆçš„åº”ç”¨ç¨‹åºå¼€å‘ã€‚ ARM è½¯ä»¶å¼€å‘ç¯å¢ƒARM å¼€å‘ç¯å¢ƒç›¸å¯¹å¤æ‚ï¼Œæ¶µç›–äº†åº•å±‚é©±åŠ¨çš„ç§»æ¤ä¸å¼€å‘ï¼Œä»¥åŠé¡¶å±‚åº”ç”¨ç¨‹åºçš„å¼€å‘ã€‚å¼€å‘è€…éœ€è¦ä½¿ç”¨ç›¸åº”çš„å·¥å…·å’Œè½¯ä»¶è¿›è¡Œè°ƒè¯•å’Œå¼€å‘ã€‚è™½ç„¶æœ¬æ–‡ä¸æ¶‰åŠé©±åŠ¨å¼€å‘çš„ç»†èŠ‚ï¼Œä½†é¡¶å±‚åº”ç”¨ç¨‹åºå¼€å‘çš„ä¸€ä¸ªé‡è¦ç¯èŠ‚æ˜¯å›¾å½¢ç”¨æˆ·ç•Œé¢çš„è®¾è®¡ã€‚åœ¨åµŒå…¥å¼é¢†åŸŸï¼ŒQt æ˜¯æœ€å¸¸ç”¨çš„å›¾å½¢ç•Œé¢å¼€å‘æ¡†æ¶ã€‚ Qt æ˜¯ç”±è¯ºåŸºäºšå¼€å‘çš„è·¨å¹³å° C++å›¾å½¢ç”¨æˆ·ç•Œé¢åº”ç”¨ç¨‹åºæ¡†æ¶ã€‚å®ƒä¸ºå¼€å‘è€…æä¾›äº†æ„å»ºè‰ºæœ¯çº§å›¾å½¢ç”¨æˆ·ç•Œé¢æ‰€éœ€çš„æ‰€æœ‰åŠŸèƒ½ã€‚Qt å®Œå…¨é¢å‘å¯¹è±¡ï¼Œæ˜“äºæ‰©å±•ï¼Œå¹¶æ”¯æŒç»„ä»¶åŒ–ç¼–ç¨‹ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿé«˜æ•ˆåœ°åˆ›å»ºå¤æ‚çš„ç”¨æˆ·ç•Œé¢ã€‚ åº”ç”¨ç¨‹åºå¼€å‘ä¸è°ƒè¯•å¼€å‘è€…é€šå¸¸åœ¨ PC ä¸Šå®Œæˆåº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œéšåå¸Œæœ›åœ¨ ARM å¼€å‘æ¿ä¸Šè¿›è¡Œè°ƒè¯•ï¼Œä»¥éªŒè¯ç¨‹åºçš„æ­£ç¡®æ€§å’Œå®Œæ•´æ€§ã€‚è¿™ä¸€è¿‡ç¨‹æ¶‰åŠå¤šä¸ªçŸ¥è¯†é¢†åŸŸï¼ŒåŒ…æ‹¬ï¼š å¼€å‘æ¿å¼•å¯¼å¯åŠ¨æ–‡ä»¶ U-Bootï¼šU-Boot æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„å¼•å¯¼åŠ è½½ç¨‹åºï¼Œè´Ÿè´£åœ¨è®¾å¤‡å¯åŠ¨æ—¶åŠ è½½ Linux å†…æ ¸ã€‚ Linux å†…æ ¸é•œåƒçš„çƒ§å†™ï¼šå°†ç¼–è¯‘å¥½çš„ Linux å†…æ ¸é•œåƒå†™å…¥å¼€å‘æ¿çš„å­˜å‚¨ä»‹è´¨ï¼Œä»¥ä¾¿è®¾å¤‡å¯åŠ¨æ—¶èƒ½å¤ŸåŠ è½½ã€‚ äº¤å‰ç¼–è¯‘ï¼šç”±äº ARM æ¶æ„ä¸ PC æ¶æ„ä¸åŒï¼Œå¼€å‘è€…éœ€è¦ä½¿ç”¨äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œå°†ä»£ç ç¼–è¯‘ä¸º ARM å¯æ‰§è¡Œæ–‡ä»¶ã€‚ æ­å»º Qt å¼€å‘ç¯å¢ƒï¼šåœ¨ PC ä¸Šé…ç½® Qt å¼€å‘ç¯å¢ƒï¼ŒåŒ…æ‹¬å®‰è£… Qt åº“å’Œå¼€å‘å·¥å…·ã€‚ å¼€å‘æ¿ä¸ PC çš„ NFS æŒ‚è½½è¿æ¥ï¼šé€šè¿‡ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰å°†å¼€å‘æ¿ä¸ PC è¿æ¥ï¼Œæ–¹ä¾¿æ–‡ä»¶çš„å…±äº«å’Œè®¿é—®ã€‚ Qt ç¨‹åºåœ¨çº¿æµ‹è¯•ï¼šåœ¨å¼€å‘æ¿ä¸Šè¿è¡Œ Qt åº”ç”¨ç¨‹åºï¼Œè¿›è¡Œå®æ—¶æµ‹è¯•å’Œè°ƒè¯•ã€‚ ä¸Šè¿°å†…å®¹æ¶‰åŠçš„äº¤å‰ç¼–è¯‘ä¹‹å‰çš„æ‰€æœ‰æ“ä½œï¼Œæœ¬æ–‡å°†ä¸ä½œè¯¦ç»†è®¨è®ºã€‚è‹¥è¯»è€…å¯¹æ­¤æœ‰ç–‘é—®ï¼Œå»ºè®®æŸ¥é˜…ç›¸å…³èµ„æ–™ã€‚æœ¬æ–‡çš„ä¸»è¦ç›®çš„æ˜¯æ„å»ºä¸€ä¸ª Qt å¼€å‘ç¯å¢ƒï¼Œå¹¶ä»‹ç»å¦‚ä½•é€šè¿‡ NFS æŒ‚è½½è¿›è¡Œ Qt åº”ç”¨ç¨‹åºçš„æµ‹è¯•ã€‚ QT ç§»æ¤å…·å¤‡æ¡ä»¶ äº¤å‰ç¼–è¯‘å™¨äº¤å‰ç¼–è¯‘å™¨æ˜¯å°†ä»£ç ç¼–è¯‘ä¸ºä¸åŒå¹³å°å¯æ‰§è¡Œæ–‡ä»¶çš„å·¥å…·ã€‚åœ¨ QT ç§»æ¤è¿‡ç¨‹ä¸­ï¼Œå¸¸ç”¨çš„ç‰ˆæœ¬åŒ…æ‹¬ arm-linux-gcc-4.3.2 å’Œ arm-linux-gcc-4.1.2ã€‚è¿™äº›ç¼–è¯‘å™¨èƒ½å¤Ÿå°†ä¸º Linux ç¯å¢ƒç¼–å†™çš„ä»£ç è½¬æ¢ä¸ºé€‚ç”¨äº ARM æ¶æ„çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨ä¸€å° x86 æ¶æ„çš„ PC ä¸Šå¼€å‘åº”ç”¨ç¨‹åºï¼Œäº¤å‰ç¼–è¯‘å™¨å°†å¸®åŠ©ä½ ç”Ÿæˆå¯ä»¥åœ¨ ARM å¼€å‘æ¿ä¸Šè¿è¡Œçš„ä»£ç ã€‚ QT ç‰ˆæœ¬éœ€è¦ä¸‹è½½ç‰¹å®šç‰ˆæœ¬çš„ QT åº“ï¼Œæ¨èä½¿ç”¨ qt-embedded-linux-opensource-src-4.5.3.tar.gz å’Œ qt-x11-opensource-src-4.5.3.tar.gzã€‚è¿™äº›æ–‡ä»¶å¯ä»¥ä» QT çš„å®˜æ–¹ç½‘ç«™è·å–ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒQT çš„å¼€å‘å…¬å¸å·²ç»è¢«è¯ºåŸºäºšæ”¶è´­ï¼Œå› æ­¤å®˜æ–¹ç½‘ç«™åœ°å€ä¸º http://qt.nokia.com/ã€‚ qt-embedded-linux-opensource-src åŒ…å«äº†æ”¯æŒåœ¨ ARM å¼€å‘æ¿ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºæ‰€éœ€çš„åº“æ–‡ä»¶ã€‚ qt-x11-opensource-src åˆ™ç”¨äºåœ¨ PC ä¸Šæ¨¡æ‹Ÿ ARM ç¯å¢ƒï¼Œä»¥ä¾¿è¿›è¡Œç¨‹åºè°ƒè¯•ã€‚è¿™åœ¨æ²¡æœ‰å®é™…å¼€å‘æ¿çš„æƒ…å†µä¸‹å°¤ä¸ºé‡è¦ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ PC ä¸ŠéªŒè¯ä»£ç çš„å¯è¡Œæ€§ã€‚ è§¦æ‘¸å±æ”¯æŒ tslibtslib æ˜¯ä¸€ä¸ªç”¨äºè§¦æ‘¸å±çš„æ”¯æŒåº“ï¼Œè´Ÿè´£å¤„ç†è§¦æ‘¸è¾“å…¥ã€‚å®ƒçš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼šé¦–å…ˆï¼Œè§¦æ‘¸æ•°æ®é€šè¿‡å¼€å‘æ¿ä¸Šçš„é©±åŠ¨ç¨‹åºè·å–ï¼ˆè¿™äº›é©±åŠ¨ç¨‹åºå·²ç»åŠ è½½åˆ°å†…æ ¸ä¸­ï¼‰ã€‚æ¥ç€ï¼Œè¿™äº›åŸå§‹æ•°æ®ä¼šä¼ é€’ç»™ tslibï¼Œè¯¥åº“ä¼šå¯¹æ•°æ®è¿›è¡Œå»æŠ–åŠ¨å’Œæ ¡å‡†ç­‰å¤„ç†ï¼Œç¡®ä¿è§¦æ‘¸è¾“å…¥çš„å‡†ç¡®æ€§ã€‚æœ€åï¼Œå¤„ç†åçš„æ•°æ®å°†è¢«ä¼ é€’ç»™é¡¶å±‚åº”ç”¨ç¨‹åºã€‚è¿™æ ·ï¼Œå¼€å‘è€…å¯ä»¥ç¡®ä¿ç”¨æˆ·çš„è§¦æ‘¸æ“ä½œèƒ½å¤Ÿè¢«å‡†ç¡®è¯†åˆ«å’Œå“åº”ã€‚ Linux ç³»ç»Ÿä¸Šçš„ä¸€äº›ç¼–è¯‘å·¥å…·æˆ–åº“åœ¨è¿›è¡Œ QT ç§»æ¤æ—¶ï¼Œè¿˜éœ€è¦ä¸€äº›é¢å¤–çš„ç¼–è¯‘å·¥å…·å’Œåº“ã€‚è¿™äº›å·¥å…·å¯èƒ½åŒ…æ‹¬ makeã€cmake ç­‰æ„å»ºå·¥å…·ï¼Œä»¥åŠä¸€äº›å¿…è¦çš„å¼€å‘åº“ï¼Œå¦‚ libX11ã€libXext ç­‰ã€‚è¿™äº›å·¥å…·å’Œåº“å°†å¸®åŠ©ä½ åœ¨ Linux ç³»ç»Ÿä¸Šé¡ºåˆ©ç¼–è¯‘å’Œè°ƒè¯• QT åº”ç”¨ç¨‹åºã€‚ è¯´æ˜ äº¤å‰ç¼–è¯‘å·¥å…·åœ¨ QT åº“å®‰è£…æ—¶è‡³å…³é‡è¦ï¼Œå®ƒä¸ä»…ç”¨äºç¼–è¯‘ QT åº“æœ¬èº«ï¼Œè¿˜åœ¨è°ƒè¯• QT åº”ç”¨ç¨‹åºæ—¶å°†ä»£ç ç¼–è¯‘æˆ ARM æ¿ä¸Šå¯è¿è¡Œçš„æ ¼å¼ã€‚ qt-embedded-linux-opensource-src æä¾›äº†æ”¯æŒåœ¨ ARM å¼€å‘æ¿ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºçš„å¿…è¦åº“æ–‡ä»¶ï¼Œè€Œ qt-x11-opensource-src åˆ™ç”¨äºåœ¨ PC ä¸Šè¿›è¡Œ ARM ç¯å¢ƒçš„æ¨¡æ‹Ÿè°ƒè¯•ï¼Œç¡®ä¿åœ¨æ²¡æœ‰å¼€å‘æ¿çš„æƒ…å†µä¸‹ä¹Ÿèƒ½éªŒè¯ç¨‹åºçš„å¯è¡Œæ€§ã€‚ tslib çš„ä½œç”¨æ˜¯æ ¡å‡†è§¦æ‘¸å±ï¼Œç¡®ä¿è§¦æ‘¸è¾“å…¥çš„å‡†ç¡®æ€§ã€‚å®ƒé€šè¿‡å»æŠ–åŠ¨å’Œæ ¡å‡†ç­‰å¤„ç†ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼Œä½¿å¾—åº”ç”¨ç¨‹åºèƒ½å¤Ÿæ›´å¥½åœ°å“åº”ç”¨æˆ·çš„è§¦æ‘¸æ“ä½œã€‚ ç¬¬ä¸‰éƒ¨åˆ†ï¼šQT ç§»æ¤è¯¦æƒ…æ³¨ï¼šæ­¤ç§»æ¤è¿‡ç¨‹åœ¨ Ubuntu 9.04 ç³»ç»Ÿä¸‹å®Œæˆ å¸¦ # å¼€å¤´çš„è¡¨ç¤ºç»ˆç«¯è¿è¡Œçš„å‘½ä»¤å¸¦ // å¼€å¤´çš„è¡¨ç¤ºæ³¨é‡Šçº¢è‰²å­—ä½“è¡¨ç¤ºåº”è¯¥ç‰¹åˆ«æ³¨æ„çš„åœ°æ–¹ æˆ‘çš„ç§»æ¤ç¯å¢ƒ å¼€å‘æ¿ï¼šå‹åšæ’å¤©å…¬å¸çš„ S3C6410 PC æœºç³»ç»Ÿï¼šWindows XP PC æœºä¸Šè£… VMware è™šæ‹Ÿæœºç³»ç»Ÿï¼šUbuntu 9.04 äº¤å‰ç¼–è¯‘å·¥å…·ï¼šarm920t-eabi-4.1.2.tar.gz Qt ç‰ˆæœ¬ï¼šqt-embedded-linux-opensource-src-4.5.3.tar.gz è§¦æ‘¸å±æ ¡å‡†ï¼štslib1.4.tar.gz ç¬¬ä¸€æ­¥ï¼šå®‰è£…äº¤å‰ç¼–è¯‘å·¥å…·è§£å‹å¹¶è®¾ç½®ç¯å¢ƒå˜é‡ å°† arm920t-eabi-4.1.2.tar.gz æ‹·è´åˆ° /home/resource ä¸‹ï¼Œç„¶åè§£å‹åˆ°æ ¹ç›®å½•ï¼š # cd /home# mkdir resource# cd /home/resource# tar zxvf arm920t-eabi-4.1.2.tar.gz -C / æ³¨ï¼šzxvf æ˜¯è§£å‹å‚æ•°ï¼Œ-C æ˜¯æ”¹å˜è§£å‹è·¯å¾„ï¼Œ/ è¡¨ç¤ºåˆ°æ ¹ç›®å½•ã€‚ è§£å‹å®Œæˆåï¼Œå®‰è£…è·¯å¾„ä¸º /opt/toolchains/arm920teabi/ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š # ls /opt/toolchains/arm920teabi/ ä¸ºäº†åç»­ QT å®‰è£…èƒ½å¤Ÿè°ƒç”¨ arm-linux-gcc ç­‰å‘½ä»¤ï¼Œéœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ï¼š # gedit /etc/bash.bashrc åœ¨è¯¥æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ï¼š export PATH=$PATH:/opt/toolchains/arm920teabi/bin ä¿å­˜å¹¶å…³é—­æ–‡ä»¶åï¼Œæ‰§è¡Œï¼š # source /etc/bash.bashrc# arm-linux-gcc -v æ³¨ï¼š å®‰è£…è·¯å¾„å¯ä»¥è‡ªå®šä¹‰ï¼Œä½†ç¯å¢ƒå˜é‡è®¾ç½®å¿…é¡»ä¸å®‰è£…è·¯å¾„ä¸€è‡´ã€‚ ä¸åŒçš„äº¤å‰ç¼–è¯‘å·¥å…·é»˜è®¤çš„å®‰è£…è·¯å¾„ä¸åŒï¼Œç¡®ä¿ç¯å¢ƒå˜é‡è®¾ç½®æ­£ç¡®ã€‚ ç¬¬äºŒæ­¥ï¼šå®‰è£… tslibè§£å‹å¹¶å®‰è£…ï¼Œç„¶åè®¾ç½®é…ç½®æ–‡ä»¶ åœ¨ Ubuntu ä¸‹å®‰è£…å¿…è¦çš„å·¥å…·ï¼š # apt-get install automake autoconf libtool tslib æ˜¯æ”¯æŒè§¦æ‘¸å±çš„åº“ï¼Œç¡®ä¿ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ï¼š ç¡¬ä»¶æ”¯æŒè§¦æ‘¸å±ã€‚ å†…æ ¸å·²åŠ è½½è§¦æ‘¸å±é©±åŠ¨ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤æµ‹è¯•ï¼š # cat /dev/input/event0 å¦‚æœé©±åŠ¨å·²åŠ è½½ï¼Œç‚¹å‡»è§¦æ‘¸å±ä¼šæœ‰ååº”ï¼ˆå¦‚ä¹±ç ï¼‰ã€‚ æœ‰æ”¯æŒè§¦æ‘¸å±æ ¡å‡†çš„åº“ï¼Œtslib æ˜¯å¸¸ç”¨çš„é€‰æ‹©ã€‚ åº”ç”¨ç¨‹åºæ”¯æŒè§¦æ‘¸å±ã€‚ å°† tslib1.4.tar.gz æ‹·è´åˆ° /home/resource ä¸‹ï¼Œç„¶åè§£å‹åˆ° /home ç›®å½•ï¼š # cd /home/# tar zxvf ./resource/tslib1.4.tar.gz è¿›å…¥ tslib ç›®å½•å¹¶é…ç½®å®‰è£…ï¼š # cd tslib# ./autogen.sh# ./configure --prefix=/usr/local/tslib/ --host=arm-linux ac_cv_func_malloc_0_nonnull=yes ç”Ÿæˆ Makefile å¹¶å®‰è£…ï¼š # make# make install æ¸…ç†å®‰è£…æ–‡ä»¶ï¼š # cd /home# rm -r tslib æ³¨ï¼šå®‰è£…è¿‡ç¨‹ä¸­è‹¥æ²¡æœ‰å‡ºç°é”™è¯¯ï¼Œåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸï¼Œæ£€æŸ¥ /usr/local/tslib/ ä¸‹æ˜¯å¦æœ‰å®‰è£…å¥½çš„æ–‡ä»¶ã€‚ ç¬¬ä¸‰æ­¥ï¼šå®‰è£… Qtå®‰è£… qt-embedded-linux-opensource-src-4.5.3.tar.gz ç¡®ä¿å·²å®‰è£… Linux ä¸‹çš„ G++ å·¥å…·ï¼š # apt-get install g++ å°† qt-embedded-linux-opensource-src-4.5.3.tar.gz æ‹·è´åˆ° /home/resource ä¸‹å¹¶è§£å‹ï¼š # cd /home# tar zxvf ./resource/qt-embedded-linux-opensource-src-4.5.3.tar.gz è¿›å…¥è§£å‹åçš„ç›®å½•å¹¶é…ç½® Qtï¼š # cd qt-embedded-linux-opensource-src-4.5.3# ./configure -prefix /usr/local/Trolltech/QtEmbedded-4.5.3 \\-release -shared \\-fast \\-pch \\-no-qt3support \\-qt-sql-sqlite \\-no-libtiff -no-libmng \\-qt-libjpeg \\-qt-zlib \\-qt-libpng \\-qt-freetype \\-no-openssl \\-nomake examples -nomake demos -nomake tools \\-optimized-qmake \\-no-phonon \\-no-nis \\-no-opengl \\-no-cups \\-no-xcursor -no-xfixes -no-xrandr -no-xrender -no-xkb -no-sm \\-no-xinerama -no-xshape \\-no-separate-debug-info \\-xplatform qws/linux-arm-g++ \\-embedded arm \\-depths 16 \\-no-qvfb \\-qt-gfx-linuxfb \\-no-gfx-qvfb -no-kbd-qvfb -no-mouse-qvfb \\-qt-kbd-usb \\-confirm-license \\-no-armfpa \\-qt-mouse-tslib \\-L /usr/local/tslib/lib \\-I /usr/local/tslib/include æ³¨ï¼šä¸Šè¿°é…ç½®å‘½ä»¤ç”¨äºè£å‰ª Qt åº“ï¼Œé¿å…è¿‡å¤§çš„åº“å¯¼è‡´ ARM æ¿è´Ÿè½½ä¸äº†ã€‚å¯ä»¥é€šè¿‡ ./configure -help æŸ¥çœ‹å„é€‰é¡¹çš„å«ä¹‰ã€‚ ç¼–è¯‘å’Œå®‰è£…ï¼š # make# make install ä¿®æ”¹ qmake åç§°ä»¥é¿å…å†²çªï¼š # cd /usr/local/Trolltech/QtEmbedded-4.5.3/bin# mv qmake qmake-arm æ·»åŠ ç¯å¢ƒå˜é‡ï¼š # gedit /etc/bash.bashrc åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š export PATH=$PATH:/usr/local/Trolltech/QtEmbedded-4.5.3/bin ä¿å­˜å¹¶å…³é—­æ–‡ä»¶åï¼Œæ‰§è¡Œï¼š # source /etc/bash.bashrc# qmake-arm (æŒ‰ Tab é”®ï¼Œè‹¥å‡ºç° qmake-arm åˆ™è¡¨ç¤ºç¯å¢ƒå˜é‡è®¾ç½®æˆåŠŸ) ç¬¬å››æ­¥ï¼šå¯åŠ¨ NFS æœåŠ¡åœ¨è¿›è¡Œç¨‹åºè°ƒè¯•æ—¶ï¼Œä½¿ç”¨ NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼‰æŒ‚è½½çš„æ–¹æ³•éå¸¸æ–¹ä¾¿ä¸”èŠ‚çœèµ„æºã€‚é¦–å…ˆï¼Œç¡®ä¿ä½ çš„ Ubuntu ç³»ç»Ÿå·²ç»å®‰è£…äº† NFS æœåŠ¡ã€‚å¦‚æœå°šæœªå®‰è£…ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š # apt-get install nfs-kernel-server // å®‰è£… NFS æœåŠ¡ æ¥ä¸‹æ¥ï¼Œä¿®æ”¹ NFS é…ç½®æ–‡ä»¶ä»¥è®¾ç½®å…±äº«ç›®å½•ï¼š # gedit /etc/exports // æ‰“å¼€ NFS é…ç½®æ–‡ä»¶ åœ¨è¯¥æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š /home/nfs 192.168.1.128(rw,sync,no_root_squash) // 192.168.1.128 ä¸ºå¼€å‘æ¿çš„ IP åœ°å€ ä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚ç„¶åï¼Œé‡å¯ NFS æœåŠ¡ä»¥ä½¿é…ç½®ç”Ÿæ•ˆï¼š # /etc/init.d/portmap restart // é‡å¯ portmap æœåŠ¡# /etc/init.d/nfs-kernel-server restart // é‡å¯ NFS æœåŠ¡ æ³¨æ„ï¼šç¡®ä¿ IP åœ°å€é…ç½®æ­£ç¡®ï¼Œå¦åˆ™ NFS å°†æ— æ³•æŒ‚è½½ã€‚å¼€å‘æ¿å’Œ Ubuntu å¿…é¡»åœ¨åŒä¸€ç½‘æ®µã€‚è‹¥ Ubuntu æ˜¯åœ¨è™šæ‹Ÿæœºä¸­è¿è¡Œï¼Œè¿˜éœ€ç¡®ä¿è™šæ‹Ÿæœºä¸ä¸»æœºï¼ˆPCï¼‰ä¹‹é—´çš„ç½‘ç»œè¿æ¥æ­£å¸¸ã€‚é€šå¸¸ï¼Œä½¿ç”¨æ¡¥æ¥ï¼ˆbridgedï¼‰æˆ– NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰å‡å¯ï¼Œå…·ä½“å¯æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæµ‹è¯•ã€‚å¼€å‘æ¿çš„ IP åœ°å€è®¾ç½®é€šå¸¸ä¼šåœ¨è´­ä¹°æ—¶æä¾›çš„æ–‡æ¡£ä¸­è¯´æ˜ã€‚ ä¾‹å¦‚ï¼Œæˆ‘çš„é…ç½®å¦‚ä¸‹ï¼š å¼€å‘æ¿ IP åœ°å€ï¼š192.168.1.128 ä¸»æœºï¼ˆè™šæ‹Ÿæœºï¼‰IP åœ°å€ï¼š192.168.1.110ï¼ˆåœ¨ç¬¬ä¸ƒæ­¥ä¸­è®¾ç½®ï¼‰ è®¾ç½®å¼€å‘æ¿çš„ IP åœ°å€ï¼šåœ¨ä¸²å£ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š setenv bootargs root=/dev/nfs nfsroot=192.168.1.110:/home/nfs ip=192.168.1.128:192.168.1.110:192.168.1.1:255.255.255.0:www.urbetter.com:eth0:off console=ttySAC0,115200 ç„¶åä¿å­˜é…ç½®ï¼š # saveenv // ä¿å­˜é…ç½® æ­¤å‘½ä»¤åœ¨å¼€å‘æ¿å¯åŠ¨æ—¶è¿›å…¥ U-Bootï¼ˆç±»ä¼¼äº PC çš„ BIOSï¼‰æ—¶è¾“å…¥ã€‚ä½¿ç”¨ä¸²å£è°ƒè¯•å·¥å…·ï¼ˆå¦‚ Windows çš„è¶…çº§ç»ˆç«¯ï¼‰ï¼Œåœ¨å¼€å‘æ¿å¼€æœºæ—¶æŒ‰ç©ºæ ¼é”®è¿›å…¥ U-Bootï¼Œç„¶ååœ¨ä¸²å£ç»ˆç«¯è¾“å…¥ä¸Šè¿°å‘½ä»¤å¹¶ä¿å­˜å‚æ•°é…ç½®ã€‚å…·ä½“æ“ä½œå¯å‚è€ƒç¬¬ä¸ƒæ­¥ã€‚ ç¬¬äº”æ­¥ï¼šä¿®æ”¹æ–‡ä»¶ç³»ç»Ÿä¸ºäº†ç¡®ä¿å¼€å‘æ¿èƒ½å¤ŸæˆåŠŸæŒ‚è½½ NFS å¹¶è¿è¡Œç¨‹åºï¼Œå¿…é¡»ä½¿ç”¨é’ˆå¯¹ ARM ç¡¬ä»¶å¹³å°çš„æ–‡ä»¶ç³»ç»Ÿã€‚é€šå¸¸ï¼Œå¼€å‘æ¿ä¾›åº”å•†ä¼šæä¾›è¿™æ ·çš„æ–‡ä»¶ç³»ç»Ÿã€‚æˆ‘ä½¿ç”¨çš„æ˜¯ urbetter-rootfs-qt-2.2.0.tgzã€‚ å°† urbetter-rootfs-qt-2.2.0.tgz æ‹·è´åˆ° /home/resource ç›®å½•ä¸‹ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª NFS æŒ‚è½½ç”¨çš„å…±äº«æ–‡ä»¶å¤¹ï¼š # cd /home# mkdir nfs // åˆ›å»º NFS å…±äº«ç›®å½•# cd /home/resource# tar zxvf urbetter-rootfs-qt-2.2.0.tgz -C /home/nfs // è§£å‹æ–‡ä»¶ç³»ç»Ÿåˆ° /home/nfs è¿›å…¥ /home/nfs ç›®å½•ï¼Œåˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶ï¼š # cd /home/nfs# ls // æŸ¥çœ‹æ–‡ä»¶ æ‰‹åŠ¨åˆ é™¤ /home/nfs/opt/Qtopia ä¸‹çš„æ‰€æœ‰å†…å®¹ï¼Œä»¥ç§»é™¤æ–‡ä»¶ç³»ç»Ÿè‡ªå¸¦çš„ç³»ç»Ÿè½¯ä»¶ç­‰ã€‚æ¥ç€ï¼Œåˆ é™¤ /home/nfs/usr/local ä¸‹çš„æ‰€æœ‰å†…å®¹ï¼Œä»¥ç§»é™¤æ–‡ä»¶ç³»ç»Ÿè‡ªå¸¦çš„ç”¨æˆ·ç¨‹åºç­‰ã€‚ æ‰“å¼€ /home/nfs/etc/init.d/rcS æ–‡ä»¶ï¼Œå±è”½ç³»ç»Ÿé»˜è®¤å¯åŠ¨ä»£ç ï¼Œåˆ é™¤ä»¥ä¸‹å†…å®¹ï¼š /bin/qtopia // å¯åŠ¨ä»£ç echo /dev/tty1echo Starting Qtopia, please waiting... /dev/tty1 // æç¤ºä¿¡æ¯echo echo Starting Qtopia, please waiting... ä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚ å°† Qt çš„åº“æ–‡ä»¶ä»å®‰è£…ç›®å½•æ‹·è´åˆ° /home/nfs/opt/Qtopiaï¼š # cp -r /usr/local/Trolltech/QtEmbedded-4.5.3/lib /home/nfs/opt/Qtopia // -r æ˜¯é€’å½’æ‹·è´ å°† tslib çš„æ•´ä¸ªæ–‡ä»¶å¤¹æ‹·è´åˆ° /home/nfs/usr/local/ï¼š # cp -r /usr/local/tslib/ /home/nfs/usr/local/ // -r æ˜¯é€’å½’æ‹·è´ è¿›å…¥ /usr/local/tslib/ ç›®å½•ï¼ŒæŸ¥çœ‹ä»¥ä¸‹ç›®å½•ï¼š # cd /usr/local/tslib/# ls // åº”è¯¥çœ‹åˆ° /bin, /etc, /include, /lib åœ¨ /bin ç›®å½•ä¸‹ï¼Œä½ åº”è¯¥çœ‹åˆ°ä¸€äº›å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚ ts_calibrateï¼ˆæ ¡å‡†ç¨‹åºï¼‰å’Œ ts_testï¼ˆæµ‹è¯•ç¨‹åºï¼‰ã€‚åœ¨ /etc ç›®å½•ä¸‹ï¼Œæ‰¾åˆ°è§¦æ‘¸å±çš„é…ç½®æ–‡ä»¶ ts.confï¼Œå¹¶åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š module_raw input // å¯åŠ¨è§¦æ‘¸å±çš„æ•°æ®è¾“å…¥æ–¹å¼module pthres module variance delta=30module dejitter delta=100module linear ä¿å­˜å¹¶å…³é—­è¯¥æ–‡ä»¶ã€‚ è®¾ç½® NFS æ–‡ä»¶ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ï¼š # gedit /home/nfs/etc/profile // æ‰‹åŠ¨ä»¥è®°äº‹æœ¬æ‰“å¼€ åœ¨è¯¥æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š export QTDIR=/opt/Qtopia // Qt æ ¹ç›®å½•export PATH=$QTDIR/bin:$PATH // Qt å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•export QT_QWS_FONTDIR=/opt/Qtopia/lib/fonts // Qt å­—ä½“åº“export TSLIB_ROOT=/usr/local/tslib // tslib è·¯å¾„export TSLIB_TSDEVICE=/dev/input/event1 // æŒ‡å®šè§¦æ‘¸å±å¯¹åº”é©±åŠ¨è®¾å¤‡export TSLIB_FBDEVICE=/dev/fb0export TSLIB_CONSOLEDEVICE=noneexport TSLIB_CALIBFILE=/etc/pointercal // æŒ‡å®šæ ¡å‡†æ–‡ä»¶ç”Ÿæˆç›®å½•export TSLIB_CONFFILE=$TSLIB_ROOT/etc/ts.conf // æŒ‡å®š tslib é…ç½®æ–‡ä»¶export TSLIB_PLUGINDIR=$TSLIB_ROOT/lib/ts // æŒ‡å®š tslib æ•°æ®è¯»å–åº“export LD_LIBRARY_PATH=$TSLIB_ROOT/lib:$QTDIR/lib:$LD_LIBRARY_PATH // æŒ‡å®š QT åº“å’Œ tslib æ ¡å‡†åº“ ä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚ ç¬¬å…­æ­¥ï¼šæ‰¾åˆ° QT æµ‹è¯•ç¨‹åºä¸ºäº†éªŒè¯ QT æ˜¯å¦æˆåŠŸç§»æ¤ï¼Œéœ€è¦è¿›è¡Œ QT ç¨‹åºæµ‹è¯•ã€‚æµ‹è¯•ç¨‹åºæœ‰å¾ˆå¤šï¼Œä¾‹å¦‚åœ¨è§£å‹çš„ /home/qt-embedded-linux-opensource-src-4.5.3/ ç›®å½•ä¸‹çš„ ./demos å’Œ ./examples æ–‡ä»¶å¤¹ä¸­å°±æœ‰è®¸å¤šç¤ºä¾‹ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±å¼€å‘çš„ QT åº”ç”¨ç¨‹åºè¿›è¡Œæµ‹è¯•ã€‚æˆ‘é€‰æ‹©äº† ./demos/embedded ä½œä¸ºæµ‹è¯•ç¨‹åºã€‚ åœ¨æµ‹è¯•ç¨‹åºä¹‹å‰ï¼Œç¡®ä¿å…ˆè¿›è¡Œç¼–è¯‘ï¼Œä½¿ç”¨ qmake-armï¼ˆé‡å‘½ååçš„ qmake å‘½ä»¤ï¼‰è¿›è¡Œç¼–è¯‘ã€‚ç¼–è¯‘æ­¥éª¤å¦‚ä¸‹ï¼š ç¡®ä¿ç¨‹åºå®Œæ•´ä¸”æ­£ç¡®ï¼Œå°†ä¸ç¨‹åºç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆå¦‚å¤´æ–‡ä»¶ç­‰ï¼‰æ”¾åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸‹ã€‚ ä½¿ç”¨ cd å‘½ä»¤è¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š # qmake -project# qmake# make æ‰§è¡Œ make åï¼Œå°†ç”Ÿæˆèƒ½å¤Ÿåœ¨ ARM æ¿ä¸Šè¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆåœ¨ PC ä¸Šæ— æ³•è¿è¡Œï¼‰ã€‚å°†è¯¥å¯æ‰§è¡Œæ–‡ä»¶æ‹·è´åˆ° NFS ç›®å½•ï¼ˆhomenfsï¼‰ä¸‹çš„ä»»æ„ä½ç½®ï¼Œæœ€å¥½è¿åŒæ•´ä¸ªæ–‡ä»¶å¤¹ä¸€èµ·æ‹·è´è¿‡æ¥ã€‚ ä¾‹å¦‚ï¼Œæˆ‘çš„æµ‹è¯•ç¨‹åºä¸º ./demos/embeddedï¼Œè¯¥ç¨‹åºä¸‹æœ‰ä¸‰ä¸ªå°çš„æµ‹è¯•ç¨‹åºï¼Œå¯ä»¥ä¸€èµ·ç¼–è¯‘ï¼Œä¹Ÿå¯ä»¥å•ç‹¬ç¼–è¯‘ã€‚æˆ‘çš„æ“ä½œå¦‚ä¸‹ï¼š # cp -r /home/qt-embedded-linux-opensource-src-4.5.3/demos/embedded /home/nfs // æ‹·è´æµ‹è¯•ç¨‹åº# cd /home/nfs/embedded# ls // æŸ¥çœ‹ä¸‰ä¸ªå°æµ‹è¯•ç¨‹åº# qmake-arm# make // ç¼–è¯‘ä¸‰ä¸ªæµ‹è¯•ç¨‹åº æ­¤æ—¶ï¼Œæµ‹è¯•ç¨‹åºå·²ç»å‡†å¤‡å¥½ï¼Œç­‰å¾…æµ‹è¯•ã€‚ ç¬¬ä¸ƒæ­¥ï¼šNFS æŒ‚è½½æµ‹è¯• ç¡®ä¿å¼€å‘æ¿ä¸ PC è¿æ¥æ­£å¸¸ï¼ŒåŒ…æ‹¬ç½‘çº¿å’Œä¸²å£è¿æ¥ã€‚æ‰“å¼€ç»ˆç«¯è°ƒè¯•å·¥å…·ï¼ˆå¦‚ Xshellï¼‰ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ Windows ä¸‹çš„è¶…çº§ç»ˆç«¯ï¼Œç¡®ä¿æ³¢ç‰¹ç‡è®¾ç½®ä¸º 115200ã€‚ è®¾ç½®è™šæ‹Ÿæœº Ubuntu çš„ IP åœ°å€ï¼š #ifconfig // æŸ¥çœ‹å½“å‰ IP#ifconfig eth5 192.168.1.110 up // é…ç½® IP åœ°å€#ifconfig // ç¡®è®¤ IP åœ°å€ä¸º 192.168.1.110 æ³¨æ„ï¼šeth åé¢çš„æ•°å­—å¯èƒ½ä¸åŒï¼ŒæŸ¥çœ‹ IP æ—¶å¯ä»¥çœ‹åˆ°è‡ªå·±çš„ eth å·ï¼Œæ›¿æ¢ä¸ºç›¸åº”çš„æ•°å­—å³å¯ã€‚ æ‰“å¼€ ARM å¼€å‘æ¿ç”µæºï¼Œæ­¤æ—¶ä½ åº”è¯¥åœ¨ç»ˆç«¯å·¥å…·ä¸Šçœ‹åˆ°ååº”ï¼ˆå‡ºç°ä¸€ç³»åˆ—æ•°æ®ï¼‰ï¼Œå½“å‡ºç°æç¤ºä¿¡æ¯ Please press Enter to active this console. æ—¶ï¼ŒæŒ‰å›è½¦é”®ã€‚ åœ¨ä¸²å£ç»ˆç«¯ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š ä¸²å£ç»ˆç«¯# ls // æ˜¾ç¤º NFS æ–‡ä»¶ç³»ç»Ÿä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¸²å£ç»ˆç«¯# cd /embeddedä¸²å£ç»ˆç«¯# lsä¸²å£ç»ˆç«¯# cd ./styledemoä¸²å£ç»ˆç«¯# lsä¸²å£ç»ˆç«¯# ./styledemo -qws // è¿è¡Œæµ‹è¯•æ–‡ä»¶ï¼Œ-qws æ˜¯å‚æ•° ç­‰å¾…ç‰‡åˆ»ï¼ŒARM æ¿æ˜¾ç¤ºå±ä¸Šåº”è¯¥ä¼šå‡ºç°ä¸€äº› QT ç¨‹åºçš„ç”»é¢ã€‚æ­¤æ—¶å¯ä»¥æ’å…¥é¼ æ ‡è¿›è¡Œæµ‹è¯•ï¼Œä½†è§¦æ‘¸å±å¯èƒ½æ— æ³•ä½¿ç”¨ã€‚è¿™ä¸ªé—®é¢˜æˆ‘æ›¾ç»å›°æ‰°å¾ˆä¹…ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†è§£å†³æ–¹æ³•ï¼Œå…·ä½“æ–¹æ³•ä¸åœ¨æ­¤æ–‡æ¡£ä¸­æåŠã€‚å¦‚æœ‰éœ€è¦ï¼Œå¯ä»¥åœ¨æˆ‘çš„ç™¾åº¦æ–‡åº“ä¸Šä¸‹è½½ã€ŠGPS è§¦æ‘¸å±æ ¡å‡†ã€‹ã€‚ æ³¨æ„ï¼šå¦‚æœè¿è¡Œæ—¶ä¸²å£ç»ˆç«¯æç¤ºæ‰¾ä¸åˆ°æŸä¸ªåº“æ–‡ä»¶ï¼ˆé—®é¢˜ä¸å¤§ï¼‰ï¼Œå¯èƒ½æ˜¯ç¯å¢ƒå˜é‡æœªè®¾ç½®å¥½ï¼Œæˆ–ç¡®å®ç¼ºå°‘è¯¥åº“æ–‡ä»¶ã€‚æ­¤æ—¶å¯ä»¥åœ¨ Linux ç»ˆç«¯ä¸‹è¾“å…¥ä»¥ä¸‹å‘½ä»¤æŸ¥æ‰¾åº“æ–‡ä»¶ï¼š # locate è¿™ä¸ªåº“çš„åå­— // æ‰¾å‡ºå­˜åœ¨è¯¥åº“çš„è·¯å¾„ ä¾‹å¦‚ï¼Œå¦‚æœç¼ºå°‘åº“ libts-1.0.so.0ï¼Œåˆ™è¾“å…¥ï¼š # locate libts-1.0.so.0 ä½ ä¼šå‘ç°è¯¥åº“å¯èƒ½å­˜åœ¨äºå¤šä¸ªè·¯å¾„ä¸­ï¼Œç”šè‡³åœ¨ /home/nfs/opt/Qtopia/lib ä¸‹ä¹Ÿæœ‰ã€‚å¯ä»¥å°è¯•å°†äº¤å‰ç¼–è¯‘å™¨å®‰è£…ç›®å½•ä¸‹çš„å¯¹åº”åº“æ‹·è´åˆ° /home/nfs/opt/Qtopia/libã€‚å¦‚æœç¼ºå°‘çš„æ˜¯åº“é“¾æ¥æ–‡ä»¶ï¼Œæœ€å¥½è¿åŒåº“å’Œåº“é“¾æ¥ä¸€èµ·æ‹·è´ã€‚æ‹·è´å®Œæˆåï¼Œé‡å¯å¼€å‘æ¿ï¼Œå†æ¬¡åœ¨ä¸²å£ç»ˆç«¯ä¸Šé‡å¤ä¸Šè¿°æµ‹è¯•ã€‚å¦‚æœäº¤å‰ç¼–è¯‘å™¨å®‰è£…ç›®å½•ä¸‹çš„å¯¹åº”åº“æ²¡æœ‰ï¼Œæˆ–è€…å°è¯•åä»ç„¶ä¸è¡Œï¼Œå¯ä»¥è½¬åˆ° QT çš„å®‰è£…ç›®å½•å¯»æ‰¾å¯¹åº”åº“å¹¶æ‹·è´ï¼ˆæ›¿æ¢åŸæœ‰åº“ï¼‰ï¼Œé‡å¯å¼€å‘æ¿åå†è¯•ã€‚","categories":["3.å¼€å‘æ¡†æ¶","Qt"]},{"title":"QtåŸºæœ¬æ•°æ®ç±»å‹è½¬æ¢","path":"/2025/03/02/3-å¼€å‘æ¡†æ¶-Qt-QtåŸºæœ¬æ•°æ®ç±»å‹è½¬æ¢/","content":"char * ä¸ const char * çš„è½¬æ¢åœ¨ C å’Œ C++ ä¸­ï¼Œchar * å’Œ const char * æ˜¯ä¸¤ç§å¸¸è§çš„å­—ç¬¦æŒ‡é’ˆç±»å‹ã€‚å®ƒä»¬ä¹‹é—´çš„è½¬æ¢éœ€è¦è°¨æ…å¤„ç†ï¼Œä»¥é¿å…æ½œåœ¨çš„é”™è¯¯å’Œè­¦å‘Šã€‚ char *ch1 = hello11; // ch1 æ˜¯ä¸€ä¸ªå¯ä¿®æ”¹çš„å­—ç¬¦æŒ‡é’ˆconst char *ch2 = hello22; // ch2 æ˜¯ä¸€ä¸ªå¸¸é‡å­—ç¬¦æŒ‡é’ˆch2 = ch1; // è¿™è¡Œä»£ç ä¸ä¼šæŠ¥é”™ï¼Œä½†ä¼šäº§ç”Ÿè­¦å‘Šï¼Œå› ä¸ºæˆ‘ä»¬è¯•å›¾å°†ä¸€ä¸ªå¯ä¿®æ”¹çš„æŒ‡é’ˆèµ‹å€¼ç»™ä¸€ä¸ªå¸¸é‡æŒ‡é’ˆ åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè™½ç„¶ ch2 å¯ä»¥æ¥å— ch1 çš„å€¼ï¼Œä½†ç”±äº ch2 æ˜¯å¸¸é‡æŒ‡é’ˆï¼Œç¼–è¯‘å™¨ä¼šè­¦å‘Šæˆ‘ä»¬å¯èƒ½ä¼šä¿®æ”¹å¸¸é‡æ•°æ®ã€‚ä¸ºäº†å°† const char * è½¬æ¢ä¸º char *ï¼Œå¯ä»¥ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼š ch1 = (char *)ch2; // è¿™é‡Œå°† const char * å¼ºåˆ¶è½¬æ¢ä¸º char * è¿™ç§è½¬æ¢å¯èƒ½ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œç‰¹åˆ«æ˜¯å¦‚æœ ch2 æŒ‡å‘çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ï¼Œå› ä¸ºå­—ç¬¦ä¸²å­—é¢é‡æ˜¯ä¸å¯ä¿®æ”¹çš„ã€‚ char è½¬æ¢ä¸º QStringåœ¨ Qt æ¡†æ¶ä¸­ï¼ŒQString æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†å­—ç¬¦ä¸²çš„ç±»ã€‚å°†å•ä¸ªå­—ç¬¦è½¬æ¢ä¸º QString å¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°ï¼š char a = b; // å®šä¹‰ä¸€ä¸ªå­—ç¬¦å˜é‡QString str; // åˆ›å»ºä¸€ä¸ª QString å¯¹è±¡str = QString(a); // å°†å­—ç¬¦è½¬æ¢ä¸º QString è¿™é‡Œï¼ŒQString çš„æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå­—ç¬¦å¹¶åˆ›å»ºä¸€ä¸ªåŒ…å«è¯¥å­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚ QString è½¬æ¢ä¸º charè¦å°† QString è½¬æ¢ä¸º char *ï¼Œå¯ä»¥ä½¿ç”¨ toLatin1() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª QByteArrayï¼Œç„¶åå¯ä»¥é€šè¿‡ data() æ–¹æ³•è·å– char *ï¼š QString str = abc; // åˆ›å»ºä¸€ä¸ª QString å¯¹è±¡char *ch; // å®šä¹‰ä¸€ä¸ª char æŒ‡é’ˆch = str.toLatin1().data(); // å°† QString è½¬æ¢ä¸º char * è¯·æ³¨æ„ï¼Œdata() è¿”å›çš„æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜æ˜¯ä¸´æ—¶çš„ï¼Œå› æ­¤åœ¨ä½¿ç”¨ååº”è°¨æ…å¤„ç†ã€‚ QByteArray è½¬æ¢ä¸º char *åœ¨ Qt ä¸­ï¼ŒQByteArray æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†å­—èŠ‚æ•°ç»„çš„ç±»ã€‚å°† QByteArray è½¬æ¢ä¸º char * å¯ä»¥ç›´æ¥ä½¿ç”¨ data() æ–¹æ³•ï¼š char *ch; // å®šä¹‰ä¸€ä¸ª char æŒ‡é’ˆQByteArray byte; // åˆ›å»ºä¸€ä¸ª QByteArray å¯¹è±¡ch = byte.data(); // å°† QByteArray è½¬æ¢ä¸º char * åŒæ ·ï¼Œdata() è¿”å›çš„æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜æ˜¯ä¸´æ—¶çš„ï¼Œä½¿ç”¨æ—¶è¦å°å¿ƒã€‚ char * è½¬æ¢ä¸º QByteArrayå°† char * è½¬æ¢ä¸º QByteArray å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°å®ç°ï¼š char *ch; // å®šä¹‰ä¸€ä¸ª char æŒ‡é’ˆQByteArray byte; // åˆ›å»ºä¸€ä¸ª QByteArray å¯¹è±¡byte = QByteArray(ch); // å°† char * è½¬æ¢ä¸º QByteArray è¿™ç§è½¬æ¢ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ QByteArrayï¼Œå…¶å†…å®¹ä¸ char * æŒ‡å‘çš„å†…å®¹ç›¸åŒã€‚ QString è½¬æ¢ä¸º QByteArrayå°† QString è½¬æ¢ä¸º QByteArray å¯ä»¥ä½¿ç”¨ toUtf8() æˆ– toAscii() æ–¹æ³•ï¼š QByteArray byte; // åˆ›å»ºä¸€ä¸ª QByteArray å¯¹è±¡QString string; // åˆ›å»ºä¸€ä¸ª QString å¯¹è±¡byte = string.toUtf8(); // å°† QString è½¬æ¢ä¸º QByteArray è¿™é‡Œï¼ŒtoUtf8() æ–¹æ³•å°† QString è½¬æ¢ä¸º UTF-8 ç¼–ç çš„å­—èŠ‚æ•°ç»„ã€‚ QByteArray è½¬æ¢ä¸º QStringå°† QByteArray è½¬æ¢ä¸º QString å¯ä»¥ç›´æ¥ä½¿ç”¨æ„é€ å‡½æ•°ï¼š QByteArray byte; // åˆ›å»ºä¸€ä¸ª QByteArray å¯¹è±¡QString string; // åˆ›å»ºä¸€ä¸ª QString å¯¹è±¡string = QString(byte); // å°† QByteArray è½¬æ¢ä¸º QString è¿™ç§è½¬æ¢ä¼šå°†å­—èŠ‚æ•°ç»„çš„å†…å®¹è§£ç ä¸ºå­—ç¬¦ä¸²ã€‚ int è½¬ QStringå°†æ•´æ•°è½¬æ¢ä¸º QString å¯ä»¥ä½¿ç”¨ QString::number() æ–¹æ³•ï¼š int a = 10; // å®šä¹‰ä¸€ä¸ªæ•´æ•°QString b; // åˆ›å»ºä¸€ä¸ª QString å¯¹è±¡b = QString::number(a); // å°†æ•´æ•°è½¬æ¢ä¸º QString è¿™ç§æ–¹æ³•å°†æ•´æ•°è½¬æ¢ä¸ºå¯¹åº”çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚ QString è½¬ intè¦å°† QString è½¬æ¢ä¸ºæ•´æ•°ï¼Œå¯ä»¥ä½¿ç”¨ toInt() æ–¹æ³•ï¼š QString a = 120; // åˆ›å»ºä¸€ä¸ª QString å¯¹è±¡int b; // å®šä¹‰ä¸€ä¸ªæ•´æ•°b = a.toInt(); // å°† QString è½¬æ¢ä¸º int toInt() æ–¹æ³•ä¼šå°†å­—ç¬¦ä¸²ä¸­çš„æ•°å­—è§£æä¸ºæ•´æ•°ã€‚","categories":["3.å¼€å‘æ¡†æ¶","Qt"]},{"title":"åŠé€æ˜","path":"/2025/03/02/3-å¼€å‘æ¡†æ¶-Qt-æ§ä»¶-åŠé€æ˜/","content":"å¤´æ–‡ä»¶ï¼ˆmainwindow.hï¼‰#ifndef MAINWINDOW_H#define MAINWINDOW_H#include QMainWindow#include QIconnamespace Ui class MainWindow;class MainWindow : public QMainWindow Q_OBJECTpublic: explicit MainWindow(QWidget *parent = nullptr); ~MainWindow();private: Ui::MainWindow *ui;private slots: void on_pushButton_Set_clicked();;#endif // MAINWINDOW_H å®ç°æ–‡ä»¶ï¼ˆmainwindow.cppï¼‰#include mainwindow.h#include ui_mainwindow.hMainWindow::MainWindow(QWidget *parent) : QMainWindow(parent), ui(new Ui::MainWindow) ui-setupUi(this); this-setWindowTitle(QQ); this-setWindowIcon(QIcon(:/images/po.jpg)); this-setWindowFlags(Qt::FramelessWindowHint); // å»æ‰æ ‡é¢˜æ  this-setGeometry(QRect(950, 55, 350, 250)); // è®¾ç½®çª—å£çš„ä½ç½®å’Œå¤§å° this-setAttribute(Qt::WA_TranslucentBackground, true); // è®¾ç½®èƒŒæ™¯é€æ˜ this-resize(300, 300); // è®¾ç½®æ˜¾ç¤ºå¤§å°MainWindow::~MainWindow() delete ui; ä¸»ç¨‹åºï¼ˆmain.cppï¼‰#include QApplication#include QTextCodec#include mainwindow.hint main(int argc, char *argv[]) QApplication a(argc, argv); QTextCodec::setCodecForCStrings(QTextCodec::codecForName(GB2312)); QTextCodec::setCodecForLocale(QTextCodec::codecForName(GB2312)); QTextCodec::setCodecForTr(QTextCodec::codecForName(GB2312)); MainWindow w; w.show(); return a.exec(); é€æ˜æ•ˆæœçš„å®ç°åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å‡ ç§ä¸åŒçš„é€æ˜æ•ˆæœï¼Œå…·ä½“å¦‚ä¸‹ï¼š å…¨ä½“é€æ˜ï¼šä½¿ç”¨ this-setWindowOpacity(0.7); å¯ä»¥å°†æ•´ä¸ªçª—å£ï¼ˆåŒ…æ‹¬æ ‡é¢˜æ å’Œæ‰€æœ‰æ§ä»¶ï¼‰è®¾ç½®ä¸ºé€æ˜ï¼Œå‚æ•°å€¼æ§åˆ¶é€æ˜åº¦ï¼Œ0.0 è¡¨ç¤ºå®Œå…¨é€æ˜ï¼Œ1.0 è¡¨ç¤ºå®Œå…¨ä¸é€æ˜ã€‚ çª—å£æ•´ä½“é€æ˜ï¼Œæ§ä»¶ä¸é€æ˜ï¼šé€šè¿‡è®¾ç½®çª—ä½“çš„èƒŒæ™¯è‰²ä¸ºå…¨é€æ˜æ¥å®ç°ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š QPalette pal = palette();pal.setColor(QPalette::background, QColor(0x00, 0xff, 0x00, 0x00));setPalette(pal); çª—ä½“æ ‡é¢˜æ ä¸é€æ˜ï¼ŒèƒŒæ™¯é€æ˜ï¼šè¿™æ˜¯æœ¬ä¾‹ä¸­ä½¿ç”¨çš„æ•ˆæœï¼Œé€šè¿‡ this-setAttribute(Qt::WA_TranslucentBackground, true); æ¥å®ç°ã€‚ çª—å£æ•´ä½“ä¸é€æ˜ï¼Œå±€éƒ¨é€æ˜ï¼šåœ¨ paintEvent ä¸­ä½¿ç”¨ QPainter::CompositionMode_Clear æ¨¡å¼ç»˜åˆ¶åŒºåŸŸå…¨é€æ˜ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š void MainWindow::paintEvent(QPaintEvent*) QPainter p(this); p.setCompositionMode(QPainter::CompositionMode_Clear); p.fillRect(30, 30, 300, 300, Qt::SolidPattern); å»æ‰æ ‡é¢˜æ è¦å»æ‰çª—å£çš„æ ‡é¢˜æ ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š this-setWindowFlags(Qt::FramelessWindowHint); // å»æ‰æ ‡é¢˜æ ","categories":["3.å¼€å‘æ¡†æ¶","Qt","æ§ä»¶"]},{"title":"QSlideræ ·å¼è¡¨","path":"/2025/03/02/3-å¼€å‘æ¡†æ¶-Qt-æ§ä»¶-QSlideræ ·å¼è¡¨/","content":"// æ»‘åŠ¨æ¡æ§½ï¼ˆæ•´ä½“ï¼‰çš„ç¾åŒ–QSlider::groove:horizontal height: 12px; // è®¾ç½®æ»‘åŠ¨æ¡æ§½çš„é«˜åº¦ä¸º12åƒç´ ï¼Œç¡®ä¿ç”¨æˆ·åœ¨ä½¿ç”¨æ—¶æœ‰è‰¯å¥½çš„è§¦æ„Ÿ left: 0px; // å·¦ä¾§è¾¹è·ä¸º0ï¼Œç¡®ä¿æ»‘åŠ¨æ¡ä»æœ€å·¦è¾¹å¼€å§‹ right: 0px; // å³ä¾§è¾¹è·ä¸º0ï¼Œç¡®ä¿æ»‘åŠ¨æ¡å»¶ä¼¸åˆ°æœ€å³è¾¹ border: 0px; // æŒ‡å®šæ— è¾¹æ¡†ï¼Œä¿æŒç®€æ´çš„å¤–è§‚ border-radius: 6px; // è®¾ç½®åœ†è§’ä¸º6åƒç´ ï¼Œä½¿æ»‘åŠ¨æ¡çœ‹èµ·æ¥æ›´åŠ æŸ”å’Œ background: rgba(0, 0, 0, 0.5); // è®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºåŠé€æ˜é»‘è‰²ï¼Œå¢åŠ è§†è§‰å±‚æ¬¡æ„Ÿ// æ»‘å—çš„ç¾åŒ–QSlider::handle:horizontal width: 50px; // è®¾ç½®æ»‘å—çš„å®½åº¦ä¸º50åƒç´ ï¼Œç¡®ä¿ç”¨æˆ·æ˜“äºæŠ“å– height: 50px; // è®¾ç½®æ»‘å—çš„é«˜åº¦ä¸º50åƒç´ ï¼Œæä¾›è¶³å¤Ÿçš„ç‚¹å‡»åŒºåŸŸ margin-top: -20px; // ä¸Šè¾¹è·ä¸º-20åƒç´ ï¼Œä½¿æ»‘å—ä¸æ§½çš„ä¸­å¿ƒå¯¹é½ margin-left: 0px; // å·¦è¾¹è·ä¸º0ï¼Œä¿æŒæ»‘å—åœ¨æ§½å†… margin-bottom: -20px; // ä¸‹è¾¹è·ä¸º-20åƒç´ ï¼Œç¡®ä¿æ»‘å—ä¸æ§½çš„åº•éƒ¨å¯¹é½ margin-right: 0px; // å³è¾¹è·ä¸º0ï¼Œä¿æŒæ»‘å—åœ¨æ§½å†… border-image: url(:/res/images/setting_slider_handle.png); // ä½¿ç”¨è‡ªå®šä¹‰å›¾ç‰‡ä½œä¸ºæ»‘å—çš„å¤–è§‚// å·²æ»‘è¿‡çš„è¿›åº¦ç¾åŒ–QSlider::sub-page:horizontal background: rgba(80, 166, 234, 1); // è®¾ç½®å·²æ»‘è¿‡éƒ¨åˆ†çš„èƒŒæ™¯é¢œè‰²ä¸ºä¸é€æ˜çš„è“è‰²// æœªæ»‘è¿‡çš„è¿›åº¦ç¾åŒ–QSlider::add-page:horizontal background: rgb(0, 0, 255); // è®¾ç½®æœªæ»‘è¿‡éƒ¨åˆ†çš„èƒŒæ™¯é¢œè‰²ä¸ºçº¯è“è‰²// æ³¨æ„äº‹é¡¹// grooveã€sub-page å’Œ add-page ä¸‰ä¸ªå±æ€§å…±å­˜æ—¶ï¼Œadd-page çš„é¢œè‰²ä¼šè¦†ç›– groove çš„é¢œè‰²ã€‚// å¦‚æœæ»‘å—éœ€è¦å¤–æ‰©æ¯”æ§½éƒ¨åˆ†å¤§ï¼Œå¯ä»¥ä½¿ç”¨ margin å‚æ•°è¿›è¡Œè°ƒæ•´ã€‚// å½“ç„¶ï¼ŒQSlider çš„æ•´ä½“é«˜åº¦å¿…é¡»å¤§äºæˆ–ç­‰äºæ»‘å—çš„é«˜åº¦ï¼Œå¦åˆ™æ»‘å—ä¼šè¢«å‹ç¼©ã€‚// ä¾‹å­ä¸­æ»‘å—ä½¿ç”¨çš„æ˜¯å›¾ç‰‡ï¼Œgrooveã€handleã€sub-page å’Œ add-page è¿™äº›æ—¢å¯ä»¥ç”¨é¢œè‰²å¡«å……ï¼Œä¹Ÿå¯ä»¥ç”¨å›¾ç‰‡å¡«å……ï¼Œå…·ä½“å–å†³äºè®¾è®¡éœ€æ±‚ã€‚// å¦‚æœæƒ³è¦æ›´ç‚«é…·çš„æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨çº¿æ€§æ¸å˜é¢œè‰²æ¥å®šä¹‰èƒŒæ™¯ï¼Œä¾‹å¦‚ï¼šbackground: qlineargradient(x1:0, y1:0, x2:1, y2:1, stop:0 #fff, stop:1 #ddd); // å®šä¹‰ä»ç™½è‰²åˆ°ç°è‰²çš„æ¸å˜æ•ˆæœ// çŠ¶æ€å˜åŒ–çš„ç¾åŒ–QSlider::handle:horizontal:hover width: 50px; // é¼ æ ‡æ‚¬åœæ—¶ï¼Œæ»‘å—å®½åº¦ä¿æŒä¸å˜ height: 50px; // é¼ æ ‡æ‚¬åœæ—¶ï¼Œæ»‘å—é«˜åº¦ä¿æŒä¸å˜ margin-top: -20px; // é¼ æ ‡æ‚¬åœæ—¶ï¼Œä¸Šè¾¹è·ä¿æŒä¸å˜ margin-left: 0px; // é¼ æ ‡æ‚¬åœæ—¶ï¼Œå·¦è¾¹è·ä¿æŒä¸å˜ margin-bottom: -20px; // é¼ æ ‡æ‚¬åœæ—¶ï¼Œä¸‹è¾¹è·ä¿æŒä¸å˜ margin-right: 0px; // é¼ æ ‡æ‚¬åœæ—¶ï¼Œå³è¾¹è·ä¿æŒä¸å˜ border-image: url(:/res/images/setting_slider_handle_hover.png); // é¼ æ ‡æ‚¬åœæ—¶ä½¿ç”¨ä¸åŒçš„æ»‘å—å›¾ç‰‡QSlider::sub-page:horizontal:disabled background: #BB345F; // è®¾ç½®ç¦ç”¨çŠ¶æ€ä¸‹å·²æ»‘è¿‡éƒ¨åˆ†çš„èƒŒæ™¯é¢œè‰²ä¸ºæš—çº¢è‰²QSlider::add-page:horizontal:disabled background: #1ADEFF; // è®¾ç½®ç¦ç”¨çŠ¶æ€ä¸‹æœªæ»‘è¿‡éƒ¨åˆ†çš„èƒŒæ™¯é¢œè‰²ä¸ºæ˜äº®çš„è“è‰²QSlider::handle:horizontal:disabled background: #EEDDFF; // è®¾ç½®ç¦ç”¨çŠ¶æ€ä¸‹æ»‘å—çš„èƒŒæ™¯é¢œè‰²ä¸ºæ·¡ç´«è‰²// è¿™æ ·åœ¨é¼ æ ‡æ‚¬åœæˆ–è®¾ç½®ä¸ºæ— æ•ˆçŠ¶æ€æ—¶ï¼Œæ»‘å—å’Œè¿›åº¦æ¡çš„é¢œè‰²ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå¢å¼ºç”¨æˆ·ä½“éªŒã€‚","categories":["3.å¼€å‘æ¡†æ¶","Qt","æ§ä»¶"]},{"title":"æ ·å¼è¡¨","path":"/2025/03/02/3-å¼€å‘æ¡†æ¶-Qt-æ§ä»¶-æ ·å¼è¡¨/","content":"Qt çš„ QSS æ ·å¼è¡¨åŠŸèƒ½Qt è‡ªå¸¦ä¸€ä¸ªå¼ºå¤§çš„çš®è‚¤åŠŸèƒ½ï¼Œç§°ä¸º QSSï¼ˆQt æ ·å¼è¡¨ï¼‰ï¼Œç±»ä¼¼äºç½‘é¡µè®¾è®¡ä¸­çš„ CSSã€‚å³ä½¿æ²¡æœ‰ä¸“ä¸šçš„ç¾å·¥è®¾è®¡å¸ˆï¼Œä½ ä¹Ÿèƒ½è½»æ¾åˆ›å»ºå‡ºç‚«é…·çš„ç”¨æˆ·ç•Œé¢ã€‚å®Œæ•´çš„å®˜æ–¹æ–‡æ¡£å¯ä»¥é€šè¿‡æ–‡é¦–çš„è“è‰²é“¾æ¥è®¿é—®ï¼Œè¿™é‡Œæˆ‘ä»¬å°†ä»‹ç»ä¸€äº›å¸¸ç”¨çš„è¯­æ³•ã€‚ 1 æ ·å¼è¡¨è¯­æ³•ğŸ”µ é€‰æ‹©å™¨ç±»å‹åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°åœ¨ç•Œé¢ä¸Šè®¾ç½®èƒŒæ™¯å›¾ç‰‡çš„æƒ…å†µï¼Œä½†å‘ç°ç•Œé¢ä¸Šçš„æŸäº›ç»„ä»¶ï¼ˆä¾‹å¦‚æŒ‰é’®ï¼‰çš„èƒŒæ™¯ä¹Ÿè¢«è®¾ç½®ä¸ºè¯¥èƒŒæ™¯å›¾ã€‚è¿™é€šå¸¸æ˜¯ç”±äºé€‰æ‹©å™¨çš„ä½¿ç”¨ä¸å½“é€ æˆçš„ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªåä¸º frame çš„ç»„ä»¶ï¼Œä½¿ç”¨é€‰æ‹©å™¨æ—¶å¯ä»¥æŒ‡å®šæ ·å¼ä»…å¯¹è¯¥ç»„ä»¶æœ‰æ•ˆã€‚è‹¥é€‰æ‹©å™¨ä¸ºå…·ä½“çš„ç±»å®ä¾‹å¯¹è±¡åï¼Œéœ€åœ¨å‰é¢åŠ ä¸Š # ç¬¦å·ã€‚ä¾‹å¦‚ï¼Œ#frame è¡¨ç¤ºåªå¯¹åä¸º frame çš„å…·ä½“å¯¹è±¡ç”Ÿæ•ˆï¼Œè€Œ QFrame åˆ™ä¼šå½±å“æ‰€æœ‰ QFrame ç±»åŠå…¶å­ç±»çš„å®ä¾‹ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„é€‰æ‹©å™¨ç¤ºä¾‹ï¼š **QPushButton[flat=false]**ï¼šåŒ¹é…æ‰€æœ‰éæ‰å¹³åŒ–çš„ QPushButton å®ä¾‹ã€‚ **.QPushButton**ï¼šåŒ¹é…æ‰€æœ‰ QPushButton å®ä¾‹ï¼Œä½†ä¸åŒ…æ‹¬å…¶å­ç±»ï¼Œæ³¨æ„å‰é¢çš„ç‚¹ã€‚ **QPushButton#okButton**ï¼šåŒ¹é…å¯¹è±¡åç§°ä¸º okButton çš„æ‰€æœ‰ QPushButton å®ä¾‹ã€‚ **QDialog QPushButton**ï¼šåŒ¹é…æ‰€æœ‰ QPushButton å®ä¾‹ï¼Œè¿™äº›å®ä¾‹æ˜¯ QDialog çš„åä»£ã€‚ **QDialog QPushButton**ï¼šåŒ¹é…æ‰€æœ‰ QPushButton å®ä¾‹ï¼Œè¿™äº›å®ä¾‹æ˜¯ QDialog çš„ç›´æ¥å­ä»£ã€‚ ğŸ”µ å£°æ˜æ ·å¼è¡¨ä¸­çš„å£°æ˜éƒ¨åˆ†å®šä¹‰äº†å…·ä½“çš„æ ·å¼å±æ€§ã€‚ä¾‹å¦‚ï¼š QPushButton color: rgb(255, 0, 0); /* è¿™æ¡è¯­å¥å°†æ‰€æœ‰QPushButtonç±»çš„æŒ‰é’®å­—ä½“é¢œè‰²è®¾ç½®ä¸ºçº¢è‰²ã€‚ */QPushButton background-color: rgb(0, 170, 255); /* è¿™æ¡è¯­å¥å°†æ‰€æœ‰QPushButtonç±»çš„æŒ‰é’®èƒŒæ™¯è‰²è®¾ç½®ä¸ºè“è‰²ã€‚ */ å¦‚æœä½ æŒ‰ç…§ä¸Šè¿°æ–¹å¼è®¾ç½®ï¼ŒæŒ‰é’®çš„å­—ä½“é¢œè‰²åœ¨ç¼–è¯‘å‰æ˜¯å¯è§çš„ï¼Œä½†æŒ‰é’®çš„èƒŒæ™¯å¯èƒ½ä¸ä¼šç«‹å³æ˜¾ç¤ºã€‚ä¸ºäº†ç¡®ä¿èƒŒæ™¯è‰²æ˜¾ç¤ºï¼Œå¯ä»¥æ·»åŠ  border-radius: 0px;ï¼Œè¿™æ ·æŒ‰é’®çš„èƒŒæ™¯è‰²å°±ä¼šæ­£å¸¸æ˜¾ç¤ºã€‚border-radius å±æ€§å®šä¹‰äº†è¾¹æ¡†çš„åœ†è§’åŠå¾„ï¼Œæ•°å€¼è¶Šå¤§ï¼ŒæŒ‰é’®çš„è§’å°±è¶Šåœ†æ¶¦ã€‚ ğŸ”µ å­æ§ä»¶å¯¹äºå¤æ‚çš„çª—å£ç»„ä»¶ï¼ˆå¦‚ QTabWidgetï¼‰ï¼Œä½ éœ€è¦è®¿é—®å…¶å­æ§ä»¶å¹¶å•ç‹¬è®¾ç½®æ ·å¼ã€‚ç›´æ¥å³é”®ç‚¹å‡» QTabWidget ä½¿ç”¨æ ·å¼è¡¨æ˜¯ä¸å¯è¡Œçš„ã€‚ ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ª QTabWidget ä¸­ï¼Œçº¢è‰²éƒ¨åˆ†ä»£è¡¨é€‰é¡¹å¡ï¼ˆå¦‚ QTabBar æˆ– QToolBoxï¼‰ï¼Œè€Œè“è‰²éƒ¨åˆ†åˆ™æ˜¯çª—æ ¼ï¼ˆpaneï¼‰ã€‚ä¸ºäº†å®ç°ç‰¹å®šçš„æ ·å¼æ•ˆæœï¼Œä½ éœ€è¦åˆ†åˆ«ä¸ºè¿™äº›å­æ§ä»¶è®¾ç½®æ ·å¼è¡¨ã€‚ ğŸ”µ ä¼ªçŠ¶æ€ä¼ªçŠ¶æ€ç”¨äºå®ç°ç•Œé¢çš„åŠ¨æ€æ•ˆæœï¼Œèƒ½å¤Ÿæ£€æµ‹ç”¨æˆ·çš„äº¤äº’è¡Œä¸ºï¼Œä¾‹å¦‚é¼ æ ‡æ‚¬åœæˆ–æŒ‰ä¸‹æŒ‰é’®ç­‰ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ä¼ªçŠ¶æ€ï¼š æ‚¬åœï¼š:hover ä¸æ‚¬åœï¼š:!hover æ‚¬åœå¹¶é€‰ä¸­ï¼š:hover:checked æ‚¬åœå¹¶æŒ‰ä¸‹ï¼š:hover:!pressed ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³ä¿®æ”¹è¾“å…¥æ¡†çš„è¾¹æ¡†é¢œè‰²ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ ·å¼ï¼š border-style: solid;border-color: rgb(170, 170, 255); åœ¨ä½¿ç”¨è¾¹æ¡†é¢œè‰²ä¹‹å‰ï¼Œå¿…é¡»å…ˆå®šä¹‰è¾¹æ¡†çš„é£æ ¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¾¹æ¡†ç±»å‹æ˜¯ noneï¼Œè¿™æ„å‘³ç€å³ä½¿è®¾ç½®äº†è¾¹æ¡†é¢œè‰²ï¼Œè¾¹æ¡†ä¹Ÿä¸ä¼šæ˜¾ç¤ºã€‚ä»¥ä¸‹æ˜¯å¯ç”¨çš„è¾¹æ¡†æ ·å¼ç±»å‹ï¼š noneï¼šæ— è¾¹æ¡†ã€‚ hiddenï¼šä¸ none ç›¸åŒï¼Œä½†åœ¨è¡¨æ ¼ä¸­ç”¨äºè§£å†³è¾¹æ¡†å†²çªã€‚ dottedï¼šç‚¹çŠ¶è¾¹æ¡†ï¼Œé€šå¸¸åœ¨å¤§å¤šæ•°æµè§ˆå™¨ä¸­å‘ˆç°ä¸ºå®çº¿ã€‚ dashedï¼šè™šçº¿ï¼Œé€šå¸¸åœ¨å¤§å¤šæ•°æµè§ˆå™¨ä¸­å‘ˆç°ä¸ºå®çº¿ã€‚ solidï¼šå®çº¿è¾¹æ¡†ã€‚ doubleï¼šåŒçº¿è¾¹æ¡†ï¼Œå®½åº¦ç­‰äº border-width çš„å€¼ã€‚ grooveï¼š3D å‡¹æ§½è¾¹æ¡†ï¼Œæ•ˆæœå–å†³äº border-color çš„å€¼ã€‚ ridgeï¼š3D å„çŠ¶è¾¹æ¡†ï¼Œæ•ˆæœå–å†³äº border-color çš„å€¼ã€‚ insetï¼š3D å†…åµŒè¾¹æ¡†ï¼Œæ•ˆæœå–å†³äº border-color çš„å€¼ã€‚ outsetï¼š3D å¤–å‡¸è¾¹æ¡†ï¼Œæ•ˆæœå–å†³äº border-color çš„å€¼ã€‚ é€šè¿‡åˆç†ä½¿ç”¨è¿™äº›é€‰æ‹©å™¨å’Œæ ·å¼å£°æ˜ï¼Œä½ å¯ä»¥ä¸º Qt åº”ç”¨ç¨‹åºåˆ›å»ºå‡ºä¸°å¯Œå¤šå½©çš„ç”¨æˆ·ç•Œé¢ã€‚ 2 setStyleSheet ç®€ä»‹Qt çš„æ ·å¼è¡¨ï¼ˆStyle Sheetsï¼‰æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒå…è®¸å¼€å‘è€…è‡ªå®šä¹‰çª—å£çš„å¤–è§‚ã€‚é™¤äº†ä½¿ç”¨æ ·å¼è¡¨ï¼Œå¼€å‘è€…è¿˜å¯ä»¥é€šè¿‡å­ç±» QStyle æ¥å®ç°æ ·å¼å®šåˆ¶ã€‚Qt æ ·å¼è¡¨çš„è¯­æ³•ä¸ HTML çš„ CSS æœ‰å¾ˆå¤§çš„ç›¸ä¼¼æ€§ï¼Œä½†å®ƒä¸“é—¨ç”¨äºçª—å£ç»„ä»¶ã€‚ç®€å•æ¥è¯´ï¼ŒsetStyleSheet å‡½æ•°ç”¨äºè®¾ç½®ç»„ä»¶çª—å£çš„å¤–è§‚ã€‚ 3 setStyleSheet ä½¿ç”¨æ–¹æ³•åŸºæœ¬å¥æ³•æ ·å¼è¡¨çš„è¯­æ³•åŸºæœ¬ä¸Šä¸ HTML CSS è¯­æ³•ä¸€è‡´ã€‚æ ·å¼è¡¨ç”±ä¸€ç³»åˆ—æ ·å¼è§„åˆ™ç»„æˆï¼Œæ¯ä¸ªæ ·å¼è§„åˆ™ç”±ä¸€ä¸ª selector å’Œä¸€ä¸ª declaration ç»„æˆã€‚selector æŒ‡å®šå“ªäº›çª—å£å°†å—åˆ°è¿™äº›è§„åˆ™çš„å½±å“ï¼Œè€Œ declaration åˆ™æŒ‡å®šè¦è®¾ç½®çš„å±æ€§ã€‚ä¾‹å¦‚ï¼š QPushButton color: red; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒQPushButton æ˜¯ selectorï¼Œè€Œ color: red; æ˜¯ declarationã€‚è¿™ä¸ªè§„åˆ™æŒ‡å®šæ‰€æœ‰ QPushButton åŠå…¶å­ç±»çš„å‰æ™¯é¢œè‰²ä¸ºçº¢è‰²ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒQt å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œå› æ­¤ colorã€ColoR å’Œ COLOR éƒ½æ˜¯ç­‰æ•ˆçš„ã€‚ å¤šä¸ª selector å¯ä»¥ç”¨é€—å· , åˆ†éš”ï¼Œä¾‹å¦‚ï¼š QPushButton, QLineEdit, QComboBox color: red; declaration éƒ¨åˆ†å¯ä»¥åŒ…å«å¤šä¸ªå±æ€§å€¼å¯¹ï¼Œç”¨åˆ†å· ; åˆ†éš”ã€‚ä¾‹å¦‚ï¼š QPushButton color: red; font-family: Arial; line-height: 26px; ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š QWidget-setStyleSheet(QPushButton, QLineEdit, QPlainTextEdit color: blue; background-color: yellow; selection-color: yellow; selection-background-color: blue; ); å¸¸è§çš„ selector éƒ¨åˆ† declaration æ ·å¼-è‹±æ–‡ å‚æ•° æ ·å¼-ä¸­æ–‡ color: white rgb(110,110,110) #eb7350 å‰æ™¯é¢œè‰²ï¼Œå­—ä½“é¢œè‰² background: transparent èƒŒæ™¯ä¸ºé€æ˜ï¼ˆå¯ä»¥ä¸ºå›¾ç‰‡ç­‰ï¼‰ background-color: white rgb(110,110,110) #eb7350 èƒŒæ™¯é¢œè‰²ï¼ˆåªèƒ½ä¸ºé¢œè‰²ï¼‰ background-position: left right center top bottom è®¾å®šå›¾ç‰‡çš„ä½ç½® background-image: url() .imgback.jpg èƒŒæ™¯å›¾ç‰‡ï¼Œä¸ç¼©æ”¾å›¾ç‰‡å¤§å° border-image: url() .imgback.jpg èƒŒæ™¯å›¾ç‰‡ï¼Œä¼šå¯¹å›¾ç‰‡è¿›è¡Œæ‹‰ä¼¸ border-style: outset inset è¾¹æ¡†æ ·å¼ï¼ŒæŒ‰ä¸‹æ˜¯ inset border-width: px è¾¹æ¡†å¤§å° border-radius: px è¾¹æ¡†å¼§åº¦ border: 3px solid red è¾¹æ¡†å®½åº¦åŠé¢œè‰² border-color: rgba(255, 225, 255, 30) è¾¹æ¡†é¢œè‰² font-family å¾®è½¯é›…é»‘ è®¾å®šå­—ä½“æ‰€å±å®¶æ— font: bold 14px å­—ä½“å¤§å°å¹¶åŠ ç²— font-size: px å­—ä½“å¤§å° font-style: inset å­—ä½“æ ·å¼ font-weight: px å­—ä½“æ·±æµ… selection-color: color è®¾å®šé€‰ä¸­æ—¶çš„é¢œè‰² selection-background-color: color è®¾å®šé€‰ä¸­æ—¶çš„èƒŒæ™¯é¢œè‰² å­æ§ä»¶åœ¨ Qt ä¸­ï¼Œä¸€äº›ç•Œé¢ç»„ä»¶æ˜¯ç»„åˆè€Œæˆçš„ï¼Œä¾‹å¦‚ QComboBox çš„ä¸‹æ‹‰æŒ‰é’®æˆ– QSpinBox çš„ä¸Šä¸‹è°ƒèŠ‚æŒ‰é’®ã€‚è¿™äº›æŒ‰é’®è¢«ç§°ä¸ºå­æ§ä»¶ï¼Œå­æ§ä»¶åŒæ ·å¯ä»¥è®¾ç½®æ ·å¼ã€‚å­æ§ä»¶ä½¿ç”¨ä¼ªçŠ¶æ€è¿›è¡Œæ ·å¼å®šä¹‰ã€‚ä¾‹å¦‚ï¼š table-setStyleSheet(QTableView::item background-color: #383838; color: white; ); è¿™æ®µä»£ç è®¾ç½®äº† QTableView ä¸­æ¯ä¸ªå•å…ƒæ ¼çš„èƒŒæ™¯è‰²å’Œå­—ä½“é¢œè‰²ã€‚ å¸¸è§çš„å­æ§ä»¶ ä¼ªçŠ¶æ€ä¼ªçŠ¶æ€å…è®¸å¼€å‘è€…ä¸ºç»„ä»¶çš„ç‰¹å®šçŠ¶æ€å®šä¹‰æ ·å¼è§„åˆ™ã€‚ä¼ªçŠ¶æ€å‡ºç°åœ¨ selector åé¢ï¼Œç”¨å†’å· : éš”å¼€ã€‚ åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹ï¼šå½“é¼ æ ‡æ‚¬åœåœ¨ QLineEdit ä¸Šæ—¶ï¼Œæ”¹å˜å…¶èƒŒæ™¯è‰²å’Œå‰æ™¯è‰²ï¼š QWidget-setStyleSheet(QLineEdit::hover background-color: black; color: yellow; ); ä¼ªçŠ¶æ€å–åï¼šåœ¨ä¼ªçŠ¶æ€å‰åŠ ä¸€ä¸ªæ„Ÿå¹å·ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç å®šä¹‰äº† readonly å±æ€§ä¸º false çš„ QLineEdit çš„èƒŒæ™¯è‰²ï¼š QWidget-setStyleSheet(QLineEdit::!readonly background-color: gray; ); ä¼ªçŠ¶æ€ä¸²è”ä½¿ç”¨ï¼šç›¸å½“äºâ€œé€»è¾‘ä¸â€çš„è®¡ç®—ã€‚ä¾‹å¦‚ï¼Œå½“é¼ æ ‡æ‚¬åœåœ¨ä¸€ä¸ªè¢«å‹¾é€‰çš„ QCheckBox ç»„ä»¶ä¸Šæ–¹æ—¶ï¼Œå…¶æ ·å¼å¯ä»¥è¿™æ ·å®šä¹‰ï¼š QWidget-setStyleSheet(QCheckBox:checked:hover background-color: green; ); ä¼ªçŠ¶æ€å¹¶è”ä½¿ç”¨ï¼šç›¸å½“äºâ€œé€»è¾‘æˆ–â€ã€‚ä¾‹å¦‚ï¼Œå½“é¼ æ ‡æ‚¬åœåœ¨ QCheckBox ä¸Šæ–¹æˆ– QCheckBox è¢«å‹¾é€‰æ—¶ï¼Œæ ·å¼éƒ½è¢«åº”ç”¨ï¼š QWidget-setStyleSheet(QCheckBox:hover, QCheckBox:checked background-color: blue; ); å­æ§ä»¶ä½¿ç”¨ä¼ªçŠ¶æ€çš„ç¤ºä¾‹ï¼šä¸‹é¢å®šä¹‰äº† QCheckBox çš„ indicator åœ¨ checked å’Œ unchecked ä¸¤ç§çŠ¶æ€ä¸‹æ˜¾ç¤ºçš„å›¾ç‰‡ï¼š QCheckBox::indicator:checked image: url(checked.png); QCheckBox::indicator:unchecked image: url(unchecked.png); å¸¸è§çš„ä¼ªçŠ¶æ€ 4 setStyleSheet ä½¿ç”¨å®ä¾‹å…¨å±€ä½¿ç”¨ä½¿ç”¨ qApp çš„ setStyleSheet å‡½æ•°å¯ä»¥ä¸ºæ•´ä¸ªåº”ç”¨ç¨‹åºè®¾ç½®æ ·å¼ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ä¸ºåº”ç”¨ç¨‹åºçš„ QLineEdit ç»„ä»¶è®¾ç½®æ ·å¼ï¼š qApp-setStyleSheet(QLineEdit background-color: lightgray; ); å±€éƒ¨ä½¿ç”¨ä½¿ç”¨ QWidget::setStyleSheet å‡½æ•°å¯ä»¥ä¸ºä¸€ä¸ªçª—å£ã€å¯¹è¯æ¡†æˆ–ç•Œé¢ç»„ä»¶è®¾ç½®æ ·å¼ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ä¸ºä¸»çª—å£ MainWindow å†…çš„ QLineEdit ç»„ä»¶è®¾ç½®æ ·å¼ï¼š mainWindow-setStyleSheet(QLineEdit color: blue; ); å•ç‹¬è®¾ç½®ä¸€ä¸ªå¯¹è±¡çš„æ ·å¼è¡¨æ—¶ï¼Œæ— éœ€æŒ‡å®š selector çš„åç§°ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç è®¾ç½®ä¸€ä¸ªåä¸º editName çš„ QLineEdit ç»„ä»¶çš„æ ·å¼ï¼š editName-setStyleSheet(color: green;); æ³¨æ„äº‹é¡¹å¯¹äºåŒä¸€ä¸ªç»„ä»¶ï¼Œæ ·å¼éœ€è¦ä¸€æ¬¡æ€§è®¾ç½®å¥½ï¼Œå¦åˆ™ä¼šè¦†ç›–æ‰å‰ä¸€æ¬¡çš„è®¾ç½®ã€‚ä¾‹å¦‚ï¼š btn1-setStyleSheet(QPushButton color: red; ); // è®¾å®šå‰æ™¯é¢œè‰²btn1-setStyleSheet(QPushButton background: yellow; ); // è®¾å®šèƒŒæ™¯é¢œè‰² åœ¨æ‰§è¡Œå®Œç¬¬ä¸€å¥åï¼Œå­—ä½“ä¼šå˜çº¢ï¼›æ‰§è¡Œå®Œç¬¬äºŒå¥åï¼Œå­—ä½“é¢œè‰²æ¢å¤é»˜è®¤ï¼ŒèƒŒæ™¯å˜ä¸ºé»„è‰²ã€‚è¿™æ„å‘³ç€å¯¹äºåŒä¸€ä¸ªç»„ä»¶çš„è¿ç»­è®¾ç½®ï¼Œåªæœ‰æœ€åä¸€æ¬¡æ‰§è¡Œçš„æ ·å¼ä¼šç”Ÿæ•ˆã€‚ å¦‚æœæƒ³åŒæ—¶è®¾ç½®å­—ä½“ä¸ºçº¢è‰²å’ŒèƒŒæ™¯ä¸ºé»„è‰²ï¼Œåº”è¯¥å°†æ‰€æœ‰è®¾ç½®æ”¾åœ¨ä¸€ä¸ª setStyleSheet è°ƒç”¨ä¸­ï¼š btn1-setStyleSheet(QPushButton color: red; background: yellow; ); å¯¹äºä¸€ä¸ªç»„ä»¶åŠå…¶å­ç»„ä»¶å’Œä¼ªçŠ¶æ€ï¼Œä¹Ÿéœ€è¦ä¸€æ¬¡æ€§è®¾ç½®å¥½ï¼Œå¦åˆ™ä¼šè¦†ç›–æ‰å‰ä¸€æ¬¡è®¾ç½®ã€‚ä¾‹å¦‚ï¼š table-setStyleSheet(\\ QTableView::item background-color: #383838; color: white; \\ QTableView::item:selected background-color: #383838; color: white; \\ QTableView::item:hover background-color: #4d80e6; color: white; ); å¦‚æœå†æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼š table-setStyleSheet(QTableView selection-color: white; selection-background-color: #4d80e6; ); ä¸Šé¢çš„è®¾ç½®å°†ä¼šè¢«è¦†ç›–ï¼Œå¯¼è‡´æœ€ç»ˆåªå®ç°äº†æ–‡å­—é€‰ä¸­åå˜è‰²çš„åŠŸèƒ½ã€‚è™½ç„¶æˆ‘è®¾ç½®äº† QTableView çš„ä¸åŒå­éƒ¨ä»¶å’Œä¼ªçŠ¶æ€ï¼Œä½† setStyleSheet å§‹ç»ˆä½œç”¨åœ¨å¯¹è±¡ table ä¸Šã€‚ ä¸ºäº†å®ç°é¢„æœŸæ•ˆæœï¼Œæ‰€æœ‰è®¾ç½®åº”æ”¾åœ¨ä¸€ä¸ª setStyleSheet è°ƒç”¨ä¸­ï¼š table-setStyleSheet(\\ QTableView::item background-color: #383838; color: white; \\ QTableView::item:selected background-color: #383838; color: white; \\ QTableView::item:hover background-color: #4d80e6; color: white; \\ selection-color: white; selection-background-color: #4d80e6;); æç¤ºï¼šè®¾ç½®åŒä¸€ç»„ä»¶çš„å­æ§ä»¶å’Œä¼ªçŠ¶æ€æ—¶ï¼Œä½¿ç”¨ç©ºæ ¼è¿æ¥ä¸¤ä¸ªå¯¹è±¡ï¼Œè¿›è¡Œçº§è”ã€‚","categories":["3.å¼€å‘æ¡†æ¶","Qt","æ§ä»¶"]},{"title":"å¸ƒå±€ç®¡ç†","path":"/2025/03/02/3-å¼€å‘æ¡†æ¶-Qt-æ§ä»¶-å¸ƒå±€ç®¡ç†/","content":"// m.h æ–‡ä»¶çš„å†…å®¹#ifndef M_H#define M_H#include QtWidgets // å¼•å…¥Qt Widgetsæ¨¡å—ï¼Œæä¾›å›¾å½¢ç”¨æˆ·ç•Œé¢ç»„ä»¶// å®šä¹‰ä¸€ä¸ªåä¸ºBçš„ç±»ï¼Œç»§æ‰¿è‡ªQWidgetï¼Œè¡¨ç¤ºä¸€ä¸ªçª—å£éƒ¨ä»¶class B : public QWidget Q_OBJECT // å®ï¼Œå¯ç”¨Qtçš„ä¿¡å·å’Œæ§½æœºåˆ¶public: QVBoxLayout *pv; // å‚ç›´å¸ƒå±€æŒ‡é’ˆï¼Œç”¨äºç®¡ç†æŒ‰é’®çš„å¸ƒå±€ QHBoxLayout *ph; // æ°´å¹³å¸ƒå±€æŒ‡é’ˆï¼Œç”¨äºç®¡ç†æ“ä½œæŒ‰é’®çš„å¸ƒå±€ QLayoutItem* pi; // å¸ƒå±€é¡¹æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨å½“å‰æ“ä½œçš„å¸ƒå±€é¡¹ QWidget *pw; // ç”¨äºä¿å­˜è¢«æ“ä½œçš„éƒ¨ä»¶ QPushButton *pb, *pb1, *pb2, *pb3, *pb4, *pb5, *pb6, *pb7; // å¤šä¸ªæŒ‰é’®æŒ‡é’ˆ // æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–çª—å£éƒ¨ä»¶ B(QWidget* p = 0) : QWidget(p) pw = 0; // åˆå§‹åŒ–pwä¸º0 pi = 0; // åˆå§‹åŒ–piä¸º0 pv = new QVBoxLayout; // åˆ›å»ºä¸€ä¸ªæ–°çš„å‚ç›´å¸ƒå±€ // åˆ›å»ºå¤šä¸ªæŒ‰é’®å¹¶è®¾ç½®å…¶æ–‡æœ¬ pb = new QPushButton(AAA); pb1 = new QPushButton(BBB); pb2 = new QPushButton(CCC); pb3 = new QPushButton(DDD); pb4 = new QPushButton(replace); // æ›¿æ¢æŒ‰é’® pb5 = new QPushButton(remove); // ç§»é™¤æŒ‰é’® pb6 = new QPushButton(take); // å–å‡ºæŒ‰é’® pb7 = new QPushButton(del); // åˆ é™¤æŒ‰é’® // å°†æŒ‰é’®æ·»åŠ åˆ°å‚ç›´å¸ƒå±€ä¸­ pv-addWidget(pb); pv-addWidget(pb1); pv-addWidget(pb2); ph = new QHBoxLayout; // åˆ›å»ºä¸€ä¸ªæ–°çš„æ°´å¹³å¸ƒå±€ // å°†æ“ä½œæŒ‰é’®æ·»åŠ åˆ°æ°´å¹³å¸ƒå±€ä¸­ ph-addWidget(pb4); ph-addWidget(pb5); ph-addWidget(pb6); ph-addWidget(pb7); // åˆ›å»ºä¸»å¸ƒå±€ï¼Œå°†æ°´å¹³å¸ƒå±€å’Œå‚ç›´å¸ƒå±€æ·»åŠ åˆ°ä¸»å¸ƒå±€ä¸­ QVBoxLayout *pv1 = new QVBoxLayout; pv1-addLayout(ph); pv1-addLayout(pv); setLayout(pv1); // è®¾ç½®çª—å£çš„å¸ƒå±€ä¸ºä¸»å¸ƒå±€ // è¿æ¥æŒ‰é’®çš„ç‚¹å‡»ä¿¡å·åˆ°ç›¸åº”çš„æ§½å‡½æ•° connect(pb4, QPushButton::clicked, this, B::f); // ç‚¹å‡»æ›¿æ¢æŒ‰é’®æ—¶è°ƒç”¨få‡½æ•° connect(pb5, QPushButton::clicked, this, B::f1); // ç‚¹å‡»ç§»é™¤æŒ‰é’®æ—¶è°ƒç”¨f1å‡½æ•° connect(pb6, QPushButton::clicked, this, B::f2); // ç‚¹å‡»å–å‡ºæŒ‰é’®æ—¶è°ƒç”¨f2å‡½æ•° connect(pb7, QPushButton::clicked, this, B::f3); // ç‚¹å‡»åˆ é™¤æŒ‰é’®æ—¶è°ƒç”¨f3å‡½æ•° // æ„é€ å‡½æ•°ç»“æŸpublic slots: void f() // æ›¿æ¢pvå¸ƒå±€ä¸­çš„pbæŒ‰é’®ä¸ºpb3æŒ‰é’®ï¼Œpbæœªè¢«åˆ é™¤ pi = pv-replaceWidget(pb, pb3); // æ£€æŸ¥piç®¡ç†çš„éƒ¨ä»¶æ˜¯å¦ä¸ºæŒ‰é’® if (pi-controlTypes() == QSizePolicy::PushButton) pw = pi-widget(); // å°†è¢«æ›¿æ¢çš„æŒ‰é’®èµ‹å€¼ç»™pw void f1() // ä»pvå¸ƒå±€ä¸­ç§»é™¤pb1æŒ‰é’®ï¼Œä½†ä¸åˆ é™¤å®ƒ pv-QLayout::removeWidget(pb1); pw = pb1; // å°†pb1èµ‹å€¼ç»™pw void f2() // ä½¿ç”¨QBoxLayoutç±»çš„takeAtå‡½æ•°ç§»é™¤ç´¢å¼•ä¸º0çš„éƒ¨ä»¶ï¼Œä½†ä¸åˆ é™¤å®ƒ pi = pv-QBoxLayout::takeAt(0); // æ£€æŸ¥piç®¡ç†çš„éƒ¨ä»¶æ˜¯å¦ä¸ºæŒ‰é’® if (pi-controlTypes() == QSizePolicy::PushButton) pw = pi-widget(); // å°†è¢«å–å‡ºçš„æŒ‰é’®èµ‹å€¼ç»™pw void f3() // åˆ é™¤é¡¹ç›®å’Œéƒ¨ä»¶çš„å‡½æ•° // ä»…åˆ é™¤å¸ƒå±€é¡¹ç›®piä¸ä¼šåˆ é™¤å¸ƒå±€ç®¡ç†çš„éƒ¨ä»¶pwï¼Œå› æ­¤éœ€è¦æ˜ç¡®åˆ é™¤ if (pi != 0) delete pi; // åˆ é™¤å¸ƒå±€é¡¹ pi = 0; // å°†pié‡ç½®ä¸º0 if (pw != 0) delete pw; // åˆ é™¤éƒ¨ä»¶ pw = 0; // å°†pwé‡ç½®ä¸º0 ;#endif // M_H// m.cpp æ–‡ä»¶çš„å†…å®¹#include m.h // åŒ…å«å¤´æ–‡ä»¶m.hint main(int argc, char *argv[]) QApplication a(argc, argv); // åˆ›å»ºQApplicationå¯¹è±¡ï¼Œåˆå§‹åŒ–åº”ç”¨ç¨‹åº B w; // åˆ›å»ºBç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºä¸»çª—å£ w.resize(300, 200); // è®¾ç½®çª—å£å¤§å°ä¸º300x200åƒç´  w.show(); // æ˜¾ç¤ºçª—å£ return a.exec(); // è¿›å…¥åº”ç”¨ç¨‹åºçš„äº‹ä»¶å¾ªç¯ æ€»ç»“è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ª Qt åº”ç”¨ç¨‹åºï¼Œåˆ›å»ºäº†ä¸€ä¸ªçª—å£éƒ¨ä»¶ç±» Bã€‚è¯¥ç±»åŒ…å«å¤šä¸ªæŒ‰é’®å’Œå¸ƒå±€ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ç‚¹å‡»æŒ‰é’®æ¥æ›¿æ¢ã€ç§»é™¤ã€å–å‡ºå’Œåˆ é™¤æŒ‰é’®ã€‚æ¯ä¸ªæŒ‰é’®çš„åŠŸèƒ½é€šè¿‡æ§½å‡½æ•°å®ç°ï¼Œç¡®ä¿ç”¨æˆ·çš„äº¤äº’èƒ½å¤ŸåŠ¨æ€æ›´æ–°ç•Œé¢ã€‚ä¸»å‡½æ•°åˆå§‹åŒ–åº”ç”¨ç¨‹åºå¹¶æ˜¾ç¤ºçª—å£ã€‚","categories":["3.å¼€å‘æ¡†æ¶","Qt","æ§ä»¶"]},{"title":"QTabWidget","path":"/2025/03/02/3-å¼€å‘æ¡†æ¶-Qt-æ§ä»¶-QTabWidgetçš„éšè—/","content":"å¯¹äºä¸€ä¸ª QTabWidgetï¼Œåœ¨ä¸åŒçš„çŠ¶æ€ä¸‹æ˜¾ç¤ºä¸åŒçš„æ ‡ç­¾é¡µï¼ˆtabï¼‰æ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ã€‚æœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦éšè—æŸäº›æ ‡ç­¾é¡µï¼Œä»¥ä¾¿ç”¨æˆ·ç•Œé¢æ›´åŠ ç®€æ´ã€‚è™½ç„¶å¯ä»¥ä½¿ç”¨ removeTab() æ–¹æ³•æ¥åˆ é™¤æ ‡ç­¾é¡µï¼Œä½†è¿™æ ·åšä¼šå¯¼è‡´åœ¨éœ€è¦å†æ¬¡æ˜¾ç¤ºè¿™äº›æ ‡ç­¾é¡µæ—¶ï¼Œå¿…é¡»é‡æ–°æ·»åŠ å®ƒä»¬ï¼Œè¿™ä¸ä»…ç¹çï¼Œè¿˜å¯èƒ½éœ€è¦å¤æ‚çš„ç´¢å¼•è®¡ç®—ã€‚ å› æ­¤ï¼Œå¯»æ‰¾ä¸€ç§åœ¨ä¸åˆ é™¤æ ‡ç­¾é¡µçš„æƒ…å†µä¸‹éšè—å®ƒä»¬çš„æ–¹æ³•æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚é—æ†¾çš„æ˜¯ï¼ŒQt å¹¶æ²¡æœ‰æä¾›ç±»ä¼¼ hide() æˆ– setVisible() çš„æ¥å£æ¥ç›´æ¥éšè—æ ‡ç­¾é¡µï¼ˆæŸ¥çœ‹æºç å¯ä»¥å‘ç°ï¼Œæ ‡ç­¾é¡µå¹¶ä¸æ˜¯ QWidget çš„å­ç±»ï¼‰ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ æˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯ç»“åˆä½¿ç”¨ QTabWidget::setTabEnabled() æ¥å£å’Œ Qt æ ·å¼è¡¨ï¼ˆQSSï¼‰æ¥å®ç°éšè—æ ‡ç­¾é¡µçš„æ•ˆæœã€‚ ä½¿ç”¨ setTabEnabled()setTabEnabled() æ–¹æ³•çš„åŠŸèƒ½éå¸¸ç®€å•æ˜äº†ï¼šå½“æŸäº›æ ‡ç­¾é¡µä¸éœ€è¦è¢«ä½¿ç”¨æ—¶ï¼Œå¯ä»¥å°†å®ƒä»¬ç¦ç”¨ã€‚ç¦ç”¨æ ‡ç­¾é¡µåï¼Œå®ƒä»¬ä»ç„¶ä¼šæ˜¾ç¤ºåœ¨ç•Œé¢ä¸Šï¼Œä½†ç”¨æˆ·æ— æ³•ä¸ä¹‹äº¤äº’ã€‚ç„¶è€Œï¼Œç¦ç”¨æ ‡ç­¾é¡µå¹¶ä¸ä¼šä½¿å…¶å®Œå…¨éšè—ï¼Œè¿™æ—¶å°±éœ€è¦å€ŸåŠ© QSS çš„åŠ›é‡ã€‚ ä½¿ç”¨ QSS éšè—æ ‡ç­¾é¡µè™½ç„¶ QSS æœ¬èº«å¹¶ä¸èƒ½ç›´æ¥éšè—æ ‡ç­¾é¡µï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®æ ‡ç­¾é¡µçš„æ ·å¼æ¥è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç¦ç”¨çŠ¶æ€çš„æ ‡ç­¾é¡µçš„å®½åº¦è®¾ç½®ä¸º 0ï¼Œå¹¶å°†å…¶æ–‡å­—é¢œè‰²è®¾ç½®ä¸ºé€æ˜ã€‚è¿™æ ·ï¼Œç”¨æˆ·åœ¨ç•Œé¢ä¸Šå°±çœ‹ä¸åˆ°è¿™äº›æ ‡ç­¾é¡µï¼Œä»è€Œå®ç°äº†é—´æ¥éšè—çš„ç›®çš„ã€‚ ç¤ºä¾‹ä»£ç ä»¥ä¸‹æ˜¯å®ç°è¿™ä¸€åŠŸèƒ½çš„ç¤ºä¾‹ä»£ç ï¼š // å‡è®¾ tabWidget æ˜¯ä¸€ä¸ª QTabWidget çš„å®ä¾‹tabWidget-setTabEnabled(index, false); // ç¦ç”¨æŒ‡å®šçš„æ ‡ç­¾é¡µ// ä½¿ç”¨ QSS è®¾ç½®æ ·å¼QString style = QTabBar::tab:disabled width: 0px; color: transparent; ;tabWidget-setStyleSheet(style); åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œindex æ˜¯æˆ‘ä»¬æƒ³è¦éšè—çš„æ ‡ç­¾é¡µçš„ç´¢å¼•ã€‚é€šè¿‡è°ƒç”¨ setTabEnabled() æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç¦ç”¨è¯¥æ ‡ç­¾é¡µã€‚æ¥ç€ï¼Œæˆ‘ä»¬ä½¿ç”¨ QSS è®¾ç½®æ ‡ç­¾é¡µçš„æ ·å¼ï¼Œä½¿å…¶åœ¨ç¦ç”¨çŠ¶æ€ä¸‹å®½åº¦ä¸º 0ï¼Œå¹¶å°†æ–‡å­—é¢œè‰²è®¾ä¸ºé€æ˜ã€‚è¿™æ ·ï¼Œç”¨æˆ·åœ¨ç•Œé¢ä¸Šå°±çœ‹ä¸åˆ°è¿™ä¸ªæ ‡ç­¾é¡µäº†ã€‚ å¦‚æœä¹‹å‰è¢«é€‰æ‹©çš„ tab å¦‚æœè¢«ç¦ç”¨æ‰çš„è¯ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨é‡æ–°é€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„ tabï¼Œè¿™ä¸ªéœ€è¦æ‰‹åŠ¨å¤„ç†ï¼›å¦ä¸€ä¸ªæ˜¯å¦‚æœä»”ç»†è§‚å¯Ÿçš„è¯ï¼Œtab ä¹‹é—´æœ‰ä¸€ä¸ªéšè—çš„ tab çš„è¯å¯¹æ˜¾ç¤ºæ ·å¼ä¼šæœ‰ç»†å¾®çš„å½±å“ï¼Œæœ€å·¦ä¾§å’Œæœ€å³ä¾§æœ€ä¸ºæ˜æ˜¾ï¼ˆå¯èƒ½ä¼šå°‘ä¸€ä¸ªè¾¹æ¡†ï¼‰ã€‚","categories":["3.å¼€å‘æ¡†æ¶","Qt","æ§ä»¶"]},{"title":"QTabWidgetæ ·å¼","path":"/2025/03/02/3-å¼€å‘æ¡†æ¶-Qt-æ§ä»¶-QTabWidgetæ ·å¼/","content":"ä¸€ã€QTabWidget æ ·å¼è®¾ç½® åœ¨è®¾ç½® QTabWidget çš„æ ·å¼æ—¶ï¼Œä½¿ç”¨äº† setStyleSheet æ–¹æ³•æ¥å®šä¹‰å…¶å¤–è§‚ã€‚ä»¥ä¸‹æ˜¯å…·ä½“çš„æ ·å¼è®¾ç½®ï¼š setStyleSheet(QTabWidget::pane \\ border-width: 1px; \\ border-color: rgb(48, 104, 151); \\ border-style: outset; \\ background-color: rgb(132, 171, 208); \\ background: transparent; \\ \\QTabWidget::tab-bar \\ border-width: 0px; \\ \\QTabBar::tab \\ border-bottom-color: #C2C7CB; \\ border-top-left-radius: 0px; \\ border-top-right-radius: 0px; \\ max-width: 75px; \\ min-width: 75px; \\ min-height: 25px; \\ font: 14px Times New Roman; \\ padding: 0px; \\ \\QTabBar::scroller \\ width: 25; \\ border: 0; \\ padding: 0px; \\ \\QTabBar QToolButton::right-arrow \\ background-color: rgb(132, 171, 208); \\ border-width: 0; \\ background-image: url(:/images/tab/rightbtn.png); \\ \\QTabBar QToolButton::right-arrow:hover \\ background-color: rgb(132, 171, 208); \\ border-width: 0; \\ background-image: url(:/images/tab/hoverrightbtn.png); \\ \\QTabBar QToolButton::right-arrow:disabled \\ background-color: rgb(132, 171, 208); \\ border-width: 0; \\ background-image: url(:/images/tab/grayrightbtn.png); \\ \\QTabBar QToolButton::left-arrow \\ background-color: rgb(132, 171, 208); \\ border-width: 0; \\ background-image: url(:/images/tab/leftbtn.png); \\ \\QTabBar QToolButton::left-arrow:hover \\ background-color: rgb(132, 171, 208); \\ border-width: 0; \\ background-image: url(:/images/tab/hoverleftbtn.png); \\ \\QTabBar QToolButton::left-arrow:disabled \\ background-color: rgb(132, 171, 208); \\ border-width: 0; \\ background-image: url(:/images/tab/grayleftbtn.png); \\ \\QTabBar::tab:first:selected \\ margin-left: 30; \\ margin-right: 0; \\ color: white; \\ border-image: url(:/images/tab/sel3.png); \\ \\QTabBar::tab:first:!selected \\ color: black; \\ margin-left: 30; \\ margin-right: 0; \\ border-image: url(:/images/tab/normal3.png); \\ \\QTabBar::tab:first:hover:!selected \\ color: black; \\ margin-left: 30; \\ margin-right: 0; \\ border-image: url(:/images/tab/hover3.png); \\ \\QTabBar::tab:middle:selected \\ margin-top: 0; \\ margin-left: -15; \\ margin-right: 8; \\ color: white; \\ border-image: url(:/images/tab/sel3.png); \\ \\QTabBar::tab:middle:!selected \\ color: black; \\ margin-top: 0; \\ margin-left: -15; \\ margin-right: 8; \\ border-image: url(:/images/tab/normal3.png); \\ \\QTabBar::tab:middle:hover:!selected \\ color: black; \\ margin-top: 0; \\ margin-left: -15; \\ margin-right: 8; \\ border-image: url(:/images/tab/hover3.png); \\ \\QTabBar::tab:last:selected \\ margin-top: 0px; \\ margin-left: 0; \\ margin-right: 0; \\ color: white; \\ border-image: url(); \\ \\QTabBar::tab:last:!selected \\ color: black; \\ margin-top: 0; \\ margin-left: 0; \\ margin-right: 0; \\ border-image: url(); \\ \\QTabBar::tab:last:hover:!selected \\ color: black; \\ margin-top: 0; \\ margin-left: 0; \\ margin-right: 0; \\ border-image: url(); \\ \\QTabBar::tab:only-one \\ margin: 0; \\); åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒQTabWidget çš„å¤–è§‚é€šè¿‡è®¾ç½®è¾¹æ¡†ã€èƒŒæ™¯é¢œè‰²å’Œå­—ä½“æ ·å¼ç­‰å±æ€§è¿›è¡Œäº†è¯¦ç»†çš„å®šä¹‰ã€‚ä¾‹å¦‚ï¼Œborder-color è®¾ç½®äº†è¾¹æ¡†çš„é¢œè‰²ï¼Œè€Œ background-color åˆ™å®šä¹‰äº†èƒŒæ™¯çš„é¢œè‰²ã€‚é€šè¿‡ä½¿ç”¨ border-imageï¼Œå¯ä»¥ä¸ºé€‰ä¸­çš„æ ‡ç­¾æä¾›æ›´å…·è§†è§‰å¸å¼•åŠ›çš„æ•ˆæœã€‚ äºŒã€è®¾ç½® QTabWidget çš„ TabBar æ ·å¼ 1ä¸ºäº†è¿›ä¸€æ­¥è‡ªå®šä¹‰ QTabWidget çš„ TabBar æ ·å¼ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š QString tabBarStyle = QTabBar::tab \\ min-width: 100px; \\ color: white; \\ border: 2px solid; \\ border-top-left-radius: 10px; \\ border-top-right-radius: 10px; \\ padding: 5px; \\ \\QTabBar::tab:!selected \\ margin-top: 5px; \\ \\QTabBar::tab:selected \\ color: blue; \\;m_TabWidget-setStyleSheet(tabBarStyle); åœ¨è¿™ä¸ªæ ·å¼ä¸­ï¼Œmin-width ç¡®ä¿æ¯ä¸ªæ ‡ç­¾çš„æœ€å°å®½åº¦ä¸º 100 åƒç´ ï¼Œæä¾›äº†è¶³å¤Ÿçš„ç©ºé—´æ¥æ˜¾ç¤ºæ ‡ç­¾æ–‡æœ¬ã€‚border å±æ€§å®šä¹‰äº†æ ‡ç­¾çš„è¾¹æ¡†æ ·å¼ï¼Œè€Œ border-top-left-radius å’Œ border-top-right-radius åˆ™ä¸ºæ ‡ç­¾çš„é¡¶éƒ¨è§’æ·»åŠ äº†åœ†è§’æ•ˆæœï¼Œä½¿å…¶çœ‹èµ·æ¥æ›´åŠ æŸ”å’Œã€‚é€‰ä¸­çš„æ ‡ç­¾é¢œè‰²è®¾ç½®ä¸ºè“è‰²ï¼Œå¢å¼ºäº†ç”¨æˆ·çš„è§†è§‰ä½“éªŒã€‚ ä¸‰ã€è®¾ç½® QTabWidget çš„ TabBar æ ·å¼ 2 å¦ä¸€ç§æ ·å¼è®¾ç½®çš„æ–¹å¼å¦‚ä¸‹ï¼š QTabWidget::pane \\ border: none; \\ \\QTabWidget::tab-bar \\ alignment: left; \\ \\QTabBar::tab \\ background: transparent; \\ color: white; \\ min-width: 30ex; \\ min-height: 10ex; \\ \\QTabBar::tab:hover \\ background: rgb(255, 255, 255, 100); \\ \\QTabBar::tab:selected \\ border-color: white; \\ background: white; \\ color: green; \\ åœ¨è¿™ä¸ªæ ·å¼ä¸­ï¼ŒQTabWidget::pane çš„è¾¹æ¡†è¢«è®¾ç½®ä¸ºæ— ï¼Œä»¥ä¾¿ä½¿æ ‡ç­¾çš„èƒŒæ™¯æ›´åŠ å¹²å‡€ã€‚QTabBar::tab çš„èƒŒæ™¯è®¾ç½®ä¸ºé€æ˜ï¼Œç¡®ä¿æ ‡ç­¾ä¸èƒŒæ™¯èä¸ºä¸€ä½“ã€‚min-width å’Œ min-height ç¡®ä¿æ ‡ç­¾çš„å°ºå¯¸é€‚ä¸­ï¼Œä¾¿äºç”¨æˆ·ç‚¹å‡»ã€‚é¼ æ ‡æ‚¬åœæ—¶ï¼Œæ ‡ç­¾çš„èƒŒæ™¯é¢œè‰²å˜ä¸ºåŠé€æ˜çš„ç™½è‰²ï¼Œæä¾›äº†è§†è§‰åé¦ˆã€‚é€‰ä¸­çš„æ ‡ç­¾åˆ™æ˜¾ç¤ºä¸ºç™½è‰²èƒŒæ™¯å’Œç»¿è‰²æ–‡æœ¬ï¼Œè¿›ä¸€æ­¥å¢å¼ºäº†å¯è¯»æ€§å’Œç¾è§‚æ€§ã€‚ å‚è€ƒé“¾æ¥ CSDN è®¨è®ºåŒº CSDN åšå®¢","categories":["3.å¼€å‘æ¡†æ¶","Qt","æ§ä»¶"]},{"title":"è¡¨æ ¼Qtxlsx","path":"/2025/03/02/3-å¼€å‘æ¡†æ¶-Qt-æ§ä»¶-è¡¨æ ¼Qtxlsx/","content":"è¯¥æ–‡æ¡£ä»‹ç»äº†åœ¨ ARM ä¸Šä½¿ç”¨ Qtxlsx çš„æ–¹æ³•ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤ç§æ–¹å¼ï¼š 1. ç¼–è¯‘æˆåŠ¨æ€åº“ä½¿ç”¨ ä¸‹è½½ Qtxlsx æºç ï¼ˆGitHubåœ°å€ï¼‰ã€‚ è¿è¡Œï¼š qmakemakemake install åœ¨ .pro æ–‡ä»¶ä¸­æ·»åŠ ï¼š QT += xlsx ç¤ºä¾‹ä»£ç ï¼š #include xlsxdocument.hint main() QXlsx::Document xlsx; xlsx.write(A1, Hello Qt!); xlsx.saveAs(Test.xlsx); return 0; 2. ç›´æ¥ä½¿ç”¨æºä»£ç  åœ¨å·¥ç¨‹ç›®å½•ä¸­æ–°å»º qtxlsx ç›®å½•ï¼Œæ‹·è´ QtXlsxWriter-master/src/xlsx ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶åˆ é™¤ doc æ–‡ä»¶å¤¹å’Œ xlsx.pro æ–‡ä»¶ã€‚ åœ¨ .pro æ–‡ä»¶ä¸­æ·»åŠ ï¼š include(qtxlsx/qtxlsx.pri) ç›´æ¥ä½¿ç”¨æºç æ—¶ï¼Œå¦‚æœä¸ä½¿ç”¨ qmakeï¼Œéœ€æ‰‹åŠ¨å®šä¹‰ï¼š XLSX_NO_LIB å¦‚æœç¼–è¯‘æŠ¥é”™ï¼Œéœ€è¦ä¿®æ”¹ qzipwriter_p.h å’Œ qzipreader.h å¤´æ–‡ä»¶ï¼ˆæ ¹æ®äº¤å‰ç¼–è¯‘ç¯å¢ƒè°ƒæ•´ï¼‰ã€‚ è¿™ä¸¤ç§æ–¹æ³•å‡å¯åœ¨ ARM è®¾å¤‡ä¸Šä½¿ç”¨ Qtxlsx è¿›è¡Œ Excel æ–‡ä»¶çš„å¤„ç†ã€‚å¦‚æœä½ æœ‰å…·ä½“çš„é—®é¢˜æˆ–ç¼–è¯‘é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘å¯ä»¥å¸®åŠ©ä½ åˆ†æè§£å†³ã€‚","categories":["3.å¼€å‘æ¡†æ¶","Qt","æ§ä»¶"]},{"title":"æ‰“åŒ…åˆ†å‘åº”ç”¨","path":"/2025/03/02/3-å¼€å‘æ¡†æ¶-Qt-æ‰“åŒ…åˆ†å‘åº”ç”¨/","content":"è®¾ç½®åº”ç”¨ç¨‹åºå›¾æ ‡ åˆ›å»º .ico æ–‡ä»¶ä½¿ç”¨å¦‚ Photoshop æˆ–åœ¨çº¿å·¥å…·ï¼ˆå¦‚ ConvertICOï¼‰å°† PNGJPG å›¾åƒè½¬æ¢ä¸º ICO æ ¼å¼ã€‚ICO æ–‡ä»¶é€šå¸¸åŒ…å«å¤šä¸ªå°ºå¯¸ï¼ˆå¦‚ 16x16, 32x32, 48x48, 256x256 åƒç´ ï¼‰ï¼Œä»¥é€‚åº”ä¸åŒç¯å¢ƒçš„æ˜¾ç¤ºéœ€æ±‚ã€‚ å°† .ico æ–‡ä»¶æ”¾ç½®åœ¨æºç ç›®å½•å°†ç”Ÿæˆçš„ car.ico æ–‡ä»¶æ”¾åœ¨ä¸ .pro æ–‡ä»¶åŒçº§çš„ç›®å½•ä¸­ï¼Œç¡®ä¿è·¯å¾„æ­£ç¡®ã€‚ åœ¨ .pro æ–‡ä»¶ä¸­æ·»åŠ å›¾æ ‡é…ç½®æ‰“å¼€é¡¹ç›®çš„ .pro æ–‡ä»¶ï¼Œåœ¨ RC_ICONS éƒ¨åˆ†æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š RC_ICONS = car.ico # æ›¿æ¢ä¸ºä½ çš„å›¾æ ‡æ–‡ä»¶å é‡æ–°æ„å»ºé¡¹ç›® é‡æ–°è¿è¡Œ qmake ä»¥åº”ç”¨æ›´æ”¹ã€‚ é‡æ–°ç¼–è¯‘ç¨‹åºï¼Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶å°†æ˜¾ç¤ºæ–°å›¾æ ‡ã€‚ é™æ€ç¼–è¯‘ vs åŠ¨æ€ç¼–è¯‘æ ¸å¿ƒå·®å¼‚å¯¹æ¯” ç‰¹æ€§ é™æ€ç¼–è¯‘ åŠ¨æ€ç¼–è¯‘ å¯æ‰§è¡Œæ–‡ä»¶ å•ä¸€å¤§æ–‡ä»¶ï¼ˆ50-100MB+ï¼‰ å°æ–‡ä»¶ + å¤š DLLï¼ˆæ€»è®¡ç›¸è¿‘ï¼‰ æ’ä»¶æ”¯æŒ âŒ ä¸æ”¯æŒ âœ… å®Œæ•´æ”¯æŒ æ›´æ–°çµæ´»æ€§ éœ€é‡æ–°ç¼–è¯‘æ•´ä¸ªåº”ç”¨ å¯ç‹¬ç«‹æ›´æ–° Qt åº“ å†…å­˜å ç”¨ æ¯è¿›ç¨‹ç‹¬ç«‹åŠ è½½ï¼Œå¤šè¿›ç¨‹æ—¶è¾ƒé«˜ å…±äº«åº“ï¼Œå¤šè¿›ç¨‹æ—¶æ›´é«˜æ•ˆ éƒ¨ç½²å¤æ‚åº¦ ç®€å•ï¼ˆå•æ–‡ä»¶ï¼‰ éœ€ç®¡ç† DLL ä¾èµ– LGPL åˆè§„ éœ€æä¾›å¯¹è±¡æ–‡ä»¶æˆ–æºç  ç›´æ¥ä½¿ç”¨ï¼Œæ— é¢å¤–ä¹‰åŠ¡ é™æ€ç¼–è¯‘ Qt (ä»æºç æ„å»º)é™æ€ç¼–è¯‘éœ€ä» Qt æºç é‡æ–°æ„å»ºï¼Œè¿‡ç¨‹è€—æ—¶è¾ƒé•¿ï¼ˆ2-4 å°æ—¶ï¼‰ï¼Œå»ºè®®ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨ã€‚ Windows (MSVC)ç¯å¢ƒè¦æ±‚ï¼š Visual Studio 20192022 (MSVC) CMake 3.21 Ninja Python 3 Perl (éƒ¨åˆ†æ¨¡å—éœ€è¦) # ä½¿ç”¨ x64 Native Tools Command Prompt for VS# 1. è§£å‹ Qt æºç åˆ°çŸ­è·¯å¾„ï¼ˆé¿å…è·¯å¾„è¿‡é•¿é—®é¢˜ï¼‰cd C:\\qt-src# 2. åˆ›å»ºæ„å»ºç›®å½•mkdir C:\\qt-static-build cd C:\\qt-static-build# 3. é…ç½®ï¼ˆè·³è¿‡éå¿…è¦æ¨¡å—ä»¥åŠ é€Ÿï¼‰C:\\qt-src\\configure.bat ^ -static ^ -static-runtime ^ -release ^ -opensource ^ -confirm-license ^ -prefix C:\\Qt\\6.6.0-static ^ -skip qtwebengine ^ -skip qt3d ^ -skip qtquick3d ^ -nomake examples ^ -nomake tests# 4. ç¼–è¯‘ï¼ˆæ ¹æ® CPU æ ¸å¿ƒæ•°è°ƒæ•´ï¼‰cmake --build . --parallel 8# 5. å®‰è£…cmake --install . Linux# å®‰è£…ä¾èµ–sudo apt install build-essential libgl1-mesa-dev libfontconfig1-dev \\ libfreetype6-dev libx11-dev libxext-dev libxfixes-dev libxi-dev \\ libxrender-dev libxcb1-dev libxcb-glx0-dev libxcb-keysyms1-dev \\ libxcb-image0-dev libxcb-shm0-dev libxcb-icccm4-dev \\ libxcb-sync-dev libxcb-xfixes0-dev libxcb-shape0-dev \\ libxcb-randr0-dev libxcb-render-util0-dev libxkbcommon-dev \\ libxkbcommon-x11-dev libssl-dev# é…ç½®../qt-src/configure \\ -static \\ -release \\ -opensource \\ -confirm-license \\ -prefix /opt/qt6-static \\ -skip qtwebengine \\ -nomake examples \\ -nomake testscmake --build . --parallelsudo cmake --install . macOS (Universal Binary)# ç¡®ä¿ Xcode Command Line Tools å·²å®‰è£…xcode-select --install# é…ç½® Universal Binary (x86_64 + arm64)../qt-src/configure \\ -static \\ -release \\ -opensource \\ -confirm-license \\ -prefix /opt/qt6-static \\ -- -DCMAKE_OSX_ARCHITECTURES=x86_64;arm64cmake --build . --parallelsudo cmake --install . [!WARNING]LGPL åè®®çº¦æŸé™æ€é“¾æ¥ Qt (LGPL) è¦æ±‚ç”¨æˆ·èƒ½å¤Ÿé‡æ–°é“¾æ¥åº”ç”¨ã€‚ä½ éœ€è¦ï¼š æä¾›åº”ç”¨çš„ç›®æ ‡æ–‡ä»¶ (.o.obj)ï¼Œæˆ– å¼€æºæ•´ä¸ªåº”ç”¨ï¼Œæˆ– è´­ä¹° Qt å•†ä¸šè®¸å¯è¯ å‘å¸ƒç¨‹åºWindows: windeployqt è¯¦è§£windeployqt æ˜¯ Qt å®˜æ–¹æä¾›çš„ Windows éƒ¨ç½²å·¥å…·ï¼Œè‡ªåŠ¨æ”¶é›†æ‰€æœ‰è¿è¡Œæ—¶ä¾èµ–ã€‚ åŸºç¡€ç”¨æ³•# 1. ä»¥ Release æ¨¡å¼ç¼–è¯‘é¡¹ç›®# 2. å°† exe å¤åˆ¶åˆ°ç‹¬ç«‹ç›®å½•mkdir F:\\deploy copy release\\myapp.exe F:\\deploy\\# 3. è¿è¡Œ windeployqtcd F:\\deploywindeployqt myapp.exe å®Œæ•´å‚æ•°å‚è€ƒ å‚æ•° è¯´æ˜ --release --debug æŒ‡å®šæ„å»ºç±»å‹ --qmldir path QML åº”ç”¨å¿…é¡»æŒ‡å®šï¼Œæ‰«æ QML å¯¼å…¥ --compiler-runtime å¤åˆ¶ MSVCMinGW è¿è¡Œæ—¶åº“ --no-translations ä¸å¤åˆ¶ç¿»è¯‘æ–‡ä»¶ï¼ˆå‡å°ä½“ç§¯ï¼‰ --no-opengl-sw ä¸å¤åˆ¶è½¯ä»¶ OpenGL åº“ --no-system-d3d-compiler ä¸å¤åˆ¶ D3D ç¼–è¯‘å™¨ --list option åˆ—å‡ºä¾èµ– (sourcetargetrelativemapping) --dir path æŒ‡å®šè¾“å‡ºç›®å½• --verbose level è¯¦ç»†è¾“å‡º (0-2) ç”Ÿäº§çº§éƒ¨ç½²å‘½ä»¤# å®Œæ•´éƒ¨ç½²ï¼ˆQML åº”ç”¨ï¼‰windeployqt ^ --release ^ --qmldir D:\\project\\qml ^ --compiler-runtime ^ --no-translations ^ myapp.exe# æœ€å°åŒ–éƒ¨ç½²ï¼ˆWidget åº”ç”¨ï¼‰windeployqt ^ --release ^ --no-translations ^ --no-opengl-sw ^ --no-system-d3d-compiler ^ myapp.exe CMake è‡ªåŠ¨åŒ–é›†æˆ# CMakeLists.txtif(WIN32) # æŸ¥æ‰¾ windeployqt find_program(WINDEPLOYQT_EXECUTABLE windeployqt HINTS $Qt6_DIR/../../../bin) # æ·»åŠ éƒ¨ç½²ç›®æ ‡ add_custom_command(TARGET $PROJECT_NAME POST_BUILD COMMAND $WINDEPLOYQT_EXECUTABLE --release --no-translations $TARGET_FILE:$PROJECT_NAME COMMENT Running windeployqt... )endif() macOS: macdeployqtmacdeployqt åˆ›å»ºè‡ªåŒ…å«çš„ .app Bundleï¼Œå¯é€‰ç”Ÿæˆ .dmg ç£ç›˜æ˜ åƒã€‚ åŸºç¡€ç”¨æ³•# éƒ¨ç½²åº”ç”¨macdeployqt MyApp.app# ç”Ÿæˆ DMGmacdeployqt MyApp.app -dmg# QML åº”ç”¨macdeployqt MyApp.app -qmldir=./qml -dmg ä»£ç ç­¾åä¸å…¬è¯ (App Store åˆ†å‘å¿…éœ€)# ç­¾åå¹¶å¯ç”¨ Hardened Runtimemacdeployqt MyApp.app \\ -sign-for-notarization=Developer ID Application: Your Name (TEAM_ID) \\ -hardened-runtime \\ -timestamp# å…¬è¯ (éœ€ Apple Developer è´¦å·)xcrun notarytool submit MyApp.dmg \\ --apple-id your@email.com \\ --team-id TEAM_ID \\ --password @keychain:AC_PASSWORD \\ --wait# è£…è®¢å…¬è¯ç¥¨æ®xcrun stapler staple MyApp.dmg å¸¸ç”¨å‚æ•° å‚æ•° è¯´æ˜ -dmg ç”Ÿæˆ DMG ç£ç›˜æ˜ åƒ -qmldir=path QML æºç ç›®å½• -codesign=identity ä»£ç ç­¾åæ ‡è¯† -hardened-runtime å¯ç”¨å¼ºåŒ–è¿è¡Œæ—¶ -sign-for-notarization=id ç­¾åå¹¶å‡†å¤‡å…¬è¯ -appstore-compliant ç§»é™¤ App Store ç¦æ­¢çš„ API -verbose=0-3 è¯¦ç»†è¾“å‡ºçº§åˆ« Linux: linuxdeployqt ä¸ AppImageLinux æ²¡æœ‰å®˜æ–¹éƒ¨ç½²å·¥å…·ï¼Œç¤¾åŒºé¡¹ç›® linuxdeployqt å¡«è¡¥äº†è¿™ä¸€ç©ºç™½ã€‚ å®‰è£… linuxdeployqt# ä¸‹è½½ï¼ˆå»ºè®®åœ¨è¾ƒè€çš„å‘è¡Œç‰ˆä¸Šè¿è¡Œä»¥è·å¾—æ›´å¥½å…¼å®¹æ€§ï¼‰wget https://github.com/probonopd/linuxdeployqt/releases/download/continuous/linuxdeployqt-continuous-x86_64.AppImagechmod +x linuxdeployqt-continuous-x86_64.AppImage åˆ›å»º AppImage# 1. å‡†å¤‡ AppDir ç»“æ„mkdir -p MyApp.AppDir/usr/binmkdir -p MyApp.AppDir/usr/share/applicationsmkdir -p MyApp.AppDir/usr/share/icons/hicolor/256x256/appscp build/myapp MyApp.AppDir/usr/bin/cp myapp.desktop MyApp.AppDir/usr/share/applications/cp icon.png MyApp.AppDir/usr/share/icons/hicolor/256x256/apps/myapp.png# 2. åˆ›å»º .desktop æ–‡ä»¶cat MyApp.AppDir/usr/share/applications/myapp.desktop EOF[Desktop Entry]Type=ApplicationName=MyAppExec=myappIcon=myappCategories=Utility;EOF# 3. è¿è¡Œ linuxdeployqt./linuxdeployqt-continuous-x86_64.AppImage \\ MyApp.AppDir/usr/share/applications/myapp.desktop \\ -appimage \\ -qmldir=./qml# è¾“å‡º: MyApp-x86_64.AppImage å¸¸ç”¨å‚æ•° å‚æ•° è¯´æ˜ -appimage ç”Ÿæˆ AppImage æ–‡ä»¶ -qmldir=path QML æºç ç›®å½• -bundle-non-qt-libs åŒ…å«é Qt ä¾èµ–åº“ -extra-plugins=list é¢å¤– Qt æ’ä»¶ -no-translations ä¸åŒ…å«ç¿»è¯‘ -verbose=0-3 è¯¦ç»†è¾“å‡º CMake é¡¹ç›®éƒ¨ç½²é…ç½®Qt 6 æä¾›äº†åŸç”Ÿ CMake éƒ¨ç½²æ”¯æŒï¼Œæ¨èä½¿ç”¨å®˜æ–¹ APIã€‚ Qt 6 éƒ¨ç½² APIcmake_minimum_required(VERSION 3.21)project(MyApp VERSION 1.0.0 LANGUAGES CXX)find_package(Qt6 REQUIRED COMPONENTS Core Widgets)qt_standard_project_setup()qt_add_executable(MyApp main.cpp mainwindow.cpp)target_link_libraries(MyApp PRIVATE Qt6::Core Qt6::Widgets)# ç”Ÿæˆéƒ¨ç½²è„šæœ¬qt_generate_deploy_app_script( TARGET MyApp OUTPUT_SCRIPT deploy_script NO_UNSUPPORTED_PLATFORM_ERROR)# å®‰è£…ç›®æ ‡install(TARGETS MyApp BUNDLE DESTINATION . RUNTIME DESTINATION $CMAKE_INSTALL_BINDIR)# æ‰§è¡Œéƒ¨ç½²è„šæœ¬install(SCRIPT $deploy_script) Windows å›¾æ ‡é…ç½®# åˆ›å»º resources/app.rcset(APP_ICON_RESOURCE $CMAKE_SOURCE_DIR/resources/app.rc)# app.rc å†…å®¹:# IDI_ICON1 ICON app.icoqt_add_executable(MyApp main.cpp $APP_ICON_RESOURCE # æ·»åŠ èµ„æºæ–‡ä»¶)# è®¾ç½® Windows åº”ç”¨å±æ€§set_target_properties(MyApp PROPERTIES WIN32_EXECUTABLE TRUE) RPATH é…ç½® (LinuxmacOS)# è®¾ç½®è¿è¡Œæ—¶åº“æœç´¢è·¯å¾„set_target_properties(MyApp PROPERTIES INSTALL_RPATH $ORIGIN/../lib INSTALL_RPATH_USE_LINK_PATH TRUE BUILD_WITH_INSTALL_RPATH TRUE) åº”ç”¨ç‰ˆæœ¬ä¿¡æ¯ä¸å…ƒæ•°æ®Windows èµ„æºæ–‡ä»¶ (.rc)åœ¨ Windows ä¸Šï¼Œç‰ˆæœ¬ä¿¡æ¯åµŒå…¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶çš„èµ„æºæ®µä¸­ã€‚ version.h#ifndef VERSION_H#define VERSION_H#define VER_FILEVERSION 1,0,0,0#define VER_FILEVERSION_STR 1.0.0.0#define VER_PRODUCTVERSION 1,0,0,0#define VER_PRODUCTVERSION_STR 1.0.0#define VER_COMPANYNAME_STR Your Company#define VER_FILEDESCRIPTION_STR My Application#define VER_INTERNALNAME_STR myapp#define VER_LEGALCOPYRIGHT_STR Copyright (C) 2025#define VER_ORIGINALFILENAME_STR myapp.exe#define VER_PRODUCTNAME_STR My Application#endif // VERSION_H version.rc#include windows.h#include version.hIDI_ICON1 ICON app.icoVS_VERSION_INFO VERSIONINFOFILEVERSION VER_FILEVERSIONPRODUCTVERSION VER_PRODUCTVERSIONFILEFLAGSMASK VS_FFI_FILEFLAGSMASKFILEFLAGS 0FILEOS VOS_NT_WINDOWS32FILETYPE VFT_APPFILESUBTYPE VFT2_UNKNOWNBEGIN BLOCK StringFileInfo BEGIN BLOCK 040904B0 // è‹±æ–‡(ç¾å›½), Unicode BEGIN VALUE CompanyName, VER_COMPANYNAME_STR VALUE FileDescription, VER_FILEDESCRIPTION_STR VALUE FileVersion, VER_FILEVERSION_STR VALUE InternalName, VER_INTERNALNAME_STR VALUE LegalCopyright, VER_LEGALCOPYRIGHT_STR VALUE OriginalFilename, VER_ORIGINALFILENAME_STR VALUE ProductName, VER_PRODUCTNAME_STR VALUE ProductVersion, VER_PRODUCTVERSION_STR END END BLOCK VarFileInfo BEGIN VALUE Translation, 0x0409, 1200 // è‹±æ–‡, Unicode ENDEND qmake é›†æˆVERSION = 1.0.0QMAKE_TARGET_COMPANY = Your CompanyQMAKE_TARGET_PRODUCT = My ApplicationQMAKE_TARGET_DESCRIPTION = Application DescriptionQMAKE_TARGET_COPYRIGHT = Copyright (C) 2025RC_ICONS = app.icoRC_FILE = version.rc CMake é›†æˆ (configure_file)# version.rc.in æ¨¡æ¿set(PROJECT_VERSION_MAJOR 1)set(PROJECT_VERSION_MINOR 0)set(PROJECT_VERSION_PATCH 0)configure_file( $CMAKE_SOURCE_DIR/resources/version.rc.in $CMAKE_BINARY_DIR/version.rc @ONLY)qt_add_executable(MyApp main.cpp $CMAKE_BINARY_DIR/version.rc) macOS Info.plist?xml version=1.0 encoding=UTF-8?!DOCTYPE plist PUBLIC -//Apple//DTD PLIST 1.0//EN http://www.apple.com/DTDs/PropertyList-1.0.dtdplist version=1.0dict keyCFBundleExecutable/key stringMyApp/string keyCFBundleIdentifier/key stringcom.yourcompany.myapp/string keyCFBundleName/key stringMy Application/string keyCFBundleShortVersionString/key string1.0.0/string keyCFBundleVersion/key string1/string keyNSHighResolutionCapable/key true//dict/plist æ‰“åŒ…ç¨‹åºQt Installer Framework (IFW)Qt å®˜æ–¹å®‰è£…ç¨‹åºæ¡†æ¶ï¼Œæ”¯æŒè·¨å¹³å°ã€åœ¨çº¿æ›´æ–°ã€ç»„ä»¶åŒ–å®‰è£…ã€‚ ç›®å½•ç»“æ„installer/â”œâ”€â”€ config/â”‚ â””â”€â”€ config.xml # å…¨å±€é…ç½®â””â”€â”€ packages/ â””â”€â”€ com.yourcompany.myapp/ â”œâ”€â”€ meta/ â”‚ â””â”€â”€ package.xml # ç»„ä»¶é…ç½® â””â”€â”€ data/ â””â”€â”€ ... # åº”ç”¨æ–‡ä»¶ config.xml?xml version=1.0 encoding=UTF-8?Installer NameMy Application/Name Version1.0.0/Version TitleMy Application Installer/Title PublisherYour Company/Publisher StartMenuDirMy Application/StartMenuDir TargetDir@ApplicationsDir@/MyApp/TargetDir !-- å®‰è£…ç¨‹åºå›¾æ ‡ -- InstallerWindowIconinstaller_icon/InstallerWindowIcon InstallerApplicationIconinstaller_icon/InstallerApplicationIcon !-- ç»´æŠ¤å·¥å…· -- MaintenanceToolNameMaintenanceTool/MaintenanceToolName !-- åœ¨çº¿ä»“åº“ï¼ˆå¯é€‰ï¼‰ -- !-- RemoteRepositories Repository Urlhttps://your-server.com/repository/Url Enabled1/Enabled /Repository /RemoteRepositories --/Installer package.xml?xml version=1.0 encoding=UTF-8?Package DisplayNameMy Application/DisplayName DescriptionCore application files/Description Version1.0.0/Version ReleaseDate2025-01-22/ReleaseDate Defaulttrue/Default Scriptinstallscript.qs/Script/Package ç”Ÿæˆå®‰è£…ç¨‹åº# å®šä½ binarycreatorï¼ˆQt å®‰è£…ç›®å½•ä¸‹ï¼‰# Windows: Qt\\Tools\\QtInstallerFramework\\4.x\\bin\\binarycreator.exe# Linux/macOS: ~/Qt/Tools/QtInstallerFramework/4.x/bin/binarycreator# ç”Ÿæˆç¦»çº¿å®‰è£…ç¨‹åºbinarycreator -c config/config.xml -p packages MyAppInstaller# ç”Ÿæˆåœ¨çº¿å®‰è£…ç¨‹åºbinarycreator -c config/config.xml -p packages -n MyAppOnlineInstaller IFW vs Inno Setup å¯¹æ¯” ç‰¹æ€§ Qt IFW Inno Setup è·¨å¹³å° âœ… WindowsmacOSLinux âŒ ä»… Windows åœ¨çº¿æ›´æ–° âœ… å†…ç½®æ”¯æŒ âŒ éœ€ç¬¬ä¸‰æ–¹ ç»„ä»¶åŒ– âœ… ç»†ç²’åº¦ç»„ä»¶ âš ï¸ æœ‰é™æ”¯æŒ å­¦ä¹ æ›²çº¿ ä¸­ç­‰ ç®€å• å®‰è£…åŒ…ä½“ç§¯ è¾ƒå¤§ (å«æ¡†æ¶) è¾ƒå° ä½¿ç”¨ Inno Setup åˆ¶ä½œå®‰è£…åŒ… ä¸‹è½½å¹¶å®‰è£… Inno Setupä» Inno Setup å®˜æ–¹ç½‘ç«™ ä¸‹è½½å¹¶å®‰è£…ã€‚ åˆ›å»ºæ–°è„šæœ¬ æ‰“å¼€ Inno Setup Compilerï¼Œé€‰æ‹© File â†’ New åˆ›å»ºæ–°è„šæœ¬ã€‚ å¡«å†™åº”ç”¨ç¨‹åºä¿¡æ¯ï¼š åº”ç”¨ç¨‹åºåç§°ï¼šçº¢ç‰Œæ£€æµ‹ç³»ç»Ÿåº”ç”¨ç¨‹åºç‰ˆæœ¬ï¼š2.5å‘å¸ƒè€…ï¼šSHIOTC, Inc.ç½‘ç«™ï¼šhttp://www.shiotc.com/ æŒ‡å®šè¾“å‡ºç›®å½•å’Œæ–‡ä»¶ è®¾ç½®è¾“å‡ºç›®å½•ï¼ˆå¦‚ E:\\releaseï¼‰å’Œä¸»æ‰§è¡Œæ–‡ä»¶è·¯å¾„ã€‚ é…ç½®å®‰è£…é€‰é¡¹ é€‰æ‹©å¼€å§‹èœå•é€‰é¡¹ã€è®¸å¯åè®®ã€å®‰è£…è¯­è¨€ç­‰ã€‚ ç”Ÿæˆè„šæœ¬ç¤ºä¾‹ ; Script generated by the Inno Setup Script Wizard.#define MyAppName çº¢ç‰Œæ£€æµ‹ç³»ç»Ÿ#define MyAppVersion 2.5#define MyAppPublisher SHIOTC, Inc.#define MyAppURL http://www.shiotc.com/#define MyAppExeName redplate_qt.exe[Setup]AppId=ID21B4F6B-401E-4575-B6E1-612A9CA50D58AppName=#MyAppNameAppVersion=#MyAppVersionDefaultDirName=D:/redplate_detection_v2.5OutputDir=E:\\releaseSetupIconFile=ICON.icoCompression=lzma[Files]Source: E:\\release\\*; DestDir: app; Flags: ignoreversion recursesubdirs[Icons]Name: group\\#MyAppName; Filename: app\\#MyAppExeName ç¼–è¯‘è„šæœ¬ ç‚¹å‡» Build â†’ Compile ç”Ÿæˆå®‰è£…åŒ…ã€‚ å¸¸è§éƒ¨ç½²é”™è¯¯ä¸è°ƒè¯•â€œCould not find Qt platform plugin â€˜windowsâ€™â€è¿™æ˜¯æœ€å¸¸è§çš„ Windows éƒ¨ç½²é”™è¯¯ï¼Œè¡¨ç¤ºç¼ºå°‘å¹³å°æ’ä»¶ã€‚ è§£å†³æ–¹æ¡ˆï¼š ç¡®ä¿ç›®å½•ç»“æ„æ­£ç¡®ï¼š myapp/â”œâ”€â”€ myapp.exeâ””â”€â”€ platforms/ â””â”€â”€ qwindows.dll # å¿…é¡»åœ¨ platforms å­ç›®å½• ä½¿ç”¨ windeployqt è‡ªåŠ¨å¤„ç†ï¼š windeployqt myapp.exe æ‰‹åŠ¨æŒ‡å®šæ’ä»¶è·¯å¾„ï¼ˆåˆ›å»º qt.confï¼‰ï¼š [Paths]Plugins = . MinGW è¿è¡Œæ—¶åº“ç¼ºå¤±ä½¿ç”¨ MinGW ç¼–è¯‘æ—¶ï¼Œéœ€è¦é¢å¤–çš„è¿è¡Œæ—¶åº“ï¼š éœ€è¦å¤åˆ¶çš„æ–‡ä»¶ï¼ˆä» MinGW bin ç›®å½•ï¼‰ï¼šâ”œâ”€â”€ libgcc_s_seh-1.dll æˆ– libgcc_s_dw2-1.dll (å–å†³äºæ¶æ„)â”œâ”€â”€ libstdc++-6.dllâ””â”€â”€ libwinpthread-1.dll OpenGL ç›¸å…³é”™è¯¯å¦‚æœåº”ç”¨ä½¿ç”¨ OpenGLï¼š éœ€è¦çš„æ–‡ä»¶ï¼šâ”œâ”€â”€ libEGL.dllâ”œâ”€â”€ libGLESv2.dllâ””â”€â”€ opengl32sw.dll # è½¯ä»¶æ¸²æŸ“åå¤‡ ï¼ˆæˆ– d3dcompiler_47.dllï¼‰ [!TIP]å¦‚æœç›®æ ‡æœºå™¨æœ‰ç‹¬ç«‹æ˜¾å¡ï¼Œé€šå¸¸ä¸éœ€è¦ opengl32sw.dllã€‚ä½¿ç”¨ --no-opengl-sw æ’é™¤å®ƒä»¥å‡å°åŒ…ä½“ç§¯ã€‚ ä¾èµ–è¯Šæ–­å·¥å…· å·¥å…· å¹³å° è¯´æ˜ Dependencies Windows ç°ä»£åŒ– Dependency Walker æ›¿ä»£ ldd Linux åˆ—å‡ºåŠ¨æ€åº“ä¾èµ– otool -L macOS åˆ—å‡ºåŠ¨æ€åº“ä¾èµ– ä½¿ç”¨ Dependencies è¯Šæ–­# ä¸‹è½½ Dependencies# https://github.com/lucasg/Dependencies/releases# åˆ†æå¯æ‰§è¡Œæ–‡ä»¶Dependencies.exe myapp.exe# æŸ¥çœ‹ç¼ºå¤±çš„ DLLï¼ˆçº¢è‰²æ ‡è®°ï¼‰ Linux: ldd æ£€æŸ¥# æ£€æŸ¥ä¾èµ–ldd ./myapp# æŸ¥æ‰¾ç¼ºå¤±åº“ldd ./myapp | grep not found è°ƒè¯•ç¯å¢ƒå˜é‡è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡è·å–è¯¦ç»†æ—¥å¿—ï¼š # Windows (PowerShell)$env:QT_DEBUG_PLUGINS = 1$env:QT_PLUGIN_PATH = C:\\path\\to\\plugins./myapp.exe# Linux/macOSQT_DEBUG_PLUGINS=1 ./myapp","categories":["3.å¼€å‘æ¡†æ¶","Qt"]},{"title":"Qt MySQL å…¨æµç¨‹å®æˆ˜æŒ‡å—","path":"/2025/03/02/3-å¼€å‘æ¡†æ¶-Qt-Standby-æ“ä½œMySQL/","content":"1. æ ¸å¿ƒæœºåˆ¶ä¸æ¶æ„ (Architecture)ä¸ SQLite çš„åµŒå…¥å¼æ¶æ„ä¸åŒï¼ŒQt æ“ä½œ MySQL éµå¾ªæ ‡å‡†çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨ (CS) æ¨¡å‹ã€‚ç†è§£è¿™ä¸€ç‰©ç†éš”ç¦»å¯¹äºè§£å†³â€é©±åŠ¨åŠ è½½å¤±è´¥â€é—®é¢˜è‡³å…³é‡è¦ã€‚ Qt MySQL é©±åŠ¨æ ˆgraph LR App[Qt Application] --|Calls| QtSQL[Qt SQL Module] QtSQL --|Uses| QMYSQL[QMYSQL Plugin .dll/.so] subgraph Client_Side QMYSQL --|Dynamic Link| LibMySQL[MySQL Connector C br (libmysql.dll / libmysqlclient.so)] LibMySQL --|Dependencies| SSL[OpenSSL Libs br (libssl/libcrypto)] end LibMySQL --|TCP/IP| Server[MySQL Server] Qt Application: ä½ çš„åº”ç”¨ç¨‹åºã€‚ QMYSQL Plugin: Qt æä¾›çš„æ¡¥æ¥æ’ä»¶ (qsqlmysql.dll)ã€‚æ³¨æ„ï¼šè¿™åªæ˜¯ä¸€ä¸ªåŒ…è£…å™¨ï¼Œå®ƒæœ¬èº«ä¸åŒ…å« MySQL åè®®å®ç°ã€‚ MySQL Connector (libmysql): çœŸæ­£çš„ Oracle å®˜æ–¹å®¢æˆ·ç«¯åº“ã€‚è¿™æ˜¯æœ€å¸¸ç¼ºå¤±çš„ä¸€ç¯ã€‚ [!IMPORTANT]99% çš„ â€œQMYSQL driver not loadedâ€ é”™è¯¯ï¼Œæ˜¯å› ä¸º Qt æ’ä»¶æ‰¾åˆ°äº†ï¼Œä½†æ’ä»¶æ‰€ä¾èµ–çš„ libmysql.dll æˆ– libssl æ‰¾ä¸åˆ°ã€‚ 2. é©±åŠ¨éƒ¨ç½²ä¸æ•…éšœæ’æŸ¥ (Troubleshooting)åœ¨ WindowsLinux ç¯å¢ƒä¸‹éƒ¨ç½²ç¨‹åºæ—¶ï¼Œå¿…é¡»æ‰‹åŠ¨æä¾›ä¾èµ–åº“ã€‚ 2.1 è¯Šæ–­æ­¥éª¤åœ¨ä¸»å‡½æ•°æœ€å¼€å§‹è¿è¡Œè¯Šæ–­ä»£ç ï¼š #include QCoreApplication#include QSqlDatabase#include QDebug#include QLibraryInfovoid diagnoseDrivers() qInfo() Library Path: QCoreApplication::libraryPaths(); qInfo() Available Drivers: QSqlDatabase::drivers(); QSqlDatabase db = QSqlDatabase::addDatabase(QMYSQL); if (!db.isValid()) qCritical() QMYSQL driver could not be loaded!; // å°è¯•åŠ è½½æ’ä»¶æŸ¥çœ‹è¯¦ç»†ç³»ç»Ÿé”™è¯¯ (ä»…è°ƒè¯•ç”¨) // åœ¨ Windows ä¸Šå¯ä»¥ä½¿ç”¨ DependenciesGui.exe æŸ¥çœ‹ qsqlmysql.dll ç¼ºä»€ä¹ˆä¾èµ– 2.2 ç»ˆæè§£å†³æ–¹æ¡ˆ (Windows)ç°è±¡ï¼šavailable drivers åˆ—è¡¨ä¸­æ²¡æœ‰ QMYSQLï¼Œæˆ–è€…è¿æ¥æ—¶æç¤º Driver not loadedã€‚ ä¿®å¤æ­¥éª¤ï¼š å®šä½ä½æ•°ï¼šç¡®è®¤ä½ çš„ Qt ç¼–è¯‘å™¨æ˜¯ 64ä½ (MSVC2019_64) è¿˜æ˜¯ 32ä½ (MinGW_32)ã€‚å¿…é¡»ä¸‹è½½å¯¹åº”ä½æ•°çš„ MySQL Connectorã€‚ è¯¯åŒºï¼šå®‰è£…äº† 64ä½ MySQL Serverï¼Œä½† Qt ç¨‹åºæ˜¯ 32ä½çš„ - é©±åŠ¨åŠ è½½å¤±è´¥ã€‚ ä¸‹è½½ä¾èµ–ï¼š è®¿é—® MySQL ConnectorC Downloadsã€‚ ä¸‹è½½å¯¹åº”çš„ Zip åŒ…ï¼ˆæ— éœ€å®‰è£…ï¼‰ã€‚ å¤åˆ¶æ–‡ä»¶ï¼š è§£å‹åï¼Œå°† lib ç›®å½•ä¸‹çš„ libmysql.dll å¤åˆ¶åˆ°ä½ çš„ Qt ç¼–è¯‘è¾“å‡ºç›®å½• (å³ .exe æ‰€åœ¨ç›®å½•)ã€‚ æ³¨æ„ï¼šå¦‚æœéœ€è¦ SSL è¿æ¥ï¼Œè¿˜éœ€è¦ OpenSSL åº“ (libssl-1_1-x64.dll, libcrypto-1_1-x64.dll)ï¼Œé€šå¸¸ä½äº Qt çš„ bin ç›®å½•ä¸­ï¼Œç¡®ä¿å®ƒä»¬ä¹Ÿåœ¨æœç´¢è·¯å¾„å†…ã€‚ 2.3 ç»ˆæè§£å†³æ–¹æ¡ˆ (Linux)ç°è±¡ï¼šç¨‹åºæç¤º libmysqlclient.so.X: cannot open shared object fileã€‚ ä¿®å¤æ­¥éª¤ï¼š Qt çš„é¢„ç¼–è¯‘ç‰ˆæ’ä»¶é€šå¸¸é“¾æ¥åˆ°ç‰¹å®šç‰ˆæœ¬çš„åº“ï¼ˆå¦‚ libmysqlclient.so.21ï¼‰ã€‚ å®‰è£…å®¢æˆ·ç«¯åº“ï¼šsudo apt-get install libmysqlclient-dev æ£€æŸ¥ä¾èµ–ï¼šldd path/to/qt/plugins/sqldrivers/libqsqlmysql.so å¦‚æœæç¤º not foundï¼Œå¯èƒ½éœ€è¦å»ºç«‹è½¯é“¾æ¥å…¼å®¹è€ç‰ˆæœ¬ï¼ˆæ…ç”¨ï¼Œæœ€å¥½é‡æ–°ç¼–è¯‘é©±åŠ¨ï¼‰ï¼š# ç¤ºä¾‹ï¼šè®©ç³»ç»ŸæŠŠ.20å½“æˆ.18ç”¨ (ä»…åº”æ€¥)sudo ln -s /usr/lib/x86_64-linux-gnu/libmysqlclient.so.20 /usr/lib/x86_64-linux-gnu/libmysqlclient.so.18 3. å·¥ç¨‹åŒ–è¿æ¥é…ç½® (Production Connection)3.1 ç¨³å¥è¿æ¥æ¨¡å¼MySQL è¿æ¥å¯èƒ½ä¼šå› ä¸ºç½‘ç»œæ³¢åŠ¨æˆ–æœåŠ¡å™¨è¶…æ—¶ï¼ˆwait_timeoutï¼‰è€Œæ–­å¼€ã€‚Qt æä¾›äº†æ–­çº¿é‡è¿é€‰é¡¹ã€‚ bool setupMySql(const QString connName) if (QSqlDatabase::contains(connName)) return true; QSqlDatabase db = QSqlDatabase::addDatabase(QMYSQL, connName); db.setHostName(192.168.1.100); db.setPort(3306); db.setDatabaseName(production_db); db.setUserName(app_user); db.setPassword(strong_password); // å…³é”®é…ç½® (Connect Options) QStringList options; // 1. å¼€å¯æ–­çº¿è‡ªåŠ¨é‡è¿ (MySQL ç‰¹æœ‰é€‰é¡¹) options MYSQL_OPT_RECONNECT=1; // 2. è®¾ç½®è¿æ¥è¶…æ—¶ (ç§’) options MYSQL_OPT_CONNECT_TIMEOUT=10; // 3. è®¾ç½®è¯»å–è¶…æ—¶ (é˜²æ­¢åæŸ¥è¯¢å¡æ­» UI) options MYSQL_OPT_READ_TIMEOUT=30; db.setConnectOptions(options.join(;)); if (!db.open()) qCritical() MySQL Connection Error: db.lastError().text(); return false; return true; 4. é«˜æ•ˆ CRUD ä¸å®‰å…¨æ€§ (Best Practices)4.1 ç»å¯¹ç¦æ­¢çš„æ“ä½œ [!WARNING]ä¸¥ç¦ä½¿ç”¨ QString::arg() æ‹¼æ¥ SQLã€‚ âŒ æ³¨å…¥æ¼æ´ï¼šUser: admin -- âŒ æ€§èƒ½ä½ä¸‹ï¼šæ¯æ¬¡æ‰§è¡Œéƒ½éœ€è¦æœåŠ¡å™¨é‡æ–°è§£æ SQL è¯­æ³•æ ‘ã€‚ 4.2 äº‹åŠ¡ä¸é¢„å¤„ç† (Transactions Prepared Statements)MySQL çš„ç½‘ç»œå»¶è¿Ÿè¿œé«˜äº SQLite çš„æœ¬åœ°ç£ç›˜ IOã€‚æ‰¹é‡æ“ä½œå¿…é¡»ä½¿ç”¨äº‹åŠ¡ã€‚ bool batchInsertOrders(const QString connName, const QListOrder orders) QSqlDatabase db = QSqlDatabase::database(connName); QSqlQuery query(db); // 1. å¼€å¯äº‹åŠ¡ (å‡å°‘ç½‘ç»œå¾€è¿” RTT) if (!db.transaction()) qWarning() Failed to start transaction; return false; // 2. é¢„ç¼–è¯‘ SQL (Server Side Prepare) query.prepare(INSERT INTO orders (order_id, amount, created_at) VALUES (?, ?, ?)); bool success = true; for (const auto order : orders) query.addBindValue(order.id); query.addBindValue(order.amount); query.addBindValue(QDateTime::currentDateTime()); if (!query.exec()) qCritical() Insert failed: query.lastError().text(); success = false; break; // 3. æäº¤ if (success) db.commit(); return true; else db.rollback(); return false; 4.3 å­˜å‚¨è¿‡ç¨‹è°ƒç”¨MySQL å¼ºå¤§çš„åœ°æ–¹åœ¨äºå­˜å‚¨è¿‡ç¨‹ã€‚Qt å¯ä»¥é€šè¿‡ call è¯­æ³•è°ƒç”¨ã€‚ void callReportProcedure() QSqlQuery query; // è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ calculate_daily_report(IN date, OUT status) query.prepare(CALL calculate_daily_report(?, ?)); query.bindValue(0, 2023-10-01); query.bindValue(1, 0, QSql::Out); // ç»‘å®šè¾“å‡ºå‚æ•° if (query.exec()) int status = query.boundValue(1).toInt(); // è·å–è¾“å‡ºå‚æ•° qInfo() Report Finish Status: status; 5. å¸¸è§é—®é¢˜ (FAQ)5.1 è¿œç¨‹è¿æ¥å¤±è´¥ (Host â€˜xxxâ€™ is not allowed)è¿™æ˜¯ MySQL æƒé™é…ç½®é—®é¢˜ï¼Œè€Œé Qt é—®é¢˜ã€‚è§£å†³ï¼šç™»å½• MySQL æœåŠ¡å™¨æ‰§è¡Œï¼š -- å…è®¸ root ç”¨æˆ·ä»ä»»æ„ IP ç™»å½• (ç”Ÿäº§ç¯å¢ƒè¯·æŒ‡å®šå…·ä½“ IP)GRANT ALL PRIVILEGES ON *.* TO root@% IDENTIFIED BY password WITH GRANT OPTION;FLUSH PRIVILEGES; 5.2 ä¹±ç é—®é¢˜ (Wait, itâ€™s all ??)Qt é»˜è®¤ä½¿ç”¨ UTF-8ï¼Œä½†å¦‚æœ MySQL Server é…ç½®ä¸º latin1ï¼Œä¸­æ–‡ä¼šå˜æˆ ?ã€‚è§£å†³ï¼šç¡®ä¿ my.cnf é…ç½®äº† character-set-server=utf8mb4ï¼Œæˆ–è€…åœ¨ Qt è¿æ¥åç«‹å³æ‰§è¡Œï¼š db.exec(SET NAMES utf8mb4); 5.3 çº¿ç¨‹å®‰å…¨ä¸ SQLite ä¸€æ ·ï¼Œ**QSqlDatabase è¿æ¥ä¸èƒ½è·¨çº¿ç¨‹å…±äº«ã€‚å¦‚æœæ˜¯å¤šçº¿ç¨‹é«˜å¹¶å‘åœºæ™¯ï¼ˆå¦‚ HTTP æœåŠ¡å™¨ï¼‰ï¼Œå»ºè®®å®ç°ä¸€ä¸ªè¿æ¥æ±  (Connection Pool)**ï¼Œç»´æŠ¤ä¸€ç»„æ‰“å¼€çš„è¿æ¥ä¾›å·¥ä½œçº¿ç¨‹å¤ç”¨ï¼Œè€Œä¸æ˜¯é¢‘ç¹åœ° OpenCloseã€‚","tags":["Qt","MySQL","Database","Deployment"],"categories":["3.å¼€å‘æ¡†æ¶,Qt,æ•°æ®åº“"]},{"title":"Qt SQLite3 æ·±åº¦å®è·µæŒ‡å—","path":"/2025/03/02/3-å¼€å‘æ¡†æ¶-Qt-Standby-æ•°æ®åº“Sqlite3çš„ä½¿ç”¨/","content":"1. æ ¸å¿ƒæœºåˆ¶ä¸æ¶æ„ (Architecture Mechanism)åœ¨ Qt ç”Ÿæ€ç³»ç»Ÿä¸­ï¼ŒSQLite ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„æ•°æ®åº“æ–‡ä»¶ï¼Œè€Œæ˜¯é€šè¿‡ Qt SQL æ¨¡å—æä¾›çš„ QSQLITE é©±åŠ¨æ’ä»¶è¿›è¡Œæ·±åº¦é›†æˆçš„åµŒå…¥å¼å…³ç³»å‹æ•°æ®åº“ã€‚ç†è§£å…¶åº•å±‚æ¶æ„æ˜¯å†™å‡ºé«˜æ€§èƒ½ã€é«˜å¯é ä»£ç çš„å‰æã€‚ Qt SQL æ¨¡å—æ¶æ„Qt çš„æ•°æ®åº“æ“ä½œæµç¨‹å¹¶éç›´æ¥è°ƒç”¨ SQLite C APIï¼Œè€Œæ˜¯ç»è¿‡äº†å¤šå±‚æŠ½è±¡ã€‚ graph TD UserCode[User Application Code] --|Calls| API[Qt SQL API Layer] API --|QSqlDatabase| Factory[Connection Factory] API --|QSqlQuery| Interface[Query Interface] subgraph Qt_SQL_Module Factory --|Manages| Connection[Connection Handle] Interface --|Uses| AbstractDriver[QSqlDriver Abstract Layer] end AbstractDriver --|Polymorphs to| Plugin[QSQLITE Plugin] Plugin --|Statical/Dynamical Link| Engine[SQLite3 Engine] Engine --|I/O| Disk[(Database File .sqlite / .db)] API Layer (QSqlDatabase, QSqlQuery): å¼€å‘è€…ç›´æ¥äº¤äº’çš„é«˜å±‚æ¥å£ã€‚ Driver Layer (QSqlDriver): æŠ½è±¡å±‚ï¼Œå±è”½ä¸åŒæ•°æ®åº“ï¼ˆMySQL, PostgreSQL, SQLiteï¼‰çš„å·®å¼‚ã€‚ Plugin Layer (QSQLITE): å…·ä½“çš„ SQLite é©±åŠ¨é€‚é…å™¨ï¼Œå®ƒè´Ÿè´£å°† Qt çš„è¯·æ±‚è½¬æ¢ä¸º SQLite çš„ C API è°ƒç”¨ã€‚ [!NOTE]QSqlDatabase æœ¬è´¨ä¸Šä¸æ˜¯ä¸€ä¸ªæ‰“å¼€çš„æ•°æ®åº“è¿æ¥å¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ªç®¡ç†æ•°æ®åº“è¿æ¥çš„å·¥å‚ã€‚å®ƒç»´æŠ¤äº†ä¸€ä¸ªé™æ€çš„è¿æ¥å­—å…¸ï¼ˆDictï¼‰ï¼Œé€šè¿‡ Connection Name åŒºåˆ†ä¸åŒçš„è¿æ¥å®ä¾‹ã€‚ çº¿ç¨‹æ¨¡å‹ (Thread Safety Topology)è¿™æ˜¯ Qt SQLite å¼€å‘ä¸­æœ€å®¹æ˜“å¯¼è‡´å´©æºƒï¼ˆSegmentation Faultï¼‰çš„é¢†åŸŸã€‚ SQLite å¼•æ“: é»˜è®¤ç¼–è¯‘æ¨¡å¼é€šå¸¸æ˜¯ Serialized (çº¿ç¨‹å®‰å…¨)ï¼Œå…è®¸åœ¨å¤šçº¿ç¨‹ä¸­å®‰å…¨è°ƒç”¨ç‰¹å®šçš„ APIã€‚ QSqlDatabase: éçº¿ç¨‹å®‰å…¨ã€‚å®˜æ–¹æ–‡æ¡£æ˜ç¡®è§„å®šï¼šQSqlDatabase çš„è¿æ¥å¥æŸ„ä¸èƒ½è·¨çº¿ç¨‹ä½¿ç”¨ã€‚ é”™è¯¯æ¨¡å¼ï¼šå¦‚æœåœ¨ Thread A åˆ›å»ºè¿æ¥ï¼Œåœ¨ Thread B ä¸­å¤åˆ¶è¯¥è¿æ¥å¯¹è±¡å¹¶æ‰§è¡Œ QSqlQueryã€‚åæœï¼šè™½ç„¶ SQLite å¼•æ“æœ¬èº«æ”¯æŒå¤šçº¿ç¨‹ï¼Œä½† QSqlDriver çš„å†…éƒ¨çŠ¶æ€ç®¡ç†ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè·¨çº¿ç¨‹å…±äº«è¿æ¥å°†å¯¼è‡´ç«äº‰æ¡ä»¶ã€‚ 2. å·¥ç¨‹åŒ–éƒ¨ç½²ä¸é…ç½® (Production Setup)æŠ›å¼ƒ â€œHello Worldâ€ å¼çš„æ•™ç¨‹ï¼Œä»¥ä¸‹æ˜¯ç”Ÿäº§ç¯å¢ƒçš„æ ‡å‡†åˆå§‹åŒ–æµç¨‹ã€‚ 2.1 é©±åŠ¨æ£€æŸ¥ä¸ç¯å¢ƒåˆå§‹åŒ–åœ¨æ“ä½œä»»ä½•æ•°æ®åº“å‰ï¼Œå¿…é¡»é˜²èŒƒå¼åœ°ç¡®è®¤é©±åŠ¨å¯ç”¨æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ†å‘åº”ç”¨æ—¶é˜²æ­¢æ’ä»¶ä¸¢å¤±ã€‚ #include QSqlDatabase#include QDebug#include QStringListvoid checkDriverAvailability() // æ£€æŸ¥ QSQLITE é©±åŠ¨æ˜¯å¦å·²åŠ è½½ if (!QSqlDatabase::isDriverAvailable(QSQLITE)) qCritical() Fatal Error: QSQLITE driver not loaded!; // æ­¤æ—¶åº”æŠ›å‡ºå¼‚å¸¸æˆ–ç»ˆæ­¢åº”ç”¨ä¸Šä¸‹æ–‡ return; // æ‰“å°å½“å‰æ‰€æœ‰å¯ç”¨é©±åŠ¨ä»¥ä¾›è°ƒè¯• qInfo() Available Drivers: QSqlDatabase::drivers(); 2.2 å»ºç«‹ç¨³å¥çš„è¿æ¥ (Robust Connection)åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦é…ç½® ConnectOptions æ¥å¤„ç†å¹¶å‘é”ç«äº‰å’Œç‰¹æ®Šå­—ç¬¦è·¯å¾„ã€‚ bool setupDatabase(const QString dbName, const QString connectionName) // 1. æ£€æŸ¥è¿æ¥æ˜¯å¦å·²å­˜åœ¨ï¼Œé¿å…é‡å¤æ·»åŠ äº§ç”Ÿæ§åˆ¶å°è­¦å‘Š if (QSqlDatabase::contains(connectionName)) return true; // 2. æ·»åŠ æ•°æ®åº“ (æŒ‡å®šé©±åŠ¨ç±»å‹å’Œè¿æ¥å) // æ³¨æ„ï¼šå¦‚æœæ˜¯å•ä¾‹æ¨¡å¼ï¼ŒconnectionName å¯ç•™ç©ºä½¿ç”¨é»˜è®¤è¿æ¥ QSqlDatabase db = QSqlDatabase::addDatabase(QSQLITE, connectionName); db.setDatabaseName(dbName); // 3. å…³é”®é…ç½® (Critical Configuration) // QSQLITE_BUSY_TIMEOUT: è®¾ç½®å¿™ç­‰å¾…è¶…æ—¶ä¸º 5000msã€‚ // é»˜è®¤å€¼ä¸º 0ï¼Œæ„å‘³ç€ä¸€æ—¦é‡åˆ°é”ç«äº‰ï¼ˆLock Contentionï¼‰ç«‹å³è¿”å› SQLITE_BUSY é”™è¯¯ã€‚ // åœ¨å¤šçº¿ç¨‹å†™å…¥åœºæ™¯ä¸‹ï¼Œè¿™æ˜¯å¿…é¡»è®¾ç½®çš„å‚æ•°ã€‚ db.setConnectOptions(QSQLITE_BUSY_TIMEOUT=5000); // 4. æ‰“å¼€è¿æ¥ if (!db.open()) qCritical() Connection failed: db.lastError().text(); return false; return true; 2.3 æ­£ç¡®çš„èµ„æºé‡Šæ”¾ (RAII)QSqlDatabase çš„ææ„æœºåˆ¶æ¯”è¾ƒç‰¹æ®Šã€‚è¦å½»åº•ç§»é™¤è¿æ¥ï¼Œå¿…é¡»éµå¾ª â€œScope éš”ç¦»â€ åŸåˆ™ã€‚ void closeAndRemoveInfo(const QString connName) // åˆ›å»ºå—çº§ä½œç”¨åŸŸ (Block Scope) // åœ¨æ­¤ä½œç”¨åŸŸå†…è·å–è¿æ¥å¹¶ä½¿ç”¨ QSqlDatabase db = QSqlDatabase::database(connName); db.close(); // db å˜é‡åœ¨æ­¤å¤„ç¦»å¼€ä½œç”¨åŸŸï¼Œå¼•ç”¨è®¡æ•°å‡ 1 // å…³é”®ï¼šæ­¤æ—¶ db å¯¹è±¡å·²é”€æ¯ï¼Œä¸å†æŒæœ‰è¿æ¥çš„å¼•ç”¨ // åªæœ‰å½“æ²¡æœ‰ä»»ä½•å˜é‡æŒæœ‰è¯¥è¿æ¥å¼•ç”¨æ—¶ï¼ŒremoveDatabase æ‰ä¼šçœŸæ­£é‡Šæ”¾èµ„æº QSqlDatabase::removeDatabase(connName); 3. é«˜èƒ½æ•ˆå¼€å‘æ¨¡å¼ (High-Efficiency Development)3.1 æ€§èƒ½ä¸å¹¶å‘ï¼šå¯ç”¨ WAL æ¨¡å¼é»˜è®¤çš„ SQLite å›æ»šæ—¥å¿— (Delete Journal) æ¨¡å¼åœ¨ä¸­é«˜å¹¶å‘ä¸‹æ€§èƒ½è¾ƒå·®ï¼ˆè¯»å†™äº’æ–¥ï¼‰ã€‚ç”Ÿäº§ç¯å¢ƒå¼ºçƒˆå»ºè®®å¼€å¯ Write-Ahead Logging (WAL) æ¨¡å¼ï¼Œå®ç°è¯»å†™å¹¶å‘ã€‚ void enableWalMode(const QString connName) QSqlDatabase db = QSqlDatabase::database(connName); QSqlQuery query(db); // å¼€å¯ WAL æ¨¡å¼ // æ³¨æ„ï¼šè¿™å°†æ”¹å˜æ•°æ®åº“æ–‡ä»¶çš„ç‰©ç†ç»“æ„ï¼Œä¼šç”Ÿæˆ -wal å’Œ -shm ä¸´æ—¶æ–‡ä»¶ bool success = query.exec(PRAGMA journal_mode=WAL;); if (!success) qWarning() Failed to set WAL mode: query.lastError(); else if (query.next()) qInfo() Current Journal Mode: query.value(0).toString(); // åº”è¾“å‡º wal // å»ºè®®åŒæ—¶è®¾ç½®åŒæ­¥æ¨¡å¼ä¸º NORMAL (å…¼é¡¾æ€§èƒ½ä¸å®‰å…¨æ€§ï¼Œä»…åœ¨æ–­ç”µæ—¶å¯èƒ½ä¸¢å¤±æå°‘é‡æ•°æ®) query.exec(PRAGMA synchronous=NORMAL;); 3.2 æ‰¹é‡å†™å…¥ä¼˜åŒ–ï¼šäº‹åŠ¡æ§åˆ¶SQLite çš„å•æ¡æ’å…¥æ“ä½œé»˜è®¤ä¼šè§¦å‘ä¸€æ¬¡å®Œæ•´çš„ç£ç›˜åŒæ­¥ï¼ˆfsyncï¼‰ï¼Œè¿™éå¸¸è€—æ—¶ã€‚ [!TIP]æ€§èƒ½é»„é‡‘æ³•åˆ™ï¼šåœ¨æ‰§è¡Œå¤§é‡å†™å…¥ï¼ˆInsertUpdateDeleteï¼‰æ—¶ï¼ŒåŠ¡å¿…æ˜¾å¼å¼€å¯äº‹åŠ¡ã€‚ bool insertUsersBatch(const QString connName, const QListQVariantMap users) QSqlDatabase db = QSqlDatabase::database(connName); QSqlQuery query(db); // 1. å¼€å¯äº‹åŠ¡ (æå¤§æå‡æ‰¹é‡å†™å…¥æ€§èƒ½ï¼Œæ€§èƒ½æå‡å¯è¾¾ 100x) db.transaction(); // 2. å‡†å¤‡è¯­å¥ (Prepared Statement) // ä½¿ç”¨ ODBC é£æ ¼å ä½ç¬¦ (?)ï¼Œé¿å… SQL æ³¨å…¥ä¸”åˆ©ç”¨é¢„ç¼–è¯‘ä¼˜åŒ– query.prepare(INSERT INTO users (id, name, role) VALUES (?, ?, ?)); bool allGood = true; for (const auto user : users) // 3. ç»‘å®šå‚æ•° (Strongly Typed Binding) query.addBindValue(user[id]); query.addBindValue(user[name]); query.addBindValue(user[role]); if (!query.exec()) qCritical() Insert error: query.lastError() Data: user; allGood = false; break; // 4. æäº¤æˆ–å›æ»š if (allGood) db.commit(); return true; else db.rollback(); return false; 3.3 å®‰å…¨çº¢çº¿ï¼šé¢„å¤„ç†è¯­å¥ [!WARNING]ç»å¯¹ç¦æ­¢åœ¨ SQL è¯­å¥å¯å˜éƒ¨åˆ†ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ã€‚ é”™è¯¯ç¤ºèŒƒ (Anti-Pattern): // ä¸¥ç¦åœ¨ç”Ÿäº§ä»£ç ä¸­å‡ºç°ï¼// é£é™© 1: SQL æ³¨å…¥// é£é™© 2: å½“ name åŒ…å«å•å¼•å·æ—¶ä¼šå¯¼è‡´è¯­æ³•é”™è¯¯query.exec(QString(INSERT INTO user VALUES(%1, %2)).arg(id).arg(name)); æ­£ç¡®åšæ³•: å§‹ç»ˆä½¿ç”¨ query.prepare() å’Œ bindValue()ï¼Œå¦‚ä¸ŠèŠ‚ä»£ç æ‰€ç¤ºã€‚ 4. å¤šçº¿ç¨‹å®‰å…¨èŒƒå¼ (Thread-Safe Patterns)é’ˆå¯¹å¤šçº¿ç¨‹å·¥ä½œï¼ˆå¦‚åœ¨åå°çº¿ç¨‹å†™å…¥æ—¥å¿—ï¼Œä¸»çº¿ç¨‹è¯»å– UIï¼‰ï¼Œå¿…é¡»éµå¾ª â€œæ¯çº¿ç¨‹ä¸€è¿æ¥â€ (One Connection Per Thread) åŸåˆ™ã€‚ // ThreadWorker.cpp :: åœ¨å·¥ä½œçº¿ç¨‹çš„æ‰§è¡Œå‡½æ•°ä¸­void ThreadWorker::processData() // 1. æ„é€ å”¯ä¸€çš„è¿æ¥åç§° // ä½¿ç”¨å†…å­˜åœ°å€æˆ–çº¿ç¨‹ ID ä½œä¸ºåç¼€ï¼Œç¡®ä¿ä¸ä¸ä¸»çº¿ç¨‹æˆ–å…¶ä»–çº¿ç¨‹å†²çª QString threadConnName = QString(WorkerConn_%1) .arg((quintptr)QThread::currentThreadId()); // 2. å»ºç«‹è¯¥çº¿ç¨‹ä¸“ç”¨çš„è¿æ¥ (Scope éš”ç¦») QSqlDatabase db = QSqlDatabase::addDatabase(QSQLITE, threadConnName); db.setDatabaseName(app_data.db); // å…³é”®ï¼šå¿…é¡»ä¸ºæ¯ä¸ªçº¿ç¨‹çš„è¿æ¥ç‹¬ç«‹è®¾ç½® Busy Timeout db.setConnectOptions(QSQLITE_BUSY_TIMEOUT=5000); if (db.open()) // åœ¨æ­¤æ‰§è¡Œè¯¥çº¿ç¨‹çš„æ‰€æœ‰æ•°æ®åº“ä»»åŠ¡ QSqlQuery query(db); query.prepare(INSERT INTO logs (level, msg) VALUES (?, ?)); query.addBindValue(INFO); query.addBindValue(Job Processing in Background); query.exec(); db.close(); // 3. æ¸…ç†è¿æ¥å¥æŸ„ // å¿…é¡»åœ¨ db å¯¹è±¡ææ„åè°ƒç”¨ QSqlDatabase::removeDatabase(threadConnName); 5. æ•°æ®å¯¹æ¯”ä¸å±€é™æ€§ (Limitations Benchmarks)5.1 æ€§èƒ½åŸºå‡† (Benchmark Reference)åŸºäº SQLite 3.3x ç‰ˆæœ¬ï¼Œåœ¨æ ‡å‡† SSD ä¸Šçš„å…¸å‹æ€§èƒ½è¡¨ç°ï¼š æ“ä½œç±»å‹ æ¨¡å¼ ååé‡ (Opssec) ç“¶é¢ˆåˆ†æ å•æ¡ Insert Default (Auto-commit) ~100 ç­‰å¾…ç£ç›˜ IO (fsync) æ‰¹é‡ Insert Transaction ~50,000+ ä»…ä¸€æ¬¡ fsync Read (Select) WAL Mode ~100,000+ æ¥è¿‘å†…å­˜è¯»å–é€Ÿåº¦ 5.2 Qt SQLite çš„ç‰¹å®šå±€é™ QSqlQueryModel å»¶è¿ŸåŠ è½½ (Lazy Population):å½“ä½¿ç”¨ QSqlQueryModel æˆ– QSqlTableModel æ˜¾ç¤ºå¤§é‡æ•°æ®æ—¶ï¼ŒQt é»˜è®¤ä»…åŠ è½½å‰ 256 è¡Œã€‚ é—®é¢˜: å¦‚æœåœ¨æ­¤æ—¶è°ƒç”¨ rowCount()ï¼ŒQt ä¸ºäº†è®¡ç®—æ€»è¡Œæ•°ï¼Œä¼šå¼ºåˆ¶éå†æ•´ä¸ªç»“æœé›†ï¼Œå¯¼è‡´ç•Œé¢ç¬é—´å¡é¡¿ã€‚ å¯¹ç­–: å¦‚æœéœ€è¦æ€»è¡Œæ•°ï¼Œè¯·å•ç‹¬æ‰§è¡Œ SELECT COUNT(*) æŸ¥è¯¢ï¼›åœ¨ View ä¸­å°½é‡ä½¿ç”¨ canFetchMore() åŠ¨æ€åŠ è½½ã€‚ ç±»å‹ç³»ç»Ÿçš„å¼±åŒ–:SQLite æ˜¯å¼±ç±»å‹ (Weakly Typed) çš„ã€‚Qt è™½ç„¶ä¼šå°è¯•é€šè¿‡ QVariant è¿›è¡Œè½¬æ¢ï¼Œä½†å¼€å‘è€…å¿…é¡»è‡ªè¡Œä¿è¯ C++ ä¾§ç±»å‹çš„ä¸€è‡´æ€§ã€‚ä¾‹å¦‚ï¼Œå­˜å…¥å­—ç¬¦ä¸²ç±»å‹çš„ â€œ2023-01-01â€ å’Œæ—¶é—´æˆ³ç±»å‹çš„ QDateTime åœ¨æ•°æ®åº“å±‚é¢å¯èƒ½éƒ½æ˜¯å­—ç¬¦ä¸²æˆ–æ•°å€¼ï¼Œæ··åˆå­˜å‚¨ä¼šå¯¼è‡´æŸ¥è¯¢æ¯”è¾ƒå¤±è´¥ã€‚ å†™æ‰©å®¹ç“¶é¢ˆ:å³ä¾¿å¼€å¯ WALï¼ŒSQLite åœ¨åŒä¸€ç‰©ç†æ–‡ä»¶ä¸Šä»ç„¶åªèƒ½æœ‰ä¸€ä¸ª Writerã€‚å¦‚æœåº”ç”¨åœºæ™¯éœ€è¦æŒç»­é«˜å¹¶å‘å†™å…¥å¯¼è‡´ UI å“åº”å»¶è¿Ÿï¼Œåº”è€ƒè™‘å°†æ•°æ®å†™å…¥è¿ç§»åˆ°ç‹¬ç«‹çš„åå°é˜Ÿåˆ—ï¼Œæˆ–è€…å‡çº§åˆ° MySQLPostgreSQL å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ã€‚","tags":["Qt","Performance","Database","SQLite"],"categories":["3.å¼€å‘æ¡†æ¶,Qt,æ•°æ®åº“"]},{"title":"XYç”µæœºæ–¹å‘è°ƒæ•´","path":"/2025/02/24/5-åµŒå…¥å¼å¼€å‘-ç¡¬ä»¶çŸ¥è¯†-3Dæ‰“å°-XYç”µæœºæ–¹å‘è°ƒæ•´/","content":"è°ƒè¯•æ–¹æ³• 1å‚è€ƒé“¾æ¥ï¼šhttps://wiki.3dphell.com/zh/basic/calibration ä¹Ÿéœ€è¦ä¸‰æ­¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è°ƒè¯•æ–¹æ³• 2é¦–å…ˆ CoreXY çš„å®˜æ–¹ç½‘ç«™ å¯ä»¥çœ‹åˆ°å…¶åŸç†å›¾ï¼Œæˆ‘ä»¬ä»è¿™é‡Œå…¥æ‰‹ã€‚è¿˜æœ‰ä¸€ç§ HD-Bot æ¶æ„ï¼Œæœ¬æ–‡ä¸å±•å¼€è®¨è®ºã€‚ å®é™…çš„ç»•çº¿å›¾ï¼š æˆ‘ä»¬é¦–å…ˆæ¥åˆ†æä¸€ä¸‹ CoreXY çš„ç‰¹ç‚¹ï¼š æ•´ä¸ªç³»ç»Ÿæœ‰ 2 æ ¹çš®å¸¦ï¼Œå¯¹åº” 2 ä¸ªç”µæœºï¼šA å’Œ Bã€‚æŒ¤å‡ºå¤´åœ¨ X å’Œ Y æ–¹å‘ä¸Šçš„ç§»åŠ¨ï¼Œç”±ä¸¤ä¸ªç”µæœºå‚ä¸å®Œæˆã€‚ å½“æŒ¤å‡ºå¤´åœ¨æ–œ 45Â° ç§»åŠ¨æ—¶ï¼Œåªæœ‰ä¸€ä¸ªç”µæœºå‚ä¸ã€‚ ç”±äºæ˜¯å¹¶è”è‡‚ç»“æ„ï¼Œå…¶å®å¾ˆå¤šé…ç½®é‡Œè¯´çš„ Xã€Y ç”µæœºæ˜¯ä¸æ°å½“çš„ã€‚é™¤äº† X æ¨ªæ¢ï¼ŒAã€B ç”µæœºåˆ†åˆ«å¯ä»¥æ”¾åœ¨å›¾ç¤ºä¸‰ä¸ªä½ç½®ã€‚æˆ‘ä»¬çº¦å®šï¼Œå°† A ç”µæœºæ¥åˆ° 3D æ‰“å°æœºä¸»æ¿çš„ X ç”µæœºæ’æ§½ï¼ŒB ç”µæœºæ¥åˆ° Y ç”µæœºæ’æ§½ã€‚ ä¹‹å‰å­˜åœ¨çš„ä¸¤ç§çš„æ–¹æ³•ä¹‹æ‰€ä»¥å¤æ‚ï¼Œæ˜¯å› ä¸ºå½’é›¶æ“ä½œä¸€ç›´éœ€è¦ä¸¤ä¸ªç”µæœºå…±åŒå‚ä¸ï¼Œé‚£å¦‚æœæˆ‘ä»¬è§‚å¯Ÿæ–œ 45Â° æŒ¤å‡ºå¤´çš„è¿åŠ¨æ–¹å‘ï¼Œæ­¤æ—¶å°±åƒç®€å•çš„ i3 æ¶æ„ï¼Œå…¶è¿åŠ¨æ–¹å‘ä»…ä¸€ä¸ªç”µæœºå‚ä¸ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¿«é€Ÿç¡®è®¤ç”µæœºæ–¹å‘ã€‚ 4.1 å¯ç”¨å¼ºåˆ¶ç§»åŠ¨æ–¹ä¾¿è°ƒè¯•#ç”±äº Klipper çš„ä¿æŠ¤æªæ–½ï¼Œåªæœ‰å½’é›¶åæ‰èƒ½æ§åˆ¶è½´ç§»åŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è§£é™¤è¿™ä¸€é™åˆ¶ã€‚å‚è€ƒæ–‡æ¡£ã€‚ Copy# ä¿®æ”¹ printer.cfgï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹# CoreXY ç”µæœºæ–¹å‘æµ‹è¯•ï¼Œæ—¥å¸¸ä½¿ç”¨è¯·å‹¿å¼€å¯[force_move]enable_force_move: True# ä½¿èƒ½ M118 æ§åˆ¶å°è¾“å‡º[respond] åŒæ—¶ï¼Œä¸ºäº†é˜²æ­¢å–·å˜´é¡¶åˆ°çƒ­åºŠï¼Œæˆ‘ä»¬å…ˆæŠŠ Z è½´å½’é›¶ï¼Œç„¶åæŒ¤å‡ºå¤´ç¦»å¼€çƒ­åºŠ 30mmï¼ˆæ­¤è¿‡ç¨‹å¯ä»¥ä½¿ç”¨ä¸‹æ–¹çš„å®ï¼‰ã€‚å†æŠŠæŒ¤å‡ºå¤´æ‰‹åŠ¨ç§»åˆ°çƒ­åºŠä¸­é—´ï¼Œé˜²æ­¢è°ƒè¯•è¿‡ç¨‹ä¸­æ’åˆ°æ¡†æ¶ã€‚ 4.2 æ§åˆ¶å•ä¸ªç”µæœº#ç”±äºæˆ‘ä»¬ä»…éœ€è¦æ§åˆ¶ä¸€ä¸ªç”µæœºï¼Œæ— æ³•ä½¿ç”¨è¯¸å¦‚ G1 X100 F3000 çš„å‘½ä»¤ï¼ŒæŸ¥çœ‹æ–‡æ¡£ å¯çŸ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ FORCE_MOVE STEPPER=config_name DISTANCE=value VELOCITY=value [ACCEL=value] è¿›è¡Œæ§åˆ¶ã€‚æˆ‘ä»¬å†™ä¸€ä¸ªå®ï¼Œæ–¹ä¾¿æ“ä½œã€‚ Copy[gcode_macro DIRECTION]description: æ€å…¼ | å¿«é€Ÿç¡®å®š Aã€B ç”µæœºæ–¹å‘ï¼Œéœ€è¦è®¾ç½® [force_move] ä¸º Truegcode:# å½’é›¶ Zè½´å¹¶æŠ¬é«˜30mmï¼Œé˜²æ­¢è¯¯è§¦çƒ­åºŠã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ“ä½œã€‚G28 ZG1 Z30 F2000M117 Goto Right-Back # æç¤ºä¿¡æ¯æ˜¾ç¤ºåœ¨å±å¹•ä¸ŠM118 Goto Right-Back # æ˜¾ç¤ºåœ¨æ§åˆ¶å°# æ­¤æ—¶æŒ¤å‡ºå¤´åº”å‘å³åæ–¹ç§»åŠ¨FORCE_MOVE STEPPER=stepper_x DISTANCE=20 VELOCITY=10# ç­‰å¾… 2ç§’G4 S2M117 Goto Right-FrontM118 Goto Right-Front# æ­¤æ—¶æŒ¤å‡ºå¤´åº”å‘å³å‰æ–¹ç§»åŠ¨FORCE_MOVE STEPPER=stepper_y DISTANCE=20 VELOCITY=10 æˆ‘ä»¬è®°ä¸‹æŒ¤å‡ºå¤´ä¸¤æ¬¡çš„ç§»åŠ¨æƒ…å†µï¼Œå¯¹ç…§è¿™ä¸ªå›¾ï¼Œç†è®ºä¸Š å…ˆæ²¿çº¢è‰²å‘å³åæ–¹ç§»åŠ¨ 20mm - ç­‰å¾… 2s - å†æ²¿è“è‰²å‘å³å‰æ–¹ç§»åŠ¨ 20mm ã€‚é‚£ä¹ˆæ ¹æ®å®é™…æƒ…å†µï¼Œæˆ‘ä»¬è¿›è¡Œåˆ†æï¼š æŒ¤å‡ºå¤´å…ˆæ²¿è“è‰²æ–¹å‘ç§»åŠ¨ â€”â€” AB ç”µæœºæ¥åï¼Œé…ç½®æ–‡ä»¶ä¸­äº¤æ¢å¼•è„šï¼Œ[stepper_x] å’Œ [stepper_y] çš„ xã€y å­—æ¯å¯¹è°ƒ å…ˆæ²¿çº¢è‰²æ–¹å‘å‘å·¦å‰æ–¹ç§»åŠ¨ â€”â€” A ç”µæœºåå‘ï¼Œå–å DIR å¼•è„šï¼Œå¯¹åº”åŒºåŸŸ [dir_pin: ] å–æ¶ˆæˆ–è€…å¢åŠ åé¢çš„ ! åŒæ ·ï¼Œå†æ²¿çº¢è‰²æ–¹å‘å‘å·¦åæ–¹ç§»åŠ¨ â€”â€” B ç”µæœºæ¥åï¼Œå–å DIR å¼•è„šï¼Œ[dir_pin: ] å–æ¶ˆæˆ–è€…å¢åŠ åé¢çš„ ! ä¿®æ”¹å®Œæˆåï¼Œå»ºè®®åŠæ—¶å…³é—­ [force_move]","tags":["clippings"],"categories":["5.åµŒå…¥å¼å¼€å‘","ç¡¬ä»¶çŸ¥è¯†","3Dæ‰“å°"]},{"title":"5.å¸¸è§é—®é¢˜æ€»ç»“","path":"/2025/02/24/5-åµŒå…¥å¼å¼€å‘-ç¡¬ä»¶çŸ¥è¯†-3Dæ‰“å°-5-å¸¸è§é—®é¢˜æ€»ç»“/","content":"3D æ‰“å°æœºé—®é¢˜æ€»ç»“å¹³å°ä¸Šçš„è“è‰²çº¸æœ‰ä»€ä¹ˆç”¨å¤„ï¼Œç”¨åˆ°ä»€ä¹ˆç¨‹åº¦éœ€è¦æ›´æ¢ï¼Ÿç¾çº¹çº¸ï¼Œå®ƒçš„ä½œç”¨ä¸€æ˜¯é˜²æ­¢åˆ®åå–·å˜´ï¼ŒäºŒè®©æ¨¡å‹ä¸å¹³å°ç²˜æ¥æ›´ç¨³ã€‚ ç”±äºæ‰“å°ææ–™çš„çƒ­èƒ€å†·ç¼©æ•ˆåº”ï¼Œå½“æ‰“å°å¤§ä½“ç§¯æ¨¡å‹æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿç¿˜è¾¹ç°è±¡ï¼Œå»ºè®®æ‰“å°å‰å…ˆè´´ä¸Šè“è‰²ç¾çº¹çº¸ï¼Œæ‰å¼€å§‹æ‰“å°ã€‚è¯¥çº¸å¯åå¤ä½¿ç”¨ï¼Œç›´åˆ°ç ´æŸæˆ–è€…æ˜æ˜¾ç²˜ä¸ä½æ¨¡å‹ä¸ºæ­¢ã€‚ å¤§éƒ¨åˆ†äººéƒ½åœ¨ç”¨ PEI å–·æ¶‚çš„é’¢æ¿ä½œä¸ºåº•é¢ã€‚PEI çš„ç‰¹æ€§æ˜¯å†·çš„æ—¶å€™ä¸ç²˜ï¼Œçƒ­çš„æ—¶å€™å…·æœ‰ä¸€å®šçš„ç²˜æ€§ã€‚ æ–°çš„ PEI åºŠå’Œæ—§çš„è‡ªå¸¦çš„åºŠã€‚æ›´æ¢ PEI åæ‰“å° PETG å°±éå¸¸å¥½ç”¨äº†ã€‚ç­‰åºŠå‡‰äº†ä»¥åè½»è½»ä¸€æ‹¿å°±å¯ä»¥ä»åºŠä¸Šæ‹¿èµ·æ¥äº†ï¼Œä¸åƒæ˜¯åŸæ¥é‚£å¼ åºŠç”¨é“²å­ç¿˜åŠå¤©ã€‚ ä¸è¿‡æ–°åºŠç›®å‰ä¹Ÿæ˜¯é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œå°±æ˜¯æ‰“ PLA æ²¡æœ‰åŸæ¥ç²˜äº†ã€‚æ‰€ä»¥ç”¨ PLA æ‰“å°ç¬¬ä¸€å±‚å¾—æ—¶å€™éœ€è¦å‹å¾—æ›´ä½ä¸€ç‚¹ï¼Œæ‰èƒ½è·å¾—æœ€ä½³å¾—ç²˜æ€§ã€‚ å“ªäº›æ¨¡å‹è¦åŠ æ”¯æ’‘ï¼Ÿå¦‚ä½•åˆ¤æ–­ï¼Ÿ çº¢è‰²ä½ç½®æ˜¯éœ€è¦åŠ æ”¯æ’‘çš„ä½ç½®ï¼ŒCura å³ä¾§å¯ä»¥è®¾ç½®æ”¯æ’‘çš„ç›¸å…³å‚æ•° è°ƒå¹³å°è¿™ä¸ªæ­¥éª¤æ€ä¹ˆç¡®ä¿è·ç¦»è°ƒçš„ ok å‘¢ï¼Ÿå–·å˜´è·ç¦»å¹³å°è·ç¦»å¤ªè¿œæˆ–å¤ªè¿‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆæ¨¡å‹æ‰“å°è¿‡ç¨‹ä¸­ç›´æ¥è¢«æ‹–èµ°ï¼Ÿ é¦–å…ˆåœ¨è°ƒèŠ‚å¹³å°ä¹‹å‰éœ€è¦å…ˆä¿è¯ X è½´åœ¨ä¸æ†ä¸Šç§»åŠ¨æ˜¯æ°´å¹³çš„ å–·å˜´å’Œå¹³å°çš„è·ç¦»æ ‡å‡†ä¸ºä¸€å¼  A4 çº¸çš„è·ç¦»ï¼Œå¦‚æœä¸å¥½åˆ¤æ–­ï¼Œå¡å¼ çº¸åœ¨å¹³å°å’Œå–·å˜´ä¹‹é—´ï¼Œä»¥æ­£å¸¸æŠ½æ‹‰å¹¶é™„å¸¦é˜»åŠ›ä¸ºæ ‡å‡†ï¼› åœ¨ä¸ä¼šåˆ®ä¼¤å¹³å°çš„å‰æä¸‹ï¼Œè°ƒçš„è¶Šè¿‘æ¨¡å‹ç²˜çš„è¶Šç‰¢å›ºï¼ è¿˜å¯ä»¥é€šè¿‡æ¨¡å‹æ‰“å°ç¬¬ä¸€å±‚çš„çŠ¶æ€æ¥åˆ¤æ–­è·ç¦»æ˜¯å¦è°ƒå¥½ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š 1ã€æ­£ç¡®çš„è·ç¦»ï¼šæ‰å¹³ï¼Œæ— é—´éš™ï¼Œé“ºåœ¨å¹³å°ä¸Šé¢å¾ˆå¹³æ•´æ— æ¯›åˆº,å–·å¤´ä¸çƒ­åºŠæ˜¯æœ€ä½³è·ç¦»èƒ½ä¿è¯æ‰“å°å‡ºçš„è€—æè¢«ç´§å‹åœ¨çƒ­åºŠä¸Šæˆå¹³æ•´çš„å¸¦çŠ¶ï¼ˆæ‰çš®çŠ¶ï¼‰ã€‚å¦‚å›¾æ‰€ç¤ºï¼š 2ã€ä¸æ­£ç¡®çš„è·ç¦»ï¼šç»†åœ†çš„ï¼Œç²˜ä¸Šå»æ—¶é“ºçš„ä¸å‡åŒ€ï¼Œæœ‰ç©ºéš™å’Œç¿˜èµ·ï¼Œè¯´æ˜è·ç¦»å¤ªè¿œ,è€—ææ˜¯é é‡åŠ›ä½œç”¨å‚åˆ°çƒ­åºŠï¼Œå½¢æˆåœ†æ¶¦çš„æ¡çŠ¶ï¼Œå…¶é»é™„æ•ˆæœä¸ä½³ï¼Œæ¨¡å‹å®¹æ˜“ç§»åŠ¨ï¼Œæ‰“å°æ•ˆæœéå¸¸ä¸ç†æƒ³ã€‚å¦‚å›¾æ‰€ç¤ºï¼š 3ã€ä¸æ­£ç¡®çš„è·ç¦»ï¼šå‡ºä¸æ—¶ï¼Œå‹åœ¨å¹³å°ä¸Šä¼šå‡ºç°ä¸­é—´è–„ä¸¤è¾¹æœ‰ä¸è§„åˆ™çªèµ·ï¼ˆæœ‰æ¯›åˆºï¼‰çš„ï¼Œè¯´æ˜è´´çš„å¤ªç´§ï¼Œæˆ–è€…å¯èƒ½é€ æˆæ— æ³•å‡ºä¸ä»¥åŠå–·å¤´ç§»åŠ¨æ—¶ä¼šåˆ®å¸¦åˆ°ä¹‹å‰æ‰“å°çš„åœ°æ–¹ï¼Œç›¸å…³å½¢çŠ¶å¦‚å›¾æ‰€ç¤ºï¼š ä»¥ä¸Šæƒ…å†µå‡å¯ä»¥é€šè¿‡è°ƒèŠ‚çƒ­åºŠä¸‹æ–¹çš„å¼¹ç°§æ¥è°ƒæ•´ã€‚ è°ƒèŠ‚å¹³å°éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿè€Œä¸”æ¯æ¬¡æ‰“å°å‰éƒ½éœ€è¦æ£€æŸ¥å¹³å°å—ï¼Ÿ è°ƒèŠ‚å¼¹ç°§èºä¸æ—¶ï¼Œè¯·æ³¨æ„æŒ‰ä½ä¸‹æ–¹çš„ç¾Šè§’èºæ¯ï¼Œä¸ç„¶åœ¨æ‹§çš„è¿‡ç¨‹ä¸­ä¹Ÿä¼šä¸€èµ·è½¬åŠ¨ï¼› æ¯æ¬¡è°ƒå®Œæˆ–æ£€æŸ¥å¹³å°æ“ä½œåï¼Œéƒ½å¿…é¡»ç§»åŠ¨å–·å˜´åœ¨å¹³å°ä¸Šèµ°ä¸€åœˆï¼Œç¡®ä¿ä¸ä¼šåˆ®ä¼¤å¹³å°æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼› è™½ç„¶ä¸éœ€è¦æ¯æ¬¡åœ¨æ‰“å°å‰è°ƒèŠ‚å¹³å°ï¼Œä½†éœ€è¦ä»¥ 1 å¤© 1 æ¬¡ä½œä¸ºå‘¨æœŸæ€§æ£€æŸ¥ï¼Œå¹³å°è·ç¦»åˆé€‚ï¼› ä¸ºä»€ä¹ˆé¢„çƒ­åä¸Šæ–™ï¼Ÿä¸ºä½•æ„Ÿè§‰æ’åˆ°åº•äº†ï¼Œä¸‹æ–¹å–·å˜´å´ä¸å‡ºä¸ï¼Ÿæ¢æ–™çš„æ—¶å€™éœ€è¦æ³¨æ„å“ªäº›æƒ…å†µï¼Ÿ ä¸Šæ–™æ—¶ï¼Œå¦‚æœå–·å¤´æ²¡æœ‰åŠ çƒ­ï¼Œè€—ææ’åˆ°åº•ä¹Ÿä¸ä¼šåä¸ï¼Œå®¢æˆ·å°±æ— æ³•åˆ¤æ–­æ˜¯å¦å·²æ­£å¸¸ä¸Šæ–™ï¼Œæ‰€ä»¥å¿…é¡»å…ˆé¢„çƒ­ï¼Œå†ä¸Šæ–™ï¼ åœ¨ä¸Šæ–™æ—¶ï¼Œæ’å…¥è¿›æ–™å£åä¸€æ®µè·ç¦»æ„Ÿè§‰å·²ç»æ— æ³•æ’å…¥ï¼Œä½†æ˜¯å–·å¤´ä¸‹æ–¹å¹¶æ²¡æœ‰å‡ºä¸ï¼Œå› ä¸ºåœ¨è€—æåœ¨è¿›å…¥è¿›æ–™å£åéœ€è¦ç©¿è¿‡æŒ¤å‡ºè½®å’Œå‹æ–™è½®ä¸­é—´åå†è¿›å…¥ä¸‹æ–¹å–·å˜´å¯¼æ–™ç®¡ï¼Œåœ¨ä¸Šè€—æçš„æ—¶å€™æ²¡æœ‰æŠŠè€—æå‰æ®µå‰ªå°–å’Œæ‹ç›´ï¼Œå¯¼è‡´è€—ææ’å…¥æ—¶æ²¡èƒ½ç›´æ¥è¿›å…¥ä¸‹æ–¹å¯¼æ–™å£è€Œè¢«æ—è¾¹é˜»æŒ¡ï¼Œå¦‚å›¾ï¼š æ­£ç¡®ä¸Šæ–™æ­¥éª¤ï¼šé¢„çƒ­â€”å‰ªå°–å¹¶æ‹ç›´è€—æâ€”ä¸‹å‹èºä¸â€”ç¬”ç›´æ’å…¥è€—æâ€”å‡ºä¸ æ¯æ¬¡æ‰“æ¨¡å‹å‰éƒ½éœ€è¦é¢„çƒ­å—ï¼Ÿæå‰é¢„çƒ­çš„æƒ…å†µåªæœ‰åœ¨è¿›è¡Œæ¢æ–™å‰æ‰éœ€è¦æå‰é¢„çƒ­ï¼Œæ­£å¸¸æ‰“å°æ—¶ï¼Œåªéœ€è¦é€‰æ‹©æ‰“å°çš„æ¨¡å‹æ–‡ä»¶å³å¯è‡ªåŠ¨åŠ çƒ­ï¼› æ¨¡å‹æ‰“å°è¿‡ç¨‹ä¸­åœç”µäº†èƒ½å¦ç»§ç»­æ‰“å°ï¼Ÿå¦‚æœåœç”µäº†æ¨¡å‹ç›´æ¥ç»ˆæ­¢æ‰“å°ï¼Œä¸‹æ¬¡å¼€æœºæ— æ³•å»¶ç»­æ‰“å°ï¼ˆä½†å¯ä»¥é€šè¿‡æµ‹é‡å·²æ‰“å°é«˜åº¦ï¼Œä»…å°†æœªæ‰“å°çš„éƒ¨åˆ†åˆ‡ç‰‡è¿›è¡Œæ‰“å°ï¼Œå†ç²˜ä¸Šï¼Œä»…é€‚åˆéç²¾å¯†é›¶ä»¶æ¨¡å‹ï¼‰ é‚£ä¸­é€”å¯ä»¥æš‚åœå†ç»§ç»­æ‰“å—ï¼Ÿçœ‹æœºå™¨æ˜¯å¦æœ‰è®¾è®¡æš‚åœæ‰“å°åŠŸèƒ½ åœ¨æ‰“å°æ—¶æš‚åœå–·å˜´ä¾æ—§å¤„äºåŠ çƒ­çŠ¶æ€ï¼Œè€—æå› é‡åŠ›ä½œç”¨ä¼šä¸‹å‚æµå‡ºï¼Œå½±å“æ¨¡å‹å¤–è§‚ï¼› ä¸­é€”è€—æç”¨å®Œæ€ä¹ˆåŠï¼Ÿ é¦–å…ˆæ¨¡å‹åœ¨è½¯ä»¶è¿›è¡Œåˆ‡ç‰‡è½¬æ¢æ ¼å¼çš„æ—¶å€™å°±ä¼šæ˜¾ç¤ºæ‰€éœ€æ‰“å°çš„æ—¶é—´ï¼Œè€—æé•¿åº¦ä»¥åŠé‡é‡ï¼Œé‚£éœ€è¦åˆ¤æ–­æœºå™¨ä¸Šä½™ä¸‹çš„è€—æèƒ½å¦æ”¯æŒæœ¬æ¬¡æ‰“å°å®Œæˆï¼Œé¿å…ä¸­é€”æ‰“å°è€—æç”¨å®Œï¼› è‹¥ç¢°åˆ°è€—æä¸­é€”å¿«ç”¨å®Œï¼Œè¯·åœ¨è€—æè¿˜æ²¡è¿›å…¥è¿›æ–™å£çš„æ—¶å€™åŠæ—¶çš„è¿›è¡Œæš‚åœï¼Œå¹¶è¿…é€Ÿæ‹”å‡ºå‰©ä½™è€—æï¼Œå°†æ–°çš„è€—ææ’å…¥è‡³å–‰ç®¡çš„æ·±åº¦å³å¯ æ¯æ¬¡æ‰“å®Œéœ€è¦å°†è€—æå–å‡ºæ¥åšæ’ç©ºå¤„ç†å—ï¼Ÿä¸æ˜¯ï¼Œè·ç¦»ä¸‹æ¬¡æ‰“å°è¶…è¿‡ 72 å°æ—¶ï¼Œåˆ™éœ€è¦æ’ç©ºå¤„ç†ï¼› å–·å¤´éœ€è¦å®šæœŸæ¸…ç†å—ï¼Ÿéœ€è¦ï¼ æŒ¤å‡ºå¤´åŠ çƒ­åˆ°æŒ‡å®šæ¸©åº¦åç”¨æœ€å°å·çš„å†…å…­è§’èºä¸åˆ€ï¼Œå‹ä¸‹è¿›æ–™å¼¹ç°§ï¼Œæ’å…¥è¿›æ–™å£ï¼Œå¾€ä¸‹æŒ¤å‹ï¼ŒæŒ¤å‹çš„æ—¶å€™æ‰³æ‰‹æ’æ…¢æ…¢æ’åˆ°åº•æ—¶ï¼Œæ¥å›æŒ¤å‹ä¸‰æ¬¡ï¼Œæ‰³æ‰‹å›æŠ½ä¸è¦è¿‡æ€¥æˆ–è¿‡é•¿ï¼Œæ’è¿›å»åå°å¹…åº¦çš„åœ¨é‡Œé¢æŒ¤å‹ä¸‰æ¬¡å³å¯ï¼Œå†è¿…é€Ÿæ‹”å‡ºï¼Œç©ºçƒ§ 1 åˆ†é’Ÿå·¦å³æ³¨æ„è§‚å¯Ÿä¸‹æ–¹æ˜¯å¦æœ‰ä¸œè¥¿æµå‡ºï¼Œæµå®Œæˆ–æ²¡ä¸œè¥¿æµå‡ºä¸€åˆ†é’Ÿåè¯·ç”¨é…é€çš„å°æ…é’ˆï¼Œä»ä¸‹æ–¹å–·å˜´æ’å…¥ï¼ŒæŠ½æ‹‰ä¸‰æ¬¡æ²¡ä¸œè¥¿æµå‡ºå³å¯ï¼›æœ€åä¸€æ­¥ï¼Œè¯·å¼„æ ¹æ–°è€—æï¼Œæ’å…¥åˆ°åº•å‘ä¸‹æŒ¤å‹å‡ºä¸åçŒ›çš„è¿…é€Ÿæ‹”å‡ºï¼Œå°½é‡å¸¦å‡ºå†…å£é™„ç€ç‰©å³å¯ï¼› æ¨¡å‹åˆšå¼€å§‹æ‰“å°ç¬¬ä¸€å±‚å°±ä¸å‡ºä¸ï¼Œæ€ä¹ˆå›äº‹ï¼Ÿå¦‚æœè¿™ç§æƒ…å†µå‘ç”Ÿåœ¨åˆšæ‰æœ‰æ¢è¿‡è€—æçš„æƒ…å†µä¸‹ï¼Œé‚£éœ€è¦ç¡®å®šè€—æå·²ä¸Šåˆ°åº•ï¼Œå¹¶å‡ºä¸ï¼›ç¡®ä¿å–·å˜´æ˜¯å¦é¡¶åˆ°å¹³å°ï¼Œå¯¼è‡´æ— é—´éš™ç©ºé—´åä¸ï¼› æ‰“å‡ºæ¥çš„æ¨¡å‹å¾ˆè„†ï¼Œå¤–å£åƒç½‘ä¸çŠ¶ï¼Œå¾ˆè„†ï¼Œä¸€æå°±ç˜ªäº†ï¼Ÿæ­¤æƒ…å†µå±äºå‡ºä¸é‡å¾ˆå°ï¼Œéœ€è¦æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š æ‹‰æ–™æ­£å¸¸ï¼Œæ–™ç›˜ä¸Šçš„è€—ææ²¡æœ‰æ‰“ç»“ç­‰ç¼ ä½ç°è±¡ï¼› è€—æåœ¨è¿›å…¥å¯¼æ–™ç®¡ä¸å–·å˜´ï¼ˆåŠ çƒ­ç®¡å–‰ç®¡ï¼‰ä¹‹å‰ï¼Œè¦ç©¿è¿‡ä¸€ä¸ª u å‹è½®å’ŒæŒ¤å‡ºç”µæœºé½¿è½®ä¸­é—´ï¼Œu å‹è½®å‹ä½è€—æè®©é½¿è½®æŠŠè€—æå¾€ä¸‹æŒ¤é€ï¼Œu å‹è½®å‹ä½è€—æçš„åŠ›é‡æ˜¯ç”±æ—è¾¹çš„å…­è§’èºé’‰é¡¶ç€å¼¹ç°§çš„åŠ›åº¦æ¥å†³å®šçš„ï¼Œèºä¸æ‰­ç´§å¼¹ç°§å¼¹æ€§è¶Šå¤§ï¼Œu å‹è½®å‹æ–™å°±è¶Šç´§ï¼Œåä¹‹è¶Šæ¾ï¼Œ è¿›æ–™å£æ—èºä¸å¤ªæ¾æˆ–è€…å¤ªç´§éƒ½æœ‰å¯èƒ½å¯¼è‡´è€—ææŒ¤å‡ºé€Ÿåº¦å—åˆ°å½±å“ é½¿è½®æœ¬èº«å¸¦åŠ¨è€—ææŒ¤å‹ä¹Ÿæœ‰è®¸å¤šå› ç´ ï¼Œè€—æä»ä¸Šå¾€ä¸‹ç»è¿‡é½¿è½®çš„æ—¶å€™æ˜¯å¦æœ‰åœ¨é½¿è½®çš„ä¸­é—´ï¼Œå¦‚æœé½¿è½®è„±ä½ï¼Œè€—æåœ¨é½¿è½®çš„ç‰™è¾¹ä¸‹å»çš„ï¼Œå¯èƒ½å‡ºç°å¸¦ä¸åŠ¨è€—æå¾€ä¸‹çš„æƒ…å†µè€Œå‡ºä¸ä¸é¡º æ¨¡å‹æ‰“å°æ—¶ï¼Œçªç„¶åœ¨æŸä¸€å±‚é«˜å¤„æ•´ä½“å‘ Xï¼ˆå·¦å³ï¼‰Yï¼ˆå‰åï¼‰æ–¹å‘åç§»ï¼Ÿé¦–å…ˆéœ€è¦ç¡®å®šæœºå™¨ä¼ åŠ¨ç³»ç»Ÿé—®é¢˜ï¼Œå†æ¥æ’é™¤è½¯ä»¶å‚æ•°å’Œä¸»æ¿å›ºä»¶é—®é¢˜ï¼Œæ’é™¤æ–¹æ³•å¦‚ä¸‹ï¼š é¦–å…ˆéœ€è¦åˆ¤æ–­çš„æ¨¡å‹æ‘†æ”¾åœ¨å¹³å°ä¸Šæ—¶ï¼Œåç§»çš„æ–¹å‘æ˜¯ xï¼ˆæ¨ªå‘ï¼‰è¿˜æ˜¯ yï¼ˆçºµå‘ï¼‰ï¼Œç„¶åéœ€è¦æ£€æŸ¥å¯¹åº”çš„ xy è½´çš„ä¼ åŠ¨ç³»ç»Ÿæ˜¯å¦æ­£å¸¸ï¼Œç¬¬ä¸€å…ˆæ£€æŸ¥çš®å¸¦æ˜¯å¦æ¾åŠ¨è„±è½ï¼›ç¬¬äºŒæ£€æŸ¥åŒæ­¥è½®å›ºå®šèºä¸æ˜¯å¦æ¾åŠ¨ â‘  å¸¦æ¾åŠ¨åŠ ç´§ï¼š é¦–å…ˆï¼Œå¦‚æœæ˜¯ X è½´çš®å¸¦æ¾åŠ¨ï¼Œå¿…é¡»æ‹‰ç´§è‡³ç»·ç´§çŠ¶æ€ï¼Œåˆ‡å¹³è¡Œï¼› â‘¡åŒæ­¥è½®æ¾åŠ¨ï¼šY è½´ä¼ åŠ¨ç³»ç»ŸåŒæ­¥è½®å’Œ X è½´åŒæ­¥è½®éƒ½éœ€è¦æ£€æŸ¥åˆ°ï¼› æ’é™¤å®Œæœºå™¨é—®é¢˜ï¼Œå»ºè®®çœ‹ä¸‹è½¯ä»¶å‚æ•°æ˜¯å¦å­˜åœ¨é—®é¢˜ ä¾‹å¦‚æ£€æŸ¥æ˜¯å¦æ˜¯ç”µæœºè¿åŠ¨é€Ÿåº¦è¿‡å¿«æˆ–å‡ºç°é˜»ç¢å¯¼è‡´çš„ä¸¢æ­¥ ä»¥ä¸Šä¸¤ç‚¹æ’é™¤å®Œæ¯•ï¼Œéœ€è¦å¯¹ä¸»æ¿å›ºä»¶ç¨‹åºè¿›è¡Œé‡æ–°çƒ§å½•æ¥è§£å†³é—®é¢˜ æ‰“å°æ¨¡å‹è¿‡ç¨‹ä¸­ä¸­é—´æ–­äº†å‡ å±‚ï¼Œä½†æ˜¯ä¸Šé¢æ‰“å°è¿˜å¯ä»¥ï¼Ÿä¸ºä»€ä¹ˆæ¨¡å‹çªç„¶ä¸­é€”å°±ä¸å‡ºä¸ï¼Œå–·å˜´ä¸€ç›´åœ¨ç©ºèµ°æ‰“å°ä¸å‡ºä¸ï¼Ÿè¿™å‡ ç§é—®é¢˜éƒ½å±äºå‰æœŸèƒ½æ­£å¸¸æ‰“ï¼Œä½†æ˜¯ä¸­é€”ä¸å‡ºä¸çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µéœ€è¦ä»ä»¥ä¸‹å‡ ç‚¹åˆ¤æ–­ï¼š æŒ¤å‡ºç”µæœºæ¥çº¿å£å¤„å››é’ˆæ’çº¿æ¾åŠ¨ï¼Œå¯¼è‡´ç”µæœºæŒ¤å‡ºé½¿è½®æ¥å›æ­£åè½¬ï¼Œè€—æé€ä¸ä¸‹å»ï¼› æ‰“å°ä¸å‡ºä¸æ—¶ï¼Œå¯ä»¥ä»ç”µæœºå³ä¾§æ–¹å¼¹ç°§æ–¹å‘å¾€é‡Œé¢çœ‹åˆ°é½¿è½®è½¬åˆ°æƒ…å†µï¼Œå¦‚æœé½¿è½®æ¥å›æ‘†åŠ¨ä¸å®šï¼Œè¯´æ˜æ¥çº¿å‡ºæœ‰é—®é¢˜ï¼Œå°†æ¥çº¿æ‹”æ‰é‡æ–°æ’å…¥å°è¯•å³å¯ï¼› è¿›æ–™å£æ—èºä¸å¤ªæ¾æˆ–è€…å¤ªç´§éƒ½æœ‰å¯èƒ½å¯¼è‡´è€—ææŒ¤å‡ºé€Ÿåº¦å—åˆ°å½±å“ è€—æåœ¨æ–™ç›˜ä¸Šç¼ ä½ï¼Œå¯¼è‡´è¿›æ–™ä¸é¡º,æ£€æŸ¥æ–™ç›˜çš„è€—æç¼ ç»•æ˜¯å¦æœ‰æ‹‰æ‰¯ä½ å–·å˜´å¯èƒ½æœ‰æ®‹æ–™å µå¡,å¯ä»¥æŠŠå–·å¤´é¦–å…ˆé¢„çƒ­ 230ï¼Œä¸€æ‰‹æŒ‰ä½è¿›æ–™å£æ—èºä¸ï¼Œä¸€æ‰‹å¿«é€ŸæŒ¤å‹è€—æï¼ˆå¤šé€ç‚¹ä¸ï¼‰ï¼Œå†è¿…é€Ÿæ‹”å‡ºï¼Œç„¶åè®©å–·å˜´ç©ºçƒ§ä¸€ä¼šå„¿ï¼Œç›´åˆ°æœ‰é»‘è‰²ç‰©è´¨ä»å–·å˜´é‡Œæµå‡ºï¼Œç„¶åç”¨é’¢ä¸ä»å–·å˜´ç«¯æ’å…¥ï¼ŒæŠ½æ‹‰ï¼Œæ‹”å‡ºï¼Œè®©é‡Œé¢å‰©ä½™çš„è€—ææ‰å‡ºï¼Œé‡å¤æŠ½æ‹‰åŠ¨ä½œï¼Œç›´åˆ°å–·å˜´æ²¡æ–™è‡ªç„¶æµå‡ºä¸ºæ­¢ï¼Œæœ€åä¸Šæ–™ï¼Œé‡æ–°æ‰“å°ï¼› ä¸ºä»€ä¹ˆæ‰“å°æ¨¡å‹åœ¨ä¸­é€”è¿‡ç¨‹ä¸­ï¼Œå–·å˜´å‘¨è¾¹ç¼ ç€å¾ˆå¤šè€—æï¼Œæ¨¡å‹å˜æˆä¸€å›¢ä¹±ä¸ï¼Œä¸æˆå½¢ï¼Ÿè¿™ç§æƒ…å†µåˆ†ä¸¤ç§ï¼š åˆšå¼€å§‹æ‰“å°é˜¶æ®µï¼Œæ­¤æƒ…å†µä¸€èˆ¬æ˜¯å–·å˜´å’Œå¹³å°ä¹‹é—´çš„è·ç¦»è¿‡è¿œï¼Œå–·å˜´å‡ºä¸æ— æ³•ç²˜ä½å¹³å°ï¼Œå°±ä¼šè¢«å–·å˜´å¸¦èµ°å¹¶ä¸€ç›´å‡ºä¸å½¢æˆä¸€å¨ï¼› æ‰“å°è¿‡ç¨‹ä¸­å‡ºä¸ä¸å‡åŒ€ï¼Œæœ‰æ–­å±‚ç°è±¡ï¼Œæ‰“å°æ¨¡å‹æ¯”å®é™…é«˜åº¦ä½ï¼Œè¶…è¿‡ä¸€å®šé—´éš™è·ç¦»åå‡ºæ–™æ­£å¸¸æ˜¯æ²¡é™„ç€ä¸‹é¢çš„æ¨¡å‹ä¸Šé¢å°±ä¼šç¼ æˆä¸€å¨ï¼› æ‰“å°è¿‡ç¨‹ä¸­å–·å˜´çªç„¶åœæ­¢åœ¨æ‰“å°æ¨¡å‹ä¸Šæ–¹ä¸æ‰“å°ï¼Œå¹¶æœªå›åŸç‚¹ï¼Œæ€ä¹ˆå›äº‹ï¼Ÿ åˆ‡ç‰‡é—®é¢˜,é‡æ–°åˆ‡ç‰‡æ‰“å°æµ‹è¯• å†…å­˜å¡æ¾åŠè¯»å–é—®é¢˜ ä¸»æ¿å›ºä»¶é—®é¢˜ ä¸ºä»€ä¹ˆæŠŠæ¨¡å‹ä¿å­˜åœ¨å¡é‡Œæ˜¯æ˜¾ç¤º okï¼Œä½†æ’å…¥æœºå™¨åé€‰æ‹©æ¨¡å‹æ‰“å°åä¸åŠ çƒ­ä¹Ÿæ²¡ååº”ï¼Ÿä¸ºä»€ä¹ˆ SD å¡åœ¨ç”µè„‘è¯»å–æ­£å¸¸æ”¾å…¥æœºå™¨ç¼ºæ˜¾ç¤ºæ— å¡ï¼Ÿä¸€èˆ¬ç”±äºä¿å­˜æ–‡ä»¶æ—¶çš„æ–‡ä»¶åä¸Šï¼Œåˆ‡ç‰‡å®Œæˆåè¿›è¡Œä¿å­˜æ—¶æ–‡ä»¶åè¯·ä½¿ç”¨è‹±æ–‡å­—æ¯æˆ–æ•°å­—. ä¸ºä»€ä¹ˆ SD å¡åœ¨ç”µè„‘è¯»å–æ­£å¸¸æ”¾å…¥æœºå™¨ç¼ºæ˜¾ç¤ºæ— å¡ï¼Ÿè¿™ç§é—®é¢˜é¦–å…ˆè¦æ’é™¤å¡å’Œå¡æ§½æ˜¯å¦æ­£å¸¸é…åˆï¼Œä¿è¯å¡å’Œå¡æ§½è¯»å–æ­£å¸¸ï¼Œå¦‚æœé‡æ–°æ’å…¥è¿˜æ˜¯æ— æ³•è¯»å–ï¼Œå¯ç”¨èº«è¾¹çš„å†…å­˜å¡ä¿å­˜æ–‡ä»¶æ’å…¥æœºå™¨æ˜¯å¦èƒ½æ­£å¸¸è¯»å– ä¸ºä»€ä¹ˆé€‰æ‹©æ¨¡å‹æ‰“å°ï¼Œæœºå™¨æ²¡ä»»ä½•ååº”ï¼Ÿæˆ–è€…åŠ çƒ­äº†å¾ˆä¹…ä½†æ˜¯ä¸æ‰“å°ï¼Ÿè¿™ç§æƒ…å†µå¯èƒ½å–·å˜´å†·å´é£æ‰‡æå‰å¼€å¯ï¼Œå¯¼è‡´å®é™…æ¸©åº¦å’Œè®¾ç½®æ¸©åº¦æ€»æœ‰ 1-2 åº¦å·®è·ï¼Œå¯¼è‡´æ— æ³•æ‰“å°ï¼Œè¯·é€‰æ‹©åœæ­¢æ‰“å°å¹¶å…³æ‰é£æ‰‡å¼€å…³åï¼Œé‡æ–°é€‰æ‹©æ‰“å°æ¨¡å‹å³å¯ï¼› å®½åº¦ 5mm é«˜åº¦ 6mm çš„å­—ä½“æ‰“å¾—å‡ºæ¥ä¸,ç±»ä¼¼è¿™ç§å°æ¨¡å‹éœ€è¦ä¿®æ”¹å“ªäº›å‚æ•°å‘¢ï¼Ÿå°æ¨¡å‹æ‰“å°éœ€è¦å°†é€Ÿåº¦å’ŒæŒ¤å‡ºé‡é™ä½ï¼Œæ¨¡å‹å¯ä»¥æ‰“å¾—æ›´å¥½çœ‹ã€‚æ¯”å¦‚æ‰“ 5mm å·¦å³çš„å­—ä½“ï¼Œå¯ä»¥é‡‡ç”¨ 22 å·¦å³çš„é€Ÿåº¦é…åˆ 85 çš„æŒ¤å‡ºé‡æ¥è¿›è¡Œåˆ‡ç‰‡æ‰“å°ï¼Œæ¸©åº¦é‡‡ç”¨ 190 å·¦å³çš„å³æº¶æ¸©åº¦å³å¯ï¼Œè¿™é€‚åˆå°æ¨¡å‹æ‰“å°å“¦ï¼› ä¸ºä»€ä¹ˆåœ¨æ‰“å°æ¨¡å‹æ—¶ï¼ŒæŸä¸ªä½ç½®ä¼šå‰§çƒˆæŒ¯åŠ¨ï¼Œæœºå™¨å£°éŸ³å¾ˆå¤§ï¼Ÿè¿™ç§ä½ç½®ä¸€èˆ¬æ˜¯æ¨¡å‹å®ä½“éƒ¨åˆ†çš„å¡«å……ï¼Œç‰¹åˆ«æ˜¯äº¤çª„çš„å£åšï¼Œå¡«å……ä¸ºæ³¢æµªå½¢ï¼Œæ‰“å°é€Ÿåº¦å¾ˆå¿«çš„æ—¶å€™ xy é…åˆäº§ç”Ÿå…±æŒ¯å¼•èµ·çš„ ä¸ºä»€ä¹ˆåœ¨æ‰“å°å¾ˆå¤§æ¨¡å‹ä¾‹å¦‚ 190*190*180 å’Œå¹³å°å°ºå¯¸ç›¸è¿‘çš„æ¨¡å‹æ—¶ï¼Œå–·å¤´ç§»åŠ¨åˆ°æŸä¸ªæ–¹å‘æé™å€¼æ—¶ï¼Œä¼šæœ‰æŒ¯åŠ¨ç„¶åå†æ”¹æ–¹å‘è¿›è¡Œç§»åŠ¨å‘¢ï¼Ÿæ‰“å°å‰ï¼Œå–·å˜´ä¼šåœ¨æ¨¡å‹å‘¨å›´æ‰“ä¸€åœˆè¿›è¡Œæ’ç©ºå‡ºæ–™çš„æ“ä½œï¼Œè¿™æ ·çš„è¯å°±å®é™…å¢åŠ äº†å¤§æ¨¡å‹çš„æˆå‹ç©ºé—´ï¼Œå¯¼è‡´ç›´æ¥ç¢°åˆ°æœºç®±ï¼Œå¯ä»¥æŠŠæ­¤è®¾ç½®å…³æ‰å³å¯ æŸ¥çœ‹åˆ‡ç‰‡æ—¶æ˜¯å¦æœ‰è£™è¾¹è®¾ç½® æ‰“å°æ¨¡å‹ç»å¸¸ç¿˜è¾¹é—®é¢˜æ€ä¹ˆè§£å†³ï¼ŸPLA ä¸ ABS é€šç”¨åŸå› ï¼š å–·å˜´è·ç¦»ä¸å¹³å°å¤ªè¿œï¼Œæ²¡èƒ½å……åˆ†è´´ç´§å¹³å° æ¨¡å‹ä¸çƒ­åºŠæ¥è§¦é¢ç§¯å¤ªå°ï¼Œå¯¼è‡´é™„ç€åŠ›ä¸å¤Ÿ è§£å†³åŠæ³•ï¼šå¯å¢åŠ  brim æˆ–è€… raft å«å­ ï¼›æ‰“å° ABS çš„è¯ Brim æ•ˆæœæ›´ç†æƒ³ï¼› æ‰“å° ABS æ—¶å¼€äº†æ•£çƒ­é£æ‰‡ã€‚ è§£å†³åŠæ³•ï¼šåœ¨æ‰“å°æ˜¯è¿›å…¥ä¸»ç•Œé¢çš„æ§åˆ¶ â€“ æ¸©åº¦ â€“ é£æ‰‡é€Ÿåº¦ Bed ä¸­ç”±æœ€é«˜è½¬é€Ÿ 255 æ”¹æˆ 100 å‡å°‘å†·å´æ•ˆæœï¼Œç›´æ¥å…³é—­é£æ‰‡å¼€å…³æ•ˆæœæ›´ç†æƒ³ï¼› - æŒ¤å‡ºå¤´æˆ–çƒ­åºŠæ¸©åº¦ä¸åˆé€‚ï¼ŒæŒ¤å‡ºå¤´æ¸©åº¦ä¸å¤Ÿå¯èƒ½å¯¼è‡´æŒ¤å‡ºçš„ææ–™æµåŠ¨æ€§ä¸å¤Ÿï¼Œæ— æ³•å®Œç¾çš„å¹³é“ºåœ¨çƒ­åºŠä¸Šï¼Œå½±å“å…¶ç²˜æ»åŠ›ã€‚çƒ­åºŠæ¸©åº¦è¿‡é«˜ä¹Ÿå¯èƒ½å¯¼è‡´ç¿˜è¾¹ï¼ŒåŸå› æ˜¯ææ–™å—çƒ­æµåŠ¨æ€§å˜å¤§ï¼Œä¸èƒ½ç¨³å›ºé»åœ¨çƒ­åºŠä¸Šã€‚ - çƒ­åºŠè¡¨é¢ä¸å¹²å‡€ã€‚æ‰‹çš„æ±—ä¸æ²¹ç²˜åœ¨èƒ¶å¸¦ä¸Šï¼Œè¡¨é¢ä¸Šçœ‹ä¸è§ï¼Œä½†ä¹Ÿå¯¼è‡´è¡¨é¢æ‰“æ»‘ï¼Œå½±å“é»é™„æ•ˆæœã€‚è¿™ç§æƒ…å†µåœ¨æ¹¿åº¦å¤§çš„å—æ–¹æ¯”è¾ƒå¸¸è§ã€‚ ABS ææ–™å¾ˆç‰¹æ®Šå› ä¸ºå®ƒæœ‰ä¸€å®šçš„æ”¶ç¼©ç‡ï¼Œæ‰“å°è¾ƒå¤§çš„ç‰©ä½“æ—¶ï¼Œæ•ˆæœæ›´ä½³æ˜æ˜¾ï¼Œæ•´ä½“æ”¶ç¼©å¯¼è‡´åº•é¢ç¿˜èµ·ã€‚æœ€å¥½èƒ½é…åˆæ´æ´æ¿ã€‚ æ˜¾ç¤ºå±ä¸‹æ–¹æ˜¾ç¤º Err æŠ¥é”™ï¼ŒæŒ¤å‡ºå¤´çƒ­åºŠæ¸©åº¦æ¸©åº¦æ˜¾ç¤ºä¸æ­£å¸¸ï¼Ÿå–·å¤´ä¸Šçƒ­æ•ç”µé˜»çš„æ¥è§¦ä¸è‰¯æˆ–è€…æŸåäº† æ‹†ä¸‹çƒ­æ•ç”µé˜»ï¼Œè‹¥æ˜¯æ¥è§¦ä¸è‰¯ï¼Œåˆ™é‡æ–°æ‹”æ’æ¥å¥½ï¼›è‹¥æ˜¯çº¿çš„ç„Šç‚¹è„±è½ï¼Œç”¨ç”µçƒ™é“ç„Šå¥½å¦åˆ™æ˜“æŸåç”µé˜»ï¼›è‹¥æ˜¯æŸåï¼Œåˆ™æ›´æ¢æ–°çš„çƒ­æ•ç”µé˜»ã€‚æ³¨ï¼šå›ºå®šçº¿æ—¶èºä¸ä¸å®œæ‹§è¿‡ç´§ è¿™ä¸ªé»‘è‰²èºä¸æ‹§æ¾ï¼Œçƒ­æ•ç”µé˜»å–å‡ºæ¥ï¼ŒåŒæ—¶çƒ­æ•ç”µé˜»çº¿ä¹Ÿä»ä¸»æ¿ä¸Šæ‹”ä¸‹æ¥ï¼Œç”¨ä¸‡ç”¨è¡¨æµ‹ä¸€ä¸‹é˜»å€¼ï¼Œ80-100K æ­£å¸¸ æ‰“å®Œç¬¬ä¸€å±‚ï¼Œæ‰“å°å¤´åœ¨å·¦è¾¹ï¼Œè¦æ‰“ä¸Šé¢ä¸€å±‚çš„æ—¶å€™ï¼Œæ‰“å°å¤´ä¸æ˜¯è¦å›åˆ°å³è¾¹çš„å—ï¼Œå›å»çš„æ—¶å€™å°±ä¼šåˆ®åœ¨ä¹‹å‰æ‰“å°çš„ç¬¬ä¸€å±‚ä¸Šå¹¶ç•™ä¸‹ä¸€æ¡çº¿å‘¢ï¼Ÿé‚£æ˜¯è·ç¦»å¹³å°è¿‡è¿‘ï¼Œä¼šåˆ®åˆ°ä¸Šä¸€å±‚æ‰“å°çš„è€—æ å¹³å°è·ç¦»å–·å˜´è¿‘æœ‰åˆ©äºç²˜ä½å¹³å°ï¼Œä¸ä¼šç¿˜è¾¹; ä¼šè½»å¾®åˆ®åˆ°ä¸Šä¸€å±‚æ‰“å°æ¨¡å‹ï¼Œä½†ä¸å½±å“æ¨¡å‹æˆå‹è¿‡ç¨‹ï¼Œæœ€å¤šæŒ‚ç‚¹æ–™åœ¨å–·å˜´ä¸ŠæŒ‚ç€ï¼Œç„¶ååœ¨æ‰ä¸‹æ¥ æ¨¡å‹å¹³é¢ä¸Šå­—ä½“æ‰“å‡ºæ¥æ•ˆæœä¸å¥½æ€ä¹ˆåŠï¼Ÿå¦‚æœå­—å†™åœ¨æ¨¡å‹ä¸Šï¼Œæ­¤æƒ…å†µå¯ä»¥å°†æ¨¡å‹ç«–èµ·æ¥æ‰“ï¼Œå±‚åš 0.1 èƒ½æ›´ä¸ºç»†è…»çš„æ‰“å‡ºå­—ä½“ï¼› ä¸ºä»€ä¹ˆä»ç»˜å›¾è½¯ä»¶é‡Œå¯¼å‡ºæ¥çš„æ¨¡å‹æ”¾åœ¨ cura é‡Œæ˜¾ç¤ºä¸è§„æ•´ï¼Œå¼§é¢éƒ½æ˜¯æ£±é¢ç»„æˆçš„ï¼Ÿåœ¨ç»˜å›¾è½¯ä»¶é‡Œå¯¼å‡º stl çš„æ—¶å€™ä¼šæœ‰äºŒè¿›åˆ¶å’Œ ASCâ…¡ï¼Œé€šå¸¸é€‰æ‹©äºŒè¿›åˆ¶å¹¶å°†è§’åº¦å’Œå¼¦å€¼è®¾ç½®é»˜è®¤æœ€å°å€¼ï¼Œä½†åœ¨ maya ç­‰ä¸€äº›è½¯ä»¶é‡Œï¼Œæ–‡ä»¶å¯¼å‡ºçš„æ—¶å€™ stl æ ¼å¼æ˜¯é»˜è®¤è®¾ç½®çš„ï¼Œè¿™æ˜¯è½¯ä»¶çš„ç‰¹æ€§ï¼Œä½†æ˜¯è¿™ä¸ªé»˜è®¤æ•°å€¼ä¼šéšç€æ–‡ä»¶çš„å»ºæ¨¡æ—¶çš„ç½‘æ ¼ç»†è…»ç¨‹åº¦å¢åŠ ï¼Œä¹Ÿå°±æ˜¯è¯´æ–‡ä»¶å¹³æ»‘åŸæœ¬æ˜¯ä¸€å€çš„ï¼Œç°åœ¨åŠ åˆ°ä¸‰å€å¯¼å‡ºæ¥çš„ STL å°±ä¼šæ¯”ä¸€å€çš„ç»†è…»å¾ˆå¤š è°ƒè¯•æœºå™¨æ—¶é€‰æ‹©è‡ªåŠ¨ä¸å‡ºæ¥éƒ½ä¸æ˜¯ç›´çš„ï¼Œæ˜¯å¼¯æ›²çš„?å¦‚æœå‡ºä¸æ˜¯å¼¯æ›²çš„ æŒ¤å‡ºé‡æœ‰å…³ï¼›æŒ¤å‡ºé‡ä¸€èˆ¬ç”±æ¸©åº¦ä»¥åŠè¿›æ–™å£æ—è¾¹çš„èºä¸æ¾ç´§åº¦æœ‰å…³ï¼Œéœ€è¦æ£€æŸ¥è¿›æ–™å£æ—è¾¹çš„èºä¸ æ¸©åº¦åŸå› ï¼Œ1.é£æ‰‡å¹çš„ 2.æ¸©åº¦å¯ä»¥é€‚å½“åŠ é«˜åˆ° 200 åº¦å·¦å³ æ¸©åº¦æ€»æ˜¯ä¸Šä¸å»æˆ–è€…ä¸ç¨³å®šï¼Ÿ æŒ¤å‡ºå¤´çš„çƒ­æ•æ„Ÿåº”ä»¶æ²¡å›ºå®šå¥½åœ¨é“å—é‡Œï¼Œæ‰“å°çš„æ—¶å€™æ˜“æ¾ï¼Œå¯¼è‡´æ¢æ¸©ä¸å‡†ï¼› å¯¼é£å˜´å†·å´é£æ‰‡çš„é£æ˜¯å¹åˆ°å–·å˜´ä¸‹æ–¹çš„æ¨¡å‹ï¼Œå¦‚æœæ²¡æœ‰è°ƒå¥½å°±ä¼šå¹åˆ° å–·å˜´ï¼Œå¯¼è‡´æ¸©åº¦ä¸‹é™ï¼› å¦‚æœå‡ºç°ä»¥ä¸‹æƒ…å†µæ˜¯æ€ä¹ˆå¯¼è‡´ï¼Ÿ æŒ¤å‡ºé½¿è½®åº•éƒ¨ç¼ æ–™ï¼Œä¸€èˆ¬æ˜¯ç”±æ­¤éƒ¨ä½æ¸©åº¦è¿‡é«˜å¼•èµ·è€—æå˜è½¯ï¼Œé€ä¸è¿‡ç¨‹ä¸­å¯¼è‡´é½¿è½®ä¸‹éƒ¨è€—ææŠ˜æ–­è€Œç¼ ä½ï¼› é‡åˆ°æ­¤æƒ…å†µé¦–å…ˆéœ€æ£€æŸ¥ç”µæœºå‰æ–¹çš„æ–¹å½¢å†·å´é£æ‰‡æ˜¯å¦å·¥ä½œä»¥åŠå¶ç‰‡æ˜¯å¦å®Œæ•´ï¼Œé¿å…å†·å´ä¸å¤Ÿè€Œå¯¼è‡´å µæ–™ï¼› è¯·æ£€æŸ¥è€—ææ˜¯å¦é•¿æ—¶é—´æœªå¯†å°ä¿å­˜è€Œå˜è„†ï¼Œå–ä¸€æ®µä»ä¸­é—´è¿™æ®µï¼Œè‹¥æŠ˜åæ˜¾ç™½ç—•ä¸”æœ‰éŸ§æ€§å³æ­£å¸¸ï¼Œè‹¥æŠ˜åç›´æ¥å•ªçš„åº”å£°è€Œæ–­å³å·²å˜è„†ï¼› X è½´æ¶æ„åœ¨ Z è½´ç”µæœºä¸æ†æ§åˆ¶ä¸Šä¸‹è¿‡ç¨‹ä¸­ï¼Œä¼šå¯¼è‡´ä¸€è¾¹é«˜ä¸€è¾¹ä½ï¼Œæ¯æ¬¡éƒ½éœ€è¦é‡æ–°è°ƒèŠ‚å¹³å°é«˜åº¦å‘¢ï¼Ÿ x è½´æœ¬èº«æ²¡æœ‰å¹³è¡¡ï¼Œåœ¨ç§»åŠ¨è¿‡ç¨‹ä¸­ååº”æ›´æ˜æ˜¾ï¼› è¯·è§£å†³ X è½´è°ƒå¹³é—®é¢˜ï¼› é»„è‰² T å‹èºæ¯å¤ªç´§ï¼Œå¯¼è‡´ T å‹èºæ¯ä¸ä¸æ†ç´§é…å—åŠ›ä¸å‡åŒ€ï¼Œç§»åŠ¨ä¸é¡ºç•…ï¼› å°†å›ºå®š T å‹èºæ¯ä¸Šçš„èºä¸ä¸è¦æ‹§ç´§ï¼Œç•™åŠä¸ªèºçº¹çš„ç¼éš™ï¼Œç»™äºˆç¼“å†²ï¼Œå†å°† x è½´è°ƒè‡³å¹³è¡¡ï¼Œç§»åŠ¨ z è½´ç”µæœºè°ƒè¯•ï¼ x è½´å…‰æ†å¤ªé•¿ï¼Œæ²¡æœ‰å®Œå…¨æ…åˆ°åº•å»ï¼Œé¡¶ä½ä¸æ†ï¼Œå¯¼è‡´ç§»åŠ¨ä¸é¡º æ£€æŸ¥å…‰æ†æ’å…¥æ·±åº¦ï¼› å°† Z è½´ä¸¤è¾¹çš„ä¸¤ä¸ªå…‰æ†å»æ‰ï¼Œæ§åˆ¶ç”µæœºä¸Šå‡æ˜¯å¦æ­£å¸¸ï¼Œæ’é™¤å…‰æ†å¼¯æ›²é…åˆæ»‘åŠ¨è½´æ‰¿é…åˆä¸é¡ºé—®é¢˜ï¼ˆå¯ä»¥å•ç‹¬å°†å…‰æ†æ’å…¥æ»‘åŠ¨è½´æ‰¿ï¼Œä¸Šä¸‹ç§»åŠ¨æ˜¯å¦é¡ºæ»‘ï¼‰ æ›´æ¢å…‰æ†æˆ–è€…æ»‘åŠ¨è½´æ‰¿ ä»¥ä¸Šé—®é¢˜éƒ½æ£€æŸ¥åå°±å¯èƒ½: ç§»åŠ¨ä¸é¡ºç•…çš„ä¸æ†éƒ¨åˆ†å¼¯æ›²æˆ–è€…èºçº¹æŸä¼¤ï¼Œæ›´æ¢ä¸æ† åœ¨æ›´æ–°å›ºä»¶åï¼ŒæŒ¤å‡ºç”µæœºé½¿è½®æ£€æµ‹å‡ºåè½¬ï¼Œæ— æ³•æ­£å¸¸ä¸‹æ–™ å›ºä»¶ä¸­ç”µæœºå¼•è„šé…ç½®åäº† æ‹”å‡ºæŒ¤å‡ºç”µæœºåç«¯ç”µæœºçº¿æ¥å£ï¼ŒæŒ‰ç…§ç°åœ¨æ­£å¸¸ 1234 çº¿åºï¼ŒæŠŠå…¶ä¸­â€˜ä¸€ç»„â€™12 å¯¹è°ƒæˆ–è€… 34 å¯¹æ‰å³å¯ å¦‚æœæ¨¡å‹æ‘†æ”¾åœ¨è½¯ä»¶é‡Œä¸ºä¸­å¿ƒç‚¹ï¼Œä½†åœ¨å®é™…æ‰“å°è¿‡ç¨‹ä¸­å¹¶ä¸åœ¨å¹³å°ä¸­é—´ï¼›å› ä¸ºæœºå™¨å–·å˜´å›åŸç‚¹çš„æ—¶å€™å¹¶ä¸åœ¨çƒ­åºŠå¹³å°ä¸Šæ–¹è€Œæ˜¯åœ¨å¤–é¢ï¼Œè€Œ cura è½¯ä»¶çš„æœºå™¨è®¾ç½®é‡ŒåŸç‚¹å°±åœ¨å¹³å°æŸä¸ªè§’çš„æ­£ä¸Šæ–¹ï¼Œä¸ºäº†è¡¥å¿åŸç‚¹æ‰€åœ¨è¯¯å·®ï¼Œéœ€è¦å°†è½¯ä»¶çš„å¹³å°è®¾ç½®æ‰©å¤§ï¼Œæ‰èƒ½è®©æ¨¡å‹æ‰“å°åœ¨æ­£ä¸­é—´ï¼Œå¦‚å›¾æ“ä½œæ›´æ”¹å³å¯ï¼š åŠ çƒ­åæ‹”æ–™æ„Ÿè§‰æ‰¯ä¸å‡ºæ¥ï¼Œä¹Ÿæ— æ³•ä¸‹å‹äº†é“å—èåŒ–å¤„å‰©ä½™è€—æå£å¾„è¾ƒå¤§ï¼ŒåŠ çƒ­åç›´æ¥ä¸Šæ‹‰è€—æï¼Œæ˜“å µåœ¨å£å¾„è¾ƒå°çš„å–‰ç®¡å¤„ï¼Œå¹¶è¿…é€Ÿå†·å´ï¼Œä»¥è‡³å µå¡å–‰ç®¡ é¢„çƒ­è¾¾åˆ°æ¸©åº¦åï¼Œä¸€åªæ‰‹æŒ‰ä½è¿›æ–™å£æ—è¾¹çš„èºä¸ï¼Œå¦ä¸€åªæ‰‹å°†è€—æå¾€ä¸‹æŒ¤å‹ï¼Œè®©å‰ç«¯è€—ææŒ¤å‡ºä¸€æ®µè·ç¦»åï¼Œå†è¿…é€Ÿæ‹”å‡ºè€—æå³å¯é¿å…å µå¡å–‰ç®¡ é€‰æ‹©è‡ªåŠ¨å›åŸç‚¹æ—¶ï¼Œå½“å–·å¤´ç§»åŠ¨è‡³é™ä½å¼€å…³çš„æ—¶å€™ï¼Œç”µæœºä¸€ç›´ä¸åœçš„å¾€å‰èµ°ï¼Œæ’å‡»é™ä½å¼€å…³å¹¶æŠ–åŠ¨ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ éœ€è¦æ£€æŸ¥åœ¨éƒ¨ä»¶å›åŸç‚¹è§¦ç¢°åˆ°é™ä½å¼€å…³ä¹‹å‰æ˜¯å¦æœ‰ä¸œè¥¿æŒ¡ä½å®ƒå‰è¿›æ‰æ— æ³•è§¦ç¢°åˆ°é™ä½å¼€å…³è€Œä¸åœæ­¢è¿åŠ¨ï¼› - å¯èƒ½æ˜¯é™ä½å¼€å…³åäº†å¯¼è‡´çš„ï¼Œæ£€æŸ¥æ–¹æ³•æ˜¯å°†æ¯ä¸ªè½´çš„ç§»åŠ¨éƒ¨ä»¶ç§»è‡³è½´ä¸­éƒ¨ï¼Œé€‰æ‹©è‡ªåŠ¨å›åŸç‚¹ï¼Œåœ¨éƒ¨ä»¶å‘åŸç‚¹é™ä½å¼€å…³ç§»åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œè¯·æŒ‰ä½é™ä½å¼€å…³ï¼Œè§‚å¯Ÿéƒ¨ä»¶æ˜¯å¦åœæ­¢ç§»åŠ¨ï¼Œå¦‚æœæ²¡æœ‰åœæ­¢ï¼Œè¯·é©¬ä¸Šåˆ‡æ–­ç”µæºï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç¡®å®šé™ä½å¼€å…³é—®é¢˜ ä¸ºä»€ä¹ˆ X è½´ä¸Šçš„å–·å¤´åœ¨ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œä¸€é¡¿ä¸€é¡¿çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨å›åŸç‚¹çš„æ—¶å€™ï¼Œç§»åŠ¨æ—¶å‡ ä¹åœ¨æŠ–åŠ¨å¾ˆä¸é¡ºç•…ï¼Ÿ æ’é™¤ä¸‹ç”µæœºçº¿ä¸ç”µæœºçš„é—®é¢˜ï¼šæ‹†å¸åº•æ¿ï¼šéœ€è¦ç”¨ä¸‡ç”¨è¡¨æ£€æŸ¥ x è½´å››æ ¹ç”µæœºçº¿æ˜¯å¦éƒ½æ˜¯é€šè·¯ï¼Œå¦‚æœæ­£å¸¸å°±æ˜¯ç”µæœºæœ¬èº«é—®é¢˜ï¼› å¯ä»¥æ–­ç”µåæ‰‹åŠ¨è¿åŠ¨ä¸‹æŒ¤å‡ºå¤´ï¼Œæ˜¯å¦ä¸æ†æˆ–æ»‘å—ä¸­çš„é’¢ç ç”Ÿé”ˆå¯¼è‡´è¿åŠ¨ä¸æµç•… è¶…å‡ºæ‰“å°èŒƒå›´å®‰è£…è½¯ä»¶çš„æ—¶å€™åˆå§‹è®¾ç½®é€‰æ‹©é”™è¯¯æœºå‹å¯¼è‡´çš„ï¼Œé‡æ–°è®¾ç½®æœºå‹å³å¯ ä¸ç²˜åºŠï¼Œæ‰¾å¹³ è‡ªåŠ¨æ‰¾å¹³åï¼Œä½†æœ‰çš„æ—¶å€™æ‰“å°å‡ºæ¥çš„ç¬¬ä¸€å±‚è¿˜æ˜¯å’ŒåºŠç²˜çš„ä¸ç´§å¯† Z Offset è®¾ç½®ä¹Ÿä¼šå½±å“ç²˜ä¸ç²˜åºŠã€‚ å…¶ä¸­ç™½è‰²éƒ¨åˆ†ä¸ºå‹åŠ›ä¼ æ„Ÿå™¨ï¼ˆBLTouchï¼‰ï¼Œå³è¾¹è“è‰²ç¡…èƒ¶ç½©ä¸‹é¢çš„ä¸ºå–·å¤´ å¯ä»¥çœ‹åˆ°å·¦è¾¹ç™½è‰²çš„å‹åŠ›ä¼ æ„Ÿå™¨çš„é«˜åº¦å’Œå³è¾¹è“è‰²ç¡…èƒ¶å¥—ä¸‹é¢çš„å–·å˜´æ˜¯ä¸åœ¨ä¸€ä¸ªé«˜åº¦çš„ã€‚è®¾ç½®å–·å˜´å’ŒåºŠä¹‹å‰çš„è·ç¦»æ˜¯ä»¥å‹åŠ›ä¼ æ„Ÿå™¨çš„åé¦ˆä¸ºå‡†çš„ã€‚ä½†æ˜¯å‹åŠ›ä¼ æ„Ÿå™¨æµ‹åˆ°çš„è·ç¦»æ˜¯ä¼ æ„Ÿå™¨æœ¬èº«åˆ°åºŠçš„è·ç¦»ï¼Œå¹¶ä¸æ˜¯å–·å˜´åˆ°åºŠçš„è·ç¦»ã€‚æ‰€ä»¥å‹åŠ›ä¼ æ„Ÿå™¨åˆ°å–·å˜´ä¹‹é—´çš„é«˜åº¦å·®å°±æ˜¯ Z Offsetï¼Œéœ€è¦é€šè¿‡è°ƒæ•´å®ƒæ¥è®¾ç½®åˆé€‚çš„å–·å˜´é«˜åº¦ã€‚ æ‰‹åŠ¨è°ƒå¹³ éœ€è¦ç”¨åˆ°ä¸€å¼ çº¸ï¼Œä¸€èˆ¬æ‰“å°ç”¨çš„ A4 å³å¯ã€‚ ç„¶ååœ¨åºŠçš„ä¸­ç‚¹è¿›è¡Œ Z Offset è°ƒæ•´ï¼Œåœ¨å››ä¸ªè§’è½ï¼ˆèºä¸ä½ç½®ï¼‰æ‰‹åŠ¨è°ƒæ•´åºŠçš„é«˜ä½ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š ä¸­ç‚¹ Z-Offset è°ƒæ•´ é¦–å…ˆé€šè¿‡æ§åˆ¶é¢æ¿å°†å–·å˜´ç§»åŠ¨åˆ°åºŠçš„ä¸­é—´çš„æ­£ä¸Šæ–¹ï¼Œæ¥ä¸‹æ¥å°†çº¸æ”¾å–·å˜´ä¸‹æ–¹çš„åºŠä¸Šï¼Œç´§æ¥ç€æ…¢æ…¢å°† Z è½´çš„é«˜åº¦é™ä½åˆ° 0ï¼ˆå¦‚æœé™ä¸ä¸‹å»ä¸è¦ç¡¬æ¥ï¼‰ï¼Œå–·å˜´å¯èƒ½ä¼šå‹ä½çº¸æˆ–è€…æ²¡ç¢°åˆ°çº¸ï¼›å°è¯•å‰åä¸åœçš„ç§»åŠ¨çº¸å¼ ã€‚ å¦‚æœçº¸å¼ èƒ½ç§»åŠ¨å¹¶ä¸”åˆšå¥½æœ‰ä¸€ç‚¹é˜»åŠ›å°±æ˜¯åˆé€‚çš„å–·å˜´é«˜åº¦ä¸éœ€è¦è°ƒèŠ‚ï¼Œé€šå¸¸è€Œè¨€ä¸ä¼šé‚£ä¹ˆé¡ºåˆ©ï¼›å¦‚æœå¦‚æœå–·å˜´å®Œå…¨æ²¡ç¢°åˆ°çº¸å¼ ï¼Œæˆ–è€…çº¸å¼ ç§»åŠ¨å®Œå…¨æ²¡æœ‰ä»»ä½•é˜»åŠ›ï¼Œå¯ä»¥å°è¯•é€šè¿‡è°ƒæ•´ Z-Offset ï¼Œä¸€ç‚¹ç‚¹é™ä½å–·å˜´é«˜åº¦ã€‚ç›´åˆ°è¾¾åˆ°ä¸Šè¿°çš„ç§»åŠ¨çº¸å¼ æœ‰ä¸€ç‚¹ç‚¹é˜»åŠ›çš„çŠ¶æ€ï¼›å¦‚æœçº¸å¼ è¢«å‹çš„å¾ˆæ­»æ— æ³•åŠ¨å¼¹ï¼Œåˆ™å…ˆå°† Z è½´å‡é«˜åˆ° 5mm ç„¶åå°è¯•è°ƒæ•´ Z-Offset å‡é«˜å–·å˜´ï¼Œç„¶åå†ç»§ç»­å°è¯•æ…¢æ…¢é™ä½ Z è½´åˆ° 0mmï¼Œåå¤è°ƒæ•´ç›´åˆ°ç§»åŠ¨çº¸å¼ æœ‰ä¸€ç‚¹ç‚¹é˜»åŠ›çš„çŠ¶æ€ã€‚ ä½¿ç”¨ä¸€å¼ çº¸æ¥æ‰‹åŠ¨æ‰¾åˆ°å–·å¤´åˆé€‚é«˜åº¦çš„æ–¹æ³•ã€‚ä½†æ˜¯è¿™ä¸ªèƒ½ç§»åŠ¨ä½†æ˜¯æœ‰ä¸€ç‚¹ç‚¹é˜»åŠ›çŠ¶æ€æœ‰ç‚¹æ¨¡ç³Šï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå›ºå®šçš„ç‚¹ï¼Œæ˜¯ä¸€æ®µåŒºé—´å†…éƒ½å¯ä»¥æ„Ÿè§‰åˆ°èƒ½ç§»åŠ¨ä½†æ˜¯æœ‰æ‘©æ“¦åŠ›ã€‚å»ºè®®æ˜¯é€‰æ‘©æ“¦åŠ›ç¨å¾®è½»ä¸€ç‚¹çš„åŠ›åº¦çš„ç‚¹ï¼Œè¿™æ ·å–·å˜´é«˜åº¦è¾ƒé«˜ï¼Œåé¢è°ƒæ•´çš„æ—¶å€™ä¸å®¹æ˜“åˆ®ä¼¤åºŠä¸Šçš„åº•æ¿ã€‚ å››å‘¨èºä¸è°ƒæ•´ åœ¨ä¸­é—´ç¡®å®šäº†æœ€åŸºæœ¬çš„ Z è½´çš„é«˜åº¦ä¹‹ååˆ™éœ€è¦ç‰©ç†è°ƒæ•´å››å‘¨çš„èºä¸äº†ï¼Œè°ƒæ•´å››å‘¨çš„èºä¸éœ€è¦æŒ‰ç…§é¡ºåºä¸€ä¸ªä¸€ä¸ªçš„è°ƒæ•´ï¼Œå¹¶ä¸”éœ€è¦å¤šæ¬¡è°ƒæ•´å’Œç¡®è®¤ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š é¦–å…ˆæŠ¬èµ· Z è½´è®©å–·å˜´è·ç¦»åºŠå¤§æ¦‚ 5mm çš„è·ç¦»ï¼Œå†ç§»åŠ¨åˆ°ä»»æ„ä¸€ä¸ªè·ç¦»è°ƒæ•´èºæ¯çš„æ­£ä¸Šæ–¹ï¼Œå°†çº¸æ”¾åœ¨å–·å˜´æ­£ä¸‹æ–¹çš„åºŠä¸Šï¼Œç´§æ¥ç€ä¸€ç‚¹ç‚¹å°è¯•å¾€ä¸‹ç§»åŠ¨ Z è½´åˆ° 0mmï¼Œå’Œä¸Šé¢ä¸€æ ·å¦‚æœé™ä¸ä¸‹å»ä¸è¦ç¡¬æ¥ï¼›æ¥ä¸‹æ¥å°±å’Œä¸Šé¢ä¸€æ ·ï¼Œå°è¯•ç§»åŠ¨ä¸åœçš„å‰åç§»åŠ¨çº¸å¼ ï¼Œå¦‚æœå¤„äºèƒ½ç§»åŠ¨ä½†æ˜¯æœ‰æ‘©æ“¦åŠ›çš„çŠ¶æ€åˆ™æ˜¯åˆé€‚çš„ï¼Œå¦‚æœå®Œå…¨æ²¡ç¢°åˆ°çº¸å¼ ï¼Œåœ¨ç§»åŠ¨çº¸å¼ çš„åŒæ—¶æ—‹è½¬ä¸‹æ–¹çš„èºä¸æ¥ç‰©ç†è°ƒèŠ‚è¿™ä¸ªè§’è½çš„é«˜åº¦ï¼Œç›´åˆ°çº¸å¼ å¤„äºèƒ½ç§»åŠ¨ä½†æ˜¯æœ‰æ‘©æ“¦åŠ›çš„çŠ¶æ€ã€‚æœ€åå°† Z æŠ¬èµ·åˆ° 5mm å·¦å³ï¼Œé¡ºé€†æ—¶é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªè°ƒèŠ‚èºæ¯çš„ä¸Šæ–¹ï¼Œé‡å¤ä»¥ä¸Šæ­¥éª¤ã€‚ ä¸Šé¢æ­¥éª¤æ˜¯å•ä¸ªè§’è½æ‰‹åŠ¨ç‰©ç†è°ƒæ•´åºŠé«˜åº¦çš„æ–¹æ³•ï¼Œå®Œæˆå››ä¸ªç‚¹ï¼ˆä¸Šå›¾çš„åºŠåªæœ‰å››ä¸ªèºä¸ï¼Œæœ‰å‡ ä¸ªèºä¸å°±æ ¡å‡†å‡ ä¸ªç‚¹ï¼‰ä¸ºä¸€ä¸ªå¾ªç¯ã€‚å› ä¸ºæ‰“å°æœºçš„åºŠæ˜¯ä¸€ä¸ªå›ºä½“ï¼Œæ‰€ä»¥å½“ä¸Šä¸‹ç§»åŠ¨æŸä¸€ä¸ªè§’è½çš„é«˜åº¦çš„æ—¶å€™å¦å¤–ä¸‰ä¸ªè§’è½çš„é«˜ä½ä¹Ÿæ˜¯ä¼šå—åˆ°å½±å“çš„ï¼Œå°¤å…¶æ˜¯ç›¸é‚»çš„ä¸¤ä¸ªè§’è½ã€‚æ‰€ä»¥è¿™é‡Œéœ€è¦å¤šä¸ªå¾ªç¯æ¥æ‹§èºä¸è°ƒæ•´å„ä¸ªè§’è½çš„é«˜åº¦ï¼Œç›´åˆ°å››ä¸ªè§’è½çš„é«˜åº¦éƒ½åˆé€‚çš„æƒ…å†µï¼Œå³ä¸ºçº¸å¼ èƒ½ç§»åŠ¨ä½†æ˜¯æœ‰é˜»åŠ›çš„çŠ¶æ€ã€‚ åœ¨æ‹§ç©èºä¸æ ¡å‡†å®Œå››ä¸ªè§’è½çš„é«˜åº¦åï¼Œéœ€è¦å†æ¬¡é€šè¿‡ Z-Offset æ ¡å‡†ä¸­é—´å–·å˜´çš„é«˜åº¦ã€‚å› ä¸ºåœ¨è°ƒæ•´å››è§’çš„èºä¸çš„æ—¶å€™å¯èƒ½ä¼šæ•´ä½“æŠ¬é«˜æˆ–è€…é™ä½äº†åºŠçš„é«˜åº¦ï¼Œæ‰€ä»¥ä¸­é—´çš„å–·å˜´é«˜åº¦éœ€è¦å†ä¸€æ¬¡æ ¡å‡†ã€‚é‡å¤ä¸Šé¢ä¸­ç‚¹ Z-Offset æ ¡å‡†å³å¯ã€‚ å¦‚æœå›ºä»¶è‡ªå¸¦è‡ªåŠ¨æ‰¾å¹³è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œé€‰æ‹©è‡ªåŠ¨æ‰¾å¹³ç­‰å°±å¥½äº†ã€‚è™½ç„¶æ‰‹åŠ¨æ‰¾å¹³å®Œä¹‹ååºŠåŸºæœ¬ä¸Šæ˜¯å¤„äºå¯ä»¥ç”¨çš„çŠ¶æ€äº†ï¼Œä½†æ˜¯ä¾¿å®œçš„æ¡Œé¢æ‰“å°æœºçš„åºŠå®ƒæœ¬èº«å¯èƒ½å°±æ˜¯å‡¹å‡¸ä¸å¹³çš„ï¼Œæ‰€ä»¥éœ€è¦è‡ªåŠ¨æ‰¾å¹³æ¥å¼¥è¡¥åºŠæœ¬èº«çš„å‡¹å‡¸èµ·ä¼çš„éƒ¨åˆ†ã€‚å¦‚æœæ²¡æœ‰è‡ªåŠ¨æ‰¾å¹³çš„æ‰“å°æœºå°±æ²¡æœ‰å¤ªå¥½çš„åŠæ³•é¿å…è¿™ä¸ªäº†ã€‚åªèƒ½é€šè¿‡ç¨å¾®å‹ä½ä¸€ç‚¹ç‚¹å–·å˜´æ¥åšåˆ°å°½é‡éƒ½ç²˜åˆ°åºŠã€‚ æµ‹è¯•è°ƒå¹³æ˜¯å¦æˆåŠŸ åœ¨åšå®Œä¸Šè¿°çš„è°ƒæ•´åå°±å¯ä»¥è¿›è¡Œæœ€ç»ˆçš„è°ƒæ•´äº†ã€‚è¿™ä¸€æ­¥æ˜¯é€šè¿‡æ‰“å°ä¸€äº›æ¨¡å‹æ¥ç¡®è®¤å–·å˜´çš„é«˜åº¦æ˜¯å¦åˆé€‚ã€‚ è™½ç„¶ç”¨çº¸è°ƒæ•´å¥½äº†å–·å˜´çš„é«˜åº¦ï¼Œä½†æ˜¯çº¸æœ‰è–„æœ‰åšï¼Œè°ƒæ•´å‡ºæ¥çš„å–·å˜´é«˜åº¦å¹¶ä¸ä¸€å®šæ˜¯æœ€å¥½çš„æ‰“å°é«˜åº¦ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯éœ€è¦é€šè¿‡æ‰“å°æ¥è°ƒæ•´ã€‚ æ‰“å°æµ‹è¯•æ—¶å°½é‡é€‰æ‹©æœ‰é¢œè‰²çš„ææ–™ï¼Œé€æ˜é€æ˜ææ–™ä¼šçœ‹ä¸æ¸…æ¥šç¬¬ä¸€å±‚æœ‰æ²¡æœ‰æ‰“å¥½ï¼Œåœ¨æ‰“å°æ¨¡å‹çš„æ—¶å€™ï¼Œæ‰‹éœ€è¦åœ¨ç”µæºé™„è¿‘éšæ—¶å¾…å‘½ã€‚åœ¨å–·å˜´é«˜åº¦è®¾ç½®é”™è¯¯æˆ–è€…åºŠä¸å¹³çš„æ—¶èƒ½åŠæ—¶åœæ­¢æ‰“å°æœºé™ä½æŸå¤±ã€‚ æ‰“å°å‡ºæ¥çš„æ¨¡å‹ä¸»è¦æ˜¯ç”¨æ¥æ£€æŸ¥å–·å˜´çš„é«˜åº¦å’ŒåºŠæ˜¯å¦å€¾æ–œçš„ï¼Œå››å‘¨çš„åœ†æŸ±å’Œç»•åœºä¸€å‘¨çš„çº¿æ¡ç”¨æ¥æ£€æŸ¥åºŠçš„å€¾æ–œåº¦ã€‚ å¤–å›´çº¿æ¡å¦‚æœé«˜ä½ä¸å¹³å‡ï¼Œè–„çš„é‚£è¾¹å°±æ˜¯è¾ƒé«˜çš„åœ°æ–¹ï¼Œåšçš„é‚£è¾¹åˆ™æ˜¯è¾ƒä½çš„åœ°æ–¹ã€‚å››è§’çš„åœ†æŸ±åˆ™å¯ä»¥å’Œä¸Šè¿°çš„ Raise 3D çš„ç¤ºæ„å›¾æ¥æ¯”è¾ƒç¡®è®¤å–·å¤´çš„é«˜åº¦æ˜¯å¦åˆé€‚ã€‚å¦‚æœä¸åˆé€‚å¯èƒ½éœ€è¦é‡æ–°æ‰‹åŠ¨æ‰¾å¹³ã€‚ä¸­é—´çš„åœ†å½¢æ˜¯ç¡®è®¤å–·å˜´é«˜åº¦ç”¨çš„ã€‚åŒæ ·é€šè¿‡å¯¹æ¯”æ¥è§‚å¯Ÿé«˜åº¦æ˜¯å¦åˆé€‚ï¼Œå¦‚æœåºŠå¹¶æ²¡æœ‰å¾ˆä¸¥é‡çš„å€¾æ–œï¼Œåˆ™åªéœ€è¦è°ƒæ•´ Z-Offset æ¥ç§»åŠ¨å–·å˜´ã€‚ç„¶åé‡æ–°æ‰“å°ç¡®è®¤ã€‚å¦‚æœç¡®è®¤åºŠæœ‰å€¾æ–œï¼Œå°±è¦é‡æ–°èµ°ä¸€éæ‰‹åŠ¨æ‰¾å¹³çš„æµç¨‹çš„äº†ï¼Œç„¶åé‡æ–°æ‰“å°ç¡®è®¤ã€‚ å½“ç„¶æ‰¾å¹³ä¹Ÿä¸æ˜¯ä¸€å®šå®Œç¾çš„ã€‚ä½†æ˜¯æœ‰è‡ªåŠ¨æ‰¾å¹³åï¼Œæ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚ä½†æ˜¯ä¹Ÿæœ‰æ— è®ºæ€ä¹ˆè°ƒæ•´ï¼Œéƒ½è§‰å¾—åºŠæœ‰å€¾æ–œæˆ–è€…é«˜åº¦ä¸å¯¹çš„æ—¶å€™ã€‚è¿™é‡Œå°±è¦åˆ†ä¸¤ç§æƒ…å†µè®¨è®ºäº†ã€‚å¦‚æœèƒ½æ­£å¸¸æ‰“å°ä¸æƒ³æŠ˜è…¾äº†å°±é€‰ä¸€ä¸ªèƒ½è°ƒæ•´åˆ°çš„æœ€å¥½çš„çŠ¶æ€ç›´æ¥ç”¨å§ã€‚å¦‚æœä¸¥é‡åˆ°äº†æ— æ³•æ‰“å°çš„ç¨‹åº¦ï¼Œåˆ™éœ€è¦æ£€æŸ¥æ‰“å°çš„è£…é…æ˜¯ä¸æ˜¯æœ‰é—®é¢˜äº†ã€‚ è¿‡åº¦æŒ¤å‡º æ‰“å°å‡ºæ¥çš„ä¸œè¥¿éƒ½æœ‰å¥‡æ€ªçš„çº¹ç†ã€‚è€Œä¸”è´¨é‡ä¹Ÿå‚å·®ä¸é½ã€‚ æ£€æŸ¥ä¹‹åæ˜¯ klipper é…ç½®é‡Œé¢çš„æŒ¤å‡ºæœºçš„ã€Œroration_distanceã€é…é”™äº†ã€‚å¯¼è‡´æŒ¤å‡ºæœºå¾€å¤–æŒ¤çš„æ—¶å€™ç»™äº†è¿œæ¯”æ­£å¸¸æƒ…å†µå¤šçš„æ–™ï¼Œè¿›è€Œæº¢å‡ºåˆ°è¾¹ç¼˜äº§ç”Ÿäº†ç¥å¥‡çš„çº¹ç†ã€‚ Klipper é…ç½®é‡Œé¢çš„æŒ¤å‡ºæœºè½¬ä¸€åœˆæŒ¤å¤šå°‘æ–™è¿™äº›ä¸œè¥¿éƒ½éœ€è¦è‡ªå·±é…ç½®ã€‚æ‰€ä»¥é…ç½®æŒ¤å‡ºå‚æ•°æ—¶æ˜¯éœ€è¦æ ¡å‡†çš„ï¼Œå½“ç»™æŒ‡ä»¤è®©ä»–æŒ¤ 100mm çš„ææ–™çš„æ—¶å€™ï¼Œä»–åº”è¯¥å°±æŒ¤å‡ºæ¥ 100mm å·¦å³çš„ææ–™ã€‚æ²¡æœ‰æ ¡å‡†æ‰€ä»¥å¯¼è‡´äº†éå¸¸ä¸¥é‡çš„è¿‡åº¦æŒ¤å‡ºï¼Œé…ç½®æ­£ç¡®åæ‰“å°çš„ä¸œè¥¿è¡¨é¢çš„é—®é¢˜å°±æ¼‚äº®å¤šäº†ã€‚ æ­£å¸¸æŒ¤å‡ºæ‰“å°çš„é›¶ä»¶çš„è¡¨é¢è´¨æ„Ÿ ææ–™ä¸ç¯å¢ƒæ¹¿åº¦ç”±äº FDM 3D æ‰“å°ä»¶ä¸€èˆ¬éƒ½éœ€è¦å°†ææ–™åŠ çƒ­åˆ° 200 æ‘„æ°åº¦æˆ–ä»¥ä¸Šçš„æ¸©åº¦æ‰èƒ½æ‰“å°ï¼Œæ‰€ä»¥å½“ææ–™é€šè¿‡çƒ­ç«¯çš„æ—¶å€™ï¼Œå…¶ä¸­çš„æ°´è’¸æ°”ä¼šè’¸å‘å‡ºæ¥ï¼Œé€ æˆå–·å˜´é‡Œé¢çš„ææ–™æœ‰é—´éš™ï¼Œè¿™äº›ç°è±¡è¿˜ä¼šé€ æˆæ‰“å°ä»¶åœ¨ç‰©ç†ç‰¹æ€§ä¸Šçš„æ”¹å˜ï¼š æ°´æ±½è†¨èƒ€é€ æˆæŒ¤å‡ºåŸæ–™ä¸å‡åŒ€å¯¼è‡´çš„è¡¨é¢ç²—ç³™ æ°´æ±½è†¨èƒ€é€ æˆææ–™ä¹‹é—´æœ‰å¾ˆå¤šç©ºéš™å¯¼è‡´çš„å¼ºåº¦ä¸‹é™ æ°´æ±½è†¨èƒ€å–·å˜´ä¸­é»åœ¨ä¸€å—çš„ææ–™æœ‰ç¼éš™ï¼Œå¯¼è‡´æ‹‰ä¸ã€‚ ææ–™å‡éœ€è¦å¯†å°å¹²ç‡¥ä¿å­˜ï¼ä¹°å¹²ç‡¥ç›’ ä¸»è¦æˆåˆ†ç®€ç§° æ¨èæ‰“å°å–·å˜´æ¸©åº¦ æ¨èæ‰“å°åºŠæ¸©åº¦ ç‰¹ç‚¹ PLA 190ËšC â€“ 230ËšC 25ËšC-60ËšC æ˜“å—æ½® TPU 200ËšC â€“ 210ËšC 50ËšC æ˜“æ‹‰ä¸ PETG 230ËšC â€“ 240ËšC 70ËšC â€“ 80ËšC ABS 245ËšC â€“ 265ËšC 90ËšC â€“ 100ËšC æœ‰æ¯’ ASA 240ËšC â€“ 260ËšC 75ËšC â€“ 95ËšC PC 250ËšC â€“ 270ËšC 90ËšC â€“ 105ËšC PA6 250ËšC â€“ 270ËšC 25ËšC â€“ 50ËšC PA6-CF 280ËšC â€“ 300ËšC 25ËšC â€“ 50ËšC","categories":["5.åµŒå…¥å¼å¼€å‘","ç¡¬ä»¶çŸ¥è¯†","3Dæ‰“å°"]},{"title":"PCRè®¾å¤‡è®¾è®¡çš„åŸºæœ¬å‚æ•°","path":"/2025/02/24/5-åµŒå…¥å¼å¼€å‘-ç¡¬ä»¶çŸ¥è¯†-PCRè®¾å¤‡è®¾è®¡çš„åŸºæœ¬å‚æ•°/","content":"é¡¹ç›®ï¼š ååº”ç±»å‹ï¼šå®šæ€§å®šé‡ æº¶è§£æ›²çº¿ ååº”ä½“ç³»ï¼š20ul å•ä½ï¼šcopiesml IUmlï¼ˆå¯é€‰è¾“å…¥ï¼‰ æ¸©åº¦ä¿¡æ¯ï¼ˆæ¸©åº¦èŒƒå›´ï¼Œæ—¶é—´èŒƒå›´ï¼‰ å‡é™æ¸©é€Ÿç‡å¯æ§ é™è½ PCRï¼ˆå¯é€‰ï¼‰ ç¨‹åºç»„ï¼Œç¨‹åºæ­¥éª¤ é€šé“å®éªŒåŸºæœ¬å‚æ•° é€šé“åˆ†æç±»å‹ï¼šå®šæ€§å®šé‡ é€šé“åŸºçº¿èµ·ç‚¹ç»ˆç‚¹ï¼š6ã€12 åŸºçº¿ä¼˜åŒ–ï¼šè‡ªåŠ¨ä¼˜åŒ–ä¸ä¼˜åŒ– é˜ˆå€¼ï¼šè‡ªåŠ¨é˜ˆå€¼ã€æ‰‹åŠ¨é˜ˆå€¼ æ•°å­—æ»¤æ³¢ï¼šä¸æ»¤æ³¢ã€è½»åº¦æ»¤æ³¢ã€é‡åº¦æ»¤æ³¢ æ¯ä¸ªé€šé“çš„åŸºçº¿å–å€¼æ–¹å¼ä¸åŒ å®šé‡æ£€æµ‹èŒƒå›´ï¼šå•ä½ UImlï¼Œæ£€æµ‹ä¸Šé™å’Œæ£€æµ‹ä¸‹é™ æ£€æµ‹è§„åˆ™ é˜´é˜³æ€§åˆ¤æ–­ æº¶è§£æ›²çº¿ è¿ç»­å‡æ¸©æ–¹å¼å’Œæ­¥éª¤å‡æ¸©æ–¹å¼ é«˜ç‚¹è¿‡å†²æ¸©åº¦èŒƒå›´ç›‘æ§ï¼Œä½ç‚¹è¿‡å†²æ¸©åº¦èŒƒå›´ç›‘æ§ æœ€å°ç•Œå®šæ¸©åº¦å’Œæœ€å¤§ç•Œå®šæ¸©åº¦ å™ªå£°é˜ˆå€¼ï¼ˆå³°é«˜é˜ˆå€¼ï¼Œç”¨äºæ’é™¤å™ªå£°å’Œéç‰¹å¼‚æ€§æ‚å³°ï¼‰ å…‰å¼ºè¾¹ç¼˜æ•ˆåº”ã€æ¸©æ§è¾¹ç¼˜æ•ˆåº” æº¶è§£æ›²çº¿çš„ Tm å€¼å’Œ Rm æº¶è§£æ›²çº¿ è¿ç»­å‡æ¸©æ–¹å¼å’Œæ­¥éª¤å‡æ¸©æ–¹å¼ æœ€å°ç•Œå®šæ¸©åº¦å’Œæœ€å¤§ç•Œå®šæ¸©åº¦ å™ªå£°é˜ˆå€¼ï¼ˆå³°é«˜é˜ˆå€¼ï¼Œç”¨äº å¸¸ç”¨é€šé“æ³¢é•¿å’ŒæŸ“æ–™","categories":["5.åµŒå…¥å¼å¼€å‘","ç¡¬ä»¶çŸ¥è¯†"]},{"title":"QChartç»˜å›¾","path":"/2025/02/24/3-å¼€å‘æ¡†æ¶-Qt-Standby-QChartç»˜å›¾/","content":"QChartViewQChartQLineSeriesåœ¨ Qt Charts æ¡†æ¶ä¸­ï¼ŒQChartã€QLineSeries å’Œ QChartView æ˜¯æ„å»ºå’Œå±•ç¤ºå›¾è¡¨çš„ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ã€‚å®ƒä»¬å„è‡ªæ‰¿æ‹…ç€ä¸åŒçš„è§’è‰²ï¼Œå¹¶é€šè¿‡ç´§å¯†çš„åä½œæ¥å®ç°å›¾è¡¨çš„åˆ›å»ºå’Œæ˜¾ç¤ºã€‚ä»¥ä¸‹æ˜¯å¯¹è¿™ä¸‰ä¸ªç»„ä»¶çš„è¯¦ç»†è¯´æ˜ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚ 1. QChart å«ä¹‰: QChart æ˜¯ä¸€ä¸ªå›¾è¡¨å®¹å™¨ï¼Œè´Ÿè´£ç®¡ç†å›¾è¡¨ä¸­çš„æ•°æ®ç³»åˆ—ã€åæ ‡è½´ã€å›¾ä¾‹ç­‰å¸ƒå±€å…ƒç´ ã€‚å®ƒæ˜¯å›¾è¡¨çš„æ ¸å¿ƒï¼Œå¤„ç†æ•´ä½“çš„ç»˜åˆ¶å’Œå‘ˆç°é€»è¾‘ã€‚ ç”¨æ³•: åˆ›å»ºä¸€ä¸ª QChart å®ä¾‹åï¼Œå¯ä»¥é€šè¿‡ addSeries() æ–¹æ³•å°†æ•°æ®ç³»åˆ—ï¼ˆå¦‚ QLineSeriesï¼‰æ·»åŠ åˆ°å›¾è¡¨ä¸­ã€‚ é€šè¿‡ setTitle() æ–¹æ³•è®¾ç½®å›¾è¡¨çš„æ ‡é¢˜ï¼Œä½¿ç”¨ createDefaultAxes() æ–¹æ³•è‡ªåŠ¨ç”Ÿæˆåæ ‡è½´ã€‚ QChart æ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ç³»åˆ—ï¼ŒåŒ…æ‹¬çº¿å½¢å›¾ã€æŸ±çŠ¶å›¾ç­‰ï¼Œå…è®¸ç”¨æˆ·åˆ›å»ºå¤æ‚çš„å¤šè½´å›¾è¡¨ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åŒæ—¶æ˜¾ç¤ºå¤šä¸ª QLineSeriesï¼Œå¹¶ä¸ºæ¯ä¸ªç³»åˆ—è®¾ç½®ä¸åŒçš„é¢œè‰²å’Œæ ·å¼ï¼Œä»¥ä¾¿äºåŒºåˆ†ã€‚ 2. QLineSeries å«ä¹‰: QLineSeries æ˜¯ä¸€ç§ç‰¹å®šç±»å‹çš„æ•°æ®ç³»åˆ—ï¼Œç”¨äºåœ¨å›¾è¡¨ä¸­è¡¨ç¤ºçº¿å½¢å›¾ã€‚å®ƒç”±ä¸€ç³»åˆ—çš„ç‚¹æ„æˆï¼Œè¿™äº›ç‚¹é€šè¿‡çº¿æ®µè¿æ¥ï¼Œå½¢æˆä¸€æ¡è¿ç»­çš„æ›²çº¿ã€‚ ç”¨æ³•: åˆ›å»ºä¸€ä¸ª QLineSeries å®ä¾‹åï¼Œå¯ä»¥ä½¿ç”¨ append(x, y) æ–¹æ³•å‘å…¶ä¸­æ·»åŠ æ•°æ®ç‚¹ã€‚ä¾‹å¦‚ï¼Œseries-append(0, 6) è¡¨ç¤ºåœ¨åæ ‡ (0, 6) å¤„æ·»åŠ ä¸€ä¸ªç‚¹ã€‚ é€šè¿‡è®¾ç½®çº¿æ¡çš„æ ·å¼ã€é¢œè‰²å’Œå®½åº¦ç­‰å±æ€§ï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰çº¿å½¢å›¾çš„å¤–è§‚ã€‚æ¯”å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ setPen() æ–¹æ³•æ¥æ”¹å˜çº¿æ¡çš„é¢œè‰²å’Œç²—ç»†ï¼Œä½¿å¾—å›¾è¡¨æ›´åŠ ç¾è§‚å’Œæ˜“äºç†è§£ã€‚ 3. QChartView å«ä¹‰: QChartView æ˜¯ QWidget çš„å­ç±»ï¼Œä¸“é—¨ç”¨äºæ˜¾ç¤º QChart å®ä¾‹ã€‚å®ƒä¸ºå°†å›¾è¡¨é›†æˆåˆ°æ ‡å‡† Qt ç”¨æˆ·ç•Œé¢æä¾›äº†ä¾¿åˆ©çš„æ–¹å¼ã€‚ ç”¨æ³•: åˆ›å»ºä¸€ä¸ª QChartView å®ä¾‹ï¼Œå¹¶é€šè¿‡ setChart() æ–¹æ³•å°†ä¸€ä¸ª QChart å¯¹è±¡è®¾ç½®ç»™å®ƒã€‚è¿™æ ·ï¼ŒQChartView å°±å¯ä»¥æ˜¾ç¤ºè¯¥å›¾è¡¨ã€‚ QChartView å¯ä»¥åƒå…¶ä»– QWidget ä¸€æ ·è¢«æ”¾ç½®åœ¨ä»»ä½• Qt å¸ƒå±€ä¸­ï¼Œä¾‹å¦‚ä½¿ç”¨ QVBoxLayout æˆ– QHBoxLayoutã€‚è¿™ä½¿å¾—å›¾è¡¨èƒ½å¤Ÿä¸å…¶ä»–ç•Œé¢å…ƒç´ ï¼ˆå¦‚æŒ‰é’®ã€æ–‡æœ¬æ¡†ç­‰ï¼‰æ— ç¼ç»“åˆã€‚ ç»„ä»¶å…³ç³»æ¦‚è¿°è¿™ä¸‰ä¸ªç»„ä»¶çš„å…³ç³»å¯ä»¥æ€»ç»“ä¸ºï¼šQChartView ç”¨äºå±•ç¤º QChartï¼Œè€Œ QChart åˆ™è´Ÿè´£å®¹çº³å’Œç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®ç³»åˆ—ï¼ˆå¦‚ QLineSeriesï¼‰ã€‚å…·ä½“æ¥è¯´ï¼Œæ‚¨é¦–å…ˆåˆ›å»ºæ•°æ®ç³»åˆ—ä»¥å­˜å‚¨æ•°æ®ï¼Œç„¶åä½¿ç”¨ QChart æ¥ç»„ç»‡å’Œå¤„ç†è¿™äº›ç³»åˆ—ï¼Œæœ€åé€šè¿‡ QChartView åœ¨ç”¨æˆ·ç•Œé¢ä¸­å±•ç¤ºå›¾è¡¨ã€‚ ç¤ºä¾‹ä»£ç ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•å°†è¿™ä¸‰ä¸ªç»„ä»¶ç»„åˆä½¿ç”¨ï¼š QLineSeries *series = new QLineSeries();series-append(0, 6); // åœ¨ (0, 6) æ·»åŠ ç‚¹series-append(1, 3); // åœ¨ (1, 3) æ·»åŠ ç‚¹series-append(2, 5); // åœ¨ (2, 5) æ·»åŠ ç‚¹// ... å¯ä»¥ç»§ç»­æ·»åŠ æ›´å¤šæ•°æ®ç‚¹QChart *chart = new QChart();chart-addSeries(series); // å°†æ•°æ®ç³»åˆ—æ·»åŠ åˆ°å›¾è¡¨ä¸­chart-setTitle(ç¤ºä¾‹çº¿å½¢å›¾); // è®¾ç½®å›¾è¡¨æ ‡é¢˜chart-createDefaultAxes(); // åˆ›å»ºé»˜è®¤åæ ‡è½´QChartView *chartView = new QChartView(chart);chartView-setRenderHint(QPainter::Antialiasing); // è®¾ç½®æŠ—é”¯é½¿ä»¥æé«˜æ¸²æŸ“è´¨é‡// å°† chartView æ·»åŠ åˆ°å¸ƒå±€ä¸­QVBoxLayout *layout = new QVBoxLayout(ui-chart_widget);layout-addWidget(chartView); // å°†å›¾è¡¨è§†å›¾æ·»åŠ åˆ°æŒ‡å®šçš„ QWidget ä¸­ åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å¦‚ä½•åˆ›å»ºä¸€ä¸ªç®€å•çš„çº¿å½¢å›¾ï¼Œå¹¶å°†å…¶åµŒå…¥åˆ° Qt ç•Œé¢ä¸­ã€‚é€šè¿‡è°ƒæ•´æ•°æ®ç‚¹å’Œæ ·å¼ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°åˆ›å»ºå‡ºç¬¦åˆéœ€æ±‚çš„å›¾è¡¨ã€‚ QChartViewæ¯ä¸ª QChartView å¯¹è±¡éƒ½ç»‘å®šä¸€ä¸ª QChart å¯¹è±¡ã€‚å¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­ä¼ å…¥ QChart å¯¹è±¡çš„æŒ‡é’ˆï¼Œä¹Ÿå¯ä»¥é€šè¿‡ setChart() å‡½æ•°è®¾ç½®ã€‚ QChartView *chartView = new QChartView(chart); // åˆ›å»ºä¸€ä¸ª QChartView å¯¹è±¡å¹¶å°†å›¾è¡¨æ·»åŠ åˆ°å…¶ä¸­QMainWindow window; // åˆ›å»ºä¸»çª—å£window.setCentralWidget(chartView); // å°†å›¾è¡¨è§†å›¾è®¾ç½®ä¸ºä¸»çª—å£çš„ä¸­å¿ƒæ§ä»¶window.show(); // æ˜¾ç¤ºä¸»çª—å£ é€šè¿‡å°† QChartView è®¾ç½®ä¸ºä¸»çª—å£çš„ä¸­å¿ƒæ§ä»¶ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°æŸ¥çœ‹å›¾è¡¨ã€‚ ä¸»è¦åŠŸèƒ½ï¼š å›¾è¡¨æ˜¾ç¤ºï¼šå°† QChart çš„å†…å®¹å‘ˆç°ä¸ºå›¾å½¢ï¼Œç”¨æˆ·å¯ä»¥ç›´è§‚åœ°ç†è§£æ•°æ®ã€‚ ç”¨æˆ·äº¤äº’ï¼šå…è®¸ç”¨æˆ·è¿›è¡Œç¼©æ”¾ã€å¹³ç§»ã€ç‚¹å‡»ç­‰æ“ä½œï¼Œå¢å¼ºç”¨æˆ·ä½“éªŒã€‚ æŠ—é”¯é½¿æ¸²æŸ“ï¼šæä¾›å¹³æ»‘çš„å›¾è¡¨æ˜¾ç¤ºï¼Œé¿å…äº†å›¾å½¢çš„é”¯é½¿çŠ¶è¾¹ç¼˜ï¼Œä½¿å¾—å›¾è¡¨æ›´åŠ ç¾è§‚ã€‚ é›†æˆåˆ° Qt UI ç³»ç»Ÿï¼šQChartView å¯ä»¥ä½œä¸º Qt UI ç•Œé¢çš„ä¸€éƒ¨åˆ†åµŒå…¥åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œæ–¹ä¾¿ä¸å…¶ä»–æ§ä»¶ååŒå·¥ä½œã€‚ 1. QChartView çš„æ„é€ å‡½æ•°QChartView çš„æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š QChartView::QChartView(QChart *chart, QWidget *parent = nullptr); **QChart *chart**ï¼šè¦æ˜¾ç¤ºçš„ QChart å¯¹è±¡ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ­¤å‚æ•°æŒ‡å®šè¦å±•ç¤ºçš„æ•°æ®å›¾è¡¨ã€‚ **QWidget *parent**ï¼šçˆ¶çª—å£éƒ¨ä»¶ï¼Œé»˜è®¤ä¸ºç©ºã€‚å¦‚æœè®¾ç½®ä¸ºéç©ºï¼ŒQChartView ä¼šåµŒå…¥åˆ°æŒ‡å®šçš„çˆ¶ç»„ä»¶ä¸­ï¼Œä¾¿äºç®¡ç†å’Œå¸ƒå±€ã€‚ 2. QChartView çš„ä¸»è¦æ–¹æ³•å’Œå±æ€§2.1 è®¾ç½®ä¸è·å–å›¾è¡¨å¯¹è±¡ **void setChart(QChart *chart)**ï¼šè®¾ç½®è¦æ˜¾ç¤ºçš„ QChart å¯¹è±¡ï¼Œå…è®¸åŠ¨æ€æ›´æ–°å›¾è¡¨å†…å®¹ã€‚ **QChart* chart() const**ï¼šè·å–å½“å‰æ˜¾ç¤ºçš„ QChart å¯¹è±¡ï¼Œä¾¿äºåç»­æ“ä½œã€‚ ä¾‹å¦‚ï¼š QChartView *chartView = new QChartView(); QChart *chart = new QChart(); chartView-setChart(chart); // åŠ¨æ€è®¾ç½®å›¾è¡¨ 2.2 æ¸²æŸ“è®¾ç½® **void setRenderHint(QPainter::RenderHint hint, bool on = true)**ï¼šè®¾ç½® QPainter çš„æ¸²æŸ“æç¤ºï¼Œå¸¸ç”¨æ¥å¯ç”¨æŠ—é”¯é½¿ä»¥æå‡å›¾è¡¨çš„å¹³æ»‘åº¦ã€‚ chartView-setRenderHint(QPainter::Antialiasing); // å¯ç”¨æŠ—é”¯é½¿ 2.3 åŠ¨ç”»æ•ˆæœ **void setAnimationOptions(QChart::AnimationOption options)**ï¼šä¸ºå›¾è¡¨è®¾ç½®åŠ¨ç”»æ•ˆæœï¼Œä½¿æ•°æ®å±•ç¤ºæ›´ä¸ºæµç•…ï¼Œå¸å¼•ç”¨æˆ·çš„æ³¨æ„ã€‚ chartView-chart()-setAnimationOptions(QChart::AllAnimations); // å¯ç”¨æ‰€æœ‰åŠ¨ç”»æ•ˆæœ 2.4 ç”¨æˆ·äº¤äº’è®¾ç½® **void setRubberBand(QChartView::RubberBand rubberBand)**ï¼šè®¾ç½®ç”¨æˆ·äº¤äº’æ¨¡å¼ï¼Œæ”¯æŒçŸ©å½¢åŒºåŸŸç¼©æ”¾ã€æ°´å¹³æˆ–å‚ç›´ç¼©æ”¾ç­‰ï¼Œæ–¹ä¾¿ç”¨æˆ·é€‰æ‹©ç‰¹å®šåŒºåŸŸè¿›è¡ŒæŸ¥çœ‹ã€‚ chartView-setRubberBand(QChartView::RectangleRubberBand); // å¯ç”¨åŒºåŸŸç¼©æ”¾ **void setDragMode(QGraphicsView::DragMode mode)**ï¼šè®¾ç½®æ‹–åŠ¨æ¨¡å¼ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡é¼ æ ‡æ‹–åŠ¨å›¾è¡¨ï¼Œä¾¿äºæŸ¥çœ‹ä¸åŒéƒ¨åˆ†çš„æ•°æ®ã€‚ chartView-setDragMode(QGraphicsView::ScrollHandDrag); // å¯ç”¨æ‹–åŠ¨ **void resetZoom()**ï¼šé‡ç½®å›¾è¡¨ç¼©æ”¾åˆ°é»˜è®¤çŠ¶æ€ï¼Œæ–¹ä¾¿ç”¨æˆ·å¿«é€Ÿæ¢å¤è§†å›¾ã€‚ chartView-chart()-zoomReset(); // é‡ç½®ç¼©æ”¾ 3. ç¼©æ”¾ä¸æ‹–åŠ¨åŠŸèƒ½QChartView æ”¯æŒå¼ºå¤§çš„ç¼©æ”¾å’Œå¹³ç§»åŠŸèƒ½ï¼Œé€šè¿‡è®¾ç½®ç¼©æ”¾æ–¹å¼å’Œæ‹–åŠ¨æ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥è½»æ¾åœ°è°ƒæ•´å›¾è¡¨è§†å›¾ã€‚ å¯ç”¨ç¼©æ”¾ï¼šé€šè¿‡ RubberBand å…è®¸ç”¨æˆ·é€‰æ‹©å›¾è¡¨åŒºåŸŸè¿›è¡Œç¼©æ”¾ï¼Œæå‡æ•°æ®åˆ†æçš„çµæ´»æ€§ã€‚ chartView-setRubberBand(QChartView::RectangleRubberBand); // çŸ©å½¢ç¼©æ”¾ æ‹–åŠ¨å›¾è¡¨ï¼šé€šè¿‡ ScrollHandDrag æ¨¡å¼å…è®¸ç”¨æˆ·æ‹–åŠ¨å›¾è¡¨è§†å›¾ï¼Œä¾¿äºæŸ¥çœ‹ä¸åŒæ•°æ®ç‚¹ã€‚ chartView-setDragMode(QGraphicsView::ScrollHandDrag); // å¯ç”¨æ‰‹åŠ¨æ‹–åŠ¨ ä¸ RubberBand ç›¸å…³çš„å‡½æ•°QChartView çš„å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯è®¾ç½® RubberBand ç±»å‹ã€‚ RubberBands rubberBand() constvoid setRubberBand(const RubberBands rubberBand) RubberBand ç±»å‹æœ‰ 4 ç§ï¼Œå«ä¹‰å¦‚ä¸‹ï¼š é»˜è®¤æ•ˆæœ æ— æ©¡çš®åœˆæ•ˆæœsetRubberBand(QChartView::NoRubberBand); è®¾ç½®ä¸ºæ— æ©¡çš®åœˆæ•ˆæœï¼Œåˆ™æ— æ³•åœ¨ç»˜å›¾åŒºæ‹–å‡ºé€‰å®šåŒºåŸŸï¼Œä¹Ÿå°±ä¸ä¼šè¿›è¡Œç¼©æ”¾äº†ã€‚ çŸ©å½¢æ©¡çš®åœˆæ•ˆæœsetRubberBand(QChartView::RectangleRubberBand); å¯ä»¥åœ¨å›¾è¡¨çš„ç»˜å›¾åŒºæ‹‰å‡ºçŸ©å½¢æ©¡çš®åœˆï¼š æ”¾æ‰‹åï¼Œæ©¡çš®åœˆéƒ¨åˆ†å°†æ”¾å¤§æ˜¾ç¤ºï¼Œå¡«æ»¡ä¸¤ä¸ªç»˜å›¾åŒºï¼š æ°´å¹³æ©¡çš®åœˆæ•ˆæœsetRubberBand(QChartView::HorizontalRubberBand); å¯ä»¥åœ¨å›¾è¡¨çš„ç»˜å›¾åŒºæ‹‰å‡ºæ°´å¹³æ©¡çš®åœˆï¼š æ¾æ‰‹åï¼Œå°†æ‰€é€‰çŸ©å½¢æ°´å¹³æ”¾å¤§ï¼š ç«–ç›´æ©¡çš®åœˆæ•ˆæœsetRubberBand(QChartView::VerticalRubberBand); å¯ä»¥åœ¨å›¾è¡¨çš„ç»˜å›¾åŒºæ‹‰å‡ºç«–ç›´æ©¡çš®åœˆï¼š æ¾æ‰‹åï¼Œæ•ˆæœä¸ºï¼š 4. äº‹ä»¶å¤„ç†ä¸äº¤äº’ç”±äº QChartView ç»§æ‰¿è‡ª QGraphicsViewï¼Œå®ƒä¹Ÿæ”¯æŒé¼ æ ‡å’Œé”®ç›˜äº‹ä»¶çš„å¤„ç†ï¼Œå…è®¸å¼€å‘è€…å®šåˆ¶ç”¨æˆ·çš„äº¤äº’è¡Œä¸ºã€‚ 4.1 é¼ æ ‡äº‹ä»¶ä½ å¯ä»¥é€šè¿‡é‡è½½ mousePressEvent æ–¹æ³•å¤„ç†ç”¨æˆ·çš„é¼ æ ‡ç‚¹å‡»äº‹ä»¶ï¼Œä¾‹å¦‚å¤„ç†ç”¨æˆ·ç‚¹å‡»æŸä¸ªæ•°æ®ç‚¹çš„æ“ä½œã€‚ void MyChartView::mousePressEvent(QMouseEvent *event) QPoint point = event-pos(); // è·å–é¼ æ ‡ç‚¹å‡»ä½ç½® // è‡ªå®šä¹‰é¼ æ ‡ç‚¹å‡»æ“ä½œ QChartView::mousePressEvent(event); // ä¿æŒé»˜è®¤è¡Œä¸º 4.2 é”®ç›˜äº‹ä»¶ä½ å¯ä»¥é€šè¿‡é‡è½½ keyPressEvent æ¥å¤„ç†é”®ç›˜äº‹ä»¶ï¼Œä¾‹å¦‚ä¸ºå›¾è¡¨è®¾ç½®å¿«æ·é”®æ“ä½œã€‚ void MyChartView::keyPressEvent(QKeyEvent *event) if (event-key() == Qt::Key_R) chart()-zoomReset(); // æŒ‰ R é”®é‡ç½®ç¼©æ”¾ else QChartView::keyPressEvent(event); 5. å®ä¾‹ä»£ç ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„æŠ˜çº¿å›¾ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ QChartView åœ¨ Qt åº”ç”¨ç¨‹åºä¸­æ˜¾ç¤ºå›¾è¡¨ã€‚ #include QtCharts/QChartView#include QtCharts/QLineSeries#include QtCharts/QChart#include QtWidgets/QApplication#include QtWidgets/QMainWindowQT_CHARTS_USE_NAMESPACEint main(int argc, char *argv[]) QApplication a(argc, argv); QLineSeries *series = new QLineSeries(); // åˆ›å»ºæŠ˜çº¿ç³»åˆ— series-append(0, 6); // æ·»åŠ æ•°æ®ç‚¹ series-append(2, 4); series-append(3, 8); series-append(7, 4); series-append(10, 5); QChart *chart = new QChart(); // åˆ›å»ºå›¾è¡¨ chart-addSeries(series); // å°†æ•°æ®ç³»åˆ—æ·»åŠ åˆ°å›¾è¡¨ chart-setTitle(Simple Line Chart Example); // è®¾ç½®å›¾è¡¨æ ‡é¢˜ chart-createDefaultAxes(); // åˆ›å»ºé»˜è®¤åæ ‡è½´ QChartView *chartView = new QChartView(chart); // åˆ›å»ºå›¾è¡¨è§†å›¾ chartView-setRenderHint(QPainter::Antialiasing); // å¯ç”¨æŠ—é”¯é½¿ QMainWindow window; // åˆ›å»ºä¸»çª—å£ window.setCentralWidget(chartView); // è®¾ç½®ä¸­å¿ƒæ§ä»¶ window.resize(800, 600); // è®¾ç½®çª—å£å¤§å° window.show(); // æ˜¾ç¤ºçª—å£ return a.exec(); // è¿è¡Œåº”ç”¨ç¨‹åº Qt Chart æ¨¡å—å¯¹äº QChartï¼Œä¸€ä¸ªç¨å¾®èƒ½ç¼“è§£å¡é¡¿çš„æ–¹æ¡ˆå°±æ˜¯ï¼šseries-setUseOpenGL(true); åœ¨å¼€å¯ openGl ä¹‹åï¼ŒX è½´åªèƒ½ä½¿ç”¨åŸç”Ÿæ•°æ®è½´ QValueAxisï¼ŒX è½´æ— æ³•ä½¿ç”¨æ—¶é—´è½´ QDateTimeAxisï¼Œé‡‡ç”¨æ—¶é—´è½´çš„ç‚¹ï¼Œåœ¨å¼€å¯ OpenGL ä¹‹åï¼Œæ›²çº¿æ— æ³•æ˜¾ç¤ºã€‚ ç”»ç›´çº¿ä½¿ç”¨ QLineSeries æ¥ç»˜åˆ¶ç›´çº¿æ˜¯ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯å®ç°çš„ä»£ç ç¤ºä¾‹ï¼š QLineSeries m_series; // åˆ›å»ºä¸€ä¸ª QLineSeries å¯¹è±¡QPen green(Qt::red); // åˆ›å»ºä¸€ä¸ªçº¢è‰²çš„ç”»ç¬”green.setWidth(2); // è®¾ç½®ç”»ç¬”çš„å®½åº¦ä¸º 2 åƒç´ m_series.setPen(green); // å°†ç”»ç¬”åº”ç”¨åˆ°ç³»åˆ—ä¸Šm_series.append(m_x, m_y); // å‘æ›²çº¿æ·»åŠ æ•°æ®ç‚¹ (m_x, m_y) åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒQLineSeries ç”¨äºå­˜å‚¨ä¸€ç³»åˆ—çš„ç‚¹ï¼Œå¹¶é€šè¿‡ QPen è®¾ç½®çº¿æ¡çš„é¢œè‰²å’Œå®½åº¦ã€‚ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ append æ–¹æ³•ä¸æ–­æ·»åŠ æ–°çš„æ•°æ®ç‚¹ï¼Œä»è€ŒåŠ¨æ€æ›´æ–°å›¾è¡¨ã€‚ ç”»å¼§çº¿ä½¿ç”¨ QSplineSeries å¯ä»¥ç»˜åˆ¶å¹³æ»‘çš„å¼§çº¿ã€‚QSplineSeries é€‚åˆäºéœ€è¦å¹³æ»‘è¿‡æ¸¡çš„æ›²çº¿ï¼Œèƒ½å¤Ÿä½¿å¾—æ•°æ®ç‚¹ä¹‹é—´çš„è¿æ¥æ›´åŠ è‡ªç„¶ã€‚ æ•°å­—é‡åæ ‡ä¸ºäº†åœ¨å›¾è¡¨ä¸­æ˜¾ç¤ºæ•°å­—åæ ‡ï¼Œå¯ä»¥ä½¿ç”¨ QValueAxisã€‚ä»¥ä¸‹æ˜¯è®¾ç½®æ•°å­—åæ ‡çš„ä»£ç ç¤ºä¾‹ï¼š QValueAxis *axisX = new QValueAxis // åˆ›å»ºä¸€ä¸ªæ–°çš„ QValueAxis å¯¹è±¡axisX-setRange(0, 2000); // è®¾ç½®åæ ‡èŒƒå›´ä¸º 0 åˆ° 2000axisX-setLabelFormat(%g); // è®¾ç½®åæ ‡æ ‡ç­¾çš„æ ¼å¼axisX-setTitleText(Samples); // è®¾ç½®æ ‡è½´çš„æ ‡é¢˜ä¸º SamplesaxisX-setTickCount(5); // è®¾ç½®åæ ‡è½´ä¸Šæ˜¾ç¤ºçš„åˆ»åº¦æ•°é‡ä¸º 5 åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒsetRange æ–¹æ³•å®šä¹‰äº†åæ ‡è½´çš„æ˜¾ç¤ºèŒƒå›´ï¼Œè€Œ setTickCount æ–¹æ³•åˆ™äº†åˆ»åº¦çš„æ•°é‡ï¼Œä½¿å¾—å›¾è¡¨æ›´åŠ æ¸…æ™°æ˜“è¯»ã€‚ æ—¶é—´æ—¥æœŸåæ ‡ä½¿ç”¨ QDateTimeAxis å¯ä»¥åœ¨å›¾è¡¨ä¸­æ˜¾ç¤ºæ—¶é—´å’Œæ—¥æœŸã€‚ä»¥ä¸‹æ˜¯ç›¸å…³ä»£ç ç¤ºä¾‹ï¼š QDateTimeAxis *axisX = new QDateTimeAxis; // åˆ›å»ºä¸€ä¸ªæ–°çš„ QDateTimeAxis å¯¹è±¡axisX-setTickCount(10); // è®¾ç½®åˆ»åº¦æ•°é‡ä¸º 10axisX-setFormat(yyyy-MM-dd); // è®¾ç½®æ—¥æœŸæ ¼å¼ä¸º æœˆ å¹´axisX-setTitleText(Date); // è®¾ç½®åæ ‡è½´çš„æ ‡é¢˜ä¸º Date//è®¾ç½®åæ ‡è½´çš„å¼€å§‹äº‹ä»¶å’Œç»“æŸäº‹ä»¶QDateTime startTime = QDateTime::fromString(minValue,yyyy-MM-dd);QDateTime endTime = QDateTime::fromString(maxValue,yyyy-MM-dd);axisXDate-setRange(startTime, endTime);//ç»‘å®šåæ ‡è½´åˆ°å›¾æ ‡chart-addAxis(axisXDate, Qt::AlignBottom); // å°† X è½´æ·»åŠ åˆ°å›¾è¡¨åº•éƒ¨//ç»‘å®šåæ ‡è½´åˆ°æ›²çº¿series-attachAxis(axisXDate);//è¿½åŠ ç‚¹ä½åˆ°æ›²çº¿ä¸­å»series-append(QPointF(QDateTime::fromString(curValueX,yyyy-MM-dd).toMSecsSinceEpoch(), curValueY)); é€šè¿‡è®¾ç½®æ—¥æœŸæ ¼å¼ï¼Œç”¨æˆ·å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°æ—¶é—´çš„å˜åŒ–ï¼Œè¿™å¯¹äºæ—¶é—´åºåˆ—æ•°æ®çš„å¯è§†åŒ–å°¤ä¸ºé‡è¦ã€‚ ç®¡ç† QChartåœ¨ Qt ä¸­ï¼ŒQChart ç”¨äºç®¡ç†å’Œæ˜¾ç¤ºå›¾è¡¨ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åˆ›å»ºå’Œç®¡ç†ä¸€ä¸ªå›¾è¡¨çš„ç¤ºä¾‹ï¼š QChart *chart = new QChart(); // åˆ›å»ºä¸€ä¸ªæ–°çš„ QChart å¯¹è±¡chart-addSeries(series); // å°†æ•°æ®ç³»åˆ—æ·»åŠ åˆ°å›¾è¡¨ä¸­chart-setTitle(Sunspots count (by Space Weather Prediction Center)); // è®¾ç½®å›¾è¡¨çš„æ ‡é¢˜chart-setAxisX(axisX, series); // å°† X è½´åæ ‡æ·»åŠ åˆ°å›¾è¡¨ä¸­ è¿™é‡Œï¼ŒaddSeries æ–¹æ³•ç”¨äºå°†æ•°æ®ç³»åˆ—æ·»åŠ åˆ°å›¾è¡¨ä¸­ï¼Œè€Œ setTitle æ–¹æ³•åˆ™ä¸ºå›¾è¡¨è®¾ç½®äº†ä¸€ä¸ªæè¿°æ€§çš„æ ‡é¢˜ï¼Œå¸®åŠ©ç”¨æˆ·ç†è§£å›¾è¡¨çš„å†…å®¹ã€‚ æ›´æ–°æ›´æ–°å›¾è¡¨æ•°æ®æœ‰ä¸¤ç§æ–¹å¼ï¼š è¿½åŠ çš„æ–¹å¼æ›´æ–°ï¼šä½¿ç”¨ m_series.append(m_x, m_y); å¯ä»¥åœ¨ç°æœ‰æ•°æ®ç³»åˆ—ä¸­æ·»åŠ æ–°çš„æ•°æ®ç‚¹ã€‚ æ•´ä½“åˆ·æ–°ï¼šä½¿ç”¨ m_series-replace(m_buffer); å¯ä»¥ç”¨æ–°çš„æ•°æ®é›†æ›¿æ¢ç°æœ‰çš„æ•°æ®ã€‚ è¿™ç§çµæ´»çš„æ›´æ–°æ–¹å¼ä½¿å¾—å›¾è¡¨èƒ½å¤Ÿå®æ—¶åæ˜ æ•°æ®çš„å˜åŒ–ã€‚ åŠ¨æ€æ˜¾ç¤ºä¸ºäº†å®ç°åŠ¨æ€æ˜¾ç¤ºï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š qreal dwidth = chart-plotArea().width() / (m_axis.tickCount() * 2); // è®¡ç®—æ¯æ¬¡æ»šåŠ¨çš„å®½åº¦qreal dx = 10 / (m_axis.tickCount() * 2); // è®¡ç®—æ¨ªåæ ‡çš„åç§»é‡m_x += dx; // æ›´æ–° x åæ ‡m_y = sin(m_x); // è®¡ç®—æ–°çš„ y åæ ‡m_series.append(m_x, m_y); // æ·»åŠ æ–°çš„æ•°æ®ç‚¹// æ»¡å±ä¹‹åæ»šåŠ¨çª—å£if (m_x 10) chart-scroll(dwidth, 0); // æ»šåŠ¨å›¾è¡¨ åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå›¾è¡¨ä¼šæ ¹æ®æ•°æ®çš„å˜åŒ–åŠ¨æ€æ›´æ–°ï¼Œæä¾›å®æ—¶çš„å¯è§†åŒ–æ•ˆæœã€‚ é€šè¿‡äº‹ä»¶å¤„ç†æ¡†é€‰æ”¾å¤§é€‰ä¸­åŒºåŸŸ/// é¼ æ ‡å³é”®èœå•void WidgetPloter::mousePressEvent(QMouseEvent *event) // æ£€æŸ¥é¼ æ ‡æŒ‰ä¸‹çš„æŒ‰é’®æ˜¯å¦ä¸ºå³é”® if (event-button() == Qt::RightButton) // åœ¨é¼ æ ‡ç‚¹å‡»ä½ç½®æ˜¾ç¤ºå³é”®èœå• m_menu-exec(event-globalPos()); // æ£€æŸ¥é¼ æ ‡æŒ‰ä¸‹çš„æŒ‰é’®æ˜¯å¦ä¸ºå·¦é”® if (event-button() == Qt::LeftButton) // è®°å½•é¼ æ ‡æŒ‰ä¸‹çš„ä½ç½®ï¼Œä½œä¸ºæ¡†é€‰çš„èµ·ç‚¹ origin = event-pos(); // å¦‚æœè¿˜æ²¡æœ‰åˆ›å»ºæ©¡çš®ç­‹æ¡†ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ if (!rubberBand) rubberBand = new QRubberBand(QRubberBand::Line, this); // è®¾ç½®æ©¡çš®ç­‹æ¡†çš„å‡ ä½•å½¢çŠ¶ï¼Œåˆå§‹å¤§å°ä¸º0 rubberBand-setGeometry(QRect(origin, QSize())); // æ˜¾ç¤ºæ©¡çš®ç­‹æ¡† rubberBand-show(); // è¿™é‡Œå¯ä»¥è®¾ç½®æ©¡çš®ç­‹æ¡†çš„ç±»å‹ä¸ºçŸ©å½¢ï¼Œå…è®¸åœ¨XYæ–¹å‘ä¸Šæ”¾å¤§ // this-setRubberBand(QChartView::RectangleRubberBand);void WidgetPloter::mouseMoveEvent(QMouseEvent *event) // å¦‚æœæ©¡çš®ç­‹æ¡†å­˜åœ¨ï¼Œåˆ™æ›´æ–°å…¶å‡ ä½•å½¢çŠ¶ if (rubberBand) // æ ¹æ®èµ·å§‹ç‚¹å’Œå½“å‰é¼ æ ‡ä½ç½®è®¡ç®—å¹¶è®¾ç½®æ©¡çš®ç­‹æ¡†çš„å¤§å° rubberBand-set(QRect(origin, event-pos()).normalized()); void WidgetPloter::mouseReleaseEvent(QMouseEvent *event) // å½“é¼ æ ‡é‡Šæ”¾æ—¶ï¼Œæ£€æŸ¥æ©¡çš®ç­‹æ¡†æ˜¯å¦å­˜åœ¨ if (rubberBand) // éšè—æ©¡çš®ç­‹æ¡† rubberBand-hide(); // ä½¿ç”¨é€‰å®šçš„çŸ©å½¢åŒºåŸŸè¿›è¡Œç¼©æ”¾ m_plot-zoomIn(QRect(origin, event-pos()).normalized()); // ä¸‹é¢çš„ä»£ç æ˜¯ä¸€äº›å¯é€‰çš„ç¼©æ”¾æ“ä½œç¤ºä¾‹ // m_plot-scroll10, 5); // æ•´ä½“å¹³ç§»ï¼Œå‚æ•°åˆ†åˆ«ä¸ºÎ”xå’ŒÎ”y // m_plot-zoom(0.9); // æ•´ä½“ç¼©æ”¾ï¼Œå‚æ•°ä¸ºæ”¾ç¼©ç³»æ•°ï¼Œ1ä»£è¡¨ç¼©å°ï¼Œ1ä»£è¡¨æ”¾å¤§ // m_plot-zoomReset(); // æ’¤é”€æ‰€æœ‰ç¼©æ”¾æ“ä½œ // ä¸‹é¢çš„ä»£ç å¯ä»¥è®¾ç½®Xè½´å’ŒYè½´çš„èŒƒå›´ // m_axisX-setRange(origin.x() - this-pos().x(), event-pos().x() - this-pos().x()); // m_axisY-setRange(event-pos().y() - this-pos().y(), origin.y() - this-pos().y()); // è°ƒè¯•ä¿¡æ¯ï¼Œè¾“å‡ºå½“å‰çŸ©å½¢å’Œé¼ æ ‡ä½ç½® // qDebug() this-rect().x() this-rect().y() this-rect().width() this-rect().height() origin.x() origin.y() event-pos().x() event-pos().y(); ä»£ç è¯´æ˜ é¼ æ ‡äº‹ä»¶å¤„ç†ï¼š mousePressEventï¼šå¤„ç†é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶ï¼Œå³é”®æ˜¾ç¤ºèœå•ï¼Œå·¦é”®å¼€å§‹æ¡†é€‰ã€‚ mouseMoveEventï¼šå®æ—¶æ›´æ–°æ©¡çš®ç­‹æ¡†çš„å¤§å°ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥çœ‹åˆ°å½“å‰é€‰ä¸­çš„åŒºåŸŸã€‚ mouseReleaseEventï¼šå½“ç”¨æˆ·é‡Šæ”¾é¼ æ ‡æ—¶ï¼Œéšè—æ©¡çš®ç­‹æ¡†ï¼Œå¹¶æ ¹æ®é€‰å®šçš„åŒºåŸŸè¿›è¡Œç¼©æ”¾ã€‚ æ©¡çš®ç­‹æ¡†ï¼š ä½¿ç”¨ QRubberBand ç±»åˆ›å»ºä¸€ä¸ªå¯è§†åŒ–çš„æ¡†é€‰æ•ˆæœï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ‹–åŠ¨é¼ æ ‡é€‰æ‹©åŒºåŸŸã€‚ ç¼©æ”¾åŠŸèƒ½ï¼š zoomIn æ–¹æ³•æ ¹æ®ç”¨æˆ·é€‰å®šçš„çŸ©å½¢åŒºåŸŸè¿›è¡Œç¼©æ”¾ï¼Œæä¾›æ›´ç›´è§‚çš„æ•°æ®æŸ¥çœ‹æ–¹å¼ã€‚ è°ƒè¯•ä¿¡æ¯ï¼š ä½¿ç”¨ qDebug() è¾“å‡ºå½“å‰çŠ¶æ€ï¼Œä¾¿äºå¼€å‘è€…è°ƒè¯•å’Œç†è§£ç¨‹åºè¿è¡Œæƒ…å†µã€‚ é€šè¿‡è¿™äº›ç»†èŠ‚ï¼Œè¯»è€…å¯ä»¥æ›´å¥½åœ°ç†è§£æ¯ä¸ªéƒ¨åˆ†çš„åŠŸèƒ½å’Œä½œç”¨ï¼Œå³ä½¿å¯¹ä»£ç ä¸å¤Ÿç†Ÿæ‚‰ï¼Œä¹Ÿèƒ½æ„Ÿå—åˆ°æ•´ä½“çš„é€»è¾‘å’Œè®¾è®¡æ€è·¯ã€‚","categories":["3.å¼€å‘æ¡†æ¶","Qt","ç»˜å›¾"]},{"title":"è”ç½‘è·å–æ•°æ®å¹¶é€šè¿‡Jsonå’Œæ­£åˆ™è¿›è¡Œè§£æ","path":"/2025/02/24/3-å¼€å‘æ¡†æ¶-Qt-Project-ETFæ•°æ®è·å–åŠåˆ†æ/","content":"#ifndef NETDRIVER_H#define NETDRIVER_H#include QObject#include QApplication#include QNetworkAccessManager#include QNetworkReply#include QRegularExpression#include QRegularExpressionMatch#include QJsonDocument#include QJsonObject#include QThread#include blackboard.h// å®šä¹‰æ¶ˆæ¯ç±»å‹çš„å¸¸é‡#define EMPTY_MSG 1 // ç©ºæ¶ˆæ¯#define NETVALUE_MSG 2 // ç½‘ç»œå€¼æ¶ˆæ¯#define HISTORY_MSG 3 // å†å²æ¶ˆæ¯#define STBY_MSG 4 // å¾…æœºæ¶ˆæ¯class NetDriver : public QObject Q_OBJECTpublic: NetDriver(); // æ„é€ å‡½æ•° // å•ä¾‹æ¨¡å¼è·å–å®ä¾‹ static NetDriver* getIns() static NetDriver *ins = nullptr; // é™æ€æŒ‡é’ˆï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹ if(ins == nullptr) ins = new NetDriver(); // å¦‚æœå®ä¾‹ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ return ins; // è¿”å›å®ä¾‹ // æ›´æ–°ç½‘ç»œå€¼å’Œå†å²æ•°æ®çš„å‡½æ•° void updateNetValue(MSG_CONTENT *); void updateHistory(MSG_CONTENT *); QNetworkAccessManager m_AccessManager; // ç½‘ç»œè®¿é—®ç®¡ç†å™¨ QNetworkRequest m_Request; // ç½‘ç»œè¯·æ±‚å¯¹è±¡ QString todaySub; // ä»Šæ—¥æ•°æ®çš„URLæ¨¡æ¿ QString historySub; // å†å²æ•°æ®çš„URLæ¨¡æ¿ int retMsgType = 0; // è¿”å›æ¶ˆæ¯ç±»å‹ MSG_CONTENT *msg_content_p; // æŒ‡å‘æ¶ˆæ¯å†…å®¹çš„æŒ‡é’ˆprivate slots: void analysisGet(QNetworkReply *reply); // å¤„ç†ç½‘ç»œè¿”å›æ•°æ®çš„æ§½å‡½æ•°;#endif // NETDRIVER_H #include netdriver.h// æ„é€ å‡½æ•°å®ç°NetDriver::NetDriver() // è®¾ç½®ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²ï¼Œæ¨¡æ‹Ÿæµè§ˆå™¨è¯·æ±‚ QString agent = xxxxxxxxxxxxxxxx; // è®¾ç½®æˆæƒå¤´éƒ¨ï¼Œä½¿ç”¨Bearer Tokenè¿›è¡Œèº«ä»½éªŒè¯ QByteArray authHeaderData = xxxxxxxxx; // è®¾ç½®Cookieå¤´éƒ¨ï¼Œæ¨¡æ‹Ÿç”¨æˆ·ä¼šè¯ QByteArray cookieHeaderData = xxxxxxxxxx; // è®¾ç½®è¯·æ±‚å¤´éƒ¨ m_Request.setRawHeader(QByteArray(User-Agent), agent.toUtf8()); m_Request.setRawHeader(QByteArray(Authorization), authHeaderData); m_Request.setRawHeader(QByteArray(Cookie), cookieHeaderData); // åˆå§‹åŒ–ä»Šæ—¥æ•°æ®å’Œå†å²æ•°æ®çš„URLæ¨¡æ¿ todaySub = https://xxxxxxxxxx/%1.js; // %1å°†è¢«æ›¿æ¢ä¸ºåŸºé‡‘ä»£ç  historySub = http://xxxxxxxxx/%1.js; // %1å°†è¢«æ›¿æ¢ä¸ºåŸºé‡‘ä»£ç  // è¿æ¥ç½‘ç»œè¯·æ±‚å®Œæˆä¿¡å·åˆ°æ•°æ®åˆ†ææ§½å‡½æ•° connect(m_AccessManager, QNetworkAccessManager::finished, this, NetDriver::analysisGet);// æ›´æ–°ç½‘ç»œå€¼çš„å‡½æ•°å®ç°void NetDriver::updateNetValue(MSG_CONTENT* msg_code) msg_content_p = msg_code; // ä¿å­˜æ¶ˆæ¯å†…å®¹æŒ‡é’ˆ retMsgType = NETVALUE_MSG; // è®¾ç½®è¿”å›æ¶ˆæ¯ç±»å‹ä¸ºç½‘ç»œå€¼æ¶ˆæ¯ QString urlStr = todaySub.arg(msg_code-code); // æ ¹æ®åŸºé‡‘ä»£ç ç”Ÿæˆè¯·æ±‚URL m_Request.setUrl(urlStr); // è®¾ç½®è¯·æ±‚çš„URL m_AccessManager.get(m_Request); // å‘é€GETè¯·æ±‚ int timeoutIndex = 0; // è¶…æ—¶è®¡æ•°å™¨ while(retMsgType != STBY_MSG timeoutIndex 100) // å¦‚æœæœªæ”¶åˆ°åº”ç­”ä¸”æœªè¶…æ—¶ QApplication::processEvents(); // å¤„ç†äº‹ä»¶ï¼Œä¿æŒåº”ç”¨å“åº” QThread::msleep(50); // æš‚åœ50æ¯«ç§’ timeoutIndex++; // å¢åŠ è®¡æ•°å™¨ // å¦‚æœè¶…æ—¶ï¼Œè®¾ç½®é”™è¯¯ä¿¡æ¯ if(timeoutIndex = 100) msg_code-name = ç½‘ç»œè¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•ï¼; // æç¤ºç”¨æˆ·ç½‘ç»œè¶…æ—¶ /** * @brief NetDriver::updateHistory * @param code * é˜»å¡å‡½æ•°ï¼Œè°ƒç”¨åä¼šç­‰å¾…ç½‘ç»œè¿”å›æ•°æ® */void NetDriver::updateHistory(MSG_CONTENT* msg_code) msg_content_p = msg_code; // ä¿å­˜æ¶ˆæ¯å†…å®¹æŒ‡é’ˆ retMsgType = HISTORY_MSG; // è®¾ç½®è¿”å›æ¶ˆæ¯ç±»å‹ä¸ºå†å²æ¶ˆæ¯ QString urlStr = historySub.arg(msg_code-code); // æ ¹æ®åŸºé‡‘ä»£ç ç”Ÿæˆè¯·æ±‚URL m_Request.setUrl(urlStr); // è®¾ç½®è¯·æ±‚çš„URL m_AccessManager.get(m_Request); // å‘é€GETè¯·æ±‚ int timeoutIndex = 0; // è¶…æ—¶è®¡æ•°å™¨ while(retMsgType != STBY_MSG timeoutIndex 100) // å¦‚æœæœªæ”¶åˆ°åº”ç­”ä¸”æœªè¶…æ—¶ QApplication::processEvents(); // å¤„ç†äº‹ä»¶ï¼Œä¿æŒåº”ç”¨å“åº” QThread::msleep(50); // æš‚åœ50æ¯«ç§’ timeoutIndex++; // å¢åŠ è®¡æ•°å™¨ // å¦‚æœè¶…æ—¶ï¼Œè®¾ç½®é”™è¯¯ä¿¡æ¯ if(timeoutIndex = 100) msg_code-name = ç½‘ç»œè¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•ï¼; // æç¤ºç”¨æˆ·ç½‘ç»œè¶…æ—¶ /** * @brief NetDriver::analysisGet * @param reply * åˆ†æç½‘ç»œè¿”å›çš„æ•°æ®ï¼Œå¹¶è§£ææˆéœ€è¦ä¿å­˜çš„æ ¼å¼ */void NetDriver::analysisGet(QNetworkReply *reply) // æ£€æŸ¥ç½‘ç»œè¯·æ±‚æ˜¯å¦å‡ºé”™ if (reply-error() != QNetworkReply::NoError) reply-deleteLater(); // åˆ é™¤replyå¯¹è±¡ï¼Œé‡Šæ”¾èµ„æº return; // é€€å‡ºå‡½æ•° // æ ¹æ®è¿”å›çš„æ¶ˆæ¯ç±»å‹è¿›è¡Œä¸åŒçš„å¤„ç† switch (retMsgType) case NETVALUE_MSG: // å¤„ç†ç½‘ç»œå€¼æ¶ˆæ¯ QString data = QString::fromUtf8(reply-readAll()); // è¯»å–è¿”å›çš„æ•°æ® QRegularExpression re(jsonpgz\\\\((.*)\\\\)); // æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…JSONæ•°æ® QRegularExpressionMatch match = re.match(data); // æ‰§è¡ŒåŒ¹é… if (match.hasMatch()) // å¦‚æœåŒ¹é…æˆåŠŸ QString jsonStr = match.captured(1); // è·å–JSONå­—ç¬¦ä¸² QJsonDocument jsonDoc = QJsonDocument::fromJson(jsonStr.toUtf8()); // è§£æJSONæ–‡æ¡£ QJsonObject jsonObj = jsonDoc.object(); // è·å–JSONå¯¹è±¡ // æå–æ‰€éœ€æ•°æ®å¹¶ä¿å­˜åˆ°msg_content_pä¸­ msg_content_p-code = jsonObj[fundcode].toString(); // åŸºé‡‘ä»£ç  msg_content_p-name = jsonObj[name].toString(); // åŸºé‡‘åç§° msg_content_p-lastNetValue = jsonObj[gsz].toString(); // æœ€æ–°å‡€å€¼ msg_content_p-lastPercent = jsonObj[gszzl].toString() + %; // æœ€æ–°æ¶¨å¹… msg_content_p-lastTime = jsonObj[gztime].toString(); // æ›´æ–°æ—¶é—´ break; case HISTORY_MSG: // å¤„ç†å†å²æ¶ˆæ¯ QByteArray data = reply-readAll(); // è¯»å–è¿”å›çš„æ•°æ® // æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å†å²æ•°æ® QRegularExpression re(\\\\\\x\\:(\\\\d+),\\y\\:([\\\\d.]+),\\equityReturn\\:([\\\\-\\\\d.]+),\\unitMoney\\:\\([^\\]*)\\\\\\); QRegularExpressionMatchIterator match_it = re.globalMatch(data); // è·å–æ‰€æœ‰åŒ¹é…é¡¹ // æ¸…ç©ºå†å²æ•°æ® msg_content_p-hisDate.clear(); msg_content_p-hisNetValue.clear(); msg_content_p-hisPercent.clear(); // éå†æ‰€æœ‰åŒ¹é…é¡¹å¹¶æå–æ•°æ® while (match_it.hasNext()) QRegularExpressionMatch match = match_it.next(); // è·å–ä¸‹ä¸€ä¸ªåŒ¹é…é¡¹ // å°†åŒ¹é…çš„æ•°æ®è½¬æ¢å¹¶ä¿å­˜ msg_content_p-hisDate.append(QDateTime::fromMSecsSinceEpoch(match.captured(1).toULongLong()).date().toString(yyyy-MM-dd)); // æ—¥æœŸ msg_content_p-hisNetValue.append(match.captured(2)); // å‡€å€¼ msg_content_p-hisPercent.append(match.captured(3)); // æ¶¨å¹… break; retMsgType = STBY_MSG; // é‡ç½®æ¶ˆæ¯ç±»å‹ä¸ºå¾…æœºçŠ¶æ€ reply-deleteLater(); // åˆ é™¤replyå¯¹è±¡ï¼Œé‡Šæ”¾èµ„æº","categories":["3.å¼€å‘æ¡†æ¶","Qt"]},{"title":"é“¾è¡¨å’Œæ•°ç»„çš„æ•°æ®å­˜å–æ–¹å¼","path":"/2025/02/24/2-ç¼–ç¨‹è¯­è¨€-ç»“æ„ç®—æ³•-é“¾è¡¨å’Œæ•°ç»„çš„æ•°æ®å­˜å–æ–¹å¼/","content":"BlackBoardArray ç±»å®ç°äº†ä¸€ä¸ªç®€å•çš„æ•°ç»„ç»“æ„æ¥å­˜å‚¨æ•°æ®ï¼Œè€Œ BlackBoardLinkList ç±»åˆ™ä½¿ç”¨é“¾è¡¨ç»“æ„æ¥å­˜å‚¨æ•°æ®ã€‚æ¯ä¸ªç±»éƒ½å®ç°äº† writeã€read å’Œ size æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å®‰å…¨åœ°è¯»å†™æ•°æ®ã€‚é€šè¿‡ä½¿ç”¨ QMutex å’Œ QMutexLockerï¼Œç¡®ä¿äº†å¯¹å…±äº«æ•°æ®çš„è®¿é—®æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ #ifndef BLACKBOARD_H#define BLACKBOARD_H#include QObject#include QByteArray#include QMutex#include QMutexLocker#include DriverDefines.h// å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œè¡¨ç¤ºé»‘æ¿èŠ‚ç‚¹struct BlackBoardNode QByteArray bytedata; // å­˜å‚¨æ•°æ®çš„å­—èŠ‚æ•°ç»„ BlackBoardNode *next; // æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ // æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–èŠ‚ç‚¹æ•°æ®å’ŒæŒ‡é’ˆ BlackBoardNode(QByteArray insertNode) : bytedata(insertNode), next(nullptr) ;// é»‘æ¿åŸºç±»ï¼Œæä¾›åŸºæœ¬çš„è¯»å†™æ¥å£class BlackBoard public: BlackBoard() return; // é»˜è®¤æ„é€ å‡½æ•° // çº¯è™šå‡½æ•°ï¼Œå­ç±»å¿…é¡»å®ç° virtual void write(QByteArray) = 0; // å†™å…¥æ•°æ® virtual QByteArray read() = 0; // è¯»å–æ•°æ® int size() // è·å–å½“å‰æ•°æ®å¤§å° QMutexLocker locker(mutex); // ç¡®ä¿çº¿ç¨‹å®‰å…¨ return sizeCount; // è¿”å›å½“å‰æ•°æ®å¤§å° protected: QMutex mutex; // äº’æ–¥é”ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ int sizeCount = 0; // è®°å½•å½“å‰æ•°æ®æ•°é‡;// é»‘æ¿æ•°ç»„ç±»ï¼Œç»§æ‰¿è‡ªé»‘æ¿åŸºç±»class BlackBoardArray : public BlackBoard private:\tQVectorQByteArray dataArray;public: void write(QByteArray); // å†™å…¥æ•°æ® QByteArray read(); // è¯»å–æ•°æ®;// é»‘æ¿é“¾è¡¨ç±»ï¼Œç»§æ‰¿è‡ªé»‘æ¿åŸºç±»class BlackBoardLinkList : public BlackBoard private: BlackBoardNode *head = nullptr; // é“¾è¡¨å¤´æŒ‡é’ˆ BlackBoardNode *tail = nullptr; // é“¾è¡¨å°¾æŒ‡é’ˆpublic: void write(QByteArray); // å†™å…¥æ•°æ® QByteArray read(); // è¯»å–æ•°æ®;#endif // BLACKBOARD_H #include blackboard.h// åœ¨é»‘æ¿æ•°ç»„ä¸­å†™å…¥æ•°æ®void BlackBoardArray::write(QByteArray insertNode) QMutexLocker locker(mutex); // ç¡®ä¿çº¿ç¨‹å®‰å…¨ // è¿™é‡Œå¯ä»¥å®ç°ä¸€ä¸ªåŠ¨æ€æ•°ç»„ï¼Œå­˜å‚¨æ•°æ® dataArray.append(insertNode); // å°†æ•°æ®æ·»åŠ åˆ°æ•°ç»„ä¸­ sizeCount++; // æ›´æ–°æ•°æ®å¤§å°è®¡æ•°// ä»é»‘æ¿æ•°ç»„ä¸­è¯»å–æ•°æ®QByteArray BlackBoardArray::read() QMutexLocker locker(mutex); // ç¡®ä¿çº¿ç¨‹å®‰å…¨ if (dataArray.isEmpty()) return QByteArray(); // å¦‚æœæ•°ç»„ä¸ºç©ºï¼Œè¿”å›ç©ºå­—èŠ‚æ•°ç»„ QByteArray data = dataArray.takeFirst(); // å–å‡ºç¬¬ä¸€ä¸ªå…ƒç´  sizeCount--; // æ›´æ–°æ•°æ®å¤§å°è®¡æ•° return data; // è¿”å›è¯»å–çš„æ•°æ®// åœ¨é»‘æ¿é“¾è¡¨ä¸­å†™å…¥æ•°æ®void BlackBoardLinkList::write(QByteArray insertNode) QMutexLocker locker(mutex); // ç¡®ä¿çº¿ç¨‹å®‰å…¨ BlackBoardNode *newNode = new BlackBoardNode(insertNode); // åˆ›å»ºæ–°èŠ‚ç‚¹ if (!head) // å¦‚æœé“¾è¡¨ä¸ºç©º head = tail = newNode; // æ–°èŠ‚ç‚¹æ—¢æ˜¯å¤´ä¹Ÿæ˜¯å°¾ else tail-next = newNode; // å°†æ–°èŠ‚ç‚¹é“¾æ¥åˆ°é“¾è¡¨å°¾éƒ¨ tail = newNode; // æ›´æ–°å°¾æŒ‡é’ˆ sizeCount++; // æ›´æ–°æ•°æ®å¤§å°è®¡æ•°// ä»é»‘æ¿é“¾è¡¨ä¸­è¯»å–æ•°æ®QByteArray BlackBoardLinkList::read() QMutexLocker locker(mutex); // ç¡®ä¿çº¿ç¨‹å®‰å…¨ QByteArray getData; if (!head) // å¦‚æœé“¾è¡¨ä¸ºç©º return getData; // è¿”å›ç©ºå­—èŠ‚æ•°ç»„ getData = head-bytedata; // è·å–å¤´èŠ‚ç‚¹çš„æ•°æ® BlackBoardNode *tmp = head; // ä¸´æ—¶ä¿å­˜å¤´èŠ‚ç‚¹ head = head-next; // æ›´æ–°å¤´æŒ‡é’ˆ if (!head) // å¦‚æœé“¾è¡¨å˜ä¸ºç©º tail = nullptr; // æ›´æ–°å°¾æŒ‡é’ˆ delete tmp; // åˆ é™¤æ—§çš„å¤´èŠ‚ç‚¹ sizeCount--; // æ›´æ–°æ•°æ®å¤§å°è®¡æ•° return getData; // è¿”å›è¯»å–çš„æ•°æ®","categories":["2.ç¼–ç¨‹è¯­è¨€","ç»“æ„ç®—æ³•"]},{"title":"G-code - RepRap","path":"/2025/02/24/5-åµŒå…¥å¼å¼€å‘-ç¡¬ä»¶çŸ¥è¯†-3Dæ‰“å°-G-code-RepRap/","content":"æœ‰å‡ ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥ä¸ºæ‰“å°æœºå‡†å¤‡ G-codeã€‚ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨åˆ‡ç‰‡ç¨‹åºï¼Œä¾‹å¦‚ Slic3rã€Skeinforge æˆ– Curaã€‚è¿™äº›ç¨‹åºå¯¼å…¥ CAD æ¨¡å‹ï¼Œå°†å…¶åˆ‡ç‰‡æˆå±‚ï¼Œå¹¶è¾“å‡ºæ‰“å°æ¯ä¸€å±‚æ‰€éœ€çš„ G-codeã€‚åˆ‡ç‰‡å™¨æ˜¯ä» 3D æ¨¡å‹åˆ°æ‰“å°éƒ¨ä»¶çš„æœ€ç®€å•æ–¹æ³•ï¼Œä½†ä½¿ç”¨å®ƒä»¬æ—¶ç”¨æˆ·ä¼šç‰ºç‰²ä¸€äº›çµæ´»æ€§ã€‚å¦ä¸€ç§ G-code ç”Ÿæˆé€‰é¡¹æ˜¯ä½¿ç”¨åƒ mecode è¿™æ ·çš„ä½çº§åº“ã€‚åƒ mecode è¿™æ ·çš„åº“å¯ä»¥è®©æ‚¨ç²¾ç¡®æ§åˆ¶å·¥å…·è·¯å¾„ï¼Œå› æ­¤å¦‚æœæ‚¨æœ‰ä¸€ä¸ªä¸é€‚åˆç®€å•åˆ‡ç‰‡çš„å¤æ‚æ‰“å°ï¼Œå®ƒä»¬ä¼šå¾ˆæœ‰ç”¨ã€‚æœ€åä¸€ä¸ªé€‰é¡¹æ˜¯è‡ªå·±ç¼–å†™ G-codeã€‚å¦‚æœæ‚¨åªéœ€è¦åœ¨æ ¡å‡†æ‰“å°æœºæ—¶è¿è¡Œå‡ è¡Œæµ‹è¯•ä»£ç ï¼Œè¿™å¯èƒ½æ˜¯æœ€ä½³é€‰æ‹©ã€‚ IntroductionA typical piece of G-code as sent to a RepRap machine might look like this: N3 T0*57N4 G92 E0*67N5 G28*22N6 G1 F1500.0*82N7 G1 X2.0 Y2.0 F3000.0*85N8 G1 X3.0 Y3.0*33 G-code can also be stored in files on SD cards. A file containing RepRap G-code usually has the extension .g, .gco or .gcode. Files for BFBRapMan have the extension .bfb. G-code stored in file or produced by a slicer might look like this: G92 E0G28G1 F1500G1 X2.0 Y2.0 F3000G1 X3.0 Y3.0 The meaning of all those symbols and numbers (and more) is explained below. Slicers will (optionally?) add G-code scripts to the beginning and end of their output file to perform specified actions before andor after a print such as z-probing the build-area, heatingcooling the bed and hotend, performing ooze free â€œnozzle wipeâ€ startup routine, switching system power onoff, and even â€œejectingâ€ parts. More info on the Start GCode routines and End GCode routines pages. To find out which specific G-code(s) are implemented in any given firmware, there are little tables attached to the command descriptions, like this one: Here means: ??? Unknown if the firmware supports this G-code. You may want to test this yourself before using it in production. Yes The G-code is fully supported by the firmware. 1.23+ The G-code is supported by version 1.23 and above. No The firmware does not support the G-code at all. Partial There is only partial support for the full G-code specification. It may be required to rebuild the source code with extra options or flip configuration switches on the mainboard. Experimental The G-code is experimental and may change or be removed. Automatic The firmware handles this G-code automatically, so thereâ€™s no need to send the command. An example is power supply onoff G-code (M80M81) in the Teacup firmware. For the technically-minded, G-code line endings are Unix Line Endings ( ), but will accept Windows Line Endings (\\r ), so you should not need to worry about converting between the two, but it is best practice to use Unix Line Endings where possible. FieldsA RepRap G-code is a list of fields that are separated by white spaces or line breaks. A field can be interpreted as a command, parameter, or for any other special purpose. It consists of one letter directly followed by a number, or can be only a stand-alone letter (Flag). The letter gives information about the meaning of the field (see the list below in this section). Numbers can be integers (128) or fractional numbers (12.42), depending on context. For example, an X coordinate can take integers (X175) or fractionals (X17.62), but selecting extruder number 2.76 would make no sense. In this description, the numbers in the fields are represented by nnn as a placeholder. In RepRapFirmware, some parameters can be followed by more than one number, with colon used to separate them. Typically this is used to specify extruder parameters, with one value provided per extruder. If only one value is provided where a value is needed for each extruder, then that value is applied to all extruders. Letter Meaning Gnnn Standard G-code command, such as move to a point Mnnn RepRap-defined command, such as turn on a cooling fan Tnnn Select tool nnn. In RepRap, a tool is typically associated with a nozzle, which may be fed by one or more extruders. Snnn Command parameter, such as time in seconds; temperatures; voltage to send to a motor Pnnn Command parameter, such as time in milliseconds; proportional (Kp) in PID Tuning Xnnn A X coordinate, usually to move to. This can be an Integer or Fractional number. Ynnn A Y coordinate, usually to move to. This can be an Integer or Fractional number. Znnn A Z coordinate, usually to move to. This can be an Integer or Fractional number. U,V,W Additional axis coordinates (RepRapFirmware) Innn Parameter - X-offset in arc move; integral (Ki) in PID Tuning Jnnn Parameter - Y-offset in arc move Dnnn Parameter - used for diameter; derivative (Kd) in PID Tuning Hnnn Parameter - used for heater number in PID Tuning Fnnn Feedrate in mm per minute. (Speed of print head movement) Rnnn Parameter - used for temperatures Qnnn Parameter - not currently used Ennn Length of extrudate. This is exactly like X, Y and Z, but for the length of filament to consume. Nnnn Line number. Used to request repeat transmission in the case of communications errors. *nnn Checksum. Used to check for communications errors. Case sensitivityThe original NIST G-code standard requires gcode interpreters to be case-insensitive, except for characters in comments. However, not all 3D printer firmwares conform to this and some recognise uppercase command letters and parameters only. Firmwares that are known to be case-insensitive RepRapFirmware version 1.19 and later (except within quoted strings) Druid Firmware version 1.00 by default is case-insensitive: ( M544 S0 case-sensitive M544 S1 case-insensitive ) Firmwares that are known to be case-sensitive RepRapFirmware version 1.18 and earlier Druid Firmware version 1.00 for case-sensitive: M544 S0 case-sensitive Quoted stringsIn RepRapFirmware, some commands support quoted strings when providing file names and other string parameters. This allows file names, WiFi passwords etc. to contain spaces, semicolons and other characters that would otherwise not be permitted. Double-quote characters are used to delimit the string, and any double-quote character within the string must be repeated. Unfortunately, some gcode sender programs convert all characters to uppercase and donâ€™t provide any means to disable this feature. Therefore, within a quoted-string, the single-quote character is used as a flag to force the following character to lowercase. If you want to include a single quote character in the string, use two single quote characters to represent one single quote character. Example: to add SSID MYROUTER with password ABCxyz; 123 to the WiFi network list, use command: M587 SMYROUTER PABCxyz; 123 or if you canâ€™t send lowercase characters: M587 SMYROUTER PABCXYZ; 123 Using expressions in parametersRepRapFirmware 3.1 and later allow parameter values to be computed from an expression enclosed in { }. Such an expression may include constants, values from the machine object model, operators and functions. Example: G1 Xmove.axes[0].max-5 Ymove.axes[1].min+5 F6000Â ; move to 5mm short of the X and Y axis limits See https://docs.duet3d.com/en/User_manualReferenceGcode_meta_commands for more details. G-code comments begin at a semicolon, and end at the end of the line: N3 T0*57Â ; This is a commentN4 G92 E0*67; So is thisN5 G28*22 Some firmwares also obey the CNC G-code standard, which is to enclose comments in round brackets. Comments of this form must start and end on the same line: (Home some axes)G28 (here come the axes to be homed) X Y Comments and white space will be ignored by your RepRap Printer. Itâ€™s better to strip these out on the host computer before sending the G-code to your printer, as this saves bandwidth. Special fieldsN: Line numberExample N123 If present, the line number should be the first field in a line. For G-code stored in files on SD cards the line number is usually omitted. If checking is supported, the RepRap firmware expects line numbers to increase by 1 each line, and if that doesnâ€™t happen it is flagged as an error. But you can reset the count using M110 (see below). Although supported, usage of N in Machinekit is discouraged as it serves no purpose. *: ChecksumExample: *71 If present, the checksum should be the last field in a line, but before a comment. For G-code stored in files on SD cards the checksum is usually omitted. The firmware compares the checksum against a locally-computed value. If they differ, it requests a repeat transmission of the line. *: CRCExample: *37428 The 8-bit checksum provides insufficient protection against noise on the received data connection in some situations, for example where the cable from a display device runs close to an extruder cable. Therefore RepRapFirmware allows a CRC to be used in place of a checksum. If present, the CRC should be the last field in a line, but before the semicolon and comment if present. RepRapFirmware assumes that * followed by 5 digits is a CRC, whereas * followed by 1, 2 or 3 digits is a checksum. The polynomial used is 0x1021 as for CCITT CRC16. CheckingExample N123 [...G Code in here...] *71 The RepRap firmware checks the line number and the checksum (or CRC if supported). You can leave both of these out - RepRap will still work, but it wonâ€™t do checking. You have to have both or neither though. If only one appears, it produces an error. The checksum â€œcsâ€ for a G-code string â€œcmdâ€ (including its line number) is computed by exor-ing the bytes in the string up to and not including the * character as follows: int cs = 0;for(i = 0; cmd[i]Â != * cmd[i]Â != NULL; i++) cs = cs ^ cmd[i];cs = 0xff; // Defensive programming... and the value is appended as a decimal integer to the command after the * character. Conditional Execution and LoopsRepRapFirmware 3.01 and later supports conditions and loops in GCode. Properties from the firmware object model (e.g. current position, current tool) can be included in controlling expressions. See https://docs.duet3d.com/en/User_manualReferenceGcode_meta_commands for details. BufferingIf buffering is supported, the RepRap firmware stores some commands in a ring buffer internally for execution. This means that there is no (appreciable) delay while a command is acknowledged and the next transmitted. In turn, this means that sequences of line segments can be plotted without a dwell between one and the next. As soon as one of these buffered commands is received it is acknowledged and stored locally. If the local buffer is full, then the acknowledgment is delayed until space for storage in the buffer is available. This is how flow control is achieved. Typically, the following moving commands are buffered: G0-G3 and G28-G32. The Teacup Firmware buffers also some setting commands: G20, G21, G90 and G91. All other G, M or T commands are not buffered. RepRapFirmware also implements an internal queue to ensure that certain codes (like M106) are executed in the right order and not when the last move has been added to the look-ahead queue. When an unbuffered command is received it is stored, but it is not acknowledged to the host until the buffer is exhausted and then the command has been executed. Thus the host will pause at one of these commands until it has been done. Short pauses between these commands and any that might follow them do not affect the performance of the machine. G-commandsG0 G1: Move G0Â : Rapid Move G1Â : Linear Move Usage G0 Xnnn Ynnn Znnn Ennn Fnnn Snnn G1 Xnnn Ynnn Znnn Ennn Fnnn Snnn Parameters Not all parameters need to be used, but at least one has to be used Xnnn The position to move to on the X axis Ynnn The position to move to on the Y axis Znnn The position to move to on the Z axis Ennn The amount to extrude between the starting point and ending point Fnnn The feedrate per minute of the move between the starting point and ending point (if supplied) Hnnn (RepRapFirmware) Flag to check if an endstop was hit (H1 to check, H0 to ignore, other Hnnn see note, default is H0)1 Rnnn (RepRapFirmware) Restore point number 4 Snnn Laser cutterengraver power. In RepRapFirmware, when not in laser mode S in interpreted the same as H. Examples G0 X12 ; move to 12mm on the X axisG0 F1500 ; Set the feedrate to 1500mm/minG1 X90.6 Y13.8 E22.4Â ; Move to 90.6mm on the X axis and 13.8mm on the Y axis while extruding 22.4mm of material The RepRap firmware spec treats G0 and G1 as the same command, since itâ€™s just as efficient as not doing so.2 Most RepRap firmwares do subtle things with feedrates. G1 F1500 ; Set feedrate to 1500mm/minG1 X50 Y25.3 E22.4Â ; Move and extrude In the above example, we first set the feedrate to 1500mmmin, then move to 50mm on X and 25.3mm on Y while extruding 22.4mm of filament between the two points. G1 F1500 ; Feedrate 1500mm/minG1 X50 Y25.3 E22.4 F3000Â ; Accelerate to 3000mm/min However, in the above example, we set a feedrate of 1500 mmmin, then do the same move, but accelerating to 3000 mmmin. Everything stays synchronized, so extrusion accelerates right along with X and Y movement. The RepRap spec treats the feedrate as simply another variable (like X, Y, Z, and E) to be linearly interpolated. This gives complete control over the acceleration and deceleration of the printer head in a way that ensures everything moves smoothly together and the right volume of material is extruded at all points.3 To reverse the extruder by a given amount (for example to reduce its internal pressure while it does an in-air movement so that it doesnâ€™t dribble) simply use G0 or G1 to send an E value that is less than the currently extruded length. Notes 1Some firmwares allow for the RepRap to enable or disable the â€œsensingâ€ of endstops during a move. Please check with whatever firmware you are using to see if they support the H parameter in this way, as damage may occur if you assume incorrectly. In RepRapFirmware, using the H1 or H2 parameter on a delta printer causes the XYZ parameters to refer to the individual tower motor positions instead of the head position, and to enable endstop detection as well if the parameter is H1. H3 may be used to measure axis lengths and H4 can be used to stop when an endstop is hit while updating the position only (H4 is supported in 3.2-b4 and later). 2In the RS274NGC Spec, G0 is Rapid Move, which was used to move between the current point in space and the new point as quickly and efficiently as possible, and G1 is Controlled Move, which was used to move between the current point in space and the new point as precise as possible. In RepRapFirmware, G1 is always a linear move but G0 may not be linear (e.g. on a SCARA machine); however a G0 move will never go below the lower of the initial and final Z height of the move. 3Some firmwares may not support setting the feedrate inline with a move. 4RepRapFirmware provides an additional â€˜Râ€™ parameter to tell the machine to add the coordinates of the specified restore point to all axis coordinates mentioned in the G0 or G1 command. Axes that are not mentioned in the G0 or G1 command are not moved. When a print is paused, the coordinates are saved in restore point #1. When a tool change is commenced, the coordinates are saved in restore point #2. Coordinates can also be saved in restore points explicity using the G60 command. Some older machines, CNC or otherwise, used to move faster if they did not move in a straight line. This is also true for some non-Cartesian printers, like delta or polar printers, which move easier and faster in a curve. G2 G3: Controlled Arc MoveUsage G2 Xnnn Ynnn Innn Jnnn Ennn Fnnn (Clockwise Arc) G3 Xnnn Ynnn Innn Jnnn Ennn Fnnn (Counter-Clockwise Arc) Parameters Xnnn The position to move to on the X axis Ynnn The position to move to on the Y axis Znnn The position to move to on the Z axis (optional, may not be supported in some firmwares) Innn The point in X space from the current X position to maintain a constant distance from Jnnn The point in Y space from the current Y position to maintain a constant distance from Ennn The amount to extrude between the starting point and ending point Fnnn The feedrate per minute of the move between the starting point and ending point (if supplied) Knnn The point in Z space from the current Z position to maintain a constant distance from (used only when the current plane is YZ or ZX - see G18 and G19) Rnnn The radius of the arc (can be used in place of I and J, may not be supported in some firmwares) Examples G2 X90.6 Y13.8 I5 J10 E22.4 (Move in a Clockwise arc from the current point to point (X90.6,Y13.8), with a center point at (Xcurrent_X+5, Ycurrent_Y+10), extruding 22.4mm of material between starting and stopping) G3 X90.6 Y13.8 I5 J10 E22.4 (Move in a Counter-Clockwise arc from the current point to point (X90.6,Y13.8), with a center point at (Xcurrent_X+5, Ycurrent_Y+10), extruding 22.4mm of material between starting and stopping) Notes 1In Marlin Firmware not implemented for DELTA printers. 2Prusa Firmware implements arcs only in Cartesian XY. 3On Klipper, a gcode_arcs section must be enabled in the configuration file. G4: DwellPause the machine for a period of time. Parameters Pnnn Time to wait, in milliseconds (In Teacup, P0, wait until all previous moves are finished) Snnn Time to wait, in seconds (Only on Repetier, Marlin, Prusa, Smoothieware, and RepRapFirmware 1.16 and later) Example G4 P200 In this case sit still doing nothing for 200 milliseconds. During delays the state of the machine (for example the temperatures of its extruders) will still be preserved and controlled. On Marlin, Smoothie and RepRapFirmware, the â€œSâ€ parameter will wait for seconds, while the â€œPâ€ parameter will wait for milliseconds. â€œG4 S2â€ and â€œG4 P2000â€ are equivalent. G6: External Motion Control (Marlin)With DIRECT_STEPPING enabled Marlin can receive low-level stepper movement commands from a host device (e.g., OctoPrint with a plugin) in a compact binary format, so all acceleration and other motion tuning can be done on the host side. The commands are routed directly to page storage on the printer by a â€œpage managerâ€ system on the host side. The page manager operates in parallel with the usual G-code commands over the USB serial connection. The host is thus able to load data onto the machine quickly alongside regular G-code processing. The G6 command triggers the movements stored in the pages by referencing the corresponding page. Depending on the format, direction arguments may also be needed in the G6 command. Requires Step Daemon by @ColinRGodsey. See the Direct Stepping article for more information. Parameters I(index) Set page index R(rate) Step rate per second. Last value is cached for future invocations. S(rate) Number of steps to take. Defaults to max steps. X(direction) 1 for positive, 0 for negative. Last value is cached for future invocations. Not used for directional formats. Y(direction) 1 for positive, 0 for negative. Last value is cached for future invocations. Not used for directional formats. Z(direction) 1 for positive, 0 for negative. Last value is cached for future invocations. Not used for directional formats. E(direction) 1 for positive, 0 for negative. Last value is cached for future invocations. Not used for directional formats. G6: Direct Stepper Move (Druid)Perform a direct, uninterpolated, and non-kinematic synchronized move of one or more steppers directly. Units may be linear (e.g., mm or inches on DELTA) or specified in degrees (SCARA). This command is useful for initialization, diagnostics, and calibration, and should be disabled on production equipment. This type of move can be potentially dangerous, especially for deltabots, so implementations should do their best to limit movement to prevent twerking and damaging the carriage assembly. Parameters Annn Stepper A position or angle Bnnn Stepper B position or angle Cnnn Stepper C position or angle R Relative move flag SCARA Examples G6 A45 ; Move SCARA A stepper to the 45Â° positionG6 B20 R ; Move SCARA B stepper 20Â° counter-clockwise DELTA Example G6 C10 R ; Move DELTA C carriage up by 10mm G10: Set tool Offset andor workplace coordinates andor tool temperaturesUsage G10 Lnnn Pnnn Xnnn Ynnn Znnn Rnnn Snnn1 Parameters Pnnn Tool number Lnnn Offset mode 5 Xnnn X offset Ynnn Y offset Znnn Z offset2 U,V,W,A,B,Cnnn other axis offsets4 Rnnn Standby temperature(s) (RepRapFirmware) Snnn Active temperature(s) (RepRapFirmware) Examples G10 L1 P2 X17.8 Y-19.3 Z0.0 (sets the offset for tool 2 to the X, Y, and Z values specified) G10 P1 R140 S205 (RepRapFirmware only - set standby and active temperatures3 for tool 1) Remember that any parameter that you donâ€™t specify will automatically be set to the last value for that parameter. That usually means that you want explicitly to set Z0.0. RepRapFirmware will report the tool parameters if only the tool number is specified. The precise meaning of the X, Y (and other offset) values is: with no offset this tool is at this position relative to where a tool with offset (0, 0, 0) would be. So if the tool is 10mm to the left of a zero-offset tool the X value would be -10, and so on. The R value is the standby temperature in oC that will be used for the tool, and the S value is its operating temperature. If you donâ€™t want the tool to be at a different temperature when not in use, set both values the same. See the T code (select tool) below. In tools with multiple heaters the temperatures for them all are specified thus: R100.0:90.0:20.0 S185.0:200.0:150.0 . See also M585. Notes 1Marlin uses G10G11 for executing a retractionunretraction move. Smoothie uses G10 for retract and G10 Ln for setting workspace coordinates. RepRapFirmware interprets a G10 command with no P or L parameter as a retraction command. 2Itâ€™s usually a bad idea to put a non-zero Z value in as well unless the tools are loaded and unloaded by some sort of tool changer or are on indepedent carriages. When all the tools are in the machine at once they should all be set to the same Z height. 3If the absolute zero temperature (-273.15) is passed as active and standby temperatures, RepRapFirmware will only switch off the tool heater(s) without changing their preset active or standby temperatures. RepRapFirmware-dc42 does not support this setting. 4Tool offsets are applied after any X axis mapping has been performed. Therefore if for example you map X to U in your M563 command to create the tool, you should specify a U offset not an X offset. If you map X to both X and U, you can specify both offsets. (Not supported on all firmwares). 5L1 sets the offsets of the specified tool relative to the head reference point to the specified values. L2 sets the current workplace coordinate offsets to the specified values. L20 adjusts the current workplace coordinate offsets so that the current tool head position has the specified coordinates. NOTE on some firmwares L is required (and is required by NIST standard). P is also required to specify either the tool to update or the WCS to update. G10: RetractParameters Snnn retract length (S1 long retract, S0 short retract default) (Repetier only) Example G10 Retracts filament according to settings of M207 (Marlin, RepRapFirmware) or according to the S value (Repetier). RepRapFirmware recognizes G10 as a command to set tool offsets andor temperatures if the P parameter is present, and as a retraction command if it is absent. G11: UnretractParameters Snnn retract length (S1 long retract, S0 short retract default) (Repetier only) Example G11 Unretractsrecovers filament according to settings of M208 (Marlin, RepRapFirmware) or according to the S value (Repetier). G12: Clean ToolUsage [P0|1] [Scount] [Tcount] G12 Pnnn Snnn Tnnn Parameters Pnnn1 Pattern style selection Snnn Number of strokes (i.e. back-and-forth movements) Tnnn Number of repetitions Ennn 0Never 1Always apply software endstops (Marlin 2.0.6+) Examples G12Â ; stroke pattern (default) To generate a three triangle zig-zag pattern which will be stroked three times time use the following command. G12 P1 S3 T2Â ; zig-zag pattern with 2 triangles Notes 1In Marlin firmware and Derivatives Mk4duo this is implemented by hard-coded firmware behaviours As defined for variables NOZZLE_CLEAN_STROKES, NOZZLE_CLEAN_START_POINT, NOZZLE_CLEAN_END_POINT and NOZZLE_CLEAN_PARK. With NOZZLE_CLEAN_PARK enabled, the nozzle will automatically return to the XYZ position after G12 is run. More on this behaviour is documented inside of the code base. The use of G12 for tool cleaning clashes with the established use of G12 for circular pocket milling on CNC machines. For this reason, RepRapFirmware does not support G12. G17..19: Plane Selection (CNC specific)These codes set the current plane as follows: G17Â : XY (default) G18Â : ZX G19Â : YZ This mode applies to G2G3 arc moves. Normal arc moves are in the XY plane, and for most applications thatâ€™s all you need. For CNC routing it can be useful to do small â€œdiggingâ€ moves while making cuts, so to keep the G-code compact it uses G2G3 arcs involving the Z plane. These commands are supported in Marlin 1.1.4 and later with ARC_SUPPORT and CNC_WORKSPACE_PLANES enabled. G20: Set Units to InchesExample G20 Units from now on are in inches. In RepRapFirmware, the inchesmm setting applies to regular printing and travel moves (G0, G1, G2 etc.) but not to configuration commands. Therefore configuration should be done in mm. When executing a macro file, RepRapFirmware remembers the initial inchesmm setting and restores it after execution of the macro has completed. G21: Set Units to MillimetersExample G21 Units from now on are in millimeters. (This is the RepRap default.) In RepRapFirmware, the inchesmm setting applies to regular printing and travel moves (G0, G1, G2 etc.) but not to configuration commands. Therefore configuration should be done in mm. When executing a macro file, RepRapFirmware remembers the initial inchesmm setting and restores it after execution of the macro has completed. So a macro file such as pause.g (executed when a pause command is received) can safely use G21 at the start to switch the units to mm without affecting the job after the macro completes, regardless of whether the job was using inches or mm. G22: Firmware RetractUsage G22Â ; Do a retract move Use this command (along with G23) to have the firmware to do retraction moves (in contrast to generating an E axis G1 move). The retract length and speed are set in the firmware. G23: Firmware RecoverUsage G23Â ; Do a recover move Use this command (along with G22) to have the firmware to do a recover move. The recover length and speed are set in the firmware. G26: Mesh Validation PatternUsage G26 C P O2.25Â ; Do a typical test sequence The G26 Mesh Validation Pattern is designed to be used in conjunction with various Mesh Bed Leveling systems â€“ those that adjust for an uneven â€”rather than just tiltedâ€” bed. The G26 command prints a single layer pattern over the entire print bed, giving a clear indication of how accurately every mesh point is defined. G26 can be used to determine which areas of the mesh are less-than-perfect and how much to adjust each mesh point. G26 has large feature list, including a built-in test that extrudes material onto the bed. By default this is configured for PLA temperatures and a nozzle size of 0.4mm. (This will be adjustable in an upcoming version of Marlin.) See the G26_Mesh_Validation_Tool.cpp file in the Marlin source code for full documentation of the G26 parameter list. G27: Park toolheadPark the toolhead (i.e., nozzle) at a predefined XY position, with a Z raise value that applies over 0 or over the current position depending on the P parameter. In Marlin this G-code is enabled by NOZZLE_PARK_FEATURE and the park position is defined by NOZZLE_PARK_POINT. See G27 Park Toolhead for details. Usage G27 Xnnn Ynnn Znnn Pn Parameters Not all parameters need to be used, but at least one has to be used Xnnn X park position 1 Ynnn Y park position 1 Znnn Z park position 1 Pn [value] Z action 0 (Default) Relative raise by NOZZLE_PARK_Z_RAISE_MIN before XY parking 1 (Default) Absolute move to NOZZLE_PARK_POINT.z before XY parking. This may move the nozzle down, so use with caution! 2 Relative raise by NOZZLE_PARK_POINT.z before XY parking. Examples G27 P0Â ; Park, raising Z by NOZZLE_PARK_Z_RAISE_MIN, using NOZZLE_PARK_POINT.z as a safe height over 0G27 P1Â ; Park, raising Z to at least NOZZLE_PARK_POINT.z over 0G27 P2Â ; Park, raising Z by NOZZLE_PARK_POINT.z over the current Z G28: Move to Origin (Home)Usage G28 Xnnn Ynnn Znnn I N O P Rnnn S W C Parameters This command can be used without any additional parameters. X Flag to go back to the X axis origin Y Flag to go back to the Y axis origin Z Flag to go back to the Z axis origin I imprecise: do not perform precise refinement 3 L Force leveling state ON (if possible) or OFF after homing (Requires RESTORE_LEVELING_AFTER_G28 or ENABLE_LEVELING_AFTER_G28) 3 N No-change mode (do not change any motion setting such as feedrate) 3 O Home only if the position is not known and trusted 3 P Do not check print sheet presence 3 R Raise by n mminches before homing 3 S Simulated homing only in MARLIN_DEV_MODE 3 W Suppress mesh bed leveling if `X`, `Y` or `Z` are not provided 2 C Calibrate X and Y origin (home) - Only on MK3s 2 Examples G28 ; Home all axes (On Prusa i3 MK2/s,MK2.5/s,MK3/s it will also perform mesh bed leveling)2G28 X ZÂ ; Home the X and Z axes When the firmware receives this command, it quickly moves the specified axes (or all axes if none are given) to the endstops, backs away from each endstop by a short distance, and slowly bumps the endstop again to increase positional accuracy. This process, known as â€œHomingâ€œ, is required to determine the position of the print carriage(s). Some firmware may even forbid movement away from endstops and other operations until the axes have been homed. The X, Y, and Z parameters act only as flags. Any coordinates given are ignored. For example, G28Â Z10 results in the same behavior as G28Â Z. Delta printers cannot home individual axes, but must always home all three towers, so the X Y Z parameters are simply ignored on these machines. Marlin firmware (version 1.1.0 and later) provides an option called Z_SAFE_HOMING for printers that use a Z probe to home Z instead of an endstop. With this option, the XY axes are homed first, then the carriage moves to a position â€“usually the middle of the bedâ€“ where it can safely probe downward to home Z. RepRapFirmware uses macro files to home either all axes or individual axes. If all axes are homed, the file homeall.g is processed. For individual axes the homex.g, homey.g, or homez.g file will be used. On Delta printers, G28 command will always home all three towers by processing the homedelta.g file, regardless of any X Y Z parameters. Because the behavior of G28 is unspecified, it is recommended not to automatically include G28 in your ending G-code. On a Cartesian this will result in damaging the printed object. If you need to move the carriage at the completion of a print, use G0 or G1. Notes 1 MK4duo has a B parameter that tells the printer to return to the coordinates it was at before homing.2 Original Prusa i3 MK2s, MK2.5s, MK3s supports a W parameter to suppress mesh bed leveling. If W is omitted, G28 will home only and NOT perform mesh bed leveling. Original Prusa i3 MK3s (TMC2130 drivers) supports a C parameter to calibrate the X and Y home position. W Suppress mesh bed leveling (Prusa MK2s, MK2.5s and MK3s only)2 C Calibrate X and Y home position (Prusa MK3s only)2 G29: Detailed Z-ProbeThis command uses a probe to measure the bed height at 3 or more points to determine its tilt and overall flatness. It then enables compensation so that the nozzle will remain parallel to the bed. The printer must be homed with G28 before using this command. Each firmware behaves differently and depends on the type of bed leveling thatâ€™s been configured. For example, Marlin 1.0.2 provides 3 different types of automatic bed leveling (probe required) and a manual bed leveling option. See your firmwareâ€™s documentation for the specific options available. Usage G29 G29 Snnn Parameters Snnn Firmware-dependent behavior Pfile.csv Optional file name for bed height map file (RepRapFirmware only) Examples G29 ; Probe the bed and enable compensationG29 S2Â ; Special operation - see belowG29 P1Â ; UBL automated probe - see below G29 Auto Bed Leveling (Marlin - MK4duo)Marlin 1.0.2 and earlier provides three options for automatic bed leveling: The 3-point method probes the bed at three points to produce a matrix, adjusting for a flat but tilted bed. The planar grid method (non-Delta) probes a grid pattern to produce a matrix by the â€œleast-squaresâ€ method, adjusting for a flat but tilted bed. The bilinear grid method (Delta only) probes a grid pattern to produce a mesh, using bilinear interpolation to adjust for an uneven bed. Marlin 1.1.0 and later allows the bilinear grid (i.e., â€œmeshâ€) method to be used on all types of machines, not just deltas. This is the recommended leveling method going forward. Also in Marlin 1.1.0 and later, the PROBE_MANUALLY option allows all forms of Auto Bed Leveling to be used without a probe. The procedure is similar to that of MESH_BED_LEVELING (see below). Begin the process with G29 to move the nozzle to the first point. Adjust the Z axis using G1 or your host software. Send G29 again to move to the next point and repeat until all points have been sampled. Parameters P Set the size of the grid that will be probed (P x P points). Not supported by non-linear delta printer bed leveling. Example: G29 P4 S Set the XY travel speed between probe points (in unitsmin) D Dry-Run mode. Just evaluate the bed Topology - Donâ€™t apply or clean the rotation Matrix. Useful to check the topology after a first run of G29. V Set the verbose level (0-4). Example: G29 V3 T Generate a Bed Topology Report. Example: G29 P5 T for a detailed report. This is useful for manual bed leveling and finding flaws in the bed (to assist with part placement). Not supported by non-linear delta printer bed leveling. F Set the Front limit of the probing grid B Set the Back limit of the probing grid L Set the Left limit of the probing grid R Set the Right limit of the probing grid Global Parameters E By default G29 will engage the Z probe, test the bed, then disengage. Include E or E1 to engagedisengage the Z probe for each sample. (This has no effect for fixed probes.) G29 Unified Bed Leveling (Marlin - MK4duo)Marlin firmware (version 1.1.0 and later) includes the AUTO_BED_LEVELING_UBL option for Unified Bed Leveling. UBL combines mesh leveling, tilted plane adjustment, 3-point leveling, and manual editing tools all together in a single package. To accomplish so much, UBL overloads `G29` with several new parameters and provides an additional G26 Mesh Tuning feature. See the MarlinFW website for a dedicated Unified Bed Leveling page and complete documentation on `G29` for UBL and `G26` Mesh Validation. G29 UBL Parameters (synopsis) A Activate Activate the Unified Bed Leveling system. (i.e., M420 S1)D Disable Disable the Unified Bed Leveling system. (i.e., M420 S0)B# Business Do Manual Probing in Business Card mode.H# Height Height to raise the nozzle after each Manual Probe of the bed.C Continue Continue, Constant, or Current Location, depending on Phase.E Every Stow the probe after every sampled point.F# Fade Fade leveling compensation gradually, until it ceases at the given height.I# Invalidate Invalidate a specified number of Mesh Points (X and Y).J# Grid Do a grid (planar) leveling of the current Mesh using a grid with n points on a side.K# Kompare Compare (diff) current Mesh with stored Mesh #, replacing current Mesh with the result.L Load Load Mesh from the previously activated location in the EEPROM.L# Load Load Mesh from the specified location in the EEPROM.S Store Store the current Mesh in the Activated area of the EEPROM. Also save all settings.S # Store Store the current Mesh at the specified area in EEPROM, set as the Activated area.S -1 Store Store the current Mesh as a print-out suitable to be fed back into the system.O Map Display the Mesh Map Topology.P0 Phase 0 Zero Mesh Data and turn off the Mesh Compensation System.P1 Phase 1 Invalidate the Mesh and do Automatic Probing to generate new Mesh data.P2 Phase 2 Probe unpopulated areas of the Mesh (those that couldnt be auto-probed).P3 Phase 3 Fill unpopulated Mesh points with a fixed value. No C for smart fill extrapolation.P4 Phase 4 Fine tune the Mesh. ** Delta Mesh Compensation requires an LCD panel. **P5 Phase 5 Find Mean Mesh Height and Standard Deviation.P6 Phase 6 Shift Mesh height. All Mesh points are adjusted by the amount specified with C.Q Test Load specified Test Pattern to help check system operation.R # Repeat Repeat the command the specified number of times. Default: grid points X * Y.T 3-Point Perform a 3-Point Bed Leveling on the current Mesh.U Unlevel Perform a probe of the outer perimeter to assist in physically leveling the bed.W What? Print a report of Unified Bed Leveling stored data.X # The X location for the commandY # The Y location for the commandZ Zero Do a single probe to set the Z Height of the nozzle.Z # Zero Raise/lower the entire Mesh to conform with the specified difference (plus zprobe_zoffset). G29 Manual Bed Leveling (Marlin - MK4duo)Marlin firmware (version 1.0.2 and later) also provides a MESH_BED_LEVELING feature that can be used to perform bed leveling on machines lacking a probe. This form of bed leveling compensates for uneven Z height across the surface of the bed using a mesh and bilinear interpolation. Manual Bed Leveling Usage G29 S1Â ; Move to the first point and wait for a measurementG29 S2Â ; Store the current Z, move to the next pointG29 S3 Xn Yn Zn.nnÂ ; Modify the Z height of a single point Options for the S parameter S0 Produces a mesh report S1 Start probing mesh points S2 Probe the next mesh point S3 Xn Yn Zn.nn Manually modify a single point S4 Zn.nn Set z offset. Positive away from bed, negative closer to bed. G29 Auto Bed Leveling (Repetier-Firmware)Repetier firmware since v0.91 supports G29 with the optional Snnn parameter as described below. Useful to simply detect the Z bed angle so you can manually readjust your bed and get it as close to in plane as possible. If you wish to apply automatic software Z plane compensation on Repetier, use G32 instead with firmware 0.92.8 and above. S0 Default value. Z bed heights are calculated at the measured points, relative to current Z position before issuing G29. S1 Same as S0, except printer immediately moves to Z maximum position (Z max endstop required!), and calculates new Z maximum height. You must first issue G28 Z to home to Z maximum position before issuing G29 Snnn for this to work correctly, or the printer height will be invalid. S2 Same as S1, except new calculated Z height is also stored to EEPROM. G29 Mesh Bed Compensation (RepRapFirmware)RepRapFirmware: S0 (default if no S parameter) Probe the bed, save the height map in a file on the SD card, and activate the height map. The default folder for the height map file is /sys and the default file name is heightmap.csv. S1 Load the height map from file and activate bed compensation. The default folder and filename as for S0. S2 Clear the currently-loaded bed height map To define the grid, see M557. In RepRapFirmware 3.2 and later, G29 runs macro file mesh.g if it exists, otherwise it behaves like G29 S0. The mesh.g file can perform other actions (e.g. homing or tool selection) and then use G29 S0 to do the probing. Notes In Prusa Firmware G29 is not active by default, instead G81 is used.1 G29.1: Set Z probe head offsetExample G29.1 X30 Y20 Z0.5 Set the offset of the Z probe head. The offset will be subtracted from all probe moves. G29.2: Set Z probe head offset calculated from toolhead positionExample G29.2 Z0.0 Set the offset of the Z probe head. The offset will be subtracted from all probe moves. The calculated value is derived from the distance of the toolhead from the current axis zero point. The user would typically place the toolhead at the zero point of the axis and issue the G29.2 command. G30: Single Z-ProbeUsage G30 Pnnn Xnnn Ynnn Znnn Hnnn Snnn Parameters Pnnn Probe point number Xnnn X coordinate Ynnn Y coordinate Znnn Z coordinate Hnnn Height correction Snnn Set parameter Example G30 Examples (RepRapFirmware) G30 ; Probe the bed at the current XY position. When the probe is triggered, set the Z coordinate to the probe trigger height.G30 S-1 ; Probe the bed at the current XY position. When the probe is triggered, do not adjust the Z coordinate.G30 P0 X20 Y50 Z-99999 ; Probe the bed at X20 Y50 and save the XY coordinates and the height error as point 0G30 P3 X180 Y180 Z-99999 S4 ; Probe the bed at X180 Y180, save the XY coordinates and the height error as point 3 and calculate 4-point compensation or calibrationG30 P3 X180 Y180 Z-99999 S-1Â ; As previous example but just report the height errors In its simplest form probes bed at current XY location. RepRapFirmware supports additional behaviour: if a Pn field is specified the probed X, Y, and Z values are saved as point n on the bed for calculating the offset plane or for performing delta printer calibration. If X, Y, or Z values are specified (e.g. G30 P1 X20 Y50 Z0.3) then those values are used instead of the machineâ€™s current coordinates. A silly Z value (less than -9999.0) causes the machine to probe at the current point to get Z, rather than using the given value. If an S field is specified (e.g. G30 P1 Z0.3 S) the bed plane is computed for compensation and stored. The combination of these options allows for the machine to be moved to points using G1 commands, and then probe the bed, or for the user to position the nozzle interactively and use those coordinates. The user can also record those values and place them in a setup G-code file for automatic execution. RepRapFirmware uses the value of the S parameter to specify what computation to perform. If the value is -1 then the Z offsets of all the points probed are printed, but no calibration is done. If the value is zero or not present, then this specifies that the number of factors to be calibrated is the same as the number of points probed. Otherwise, the value indicates the number of factors to be calibrated, which must be no greater than the number of points probed. In version 1.09, the number of factors may be 3, 4 or 5 when doing auto bed compensation on a Cartesian or CoreXY printer, and 3, 4, 6 or 7 when doing auto calibration of a Delta printer. RepRapFirmware supports an optional H parameter, which is a height correction for that probe point. It allows for the Z probe having a trigger height that varies with XY position. The nominal trigger height of the Z probe (e.g. at bed centre) is declared in the Z parameter of the G31 command in the config.g file. When you probe using G30 and the probe triggers, the firmware will assume that the nozzle is at the nominal trigger height plus the value you have in the H parameter. 1MK4duo Firmware support an optional parameter for Delta. Usage G30 Xnnn Ynnn S Z P Parameters Xnnn X coordinate Ynnn Y coordinate Sn Stows the probe if 1 (default1) Zn with a non-zero value will apply the result to current delta_height Pn with a non-zero value will apply the result to current zprobe_zoffset Notes In Prusa Firmware this G-code is deactivated by default, must be turned on in the source code.2 G31: Set or Report Current Probe statusUsage G31 Pnnn Xnnn Ynnn Znnn Cnnn Snnn Parameters Pnnn Trigger value Xnnn Probe X offset1 Ynnn Probe Y offset1 Znnn Trigger Z height Cnnn Temperature coefficient(s) of trigger height2 Snnn Calibration temperature2 Tnnn (RepRapFirmware 1.17 and later) Z probe type to which these parameters apply, defaults to the current Z probe type as defined by M558 P parameter Examples G31 P500 Z2.6G31 X16.0 Y1.5 When used on its own this reports whether the Z probe is triggered, or gives the Z probe value in some units if the probe generates height values. If combined with a Z and P field (example: G31 P312 Z0.7) this will set the Z height to 0.7mm when the Z-probe value reaches 312 when a G28 Z0 (zero Z axis) command is sent. The machine will then move a further -0.7mm in Z to place itself at Z 0. This allows non-contact measuring probes to approach but not touch the bed, and for the gap left to be allowed for. If the probe is a touch probe and generates a simple 01 offon signal, then G31 Z0.7 will tell the RepRap machine that it is at a height of 0.7mm when the probe is triggered. In RepRapFirmware, separate G31 parameters may be defined for different probe types (i.e. 0+4 for switches, 1+2 for IR probes and 3 for alternative sensors). To specify which probe you are setting parameters for, send a M558 command to select the probe type before sending the G31 command, or use the T parameter. In Repetier, G31 supports no parameters and simply prints the highlow status of the Z probe. Notes 1X and Y offsets of the Z probe relative to the print head (i.e. the position when the empty tool is selected) can be specified in RepRapFirmware. This allows you to calculate your probe coordinates based on the geometry of the bed, without having to correct them for Z probe X and Y offset. 2In RepRapFirmware, additional parameters â€˜Sâ€™ (bed temperature in oC at which the specified Z parameter is correct, default is current bed temperature) and â€˜Câ€™ (temperature coefficient of Z parameter in mmoC, default zero) can be set for the alternative (ultrasonic) sensor. This is useful for probes that are affected by temperature such as PINDA. RepRapFirmware 3.1 and later allow both first and second order temperature coefficients to be specified, e.g. C0.015:0.001. G31: Dock Z Probe sledNotes In Prusa Firmware this G-code is deactivated by default, must be turned on in the source code.1 G32: Probe Z and calculate Z planeUsage G32 ; Probe and calculateG32 Snnn ; Each firmware has its own parametersG32 Snnn PnnnÂ ; Refer to their specific documentation This command is implemented as a more sophisticated form of bed leveling (which uses a transformation matrix or motorized correction. Smoothieware uses this code instead of `G29`. Each firmware behaves differently. For example, Repetier firmware allows for motorized rotation of the bed whilst ReprapFirmware probes the bed with a transformation matrix. Probe and calculate in ReprapfirmwareRepRapFirmware executes macro file bed.g in response to the G31 command. The bed.g file is typically used to probe the bed and then perform delta calibration if the printer is a delta, or to perform individual leadscrew adjustment to level the bed if the printer has multiple independently-controlled Z motors, or to advise the user on how much to adjust each bed levelling adjustment screw. Probe and calculate in Repetier firmwareThis command probes the bed at 3 or more pre-defined points and implements bed leveling compensation by either moving the A axis during printing (as with regular bed leveling, G29) or by tilting the bed with motors. Parameters Snnn Bed leveling method Pnnn Bed correction method The values for Snnn and Pnnn are as follows: S0 This method measures at the 3 probe points and creates a plane through these points. If you have a really planar bed this gives the optimum result. The 3 points must not be in one line and have a long distance to increase numerical stability. S1 This measures a grid. Probe point 1 is the origin and points 2 and 3 span a grid. We measure BED_LEVELING_GRID_SIZE points in each direction and compute a regression plane through all points. This gives a good overall plane if you have small bumps measuring inaccuracies. S2 Bending correcting 4 point measurement. This is for cantilevered beds that have the rotation axis not at the side but inside the bed. Here we can assume no bending on the axis and a symmetric bending to both sides of the axis. So probe points 2 and 3 build the symmetric axis and point 1 is mirrored to 1m across the axis. Using the symmetry we then remove the bending from 1 and use that as plane. P0 Use a rotation matrix. This will make z axis go updown while moving in xy direction to compensate the tilt. For multiple extruders make sure the height match the tilt of the bed or one will scratch. This is the default. P1 Motorized correction. This method needs a bed that is fixed on 3 points from which 2 have a motor to change the height. The positions are defined in firmware by BED_MOTOR_1_X, BED_MOTOR_1_Y, BED_MOTOR_2_X, BED_MOTOR_2_Y, BED_MOTOR_3_X, BED_MOTOR_3_Y Motor 2 and 3 are the one driven by motor driver 0 and 1. These can be extra motors like Felix Pro 1 uses them or a system with 3 z axis where motors can be controlled individually like the Sparkcube does. This method requires a Z max endstop. G32: Undock Z Probe sledNotes In Prusa Firmware this G-code is deactivated by default, must be turned on in the source code.1 G33: Firmware dependentG33: MeasureListAdjust Distortion Matrix (Repetier - Redeem)Usage G33 G33 Lnnn G33 Rnnn G33 Xnnn Ynnn Znnn Parameters L0 List distortion matrix in a report R0 Reset distortion matrix X[pos] Y[pos] Z[zCorrection] Set correction for nearest point Examples G33G33 R0 When used with no parameters, G33 will measure a grid of points and store the distortion dips and valleys in the bed surface, and then enable software distortion correction for the first few or several layers. The values will be stored in EEPROM if enabled in firmware. You must previously have G28 homed, and your Z minimummaximum height must be set correctly for this to work. Use the optional parameters to list, reset or modify the distortion settings. Distortion correction behavior can be later turned on or off by code M323. G33: Delta Auto Calibration (Marlin 1.1.x - MK4duo)End-stops and tower angle corrections are normalized (P0); Performs a 1-4-7 point calibration of delta height (P1), end-stops, delta radius (P2) and tower angle corrections (P3) by a least squares iteration process based on the displacement method. Usage G33 G33 Pn T Cx.xx Fn Vn E O Rx.xx Parameters Pn Number of probe points: n*n (n 0-10), when P is omitted the default set in Configuration.h is used. T Do not calibrate tower angle corrections (if used with P3); do not use the probe points near the towers, but the probe points opposite to the towers (if used with P2) Cx.xx Force the iterations to stop when a standard deviation from the zero plane less then x.xx mm is achieved; when C is omitted the iterations go on until the best possible standard deviation is reached. Fn Force to run at least n iterations (n1-30) and take the best result Vn Verbose level: (n0-3) 0 dry run without calibration; 1(default) settings at start and end; 2 settings at all iterations; 3 settings and probe results E Engage the probe for each point O Do not probe at the required kinematic points but at positions offseted to the probe-offsets 1 R Temporary reduce the size of the probe grid by the specified amount (mm) 1 Notes 1 since 2.0.9.2 Examples G33Â : calibrates with the default settings.G33 Auto CalibrateChecking... AC.Height:297.77 Ex:+0.00 Ey:+0.00 Ez:+0.00 Radius:100.00.Tower angleÂ : Tx:+0.00 Ty:+0.00 Tz:+0.00IterationÂ : 01 std dev:0.306IterationÂ : 02 std dev:0.049IterationÂ : 03 std dev:0.033IterationÂ : 04 std dev:0.031Calibration OK rolling back..Height:297.69 Ex:-0.10 Ey:-0.12 Ez:+0.00 Radius:100.91.Tower angleÂ : Tx:-0.03 Ty:+0.25 Tz:+0.00Save with M500 and/or copy to Configuration.h G33 P6 V0Â : probes 36 points in dry run mode.G33 Auto CalibrateChecking... AC (DRY-RUN).Height:297.77 Ex:+0.00 Ey:+0.00 Ez:+0.00 Radius:100.00.Tower angleÂ : Tx:+0.00 Ty:+0.00 Tz:+0.00. c:+0.03 x:+0.32 y:+0.34 z:+0.41. yz:+0.37 zx:+0.32 xy:+0.17End DRY-RUN std dev:0.306 G33 P4 C0.05 TÂ : probes 16 points and stops when a standard deviation of 0.05mm is reached; calibrates delta height, endstops and delta radius, leaves the tower angle corrections unaltered.G33 Auto CalibrateChecking... AC.Height:297.78 Ex:+0.00 Ey:+0.00 Ez:+0.00 Radius:100.00IterationÂ : 01 std dev:0.317IterationÂ : 02 std dev:0.059Calibration OK std dev:0.042.Height:297.66 Ex:-0.17 Ey:-0.13 Ez:+0.00 Radius:100.91Save with M500 and/or copy to Configuration.h G33 P2Â : probes center and tower positions and calibrates delta height, endstops and delta radius.G33 Auto CalibrateChecking... AC.Height:297.78 Ex:+0.00 Ey:+0.00 Ez:+0.00 Radius:100.00IterationÂ : 01 std dev:0.374IterationÂ : 02 std dev:0.054IterationÂ : 03 std dev:0.007Calibration OK rolling back..Height:297.68 Ex:-0.14 Ey:-0.14 Ez:+0.00 Radius:101.23Save with M500 and/or copy to Configuration.h G33 P1Â : probes the center and calibrates the delta height only.G33 Auto CalibrateChecking... AC.Height:261.40 Offset:+0.30Calibration OK std dev:0.000.Height:261.58 Offset:+0.10Save with M500 and/or copy to Configuration.h note: Height delta height; Ex, Ey, Ez end-stop corrections; Radius delta radius; Tx, Ty, Tz tower angular corrections; c, x, y, z, yz, zx, xy probe results at center, towers and opposite to towers; std dev standard deviation of the probe results towards the zero plane. G34: Z Stepper Auto-AlignUse multiple Z steppers and a probe to align Z axis connection points. See M422 for other options. Example G34 I3 T0.8 A1.5Â ; 3 iterations, Target Accuracy 0.8, Amplification 1.5 G34: Calculate Delta Height from toolhead position (DELTA)Example G34 The values specified are added to the calculated end stop position when the axes are referenced. The calculated value is derived from the distance of the toolhead from the current axis zero point. The user would typically place the toolhead at the zero point of the axis and issue the G34 command. This value can be saved to EEPROM using the M500 command. G38.x Straight Probe (CNC specific)G38.2 probe toward workpiece, stop on contact, signal error if failureMonitors probe input while moving linearly towards the specified coordinates, stopping upon detecting contact or reaching specified coordinates. Usage G38.2 Xnnn Ynnn Znnn Fnnn Parameters Xnnn target X coordinate Ynnn target Y coordinate Znnn target Z coordinate Fnnn Feedrate in mmmin Example G38.2 Z0G38.2 X50G38.2 Z10 Y10 G38.3 probe toward workpiece, stop on contactG38.4 probe away from workpiece, stop on loss of contact, signal error if failureG38.5 probe away from workpiece, stop on loss of contactG40: Compensation Off (CNC specific)G40 turns off cutter compensation. If tool compensation was on the next move must be a linear move and longer than the tool diameter. It is OK to turn compensation off when it is already off. http://www.linuxcnc.org/docs/2.5/html/gcode/tool_compensation.html G42: Move to Grid PointG42 does a fast move in XY to any of the intersection points in the bed calibration grid. This is useful during calibration to align the nozzle or probe. Parameters Inn Grid X index (zero-based). If omitted, the nearest latitude. Jnn Grid Y index (zero-based). If omitted, the nearest longitude. P Probe flag. Moves the probe to the grid point (instead of the nozzle). Fnnn Feedrate (mmmin) Example G42 I3 J4 P F3000Â ; Move the probe to grid coordinate 3, 4 G53..59: Coordinate System Select (CNC specific)G53 refers to the native machine coordinate system, while the remaining coordinate systems are typically used to define the offset to the origin of specific parts. See linuxcnc.org for more help Not all builds of RepRapFirmware support these commands. For those that do (e.g. Duet WiFiEthernet and Duet 3), from firmware version 2.02 the workplace coordinate offsets are included in the data saved to config-override.g by the M500 command. Marlin supports these commands when enabled with the #define CNC_COORDINATE_SYSTEMS option in Configuration_adv.h. G60: Save Restore positionUse this command to save the current position to a memory slot, restore (and move to) a saved position, or delete a previously-saved position. When moving to a saved position, you can choose which axes to move, and some firmwares allow you to specify an offset distance for each axis. See usage notes for each firmware below. G60 S Usage G60 Snn Parameters Snn specifies a memory slot # (0-based) to save into (default 0) RepRapFirmware: RRF 1.21 has 3 slots (0..2). RRF 2.02 adds two more slots (4..5) skipping slot index 3. When a print is paused the coordinates are saved to slot 1 automatically, and at the start of a tool change the coordinates are saved to slot 2 automatically. Use G0 or G1 with the R0, R1 or R2 parameter to move the current tool to a saved position. Marlin: The number of save slots is defined with SAVED_POSITIONS. Druid: This firmware always has 64 slots (0..63). G60 Q Usage G60 Qnnn Fnnn X Y Z ... E Move back to a saved position. Specify one or more axes to restore unless all axes should be restored. Parameters Qnnn - From slot # 0-63 (required) Fnnn - Feedrate (unitsmin) X - Flag to restore X Y - Flag to restore Y Z - Flag to restore Z E - Flag to restore E Other axis letters may be included for fancier robots. If no axes are specified with G60 Qnn then all axes are restored. Marlin: Put a value next to an axis letter to specify an offset to add to the position before moving. The E axis is restored but never actually moved by this command. G60 D Usage G60 Dnnn - Delete content of slot number nnn (0â€¦63) G60 D - if D is provided without a slot number, all 64 slots will be deleted. Notes Only one of S, Q, or D may be used in the command. If more than one is present, the whole command will be ignored. Examples G60 S0 ; Save current position to slot #0G60 S63 ; Save current position to slot #63G60 Q55 ; Move to the position stored in slot #55 G60 Q10 F20000 X Y ; Move XY to the position stored in slot #10, with feedrate 20000 units/min. G60 Q0 X ; Move X to the position saved in slot #0G60 D0 ; Delete the position saved in slot #0G60 D ; Delete all saved positions from all slotsG60 ; List all saved positions G61: Restore saved positionUse this command to restore (and move to) a saved position, optionally specifying which axes to restore, with an optional offset for each axis. Usage G61 Snn Parameters Snn specifies memory slot # (0-based) to restore from (default 0) Move back to the position that was saved in the given slot. If nothing was saved in the slot, do nothing. G61 Snn Fnnn X Y Z E Move back to a saved position, specifying one or more axes to restore, with optional offset. The E axis is restored but never actually moved by this command. Parameters Snnn - From slot # 0-63 (required) Fnnn - Feedrate (unitsmin) X - Flag to restore X axis, with optional X offset Y - Flag to restore Y axis, with optional Y offset Z - Flag to restore Z axis, with optional Z offset E - Flag to restore E axis, with optional E offset Other axis letters may be included for fancier robots. If no axes are specified then all axes are restored. Put a value next to an axis letter to specify the offset to add to the position before moving restoring. Examples G61 S15 ; Move to the position from slot #15G61 S10 F20000 X3 Y ; Move XY to the XY position from slot #10, shifting X by 3, with feedrate 20000 units/minG61 S0 X ; Move X to the X position from slot #0 G68: Coordinate rotationUsage G68 Xnnn Ynnn Rnnnn [I] G68 Annn Bnnn Rnnnn [I] Parameters Xnnn, Ynnn... Centre coordinates to rotate about Annn first centre coordinate in the selected plane (e.g. equivalent to Xnnn if the selected plane is XY) Bnnn second centre coordinate in the selected plane (e.g. equivalent to Ynnn if the selected plane is XY) Rnnn angle to rotate in degrees. Positive angles rotate anticlockwise when viewing the selected plane from above. I if this parameter is present, the R parameter is added to the existing rotation instead of being absolute Rotates the coordinate system in the current plane as selected by G17, G18 or G19. You may either specify the coordinates of the two axes of the selected plan (e.g. X and Y if using the default XY plane or after G17) or you may specify A and B coordinates. RepRapFirmware implements G68 for the XY plane only. G69: Cancel coordinate rotationUsage G69 This cancels any coordinate rotation that was set up by G68. G75: Print temperature interpolationShowprint PINDA temperature interpolating. Usage G75 G76: PINDA probe temperature calibrationThis G-code is used to calibrate the temperature drift of the PINDA (inductive Sensor). The PINDAv2 sensor has a built-in thermistor which has the advantage that the calibration can be done once for all materials. The Original i3 Prusa MK2s uses PINDAv1 and this calibration improves the temperature drift, but not as good as the PINDAv2. Usage G76 G76 B1 G76 P1 Parameters B Calibrate bed only 1 P Calibrate probe only 1 Example G76echo PINDA probe calibration startecho start temperature: 35.0Â°echo ...echo PINDA temperature -- Z shift (mm): 0.--- Notes1 Marlin requires PROBE_TEMP_COMPENSATION. This process can take a very long time. The timeout is currently set to 15min to allow the parts to fully heat up and cool down. Use M500 to save the result to EEPROM. At this moment it is only supported in Marlin bugfix-2.0.x branch. G80: Cancel Canned Cycle (CNC specific)It cancel canned cycle modal motion. G80 is part of modal group 1, so programming any other G code from modal group 1 will also cancel the canned cycle. G80: Mesh-based Z probeDefault 3x3 grid can be changed on MK2.5s and MK3s to 7x7 grid. Parameters This command can be used without any additional parameters. N Number of mesh points on x axis. Default is 3. Valid values are 3 and 7. C Probe retry counts. Default is value stored in EEPROM. Valid values are 1 to 10. O Return to origin. Default is 1. Valid values are 0 (false) and 1 (true). 2 M Use magnet compensation. Will only be used if number of mesh points is set to 7. Default is value stored in EEPROM. Valid values are 0 (false) and 1 (true). 2 Using the following parameters enables additional â€œmanualâ€ bed leveling correction. Valid values are -100 microns to 100 microns. L Left Bed Level correct value in um. R Right Bed Level correct value in um. F Front Bed Level correct value in um. B Back Bed Level correct value in um. The following parameters are used to define the area used by the print: X area lower left point X coordinate 2 Y area lower left point Y coordinate 2 W area width (on X axis) 2 H area height (on Y axis) 2 1Prusa Firmware till version 3.13.3 R Probe retries. Default 3 max. 10 1 V Verbosity level 1low, 10mid, 20high.It can be only used if firmware has been compiled with SUPPORT_VERBOSITY active. 1 2Prusa Firmware from version 3.14.0 3Prusa MK3.5, MK3.9 and MK4 G81: Mesh bed leveling statusPrints mesh bed leveling status and bed profile if activated. Usage G81 Notes Equivalent to M420 V in Marlin Firmware (and possibly G29 T depending on leveling system). G82: Single Z probe at current locationWARNING! USE WITH CAUTION! If youâ€™ll try to probe where is no leveling pad, nasty things can happen! Usage G82 Notes In Prusa Firmware this G-code is deactivated by default, must be turned on in the source code.1 G83: Babystep in Z and store to EEPROMUsage G83 Notes In Prusa Firmware this G-code is deactivated by default, must be turned on in the source code.1 G84: UNDO Babystep Z (move Z axis back)Usage G84 Notes In Prusa Firmware this G-code is deactivated by default, must be turned on in the source code.1 G85: Pick best babystepUsage G85 Notes In Prusa Firmware this G-code is deactivated by default, must be turned on in the source code.1 G86: Disable babystep correction after homeThis G-code will be performed at the start of a calibration script. Usage G86 G87: Enable babystep correction after homeThis G-code will be performed at the end of a calibration script. Usage G87 G88: ReservedUsage G88 Notes This G-code currently does not do anything. G90: Set to Absolute PositioningExample G90 All coordinates from now on are absolute relative to the origin of the machine. (This is the RepRap default.) G91: Set to Relative PositioningExample G91 All coordinates from now on are relative to the last position. Note: RepRapFirmware latest revision firmware uses M83 to set the extruder to relative mode: extrusion is NOT set to relative by ReprapFirmware on G91: only X,Y and Z are set to relative. By contrast, Marlin (for example) DOES also set extrusion to relative on a G91 command, as well as setting X, Y and Z. G92: Set PositionParameters This command can be used without any additional parameters. Xnnn new X axis position Ynnn new Y axis position Znnn new Z axis position Ennn new extruder position Example G92 X10 E90 Allows programming of absolute zero point, by reseting the current position to the values specified. This would set the machineâ€™s X coordinate to 10, and the extrude coordinate to 90. No physical motion will occur. A G92 without coordinates will reset all axes to zero on some firmware. This does not apply to RepRapFirmware. G92.x: Reset Coordinate System Offsets (CNC specific)Usage G92.1 - Reset axis offsets (and parameters 5211-5219) to zero. (X Y Z A B C U V W) G92.2 - Reset axis offsets to zero G93: Feed Rate Mode (Inverse Time Mode) (CNC specific)G93 is Inverse Time Mode. In inverse time feed rate mode, an F word means the move should be completed in (one divided by the F number) minutes. For example, F2.0 means the move should be completed in a half a minute. When the inverse time feed rate mode is active, an F word must appear on every line which has a G1, G2, or G3 motion, and an F word on a line that does not have G1, G2, or G3 is ignored. Being in inverse time feed rate mode does not affect G0 (rapid move) motions. G94: Feed Rate Mode (Units per Minute) (CNC specific)G94 is Units per Minute Mode. In units per minute feed mode, an F word is interpreted to mean the controlled point should move at a certain number of inches per minute, millimeters per minute, or degrees per minute, depending upon what length units are being used and which axis or axes are moving. G98: Activate farm modeEnable Prusa-specific Farm functions and g-code. Usage G98 Notes Set of internal Prusa commands PRUSA [ Ping | PRN | FAN | fn | thx | uvlo | fsensor_recover | MMURES | RESET | fv | M28 | SN | Fir | Rev | Lang | Lz | Beat | FR ] Parameters Ping PRN Prints revision of the printer. FAN Prints fan details. fn Prints farm number. thx uvlo Resets UVLO aka Power Panic and continues SD print. fsensor_recover Filament sensor recover - restore print and continue. MMURES Reset MMU. Reset Resets Printer. fv ??? get file version.Â ??? M28 M28 write to SD. SN Get serial number from 32U2 processor. Typical format of SN is:CZPX0917X003XC13518 Fir Prints firmware version. Rev Prints filament size, elelectronics, nozzle type. Lang Reset the language. Lz ??? maybe resets Live Z values to 0Â ??? Beat Kick farm link timer. FR Full factory reset. nozzle set diameter Set nozzle diameter. nozzle Ddiameter Check nozzle diameter. nozzle Print nozzle diameter G99: Deactivate farm modeUsage G99 G100: Calibrate floor or rod radiusParameters X Flag to set floor for X axis Y Flag to set floor for Y axis Z Flag to set floor for Z axis Rnnn Radius to add Examples G100 X Y ZÂ ; set floor for argument passed in. Number ignored and may be absent.G100 R5 ; Add 5 to radius. Adjust to be above floor if necessaryG100 R0 ; Set radius based on current z measurement. Moves all axes to zero G130: Set digital potentiometer valueExample G130 X10 Y18 Z15 A20 B12 Set the digital potentiometer value for the given axes. This is used to configure the current applied to each stepper axis. The value is specified as a value from 0-127; the mapping from current to potentimeter value is machine specific. G131: Remove offsetG132: Calibrate endstop offsetsG133: Measure steps to topG161: Home axes to minimumParameters X Flag to home the X axis to its minimum position Y Flag to home the Y axis to its minimum position Z Flag to home the Z axis to its minimum position Fnnn Desired feedrate for this command Example G161 X Y Z F1800 Instruct the machine to home the specified axes to their minimum position. Similar to G28, which decides on its own in which direction to search endstops. G162: Home axes to maximumParameters X Flag to home the X axis to its maximum position Y Flag to home the Y axis to its maximum position Z Flag to home the Z axis to its maximum position Fnnn Desired feedrate for this command Example G162 X Y Z F1800 Instruct the machine to home the specified axes to their maximum position. G425: Perform auto-calibration with calibration cubeThis performs an automatic calibration of backlash, positional errors and nozzle offset by touching the nozzle on the sides of a bed mounted, electrically conductive cube, washer or bolt. Parameters B Perform calibration of backlash only. Tnnn Perform calibration of toolhead only. V Probe cube and print position, error, backlash and hotend offset. Unnn Uncertainty, how far to start probe away from the cube (mm) Examples (Marlin) G425 ; Perform full calibration sequenceT1 ; Switch to second nozzleG425 V ; Validate by showing report for T1T0 ; Switch to second nozzleG425 V ; Validate by showing report for T0 M-commandsM0: Stop or Unconditional stopParameters This command can be used without any additional parameters. Pnnn Time to wait, in milliseconds1 Snnn Time to wait, in seconds2 Example M0 The RepRap machine finishes any moves left in its buffer, then shuts down. All motors and heaters are turned off. It can be started again by pressing the reset button on the master microcontroller, although this step is not mandatory on RepRapFirmware. See also M1, M112. The Marlin Firmware does wait for user to press a button on the LCD, or a specific time. â€œM0 P2000â€ waits 2000 milliseconds, â€œM0 S2â€ waits 2 seconds. RepRapFirmware executes cancel.g if this file is present, if the print is paused and if the axes are homed. Otherwise stop.g is run and the drives are put into idle mode. Also the heaters are turned off if no â€˜H1â€™ parameter is specified. Notes 1Not available in RepRapFirmware, but as a work-around G4 can be run before M0. 2Only available on Marlin and Prusa Firmware. 3â€œWait for user â€¦â€ is shown on LCD in Prusa Firmware. M1: Sleep or Conditional stopExample M1M1 Hello world 1 The RepRap machine finishes any moves left in its buffer, then shuts down. All motors and heaters are turned off. It can still be sent G and M codes, the first of which will wake it up again. See also M0, M112. The Marlin does the same as M0. In Prusa 8-bit Firmware 1 the M1 needs at least a space behind the command to be executed correctly. It can be used the same as M0 Pms or M0 Sseconds but will ignore the following â€œmessageâ€. Prusa Firmware 8-bit example M1 S5 will wait for 5 seconds and show in the LCD status line Waiting for user... the same as M0 S5M1 Hello world will show in the LCD status line Hello world and wait until the user press the LCD knob. If Marlin is emulated in RepRapFirmware, this does the same as M25 if the code was read from a serial or Telnet connection, else the macro file sleep.g is run before all heaters and drives are turned off. M2: Program EndExample M2 Teacup firmware does the same as M84. M3: Spindle On, Clockwise (CNC specific)Parameters Snnn Spindle RPM Example M3 S4000 The spindle is turned on with a speed of 4000 RPM. Teacup firmware turn extruder on (same as M101). RepRapFirmware interprets this code only if in CNC mode (M453), in laser mode (M452) or if a Roland mill has been configured. You must always provide an S parameter with this command to specify the required spindle speed pr laser power. In RepRapFirmware 2.05RC2 and later, and RepRapFirmware 3.0beta13 and later, in laser mode (M452) the laser will only fire during G1G2G2 moves. In Repetier-Firmware in laser mode you need S0..S255 to set laser intensity. Normally you use S255 to turn it on full power for moves. Laser will only fire during G1G2G3 moves and in laser mode (M452). M4: Spindle On, Counter-Clockwise (CNC specific)Example M4 S4000 The spindle is turned on with a speed of 4000 RPM. M5: Spindle Off (CNC specific)Example M5 The spindle is turned off. Teacup firmware turn extruder off (same as M103). M6: Tool changeExample M6 M7: Mist Coolant On (CNC specific)Example M7 Mist coolant is turned on (if available) Teacup firmware turn on the fan, and set fan speed (same as M106). M8: Flood Coolant On (CNC specific)Example M8 Flood coolant is turned on (if available) M9: Coolant Off (CNC specific)Example M9 All coolant systems are turned off. M10: Vacuum On (CNC specific)Example M10 Dust collection vacuum system turned on. M11: Vacuum Off (CNC specific)Example M11 Dust collection vacuum system turned off. M13: Spindle on (clockwise rotation) and coolant on (flood)This one M-code does the work of both M03 and M08. It is not unusual for specific machine models to have such combined commands, which make for shorter, more quickly written programs. Example M13 M16: Expected Printer CheckDo a case-sensitive comparison between the string argument and the configured MACHINE_NAME. If the machine name doesnâ€™t match, halt the printer so that a reset is required. This safety feature is meant to prevent G-code sliced for a specific machine from being used on any other machine. In Marlin this feature is enabled with EXPECTED_PRINTER_CHECK. Example M16 Cookie Monster M17: EnablePower all stepper motorsParameters This command can be used without any additional parameters.1 X X axis Y Y axis Z Z axis E All extruders Example M17M17 X E0 Powers on stepper motors. Notes 1Ability to specify axes was added to Marlin 2.0 and may not be available on other firmware implementations. M18: Disable all stepper motorsParameters This command can be used without any additional parameters.13 X X axis Y Y axis Z Z axis E Extruder drive(s)2 S Seconds3 Examples M18M18 X E0 Disables stepper motors and allows axes to move â€˜freely.â€™ On Marlin, M18 is a synonym of M84, so it can also be used to configure or disable the idle timeout. Examples M18 S10 ; Idle steppers after 10 seconds of inactivityM18 S0 ; Disable idle timeout Notes 1Some firmware implementations do not support parameters to be passed, but at least Marlin and RepRapFirmware do. 2RepRapFirmware allows stepper motors to be disabled selectively. For example, M18 X E0:2 will disable the X, extruder 0 and extruder 2 motors. 3In Prusa Firmware this command can be used to set the stepper inactivity timeout (`S`) or to disable steppers (`X`,`Y`,`Z`,`E`) M20: List SD cardParameters This command can be used without any additional parameters. Snnn Output style1 Rnnn File number to start at1 Cnnn Maximum number of files to return1 Pddd Directory to list2 L Reports long filenames instead of just short filenames. Requires host software parsing (Cap:EXTENDED_M20).4 T Report timestamps as well. The value is one uint32_t encoded as hex. Requires host software parsing (Cap:EXTENDED_M20).4 Examples M20M20 S2 P/gcodes/subdirM20 L 4M20 T 4 This code lists all files in the root folder or G-code directory of the SD card to the serial port. One name per line, like: SQUARE.GSQCOM.GZCARRI~2.GCOCARRIA~1.GCO Please note that a file list response is usually encapsulated. Standard configurations of RepRapFirmware mimic this style in emulation mode: Begin file list:SQUARE.GZCARRI~2.GCOEnd file listok The file size may be appended as an integer representing the size in bytes: Begin file list:SQUARE.G 1234ZCARRI~2.GCO 234End file list ok At least OctoPrint also supports an additional format showing the fileâ€™s long name (see also M33) after the size: Begin file list:SQUARE.G 1234 SQUARE.GZCARRI~2.GCO 234 ZCARRIAGE_V2.GCOEnd file list ok If RepRapFirmware emulates no firmware compatibility, a typical response looks like: G-code files:Traffic cone.g,frog.gcode,calibration piece.g Note that some firmwares list file names in upper case, but - when sent to the M23 command (below) they must be in lower case. Teacup and RepRapFirmware have no such trouble and accept both. RepRapFirmware always returns long filenames in the case in which they are stored. Notes 1RepRapFirmware specific: If the S2 parameter is used then the file list (or as much as can be fitted in the output buffer) is returned in JSON format as a single array called â€œfilesâ€ with each name that corresponds to a subdirectory preceded by an asterisk, and the directory is returned in variable â€œdirâ€. The optional R parameter is the file number to start at, default 0. The JSON response also returns value â€œnextâ€ which is the number of the first file that wasnâ€™t returned, or 0 if the last file in the folder was included in the response. This allows the caller to enumerate all files even if there are very many, by making successive M20 S2 calls with each call using R from the â€œnextâ€ value in the previous response, until â€œnextâ€ is zero. In RRF 3.6.0 and later the C parameter can be used to limit the maximum number of files that RRF returns in each response. Example M20 S2 P/gcodesdir:\\/gcodes,first:0,files:[4-piece-1-2-3-4.gcode,Hinged_Box.gcode,Hollow_Dodecahedron_190.gcode,*Calibration pieces],next:0 Example for M20 L4 Begin file listTEST1.GCO 1234 TEST1.GCODIR_ENTER: /TESTFO~1/ test folderDIR_EXITLFNFIL~1.GCO 56789 LFN file.gcodeEnd file list Example for M20 L T4 Begin file listTEST1.GCO 1234 0x52936b00 TEST1.GCODIR_ENTER: /TESTFO~1/ test folderDIR_EXITLFNFIL~1.GCO 56789 0x52936b08 LFN file.gcodeEnd file list Example for M20 T4 Begin file listTEST1.GCO 1234 0x52936b00DIR_ENTER: /TESTFO~1/ test folderDIR_EXITLFNFIL~1.GCO 56789 0x52936b08End file list 2This parameter is only supported by RepRapFirmware and defaults to the 0:gcodes directory, which is the directory that printable gcode files are normally stored in. 3On Klipper, a virtual SD card is required for this to work. 4The timestamp is a combination of both the date and time into a single integer and printed as a hex. M21: Initialize SD cardParameters Pnnn SD card number (RepRapFirmware only, default 0) Examples M21M21 P1 The specified SD card is initialized. If an SD card is loaded when the machine is switched on, this will happen by default. SD card must be initialized for the other SD functions to work. Marlin 2.0.9.4 added S and U parameters to mount the SD Card or USB drive, respectively. Hosts can look for â€œCap:MULTI_VOLUME:1â€œ. Notes 1On Klipper, a virtual SD card is required for this to work. 2On Druid: M21 is named Mount MediaM21 P0 or S = Mount external SD CARD M21 P1 or M = Mount onboard Micro Sd-CardM21 P2 or U = Mount USB Flash DriveM21 = Mount current volume M22: Release SD cardParameters Pnnn SD card number (RepRapFirmware only, default 0) Examples M22M22 P1 The specified SD card is released, so further (accidental) attempts to read from it are guaranteed to fail. Helpful, but not mandatory before removing the card physically. M23: Select SD fileExample M23 filename.gco The file specified as filename.gco (8.3 naming convention is supported) is selected ready for printing. RepRapFirmware supports long filenames as well as 8.3 format. Notes 1On Klipper, a virtual SD card is required for this to work. M24: Startresume SD printExample M24 The machine prints from the file selected with the M23 command. If the print was previously paused with M25, printing is resumed from that point. To restart a file from the beginning, use M23 to reset it, then M24. When this command is used to resume a print that was paused, RepRapFirmware runs macro file resume.g prior to resuming the print. Notes 1On Klipper, a virtual SD card is required for this to work. M25: Pause SD printExample M25 The machine pauses printing at the current position within the file. To resume printing, use M24. Do not use this code within a GCode file to pause the print at that point, use M226 instead. Prior to pausing, RepRapFirmware runs macro file pause.g. This allows the head to be moved away from the print, filament to be retracted, etc. RepRapFirmware 1.20 and later also save the current state of the print to file sysresurrect.g. This is so that if the printer is turned off after pausing, the print can subsequently be resumed. Without any parameters it will park the extruder to default or last set position. The default pause position will be set during power up and a reset, the new pause positions arenâ€™t permanent. Usage M25 [ X | Y | Z | S ] 2 Parameters X X position to park 2 Y Y position to park 2 Z Z raise before park 2 S Set values [S0 set to default values | S1 set values] without pausing 2 Notes 1On Klipper, a virtual SD card is required for this to work. 2Prusa Firmware equivalent to M125 and M601 M26: Set SD positionParameters Snnn File position from start of file in bytes Pnnn (Optional, RepRapFirmware only) Fraction of the first move to be skipped, default 0.0, must be less than 1.0 Xnnn,Ynnn,Znnncode (Optional, RepRapFirmware only) If the command at the specified file position is a G2 or G3 command and the P parameter is nonzero then two of these (e.g. X and Y if the XY plane is selected) are used to provide the coordinates of the centre of the arc. Example M26 S49315 Set the file offset in bytes from the start of the SD card file selected by M23. The offset must correspond to the start of a G-code command. RepRapFirmware uses this command as part of the procedure to recover a job following a power failure. Notes sup1/supOn Klipper, a virtual SD card is required for this to work. #### M27: Report SD print status table tbodytr th rowspan=4 Support /th th a href=https://reprap.org/wiki/MarlinMarlin/a /th th a href=https://reprap.org/wiki/RepRapFirmwareRepRapFirmware/a /th th a href=https://reprap.org/wiki/KlipperKlipper/a /th th a href=https://reprap.org/wiki/Prusa_FirmwarePrusa/a /th th a href=https://reprap.org/wiki/Prusa_Buddy_FirmwareBuddy/a /th th a href=https://reprap.org/wiki/Repetier-FirmwareRepetier/a /th th a href=https://reprap.org/wiki/SmoothieSmoothie/a /th th a href=https://reprap.org/wiki/Druid_FirmwareDruid/a /th th a href=https://reprap.org/wiki/MK4duoMK4duo/a /th/tr tr tdYes /td tdYes /td tdYessup1/sup /td tdYes /td tdYes /td tdYes /td tdYes /td td??? /td tdYes /td/tr tr th a href=https://reprap.org/wiki/Grblgrbl/a /th th a href=https://reprap.org/wiki/SprinterSprinter/a /th th a href=https://reprap.org/wiki/RapManBFB/a /th th a href=https://reprap.org/wiki/FiveDFiveD/a /th th a href=https://reprap.org/wiki/MachinekitMachinekit/a /th th a href=https://reprap.org/wiki/RedeemRedeem/a /th th a href=https://reprap.org/wiki/TeacupTeacup/a /th th a href=https://reprap.org/wiki/YaskawaYaskawa/a /th th a href=https://reprap.org/wiki/MakerBotMakerBot/a /th/tr tr td??? /td tdYes /td tdNo /td tdNo /td tdNo /td tdNo /td tdNo /td tdNo /td td??? /td/tr/tbody/table Parameters **C** Report the open files name and long name (Marlin 1.1.9 and up) **Sn** Set the auto-report interval (Marlin 1.1.9 and up) Example ``` M27 ``` Report SD print status. Marlin and RepRapFirmware report the number of bytes processed in this format, which can be processed by Pronterface: ``` SD printing byte 2134/235422 ``` If no file is being printed, only this message is reported: ``` Not SD printing. ``` In Marlin 1.1.9 and up codeM27 C reports the open fileâ€™s DOS 8.3 name and long filename, if any. Example M27 C Current file: filena~1.gco Filenagotcha.gcode In Marlin 1.1.9 and up M27 Sn sets the auto-report interval. This requires the AUTO_REPORT_SD_STATUS configuration option to be enabled. Marlin reports this capability in M115 as Cap: AUTO_REPORT_SD_STATUS 1 when this option is available. Example M27 S2Â ; Report the SD card status every 2 seconds Notes 1On Klipper, a virtual SD card is required for this to work. M28: Begin write to SD cardExample M28 filename.gco File specified by filename.gco is created (or overwritten if it exists) on the SD card and all subsequent commands sent to the machine are written to that file. M29: Stop writing to SD cardExample M29 filename.gco File opened by M28 command is closed, and all subsequent commands sent to the machine are executed as normal. M30: Delete a file on the SD cardExample M30 filename.gco filename.gco is deleted. M30: Program Stop- For Yaskawa and in grbl - Same as M2 in Yaskawa G-code Example M30Â ; Exchange pallet shuttles and end the program. Pressing cycle start will start the program at the beginning of the file. M31: Output time since last M109 or SD card start to serialExample M31 The response looks like: echo:54 min, 38 sec M32: Select file and start SD printExample M32 filename.gco It can be used when printing from SD card and does the same as M23 and M24. tba available in marlin(1462014) M33: Get the long name for an SD card file or folderGet the long name for a file or folder on the SD card from a dos path. Introduced in Marlin firmware 1.1.0 September 2015. Example input: M33 miscel~1/armchair/armcha~1.gco Example output: /Miscellaneous/Armchair/Armchair.gcode M33: Stop and Close File and save restart.gcodeStop the printing from SD and save all position in restart.gcode for restart printing in future M34: Set SD file sorting optionsParameters S1 Enable sorting S0 Disable sorting F-1 Folders first, followed by the files (both group, alphabetically) F0 Folders and files together, listed alphabetically F1 Files first, followed by folders (both group, alphabetically) Enable and disable SD card file-sorting, andor set the folder sorting order. Proposed by Marlin firmware, May 2015. M35: Upload firmware NEXTION from SDM36: Return file informationExample M36 filename.gco M36 Returns information in JSON format for the specified SD card file (if a filename was provided) or for the file currently being printed. A sample response is: {â€œerrâ€:0,â€sizeâ€:436831,â€fileNameâ€:â€EscherLizardModified.gcodeâ€,â€lastModifiedâ€:â€2017-09-21T16:58:07â€,â€heightâ€:5.20,â€layerHeightâ€:0.20,â€printTimeâ€:660,â€simulatedTimeâ€:1586,â€filamentâ€:[1280.7],â€generatedByâ€:â€Simplify3D(R) Version 4.0.0â€} The â€œerrâ€ field is zero if successful, nonzero if the file was not found or an error occurred while processing it. The â€œsizeâ€ field should always be present if the operation was successful. The presence or absence of other fields depends on whether the corresponding values could be found by reading the file. The â€œfilamentâ€ field is an array of the filament lengths required from each spool. The size is in bytes, the times are in seconds, all other values are in mm. â€œprintTimeâ€ is the printing time estimated by the slicer, â€œsimulationTimeâ€ is the time measured when the print was simulated by the firmware. The fields may appear in any order, and additional fields may be present. Versions of RepRapFirmware prior to 3.4 do not provide the â€œfileNameâ€ field if information for a specific file was requested. RepRapFirmware 3.4 and later also return information about thumbnail imaged embedded in the GCode file via an additional JSON field â€œthumbnailsâ€. A sample value for this field is: â€œthumbnailsâ€:[{â€œwidthâ€:32,â€heightâ€:32,â€fmtâ€:â€qoiâ€,â€offsetâ€:103,â€sizeâ€:2140},{â€œwidthâ€:220,â€heightâ€:220,â€fmtâ€:â€qoiâ€,â€offsetâ€:2384,â€sizeâ€:25464}] The â€œfmtâ€ field denotes the encoding of the thumbnail and is either â€œpngâ€ or â€œqoiâ€. The â€œthumbnailsâ€ field is omitted entirely if there are no thumbnails embedded in the GCode file. M36.1: Return embedded thumbnail dataParameters Pâ€filenameâ€ Name of the GCode file from which thumbnail data is to be retrieved Snnnn Byte offset into the file at which thumbnail data is to be fetched This command is used to return the data for an thumbnail image in a GCode file. The offset value should be either the offset of the start of data for a thumbnail as returned by the M36 command, or the value returned in the â€œnextâ€ field by a previous M36.1 command. The response is in JSON format. Here is a sample response: {fileNameâ€:â€EscherLizardModified.gcodeâ€,â€offsetâ€:103,â€dataâ€:â€cW9pZgAAACAâ€¦.AAAABâ€,â€nextâ€:0,errâ€: 0} The â€œfileNameâ€ and â€œoffsetâ€ values are as given in the command. â€œdataâ€ is part or all of the base64-encoded thumbnail data starting at that offset. â€œnextâ€ is zero if there is no more data for that thumbnail, otherwise not all the thumbnail data was returned and â€œnextâ€ is the byte offset in the file of the rest of the thumbnail data. â€œerrâ€ is 0 if the command was successful, otherwise â€œerrâ€ is nonzero and the other fields may or may not be present. M37: Simulation modeParameters S1 Enter simulation mode S0 Leave simulation mode Pâ€filenameâ€ (optional) Simulate printing a file from SD card Examples M37 S1 M37 Pâ€MyModel.gâ€ Used to switch between printing mode and simulation mode. Simulation mode allows the electronics to compute an accurate printing time, taking into account the maximum speeds, accelerations etc. that are configured. M37 S1 enters simulation mode. All G and M codes will not be acted on, but the time they would take to execute will be calculated. M37 S0 leaves simulation mode and prints the total time taken by simulated moves since entering simulation mode. M37 with no S parameter prints the time taken by the simulation, from the time it was first entered using M37 S1, up to the current point (if simulation mode is still active) or the point that the simulation was ended (if simulation mode is no longer active). M37 Pâ€filenameâ€ enters simulation mode, prints the specified file, exits simulation mode, reports the print time, and appends it to the G-code file as a comment for later retrieval. M38 Compute SHA1 hash of target fileUsed to compute a hash of a file on the SD card. Examples: M38 gcodes/myfile.g Cannot find file M38 www/reprap.htm 91199139dbfadac15a18cfb962dfd4853db83999 Returns a hexadecimal string which is the SHA1 of the file. If the file cannot be found, then the string â€œCannot find fileâ€ is returned instead. M39 Report SD card informationParameters Pn SD slot number, default 0 Sn Response format. S0 returns a plain text response, S2 returns a response in JSON format. Examples M39 ; report information for SD card 0 in plain text format M39 P1 S2Â ; report information for SD card 1 in JSON format This command returns information about the SD card in the specified slot in the requested format. At least the following is returned: Whether or not a usable card is present in the slot The capacity of the card in bytes (if a card is present) The amount of free space on the card in bytes (if a card is present) The JSON response has the following format (more fields may be added in future): SDinfo:slot:0,present:1,capacity:4294967296,free:2147485184,speed:20971520,clsize:32768 The capacity, free space and cluster size are in bytes, and the interface speed is in bytessecond. M40: EjectIf your RepRap machine can eject the parts it has built off the bed, this command executes the eject cycle. This usually involves cooling the bed and then performing a sequence of movements that remove the printed parts from it. The X, Y and Z position of the machine at the end of this cycle are undefined (though they can be found out using the M114 command, q.v.). See also M240 and M241 below. M41: LoopExample M41 If the RepRap machine was building a file from its own memory such as a local SD card (as opposed to a file being transmitted to it from a host computer) this goes back to the beginning of the file and runs it again. So, for example, if your RepRap is capable of ejecting parts from its build bed then you can set it printing in a loop and it will run and run. Use with caution - the only things that will stop it are: When you press the reset button, When the build material runs out (if your RepRap is set up to detect this), and When thereâ€™s an error (such as a heater failure). M42: Switch IO pinParameters Pnnn Pin number Snnn Pin value Example M42 P7 S255 M42 switches a general purpose IO pin. Use M42 Px Sy to set pin x to value y, when omitting Px the LEDPIN will be used. In Teacup, general purpose devices are handled like a heater, see M104. In Marlin Firmware, pin numbers for 32-bit processors are in the form PORT * 100 + PIN. So pin P1_02 on LPC1768 can be set with M42 P102 S1. Marlin 1.x includes an I parameter to permit setting â€œvolatileâ€ pins that Marlin is using. Marlin 2.0.5.2 - 2.0.9.3 uses the M parameter to set the pin mode: 0INPUT, 1OUTPUT, 2INPUT_PULLUP, 3INPUT_PULLDOWN. In Marlin 2.0.9.4 and up the T parameter is used instead. In RepRapFirmware, the S field may be in the range 0..1 or 0..255. The pin reference is an internal firmware reference named â€œdigital pinâ€, see Duet pinout. It maps on different connector pins depending the hardware. On Duet 0.6 and 0.8.5 hardware using pre-1.16 firmware, the supported pin numbers and their names on the expansion connector are: P Name Expansion Port Pin 16 TXD1 11 17 RXD1 12 18 TXD0 13 19 RXD0 14 20 TWD1 35 21 TWCK1 36 23 PA14 10 36 PC4 18 52 AD14 41 67 PB16 32 In firmware 1.16, the pin numbering has changed. P Name Expansion Port Pin 60 PA10RXD0 14 61 PA11TXD0 13 62 PA12RXD1 12 63 PA13TXD1 11 64 PA14RTS1 10 65 PB12TWD1 35 66 PB13TWCK1 36 67 PB16DAC1* 32 68 PB21AD14 41 69 PC4 18 Also used as CS signal on external SD card socket P Signal Name Expansion Connector Label Expansion Pin 60 CS5 CS5 50 61 CS6 E3_STOP 9 62 CS7 E4_STOP 14 63 CS8 E5_STOP 19 See Using servos and controlling unused IO pins for all pin definitions. Pre-1.16 example: M42 P20 S1Â ;set the connector pin 35 to high. On RADDS hardware running RepRapFirmware-dc42, the supported Arduino Due pin numbers and their names are: 5 TIOA6, 6 PWML7, 39 PWMH2, 58 AD3, 59 AD2, 66 DAC0, 67 DAC1, 68 CANRX0, 69 CANTX0, 70 SDA1, 71 SCL1, 72 RX LED, 73 TX LED. See also M583. M43: Stand by on material exhaustedExample M43 If your RepRap can detect when its material runs out, this decides the behaviour when that happens. The X and Y axes are zeroed (but not Z), and then the machine shuts all motors and heaters off except the heated bed, the temperature of which is maintained. The machine will still respond to G and M code commands in this state. M43: Pin report and debugUsage M43 En Pnnn Wn In Parameters En Enable disable background endstop monitoring Pnnn Pin to read or watch. If omitted, readwatch all pins Wn bool watch pins -reporting changes- until reset, click, or M108 In bool Flag to ignore pin protection Note You must have PINS_DEBUGGING uncommented in your Configuration_adv.h file for M43 to work. M44: Codes debug - report codes availableIn MK4duo you must enable FASTER_GCODE_EXECUTE to get this G-code. Parameters In G-code list Jn M-code list M44: Reset the bed skew and offset calibrationResets the bed skew and offset calibration on Prusa i3 MK2s,MK2.5s,MK3s. M45: Bed skew and offset with manual Z upRuns the xyz calibration on Prusa i3 MK2s,MK2.5s,MK3s. Parameters Vnn Verbosity level 1, 10 and 20 (low, mid, high). Only when SUPPORT_VERBOSITY is defined. This parameter is optional. M46: Show the assigned IP addressReports the assigned IP address of a Toshiba FlashAir on Prusa i3 MK2s,MK2.5s,MK3s. At this moment it is deactivated. M47: Show end stops dialog on the displayShow end stops dialog on the display on Prusa i3 MK2s,MK2.5s,MK3s. M48: Measure Z-Probe repeatabilityParameters Pnnn number of points Xnnn position on the X axis Ynnn position on the Y axis Vnnn verbosity E engage Lnnn legs of travel S schizoid As with G29, the E flag causes the probe to stow after each probe. The S flag will result is a random sized, 5 pointed star, being traced (X and Y axis) between each sample. Usually a user will get worse repeat-ability numbers with S specified because the X axis and Y axis movements will add to the machineâ€™s positioning errors. Prusa specific 1 This function assumes the bed has been homed. Specifically, that a G28 command as been issued prior to invoking the M48 Z-Probe repeatability measurement function. Any information generated by a prior G29 Bed leveling command will be lost and need to be regenerated. The number of samples will default to 10 if not specified. You can use upper or lower case letters for any of the options EXCEPT n. n must be in lower case because Marlin uses a capital N for its communication protocol and will get horribly confused if you send it a capital N. Usage M48 nAA Xnnnn Ynnnn Vn Lnn Parameters nAA number(AA) of samples, default10 (valid values between 4 and 50) Xnnn X position for samples Ynnn Y position for samples Vn Verbosity level 1-4 (low to highest) Lnn Legs of travel 1-15 M49: Set G26 debug flagUsage M49 S1Â ; Enable G26 verbose debug output M70: Display messageExample M70 P200 Message Display a message on the LCD. P is the time to display message for. M72: Firmware dependentM72: Play a tone or songExample M72 P2 Instruct the machine to play a preset song. Acceptable song IDs are machine specific. P is the ID of the song to play. M72: Setget Printer StateWithout any parameter get printer state 0 NotReady Used by PrusaConnect 1 IsReady Used by PrusaConnect 2 Idle 3 SD printing finished 4 Host printing finished 5 SD printing 6 Host printing Usage M72 [ S ] Parameters S Set printer state 0 not_ready, 1 ready M73: SetGet build percentageExample M73 P50 Tell the firmware the current build progress percentage. The machine is expected to display this on its display. If the percentage is exactly 0 a â€œBuild Startâ€ notification is sent to the host. If the percentage is exactly 100 a â€œBuild Endâ€ notification is sent to the host. Use â€œM73â€ by itself to get a report of the current print progress. Prusa specific1 Prusa firmware shows percent done, time remaining and time to changepauseuser interaction. Usage M73 P R Q S Csup1/sup Dsup1/sup Parameters This command can be used without any additional parameters. P Percent in normal mode R Time remaining in normal mode (minutes) Q Percent in silent mode S Time remaining in silent mode (minutes) C Time to changepauseuser interaction in normal mode (minutes)1 D Time to changepauseuser interaction in silent mode (minutes)1 Examples M73echo NORMAL MODE: Percent done: ---%; print time remaining in mins: -----echo SILENT MODE: Percent done: ---%; print time remaining in mins: -----Prusa Firmware 3.10.0+1echo NORMAL MODE: Percent done: ---%; print time remaining in mins: -----; Change in mins: -----1echo SILENT MODE: Percent done: ---%; print time remaining in mins: -----; Change in mins: -----1 M74: Set weight on print bedParameters W Set the total mass in grams of everything that is currently on the bed. Example M74 W100 Tell the firmware the current weight of 100g on the bed. M75: Start the print job timerM76: Pause the print job timerM77: Stop the print job timerM78: Show statistical information about the print jobsM79: Start host timerStart the printer-host enable keep-alive timer. While the timer has not expired, the printer will enable host specific features. Usage M79 [ S ] Parameters S Quoted string containing two characters e.g. â€œPLâ€ M80: ATX Power OnParameters Cport_name (RepRapFirmware 3.4 and later only) Name of the pin used to control the power supply, default â€œpsonâ€ Examples M80 ; Turn on the power supplyM80 S ; Report power supply state (Marlin 1.1.1)M80 C!pson ; invert the PS_ON output for Meanwell power supplies Turns on the ATX power supply from standby mode to fully operational mode. No-op on electronics without standby mode. Notes Marlin requires the POWER_SUPPLY configuration option to be set to a non-zero value to enable M80. Some firmwares (e.g., Teacup) handle power onoff automatically, so this is redundant there. Also, see RAMPS wiring for ATX onoff. Prusa requires defined (PS_ON_PIN) and PS_ON_PIN must be set.1 M81: ATX Power OffParameters P quit the daemon (redeem only) R restart the daemon (redeem only) Sn n0 turn power off immediately (default), n1 turn power off when all thermostatic fans have turned off (RepRapFirmware 1.20 and later only) Examples M81 ; turn power off immediately M81 S1Â ; turn power off when everything has cooled down (RepRapFirmware) Turns off the ATX power supply. Counterpart to M80. Notes Prusa requires defined (PS_ON_PIN) and PS_ON_PIN must be set to Power off.1 M82: Set extruder to absolute modeExample M82 Makes the extruder interpret extrusion as absolute positions. This is the default in repetier and for Yaskawa controllers. M83: Set extruder to relative modeExample M83 Makes the extruder interpret extrusion values as relative positions. Note that the Ultimaker 3 will revert back to absolute extrusion after each tool change. M84: Stop idle holdParameters This command can be used without any additional parameters. Innn Reset flags1 Example M84 Stop the idle hold on all axis and extruder. In some cases the idle hold causes annoying noises, which can be stopped by disabling the hold. Be aware that by disabling idle hold during printing, you will get quality issues. This is recommended only in between or after printjobs. On Marlin, Repetier and RepRapFirmware, M84 can also be used to configure or disable the idle timeout. For example, â€œM84 S10â€ will idle the stepper motors after 10 seconds of inactivity. â€œM84 S0â€ will disable idle timeout; steppers will remain powered up regardless of activity. For Yaskawa systems M84 is not applicable due to servo motors not producing the annoying noises. Notes 1RepRapFirmware-dc42 and other firmware may not support this parameter. 2Prusa firmware uses M84 similar to G-code#M18:_Disable_all_stepper_motors 3On Klipper M84 is equivalent to G-code#M18:_Disable_all_stepper_motors Prusa Usage M84 E S X Y Z Prusa Parameters This command can be used without any additional parameters.2 E Extruder drive(s)2 S Seconds X X axis Y Y axis Z Z axis M85: Set Inactivity Shutdown TimerExample M85 S30 Set Inactivity Shutdown Timer with parameter S. â€œM85 S0â€ will disable the inactivity shutdown time (default) M86: Set Safety TimeoutUsage M86 Snnnn Parameters S Seconds T Trigger Temperature (Marlin) E Extruder Idle Temperature (Marlin) B Bed Idle Temperature (Marlin) Similar to M85 but applies to the â€œsafety timerâ€ in Prusa and Marlin Firmware. Set the Safety Timeout in seconds. M86 S0 will disable the safety timer. When the safety timer expires, heatbed and nozzle target temperatures are set to zero (Prusa Firmware) or idle temperatures (Marlin). In Marlin Firmware the Hotend Idle Timeout is active whenever the hotend temperature goes above the trigger value and the timer gets reset whenever the extruder or other axes move. So if the machine is sitting idle for the timeout period (set by M86 T) the machine will reduce the hotend and bed temperatures to those set by M86 E and M86 B. These settings are saved to the EEPROM by M500 and reset to configuration defaults by M502. M87: Cancel Safety TimerUsage M87 Cancels the safety timer. Equivalent to M86 S0. M92: Set axis_steps_per_unitParameters Xnnn Steps per unit for the X drive Ynnn Steps per unit for the Y drive Znnn Steps per unit for the Z drive Ennn Steps per unit for the extruder drive(s) Snnn Defines in which microstepping the above steps per unit are given. If omitted it will use the microstepping currently set by M350.1 Examples M92 X87.489 Y87.489 Z87.489M92 E420:420 Allows programming of steps per unit (usually mm) for motor drives. These values are reset to firmware defaults on power on, unless saved to EEPROM if available (M500 in Marlin) or in the configuration file (config.g in RepRapFirmware). Very useful for calibration. RepRapFirmware will report the current stepsmm if you send M92 without any parameters. For Yaskawa systems M92M93 is not applicable due to use of servo motors. Notes 1 Only available in RepRapFirmware 2.03 M93: Send axis_steps_per_unitM98: Call MacroSubprogramParameters Pnnn Macro filename. In RepRapFirmware 3 this must be enclosed in double-quote characters. In RepRapFirmware 2 the double-quote characters are optional. Example M98 Pmymacro.gM98 Pmymacro.g Runs the macro in the file mymacro.g. In conventional G Codes for CNC machines the P parameter normally refers to a line number in the program itself (P2000 would run the Macro starting at line O2000, say). For RepRap, which almost always has some sort of mass storage device inbuilt, it simply refers to the name of a G-code file that is executed by the G98 call. That G-code file does not need to end with an M99 (return) as the end-of-file automatically causes a return. RepRapFirmware supports nested macro calls up to a depth of 5. Certain machine parameters are saved at the start of the macro call and restored at the end. For RepRapFirmware these are: axis movement relativeabsolute mode, extruder movement absoluterelative mode, feed rate, inchesmm setting, and whether or not volumetric extrusion is selected. This allows the macro to change these settings without affecting the subsequent behaviour of the calling file. RepRapFirmware also allows the filename to include a path to a subdirectory. For relative paths, the default folder is sys, but some implementations may check the macros directory too. Absolute file paths are supported by RepRapFirmware too. M99: Return from MacroSubprogramExample M99 Returns from an M98 call. RepRapFirmware closes the currently active macro file. If a nested macro is being run, RepRapFirmware goes up one stack level. M101: Turn extruder 1 on (Forward), Undo RetractionIn Teacup firmware: If a DC extruder is present, turn that on. Else, undo filament retraction, which means, make the extruder ready for extrusion. Complement to M103. In BFBRapMan: Turn extruder on (forwardfilament in). In RepRapFirmware: undo filament retraction. The length and speed are set by the M207 command. RepRapFirmware supports this command for compatibility with Simplify3D. In other firmwares: Deprecated. Regarding filament retraction, see G10, G11, M207, M208, M227, M228, M229. M102: Turn extruder 1 on (Reverse)In BFBRapMan firmware: Turn extruder on Reverse (Still to add) M102: Configure Distance SensorFor Marlinâ€™s BD_SENSOR option, configure the sensor. M102 S10thsÂ : Set adjustable Z height in 10ths of a mm (e.g., â€˜M102 S4â€˜ enables adjusting for Z 0.4mm.) M102 S0Â : Disable adjustable Z height. Negative S values are commands M102 S-1Â : Read sensor information M102 S-5Â : Read raw Calibration data M102 S-6Â : Start Calibration M103: Turn all extruders off, Extruder RetractionIn Teacup firmware: If a DC extruder is present, turn that off. Else, retract the filament in the hope to prevent nozzle drooling. Complement to M101. In BFBRapMan firmware: Turn extruder off. In RepRapFirmware: retract filament. The length and speed are set by the M207 command. RepRapFirmware supports this command for compatibility with Simplify3D. In other firmwares: Deprecated. Regarding filament retraction, see G10, G11, M207, M208, M227, M228, M229. M104: Set Extruder TemperatureParameters C Use fan for cooling (Buddy only) Dnnn Display temperature (Buddy only) Snnn Target temperature Rnnn Idle temperature (Only MK4duo) Example M104 S190M104 S190 R170 Set the temperature of the current extruder to 190oC and return control to the host immediately (i.e. before that temperature has been reached by the extruder). See also M109. See also using G10. Deprecation of M104 is subject to discussion. â€“Traumflug 11:33, 19 July 2012 (UTC) M104 in Marlin FirmwareSee Marlin Wiki. In Marlin Firmware, using M104 with no parameters will turn off the heater for the current extruder. This is also the case for M104 S without a number after the S parameter. M104 in Teacup FirmwareIn Teacup Firmware, M104 can be additionally used to handle all devices using a temperature sensor. It supports the additional P parameter, which is a zero-based index into the list of sensors in config.h. For devices without a temp sensor, see M106. Example M104 P1 S100 Set the temperature of the device attached to the second temperature sensor to 100Â°C. M104 in RepRapFirmware and KlipperRepRapFirmware and some other firmwares support the optional T parameter (as generated by slic3r) to specify which tool the command applies to. M105: Get Extruder TemperatureParameters This command can be used without any additional parameters. Examples M105 Request the temperature of the current extruder, the build base and the build chamber in degrees Celsius. The temperatures are returned to the host computer. For example, the line sent to the host in response to this command can look like: ok T:201 B:117ok T:201 /202 B:117 /120ok T:201 /202 B:117 /120 C:49.3 /50ok T:201 /202 T0:110 /110 T1:23 /0 B:117 /120 C:49.3 /50ok T0:110 /110 T1:23 /0 B:117 /120ok T:20.2 /0.0 B:19.1 /0.0 T0:20.2 /0.0 @:0 B@:0 P:19.8 A:26.4 The parameters mean the following: T, T0, â€¦, Tn - extruder temperature. In a single extruder setup, only T will be reported. Some firmware variants will report no T0 in multi extruder setups - in that case T is to be considered the temperature of the first tool. Otherwise, T should be considered the temperature of the currently selected tool (which will be repeated in one of the Tn entries) B - bed temperature C - chamber temperature @ - Hotend power B@ - Bed power P - PINDAv2 actual (Prusa MK2.5s MK3s only)1 A - Ambient actual (Prusa MK3s only)1 A temperature report will usually include actual and target temperature for all available heaters, with the format being â€œactualtargetâ€ or - for some firmware variants - â€œactual targetâ€. During a blocking heatup some firmware variants only report the temperature tuple for the heater that is currently in blocking heatup state. Note that temperatures can be reported as integers or floats. There sadly are a lot of interpretations of how an M105 response should look like across firmware variants, making parsing them potentially tricky. Expansiongeneralization of M105 to be considered using S1 parameter as noted in Pronterface IO Monitor In Repetier and MK4duo you can add X0 (X1 MK4duo) to get raw values as well: M105 X0== 11:05:48.910Â : T:23.61 /0 @:0 T0:23.61 /0 @0:0 RAW0:3922 T1:23.89 /0 @1:0 RAW1:3920 Recent versions of RepRapFirmware also report the current and target temperatures of all active heaters. 1Druid firmware Temperature actualtarget in Celcius (actual with one decimal , target is integer) T0: in a single extruder systems, T0: and T1: in dual extruder systems. B: for Heated bed C: for Heated chamber Power applied (PWM value 0-255) @0: and @1: for Hotends B@: for Heated bed C@: for Heated chamber Active or not, the values for all available heaters on the system are sent. Examples T0:27.80 @0:0 T0:27.70 B:21.60 @0:0 B@:0 T0:27.80 T1:27.8210 B:21.60 C:85.00 @0:0 @1:255 B@:0 C@:0 M106: Fan OnParameters Pnnn Fan number (optional, defaults to 0)2 Snnn Fan speed (0 to 255; RepRapFirmware also accepts 0.0 to 1.0)) Extra Parameters Innn Invert signal, or disable fan1 3 Fnnn Set fan PWM frequency, in Hz1 3 Lnnn Set minimum fan speed (0 to 255 or 0.0 to 1.0)1 3 Xnnn Set maximum fan speed (0 to 255 or 0.0 to 1.0)1 3 Bnnn Blip time - fan will be run at full PWM for this number of seconds when started from standstill1 Hnn:nn:nn... Select heaters monitored when in thermostatic mode1 3 Rnnn Restore fan speed to the value it has when the print was paused1 Tnnn Set thermostatic mode trigger temperature Cnnn Set custom name (RRF 2.01 only)1 Example M106 S127 Examples (RepRapFirmware) M106 P1 I1 S87M106 P1 T45 H1:2M106 P2 B0.1 L0.05 The first example turns on the default cooling fan at half speed. The second one inverts the cooling fan signal of the second fan and sets its value to 13 of its maximum. The third one sets the second fan to a thermostatic fan for heaters 1 and 2 (e.g. the extruder heaters in a dual-nozzle machine) such that the fan will be on when either hot end is at or above 45C. Mandatory parameter â€˜Sâ€™ declares the PWM value (0-255). M106 S0 turns the fan off. In some implementations like RepRapFirmware the PWM value may alternatively be specified as a real fraction: M106 S0.7. Notes 1These parameters are only available in RepRapFirmware. 2Marlin 1.0 to 1.1.6 only supports a single fan. Marlin 1.1.7 and up supports up to 3 fans. 3These parameters are only available in MK4duo. M106 in RepRapFirmwareIf an S parameter is provided but no other parameter is present, then the speeds of the print cooling fans associated with the current tool will be set (see the F parameter in the M563 command). If no tool is active then the speed of Fan 0 will be set. Either way, the speed is remembered so that it can be recalled using the R2 parameter (see below). If no S parameter is given but the R1 parameter is used, the fan speed when the print was last paused will be set. If the R2 parameter is used, then the speeds of the print cooling fans associated with the current tool will be set to the remembered value (see above). The T and H parameters allow a fan to be configured to operate in thermostatic mode, for example to use one of the fan channels to control the hot end fan. In this mode the fan will be fully on when the temperature of any of the heaters listed in the H parameter is at or above the trigger temperature set by the T parameter, and off otherwise. Thermostatic mode can be disabled using parameter H-1. The B parameter sets the time for which the fan will be operated at full PWM when started from cold, to allow low fan speeds t be used. A value of 0.1 seconds is usually sufficient. The L parameter defines the minimum PWM value that is usable with this fan. If a lower value is commanded that is not zero, it will be rounded up to this value. The X parameter defines the maximum PWM value that is allowed for this fan. If a higher value is commanded, it will be rounded down to this value. The I parameter causes the fan output signal to be inverted if its value is greater than zero. This makes the cooling fan output suitable for feeding the PWM input of a 4-wire fan via a diode. If the parameter is present and zero, the output is not inverted. If the I parameter is negative then in RRF 1.16 and later the fan is disabled, which frees up the pin for use as a general purpose IO pin that can be controlled using M42. M106 in Teacup FirmwareAdditionally to the above, Teacup Firmware uses M106 to control general devices. It supports the additional P parameter, which is an zero-based index into the list of heatersdevices in config.h. Example M106 P2 S255 Turn on device #3 at full speedwattage. Note: When turning on a temperature sensor equipped heater with M106 and M104 at the same time, temperature control will override the value given in M106 quickly. Note well: The ambiguous text in the note above needs to be reworded by someone who knows the actual functioning. Below is my interpretation based on language use, not practical experience or code inspection. Note: If M104 is (or becomes) active on a heater (or other device) with a feedback sensor it will correct any M106 initiated control output value change in the time it takes for the PID (of other feedback) loop to adjust it back to minimum error. It may not be easy to observe a change in the temperature (process value) due to this brief change in the control value M107: Fan OffDeprecated in Teacup firmware and in RepRapFirmware. Use M106 S0 instead. M108: Cancel HeatingBreaks out of an M109 or M190 wait-for-temperature loop, continuing the print job. Use this command with caution! If cold extrusion prevention is enabled (see M302) and the temperature is too low, this will start â€œprintingâ€ without extrusion. If cold extrusion prevention is disabled and the hot-end temperature is too low, the extruder may jam. This command was introduced in Marlin 1.1.0. As with other emergency commands [e.g., M112] this requires the host to leave space in the command buffer, or the command wonâ€™t be executed until later. Recent versions of Marlin introduce EMERGENCY_PARSER, which overcomes the buffer limitation by watching the incoming serial stream. Commands M108, M112, M410, and M876 can all be intercepted by the emergency parser, so it is recommended to enable this feature. M108: Set Extruder Speed (BFB)Sets speed of extruder motor. (Deprecated in FiveD firmware, see M113) M109: Set Extruder Temperature and WaitParameters C Use fan for cooling (Buddy only) Snnn minimum target temperature, waits until heating Rnnn maximum target temperature, waits until cooling (Sprinter) Rnnn accurate target temperature, waits until heating and cooling (Marlin and MK4duo) Tn tool number (RepRapFirmware and Klipper), optional Example M109 S215 M109 in TeacupNot needed. To mimic Marlin behaviour, use M104 followed by M116. M109 in Marlin, MK4duo, Sprinter (ATmega port), RepRapFirmware, PrusaSet extruder heater temperature in degrees celsius and wait for this temperature to be achieved. Example M109 S185 RepRapFirmware also supports the optional T parameter (as generated by slic3r) to specify which tool the command refers to (see below). M109 in Sprinter (4pi port)Parameters: S (optional), set target temperature value. If not specified, waits for the temperature set by M104. R (optional), sets target temperature range maximum value. Example M109 S185 R240Â ; set extruder temperature to 185 and wait for the temperature to be between 185 - 240. If you have multiple extruders, use T or P parameter to specify which extruder you want to setwait. Another way to do this is to use G10. M109 in MakerBotExample M109 S70 T0 Sets the target temperature for the current build platform. S is the temperature to set the platform to, in degrees Celsius. T is the platform to heat. M109 in KlipperAccording to the documentation, Klipper will wait for the specified temperature to settle, i.e. it will wait until it goes back down in case it overshoots. Klipper also supports the optional T parameter to specify which tool the command refers to (see above). M110: Set Current Line NumberThis command is used for host handshaking, error detection, and resend requests in host-driven print jobs when line numbers are used. See the G-code protocol described above. Parameters Nnnn Line number Example M110 N123 This example sets the current command line number to 123. Thus the expected next line after this command will be 124. In Marlin 2.1.3 and up M110 with no parameter reports the current command line number. M111: Set Debug LevelParameters Pnnn Debug module1 Snnn Debug onoff Examples M111 S6M111 P1 S1 Enable or disable debugging features in the firmware. The implementation may look different per firmware. Notes 1This parameter is only available in RepRapFirmware. 2Prusa fimrware use D-codescommands for debugging. M111 in RepRapFirmwareRepRapFirmware allows debugging to be set for each module. If the optional â€˜Pâ€™ parameter is not specified, debugging will be enabled for all modules. For a list of modules, send M111 S1 P15. M111 in RepetierSet the level of debugging information transmitted back to the host to level 6. The level is the OR of three bits: #define DEBUG_ECHO (10)#define DEBUG_INFO (11)#define DEBUG_ERRORS (12)#define DEBUG_DRYRUN (13) // repetier-firmware#define DEBUG_COMMUNICATION (14) // repetier-firmware Thus 6 means send information and errors, but donâ€™t echo commands. (This is the RepRap default.) For firmware that supports ethernet and web interfaces M111 S9 will turn web debug information on without changing any other debug settings, and M111 S8 will turn it off. Web debugging usually means that HTTP requests will be echoed to the USB interface, as will the responses. M112: Full (Emergency) StopExample M112 Any moves in progress are immediately terminated, then RepRap shuts down. All motors and heaters are turned off. It can be started again by pressing the reset button on the master microcontroller. See also M0 and M1. Please note while many systems termed this an Emergency Stop, this terminology is regulated in many regions with specific requirements behind its use. Marlin 2.0.x has renamed this to Full Stop. RepRapFirmware has indicated an intention to make a similar change as well. This stop function is NOT implemented in a Category 0 or 1 stop fashion or with fail-safe hardware compliying with PLd or better. The function as implemented is a category 2 software stop with no redundancies. M113: Set Extruder PWMExample M113 Set the PWM for the currently-selected extruder. On its own this command sets RepRap to use the on-board potentiometer on the extruder controller board to set the PWM for the currently-selected extruderâ€™s stepper power. With an S field: M113 S0.7 it causes the PWM to be set to the S value (70% in this instance). M113 S0 turns the extruder off, until an M113 command other than M113 S0 is sent. M113: Host KeepaliveDuring some lengthy processes, such as G29, Marlin may appear to the host to have â€œgone away.â€ The â€œhost keepaliveâ€ feature will send messages to the host when Marlin is busy or waiting for user response so the host wonâ€™t try to reconnect. Usage M113 Snnn Parameters Snnn keepalive interval to set Examples M113 S2 M114: Get Current PositionExample M114 This causes the RepRap machine to report its current X, Y, Z and E coordinates to the host. For example, the machine returns a string such as: ok C: X:0.00 Y:0.00 Z:0.00 E:0.00 In Marlin first 3 numbers is the position for the planner. The other positions are the positions from the stepper function. This helps for debugging a previous stepper function bug. X:0.00 Y:0.00 RZ:0.00 LZ:0.00 Count X:0.00 Y:0.00 RZ:41.02 LZ:41.02 M115: Get Firmware Version and CapabilitiesParameters This command can be used without any additional parameters. Bnnn (RepRapFirmware 3 only) Expansion board number (typically the CAN address) for which the firmware version is requested, default 0 (i.e. main board) Pnnn Electronics type1 V Report the Prusa version number2 Unnnnnn Check the firmware version provided2 Examples M115M115 P2 Request the Firmware Version and Capabilities of the current microcontroller The details are returned to the host computer as key:value pairs separated by spaces and terminated with a linefeed. sample data from firmware: ok PROTOCOL_VERSION:0.1 FIRMWARE_NAME:FiveD FIRMWARE_URL:http%3A//reprap.org MACHINE_TYPE:Mendel EXTRUDER_COUNT:1 This M115 code is inconsistently implemented, and should not be relied upon to exist, or output correctly in all cases. An initial implementation was committed to svn for the FiveD Reprap firmware on 11 Oct 2010. Work to more formally define protocol versions is currently (October 2010) being discussed. See M115_Keywords for one draft set of keywords and their meanings. See the M408 command for a more comprehensive report on machine capabilities supported by RepRapFirmware. Notes 1This parameter is supported only in RepRapFirmware and can be used tell the firmware about the hardware on which it is running. If the P parameter is present then the integer argument specifies the hardware being used. The following are currently supported: M115 P0 Automatic board type selection if supported, or default if notM115 P1 Duet 0.6M115 P2 Duet 0.7M115 P3 Duet 0.85 2These parameters are only supported in Prusa Firmware. Parameter Unnnnnn will check the firmware version provided. If the firmware version provided by the U code is higher than the currently running firmware, it will pause the print for 30s and ask the user to upgrade the firmware. sample data M115: FIRMWARE_NAME:Prusa-Firmware 3.8.1 based on Marlin FIRMWARE_URL:https://github.com/prusa3d/Prusa-Firmware PROTOCOL_VERSION:1.0 MACHINE_TYPE:Prusa i3 MK3S EXTRUDER_COUNT:1 UUID:00000000-0000-0000-0000-000000000000 sample data M115 V 3.8.1 sample data on display for 30s or user interactionM115 U3.8.2-RC1 New firmware version availible:3.8.2-RC1Please upgrade. M116: WaitParameters This command can be used without any additional parameters.1 Pnnn Tool number Hnnn Heater number Cnnn Chamber number Examples M116M116 P1 Wait for all temperatures and other slowly-changing variables to arrive at their set values if no parameters are specified. See also M109. Notes 1Most implementations donâ€™t support any parameters, but RepRapFirmware version 1.04 and later supports an optional â€˜Pâ€™ parameter that is used to specify a tool number. If this parameter is present, then the system only waits for temperatures associated with that tool to arrive at their set values. This is useful during tool changes, to wait for the new tool to heat up without necessarily waiting for the old one to cool down fully. Recent versions of RepRapFirmware also allow a list of the heaters to be specified using the â€˜Hâ€™ parameter, and if the â€˜Câ€™ parameter is present, this will indicate that the chamber heater should be waited for. M117: Get Zero PositionExample M117 This causes the RepRap machine to report the X, Y, Z and E coordinates in steps not mm to the host that it found when it last hit the zero stops for those axes. That is to say, when you zero X, the x coordinate of the machine when it hits the X endstop is recorded. This value should be 0, of course. But if the machine has drifted (for example by dropping steps) then it wonâ€™t be. This command allows you to measure and to diagnose such problems. (E is included for completeness. It doesnâ€™t normally have an endstop.) M117: Display MessageExample M117 Hello World This causes the given message to be shown in the status line on an attached LCD. The above command will display Hello World. If RepRapFirmware is used and no LCD is attached, this message will be reported on the web interface. Notes In Prusa Firmware it is also used to display internal messages on LCD.1 In RepRapFirmware the message may optionally be enclosed in double-quotation marks. Doing this is recommended, to clarify the extent of the text to be displayed. M118: Echo message on hostUse this code to print a visible message to the host console, preceded by â€˜echo:â€™. Parameters Pn (RepRapFirmware only) Message targets(s): 0 generic [default], 1 USB, 2 LCD, 3 HTTP, 4 Telnet Smsg (RepRepFirmware only) Message to send Example (Marlin) M118 Color changing to blue Example (RepRapFirmware) M118 P2 SColor changing to blue M118: Negotiate FeaturesExample M118 P42 This M-code is for future proofing. NO firmware or hostware supports this at the moment. It is used in conjunction with M115â€˜s FEATURES keyword. See Protocol_Feature_Negotiation for more info. M119: Get Endstop StatusExample M119 Returns the current state of the configured X, Y, Z endstops. Takes into account any â€˜inverted endstopâ€™ settings, so one can confirm that the machine is interpreting the endstops correctly. In redeem, M119 can also be used to invert end stops. Example M119 X1 1 This will invert end stop X1 (Inverted means switch is connected in Normally Open state (NO)) M120: PushExample M120 Push the state of the RepRap machine onto a stack. Exactly what variables get pushed depends on the implementation (as does the depth of the stack - a typical depth might be 5). A sensible minimum, however, might be Current feedrate Whether moves are relative or absolute Whether extrusion is relative or absolute RepRapFirmware calls this automatically when a macro file is run. In addition to the variables above, it pushes the following values on the stack: Whether the units are inches or mm Whether or not volumetric extrusion is in use The selected plane (see G17G18G19) for G2G3 moves M121: PopExample M121 Recover the last state pushed onto the stack. RepRapFirmware calls this automatically when execution of a macro file terminates. M120: Enable endstop detectionM121: Disable endstop detectionM122: Firmware dependentM122: Diagnose (RepRapFirmware)Parameters Bmmm Expansion board number for which diagnostics are requested, default 0 which means main board Pnnn Optional parameter to specify what diagnostics are required. Caution: some values of P will crash the firmware deliberately to test error handling! See the Duet3D wiki for more details. â€œDSFâ€ Immediate DSF diagnostics (RRF3Duet3 only with attached SBC) P200 - LPC and STM32 Port Only Outputs the configuration of all the pins allocated by the firmware and board.txt Example M122 Sending an M122 causes the RepRap to transmit diagnostic information, for example via a USB serial link. If RepRapFirmware is used and debugging is enabled for the Network module, this will also print LWIP stats to the host via USB. M122: Set Software Endstop (MK4duo)Disabled or Enabled Software Endstop M122 S01 M122: Debug Stepper drivers (Marlin)Get diagnostic info about L6470 or Trinamic stepper drivers having a UART or SPI interface. With Trinamic drivers there are some extra parameters, and depending on the configuration either basic or detailed information will be reported. Use parameters X, Y, Z, etc. to limit the report only to the specified steppers, otherwise all steppers are reported. Pass I to re-initialize the drivers. Use parameter S to sample at regular intervals. The P parameter can be used to set the sample interval in milliseconds. Example M122 M123: Firmware dependentM123: Tachometer value (RepRap, Prusa Marlin)Sending a M123 causes the RepRap to transmit filament tachometer values from all extruders. Sending a M123 is used in Prusa firmware to report fan speeds and fan pwm values.1 Sending a M123 is used in Marlin firmware to report only extruders fans speeds and pwm values.2 Usage M123 Parameters2 Sn autoreport every n seconds (0 to disable) Prusa firmware output1 E0: - Hotend fan speed in RPM PRN1: - Part cooling fans speed in RPM E0@: - Hotend fan PWM value PRN1@: - Part cooling fan PWM value Examples1 echo E0:3240 RPM PRN1:4560 RPM E0@:255 PRN1@:255 Examples2 echo E0:7040 RPM E0@:255 M123: Endstop Logic (MK4duo)Parameters Xn X Logic Yn Y Logic Zn Z Logic In X2 Logic Jn Y2 Logic Kn Z2 Logic Pn Probe Logic Dn Door Logic Examples M123Â ; Print StatusM123 X1 Y1 Z0 P0 M124: Firmware dependentM124: Immediate motor stopImmediately stops all motors. M124: Set Endstop PullupParameters Xn X Pullup onoff Yn Y Pullup onoff Zn Z Pullup onoff In X2 Pullup onoff Jn Y2 Pullup onoff Kn Z2 Pullup onoff Pn Probe Pullup onoff Dn Door Pullup onoff Examples M124Â ; Print StatusM124 X1 Y1 Z0 P0 M125: Firmware dependentM125: Park HeadSave the current nozzle position and move to the configured park position. Usage M125 [L | P | X | Y |Z ] Parameters L Retract length P Always show a prompt and await a response 1 X X position to park Y Y position to park Z Z raise before park 1 Not in Prusa Buddy firmware M125: Pause printWithout any parameters it will park the extruder to default or last set position. The default pause position will be set during power up and a reset, the new pause positions arenâ€™t permanent. Usage M125 [ X | Y | Z | S ] Parameters X X position to park Y Y position to park Z Z raise before park S Set values [S0 set to default values | S1 set values] without pausing Equivalent to M601 and M25 in Prusa Firmware M126: Open ValveExample M126 P500 Open the extruderâ€™s valve (if it has one) and wait 500 milliseconds for it to do so. M126 in MakerBotExample M126 T0 Enables an extra output attached to a specific toolhead (e.g. fan) M127: Close ValveExample M127 P400 Close the extruderâ€™s valve (if it has one) and wait 400 milliseconds for it to do so. M127 in MakerBotExample M127 T0 Disables an extra output attached to a specific toolhead (e.g. fan) M128: Extruder Pressure PWMExample M128 S255 PWM value to control internal extruder pressure. S255 is full pressure. M129: Extruder pressure offExample M129 P100 In addition to setting Extruder pressure to 0, you can turn the pressure off entirely. P400 will wait 100ms to do so. M130: Set PID P valueParameters Pnnn heater number Snnn proportional (Kp) Example M130 P0 S8.0 ; Sets heater 0 P factor to 8.0 Teacup can control multiple heaters with independent PID controls. For the default shown at https://github.com/Traumflug/Teacup_Firmwareblobmasterconfig.default.h, heater 0 is the extruder (P0), and heater 1 is the bed (P1). Teacupâ€™s PID proportional units are in pwm255 counts per quarter C, so to convert from countsC, you would divide by 4. Conversely, to convert from countqC to countC, multiply by 4. In the above example, S8 represents a Kp8*432 countsC. M131: Set PID I valueParameters Pnnn heater number Snnn integral (Ki) Example M131 P1 S0.5 ; Sets heater 1 I factor to 0.5 Teacupâ€™s PID integral units are in pwm255 counts per (quarter C*quarter second), so to convert from countsqCqs, you would divide by 16. Conversely, to convert from countqCqs to countCs, multiply by 16. In the above example, S0.5 represents a Ki0.5*168 countsCs. M132: Set PID D valueParameters Pnnn heater number Snnn derivative (Kd) Example M132 P0 S24 ; Sets heater 0 D factor to 24.0 Teacupâ€™s PID derivative units are in pwm255 counts per (quarter degree per 2 seconds), so to convert from countsC, you would divide by 4. Conversely, to convert from countqC to countC, multiply by 8. In the above example, S24 represents a Kd24*8194 counts(Cs). M132 in MakerBotExample M132 X Y Z A B Loads the axis offset of the current home position from the EEPROM and waits for the buffer to empty. M133: Set PID I limit valueParameters Pnnn heater number Snnn integral limit (Ki) Example M133 P1 S264 ; Sets heater 1 I limit value to 264 Teacupâ€™s PID integral limit units are in quarter-C*quarter-seconds, so to convert from C-s, you would multiply by 16. Conversely, to convert from qC*qs to C*s, divide by 16. In the above example, S264 represents an integral limit of 16.5 C*s. M133 in MakerBotWait for the toolhead to reach its target temperature. Parameters TnnÂ : Extruder to wait for PnnÂ : Time limit, in seconds Example M133 T0 P500Â ; Wait for Tool 0 to reach target. Fail after 8:20. M134: Write PID values to EEPROMExample M134 M134 in MakerBotExample M134 T0 P500 Instruct the machine to wait for the platform to reach its target temperature. T is the platform to wait for. P if present, sets the time limit. M135: Set PID sample intervalParameters Snnn Heat sample time in seconds Example M135 S300 Set the PID to measure temperatures and calculate the power to send to the heaters every 300ms. M135 in MakerBotExample M135 T0 Instructs the machine to change its toolhead. Also updates the State Machineâ€™s current tool_index. T is the toolhead for the machine to switch to and the new tool_index for the state machine to use. M136: Print PID settings to hostExample M136 P1 ; print heater 0 PID parameters to host M140: Set Bed Temperature (Fast)Parameters Pnnn Bed heater index1 Hnnn Heater number1 Tnnn Tool number2 Snnn ActiveTarget temperature Rnnn Standby temperature1 2 Example M140 S55 Set the temperature of the build bed to 55oC and return control to the host immediately (i.e. before that temperature has been reached by the bed). Notes 1 These parameters are only supported in RepRapFirmware. RepRapFirmware allows the bed heater to be switched off if the absolute negative temperature (-273.15) is passed as target temperature. In this case the current bed temperature is not affected: M140 S-273.15 2 These parameters are only supported in MK4duo for Idle temperature M140 S60 R30M140 T1 S60 R30 There is an optional R field that sets the bed standby temperature: M140 S65 R40. Recent versions of RepRapFirmware also provide an optional â€˜Hâ€™ parameter to set the hot bed heater number. If no heated bed is present, a negative value may be specified to disable it. M141: Set Chamber Temperature (Fast)Parameters Pnnn Chamber index1 Hnnn Heater number1 Tnnn Tool number2 Snnn ActiveTarget temperature Rnnn Standby temperature1 2 Examples M141 S30M141 H0 Set the temperature of the chamber to 30oC and return control to the host immediately (i.e. before that temperature has been reached by the chamber). Notes 1 These parameters are only supported in RepRapFirmware and work just like in M140. 2 These parameters are only supported in MK4duo and work just like in M140. M142: Firmware dependentM142: Holding PressureExample M142 S1 Set the holding pressure of the bed to 1 bar. The holding pressure is in bar. For hardware which only has onoff holding, when the holding pressure is zero, turn off holding, when the holding pressure is greater than zero, turn on holding. M142: Set Cooler Temperature (Fast)Parameters Tnnn Tool number Snnn ActiveTarget temperature Rnnn Standby temperature Examples M142 S60M142 S60 R30M141 T1 S60 R30 Set the temperature of the cooler M143: Firmware dependentM143: Set Laser Cooler Temperature (Fast)Parameters Snnn Target temperature Examples M143 S80 Set the target temperature of the laser cooler and return immediately. Use M193 to set and wait for the temperature to be reached. M143: Maximum heater temperatureParameters H Heater number (RepRapFirmware 1.17 and later, default 1 which is normally the first hot end) S Maximum temperature Examples M143 S275 ; set the maximum temperature of the hot-end to 275Â°CM143 H0 S125 ; set the maximum bed temperature to 125C The default maximum temperature for all heaters was 300Â°C prior to RepRapFirmware version 1.13, and 262Â°C from 1.13 onwards. From RepRapFirmware 1.17 onwards, the default maximum temperatures are 262C for extruders and 125C for the bed. When the temperature of the heater exceeds this value, countermeasures will be taken. M144: Bed StandbyParameters Pnn Bed heater number, default 0 Sn 0 set bed heater to standby (default), 1 set bad heater active Example M144 Switch the bed heater to its standby temperature. M140 S1 turns it back to its active temperature. M146: Set Chamber HumidityParameters Rnnn Relative humidity in percent Example M146 R60 Set the relative humidity of the chamber to 60% and return control to the host immediately (i.e. before that humidity has been reached by the chamber). M149: Set temperature unitsParameters C Flag to treat temperature as degrees Celsius K Flag to treat temperature as Kelvin Example M149 K It affects the S or R values in the codes M104, M109, M140, M141, M143, M190 and G10. The default is M149 C. M150: Set LED colorParameters Rnnn Red component Unnn Green component Bnnn Blue component Wnnn White component (Marlin) Pnnn Brightness (0-255) (Marlin, also RepRapFirmware 2.03 and later) P Set full brightness (Marlin) Snnn (RepRapFirmware) Number of individual LEDs to set to these colours Fn (RepRapFirmware) Following command action. F0 (default) means this is the last command for the LED strip, so the next M150 command starts at the beginning of the strip. F1 means further M150 commands for the remainder of the strip follow this one. Xn (RepRapFirmware) LED type: X0 (default) DotStar, X1 NeoPixel. This parameter is remembered from one call to the next, so it only needs to be given once. Ynn (RepRapFirmware) Brightness, 0-31 (alternative to P 0-255) Qnnn (RepRapFirmware) Use specified SPI frequency (in Hz) instead of default frequency. This parameter is only processed if X parameter also present. When using NeoPixels, only frequencies between about 2.5MHz and 4MHz will work. Example M150 R255 U128 B192 Example (RepRapFirmware) M150 X1 F3000000 ; set LED type to NeoPixel and set SPI frequency to 3MHzM150 R255 P128 S20 F1 ; set first 20 LEDs to red, half brightness, more commands for the strip followM150 U255 B255 P255 S20 ; set next 20 LEDs to cyan, full brightness, finished programming LED strip Set BlinkM, Neopixel, andor other LED light color and intensity with RGBW component values from 0 to 255. Some LCD controllers use this interface for a backlight. Firmware may override the set color to indicate the current printer status. RepRapFirmware uses this command to control DotStar or NeoPixel LED strips on controllers that provide a connector for this purpose. When using NeoPixel strips there is a firmware-dependent maximum number of LEDs in the strip supported determined by the size of the DMA buffer. Notes In Prusa Firmware this G-code is deactivated by default, must be turned on in the source code.1 M154: Auto Report PositionHosts normally monitor printer position by sending M114 every couple of seconds. This adds more serial traffic and fails if the command queue is full. M154 reduces traffic by setting the firmware to report the â€˜projectedâ€™ position at regular intervals. This behavior is disabled by default for best compatibility with existing hosts. If the firmware supports M154 the output of M115 will report the AUTOREPORT_POS capability. Usage M154 SnnnÂ : Set the auto-report interval in seconds. Set the interval to 0 to disable. M155: Automatically send temperaturesParameters Snnn enable sending temperatures 1, disable 0 Snnn Interval in seconds between auto-reports. S0 to disable. (Marlin) Prusa has a Maximum: 2551 Cnn Activate auto-report function (bit mask). Default is temperature.1 C bitmap1 bit 0 = Auto-report temperatures bit 1 = Auto-report fans bit 2 = Auto-report position bit 3 = free bit 4 = free bit 5 = free bit 6 = free bit 7 = free Examples M155 S1Â ; Enable temperature report (Marlin: every 1 second)M155 S0Â ; Stop reporting temperaturesM155 S4Â ; Report temperatures every 4 seconds (Marlin)M155 S4 C7; Reports temperatures, fans and position every 4 seconds (Prusa)1 Hosts normally monitor printer temperatures by sending M105 every couple of seconds. This not only adds serial traffic but it will fail whenever the command queue is full. M155 addresses these problems by telling the firmware to automatically report temperatures at regular intervals. This behavior is disabled by default for best compatibility with existing hosts. If the firmware supports M155 the output of M115 will report the AUTOREPORT_TEMP capability: Cap:AUTOREPORT_TEMP:1 Prusa Firmware 3.10.0+ also adds capabilities: Cap:AUTOREPORT_FANS:1Cap:AUTOREPORT_POSITION:1Cap:EXTENDED_M20:1 M160: Number of mixed materialsExample M160 S4 This command has been superseded by the tool definition command M563 (see below). Set the number of materials, N, that the current extruder can handle to the number specified. The default is 1. When N 2, then the E field that controls extrusion requires N values separated by colons â€œ:â€ after it like this: M160 S4G1 X90.6 Y13.8 E2.24:2.24:2.24:15.89G1 X70.6 E0:0:0:42.4G1 E42.4:0:0:0 The second line moves straight to the point (90.6, 13.8) extruding a total of 22.4mm of filament. The mix ratio for the move is 0.1:0.1:0.1:0.7. The third line moves back 20mm in X extruding 42.4mm of filament. The fourth line has no physical effect. M163: Set weight of mixed materialParameters Snnn extruder number Pnnn weight Set weight for this mixing extruder drive.See Repetier Color Mixing for more informations. M164: Store weightsParameters Snnn virtual extruder number Pnnn store to eeprom (P0 no, P1 yes) Store weights as virtual extruder S. M165: Set multiple mix weightsParameters A B C D H I A[factor] Mix factor for extruder stepper 1 B[factor] Mix factor for extruder stepper 2 C[factor] Mix factor for extruder stepper 3 D[factor] Mix factor for extruder stepper 4 H[factor] Mix factor for extruder stepper 5 I[factor] Mix factor for extruder stepper 6 Set multiple mix factors for a mixing extruder. Factors that are left out will be set to 0. All factors together must add up to 1.0. M190: Wait for bed temperature to reach target tempParameters Snnn minimum target temperature, waits until heating Rnnn accurate target temperature, waits until heating and cooling (Marlin and Prusa) Example M190 S60 Wait for the bed temperature to reach 60 degrees, printing out the temperatures once per second. M191: Wait for chamber temperature to reach target tempExample M191 S60 Set the temperature of the build chamber to 60 Â°C and wait for the temperature to be reached. Parameters Snnn minimum target temperature, waits until heating Rnnn accurate target temperature, waits until heating and cooling (Marlin) M192: Wait for Probe TemperatureUse M192 to dwell until the probe is at or above a given temperature. M193: Set Laser Cooler TemperatureParameters Snnn Target temperature Examples M193 S65 Set the target temperature of the laser cooler and wait for the temperature to be reached. Use M143 to set the temperature and return immediately. If the Emergency Parser is enabled you can use M108 to break out of the wait loop. M200: Set filament diameterVolumetric Extrusion is a firmware mode (and an option you can set in some slicers) wherein all extrusion amounts are specified as a volume â€”using cubic millimeters or inches (i.e., mm3 or in3)â€” instead of a linear distance. This makes it possible to use the same G-code with any filament diameter. M200 tells the firmware what the filament diameter is, and (if non-zero) to enable Volumetric Extrusion. Send M200 without parameters to get the current Volumetric Extrusion state and filament diameters. Note that slicer-commanded retraction amounts must also be specified in mm3 since the E axis is interpreted as a volume. However, when using Firmware Retraction (G10 G11) the retractions specified by M207 are still set in linear units. Parameters (Marlin) D[linear] Set the filament diameter in current units. If non-zero, enable Volumetric Extrusion. T[index] Select the target extruder. If omitted, the active extruder. S[bool] Enable or Disable Volumetric Extrusion (without modifying the filament diameter). L[limit] Set the Maximum Extrusion Volume in mm3 per second. (Ignores units set by G20.) Use L0 for no limit. Examples (Marlin) M200 D0 ; Disable Volumetric Extrusion on all extrudersM200 D1.75 ; Set filament diameter for the current extruder to 1.75mmM200 T1 D2.85Â ; Set filament diameter for E2 to 1.75mmM200 T1 L12 ; Set Maximum Extrusion Volume for E2 to 12mm3M200 S1 ; Enable Volumetric Extrusion using the last-set diameters Parameters (RepRapFirmware) Daaa:bbb:ccc... Set filament diameter to aaa for extruder 1, bbb for extruder 2, etc. In RepRapFirmware 3.4 and earlier, if any of aaa, bbb etc. are zero then Volumetric Extrusion is disabled for that extruder. Daaa Set filament diameter for all extruders. S[bool] Enable or disable volumetric extrusion for this input channel (RepRapFirmware 3.5 and later) Examples (RepRapFirmware) M200 D0 ; Disable volumetric extrusion on all extruders (RRF 3.4 and earlier)M200 S0 ; Disable volumetric extrusion for tis input channel (RRF 3.5 and later)M200 D1.75 ; Set all extruder filament diameters to 1.75mmM200 D1.75:3.0:1.75 ; Set extruder 0 to 1.75mm, E1 to 3.0mm and the rest to 1.75mm M201: Set max accelerationParameters Xnnn Acceleration for X axis in unitss2 Ynnn Acceleration for Y axis in unitss2 Znnn Acceleration for Z axis in unitss2 Ennn Acceleration for the active or specified extruder in unitss2 Example M201 X1000 Y1000 Z100 E2000 Set the acceleration that axes can do in unitss2. The M201 command is intended to define the machineâ€™s physical limits. Slicers should use the M204 command to define accelerations for a job and leave M201 settings to the user. RepRapFirmware specific: Multiple colon-separated E values can be provided, so that different extruders can use different accelerations. If a single E value is provided, that value is applied to all extruders. The values must be provided in mmsec^2 even if G20 has been used to set units to inches. M201 without parameters reports the current settings. M201.1: Set reduced acceleration for special move typesParameters Xnnn Acceleration for X axis in unitss2 Ynnn Acceleration for Y axis in unitss2 Znnn Acceleration for Z axis in unitss2 Ennn:nnn... Acceleration for the extruders in unitss2 Example M201.1 X500 Y500 Z20 E500:500 Set the acceleration that axes should use for special types of move that should be done using reduced acceleration. RepRapFirmware specific: these values are used for probing moves (because some types of Z probe can be triggered by high acceleration at the start of the move) and for moves that involve stall detection endstops (because high acceleration can bring the motor close to stalling). If a single E value is provided, that value is applied to all extruders. The values must be provided in mmsec^2 even if G20 has been used to set units to inches. M201.1 without parameters reports the current settings. M202: Set max travel accelerationSet max travel acceleration in unitss^2 for travel moves (M202 X1000 Y1000). Unused in Marlin!! M203: Firmware dependentM203: Set maximum feedrateParameters Xnnn Maximum feedrate for X axis Ynnn Maximum feedrate for Y axis Znnn Maximum feedrate for Z axis Ennn Maximum feedrate for extruder drives Innn (RepRapFirmware) Minimum feed rate (optional) Example M203 X6000 Y6000 Z300 E10000 Sets the maximum feedrates that your machine can do in mmmin. (Marlin uses mmsec). This command is intended to define the machine limits. Slicers should not generate M203 commands, instead they should use the F parameter on G0, G1 etc. command to specify the requested speeds. M203 (Repetier): Set temperature monitorSet temperature monitor to Sx. Repetier Firmware only. M204: Firmware dependentM204: Set default accelerationParameters (RepRapFimware) Pnnn Acceleration for printing moves Tnnn Acceleration for travel moves Example M204 P500 T2000 Accelerations set with M204 apply to the move as a whole based on the type of move. Use M201 to set limits for each axis individually. Both of these limits will be applied during printing. Parameters (MK4duo) Pnnn Acceleration for printing moves Vnnn Acceleration for travel moves Rnnn Acceleration for Retraction for Tools with T code Example M204 P500 V2000 T0 R5000 Other firmwares: S[accel] Set Acceleration for normal moves in unitss2 T[accel] Set Acceleration for retractrecover moves in unitss2 B[ms] Set Minimum Segment Time to prevent planner starvation. Marlin notes: Since version 1.0.2-1 the M204 options are: P[accel] Set Acceleration for Printing moves. (i.e., Any XYZ motion plus E.) R[accel] Set Acceleration for Retract moves. (i.e., E-axis only moves.) T[accel] Set Acceleration for Travel moves. (i.e., without E movement) Example Set the acceleration for printing movements to 800mms^2, for travels to 3000mms^2 and for retracts to 9000mms^2. M204 P800 T3000 R9000 M204: Set PID valuesUsage M204 X[Kp] Y[Ki] Z[Kd] Set one or more PID parameters. Values are 100 * real value. M205: Firmware dependentM205: Advanced settingsSprinter Marlin Minimum travel speed S[printing] T[travel] B[min segment time] X[max XY jerk] Z[max Z jerk] E[max E jerk] Sprinter Marlin Example M205 X30 Z5Â ; Set X/Y Jerk to 30mm/s, Z jerk to 5mm/s Smoothieware uses a different algorithm: [1] X[xy junction deviation] Z[z junction deviation] S[minimum planner speed]. Z junction deviation only applies to z only moves 0 disables junction deviation for Z -1 uses global junction deviation Smoothie example M205 X0.05 ; set X/Y Junction Deviation M205: EEPROM ReportOutput EEPROM settings. Repetier Firmware only. M206: Firmware dependentM206: Offset axesParameters Xnnn X axis offset Ynnn Y axis offset Znnn Z axis offset Example M206 X10.0 Y10.0 Z-0.4 The values specified are added to the endstop position when the axes are referenced. The same can be achieved with a G92 right after homing (G28, G161). With Marlin firmware, the current values can read from the machine with a bare M206 command and be saved to EEPROM using the M500 command. (See also M290: Babystepping) A similar command is G10, aligning these two is subject to discussion. With Marlin 1.0.0 RC2 a negative value for z lifts(!) your printhead. In builds of RepRapFirmware that support CNC workplace coordinates, using this command is equivalent to using G10 L2 P1 to set the coordinate offsets for workplace 1. M206: Set EEPROM valueSet a Repetier Firmware EEPROM value. Parameters T[type] Value type P[pos] Value position [S(long)] An integer value [X(float)] A float value Example M206 T3 P39 X19.9Â ; Set Jerk to 19.9 M207: Firmware dependentM207: Set retract lengthParameters Snnn positive length to retract, in mm Rnnn positive or negative additional length to un-retract, in mm (RepRapFirmware only) Fnnn retraction feedrate, in mmmin Tnnn feedrate for un-retraction if different from retraction, mmmin (RepRapFirmware 1.16 and later only) Znnn additional zlifthop Example M207 S4.0 F2400 Z0.075 Set the retract length used by the G10 and G11 commands. Units are in mm regardless of M200 setting. Machinekit uses different parameters and speed units for M207. Use P to set retract length in mm. Use Q to set retract velocity in mms. For firmware retraction Machinekit uses G22 and G23 in place of G10 and G11. M207 Calibrate Z axis with Z max endstopExample M207 After placing the tip of the nozzle in the position you expect to be considered Z0, issue this command to calibrate the Z axis. It will perform a z axis homing routine and calculate the distance traveled in this process. The result is stored in EEPROM as z_max_length. For using this calibration method the machine must be using a Z MAX endstop. This procedure is usually more reliable than mechanical adjustments of a Z MIN endstop. M207 (Repetier): Set jerk without saving to EEPROMRepetier Firmware only. Change the maximum instantaneous speed change (â€œjerkâ€) values, but donâ€™t store the change in EEPROM. Since Repetier 0.91 December 2013 [2] (if not earlier) Parameters Xnnn Temporarily set XY jerk in mms Znnn Temporarily set Z jerk in mms Ennn Temporarily set Extruder jerk in mms Example M207 X10 ; Change the X/Y Jerk to 10mm/s M208: Firmware dependentM208: Set unretract lengthParameters Snnn positive length surplus to the M207 Snnn, in mm Fnnn feedrate, in mmsec Sets the â€œrecoverâ€ (aka â€œunretractâ€) length. M208 (RepRapFirmware): Set axis max travelParameters Snnn 0 set axis maximum (default), 1 set axis minimum Xnnn X axis limit Ynnn Y axis limit Znnn Z axis limit Example M208 X200 Y200 Z90Â ; set axis maxima M208 X-5 Y0 Z0 S1Â ; set axis minima The values specified set the software limits for axis travel in the specified direction. The axis limits you set are also the positions assumed when an endstop is triggered. M209: Enable automatic retractWith automatic retract detection, G-code generated by slicers without G10G11 support can take advantage of Firmware Retraction. The firmware converts E-only moves into retractrecover moves, using the firmwareâ€™s tuned lengths and feedrates in place of the original E moves. Example M209 S1 The S parameter turns Automatic Retract Detection on (1) or off (0). M210: Set homing feedratesExample M210 X1000 Y1500 Set the feedrates used for homing to the values specified in mm per minute. If the machine is set to inches mode (e.g., with G20), this command may treat input values as inches-per-minute. M211: DisableEnable software endstopsThe boolean value S 1enable or 0disable controls state of software endstop. The boolean value X, Y or Z 1max endstop or 0min endstop selects which endstop is controlled. Example M211 X1 Y1 Z1 S0 Disables X,Y,Z max endstops Example M211 X0 S1 Enables X min endstop Example M211 Prints current state of software endstops. M212: Set Bed Level Sensor OffsetThis G-Code command is known to be available in the newer versions of PrintrBotâ€™s branch of Marlin. It may not be available in other firmware. Example M212 Z-0.2 Set the Z home to 0.2 mm lower than where the sensor says Z home is. This is extremely useful when working with printers with hard-to-move sensors, like the PrintrBot Metal Plus. PrintrBot suggests that the user make minor (0.1-0.2) adjustments between attempts and immediately executes M500 M501 after setting this. M214: Set Arc configuration valuesUsage M214 [P] [S] [N] [R] [F] Parameters Pnnn A float representing the max and default millimeters per arc segment. Must be greater than 0. Snnn A float representing the minimum allowable millimeters per arc segment. Set to 0 to disable Nnnn An int representing the number of arcs to draw before correcting the small angle approximation. Set to 0 to disable. Rnnn An int representing the minimum number of segments per arcs of any radius, except when the results in segment lengths greater than or less than the minimum and maximum segment length. Set to 0 to disable. Fnnn An int representing the number of segments per second, unless this results in segment lengths greater than or less than the minimum and maximum segment length. Set to 0 to disable. Prusa Firmware for MK3S+, MK2.5S only! M217: Toolchange ParametersIf arguments are given, sets tool-change retract and prime length (mm), prime feedrate (mmmin), retract feedrate (mmmin), and park positionraise (mm) or Z raise (mm): S Pprime_speed Rretract_speed X Y Z. XY arguments require SINGLENOZZLE_SWAP_PARK. If no arguments are given, reports current values. Currently used to set the SINGLENOZZLE tool-change options in Marlin 2.0 and up. May be extended for other tool-changing systems in the future. M218: Set Hotend OffsetSets hotend offset (in mm): Textruder_number Xoffset_on_X Yoffset_on_Y. Example M218 T1 X50 Y0.5 M220: Set speed factor override percentageParameters Snnn Speed factor override percentage (0..100 or higher) Example M220 S80 Sets the speed factor override percentage. M221: Set extrude factor override percentageParameters Snnn Extrude factor override percentage (0..100 or higher), default 100% Dnnn Extruder drive number (RepRapFirmware only), default 0 Example M221 S70M221 S95 D1 Sets extrude factor override percentage. In the case of RepRapFirmware, sets the extrusion factor percentage for the specified extruder drive only. M220: Turn off AUX V1.0.5M221: Turn on AUX V1.0.5M222: Set speed of fast XY movesM223: Set speed of fast Z movesM224: Enable extruder during fast movesM225: Disable on extruder during fast movesM226: G-code Initiated PauseExample M226 Initiates a synchronous pause (pauses after all previous commands from the same stream have been completed). That is, program execution is stopped and the printer waits for user interaction. This matches the behaviour of M1 in the NIST RS274NGC G-code standard and M0 in Marlin firmware. M226: Wait for pin stateParameters Pnnn pin number Snnn pin state Example M226 P2 S1 Wait for a pin to be in some state. M227: Enable Automatic Reverse and PrimeExample M227 P1600 S1600 P and S are steps. â€œReverse and Primeâ€ means, the extruder filament is retracted some distance when not in use and pushed forward the same amount before going into use again. This shall help to prevent drooling of the extruder nozzle. Teacup firmware implements this with M101M103. M228: Disable Automatic Reverse and PrimeExample M228 See also M227. M229: Enable Automatic Reverse and PrimeExample M229 P1.0 S1.0 P and S are extruder screw rotations. See also M227. M230: Disable Enable Wait for Temperature ChangeExample M230 S1 S1 Disable wait for temperature change S0 Enable wait for temperature change M231: Set OPS parameterM231 S[OPS_MODE] X[Min_Distance] Y[Retract] Z[Backslash] F[RetractMove] M232: Read and reset max. advance valuesM240: Trigger cameraExample M240 Triggers a camera to take a photograph. (Add to your per-layer G-code.) Notes In Prusa Firmware this G-code is deactivated by default, must be turned on in the source code.1 M240: Start conveyor belt motor Echo offExample M240 The conveyor belt allows to start mass production of a part with a reprap. Echoing may be controlled in some firmwares with M111. M241: Stop conveyor belt motor echo onExample M241 Echoing may be controlled in some firmwares with M111. M245: Start coolerExample M245 used to cool partsheated-bed down after printing for easy remove of the parts after print M246: Stop coolerExample M246 M250: Set LCD contrastExample M250 C20 Sets LCD contrast C (value 0..63), if available. M256: Set LCD brightnessExample M256 B128 Set the LCD brightness B (value 0..255), if available. M251: Measure Z steps from homing stop (Delta printers)Examples M251 S0Â ; ResetM251 S1Â ; PrintM251 S2Â ; Store to Z length (also EEPROM if enabled) (This is a Repetier-Firmware only feature.) M260: i2c Send DataBuffer and send data over the i2c bus. Use A to set the address from 0-127. Add up to 32 bytes to the buffer with each B. Send and reset the buffer with S. Parameters (Marlin, MK4duo) Ann I2C address Bnn Byte to buffer or send S If present, sends the bytes that have been buffered Examples M260 A5 B65 SÂ ; Send A to Address 5 nowM260 A0 ; Set address to 0 (broadcast)M260 B77 ; MM260 B97 ; aM260 B114Â ; rM260 B108Â ; lM260 B105Â ; iM260 B110Â ; nM260 S1 ; Send the current buffer Parameters (RepRapFirmware) Ann I2C address Bnn:nn:nnâ€¦ Bytes to send Snn Number of bytes to receive (RepRapFirmware 2.02 and later) Vâ€nameâ€ (optional, RepRapFirmware 3.6) variable to store the received data into. Ignored unless a nonzero S parameter was provided. Examples M260 A5 B65 ; Send A to address 5M260 A0x7F B65 ; Send A to address 7F (hex)M260 A0 B82:101:112:82:97:112 ; Send RepRap to address 0 RepRapFirmware does not use the S parameter to mean send the current buffer, instead the address and all the bytes to send are specified in a single command. M260.1: Modbus Write register(s)Parameters (provisional, RepRapFirmware) Pnn Serial port to sendreceive through, numbered as in M575 (1 first aux port, 2 second aux port). The port must already have been set to Modbus mode using M575. Ann Modbus slave device address Rnn First Modbus register number to send data to Bnn:nn:nnâ€¦ 16-bit words to send Examples M260 A5 R10 B956 ; write 956 to register 10 of the device at address 5M260 A8 R20 B123:456 ; write 123 to register 20 and 456 to register 21 of the device at address 8 M261: i2c Request DataRequest data (synchronously) from an i2c slave device. This command in basic form simply relays the received data to the host. Parameters Ann I2C device address Bnn How many bytes to request Snn (Marlin 2.0.9.3) Style of output: 0 Raw (default), 1 Bytes (hex), 2 1-2 byte (integer), 3 Bytes (decimal) Vâ€nameâ€ (optional, RepRapFirmware 3.6 and later) name of variable to receive data into. If this parameter is not present then the data read is output to the console. Examples M261 A99 B5 ; Request/get 5 bytes from I2C address 99 and print them as-is.M261 A32 B7 S1 ; (Marlin) Request/get 7 bytes from Address 32 and print them as space-delimited hex bytes.M261 A80 R10 B2 Vvar.modbusData ; (RepRapFirmware) Read registers 10 and 11 from I2C address 80 and store the result in var.modbusData Both M260 and M261 are commands demonstrating use of the i2c bus (TWIBus class) in Marlin Firmware. Developers and vendors can make Marlin an i2c master device by enabling EXPERIMENTAL_I2CBUS, and Marlin can act as a slave device by setting I2C_SLAVE_ADDRESS from 8-127. This class can be used to divide up processing responsibilities between multiple instances of Marlin running on multiple boards. For example, one board might control a Z axis with 4 independent steppers to create a self-leveling system, or a second board could drive the graphical display while the first board handles printing. M261.1: Modbus Read Input RegistersRequest data (synchronously) from a Modbus slave device. Parameters (provisional) Ann Modbus device address Bnn How many 16-bit registers to request Pnn Port to request data through, same numbering as in M575 command (1 first aux port, 2 second aux port). The port must already have been put into Modbus mode using M575. Rnn Register number to start from Vâ€nameâ€ (optional) name of variable to receive data into. If this parameter is not present then the data read is output to the console. Examples M261 P1 A80 R10 B2 Vvar.modbusDataÂ ; (RepRapFirmware) Read registers 10 and 11 from Modbus station 80 via the first aux port and store the result in var.modbusData M280: Set servo positionSet servo position absolute. Parameters Pnnn Servo index Snnn Angle or microseconds I1 Invert polarity (RepRapFirmware only) Example M280 P1 S50 Marlin and RepRapFirmware treat S values below 200 as angles, and 200 or greater as the pulse width in microseconds. In RepRapFirmware, the servo index is the same as the pin number for the M42 command. See https://duet3d.com/wiki/Using_servos_and_controlling_unused_IO_pins for details. RepRapFirmware supports the optional I1 parameter, which if present causes the polarity of the servo pulses to be inverted compared to normal for that output pin. The I parameter is not remembered between M280 commands (unlike the I parameter in M106 commands), so if you need inverted polarity then you must include I1 in every M280 command you send. Duet 0.8.5 M280 P value to Expansion Port Pin MappingPNameExpansion Port PinUse M307 H# A-1 C-1 D-1 before using these pins3PC23_PWML6214PC22_PWML5225PC21_PWML423 On the Duet 0.6, pin 18 is controlled by heater 2. On the 0.8.5, pin 18 is controlled by heater 6, but is also shared with fan1. In order to use this pin, the fan must be disabled (M106 P1 I-1). See Using servos and controlling unused IO pins Notes In Prusa Firmware this G-code is deactivated by default, must be turned on in the source code.1 M281: Set Servo AnglesSet the angles for a servoâ€™s deployed (or selected) and stowed (or unselected) states. To activate this command in Marlin enable the EDITABLE_SERVO_ANGLES option. Parameters P[index] - Servo Index L[angle] - Deployed Selected Angle U[angle] - Stowed Unselected Angle Example M281 P0 L30 U90 M282: Detach ServoDetach servo. This disables the servo until its next move. To activate this command in Marlin enable the SERVO_DETACH_GCODE option. Parameters Pnnn Servo index Example M282 P1 M290: BabysteppingParameters (RepRapFirmware) Snnn Amount to baby step Z in mm. Positive values raise the head, negative values lower it. Xnnn, Ynnn, ... Amount to baby step other axes in mm (optional, supported in later RepRapFirmware versions) Znnn Synonym for S (RepRapFirmware 1.21 and later) Rn (Optional, RepRapFirmware 1.21 and later) R1 relative (add to any existing babystep amount, the default), R0 absolute (set babystepping offset to the specified amount) Examples M290 S0.05 ; babystep the head up 0.05mmM290 R0 S0 ; clear babystepping (RepRapFirmware 1.21 and later only) Parameters (Repetier) Znnn Amount to baby step in mm. Positive values raise the head, negative values lower it. Examples M290 S0.05 ; babystep the head up 0.05mm Additional Parameters (Marlin 1.1.7 and later) Xnnn Amount to babystep X in current units. (Requires BABYSTEP_XY) Ynnn Amount to babystep Y in current units. (Requires BABYSTEP_XY) Znnn Amount to babystep Z in current units. Synonym for â€˜Sâ€˜ parameter. Example M290 X0.2 Z0.05Â ; Babystep X by 0.2mm, Z by 0.05mm This command tells the printer to move the axis (or axes) transparently to the motion system. This is like physically moving the axes by force, but much nicer to the machine. In RepRapFirmware M290 with no parameters reports the accumulated baby stepping offset. Marlin doesnâ€™t track accumulated babysteps. In RepRapFirmware 1.19 and earlier, the babystepping offset is reset to zero when the printer is homed or the bed is probed. In RepRapFirmware 1.21 and later, homing and bed probing donâ€™t reset babystepping, but you can reset it explicitly using M290 R0 S0. Note: If the BABYSTEP_ZPROBE_OFFSET option is used in Marlin, this command also affects the Z probe offset (as set by M851) and that offset will be saved to EEPROM. M291: Display message and optionally wait for responseParameters Pmessage The message to display, which must be enclosed in double quotation marks. If the message itself contains a double quotation mark, use two double quotation marks to represent it. Rmessage Optional title for the message box. Must be enclosed in double quotation marks too. Sn Message box mode (defaults to 1) Tn Timeout in seconds, only legal for S0 and S1. The message will be cancelled after this amount of time, if the user does not cancel it before then. A zero or negative value means that the message does not time out (it may still be cancelled by the user if it has a Close button). In RepRapFirmware, the default timeout for messages that do not require acknowledgement is 10 seconds. Zn 0 no special action, 1 display Z jog buttons alongside the message to allow the user to adjust the height of the print head Examples M291 PPlease do something and press OK when done S2M291 PThis message will be closed after 10 seconds T10 This command provides a more flexible alternative to M117, in particular messages that time out, messages that suspend execution until the user acknowledges them, and messages that allow the user to adjust the height of the print head before acknowledging them. Allowed message box modes include: 0. No buttons are displayed (non-blocking)1. Only Close is displayed (non-blocking)2. Only OK is displayed (blocking, send M292 to resume the execution)3. OK and Cancel are displayed (blocking, send M292 to resume the execution or M292 P1 to cancel the operation in progress) The combination S0 T0 is not permitted, because that would generate a message box with no close button and that never times out, which would lock up the user interface. Duet Web Control 2.0.3 and later supports HTML in the message body. M292: Acknowledge messageParameters Pn Whether the current operation shall be cancelled. Only legal if M291 was called with S3 (optional) This command is sent by the user interface when the user acknowledges a message that was displayed because of a M291 command with parameter S2 or S3. M293: Babystep Z+Babystep Z upward by one increment according to settings. Requires EP_BABYSTEPPING. With `EMERGENCY_PARSER` babystepping is asynchronous and doesnâ€™t rely on the queue. M294: Babystep Z-Babystep Z downward by one increment according to settings. Requires EP_BABYSTEPPING. With `EMERGENCY_PARSER` babystepping is asynchronous and doesnâ€™t rely on the queue. M300: Play beep soundParameters Snnn frequency in Hz Pnnn duration in milliseconds Vnnn volume in rage 0 - 1 Cnnn custom buzzer port (only in RRF 3.6 or later, must be PWM-capable) Example M300 S300 P1000 Play beep sound, use to notify important events like the end of printing. R2C2 electronics. If an LCD device is attached to RepRapFirmware, a sound is played via the add-on touch screen control panel. Else the web interface will play a beep sound. Notes 1In Prusa Firmware the defaults are 100Hz and 1000ms, so that M300 without parameters will beep for a second. 2Klipper does not support M300 by default, however it can be easily added as a G-code macro M301: Set PID parametersParameters Hnnn heater number (Smoothie uses â€˜Sâ€™, Redeem uses â€˜Eâ€™) Pnnn proportional (Kp) Innn integral (Ki) Dnnn derivative (Kd) Examples M301 H1 P1 I2 D3Â ; Marlin, RepRapFirmwareM301 S0 P30 I10 D10Â ; SmoothieM301 E0 P30 I10 D10Â ; Redeem (E = Extruder, -1=Bed, 0=E, 1=H, 2=A, 3=B, 4=C, default = 0) Sets Proportional (P), Integral (I) and Derivative (D) values for hot end. See also PID Tuning. MK4duoH[heaters] H 0-5 Hotend, H -1 BED, H -2 CHAMBER, H -3 COOLER MarlinHot end only; see M304 for bed PID. H is the heater number, default 1 (i.e. first extruder heater). RepRapFirmware 1.15 onwardsIn RepRapFirmware 1.15 and later the M301 is supported as described above, but it is not normally used. Instead the heater model is defined by M307 or found by auto tuning, and the firmware calculates the PID parameters from the model. An M301 command can be used in config.g after the M307 command for that heater to override the firmware-computed PID parameters. RepRapFirmware 1.09 to 1.14 inclusive H Is the heater number, and is compulsory. H0 is the bed, H1 is the first hot end, H2 the second etc. P Interprets a negative P term as indicating that bang-bang control should be used instead of PID (not recommended for the hot end, but OK for the bed heater). I Integral value D Derivative value T Is the approximate additional PWM (on a scale of 0 to 255) needed to maintain temperature, per degree C above room temperature. Used to preset the I-accumulator when switching from heater fully onoff to PID. S PWM scaling factor, to allow for variation in heater power and supply voltage. Is designed to allow a correction to be made for a change in heater power andor power supply voltage without having to change all the other parameters. For example, an S factor of 0.8 means that the final output of the PID controller should be scaled to 0.8 times the standard value, which would compensate for a heater that is 25% more powerful than the standard one or a supply voltage that is 12.5% higher than standard. W Wind-up. Sets the maximum value of I-term, must be high enough to reach 245C for ABS printing. B PID Band. Errors larger than this cause heater to be on or off. An example using all of these would be: M301 H1 P20 I0.5 D100 T0.4 S1 W180 B30 SmoothieS0 is 0 for the hotend, and 1 for the bed, other numbers may apply to your configuration, depending on the order in which you declare temperature control modules. Other implementationsW: Wind-up. Sets the maximum value of I-term, so it does not overwhelm other PID values, and the heater stays on. (Check firmware support - Sprinter, Marlin?) Example M301 W125 TeacupSee M130, M131, M132, M133 for Teacupâ€˜s codes for setting the PID parameters. M302: Allow cold extrudesParameters Snnn Cold extrude minimum temperature (also in RepRapFirmware 2.02 and later) Pnnn Cold extrude allow state (RepRapFirmware) Rnnn Cold retraction minimum temperature (RepRapFirmware 2.02 and later) Examples (RepRapFirmwre) M302 ; Report current stateM302 P1 ; Allow cold extrusionM302 S120 R110Â ; Allow extrusion starting from 120Â°C and retractions already from 110Â°C Examples (Others) M302 S0 ; Allow extrusion at any temperatureM302 S170 ; Allow extrusion above 170 This tells the printer to allow movement of the extruder motor above a certain temperature, or if disabled, to allow extruder movement when the hotend is below a safe printing temperature. Notes 1RepRapFirmware uses the P[0|1] parameter instead of S[temperature], and for M302 with no parameters it will report the current cold extrusion state. M303: Run PID tuningPID Tuning refers to a control algorithm used in some repraps to tune heating behavior for hot ends and heated beds. This command generates Proportional (Kp), Integral (Ki), and Derivative (Kd) values for the hotend or bed (E-1). Send the appropriate code and wait for the output to update the firmware. Hot end usage: M303 Stemperature Ccycles Bed usage (repetier, not sure whether cycles work here): M303 P1 Stemperature Bed usage (others): M303 E-1 Ccycles Stemperature Example M303 C8 S175 Smoothieâ€™s syntax, where E0 is the first temperature control module (usually the hot end) and E1 is the second temperature control module (usually the bed): M303 E0 S190 In RepRapFirmware, this command computes the process model parameters (see M307), which are in turn used to calculate the PID constants. H is the heater number, P is the PWM to use (default 0.5), and S is the maximum allowable temperature (default 225). Tuning is performed asynchronously. Run M303 with no parameters to see the current tuning state or the last tuning result. Example M303 H1 P0.4 S240Â ; tune heater 1 using 40% PWM, quit if temperature exceeds 240C Notes In Marlin Firmware you can add the U1 parameter to apply the PID results to current settings upon completion. M304: Set PID parameters - BedParameters Pnnn proportional (Kp) Innn integral (Ki) Dnnn derivative (Kd) Examples M304 P1 I2 D3Â ; set kP=3, kI=2, kD=3M304 P1 I2 D3 T0.7 B20 W127Â ; RepRapFirmwareM304 ; Report parameters Sets Proportional, Integral and Derivative values for bed. RepRapFirmware interprets a negative P term as indicating that bang-bang control should be used instead of PID. In RepRapFirmware, this command is identical to M301 except that the H parameter (heater number) defaults to zero. See also PID Tuning. M304 in RepRapPro version of Marlin: Set thermistor valuesIn the RepRapPro version of Marlin ( https://github.com/reprappro/Marlin ) M304 is used to set thermistor values (as M305 is in later firmwares). RRP Marlin calculates temperatures on the fly, rather than using a temperature table. M304 Sets the parameters for temperature measurement. Example M304 H1 B4200 R4800 T100000 This tells the firmware that for heater 1 (H parameter: 0 heated bed, H first extruder), the thermistor beta (B parameter) is 4200, the thermistor series resistance (R parameter) is 4.8Kohms, the thermistor 25C resistance (T parameter) is 100Kohms. All parameters other than H are optional. If only the H parameter is given, the currently-used values are displayed. They are also displayed within the response to M503. M305: Set thermistor and ADC parametersParameters Pnnn Heater number, or virtual heater number Sname Heater name (optional, RepRapFirmware only) Tnnn (for thermistor sensors) Thermistor resistance at 25oC Tc (for MAX31856-based thermocouple sensors) The thermistor type letter, default K Bnnn Beta value, or the reciprocal of the Steinhart-Hart thermistor model B coefficient Cnnn Steinhart-Hart C coefficient (MK4duo and RepRapFirmware 1.17 and later), default 0 Rnnn Series resistor value Lnnn ADC low offset correction, default 0 Hnnn ADC high offset correction, default 0 Xnnn Heater ADC channel, or thermocouple or PT100 or current loop adapter channel, defaults to the same value as the P parameter Fnn (where nn is 50 or 60) If the sensor interface uses a MAX31856 thermocouple chip or MAX31865 PT100 chip, this is the local mains frequency. Readings will be timed to optimise rejection of interference at this frequency. Example M305 P1 T100000 R1000 B4200 Sets the parameters for temperature measurement. The example above tells the firmware that for heater 1 (P parameter: 0 heated bed, 1 first extruder) the thermistor 25C resistance (T parameter) is 100Kohms, the thermistor series resistance (R parameter) is 1Kohms, the thermistor beta (B parameter) is 4200. All parameters other than P are optional. If only the P parameter is given, the existing values are displayed. Example M305 P1 T100000 R1000 B4200 H14 L-11 X2 The H correction affects the reading at high ADC input voltages, so it has the greatest effect at low temperatures. The L correction affects the reading at low input voltages, which correspond to high temperatures. The X parameter tells the firmware to use the thermistor input corresponding to a different heating channel. RepRapFirmware also allow an external SPI thermocouple interface (such as the MAX31855) or PT100 interface (MAX31865) to be configured. MAX31855 thermocouple channels are numbered from 100, MAX31856 thermocouple channels are numbered from 150, PT100 channels from 200 and current loop channels from 300. Channel 1000 is the CPU temperature indication, 1001 is the temperature of the hottest stepper motor driver on the main board, and 1001 is the temperature of the hottest drivers on the expansion board. In the above example, the ADC high end correction (H parameter) is 14, the ADC low end correction (L parameter) is -11, and thermistor input #2 is used to measure the temperature of heater #1. M306: Set home offset calculated from toolhead positionExample M306 Z0 The values specified are added to the calculated end stop position when the axes are referenced. The calculated value is derived from the distance of the toolhead from the current axis zero point. The user would typically place the toolhead at the zero point of the axis and issue the M306 command. This value can be saved to EEPROM using the M500 command (as M206 value). Implemented in Smoothieware M307: Set or report heating process parametersParameters Hn Heater number (0 is usually the bed heater) Annn gAin, expressed as ultimate temperature rise obtained in degC divided by the PWM fraction. For example, if G180 then at 50% PWM the ultimate temperature rise would be 90C. Cnnn dominant time Constant of the heating process in seconds Dnnn Dead time in seconds Four optional additional parameters help control the heating process Fnnn PWM frequency to use (not supported in RepRapFirmware 3, use M950 instead). Bn selects Bang-bang control instead of PID if non-zero. Default at power-up is 0 for extruder heaters, 1 for bed and chamber heaters. Snnn maximum PWM to be used used with this heater on a scale of 0 to 1. Default 1.0. Vnnn VIN supply voltage at which the A parameter was calibrated (RepRapFirmware 1.20 and later). This allows the PID controller to compensate for changes in supply voltage. A value of zero (the default) disables compensation for changes in supply voltage. Examples M307 H0Â ; report the process parameters for heater 0M307 H1 A346.2 C140 D5.3 B0 S0.8 V23.8Â ; set process parameters for heater 1, use PID, and limit heater 1 PWM to 80% Each heater and its corresponding load may be approximated as a first order process with dead time, which is characterised by the gain, time constant and dead time parameters. The model can used to calculate optimum PID parameters, using different values for the heating or cooling phase and the steady state phase. It is also used to better detect heater faults. In future it may be used to calculate feed-forward terms to better respond to changes in the load. Normally these model parameters are found by auto tuning - see M303. RepRapFirmware 1.16 and later allow the PID controller for a heater to be disabled by setting the A, C, and D parameters to -1. This frees up the corresponding heater control pin for use as a general purpose IO pin to use with the M42 or M280 command. In RepRapFirmware 3, M950 should be used to free up the pin instead. M308: Set or report sensor parametersCommon Parameters Sn Sensor number Ppin_name The name of the control board pin that this sensor uses. For thermistors it is the thermistor input pin name. For sensors connected to the SPI bus it is the name of the output pin used as the chip select. Ysensor_type The sensor and interface type, e.g. â€œthermistorâ€, â€œpt1000â€, â€œrtdmax31865â€, â€œmax31855â€, â€œmax31856â€, â€œlinear-analogâ€, â€œdht22-tempâ€, â€œdht22-humidityâ€, â€œcurrent-loop-pyroâ€ Aname Sensor name (optional), displayed in the web interface Additional parameters for thermistors Tnnn (for thermistor sensors) Thermistor resistance at 25oC Bnnn Beta value, or the reciprocal of the Steinhart-Hart thermistor model B coefficient Cnnn Steinhart-Hart C coefficient, default 0 Rnnn Series resistor value Lnnn ADC low offset correction, default 0 (ignored if the hardware supports automatic ADC gain and offset calibration) Hnnn ADC high offset correction, default 0 (ignored if the hardware supports automatic ADC gain and offset calibration) Additional parameters for PT1000 sensors Rnnn Series resistor value Lnnn ADC low offset correction, default 0 (ignored if the hardware supports automatic ADC gain and offset calibration) Hnnn ADC high offset correction, default 0 (ignored if the hardware supports automatic ADC gain and offset calibration) Additional parameters for MAX31856-based thermocouple sensors Tc The thermistor type letter, default K Fnn (where nn is 50 or 60) The local mains frequency. Readings will be timed to optimise rejection of interference at this frequency. Additional parameters for MAX31865-based PT100 sensors Rnnn Series resistor value Fnn (where nn is 50 or 60) The local mains frequency. Readings will be timed to optimise rejection of interference at this frequency. Additional parameters for linear analog sensors Fn F0 unfiltered (fast response), F1 filtered (slower response, but noise reduced and ADC oversampling used to increase resolution) Lnnn The temperature or other value when the ADC output is zero Hnnn The temperature or other value when the ADC output is full scale This code replaces M305 in RepRapFirmware 3. In earlier versions of RepRapFirmware, sensors only existed in combination with heaters, which necessitated the concept of a â€œvirtual heaterâ€ to represent a sensor with no associated heater (e.g. MCU temperature sensor). RepRapFirmware 3 allows sensors to be defined independently of heaters. The association between heaters and sensors is defined using M950. M308 can be used in the following ways: M308 Snn Ytype Ppin [other parameters]Â ; delete sensor nn if it exists, create a new one with default settings, and configure it using the other parametersM308 SnnÂ ; report the settings of sensor nnM308 AnameÂ ; report the settings of the first sensor named nameM308 Snn [any other parameters except Y]Â ; amend the settings of sensor nn Sensor type names obey the same rules as pin names, i.e. case is not significant, neither are hyphen and underscore characters. M309: Set or report heater feedforwardParameters Pn Tool number Saaa:bbb:cccâ€¦ Feedforward coefficients. The number of coefficients provided must equal the number of heaters configured for the tool when it was created (see M563). If the P parameter is not provided, the current tool is assumed. If the S parameter is not provided, the existing coefficients are reported. The units of S are PWM fraction (on a scale of 0 to 1) per mmsec of filament forward movement. M310: Temperature model settingsUsage M310 ; report values M310 [ A ] ; autotune C+R values M310 [ F ] ; force model self-test state M310 [ S ] ; set 0disable 1enable M310 [ I ] [ R ] ; set resistance at index M310 [ P | C ] ; set power, capacitance M310 [ B | E | W ] ; set beeper, warning and error threshold M310 [ T ] ; set ambient temperature correction Parameters A autotune C+R values F force model self-test state (0off 1on) during autotune using current values Snnn set 0disable 1enable Innn resistance index position (0-15) Rnnn resistance value at index (KW; requiresÂ :Innn) Pnnn power (W) Cnnn capacitance (JK) Bnnn beep and warn when reaching warning threshold 0disable 1enable (default: 1) Ennn error threshold (Ks; default in variant) Wnnnâ€˜ warning threshold (Ks; default in variant) Tnnn ambient temperature correction (K; default in variant) Prusa Firmware for MK3S+, MK2.5S only! M320: Activate autolevel (Repetier)Usage M320 M320 S1 Parameters Snnn if greater than 0, activate and store persistently in EEPROM Examples M320 ; temporarily activate auto levelingM320 S1Â ; permanently activate auto leveling Parameter Snnn is optional. (Repetier only) M321: Deactivate autolevel (Repetier)Usage M321 M321 S1 Parameters Snnn if greater than 0, deactivate and store persistently in EEPROM Examples M321 ; temporarily deactivate auto levelingM321 S1Â ; permanently deactivate auto leveling Parameter Snnn is optional. (Repetier only) M322: Reset autolevel matrix (Repetier)Usage M322 M322 S1 Parameters Snnn if greater than 0, also reset the matrix values saved EEPROM Examples M322 ; temporarily reset auto level matrixM322 S1Â ; permanently reset auto level matrix Parameter Snnn is optional. (Repetier only) M323: Distortion correction onoff (Repetier)Usage M323 M323 Snnn M323 Snnn Pnnn Parameters Snnn 0 (disable correction) or 1 (enable correction) Pnnn 1 (store correction state persistently in EEPROM) Examples M323 ; Show if distortion correction is enabledM323 S0 ; Disable distortion correction temporarilyM323 S1 P1Â ; Enable distortion correction permanently (Repetier only) Controls distortion correction feature after having set it up using G33. M340: Control the servos(Repetier only ,Marlin see M280) M340 P S ServoID 0..3 pulseInUs 500..2500 Servos are controlled by a pulse width normally between 500 and 2500 with 1500ms in center position. 0 turns servo off. M350: Set microstepping modeSets microstepping mode. Warning: Steps per unit remains unchanged; except that in RepRapFirmware the stepsmm will be adjusted automatically. Usage M350 Snn Xnn Ynn Znn Enn Bnn Parameters Not all parameters need to be used, but at least one should be used. As with other commands, RepRapFirmware reports the current settings if no parameters are used. Snn Set stepping mode for all drivers (not supported by RepRapFirmware) Xnn Set stepping mode for the X axis Ynn Set stepping mode for the Y axis Znn Set stepping mode for the Z axis Enn Set stepping mode for Extruder 0 (for RepRapFirmware use Enn:nn:nn etc. for multiple extruders) Bnn Set stepping mode for Extruder 1 (not supported by RepRapFirmware, see above) Inn Enable (nn1) or disable (nn0) microstep interpolation mode for the specified drivers, if they support it (RepRapFirmware only) Modes (nn) 1 full step 2 half step 4 quarter step 8 18 step 16 116 step 64 164 step 128 1128 step 256 1256 step Examples M350 S16 ; reset all drivers to the default 1/16 micro-stepping - not supported by RepRapFirmwareM350 Z1 ; set the Z-axis driver to use full stepsM350 E4 B4 ; set both extruders to use quarter steps - Marlin/RepetierM350 E4:4:4Â ; set extruders 0-2 to use quarter steps - RepRapFirmware M351: Toggle MS1 MS2 pins directlyExample M351 M355: Turn case lights onoffExamples M355 S1Â ; Enable lightsM355 S0Â ; Disable lightsM355 ; Report statusM355 P0Â ; Turn light offM355 P128Â ; Turn light on with half powerM355 P255Â ; Turn light on with full power Every call or change over LCD menu sends a state change for connected hosting software like: Case lights onCase lights offNo case lights M360: Report firmware configurationTarget This command helps hosting software to detect configuration details, which the user would need to enter otherwise. It should reduce configuration time considerably if supported. Example M360 Response Config:Baudrate:250000Config:InputBuffer:127Config:NumExtruder:2Config:MixingExtruder:0Config:HeatedBed:0Config:SDCard:1Config:Fan:1Config:LCD:1Config:SoftwarePowerSwitch:1Config:XHomeDir:-1Config:YHomeDir:-1Config:ZHomeDir:-1Config:SupportG10G11:1Config:SupportLocalFilamentchange:1Config:CaseLights:0Config:ZProbe:1Config:Autolevel:0Config:EEPROM:1Config:PrintlineCache:24Config:JerkXY:30.00Config:JerkZ:0.30Config:RetractionLength:3.00Config:RetractionLongLength:13.00Config:RetractionSpeed:40.00Config:RetractionZLift:0.00Config:RetractionUndoExtraLength:0.00Config:RetractionUndoExtraLongLength:0.00Config:RetractionUndoSpeed:0.00Config:XMin:0.00Config:YMin:0.00Config:ZMin:0.00Config:XMax:250.00Config:YMax:150.00Config:ZMax:90.00Config:XSize:250.00Config:YSize:150.00Config:ZSize:90.00Config:XPrintAccel:250.00Config:YPrintAccel:250.00Config:ZPrintAccel:100.00Config:XTravelAccel:250.00Config:YTravelAccel:250.00Config:ZTravelAccel:100.00Config:PrinterType:CartesianConfig:MaxBedTemp:120Config:Extr.1:Jerk:50.00Config:Extr.1:MaxSpeed:100.00Config:Extr.1:Acceleration:10000.00Config:Extr.1:Diameter:0.00Config:Extr.1:MaxTemp:220Config:Extr.2:Jerk:50.00Config:Extr.2:MaxSpeed:100.00Config:Extr.2:Acceleration:10000.00Config:Extr.2:Diameter:0.00Config:Extr.2:MaxTemp:220 SCARA calibration codes (Morgan)In order to ease calibration of Reprap Morgan, the following M-codes are used to set the machine up M360: Move to Theta 0 degree positionThe arms move into a position where the Theta steering arm is parallel to the top platform edge. The user then calibrates the position by moving the arms with the jog buttons in software like pronterface until it is perfectly parallel. Using M114 will then display the calibration offset that can then be programmed into the unit using M206 (Home offset) X represents Theta. Smoothieware: M360 P0 will take the current position as parallel to the platform edge, and store the offset in the homing trim offset (M666) No further user interaction is needed. M361: Move to Theta 90 degree positionTheta move to 90 degrees with platform edge. User calibrates by using jog arms to place exactly 90 degrees. Steps per degree can then be read out by using M114, and programmed using M92. X represents Theta. Program Y (Psi) to the same value initially. Remember to repeat M360 after adjusting steps per degree. Smoothieware: M360 P0 will accept the current position as 90deg to platform edge. New steps per angle is calculated and entered into memory (M92) No further user interaction is required, except to redo M360. M362: Move to Psi 0 degree positionArms move to Psi 0 degree. Check only after other Theta calibrations M363: Move to Psi 90 degree positionArms move to Psi 90 degree. Check only after other Theta calibrations M364: Move to Psi + Theta 90 degree positionMove arms to form a 90 degree angle between the inner and outer Psi arms. Calibrate by moving until angle is exactly 90 degree. Read out with M114, and calibrate value into Home offset M206. Psi is represented by Y. Smoothieware: M364 P0 will accept the current position as 90deg between arms. The offset is stored as a trim offset (M666) and no further user interaction is required except to save all changes via M500. M365: SCARA scaling factorAdjust X Y and Z scaling by entering the factor. 100% scaling (default) is represented by 1 M366: SCARA convert trimExecuting this command translates the calculated trim values of the SCARA calibration to real home offsets. This prevents the home and trim movement after calibration. M370: Morgan manual bed level - clear mapClear the map and prepare for calibration Usage M370 M370 X[divisions] Y[divisions] Without parameters is defaults to X5 Y5 (25 calibration points) When specifying parameters, uneven numbers are recommended. M371: Move to next calibration positionMove to the next position for calibration. User moves the bed towards the hotend until it just touches M372: Record calibration value, and move to next positionThe position of the bed is recorded and the machine moves to the next position. Repeat until all positions programmed M373: End bed level calibration modeEnd calibration mode and enable z correction matrix. Does not save current matrix M374: Save calibration gridSaves the calibration grid. Parameters extension (Smoothieware only) Extension of the grid file Pfilename (RepRapFirmware only) Name of the file to save to Z (Smoothieware only) Also save the M206 Z homing offset into the grid file Usage (Smoothieware) M374M374 file extension Z Usage (RepRapFirmware) M374M374 PMyAlternateHeightMap.csv In Smoothieware, without parameters this saves the grid into the default grid file that gets loaded at boot. The optional parameter specifies the extension of the grid file - useful for special grid files such as for a special print surface like a removable print plate. Addition of Z will additionally save the M206 Z homing offset into the grid file. In RepRapFirmware, this saves the grid parameters and height map into the specified file, or the default file heightmap.csv if no filename was specified. To load the height map automatically at startup, use command M375 in the config.g file. M375: Display matrix Load MatrixDisplays the bed level calibration matrix (Marlin), or loads the grid matrix file (Smoothieware and RepRapFirmware) Parameters extension (Smoothieware only) Pfilename (RepRapFirmware only) Usage M375M375 [file extension]Â ; (Smoothieware only)M375 PMyAlternateHeightMap.csvÂ ; (RepRapFirmware only) Without parameters loads default grid, and with specified extension or specified filename attempts to load the specified grid. If not available will not modify the current grid. In Smoothieware, if Z was saved with the grid file, it will load the saved Z with the grid. M376: Set bed compensation taperParameters Hnnn Height (mm) over which to taper off the bed compensation Example M376 H10 This command specifies that bed compensation should be tapered off over the specified height, so that no bed compensation is applied at and above that height. If H is zero or negative then no tapering is applied, so compensation is performed throughout the entire print. If the firmware does not adjust the extrusion amount to compensate for the changing layer height while tapering is being applied, you will get under- or over-extrusion. Using a large taper height will reduce this effect. For example, if the taper height is 50 times the largest bed height error, then under- or over-extrusion will be limited to 2%. M380: Activate solenoidExample M380 Activates solenoid on active extruder. M381: Disable all solenoidsExample M381 M400: Wait for current moves to finishExample M400 Finishes all current moves and and thus clears the buffer. Thatâ€™s identical to G4 P0 for Teacup printers. M401: Deploy Z ProbeParameters P Probe number, default 0 (RepRapFirmware) S Set BLTouch HS Mode (Marlin 2.0.9.3+ with BLTOUCH enabled.) H Report current BLTouch HS Mode (Marlin 2.0.9.4+ with BLTOUCH enabled.) Example M401M401 P1 Deploy the z-probe (if present). In RepRapFirmware this command runs the macro file sysdeployprobe#.g (where # is the probe number) if it exists, otherwise it runs sysdeployprobe.g if it exists. M402: Stow Z ProbeParameters P (RepRapFirmware only) Probe number, default 0 Example M402M402 P1 Raise z-probe if present. In RepRapFirmware this runs macro file sysretractprobe#.g (where # is the probe number) if it exists, otherwise sysretractprobe.g if it exists. M403: Set filament type (material) for particular extruder and notify the MMUParameters E Extruder number F Filament type Currently three different materials are needed (default, flex and PVA). And storing this information for different loadunload profiles etc. in the future firmware does not have to wait for â€œokâ€ from MMU. M404: Filament diameterParameters Nnnn Filament diameter (in mm) Dnnn Nozzle diameter (in mm)1 Examples M404 N1.75M404 N3.0 D1.0 Specifies the nominal filament diameter (typically 3mm or 1.75mm) or displays the nominal filament diameter if no parameters are provided. Notes 1While Marlin only accepts the â€˜Nâ€™ parameter, older versions of RepRapFirmware allowed the nozzle diameter (in mm) to be specified via the â€˜D â€˜parameter. This value was used to help detect the first layer height when files are parsed. Newer version of RepRapFirmware ignore the D parameter. M405: Filament Sensor onExample M405 Turn on Filament Sensor extrusion control. Optional D to set delay in centimeters between sensor and extruder. M406: Filament Sensor offExample M406 Turn off Filament Sensor extrusion control. M407: Display filament diameterExample M407 Displays measured filament diameter. In RepRapFirmware, M407 does the same as M404. M408: Report JSON-style responseThis command is deprecated in RepRapFirmware 3.3 and later. Support for it will be removed in a future release. Use M409 instead. Parameters Snnn Response type Rnnn Response sequence number Example M408 S0 Report a JSON-style response by specifying the desired type using the â€˜Sâ€™ parameter. The following response types are supported: Type 0 is a short-form response, similar to the response used by older versions of the web interface. Type 1 is like type 0 except that static values are also included. Type 2 is similar to the response provided by the web server for Duet Web Control. Type 3 is an extended version of type 2 which includes some additional parameters that arenâ€™t expected to change very frequently. Type 4 is an extended version of type 2 which may be used to poll for current printer statistics. Type 5 reports the current machine configuration. Here is an example of a typical type 0 response: status:I,heaters:[25.0,29.0,28.3],active:[-273.1,0.0,0.0],standby:[-273.1,0.0,0.0],hstat:[0,2,1],pos:[-11.00,0.00,0.00],extr:[0.0,0.0], sfactor:100.00, efactor:[100.00,100.00],tool:1,probe:535,fanPercent:[75.0,0.0],fanRPM:0,homed:[0,0,0],fraction_printed:0.572 The response is set as a single line with a newline character at the end. The meaning of the fields is: status: I=idle, P=printing from SD card, S=stopped (i.e. needs a reset), C=running config file (i.e starting up), A=paused, D=pausing, R=resuming from a pause, B=busy (e.g. running a macro), F=performing firmware updateheaters: current heater temperatures, numbered as per the machine (typically, heater 0 is the bed)active: active temperatures of the heatersstandby: standby temperatures of the heatershstat: status of the heaters, 0=off, 1=standby, 2=active, 3=heater fault. Heater 0 is normally the bed heater, heaters 1, 2.. are the extruder heaters.pos: the X, Y and Z (and U, V, W if present) axis positions of the current tool (if a tool is selected), or of the print head reference point if no tool is selectedextr: the positions of the extruderssfactor: the current speed factor (see M220 command)efactor: the current extrusion factors (see M221 command), one value per extrudertool: the selected tool number. A negative number typically means no tool selected.probe: the Z-probe readingfanPercent: the speeds of the controllable fans, in percent of maximumfanRPM: the print cooling fan RPMhomed: the homed status of the X, Y and Z axes (and U, V, W if they exist), or towers on a delta. 0=axis has not been homed so position is not reliable, 1=axis has been homed so position is reliable.fraction_printed: the fraction of the file currently being printed that has been read and at least partially processed.message: the message to be displayed on the screen (only present if there is a message to display)timesLeft: an array of the estimated remaining print times (in seconds) calculated by different methods. These are currently based on the proportion of the file read, the proportion of the total filament consumed, and the proportion of the total layers already printed. Only present if a print from SD card is in progress.seq: the sequence number of the most recent non-trivial G-code response or error message. Only present if the R parameter was provided and the current sequence number is greater than that.resp: the most recent non-trivial G-code response or error message. Only present if the R parameter was provided and the current sequence number is greater. The type 1 response comprises these fields plus some additional ones that do not generally change and therefore do not need to be fetched as often. The extra fields include: myName: the name of the printerfirmwareName: the name of the firmware, e.g. RepRapFirmware, Smoothieware or Repetiergeometry: one of cartesian, delta, corexy, corexz etc.axes: the number of axesvolumes: the number of SD card slots availablenumTools: the number of available tools numbered contiguously starting from 0 The fields may be in any order in the response. Other implementations may omit fields andor add additional fields. For a more detailed comparison of type 2 - 5, see RepRap_Firmware_Status_responses. PanelDue currently uses only M408 S0 and M408 S1. M409: Query object modelParameters Kkey Key string, default empty Fflags Flags string, default empty Rnnn Pass through request to RepRapFirmware (only for SBC mode, v3.5.2 or later) Innn Increment sequence number of the given key (reserved for internal usage ONLY) Examples M409 Kmove.axes Ff ; report all frequently-changing properties of all axesM409 Kmove.axes[0] Fv ; report all properties of the first axis, including values not normally reportedM409 Kmove.axes[].homed ; for all axes, report whether it is homedM409 K#move.axes ; report the number of axesM408 Ff ; report all values that are likely to have changed recentlyM409 Fv ; report the entire object model (caution, this may be very large!) The key string is just the path to the Object Model (OM) variables wanted, with the following extensions: An element that is an array may be followed by either [number] to select just one element, or by [] to select all elements and report the results as an array The path may be preceded by # in which case the path must refer to an array and just the number of array elements is returned An empty key string selects the entire object model. The flags string may include one or more of the following: d#: (depth) return the OM to depth d# where # is a sequence of digits. The default depth is 1 if the key is empty or not provided (because the returned object would be very large, perhaps too large to send), otherwise a large value (larger than the maximum depth of anything in the OM).f: (frequent) return only those values in the object model that typically change frequently during a job. User interfaces can use M409 with this flag to stay up to date.n: (null) include fields with null values (null fields are normally omitted, but null array elements are never omitted) v: (verbose) include values that are rarely needed and not normally returned (e.g. controller electronics and firmware limits) The response is a JSON object of the following form: {â€œkeyâ€:â€keyâ€œ,â€flagâ€™â€:â€flagsâ€œ,â€resultâ€:object-value} The key and flags fields are as provided in the M409 command. If the key string is malformed or refers to a property that does not exist in the object model, the result field is null. RepRapFirmware on network-enabled electronics also provides the same functionality via the rr_model call to the HTTP API. M410: Quick-StopThis command does a quick stop of all stepper motors and aborts all moves in the planner. This command is only intended for emergency situations, and due to the instant stop the actual stepper positions may be shifted. Note that if `EMERGENCY_PARSER` is disabled, the response may be delayed while the command buffer is being queued. If a print job is in progress, it will continue, so it is important to suspend the print job before using this command. M412: Disable Filament Runout DetectionEnable or disable filament runout detection. When filament sensors are enabled, the firmware responds to a filament runout by running the configured G-code (usually M600 Filament Change). When filament runout detection is disabled, no action will be taken on filament runout. Usage: M412 S[on|off] If no â€˜Sâ€™ parameter is given, this command reports the current state of filament runout detection. Examples M412 S1 Enable filament runout detection M412 S0 Disable filament runout detection M412 Report the current filament runout detection state M413: Power-Loss RecoveryEnable or disable the Power-loss Recovery feature. When this feature is enabled, the state of the current print job (SD card only) will be saved to a file on the SD card. If the machine crashes or a power outage occurs, the firmware will present an option to Resume the interrupted print job. In Marlin 2.0 the POWER_LOSS_RECOVERY option must be enabled. This feature operates without a power-loss detection circuit by writing to the recovery file periodically (e.g., once per layer), or if a POWER_LOSS_PIN is configured then it will write the recovery info only when a power-loss is detected. The latter option is preferred, since constant writing to the SD card can shorten its life, and the print will be resumed where it was interrupted rather than repeating the last layer. (Future implementations may allow use of the EEPROM or the on-board SD card.) Usage: M413 S[on|off] If no â€˜Sâ€™ parameter is given, this command reports the current state of Power-loss Recovery. Examples M413 S1 Enable power-loss recovery M413 S0 Disable power-loss recovery M413 Report the current power-loss recovery state M415: Host RescueThe host rescue G-code is essential to enabling host software to recover from a lost connection or power loss. With this solution the firmware stores the last received coordinate and current position in EEPROM. Once the host reconnects, the firmware reports this recovery information. From the last-received coordinate the host can determine the last line that was processed. Firmware should move the extruder to a parking position if commands stop arriving during an active print job (with heaters still on). Once the host starts sending new commands the firmware should restore the last position. Host and firmware developers can work together to optimize this solution. If the firmware supports this solution it should announce it with the capability: Cap:HOST_RESCUE:1 Examples M415 S1 Enable host rescue system M415 S0 Disable host rescue system M415 Z[zpos] Set Z position as if homed M415 Report rescue state Every call to M415 reports the state. Answers are RESCUE_STATE: OFF Nothing stored. Print finished. RESCUE_STATE: LX:121.97 LY:143.33 LZ:3.30 LE:1.84 LT:0 X:0.00 Y:240.00 Z:13.30 E:1.84 Print was interrupted. Coordinates with leading L are last received positions, LT is active extruder. Normal coordinates are current position and can be omitted, if the move did not finish due to power loss. On a power loss the firmware should respond with POWERLOSS_DETECTED as early as possible to give host time to flush log as it is likely host will also go down very soon. Support is available in Repetier-Firmware 1.0.4 or higher. Repetier-Server 0.91.0 is the first to use this concept and can be used to validate implementation. M416: Power lossHost tells firmware that it will loose power. This is the solution in case a connected host has a power loss detection and firmware does not. Firmware should return the message POWERLOSS_DETECTED and do whatever firmware is supposed to do in that case. In combination with host rescue it should store positions, disable heaters, go to park position. M420: Firmware dependentM420: Set RGB Colors as PWM (MachineKit)Usage: M420 R[Red PWM (0-255)] E[Green PWM (0-255)] B[Blue PWM (0-255)] Example M420 R255 E255 B255 Set the color of your RGB LEDs that are connected to PWM-enabled pins. Note, the Green color is controlled by the E value instead of the G value due to the G code being a primary code that cannot be overridden. In Marlin M420 is EnableDisable Mesh Leveling (with current values) S1enable S0disable M420: Leveling OnOffFade (Marlin)EnableDisable Bed Leveling (using the current stored grid or mesh). Usage M420 S[bool] Z[float] Examples M420 S1 ; Enable compensation using current grid/meshM420 Z10Â ; Gradually reduce compensation until Z=10 Marlin 1.1.0 adds the Z parameter to set the â€œfadeâ€ height. This requires the ENABLE_LEVELING_FADE_HEIGHT option. When the Z fade height value is set non-zero, bed compensation will gradually reduce up to the given height, and cease completely above that height. M420: Mesh bed leveling statusPrints mesh bed leveling status and bed profile if activated. Usage M420 Equivalent to G81 M421: Set a Mesh Bed Leveling Z coordinateSet a single Z coordinate in the Mesh, Bilinear or UBL Leveling grid. Requires MESH_BED_LEVELING or AUTO_BED_LEVELING_BILINEAR or AUTO_BED_LEVELING_UBL. I J are the index for the X and Y axis respectively. Usage M421 I[index] J[index] Z[float] to set an absolute value to a mesh point or M421 I[index] J[index] Q[float] to offset a mesh point by a specified value M422: Set a G34 PointSet a single XY coordinate to be used by G34 for Z Stepper Alignment. Usage M422 S[index] X[pos] Y[pos] M423: X-Axis Twist CompensationReset, set, or report X-Axis Twist Compensation data that will be used by subsequent G29 commands to compensate for a twisted X-axis. Parameters R Flag to reset the X-twist data to configured defaults. X[index] Zero-based index into the X-twist data array. (Z is also required) Z[offset] An offset value to set. (X is also required) A[start] Set the starting X position. I[spacing] Set the X spacing distance. Usage M423 to report the current X-twist data to the host console. M423 R to reset X-twist data to the configured defaults. M423 X[index] Z[offset] to set an offset value. M423 A[start] I[spacing] to set the X-start position and X-spacing distance. M424: Global Z OffsetSet or report the global Z offset for the leveling mesh. The command G29 will set this automatically to an average mesh value to allow for â€œleveling fadeâ€ with a biased mesh. In Marlin this feature requires the GLOBAL_MESH_Z_OFFSET option. Parameters Z New global offset value to apply. Usage M424 to report the current global mesh Z offset. M424 Z[offset] to set the global mesh Z offset. M425: Backlash CorrectionParameters Fnnn Enabledisablefade-out backlash correction (0.0 none to 1.0 100%) Snnn Distance over which backlash correction is spread1 (mm) Xnnn Set the backlash distance on X (mm; 0 to disable) Ynnn Set the backlash distance on Y (mm; 0 to disable) Znnn Set the backlash distance on Z (mm; 0 to disable) X Use measured value for backlash on X (if available) Y Use measured value for backlash on Y (if available) Z Use measured value for backlash on Z (if available) Examples (Marlin) M425 ; Report current stateM425 Z ; Use measured value of backlash on ZM425 F1 S3 ; Full backlash compensation while smoothing over 3mm.M425 F0.5 S0.0 ; Compensate for 50% of the backlash with no smoothingM425 X0.1 Y0.2 Z0.3Â ; Set backlash to specific values for all axis Notes 1 In Marlin, backlash compensation works by adding extra steps to one or more segments after a motor direction reversal. With smoothing off, this can cause blemishes on the print. Enabling smoothing will cause those extra steps to be spread over multiple segments, minimizing artifacts. M450: Report Printer ModeUsage M450 Example M450 PrinterMode:FFF Printers can be used for different task by exchanging the toolhead. Depending on the tool, a different behavior of some commands can be expected. This command reports the current working mode. Possible answers are: PrinterMode:FFF PrinterMode:Laser PrinterMode:CNC M451: Select FFF Printer ModeUsage M451 Example M451 PrinterMode:FFF Switches to FFF mode for filament printing. M452: Select Laser Printer ModeUsage M452 Example M452 PrinterMode:Laser Switches to laser mode. This mode enables handling of a laser pin and makes sure that the laser is only activated during G1 moves if laser was enabled or E is increasing. G0 moves should never enable the laser. M3M5 can be used to enabledisable the laser for moves. M453: Select CNC Printer ModeUsage M453 Parameters (RepRapFirmware only) Snnn (optional) Spindle index, defaults to 0. Duet 2 supports 4 spindles max Pfff:rrr Logical pin numbers used to drive the spindle motor in clockwise and counterclockwise directions. Omit the â€œ:rrrâ€ part if the spindle turns clockwise only. In Invert (I1) or donâ€™t invert (I0, default) the output polarity Rnnn Spindle RPM that is achieved at full PWM. Used to convert the S parameter in M3 and M4 commands to a PWM value. Fnnn (optional) The PWM frequency to use Tnnn (optional) Assign spindle to a tool allowing better control in DWC Example M453 PrinterMode:CNC Switches to CNC mode. In this mode M3M4M5 control the pins defined for the milling device. Notes for RepRapFirmware: By default, no output is assigned to the spindle motor. Logical pin numbers for the P parameters are as defined for the M42 and M208 commands. If you wish to assign a heater or fan output to control the spindle motor as in the above example, you must first disable the corresponding heater (see M307) or fan (see M106). M460: Define temperature range for thermistor-controlled fanUsage M460 X[minTemp] Y[maxTemp] Example M460 X50 Y60 If the firmware has a thermistor controlled fan defined, you can set at which temperature the fan starts and from which temperature on it should run with maximum speed. M470: Create Directory on SD-CardParameters Pname Name of directory to create Usage M470 Pdirectory/to/create Example M470 P/sys/config.d This will create a new directory on the SD-Card. If not otherwise specified the default root should be the firstinternal SD-Card. M471: Rename FileDirectory on SD-CardParameters Sname Name of existing filedirectory Tname New name of filedirectory Dnnn Setting this to 1 will delete an existing file that matches the T parameter value Usage M471 Ssource/name Tdest/name D1 Example M471 S/sys/config-override.g T/sys/config-override.g.bak Rename or move a file or directory. Using the D parameter can delete a file with the target name. Renaming or moving across directories is possible though not from one SD-Card to another. M472: Delete FileDirectory on SD-CardParameters Pname Name of filedirectory to delete Rn (optional) R1 recursive delete Example M472 P/gcodes/old_files R1 If the R1 parameter is provided and the P parameter is a directory, then files will be deleted recursively i.e. all contained files and directories will be deleted too. Otherwise, if â€œnameâ€ refers to a non-empty directory then deletion will fail. See also M30. M486: Cancel ObjectThe M486 G-code provides an interface to identify objects on the print bed and cancel them. Basic usage: Use M486 T to tell the firmware how many objects there are, so it can provide an LCD interface. (Otherwise the firmware counts them up in the first layer.) In every layer of your G-code, you must preface each objectâ€™s layer slice with M486 S[index] to indicate which object is being printed. The index should be zero-based. To cancel the first object, use M486 P0; to cancel the 5th object use M486 P4; and so on. The â€œcurrentâ€ object is canceled with M486 C. G-codes associated with the canceled objects are no longer printed. Firmware supports this feature by ignoring G0-G3G5 moves in XYZ while updating F and keeping the E coordinate up-to-date without extruding. Slicers should number purge towers and other global features with a negative index (or other flag) to distinguish them from regular print objects, since it is important to preserve color changes, purge towers, and brims. Host software (such as OctoPrint) may be able to cancel individual objects through a plugin, and in this case they should not use M486 P to cancel objects (although doing so should cause no harm). Usage M486 T12 ; Total of 12 objects (otherwise the firmware must count)M486 S3 ; Indicate that the 4th object is starting nowM486 S3 Acube copy 3Â ; Indicate that the 4th object is starting now and name it (RepRapFirmware)M486 S-1 ; Indicate a non-object, purge tower, or other global featureM486 P10 ; Cancel object with index 10 (the 11th object)M486 U2 ; Un-cancel object with index 2 (the 3rd object)M486 C ; Cancel the current object (use with care!)M486 ; List the objects on the build plate (RepRapFirmware) M486 implementation in RepRapFirmware If the GCode file being printed contains object label comments (e.g. using the â€œLabel objectsâ€ option in PrusaSlicer) then it is not necessary to use M486 S commands to indicate which object is being printed. Objects on the build plate will be numbered from 0 in the order in which their labels first appear in the file. If you do use M486 S commands in the GCode file instead of object label comments, then RepRapFirmware provides an optional A parameter to the M486 S command to allow objects to be named. The name of each object need only be specified once. M486 without parameters lists the names and approximate locations of known objects on the build plate. For the benefit of user interfaces, this information may also be retrieved from the object model using the M409 command or using the rr_model HTTP API. M493: Fixed-Time Motion ControlUse M493 to enabledisable and set parameters for Fixed-Time Motion Control (by Ulendo). Requires the FT_MOTION feature to be enabled. Fixed-Time Motion Control supersedes normal motion control when enabled, and can only be applied to Cartesian and Core motion systems. This is likely to change in future versions. This motion system implements its own Linear (Pressure) Advance and Input Shaping, but does not include proprietary Fast B-Spline (FBS) acceleration. Due to its overhead and memory requirements (around 11 kilobytes), it requires a fast board with plenty of RAM. Parameters Smode Set the motion / shaping mode. Shaping requires an X axis, at the minimum. 0: NORMAL 1: FIXED-TIME 10: ZV 11: ZVD 12: EI 13: 2HEI 14: 3HEI 15: MZV Pbool Enable (1) or Disable (0) Linear Advance pressure controlKgain Set Linear Advance gain Dmode Set Dynamic Frequency mode 0: DISABLED 1: Z-based (Requires a Z axis) 2: Mass-based (Requires X and E axes) AHz Set static/base frequency for the X axisFHz Set frequency scaling for the X axisBHz Set static/base frequency for the Y axisHHz Set frequency scaling for the Y axis M500: Store parameters in non-volatile storageExample M500 Save current parameters to EEPROM, SD card, Flash memory or other non-volatile storage. In Redeem any parameters set through GM-codes which is different than what is read from the config files, are stored back to the local config. For instance setting stepper current and microstepping through M906 and M907 followed by M500 will update etcredeemlocal.cfg. In Druid Firmware, because of the small size for parameter storage (512 bytes), a 128K flash memory sector is used as permanent storage. The sector can be partially written 256 times (512 bytes per backup) before requiring a complete sector wipe, to restart the same process again. (That was 1 write cycle). The flash memory minimum write cycles guaranteed for the STM32F407 MCU by ST Microelectronics are 10000, yielding a total of 2.56 million times, parameters can be saved. Also with Druid Firmware, you no longer have to worry about saving your newly modified settings. Druid firmware save them in a temporary file as you make them. At every Boot, it loads the settings from the FLASH memory block, and also read the temp file and apply the previously modified settings to the RAM, seamlessly. When the size of the temporary file is above the limit set by the users, or when using M500, Druid Firmware merge theses changes and write all settings to the next 512 byte block in the flash, and delete the temporary file. In Druid Firmware, users will only have to use M500, to immediately force the merging of the temporary file with the current settings, in which, all changed parameters are saved, before the file limit size is reached (as explained in previous paragraph) M501: Read parameters from EEPROMParameters Snnn Enable auto-save (only RepRapFirmware) Example M501 Set the active parameters to those stored in the EEPROM, SD card or other non-volatile storage. This is useful to revert parameters after experimenting with them. RepRapFirmware versions prior to 1.17 allows â€œS1â€ to be passed, which forces parameters to be automatically saved to EEPROM when they are changed. In RepRapFirmware 1.17 and later, the parameters are saved in file sysconfig-override.g on the SD card. M502: Restore Default SettingsExample M502 This command resets all tunable parameters to their default values, as set in the firmwareâ€™s configuration files. This doesnâ€™t reset any parameters stored in the EEPROM, so it must be followed with M500 to reboot with default settings. M503: Report Current SettingsExamples M503Â ; Output current settingsM503 S0Â ; Settings as G-code only (Marlin 1.1) This command asks the firmware to reply with the current print settings as set in memory. Settings will differ from EEPROM contents if changed since the last load save. The reply output includes the G-Code commands to produce each setting. For example, Steps-Per-Unit values are displayed as an M92 command. RepRapFirmware outputs the content of the configuration file, but note that it may be truncated if it is too long. M504: Validate EEPROMExamples M504Â ; Check EEPROM This command checks the contents of EEPROM for correct version, size, and checksum and reports the result. M505: Firmware dependentM505: Clear EEPROM and RESET PrinterThis command erase all EEPROM and reset the board. M505: Set configuration file folderParameters Pâ€nameâ€Â ; name of folder, default path is sys if it is a relative path Example M505 Pâ€experimentalâ€Â ; change config file path from sys to sysexperimental Following this command, files that would normally be fetched from sys (for example, homing files and system macro files in RepRapFirmware) are fetched from the specified folder instead. Any such files that are already being executed will continue to run. This command can be used to allow multiple configurations to be maintained easily. In RepRapFirmware the file sysconfigg can contain just these two lines: M505 Pconfig1M98 Pconfig.g The first line changes the config file folder to sysconfig1 and the second one executes file config.g in that folder. To select an alternative configuration, only the first line needs to be edited. M505: Set a named EEPROM valueUse M505 varname value to directly set and store a named variable and value to EEPROM. The variable name can be up to 31 characters in length and the value can be up to 63 characters. Be careful with this G-code because a larger name or value can cause some versions of Buddy firmware to crash. M509: Force language selectionResets the language to English. Only on Original Prusa i3 MK2.5s and MK3s with multiple languages. M510: Lock MachineLock the machine. When the machine is locked a passcode is required to unlock it. Use M511 P with your passcode to unlock the machine. In Marlin this feature is enabled with the PASSWORD_FEATURE option. In Druid, this feature is always enabled. M511: Unlock Machine with PasscodeCheck the given passcode and unlock the machine if it is correct. Otherwise, delay for a period of time before allowing another attempt. In Marlin this feature is enabled with the PASSWORD_FEATURE option. Parameters Pâ€passcodeâ€Â ; a numeric passcode to try Notes In Druid, this feature is always enabled. M511 â€œ12PWS5pbâ€ Between double quote. Fixed length = 8 Char.Valid Characters (a-z A-Z 0-9)Always case-sensitive, regardless of Gcode Parser Case sensitivity option (M544) M512: Set PasscodeCheck the given passcode (P) and if it is correct clear the passcode. If S is given, set a new passcode. In Marlin this feature is enabled with the PASSWORD_CHANGE_GCODE option. Parameters Pâ€oldpassâ€Â ; the current numeric passcode Sâ€newpassâ€Â ; a new numeric passcode Notes In Druid, we use similar procedures to create, modify the password, but it is never saved, instead it is a one-way cryptographic hash generated from it, that is saved inside the MCU, to insure maximum security. Before setting a password, the user must make a backup of its PUID (a 96 bit serial number unique to every STMicroelectronics MCU). If the password is lost, the only solution is to enter the PUID, on our website www.druid3d.com in the members area. A one-way cryptographic hash will be generated from the provided PUID, and will be available as a text file and as a string. When this file is added to the external SD CARD. The Bootloader, that is looking for it at every boot, will find it, and will verify that it matches the one it will generate from the internal PUID. Verified in a few microseconds, both will be erased, from the RAM and the SD card, then it will remove the password, unlock the machine. This is the most secure way of protecting a device. Any other system is hackable in a few minutes. (See also M513, to remove password, with either current or â€œPW Removal HASH Stringâ€ ) M512 â€œPASSWORD ; set new password, if none already set. M512 â€œcurPW001NEWnew02â€Â ; set new password, if current match. (between double quote, separated by a slash â€˜â€˜ or a space â€˜ â€˜ ) Fixed length 8 Char, Valid Characters (a-z A-Z 0-9), Always case-sensitive, regardless of Gcode Parser Case sensitivity option (M544) M513: Remove PasswordExample with Druid firmware M513 â€œcurrpassâ€ ; the current password (if known) M513 â€œ0446759DBDC230122126F5ACâ€Â ; 24 char.â€PW Removal HASH Stringâ€, generated from MCU PUID. visit www.druid3D.com to generate your unique Password Removal HASH String. M524: Abort SD PrintingExample M524 If an SD print is in progress, this command aborts the print, just as if you had selected â€œStop printâ€ from the LCD menu. M530: Enable printing modeExample M530 S1 L270 This command tells the firmware that a print has started (S1) or ended (S0). The L parameter sets the number of layers. L0 denotes unknown layer count. This enables the firmware to switch into a special print display mode to show print progress. Firmware should indicate the presence of this feature by responding to M115 with an additional line: Cap:PROGRESS:1 Notes 1In MK4duo this command starts print counters for statistics. It also turns off a 30-minute timer for the heaters. If the timer reaches 30, turn off all the heaters. M531: Set print nameExample M531 Demo Model Sets the name of the currently printed object. Should follow M530 S1 for correct display. M532: Set print progressExample M532 X23.7 L56 Sets the print progress (X 0..100) and currently printed layer (L). Should be send every 0.1% progress change on every layer change. M540: Set MAC addressParameters Pnnn The MAC address Examples M540 P0xBE:0xEF:0xDE:0xAD:0xFE:0xEDM540 PDE:AD:BE:EF:CA:FE Sets the MAC address of the RepRap. This should be done before any other network commands. The MAC address is six one-byte hexadecimal numbers separated by colons. The 0x prefix is optional in later firmware revisions. All devices running on the same network shall all have different MAC addresses. For your printers, changing the last digit is sufficient. This command is only needed when using older electronics that doesnâ€™t provide a unique MAC address, for example Duet 0.6 and Duet 0.8.5. M540 in MarlinDruidMK4duo: EnableDisable â€œStop SD Print on Endstop Hitâ€Parameters Snnn state, S1enable, S0disable Example M540 S1 Notes In Prusa Firmware this G-code is deactivated by default, must be turned on in the source code.1 M544: Gcode Parser OptionsParameters Snnn S1case insensitive, S0case sensitive S Report current case state. L List all supported Gcodes K List all Druid proprietary MMM commands (Media and Memory Management) M550: Set NameParameters Pnnn Machine name Example M550 PGodzilla Sets the name of the RepRap to (in this case) Godzilla. The name can be any string of printable characters except â€˜;â€™, which still means start comment. M551: Set PasswordParameters Pnnn Password Example M551 Pmy-very-secret-word On machines that need a password to activate them, set that password. The code â€˜Pâ€™ is not part of the password. Note that as this is sent in clear it does not (nor is it intended to) offer a very high level of security. But on machines that are (say) on a network, it prevents idle messing about by the unauthorised. The password can contain any printable characters except â€˜;â€™, which still means start comment. Note for RepRapFirmware: If the specified password differs from the default one (i.e. reprap), the user will be asked to enter it when a connection is established via HTTP or Telnet. For FTP, the password must always be passed explicitly. M552: Set IP address, enabledisable network interfaceParameters Innn (Optional) Number of the network interface to manage (defaults to 0) Pnnn IP address, 0.0.0.0 means acquire an IP address using DHCP Snnn (optional) -1 reset network interface, 0 disable networking, 1 enable networking as a client, 2 enable networking as an access point (WiFi-enabled electronics only) Rnnn (optional, RepRapFirmware 1.17 and earlier only) HTTP port, default 80 Example M552 P192.168.1.14 Sets the IP address of the machine to (in this case) 192.168.1.14. If the S parameter is not present then the enabledisable state of the network interface is not changed. In RepRapFirmware 1.18 and later the HTTP port address is set using the M586 command, so the R parameter of this command is no longer supported. M552 with no parameters reports the current network state and IP address. M553: Set NetmaskParameters Innn (Optional) Number of the network interface to manage (defaults to 0) Pnnn Net mask Example M553 P255.255.255.0 Sets the network mask of the RepRap machine to (in this case) 255.255.255.0. A restart may be required before the new network mask is used. If no â€˜Pâ€™ field is specified, this echoes the existing network mask configured. Recent RepRapFirmware versions allow the IP configuration to be changed without a restart. M554: Set Gateway andor DNS serverParameters Innn (Optional) Number of the network interface to manage (defaults to 0) Pnnn Gateway Snnn (Optional) DNS server (only supported by DSF 3.3 with DuetPi system config plugin) Example M554 P192.168.1.1 Sets the Gateway IP address of the RepRap machine to (in this case) 192.168.1.1. A restart may be required before the new gateway IP address is used. If no â€˜Pâ€™ field is specified, this echoes the existing Gateway IP address configured. Recent RepRapFirmware versions allow the IP configuration to be changed without a restart. M555: Set compatibilityParameters Pnnn Emulation type Example M555 P1 For firmware that can do it, the firmware is set to a mode where its input and (especially) output behaves exactly like other established firmware. The value of the â€˜Pâ€™ argument is: P value Firmware 0 Native (i.e. whatever the firmware actually is) 1 RepRapFirmware 2 Marlin 3 Teacup 4 Sprinter 5 Repetier 6 Marlin with changes for nanoDLP M555: Set Bounding BoxParameters Xnnn Minimum X coordinate Ynnn Minimum Y coordinate of model Wnnn X size of model (max - min X coordinate) Hnnn Y size of model (max - min Y coordinate) Example M555 X10 Y20 W30 H40 Tells the printer about the size of the model. The XL uses this information to save power for smaller models by only heating the area under it. M556: Axis compensationParameters Snnn Height of the measured distances Xnnn Deviation in X direction Ynnn Deviation in Y direction Znnn Deviation in Z direction Pnnn Apply XY compensation to Y axis instead of X (defaults to 0, requires RRF 3.2-b4 or newer) Example M556 S100 X0.7 Y-0.2 Z0.6 Image denoting how to determine the S parameter for G-code M556 Though with care and adjustment a RepRap can be set up with its axes at right-angles to each other within the accuracy of the machine, who wants to bother with care and adjustment when the problem can be solved by software? This tells software the tangents of the angles between the axes of the machine obtained by printing then measuring a test part. The S parameter (100 here) is the length of a triangle along each axis in mm. The X, Y and Z figures are the number of millimeters of the short side of the triangle that represents how out of true a pair of axes is. The X figure is the error between X and Y, the Y figure is the error between Y and Z, and the Z figure is the error between X and Z. Positive values indicate that the angle between the axis pair is obtuse, negative acute. M557: Set Z probe point or define probing gridParameters to define G32 probe points (CartesianCoreXY printers only, no longer supported in RepRapFirmware) Pnnn Probe point number Xnnn X coordinate Ynnn Y coordinate Example M557 P1 X30 Y40.5 Parameters to define G29 probe grid (all values in mm) Xaaa:bbb Minimum and maximum X coordinates to probe Yaaa:bbb Minimum and maximum Y coordinates to probe Rnnn Radius to probe Snn or Sxx:yy Probe point spacing Pnn or Pxx:yy Number of probe points in each direction (RepRapFirmware 2.02 and later) - use instead of specifying the spacing Examples M557 X0:200 Y0:220 S20M557 R150 S15 Set the points at which the bed will be probed to compensate for its plane being slightly out of horizontal. The first form defines the points for for G32 bed probing. The P value is the index of the point (indices start at 0) and the X and Y values are the position to move extruder 0 to to probe the bed. An implementation should allow a minimum of three points (P0, P1 and P2). This just records the point coordinates; it does not actually do the probing. See G32. Defining the probe points in this way is no longer supported by RepRapFirmware, you should define them in a bed.g file instead. The second form defines the grid for G29 bed probing. For Cartesian printers, specify minimum and maximum X and Y values to probe and the probing interval. For Delta printers, specify the probing radius. If you define both, the probing area will be the intersection of the rectangular area and the circle. There is a firmware-dependent maximum number of probe points supported, which may be as low as 100. M558: Set Z probe typeParameters Knn Z probe number (optional, default 0) Pnnn Z probe type Fnnn Feed rate (i.e. probing speed, mmmin) Hnnn Dive height (mm) Innn Invert (I1) or do not invert (I0) the Z probe reading (RepRapFirmware 1.16 and later) Rnnn Z probe recovery time after triggering, default zero (seconds) (RepRapFirmware 1.17 and later)1 Tnnn Travel speed to and between probe points (mmmin) Annn Maximum number of times to probe each point, default 1 (RepRapFirmware 1.21 and later) Snnn Tolerance when probing multiple times, default 0.03 (RepRapFirmware 1.21 and later) Bn B1 turns off all heaters during probing moves and during the probe recovery time (RepRapFirmware 1.21 and later) Obsolete parameters Xnnn If nonzero, use probe for homing X axis (RepRapFirmware 1.19 and earlier only) Ynnn If nonzero, use probe for homing Y axis (RepRapFirmware 1.19 and earlier only) Znnn If nonzero, use probe for homing Z axis (RepRapFirmware 1.19 and earlier only) Example M558 P1 F500 T5000 H3 A Z probe may be a switch, an IR proximity sensor, or some other device. This selects which to use: P0 indicates that no Z probe is present P1 indicates an unmodulated IR probe, or any other probe type that emulates an unmodulated IR probe (probe output is an analog signal that rises with decreasing nozzle height above the bed). If there is a control signal to the probe, it is driven high when the probe type is P1 P2 specifies a modulated IR probe, where the modulation is commanded directly by the main board firmware using the control signal to the probe P3 selects an alternative Z probe similar to P1 but the control signal to the probe low P4 selects a switch for bed probing (on the Duet, this must be connected to the E0 endstop pins) P5 (from RepRapFirmware 1.14) selects a switch or a digital output device to the In pin of the Z-probe connector P6 is as P4 but the switch is connected to and alternative connector (on the Duet series, the E1 endstop connector) P7 is as P4 but the switch is connected to and alternative connector (on the Duet series, the Z endstop connector) P8 is as P5 but the signal is unfiltered for faster response P9 is as P5 but the probe is deployed and retracted at every probe point. This is intended for BLTouch. P10 means use Z motor stall detection as the Z probe trigger. P11 means a scanning Z probe with an analog output (supported from RRF 3.5.0-beta.4). Such probes must be calibrated before use (see M558.1). Related codes: G29, G30, G31, G32, M401, M402, M558.1, M558.2. M558.1: Calibrate height vs. reading for analog Z probeParameters Knn Z probe number (optional, default 0) Sn.n Height to scan above and below the trigger height, in mm Ann.n (optional) Linear coefficient of the output, in mm per count Bnn.n (optional, ignored unless A parameter is also present, default 0.0) Quadratic coefficient of the output, in mm^2 per count Cnn.n (optional, ignored unless A parameter is also present, default 0.0) Cubic coefficient of the output, in mm^3 per count If the A parameter is present then the S parameter is ignored and the equation to calculate the actual height of the Z probe is set to this: height = trigger_height + A * (probe_reading - probe_threshold) + B * (probe_reading - probe_threshold)^2 + C * (probe_reading - probe_threshold)^3 where trigger_height and probe_threshold are as set by G31. If the A parameter is not present but the S parameter is present then the probe is raised or lowered to (trigger_height + S_parameter) at the current XY position, then readings are taken as the probe is gradually lowered to (trigger_height - S_parameter). The readings are used to compute, store and report new values of A, B, C and the trigger threshold. If neither the A nor the S parameter is present, the current A, B and C values are reported. M558.2: Set, report or calibrate drive current for analog Z probeParameters Knn Z probe number (optional, default 0) Sn.n Drive level to set, or -1 to determine automatically. For LDC1612-based probes, when setting the current this should be in the range 0 to 31. This command is used to control the drive current of scanning Z probes that use the LDC1612 chip. If the drive current is set too low, the sensor will not work when it is close to the bed. If the drive current is set too high, it will not work when the sensor is distant from the bed. Use M122 B# (where # is the CAN address of the board that carries the sensor) to determine whether the sensor is working normally. When using this command with S-1 to determine the optimum drive current automatically, the sensor should first be placed at the lower distance limit (closest distance from the metal bed surface) of the intended operating range. If M558 is used with no S parameter then the current drive level is reported. After using M558.2 to change the drive level, M558.1 should be used to recalibrate the sensor. M558.3: Set touch mode parameters for analog Z probeParameters (provisional) Knn Z probe number Sn Mode to use: 0 standard mode, 1 touch mode Fnnn Feed rate to use (mmmin) in touch mode Hn.nn Nozzle height (mm) to be assumed when touch is detected, normally negative Vn.nn Sensitivity to touch, between 0 (not at all sensitive) and 1.0 (very sensitive) Additional sensitivity parameters may be added in future to provide better control of touch recognition. All parameters are optional. If the K parameter is not provided then probe 0 is assumed. If other parameters are not provided then their values remain unchanged. If no parameters (except possibly K) are provided then the existing values are reported. In standard mode the output of an analog Z probe is compared with the threshold as the probing move progresses. When the probe output reaches the threshold, probing stops and the Z height is assumed to be equal to the trigger height. In RepRapFirmware both the threshold and trigger height are set using the G31 command. In touch mode the output of the probe is monitored as the probing move progresses. When the rate of change reduces sharply (the exact details depending on the sensitivity parameters) it is assumed hat the nozzle has contacted the bed. The Z height is assumed to be the value set using the H parameter. When an analog Z probe is created using M558, the mode is set to standard mode, the feed rate in touch mode (M558.3 F parameter) is set to the feed rate in standard mode (first or only value of the M558 F parameter) and the touch mode nozzle height and sensitivity assume default values. Fast-then-slow probing is not available in touch mode. M559: Upload configuration fileExample M559 If the RepRap supports it, this uploads a file that is run on re-boot to configure the machine. This file usually is a special G Code file. After sending M559, the file should be sent, ending with an M29 (q.v.). M560: Upload web page fileExample M560 For RepRaps that have web support and that can be driven by a web browser, this uploads the file that is the control page for the RepRap. After sending M560 the file (usually an HTML file) should be sent, terminated by the string !-- **EoF** -- . Clearly that string cannot exist in the body of the file, but can be put on the end to facilitate this process. This should not be too serious a restrictionâ€¦ M561: Set Identity TransformExample M561 This cancels any bed-plane fitting as the result of probing (or anything else) and returns the machine to moving in the userâ€™s coordinate system. M562: Reset temperature faultParameters Pnnn Heater number Example M562 P2 Reset a temperature fault on heatersensor 2. If the RepRap has switched off and locked a heater because it has detected a fault, this will reset the fault condition and allow you to use the heater again. Obviously to be used with caution. If the fault persists it will lock out again after you have issued this command. P0 is the bed; P1 the first extruder, and so on. Later versions of RepRapFirmware support M562 without the P parameter, which will reset all heater faults. M563: Define or remove a toolParameters Pnnn Tool number Sname Tool name (optional) Dnnn Extruder drive(s) Hnnn Heater(s) Fnnn Fan(s) to map the print cooling fan to (RepRapFirmware 1.16 and later) Xnnn Axis or axes to map X movement to (RepRapFirmware 1.16 and later) Ynnn Axis or axes to map Y movement to Lnnn Drive to use for filament mapping. By default RRF will use the first and only extruder drive if this parameter is not specified (supported by RRF 2.02) Examples M563 P0 D0:2:3 H1:3 ; create a tool using extruder drives 0, 2 and 3 and heaters 1 and 3M563 P1 D1 H2 X3 ; create a tool using extruder drive 1 and heater 2 with X movement mapped to the U axisM563 P2 D0:1 H1:2 X0:3 F0:2 ; create a tool using extruder drives 0 and 1, heaters 1 and 2, ; with X movement mapped to both X and U axes and fan 0 mapped to fan 0 and fan 2M563 P3 D0 H1 SChocolate extruderÂ ; create a named tool using extruder drive 0 and heater 1 Tools are usually (though not necessarily) extruders. The â€˜Pâ€™ field specifies the tool number. Tool numbers can have any positive integer value and 0. The â€˜Dâ€™ field specifies the drive(s) used by the tool - in the first example drives 0, 2 and 3. Drive 0 is the first drive in the machine after the movement drives (usually X, Y and Z). If there is no â€˜Dâ€™ field the tool has no drives. The â€˜Hâ€™ field specifies the toolâ€™s heaters - in the first example heaters 1 and 3. Heater 0 is usually the hot bed (if any) so the first extruder heater is usually 1. If there is no H field the tool has no heaters. Tools are driven using multiple values in the â€˜Eâ€™ field of G1 commands, each controlling the corresponding drive in the â€˜Dâ€™ field above, as follows: G1 X90.6 Y13.8 E2.24:2.24:15.89G1 X70.6 E0:0:42.4 The first line moves straight to the point (90.6, 13.8) extruding a total of 2.24mm of filament from both drives 0 and 2 and 15.98mm of filament from drive 3. The second line moves back 20mm in X extruding 42.4mm of filament from drive 3. Alternatively, if the slicer does not support generating G1 commands with multiple values for the extrusion amount, the M567 command can be used to define a tool mix ratio. Normally an M563 command is immediately followed by a G10 command to set the toolâ€™s offsets and temperatures. It is permissible for different tools to share some (or all) of their drives and heaters. So, for example, you can define two tools with identical hardware, but that just operate at different temperatures. The X mapping option is used to create tools on machines with multiple independent X carriages. The additional carriages are set up as axes U, V etc. (see M584) and the X mapping option in M563 defines which carriage or carriages are used. If you use the M563 command with a P value for a tool that has already been defined, that tool is redefined using the new values you provide. RepRapFirmware supports an additional form of the M563 command. The command: M563 S1 means add 1 (the value of the S parameter) to all tool numbers found in the remainder of the current input stream (e.g. the current file if the command is read from a file on the SD card), or until a new M563 command of this form is executed. The purpose of this is to provide compatibility between systems in which tool numbers start at 1, and programs such as slic3r that assume tools are numbered from zero. Recent versions of RepRapFirmware allow the deletion of existing tools if M563 is called in this way: M563 P1 D-1 H-1 M564: Limit axesParameters Hnnn H1 forbid movement of axes that have not been homed, H0 allow movement of axes that have not been homed (RepRapFirmware 1.21 and later) Snnn S1 limit movement within axis boundaries, S0 allow movement outside boundaries Example M564 S0 H0 Allow moves outside the print volume and before homing, or not. If the S parameter is 0, then you can send G codes to drive the RepRap outside its normal working volume, and it will attempt to do so. Likewise if the H parameter is 0 you can move the head or bed along axes that have not been homed. The default behaviour is S1 H1. On some types of printer (e.g. Delta and SCARA), movement before homing is prohibited regardless of the H parameter. M565: Set Z probe offsetExample M565 X3 Y4.5 Z-2.37 Set the offset from the extruder tip to the probe position. The X, Y, and Z values are the delta between the extruder and the actual trigger position of the probe. If the probe trigger point is below the extruder (typical) the Z offset will be negative. This just records the point offset; it does not actually do the probing. See G32. M566: Set allowable instantaneous speed changeParameters Xnnn Maximum instantaneous speed change of the X axis (mmmin) Ynnn Maximum instantaneous speed change of the Y axis Znnn Maximum instantaneous speed change of the Z axis Ennn Maximum instantaneous speed change of the extruder drives Example M566 X20 Y20 Z2 E10 Sets the maximum allowable speed change (sometimes called â€˜jerk speedâ€™) of each motor when changing direction. The model files and gcode files used by repraps generally render circles and other curves shapes as a sequence of straight line segments. If the motors were not allowed any instantaneous speed change, they would have to come to a stop at the junction between each pair of line segments. By allowing a certain amount of instantaneous speed change, printing speed can be maintained when the angle between the two line segments is small enough. If you set these X and Y values too low, then the printer will be slow at printing curves. If they are too high then the printer may be noisy when cornering and you may suffer ringing and other print artefacts, or even missed steps. On very old versions of RepRapFirmware (prior to 1.09), these were also the minimum speeds of each axis. M567: Set tool mix ratiosParameters Pnnn Tool number Ennn Mix ratios Example M567 P2 E0.1:0.2:0.1:0.6 This example sets the mix ratio for tool 2 (the P value). When mixing is then turned on (see M568), only single E values need to be sent on a G1 command (any extra E values will be ignored, but are not illegal): G1 X20 E1.3 This will move to X20 extruding a total length of filament of 1.3mm. The first drive of tool 2 will extrude 0.1*1.3mm, the second 0.2*1.3mm and so on. The ratios donâ€™t have to add up to 1.0 - the calculation done is as just described. But it is best if they do. See also M568. M568: Tool settingsParameters Pnnn Tool number. If this parameter is not provided, the current tool is assumed. Rnnn Standby temperature(s) Snnn Active temperature(s) Fnnn Spindle RPM, always positive An Required heater state: 0 off, 1 standby temperature(s), 2 active temperature(s) Examples M568 P1 R140 S205Â ; set standby and active temperatures for tool 1 M568 P0 F5200Â ; set spindle RPM for tool 0 M568 P2 A1Â ; set tool 2 heaters to their standby temperatures RepRapFirmware will report the tool parameters if only the tool number is specified. The R value is the standby temperature in Â°C that will be used for the tool, and the S value is its operating temperature. If you donâ€™t want the tool to be at a different temperature when not in use, set both values the same. Temperatures set with M568 do not wait for the heaters to reach temp before proceeding. In order to wait for the temp use a M116 command after the M568 to wait for temps to be reached. M568: Turn offon tool mix ratios (obsolete meaning in old RepRapFirmware versions)This command is obsolete. When using a tool defined as a mixing extruder, RepRapFirmware applies the mix ratio defined by M567 whenever only one E parameter is provided in G1 commands. When multiple colon-separated E values are provided in the G1 command, they will be used as the individual amounts to extrude. M569: Stepper driver controlParameters Pnn Motor driver number Sn Direction of movement of the motor(s) attached to this driver: 0 backwards, 1 forwards (default 1) Rn Driver enable polarity: 0 active low, 1 active high (default 0) Tnn Minimum driver step pulse width and interval in microseconds (RepRapFirmware 1.14 and later) Taa:bb:cc:dd Minimum driver step pulse width, step pulse interval, direction-to-step setup time and step-to-direction hold time, in microseconds (RepRapFirmware 1.21 and later) Dnn Stepper driver mode (RepRapFirmware 2.0 and later): 0constant off time, 1random off time, 2spread cycle, 3stealthChop, 4closed loop Fnn (firmware 2.02 and later) Off-time in the chopper control register, 1 to 15 Bnn (firmware 2.02 and later) Blanking time (tbl) in the chopper control register, 0 to 3. See the TMC driver datasheet. Yaa:bb or Yaa:bb:cc (firmware 2.02 and later) Hysteresis start, end and decrement values in the chopper control register. See the TMC driver datasheet for the meaning. Cnnn Custom chopper control register value (RepRapFirmware 2.0 and later). Do not change this value without having a good understanding of the stepper driver driver chip! Hnn (firmware 2.02 and later) t_high parameter for those stepper driver chips that support it (e.g. TMC2208, 2224). Send M569 P# (where # is the driver number) with no additional parameters to see how this translates into mmsec. See also the V parameter. Vnnn (firmware 2.02 and later) tpwmthrs parameter for those stepper driver chips that support it (e.g. TMC2208, 2224). This is the interval in clock cycles between 1256 microsteps below which the drivers will switch from stealthChop to to spreadCycle mode. Only applies when the driver is configured in stealthChop mode. Typical value are from 100 (high speed) to 4000 (low speed). Send M569 P# (where # is the driver number) with no additional parameters to see how this translates into axis speed in mmsec. Example M569 P0 S0 ; reverse the direction of the motor attached to driver 0M569 P5 R1 T2.5:2.5:5:0 ; driver 5 requires an active high enable, 2.5us minimum step pulse, 2.5us minimum step interval, 5us DIR setup time and no hold time Notes All parameters except P are optional. For any parameter that is not provided, the corresponding value will not be changed. The T parameters are intended for use with external stepper drivers. Currently, RepRapFirmware only remembers the highest T parameters seen in any M569 command, and applies those values to all drivers for which any nonzero T parameters were specified. The modes (D parameter) supported by various stepper driver chips are: TMC2130, TMC2160, TMC5160: modes 0,1,2,3 (Duet 3 EXP1HCL board also supports mode 4) TMC2660: modes 0,1,2 TMC220822092224: modes 2,3 (mode 3 is stealthChop2) Some versions of RepRapFirmware prior to 1.14 also provided X, Y, Z and E parameters to allow the mapping from axes and extruders to stepper driver numbers to be changed. From 1.14 onward, this functionality is provided by M584 instead. M569.1: Stepper driver closed loop configurationParameters Pn or Pn.n Motor driver number, or board address and driver number Sn Mode: 0open loop (default), 1closed loop (requires an encoder to be selected, see the T parameter) Tn Encoder type: 0none, 1linear quadrature encoder on axis, 2quadrature encoder on motor shaft, 3AS5047D encoder on motor shaft, 4TLI5012B encoder on motor shaft En.n Encoder counts per mm (linear encoder) or per rotation (rotary encoder). Only used if the encoder type is 1 or 2. Rn.n Proportional constant In.n Integral constant Dn.n Derivative constant Hn Minimum holding current as a percentage of the configured current when operating in closed loop mode Supported by RepRapFirmware on boards using closed loop drivers. Switching between open loop and closed loop modes is done using M569. M569.2: Read or write any stepper driver registerParameters Pnn Motor driver number Rnn Register number, 0-127 Vnnnn Value to write (optional) Example M569.2 P1 R0 If the V parameter is not provided, this command reads the specified register and returns the value of that register. If the V parameter is provided, that value is written to the specified register. WARNING! Use of M569.2 to write stepper driver registers may result in damage to the stepper drivers, for example from excessive motor current or insufficient blanking time. M569.3: Read Motor Driver EncoderThis causes the RepRap machine to report its current motor encoder positions to the host in units of arc degrees (1360â€™ths of turns), relative to some reference position that you set with the S parameter. Before the first call with the S parameter, the reference is unknown and arbitrary. Parameters Pn or Pn.n Motor driver number, or board address and driver number. Several (remote) drivers may be specified, separated by colon. No more than number of visible axes, as specified by M584 P parameter, are allowed. S Sets an encoder reference point. Current and subsequent M569.3 Pn.n calls returns numbers that are relative to the M569.3 Pn.n S call. If P is not supplied, an error is returned. A maximum of four CAN-connected drivers can be reached with M569.3 counting from machine boot. CAN addresses that fail to respond donâ€™t count towards this maximum. Examples M569.3 Error: M569: missing parameter â€˜Pâ€™ M569.3 P54.0 Error: M569.3: Message not received M569.3 P40.0:41.0:42.0:43.0 [-155.28, -4089.60, 6842.04, 0.00, ], M569.3 P43.0:41.0:42.0:40.0 [0.00, -4089.60, 6842.04, -155.28, ], M569.3 P40.0:41.0:42.0:43.0 S [0.00, 0.00, 0.00, 0.00, ], M569.3 P49.0 Error: M569.3: Max CAN addresses we can reference is 4. Canâ€™t reference board 49. Notes 1 Planned for RepRapFirmware 3.4. M569.4: Set Motor Driver Torque ModeTell one or more motor drivers to apply a specified torque regardless of position. Parameters Pn or Pn.n Motor driver number, or board address and driver number. Can also be a colon separated list of driver numbers. Tn Where n is the modetorque to apply in units of Nm. Newer Hangprinters might use units of N. If P or T parameter is missing, then no action is taken. The driver is put back into position mode by requesting a torque smaller than 0.0001 Nm. Examples M569.4 Error: M569: missing parameter â€˜Pâ€™ M569.4 P40.0:41.0 Error: M569: missing parameter â€˜Tâ€™ M569.4 P40.0 T0.001 0.001000 Nm, M569.4 P40.0:41.0 T0 pos_mode, pos_mode, Notes Hangprinterâ€™s â€œtorque modeâ€ is implemented as a ReprapFirmware macro that depends on M569.4. Practical torques for tightening lines in daily use tend to lie between 0.1 Nm and 0.001 Nm for a Hangprinter. 1 Planned for RepRapFirmware 3.4. M569.5: Collect Data from Closed-loop DriverParameters Pn.n Motor CAN board address and driver number Remaining details TBD. M569.6: Execute Closed-loop Driver Tuning MoveParameters Pn.n Motor CAN board address and driver number Remaining details TBD. M569.7: Configure motor brake portParameters Pn.n Motor CAN board address (if applicable) and driver number Cport Port name of the brake control port. The port must be on the same CAN board as the driver. The CAN address does not need to be specified in the port name, but if it is then it must be the same as the driver address. Example M569.7 P40.0 Cout2 ; driver 0 on board 40 uses port out1 on board 40 to control the brake When the motor driver is enabled, the specified output port will be turned on at the same time to release the brake. When the motor driver is disabled, the output port will be turned off. Idle current mode does not count as disabled. M569.8: Read Axis ForceParameters Pn or Pn.n Motor driver number, or board address and driver number. Can also be a colon separated list of driver numbers. The readouts are in units of Newtons. Example M569.8 P40.0:41.0:42.0:43.0 [3.52, -0.60, 7.24, -5.84, ], M569.9: Sets the driver sense resistor and maximum currentParameters Pnn or Pnn.n Motor driver number. Rnnnn Driver sense resistor value in Ohms. Snnnn Driver max current value in Amps. Example M569.9 R0.047 S4 ; driver 0 uses a 47mOhm sense resistor and 4 Amps maximum driver output M570: Configure heater fault detectionParameters for RepRapFirmware 1.14 and earlier Snnn Heater timeout (in seconds) Example M570 S120 After a heater has been switched on, wait 120 seconds for it to get close to the set temperature. If it takes longer than this, raise a heater fault. Parameters for RepRapFirmware 1.15e and later Hnnn Heater number Pnnn Time in seconds for which a temperature anomaly must persist on this heater before raising a heater fault (default 5 seconds) Tnnn Permitted temperature excursion from the setpoint for this heater (default 10C) Snnn Time in seconds after a heater fault is raised after which the print will be abandoned, default 10 minutes (RepRapFirmware 1.20 and later) Example M570 H1 P4 T15 Warning! Heating fault detection is provided to reduce the risk of starting a fire if a dangerous fault occurs, for example if the heater cartridge or thermistor falls out of the heater block. You should not increase the detection time or permitted temperature excursion without good reason, because doing so will reduce the protection. M571: Set output on extrudeParameters Snnn Output value Fnnn Output PWM frequency (RepRapFirmware 1.17 and later) Pnnn Logical pin number (RepRapFirmware 1.17 and later), defaults to the FAN0 output until M571 with a P parameter has been seen Example M571 P3 F200M571 S0.5 This turns the controlled pin output on whenever extrusion is being done, and turns it off when the extrusion is finished. The output could control a fan or a stirrer or anything else that needs to work just when extrusion is happening. It also can be used to control a laser beam. The S parameter sets the value of the PWM to the output. 0.0 is off; 1.0 is fully on. In RepRapFirmware 1.17 and later you can use the P parameter to change the pin used and you can also set the PWM frequency. Pin numbers are the same as in the M42 and M280 commands. The pin you specify must not be in use for anything else, so if it is normally used as a heater you must disable the heater first using M307, or if it is used for a fan you must disable the fan using M106 with the I-1 parameter. M572: Set or report extruder pressure advancePrusa Buddy firmware specific1 Parameters Dnnn Extruder number Tnnn Extruder number (not supported yet)1 Snnn Pressure advance amount (in seconds) Snnn Set the pressure advance value. Range is 0. to 1.0 seconds. If zero the pressure advance is disabled.1 Wnnn Set a time range in seconds used for calculating the average extruder velocity for pressure advance. Range between 0. and 0.2 Default value is 0.04.1 Example M572 D0 S0.1 M572 S0.05 1 This sets the pressure advance coefficient (S parameter) for the specified extruder (D parameter). Pressure advance causes the extruder drive position to be advanced or retarded during printing moves by an additional amount proportional to the rate of extrusion. At the end of a move when the extrusion rate is decreasing, this may result in the extruder drive moving backwards (i.e. retracting). Therefore, if you enable this feature, you may need to reduce the amount of retraction you use in your slicing program to avoid over-retraction. With Bowden extruders, an S value between 0.1 and 0.5 usually gives the best print quality. Direct drive extruders typically work best with lower values such as 0.05. Older versions of RepRapFirmware used the P parameter to specify the drive number, instead of using D to specify the extruder number. M573: Report heater PWMParameters Pnnn Heater number Example M573 P1 This gives a running average (usually taken over about five seconds) of the PWM to the heater specified by the P field. If you know the voltage of the supply and the resistance of the heater this allows you to work out the power going to the heater. Scale: 0 to 1. In RepRapFirmware 3.3.0 and later the heater PWM can be queried from the Object Model instead. M574: Set endstop configurationParameters Xnnn Switch position for X axis Ynnn Switch position for Y axis Znnn Switch position for Z axis Snnn Endstop type: 0 active low endstop input, 1 active high endstop input, 2 Z probe, 3 motor load detection Example M574 X1 Y2 Z0 S1 ; X endstop at low end, Y endstop at high end, no Z endstop, all active high This defines the position of endstop sensor that the printer has for each axis: 0 none, 1 low end, 2 high end. The optional S parameter defines whether the endstop input is active high (S1, the default), low (S0), or the axes listed use the Z probe for homing that axis (S2), or motor stall detection (S3). A normally-closed endstop switch wired in the usual way produces an active high output (S1). If different axes use different types of endstop sensing, you can use more than one M574 command. On delta printers the XYZ parameters refer to the towers, and the endstops should normally all be high end (i.e. at the top of the towers). The S2 and S3 options are supported in RepRapFirmware 1.20 and later. In RepRapFirmware 1.16 and earlier, the M574 command with E parameter was used to specify whether a Z probe connected to the E0 endstop input produces an active high (S1) or active low (S0) output. In RepRapFirmware 1.17 and later, use the I parameter of the M558 command instead. M575: Set serial comms parametersParameters Pnnn Serial channel number Bnnn Baud rate (optional) Snnn Protocol (optional) Example M575 P1 B57600 S1 This sets the communications parameters of the serial comms channel specified by the P parameter. P0 specifies the main serial interface (typically a USB port, or serial-over-USB), while P1 specifies an auxiliary serial port (for example, the port used to connect a PanelDue) and P2 specifies a second auxiliary port if there is one. The B parameter is the required baud rate (this parameter is typically ignored if the port is a true USB port). The S parameter is a bitmap of protocol features. Bit 0 if set specifies that only commands that include a valid checksum or CRC should be accepted from this comms channel. Bit 1 if set specifies that responses should be sent in raw mode (default is to send them as JSON). Bit 2 if set specifies that only commands with a valid CRC should be accepted (this overrides bit 0). If either the B or the S parameter is missing, the previous value will be retained, or a default used if the port has not previously been configured using M575. If both are missing then the existing values are reported. M576: Set SPI comms parametersParameters Snnn Maximum delay between full SPI transfers (in ms, defaults to 25ms) Fnnn Maximum delay between full SPI transfers when a file is open (in ms, defaults to 5ms) Pnnn Number of events required to skip the delay (defaults to 4) Example M576 S10Â ; set data exchange interval to 10ms This sets the communications parameters of the SPI channel. Supported in RRF 3.4 and later in SBC mode. M577: Wait until endstop is triggeredParameters Snnn Desired endstop level Xnnn Select X axis endstop Ynnn Select Y axis endstop Znnn Select Z axis endstop Ennn Select extruder drive endstop Example M577 E0 S1 Wait for an endstop switch to be pressed. The example above will wait until the first extruder endstop is triggered. The following trigger types may be used using the â€˜Sâ€™ parameter: 0: Endstop not hit 1: Low endstop hit 2: High endstop hit 3: Near endstop (only Z probe) M578: Fire inkjet bitsParameters Pnnn Inkjet head number Snnn Bit pattern Example M578 P3 S5 This fires inkjet head 3 (the P field) using the bit pattern specified by the S field. The example shown would fire bits 101. If the P parameter is ommitted inkjet 0 is assumed. This is a version of the M700 command used by the Inkshield, but unfortunately M700 is already taken so cannot be used for that in the standard. M579: Scale Cartesian axesParameters Xnnn Scale factor for X axis Ynnn Scale factor for Y axis Znnn Scale factor for Z axis Example M579 X1.0127 Y0.998 On a Cartesian RepRap you can get prints exactly the right size by tweaking the axis stepsmm using the M92 G Code above. But this does not work so easily for Delta and other RepRaps for which there is cross-talk between the axes. This command allows you to adjust the X, Y, and Z axis scales directly. So, if you print a part for which the Y length should be 100mm and measure it and find that it is 100.3mm long then you set Y0.997 ( 100100.3). M580: Select RolandParameters Rnnn Whether Roland mode should be activated Pnnn Initial text to send to the Roland controller Example M580 R1 PVS4;!VZ2;!MC1; This is not really anything to do with RepRap, but it is convenient. The little Roland mills are very widely available in hackerspaces and maker groups, but annoyingly they donâ€™t speak G Codes. As all RepRap firmware includes a G-Code interpreter, it is often easy to add functions to convert G Codes to Roland RML language. M580 selects a Roland device for output if the R field is 1, and returns to native mode if the R field is 0. The optional P string is sent to the Roland if R is 1. It is permissible to call this repeatedly with R set to 1 and different strings in the P field to communicate directly with a Roland. M581: Configure external triggerParameters Tnn Logical trigger number to associate the endstop input(s) with, from zero up to a firmware-specific maximum (e.g. 9 for RepRapFirmware) X, Y, Z, E Selects endstop input(s) to monitor P Reserved, may be used in future to allow general IO pins to cause triggers S Whether trigger occurs on a rising edge of that input (S1, default), falling edge (S0), or ignores that input (S-1). By default, all triggers ignore all inputs. C Condition: whether to trigger at any time (C0, default) or only when printing a file from SD card (C1) Example M581 E1:2 S1 T2 C1 ; invoke trigger 2 when a rising edge is detected on the E1 or E2 endstop input and a file is being printed from SD card When M581 is executed, if the T parameter is present but the other parameters are omitted, the trigger inputs and edge polarities for that trigger number are reported. Otherwise, the specified inputs and their polarities are added to the conditions that cause that trigger. Using S-1 with no X, Y, Z or E parameters sets the trigger back to ignoring all inputs. In RepRapFirmware, trigger number 0 causes a full (emergency) stop as if M112 had been received. Trigger number 1 causes the print to be paused as if M25 had been received. Any trigger number # greater then 1 causes the macro file sys/trigger#.g to be executed. Polling for further trigger conditions is suspended until the trigger macro file has been completed. RepRapFirmware does not wait for all queued moves to be completed before executing the macro, so you may wish to use the M400 command at the start of your macro file. If several triggers are pending, the one with the lowest trigger number takes priority. M582: Check external triggerParameters T Trigger number to poll Example M582 T2Â ; check levels of inputs that give rise to trigger #2 Triggers set up by the M581 command are normally activated only when the specified inputs change state. This command provides a way of causing the trigger to be executed if the input is at a certain level. For each of the inputs associated with the trigger, the trigger condition will be checked as if the input had just changed from the opposite state to the current state. For example, if you use M581 to support an out-of-filament sensor, then M582 allows you to check for out-of-filament just before starting a print. M584: Set drive mappingParameters Xnnn Driver number(s) for X motor(s) Ynnn Driver number(s) for Y motor(s) Znnn Driver number(s) for Z motor(s) U,V,W, A, B, Cnnn Driver number(s) for additional axes U, V, W, A, B and C (UVW RepRapFirmware 1.16 and later; ABC RepRapFirmware 1.19 and later) Ennn Driver number(s) for E motor(s) Pnnn Number of visible axes, defaults to the total number of axes configured. Example M584 X0 Y1 Z2:3 E4:5:6Â ; Driver 0 controls the X motor, 1 controls Y, 2 and 3 control Z motors, 4 and 5 control E motors Assigning a drive using M584 does not remove its old assignment. Therefore, if you assign a drive that defaults to being an extruder drive, you should also assign the extruder drives explicitly as in the above example. Failure to do so may result in unexpected behaviour. You can use M584 to create additional axes - for example, to represent additional carriages on a machine with multiple independent X carriages. Additional axes must be created in the order UVWABC. You can hide some of the last axes you create using the P parameter. Hidden axes have no homing buttons or jog controls in the user interface. On the Duet WiFi and Duet Ethernet, if you configure multiple drivers for an axis, either all of them must be TMC2660 drivers on the Duet or a Duet expansion board, or none of them must be. This is to facilitate dynamic microstepping and other features of the TMC2660. M585: Probe ToolIn machines with a tool probe this probes the currently selected tool against it and corrects the offsets set by the G10 command (q.v.). Parameter must be only one of Xnnn Y-nnn Znnn Where the absolute value of nnn is the radius of the tool plus the radius of the probe in that direction. So M585 X1.5 will set the X offset of a 1mm diameter tool against a 2mm diameter probe, etc. If the value of nnn is positive the tool is moved in the positive direction towards the probe until it touches. If it is negative, the tool moves the other way. So the process should be: Set the values as closely as known in the G10 command. Move to a position slightly offset from the probe then execute M585s in X, Y and Z in the tool selection macro to set them precisely. After this, the G10 command on its own can be used to report the values. M586: Configure network protocolsParameters Pnn Protocol: 0 HTTP or HTTPS, 1 FTP or SFTP, 2 Telnet or SSH, 3 - multicast discovery protocol (RepRapFirmware 3.4 and later), 4 MQTT (RepRapFirmware 3.5 and later) (where two choices are given, which one depends on the T parameter) Snn 0 disable this protocol, 1 enable this protocol Rnn TCP port number to use for the specified protocol. Ignored unless S 1. If this parameter is not provided then the default port for that protocol and TLS setting is used. Tnn 0 donâ€™t use TLS, 1 use TLS. Ignored unless S 1. If this parameter is not provided, then TLS will be used if the firmware supports it and a security certificate has been configured. If T1 is given but the firmware does not support TLS or no certificate is available, then the protocol will not be enabled and an error message will be returned. Csite Set or reset allowed site for cross-orgin HTTP requests (RRF 3.2-b4.1) M586 with no S parameter reports the current support for the available protocols. RepRapFirmware 1.18 and later enable only HTTP (or HTTPS if supported) protocol by default. If you wish to enable FTP andor Telnet, enable them using this command once or twice in config.g. M586.4: Configure MQTT serverParameters Uâ€usernameâ€ The name to use when logging on to the MQTT server Kâ€passwordâ€ The password to use when logging on to the MQTT server (only valid if the U parameter is also present) Câ€client-idâ€ The client ID to use Wâ€will-messageâ€ The will-message to use Tâ€topicâ€ The topic name to use (only processed if the W parameter is also present) Sâ€subscriptionâ€ The subscription name to use Qnn The quality of service to use, 0 to 2 (only processed if the S parameter is also present) Pâ€publishâ€ Publish the topic if this is set Rn 1 retain, 0 do not retain (only processed if the P parameter is used) Dn 1 duplicate, 0 donâ€™t duplicate (only processed if the P parameter is used) [To be completed] M587: Store WiFi host network in list, or list stored networksParameters Sccc Network SSID Pccc Network password Inn.nn.nn.nn (optional) IP address to use when connected to this network. If zero or not specified then an IP address will be acquired via DHCP. Jnn.nn.nn.nn (optional) Gateway IP address to use when connected to this network. Knn.nn.nn.nn (optional) Netmask to use when connected to this network Lnn.nn.nn.nn (optional, supported only by DuetPi + DSF v3.3 or newer) DNS server to use Cnnn (supported only by DuetPi + DSF v3.3 or newer) Country code for the WiFi adapter, only required if not set before If a password or SSID includes space or semicolon characters then it must be enclosed in double quotation marks. For security, do not use this command in the config.g file, or if you do then remove it after running it once so that the network password is not visible in the file. M587 with no parameters lists all stored SSIDs, but not the stored passwords. M588: Forget WiFi host networkParameters Sccc SSID to remove from the networks list The specified SSID will be removed from the networks list and the associated password cleared out of EEPROM. If the SSID is given as * then all stored networks will be forgotten. M589: Configure access point parametersParameters Sccc The SSID that the WiFi interface should use when it is commanded to run as an access point Pccc The WiFi password Inn.nn.nn.nn The IP address to use Note: WPA2 security will be used by default. M590: Report current tool type and indexReport the current tool type, which may be â€œExtruder,â€ â€œPicker,â€ â€œLaser,â€ â€œFoam Cutter,â€ â€œMilling,â€ or any others implemented by the machine. Also report the tool index, such as â€œ0x01â€ for the second extruder. Example M590 echo: Extruder 0x00 M591: Configure filament monitoringThis configures filament sensing for the specified extruder. The sensor may be a simple filament presence detector, or a device that measures movement of filament, or both. The action on detecting a filament error is firmware-dependent, but would typically be to run a macro andor to pause the print and display a message. Parameters Cnn Which input the filament sensor is connected to. On Duet electronics: 0X endstop input, 1Y endstop input, 2Z endstop input, 3E0 endstop input etc. Dnn Extruder drive number (0, 1, 2â€¦), Pnn Type of sensor: 0none, 1simple sensor (low signal when filament present), 2simple sensor (high signal when filament present), 3Duet3D rotating magnet sensor, 4Duet3D rotating magnet sensor with microswitch,Â :Snn S0 disable filament monitoring, S1 enable filament monitoring. Calibration data may be collected while printing even when filament monitoring is disabled. 5Duet3D laser filament monitor, 6Duet3D laser filament monitor with microswitch, 7pulse-generating sensor Additional parameters for Duet3D laser filament monitor Raa:bb Allow the filament movement reported by the sensor to be between aa% and bb% of the commanded values; if it is outside these values and filament monitoring is enabled, the print will be paused Enn minimum extrusion length before a commandedmeasured comparison is done, default 3mm Additional parameters for Duet3D rotating magnet filament monitor Lnn Filament movement per complete rotation of the sense wheel, in mm R, E As for Duet3D laser filament monitor Additional parameters for a pulse generating filament monitor Lnn Filament movement per pulse in mm R, E As for Duet3D laser filament monitor Examples M591 D0 C3 P5 S1 R70:130 L24.8 E6.0 ; Duet3D laser sensor for extruder drive 0 is connected to E0 endstop input, 24.8mmrev, 70% to 130% tolerance, 6mm detection length M591 D1 ; display filament sensor parameters for extruder drive 1 Note: RepRapFirmware 1.19 and 1.20 also supported filament monitors via M591, but some of the parameters were different. M592: Configure nonlinear extrusionParameters Dnn Extruder drive number (0, 1, 2â€¦) Annn A coefficient in the extrusion formula, default zero Bnnn B coefficient in the extrusion formula, default zero Lnnn Upper limit of the nonlinear extrusion compensation, default 0.2 T nnn Reserved for future use, for the temperature at which these values are valid Example M592 D0 A0.01 B0.0005Â ; set parameters for extruder drive 0 M592 D0Â ; report parameters for drive 0 Most extruder drives use toothed shafts to grip the filament and drive it through the hot end. As the extrusion speed increases, so does the back pressure from the hot end, and the increased back pressure causes the amount of filament extruded per step taken by the extruder stepper motor to reduce. This may be because at high back pressures, each tooth compresses and skates over the surface of the filament for longer before it manages to bite. See forum post http://forums.reprap.org/read.php?262,802277 and the graph at http://forums.reprap.org/file.php?262,file=100851,filename=graph.JPG for an example. Nonlinear extrusion compensates for this effect. The amount of extrusion requested is multiplied by (1 + MIN(L, A*v + B*v^2)) where v is the requested extrusion speed (calculated from the actual speed at which the move will take place) in mmsec. Nonlinear extrusion is not applied to extruder-only movements such as retractions and filament loading. M593: Configure Input ShapingNote: RepRapFirmware 2.02 thru 3.2 implemented a primitive form of input shaping called Dynamic Acceleration Adjustment, supporting just the F parameter. This support has been replaced in RRF 3.4 and later by the more sophisticated forms of input shaping described here. Parameters Pâ€typeâ€ Type of input shaping to use, not case sensitive. RRF 3.4 supports â€œnoneâ€, â€œzvdâ€, â€œzvddâ€, â€œzvdddâ€, â€œmzvâ€, â€œei2â€, â€œei3â€ and â€œcustomâ€. RRF 3.3 supports â€œnoneâ€ or â€œdaaâ€, and if no P parameter is given but the F parameter is given then â€œdaaâ€ is assumed for compatibility with previous releases. Fnnn Centre frequency of ringing to cancel in Hz Snnn (optional) Damping factor of ringing to be cancelled, default 0.1. Lnnn (optional) Minimum acceleration allowed, default 10mmsec^2. Input shaping will not be applied if it requires the average acceleration to be reduced below this value. Hnn:nnâ€¦ Amplitudes of each impulse except the last, normally below 1.0. Only used with Pâ€customâ€ parameter. Tnn:nn Durations of each impulse except the last. Only used with Pâ€customâ€ parameter. Prusa-Buddy Parameters1 X Set the input shaper parameters only for the X axis. Also in Marlin 2.x2 Y Set the input shaper parameters only for the Y axis. Also in Marlin 2.x2 W Write current input shaper settings to EEPROM. Dnnn Set damping ratio. Range 0 to 1. Also in Marlin 2.x2 Fnnn Set frequency. Greater or equal to 0. Also in Marlin 2.x2 Tn Set type. Range 0 to 5. Rnnn Set vibration reduction. Greater than 0. Examples (RRF 3.4 and later) M593 Pâ€zvdâ€ F40.5Â ; use ZVD input shaping to cancel ringing at 40.5Hz M593 Pâ€noneâ€ ; disable input shaping M593 Pâ€customâ€ H0.4:0.7 T0.0135:0.0135Â ; use custom input shaping Examples (RRF 3.3) M593 Pâ€daaâ€ F40.5Â ; use DAA to cancel ringing at 40.5Hz M593 Pâ€noneâ€ ; disable DAA Examples (Prusa-Buddy) M593 X T2 F50.7 M593 Y T2 F40.6 Input shaping is most useful to avoid exciting low-frequency ringing, for which S-curve acceleration is ineffective and may make the ringing worse. High-frequency ringing would be better countered by using S-curve acceleration; however, low-frequency ringing is more of a problem in most 3D printers. The ringing frequencies are best measured using an accelerometer, for which support is provided in RRF 3.3 and later. Alternatively, take a print that exhibits ringing on the perimeters (for example a cube), preferably printed single-wall or external-perimeters-first. Divide the speed at which the outer perimeter was printed (in mmsec) by the distance between adjacent ringing peaks (in mm). When measuring the distance between peaks, ignore peaks close to the corner where the ringing started (these peaks will be spaced more closely because the print head will have been accelerating in that area). Cartesian and CoreXY printers will typically have different frequencies of ringing for the X and Y axes. Note that X axis ringing causes artefacts predominantly on the Y face of the test cube, and vice versa. The more advanced forms of input shaping reduce ringing over a wide range of frequencies (for example EI3 covers a range of about 3:1) so that for printers that exhibit significant ringing on both X and Y axes, it is normally possible to choose a shaper that cancels both. High X and Y jerk values reduce the effectiveness of input shaping; therefore you should set the X and Y jerk limits only as high as necessary to allow curves to be printed smoothly. M594: EnterLeave Height Following modeParameters Pn P1 enter height following mode, P0 leave height following mode Height following mode allows the Z position of the tool to be controlled by a PID controller using feedback from a sensor. See also M951. If a movement command (e.g. G1) explicitly mentions the Z axis while height following mode is active, existing moves in the pipeline will be allowed to complete and the machine allowed to come to a standstill. Then height following mode will be terminated and the new move executed. M595: Set movement queue lengthParameters Pnn Maximum number of moves held in the movement queue. RepRapFirmware uses this value to determine how many DDA objects to allocate. Snn (optional) Number of pre-allocated per-motor movement objects. If the number of pre-allocated objects is insufficient, RepRapFirmware will attempt to allocate additional omnes dynamically when they are needed. Different features of motion control firmware may have competing demands on microcontroller RAM. In particular, operations that use many short segments (e.g. laser rastering) need longer movement queues than typical 3D printing, but have fewer motors to control. This command allows the movement queue parameters to be adjusted so that the queue can be lengthened if necessary, or kept short if a long movement queue is not needed and there are other demands on RAM. M595 without any parameters reports the length of the movement queue and the number of per-motor movement objects allocated. M596: Select movement queue numberParameters Pnn Movement queue number. Queues are numbered 0 (the default queue), 1, â€¦ This command is supported in RepRapFirmware builds that can execute moves on different axis systems asynchronously, for example for concurrent printing of two or more different objects. It specifies that subsequent GCode commands from this input channel should be routed to the specified movement queue and the tool associated with that queue. The number of available queues is firmware-dependent but will typically be 2. Before using a movement queue other than queue 0 it may be necessary to use M595 to increase the length of that queue, because the default length of movement queues other than the primary one may be quite short. At the start of a file print, queue 0 is selected automatically. If M596 is used without the P parameter, it reports the current motion system number for the input channel that the command was received on. M597: Collision avoidanceParameters X,Yâ€¦aaa First axis identifier and value U,Vâ€¦bbb Second axis identifier and value Example M597 V0 Y23.5 This configuration command is intended for use in systems having multiple tool heads that can be moved independently and asynchronously. The axis letters must be different from each other, so must the values of aaa and bbb. Normally, aaa will be zero and bbb will be positive. The command specifies that the machine position of the axis with the higher value must always be at least the difference in values greater than the position of the other axis. In the above example, the position of the Y axis must always be at least 23.5mm greater than the position of the V axis. When Y and V are driven by independent motion systems and executing moves independently, in any block of GCode between synchronisation points, using this example the minimum of all Y coordinates inside the block (including the initial Y coordinate) must be at least 23.5mm greater than the maximum of the all V coordinates inside the block. If this is not the case, the job will be aborted prior to starting the first move that would cause the conflict. M598: Sync motion systemsThis command has no parameters. It is for systems having multiple motion systems that can be moved independently and asynchronously. It is only valid within a job file. It causes the file reader for each motion system to wait at this instruction until all the file readers have reached it and all moves queued for any motion system have been completed. Example M598 ; wait until all motion systems have finished working on this layer G1 Z0.8 ; change Z for next layer M599: Define keepout zoneParameters Pn Keepout zone number, default 0 Sn (optional) S1 activate keepout zone (default if any axes are specified), S0 deactivate keepout zone X,Yâ€¦aaa:bbb Axis identifier and limits for that axis Example M599 X10:25 Y0:20 This command establishes a â€œno entryâ€ zone for the toolhead reference point. If any G0G1G2G3 move attempts to move the toolhead reference point inside the no entry zone, the job will be aborted with an error message. You may specify any number of axes, up to the number that the machine has. If no axes are specified and the S parameter is not provided then the parameters and enableddisabled state of the existing keepout zone will be reported. Movement commands (G0, G1, G2 and G3) will normally be checked before starting the move. The number of keepout zones supported is implementation dependent. It may be just one. M600: Set line cross sectionExample M600 P0.061 Sets the cross section for a line to extrude in velocity extrusion mode. When the extruder is enabled and movement is executed the amount of extruded filament will be calculated to match the specified line cross section. M600: Filament change pausePause for filament change. Parameters X[pos] Y[pos] Z[relative lift] E[initial retract] L[later retract distance for removal] AUTO Automatically (only Prusa Firmware with MMU connected)1 N (no return) Donâ€™t return to the previous position after filament change Example M600 In SmoothieWare: The variable â€œafter_suspend_gcodeâ€ is run after M600. For example: after_suspend_gcode G91_G0E-5_G0Z10_G90_G0X-50Y-50 # gcode to run after suspend, retract then get head out of way In RepRapFirmware, M600 causes macro file filament-change.g to be run if it exists, otherwise it falls back to pause.g. The parameters in the M600 command are ignored. Notes In Prusa Firmware this command is also used when the Filament Runout Sensor triggers. To prevent filament blobs it will raise to 25 mm if it has been triggered below 25 mm layer height. Default are X211 mm, Y0 mm, Z2 mm, E-2 mm, L-80 mm1 M601: Pause printWithout any parameters it will park the extruder to default or last set position. The default pause position will be set during power up and a reset, the new pause positions arenâ€™t permanent. Usage M601 [ X | Y | Z | S ] 2 Parameters X X position to park 2 Y Y position to park 2 Z Z raise before park 2 S Set values [S0 set to default values | S1 set values] without pausing 2 2Prusa Firmware equivalent to M25 and M125 M602: Resume printResumes print on Prusa i3 MK2s,MK2.5s,MK3s. M603: Stop print (Prusa i3)Stop print on Prusa i3 MK2s, MK2.5s, and MK3s. M603: Configure Filament ChangeThis command configures Filament Change behavior in Marlin Firmware and in Prusa mini firmware under development. Parameters T[toolhead] Select extruder to configure, active extruder if not specified (not used yet) U[distance] Retract distance for removal, for the specified extruder. L[distance] Extrude distance for insertion, for the specified extruder. M605: Set dual x-carriage movement modeSet Dual X-Carriage movement mode. Parameters S[mode] Mode (see below) X[duplication x-offset] Optional X offset for Mode 2 R[duplication temp offset] Optional temperature difference for Mode 2 Example M605 S1Â ; Set mode to auto-park M605 S0: Full control mode. The slicer has full control over x-carriage movement M605 S1: Auto-park mode. The inactive head will auto parkunpark without slicer involvement M605 S2 [Xnnn] [Rmmm]: Duplication mode. The second extruder will duplicate the first with nnn millimeters x-offset and an optional differential hotend temperature of mmm degrees. E.g., with â€œM605 S2 X100 R2â€œ the second extruder will duplicate the first with a spacing of 100mm in the x direction and 2 degrees hotter. RepRapFirmware does not implement M605 because it supports dual carriage mode, duplication mode, auto park, different temperatures etc. using the M563 tool definition command and the tool change macro files. M606: Fork input file readerParameters S[mode] Mode, must be 1 (other values are reserved for future use). Example M606 S1Â ; Fork input reader This command is only supported on firmware configurations that support two or more motion systems that execute asynchronously with respect to each other. If the S1 parameter is present and the command occurs within a job from SD card or other storage media, it causes the input stream to be forked. From that point on, each motion system can read and execute commands from the job file independently of other motion systems. In consequence, when the movement queue of one motion system becomes full, or one motion system is waiting for a tool change or other action to complete, the other motion system(s) can still read and execute commands. In the event that this command is executed from a job file when the input stream has already been forked, it is ignored. If the S1 parameter is present and the command is used from an input channel other than a file stream then a warning is issued but it is otherwise ignored. If this command is run without the S parameter then the firmware just reports whether a job is being run from storage media, and if so whether the input stream for that media has been forked. See also the M596 command that selects a motion system, and the M598 command which is used to synchronise forked input streams at particular point in the file. M650: Set peel move parametersThis command is sent by nanoDLP to set the parameters for the peel move used after curing a layer. RepRapFirmware 2.02 ignores it. If using RepRapFirmware 2.03 or later you can create a empty file M650.g to cause it to be ignored. M651: Execute peel moveThis command is sent by nanoDLP to execute a peel move after curing a layer. RepRapFirmware 2.02 executes macro syspeel-move.g in response to this command. For RepRapFirmware 2.03 and later, create a macro file M651.g containing the commands required to execute the peel move. M655: Send request to custom CAN-connected expansion boardParameters Bnn CAN address of target board Cnn.string Reduced string parameter, for example CAN address and port name Astring Normal string parameter Pnnn Unsigned integer parameter, maximum 65535 R, S Signed integer parameters E, F Floating point parameters Examples M655 B10 Chello world P1 R-4 E0.123M655 C10:pump P0 S22 F42.1 This command allows standard main board firmware builds to control features on custom CAN-connected expansion boards in situations where standard commands such as M950 and M42 are not suitable, for example because they do not provide sufficient parameters. The main board firmware expects to receive a standard reply to it. All parameters are optional, except that exactly one of B or C must be present. The C parameter if present must start with the CAN address of the target board followed by a period. It will be â€œreducedâ€ by removing this prefix and any underscores or hyphens and converting all characters to lowercase before sending the request to the target board. The total number of bytes occupied by the parameters provided, excluding the B parameter and after reducing the C parameter, must not exceed 60. The number of bytes in a string parameter is the number of bytes in the UTF8-encoded string plus 1. The P parameter occupies 2 bytes and the signed integer and float parameters occupy 4 bytes each. M665: Set delta configurationParameters Lnnn Diagonal rod length Rnnn Delta radius Snnn Segments per second1 Bnnn Safe probing radius2,3 Hnnn Delta height defined as nozzle height above the bed when homed after allowing for endstop corrections 2 Xnnn X tower position correction2,4 Ynnn Y tower position correction2,4 Znnn Z tower position correction2,4 Annn X tower diagonal rod trim.1 (Marlin 2.0.6+) Bnnn Y tower diagonal rod trim.1 (Marlin 2.0.6+) Cnnn Z tower diagonal rod trim.1 (Marlin 2.0.6+) Examples M665 L250 R160 S200Â ; (Marlin)M665 L250 R160 B80 H240 X0 Y0 Z0Â ; (RepRapFirmware and Marlin 1.1.0) Set the delta calibration variables. (See the discussion page for notes on this implementation.) Notes 1Only supported on Marlin. 2Only supported in RepRapFirmware and Marlin 1.1.0. 3 In Marlin 1.1.0 sets the radius on which the probe points are taken for the delta auto calibration routine G33 as well as for the manual LCD calibration menu. 4X, Y and Z tower angular offsets from the ideal (i.e. equilateral triangle) positions, in degrees, measured anti-clockwise looking down on the printer. In Marlin 1.1.0 X,Y and Z tower angular offsets will be rotated so the Z tower angular offset is zero. M666: Set delta endstop adjustmentParameters Xnnn X axis endstop adjustment Ynnn Y axis endstop adjustment Znnn Z axis endstop adjustment Annn X bed tilt in percent1 Bnnn Y bed tilt in percent1 Example M666 X-0.1 Y+0.2 Z0 Sets delta endstops adjustments. In RepRapFirmware and Repetier, positive endstop adjustments move the head closer to the bed when it is near the corresponding tower. In Marlin and Smoothieware, negative endstop corrections move the head closer to the bed when it is near the corresponding tower. In Marlin, only negative endstop corrections are allowed. From version 1.1.0 onward positive endstops are allowed to be entered but the endstops will be normalized to zero or negative and the residue will be subtracted from the delta height defined in M665. In Repetier the endstop corrections are expressed in motor steps. In other firmwares they are expressed in mm. 1RepRapFirmware 1.16 and later. M667: Select CoreXY modeParameters Snnn CoreXY mode Xnnn X axis scale factor (RepRapFirmware 2.02 and earlier) Ynnn Y axis scale factor (RepRapFirmware 2.02 and earlier) Znnn Z axis scale factor (RepRapFirmware 2.02 and earlier) Example M667 S1 M667 S0 selects Cartesian mode (unless the printer is configured as a delta using the M665 command). Forward motion of the X motor moves the head in the +X direction. Similarly for the Y motor and Y axis, and the Z motor and Z axis. This is the default state of the firmware on power up. M667 S1 selects CoreXY mode. Forward movement of the X motor moves the head in the +X and +Y directions. Forward movement of the Y motor moves the head in the -X and +Y directions. M667 S2 selects CoreXZ mode. Forward movement of the X motor moves the head in the +X and +Z directions. Forward movement of the Z motor moves the head in the -X and +Z directions. RepRapFirmware 2.03 and earlier support additional parameters X, Y and Z may be given to specify factors to scale the motor movements by for the corresponding axes. For example, to specify a CoreXZ machine in which the Z axis moves 13 of the distance of the X axis for the same motor movement, use M667 S2 Z3. The default scaling factor after power up is 1.0 for all axes. In RepRapFirmware 2.03 and later, this functionality is moved to the movement matrix that you can define or alter using the M669 command. To change the motor directions, see the M569 command. M668: Set Z-offset compensations polynomialPolynomial compensation is an experimental method to compensate for geometric distortion of a delta machine Z-plane. After the bed is compensated with the set of G30 points, there remains error. This method fits a 6th degree polynomial with independent origins for each order to the residual error data (using a simulated annealing technique on the host). The polynomial is communicated and controlled through M668. Because the polynomial takes many floating point operations to compute each point, the firmware builds a grid of values, and used bi-linear interpolation to adjust the actual Z-axis offset error estimate. For the polynomial used, 40 parameters are specified. The I parameter allows the coefficients to be loaded a few at a time, which limits the size of the G-code string. The index starts with 1, not with 0. M668 Ix S[list of values] sets the polynomial parameters starting at index x, if index present andÂ ! 0. M668 R recomputes the grid based on the current parameters. M668 P[0|1] turns off or on the polynomial compensation. Typical usage M668 I1 S4.882E-17:0.0M668 I3 ......M668 R P1 Which sets the list, computes the interpolation grid, and then enables compensation. M669: Set kinematics type and kinematics parametersParameters Knnn Kinematics type: 0 Cartesian, 1 CoreXY, 2 CoreXZ, 3 linear delta, 4 serial SCARA, 5 CoreXYU, 6 Hangprinter, 7 polar, 8 CoreXYUV, 9 linear delta + Z axis, 10 rotary delta, 11 MarkForged, 12 reserved for Collinear Tripteron Selects the specified kinematics, then uses the other parameters to configure it. If the K parameter is missing then the other parameters are used to update the configuration data for the current kinematics. If no parameters are given then the current kinematics and configuration parameters are reported Parameters for generalised Cartesian kinematics (including CoreXY, CoreXZ, MarkForged, CoreXYU etc.) Xnnn, Ynnn, Znnn, Unnn etc. (optional) Movement matrix coefficients. For example. X1:-1:0 tells the firmware that to move the X axis one unit, the first motor must be moved 1 unit in the forwards direction, the second motor 1 unit in the reverse direction, and the third motor not at all. Using these coefficients, you can specify the kinematics equations for any printer with up to 10 axes for which the movement of each axis is a linear combination of the movements of the individual motors. If these parameters are omitted, the defaults for the specified kinematics (K parameter) will be used. Parameters for serial SCARA kinematics Pnnn Proximal arm length (mm) Dnnn Distal arm length (mm) Annn:nnn Proximal arm joint movement minimum and maximum angles, in degrees anticlockwise seen from above relative to the X axis Bnnn:nnn Proximal-to-distal arm joint movement minimum and maximum angles, in degrees anticlockwise seen from above relative to both arms in line Cnnn:nnn:nnn Crosstalk factors. The first component is the proximal motor steps to equivalent distal steps factor, the second is the proximal motor steps to equivalent Z motor steps factor, and the third component is the distal motor steps to equivalent Z motor steps factor. Snnn Segments per second if smooth XY motion is approximated by means of segmentation Tnnn Minimum segment length (mm) if smooth XY motion is approximated by means of segmentation Xnnn X offset of bed origin from proximal joint Ynnn Y offset of bed origin from proximal joint Examples M669 K4 P300 D250 A-90:90 B-135:135 C0:0:0 S200 X300 Y0 The minimum and maximum arm angles are also the arm angles assumed by the firmware when the homing switches are triggered. The P, D, A and B parameters are mandatory. The C and F parameters default to zero, and the segmentation parameters default to firmware-dependent values. Parameters for Polar kinematics Raaa:bbb Minimum and maximum radius in mm. If only one value it given it will be used as the maximum radius, and the minimum radius will be assumed to be zero. Hnnn Radius in mm at which the homing switch is triggered during a homing move. If this parameter is not present, the homing switch is assumed to trigger at the minimum radius. Fnnn Maximum turntable speed in degrees per second Annn Maximum turntable acceleration in degrees per second per second Snnn, Tnnn As for serial SCARA kinematics M670: Set IO port bit mappingParameters Pnn:nn:nnâ€¦ List of logical port numbers that bits 0, 1, 2â€¦ control Tnnn port switching time advance in milliseconds RepRapFirmware 1.19 and later provides an optional P parameter on the G1 command to allow IO ports to be set to specified states for the duration of the move. The argument to the P parameter is a bitmap giving the required state of each port. The M669 command specifies the mapping between the bits of that argument and logical port numbers. Optionally, the T parameter can be used to advance the IO port switching a short time before the corresponding move begins. M671: Define positions of Z leadscrews or bed leveling screwsParameters Xnn:nn:nnâ€¦ List of between 2 and 4 X coordinates of the leadscrews that drive the Z axis or the bed leveling screws Ynn:nn:nnâ€¦ List of between 2 and 4 Y coordinates of the leadscrews that drive the Z axis or the bed leveling screws Snn Maximum correction to apply to each leadscrew in mm (optional, default 1.0) Pnnn Pitch of the bed leveling screws (not used when bed leveling using independently-driven leadscrews). Defaults to 0.5mm which is correct for M3 bed leveling screws. Example M671 X-15.0:100.0:215.0 Y220.0:-20.0:220.0 ; Z leadscrews are at (-15,220), (100,-20) and (215,220) Informs the firmware of the positions of the leadscrews used to raiselower the bed or gantry. The numbers of X and Y coordinates must both be equal to the number of drivers used for the Z axis (see the M584 command). This allows the firmware to perform bed leveling by adjusting the leadscrew motors individually after bed probing. For machines without multiple independently-driven Z leadscrews, this command can be used to define the positions of the bed leveling screws instead. Then bed probing can be used to calculate and display the adjustment required to each screw to level the bed. The thread pitch (P parameter) is used to translate the height adjustment needed to the number of turns of the leveling screws. M672: Program Z probeParameters Snn:nn:nnâ€¦ Sequence of 8-bit unsigned values to send to the currently-selected Z probe Example M671 S50:205 This command is for sending configuration data to programmable Z probes such as the Duet3D delta effector. The specified command bytes are sent to the probe. The Duet3D probe stores the configuration data in non-volatile memory, so there is no need to send this command every time the probe is used. M673: Align plane on rotary axisParameters U,V,W,A,B,C Rotary axis letter on which the plane is mounted Pnnn Factor to multiply the correction angle (degrees) with (defaults to 1) Example M673 A This code is intended to align a plane that is mounted on a rotary axis. To make use of this code it is required to take two probe points via G30 P first. Supported in RepRapFirmware 2.02 and later. M674: Set Z to center pointThis code is intended to determine the Z center point of a stash that is mounted on a rotary axis. This code is yet to be implemented. M675: Find center of cavityParameters X,Y,Z Axis to probe on Fnnnn Probing feedrate Rnnn Distance to move away from the lower endstop before the next probing move starts Example M675 X R2 F1200 This code is intended to find the center of a cavity that can be measured using the configured axis endstop. If using a Z probe for this purpose, make sure the endstop type for the corresponding axis is updated before this code is run. Once this code starts, RepRapFirmware will move to the lower end looking for an endstop to be triggered. Once it is triggered, the lower position is saved and the axis maximum is probed. As soon as both triggers have been hit, the center point is calculated and the machine moves to the calculated point. M700: Level plateExample M700 Script to adjust the plate level. M701: Load filamentInitiate a filament load. This command can be used without any additional parameters. Parameters Snn Filament to load (RepRapFirmware) Tnn Tool to load (Marlin) Lnn Length to use for load (Marlin) Znn Z raise to perform (Marlin) With no parameters RepRapFirmware will report the name of the loaded filament (if any). Marlin Firmware initiates a Filament Load. Examples M701M701 SPLAÂ ; Only in RepRapFirmwareM701 T0 ; Only in Marlin. RepRapFirmware 1.19 and later implement a filament management mechanism to load and unload different materials. This code may be used to load a material for the active tool, however be aware that this code will work only for tools that have exactly one extruder assigned. When called RepRapFirmware willâ€¦ Run the macro file â€œload.gâ€ in the subdirectory of the given material (e.g. filamentsPLAload.g) Change the filament name of the associated tool, so it can be reported back to Duet Web Control M702: Unload filamentInitiate a filament unload. This command can be used without any additional parameters. In contrast to M701 this code is intended to unload the previously loaded filament from the selected tool. Parameters Tnn Tool to load (Marlin) Unn Length to use for unload (Marlin Prusa Firmware) Znn Z raise to perform (Marlin Prusa Firmware) Cnn Unload the (current) filament only if the MMU is used in Prusa Firmware till version 3.12.2 In response to M702 RepRapFirmware will do the following: Run the macro file â€œunload.gâ€ in the subdirectory of the given material (e.g. /filaments/PLA/unload.g) Change the filament name of the current tool, so it can be reported back to Duet Web Control Examples M702 ; Unload filament as previously configuredM702 U420 Z2Â ; Unload 420mm (Marlin Prusa Firmware) with a Z raise of 2mm M703: Configure Filament In RepRapFirmware this code is used to apply the configuration of a previously loaded filament (see M701). All it does is run /filaments/loaded filament/config.g which may contain codes to set parameters like extrusion factor, retraction distances and temperatures. If no filament is assigned to the current tool, this code will not generate a warning. If the filaments feature is used, it is recommended to put this code into tpost*.g to ensure the right filament parameters are set. Supported in RepRapFirmware 2.02 and newer. M704: Preload_to_MMUPreload filament to MMU can be used to manually load the filament into the MMU. The MMU will engage the slot and turn the MMU idler pulley until the filament is pushed to the FINDA. A second unloadload check ensures that the filament is preloaded correctly to the MMU. Usage M704 [P] Parameters Pnn Index of slot (zero based from 0 to 4) With no parameters Does nothing if the P parameter is not present or if MMU is not enabled. Examples M704 P0 ;Start preload procedure at slot 0 Supported on Prusa MK3S+ from firmware version 3.13.0 with MMU firmware 2.1.9 and newer. 1 Support for MK4 with MMU TBA2 M705: Eject filamentEject filament on MMU moves the selector away from the selected slot and pushes some mm of filament towards the front. This is useful to inspect the filament for indents and other issues. Attention: User interaction is needed to confirm on LCD or MMU button that the inspection, maintenance, â€¦ is done! Printer WILL NOT accept any other gcode. Usage M705 [P] Parameters Pnn Index of slot (zero based from 0 to 4) With no parameters Does nothing if the P parameter is not present or if MMU is not enabled. Examples M705 P0 ;Eject filament at slot 0 Supported on Prusa MK3S+ from firmware version 3.13.0 with MMU firmware 2.1.9 and newer. 1 Support for MK4 with MMU TBA2 M706: Cut filamentPreload filament to MMU can be used to manually load the filament into the MMU. The MMU will engage the slot and turn the MMU Idler pulley until the filament is pushed to the FINDA. A second unloadload check ensures that the filament is preloaded correctly to the MMU. Usage M706 [P] Parameters Pnn Index of slot (zero based from 0 to 4) With no parameters Does nothing if the P parameter is not present or if MMU is not enabled. Examples M706 P0 ;Cut filament at slot 0 Supported on Prusa MK3S+ from firmware version 3.13.0 with MMU firmware 2.1.9 and newer. 1 Support for MK4 with MMU TBA2 M707: Read from MMU registerReads the MMU register. Usage M707 [A] Parameters A0xnn Address of register in hexadecimal. With no parameters Does nothing if the A parameter is not present or if MMU is not enabled. Examples M707 A0x1b ;Read a 8bit integer from register 0x1b and prints the result onto the serial line. Supported on Prusa MK3S+ from firmware version 3.13.0 with MMU firmware 2.1.9 and newer. 1 Support for MK4 with MMU TBA2 M708: Write to MMU registerWrite to the MMU register. Usage M708 [A | X] Parameters A0xnn Address of register in hexadecimal. Xnnnn Data to write (16-bit integer). Default value 0. With no parameters Does nothing if the A parameter is not present or if MMU is not enabled. Examples M708 A0x1b X05 ;Write to register 0x1b the value 05. Supported on Prusa MK3S+ from firmware version 3.13.0 with MMU firmware 2.1.9 and newer. 1 Support for MK4 with MMU TBA2 M709: MMU power resetThe MK3S cannot not power off the MMU, but we can en- and disable the MMU and will be also stored in EEPROM. The new state of the MMU is stored in printerâ€™s EEPROM - i.e. if you disable the MMU via M709, it will not be activated after the printer resets. Usage M709 [S|X] Parameters Xnnnn Reset MMU (0:soft reset | 1:hardware reset | 42: erase MMU eeprom) Snnnn En-disable the MMU (0:off | 1:on) Examples M709 X0 ;issue an X0 command via communication into the MMU (soft reset) M709 X1 ;toggle the MMUâ€™s reset pin (hardware reset) M709 X42 ;erase MMU EEPROM M709 S1 ;enable MMU M709 S0 ;disable MMU M709 ;Serial message if en- or disabled 1 Supported on Prusa MK3S+ from firmware version 3.13.0 with MMU firmware 2.1.9 and newer. 1 Supported on Prusa MK4 from firmware version 5.1.0 with MMU firmware 3.0.1 and newer. 2 M710: Firmware dependentM710: Controller Fan settingsParameters With no parameters, report current settings. A[bool] Turn Auto Mode on or off. Snnn Set the Active Speed (0-255) used when motors are enabled. Innn Set the Idle Speed (0-255) used when motors are disabled. Dnnn Set the Idle Duration (seconds) to keep the fan running after motors are disabled. R Reset to defaults. Example M710 S200Â ; Set active fan speed to 200 M710: Erase the EEPROM and reset the boardThis command only exists in a defunct bq fork of Marlin Firmware. Example M710 M711: Calibrate pressure advanceM750: Enable 3D scanner extensionExample M750 This code may be used as an OEM extension to enable scanner functionality in the firmware. After a regular start of RepRapFirmware, the 3D scan extension is disabled by default, but if additional scanner components are attached, this code may be used to enable certain OEM functions. M751: Register 3D scanner extension over USBExample M751 When a 3D scanner board is attached to the USB port, this code is used to turn on communication between the 3D printing and the scanner board. If the USB connection is removed while the 3D scanner configuration is active, the firmware will disable it again and restore the default communication parameters. M752: Start 3D scanParameters Snnn: Lengthdegrees of the scan Rnnn: Resolution (new in RRF 2.0) [optional, defaults to 100] Nnnn: Scanner mode (new in RRF 2.0) [optional, 0Linear (default), 1Rotary] Pnnn: Filename for the scan Example M752 S300 Pmyscan Instruct the attached 3D scanner to initiate a new 3D scan and to upload it to the boardâ€™s SD card (i.e. in the â€œscansâ€ directory). Before the SCAN command is sent to the scanner, the macro file â€œscan_pre.gâ€ is executed and when the scan has finished, the macro file â€œscan_post.gâ€ is run. Be aware that both files must exist to avoid error messages. M753: Cancel current 3D scanner actionExample M753 Instruct the attached 3D scanner to cancel the current operation. Cancelling uploads is not supported. M754: Calibrate 3D scannerParameters Nnnn Calibration mode (0linear [default], 1rotary) Example M754 Calibrates the attached 3D scanner. Before the calibration is performed by the external scanner, â€œcalibrate_pre.gâ€ is run and when it is complete, â€œcalibrate_post.gâ€ is executed. M755: Set alignment mode for 3D scannerParameters Pnnn Whether to turn on ( 0) or off ( 0) the alignment feature Examples M755 P1M755 P0 Sends the ALIGN ONOFF command the attached 3D scanner. Some devices turn on a laser when this command is received. If the â€˜Pâ€™ parameter is missing, equal to, or less than 0, the alignment feature is turned off. Depending on whether the alignment is turned on or off, either align_on.g or align_off.g is executed before the ALIGN command is sent to the scanner. M756: Shutdown 3D scannerExample M756 Sends the SHUTDOWN command the attached 3D scanner. M800: Fire start print procedure1 only in bq-Marlin Firmware Example M800 M801: Fire end print procedure1 only in bq-Marlin Firmware Example M801 M808: Set or Goto Repeat MarkerThe M808 L[count] command is used in a G-code file to set a Repeat Marker beginning at the start of the following line. For an SD print, the firmware will save a marker with the fileâ€™s byte position and the count given by the L parameter. To set an infinite loop use L0. To terminate an infinite loop from the host, M808 K will cancel all current loops. The M808 command (no parameters) will cause G-code processing to loop back to the previous Repeat Marker as many times as specified. Ideally, each instance of M808 L should have a corresponding M808. The number of nested M808 L commands is limited to the depth set in the firmware. To enable this feature in Marlin, define GCODE_REPEAT_MARKERS. Hosts should look for Cap:REPEAT. At this time the feature only applies to printing direct from media and otherwise M808 is ignored, so host developers are free to come up with their own approach to these codes with no nesting limit and make it work with any old firmware. Example M808 L10 ; Set Marker to repeat 10 timesM300 P100 S440 ; Beep!M300 P10 S0 ; SilenceM808 ; End Marker RepRapFirmware processes M808 as follows: - M808 S{ccc} translates into while ccc followed by block begin. ccc must yield true or false. For more on while-loops and expressions in RepRapFirmware, see https://duet3d.dozuki.com/Wiki/GCode_Meta_Commands. - M808 Lnn is equivalent to M808 S{nn 0 || iterations nn}. - M808 without S or L parameter ends the block. - As usual, predefined constant iterations reports the number of completed iterations of the innermost loop. - M808 without S or L parameter when not inside a loop, or any M808 command in an input stream other than a SD print file, gives rise to an error message. M808 in Marlin 2.0.8M808 L ; Set marker to repeat infinitelyM300 P100 S440Â ; Beep!M300 P10 S0 ; SilenceM808 ; End markerM808 K ; Sent from host to cancel the loop M810-M819: Temporary G-code macrosUse the M810-M819 commands to set and execute 10 distinct G-code â€œmacros.â€ Any G-code following the command defines the macro. To run the macro just send M810-M819 by itself. Multiple commands must be separated by the pipe character (â€˜|â€™). To run a defined macro type M810-M819 with no comments. These macros do not persist after shutdown. They are intended to be defined and used within a print session. Define the M815 macro to do some moves and make a beep: Example M815 G0 X0 Y0|G0 Z10|M300 S440 P50 Running the macro M815 M820: Report Temporary G-code macrosSend M820 to get a report of the macros defined by M810-M819. M850: Sheet parametersGet and Set Sheet parameters Usage M850 [ S | Z | L | B | P | A ] Parameters S Sheet id [0-7] Z Z offset L Label [aA-zZ, 0-9 max 7 chars] B Bed temp P PINDA temp A Active [0|1] M851: Set Z-Probe OffsetSets the Z-probe Z offset. This offset is used to determine the actual Z position of the nozzle when using a probe to home Z with G28. This value may also be used by G29 to apply correction to the Z position. This value represents the distance from nozzle to the bed surface at the point where the probe is triggered. This value will be negative for typical switch probes, inductive probes, and setups where the nozzle makes a circuit with a raised metal contact. This setting will be greater than zero on machines where the nozzle itself is used as the probe, pressing down on the bed to press a switch (this is a common setup on Delta machines). This setting is saved in the EEPROM by M500 and restored by M501. The default (as reset by M502) is set by the Z_PROBE_OFFSET_FROM_EXTRUDER setting in Configuration.h. Note that in Marlin 1.1.0 and later M851 sets the value literally as given, while Marlin 1.0.2 negates the absolute value. The examples below will set the Z-probe Z offset to -4Â mm (below the nozzle): M851 in Marlin 1.0.2M851 Z4Â ; Set the Z probe offset to -4 M851 in Marlin 1.1.0M851 Z-4Â ; Set the Z probe offset to -4 M851 in Marlin 2.0.0M851 X-22 Y3 Z-4Â ; Set the probe XYZ offsets M851 in MK4duo 4.3.25M851 X2 Y-5 Z-4Â ; Set the probe offset to X=2, Y=-5 and Z=-4 M851 in RepRapFirmware 2.02 and laterM851 Znn is implemented for backwards compatibility with other firmwares. It sets the Z probe trigger in the same way as G31 Z-nn (note the sign reversal). It also flags the Z-probe G31 parameters as to be saved in config-override.g if the M500 command is used. M855 Set Axis LengthParameters Xnnnn Sets X axis length Ynnnn Sets Y axis length Znnnn Sets Z axis length M860 Wait for Probe TemperatureParameters Snnnn Target temperature Notes In Prusa Firmware this command will wait for the PINDA thermistor to reach a target temperature. M861 Set Probe Thermal CompensationParameters ? Print current EEPROM offset values ! Set factory default values Z Set all values to 0 (effectively disabling PINDA temperature compensation) S Microsteps I Table index Example M861Â ? Results PINDA cal status: 1index, temp, ustep, umn/a, 35, 0, 0.000, 40, 0, 0.001, 45, 0, 0.002, 50, 0, 0.003, 55, 0, 0.004, 60, 0, 0.00 Notes In Prusa Firmware this command will set read the PINDA temperature compensation offsets. M862: Print checkingChecks the parameters of the printer and gcode and performs compatibility check M862.1: Check nozzle diameterParameters Pnnnn nnnn Nozzle diameter 0.25 0.40 0.60 Q Current nozzle diameter When run with P argument, the check is performed against the input value. When run with Q argument, the current value is shown. Example messages warn Printer nozzle diameter differs from the G-code. Continue? strict Printer nozzle diameter differs from the G-code. Please check the value in settings. Print cancelled. M862.2: Check model codeParameters Pnnnn nnnn Prusa model Q Current model When run with P argument, the check is performed against the input value. When run with Q argument, the current value is shown. Accepted printer type identifiers and their numeric counterparts: - MK1 (100)- MK2 (200) - MK2MM (201) - MK2S (202) - MK2SMM (203) - MK2.5 (250) - MK2.5MMU2 (20250) - MK2.5S (252) - MK2.5SMMU2S (20252)- MK3 (300)- MK3MMU2 (20300)- MK3S (302)- MK3SMMU2S (20302) Example messages warn G-code sliced for a different printer type. Continue? strict G-code sliced for a different printer type. Please re-slice the model again. Print cancelled. M862.3: Model nameParameters Pnnnn nnnn Prusa model name Q Current model name When run with P argument, the check is performed against the input value. When run with Q argument, the current value is shown. It accepts text identifiers of printer types too. The syntax of M862.3 is (note the quotes around the type): M862.3 P MK3S Example messages warn G-code sliced for a different printer type. Continue? strict G-code sliced for a different printer type. Please re-slice the model again. Print cancelled. M862.4: Firmware versionParameters Pnnnn nnnn Prusa firmware version Q Current firmware version When run with P argument, the check is performed against the input value. When run with Q argument, the current value is shown. Example messages warn G-code sliced for a newer firmware. Continue? strict G-code sliced for a newer firmware. Please update the firmware. Print cancelled. M862.5: Gcode levelParameters Pnnnn nnnn Gcode level Q Current Gcode level When run with P argument, the check is performed against the input value. When run with Q argument, the current value is shown. Example messages warn G-code sliced for a different level. Continue? strict G-code sliced for a different level. Please re-slice the model again. Print cancelled. M862.6: Firmware featuresParameters Pcccc cccc Firmware Features Q Current Firmware Features When run with P argument, the check is performed against the input value. When run with Q argument, the current value is shown. Example messages always G-code isnâ€™t fully compatible. misssing requested features: Input shaper Abort. M871: PTC ConfigurationM871 allows you to modify the Z adjustments corresponding to temperatures. Parameters B Set the Z adjustment for bed temperature P Set the Z adjustment for probe temperature E Set the Z adjustment for extruder temperature Examples M871 B V0.1 I3 ; Set Z adjustment for bed temp index 3 to 0.1M871 E V-1 I2 ; Set Z adjustment for extruder temp index 3 to -1 M876: Dialog handlingParameters Pnnn signal support for dialog creation on the host 1, disable 0 Snnn select dialog option nnn (0 based) Example M876 P1M876 S1 M876 Sn allows selecting an option of a prompt on a connected host created by the firmware through the corresponding action commands, see G-code#Action_commands. The S parameter is the 0-based index of the chosen option - 0 for the first option provided by the firmware, 1 for the second and so on. Example: A prompt with three options defined via the firmware and completed by the host by selecting the second option (â€œHome XY and pause printâ€) //action:prompt_begin Filament runout detected. Please choose how to proceed: //action:prompt_choice Swap filament //action:prompt_choice Home X/Y and pause print //action:prompt_choice Abort print //action:prompt_show M876 S1 To indicate the availability of this function, M115 will add an extra line: Cap:PROMPT_SUPPORT:1 so hosts know about the presence of the function. M890 Run User GcodeParameters Snnn select 1 - 5 User Gcode defined in configuration. Example M890 S2 ; Start User Gcode 2 M900: Set Linear Advance Scaling FactorsSets the advance extrusion factors for Linear Advance. If any of the R, W, H, or D parameters are set to zero the ratio will be computed dynamically during printing. Parameters K[factor] Advance K factor R[ratio] Set ratio directly (overrides WHD) W[width] H[height] D[diam] Set ratio from WHD Examples M900 K0.7 W0.4 H0.1 D1.75Â ; Set K and WH/D ratioM900 R0.025 ; Set the WH/D ratio directlyM900 R0Â ; Set to auto ratio Requires enabling the LIN_ADVANCE feature in Marlin 1.1. The K factor in the M900 command supported by early versions of Marlin is related to the S factor in the long-established M572 command supported by RepRapFirmware by the following formula: K = S * extruder_steps_per_mm More recent versions of Marlin appear to have removed the stepsmm dependency, so now K S. M905: Set local date and timeParameters Pnnn Set current date in the format YYYY-MM-DD Snnn Set current time in the format HH:MM:SS Example M905 P2016-10-26 S00:23:12 Updates the machineâ€™s local date and time or reports them if no parameters are specified. The time should be specified in 24-hours format as in â€œ13:45â€ instead of 1:45PM. Note1 in Druid Firmware minor differences in parameters: M905 Snnn Current time in the format HH:MM:SS or HH:MM (Seconds can be omitted) M905 R Reset the printer to UPTIME (time since power up) and date to DEFAULT 2000-01-01 When Druid Firmware is used with Repetier Server, the date and time are set automatically at each connection. M906: Set motor currentsParameters Xnnn X drive motor current Ynnn Y drive motor current Znnn Z drive motor current Ennn E drive(s) motor current(s) Innn Motor idle current in percent (0..100) In Marlin X, Y, Z are the same as above, in addition to the following Parameters In to specify index for additional motors, such as I2 to set current for X2,Y2,Z2 Tn to set tool number for the E axis Example M906 X300 Y500 Z200 E350:350 Sets the currents to send to the stepper motors for each axis. The values are the peak current per phase in milliamps. The I parameter is the percentage of normal that the motor currents should be reduced to when the printer becomes idle but the motors have not been switched off. The default value is 30%. On delta printers in particular you may need to increase it to e.g. 60% to prevent the carriages from dropping when the current is reduced to the idle value. M907: Set digital trimpot motor currentSet digital trimpot motor current using axis codes (X, Y, Z, E, B, S). In Repetier, it sets the current in Percent. In Redeem, it sets the current in Amps (whereas M906 uses milliamps). Differences with Druid Firmware1 Parameters M907 Xnnn Set X stepper current M907 Ynnn Set Y stepper current M907 Znnn Set Z stepper current M907 Annn Set E0 stepper current M907 Bnnn Set E1 stepper current M907 Innn Set Idle currentÂ % (see note 2) M907 S Reset all values to Firmware default M907 Report all values (X,Y,Z,A,B) in mA, and idle (I) asÂ % - When setting X,Y,Z,A,B current, The range in which, the values provided are, will automatically determine their UNITS (Amps,Â % or mA) as follow: Values betweenâ€¦ 0.10 ... 2.50 â€“ Unit is Amps (0.10 A â€¦ 2.50 A) 20 ... 200 â€“ Unit is Percentage (20Â % â€¦ 200Â %) of nominal values set in Druid Firmware 250 ... 2500 â€“ Unit is milliamps (250 mA â€¦ 2500 mA) - Any values outside those ranges, will be ignored. Exemple M907 X800 Y800 A600 ;values are processed as mAM907 X80 Y80 A120 ;values are processed asÂ % of firmware defaultM907 X0.75 Y0.75 Z0.5 ;values are processed as Amps M907 ;Report all values (X,Y,Z,A,B) in mA, and idle (I) asÂ %M907 S ;reset all values to Firmware default Note2 The percentage parameter I, is used to lower the current, when the printer is idle, but motors are not switched off. It Allows positions to be held without heating up the coils. (default is 50%, range is 10% ... 90%) M908: Control digital trimpot directlyM908 P S Notes In Prusa Firmware this G-code is deactivated by default, must be turned on in the source code.1 M909: Set microsteppingExample M909 X3 Y5 Z2 E3 Set the microstepping value for each of the steppers. In Redeem this is implemented as powers of 2 soâ€¦ M909 X2Â ; set microstepping on X-axis to 2^2 = 4M909 Y3Â ; set microstepping on Y-axis to 2^3 = 8 etc. M910: Set decay modeExample M910 X3 Y5 Z2 E3 Set the decay mode for each stepper controller The decay mode controls how the current is reduced and recycled by the H-bridge in the stepper motor controller. It varies how the implementations are done in silicone between controllers. Typically you have an on phase where the current flows in the target current, then an off phase where the current is reversed and then a slow decay phase where the current is recycled. M910: TMC2130 initNot active in default, only if TMC2130_SERVICE_CODES_M910_M918 is defined in source code. M911: Configure auto save on loss of power (â€œpower panicâ€)Parameters Saaa Auto save threshold in volts. The print will be stopped automatically and resume parameters saved if the voltage falls below this value. Set to around 1V to 2V lower than the voltage that appears at the Duet VIN terminals at full load. A negative or zero value disables auto save. Raaa Resume threshold in volts. Must be greater than the auto save voltage. Set to a high value to disable auto resume. Pcommand string G-Code commands to run when the print is stopped. Example M911 S19.8 R22.0 Pâ€M913 X0 Y0 G91 M83 G1 Z3 E-5 F1000â€ When the supply voltage falls below the auto save threshold while a print from SD card is in progress, all heaters will be turned off, printing will be stopped immediately (probably in the middle of a move), the position saved, and the specified command string executed. You should typically do the following in the command string: If possible, use M913 to reduce the motor current in order to conserve power. For example, on most printers except deltas you can probably set the X and Y motor currents to zero. Retract a little filament and raise the head a little. Ideally the retraction should happen first, but depending on the power reserve when low voltage is detected, it may be best to do both simultaneously. M911 with no parameters displays the current enabledisable state, and the threshold voltages if enabled. Note: RepRapFirmware 1.19 used different parameters. You are recommended to upgrade to version 1.20 or later if you wish to use this â€œpower panicâ€ functionality. M911: Set TMC2130 holding currentsNot active in default, only if TMC2130_SERVICE_CODES_M910_M918 is defined in source code. M912: Set electronics temperature monitor adjustmentParameters Pnnn Temperature monitor channel, default 0 Snnn Value to be added to the temperature reading in degC Example M912 P0 S10.5 Many microcontrollers used to control 3D printers have built-in temperature monitors, but they normally need to be calibrated for temperature reading offset. The S parameter specifies the value that should be added to the raw temperature reading to provide a more accurate result. M912: Set TMC2130 running currentsNot active in default, only if TMC2130_SERVICE_CODES_M910_M918 is defined in source code. M913: Set motor percentage of normal currentParameters X, Y, Z, E Percentage of normal current to use for the specified axis or extruder motor(s) Example M913 X50 Y50 Z50Â ; set X Y Z motors to 50% of their normal currentM913 E30:30Â ; set extruders 0 and 1 to 30% of their normal current This allows motor currents to be set to a specified percentage of their normal values as set by M906. It can be used (for example) to reduce motor current during course homing, to make homing quieter or to reduce the risk of damage to endstops, to reduce motor current when using sensorless endstops (motor stall detection), and to reduce current while loading filament to guard against the possibility of feeding too much filament. Use M913 again with the appropriate parameters set to 100 to restore the normal currents. M913: Print TMC2130 currentsNot active in default, only if TMC2130_SERVICE_CODES_M910_M918 is defined in source code. M914: SetGet Expansion Voltage Level TranslatorParameters S Expansion voltage signal level, must be 3 or 5 Example M914 S5Â ; set expansion signal level to 5VM913Â ; report expansion signal voltage level M914: Set TMC2130 normal modeUpdates EEPROM only if â€œPâ€ is given, otherwise temporary (lasts until reset or motor idle timeout) Usage M914 [ P | R | Q ] Parameters P Make the mode change permanent (write to EEPROM) R Revert to EEPROM value Q Print effective silentnormal status. (Does not report override) M915: Configure motor stall detectionParameters Pnnn:nnn:â€¦ Drive number(s) to configure X,Y,Z,U,V,W,A,B,C Axes to configure (alternative to using the P parameter) Snnn Stall detection threshold (-64 to +63, values below -10 not recommended) Fn Stall detection filter mode, 1 filtered (one reading per 4 full steps), 0 unfiltered (default, 1 reading per full step) Hnnn (optional) Minimum motor full steps per second for stall detection to be considered reliable, default 200 Tnnn (optional) Coolstep control register, 16-bit unsigned integer Rn Action to take on detecting a stall from any of these drivers: 0 no action (default), 1 just log it, 2 pause print, 3 pause print, execute macro file sysrehome.g, and resume print Examples M915 P0:2:3 S10 F1 R0 M915 X Y S5 R2 This sets the stall detection parameters and optionally the low-load current reduction parameters for TMC2660, TMC2130 or similar driver chips. Use either the P parameter to specify which driver number(s) you want to configure, or the axis names of the axes that those motors drive (the parameters will then be applied to all the drivers associated with any of those axes). If any of the S, F, T and R parameters are absent, the previous values for those parameters associated with the specified drivers will continue to be used. If all the parameters are absent, the existing settings for the specified drives will be reported. See the Trinamic TMC2660 and TMC2130 datasheets for more information about the operation and limitations of motor stall detection. M915: Set TMC2130 silent modeUpdates EEPROM only if â€œPâ€ is given, otherwise temporary (lasts until reset or motor idle timeout) Usage M915 [ P | R | Q ] Parameters P Make the mode change permanent (write to EEPROM) R Revert to EEPROM value P Print effective silentnormal status. (Does not report override) M916: Resume print after power failureParameters none Example M916 If the last print was not completed and resume information has been saved (either because the print was paused or because of a power failure), then the heater temperatures, tool selection, head position, mix ratio, mesh bed compensation height map etc. are restored from the saved values and printing is resumed. RepRapFirmware also requires macro file sysresurrect-prologue.g to be present on the SD card before you can use M915. This file is executed after the heater temperatures have been set, but before waiting for them to reach the assigned temperatures. You should put commands in this file to home the printer as best as you can without disturbing the print on the bed. To wait for the heaters to reach operating temperature first, use command M116 at the start of the file. M916: Set TMC2130 Stallguard sensitivity thresholdNot active in default, only if TMC2130_SERVICE_CODES_M910_M918 is defined in source code. M917: Set motor standstill current reductionParameters X,Y,Z,E Percentage of normal current to use when the motor is standing still or moving slowly, default 100 Example M917 X70 Y70 Z80 E70:70 Some motor drivers (e.g. TMC2660) allow higher motor currents to be used while the motor is moving than when it is at standstill. This command sets the percentage of the current set by M906 that is to be used when the motor is stationary but not idle, or moving very slowly. Standstill current reduction is not the same as idle current reduction. The standstill current must be high enough to produce accurate motion at low speeds; whereas the idle current (set using the I parameter in the M906 command) needs only to be high enough to hold the motor position sufficiently so that when the current is restored to normal, the position is the same as it was before the current was reduced to idle. M917: Set TMC2130 PWM amplitude offset (pwm_ampl)Not active in default, only if TMC2130_SERVICE_CODES_M910_M918 is defined in source code. M918: Configure direct-connect displayThis command is used to tell RepRapFirmware about a directly-connected dumb LCD or similar display. Parameters P Directly-connected display type: 0 none (default), 1 128x64 pixel mono graphics display using ST7920 controller, 2 128x64 mono display using ST7567 controller E The number of pulses generated by the rotary encoder per detent. Typical values are 2 and 4. Negative values (e.g. -2 and -4) reverse the encoder direction. F (optional, supported in RRF 2.03 and later) SPI clock frequency in Hz, default 2000000 (i.e. 2MHz) C (optional, supported in RRF 3.2 and later) Display contrast, in range 0 to 100. Only used with ST7567-based displays. ST7920-based displays usually have a contrast potentiometer instead. R (optional, supported in RRF 3.2 and later) Display resistor ratio, in range 1 to 7. Only used with ST7567-based displays. The default value of 6 is suitable for the Fysetc Mini 12864 display. Some other displays need 3. Example M918 P1 E2 M918: Set TMC2130 PWM amplitude gradient (pwm_grad)Not active in default, only if TMC2130_SERVICE_CODES_M910_M918 is defined in source code. M928: Start SD loggingExample M928 filename.g Stop SD logging with M29. M929: Startstop event logging to SD cardParameters Pâ€filenameâ€ The name of the file to log to. Only used if the S1 parameter is used. A default filename will be used if this parameter is missing. Sn S1 start logging, S0 stop logging Example M929 Pâ€eventlog.txtâ€ S1 ; start logging to file eventlog.txt M929 S0 ; stop logging When event logging is enabled, important events such as power up, startfinish printing, most error messages and (if possible) power down will be logged to the SD card. Each log entry is a single line of text, starting with the date and time if available, or the elapsed time since power up if not. If the log file already exists, new log entries will be appended to the existing file. M950: Create heater, fan or GPIOservo deviceParameters Dn SD card slot number (RRF 3.4 on Duet 3 MB6HC only - the only value supported is 1) Enn LED strip number (RRF 3.5 and later) Fnn Fan number Hnn Heater number Jnn GP input number Pnn or Snn GPIO or Servo number (the only difference is the default PWM frequency) Rnn Spindle number *RRF 3.3 and later) Câ€nameâ€ Pin name(s) and optional inversion status. Pin name â€œnilâ€ frees up the pin. A leading â€˜!â€™ character inverts the output. A leading â€˜^â€™ character enables the pullup resistor. The â€˜^â€™ and â€˜!â€™ characters may be placed in either order. Qnn (optional) For fans and heaters: PWM frequency in Hz. For LED strips: clock frequency in Hz. Tnn Temperature sensor number, required when creating a heater; or LED strip type when creating an LED port Kaaa:bbb:ccc (optional, for spindles only, RRF 3.5 and later) Optional PWM values (0..1) for spindle control (max [aaa] - or - min, max [aaa:bbb] - or - min, max, idle [aaa:bbb:ccc]) Examples M950 H1 Câ€out1â€ Q100 T1Â ; create heater 1 using temperature sensor 1 M950 H2 Câ€nilâ€Â ; disable heater 2 and free up the associated pin M950 H2 Câ€1.out0â€ T2Â ; create heater 2 using pin out0 on expansion board 1 and temperature sensor 2 M950 F3 Câ€heater2â€ Q100Â ; Fan 3 is connected to heater 2 pin, PWM at 100Hz M950 P0 Câ€exp.heater3â€Â ; create GPIO port 0 attached to heater 3 pin on expansion connector M950 F2 Câ€!fan2+^pb6â€Â ; Fan 2 uses the Fan2 output, but we are using a PWM fan so the output needs to be inverted, also we are using PB6 as a tacho input with pullup resistor enabled M950 D1 Câ€spi.cs0+spi.cs2â€Â ; on Duet 3 MB6HC support external SD card using pins spi.cs0 and spi.cs2 for the CS and Card Detect pins respectively M950 is used to create heaters, fans, LED strip ports and GP in and out ports and to assign pins to them. Each M950 command assigns a pin or pins to a single device. So every M950 command must have exactly one of the D, E, F, H, J, P or S parameters. If a M950 command has C andor Q parameters, then the pin allocation andor frequency of any existing device will be changed accordingly. Otherwise, the current configuration will be reported. When using M950 to create a heater, you must first use M308 to define a temperature sensor to control that heater, and specify its number in the T parameter of the M950 command. M951: Set height following mode parametersParameters Snn or Hnn Sensor number Pnn.n Proportional factor, in mm per sensor unit Inn.n Integral factor, in mm per sensor unit per second Dnn.n Derivative factor, in mm per rate of change of sensor units (change in sensor unit per second) Fnn.n (optional) Sample and correction frequency (Hz), default 5Hz Znn.n:nn.n Minimum and maximum permitted Z values Height following mode allows the Z position of the tool to be controlled by a PID controller using feedback from a sensor. See also M594. If commanding the motors to increase Z causes the sensor value to increase, then all of P, I and D must be positive. If commanding the motors to increase Z causes the sensor value to decrease, then all of P, I and D must be negative. M952: Set CAN expansion board address andor normal data rateParameters Bn Existing CAN address of expansion board to be changed, 1 to 125. An New CAN address of that expansion board, 1 to 125. Sn.n Requested bit rate in Kbitssecond (1K 1000) T0.n Fraction of the bit time between the bit start and the sample point (optional) J0.n Maximum jump time as a fraction of the bit time (optional) Example M952 B120 A11 ; change the CAN address of expansion board 101 to 11 M952 B11 S500 ; change the CAN bit rate or expansion board 11 to 500kbps Some CAN-connected expansion boards are too small to carry address selection switches. Such boards default to a standard address, which can be changed using this command. This command can also be used to change the normal data rate, for example if the printer has CAN bus cables that are too long to support the standard data rate (1Mbitssec in RepRapFirmware). All boards in the system on the same CAN bus must use the same CAN data rate. The procedure for changing the data rate is: Use M952 to change the data rate on all the expansion boards, one at a time. After changing the data rate on each expansion board, you will no longer be able to communicate with it, and you may need to power it down or disconnect it from the CAN bus to prevent it interfering with subsequent CAN communications. Change the data rate of the main board last. Then the main board should be able to communicate with all the expansion boards again. M953: Set CAN-FD bus fast data rateParameters Sn.n Requested bit rate in Kbitssecond (1K 1000). Ignored if it is lower than the bit rate for the negotiation phase. T0.n Fraction of the bit time between the bit start and the sample point (optional) J0.n Maximum jump time as a fraction of the bit time (optional) Caa:bb Transceiver delay compensation offset and minimum, in nanoseconds (optional) Example M953 S4000 T0.6 J0.2 This command allows the bandwidth of the CAN bus to be optimised, by increasing the data rate during transmission of CAN-FD data packets using the BRS (bit rate switch) feature. The maximum speed supported by CAN-FD is 8Mbitssec but the practical limit depends on the cable length, cable quality, number of devices on the bus and CAN interface hardware used. The rate specified will be rounded down to the nearest achievable rate. The optional C parameter allows fine-tuning of the transmitter delay compensation. The first parameter is the offset added to the measured transmitter delay. The optional second value, which must be greater than the first, is the minimum delay compensation applied. Glitches seen by the receiver while the transceiver delay is being measured will be ignored if they would result in a transceiver delay compensation lower than this value. When CAN is implemented on Microchip SAME5x and SAMC21 processors, these values are converted from nanoseconds into time quanta and stored in the TDCO and TDCF fields of the transceiver delay compensation register. M954: Configure as CAN expansion boardParameters Ann CAN address to use (required) This command is used to reconfigure the board it is executed on as a CAN-connected expansion board. It would typically be the only command in the config.g file. When it is executed, the board changes its CAN address to the one specified in the A parameter, stops sending CAN time sync messages, and responds to requests received via CAN just like a regular expansion board. A few GCode commands can still be executed locally for diagnostic purposes, for example M111 and M122. M955: Configure AccelerometerParameters (provisional) Pnn or Pbb.nn Accelerometer to use (required) Inn Accelerometer orientation Snnn Sample rate (Hz) Rnn Resolution (bits), typically 8, 10 or 12 This command configures an accelerometer. The P parameter selects which accelerometer to use and is mandatory. To use an accelerometer on a CAN-connected expansion board, use the form Pboard-address.device-number for example P22.0. If none of the other parameters are provided, the current configuration of the specified accelerometer is reported. Otherwise the configuration of that accelerometer is adjusted according to the I, S, and R parameters. These configuration settings persist until they are changed. The I (orientation) parameter tells the firmware which of the 24 possible orientations the accelerometer chip is in relative to the printer axes. It is expressed as a 2-digit number. The first digit specifies which machine direction the Z axis of the accelerometer chip (usually the top face of the chip) faces, as follows: 0 +X, 1 +Y, 2 +Z, 4 -X, 5 -Y, 6 -Z. The second digit expresses which direction the X axis of the accelerometer chip faces, using the same code. If the accelerometer chip axes line up with the machine axis, the orientation is 20. This is the default orientation if no orientation has been specified. The S and R parameters control how the accelerometer is programmed. The R parameter is ignored unless the S parameter is also provided. If S is provided but R is missing, a default resolution is used. The sensor resolution will be adjusted to be no greater than the value of the R parameter (or the minimum supported resolution if greater), then the sensor sampling rate will be adjusted to a value supported at that resolution that is close to the S parameter. The actual rate and resolution selected can be found by using M955 with just the P parameter. M956: Collect accelerometer data and write to fileParameters Pnn or Pbb.nn Accelerometer to use (required) Snnn Number of samples to collect (required) X andor Y andor Z Machine axes to collect data for. If no axes are specified, data is collected for all three axes. An (required) 0 activate immediately, 1 activate just before the start of the next move, 2 activate just before the start of the deceleration segment of the next move Kn (optional, default 0) Skip the specified number of moves before activating (use with A1 or A2) This command causes the specified number of accelerometer samples to be collected and saved to a .csv file on the SD card. The P parameter selects which accelerometer to use and is mandatory. To use an accelerometer on a CAN-connected expansion board, use the form Pboard-address.device-number for example P22.0. M957: Raise eventParameters Eâ€typeâ€ Event type name Dnn Device number to which the event relates, optionally including the CAN address of the board concerned Pnn (optional) additional data about the event (unsigned integer) Bnn (optional) CAN address that the event should appear to originate from Sâ€textâ€ (optional) Short text string to be appended to the event message This command is used to raise an event internally as if the event had actually occurred, and execute any related handler macro for that event. Its main use is to test event handler macros. The event type names are firmware-dependent. In RepRapFirmware they are: heater_fault, driver_error, filament_error, driver_warning, driver_stall and mcu_temperature_warning. The meaning of the device number depends on the event type. For a driver error it is the local driver number. For a heater fault it is the heater number. For a filament error it is the extruder number. The meaning of the optional additional parameter also depends on the event type. For example, for a driver error it is the driver status. M958: Excite harmonic vibrationParameters (provisional) X or Y or Z Machine axis Fnnn Frequency (Hz) Annn Acceleration (mms2) Snnn Duration (s) M970: EnableDisable Phase SteppingParameters Xn 0 disable, 1 enable Yn 0 disable, 1 enable Axis lettern (RRF) 0 disable, 1 enable M970.1: Configure Phase Stepping Velocity ConstantParameters Axis letternnn(RRF 3.6 onwards) velocity constant Configure the velocity constant used to scale the motor current in phase stepping. M970.2: Configure Phase Stepping Acceleration ConstantParameters Axis letternnn(RRF 3.6 onwards) acceleration constant Configure the acceleration constant used to scale the motor current in phase stepping. M972: Retrieve Current CorrectionOutputs the current correction table in format: `, , , , ` per line. Multiple axes can be specified. M973: Set Single Entry in Current Correction TableParameters String argument in format: XYFBlist of mag,phase pairs separated by space M974: Measure Print Head ResonanceParameters XY choose motor to use F motion speed in revsec R number of revolutions Outputs raw accelerometer sample , , , per line and real sampling frequency of the accelerometer as â€œsample freq: â€œ. M975: Measure Dwarf Accelerometer Sampling FrequencyOutputs sampling frequency of the accelerometer as â€œsample freq: â€œ. M976: Measure Print Head ResonanceParameters XY choose motor to use F motion speed in revsec R number of revolutions Outputs frequency response M977: Calibrate MotorParameters XY choose motor to use Calibrates given motor and sets the newly found compensation. M995: Calibrate Touch ScreenM997: Perform in-application firmware updateParameters Snnn Firmware module number(s), default 0 Bnnn Expansion board address, default 0 (i.e. main controller board) Example M997 S0:1Â ; update firmware modules 0 and 1 on the main controller boardM997 B3Â ; update firmware module 0 on the expansion board with address 3 This command triggers a firmware update if the necessary files are present on the SD card. In RepRapFirmware on the Duet series, module numbers are as follows: 0 - main firmware. The firmware filename depends on the controller electronics, e.g.sysRepRapFirmware.bin (Duet 06085), sysDuet2CombinedFirmware (Duet WiFiEthernet), sysDuetMaestroFirmware.bin (Duet Maestro). File sysiap.bin (Duet), sysiap4e.bin (Duet WiFiEthernet) or sysiap4s.bin (Duet Maestro) must also be present. 1 - WiFi module firmware, filename sysDuetWiFiServer.bin 2 - Reserved (on Duet WiFi running RepRapFirmware 1.18 and earlier, was web server file system) 3 - Duet WiFi main boards: put the WiFi module into bootloader mode so that firmware can be uploaded directly via its serial port. Duet 3 expansion boards: update the bootloader (RepRapFirmware 3.2 and later). 4 - Updates the firmware on an attached PanelDue v3 or later touch screen (supported in RRF 3.2 and later) In marlin, M997 will trigger a firmware update after the update file has been uploaded to the SD card, on the following platforms: LPC176x, STM32, STM32F1 M998: Request resend of lineParameters Pnnn Line number Example M998 P34 Request a resend of line 34. In some implementations the input-handling code overwrites the incoming G Code with this when it detects, for example, a checksum error. Then it leaves it up to the G-code interpreter to request the resend. M999: Restart after being stopped by errorParameters This command can be used without any additional parameters. Pnnn Reset flags1 Bnnn CAN address of the board to reset (RRF only)2 Example M999 Restarts the firmware using a software reset. Notes 1The dc42 fork of RepRapFirmware not only resets the board but also puts the board into firmware upload mode if parameter PERASE is present. 2Starting from RRF 3.3 this parameter may be set to -1 to reboot the attached SBC (DuetPi + SBC) Other commandsG: List all G-codesExample G Print a list of all implemented G-codes in the firmware with description to the host.(Note: this has been implemented in Redeem, and so is only a proposal.) M: List all M-codesExample M Print a list of all implemented M-codes in the firmware with description to the host.(Note: this has been implemented in Redeem, and so is only a proposition) T: Select ToolParameters This command can be used without any additional parameters. Pnnn: Bitmap of all the macros to be run (only RRF 1.17b or later) Tool number Example T1 Select tool (or in older implementations extruder) number 1 to build with. The sequence followed is: Set the current tool to its standby temperatures specified by G10 (see above), Set the new tool to its operating temperatures specified by G10 and wait for all temperatures to stabilise, Apply any X, Y, Z offset for the new tool specified by G10, Use the new tool. Selecting a non-existent tool (100, say) just does Step 1 above1. That is to say it leaves all tools in their standby state. You can, of course, use the G10 command beforehand to set that standby temperature to anything you like. Note that you may wish to move to a parking position before executing a T command in order to allow the new extruder to reach temperature while not in contact with the print. It is acceptable for the firmware to apply a small offset [by convention (-1mm x tool-number) in Y] to the current position when the above sequence is entered to allow temperature changes to take effect just away from the parking position. Any such offset must, of course, be undone when the procedure finishes. If the Z value changes in the offsets and the tool moves up, then the Z move is made before the X and Y moves. If Z moves down, X and Y are done first. Some firmware (Such as Prusa i3 Printers with MMU) also support the Tx (recommended) and T?(depricated)2 commands to prompt the user to select a tool (or a filament in the case of the MultiMaterial Unit) on the printerâ€™s menu. Then the Tc command actually loads the selected filament. Some implementations (e.g. RepRapFirmware) allow you to specify tool-change G Code macros3. There are normally three specified (any of which can contain no commands if desired) that execute in this order: Actions to do with the old tool before it is released - macro name: tfreeN.g where N is the tool number; (Old tool is released); Actions to do with the new tool before it is selected - macro name: tpreN.g where N is the tool number; (New tool is selected); and Actions to do with the new tool after it is selected - macro name: tpostN.g where N is the tool number. With such implementations there is no wait for temperature stabilisation. That can be achieved by an M116 in any of the macros, of course. However be aware that recent RepRapFirmware versions does NOT run any tool change macros if the axes are not homed. After a reset tools will not start heating until they are selected. You can either put them all at their standby temperature by selecting them in turn, or leave them off so they only come on ifwhen you first use them. The M0, M1, and M112 commands turn them all off. You can, of course, turn them all off with the M1 command, then turn some back on again. Donâ€™t forget also to turn on the heated bed (if any) if you use that trick. Tool numbering may start at 0 or 1, depending on the implementation. Some implementations (those that use the M563 command to define tools) allow the user to specify tool numbers, so with them you can have tools 17, 99 and 203 if you want. Negative numbers are not allowed. Notes 1 For RepRapFirmware, selecting a non-existent tool also removes any XYZ offset applied for the old tool. 2 T? was the original form of the command, but it was changed to Tx when it was realized that the question mark character caused problems when printing through octoprint. This change was implemented in Prusa firmware 3.5.0. 3 Under special circumstances, the execution of those macro files may not be desired. RepRapFirmware 1.17b or later supports an optional P parameter to specify which macros shall be run. If absent then all the above macros will be run. Otherwise pass a bitmap of all the macros to be executed. The bitmap of this value consists of tfree1, tpre2 and tpost4. D: Debug codesNOTE: These D codes are not compatible with the Gcode spec ( NIST Gcode spec, initially written for CNC, which Reprap initially messed up, after what the CNC side of Reprap has spent years trying to get Reprap back to respecting it ), and will make life hell for those building machines that do more than just 3D printing, or controllers that support this, as well as possibly cause other issues. IÂ see this is from Prusa, and IÂ know these guys are really cool about Open-Source, so Iâ€™m sure they care a lot about respecting standards and other projects as well, so Iâ€™m certain theyâ€™ll fix this as soon as they see there is an issue. Thankfully this is very easy to fix, just change from D1 to Mxxx D1, where you find a Mxxx Gcode that is currently free and start using it. In Gcode, only M, G and T are keywords, D is a parameter, you canâ€™t make it a keyword without messing everything up. Iâ€™m sure for your subset of using Gcode, thatâ€™s probably just fine, but itâ€™s not for the rest of us, and the whole point of adding things to this page, is for others to use it if they wantcanneed, and the way it currently is ( breaking a standard ), this canâ€™t be used by others. Links: https://en.wikipedia.org/wiki/G-code https://www.nist.gov/publications/nist-rs274ngc-interpreter-version-3 This note by:Â â€“ Debug codes are not active by defalut and must be defined in source code. D-1: Endless Loop-â€“ D0: ResetThis command will reset the board B: Bootloader D1: Clear EEPROM and RESETThis command will clear the EEPROM and reset the board D2: ReadWrite RAMParameters This command can be used without any additional parameters. It will read the entire RAM. Annnn: Address (x0000-x1fff) Cnnnn: Count (1-8192) Xnnnn: Data (hex) Notes The hex address needs to be lowercase without the 0 before the x Count is decimal The hex data needs to be lowercase D3: ReadWrite EEPROMParameters This command can be used without any additional parameters. It will read the entire EEPROM. Annnn: Address (x0000-x0fff) Cnnnn: Count (1-4096) Xnnnn: Data (hex) Notes The hex address needs to be lowercase without the 0 before the x Count is decimal The hex data needs to be lowercase D4: ReadWrite PINTo read the digital value of a pin you need only to define the pin number. Parameters Pnnn: Pin (0-255) Fn: Function inout (01) Vn: Value (01) D5: ReadWrite FLASHParameters This command can be used without any additional parameters. It will read the 1kb FLASH. Annnn: Address (x00000-x3ffff) Cnnnn: Count (1-8192) Xnnnn: Data (hex) E: Erase Notes The hex address needs to be lowercase without the 0 before the x Count is decimal The hex data needs to be lowercase D6: ReadWrite external FLASHReserved D7: ReadWrite BootloaderReserved D8: ReadWrite PINDAParameters ?: Read PINDA temperature shift values !: Reset PINDA temperature shift values to default Pnnn: Pinda temperature [C] Znnnn: Z Offset [mm] D9: ReadWrite ADCParameters I(index): ADC channel index I0: Heater 0 temperature I1: Heater 1 temperature I2: Bed temperature I3: PINDA temperature I4: PWR voltage I5: Ambient temperature I6: BED voltage V: Value to be written as simulated D10: Set XYZ calibration OKD12: TimeWrites current time in the log file. D20: Generate an offline crash dumpGenerate a crash dump for later retrival. Usage D20 [E] Parameters E: Perform an emergency crash dump (resets the printer). Notes A crash dump can be later recovered with D21, or cleared with D22. An emergency crash dump includes register data, but will cause the printer to reset after the dump is completed. D21: Print crash dump to serialOutput the complete crash dump (if present) to the serial. Usage D21 Notes The starting address can vary between builds, but itâ€™s always at the beginning of the data section. D22: Clear crash dump stateClear an existing internal crash dump. Usage D22 D23: Request emergency dump on serialOn boards without offline dump support, request online dumps to the serial port on firmware faults. When online dumps are enabled, the FW will dump memory on the serial before resetting. Usage D23 [E] [R] Parameters E: Perform an emergency crash dump (resets the printer). R: Disable online dumps. D80: Bed checkThis command will log data to SD card file â€œmesh.txtâ€. Parameters E: Dimension X (default 40) F: Dimension Y (default 40) G: Points X (default 40) H: Points Y (default 40) I: Offset X (default 74) J: Offset Y (default 34) D81: Bed analysisThis command will log data to SD card file â€œwldsd.txtâ€. Parameters E: Dimension X (default 40) F: Dimension Y (default 40) G: Points X (default 40) H: Points Y (default 40) I: Offset X (default 74) J: Offset Y (default 34) D106: Print measured fan speed for different pwm valuesD2130: Trinamic stepper controllerReserved D9125: PAT9125 filament sensorThis command can be used without any additional parameters. It will read the PAT9125 values. Parameters ?: Print values !: Print values R: Resolution. Not active in code X: X values Y: Y values L: Activate filament sensor log Proposed EEPROM configuration codesBackground: Every 3D printer has parameters that need to be persistent but also easily tunable, such as extrusion steps-per-mm and various planner values. Some of these parameters are hardcoded in firmware so that a user has to modify, recompile, and re-flash the firmware for certain adjustments, while others can be modified with an M-code and stored to the EEPROM or other persistent storage. Current implementations: Marlin and Sprinter use G-codes M500-M503 to save, load, reset, and report the settings mirrored in EEPROM. Note that the M503 command reports settings that may not have been saved to EEPROM yet. Teacup uses G-codes M130-M136 to set, read, and save PID values. Repetier Firmware uses M206 to set a stored value (using an ID number) and M205 to report settings. RepRapFirmware uses the config-override.g file on the SD card for settings storage. M500 saves some values to that file, M501 re-loads settings from this file, and M502 loads the â€œfactory settingsâ€ values from config.g, ignoring config-override.g. Please see the RFC M-codes for EEPROM config proposed by AlexRa in March of 2011. There is currently no working implementation of the proposed commands. All communication is in printable ASCII characters. Messages sent back to the host computer are terminated by a newline. The basic protocol responses look like this: xx [line number to resend] [T:93.2 B:22.9] [C: X:9.2 Y:125.4 Z:3.7 E:1902.5] [Some debugging or other information may be here] xx can be one of: ok - The RepRap machine is ready to receive the next line from the host. rs or Resend - There was a communication error and the RepRap machine is requesting a resend of the line in question. The line is specified either as Nlinenumber or N:linenumber. Examples: Resend: 123, Resend: N123, rs:123 !! or Error: or fatal: (Repetier Firmware) - There was an error. Common communication errors such as checksum mismatch, Last Line: number or Wrong checksum, No Checksum with line number, Last Line: number or Missing checksum, Line Number is not Last Line Number+1, Last Line: number or expected line number1 got number2 are recoverable and should immediately be followed by a resend. Other non-fatal errors commonly include Unknown command: command and several SD related errors such as Cannot open subdir dir, SD init fail, volume.init failed, openRoot failed, workDir open failed, open failed, File: name, error writing to file, Cannot enter subdir: dir and SD read error. Any other errors indicate a hardware fault that will make the RepRap machine shut down immediately after it has sent this message. They should be considered fatal by hosts. wait - The RepRap machineâ€™s command buffers are empty and it is waiting for the next line from the host. busy:reason - The RepRap machine is busy for some reason and currently cannot receive or process commands through the serial interface from a connected host. Possible reasons are: `processing` (the RepRap machine is busy with processing some lengthy command, like homing, heatup or auto leveling), paused for user (the RepRap machine is paused and awaiting an action by the user via its built in controller unit, e.g. clicking the button), paused for input (the RepRap machine is paused and waiting for input from the user via its built in controller unit, e.g. selecting a menu option). Examples: busy: processing, busy: paused for user. The T: and B: values are the temperature of the currently-selected extruder and the bed respectively, and are only sent in response to M105. If such temperatures donâ€™t exist (for example for an extruder that works at room temperature and doesnâ€™t have a sensor) then a value below absolute zero (-273oC) is returned. C: means that coordinates follow. Those are the X: Y: etc values. These are only sent in response to M114 and M117. The RepRap machine may also send lines that look like this: This is some debugging or other information on a line on its own. It may be sent at any time. Such lines will always be preceded by . The most common response is simply: ok When the machine boots up it sends the string start once to the host before sending anything else. This should not be replaced or augmented by version numbers and the like. M115 (see above) requests those. Originally, every line sent by RepRap to the host computer except the start line was supposed to have a two-character prefix (one of ok, rs, !! or //). The machine should never send a line without such a prefix. These days, firmwares generally do not adhere to this rule and thus it should be considered obsolete. Example of a communication error with resend request are lines sent from the host to the RepRap machine, are lines sent from the RepRap machine to the host. N66555 G1 X131.338 Y133.349 E0.0091*91 ok N66556 G1 X131.574 Y133.428 E0.0046*42 Error:checksum mismatch, Last Line: 66555 Resend: 66556 ok N66556 G1 X131.574 Y133.428 E0.0046*92 ok Action commandsThe current versions of Pronterface and OctoPrint can interpret special commands sent by the firmware of the form: //action:command Other hosts simply ignore or echo this output from the firmware. The available Host Action Commands are: start: Tell the host to start the currently selected print job. (OctoPrint 1.5.0+) pause: Tell the host to pause the print job. resume: Tell the host to resume the print job. disconnect: Tell the host to disconnect from the printer. cancel: Tell the host to abort the current job. out_of_filament Textruder_id: Tell the host that an extruderâ€™s filament is out or jammed. Host should issue a pause and can offer better help to the user. For backwards-compatibility it should be followed by the pause action. paused: Tell the host that a printer-controlled print job was paused. (OctoPrint 1.3.9+) resumed: Tell the host that a printer-controlled print job was resumed. (OctoPrint 1.3.9+) probe_rewipe: Display a â€œG29 Probing Retryingâ€ alert. (Lulzbot Cura 3.6+) probe_failed: Cancel the print job and display a â€œG29 Probing Failedâ€ alert. (Lulzbot Cura 3.6+) sd_inserted: The SD card was inserted. Hosts should update internal state as needed. (OctoPrint 1.6.0+) sd_ejected: The SD card was ejected. Hosts should update internal state as needed. (OctoPrint 1.6.0+) sd_updated: The SD card was updated. Hosts should update internal state as needed. (OctoPrint 1.6.0+) Action commands can also be sent by the firmware to have the host show alerts and prompts for user feedback. The following commands are supported by OctoPrint 1.3.9 or later with the â€œAction Command Prompt supportâ€ plugin enabled. prompt_begin message: Start a user prompt dialog that displays message to the user. prompt_choice text: Define a dialog choice with the associated text. prompt_button text: Same as prompt_choice. prompt_show: Tell the host to prompt the user with the defined dialog. prompt_end: Tell the host to close the dialog (e.g., the choice was made from the printerâ€™s own UI). After showing a user dialog the host should wait for feedback and send the userâ€™s selection back to the firmware with M876 Snnn as described in G-Code#M876:_Dialog_handling. On connection (or whenever the functionality is enabled in the host) the host can tell the firmware that it supports host dialogs by sending M876 P1. For more detailed examples of prompt_* action command dialogs, see OctoPrintâ€™s documentation. Further notesRepRapFirmware responds to some commands with a reply string in JSON format, terminated by a newline. This allows later firmware revisions to include additional information without confusing clients (e.g. PanelDue) that do not expect it, and to make responses self-describing so that the client will not be confused if responses are delayed or lost. The commands affected are: M105 S2 (now deprecated in favor of M408 and M409) M105 S3 (now deprecated in favor of M408 and M409) M20 S2 M36 M408 M409 It is also possible to generate GCODE by using ChatGPT prompts such as following source additive blog : â€œwrite the gcode of 10cm * 10cm * 10cm cube with 50% infill for an open source reprap design 3d printerâ€ Proposal for sending multiple lines of G-codeSo far, this is a proposal, open for discussion. Problem to solveWhen using Marlin firmware or emulating Marlin, each line of G-code sent from the host to the controller is answered with an ok before the next line can be sent without locking communications up. This slows down communication and limits the number of commands-per-second that can be sent to the control board, and the USB stack on the host and the serial interface driver on the Arduino also add their own latencies (up to 10 milliseconds). This is not a problem for other controller electronics using native USB such as the Duet, because the standard serial-over-USB drivers provide flow control, so the host software can be configured not to wait for the ok. For more details on this proposal, some suggested solutions and comments, please see GCODE_buffer_multiline_proposal Alternatives to G-codeMain article: FirmwareAlternative#alternatives to G-code Several people have suggested using STEP-NC or some other control language; or perhaps designing a completely new control language.","tags":["clippings"],"categories":["5.åµŒå…¥å¼å¼€å‘","ç¡¬ä»¶çŸ¥è¯†","3Dæ‰“å°"]},{"title":"å¦‚ä½•æ‰“é€ å±äºè‡ªå·±çš„3Dæ‰“å°æœºä¸Šä½æœºï¼Ÿè¿™ç¯‡æ–‡ç« å¸¦ä½ äº†è§£ä¸€ä¸‹ï¼-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘","path":"/2025/02/24/5-åµŒå…¥å¼å¼€å‘-ç¡¬ä»¶çŸ¥è¯†-3Dæ‰“å°-å¦‚ä½•æ‰“é€ å±äºè‡ªå·±çš„3Dæ‰“å°æœºä¸Šä½æœºï¼Ÿè¿™ç¯‡æ–‡ç« å¸¦ä½ äº†è§£ä¸€ä¸‹ï¼-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘/","content":"å»ºè®®ä¸æ˜¯æœ¬è¡Œåˆæ„Ÿå…´è¶£çš„å°ä¼™ä¼´ä»¬å…ˆçœ‹ä¸‹é¢ä¸¤ç¯‡äº†è§£ä¸€ä¸‹Marlin: å¼€æºMarlin2.xæºä»£ç æ¶æ„å­¦ä¹ ç¬”è®° 3Dæ‰“å°æœºmarlinå›ºä»¶æ¡†æ¶ä¸GCodeå‘½ä»¤æ€»ç»“ YouTubeä¸Šçš„è€å¤–é€šä¿—æ˜“æ‡‚çš„æ–¹å¼è®²è§£Marlin2.0ç„¶åå†çœ‹ä¸‹é¢çš„æ–‡ç« ã€‚ 1ã€æ‘˜è¦è¯´åˆ° RepRaptorï¼Œæˆ‘ä»¬å°±æœ‰å¿…è¦æ¥äº†è§£ä¸‹RepRap 3Dæ‰“å°æœºã€‚RepRapæ˜¯äººç±»å†å²ä¸Šç¬¬ä¸€éƒ¨å¯ä»¥è‡ªæˆ‘å¤åˆ¶å‹çš„æœºå™¨ã€‚RepRapæ˜¯ä¸€éƒ¨å¯ä»¥ç”Ÿæˆå¡‘æ–™å®ç‰©çš„å…è´¹æ¡Œé¢å‹ 3D æ‰“å°æœºã€‚ç”±äº RepRap å¾ˆå¤šéƒ¨ä»¶éƒ½æ˜¯ç”±å¡‘æ–™åˆ¶æˆäº†ï¼Œå¹¶ä¸” RepRap éƒ½å¯ä»¥è¿›è¡Œæ‰“å°ï¼Œæ‰€ä»¥ RepRap å¯ä»¥è‡ªæˆ‘å¤åˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»»ä½•äººéƒ½å¯ä»¥èŠ±ä¸€äº›æ—¶é—´æ”¶é›†å¤Ÿææ–™è¿›è¡Œåˆ¶ä½œã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œå¦‚æœæ‚¨å·²ç»æœ‰ä¸€å° RepRap äº†ï¼Œæ‚¨å¯ä»¥åœ¨æ‰“å°å¾ˆå¤šæœ‰ç”¨çš„ç‰©ä»¶çš„åŒæ—¶ï¼Œä¸ºæœ‹å‹å†æ‰“å°å‡ºå¦ä¸€éƒ¨ RepRapã€‚RepRap è‡´åŠ›äºè‡ªæˆ‘å¤åˆ¶å‹æœºå™¨çš„åˆ¶ä½œï¼Œå¹¶æ— å¿çš„æä¾›ç»™å¤§å®¶ä½¿ç”¨ã€‚æˆ‘ä»¬ç”¨ 3D æ‰“å°æ¥å®ç°è¿™äº›ï¼Œä½†å¦‚æœæ‚¨ä½¿ç”¨å…¶å®ƒçš„æŠ€æœ¯ä¹Ÿå®ç°äº†è‡ªæˆ‘å¤åˆ¶å¹¶æ„¿æ„æ— å¿æä¾›ç»™å¤§å®¶ä½¿ç”¨ã€‚é‚£ä¹ˆï¼Œè¿™é‡Œä¹Ÿå°†éå¸¸æ¬¢è¿æ‚¨çš„åŠ å…¥ã€‚RepRapæ˜¯ç¬¬ä¸€æ¬¾ä½æˆæœ¬ 3D æ‰“å°æœºï¼Œå¹¶ä¸” RepRap è¿˜å¼€åˆ›äº†å¼€æº 3D æ‰“å°æœºçš„é©å‘½ã€‚åœ¨æ‰‹å·¥åˆ¶ä½œç±»ç¤¾åŒºçš„æ‰€æœ‰æˆå‘˜ä¸­è¢«å¹¿æ³›ä½¿ç”¨çš„ä¸€æ¬¾ 3D æ‰“å°æœºã€‚ å…³é”®è¯ï¼š3Dæ‰“å°æœºï¼›è‡ªæˆ‘å¤åˆ¶ï¼›RepRapï¼›RepRaptor 2ã€RepRaptorç®€ä»‹RepRaptoræ˜¯ä¸€ä¸ªå¯ç”¨äºæ”¯æŒGCodeæŒ‡ä»¤3Dæ‰“å°ä¸Šä½æœºï¼Œå®ƒæ˜¯ç”¨QT5æ¥ç¼–å†™çš„ã€‚ä¹‹æ‰€ä»¥ä½¿ç”¨QT5æ¥ç¼–å†™ï¼Œè¿™æ˜¯å› ä¸ºå¼€å‘è€…å¸Œæœ›å®ƒèƒ½å¤Ÿä»»ä½•ç¡¬ä»¶ä¸Šè¿è¡Œã€‚å› æ­¤ï¼ŒRepRaptorä¹Ÿå¯ä»¥ç”¨äºæ§åˆ¶RepRap æ¥å®ç°3Dæ¨¡å‹çš„æ‰“å°ã€‚å®ƒçš„ç•Œé¢æ˜¯è¿™æ ·çš„ï¼š æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°çš„æ˜¯ï¼Œå®ƒå·²ç»å…·å¤‡äº†3Dæ‰“å°æœºä¸Šä½æœºçš„åŸºæœ¬é›å½¢ã€‚ç›®å‰3Dæ‰“å°æœºçš„ä¸»æµçš„æ¶æ„ä¸»è¦æ˜¯è¿™æ ·çš„ï¼š å› æ­¤ï¼ŒRepRaptorç›¸å½“äºå……å½“äº†ä¸Šä½æœºè¿™ä¸ªéƒ¨åˆ†çš„å·¥ä½œï¼š åªå¯æƒœï¼Œè¿™ä¸ªç‰ˆæœ¬ä»…ä»…å‘å¸ƒåˆ°äº†RepRaptor v0.3.8ä»¥åå°±æ²¡æœ‰å†è¿›è¡Œç»§ç»­æ›´æ–°äº†ã€‚ ä½†æ˜¯æ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºè¿™ä¸ªé›å½¢ï¼Œåšå‡ºå±äºæˆ‘ä»¬è‡ªå·±çš„3Dæ‰“å°æœºä¸Šä½æœºï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥ä¹°ä¸€å°æ”¯æŒè”æœºæ‰“å°çš„3Dæ‰“å°æœºï¼Œæ„‰å¿«çš„è¿›è¡Œæ¨¡å‹æ‰“å°äº†ï¼ 3ã€RepRaptoræºç æ¶æ„å¯¼è¯»åœ¨å¼€å‘å±äºè‡ªå·±çš„3Dæ‰“å°æœºä¸Šä½æœºä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»è·å¾—å®ƒçš„æºç ï¼š git clone https://github.com/josefprusa/RepRapCalculator.git ç„¶åä½¿ç”¨QT Creatorå°†å…¶æ‰“å¼€ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ä»£ç ç»“æ„: 3.1ã€ç•Œé¢ä»‹ç»åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªåŸºäºQT DesigneråšUIç•Œé¢,ç±»ä¼¼äºMFCä¸€æ ·æ‹–æ§ä»¶ï¼Œç„¶åå†ä½¿ç”¨C++å†™é€»è¾‘ã€‚å› æ­¤ï¼Œæˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°å®ƒæ˜¯ç”±6ä¸ªUIç•Œé¢æ¥å®Œæˆçš„ï¼Œåˆ†åˆ«æ˜¯ï¼š (1) aboutwindow.ui å…³äºé¡¹ç›®çš„ä»‹ç» (2)eepromwindow.ui è·å–æ‰“å°æœºEEPROMä¸­çš„æ•°æ®å¹¶å±•ç°åˆ°ç•Œé¢ä¸Šæ¥ï¼Œæ­¤éƒ¨åˆ†åŠŸèƒ½ä¸å…¨ã€‚ (3) errorwindow.ui ä¸€äº›è¿è¡Œé”™è¯¯çš„æç¤ºçª—å£ (4)mainwindow.ui ä¸»é¡µé¢ï¼Œç”¨äºæ§åˆ¶æ‰“å°æœºçš„å¸¸è§„æ“ä½œã€è·å–æ‰“å°æœºåé¦ˆçš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ¸©åº¦ã€é€Ÿåº¦ï¼š (5)sdwindow.ui ä½¿ç”¨SDå¡è¿›è¡Œæ‰“å°é”éœ€è¦çš„è®¾ç½®å’Œæ–‡ä»¶è¯»å–ç­‰åŠŸèƒ½ï¼Œæ­¤éƒ¨åˆ†åŠŸèƒ½ä¸å…¨ã€‚ (6)settingswindow.ui ä¸€äº›å‚æ•°çš„è®¾ç½®ï¼Œæ­¤éƒ¨åˆ†åŠŸèƒ½ä¸å…¨ 3.2ã€æ ¸å¿ƒä»£ç æ¶æ„å¯¼è¯» 4ã€æ‰“é€ å±äºæˆ‘ä»¬è‡ªå·±çš„3Dæ‰“å°æœºä¸Šä½æœº4.1ã€æˆåŠŸæ‰“é€ å±äºæˆ‘ä»¬è‡ªå·±çš„3Dæ‰“å°æœºä¸Šä½æœºçš„å‰æå½“ç„¶ï¼Œæƒ³è¦å­¦ä¼šæ‰“é€ è‡ªå·±çš„æ‰“å°æœºçš„å‰æï¼Œä½ å¾—å…·å¤‡ä»¥ä¸‹åŸºç¡€çŸ¥è¯†ï¼š æŒæ¡QTè½¯ä»¶å¼€å‘(å¦‚æœä½ ä¼šC#æˆ–è€…å…¶å®ƒå½“ç„¶ä¹Ÿæ²¡é—®é¢˜) æŒæ¡3Dæ‰“å°æœºGCodeæŒ‡ä»¤åè®® å…¶å®ƒå¿…è¦çš„çŸ¥è¯†ï¼Œå¦‚è®¾è®¡æ¨¡å¼ã€æ•°æ®ç»“æ„ç­‰ã€‚ 4.2ã€æ ¸å¿ƒäº¤äº’é€»è¾‘çš„å®ç°å…³äºGCodeçš„æ ¼å¼ä»¥åŠå“åº”çš„é€šè®¯åè®®å¯ä»¥å‚è€ƒï¼š https://marlinfw.org/meta/gcode/ è¿™ä¸Šé¢åˆ—å‡ºäº†å‡ ä¹æ‰€æœ‰Marlinæ”¯æŒçš„GCodeåè®®æŒ‡ä»¤ã€‚ ä»æºç å¯¼è¯»éƒ¨åˆ†ï¼Œæˆ‘ä»¬æœ€éœ€è¦å…³å¿ƒçš„æ˜¯mainwindow.cppã€sender.cppå’Œparser.cppè¿™ä¸‰ä¸ªæ–‡ä»¶ï¼Œå› ä¸ºå®ƒä»¬æ˜¯å®ç°3Dæ‰“å°æœºä¸Šä½æœºæˆåŠŸçš„åŸºç¡€ï¼Œè¿™é‡Œæˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°è¿™ä¸‰ä¸ªçº¿ç¨‹ä¹‹é—´çš„äº¤é›†éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯mainwindow.cppé‡Œçš„è¿™æ®µä»£ç ï¼š //Parser thread signal-slots and initparserWorker-moveToThread(parserThread);connect(parserThread, QThread::finished, parserWorker, QObject::deleteLater);connect(this, MainWindow::startedReadingEEPROM, parserWorker, Parser::setEEPROMReadingMode);connect(parserWorker, Parser::receivedTemperature, this, MainWindow::updateTemperature);connect(parserWorker, Parser::receivedSDFilesList, this, MainWindow::initSDprinting);connect(parserWorker, Parser::receivedEEPROMLine, this, MainWindow::EEPROMSettingReceived);connect(parserWorker, Parser::recievingEEPROMDone, this, MainWindow::openEEPROMeditor);connect(parserWorker, Parser::receivedError, this, MainWindow::receivedError);connect(parserWorker, Parser::receivedSDDone, this, MainWindow::receivedSDDone);connect(parserWorker, Parser::receivedSDUpdate, this, MainWindow::updateSDStatus);connect(parserWorker, Parser::receivedNotSDPrinting, this, MainWindow::receivedNotSDPrinting);parserThread-start();parserThread-setPriority(QThread::HighestPriority);//Sender thread signal-slots and initsenderWorker-moveToThread(senderThread);connect(senderThread, QThread::finished, senderWorker, QObject::deleteLater);connect(parserWorker, Parser::receivedOkNum, senderWorker, Sender::receivedOkNum);connect(parserWorker, Parser::receivedOkWait, senderWorker, Sender::receivedOkWait);connect(parserWorker, Parser::receivedResend, senderWorker, Sender::receivedResend);connect(parserWorker, Parser::receivedStart, senderWorker, Sender::receivedStart);connect(senderWorker, Sender::errorReceived, this, MainWindow::serialError);connect(senderWorker, Sender::dataReceived, parserWorker, Parser::parse);connect(senderWorker, Sender::dataReceived, this, MainWindow::readSerial);connect(senderWorker, Sender::reportProgress, this, MainWindow::updateFileProgress);connect(senderWorker, Sender::baudrateSetFailed, this, MainWindow::baudrateSetFailed);connect(this, MainWindow::setFile, senderWorker, Sender::setFile);connect(this, MainWindow::startPrinting, senderWorker, Sender::startPrinting);connect(this, MainWindow::stopPrinting, senderWorker, Sender::stopPrinting);connect(this, MainWindow::pause, senderWorker, Sender::pause);connect(this, MainWindow::setBaudrate, senderWorker, Sender::setBaudrate);connect(this, MainWindow::openPort, senderWorker, Sender::openPort);connect(this, MainWindow::closePort, senderWorker, Sender::closePort);connect(this, MainWindow::injectCommand, senderWorker, Sender::injectCommand);connect(this, MainWindow::flushInjectionBuffer, senderWorker, Sender::flushInjectionBuffer);senderThread-start();senderThread-setPriority(QThread::TimeCriticalPriority); (1)çº¿ç¨‹äº¤äº’çš„è®¾è®¡ å½“æˆ‘ä»¬çœ‹æ‡‚äº†è¿™æ®µä»£ç ä»¥åå°±å¯ä»¥å°†å®ƒä»¬æŠ½è±¡æˆæˆ‘ä»¬è‡ªå·±çš„ä»£ç ï¼Œå³åˆ†è§£ä¸ºï¼š ä»¥ä¸‹æ˜¯æˆ‘åŸºäºä¸Šé¢çš„è¿™ä¸ªæ¶æ„è¿›è¡Œäº†ç®€å•çš„ä¿®æ”¹ï¼š /*æ³¨å†Œä¸²å£çº¿ç¨‹*/void MainWindow::Register_Uart_thread() uartThread = new QThread(this); uartWorker = new SerialThread(Sensor_Uart,Sensor_Baud); uartWorker-moveToThread(uartThread); connect(uartThread, QThread::finished, uartWorker, QObject::deleteLater); connect(uartWorker, SerialThread::reportProgress, this, MainWindow::updateFileProgress); connect(uartWorker, SerialThread::update_layer, this, MainWindow::updateModelLayer); connect(uartWorker, SerialThread::send_debug_gcode_line, this, MainWindow::GCode_Debug); connect(this, MainWindow::startPrinting, uartWorker, SerialThread::startPrinting); connect(this, MainWindow::stopPrinting, uartWorker, SerialThread::stopPrinting); connect(this, MainWindow::pausePrinting, uartWorker, SerialThread::pausePrinting); connect(this, MainWindow::recovery_print, uartWorker, SerialThread::recovery_print); uartThread-start(); uartThread-setPriority(QThread::TimeCriticalPriority);/*æ³¨å†Œæ–‡ä»¶ç®¡ç†çº¿ç¨‹*/void MainWindow::Register_FileManage_thread() fileThread = new QThread(this); fileWorker = new file_manage(); fileWorker-moveToThread(fileThread); connect(fileThread, QThread::finished, fileWorker, QObject::deleteLater); connect(this, MainWindow::setGodeFile, fileWorker, file_manage::parseFile); connect(fileWorker, file_manage::update_gcode_info_display, this, MainWindow::GCode_File_Info); connect(fileWorker, file_manage::send_gcode_file, uartWorker, SerialThread::setFile); fileThread-start(); fileThread-setPriority(QThread::HighestPriority);/*æ³¨å†Œåè®®è§£æçº¿ç¨‹*/void MainWindow::Register_Protocol_Parse_thread() parserThread = new QThread(this); parseWorker = new protocol_parse(); parseWorker-moveToThread(parserThread); connect(parserThread, QThread::finished, parseWorker, QObject::deleteLater); connect(parseWorker, protocol_parse::hotbed_temp, this, MainWindow::Display_HotBed_Temp); connect(parseWorker, protocol_parse::hotend_temp, this, MainWindow::Display_Hotend_Temp); connect(parseWorker, protocol_parse::move_position, this, MainWindow::Display_Move_Position); connect(uartWorker, SerialThread::Data_Process, parseWorker, protocol_parse::Data_Process); parserThread-start(); parserThread-setPriority(QThread::HighestPriority); (2)æ‰“å°GCodeæ–‡ä»¶ä¸ç”¨æˆ·å‘é€GCodeå‘½ä»¤çš„æ ¸å¿ƒå®ç° (3)åè®®è§£æçš„æ ¸å¿ƒå®ç° å…³äºåè®®è§£æéƒ¨åˆ†ï¼Œæˆ‘ä¾ç„¶é‡‡ç”¨çš„æ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹æ¡ˆæ¥å®ç°ï¼Œä¾‹å¦‚å¯¹æ¸©åº¦éƒ¨åˆ†çš„å¤„ç†ï¼š typedef struct QString raw; double e_c, b_c; double e_t, b_t; TemperatureReadings;//æ­£åˆ™è¡¨è¾¾å¼è·å–æ¸©åº¦void MainWindow::Get_Temp_Test() int p = 0; QStringList data_list ; TemperatureReadings r; /*å¯¹äºå•å–·å¤´æ‰“å°æœºï¼Œå®ƒå›å¤çš„æ•°æ®æ ¼å¼æ˜¯è¿™æ ·çš„*/ QByteArray data = T:41.88 /0.00 B:56.02 /60.00 @:0 B@:0 W:?; QRegExp temperatureRegxp(-?(([0-9]\\\\d*\\\\.\\\\d*)|(0\\\\.\\\\d*[0-9]\\\\d*)|([0-9]\\\\d*))); while ((p = temperatureRegxp.indexIn(data, p)) != -1) data_list.append(temperatureRegxp.cap(1)); //ä¸Šä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦ä¸²çš„é•¿åº¦ p += temperatureRegxp.matchedLength(); r.raw = QString(data); r.e_c = data_list[0].toDouble(); //å–·å¤´å½“å‰æ¸©åº¦ r.e_t = data_list[1].toDouble(); //å–·å¤´ç›®æ ‡æ¸©åº¦ r.b_c = data_list[2].toDouble(); //çƒ­åºŠå½“å‰æ¸©åº¦ r.b_t = data_list[3].toDouble(); //çƒ­åºŠç›®æ ‡æ¸©åº¦ qDebug() è§£ææºå­—ç¬¦ä¸²: r.raw è§£æé•¿åº¦ï¼š data_list.length(); qDebug() r.e_c ; qDebug() r.e_t ; qDebug() r.b_c ; qDebug() r.b_t ; ä¾‹å¦‚å¯¹å½“å‰ç§»åŠ¨åæ ‡çš„è·å–ï¼š typedef struct QString raw; double x,y,z ; CoreXYZ ;//æ­£åˆ™è¡¨è¾¾å¼è·å–åæ ‡void MainWindow::Get_GCodeXYZ_Test() int p = 0; QStringList data_list ; CoreXYZ r; /*ç§»åŠ¨æŒ‡ä»¤ï¼Œä¾‹å¦‚è§£æä¸‹é¢è¿™ä¸ªæŒ‡ä»¤*/ QByteArray data = G1 F1200 X-9.914 Y-9.843 E3.36222; QRegExp CoreXYZRegxp(-?(([XYZ]|[0-9]\\\\d*\\\\.\\\\d*)|(0\\\\.\\\\d*[0-9]\\\\d*)|([0-9]\\\\d*))); while ((p = CoreXYZRegxp.indexIn(data, p)) != -1) data_list.append(CoreXYZRegxp.cap(1)); //ä¸Šä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦ä¸²çš„é•¿åº¦ p += CoreXYZRegxp.matchedLength(); r.raw = QString(data); r.x = data_list[0].toDouble(); r.y = data_list[1].toDouble(); qDebug() è§£ææºå­—ç¬¦ä¸²: r.raw è§£æé•¿åº¦ï¼š data_list.length(); qDebug() data_list[0]; qDebug() data_list[1]; (4)å…¶å®ƒåŠŸèƒ½çš„è®¾è®¡ è¿™éƒ¨åˆ†å°±å‘æŒ¥å¤§å®¶è‡ªå·±çš„æƒ³è±¡äº†ï¼Œæˆ‘å…ˆåšäº†ä¸ªæµ‹è¯•ç‰ˆæœ¬ï¼Œéšä¾¿æ£é¼“ä¸€ä¸‹ï¼Œå·²ç»èƒ½å¤Ÿæ­£å¸¸æ‰“å°æ¨¡å‹äº†ï¼š ç›®å‰è¿™ä¸ªé¡¹ç›®è¿˜æ²¡æœ‰å¼€æºï¼Œæˆ‘è¿˜åœ¨æŒç»­çš„å®Œå–„ä¸­ï¼Œå¸Œæœ›æœ€åèƒ½å¤ŸåŠ©åŠ›ä¸€æŠŠ RepRapCalculatorï¼Œå¸Œæœ›åŠ ä»€ä¹ˆåŠŸèƒ½ï¼Œå¤§å®¶å¯ä»¥åœ¨ä¸‹æ–¹ç»™æˆ‘ç•™è¨€ã€‚ 5ã€æ€»ç»“è¦åšå±äºè‡ªå·±çš„æ‰“å°æœºï¼Œéœ€è¦æŒæ¡ä»¥ä¸‹æŠ€èƒ½ï¼š æŒæ¡QTè½¯ä»¶å¼€å‘(å¦‚æœä½ ä¼šC#æˆ–è€…å…¶å®ƒå½“ç„¶ä¹Ÿæ²¡é—®é¢˜) æŒæ¡3Dæ‰“å°æœºGCodeæŒ‡ä»¤åè®® å…¶å®ƒå¿…è¦çš„çŸ¥è¯†ï¼Œå¦‚è®¾è®¡æ¨¡å¼ã€æ•°æ®ç»“æ„ç­‰ã€‚ å¦å¤–ï¼Œè®©æˆ‘ä»¬å¯¹3Dæ‰“å°å¼€æºçš„å°ä¼™ä¼´ä»¬ä¸º3Dæ‰“å°å¼€æºå‘å‘åŠ›é‡ï¼ 6ã€å‚è€ƒæ–‡çŒ® å¼•ç”¨[1] G-Code Index. (n.d.). Marlin Firmware. https://marlinfw.org/meta/gcode/ [2] Neo, T. (2017, May 27). G-Code Index. Github. https://github.com/NeoTheFox/RepRaptor [3] Neo, T. (2017, May 27). A Qt RepRap Gcode SenderHost Controller. https://opensourcelibs.com/lib/repraptor [4]å¢åä¸œ. (2015, December 26). RepRap 3D Printer å…¥é—¨ä»‹ç». https://blog.csdn.net/lu\\_embedded/article/details/50409510 æœ¬æ–‡å‚ä¸Â è…¾è®¯äº‘è‡ªåª’ä½“åŒæ­¥æ›å…‰è®¡åˆ’ï¼Œåˆ†äº«è‡ªå¾®ä¿¡å…¬ä¼—å·ã€‚ åŸå§‹å‘è¡¨ï¼š2021-11-08ï¼Œå¦‚æœ‰ä¾µæƒè¯·è”ç³»Â cloudcommunity@tencent.com åˆ é™¤","tags":["clippings"],"categories":["5.åµŒå…¥å¼å¼€å‘","ç¡¬ä»¶çŸ¥è¯†","3Dæ‰“å°"]},{"title":"æœ€å¸¸ç”¨çš„å…¥é—¨åˆ‡ç‰‡å·¥å…·Curaå®‰è£…æ•™ç¨‹","path":"/2025/02/24/5-åµŒå…¥å¼å¼€å‘-ç¡¬ä»¶çŸ¥è¯†-3Dæ‰“å°-æœ€å¸¸ç”¨çš„å…¥é—¨åˆ‡ç‰‡å·¥å…·Curaå®‰è£…æ•™ç¨‹/","content":"Curaæ˜¯ä¸€æ¬¾æœ€å¸¸ç”¨çš„å…¥é—¨åˆ‡ç‰‡å·¥å…·ï¼Œå®ƒçš„ç•Œé¢ç¾è§‚ï¼Œæ“ä½œç®€ä¾¿ï¼Œè€Œä¸”æ¯ä¸ªå‚æ•°éƒ½æœ‰æ³¨é‡Šï¼Œå¯¹å…¥é—¨ç©å®¶éå¸¸çš„å‹å¥½ã€‚ å®‰è£…ä½¿ç”¨ã€å®‰è£…ã€‘ Curaå®‰è£…å®Œåæ‰“å¼€ï¼Œçœ‹ä¸æ‡‚è‹±æ–‡çš„ï¼Œå¯å…ˆå¿«é€Ÿç‚¹å‡»åŒæ„â€œAgreeâ€ã€ä¸‹ä¸€æ­¥â€Nextâ€œå’Œè·³è¿‡â€œSkipâ€ã€‚ ã€é…ç½®æ‰“å°æœºã€‘ å½“æ¥åˆ°è¿™ä¸€æ­¥ä¸èƒ½è·³è¿‡æ—¶ï¼Œç‚¹å‡»â€œAdd a networked printerâ€é€‰æ‹©æ‰“å°æœºï¼ˆå…·ä½“æ“ä½œè¯·ä»”ç»†é˜…è¯»è¯´æ˜ä¹¦ï¼‰ ã€ä¸­æ–‡è®¾ç½®ã€‘ å®Œæˆæ‰“å°æœºè®¾ç½®åï¼Œè¿›å…¥æ“ä½œç•Œé¢ã€‚é€‰æ‹©èœå•æ çš„â€œPreferencesâ€å’Œâ€œConfigure Cureâ€ï¼Œç‚¹å‡»è¿›å…¥ã€‚ åœ¨â€œGeneralâ€æ ä¸­ç‚¹å‡»è¯­è¨€é€‰é¡¹â€œLanguageâ€ï¼Œä¸‹æ‹‰é€‰æ‹©â€œç®€ä½“ä¸­æ–‡â€åï¼Œç‚¹å‡»å…³é—­ã€‚é‡å¯è½¯ä»¶åå³å¯æ¢æˆç®€ä½“ä¸­æ–‡ã€‚ ä½¿ç”¨æ•™ç¨‹å¸¸ç”¨æ“ä½œ å•å‡»STLæ¨¡å‹ï¼Œå°†æ¨¡å‹æ‹–å…¥Cura é•¿æŒ‰é¼ æ ‡æ»šè½®ä¸­é”®ï¼Œå¯å¹³ç§»è§†è§’ é•¿æŒ‰é¼ æ ‡å³é”®ï¼Œå¯æ—‹è½¬è§†è§’ æ»šåŠ¨é¼ æ ‡æ»šè½®ï¼Œå¯æ”¾å¤§ç¼©å°è§†è§’ æ¨¡å‹è°ƒæ•´ ç‚¹å‡»é€‰ä¸­æ¨¡å‹åï¼Œæ¿€æ´»å·¦è¾¹å·¥å…·æ ã€‚å·¥å…·æ å¯ä»¥è°ƒèŠ‚æ¨¡å‹çš„å¤§å°ã€æ¯”ä¾‹ã€ä½ç½®ã€æ—‹è½¬è§’åº¦ã€é•œåƒç­‰æ¨¡å‹è®¾ç½®ã€‚ ã€ç‰¹æ®Šä½ç§»ã€‘ é»˜è®¤çŠ¶æ€ä¸‹æ¨¡å‹æ˜¯è‡ªåŠ¨è´´åˆå¹³å°çš„ã€‚ç‰¹æ®Šæƒ…å†µä¸‹ï¼ˆå¦‚ï¼šåªæƒ³æ‰“å°ä¸€åŠæ¨¡å‹ï¼‰ï¼Œå¯è§£é™¤Zè½´é™åˆ¶ ç¬¬1æ­¥ï¼šæ‰“å¼€â€œåå¥½è®¾ç½®â€â€”â€œåŸºæœ¬â€â€”â€œè‡ªåŠ¨ä¸‹é™æ¨¡å‹åˆ°æ‰“å°å¹³å°â€ï¼Œå–æ¶ˆå‹¾é€‰ã€‚ ç¬¬2æ­¥ï¼šé€‰æ‹©æ¨¡å‹ï¼Œç‚¹å‡»ä½ç§»å·¥å…·ï¼Œé€šç”¨æ¨æ‹‰Zè½´æˆ–ç›´æ¥è¾“å…¥Zè½´åæ ‡å¯ä½¿æ¨¡å‹ä¸‹é™è‡³è´Ÿæ•°ã€‚åˆ‡ç‰‡ååªä¼šæ‰“å°å¹³å°ä¸Šæ–¹éƒ¨åˆ†ã€‚ å³å‡»æ¨¡å‹ï¼Œå¯è¿›è¡Œâ€œå¤åˆ¶â€ã€â€œæ¸…ç©ºå¹³å°â€ã€â€œå±…ä¸­æ¨¡å‹ç­‰è®¾ç½® æ“ä½œç•Œé¢å·¦ä¸‹è§’ä½ç½®ï¼Œå¯æŸ¥çœ‹æ¨¡å‹åŸºæœ¬ä¿¡æ¯ã€‚ç‚¹å‡»â€œé’¢ç¬”â€å›¾æ ‡ï¼Œå¯æ›´æ”¹åˆ‡ç‰‡åçš„æ–‡ä»¶åã€‚ æ¨¡å‹åˆ‡ç‰‡ ç‚¹å‡»æ“ä½œç•Œé¢å³è¾¹çš„è®¾ç½®æ ï¼Œé€‰æ‹©â€œExpertâ€ä¸“å®¶æ¨¡å¼ å¯åœ¨é…ç½®æ–‡ä»¶ä¸­é€‰æ‹©é»˜è®¤è®¾åˆ‡ç‰‡è®¾ç½®ï¼Œå»ºè®®é€‰æ‹©0.12mmæˆ–0.2mmå±‚é«˜çš„è®¾ç½®ä½“éªŒæ‰“å°æ•ˆæœã€‚ ã€åˆ‡ç‰‡é¢„è§ˆã€‘ åˆ‡ç‰‡å®Œæ¯•åï¼Œå¯åœ¨é¢„è§ˆç•Œé¢é¢„è§ˆæ‰“å°æ•ˆæœã€è€—æç”¨é‡åŠé¢„è®¡ç”¨æ—¶ã€‚æ‹‰åŠ¨æœ€å³è¾¹è¿›åº¦æ¡ï¼Œå¯æŸ¥çœ‹æ¯å±‚æ‰“å°æƒ…å†µã€‚ç‚¹å‡»å³ä¸‹è§’ä¿å­˜gcodeæ–‡ä»¶åˆ°Uç›˜å‡†å¤‡æ‰“å°ã€‚ åˆ‡ç‰‡å‚æ•°è®¾ç½®ã€è´¨é‡ã€‘ ä¸»è¦è®¾ç½®æ‰“å°çš„æ¯å±‚é«˜åº¦ï¼Œè¿™ä¸ªå‚æ•°å¯¹æ‰“å°æ—¶é•¿ã€åŠæ‰“å°ç²¾åº¦æœ‰å…³é”®ä½œç”¨ï¼Œå±‚é«˜è¶Šå°ï¼Œæ‰“å°è¶Šæ…¢ã€‚ä¸€èˆ¬å»ºè®®å±‚é«˜0.1ã€0.12ã€0.2mmã€‚ï¼ˆ0.1é€‚åˆé«˜ç²¾åº¦ï¼Œ0.2é€‚åˆæ™®é€šç²¾åº¦ï¼‰ ã€å¡«å……ã€‘ ä¸ºæ¨¡å‹å†…éƒ¨è‡ªåŠ¨ç”Ÿæˆçš„å¡«å……ç‰©ã€‚ä¸€èˆ¬æ²¡åŠ›å­¦è¦æ±‚çš„æ¨¡å‹å¡«å……å¯†åº¦ä¸º10-20%ã€‚å¦‚æœå¡«å……ç‡è¿‡ä½ï¼Œä¹Ÿä¼šæœ‰ä¸€å®šç¨‹åº¦å¯¼è‡´ç¿˜è¾¹ï¼Œä¸åŒçš„å†…éƒ¨å¡«å……å›¾æ¡ˆä¹Ÿå¯ä»¥æœ‰æ•ˆå‡å°‘ç¿˜è¾¹ã€‚ ã€ææ–™ã€‘ ä¸»è¦è®¾ç½®æ‰“å°æ—¶å–·å˜´å’Œçƒ­åºŠçš„æ¸©åº¦ã€‚ä¸€èˆ¬è€—æä¸Šä¼šå†™æœ‰æ‰“å°æ¸©åº¦ã€‚ä¹Ÿå¯é€šè¿‡æ‰“å°æ¸©åº¦å¡”æµ‹è¯•å‡ºæ¯ç§æœ€è€—æå“ç‰Œæœ€ä½³çš„æ‰“å°æ¸©åº¦ã€‚å»ºè®®é¦–å±‚æ¸©åº¦ç”¨230Â°Cï¼Œå®¹æ˜“ç²˜åºŠã€‚ è€Œæ‰“å°PLAï¼Œçƒ­åºŠçš„æ¸©åº¦å»ºè®®åœ¨50-60Â°Cã€‚ ã€é€Ÿåº¦ã€‘ PLAå»ºè®®æ‰“å°é€Ÿåº¦ä¸º60mmsï¼ŒÂ±20ä¹Ÿåœ¨å¸¸ç”¨é€Ÿåº¦ã€‚ ã€ç§»åŠ¨ã€‘ å½“æ‰“å°å‡ºç°æ‹‰ä¸æƒ…å†µï¼Œå¯è°ƒæ•´å›æŠ½è®¾ç½®ã€‚å»ºè®®å›æŠ½è·ç¦»ç”¨2.0mmï¼Œå›æŠ½é€Ÿåº¦ç”¨50mmsï¼ŒåŠ å¤§æ•°å€¼å¯å‡å°‘æ‹‰ä¸æƒ…å†µã€‚å¦‚æœæ‰“å°è¿‡ç¨‹ä¸­å–·å˜´æœ‰ç¢°åˆ°æ‰“å°ç‰©çš„æƒ…å†µï¼Œå¯å‹¾é€‰Zè½´æŠ¬å‡ã€‚ ã€æ‰“å°å¹³å°é™„ç€æ–¹å¼ã€‘ å¹³å°é™„ç€æ–¹å¼æœ‰ä¸‰ç§ã€‚Skirtä¸»è¦ç”¨äºæ“¦å‡€å–·å¤´ã€‚è€Œå¸¸ç”¨é˜²æ­¢ç¿˜è¾¹çš„è®¾ç½®çš„æœ‰Brimå’ŒRaftï¼Œè¿™ä¸¤ç§æ¨¡å¼èƒ½ è®©æ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°ä¸æ‰“å°å¹³å°ç²˜è¿ ï¼Œ å‘ ç°ç¿˜è¾¹æ—¶ï¼Œå¯æé«˜æ¥è§¦é¢å®½åº¦ã€‚ Brimæ˜¯åœ¨æ¨¡å‹åº•å±‚åŠ å‡ åœˆè£™è¾¹ï¼Œåº•é¢å¤æ‚çš„æ¨¡å‹ä¸å»ºè®®ç”¨è¿™ç§ï¼Œå› ä¸ºè£™è¾¹ä¸æ˜“æ‹†é™¤ï¼Œå®¹æ˜“å½±å“åº•å±‚è¾¹ç•Œã€‚ raftæ˜¯åœ¨æ¨¡å‹ä¸‹æ–¹æ‰“å°ä¸€ä¸ªå‡ å±‚çš„åº•åº§ï¼Œä¸è®©æ¨¡å‹ä¸æ‰“å°å¹³å°ç›´æ¥æ¥è§¦ï¼Œå¯ä»¥æœ‰æ•ˆå¼¥è¡¥è°ƒå¹³ä¸ä½³çš„æƒ…å†µã€‚è‹¥æ¨¡å‹åº•å±‚æ¥è§¦é¢å°ï¼Œå®¹æ˜“å‘ç”Ÿå€¾å€’ï¼Œäº¦å¯ä½¿ç”¨raftã€‚ç¼ºç‚¹æ˜¯å½±å“åº•å±‚æ‰“å°æ•ˆæœã€‚ ã€æ”¯æ’‘ã€‘ ä½œä¸ºå…¥é—¨æœ€éš¾çš„ä¸€ä¸ªè®¾ç½®ã€‚é€šå¸¸è§’åº¦è¿‡å¤§ï¼Œæ‰“å°è¿‡ç¨‹ä¸­æ‚¬ç©ºéƒ¨ä½åˆ™éœ€è¦æ·»åŠ æ”¯æ’‘ï¼Œå¦åˆ™å®¹æ˜“ä¸‹å‚ã€‚æ”¯æ’‘ä¸æ¨¡å‹æ¥è§¦é¢å¾€å¾€å¾ˆç²—ç³™ï¼Œå½±å“æ¨¡å‹è´¨é‡ã€‚ æ”¯æ’‘æ‚¬å‚è§’åº¦è¶Šå¤§ï¼Œéœ€è¦æ”¯æ’‘éƒ¨ä½ï¼ˆçº¢è‰²éƒ¨åˆ†ï¼‰åˆ™è¶Šå°ã€‚å»ºè®®45-50é—´ã€‚ ã€æ™®é€šæ”¯æ’‘ã€‘ å»ºè®®å‚æ•° æ”¯æ’‘å›¾æ¡ˆï¼šé”¯é½¿å½¢ æ”¯æ’‘å¯†åº¦ï¼š15-20ï¼Œ æ”¯æ’‘å¢™è¡Œæ•°ï¼š0 æ”¯æ’‘Zè·ç¦»ï¼šæ¨èæ¯”å±‚é«˜ç•¥å°ï¼ˆå¦‚ï¼š0.2å±‚é«˜ï¼Œè®¾ç½®ä¸º0.15ï¼‰ ä¸€èˆ¬æ­¤å‚æ•°ä¸º0.6~1.5å€å±‚é«˜ã€‚å½“æ¨¡å‹åº•é¢è¾ƒä¸ºå¹³ç¼“æ—¶ï¼Œå¯è®¾ç½®è¾ƒå¤§çš„é—´éš™ï¼Œå‡å°‘æ‹†æ”¯æ’‘éš¾åº¦ã€‚å½“æ¨¡å‹åº•é¢å˜åŒ–å¤§æ—¶ï¼Œåº”è®¾ç½®è¾ƒå°çš„é—´éš™ã€‚åŒæ—¶ï¼Œæ”¯æ’‘é—´éš™ä¸æ”¯æ’‘å¯†åº¦ä¹Ÿæœ‰å…³è”ï¼Œæ”¯æ’‘å¯†åº¦è¾ƒé«˜æ—¶ï¼Œå¯é€‚å½“æ‹‰å¤§é—´éš™ã€‚ æ”¯æ’‘XYè·ç¦»ï¼š1-1.5mm ã€æ ‘å½¢æ”¯æ’‘ã€‘ Curaæä¾›æ™®é€šæ”¯æ’‘å’Œæ ‘å‹æ”¯æ’‘ä¸¤ç§é€‰æ‹©ã€‚æ ‘å‹æ”¯æ’‘å¯¹æ¨¡å‹å½±å“æ›´å°ï¼Œä¹ŸèŠ‚çœææ–™ã€‚æ³¨æ„ï¼Œå®ƒåªé€‚åˆäºéå¹³é¢çš„æ‚¬ç©ºï¼Œå¦‚é¼»å°–ï¼ŒæŒ‡å°–æˆ–æ‹±å½¢ã€‚å¯¹äºå¹³é¢çš„æ‚¬ç©ºï¼Œæ ‘å½¢æ”¯æ’‘æ— æ³•æä¾›è¶³å¤Ÿçš„ç¨³å®šæ€§ã€‚ å»ºè®®å‚æ•° æ”¯æ’‘å›¾æ¡ˆï¼šé”¯é½¿å½¢ æ”¯æ’‘å¯†åº¦ï¼š15-20ï¼Œ æ”¯æ’‘å¢™è¡Œæ•°ï¼š1 è¿æ¥æ”¯æ’‘é”¯é½¿å½¢:å‹¾é€‰ æ”¯æ’‘Zè·ç¦»ï¼šæ¨èæ¯”å±‚é«˜ç•¥å°ï¼ˆå¦‚ï¼š0.2å±‚é«˜ï¼Œè®¾ç½®ä¸º0.15ï¼‰ ä¸€èˆ¬æ­¤å‚æ•°ä¸º0.6~1.5å€å±‚é«˜ã€‚å½“æ¨¡å‹åº•é¢è¾ƒä¸ºå¹³ç¼“æ—¶ï¼Œå¯è®¾ç½®è¾ƒå¤§çš„é—´éš™ï¼Œå‡å°‘æ‹†æ”¯æ’‘éš¾åº¦ã€‚å½“æ¨¡å‹åº•é¢å˜åŒ–å¤§æ—¶ï¼Œåº”è®¾ç½®è¾ƒå°çš„é—´éš™ã€‚åŒæ—¶ï¼Œæ”¯æ’‘é—´éš™ä¸æ”¯æ’‘å¯†åº¦ä¹Ÿæœ‰å…³è”ï¼Œæ”¯æ’‘å¯†åº¦è¾ƒé«˜æ—¶ï¼Œå¯é€‚å½“æ‹‰å¤§é—´éš™ã€‚ æ”¯æ’‘XYè·ç¦»ï¼š1-1.5 ä»€ä¹ˆæƒ…å†µå¯ä»¥ä¸åŠ æ”¯æ’‘ï¼Ÿ ã€è½»å¾®æŒ‘å‡ºã€‘æœ‰äº›æ¨¡å‹ä½ç½®æŒ‘ç©ºè·ç¦»ä¸è¿œï¼Œå¯ä»¥ä¸ç”¨åŠ æ”¯æ’‘ï¼Œå¦‚æµ®é›•çº¹ç†ã€è¡¨é¢è½»å¾®çªèµ·ç­‰ã€‚ï¼ˆæ¯”è¾ƒé€‚åˆå±‚é«˜è¾ƒå¤§ï¼Œä½é€Ÿä½æ¸©çš„è®¾ç½®ã€‚å…·ä½“æƒ…å†µéœ€æ ¹æ®ä¸åŒæ¨¡å‹åˆç†è¿ç”¨ï¼‰å¯åœ¨å·¦è¾¹å·¥å…·æ ç‚¹å‡»æ”¯æ’‘æ‹¦æˆªå™¨ï¼Œåœ¨ç›¸åº”ä½ç½®æ·»åŠ æ–¹å—å‡å°‘æ”¯æ’‘åº”ç”¨ã€‚ ã€æ‚¬ç©ºæ‹‰çº¿æ¨¡å‹ã€‘å¦‚ä¸‹å›¾çš„æ‹‰çº¿æ¨¡å‹ï¼Œæ‚¬ç©ºçš„æ‹‰çº¿ä»ä¸€ç«¯å¢™å£èµ°åˆ°å¦ä¸€ç«¯å¢™å£ï¼Œä¸¤ç«¯ç²˜è¿åœ¨æ”¯æ’‘ä½ç½®ä¸Šï¼Œåˆ™ä¸éœ€è¦æ”¯æ’‘ã€‚ï¼ˆæ³¨æ„ï¼šé¢„è§ˆæ‰“å°è¿‡ç¨‹ï¼Œçœ‹æ˜¯å¦ç¬¦åˆæ­¤æ¡ä»¶ï¼ŒåŒæ—¶ä¹Ÿæ¯”è¾ƒè€ƒéªŒæœºå™¨ï¼‰ åœ¨å¤©åœ°ä¸‡ç‰©é—´å¾œå¾‰,åœ¨æ·¡æ·¡ä¹¦é¦™ä¸­å¯»è§…äººç”Ÿè‡³å‘³ã€‚ Curaçš„å…¥é—¨æ•™ç¨‹å°±åˆ†äº«åˆ°è¿™ï¼Œæœ‰ç–‘é—®æˆ–æœ‰æ›´å¥½å»ºè®®çš„ä¼™ä¼´ä»¬ï¼Œå¯ä»¥ç•™è¨€åˆ†äº«ã€‚","tags":["clippings"],"categories":["5.åµŒå…¥å¼å¼€å‘","ç¡¬ä»¶çŸ¥è¯†","3Dæ‰“å°"]},{"title":"è·Ÿç€æ€å…¼å­¦ä¹ Klipper(16) Klipper ç½‘é¡µä½¿ç”¨æ‘„åƒå¤´æ¯”è¾ƒå…¨æŒ‡å—","path":"/2025/02/24/5-åµŒå…¥å¼å¼€å‘-ç¡¬ä»¶çŸ¥è¯†-3Dæ‰“å°-è·Ÿç€æ€å…¼å­¦ä¹ Klipper-16-Klipper-ç½‘é¡µä½¿ç”¨æ‘„åƒå¤´æ¯”è¾ƒå…¨æŒ‡å—/","content":"ã€æ€å…¼ã€‘Klipper ç½‘é¡µä½¿ç”¨æ‘„åƒå¤´æ¯”è¾ƒå…¨æŒ‡å—å‰è¨€åŸåˆ›æ–‡ç« ï¼Œè½¬è½½å¼•ç”¨è¯·åŠ¡å¿…æ³¨æ˜é“¾æ¥ã€‚æ°´å¹³æœ‰é™ï¼Œå¦‚æœ‰ç–æ¼ï¼Œæ¬¢è¿æŒ‡æ­£äº¤æµã€‚ æœ¬æ–‡åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šä¸€æ˜¯é’ˆå¯¹æˆ‘å‡ºå”®çš„ Klipper å…é©±æ‘„åƒå¤´çš„ä¸“æœ‰å†…å®¹ï¼ŒäºŒæ˜¯å…³äºä½¿ç”¨æ‘„åƒå¤´çš„é€šç”¨å†…å®¹ã€‚ æ–‡ç« å¦‚æœ‰æ›´æ–°è¯·è®¿é—® DFRobotç¤¾åŒº æˆ–è€… cnblogsåšå®¢å›­(æ’ç‰ˆæ›´å¥½)ã€‚ æ¬¢è¿å¯¹ Klipper å›ºä»¶æ„Ÿå…´è¶£ï¼Œä»¥åŠå¯¹æ”¹ç‰ˆ CNC åŠ å·¥çš„ Voron ä¸‰å‰æˆŸã€v0ã€v2.4 æ„Ÿå…´è¶£çš„æœ‹å‹åŠ ç¾¤äº¤æµï¼ˆQQ Groupï¼š490111638ï¼‰ ä¸€ã€ä¸“æœ‰å†…å®¹ | Exclusive Content è¯·ç»“åˆè§†é¢‘äº†è§£å¦‚ä½•å¿«é€Ÿå…¥é—¨ï¼šæ€å…¼çš„ Klipper å…é©±æ‘„åƒå¤´å¿«é€Ÿä½¿ç”¨æŒ‡å—ï¼Œåšè¿™ä¸ªä¸»è¦æ˜¯è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š ä¸Šä½æœºæ”¯æŒä»€ä¹ˆæ ·çš„æ‘„åƒå¤´å“ªäº›æ‘„åƒå¤´å…é©±? å“ªç§æ‘„åƒå¤´ä»·æ ¼ä¾¿å®œï¼Œæˆåƒè´¨é‡å¥½ï¼Ÿ å¦‚ä½•åœ¨ FluiddMainsailOctoprint ä¸­è®¾ç½®ä½¿ç”¨æ‘„åƒå¤´ï¼Ÿ ä¼—å¤šæ‘„åƒå¤´é€‰é¡¹ï¼Œå¦‚ä½•é…ç½®å’Œé€‰æ‹©ï¼Ÿ ä¸ºä»€ä¹ˆæˆ‘æ­¥éª¤éƒ½å¯¹ï¼Œå°±æ˜¯æ²¡æœ‰å›¾åƒï¼Œå¦‚ä½•æ’é™¤æ•…éšœï¼Ÿ é™¤äº†ç›‘æ§ï¼Œæ‘„åƒå¤´è¿˜æœ‰æ²¡æœ‰å…¶ä»–ç©æ³•ï¼Ÿ å…¶å®é¢„ç®—è¶³å¤Ÿï¼Œå¯ä»¥è€ƒè™‘è´­ä¹°è¿™ç¯‡æ–‡ç«  Best Cameras for OctoPrint of 2021 æ¨èçš„ï¼Œæ¯”å¦‚ ç½—æŠ€C270 ç­‰ã€‚ 1ã€å…³äº Klipper ä½¿ç”¨æ‘„åƒå¤´çš„ä¸€äº›é—®é¢˜# é™¤äº†æ ‘è“æ´¾ï¼Œå¤§éƒ¨åˆ†ä¸Šä½æœºéƒ½ä¸æ”¯æŒè§†é¢‘çš„ç¡¬ä»¶è§£ç  å¤§å¤šæ•°ä¸Šä½æœºä½¿ç”¨ CPU è½¯ä»¶è§£ç ï¼Œå¦‚æœæ€§èƒ½ä¸è¶³ä¼šå‡ºç°å¡æ»ç°è±¡ï¼Œå¯ä»¥é€‚å½“é™ä½åˆ†è¾¨ç‡å’Œå¸§ç‡ Fluidd é»˜è®¤çš„ 640x480@10fps å¤šèƒ½æ»¡è¶³éœ€æ±‚ é«˜æ€§èƒ½ CPU é…Œæƒ…ä½¿ç”¨ 800x600 åˆ†è¾¨ç‡ï¼Œå¹¶æ ¹æ®ä½¿ç”¨ç›®çš„è®¾ç½®å¸§ç‡ è¯·ä¸ºä¸Šä½æœºæä¾›ç¨³å®šä¾›ç”µï¼Œ5V@2A ä»¥ä¸Šæ¯”è¾ƒç¨³å¦¥ å’Œ Windows ä¸‹ä¸€æ ·ï¼Œæœ€å¤§åˆ†è¾¨ç‡ç”¨äºé™æ€æ‹ç…§ï¼Œè§†é¢‘å½•åˆ¶æ¨¡å¼æ— æ³•è¾¾åˆ°æœ€å¤§åˆ†è¾¨ç‡ MJPG-Streamer æ¯”è¾ƒåƒ CPU èµ„æºï¼ŒKlipperScreen æ¯”è¾ƒåƒå†…å­˜èµ„æº ä½¿ç”¨è¿‡ç¨‹ä¸­å»ºè®®ä¸ºä¸Šä½æœº CPU å¢åŠ ä¸»åŠ¨æ•£çƒ­ï¼Œæ‘„åƒå¤´èŠ¯ç‰‡å¯ä»¥è´´ä¸€ä¸ªå°æ•£çƒ­ç‰‡ å®‰è£…æ­¤ USB æ‘„åƒå¤´æ—¶ï¼Œè¯·ç¡®ä¿æ²¡æœ‰æ­£åœ¨æ‰§è¡Œæ‰“å°ä»»åŠ¡ï¼Œé¿å…æ„å¤–ä¸­æ–­é€šè®¯ åœ¨ä½æ€§èƒ½ CPU ä¸Šå¦‚æœæ‘„åƒå¤´ç§»åŠ¨è¿‡å¿«è¶…å‡º CPU å¤„ç†èƒ½åŠ›ï¼Œå¯èƒ½ä¼šå¯¼è‡´å›¾åƒå¡æ­»ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ ÂµStreamer æˆ–è€…é‡å¯ webcamd æœåŠ¡ï¼Œå¹¶å°½é‡å›ºå®šæ‘„åƒå¤´ä½ç½® 2ã€å®‰è£…ä½¿ç”¨ Klipper æ‘„åƒå¤´#2.1 å®‰è£…æ‘„åƒå¤´è½¯ä»¶ä¾èµ–#Copy# ä½¿ç”¨ä¸€é”®è„šæœ¬ï¼Œç¬¬ä¸€ç§æ–¹å¼ä¼šå¯¼è‡´ kiauh æŠ¥æ— æ•ˆå‚æ•°é”™è¯¯ï¼ŒåŸå› æš‚æœªçŸ¥ã€‚# è„šæœ¬é»˜è®¤ç­–ç•¥æ˜¯ä¸ç›¸ä¿¡æœ¬åœ°è½¯ä»¶ç¯å¢ƒï¼Œä¼šå¤‡ä»½å¹¶åˆ é™¤æ—§æ–‡ä»¶ï¼š.gitconfigã€klipper_config/webcamd.txtã€kiauh# curl -fsSL http://klipper.7130404.xyz:8001/enable_webcam.sh | bashbash (curl -fsSL http://klipper.7130404.xyz:8001/add_webcam.sh) 2.2 å®‰è£… MJPG-Streamer#å¦‚è§†é¢‘ä¸­æ‰€ç¤ºï¼Œåœ¨å‡ºç°çš„ KIAUH åŠ©æ‰‹ä¸­åˆ é™¤å¹¶é‡æ–°å®‰è£… MJPG-Streamerï¼š 2.3 æ·»åŠ æ‘„åƒå¤´#æ·»åŠ æ‘„åƒå¤´ï¼Œè®¾ç½®å¦‚ä¸‹ï¼Œåˆ·æ–°ä¸»é¢æ¿å³å¯çœ‹åˆ°æ‘„åƒå¤´å†…å®¹ï¼š MJPEG Stream | ä¼ ç»Ÿæ–¹å¼ï¼ŒFluidd è¢«åŠ¨æ¥æ”¶ ä¸Šä½æœºä¸Šçš„ MJPEG æœåŠ¡ä»¥ webcamd.txt ä¸­ é…ç½®å¥½çš„åˆ†è¾¨ç‡å’Œå¸§ç‡ æ¨é€æ¥çš„è§†é¢‘æµï¼ˆè¿ç»­çš„å›¾ç‰‡åºåˆ—ï¼‰ï¼Œæ­¤ç§æ–¹å¼å¤šæ•°æƒ…å†µä¸‹å ç”¨å¤§é‡å¸¦å®½ï¼Œå¹¶ä¸”ç½‘ç»œä¸ç¨³å®šæ—¶ä¼šå‡ºç°é—®é¢˜ã€‚ MJPEG Adaptive | æ¨èæ–¹å¼ï¼ŒFluidd ä¸»åŠ¨æ‹‰å– å•å¸§å›¾ç‰‡ç»„æˆè§†é¢‘æµï¼Œå› æ­¤ä½ å¯ä»¥è®¾ç½®åˆé€‚çš„å¸§ç‡ï¼Œæ­¤ç§æ–¹å¼æ›´ç¨³å®šï¼Œå ç”¨ç½‘ç»œå¸¦å®½ä¹Ÿæ›´å°ã€‚ IP Camera| å®éªŒæ€§é€‰é¡¹ï¼Œä»…æ”¯æŒ HTML5 è§†é¢‘ï¼Œå…·ä½“æœªæµ‹è¯•ã€‚ HTTP Page |ï¼ˆå†…åµŒç½‘é¡µï¼Œæ”¯æŒæ›´å¤šè§†é¢‘æ¥æºï¼‰ U4VL (Mainsail) 3ã€ä¿®æ”¹åŸºæœ¬å‚æ•°ï¼šåˆ†è¾¨ç‡å’Œå¸§ç‡#Copy# ä¿®æ”¹ ~/klipper_config/webcam.txt æœ€ä¸‹é¢ä¸€è¡Œcamera_usb_options=-r 640x480 -f 10 -y -d /dev/v4l/by-id/usb-Etron_Technology__Inc._USB2.0_Camera-video-index0# -r (resolution, åˆ†è¾¨ç‡)ï¼š640x480 ä¿®æ”¹ä¸ºä½ æƒ³è¦çš„åˆ†è¾¨ç‡å¦‚ 800x600# -f (fpsï¼Œå¸§ç‡)ï¼š10 ä¿®æ”¹ä¸º 25 é‡å¯ç”Ÿæ•ˆï¼šsudo systemctl restart webcamd äºŒã€é€šç”¨å†…å®¹ | Generic Content2.1 å¯ç”¨ç®€å•å®‰å…¨è®¤è¯ | Enable Authentication#Copy# ä¿®æ”¹ ~/klipper_config/webcam.txt ä¸‹é¢å‡ è¡Œ-#camera_http_options=-n+camera_http_options=-n -c [username]:[password] é»˜è®¤ä½¿ç”¨httpè®¿é—®æ—¶ï¼Œå¯†ç ä¼ è¾“é‡‡ç”¨æ˜æ–‡ï¼Œå­˜åœ¨ä¸€å®šå®‰å…¨éšæ‚£ï¼Œå¦‚éœ€æ›´ä¸¥æ ¼çš„å®‰å…¨ä¿æŠ¤ï¼Œè¯·å‚è€ƒ Secure Webcam streaming with MJPG-Streamer on a Raspberry Piã€‚ 2.2 å¯ç”¨å¤šæ‘„åƒå¤´ | Enable Multiple Cameras#å‚è€ƒé“¾æ¥å¦‚ä¸‹ï¼Œæ³¨æ„æ˜¯æœ‰å…ˆåä¼ æ‰¿é¡ºåºçš„ï¼Œå³ä½¿æ˜¯ä½¿ç”¨ Fluiddï¼ŒKIAUH ä¸‹è½½ä½¿ç”¨çš„æ‘„åƒå¤´ä¾èµ–è½¯ä»¶å’Œé…ç½®æ–‡ä»¶ä¹Ÿæ˜¯æ¥æºäº Mainsailï¼Œæ‰€ä»¥æˆ‘å¸¸è¯´ Fluidd æœ‰é—®é¢˜å¯ä»¥å»çœ‹ Mainsial æ–‡æ¡£ï¼š Setting up multiple webcams in OctoPi the right way Mainsail docs: Webcams Fluidd docs: Cameras | ä¸å»ºè®® ä¸»è¦æ“ä½œå°±æ˜¯ å¤åˆ¶ä¸€ä»½ webcam1.txt é…ç½®æ–‡ä»¶ æ›´æ”¹ç›‘å¬ç«¯å£ï¼š8080~8083ï¼Œå—é™äº nginx é»˜è®¤è®¾ç½®ï¼Œç›®å‰æœ€å¤šæ”¯æŒå››ä¸ªæ‘„åƒå¤´ã€‚ æ›´æ”¹æ•è·çš„è§†é¢‘è®¾å¤‡åœ°å€ï¼Œæ³¨æ„ç›¸åŒè®¾å¤‡çš„è¯ï¼Œæ‰€ä»¥é…ç½®æ–‡ä»¶éƒ½è¦æ›´æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ by-path é‡å¯æœåŠ¡ æ–°çš„è§†é¢‘åœ°å€ä¸º webcam2/?action=stream å¯¹åº” 8081 å¯¹åº” webcam1.txt aka é…ç½®æ–‡ä»¶ä» 0 å¼€å§‹ï¼Œæ‘„åƒå¤´åœ°å€ä» 1 å¼€å§‹ï¼Œfluidd çš„æ–‡æ¡£é”™äº† Copy# å¤åˆ¶ä¸€ä»½é…ç½®æ–‡ä»¶cp ~/klipper_config/webcam.txt ~/klipper_config/webcam1.txt# æ›´æ”¹ç›‘å¬ç«¯å£sed -i /#camera_http_options=/a camera_http_options=-n -p 8081 ~/klipper_config/webcam1.txt# ç”±äºåŒä¸€æ‘„åƒå¤´å…¶ id ç›¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ path æ¥è¿›è¡ŒåŒºåˆ†ï¼Œæ­¤å¤„ç±»ä¼¼ klipper çš„ serial åœ°å€æŸ¥æ‰¾æ–¹æ³•ï¼šls /dev/v4l/by-path/*# åœ°å€åˆ†åˆ«å¯¹åº”ä¸åŒçš„USBæ¥å£ï¼Œé€‰æ‹© index0 åœ°å€ä¿®æ”¹æ‰€æœ‰ webcam*.txtï¼Œä½¿æ¯ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„è®¾å¤‡å·ä¸åŒã€‚ä¾‹å¦‚camera_usb_options=-r 640x480 -f 10 -y -d /dev/v4l/by-path/platform-xhci-hcd.3.auto-usb-0:2:1.0-video-index0# é‡å¯æœåŠ¡ç”Ÿæ•ˆsudo systemctl restart webcamd.service 2.3 å¯ç”¨å»¶æ—¶æ‘„å½± | Enable Timelapse#ä¸Šæ¬¡ç ”ç©¶è¿™ä¸ªè¿˜æ˜¯åœ¨å»å¹´ 8 æœˆä»½ï¼Œç°åœ¨è¯¥ç»„ä»¶å·²ç»åˆå¹¶åˆ° Mainsail é‡Œé¢äº†ï¼Œè¯è¯´ Mainsail åŠŸèƒ½æ˜¯çœŸçš„ä¸°å¯Œï¼Œä¸æ’é™¤æœ‰ä¸€å¤©åˆ‡æ¢åˆ°å®ƒã€‚ é¡¹ç›®åœ°å€ï¼Œé¡¹ç›®é•œåƒåœ°å€ å®‰è£…æŒ‡å— Copy# å®‰è£… ffmpeg ç”¨äºåˆæˆè§†é¢‘sudo apt install ffmpeg# ä¸‹è½½å¹¶å®‰è£… moonraker timelapse ç»„ä»¶cd ~/ git clone https://hub.0z.gs/mainsail-crew/moonraker-timelapse.gitbash ~/moonraker-timelapse/install.sh é…ç½®å‚è€ƒ ä¿®æ”¹ printer.cfg å¦‚ä¸‹ Copy# printer.cfg[include timelapse.cfg] ä¿®æ”¹ moonraker.cfg å¦‚ä¸‹ Copy# moonraker.conf[timelapse]## ä»¥ä¸‹ä¸ºé»˜è®¤è®¾ç½®ï¼Œå¦‚æœéœ€è¦æ›´æ”¹è¯·å–æ¶ˆæ³¨é‡Š#output_path: ~/timelapse/## å­˜å‚¨ç”Ÿæˆçš„å»¶æ—¶æ‘„å½±è§†é¢‘ç›®å½•#frame_path: /tmp/timelapse/## å­˜å‚¨ä¸´æ—¶å›¾åƒçš„ç›®å½•#ffmpeg_binary_path: /usr/bin/ffmpeg## ffmpeg æ‰€åœ¨è·¯å¾„snapshoturl: http://localhost:8080/?action=snapshot## æ‘„åƒå¤´å¿«ç…§è®¿é—®åœ°å€ï¼Œå¦‚æœæœ‰å¤šä¸ªæ‘„åƒå¤´å¯ä»¥è®¾ç½®å…·ä½“çš„ç«¯å£å· æ–°ç‰ˆç»„ä»¶é‡‡ç”¨ moonraker API æ¥è¿›è¡Œä¿®æ”¹å‚æ•°ï¼Œå…·ä½“æŸ¥çœ‹ä¸Šé¢çš„æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨è®¾ç½®å‚æ•°ï¼Œè°ƒæ•´åˆ†è¾¨ç‡åœ¨ webcam.txt ä¸­ä¿®æ”¹ã€‚å¯ä»¥æ‰‹åŠ¨åœ¨æ§åˆ¶å°è¾“å…¥ TIMELAPSE_TAKE_FRAME æ‹æ‘„å›¾ç‰‡ã€‚ æ³¨æ„ï¼š å³ä½¿ç½‘é¡µæ²¡æœ‰æ·»åŠ æ‘„åƒå¤´ï¼Œå›¾åƒå’Œè§†é¢‘ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡ä¸Šè¿°è¢«è®¿é—®çš„ï¼Œä½†æ˜¯å³ä½¿æ²¡æœ‰æ˜¾ç¤ºï¼Œç³»ç»Ÿèµ„æºä¹Ÿä¼šè¢«å ç”¨ å»¶æ—¶æ‘„å½±ç›¸å…³å® ä¸æ”¯æŒå¯†ç è®¿é—® çš„æ‘„åƒå¤´ ç”¨ä½œå»¶æ—¶æ‘„å½±çš„æ‘„åƒå¤´å¯ä»¥é‡‡ç”¨é«˜åˆ†è¾¨ç‡ä½å¸§ç‡ï¼Œå¦‚ 1600x1200@7fps ä¼˜åŒ–ï¼šåˆ›å»ºè½¯é“¾æ¥ï¼Œæ–¹ä¾¿ç›´æ¥åœ¨ç½‘é¡µæŸ¥çœ‹å›¾ç‰‡å’Œä¸‹è½½è§†é¢‘ Copymkdir /home/pi/gcode_files/timelapse/ln -s /tmp/timelapse/ /home/pi/gcode_files/timelapse/tmpln -s /home/pi/timelapse/ /home/pi/gcode_files/timelapse/video 2.4 ä½¿ç”¨äººå·¥æ™ºèƒ½è‡ªåŠ¨æ£€æµ‹æ‰“å°å¤±è´¥#å¯ä»¥å€ŸåŠ© The Spaghetti Detective (TSD) æœåŠ¡æ¥è‡ªåŠ¨æ£€æµ‹ç‚’é¢ï¼Œå…è´¹æœåŠ¡å—é™é¢‡å¤šï¼Œå¯ä»¥ è‡ªå·±æ­å»ºæœåŠ¡å™¨ ä½¿ç”¨ï¼Œæˆ‘æ‰‹é‡Œæœ‰ä¸€å° Jetson Nano å¯ä»¥ç”¨äºæµ‹è¯•ã€‚ combines improved webcam streaming with AI-driven print failure detection. You can access your printerâ€™s webcam feed from any device, and time-lapses of all your past prints are available on your TSD dashboard. An additional beta feature is a secure tunnel through which you can access your entire OctoPrint interface from any device. æ—¢å¾€åœ¨ Octoprint ç³»ç»Ÿä¸Šå®‰è£…æ’ä»¶ä½¿ç”¨ ç›®å‰æœ‰ä¸€ä¸ª moonraker ç»„ä»¶ å¯ä¾›æµ‹è¯•ä½¿ç”¨ã€‚ æ­¤å¤– TSD è¿˜æœ‰ä¸€ä¸ª æ‘„åƒå¤´æ”¾ç½®å»ºè®®ï¼Œå€¼å¾—ä¸€çœ‹ã€‚ TSD å…è´¹ç‰ˆé™åˆ¶ï¼š Limited to 1 printer. Basic Streaming is at 0.1fps (1 frame per 10 seconds). The stream is on only when the printer is printing. 10 free Detective Hoursmonth included Unused Detective Hours roll over month to month. You can also earn free Detective Hours by helping her improve. 50MB month Tunneling Detective Hour is sometimes abbreviated as DH. 2.5 ä½¿ç”¨ ÂµStreamer æ›¿ä»£ MJPG-Streamer#è™½ç„¶æ­¤å®éªŒç‰ˆ MJPG-Streamer ä½¿ç”¨ libjpeg-turbo è€Œéæ™®é€šçš„ libjpeg åº“è¿›è¡Œç¼–è¯‘ï¼Œç¼–è§£ç é€Ÿåº¦æœ‰æ‰€æå‡ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¼˜åŒ–ç©ºé—´ã€‚è¿™é‡Œä»‹ç»å¦ä¸€ä¸ªç±»ä¼¼çš„æ”¹è¿›é¡¹ç›®ï¼šÂµStreamerï¼Œå®ƒæ˜¯è¿™ä¹ˆè‡ªæˆ‘ä»‹ç»çš„ï¼šÂµStreamer - Lightweight and fast MJPEG-HTTP streamer ä¹Ÿå°±æ˜¯æ›´è½»é‡æ›´å¿«é€Ÿçš„ MJPG-Streamer æ›¿ä»£æœåŠ¡ã€‚æˆ‘æµ‹è¯•ä¸‹æ¥ä¼˜ç‚¹æ˜æ˜¾ï¼Œæ¯”å¦‚ï¼š ä»£ç é…ç½®æ›´ç®€æ´ æ”¯æŒå¤šçº¿ç¨‹ JPEG ç¼–ç  æ”¯æŒæ ‘è“æ´¾çš„ç¡¬ä»¶ç¼–ç ï¼ŒåŸºäº V4L2 M2M æ”¯æŒæ–­çº¿é‡è¿åä¿¡å·æ¢å¤ï¼Œè€Œæ— éœ€é‡å¯æœåŠ¡ æ”¯æŒæ§åˆ¶ GPIO è¾“å‡º æ”¯æŒ WebRTC ä¸²æµï¼Œé™ä½ç½‘ç»œå¸¦å®½å ç”¨ï¼Œå€ŸåŠ© Janus å’Œ H.264 å…¼å®¹ mjpg-streamer API ä½†æ˜¯æ€§èƒ½ä¸å¦‚ mjpg-streamerï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æˆ‘å‚æ•°è®¾ç½®ä¸æ­£ç¡®ã€‚å¥½å¤„æ˜¯å‡ ä¹å¯ä»¥å®Œå…¨æ›¿ä»£åè€…ï¼Œåé¢ä¼šæŒç»­å…³æ³¨å®ƒã€‚ åˆ›å»º systemd æœåŠ¡è¯·å‚è€ƒï¼šinit.d and systemctl scriptsï¼ŒÂµStreamer ä¸éœ€è¦ webcamd å’Œ webcam.txtã€‚ 2.6 é™ä½ç³»ç»Ÿå’Œå¸¦å®½å ç”¨ (TBD)#ç›®çš„æ˜¯ç ”ç©¶å¦‚ä½•ä¼˜åŒ–æ€§èƒ½ã€æé«˜æµç•…åº¦ï¼Œä»¥ä¸‹é¡¹ç›®éœ€è¦æ•´ç†ã€æµ‹è¯•ã€éªŒè¯ã€‚ç¡¬ä»¶åŠ é€ŸåŸºæœ¬å°±é™å®šæ ‘è“æ´¾äº†ã€‚ Fluidd HTTP Page ï¼šAdd camera iframe option with height option Uses less bandwidth and runs with hw accel in your browser but needs to be setup as a simple web page åŸºäº pi-h264-to-browser |RPi Cam Pi H264 To Browser is a simple Python application designed to stream hardware encoded h.264 from a Raspberry Pi equiped with a V1, V2, or HQ camera module, directly to a browser. ä»¥åŠ h264 webrtc-streamer I set up webrtc-streamer to get a very low latency (and low bandwidth) camera feed from my printer into a browser, sadly fluiddâ€™s options do not allow me to embed that at all. .webrtc-streamer -vvv v4l2:devvideo1 https://www.cnblogs.com/savorboard/p/webrtc-rtsp.html https://community.octoprint.org/t/js-help-needed-better-webcam-streaming-webrtc/4969/10 h264rcam | This project was inspired by pi-h264-to-browser ï¼Œh264rcam provides an easy way to get a Raspberry Pi Camera stream inside web browser. https://askubuntu.com/questions/881305/is-there-any-way-ffmpeg-send-video-to-dev-video0-on-ubuntu4. U4VL | https://www.jianshu.com/p/c08d68a1a505 2.7 è¿œç¨‹ç›‘æ§#å…³äºè¿™éƒ¨åˆ†æˆ‘æ²¡æœ‰éœ€æ±‚ï¼Œç®€å•è¯´è¯´ã€‚ å»ºè®®ä½¿ç”¨è¤çŸ³ç­‰å®¶ç”¨ç›‘æ§æ‘„åƒå¤´è¿›è¡Œç›‘æ§ï¼Œè‡ªå¸¦è¿œç¨‹è®¿é—®åŠŸèƒ½ æœ‰è®¿é—®æ¡ä»¶çš„å¯ä»¥ä½¿ç”¨ telegram-bot åŸºæœ¬æ–¹æ³•å°±æ˜¯æš´éœ² 8080 ç«¯å£ï¼Œåšå¼ºåŠ å¯†ï¼›æˆ–è€…ä½¿ç”¨ VPN è¿˜å¯ä»¥æ¨æµåˆ° B ç«™ å¦å¤–å®¶ç”¨å®½å¸¦å¦‚æœä¸Šè¡Œä¸‹è¡Œä¸å¯¹ç­‰ï¼Œä¸Šè¡Œå¸¦å®½è¾ƒå°æ—¶æ•ˆæœå¯èƒ½ä¸å¥½ å¦‚æœæƒ³è¦è¿›è¡Œè¿œç¨‹æ§åˆ¶æ‰“å°æœºï¼Œå®‰å…¨èµ·è§å»ºè®®åªæš´éœ² moonraker 7125 ç«¯å£ï¼Œä¸è¦æš´éœ² 80 ç«¯å£ï¼ˆè¿è¥å•†å¯èƒ½ä¹Ÿä¸æ„¿æ„ï¼‰ï¼Œå¯ä»¥è®¿é—® app.fluidd.xyz æˆ–è€… my.mainsail.xyz è®¿é—®ã€‚å¦‚æœæ˜¯è‡ªæœ‰åŸŸåï¼Œä¸€æ˜¯å¯ä»¥åˆ›å»ºç”¨æˆ·ï¼ŒäºŒæ˜¯å¯ä»¥ä¿®æ”¹ cors_domains ç­–ç•¥ã€‚ ä¸‰ã€å…¶ä»–æ‘„åƒå¤´æ–¹æ¡ˆ3.1 æ ‘è“æ´¾æ‘„åƒå¤´ | RPi Cam# æ³¨æ„ï¼šæ ‘è“æ´¾å®˜æ–¹ä»¥åŠä¸€äº›ä¼˜è´¨å‚å•†æä¾›çš„æ‘„åƒå¤´è´¨é‡å¾ˆä¸é”™ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›å…¼å®¹æ ‘è“æ´¾å¼•è„šçš„åŠ£è´¨æ‘„åƒå¤´å­˜åœ¨ï¼Œæ³¨æ„ç”„åˆ«ã€‚ æ ‘è“æ´¾å®˜æ–¹æ‘„åƒå¤´å‡ºäº† 3 ä»£ï¼Œ1ä»£æ”¯æŒè‡ªåŠ¨å¯¹ç„¦ï¼›2ä»£ä¸æ”¯æŒè‡ªåŠ¨å¯¹ç„¦ï¼Œä½†æ˜¯æ€§èƒ½æ›´å¥½ï¼›3ä»£è¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚ æˆ‘ä»¬è¿™é‡Œéƒ½ä»¥ Raspberry Pi OS Bullseye ä¸ºä¾‹ï¼Œä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œè¯´æ˜¯æ–°ç‰ˆä¼šè‡ªåŠ¨ä¾¦æµ‹å¹¶å¯ç”¨ï¼Œä½†æ˜¯å¯¹äº RPi3 ç­‰è€å‹å·ï¼Œè¿˜éœ€è¦è®¾ç½®ä»¥å¯åŠ¨ç¡¬ä»¶åŠ é€Ÿï¼š sudo raspi-config â€”â€” Advanced Options â€”â€” Glamor â€”â€” Yes ï¼Œé‡å¯ç”Ÿæ•ˆã€‚ ç„¶åé…ç½®æ–‡ä»¶ä¿®æ”¹åˆ†è¾¨ç‡å¸§ç‡å³å¯ã€‚æ›´å¤šå†…å®¹å¯ä»¥æŸ¥çœ‹ å®˜æ–¹æ–‡æ¡£ã€‚ä¸è¿‡æœ€å¥½è´­ä¹°å®˜æ–¹çš„æ‘„åƒå¤´ï¼Œå¾ˆå¤šå¾ˆä¾¿å®œçš„æ‘„åƒå¤´æ˜¾ç¤ºè´¨é‡å¾ˆå·®ã€‚ 3.2 æ‰‹æœºä½œä¸ºæ‘„åƒå¤´ä½¿ç”¨#å‰é¢è®²è¿‡æ—§æ‰‹æœºå¯ä»¥å……å½“ KlipperScreen çš„æ˜¾ç¤ºè§¦æ‘¸å±ï¼Œå…¶å®æ—§æ‰‹æœºçš„æ‘„åƒå¤´ä¹Ÿå¯ä»¥ä¸ºæˆ‘æ‰€ç”¨ã€‚æœ€åˆå°è¯•æˆ‘å¸¸ç”¨çš„ç”± æ²ˆåš å¼€å‘çš„ IPæ‘„åƒå¤´ï¼Œä¸‹å›¾é»„é»‘è‰²å›¾æ ‡ï¼Œåªèƒ½ä»¥ http page æ–¹å¼ä½¿ç”¨ï¼›äºæ˜¯æœç´¢ä¸‹è½½å®‰è£…äº†ç¬¬äºŒæ¬¾å›½å¤–å¼€å‘çš„é»‘ç°è‰²å›¾æ ‡çš„ IPæ‘„åƒå¤´ ï¼ˆä¸‹æ–‡ç§°ä¸º IP Webcamï¼‰ æµ‹è¯•æˆåŠŸã€‚xapk å®‰è£…å™¨ ä¸‹è½½åœ°å€ã€‚æ³¨æ„å¦‚æœæ˜¯ 32bit è€å®‰å“æ‰‹æœºï¼Œè¦æ‰¾åˆ°è€ç‰ˆæœ¬ APK çš„ä¸‹è½½ã€‚ ç°è‰²æ‘„åƒå¤´è½¯ä»¶çš„ç•Œé¢å¦‚ä¸‹å›¾æ‰€ç¤ºåŠŸèƒ½å¼ºå¤§ï¼Œå…è´¹ç‰ˆåŠŸèƒ½å°±å¤Ÿç”¨äº†ã€‚https://www.dev47apps.com/https://wolicheng.com/womic/ ã€å›¾ ã€‘IP Webcam APP ç•Œé¢ï¼Œæ”¯æŒè¯»å–ä¼ æ„Ÿå™¨æ•°æ®ï¼Œæ‰€ä»¥æœ‰æ— å¯èƒ½æ ¹æ®é™€èºä»ªåšè§†é¢‘åå¤„ç†ï¼Œæˆ–è€… GoPro é‚£ç§è‡ªç¨³è§†é¢‘æ•ˆæœï¼Ÿ ã€å›¾ ã€‘IP Webcam ç½‘é¡µç®¡ç†ç•Œé¢ï¼Œæ”¯æŒå¤šç§æ“ä½œï¼Œä»¥åŠå¼€å¯ LED é—ªå…‰ç¯ç­‰åŠŸèƒ½ï¼Œè¿˜å¯ä»¥è®¾ç½®ç†„å±å’Œç½‘é¡µç®¡ç†ï¼Œç¾æ»‹æ»‹ã€‚ å…¶ä»–å€¼å¾—å…³æ³¨çš„è½¯ä»¶è¿˜åŒ…æ‹¬ï¼š DroidCam | é«˜çº§åŠŸèƒ½éœ€è¦æ”¶è´¹ WO Mic | æ— çº¿éº¦åŠŸèƒ½ æ‰‹æœºç‰©ç†å·¥åŠ | æ‰‹æœºç‰©ç†å·¥åŠ â€“ åˆ©ç”¨ 8 ç§æ‰‹æœºä¼ æ„Ÿå™¨ï¼Œåšæœ€å¼ºç‰©ç†å®éªŒï¼Œå¯ä»¥ä¿å­˜é™€èºä»ªç­‰æ•°æ® Gyroflow | ç»“åˆé™€èºä»ªæ•°æ®ï¼Œä½¿è§†é¢‘å®ç° GoPro ç±»ä¼¼æ•ˆæœï¼ˆå¤§æ¦‚è¿™æ ·ï¼‰ å››ã€è¿›é˜¶çŸ¥è¯†4.1 è·å– USB-Camera å‚æ•°#Copy# å®‰è£…æ‰€éœ€å·¥å…·åŒ…sudo apt install v4l-utils usbtop# æŸ¥çœ‹å·²è¿æ¥çš„æ‘„åƒå¤´è®¾å¤‡v4l2-ctl --list-devices# å¦‚æœæ²¡æœ‰è¯†åˆ«åˆ°ç›¸åº”è®¾å¤‡ï¼Œè¯·æ£€æŸ¥è®¾å¤‡æ˜¯å¦è¿æ¥è‰¯å¥½ï¼Œä»¥åŠ lsusbã€dmesg ç­‰å‘½ä»¤æŸ¥çœ‹æ˜¯å¦è¢«ç³»ç»Ÿè¯†åˆ«# æŸ¥çœ‹å¯¹åº”æ‘„åƒå¤´çš„æ”¯æŒæ ¼å¼v4l2-ctl -d [/dev/video1] --list-formats-extv4l2-ctl --device=/dev/video* --all# æŸ¥çœ‹å¹¶è®¾ç½®æ‘„åƒå¤´æ”¯æŒçš„æ§åˆ¶å‚æ•°v4l2-ctl -d /dev/video0 --list-ctrls# v4l2-ctl -d /dev/video1 --set-ctrl=zoom_absolute=170 ç”±ä¸Šå›¾æˆ‘ä»¬å°±å¯ä»¥è·å¾—æ‰€éœ€çš„é…ç½®ï¼š æ‘„åƒå¤´è®¾å¤‡åœ°å€ä¸ºï¼š/dev/video0ï¼Œé video1 æˆ–è€… media0 æ­¤æ‘„åƒå¤´æ”¯æŒçš„æœ€å¤§åˆ†è¾¨ç‡å’Œå¯¹åº”çš„å¸§ç‡ä¸º 1600Ã—1200ï¼Œäº¦å³ 1080Pï¼Œ çºµæ¨ªæ¯”ä¸º 4:3ã€‚ ç”¨äº FluiddMainsail ç½‘é¡µå‰ç«¯ä½¿ç”¨æ—¶ï¼Œå¯ä»¥é€‰æ‹© 800Ã—600@25fps ä»¥è·å–è¾ƒå¥½çš„æ˜¾ç¤ºå…¼å®¹æ€§å’Œè¾ƒä½çš„ç³»ç»Ÿå ç”¨ï¼Œå‡å°‘ CPU å‘çƒ­ï¼Œé™ä½æ‰“å°ç®¡ç†è¿›ç¨‹è¢«å¹²æ‰°çš„å¯èƒ½ã€‚ ç¼–ç æ–¹æ³•ä¸º YUYVï¼Œåœ¨é…ç½®å‚æ•°ä¸­æ·»åŠ  -y é€‰é¡¹ã€‚æ­¤å¤–æœ‰çš„æ‘„åƒå¤´è¿˜æ”¯æŒ MJPG ç­‰ç¼–ç æ–¹å¼ã€‚ ç•ªå¤–ï¼š# é€šè¿‡ lsusb å‘½ä»¤è·å–è®¾å¤‡ Vendor ID å’Œ Device ID å¯ä»¥æŸ¥è¯¢åˆ°ç›¸å…³è®¾å¤‡ä¿¡æ¯ã€‚ â€‹ ç»§è€Œå¯ä»¥ä»ä»¥ä¸‹ç½‘å€æŸ¥è¯¢ç›¸å…³ä¿¡æ¯ï¼š DEVICE HUNT linux-usb.org å›¾å½¢åŒ–è®¾ç½®æ‘„åƒå¤´å‚æ•°å·¥å…·ï¼šv4l2ucp è·å–æ›´å¤š mjpg_streamer é€‰é¡¹ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹ octoprintæ–‡æ¡£ ä¹Ÿå¯ä»¥æŸ¥çœ‹å¸®åŠ©æ–‡ä»¶ Copyudevadm info --attribute-walk /dev/bus/usb/[Bus]/[Device]cd ~/mjpg_streamer./mjpg_streamer -i input_uvc.so --help./mjpg_streamer -o output_http.so --help 4.2 å›ºå®šæ‘„åƒå¤´è®¾å¤‡åœ°å€#åœ¨æœ‰å¤šä¸ª video è®¾å¤‡æ—¶ï¼Œæ’æ‹”æ‘„åƒå¤´åï¼Œå…¶ /dev/video[num] ç¼–å·å¯èƒ½ä¼šå‘ç”Ÿæ”¹å˜ï¼Œä»è€Œå¯¼è‡´æ‘„åƒå¤´é…ç½®æ–‡ä»¶å¤±æ•ˆï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¾ˆå¤šäººåŸæ¥ç”¨çš„å¥½å¥½çš„ï¼Œæ’æ‹”ä¹‹åä¸èƒ½ç”¨çš„åŸå› ã€‚ æ­¤å¤–æœ‰äº›è®¾å¤‡è‡ªå¸¦ devvideo0 è®¾å¤‡ï¼Œè€Œ webcamd ä¼šé»˜è®¤è¯»å–ç¬¬ä¸€ä¸ª video è®¾å¤‡ï¼Œåº”è¯¥è®¿é—® video1 å´è®¿é—®äº† video0ã€‚ 4.2.1 Method 1ï¼šåˆ›å»º udev è§„åˆ™ï¼ˆä¸æ¨èï¼‰#å‚è€ƒ Archwiki ï¼Œåˆ›å»º udev è§„åˆ™ï¼š Copy# /etc/udev/rules.d/83-webcam.rulesKERNEL==video[0-9]*, SUBSYSTEM==video4linux, SUBSYSTEMS==usb, ATTRSidVendor==1e4e, ATTRSidProduct==0109, ATTRindex==0, SYMLINK+=video-cam1 ä½¿ç”¨ sudo udevadm control --reload å‘½ä»¤å¯ä»¥å¼ºåˆ¶é‡è½½ç”Ÿæ•ˆ udev è§„åˆ™ï¼Œé‡æ–°æ’æ‹” USB æ‘„åƒå¤´å³å¯çœ‹åˆ°æ–°çš„ video-cam1 è®¾å¤‡ åŒæ—¶ä¿®æ”¹ webcamd.txt æŒ‡å®šè®¾å¤‡åœ°å€ -d /dev/video-cam1ï¼Œé‡å¯ webcamd æœåŠ¡ç”Ÿæ•ˆ æ³¨æ„è®¾å¤‡åç§°å¿…é¡»ä»¥ video å¼€å¤´ï¼Œä»¥è¢« v4l ä½¿ç”¨ æ¯”è¾ƒå¥‡æ€ªçš„æ˜¯ ls -al /dev/video-cam1 å¯ä»¥çœ‹åˆ°é“¾æ¥åˆ° video2ï¼ˆä¸æ˜¾ç¤ºå‚æ•°é‚£ä¸ªï¼‰ï¼Œä½†æ˜¯æ‰‹åŠ¨ä¿®æ”¹ webcamd.txt åˆåªèƒ½ç”¨ video1 æ‰è¡Œ å‘ç° mjpg_streamer ä»…æ”¯æŒ video[0-9]ï¼Œä¸æ”¯æŒä¸Šè¿°å‘½åæ ¼å¼ï¼Œwebcamd.log çœ‹åˆ°ä¼šè‡ªåŠ¨å¿½ç•¥ å¦‚æœåˆ¶å®šçš„è®¾å¤‡åœ°å€æ— æ•ˆï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ç¬¬ä¸€ä¸ª video è®¾å¤‡ï¼Œä»è€Œæœ‰å¯èƒ½å‡ºé”™ æ›´å¤šä¿¡æ¯å¯ä»¥å‚è€ƒ Webcam ordering is not persistent in Linux 4.2.2 Method 2ï¼šä½¿ç”¨ v4l è®¾å¤‡åœ°å€#è¿™ä¸ªå¾ˆåƒ Klipper è·å– serial è®¾å¤‡åœ°å€çš„æ–¹æ³•ï¼Œä¸ä¼šå‡ºç°é‡æ–°æ’æ‹”åå‡ºé”™çš„é—®é¢˜ï¼Œå¯¼è‡´ ttyAMA0 ç­‰è®¾å¤‡æ— æ³•å¯¹åº”ï¼Œklipper è¯»å–çš„æ˜¯ /dev/serial/by-id/*ï¼Œæ‘„åƒå¤´è¯»å–çš„æ˜¯ /dev/v4l/by-id/* ï¼ŒåŒæ ·ä¹Ÿé¢ä¸´ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ CH340 è®¾å¤‡çš„ id ç›¸åŒï¼Œæ­¤æ—¶å¤šä¸ª MKS Gen L ç­‰ä¸»æ¿æ— æ³•åŒºåˆ†ï¼Œæ­¤é—®é¢˜åŒæ ·ä¹Ÿå‡ºç°åœ¨è¿™é‡Œï¼Œè§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ /dev/v4l/by-path/*ï¼Œæ­¤è·¯å¾„ä¸USBæ¥å£ç»‘å®šã€‚ 4.3 ä¸ºä»€ä¹ˆä¸€ä¸ªç‰©ç†æ‘„åƒå¤´ï¼Œæœ‰å¤šä¸ª video è®¾å¤‡ï¼Ÿ#å‚è€ƒè¿™ä¸ªå›ç­”ï¼šMultiple devvideo for one physical device ï¼Œå¯çŸ¥ç¬¬ä¸€ä¸ªç”¨äºä¼ é€’å›¾åƒï¼Œç¬¬äºŒä¸ªç”¨äºä¼ é€’ V4L MetaDataï¼ŒåŒ…å«æ—¶é—´æˆ³ä»¥åŠå›¾åƒæ•æ‰å‚æ•°ç­‰ä¿¡æ¯ã€‚ The second device provides metadata about the video data from the first device. 4.4 å°†æ‘„åƒå¤´å›¾åƒè¾“å‡ºåˆ°å±å¹•#å‚è€ƒ Viewing an mjpeg stream with mplayer Copysudo apt install -y mplayermplayer -nolirc -vo fbdev2 -zoom -x 320 -y 240 test.mpgmplayer -fps 4 -demuxer lavf http://localhost:8080/?action=stream 4.5 æŸ¥çœ‹å¸¦å®½ã€æ•°æ®ååé‡# nethogs | ç”¨äºæŸ¥çœ‹ç½‘ç»œå¸¦å®½ååé‡ï¼Œä¼˜åŒ–è°ƒè¯•ä½¿ç”¨ã€‚å¯ä»¥çœ‹åˆ° jpeg è´¨é‡å¯¹å¸¦å®½å ç”¨å½±å“å¾ˆå¤§ Copysudo nethogs# ä½¿ç”¨ r å’Œ s é”®æ¥æ’åºä¼ å…¥å’Œä¼ å‡ºçš„å®æ—¶åŠç´¯è®¡æ•°æ®é‡ **usbtop ** | ç”¨äºæŸ¥çœ‹ USB æ¥å£æ•°æ®ååé‡ï¼Œä¹Ÿå¯ä»¥è§‚å¯Ÿä¸Šä½æœºä¸€å¸¦å¤šæƒ…å†µ Copy# åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„USBæ€»çº¿usbtop --list# ç›‘æ§ç‰¹å®šUSBæ€»çº¿ä¸Šçš„å¸¦å®½æµé‡sudo usbtop --bus [usbmon1]","tags":["clippings"],"categories":["5.åµŒå…¥å¼å¼€å‘","ç¡¬ä»¶çŸ¥è¯†","3Dæ‰“å°"]},{"title":"QTableWidgetå¤§é‡æ•°æ®å¤„ç†","path":"/2025/02/22/3-å¼€å‘æ¡†æ¶-Qt-æ§ä»¶-QTableWidgetå¤§é‡æ•°æ®å¤„ç†/","content":"Qt å¤§æ•°æ®åˆ—è¡¨å±•ç¤ºä¼˜åŒ–æ–¹æ¡ˆåœ¨ Qt ä¸­ä½¿ç”¨ QListWidgetã€QTableWidget æˆ– QTreeWidgetï¼ˆæœ€å¤šæ”¯æŒä¸‰å±‚ç»“æ„ï¼‰è¿›è¡Œå¤§æ•°æ®åˆ—è¡¨å±•ç¤ºæ—¶ï¼Œé€šå¸¸ä¼šé‡åˆ°åŠ è½½ç¼“æ…¢å’Œå†…å­˜å ç”¨é«˜çš„é—®é¢˜ã€‚å…¶ä¸»è¦åŸå› æ˜¯åˆ›å»ºäº†è¿‡å¤šçš„å­ Widgetï¼Œå¯¼è‡´ç³»ç»Ÿèµ„æºç´§å¼ ï¼Œå½±å“ç•Œé¢å“åº”é€Ÿåº¦ã€‚ é—®é¢˜åˆ†æå½“åˆ—è¡¨ä¸­çš„æ•°æ®é‡è¾¾åˆ°ä¸Šåƒç”šè‡³ä¸Šä¸‡æ¡æ—¶ï¼Œå¦‚æœä¸ºæ¯ä¸€æ¡æ•°æ®éƒ½åˆ›å»ºä¸€ä¸ª Widget å®ä¾‹ï¼Œçª—å£ç®¡ç†å’Œå†…å­˜å ç”¨éƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚å®é™…ä¸Šï¼Œåˆ—è¡¨çš„å¯è§†åŒºåŸŸé«˜åº¦æ˜¯æœ‰é™çš„ï¼Œé€šå¸¸åªéœ€è¦å°‘é‡çš„ Widget ä¾¿å¯å¡«æ»¡å±å¹•ã€‚ æ ¸å¿ƒä¼˜åŒ–æ€è·¯ä¸ä¸ºæ¯æ¡æ•°æ®åˆ›å»º Widgetï¼Œè€Œæ˜¯ï¼š **ä»…åˆ›å»ºå¯è§†èŒƒå›´å†…çš„ Widget**ï¼Œå…¶ä½™æ•°æ®é€šè¿‡é€»è¾‘æ§åˆ¶è¿›è¡Œæ˜¾ç¤ºä¸éšè—ã€‚ **å¤ç”¨å·²åˆ›å»ºçš„ Widget**ï¼Œå½“æ»šåŠ¨æ¡æ»šåŠ¨æ—¶ï¼Œå°†è¶…å‡ºå±å¹•çš„ Widget éšè—ï¼Œå¹¶ç”¨å…¶å±•ç¤ºæ–°çš„æ•°æ®ï¼Œè€Œä¸å†æ–°å»ºå®ä¾‹ã€‚ ä»…åœ¨ Widget æ•°é‡ä¸è¶³æ—¶åˆ›å»ºæ–°çš„ Widgetï¼Œç¡®ä¿å§‹ç»ˆåªå ç”¨ä¸€ä¸ªå±å¹•æ‰€éœ€çš„ Widget æ•°é‡ã€‚ å®ç°æ­¥éª¤1. ç»„ä»¶ç»„æˆ **m_widgets**ï¼šç¼“å­˜æ‰€æœ‰å·²åˆ›å»ºçš„ Widgetï¼Œé¿å…é‡å¤åˆ›å»ºã€‚ **çˆ¶ Widget**ï¼šå®¹çº³å­ Widget å’Œæ»šåŠ¨æ¡ï¼Œç¡®ä¿å­ Widget åœ¨å…¶ä¸­é€‚å½“å¸ƒå±€ã€‚ æ»šåŠ¨æ¡ï¼šæ§åˆ¶å¯è§†èŒƒå›´ï¼ŒåŠ¨æ€è°ƒæ•´å¯è§ Widgetã€‚ 2. å¤ç”¨ WidgetQListItemWidget* m_widgets; // å­˜å‚¨æ‰€æœ‰åˆ›å»ºçš„å­ WidgetItemWidget *TreeWidget::getWidget(const ItemInfo info) ItemWidget *widget = nullptr; // æŸ¥æ‰¾å·²å­˜åœ¨ä½†éšè—çš„ Widgetï¼Œç›´æ¥å¤ç”¨ for (int i = 0; i m_widgets.size(); i++) if (m_widgets[i]-data().type == info.type !m_widgets[i]-isVisible()) widget = m_widgets[i]; break; // è‹¥æ‰¾ä¸åˆ°å¯å¤ç”¨ Widgetï¼Œåˆ™åˆ›å»ºæ–°çš„ if (widget == nullptr) if (info.type == Top) widget = new TopWidget(this); else if (info.type == Parent) widget = new ParentWidget(this); else if (info.type == Child) widget = new ChildWidget(this); else Q_ASSERT(0); // ç»‘å®šä¿¡å·æ§½ connect(widget, ItemWidget::sigMousePress, [this, widget]() if (widget-data().type != Child) ItemInfo newInfo = widget-data(); newInfo.isExpand = !newInfo.isExpand; updateItemInfo(newInfo); refreshWidgets(); else gotoSelected(widget-data().id); emit sigItemMousePress(widget-data()); ); connect(widget, ItemWidget::sigMouseDoubleClick, [this, widget]() emit sigItemMouseDoubleClick(widget-data()); ); m_widgets.append(widget); // è®¾ç½®æ•°æ® widget-setData(info); if (widget-data().type == Child) widget-setSelected(widget-data().id == m_curChildId); widget-resize(this-width(), widget-height()); widget-show(); return widget; 3. åˆ·æ–°æ•°æ® å…ˆéšè—æ‰€æœ‰ Widgetã€‚ éå†æ•°æ®ï¼Œæ ¹æ® y è½´åæ ‡è®¡ç®—å“ªäº›æ•°æ®éœ€è¦æ˜¾ç¤ºã€‚ æ˜¾ç¤ºç¬¦åˆèŒƒå›´çš„ Widgetï¼Œå¹¶æ›´æ–°æ»šåŠ¨æ¡ã€‚ void TreeWidget::refreshWidgets() // éšè—æ‰€æœ‰ Widget for (int i = 0; i m_widgets.size(); i++) m_widgets[i]-resize(this-width(), m_widgets[i]-height()); m_widgets[i]-hide(); auto moveItem = [this](const ItemInfo item, int y, int startPos, bool isContinue) if (y = m_scrollbar-value() isContinue) getWidget(item)-move(0, startPos); startPos += item.height; isContinue = startPos this-height(); y += item.height; ; int y = 0, startPos = 0; bool isContinue = true; for (int i = 0; i m_list.count(); i++) const ItemInfo topItem = m_list[i]; moveItem(topItem, y, startPos, isContinue); if (topItem.childList.count() 0 topItem.isExpand) for (int j = 0; j topItem.childList.count(); j++) const ItemInfo parentItem = topItem.childList[j]; moveItem(parentItem, y, startPos, isContinue); if (parentItem.childList.count() 0 parentItem.isExpand) for (int k = 0; k parentItem.childList.count(); k++) const ItemInfo childItem = parentItem.childList[k]; moveItem(childItem, y, startPos, isContinue); // è®¡ç®—æ»šåŠ¨æ¡èŒƒå›´ m_scrollbar-move(this-width() - m_scrollbar-width(), 0); m_scrollbar-resize(m_scrollbar-width(), this-height()); m_scrollbar-setPageStep(this-height()); if (y startPos) m_scrollbar-setMaximum(y - m_scrollbar-pageStep()); m_scrollbar-show(); m_scrollbar-raise(); else m_scrollbar-setMaximum(0); m_scrollbar-setValue(0); m_scrollbar-hide(); æ€§èƒ½ä¼˜åŒ–1. å“åº”äº‹ä»¶æ‰©å±• æ”¯æŒé¼ æ ‡æ»šåŠ¨ï¼š wheelEvent() å¤„ç†æ»šåŠ¨äº‹ä»¶ï¼ŒåŠ¨æ€æ›´æ–° Widget å¯è§çŠ¶æ€ã€‚ æ”¯æŒçª—å£å¤§å°è°ƒæ•´ï¼š resizeEvent() é‡æ–°è®¡ç®—å¯è§åŒºåŸŸï¼Œç¡®ä¿çª—å£å˜åŒ–æ—¶ Widget å¸ƒå±€åˆç†ã€‚ 2. ä»£ç ä¼˜åŒ– å‡å°‘ Widget åˆ›å»ºï¼Œä¿è¯æµç•…æ»šåŠ¨ã€‚ äº‹ä»¶è§¦å‘å‡å°‘ UI çº¿ç¨‹é˜»å¡ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚ å®é™…æ•ˆæœ æµ‹è¯•æ•°æ®é‡ï¼š17000+ æ¡è®°å½•ï¼Œæ»šåŠ¨æµç•…ã€‚ å±‚çº§ç»“æ„ï¼š çº¢è‰²ï¼šæœ€é¡¶å±‚ï¼ˆTopï¼‰ ç»¿è‰²ï¼šä¸­é—´å±‚ï¼ˆParentï¼‰ ç™½è‰²ï¼šæœ€åº•å±‚ï¼ˆChildï¼‰ å…·ä½“å®ç°åœ¨ä½¿ç”¨ QTableWidget æ—¶ï¼Œå½“æ•°æ®é‡è¶…è¿‡ 1000 æ¡æ—¶ï¼Œç”¨æˆ·å¯èƒ½ä¼šæ„Ÿåˆ°ç•Œé¢å“åº”å˜æ…¢ã€‚å¦‚æœæ•°æ®é‡è¾¾åˆ° 1 ä¸‡ã€10 ä¸‡ç”šè‡³ 100 ä¸‡æ¡ï¼Œæ˜¾ç¤ºé€Ÿåº¦çš„ä¸‹é™å°†æ›´åŠ æ˜æ˜¾ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·ä½“éªŒä¼šå—åˆ°æ˜¾è‘—å½±å“ï¼Œå› æ­¤éœ€è¦é‡‡å–æªæ–½æ¥ä¼˜åŒ–æ•°æ®çš„æ˜¾ç¤ºã€‚ ä¸ºäº†æé«˜æ€§èƒ½ï¼Œæˆ‘é‡æ–°å°è£…äº†ä¸€ä¸ªç±» BigTableWidgetï¼Œå®ƒç»§æ‰¿è‡ª QTableWidgetã€‚è¿™ä¸ªç±»çš„æ ¸å¿ƒæ€æƒ³æ˜¯é‡‡ç”¨å»¶è¿ŸåŠ è½½çš„æ–¹æ³•æ¥æ˜¾ç¤ºæ•°æ®ã€‚å…·ä½“æ¥è¯´ï¼ŒBigTableWidget é€šè¿‡æ»šåŠ¨æ¡æ§åˆ¶æ˜¾ç¤ºå†…å®¹ã€‚ç”±äºåœ¨å±å¹•ä¸Šä¸€æ¬¡åªèƒ½æ˜¾ç¤ºæœ‰é™çš„æ•°æ®è¡Œï¼Œåªæœ‰å½“å‰å¯è§çš„æ•°æ®ä¼šè¢«åŠ è½½åˆ°ç•Œé¢ä¸­ï¼Œè€Œä¸åœ¨è§†é‡ä¸­çš„æ•°æ®åˆ™ä¿ç•™åœ¨å†…å­˜ä¸­ã€‚åªæœ‰å½“ç”¨æˆ·æ‹–åŠ¨æ»šåŠ¨æ¡æ—¶ï¼Œæ‰ä¼šåŠ è½½æ–°çš„æ•°æ®è¡Œã€‚è¿™ç§æ–¹æ³•æœ‰æ•ˆåœ°å°†å¤§æ•°æ®é›†åˆ†æ‰¹æ˜¾ç¤ºï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ 100 ä¸‡æ¡æ•°æ®ï¼Œç›´æ¥åœ¨ QTableWidget ä¸­æ˜¾ç¤ºä¼šæ¶ˆè€—å¤§é‡å†…å­˜å’Œå¤„ç†æ—¶é—´ã€‚è€Œé€šè¿‡ BigTableWidgetï¼Œæˆ‘ä»¬åªéœ€åŠ è½½å½“å‰è§†å›¾æ‰€éœ€çš„è¡Œï¼Œå…¶ä»–æ•°æ®åˆ™åœ¨ç”¨æˆ·éœ€è¦æ—¶åŠ¨æ€åŠ è½½ã€‚è¿™ç§â€œç©ºé—´æ¢æ—¶é—´â€çš„ç­–ç•¥åœ¨å¤„ç†å¤§æ•°æ®æ—¶éå¸¸æœ‰æ•ˆã€‚ BigTableWidget ç±»çš„å¤´æ–‡ä»¶/// è¿™ä¸ªç±»æ¥ä¿å­˜æ¯ä¸€ä¸ª Item çš„ä¿¡æ¯class BigTableWidgetInfo public: BigTableWidgetInfo() ; ~BigTableWidgetInfo() ; int nRow; //! æ’å…¥æ•°æ®æ‰€åœ¨è¡Œæ•° int nColumn; //! æ’å…¥æ•°æ®æ‰€åœ¨åˆ—æ•° char strText[100]; //! åœ¨å•å…ƒæ ¼ä¸­æ˜¾ç¤ºçš„æ•°æ® QVariant userData; //! å•å…ƒæ ¼ä¸­ç”¨æˆ·å…³è”çš„æ•°æ®;class BigTableWidget : public QTableWidget Q_OBJECTpublic: BigTableWidget(QWidget* parent = 0); ~BigTableWidget(); //! å‘è¡¨æ ¼ä¸­æŒ‡å®šçš„è¡Œåˆ—æ·»åŠ æ˜¾ç¤ºä¿¡æ¯å’Œç”¨æˆ·æ•°æ® void addItem(int row, int column, QString strText, QVariant userData = QVariant()); //! åˆå§‹åŒ–è¡¨æ ¼çš„è¡Œæ•°å’Œåˆ—æ•° void initTableRowAndColumn(int row, int nColumn); //! æ¸…é™¤è¡¨æ ¼ä¸­çš„æ•°æ®ï¼Œå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹åœ¨åå°å»å¤„ç†æ•°æ®çš„æ¸…é™¤æ“ä½œï¼Œä¸å½±å“ç•Œé¢çš„æ“ä½œ void clearTableData(); //! è·å–å½“å‰è¡¨æ ¼çª—å£æ˜¾ç¤ºæœ€å¤§çš„è¡Œæ•° int getMaxCount() return m_nMaxCount; //! å°†æ•°æ®ä¿å­˜åˆ° list çš„åˆ—è¡¨ä¸­ void pushData(int row, int column, QString strText, QVariant userData); protected: static void dealClearData(void* users); private slots: void dealChangeValue(int nValue); private: Ui::BigTableWidget ui; int m_nMaxCount; //! æ¯é¡µæ˜¾ç¤ºçš„æœ€å¤§è¡Œæ•° QListBigTableWidgetInfo* m_listTableInfo; //! æ˜¾ç¤ºæ•°æ®çš„å­˜å‚¨åˆ—è¡¨ QListBigTableWidgetInfo* m_listCopyTableInfo; //! å­˜å‚¨æ¸…é™¤æ•°æ®çš„åƒåœ¾åˆ—è¡¨ QMutex m_tableInfoMutex;; BigTableWidget ç±»çš„å®ç°BigTableWidget::BigTableWidget(QWidget *parent) : QTableWidget(parent) ui.setupUi(this); // è®¾ç½®å•å…ƒæ ¼ä¸ºç¦æ­¢ç¼–è¾‘ setEditTriggers(QAbstractItemView::NoEditTriggers);/// åˆå§‹åŒ–è¡¨æ ¼çš„è¡Œæ•°å’Œåˆ—æ•°void BigTableWidget::initTableRowAndColumn(int row, int nColumn) this-setColumnCount(nColumn); this-setRowCount(row); // åˆå§‹åŒ–çª—å£æ»šåŠ¨æ¡æ‹–åŠ¨å˜åŒ–çš„ä¿¡å·æ§½ï¼Œä»¥åŠçª—å£æœ€å¤šæ˜¾ç¤ºæ•°æ®çš„è¡Œæ•° QScrollBar* pBar = this-verticalScrollBar(); connect((QObject*)pBar, SIGNAL(valueChanged(int)), this, SLOT(dealChangeValue(int))); int nRowHeight = this-rowHeight(0); int nScrollBarHeight = this-maximumViewportSize().height(); // è·å–æ»šåŠ¨æ¡çš„æ»šåŠ¨èŒƒå›´ m_nMaxCount = nScrollBarHeight / nRowHeight + 1;/// è¿™ä¸ªæ˜¯æœ€é‡è¦çš„æ§½å‡½æ•°ï¼Œæ‹–åŠ¨æ»šåŠ¨æ¡æ¥åŠ¨æ€çš„åŠ è½½æ•°æ®æ˜¾ç¤ºvoid BigTableWidget::dealChangeValue(int nValue) int nRealRow = nValue; int nRowChanged = 0; int nTempColumn = this-columnCount(); int nListSize = m_listTableInfo.size() / nTempColumn; // æ»šåŠ¨æ¡æ‹–åŠ¨çš„æ•°å€¼ä½†æ•°æ®æ²¡æœ‰åŠ è½½å®Œæˆ if (nValue nListSize) QScrollBar* pBar = this-verticalScrollBar(); pBar-setValue(nListSize); return; if (nListSize - nRealRow m_nMaxCount) nRowChanged = nListSize - nRealRow; for (int i = 0; i nRowChanged; ++i) if (i == nRowChanged i + nRealRow == this-rowCount()) break; for (int j = 0; j nTempColumn; ++j) int temp = (i + nRealRow) * (nTempColumn) + j; if (temp = m_listTableInfo.size()) return; BigTableWidgetInfo* info = m_listTableInfo.at(temp); QTableWidgetItem* tempItem = new QTableWidgetItem(QString::fromStdString(info-strText)); tempItem-setTextAlignment(Qt::AlignHCenter); this-setItem(info-nRow, info-nColumn, tempItem); /// å‘çœ‹åˆ°çš„è¡¨æ ¼ä¸­åŠ è½½æ˜¾ç¤ºæ•°æ®void BigTableWidget::addItem(int row, int column, QString strText, QVariant pUserData) BigTableWidgetInfo* info = new BigTableWidgetInfo; info-nRow = row; info-nColumn = column; strcpy(info-strText, strText.toStdString().c_str()); info-userData = pUserData; m_listTableInfo.push_back(info); // m_nMaxCount åœ¨çœ‹åˆ°çš„åŒºåŸŸå†…æœ€å¤šæ˜¾ç¤ºçš„è®°å½•æ¡æ•° if (row m_nMaxCount) QTableWidgetItem* tempItem = new QTableWidgetItem(strText); tempItem-setTextAlignment(Qt::AlignHCenter); this-setItem(row, column, tempItem); /// å¦‚æœæ²¡æœ‰åœ¨è¡¨æ ¼ä¸­æ˜¾ç¤ºçš„åˆ™å­˜å‚¨åˆ°å†…å­˜ä¸­void BigTableWidget::pushData(int row, int column, QString strText, QVariant pUserData) BigTableWidgetInfo* info = new BigTableWidgetInfo; info-nRow = row; info-nColumn = column; strcpy(info-strText, strText.toStdString().c_str()); info-userData = pUserData; m_listTableInfo.push_back(info);/// å¦‚æœå¾ˆå¤šæ¡æ•°æ®ï¼Œåœ¨ä¸ç”¨çš„æ—¶å€™å°†è¡¨æ ¼æ¸…ç©ºï¼Œå¹¶ä¸”è¦å°†å†…å­˜ä¸­çš„æ•°æ®æ¸…é™¤ï¼Œå¦åˆ™ä¼šå ç”¨å†…å­˜ï¼›void BigTableWidget::clearTableData() if (m_listTableInfo.isEmpty()) return; m_listCopyTableInfo.append(m_listTableInfo); QMutexLocker locker(m_tableInfoMutex); m_listTableInfo.clear(); this-clearContents(); this-setRowCount(1); QtConcurrent::run(dealClearData, (void*)this);/// çº¿ç¨‹å‡½æ•° æ¸…é™¤å†å²æ•°æ®void BigTableWidget::dealClearData(void* users) BigTableWidget* pThis = static_castBigTableWidget*(users); for (int i = 0; i pThis-m_listCopyTableInfo.size(); ++i) if (pThis-m_listCopyTableInfo.at(i)) delete pThis-m_listCopyTableInfo.at(i); pThis-m_listCopyTableInfo.clear(); ä¸Šè¿°ä»£ç å±•ç¤ºäº† BigTableWidget çš„åŸºæœ¬å®ç°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœéœ€è¦å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œå½“å‰çš„æ•°æ®ç»“æ„å¯èƒ½ä¼šå¯¼è‡´æ•ˆç‡ä½ä¸‹ã€‚å› ä¸ºæ¯ä¸ª Item çš„æ•°æ®éƒ½è¢«å•ç‹¬ä¿å­˜ï¼Œæ’åºæ—¶éœ€è¦è°ƒæ•´æ‰€æœ‰ç›¸å…³ Item çš„é¡ºåºï¼Œå¹¶æ›´æ–°å®ƒä»¬çš„è¡Œåˆ—ä¿¡æ¯ã€‚å› æ­¤ï¼Œé’ˆå¯¹æ’åºçš„éœ€æ±‚ï¼Œå¯èƒ½éœ€è¦è€ƒè™‘æ›´é«˜æ•ˆçš„æ•°æ®ç»“æ„æ¥å­˜å‚¨å’Œç®¡ç†æ•°æ®ã€‚","categories":["3.å¼€å‘æ¡†æ¶","Qt","æ§ä»¶"]},{"title":"QTableWidgetæ ·å¼è¡¨","path":"/2025/02/22/3-å¼€å‘æ¡†æ¶-Qt-æ§ä»¶-QTableWidgetæ ·å¼è¡¨/","content":"// 1. å‡åŒ€æ‹‰ç›´è¡¨å¤´ui-tableWidget-horizontalHeader()-setSectionResizeMode(QHeaderView::Stretch); // è®¾ç½®æ°´å¹³è¡¨å¤´çš„æ¯ä¸€åˆ—å‡åŒ€æ‹‰ä¼¸ï¼Œç¡®ä¿è¡¨æ ¼çš„å®½åº¦è¢«å……åˆ†åˆ©ç”¨ã€‚ui-tableWidget-verticalHeader()-setSectionResizeMode(QHeaderView::Stretch); // è®¾ç½®å‚ç›´è¡¨å¤´çš„æ¯ä¸€è¡Œå‡åŒ€æ‹‰ä¼¸ï¼Œä½¿å¾—è¡¨æ ¼çš„é«˜åº¦ä¹Ÿè¢«åˆç†åˆ†é…ã€‚// 2. å°†è¡¨æ ¼å®½åº¦è¦†ç›–æ»¡ui-tableWidget-horizontalHeader()-setStretchLastSection(true); // ä½¿æœ€åä¸€åˆ—çš„å®½åº¦è‡ªåŠ¨æ‰©å±•ï¼Œä»¥å¡«æ»¡è¡¨æ ¼çš„å‰©ä½™ç©ºé—´ã€‚ui-tableWidget-verticalHeader()-setStretchLastSection(true); // ä½¿æœ€åä¸€è¡Œçš„é«˜åº¦è‡ªåŠ¨æ‰©å±•ï¼Œä»¥å¡«æ»¡è¡¨æ ¼çš„å‰©ä½™ç©ºé—´ã€‚ å¤–è§‚ #ifndef MAINWIDGET_H#define MAINWIDGET_H#include QWidgetQT_BEGIN_NAMESPACEnamespace Ui class MainWidget; QT_END_NAMESPACEclass MainWidget : public QWidget Q_OBJECTpublic: MainWidget(QWidget *parent = nullptr); // æ„é€ å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªçˆ¶çª—å£æŒ‡é’ˆï¼Œé»˜è®¤ä¸ºnullptrã€‚ ~MainWidget(); // ææ„å‡½æ•°ï¼Œè´Ÿè´£é‡Šæ”¾èµ„æºã€‚private: Ui::MainWidget *ui; // æŒ‡å‘UIç•Œé¢çš„æŒ‡é’ˆï¼Œè´Ÿè´£ç®¡ç†ç•Œé¢å…ƒç´ ã€‚;#endif // MAINWIDGET_H // mainwidget.cpp#include mainwidget.h#include ui_mainwidget.h#include QString#include QFile#include QTextStreamMainWidget::MainWidget(QWidget *parent) : QWidget(parent) // è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–çˆ¶çª—å£ã€‚ , ui(new Ui::MainWidget) // åˆ›å»ºUIç•Œé¢çš„å®ä¾‹ã€‚ ui-setupUi(this); // è®¾ç½®UIç•Œé¢ï¼Œåˆå§‹åŒ–æ‰€æœ‰ç•Œé¢å…ƒç´ ã€‚ ui-tableWidget-verticalHeader()-setVisible(true); // æ˜¾ç¤ºå‚ç›´è¡¨å¤´ï¼Œä¾¿äºç”¨æˆ·æŸ¥çœ‹è¡Œä¿¡æ¯ã€‚ QString qss; // ç”¨äºå­˜å‚¨æ ·å¼è¡¨çš„å­—ç¬¦ä¸²ã€‚ QFile file(:/style.css); // åˆ›å»ºæ–‡ä»¶å¯¹è±¡ï¼ŒæŒ‡å‘èµ„æºä¸­çš„æ ·å¼è¡¨æ–‡ä»¶ã€‚ if (file.open(QFile::ReadOnly)) // ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚ QStringList list; // å­˜å‚¨æ ·å¼è¡¨æ¯ä¸€è¡Œçš„åˆ—è¡¨ã€‚ QTextStream in(file); // åˆ›å»ºæ–‡æœ¬æµå¯¹è±¡ï¼Œç”¨äºè¯»å–æ–‡ä»¶å†…å®¹ã€‚ while (!in.atEnd()) // å¾ªç¯è¯»å–æ–‡ä»¶ï¼Œç›´åˆ°ç»“æŸã€‚ QString line; // å­˜å‚¨å½“å‰è¡Œçš„å­—ç¬¦ä¸²ã€‚ in line; // è¯»å–ä¸€è¡Œã€‚ list line; // å°†è¯»å–çš„è¡Œæ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚ file.close(); // å…³é—­æ–‡ä»¶ï¼Œé‡Šæ”¾èµ„æºã€‚ qss = list.join( ); // å°†åˆ—è¡¨ä¸­çš„è¡Œåˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»¥æ¢è¡Œç¬¦åˆ†éš”ã€‚ QString paletteColor = qss.mid(20, 7); // ä»æ ·å¼è¡¨ä¸­æå–é¢œè‰²ä¿¡æ¯ï¼Œç”¨äºè®¾ç½®åº”ç”¨ç¨‹åºçš„è°ƒè‰²æ¿ã€‚ qApp-setPalette(QPalette(paletteColor)); // è®¾ç½®åº”ç”¨ç¨‹åºçš„è°ƒè‰²æ¿ï¼Œå½±å“æ•´ä¸ªåº”ç”¨çš„é¢œè‰²ã€‚ qApp-setStyleSheet(qss); // åº”ç”¨æ ·å¼è¡¨ï¼Œæ”¹å˜ç•Œé¢çš„å¤–è§‚ã€‚ MainWidget::~MainWidget() // ææ„å‡½æ•°å®ç° delete ui; // é‡Šæ”¾UIç•Œé¢èµ„æºï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚ // main.cpp#include mainwidget.h#include QApplicationint main(int argc, char *argv[]) // ä¸»å‡½æ•°ï¼Œç¨‹åºå…¥å£ã€‚ QApplication a(argc, argv); // åˆ›å»ºQApplicationå¯¹è±¡ï¼Œç®¡ç†åº”ç”¨ç¨‹åºçš„æ§åˆ¶æµå’Œä¸»è¦è®¾ç½®ã€‚ MainWidget w; // åˆ›å»ºMainWidgetå¯¹è±¡ï¼Œè¡¨ç¤ºä¸»çª—å£ã€‚ w.show(); // æ˜¾ç¤ºä¸»çª—å£ã€‚ return a.exec(); // è¿›å…¥äº‹ä»¶å¾ªç¯ï¼Œç­‰å¾…ç”¨æˆ·æ“ä½œã€‚ // style.css* outline: 0px; // å»æ‰æ‰€æœ‰å…ƒç´ çš„è½®å»“çº¿ã€‚ color: #DCDCDC; // è®¾ç½®æ–‡æœ¬é¢œè‰²ä¸ºæµ…ç°è‰²ã€‚ background: #444444; // è®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºæ·±ç°è‰²ã€‚QTableView border: 1px solid #242424; // è®¾ç½®è¡¨æ ¼è¾¹æ¡†ä¸ºæ·±ç°è‰²ã€‚ selection-background-color: #646464; // è®¾ç½®é€‰ä¸­é¡¹çš„èƒŒæ™¯é¢œè‰²ã€‚ selection-color: #DCDCDC; // è®¾ç½®é€‰ä¸­é¡¹çš„æ–‡æœ¬é¢œè‰²ã€‚ alternate-background-color: #525252; // è®¾ç½®äº¤æ›¿è¡Œçš„èƒŒæ™¯é¢œè‰²ã€‚ gridline-color: #242424; // è®¾ç½®ç½‘æ ¼çº¿é¢œè‰²ã€‚QTableView::indicator padding: 0px; // è®¾ç½®æŒ‡ç¤ºå™¨çš„å†…è¾¹è·ä¸º0ã€‚ width: 15px; // è®¾ç½®æŒ‡ç¤ºå™¨çš„å®½åº¦ã€‚ height: 15px; // è®¾ç½®æŒ‡ç¤ºå™¨çš„é«˜åº¦ã€‚QTableView::indicator:unchecked image:url(:/image/checkbox_unchecked.png); // æœªé€‰ä¸­çŠ¶æ€ä¸‹çš„æŒ‡ç¤ºå™¨å›¾æ ‡ã€‚QTableView::indicator:unchecked:disabled image:url(:/image/checkbox_unchecked_disable.png); // ç¦ç”¨çŠ¶æ€ä¸‹çš„æœªé€‰ä¸­æŒ‡ç¤ºå™¨å›¾æ ‡ã€‚QTableView::indicator:checked image:url(:/image/checkbox_checked.png); // é€‰ä¸­çŠ¶æ€ä¸‹çš„æŒ‡ç¤ºå™¨å›¾æ ‡ã€‚QTableView::indicator:checked:disabled image:url(:/image/checkbox_checked_disable.png); // ç¦ç”¨çŠ¶æ€ä¸‹çš„é€‰ä¸­æŒ‡ç¤ºå™¨å›¾æ ‡ã€‚QTableView::indicator:indeterminate image:url(:/image/checkbox_parcial.png); // ä¸ç¡®å®šçŠ¶æ€ä¸‹çš„æŒ‡ç¤ºå™¨å›¾æ ‡ã€‚QTableView::indicator:indeterminate:disabled image:url(:/image/checkbox_parcial_disable.png); // ç¦ç”¨çŠ¶æ€ä¸‹çš„ä¸ç¡®å®šæŒ‡ç¤ºå™¨å›¾æ ‡ã€‚QTableView::item:selected color: #DCDCDC; // é€‰ä¸­é¡¹çš„æ–‡æœ¬é¢œè‰²ã€‚ background: #383838; // é€‰ä¸­é¡¹çš„èƒŒæ™¯é¢œè‰²ã€‚QTableView::item:hover color: #DCDCDC; // é¼ æ ‡æ‚¬åœæ—¶çš„æ–‡æœ¬é¢œè‰²ã€‚ background: #525252; // é¼ æ ‡æ‚¬åœæ—¶çš„èƒŒæ™¯é¢œè‰²ã€‚QTableView::item padding: 1px; // è¡¨æ ¼é¡¹çš„å†…è¾¹è·ã€‚ margin: 0px; // è¡¨æ ¼é¡¹çš„å¤–è¾¹è·ã€‚ border: 0px; // è¡¨æ ¼é¡¹çš„è¾¹æ¡†ã€‚/* è¡¨æ ¼æ ·å¼ */QTableView QLineEdit,QTableView QComboBox,QTableView QSpinBox,QTableView QDoubleSpinBox,QTableView QDateEdit,QTableView QTimeEdit,QTableView QDateTimeEdit border-width: 1px; // è®¾ç½®è¾¹æ¡†å®½åº¦ã€‚ border-radius: 0px; // è®¾ç½®è¾¹æ¡†åœ†è§’ä¸º0ã€‚/* é€‰ä¸­è¡¨æ ¼åæ ·å¼ (æ­¤å¤„QLineEdit:focusç”Ÿæ•ˆ) */QTableView QLineEdit:focus,QTableView QComboBox:focus,QTableView QSpinBox:focus,QTableView QDoubleSpinBox:focus,QTableView QDateEdit:focus,QTableView QTimeEdit:focus,QTableView QDateTimeEdit:focus background-color: #3fd4f2; // ç„¦ç‚¹çŠ¶æ€ä¸‹çš„èƒŒæ™¯é¢œè‰²ã€‚ border-width: 3px; // ç„¦ç‚¹çŠ¶æ€ä¸‹çš„è¾¹æ¡†å®½åº¦ã€‚ border-radius: 5px; // ç„¦ç‚¹çŠ¶æ€ä¸‹çš„è¾¹æ¡†åœ†è§’ã€‚/* æ»šåŠ¨æ¡æ ·å¼ */QScrollBar:horizontal background:#484848; // æ°´å¹³æ»šåŠ¨æ¡çš„èƒŒæ™¯é¢œè‰²ã€‚ padding:0px; // æ°´å¹³æ»šåŠ¨æ¡çš„å†…è¾¹è·ã€‚ border-radius:6px; // æ°´å¹³æ»šåŠ¨æ¡çš„åœ†è§’ã€‚ max-height:12px; // æ°´å¹³æ»šåŠ¨æ¡çš„æœ€å¤§é«˜åº¦ã€‚QScrollBar::handle:horizontal background:#242424; // æ°´å¹³æ»šåŠ¨æ¡æ»‘å—çš„èƒŒæ™¯é¢œè‰²ã€‚ min-width:50px; // æ°´å¹³æ»šåŠ¨æ¡æ»‘å—çš„æœ€å°å®½åº¦ã€‚ border-radius:6px; // æ°´å¹³æ»šåŠ¨æ¡æ»‘å—çš„åœ†è§’ã€‚QScrollBar::handle:horizontal:hover background:#AAAAAA; // é¼ æ ‡æ‚¬åœæ—¶çš„æ°´å¹³æ»šåŠ¨æ¡æ»‘å—é¢œè‰²ã€‚QScrollBar::handle:horizontal:pressed background:#AAAAAA; // æŒ‰ä¸‹æ—¶çš„æ°´å¹³æ»šåŠ¨æ¡æ»‘å—é¢œè‰²ã€‚QScrollBar::add-page:horizontal background:none; // æ°´å¹³æ»šåŠ¨æ¡æ·»åŠ åŒºåŸŸçš„èƒŒæ™¯é¢œè‰²ã€‚QScrollBar::sub-page:horizontal background:none; // æ°´å¹³æ»šåŠ¨æ¡å‡å»åŒºåŸŸçš„èƒŒæ™¯é¢œè‰²ã€‚QScrollBar::add-line:horizontal background:none; // æ°´å¹³æ»šåŠ¨æ¡æ·»åŠ çº¿çš„èƒŒæ™¯é¢œè‰²ã€‚QScrollBar::sub-line:horizontal background:none; // æ°´å¹³æ»šåŠ¨æ¡å‡å»çº¿çš„èƒŒæ™¯é¢œè‰²ã€‚QScrollBar:vertical background:#484848; // å‚ç›´æ»šåŠ¨æ¡çš„èƒŒæ™¯é¢œè‰²ã€‚ padding:0px; // å‚ç›´æ»šåŠ¨æ¡çš„å†…è¾¹è·ã€‚ border-radius:6px; // å‚ç›´æ»šåŠ¨æ¡çš„åœ†è§’ã€‚ max-width:12px; // å‚ç›´æ»šåŠ¨æ¡çš„æœ€å¤§å®½åº¦ã€‚QScrollBar::handle:vertical background:#242424; // å‚ç›´æ»šåŠ¨æ¡æ»‘å—çš„èƒŒæ™¯é¢œè‰²ã€‚ min-height:50px; // å‚ç›´æ»šåŠ¨æ¡æ»‘å—çš„æœ€å°é«˜åº¦ã€‚ border-radius:6px; // å‚ç›´æ»šåŠ¨æ¡æ»‘å—çš„åœ†è§’ã€‚QScrollBar::handle:vertical:hover background:#AAAAAA; // é¼ æ ‡æ‚¬åœæ—¶çš„å‚ç›´æ»šåŠ¨æ¡æ»‘å—é¢œè‰²ã€‚QScrollBar::handle:vertical:pressed background:#AAAAAA; // æŒ‰ä¸‹æ—¶çš„å‚ç›´æ»šåŠ¨æ¡æ»‘å—é¢œè‰²ã€‚QScrollBar::add-page:vertical background:none; // å‚ç›´æ»šåŠ¨æ¡æ·»åŠ åŒºåŸŸçš„èƒŒæ™¯é¢œè‰²ã€‚QScrollBar::sub-page:vertical background:none; // å‚ç›´æ»šåŠ¨æ¡å‡å»åŒºåŸŸçš„èƒŒæ™¯é¢œè‰²ã€‚QScrollBar::add-line:vertical background:none; // å‚ç›´æ»šåŠ¨æ¡æ·»åŠ çº¿çš„èƒŒæ™¯é¢œè‰²ã€‚QScrollBar::sub-line:vertical background:none; // å‚ç›´æ»šåŠ¨æ¡å‡å»çº¿çš„èƒŒæ™¯é¢œè‰²ã€‚/* è¡¨å¤´æ ·å¼ QTableCornerButton::sectionæ˜¯tablewidgetå·¦ä¸Šè§’é‚£ä¸€å°å— è¯¦è§https://blog.csdn.net/qq_43627907/article/details/125677496 */QHeaderView, QHeaderView::section, QTableView QTableCornerButton::section color: #DCDCDC; // è¡¨å¤´æ–‡æœ¬é¢œè‰²ã€‚ background: #525252; // è¡¨å¤´èƒŒæ™¯é¢œè‰²ã€‚QHeaderView::section, QTableCornerButton:section padding: 3px; // è¡¨å¤´çš„å†…è¾¹è·ã€‚ margin: 0px; // è¡¨å¤´çš„å¤–è¾¹è·ã€‚ border: 1px solid #242424; // è¡¨å¤´çš„è¾¹æ¡†æ ·å¼ã€‚ border-left-width: 0px; // è¡¨å¤´å·¦è¾¹æ¡†å®½åº¦ä¸º0ã€‚ border-right-width: 1px; // è¡¨å¤´å³è¾¹æ¡†å®½åº¦ã€‚ border-top-width: 0px; // è¡¨å¤´ä¸Šè¾¹æ¡†å®½åº¦ä¸º0ã€‚ border-bottom-width: 1px; // è¡¨å¤´ä¸‹è¾¹æ¡†å®½åº¦ã€‚QHeaderView::section:disabled background: #444444; // ç¦ç”¨çŠ¶æ€ä¸‹çš„è¡¨å¤´èƒŒæ™¯é¢œè‰²ã€‚ border-color: #484848; // ç¦ç”¨çŠ¶æ€ä¸‹çš„è¡¨å¤´è¾¹æ¡†é¢œè‰²ã€‚ color: #242424; // ç¦ç”¨çŠ¶æ€ä¸‹çš„è¡¨å¤´æ–‡æœ¬é¢œè‰²ã€‚","tags":["clippings"],"categories":["3.å¼€å‘æ¡†æ¶","Qt","æ§ä»¶"]},{"title":"è¡¨æ ¼QTableWidget","path":"/2025/02/22/3-å¼€å‘æ¡†æ¶-Qt-æ§ä»¶-è¡¨æ ¼QTableWidget/","content":"QTableWidget æ¦‚è¿°QTableWidget æ˜¯ QT ç¨‹åºä¸­å¸¸ç”¨çš„æ˜¾ç¤ºæ•°æ®è¡¨æ ¼çš„ç»„ä»¶ï¼Œç±»ä¼¼äº VC å’Œ C# ä¸­çš„ DataGridã€‚å®ƒæä¾›äº†ä¸€ä¸ªç›´è§‚çš„æ–¹å¼æ¥å±•ç¤ºå’Œæ“ä½œè¡¨æ ¼æ•°æ®ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£ QTableWidgetï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£å®ƒä¸ QTableView çš„åŒºåˆ«ã€‚ QTableWidget ä¸ QTableView çš„åŒºåˆ«QTableWidget æ˜¯ QTableView çš„å­ç±»ï¼ŒäºŒè€…çš„ä¸»è¦åŒºåˆ«åœ¨äºæ•°æ®æ¨¡å‹çš„ä½¿ç”¨ã€‚QTableView å…è®¸å¼€å‘è€…ä½¿ç”¨è‡ªå®šä¹‰çš„æ•°æ®æ¨¡å‹æ¥æ˜¾ç¤ºå†…å®¹ï¼Œè¿™æ„å‘³ç€å¼€å‘è€…éœ€è¦é€šè¿‡ setModel æ–¹æ³•æ¥ç»‘å®šæ•°æ®æºã€‚è€Œ QTableWidget åˆ™åªèƒ½ä½¿ç”¨æ ‡å‡†çš„æ•°æ®æ¨¡å‹ï¼Œå…¶å•å…ƒæ ¼çš„æ•°æ®æ˜¯é€šè¿‡ QTableWidgetItem å¯¹è±¡æ¥å®ç°çš„ã€‚è¿™æ„å‘³ç€åœ¨ä½¿ç”¨ QTableWidget æ—¶ï¼Œå¼€å‘è€…å¯ä»¥é€ä¸ªå¡«å……å•å…ƒæ ¼çš„ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦äº‹å…ˆå®šä¹‰æ•°æ®æºã€‚å…·ä½“æ¥è¯´ï¼ŒQTableView ç±»ä¸­æœ‰ setModel æˆå‘˜å‡½æ•°ï¼Œè€Œåœ¨ QTableWidget ç±»ä¸­ï¼Œè¯¥æˆå‘˜å‡½æ•°è¢«è®¾ä¸ºç§æœ‰ã€‚ QTableWidgetItem çš„é‡è¦æ€§åœ¨ä½¿ç”¨ QTableWidget æ—¶ï¼ŒQTableWidgetItem æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚å®ƒç”¨äºè¡¨ç¤ºè¡¨æ ¼ä¸­çš„ä¸€ä¸ªå•å…ƒæ ¼ï¼Œæ•´ä¸ªè¡¨æ ¼çš„æ„å»ºéƒ½æ˜¯åŸºäºè¿™äº›å•å…ƒæ ¼çš„ã€‚ä¾‹å¦‚ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç åˆ›å»ºå’Œè®¾ç½®å•å…ƒæ ¼çš„å†…å®¹ï¼š tableWidget-setItem(0, 0, new QTableWidgetItem(Jan)); è¿™è¡Œä»£ç åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ QTableWidgetItem å¯¹è±¡ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—çš„å†…å®¹ã€‚ ç¤ºä¾‹ä»£ç ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ª QTableWidget å¯¹è±¡å¹¶è®¾ç½®å…¶å†…å®¹ï¼š #include QApplication#include QTableWidget#include QStringList#include QIconint main(int argc, char *argv[]) QApplication a(argc, argv); QTableWidget *tableWidget = newTableWidget(10, 5); // åˆ›å»ºä¸€ä¸ª10è¡Œ5åˆ—çš„QTableWidgetå¯¹è±¡ tableWidget-setWindowTitle(QTableWidget Item); tableWidget-resize(350, 200); // è®¾ç½®è¡¨æ ¼çš„å¤§å° QStringList header; header Month Description // è®¾ç½®è¡¨å¤´ tableWidget-setHorizontalHeaderLabels(header); // å¡«å……è¡¨æ ¼æ•°æ® tableWidget-setItem(0, 0, new QTableWidgetItem(Jan)); tableWidget-setItem(1, 0, new QTableWidgetItemFeb)); tableWidget-setItem(2, 0, new QTableWidgetItem(Mar)); tableWidget-setItem(0, 1, new QTableWidgetItem(QIcon(images/IED.png), Jans month)); tableWidget-setItem(1,1, new QTableWidgetItem(QIcon(images/IED.png), Febs month)); tableWidget-setItem(2, 1, new QTableWidgetItem(QIcon(images/IED.png), Mars month)); tableWidget-show(); // æ˜¾ç¤ºæ ¼ return a.exec(); // è¿›å…¥äº‹ä»¶å¾ªç¯ è·å–å•å‡»å•å…ƒæ ¼çš„å†…å®¹è¦è·å–ç”¨æˆ·å•å‡»çš„å•å…ƒæ ¼å†…å®¹ï¼Œå¯ä»¥é€šè¿‡å®ç° itemClicked(QTableWidgetItem *) ä¿¡å·çš„æ§½å‡½æ•°ã€‚è¿™æ ·ï¼Œå¼€å‘å¯ä»¥è·å–é¼ æ ‡å•å‡»åˆ°çš„å•å…ƒæ ¼æŒ‡é’ˆï¼Œå¹¶è¿›ä¸€æ­¥è·å–å…¶ä¸­çš„æ–‡å­—ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š connect(tableWidget, SIGNAL(itemDoubleClicked(QTableWidgetItem*)), this, SLOT(getItem(QTableWidgetItem*))); è°ƒæ•´è¡¨æ ¼è¡Œå®½å’Œåˆ—å®½åœ¨ä½¿ç”¨ QTableWidget æ—¶ï¼Œè°ƒæ•´è¡¨æ ¼çš„è¡Œå®½å’Œåˆ—å®½æ˜¯å¸¸è§çš„éœ€æ±‚ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡½æ•°ï¼š resizeColumnsToContents()ï¼šæ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´æ‰€æœ‰åˆ—çš„å®½åº¦ã€‚ resizeColumnToContents(int col)ï¼šæ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´æŒ‡å®šåˆ—çš„å®½åº¦ã€‚ setColumnWidth(int column, int width)ï¼šè®¾ç½®æŒ‡å®šåˆ—çš„å®½åº¦ã€‚ setRowHeight(int row, int height)ï¼šè®¾ç½®æŒ‡å®šè¡Œçš„é«˜åº¦ã€‚ ä¾‹å¦‚ï¼š tableWidget-setColumnWidth(3, 200); // è®¾ç½®ç¬¬å››åˆ—å®½åº¦ä¸º200tableWidget-setRowHeight(3, 60); // è®¾ç½®ç¬¬å››è¡Œé«˜åº¦ä¸º60 è¡¨æ ¼çš„å…¶ä»–è®¾ç½®å¼€å‘è€…è¿˜å¯ä»¥è¿›è¡Œå…¶ä»–è®¾ç½®ï¼Œä¾‹å¦‚ï¼š setShowGrid(true)ï¼šæ˜¾ç¤ºè¡¨æ ¼çº¿ã€‚ verticalHeader()-setVisible(false)ï¼šéšè—å·¦ä¾§çš„å‚ç›´è¡¨å¤´ã€‚ setEditTriggers(QTableWidget::NoEditTriggers)ï¼šç¦æ­¢ç¼–è¾‘å•å…ƒæ ¼ã€‚ setSelectionBehavior(QTableWidget::SelectRows)ï¼šä¸€æ¬¡é€‰ä¸­ä¸€æ•´è¡Œã€‚ setSelectionMode(QAbstractItemView::SingleSelection)ï¼šåªèƒ½å•é€‰ã€‚ å¦‚æœå¸Œæœ›å»æ‰å·¦è¾¹çš„è¡Œå·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š QHeaderView* headerView = tableWidget-verticalHeader();headerView-setHidden(true); // éšè—å‚ç›´è¡¨å¤´ é€šè¿‡è¿™äº›è®¾ç½®ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®éœ€æ±‚çµæ´»åœ°è°ƒæ•´ QTableWidget çš„å¤–è§‚å’Œè¡Œä¸ºï¼Œä»¥æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ QTableWidget ä¸èƒ½åœ¨ mainwindow ä¸­éšä¸»çª—å£çš„å¤§å°å˜åŒ–ï¼Ÿä¸ºäº†ç¡®ä¿ QTableWidget éšç€ä¸»çª—å£çš„å¤§å°å˜åŒ–è€Œè°ƒæ•´ï¼Œå¯ä»¥åœ¨è¡¨æ ¼å¤–éƒ¨æ·»åŠ å¸ƒå±€ã€‚è¿™æ ·ï¼Œè¡¨æ ¼ä¼šè‡ªåŠ¨é€‚åº”çˆ¶çª—å£çš„å°ºå¯¸å˜åŒ–ã€‚ tableWidget = new QTableWidget;tableWidget-setObjectName(QString::fromUtf8(tableWidget));QVBoxLayout *verticalLayout = new QVBoxLayout; // åˆ›å»ºä¸€ä¸ªå‚ç›´å¸ƒå±€verticalLayout-addWidget(tableWidget); // å°†è¡¨æ ¼æ·»åŠ åˆ°å¸ƒå±€ä¸­ å°†è¡¨æ ¼å˜ä¸ºç¦æ­¢ç¼–è¾‘ï¼šé€šè¿‡è®¾ç½®ç¼–è¾‘è§¦å‘å™¨ï¼Œå¯ä»¥æ§åˆ¶ç”¨æˆ·å¯¹è¡¨æ ¼å†…å®¹çš„ç¼–è¾‘æƒé™ã€‚ä»¥ä¸‹ä»£ç å°†è¡¨æ ¼è®¾ç½®ä¸ºç¦æ­¢ç¼–è¾‘ã€‚ tableWidget-setEditTriggers(QAbstractItemView::NoEditTriggers); å‚æ•°å«ä¹‰ï¼š QAbstractItemView::NoEditTriggersï¼šç”¨æˆ·æ— æ³•ä¿®æ”¹è¡¨æ ¼å†…å®¹ã€‚ QAbstractItemView::CurrentChangedï¼šç”¨æˆ·å¯ä»¥åœ¨ä»»ä½•æ—¶å€™ä¿®æ”¹å•å…ƒæ ¼ã€‚ QAbstractItemView::DoubleClickedï¼šç”¨æˆ·åŒå‡»å•å…ƒæ ¼æ—¶å¯ä»¥ä¿®æ”¹ã€‚ QAbstractItemView::SelectedClickedï¼šç”¨æˆ·å•å‡»å·²é€‰ä¸­çš„å†…å®¹æ—¶å¯ä»¥ä¿®æ”¹ã€‚ QAbstractItemView::EditKeyPressedï¼šæŒ‰ä¸‹ç¼–è¾‘é”®æ—¶å¯ä»¥ä¿®æ”¹ã€‚ QAbstractItemView::AnyKeyPressedï¼šæŒ‰ä¸‹ä»»æ„é”®æ—¶å¯ä»¥ä¿®æ”¹ã€‚ QAbstractItemView::AllEditTriggersï¼šä»¥ä¸Šæ‰€æœ‰æ¡ä»¶å‡å¯ç¼–è¾‘ã€‚ è®¾ç½®è¡¨æ ¼ä¸ºæ•´è¡Œé€‰æ‹©ï¼šé€šè¿‡è®¾ç½®é€‰æ‹©è¡Œä¸ºï¼Œå¯ä»¥æ§åˆ¶ç”¨æˆ·é€‰æ‹©çš„æ–¹å¼ã€‚ä»¥ä¸‹ä»£ç å°†è¡¨æ ¼è®¾ç½®ä¸ºæ•´è¡Œé€‰æ‹©ã€‚ tableWidget-setSelectionBehavior(QAbstractItemView::SelectRows); // æ•´è¡Œé€‰ä¸­çš„æ–¹å¼ å‚æ•°å«ä¹‰ï¼š QAbstractItemView::SelectItemsï¼šé€‰ä¸­å•ä¸ªå•å…ƒæ ¼ã€‚ QAbstractItemView::SelectRowsï¼šé€‰ä¸­æ•´è¡Œã€‚ QAbstractItemView::SelectColumnsï¼šé€‰ä¸­æ•´åˆ—ã€‚ å•ä¸ªé€‰ä¸­å’Œå¤šä¸ªé€‰ä¸­çš„è®¾ç½®ï¼šé€šè¿‡è®¾ç½®é€‰æ‹©æ¨¡å¼ï¼Œå¯ä»¥æ§åˆ¶ç”¨æˆ·çš„é€‰æ‹©æ–¹å¼ã€‚ä»¥ä¸‹ä»£ç å…è®¸ç”¨æˆ·é€‰æ‹©å¤šä¸ªç›®æ ‡ã€‚ tableWidget-setSelectionMode(QAbstractItemView::ExtendedSelection); // è®¾ç½®ä¸ºå¯ä»¥é€‰ä¸­å¤šä¸ªç›®æ ‡ å‚æ•°å«ä¹‰ï¼š QAbstractItemView::NoSelectionï¼šä¸èƒ½é€‰æ‹©ã€‚ QAbstractItemView::SingleSelectionï¼šåªèƒ½é€‰ä¸­å•ä¸ªç›®æ ‡ã€‚ QAbstractItemView::MultiSelectionï¼šå¯ä»¥é€‰ä¸­å¤šä¸ªç›®æ ‡ã€‚ QAbstractItemView::ExtendedSelection å’Œ QAbstractItemView::ContiguousSelection çš„åŒºåˆ«ä¸æ˜æ˜¾ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ­£å¸¸æƒ…å†µä¸‹æ˜¯å•é€‰ï¼Œä½†æŒ‰ä¸‹ Ctrl æˆ– Shift é”®åå¯ä»¥å¤šé€‰ã€‚ è¡¨æ ¼è¡¨å¤´çš„æ˜¾ç¤ºä¸éšè—ï¼šå¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ¥éšè—æˆ–æ˜¾ç¤ºè¡¨å¤´ã€‚ tableWidget-verticalHeader()-setVisible(false); // éšè—å‚ç›´è¡¨å¤´ tableWidget-horizontalHeader()-setVisible(false); // éšè—æ°´å¹³è¡¨å¤´ å¯¹è¡¨å¤´æ–‡å­—çš„å­—ä½“ã€é¢œè‰²è¿›è¡Œè®¾ç½®ï¼šå¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç è®¾ç½®è¡¨å¤´çš„å­—ä½“å’Œé¢œè‰²ã€‚ QTableWidgetItem *columnHeaderItem0 = tableWidget-horizontalHeaderItem(0); // è·å–æ°´å¹³è¡¨å¤´çš„ Item å¯¹è±¡ columnHeaderItem0-setFont(QFont(Helvetica)); // è®¾ç½®å­—ä½“ columnHeaderItem0-setBackgroundColor(QColor(0, 60, 10)); // è®¾ç½®å•å…ƒæ ¼èƒŒæ™¯é¢œè‰² columnHeaderItem0-setTextColor(QColor(200, 111, 30)); // è®¾ç½®æ–‡å­—é¢œè‰² åœ¨å•å…ƒæ ¼é‡ŒåŠ å…¥æ§ä»¶ï¼šå¯ä»¥åœ¨è¡¨æ ¼çš„å•å…ƒæ ¼ä¸­æ·»åŠ æ§ä»¶ï¼Œä¾‹å¦‚ä¸‹æ‹‰æ¡†ã€‚ QComboBox *comBox = new QComboBox();comBox-addItem(Y);comBox-addItem(N);tableWidget-setCellWidget(0, 2, comBox); // å°†ä¸‹æ‹‰æ¡†æ·»åŠ åˆ°ç¬¬ä¸€è¡Œç¬¬ä¸‰åˆ— å•å…ƒæ ¼ä¸­æ·»åŠ å›¾ç‰‡ï¼šå¯ä»¥åœ¨å•å…ƒæ ¼ä¸­æ·»åŠ å›¾ç‰‡ï¼Œä»¥ä¸‹ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨å•å…ƒæ ¼ä¸­æ’å…¥å›¾æ ‡ã€‚ tableWidget-setItem(row, 0, new QTableWidgetItem(QIcon(:/new/images/kingdemo.ico), tr())); è®¾ç½®å•å…ƒæ ¼å­—ä½“é¢œè‰²ã€èƒŒæ™¯é¢œè‰²å’Œå­—ä½“å­—ç¬¦ï¼šå¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç è®¾ç½®å•å…ƒæ ¼çš„å­—ä½“ã€èƒŒæ™¯é¢œè‰²å’Œå­—ä½“æ ·å¼ã€‚ QTableWidgetItem *item = new QTableWidgetItem(Apple);item-setBackgroundColor(QColor(0, 60, 10));item-setTextColor(QColor(200, 111, 100));item-setFont(QFont(Helvetica));tableWidget-setItem(0, 3, item); // å°†è®¾ç½®å¥½çš„å•å…ƒæ ¼é¡¹æ·»åŠ åˆ°ç¬¬ä¸€è¡Œç¬¬å››åˆ— å¦‚æœéœ€è¦å¯¹æ‰€æœ‰å•å…ƒæ ¼ä½¿ç”¨ç›¸åŒçš„å­—ä½“ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼š tableWidget-setFont(QFont(Helvetica)); è®¾ç½®å•å…ƒæ ¼å†…æ–‡å­—çš„å¯¹é½æ–¹å¼ï¼šå¯ä»¥é€šè¿‡ä»¥ä¸‹å¸¸é‡è®¾ç½®å•å…ƒæ ¼å†…æ–‡å­—çš„æ°´å¹³å’Œå‚ç›´å¯¹é½æ–¹å¼ã€‚ æ°´å¹³å¯¹é½æ–¹å¼ï¼š Constant Value DescriptionQt.AlignLeft 0x0001 Aligns with the left edge.Qt.AlignRight 0x0002 Aligns with the right edge.Qt.AlignHCenter 0x0004 Centers horizontally in the available space.Qt.AlignJustify 0x0008 Justifies the text in the available space. å‚ç›´å¯¹é½æ–¹å¼ï¼š Constant Value DescriptionQt.AlignTop 0x0020 Aligns with the top.Qt.AlignBottom 0x0040 Aligns with the bottom.Qt.AlignVCenter 0x0080 Centers vertically in the available space. å¦‚æœéœ€è¦åŒæ—¶è®¾ç½®æ°´å¹³å’Œå‚ç›´å¯¹é½æ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨æŒ‰ä½æˆ–è¿ç®—ç¬¦ï¼š Qt.AlignHCenter | Qt.AlignVCenter åˆå¹¶å•å…ƒæ ¼ï¼šå¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç åˆå¹¶å¤šä¸ªå•å…ƒæ ¼ã€‚ tableWidget-setSpan(0, 0, 3, 1); // åˆå¹¶ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—çš„3è¡Œ1åˆ— è®¾ç½®å•å…ƒæ ¼çš„å¤§å°ï¼šå¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç è®¾ç½®ç‰¹å®šè¡Œæˆ–åˆ—çš„å¤§å°ã€‚ tableWidget-setColumnWidth(3, 200); // è®¾ç½®ç¬¬å››åˆ—å®½åº¦ä¸º200tableWidget-setRowHeight(3, 60); // è®¾ç½®ç¬¬å››è¡Œé«˜åº¦ä¸º60 è¿˜å¯ä»¥å°†è¡Œå’Œåˆ—çš„å¤§å°è®¾ä¸ºä¸å†…å®¹ç›¸åŒ¹é…ï¼š tableWidget-resizeColumnsToContents(); // æ ¹æ®å†…å®¹è°ƒæ•´æ‰€æœ‰åˆ—å®½tableWidget-resizeRowsToContents(); // æ ¹æ®å†…å®¹è°ƒæ•´æ‰€æœ‰è¡Œé«˜ è·å¾—å•å‡»å•å…ƒæ ¼çš„å†…å®¹ï¼šé€šè¿‡å®ç° itemClicked(QTableWidgetItem *) ä¿¡å·çš„æ§½å‡½æ•°ï¼Œå¯ä»¥è·å¾—é¼ æ ‡å•å‡»åˆ°çš„å•å…ƒæ ¼æŒ‡é’ˆï¼Œä»è€Œè·å–å…¶ä¸­çš„æ–‡å­—ä¿¡æ¯ã€‚ connect(tableWidget, SIGNAL(itemDoubleClicked(QTableWidgetItem*, int)), this, SLOT(getItem(QTableWidgetItem*, int)));// å°† itemClicked ä¿¡å·ä¸å‡½æ•° getItem ç»‘å®š QTableWidget è¦è°ƒæ•´è¡¨æ ¼è¡Œå®½ä¸»è¦æ¶‰åŠä»¥ä¸‹å‡½æ•°ï¼šé€šè¿‡ä»¥ä¸‹ä»£ç å¯ä»¥è°ƒæ•´è¡¨æ ¼çš„è¡Œå®½å’Œåˆ—å®½ã€‚ tableWidget-horizontalHeader()-setResizeMode(QHeaderView::Stretch); // åˆ—å®Œå…¨å¡«å……å¹¶å¹³åˆ†tableWidget-verticalHeader()-setResizeMode(QHeaderView::Stretch); // è¡Œè‡ªé€‚åº”å®½åº¦ tableWidget-resizeColumnsToContents(); // æ ¹æ®å†…å®¹è°ƒæ•´åˆ—å®½tableWidget-resizeColumnToContents(int col); // æ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´ç»™å®šåˆ—å®½ æ·»åŠ è¡¨å¤´å†…å®¹ï¼šå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹æ³•æ·»åŠ è¡¨å¤´å†…å®¹ã€‚ æ–¹æ³•ä¸€ï¼š QStringList header;header Column 1 Column 2 Column 3; // æ·»åŠ åˆ—åtableWidget-setHorizontalHeaderLabels(header); // è®¾ç½®è¡¨å¤´ æ–¹æ³•äºŒï¼š tableWidget-setHorizontalHeaderLabels(QStringList() tr(1) tr(2) tr(3)); // ç›´æ¥è®¾ç½®è¡¨å¤´ æ¸…é™¤ï¼šå¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ¸…é™¤è¡¨æ ¼ä¸­çš„å†…å®¹ã€‚ tableWidget-clear(); // æ¸…é™¤æ‰€æœ‰å¯è§æ•°æ®ï¼ˆåŒ…æ‹¬è¡¨å¤´ï¼‰ï¼Œè¡Œè¿˜åœ¨tableWidget-clearContents(); // åªæ¸…é™¤è¡¨ä¸­æ•°æ®ï¼Œä¸æ¸…é™¤è¡¨å¤´å†…å®¹tableWidget-setRowCount(0); // æ¸…é™¤æ‰€æœ‰è¡Œ ä¸€äº›é›¶ç¢çš„çŸ¥è¯†ç‚¹ä»£ç ï¼šä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„æ“ä½œä»£ç ç¤ºä¾‹ã€‚ int row = tableWidget-rowCount(); // è·å–è¡¨æ ¼ä¸­å½“å‰æ€»è¡Œæ•°tableWidget-setRowCount(row + 1); // æ·»åŠ ä¸€è¡ŒtableWidget-removeRow(row); // æ¸…é™¤å·²æœ‰çš„è¡Œint row1 = tableWidget-currentItem()-row(); // è·å–å½“å‰é€‰ä¸­è¡Œbool focus = tableWidget-isItemSelected(tableWidget-currentItem()); // åˆ¤æ–­æ˜¯å¦é€‰ä¸­ä¸€è¡ŒQString proName = tableWidget-item(row, col)-text(); // è·å–æŸä¸€æ ¼å†…å®¹tableWidget-setShowGrid(true); // æ˜¾ç¤ºè¡¨æ ¼çº¿tableWidget-verticalHeader()-setVisible(false); // éšè—å·¦è¾¹å‚ç›´è¡¨å¤´QHeaderView *headerView = tableWidget-horizontalHeader();headerView-setMovable(false); // å»é™¤è¡¨å¤´çš„ç§»åŠ¨headerView-resizeSection(0, 284); // è®¾ç½®ç¬¬ä¸€åˆ—å®½headerView-resizeSection(1, 127); // è®¾ç½®ç¬¬äºŒåˆ—å®½headerView-setResizeMode(QHeaderView::Fixed); // åˆ—è¡¨ä¸èƒ½ç§»åŠ¨headerView-setClickable(false); // ä¸å“åº”é¼ æ ‡å•å‡»tableWidget-setEditTriggers(QTableWidget::NoEditTriggers); // ä¸èƒ½ç¼–è¾‘tableWidget-setSelectionBehavior(QTableWidget::SelectRows); // ä¸€æ¬¡é€‰ä¸­ä¸€è¡ŒtableWidget-setSelectionMode(QAbstractItemView::SingleSelection); // åªèƒ½å•é€‰// QScrollBar *scrollBar = tableWidget-horizontalScrollBar();// scrollBar-hide(); // éšè—æ°´å¹³æ»šåŠ¨æ¡tableWidget-setHorizontalScrollBarPolicy(Qt::ScrollBarAlwaysOff); // å»æ‰æ°´å¹³æ»šåŠ¨æ¡tableWidget-setVerticalScrollMode(QAbstractItemView::ScrollPerItem); // å‚ç›´æ»šåŠ¨æ¡æŒ‰é¡¹ç§»åŠ¨tableWidget-setAutoScroll(false); // å»æ‰è‡ªåŠ¨æ»šåŠ¨ æ’åºï¼šå¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç å¯¹è¡¨æ ¼çš„æŸä¸€åˆ—è¿›è¡Œæ’åºã€‚ tableWidget-sortByColumn(0, Qt::AscendingOrder); // å°†ç¬¬ä¸€åˆ—æŒ‰å‡åºæ’åˆ— ç‚¹å‡»è¡¨å¤´è®¾ç½®å•å…ƒæ ¼æ’åºåœ¨ QT C++ä¸­ï¼ŒQTableWidget æä¾›äº†æ–¹ä¾¿çš„æ’åºåŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡ç‚¹å‡»è¡¨å¤´è¿›è¡Œæ’åºã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»ä¸¤ç§å®ç°æ–¹æ³•ï¼Œå¹¶æä¾›å®Œæ•´çš„ä»£ç ç¤ºä¾‹å’Œä½¿ç”¨åœºæ™¯è¯´æ˜ã€‚ æ–¹æ³•ä¸€ï¼šå¯ç”¨é»˜è®¤æ’åºåŠŸèƒ½QTableWidget æä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ¥å¯ç”¨æ’åºåŠŸèƒ½ï¼Œå³é€šè¿‡è°ƒç”¨ setSortingEnabled(true) æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œé€‚ç”¨äºå¤§å¤šæ•°é»˜è®¤çš„æ’åºéœ€æ±‚ã€‚ ä»£ç ç¤ºä¾‹QTableWidget *tableWidget = new QTableWidget(this);tableWidget-setRowCount(5);tableWidget-setColumnCount(3);tableWidget-setSortingEnabled(true); // å¯ç”¨æ’åºåŠŸèƒ½ è¯¦ç»†è¯´æ˜ å®ç°åŸç†ï¼šsetSortingEnabled(true) ä¼šè‡ªåŠ¨æ ¹æ®è¡¨æ ¼ä¸­æ¯ä¸€åˆ—çš„æ•°æ®ç±»å‹ï¼ˆå¦‚æ•°å­—ã€æ–‡æœ¬ã€æ—¥æœŸç­‰ï¼‰è¿›è¡Œæ’åºã€‚ä¾‹å¦‚ï¼š æ•°å­—åˆ—ä¼šæŒ‰ç…§ä»å°åˆ°å¤§æˆ–ä»å¤§åˆ°å°çš„é¡ºåºæ’åˆ—ã€‚ æ–‡æœ¬åˆ—ä¼šæŒ‰ç…§å­—æ¯é¡ºåºæ’åˆ—ã€‚ æ—¥æœŸåˆ—ä¼šæŒ‰ç…§æ—¶é—´é¡ºåºæ’åˆ—ã€‚ é€‚ç”¨åœºæ™¯ï¼š é€‚ç”¨äºéœ€è¦å¿«é€Ÿå®ç°ç®€å•æ’åºçš„åœºæ™¯ã€‚ é€‚ç”¨äºæ•°æ®ç±»å‹ä¸º QT å†…ç½®ç±»å‹ï¼ˆå¦‚ intã€QStringã€QDateTimeï¼‰çš„è¡¨æ ¼ã€‚ ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œä»£ç é‡å°‘ã€‚ ç¼ºç‚¹ï¼šæ’åºé€»è¾‘å®Œå…¨ç”± QT æ§åˆ¶ï¼Œæ— æ³•è‡ªå®šä¹‰æ’åºè§„åˆ™ã€‚ æ–¹æ³•äºŒï¼šè‡ªå®šä¹‰æ’åºå®ç°å¦‚æœéœ€è¦æ›´çµæ´»çš„æ’åºåŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡ QHeaderView çš„ sectionClicked ä¿¡å·æ¥å®ç°è‡ªå®šä¹‰æ’åºã€‚è¿™ç§æ–¹æ³•é€‚ç”¨äºéœ€è¦è‡ªå®šä¹‰æ’åºé€»è¾‘çš„åœºæ™¯ã€‚ ä»£ç ç¤ºä¾‹// åœ¨è¡¨å¤´å•å‡»æ—¶è§¦å‘æ’åºhorizontalHeader()-setSectionsClickable(true);connect(horizontalHeader(), QHeaderView::sectionClicked, this, CustomTableWidget::onHeaderClicked);// è‡ªå®šä¹‰æ’åºæ§½å‡½æ•°void CustomTableWidget::onHeaderClicked(int logicalIndex) // è·å–å½“å‰æ’åºåˆ— int column = logicalIndex; // è®¾ç½®æ’åºæ–¹å¼ï¼ˆå‡åºæˆ–é™åºï¼‰ Qt::SortOrder order = (horizontalHeader()-sortIndicatorOrder() == Qt::AscendingOrder) ? Qt::DescendingOrder : Qt::AscendingOrder; horizontalHeader()-setSortIndicator(column, order); // æ ¹æ®æ’åºåˆ—å’Œæ’åºæ–¹å¼å¯¹è¡¨æ ¼é¡¹è¿›è¡Œæ’åº sortItems(column, order);// è‡ªå®šä¹‰æ’åºå‡½æ•°void CustomTableWidget::sortItems(int column, Qt::SortOrder order) // è·å–è¡Œæ•° int row_count = tableWidget-rowCount(); // è·å–æ‰€æœ‰è¡Œæ•°æ® QListQTableWidgetItem* items; for (int i = 0; i row_count; i++) items tableWidget-item(i, column); // è‡ªå®šä¹‰æ’åºé€»è¾‘ std::sort(items.begin(), items.end(), [](QTableWidgetItem* a, QTableWidgetItem* b) // æ ¹æ®ä¸åŒæ•°æ®ç±»å‹å®ç°ä¸åŒçš„æ’åºè§„åˆ™ if (a-text().isdigit() b-text().isdigit()) // æ•°å­—æ’åº return order == Qt::AscendingOrder ? a-text().toInt() b-text().toInt() : a-text().toInt() b-text().toInt(); else // æ–‡æœ¬æ’åº return order == Qt::AscendingOrder ? a-text() b-text() : a-text() b-text(); ); // å°†æ’åºåçš„æ•°æ®é‡æ–°å¡«å……åˆ°è¡¨æ ¼ for (int i = 0; i row_count; i++) tableWidget-setItem(i, column, items[i]); è¯¦ç»†è¯´æ˜ å®ç°åŸç†ï¼š é€šè¿‡ QHeaderView::sectionClicked ä¿¡å·æ•è·è¡¨å¤´å•å‡»äº‹ä»¶ã€‚ åœ¨è‡ªå®šä¹‰æ§½å‡½æ•°ä¸­ï¼Œè·å–ç‚¹å‡»çš„åˆ—ç´¢å¼•å’Œæ’åºæ–¹å¼ï¼ˆå‡åºæˆ–é™åºï¼‰ã€‚ è°ƒç”¨è‡ªå®šä¹‰çš„ sortItems å‡½æ•°å¯¹è¡¨æ ¼é¡¹è¿›è¡Œæ’åºã€‚ é€‚ç”¨åœºæ™¯ï¼š éœ€è¦è‡ªå®šä¹‰æ’åºé€»è¾‘çš„åœºæ™¯ã€‚ è¡¨æ ¼ä¸­çš„æ•°æ®ç±»å‹ä¸ºè‡ªå®šä¹‰ç±»å‹æˆ–éœ€è¦ç‰¹æ®Šå¤„ç†çš„ç±»å‹ã€‚ ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼šå¯ä»¥å®Œå…¨è‡ªå®šä¹‰æ’åºé€»è¾‘ï¼Œçµæ´»æ€§å¼ºã€‚ ç¼ºç‚¹ï¼šå®ç°å¤æ‚ï¼Œä»£ç é‡è¾ƒå¤§ã€‚ æ³¨æ„äº‹é¡¹ æ•°æ®ç±»å‹å½±å“æ’åºï¼š ç¡®ä¿è¡¨æ ¼ä¸­çš„æ•°æ®ç±»å‹ä¸æ’åºé€»è¾‘åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œæ–‡æœ¬å½¢å¼çš„æ•°å­—éœ€è¦å…ˆè½¬æ¢ä¸ºæ•°å€¼ç±»å‹å†æ’åºã€‚ è¡¨æ ¼åˆ·æ–°ï¼š åœ¨è‡ªå®šä¹‰æ’åºåï¼Œå¯èƒ½éœ€è¦è°ƒç”¨ tableWidget-viewport()-update() åˆ·æ–°è¡¨æ ¼ã€‚ æ€§èƒ½é—®é¢˜ï¼š å¯¹äºå¤§æ•°æ®é‡çš„è¡¨æ ¼ï¼Œè‡ªå®šä¹‰æ’åºå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚å¯ä»¥é€šè¿‡ä¼˜åŒ–æ’åºç®—æ³•æˆ–ä½¿ç”¨æ•°æ®åº“æ’åºæ¥è§£å†³ã€‚","categories":["3.å¼€å‘æ¡†æ¶","Qt","æ§ä»¶"]},{"title":"å¾ªç¯è¯­å¥","path":"/2025/02/22/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-å¾ªç¯è¯­å¥/","content":"åŸºæœ¬ç»“æ„ é¡ºåºç»“æ„ã€é€‰æ‹©ç»“æ„ã€å¾ªç¯ç»“æ„ åœ¨ç”Ÿæ´»ä¸­æˆ‘ä»¬å¸¸å¸¸é‡åˆ°éœ€è¦é‡å¤å¤„ç†çš„é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨ç¼–ç¨‹æ—¶è§£å†³éœ€è¦é‡å¤å¤„ç†çš„é—®é¢˜éœ€è¦ä½¿ç”¨å¾ªç¯è¯­å¥ å¾ªç¯è¯­å¥ä¸»è¦æœ‰ 3 ç§ï¼šwhile()å¾ªç¯ï¼›do-while()å¾ªç¯å’Œ for()å¾ªç¯ while()å¾ªç¯ç”¨æ³•ï¼š while(å¾ªç¯æ¡ä»¶)\tå¾ªç¯ä½“;\tâ€¦â€¦ å½“ç¨‹åºé‡åˆ° while()å¾ªç¯çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šåˆ¤æ–­ while()çš„æ‹¬å·å†…çš„è¡¨è¾¾å¼ï¼Œè‹¥ä¸ºçœŸï¼ˆå³æ»¡è¶³å¾ªç¯æ¡ä»¶ï¼‰åˆ™æ‰§è¡Œå¾ªç¯ï¼Œæ‰§è¡Œå®Œå¾ªç¯ä½“åå†æ¬¡è¿”å›åˆ° while()ï¼›è‹¥ä¸ºå‡åˆ™ç»“æŸå¾ªç¯ ç¤ºä¾‹ï¼šè¾“å…¥ 10 ä¸ªå­¦ç”Ÿçš„æˆç»©ï¼Œè¾“å‡ºè¿™ 10 ä¸ªå­¦ç”Ÿçš„æˆç»©æ€»å’Œä»¥åŠå¹³å‡åˆ† int main()\tint i = 1,count = 0,input = 0;//iç”¨æ¥æ§åˆ¶å¾ªç¯æ¬¡æ•°ï¼Œcountç”¨äºæ€»å’Œï¼Œinputç”¨äºæ¯æ¬¡è¾“å…¥\tfloat avg = 0;//avgç”¨äºå¹³å‡åˆ†\twhile(i=10)//å¾ªç¯æ¡ä»¶ printf(è¯·è¾“å…¥ç¬¬%dä¸ªå­¦ç”Ÿçš„æˆç»©ï¼š ,i); scanf(%d,input); count += input; i++;//ä¸è¦å¿˜äº†è®©i++ avg = (float)count/10;\tprintf(æ€»æˆç»©æ˜¯%d å¹³å‡æˆç»©æ˜¯%f ,count,avg);\treturn 0; æ€è€ƒï¼šè‹¥åœ¨å¾ªç¯ä½“ä¸­æ²¡æœ‰ i++è¿™ä¸€å¥å°†ä¼šå‘ç”Ÿä»€ä¹ˆç»“æœï¼Ÿ i++è¿™ä¸€å¥çš„ä½œç”¨æ˜¯æ”¹å˜å¾ªç¯çš„çŠ¶æ€ã€‚è‹¥æ²¡æœ‰ i++è¿™å¥ï¼Œåˆ™ i çš„å€¼ä¼šæ°¸è¿œæ˜¯ 1ï¼Œåˆ™å¾ªç¯æ°¸è¿œéƒ½ä¸ä¼šç»“æŸï¼Œå³ç¨‹åºä¼šè¿›å…¥æ­»å¾ªç¯ åˆå­¦è€…åœ¨ä½¿ç”¨å¾ªç¯æ—¶ä¸€å®šè¦æ³¨æ„ä¸è¦é™·å…¥æ­»å¾ªç¯ã€‚å½“ä½ çš„ç¨‹åºä½¿ç”¨äº†å¾ªç¯ç»“æ„ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µæ— è¯­æ³•é”™è¯¯ï¼Œåœ¨æ‰§è¡Œæ—¶å‘ç°ç¨‹åºä¼šæ— é™æœŸè¿›è¡Œä¸‹å»ï¼Œåˆ™å¾ˆå¯èƒ½ä½ çš„ç¨‹åºè¿›å…¥äº†æ­»å¾ªç¯ã€‚æ­¤æ—¶è¦æ£€æŸ¥å¾ªç¯æ¡ä»¶è®¾ç½®æ˜¯å¦æ­£ç¡®ï¼Œä»¥åŠæ£€æŸ¥æ˜¯å¦è®¾ç½®äº†æ”¹å˜å¾ªç¯çŠ¶æ€çš„é‡ã€‚ è‹¥ while()åæ²¡æœ‰{}é™åˆ¶ï¼Œåˆ™å¾ªç¯åªæ‰§è¡Œåˆ° while()åç¬¬ä¸€ä¸ªåˆ†å·å¤„ï¼ˆå³åªæ‰§è¡Œä¸€æ¡è¯­å¥ï¼‰ï¼Œè¿™ç‚¹ä¸ if()-else ç›¸åŒ do-while()å¾ªç¯ç”¨æ³•ï¼š do\tå¾ªç¯ä½“;\tâ€¦â€¦while(å¾ªç¯æ¡ä»¶); å½“ç¨‹åºé‡åˆ° doï¼Œä¼šé¦–å…ˆæ‰§è¡Œ do ä¸‹é¢çš„è¯­å¥ï¼ˆå³å¾ªç¯ä½“ï¼‰ï¼Œä¹‹åæ‰§è¡Œåˆ° while()ï¼Œåˆ¤æ–­ while()çš„æ‹¬å·å†…çš„è¡¨è¾¾å¼æ˜¯çœŸå‡ï¼Œè‹¥ä¸ºçœŸï¼ˆå³æ»¡è¶³å¾ªç¯æ¡ä»¶ï¼‰åˆ™è¿”å› do è¯­å¥å¤„å†æ¬¡æ‰§è¡Œå¾ªç¯ä½“ï¼›è‹¥ä¸ºå‡åˆ™ç»“æŸå¾ªç¯ã€‚ ç¤ºä¾‹ï¼šå°†ä¸Šæ–‡ç¤ºä¾‹æ”¹å†™æˆ do-while()å¾ªç¯ int main()\tint i = 1,count = 0,input = 0;//iç”¨æ¥æ§åˆ¶å¾ªç¯æ¬¡æ•°ï¼Œcountç”¨äºæ€»å’Œï¼Œinputç”¨äºæ¯æ¬¡è¾“å…¥\tfloat avg = 0;//avgç”¨äºå¹³å‡åˆ†\tdo//å¾ªç¯å¼€å§‹ printf(è¯·è¾“å…¥ç¬¬%dä¸ªå­¦ç”Ÿçš„æˆç»©ï¼š ,i); scanf(%d,input); count += input; i++;//ä¸è¦å¿˜äº†è®©i++\twhile(i=10);//å¾ªç¯æ¡ä»¶\tavg = (float)count/10;\tprintf(æ€»æˆç»©æ˜¯%d å¹³å‡æˆç»©æ˜¯%f ,count,avg);\treturn 0; while()ä¸ do-while()çš„åŒºåˆ«ï¼š while()å¾ªç¯æ˜¯å…ˆåˆ¤æ–­å¾ªç¯æ¡ä»¶ï¼Œå†è¿›å…¥å¾ªç¯ä½“ã€‚è€Œ do-while()å¾ªç¯æ˜¯å…ˆè¿›å…¥å¾ªç¯ä½“ï¼Œå†åˆ¤æ–­å¾ªç¯æ¡ä»¶ã€‚ while()å¾ªç¯æœ‰å¯èƒ½ä¸æ‰§è¡Œå¾ªç¯ä½“ï¼Œè€Œ do-while()å¾ªç¯ä¸€å®šä¼šæ‰§è¡Œä¸€æ¬¡å¾ªç¯ä½“ for()å¾ªç¯ç”¨æ³•ï¼š for(è¡¨è¾¾å¼ 1;è¡¨è¾¾å¼ 2;è¡¨è¾¾å¼ 3)\tå¾ªç¯ä½“;\tâ€¦â€¦ æ³¨æ„ï¼šfor()æ‹¬å·å†…çš„ 3 ä¸ªè¡¨è¾¾å¼çš„åˆ†éš”ç¬¦æ˜¯åˆ†å·;ä¸æ˜¯é€—å·, è¡¨è¾¾å¼ 1ï¼šå¾ªç¯çš„åˆå§‹æ¡ä»¶ï¼Œåªæ‰§è¡Œä¸€æ¬¡ã€‚å¯ä»¥ä¸º 0 ä¸ªã€1 ä¸ªæˆ–å¤šä¸ªå˜é‡è®¾ç½®åˆå€¼ è¡¨è¾¾å¼ 2ï¼šåˆ¤æ–­å¾ªç¯ç»“æŸçš„æ¡ä»¶ã€‚åœ¨æ¯æ¬¡æ‰§è¡Œå¾ªç¯ä½“å‰åˆ¤æ–­æ­¤è¡¨è¾¾å¼ï¼Œè‹¥è¡¨è¾¾å¼ä¸ºçœŸåˆ™è¿›å…¥å¾ªç¯ï¼Œå¦åˆ™ä¸æ‰§è¡Œå¾ªç¯ è¡¨è¾¾å¼ 3ï¼šä½œä¸ºå¾ªç¯çš„è°ƒæ•´ï¼ˆå³æ”¹å˜å¾ªç¯çŠ¶æ€ï¼‰ï¼Œåœ¨æ‰§è¡Œå®Œå¾ªç¯ä½“ä¹‹åæ‰§è¡Œ ç­‰ä»·äºï¼š è¡¨è¾¾å¼ 1;while(è¡¨è¾¾å¼ 2)\tå¾ªç¯ä½“;\tè¡¨è¾¾å¼3; è¡¨è¾¾å¼ 1 å¯ä»¥çœç•¥ã€‚è‹¥å¦‚æ­¤åšï¼Œç›¸å½“äºæ²¡æœ‰ç»™ for()å¾ªç¯è®¾å®šèµ·å§‹åˆå€¼ã€‚å› æ­¤ï¼Œè‹¥è¦å¾ªç¯æ­£å¸¸è¿›è¡Œï¼Œéœ€è¦åœ¨ for()ä¹‹å‰è®¾ç½®å¥½å¾ªç¯èµ·å§‹åˆå€¼ è¡¨è¾¾å¼ 2 å¯ä»¥çœç•¥ã€‚è‹¥å¦‚æ­¤åšï¼Œç›¸å½“äº for()å¾ªç¯æ²¡æœ‰ç»“æŸæ¡ä»¶ï¼Œå³æ­»å¾ªç¯ã€‚ç­‰ä»·äºï¼š while(1)\tå¾ªç¯ä½“;\tè¡¨è¾¾å¼3; è¡¨è¾¾å¼ 3 å¯ä»¥çœç•¥ã€‚è‹¥å¦‚æ­¤åšï¼Œéœ€è¦åœ¨å¾ªç¯ä½“å†…è®¾ç½®å¾ªç¯è°ƒæ•´è¯­å¥ï¼Œå¦åˆ™å¾ªç¯æ— æ³•æ­£å¸¸æ‰§è¡Œã€‚ è‹¥å°† 3 ä¸ªè¡¨è¾¾å¼éƒ½çœç•¥ï¼ˆå³ for(;;)ï¼‰ï¼Œåˆ™ç›¸å½“äºè®¾ç½®äº†ä¸€ä¸ªæ— é™å¾ªç¯ è‹¥ for()åæ²¡æœ‰{}é™åˆ¶ï¼Œåˆ™å¾ªç¯åªæ‰§è¡Œåˆ° for()åç¬¬ä¸€ä¸ªåˆ†å·å¤„ï¼ˆå³åªæ‰§è¡Œä¸€æ¡è¯­å¥ï¼‰ï¼Œè¿™ç‚¹ä¸ if()-else ç›¸åŒ ä¸‰ç§å¾ªç¯çš„æ¯”è¾ƒï¼š1ï¼‰å¦‚æœä½¿ç”¨ while()æˆ– do-while()ï¼Œéœ€è¦æ³¨æ„åœ¨å¾ªç¯ä½“å†…è®¾ç½®æ”¹å˜å¾ªç¯çŠ¶æ€çš„å˜é‡ã€‚è€Œ for()å¾ªç¯åˆ™æ˜¯åœ¨è¡¨è¾¾å¼ 3 ä¸­è®¾ç½® 2ï¼‰ä¸€èˆ¬æ¥è¯´ï¼Œfor()å¾ªç¯çš„è¡¨è¾¾å¼ 3 çš„ä½ç½®ç”šè‡³å¯ä»¥å°†å¾ªç¯ä½“éƒ½æ”¾å…¥ï¼Œæ‰€ä»¥ for()å¾ªç¯æ›´å¸¸ç”¨ 3ï¼‰åœ¨çŸ¥é“å¾ªç¯æ¬¡æ•°çš„æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨ for()å¾ªç¯ï¼›åœ¨ä¸çŸ¥å¾ªç¯æ¬¡æ•°çš„æƒ…å†µä¸‹æ¨èä½¿ç”¨ while()æˆ– do-while()å¾ªç¯ 4ï¼‰ä» C99 ç‰ˆæœ¬å¼€å§‹ï¼ŒC è¯­è¨€æ”¯æŒä»¥ä¸‹ç”¨æ³•ï¼š for(int i=0;i10;i++)\tå¾ªç¯ä½“;\tâ€¦â€¦ è¿™æ ·å°±å¯ä»¥ä¸ç”¨äº‹å…ˆç‰¹åœ°å®šä¹‰ä¸€ä¸ªç”¨äºå¾ªç¯çš„å˜é‡ï¼Œéšæ—¶ä½¿ç”¨éšæ—¶å®šä¹‰å³å¯ã€‚ æ³¨æ„ 1ï¼šè¿™ç§ä½¿ç”¨æ–¹å¼å¾ªç¯å˜é‡ i çš„ç”Ÿå‘½å‘¨æœŸä»…ä»…æ˜¯åœ¨ for()å¾ªç¯ä¸­ï¼Œå½“ for()å¾ªç¯ç»“æŸ i å³ç»“æŸå…¶ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœè¿™æ ·ä½¿ç”¨ï¼š for(int i=0;i10;i++)\tå¾ªç¯ä½“;\tâ€¦â€¦printf(%d,i);//æ­¤æ—¶ i çš„ç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œä¼å›¾è®¿é—®ä¸å­˜åœ¨çš„å˜é‡ iï¼Œéæ³• åˆ™ç¼–è¯‘ä¼šæ˜¾ç¤ºè¯­æ³•é”™è¯¯ã€‚ æ³¨æ„ 2ï¼šè¿™ç§ç”¨æ³•ä»…æ”¯æŒ C99 åŠä»¥å C è¯­è¨€ç‰ˆæœ¬çš„ç¼–è¯‘å™¨ï¼Œå¦‚æœè¿™æ ·ä½¿ç”¨å‡ºç°è¯­æ³•é”™è¯¯åˆ™è¯æ˜å…¶ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸æ”¯æŒè¿™ç§è¯­æ³•ï¼Œè¯·ä¸è¦ä½¿ç”¨è¿™ç§è¯­æ³•è€Œæ˜¯åœ¨ for()å¾ªç¯å¼€å§‹å‰å°±å®šä¹‰å¾ªç¯å˜é‡ã€‚ å¾ªç¯çš„åµŒå¥—ä½¿ç”¨ä¸€ä¸ªå¾ªç¯ä½“å†…åˆåŒ…å«ä¸€ä¸ªå¾ªç¯ä½“çš„ç»“æ„ç§°ä¹‹ä¸ºå¾ªç¯çš„åµŒå¥—ã€‚å†…åµŒå¾ªç¯è¿˜å¯ä»¥å†åµŒå¥—å¾ªç¯ã€‚3 ç§å¾ªç¯éƒ½æ˜¯å¯ä»¥äº’ç›¸åµŒå¥—ä½¿ç”¨çš„ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­éƒ½æ˜¯åˆæ³•çš„ï¼š 1ï¼‰ while()\tdo while(); 2ï¼‰ for(;;)\twhile() 3ï¼‰ do\tfor() while(); æå‰ç»“æŸå¾ªç¯è¯­å¥ï¼šcontinueã€breakã€returnã€exit() continuecontinue è¯­å¥çš„ç”¨æ³•æ˜¯ï¼š continue; å…¶ä½œç”¨æ˜¯ç»“æŸæœ¬æ¬¡å¾ªç¯ï¼Œå³è·³è¿‡æ‰€æœ‰ continue ä¸‹çš„è¯­å¥ï¼Œè¿›å…¥ä¸‹æ¬¡å¾ªç¯ã€‚ breakbreak è¯­å¥çš„ç”¨æ³•æ˜¯ï¼š break; å…¶ä½œç”¨æ˜¯ç»“æŸå¾ªç¯ï¼Œæ‰§è¡Œå¾ªç¯ä½“å¤–çš„ä¸‹ä¸€ä¸ªè¯­å¥ å›é¡¾ï¼šbreak åœ¨ switch()è¯­å¥ä¸­çš„ä½œç”¨ break åœ¨ switch()è¯­å¥ä¸­çš„ä½œç”¨æ˜¯è·³å‡º switch()è¯­å¥ï¼Œæ‰§è¡Œ switch()è¯­å¥ä¸‹ä¸€æ¡è¯­å¥ã€‚ returnreturn è¯­å¥çš„ç”¨æ³•æ˜¯ï¼š return éœ€è¦çš„è¿”å›å€¼; å…¶ä¸­éœ€è¦çš„è¿”å›å€¼ç”±å‡½æ•°ç±»å‹å†³å®šã€‚å¦‚ main()å‡½æ•°æ˜¯ int ç±»å‹ï¼Œåˆ™éœ€è¦è¿”å›ä¸€ä¸ªæ•´æ•°ã€‚å¦‚æœå‡½æ•°æ˜¯ void ç±»å‹åˆ™æ— éœ€å†™è¿”å›å€¼ã€‚ return è¯­å¥çš„ä½œç”¨æ˜¯ç»“æŸå½“å‰å‡½æ•°ï¼Œå¹¶å°†è¿”å›å€¼è¿”å›ç»™å‡½æ•°è°ƒç”¨çš„ä½ç½®ã€‚ æœ‰å…³ return è¯­å¥çš„ç”¨æ³•æˆ‘ä»¬å°†åœ¨å‡½æ•°çš„è¯¾ç¨‹ä¸­è¯¦ç»†è®²è§£ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ return ä¸ä»…ä»…æ˜¯ç»“æŸäº†å¾ªç¯ï¼Œæ›´æ˜¯ç»“æŸäº†å½“å‰çš„å‡½æ•°ã€‚å› æ­¤è¦æ…ç”¨ã€‚ exitexit è¯­å¥çš„ç”¨æ³•æ˜¯ï¼š exit(x);//x ä¸º 0 æˆ–æ­£æ•´æ•° å½“ x ä¸º 0 æ—¶è¡¨ç¤ºæ­£å¸¸ç»“æŸï¼Œä¸ä¸º 0 æ—¶è¡¨ç¤ºå¼‚å¸¸ç»“æŸï¼ˆå¼‚å¸¸å·ï¼‰ exit()åœ¨å¤´æ–‡ä»¶ stdlib.h ä¸­ exit()ä¸ä»…ä»…æ˜¯ç»“æŸå¾ªç¯ï¼Œå®ƒçš„çœŸæ­£æ„ä¹‰æ˜¯é€€å‡ºå½“å‰ç¨‹åºã€‚å› æ­¤éå¸¸ä¸æ¨èä½¿ç”¨ exit()ç»“æŸå¾ªç¯ ä»æ•ˆæœæ¥çœ‹ï¼Œ4 ä¸ªè¯­å¥çš„æ•ˆæœå¦‚ä¸‹ï¼š exit() return break continueå¼º----------------------------å¼± goto è¯­å¥ç”¨æ³•ï¼š goto è¯­å¥æ ‡å·; è¯´æ˜ï¼š goto è¯­å¥æ˜¯æ— æ¡ä»¶è·³è½¬è¯­å¥ï¼Œå½“æ‰§è¡Œåˆ° goto è¯­å¥æ—¶ï¼Œç¨‹åºä¼šè·³è½¬åˆ° goto è¯­å¥æ‰€æŒ‡å‘çš„æ ‡å·å¤„ã€‚è¯­å¥æ ‡å·çš„å‘½åè§„åˆ™ä¸ C è¯­è¨€æ ‡è¯†ç¬¦çš„å‘½åè§„åˆ™ç›¸åŒã€‚ ç¤ºä¾‹ï¼š int main()\tlabel_1:\tâ€¦â€¦\tâ€¦â€¦\tgoto label_1; æ»¥ç”¨ goto è¯­å¥ä¼šä½¿ç¨‹åºæ— è§„å¾‹ã€å¯è¯»æ€§å·®ã€‚goto è¯­å¥è¿èƒŒäº† C è¯­è¨€çš„æ¨¡å—åŒ–ç¼–ç¨‹çš„åŸºæœ¬æ€æƒ³ï¼Œå› æ­¤ goto è¯­å¥ä¸æ¨èä½¿ç”¨ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€"]},{"title":"Linuxå†…æ ¸ï¼ˆ4.17.10ï¼‰é…ç½®é¡¹è¯¦è§£ï¼ˆx86ï¼‰_pci=realloc=on-CSDNåšå®¢","path":"/2025/02/22/1-å¹³å°ç³»ç»Ÿ-Linux-Linuxå†…æ ¸ï¼ˆ4-17-10ï¼‰é…ç½®é¡¹è¯¦è§£ï¼ˆx86ï¼‰-pci-realloc-on-CSDNåšå®¢/","content":"- `64-bit kernel`â€”â€”æ”¯æŒ64ä½- `General setup`â€”â€”é€šç”¨è®¾ç½®- `Cross-compiler tool prefix`â€”â€”äº¤å‰ç¼–è¯‘å·¥å…·å‰ç¼€- `Local version-append to kernel release`â€”â€”å†…æ ¸æ˜¾ç¤ºçš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¡«å…¥64å­—ç¬¦ä»¥å†…çš„å­—ç¬¦ä¸²ï¼Œå¯ç”¨uname -aå‘½ä»¤çœ‹åˆ°ã€‚- `Automatically append version information to the version string`â€”â€”è‡ªåŠ¨åœ¨ç‰ˆæœ¬å­—ç¬¦ä¸²åé¢æ·»åŠ ç‰ˆæœ¬ä¿¡æ¯,ç¼–è¯‘æ—¶éœ€è¦æœ‰perlä»¥åŠgitä»“åº“æ”¯æŒ- `Kernel compression mode (Gzip)`â€”â€”å†…æ ¸é•œåƒè¦ç”¨çš„å‹ç¼©æ¨¡å¼ï¼ŒGzipï¼ŒLZMAï¼Œ XZ ï¼ŒLZOï¼ŒLZ4- `Default hostname`â€”â€”é»˜è®¤ä¸»æœºå- `Support for paging of anonymous memory (swap)` â€”â€”ä½¿ç”¨äº¤æ¢åˆ†åŒºæˆ–äº¤æ¢æ–‡ä»¶æ¥åšä¸ºè™šæ‹Ÿå†…å­˜ã€‚- `System V IPC`â€”â€”æ”¯æŒsystem V è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ã€‚- `POSIX Message Queues`â€”â€”æ”¯æŒPOSIXæ ‡å‡†çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ç§IPCã€‚- `Enable process_vm_readv/writev syscalls`â€”â€”å¯ç”¨æ­¤é€‰é¡¹ä¼šæ·»åŠ ç³»ç»Ÿè°ƒç”¨process\\_vm\\_readvå’Œprocess\\_vm\\_writevï¼Œè¿™äº›è°ƒç”¨å…è®¸å…·æœ‰æ­£ç¡®æƒé™çš„è¿›ç¨‹ç›´æ¥è¯»å–æˆ–å†™å…¥å¦ä¸€ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚- `uselib syscall`â€”â€”æ­¤é€‰é¡¹å¯ç”¨uselib syscallï¼Œè¿™æ˜¯libc5åŠæ›´æ—©ç‰ˆæœ¬çš„åŠ¨æ€é“¾æ¥å™¨ä¸­ä½¿ç”¨çš„ç³»ç»Ÿè°ƒç”¨ã€‚ glibcä¸ä½¿ç”¨æ­¤ç³»ç»Ÿè°ƒç”¨ã€‚ å¦‚æœæ‚¨æ‰“ç®—è¿è¡ŒåŸºäºlibc5æˆ–æ›´æ—©ç‰ˆæœ¬çš„ç¨‹åºï¼Œåˆ™å¯èƒ½éœ€è¦å¯ç”¨æ­¤ç³»ç»Ÿè°ƒç”¨ã€‚ è¿è¡Œglibcçš„å½“å‰ç³»ç»Ÿå¯ä»¥å®‰å…¨åœ°ç¦ç”¨å®ƒã€‚- `Auditing support`â€”â€”å¯ç”¨å¯ä¸å…¶ä»–å†…æ ¸å­ç³»ç»Ÿä¸€èµ·ä½¿ç”¨çš„å®¡æ ¸åŸºç¡€ç»“æ„ï¼Œä¾‹å¦‚SELinuxï¼ˆéœ€è¦æ­¤ç”¨äºè®°å½•avcæ¶ˆæ¯è¾“å‡ºï¼‰ã€‚ ç³»ç»Ÿè°ƒç”¨å®¡è®¡åŒ…å«åœ¨æ”¯æŒå®ƒçš„ä½“ç³»ç»“æ„ä¸­ã€‚- `IRQ subsystem`â€”â€”ä¸­æ–­è¯·æ±‚å­ç³»ç»Ÿ - `Expose irq internals in debugfs`â€”â€”é€šè¿‡debugfså…¬å¼€å†…éƒ¨çŠ¶æ€ä¿¡æ¯ã€‚ ä¸»è¦ç”¨äºå¼€å‘äººå‘˜å’Œè°ƒè¯•éš¾ä»¥è¯Šæ–­çš„ä¸­æ–­é—®é¢˜- `Timers subsystem`â€”â€”æ—¶é’Ÿå­ç³»ç»Ÿ - `Periodic timer ticks`â€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- â€œâ€”â€”- BSD Process Accounting ç”¨æˆ·è¿›ç¨‹è®¿é—®å†…æ ¸æ—¶å°†è¿›ç¨‹ä¿¡æ¯å†™å…¥æ–‡ä»¶ä¸­ã€‚é€šå¸¸ä¸»è¦åŒ…æ‹¬è¿›ç¨‹çš„åˆ›å»ºæ—¶é—´/åˆ›å»ºè€…/å†…å­˜å ç”¨ç­‰ä¿¡æ¯ã€‚å»ºè®®æœ€å¥½é€‰ä¸Šã€‚ BSD Process Accounting [version](https://so.csdn.net/so/search?q=versionspm=1001.2101.3001.7020) 3 file format ä½¿ç”¨æ–°çš„ç¬¬ä¸‰ç‰ˆæ–‡ä»¶æ ¼å¼,å¯ä»¥åŒ…å«æ¯ä¸ªè¿›ç¨‹çš„PIDå’Œå…¶çˆ¶è¿›ç¨‹çš„PID,ä½†æ˜¯ä¸å…¼å®¹è€ç‰ˆæœ¬çš„æ–‡ä»¶æ ¼å¼ã€‚1.11ã€Export task/process statistics through netlink (EXPERIMENTAL) é€šè¿‡netlinkæ¥å£å‘ç”¨æˆ·ç©ºé—´å¯¼å‡ºä»»åŠ¡/è¿›ç¨‹çš„ç»Ÿè®¡ä¿¡æ¯,ä¸BSD Process Accountingçš„ä¸åŒä¹‹å¤„åœ¨äºè¿™äº›ç»Ÿè®¡ä¿¡æ¯åœ¨æ•´ä¸ªä»»åŠ¡/è¿›ç¨‹ç”Ÿå­˜æœŸéƒ½æ˜¯å¯ç”¨çš„ Enable per-task delay accounting (EXPERIMENTAL) åœ¨ç»Ÿè®¡ä¿¡æ¯ä¸­åŒ…å«è¿›ç¨‹ç­‰å€™ç³»ç»Ÿèµ„æº(cpu,IOåŒæ­¥,å†…å­˜äº¤æ¢ç­‰)æ‰€èŠ±è´¹çš„æ—¶é—´ Enable extended accounting over taskstats (EXPERIMENTAL) åœ¨ç»Ÿè®¡ä¿¡æ¯ä¸­åŒ…å«æ‰©å±•è¿›ç¨‹æ‰€èŠ±è´¹çš„æ—¶é—´1.12ã€Auditing support å®¡è®°æ”¯æŒï¼Œç”¨äºå’Œå†…æ ¸çš„æŸäº›å­æ¨¡å—åŒæ—¶å·¥ä½œï¼Œä¾‹å¦‚Security Enhanced Linuxã€‚åªæœ‰é€‰æ‹©æ­¤é¡¹åŠå®ƒçš„å­é¡¹ï¼Œæ‰èƒ½è°ƒç”¨æœ‰å…³å®¡è®°çš„ç³»ç»Ÿè°ƒç”¨ã€‚1.13ã€Enable system-call auditing support æ”¯æŒå¯¹ç³»ç»Ÿè°ƒç”¨çš„å®¡è®¡1.14ã€IRQ subsystem â€” ä¸­æ–­å­ç³»ç»Ÿ Support sparse irq numbering === æ”¯æŒç¨€æœ‰çš„ä¸­æ–­ç¼–å·ï¼Œå…³é—­1.15ã€RCU Subsystem â€” éå¯¹ç§°è¯»å†™é”ç³»ç»Ÿ æ˜¯ä¸€ç§é«˜æ€§èƒ½çš„kernel é”æœºåˆ¶ï¼Œé€‚ç”¨äºè¯»å¤šå†™å°‘ç¯å¢ƒ RCU Implementation (Tree-based hierarchical RCU) â€” RCU å®ç°æœºåˆ¶ Tree(X) Tree-based hierarchical RCU åŸºæœ¬æ•°æŒ‰ç­‰çº§åˆ’åˆ† Enable tracing for RCU æ¿€æ´»è·Ÿè¸ª (32) Tree-based hierarchical RCU fanout value åŸºæœ¬æ•°æŒ‰ç­‰çº§åˆ’åˆ†åˆ†åˆ—å€¼ Disable tree-based hierarchical RCU auto\\-balancing1.16ã€ Kernel .config support è¿™ä¸ªé€‰é¡¹å…è®¸.configæ–‡ä»¶ï¼ˆå³ç¼–è¯‘LINUXæ—¶çš„é…ç½®æ–‡ä»¶ï¼‰ä¿å­˜åœ¨å†…æ ¸å½“ä¸­1.17ã€(17) Kernel log buffer size (16 = 64KB, 17 = 128KB)1.18ã€\\[ \\] Control Group support â€” cgroups æ”¯æŒï¼Œ æ–‡æ¡£èµ„æ–™ ï¼Œcgroups ä¸»è¦ä½œç”¨æ˜¯ç»™è¿›ç¨‹åˆ†ç»„ï¼Œå¹¶å¯ä»¥åŠ¨æ€è°ƒæ§è¿›ç¨‹ç»„çš„CPU å ç”¨ç‡ã€‚æ¯”å¦‚A è¿›ç¨‹åˆ†åˆ°apple ç»„ï¼Œç»™äºˆ20%CPU å ç”¨ç‡ï¼ŒE è¿›ç¨‹åˆ†easy ç»„ï¼Œç»™äºˆ50%CPU å ç”¨ç‡ï¼Œæœ€é«˜100% ã€‚æˆ‘ç›®å‰æ²¡æœ‰æ­¤ç±»åº”ç”¨åœºæ™¯ï¼Œç”¨åˆ°æ—¶ä¼šé€‰æ‹©å°†å…¶ç¼–è¯‘è¿›å»ã€‚ CPU bandwidth provisioning for FAIR\\_GROUP\\_SCHED æ­¤é€‰é¡¹å…è®¸ç”¨æˆ·å®šä¹‰çš„CPUå¸¦å®½é€Ÿç‡ï¼ˆé™åˆ¶ï¼‰åœ¨å…¬å¹³çš„ç»„è°ƒåº¦è¿è¡Œçš„ä»»åŠ¡ã€‚ç»„æ²¡æœ‰é™åˆ¶è®¾ç½®è¢«è®¤ä¸ºæ˜¯æ— çº¦æŸå’Œè¿è¡Œæ²¡æœ‰é™åˆ¶ã€‚ Group scheduling for SCHED\\_RR/FIFO æ­¤åŠŸèƒ½å¯ä»¥è®©æ‚¨æ˜¾å¼åœ°åˆ†é…çœŸå®çš„CPUå¸¦å®½ä»»åŠ¡ç»„ã€‚1.19ã€-\\*- Namespaces support â€” å‘½åç©ºé—´æ”¯æŒï¼Œå…è®¸æœåŠ¡å™¨ä¸ºä¸åŒçš„ç”¨æˆ·ä¿¡æ¯æä¾›ä¸ åŒçš„ç”¨æˆ·åç©ºé—´æœåŠ¡ \\[\\*\\] UTS namespace é€šç”¨ç»ˆç«¯ç³»ç»Ÿçš„å‘½åç©ºé—´ã€‚å®ƒå…è®¸å®¹å™¨ï¼Œæ¯”å¦‚Vserversåˆ©ç”¨UTSå‘½åç©ºé—´æ¥ä¸ºä¸åŒçš„æœåŠ¡å™¨æä¾›ä¸åŒçš„UTSã€‚å¦‚æœä¸æ¸…æ¥šï¼Œé€‰Nã€‚ \\[\\*\\] IPC namespace IPCå‘½åç©ºé—´ï¼Œä¸ç¡®å®šå¯ä»¥ä¸é€‰ \\[\\*\\] User namespace (EXPERIMENTAL) Userå‘½åç©ºé—´ï¼Œä¸ç¡®å®šå¯ä»¥ä¸é€‰ \\[\\*\\] PID Namespaces PIDå‘½åç©ºé—´ï¼Œä¸ç¡®å®šå¯ä»¥ä¸é€‰ \\[\\*\\] Network namespace1.20ã€Automatic process group scheduling è‡ªåŠ¨è¿›ç¨‹ç»„è°ƒåº¦1.21ã€\\[ \\] enable deprecated sysfs features to support old userspace tools1.22ã€-\\*- Kernel-user space relay support (formerly relayfs) åœ¨æŸäº›æ–‡ä»¶ç³»ç»Ÿä¸Š( æ¯”å¦‚debugfs ) æä¾›ä»å†…æ ¸ç©ºé—´å‘ç”¨æˆ·ç©ºé—´ä¼ é€’å¤§é‡æ•°æ®çš„æ¥å£ï¼Œæˆ‘ç›®å‰æ²¡æœ‰æ­¤ç±»åº”ç”¨åœºæ™¯1.23ã€ \\[\\*\\] Initial RAM filesystem and RAM disk (initramfs/initrd) support ç”¨äºåœ¨çœŸæ­£å†…æ ¸è£…è½½å‰ï¼Œåšä¸€äº›æ“ä½œï¼ˆä¿—ç§°ä¸¤é˜¶æ®µå¯åŠ¨ï¼‰ï¼Œæ¯”å¦‚åŠ è½½module ï¼Œmount ä¸€äº›éroot åˆ†åŒºï¼Œæä¾›ç¾éš¾æ¢å¤shell ç¯å¢ƒç­‰ï¼Œ èµ„æ–™ ï¼Œæˆ‘æ˜¯æœŸæœ›ç›´æ¥ä»kernel image ç›´æ¥å¯åŠ¨ï¼Œæ‰€ä»¥æ²¡é€‰å®ƒï¼Ÿ1.24ã€Initramfs source file(s) initrdå·²ç»è¢«initramfså–ä»£,å¦‚æœä½ ä¸æ˜ç™½è¿™æ˜¯ä»€ä¹ˆæ„æ€,è¯·ä¿æŒç©ºç™½1.25ã€Optimize for size è¿™ä¸ªé€‰é¡¹å°†åœ¨GCC å‘½ä»¤åç”¨ â€œ-Os â€ ä»£æ›¿ â€œ-O2 â€³å‚æ•°ï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°æ›´å°çš„å†…æ ¸ã€‚æ²¡å¿…è¦é€‰ã€‚é€‰ä¸Šäº†æœ‰æ—¶ä¼šäº§ç”Ÿé”™è¯¯çš„äºŒè¿›åˆ¶ä»£ç ã€‚1.26ã€Enable full-sized data structures for coreï¼šåœ¨å†…æ ¸ä¸­ä½¿ç”¨å…¨å°ºå¯¸çš„æ•°æ®ç»“æ„.ç¦ç”¨å®ƒå°†ä½¿å¾—æŸäº›å†…æ ¸çš„æ•°æ®ç»“æ„å‡å°ä»¥èŠ‚çº¦å†…å­˜,ä½†æ˜¯å°†ä¼šé™ä½æ€§èƒ½ã€‚1.27ã€Enable futex supportï¼šå¿«é€Ÿç”¨æˆ·ç©ºé—´äº’æ–¥ä½“å¯ä»¥ä½¿çº¿ç¨‹ä¸²è¡ŒåŒ–ä»¥é¿å…ç«æ€æ¡ä»¶,ä¹Ÿæé«˜äº†å“åº”é€Ÿåº¦.ç¦ç”¨å®ƒå°†å¯¼è‡´å†…æ ¸ä¸èƒ½æ­£ç¡®çš„è¿è¡ŒåŸºäºglibcçš„ç¨‹åºã€‚1.28ã€Enable eventpoll supportï¼šæ”¯æŒäº‹ä»¶è½®å¾ªçš„ç³»ç»Ÿè°ƒç”¨ã€‚1.29ã€Use full shmem filesystemï¼šé™¤éä½ åœ¨å¾ˆå°‘çš„å†…å­˜ä¸”ä¸ä½¿ç”¨äº¤æ¢å†…å­˜æ—¶ï¼Œæ‰ä¸è¦é€‰æ‹©è¿™é¡¹ã€‚åé¢çš„è¿™å››é¡¹éƒ½æ˜¯åœ¨ç¼–è¯‘æ—¶å†…å­˜ä¸­çš„å¯¹é½æ–¹å¼ï¼Œ0 è¡¨ç¤º ç¼–è¯‘å™¨çš„é»˜è®¤æ–¹å¼ã€‚ä½¿ç”¨å†…å­˜å¯¹é½èƒ½æé«˜ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ï¼Œä½†æ˜¯ä¼šå¢åŠ ç¨‹åºå¯¹å†…å­˜çš„ä½¿ç”¨é‡ã€‚å†…æ ¸ä¹Ÿæ˜¯ä¸€ç»„ç¨‹åºå‘€ã€‚ Enable VM event counters for /proc/vmstatï¼šå…è®¸åœ¨/proc/vmstatä¸­åŒ…å«è™šæ‹Ÿå†…å­˜äº‹ä»¶è®°æ•°å™¨ã€‚ \\[\\*\\] Disable heap randomization ç¦ç”¨éšæœºheapï¼ˆheapå †æ˜¯ä¸€ä¸ªåº”ç”¨å±‚çš„æ¦‚å¿µï¼Œå³å †å¯¹CPUæ˜¯ä¸å¯è§çš„ï¼Œå®ƒçš„å®ç°æ–¹å¼æœ‰å¤šç§ï¼Œå¯ä»¥ç”±OSå®ç°ï¼Œä¹Ÿå¯ä»¥ç”±è¿è¡Œåº“å®ç°,å¦‚æœä½ æ„¿æ„ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ªæ ˆä¸­æ¥å®ç°ä¸€ä¸ªå †ï¼‰1.30ã€Choose SLAB allocator (SLAB) â€” é€‰æ‹©å†…å­˜åˆ†é…ç®¡ç†å™¨ï¼ˆå¼ºçƒˆæ¨èä½¿ç”¨SLUBï¼‰1.31ã€\\[ \\] Configure standard kernel features (for small systems) â€” è¿™ä¸ªé€‰é¡¹å¯ä»¥è®©å†…æ ¸çš„åŸºæœ¬é€‰é¡¹å’Œè®¾ç½®æ— æ•ˆæˆ–è€…æ‰­æ›²ã€‚è¿™æ˜¯ç”¨äºç‰¹å®šç¯å¢ƒä¸­çš„ï¼Œå®ƒå…è®¸â€œéæ ‡å‡†â€å†…æ ¸ã€‚ä½ è¦æ˜¯é€‰å®ƒï¼Œä½ ä¸€å®šè¦æ˜ç™½è‡ªå·±åœ¨å¹²ä»€ä¹ˆã€‚è¿™æ˜¯ä¸ºäº†ç¼–è¯‘æŸ äº›ç‰¹æ®Šç”¨é€”çš„å†…æ ¸ä½¿ç”¨çš„ï¼Œä¾‹å¦‚å¼•å¯¼ç›˜ç³»ç»Ÿã€‚é…ç½®æ ‡å‡†çš„å†…æ ¸ç‰¹æ€§(ä¸ºå°å‹ç³»ç»Ÿ) Enable 16-bit UID system callsï¼šå…è®¸å¯¹UIDç³»ç»Ÿè°ƒç”¨è¿›è¡Œè¿‡æ—¶çš„16-bitåŒ…è£…ã€‚ Sysctl syscall support å‡ ä¹ä½¿ç”¨ä¸åˆ°è¿™ä¸€é€‰é¡¹ï¼Œä¸é€‰å®ƒå¯ä»¥è½»å¾®ä½¿å†…æ ¸å˜å° Include all symbols in kallsymsï¼šåœ¨kallsymsä¸­åŒ…å«å†…æ ¸çŸ¥é“çš„æ‰€æœ‰ç¬¦å·,å†…æ ¸å°†ä¼šå¢å¤§300Kã€‚ Enable support for printkï¼šå…è®¸å†…æ ¸å‘ç»ˆç«¯æ‰“å°å­—ç¬¦ä¿¡æ¯,åœ¨éœ€è¦è¯Šæ–­å†…æ ¸ä¸ºä»€ä¹ˆä¸èƒ½è¿è¡Œæ—¶é€‰æ‹©ã€‚ BUG() supportï¼šæ˜¾ç¤ºæ•…éšœå’Œå¤±è´¥æ¡ä»¶(BUG å’ŒWARN),ç¦ç”¨å®ƒå°†å¯èƒ½å¯¼è‡´éšå«çš„é”™è¯¯è¢«å¿½ç•¥ã€‚ Enable ELF core dumpsï¼šå†…å­˜è½¬å‚¨æ”¯æŒ,å¯ä»¥å¸®åŠ©è°ƒè¯•ELFæ ¼å¼çš„ç¨‹åºã€‚1.32ã€\\[\\*\\] Profiling support ä¸é€‰å‰–é¢æ”¯æŒï¼Œç”¨ä¸€ä¸ªå·¥å…·æ¥æ‰«æå’Œæä¾›è®¡ç®—æœºçš„å‰–é¢å›¾ã€‚æ”¯æŒç³»ç»Ÿè¯„æµ‹ï¼ˆå¯¹äºå¤§å¤šæ•°ç”¨æˆ·æ¥è¯´å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼‰1.33ã€OProfile system profiling OProfileè¯„æµ‹å’Œæ€§èƒ½ç›‘æ§å·¥å…·1.35ã€\\[ \\] OProfile multiplexing support (EXPERIMENTAL)1.34ã€Kprobes è°ƒè¯•å†…æ ¸é™¤éå¼€å‘äººå‘˜ï¼Œå¦åˆ™ä¸é€‰?1.35ã€Optimize trace point call sites1.36ã€GCOV-based kernel profiling \\[ \\] Enable gcov-based kernel profiling ä¸é€‰2ã€Enable loadable module support 2.1 Forced module loading å…è®¸å¼ºåˆ¶åŠ è½½æ¨¡å—2.2 Module unloading å…è®¸å¸è½½å·²ç»åŠ è½½çš„æ¨¡å—2.3 Forced module unloading å…è®¸å¼ºåˆ¶å¸è½½æ­£åœ¨ä½¿ç”¨ä¸­çš„æ¨¡å—(æ¯”è¾ƒå±é™©)è¿™ä¸ªé€‰é¡¹å…è®¸ä½ å¼ºè¡Œå¸é™¤æ¨¡å—ï¼Œå³ä½¿å†…æ ¸è®¤ä¸ºè¿™ä¸å®‰å…¨ã€‚å†…æ ¸å°†ä¼šç«‹å³ç§»é™¤æ¨¡å—ï¼Œè€Œä¸ç®¡æ˜¯å¦æœ‰äººåœ¨ä½¿ç”¨å®ƒï¼ˆç”¨ rmmod -f å‘½ä»¤ï¼‰ã€‚è¿™ä¸»è¦æ˜¯é’ˆå¯¹å¼€å‘è€…å’Œå†²åŠ¨çš„ç”¨æˆ·æä¾›çš„åŠŸèƒ½ã€‚å¦‚æœä¸æ¸…æ¥šï¼Œé€‰Nã€‚2.4 Module versioning support æœ‰æ—¶å€™ï¼Œä½ éœ€è¦ç¼–è¯‘æ¨¡å—ã€‚é€‰è¿™é¡¹ä¼šæ·»åŠ ä¸€äº›ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ¥ç»™ç¼–è¯‘çš„æ¨¡å—æä¾›ç‹¬ç«‹çš„ç‰¹æ€§ï¼Œä»¥ä½¿ä¸åŒçš„å†…æ ¸åœ¨ä½¿ç”¨åŒä¸€æ¨¡å—æ—¶åŒºåˆ«äºå®ƒåŸæœ‰çš„æ¨¡å—ã€‚è¿™æœ‰æ—¶å¯èƒ½ä¼šæœ‰ç‚¹ç”¨ã€‚å¦‚æœä¸æ¸…æ¥šï¼Œé€‰Nã€‚å…è®¸ä½¿ç”¨å…¶ä»–å†…æ ¸ç‰ˆæœ¬çš„æ¨¡å—(å¯èƒ½ä¼šå‡ºé—®é¢˜)2.5 Source checksum for all modules ä¸ºæ‰€æœ‰çš„æ¨¡å—æ ¡éªŒæºç ,å¦‚æœä½ ä¸æ˜¯è‡ªå·±ç¼–å†™å†…æ ¸æ¨¡å—å°±ä¸éœ€è¦å®ƒè¿™ä¸ªåŠŸèƒ½æ˜¯ä¸ºäº†é˜²æ­¢ä½ åœ¨ç¼–è¯‘æ¨¡å—æ—¶ä¸å°å¿ƒæ›´æ”¹äº†å†…æ ¸æ¨¡å—çš„æºä»£ç ä½†å¿˜è®°æ›´æ”¹ç‰ˆæœ¬å·è€Œé€ æˆç‰ˆæœ¬å†²çªã€‚å¦‚æœä¸æ¸…æ¥šï¼Œé€‰Nã€‚3ã€Enable the block layer å—è®¾å¤‡æ”¯æŒ,ä½¿ç”¨ç¡¬ç›˜/USB/SCSIè®¾å¤‡è€…å¿…é€‰è¿™é€‰é¡¹ä½¿å¾—å—è®¾å¤‡å¯ä»¥ä»å†…æ ¸ç§»é™¤ã€‚å¦‚æœä¸é€‰ï¼Œé‚£ä¹ˆ blockdev æ–‡ä»¶å°†ä¸å¯ç”¨ï¼Œä¸€äº›æ–‡ä»¶ç³»ç»Ÿæ¯”å¦‚ ext3 å°†ä¸å¯ç”¨ã€‚è¿™ä¸ªé€‰é¡¹ä¼šç¦æ­¢ SCSI å­—ç¬¦è®¾å¤‡å’Œ USB å‚¨å­˜è®¾å¤‡ï¼Œå¦‚æœå®ƒä»¬ä½¿ç”¨ä¸åŒçš„å—è®¾å¤‡ã€‚é€‰Yï¼Œé™¤éä½ çŸ¥é“ä½ ä¸éœ€è¦æŒ‚è½½ç¡¬ç›˜å’Œå…¶ä»–ç±»ä¼¼çš„è®¾å¤‡ã€‚ä¸è¿‡æ­¤é¡¹æ— å¯é€‰é¡¹3.1 Support for large (2TB+) block devices and files ä»…åœ¨ä½¿ç”¨å¤§äº2TBçš„å—è®¾å¤‡æ—¶éœ€è¦3.2 Block layer SG support v4 é€šç”¨scsiå—è®¾å¤‡ç¬¬4ç‰ˆæ”¯æŒ3.3 Block layer data integrity support å—è®¾å¤‡æ•°æ®å®Œæ•´æ€§æ”¯æŒï¼Ÿ3.4 Block layer bio throttling support å¯ç”¨äºé™åˆ¶è®¾å¤‡çš„IOé€Ÿåº¦3.5 Partition Types Advanced partition selection å¦‚æœä½ æƒ³è¦åœ¨linuxä¸Šä½¿ç”¨ä¸€ä¸ªåœ¨å…¶ä»–çš„ä»‹è´¨ä¸Šè¿è¡Œç€æ“ä½œç³»ç»Ÿçš„ç¡¬ç›˜æ—¶ï¼Œé€‰æ‹©Yï¼Œå¦‚æœä½ ä¸ç¡®å®šæ—¶å¯ä»¥é€‰N3.6 IO Schedulers IOè°ƒåº¦å™¨Iï¼Oæ˜¯è¾“å…¥è¾“å‡ºå¸¦å®½æ§åˆ¶ï¼Œä¸»è¦é’ˆå¯¹ç¡¬ç›˜ï¼Œæ˜¯æ ¸å¿ƒçš„å¿…é¡»çš„ä¸œè¥¿ã€‚è¿™é‡Œæä¾›äº†ä¸‰ä¸ªIOè°ƒåº¦å™¨ã€‚ Deadline I/O scheduler ä½¿ç”¨è½®è¯¢çš„è°ƒåº¦å™¨,ç®€æ´å°å·§,æä¾›äº†æœ€å°çš„è¯»å–å»¶è¿Ÿå’Œå°šä½³çš„ååé‡,ç‰¹åˆ«é€‚åˆäºè¯»å–è¾ƒå¤šçš„ç¯å¢ƒ(æ¯”å¦‚æ•°æ®åº“)Deadline Iï¼Oè°ƒåº¦å™¨ç®€å•è€Œåˆç´§å¯†ï¼Œåœ¨æ€§èƒ½ä¸Šå’ŒæŠ¢å…ˆå¼è°ƒåº¦å™¨ä¸ç›¸ä¸Šä¸‹ï¼Œåœ¨ä¸€äº›æ•°æ®è°ƒå…¥æ—¶å·¥ä½œå¾—æ›´å¥½ã€‚è‡³äºåœ¨å•è¿›ç¨‹Iï¼Oç£ç›˜è°ƒåº¦ä¸Šï¼Œå®ƒçš„å·¥ä½œæ–¹å¼å‡ ä¹å’ŒæŠ¢å…ˆå¼è°ƒåº¦å™¨ç›¸åŒï¼Œå› æ­¤ä¹Ÿæ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚CFQ I/O scheduler ä½¿ç”¨QoSç­–ç•¥ä¸ºæ‰€æœ‰ä»»åŠ¡åˆ†é…ç­‰é‡çš„å¸¦å®½,é¿å…è¿›ç¨‹è¢«é¥¿æ­»å¹¶å®ç°äº†è¾ƒä½çš„å»¶è¿Ÿ,å¯ä»¥è®¤ä¸ºæ˜¯ä¸Šè¿°ä¸¤ç§è°ƒåº¦å™¨çš„æŠ˜ä¸­.é€‚ç”¨äºæœ‰å¤§é‡è¿›ç¨‹çš„å¤šç”¨æˆ·ç³»ç»ŸCFQè°ƒåº¦å™¨å°è¯•ä¸ºæ‰€æœ‰è¿›ç¨‹æä¾›ç›¸åŒçš„å¸¦å®½ã€‚å®ƒå°†æä¾›å¹³ç­‰çš„å·¥ä½œç¯å¢ƒï¼Œå¯¹äºæ¡Œé¢ç³»ç»Ÿå¾ˆåˆé€‚ã€‚ Default I/O scheduler (CFQ) é»˜è®¤IOè°ƒåº¦å™¨æˆ‘è¿™æ ·ç†è§£ä¸Šé¢ä¸‰ä¸ªIOè°ƒåº¦å™¨ï¼š æŠ¢å…ˆå¼æ˜¯ä¼ ç»Ÿçš„ï¼Œå®ƒçš„åŸç†æ˜¯ä¸€æœ‰å“åº”ï¼Œå°±ä¼˜å…ˆè€ƒè™‘è°ƒåº¦ã€‚å¦‚æœä½ çš„ç¡¬ç›˜æ­¤æ—¶åœ¨è¿è¡Œä¸€é¡¹å·¥ä½œï¼Œå®ƒä¹Ÿä¼šæš‚åœä¸‹æ¥å…ˆå“åº”ç”¨æˆ·ã€‚ æœŸé™å¼åˆ™æ˜¯ï¼šæ‰€æœ‰çš„å·¥ä½œéƒ½æœ‰æœ€ç»ˆæœŸé™ï¼Œåœ¨è¿™ä¹‹å‰å¿…é¡»å®Œæˆã€‚å½“ç”¨æˆ·æœ‰å“åº”æ—¶ï¼Œå®ƒä¼šæ ¹æ®è‡ªå·±çš„å·¥ä½œèƒ½å¦å®Œæˆï¼Œæ¥å†³å®šæ˜¯å¦å“åº”ç”¨æˆ·ã€‚ CFQåˆ™æ˜¯å¹³å‡åˆ†é…èµ„æºï¼Œä¸ç®¡ä½ çš„å“åº”å¤šæ€¥ï¼Œä¹Ÿä¸ç®¡å®ƒçš„å·¥ä½œé‡æ˜¯å¤šå°‘ï¼Œå®ƒéƒ½æ˜¯å¹³å‡åˆ†é…ï¼Œä¸€è§†åŒä»çš„ã€‚ ( *) Deadline ( ) CFQ ( ) No-op 4ã€Processor type and features ï¼ˆå¤„ç†å™¨ç±»å‹åŠç‰¹ç‚¹ï¼‰ ï¼Ÿ4.1 DMA memory allocation support è¯¥é€‰é¡¹å…è®¸å°äº32ä½åœ°å€çš„è®¾å¤‡ä½¿ç”¨å‰16MBçš„åœ°å€ç©ºé—´ï¼Œå¦‚æœä¸ç¼ºå®šçš„è¯ï¼Œé€‰Y4.2 Symmetric multi-processing support å¯¹ç§°å¤šå¤„ç†å™¨æ”¯æŒ,å¦‚æœä½ æœ‰å¤šä¸ªCPUæˆ–è€…ä½¿ç”¨çš„æ˜¯å¤šæ ¸CPUå°±é€‰ä¸Š.æ­¤æ—¶â€Enhanced Real Time Clock Supportâ€é€‰é¡¹å¿…é¡»å¼€å¯,â€Advanced Power Managementâ€é€‰é¡¹å¿…é¡»å…³é—­å¦‚æœä½ é€‰Nï¼Œå†…æ ¸å°†ä¼šåœ¨å•ä¸ªæˆ–è€…å¤šä¸ªCPUçš„æœºå™¨ä¸Šè¿è¡Œï¼Œä½†æ˜¯åªä¼šä½¿ç”¨ä¸€ä¸ªCPUã€‚å¦‚æœä½ é€‰Yï¼Œå†…æ ¸å¯ä»¥åœ¨å¾ˆå¤šï¼ˆä½†ä¸æ˜¯æ‰€æœ‰ï¼‰å•CPUçš„æœºå™¨ä¸Šè¿è¡Œï¼Œåœ¨è¿™æ ·çš„æœºå™¨ï¼Œä½ é€‰Nä¼šä½¿å†…æ ¸è¿è¡Œå¾—æ›´å¿«ã€‚ å¦‚æœä½ é€‰Yï¼Œç„¶ååœ¨Processor familyé€‰é¡¹ä¸­é€‰æ‹©â€œ586ã€ƒ or â€œPentiumâ€ ï¼Œå†…æ ¸å°†ä¸èƒ½è¿è¡Œåœ¨486æ„æ¶çš„æœºå™¨ä¸Šã€‚åŒæ ·çš„ï¼Œå¤šCPUçš„è¿è¡ŒäºPProæ„æ¶ä¸Šçš„å†…æ ¸ä¹Ÿæ— æ³•åœ¨ Pentium ç³»åˆ—çš„æ¿ä¸Šè¿è¡Œã€‚4.3 Enable MPS table MPSå¤šå¤„ç†å™¨è§„èŒƒï¼Œä¸é€‰4.4 Support for big SMP systems with more than 8 CPUs é»˜è®¤æƒ…å†µä¸‹ä¸ºä¸é€‰4.5 Support for extended (non-PC) x86 platforms å¦‚æœé€‰çš„è¯ï¼Œä½ å°†å¯ä»¥é€‰æ‹©æ”¯æŒå¦‚ä¸‹32ä½X86çš„å¹³å°ã€‚ AMD Elanï¼ŒNUMAQ (IBM/Sequent)ï¼ŒRDC R-321x SoCï¼ŒSGI 320/540 (Visual Workstation)ï¼ŒSTA2X11-based (e.g. Northville)ï¼ŒSummit/EXA (IBM x440)ï¼ŒUnisys ES7000 IA32 series Moorestown MID deviceså¦‚æœä½ æœ‰è¿™æ ·çš„ç³»ç»Ÿï¼Œæˆ–è€…ä½ æƒ³è¦æ„å»ºä¸€ä¸ªè¿™æ ·çš„é€šç”¨çš„åˆ†å¸ƒå¼ï¼Œé€‰æ‹©Yï¼Œå¦åˆ™é€‰æ‹©Nï¼Ÿ4.6 intel MID platform support Medfield MID platform4.7 RDC R-321x SoC åµŒå…¥å¼ç›¸å…³ï¼Œä¸é€‰4.8 Support non-standard 32-bit SMP architectures éæ ‡å‡†çš„32ä½SMPç»“æ„æ”¯æŒï¼Œä¸é€‰4.9 Eurobraille/Iris poweroff module æ¥è‡ªurobrailleçš„irisæœºå™¨ä¸æ”¯æŒAPMå’ŒACPIæ¥é€‚æ—¶å…³é—­è‡ªå·±ï¼Œæ­¤æ¨¡å—åœ¨å†…æ ¸ä¸­èµ·åˆ°è¿™ä¸€ä½œç”¨ã€‚è¿™æ˜¯ç”¨äºurobrailleçš„irisæœºå­ï¼Œä¸ç¡®å®šçš„è¯ï¼Œä¸é€‰ã€‚4.10 Single-depth WCHAN output è·Ÿ proc ç›¸å…³çš„æœ€å¥½ä¸è¦å…³ï¼Œé€‰Yï¼Ÿ4.11 paravirt-ops debugging4.12 Memtest è¿™ä¸€é€‰é¡¹ä½¿å†…æ ¸å¢åŠ ä¸€ä¸ªâ€œmemtestâ€ï¼ˆå†…æ ¸æµ‹è¯•ï¼‰çš„å‚æ•°ï¼Œè¿™å°†å…è®¸è®¾ç½®memtestã€‚å¦‚æœä½ ä¸çŸ¥é“å¦‚ä½•å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œé€‰æ‹©N4.13 Processor family (Pentium-Pro)å¤„ç†å™¨ç³»åˆ—,è¯·æŒ‰ç…§ä½ å®é™…ä½¿ç”¨çš„CPUé€‰æ‹©è¿™é‡Œæ˜¯å¤„ç†å™¨çš„ç±»å‹ã€‚è¿™é‡Œçš„ä¿¡æ¯ä¸»è¦ç›®çš„æ˜¯ç”¨æ¥ä¼˜åŒ–ã€‚ä¸ºäº†è®©å†…æ ¸èƒ½å¤Ÿåœ¨æ‰€æœ‰X86æ„æ¶çš„CPUä¸Šè¿è¡Œï¼ˆè™½ç„¶ä¸æ˜¯ æœ€ä½³é€Ÿåº¦ï¼‰ï¼Œåœ¨è¿™ä½ å¯ä»¥é€‰386ã€‚å†…æ ¸ä¸ä¼šè¿è¡Œåœ¨æ¯”ä½ é€‰çš„æ„æ¶è¿˜è¦è€çš„æœºå™¨ä¸Šã€‚æ¯”å¦‚ï¼Œä½ é€‰äº†Pentiumæ„æ¶æ¥ä¼˜åŒ–å†…æ ¸ï¼Œå®ƒå°†ä¸èƒ½åœ¨486æ„æ¶ä¸Šè¿è¡Œã€‚å¦‚æœä½ ä¸æ¸…æ¥šï¼Œé€‰386ã€‚( ) 386 ( ) 486( ) 586/K5/5x86/6x86/6x86MX ( ) Pentium-Classic( ) Pentium-MMX(ç³»ç»Ÿé»˜è®¤é€‰é¡¹) Pentium-Pro ( ) Pentium-II/Celeron(pre-Coppermine)( ) Pentium-III/Celeron(Coppermine)/Pentium-III Xeon ( ) Pentium M( ) Pentium-4/Celeron(P4-based)/Pentium-4 M/older Xeon ( ) K6/K6-II/K6-III( ) Athlon/Duron/K7( ) Opteron/Athlon64/Hammer/K8( ) Crusoe( ) Efficeon( ) Winchip-C6( ) Winchip-2/Winchip-2A/Winchip-3( ) GeodeGX1( ) Geode GX/LX( ) CyrixIII/VIA-C3( ) VIA C3-2 (Nehemiah)( ) VIA C7 ( ) Core 2/newer Xeon( ) Intel Atomï¼Ÿ4.14 Generic x86 support è¿™ä¸€é€‰é¡¹é’ˆå¯¹x86ç³»åˆ—çš„CPUä½¿ç”¨æ›´å¤šçš„å¸¸è§„ä¼˜åŒ–ã€‚å¦‚æœä½ åœ¨ä¸Šé¢ä¸€é¡¹é€‰çš„æ˜¯i386ã€i586ä¹‹ç±»çš„æ‰é€‰è¿™ä¸ªé€šç”¨x86æ”¯æŒ,å¦‚æœä½ çš„CPUèƒ½å¤Ÿåœ¨ä¸Šè¿°â€Processor familyâ€ä¸­æ‰¾åˆ°å°±åˆ«é€‰é™¤äº†å¯¹ä¸Šé¢ä½ é€‰æ‹©çš„X86 CPUè¿›è¡Œä¼˜åŒ–ï¼Œå®ƒè¿˜å¯¹æ›´å¤šç±»å‹X86 CPUçš„è¿›è¡Œä¼˜åŒ–ã€‚è¿™å°†ä¼šä½¿å†…æ ¸åœ¨å…¶ä»–çš„X86 CPUä¸Šè¿è¡Œå¾—æ›´å¥½ã€‚è¿™ä¸ªé€‰é¡¹æä¾›äº†å¯¹X86ç³»åˆ—CPUæœ€å¤§çš„å…¼å®¹æ€§ï¼Œç”¨æ¥æ”¯æŒä¸€äº›å°‘è§çš„x86æ„æ¶çš„CPUã€‚å¦‚æœä½ çš„CPUèƒ½å¤Ÿåœ¨ä¸Šé¢çš„åˆ—è¡¨ä¸­æ‰¾åˆ°ï¼Œå°±é‡Œå°±ä¸ç”¨é€‰äº†ã€‚4.15 PentiumPro memory ordering errata workaround æ—§çš„PentiumProå¤šå¤„ç†å™¨ç³»ç»Ÿæœ‰å‹˜è¯¯èƒ½åŠ›ï¼Œå¯èƒ½ä¼šå¯¼è‡´åœ¨å°‘æ•°çš„æƒ…å†µä¸‹ï¼Œè¿åx86çš„æ’åºæ ‡å‡†å†…å­˜æ“ä½œã€‚å¯ç”¨æ­¤é€‰é¡¹å°†å°è¯•è§£å†³ä¸€äº›ï¼ˆä½†ä¸æ˜¯å…¨éƒ¨ï¼‰æ­¤ç±»é—®é¢˜ï¼Œä½†å°†ä»¥spinlockå’Œå†…å­˜ä¸ºä»£ä»·ã€‚4.16 HPET Timer Supportï¼ˆHPETæ—¶é’Ÿæ”¯æŒï¼‰ å…è®¸å†…æ ¸ä½¿ç”¨HPETã€‚HPETæ˜¯æ›¿ä»£8254èŠ¯ç‰‡çš„æ–°ä¸€ä»£å®šæ—¶å™¨,i686åŠä»¥ä¸Šçº§åˆ«çš„ä¸»æ¿éƒ½æ”¯æŒ,å¯ä»¥å®‰å…¨çš„é€‰ä¸Šã€‚ä½†æ˜¯ï¼ŒHEPTåªä¼šåœ¨æ”¯æŒå®ƒçš„å¹³å°å’ŒBIOSä¸Šè¿è¡Œã€‚å¦‚æœä¸æ”¯æŒï¼Œ8254å°†ä¼šæ¿€æ´»ã€‚é€‰Nï¼Œå°†ç»§ç»­ä½¿ç”¨8254æ—¶é’Ÿã€‚4.17 Enable DMI scanning é€‰æ‹©Yé™¤éä½ å·²ç»è¯æ˜å½“è¿›å…¥DMIæ—¶ä¸å½±å“ä½ çš„é…ç½®ã€‚PNP BIOSä»£ç éœ€è¦è¿™ä¸€é¡¹çš„æ”¯æŒã€‚4.18 (8) Maximum number of CPUs æ”¯æŒçš„æœ€å¤§CPUæ•°,æ¯å¢åŠ ä¸€ä¸ªå†…æ ¸å°†å¢åŠ 8Kä½“ç§¯4.19 SMT (Hyperthreading) scheduler support æ”¯æŒIntelçš„è¶…çº¿ç¨‹(HT)æŠ€æœ¯è¶…çº¿ç¨‹è°ƒåº¦å™¨åœ¨æŸäº›æƒ…å†µä¸‹å°†ä¼šå¯¹ Intel Pentium 4 HTç³»åˆ—æœ‰è¾ƒå¥½çš„æ”¯æŒã€‚å¦‚æœä½ ä¸æ¸…æ¥šï¼Œé€‰N4.20 Multi-core scheduler support é’ˆå¯¹å¤šæ ¸CPUè¿›è¡Œè°ƒåº¦ç­–ç•¥ä¼˜åŒ–å¤šæ ¸è°ƒåº¦æœºåˆ¶æ”¯æŒï¼ŒåŒæ ¸çš„CPUè¦é€‰ã€‚å¤šæ ¸å¿ƒè°ƒåº¦åœ¨æŸäº›æƒ…å†µä¸‹å°†ä¼šå¯¹å¤šæ ¸çš„CPUç³»åˆ—æœ‰è¾ƒå¥½çš„æ”¯æŒã€‚å¦‚æœä½ ä¸æ¸…æ¥šï¼Œé€‰N4.21 Fine granularity task level IRQ time accounting å¦‚æœä¸ç¡®å®šçš„è¯ï¼Œé€‰Nï¼Œé»˜è®¤ä¸ºä¸é€‰ã€‚4.22 Preemption Model (Voluntary Kernel Preemption (Desktop)) å†…æ ¸æŠ¢å æ¨¡å¼ä¸€äº›ä¼˜å…ˆçº§å¾ˆé«˜çš„ç¨‹åºå¯ä»¥å…ˆè®©ä¸€äº›ä½ä¼˜å…ˆçº§çš„ç¨‹åºæ‰§è¡Œï¼Œå³ä½¿è¿™äº›ç¨‹åºæ˜¯åœ¨æ ¸å¿ƒæ€ä¸‹æ‰§è¡Œã€‚ä»è€Œå‡å°‘å†…æ ¸æ½œä¼æœŸï¼Œæé«˜ç³»ç»Ÿçš„å“åº”ã€‚å½“ç„¶åœ¨ä¸€äº›ç‰¹æ®Šçš„ç‚¹çš„å†…æ ¸æ˜¯ä¸å¯æŠ¢å…ˆçš„ï¼Œæ¯”å¦‚å†…æ ¸ä¸­çš„è°ƒåº¦ç¨‹åºè‡ªèº«åœ¨æ‰§è¡Œæ—¶å°±æ˜¯ä¸å¯è¢«æŠ¢å…ˆçš„ã€‚è¿™ä¸ªç‰¹æ€§å¯ä»¥æé«˜æ¡Œé¢ç³»ç»Ÿã€å®æ—¶ç³»ç»Ÿçš„æ€§èƒ½ã€‚ No Forced Preemption (Server) é€‚åˆæœåŠ¡å™¨ç¯å¢ƒçš„ç¦æ­¢å†…æ ¸æŠ¢å  è¿™æ˜¯ä¼ ç»Ÿçš„LINUXæŠ¢å…ˆå¼æ¨¡å‹ï¼Œé’ˆå¯¹äºé«˜ååé‡è®¾è®¡ã€‚å®ƒåŒæ ·åœ¨å¾ˆå¤šæ—¶å€™ä¼šæä¾›å¾ˆå¥½çš„å“åº”ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½ä¼šæœ‰è¾ƒé•¿çš„å»¶è¿Ÿã€‚å¦‚æœä½ æ˜¯å»ºç«‹æœåŠ¡å™¨æˆ–è€…ç”¨äºç§‘å­¦è¿ ç®—ï¼Œé€‰è¿™é¡¹ï¼Œæˆ–è€…ä½ æƒ³è¦æœ€å¤§åŒ–å†…æ ¸çš„åŸå§‹è¿ç®—èƒ½åŠ›ï¼Œè€Œä¸ç†ä¼šè°ƒåº¦ä¸Šçš„å»¶è¿Ÿã€‚ (é»˜è®¤é€‰é¡¹) Voluntary Kernel Preemption (Desktop) é€‚åˆæ™®é€šæ¡Œé¢ç¯å¢ƒçš„è‡ªæ„¿å†…æ ¸æŠ¢å  è¿™ä¸ªé€‰é¡¹é€šè¿‡å‘å†…æ ¸æ·»åŠ æ›´å¤šçš„â€œæ¸…æ™°æŠ¢å…ˆç‚¹â€æ¥å‡å°‘å†…æ ¸å»¶è¿Ÿã€‚è¿™äº›æ–°çš„æŠ¢å…ˆç‚¹ä»¥é™ä½ååé‡çš„ä»£ä»·ï¼Œæ¥é™ä½å†…æ ¸çš„æœ€å¤§å»¶è¿Ÿï¼Œæä¾›æ›´å¿«çš„åº”ç”¨ç¨‹åºå“åº”ã€‚è¿™é€šè¿‡ å…è®¸ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹è‡ªåŠ¨æŠ¢å…ˆæ¥å“åº”äº‹ä»¶ï¼Œå³ä½¿è¿›ç¨‹åœ¨å†…æ ¸ä¸­è¿›è¡Œç³»ç»Ÿè°ƒç”¨ã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºè¿è¡Œå¾—æ›´â€œæµç•…â€ï¼Œå³ä½¿ç³»ç»Ÿå·²ç»æ˜¯é«˜è´Ÿè·è¿è½¬ã€‚å¦‚æœä½ æ˜¯ä¸ºæ¡Œé¢ç³»ç»Ÿç¼–è¯‘å†…æ ¸ï¼Œé€‰è¿™é¡¹ã€‚ Preemptible Kernel (Low-Latency Desktop) é€‚åˆè¿è¡Œå®æ—¶ç¨‹åºçš„ä¸»åŠ¨å†…æ ¸æŠ¢å  è¿™ä¸ªé€‰é¡¹é€šè¿‡ä½¿æ‰€æœ‰å†…æ ¸ä»£ç ï¼ˆéè‡´å‘½éƒ¨åˆ†ï¼‰ç¼–è¯‘ä¸ºâ€œå¯æŠ¢å…ˆâ€æ¥é™ä½å†…æ ¸å»¶è¿Ÿã€‚è¿™é€šè¿‡å…è®¸ä½ä¼˜å…ˆçº§è¿›ç¨‹è¿›è¡Œå¼ºåˆ¶æŠ¢å…ˆæ¥å“åº”äº‹ä»¶ï¼Œå³ä½¿è¿™äº›è¿›ç¨‹æ­£åœ¨è¿›è¡Œç³»ç»Ÿè°ƒç”¨æˆ–è€…æœªè¾¾åˆ°æ­£å¸¸çš„â€œæŠ¢å…ˆç‚¹â€ã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºè¿è¡Œå¾—æ›´åŠ â€œæµç•…â€å³ä½¿ç³»ç»Ÿå·² ç»æ˜¯é«˜è´Ÿè·è¿è½¬ã€‚ä»£ä»·æ˜¯ååé‡é™ä½ï¼Œå†…æ ¸è¿è¡Œå¼€é”€å¢å¤§ã€‚é€‰è¿™é¡¹å¦‚æœä½ æ˜¯ä¸ºæ¡Œé¢æˆ–è€…åµŒå…¥å¼ç³»ç»Ÿç¼–è¯‘å†…æ ¸ï¼Œéœ€è¦éå¸¸ä½çš„å»¶è¿Ÿã€‚ å¦‚æœä½ è¦æœ€å¿«çš„å“åº”ï¼Œé€‰ç¬¬ä¸‰é¡¹ã€‚æˆ‘è®¤ä¸ºä¸‡ç‰©æ˜¯å¹³è¡¡çš„ï¼Œä½å»¶è¿Ÿæ„å‘³ç€ç³»ç»Ÿè¿è¡Œä¸ç¨³å®šï¼Œå› ä¸ºè¿‡å¤šæ¥å“åº”ç”¨æˆ·çš„è¦æ±‚ï¼Œæ‰€ä»¥æˆ‘é€‰ç¬¬äºŒä¸ªã€‚4.23 Reroute for broken boot IRQs é˜²æ­¢åŒæ—¶æ”¶åˆ°å¤šä¸ªboot IRQ ( ä¸­æ–­ ) æ—¶ï¼Œç³»ç»Ÿæ··ä¹±ï¼Ÿ4.24 Machine Check / overheating reporting è®©CPU æ£€æµ‹åˆ°ç³»ç»Ÿæ•…éšœæ—¶é€šçŸ¥å†…æ ¸, ä»¥ä¾¿å†…æ ¸é‡‡å–ç›¸åº”çš„æªæ–½( å¦‚è¿‡çƒ­å…³æœºç­‰) Intel MCE features AMD MCE features Support for old Pentium 5 / WinChip machine checks4.25 Machine check injector support è®©CPUæ£€æµ‹åˆ°ç³»ç»Ÿæ•…éšœæ—¶é€šçŸ¥å†…æ ¸,ä»¥ä¾¿å†…æ ¸é‡‡å–ç›¸åº”çš„æªæ–½(å¦‚è¿‡çƒ­å…³æœºç­‰)ï¼ˆä¸æ˜ç™½æ­¤é¡¹ä¸ä¸Šä¸€é¡¹çš„åŒºåˆ«ï¼ŒåŸæ¥çš„é…ç½®ä¸­æ˜¯åšä¸ºæ¨¡å—åŠ å…¥å†…æ ¸çš„ï¼‰ï¼Ÿ4.26 Enable VM86 support è¿™ä¸€é€‰é¡¹ç”¨äºæ”¯æŒåœ¨åƒDOSEMUä¸€æ ·çš„ç¨‹åºåœ¨x86çš„å¤„ç†å™¨ä¸Šè¿è¡Œ16ä½çš„legacyä»£ç ã€‚ä¹Ÿå¯èƒ½åƒXFree86è¿™æ ·çš„è½¯ä»¶é€šè¿‡BIOSåˆå§‹åŒ–å£°å¡çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚4.27 Toshiba Laptop support ä¸œèŠç¬”è®°æœ¬æ¨¡å—æ”¯æŒï¼Œä¸é€‰4.28 Dell laptop support Dellç¬”è®°æœ¬æ¨¡å—æ”¯æŒï¼Œä¸é€‰4.29 Enable X86 board specific fixups for reboot ä¿®æ­£æŸäº›æ—§x86ä¸»æ¿çš„é‡èµ·bug,è¿™ç§ä¸»æ¿åŸºæœ¬ç»ç§äº†ï¼Œæˆ‘è®¤ä¸ºå¯ä»¥ä¸é€‰æ‹©è¿™ä¸€é¡¹4.30 dev/cpu/microcode - microcode support æ˜¯å¦æ”¯æŒIntel IA32æ¶æ„çš„CPUã€‚è¿™ä¸ªé€‰é¡¹å°†è®©ä½ å¯ä»¥æ›´æ–°Intel IA32ç³»åˆ—å¤„ç†å™¨çš„å¾®ä»£ç ï¼Œæ˜¾ç„¶ä½ éœ€è¦åˆ°ç½‘ä¸Šå»ä¸‹è½½æœ€æ–°çš„ä»£ç ï¼ŒLINUXä¸æä¾›è¿™äº›ä»£ç ã€‚å½“ç„¶ä½ è¿˜å¿…é¡»åœ¨æ–‡ä»¶ç³»ç»Ÿé€‰é¡¹ä¸­é€‰æ‹©/dev file system supportæ‰èƒ½æ­£å¸¸çš„ä½¿ç”¨å®ƒã€‚å¦‚æœä½ æŠŠå®ƒè¯‘ä¸ºæ¨¡å— ,å®ƒå°†æ˜¯ microcodeã€‚ IA32ä¸»è¦ç”¨äºé«˜äº4GBçš„å†…å­˜ã€‚è¯¦è§ä¸‹é¢çš„â€œé«˜å†…å­˜é€‰é¡¹â€ã€‚ä½¿ç”¨ä¸éšLinuxå†…æ ¸å‘è¡Œçš„IA32å¾®ä»£ç ,ä½ å¿…éœ€æœ‰IA32å¾®ä»£ç äºŒè¿›åˆ¶æ–‡ä»¶,ä»…å¯¹Intelçš„CPUæœ‰æ•ˆã€‚ Intel microcode patch loading support AMD microcode patch loading support4.31 /dev/cpu/*/msr - Model-specific register support æ˜¯å¦æ‰“å¼€CPUç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨çš„åŠŸèƒ½ã€‚è¿™ä¸ªé€‰é¡¹æ¡Œé¢ç”¨æˆ·ä¸€èˆ¬ç”¨ä¸åˆ°ï¼Œå®ƒä¸»è¦ç”¨åœ¨Intelçš„åµŒå…¥å¼CPUä¸­çš„ï¼Œè¿™ä¸ªå¯„å­˜å™¨çš„ä½œç”¨ä¹Ÿä¾èµ–ä¸ä¸åŒçš„CPUç±»å‹è€Œæœ‰æ‰€ä¸åŒï¼Œä¸€èˆ¬å¯ä»¥ç”¨æ¥æ”¹å˜ä¸€äº›CPUåŸæœ‰ç‰©ç†ç»“æ„çš„ç”¨é€”ï¼Œä½†ä¸åŒçš„CPUç”¨é€”å·®åˆ«ä¹Ÿå¾ˆå¤§ã€‚åœ¨å¤šcpuç³»ç»Ÿä¸­è®©ç‰¹æƒCPUè®¿é—®x86çš„MSRå¯„å­˜å™¨ã€‚4.32 /dev/cpu/*/cpuid - CPU information support æ˜¯å¦æ‰“å¼€è®°å½•CPUç›¸å…³ä¿¡æ¯åŠŸèƒ½ã€‚è¿™ä¼šåœ¨/dev/cpuä¸­å»ºç«‹ä¸€ç³»åˆ—çš„è®¾å¤‡æ–‡ä»¶ï¼Œç”¨ä»¥è®©è¿‡ç¨‹å»è®¿é—®æŒ‡å®šçš„CPUã€‚èƒ½ä»/dev/cpu/x/cpuidè·å¾—CPUçš„å”¯ä¸€æ ‡è¯†ç¬¦(CPUID)ã€‚4.33 High Memory Support (4GB) LINUXèƒ½å¤Ÿåœ¨X86ç³»ç»Ÿä¸­ä½¿ç”¨64GBçš„ç‰©ç†å†…å­˜ã€‚ä½†æ˜¯ï¼Œ32ä½åœ°å€çš„X86å¤„ç†å™¨åªèƒ½æ”¯æŒåˆ°4GBå¤§å°çš„å†…å­˜ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ æœ‰å¤§äº4GBçš„ç‰©ç†å†…å­˜ï¼Œå¹¶ééƒ½èƒ½è¢«å†…æ ¸â€œæ°¸ä¹…æ˜ å°„â€ã€‚è¿™äº›éæ°¸ä¹…æ˜ å°„å†…å­˜å°±ç§°ä¸ºâ€œé«˜é˜¶å†…å­˜â€ã€‚ å¦‚æœä½ ç¼–è¯‘çš„å†…æ ¸æ°¸è¿œéƒ½ä¸ä¼šè¿è¡Œåœ¨é«˜äº1Gå†…å­˜çš„æœºå™¨ä¸Šï¼Œé€‰OFFï¼ˆé»˜è®¤é€‰é¡¹ï¼Œé€‚åˆå¤§å¤šæ•°äººï¼‰ã€‚è¿™å°†ä¼šäº§ç”Ÿä¸€ä¸ªâ€œ3GB/1GBâ€çš„å†…å­˜ç©ºé—´åˆ’åˆ†ï¼Œ3GB è™šæ‹Ÿå†…å­˜è¢«å†…æ ¸æ˜ å°„ä»¥ä¾¿æ¯ä¸ªå¤„ç†å™¨èƒ½å¤Ÿâ€œçœ‹åˆ°â€3GBçš„è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œè¿™æ ·ä»ç„¶èƒ½å¤Ÿä¿æŒ4GBçš„è™šæ‹Ÿå†…å­˜ç©ºé—´è¢«å†…æ ¸ä½¿ç”¨ï¼Œæ›´å¤šçš„ç‰©ç†å†…å­˜èƒ½å¤Ÿè¢«æ°¸ä¹…æ˜ å°„ã€‚ å¦‚æœä½ æœ‰1GBï¼4GBä¹‹é—´çš„ç‰©ç†å†…å­˜ï¼Œé€‰4GBé€‰é¡¹ã€‚å¦‚æœè¶…è¿‡4GBï¼Œé‚£ä¹ˆé€‰æ‹©64GBã€‚è¿™å°†æ‰“å¼€ Intel çš„ç‰©ç†åœ°å€å»¶ä¼¸æ¨¡å¼ï¼ˆPAEï¼‰ã€‚PAEå°†åœ¨IA32å¤„ç†å™¨ä¸Šæ‰§è¡Œ3ä¸ªå±‚æ¬¡çš„å†…å­˜é¡µé¢ã€‚PAEæ˜¯è¢«LINUXå®Œå…¨æ”¯æŒçš„ï¼Œç°åœ¨çš„Intelå¤„ç†å™¨ (Pentium Pro å’Œæ›´é«˜çº§çš„)éƒ½èƒ½è¿è¡ŒPAEæ¨¡å¼ã€‚æ³¨æ„ï¼šå¦‚æœä½ é€‰64GBï¼Œé‚£ä¹ˆåœ¨ä¸æ”¯æŒPAEçš„CPUä¸Šå†…æ ¸å°†æ— æ³•å¯åŠ¨ã€‚ ä½ æœºå™¨ä¸Šçš„å†…å­˜èƒ½å¤Ÿè¢«è‡ªåŠ¨æ¢æµ‹åˆ°ï¼Œæˆ–è€…ä½ å¯ä»¥ç”¨ç±»ä¼¼äºâ€œmem=256Mâ€çš„å‚æ•°å¼ºåˆ¶ç»™å†…æ ¸æŒ‡å®šå†…å­˜å¤§å°ã€‚ 4GB é€‰è¿™é¡¹å¦‚æœä½ ç”¨çš„æ˜¯32ä½çš„å¤„ç†å™¨ï¼Œå†…å­˜åœ¨1-4GBä¹‹é—´ã€‚ 64GB é€‰è¿™é¡¹å¦‚æœä½ ç”¨çš„æ˜¯32ä½çš„å¤„ç†å™¨ï¼Œå†…å­˜å¤§äº4GBã€‚ ( ) off (X) 4GB ( ) 64GB4.34 Memory model (Flat Memory) ä¸€èˆ¬é€‰â€Flat Memoryâ€,å…¶ä»–é€‰é¡¹æ¶‰åŠå†…å­˜çƒ­æ’æ‹”(X) Flat Memory ï¼ˆå¹³å¦å†…å­˜æ¨¡å¼ï¼‰ è¿™ä¸ªé€‰é¡¹å…è®¸ä½ æ”¹å˜å†…æ ¸åœ¨å†…éƒ¨ç®¡ç†å†…å­˜çš„ä¸€äº›æ–¹å¼ã€‚å¤§å¤šæ•°ç”¨æˆ·åœ¨è¿™åªä¼šæœ‰ä¸€ä¸ªé€‰é¡¹ï¼šFlat Memoryã€‚è¿™æ˜¯æ™®éçš„å’Œæ­£ç¡®çš„é€‰é¡¹ã€‚ä¸€äº›ç”¨æˆ·çš„æœºå™¨æœ‰æ›´é«˜çº§çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ NUMA å’Œå†…å­˜çƒ­æ‹”æ’ï¼Œé‚£å°†ä¼šæœ‰ä¸åŒçš„é€‰é¡¹ã€‚Discontiguous Memoryï¼ˆéæ¥è§¦å¼å†…å­˜æ¨¡å¼ï¼‰æ˜¯ä¸€ä¸ªæ›´æˆç†Ÿã€æ›´å¥½çš„æµ‹è¯•ç³»ç»Ÿã€‚ä½†æ˜¯å¯¹äºå†…å­˜çƒ­æ‹”æ’ç³»ç»Ÿä¸å¤ªåˆé€‚ï¼Œä¼šè¢«â€œSparse Memoryâ€ä»£æ›¿ã€‚å¦‚æœä½ ä¸æ¸…æ¥šâ€œSparse Memoryâ€å’Œâ€œDiscontiguous Memoryâ€çš„åŒºåˆ«ï¼Œé€‰åè€…ã€‚å¦‚æœä¸æ¸…æ¥šï¼Œå°±é€‰Flat Memoryã€‚ Sparse Memoryï¼ˆç¨€ç–å†…å­˜æ¨¡å¼ï¼‰ è¿™å¯¹æŸäº›ç³»ç»Ÿæ˜¯å”¯ä¸€é€‰é¡¹ï¼ŒåŒ…æ‹¬å†…å­˜çƒ­æ‹”æ’ç³»ç»Ÿã€‚è¿™æ­£å¸¸ã€‚å¯¹äºå…¶ä»–ç³»ç»Ÿï¼Œè¿™å°†ä¼šè¢«Discontiguous Memoryé€‰é¡¹ä»£æ›¿ã€‚è¿™ä¸ªé€‰é¡¹æä¾›æ½œåœ¨çš„æ›´å¥½çš„ç‰¹æ€§ï¼Œå¯ä»¥é™ä½ä»£ç å¤æ‚åº¦ï¼Œä½†æ˜¯å®ƒæ˜¯æ–°çš„æ¨¡å¼ï¼Œéœ€è¦æ›´å¤šçš„æµ‹è¯•ã€‚å¦‚æœä¸æ¸…æ¥šï¼Œé€‰æ‹©â€œDiscontiguous Memoryâ€ æˆ– â€œFlat Memoryâ€ã€‚4.35 Allow for memory compaction4.36 Page migration ï¼ˆé€‰æ‹©Yï¼‰ Enable KSM for page merging (4096) Low address space to protect from user allocation4.37 Enable recovery from hardware memory errors é€‰æ‹©Y4.38 Transparent Hugepage Support Transparent Hugepage Support sysfs defaults 1.always 2.madviseï¼ˆé»˜è®¤é€‰é¡¹ï¼‰4.39 Cross Memory Support 4.40 Enable cleancache driver to cache clean pages if tmem is present 4.41 Enable frontswap to cache swap pages if tmem is presentï¼ˆè¿™ä¸‰éƒ¨åˆ†ä¸å¤ªäº†è§£ï¼‰4.42 Allocate 3rd-level pagetables from highmem åœ¨å†…å­˜å¾ˆå¤š ( å¤§äº 4G) çš„æœºå™¨ä¸Šå°†ç”¨æˆ·ç©ºé—´çš„é¡µè¡¨æ”¾åˆ°é«˜ä½å†…å­˜åŒº , ä»¥èŠ‚çº¦å®è´µçš„ä½ç«¯å†…å­˜ ã€‚4.43 Check for low memory corruption ä½ä½å†…å­˜è„æ•°æ®æ£€æŸ¥ï¼Œé»˜è®¤æ˜¯æ¯60 ç§’æ£€æŸ¥ä¸€æ¬¡ã€‚ä¸€èˆ¬è¿™ç§è„æ•°æ® æ˜¯å› æŸäº›Bios å¤„ç†ä¸å½“å¼•èµ·çš„ã€‚4.44 (64) Amount of low memory, in kilobytes, to reserve for the BIOS4.45 Math emulation æ•°å­¦åå¤„ç†å™¨ä»¿çœŸ,486DXä»¥ä¸Šçš„cpuå°±ä¸è¦é€‰å®ƒäº†4.46 MTRR (Memory Type Range Register) supportï¼ˆå†…å­˜ç±»å‹åŒºåŸŸå¯„å­˜å™¨ï¼‰ åœ¨ Intel P6 ç³»åˆ—å¤„ç†å™¨(Pentium Pro, Pentium II å’Œæ›´æ–°çš„)ä¸Šï¼ŒMTRRå°†ä¼šç”¨æ¥è§„å®šå’Œæ§åˆ¶å¤„ç†å™¨è®¿é—®æŸæ®µå†…å­˜åŒºåŸŸçš„ç­–ç•¥ã€‚å¦‚æœä½ åœ¨PCIæˆ–è€…AGPæ€»çº¿ä¸Šæœ‰VGAå¡ï¼Œè¿™å°†éå¸¸æœ‰ç”¨ã€‚å¯ä»¥æå‡å›¾åƒçš„ä¼ é€é€Ÿåº¦2.5å€ä»¥ä¸Šã€‚é€‰Yï¼Œä¼šç”Ÿæˆæ–‡ä»¶/proc/mtrrï¼Œå®ƒå¯ä»¥ç”¨æ¥æ“çºµ ä½ çš„å¤„ç†å™¨çš„MTRRã€‚å…¸å‹åœ°ï¼ŒX server ä¼šç”¨åˆ°ã€‚è¿™æ®µä»£ç æœ‰ç€é€šç”¨çš„æ¥å£ï¼Œå…¶ä»–CPUçš„å¯„å­˜å™¨åŒæ ·èƒ½å¤Ÿä½¿ç”¨è¯¥åŠŸèƒ½ã€‚Cyrix 6Ã—86, 6Ã—86MXå’Œ M IIå¤„ç†å™¨æœ‰ARR ï¼Œå®ƒå’Œ MTRRæœ‰ç€ç±»ä¼¼çš„åŠŸèƒ½ã€‚AMD K6-2/ K6-3æœ‰ä¸¤ä¸ªMTRRï¼Œ Centaur C6æœ‰8ä¸ªMCRå…è®¸å¤åˆå†™å…¥ã€‚æ‰€æœ‰è¿™äº›å¤„ç†å™¨éƒ½æ”¯æŒè¿™æ®µä»£ç ï¼Œä½ å¯ä»¥é€‰Yå¦‚æœä½ æœ‰ä»¥ä¸Šå¤„ç†å™¨ã€‚é€‰YåŒæ ·å¯ä»¥ä¿®æ­£SMP BIOSçš„é—®é¢˜ï¼Œå®ƒä»…ä¸ºç¬¬ä¸€ä¸ªCPUæä¾›MTRRï¼Œè€Œä¸ä¸ºå…¶ä»–çš„æä¾›ã€‚è¿™ä¼šå¯¼è‡´å„ç§å„æ ·çš„é—®é¢˜ï¼Œæ‰€ä»¥é€‰Yæ˜¯æ˜æ™ºçš„ã€‚ä½ å¯ä»¥å®‰å…¨åœ°é€‰Yï¼Œå³ä½¿ä½ çš„æœºå™¨æ²¡æœ‰MTRRã€‚è¿™ä¼šç»™å†…æ ¸å¢åŠ 9KBã€‚æ‰“å¼€å®ƒå¯ä»¥æå‡PCI/AGPæ€»çº¿ä¸Šçš„æ˜¾å¡2å€ä»¥ä¸Šçš„é€Ÿåº¦,å¹¶ä¸”å¯ä»¥ä¿®æ­£æŸäº›BIOSé”™è¯¯ã€‚4.47 MTRR cleanup support MTRRæ¸…ç†ï¼ˆ2.6.27å†…æ ¸æ–°å¢åŠŸèƒ½ï¼Œä¸ç¡®å®šå¯ä»¥ä¸é€‰ï¼‰ MTRR cleanup enable value (0-1) MTRR cleanup spare reg num (0-7) x86 PAT support x86 architectural random number generator4.48 EFI runtime service supportï¼ˆEFIå¯åŠ¨æ”¯æŒï¼‰ è¿™é‡Œå…è®¸å†…æ ¸åœ¨EFIå¹³å°ä¸Šä½¿ç”¨å‚¨å­˜äºEFIå›ºä»¶ä¸­çš„ç³»ç»Ÿè®¾ç½®å¯åŠ¨ã€‚è¿™ä¹Ÿå…è®¸å†…æ ¸åœ¨è¿è¡Œæ—¶ä½¿ç”¨EFIçš„ç›¸å…³æœåŠ¡ã€‚è¿™ä¸ªé€‰é¡¹åªåœ¨æœ‰EFIå›ºä»¶çš„ç³»ç»Ÿä¸Šæœ‰ç”¨ï¼Œå®ƒä¼šä½¿å†…æ ¸å¢åŠ 8KBã€‚å¦å¤–ï¼Œä½ å¿…é¡»ä½¿ç”¨æœ€æ–°çš„ELILO ç™»å½•å™¨æ‰èƒ½ä½¿å†…æ ¸é‡‡ç”¨EFIçš„å›ºä»¶è®¾ç½®æ¥å¯åŠ¨ï¼ˆGRUBå’ŒLILOå®Œå…¨ä¸çŸ¥é“EFIæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼‰ã€‚å³ä½¿ä½ æ²¡æœ‰EFIï¼Œå´é€‰äº†è¿™ä¸ªé€‰é¡¹ï¼Œå†…æ ¸åŒæ ·å¯ä»¥å¯åŠ¨ã€‚å¤§å®¶åº”è¯¥ç”¨çš„æ˜¯GRUBï¼Œæ‰€ä»¥é€‰ä¸Šè¿™ä¸ªä¹Ÿæ²¡ä»€ä¹ˆç”¨ã€‚é™¤éä½ çš„ç³»ç»Ÿæ”¯æŒEFIï¼ˆä¸€ç§å¯ä»£æ›¿ä¼ ç»ŸBIOSçš„æŠ€æœ¯ï¼‰å¦åˆ™ä¸é€‰ã€‚4.49 Enable seccomp to safely compute untrusted bytecode åªæœ‰åµŒå…¥å¼ç³»ç»Ÿå¯ä»¥ä¸é€‰4.50 Enable -fstack-protector buffer overflow detection (EXPERIMENTAL)4.51 Timer frequency (1000 HZ) å†…æ ¸æ—¶é’Ÿé¢‘ç‡æ¡Œé¢1000æœåŠ¡å™¨100æˆ–250,å…è®¸è®¾ç½®æ—¶é’Ÿé¢‘ç‡ã€‚ è¿™æ˜¯ç”¨æˆ·å®šä¹‰çš„æ—¶é’Ÿä¸­æ–­é¢‘ç‡ 100HZ-1000 HZ ï¼Œä¸è¿‡ 100 HZ å¯¹æœåŠ¡å™¨å’ŒNUMAç³»ç»Ÿæ›´åˆé€‚ï¼Œå®ƒä»¬ä¸éœ€è¦å¾ˆå¿«é€Ÿçš„å“åº”ç”¨æˆ·çš„è¦æ±‚ï¼Œå› ä¸ºæ—¶é’Ÿä¸­æ–­ä¼šå¯¼è‡´æ€»çº¿äº‰ç”¨å’Œç¼“å†²æ‰“å›ã€‚æ³¨æ„åœ¨SMPç¯å¢ƒä¸­ï¼Œæ—¶é’Ÿä¸­æ–­ç”±å˜é‡ NR_CPUS * Hzå®šä¹‰åœ¨æ¯ä¸ªCPUäº§ç”Ÿã€‚ å…¶å®å’Œå‰é¢çš„æŠ¢å…ˆå¼è¿›ç¨‹å·®ä¸å¤šï¼Œå°±æ˜¯å¤šå°‘é¢‘ç‡æ¥å“åº”ç”¨æˆ·è¦æ±‚ã€‚æˆ‘é€‰äº†250HZçš„ã€‚è¦å¿«ç‚¹çš„å¯ä»¥é€‰1000HZçš„ã€‚ä½†æ˜¯è¿˜æ˜¯é‚£å¥è¯ï¼Œä¸€åˆ‡æ˜¯å¹³è¡¡çš„ã€‚æœºå™¨è¿‡å¿«å“åº”ä½ ï¼Œå®ƒè‡ªå·±çš„æ´»å°±ä¸çŸ¥é“åšå¾—å¥½ä¸å¥½äº†ã€‚( ) 100 HZ100 HZæ˜¯ä¼ ç»Ÿçš„å¯¹æœåŠ¡å™¨ã€SMP å’Œ NUMAçš„ç³»ç»Ÿé€‰é¡¹ã€‚è¿™äº›ç³»ç»Ÿæœ‰æ¯”è¾ƒå¤šçš„å¤„ç†å™¨ï¼Œå¯ä»¥åœ¨ä¸­æ–­è¾ƒé›†ä¸­çš„æ—¶å€™åˆ†æ‹…ä¸­æ–­( ) 250 HZ250 HZå¯¹æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå¥½çš„æŠ˜è¡·çš„é€‰é¡¹ï¼Œå®ƒåŒæ ·åœ¨SMP å’Œ NUMA ç³»ç»Ÿä¸Šä½“ç°å‡ºè‰¯å¥½çš„ååº”é€Ÿåº¦ã€‚( ) 300 HZ(X) 1000 HZ1000 HZå¯¹äºæ¡Œé¢å’Œå…¶ä»–éœ€è¦å¿«é€Ÿäº‹ä»¶ååº”çš„ç³»ç»Ÿæ˜¯éå¸¸æ£’çš„ã€‚4.52 kexec system call(kexec ç³»ç»Ÿè°ƒç”¨) kexecæ˜¯ä¸€ä¸ªç”¨æ¥å…³é—­ä½ å½“å‰å†…æ ¸ï¼Œç„¶åå¼€å¯å¦ä¸€ä¸ªå†…æ ¸çš„ç³»ç»Ÿè°ƒç”¨ã€‚å®ƒå’Œé‡å¯å¾ˆåƒï¼Œä½†æ˜¯å®ƒä¸è®¿é—®ç³»ç»Ÿå›ºä»¶ã€‚ç”±äºå’Œé‡å¯å¾ˆåƒï¼Œä½ å¯ä»¥å¯åŠ¨ä»»ä½•å†…æ ¸ï¼Œä¸ä»…ä»…æ˜¯LINUXã€‚ kexecè¿™ä¸ªåå­—æ˜¯ä» exec ç³»ç»Ÿè°ƒç”¨æ¥çš„ã€‚å®ƒåªæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œå¯ä»¥ç¡®å®šç¡¬ä»¶æ˜¯å¦æ­£ç¡®å…³é—­ï¼ŒLinusæœ¬äººéƒ½æ²¡è¯è¯´ï¼Œä¼°è®¡æ˜¯å—å®³ä¸æµ…ã€‚æˆ‘ä»¬å½“ç„¶ä¸èƒ½ä¸Šå½“ï¼Œé€‰Nï¼æä¾›kexecç³»ç»Ÿè°ƒç”¨,å¯ä»¥ä¸å¿…é‡å¯è€Œåˆ‡æ¢åˆ°å¦ä¸€ä¸ªå†…æ ¸ï¼Œå¦‚æœéœ€è¦å°±é€‰æ‹©ï¼Œå¯¹å¤§å¤šæ•°ç”¨æˆ·æ¥è¯´å¹¶ä¸éœ€è¦.4.53 kernel crash dumps å†…æ ¸å´©æºƒæ—¶ï¼Œdump è¿è¡Œæ—¶ä¿¡æ¯ã€‚å°±ç®— crash äº†ï¼Œæˆ‘ä¹Ÿä¸ä¼šå»è°ƒè¯•å†…æ ¸çš„core dump4.54 (0x1000000) Physical address where the kernel is loaded4.55 Build a relocatable kernel å®˜æ–¹è¯´æ˜ ï¼ˆå»ºç«‹ä¸€ä¸ªç§»åŠ¨çš„å†…æ ¸ï¼Œå¹¶å¢åŠ 10% çš„å†…æ ¸å°ºå¯¸ï¼Œè¿è¡Œæ—¶ä¼šè¢«ä¸¢å¼ƒï¼‰ï¼Œæˆ‘è®¤ä¸ºæ²¡å®è´¨æ€§çš„ä½œç”¨4.56 (0x100000) Alignment value to which kernel should be aligned4.57 Support for hot-pluggable CPUs å¯¹SMPä¼‘çœ å’Œçƒ­æ’æ‹”CPUæä¾›æ”¯æŒ 4.58 Compat VDSO support å¦‚æœGlibcç‰ˆæœ¬å¤§äºç­‰äº2.3.3å°±ä¸é€‰,å¦åˆ™å°±é€‰ä¸Šï¼Œç›®å‰çš„ç‰ˆæœ¬åŸºæœ¬ä¸Šéƒ½å¤§äº2.3.3å¦‚æœä½ è¿è¡Œçš„æ˜¯æœ€æ–°çš„glibcï¼ˆGNU Cå‡½æ•°åº“ï¼‰ç‰ˆæœ¬ï¼ˆ 2.3.3 æˆ–æ›´æ–°ï¼‰ï¼Œé€‰Nï¼Œè¿™æ ·å¯ä»¥ç§»é™¤é«˜é˜¶çš„VDSO æ˜ å°„ï¼Œä½¿ç”¨éšæœºçš„ VDSOã€‚ 4.59 Built-in kernel command line (ä¸é€‰)5ã€ Power management and ACPI options 5.1ã€Power Management support5.2ã€Power Management Debug Support ä¸æƒ³è°ƒè¯•ACPI è¿™ä¸ªä½ ç°åœ¨å¯ä»¥å‹¾æ‰ï¼Œä¸å‹¾ä¹Ÿæ²¡äº‹ï¼Œç¨ä¾¯ä¼šåœ¨kernel-hackingè¿™ä¸€èŠ‚å‹¾æ‰è°ƒè¯•ï¼Œè¿™é‡Œä¹Ÿå°±æ²¡5.3ã€Suspend to RAM and standby å¾…æœº5.4ã€Hibernation (aka â€˜suspend to diskâ€™) ä¼‘çœ 5.5ã€Run-time PM core functionality5.6ã€ACPI (Advanced Configuration and Power Interface) Support â€” è§é™„15.7ã€SFI (Simple Firmware Interface) Support â€”5.8ã€APM (Advanced Power Management) BIOS support â€” é€‰acpiå°±ä¸ç”¨apmï¼Œä¸€èˆ¬ä½ ä¹Ÿåªç”¨acpiï¼†5.9ã€CPU Frequency scaling â€” [*] CPU Frequency scaling [ ] Enable CPUfreq debugging === æˆ‘ä¸éœ€è¦è°ƒè¯• CPUfreq CPU frequency translation statistics Default CPUFreq governor (performance) â€” === é»˜è®¤ç”¨ performance é«˜æ€§èƒ½çš„CPU è°ƒé¢‘æ–¹å¼ -*- â€˜performanceâ€™ governor â€˜powersave â€™ governor â€˜userspace â€™ governor for userspace frequency scaling â€˜ondemand â€™ cpufreq policy governor === â€ å‘¨æœŸæ€§çš„è€ƒå¯ŸCPU è´Ÿè½½å¹¶è‡ªåŠ¨çš„åŠ¨æ€è°ƒæ•´cpu é¢‘ç‡â€ ï¼Œæˆ‘åªç”¨ performance â€˜conservativeâ€™ cpufreq governor * CPUFreq processor drivers * Processor Clocking P-stat driver * ACPI Processor P-States driver AMD Mobile K6-2/K6-3 PowerNow ! AMD Mobile Athlon/Duron PowerNow ! AMD Opteron/Athlon64 PowerNow ! Cyrix MediaGX /NatSemi Geode Suspend Modulation Intel Enhanced SpeedStep (deprecated) Intel Speedstep on ICH-M chipsets (ioport interface) Intel Pentium 4 clock modulation Transmeta LongRun VIA Cyrix III Longhaul5.10ã€CPU idle PM support5.11ã€Cpuidle Driver for Intel Processors6ã€Bus options(PCI etc.) 6.1ã€PCI supportï¼ˆè¿™ä¸ªå¿…é¡»é€‰ï¼‰6.2ã€PCI access mode (Any) ( ) BIOS ( ) MMConfig ( ) Direct (X) Any6.3ã€Read CNB20LE Host Bridge Windows æ²¡æœ‰å…¬å…±è§„èŒƒçš„èŠ¯ç‰‡ç»„ï¼Œæ­¤åŠŸèƒ½å·²çŸ¥æ˜¯ä¸å®Œæ•´çš„ã€‚å¦‚æœä½ ä¸çŸ¥é“éœ€ä¸éœ€è¦å®ƒï¼Œè¯·é€‰æ‹©N6.4ã€PCI Express support å¦‚æœä½ çš„ä¸»æ¿æ”¯æŒPCI Expressï¼Œè¯·é€‰æ‹©Y6.5ã€PCI Express Hotplug driver é€‰Y6.6ã€Root Port Advanced Error Reporting support ç¡¬ä»¶é©±åŠ¨ä¼šè´Ÿè´£å‘é€é”™è¯¯ä¿¡æ¯6.7ã€PCI Express ECRC settings control å¦‚æœæ€€ç–‘ï¼Œè¯·é€‰æ‹©N6.8ã€PCIe AER error injector support åŒä¸Šï¼Œé€‰ N6.9ã€PCI Express ASPM control è¿™ä½¿å¾—OSæ§åˆ¶çš„PCI Express ASPMï¼ˆæ´»åŠ¨çŠ¶æ€ç”µæºç®¡ç†ï¼‰å’Œæ—¶é’Ÿç”µæºç®¡ç†ã€‚ ASPMæ”¯æŒ çŠ¶æ€L0/L0s/L1ï¼Œé€‰Y6.10ã€Debug PCI Express ASPM é€‰N Default ASPM policy (X)BIOS default ( )powersave ( )performance6.11ã€Message Signaled Interrupts (MSI and MSI-X) è¿™ä½¿å¾—è®¾å¤‡é©±åŠ¨èƒ½å¤Ÿä½¿ç”¨MISï¼ˆæ¶ˆæ¯ä¿¡å·ä¸­æ–­ï¼‰é€‰Y6.12ã€PCI Debugging æˆ‘è®¤ä¸ºè¿™é‡Œæ²¡æœ‰å¿…è¦é€‰ï¼Ÿ6.13ã€Enable PCI resource re-allocation detection å½“PCIèµ„æºé‡æ–°åˆ†é…æ—¶ï¼Œå¦‚æœä½ éœ€è¦PCIæ ¸å¿ƒæ¥æ£€æµ‹çš„è¯ï¼Œé€‰æ‹©Yï¼ŒåŒæ—¶ä½ å¯ä»¥ç”¨pci=realloc=onå’Œpci=realloc=offæ¥è¦†ç›–å®ƒï¼Œå¦‚æœä½ ä¸ç¡®å®šçš„è¯ï¼Œé€‰æ‹©N6.14ã€PCI Stub driver é€‰æ‹©Yæˆ–è€…Mï¼Œå¦‚æœä½ æƒ³è¦ï¼šå½“ä¸€ä¸ªè®¾å¤‡å»æ³¨å†Œå…¶ä»–çš„å®¢æˆ·æ“ä½œç³»ç»Ÿæ—¶éœ€è¦ä¿ç•™è¯¥PCIè®¾å¤‡6.15ã€ Interrupts on hypertransport devices è¿™å°†å…è®¸é«˜é€Ÿä¼ è¾“è®¾å¤‡ä½¿ç”¨ä¸­æ–­ï¼Œå¦‚æœä¸æ˜ç¡®çš„è¯ï¼Œé€‰æ‹©Yï¼Ÿ6.16ã€ PCI IOV support I / Oè™šæ‹ŸåŒ–æ˜¯ç”±ä¸€äº›è®¾å¤‡æ”¯æŒçš„PCIåŠŸèƒ½ï¼Œè¿™ä½¿å¾—ä»–ä»¬èƒ½å¤Ÿåˆ›å»ºè™šæ‹Ÿè®¾å¤‡å…±äº«å…¶ç‰©ç†èµ„æºã€‚å¦‚æœä¸ç¡®å®šçš„è¯ï¼Œé€‰æ‹©Nï¼Ÿ6.17ã€PCI PRI support RIPå°±æ˜¯PCIé¡µé¢è¯·æ±‚æ¥å£ï¼Œå¦‚æœä¸ç¡®å®šçš„è¯ï¼Œé€‰æ‹©N6.18ã€PCI PASID support ä¸ç¡®å®šçš„è¯é€‰æ‹©N6.19ã€PCI IO-APIC hotplug support é€‰Y6.20ã€ISA supportï¼ˆä»¥åŠä¹‹åçš„EISAï¼‰ æŸ¥çœ‹ä½ çš„ä¸»æ¿ä¸Šæ˜¯å¦æœ‰ISAæ’æ§½ã€‚ISAæ˜¯æ€»çº¿ç³»ç»Ÿçš„åç§°ï¼Œå®ƒæ˜¯ä¸€ä¸ªè€çš„ç³»ç»Ÿï¼Œç°å·²è¢«PCIå–ä»£ã€‚æ–°çš„ä¸»æ¿å·²ç»ä¸æ”¯æŒå®ƒï¼Œå¦‚æœä½ è¿˜æœ‰ï¼Œé€‰æ‹©Yï¼Œå¦åˆ™ï¼Œé€‰æ‹©N6.21ã€NatSemi SCx200 support é€‰æ‹©ç¼–è¯‘ä¸ºæ¨¡å—6.22ã€One Laptop Per Child support ä¸é€‰6.23ã€PCEngines ALIX System Support (LED setup) 6.24ã€Soekris Engineering net5501 System Supportï¼ˆLEDS, GPIO, etc) 6.25ã€Traverse Technologies GEOS System Support (LEDS, GPIO, etc)ï¼Ÿ6.26ã€RapidIO support RapidIOä¸»è¦åº”ç”¨äºåµŒå…¥å¼ç³»ç»Ÿå†…éƒ¨äº’è¿ã€‚å¦‚æœä½ é€‰æ‹©Yï¼Œå†…æ ¸ä¸­å°†åŒ…å«æ”¯æŒRapidIOè®¾å¤‡è¿æ¥çš„é©±åŠ¨å’Œè®¾æ–½?6.27ã€PCCard (PCMCIA/CardBus) support ä¸€èˆ¬ç¬”è®°æœ¬ç”µè„‘ä¼šé…å¤‡PCCard æ¥å£( æ— çº¿ç½‘å¡ä¹‹ç±»çš„) ï¼Œçœ‹ä½ çš„ç¡¬ä»¶å’Œä½¿ç”¨åœºæ™¯å§ã€‚è™½ç„¶æˆ‘ä¹Ÿæ˜¯NB ï¼Œä½†æˆ‘ä»æ¥ä¸ç”¨PCMCIA 16-bit PCMCIA support Load CIS updates from userspace (EXPERIMENTAL) 32-bit CardBus support * PC-card bridges * CardBus yenta-compatible bridge support Cirrus PD6729 compatible bridge support i82092 compatible bridge support6.28ã€ Support for PCI Hotplug æ”¯æŒçƒ­æ‹”æ’PCI è®¾å¤‡ Fake PCI Hotplug driver Compaq PCI Hotplug driver Save configuration into NVRAM on Compaq servers IBM PCI Hotplug driver ACPI PCI Hotplug driver ACPI PCI Hotplug driver IBM extensions CompactPCI Hotplug driver SHPC PCI Hotplug driver7ã€Executable file formats / Emulations 7.1ã€Kernel support for ELF binaries é€‰æ‹©Y 7.2ã€Write ELF core dumps with partial segments ä¸é€‰ 7.3ã€Kernel support for a.out and ECOFF binaries ç¼–è¯‘æˆæ¨¡å— 7.4ã€Kernel support for MISC binaries ç¼–è¯‘æˆæ¨¡å—8ã€Networking support 8.1ã€Networking options Packet socket Unix domain sockets Transformation user configuration interface [ ] Transformation sub policy support (EXPERIMENTAL) [ ] Transformation migrate database (EXPERIMENTAL) [ ] Transformation statistics (EXPERIMENTAL) PF_KEY sockets [ ] PF_KEY MIGRATE (EXPERIMENTAL) [Y] TCP/IP networking [Y] IP: multicasting [Y] IP: advanced router Choose IP: FIB lookup algorithm (choose FIB_HASH if unsure) (FIB_HASH)â”‚ [Y] IP: policy routing [Y] IP: equal cost multipath [Y] IP: verbose route monitoring [ ] IP: kernel level autoconfiguration IP: tunneling M IP: GRE demultiplexer [Y] IP: multicast routing [ ] IP: multicast policy routing [Y] IP: PIM-SM version 1 support [Y] IP: PIM-SM version 2 support [ ] IP: ARP daemon support [ Y] IP: TCP syncookie support æŠµæŠ—SYN flood æ”»å‡»ï¼Œæˆ‘æ˜¯å¼€å‘æœºï¼Œæš‚ä¸è€ƒè™‘å®‰å…¨ç‰¹æ€§ IP: AH transformation IP: ESP transformation IP: IPComp transformation IP: IPsec transport mode IP: IPsec tunnel mode * IP: IPsec BEET mode * Large Receive Offload (ipv4/tcp) INET: socket monitoring interface [*] TCP: advanced congestion control â€” é«˜çº§æ‹¥å¡æ§åˆ¶, å¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚( æ¯”å¦‚æ— çº¿ç½‘ç»œ) å°±åˆ«é€‰äº† [ ] TCP: MD5 Signature Option support (RFC2385) (EXPERIMENTAL) The IPv6 protocol â€” æˆ‘æš‚æ—¶æ²¡æœ‰è¦æ”¯æŒIPV6 çš„éœ€æ±‚ [ ] NetLabel subsystem support NetLabel å­ç³»ç»Ÿ, ä¸ºè¯¸å¦‚CIPSO ä¸RIPSO ä¹‹ç±»èƒ½å¤Ÿ åœ¨åˆ†ç»„ä¿¡æ¯ä¸Šæ·»åŠ æ ‡ç­¾çš„åè®®æä¾›æ”¯æŒï¼Œæˆ‘ç”¨ä¸åˆ° -*- Security Marking å¯¹ç½‘ç»œåŒ…è¿›è¡Œå®‰å…¨æ ‡è®°, ç±»ä¼¼äºnfmark , ä½†ä¸»è¦æ˜¯ä¸ºå®‰å…¨ç›®çš„è€Œè®¾è®¡ , å®‰å…¨ç‰¹æ€§ï¼Œæˆ‘æš‚æ—¶ä¸è€ƒè™‘ [ ] Timestamping in PHY devices [ ] Network packet filtering framework (Netfilter) â€” æˆ‘ä¸æ‰“ç®—ä½¿ç”¨é˜²ç«å¢™ï¼Œè¦ç”¨åˆ°æ—¶å†ç¼–è¯‘è¿›å» The DCCP Protocol (EXPERIMENTAL) â€” -M- The SCTP Protocol (EXPERIMENTAL) â€” The RDS Protocol (EXPERIMENTAL) RDS over Infiniband and iWARP RDS over TCP [ ] RDS debugging messages The TIPC Protocol (EXPERIMENTAL) â€” Asynchronous Transfer Mode (ATM) Classical IP over ATM [ ] Do NOT send ICMP if no neighbour LAN Emulation (LANE) support Multi-Protocol Over ATM (MPOA) support RFC1483/2684 Bridged protocols [ ] Per-VC IP filter kludge Layer Two Tunneling Protocol (L2TP) â€” 802.1d Ethernet Bridging [*] IGMP/MLD snooping [ ] Distributed Switch Architecture support â€” 802.1Q VLAN Support [ ] GVRP (GARP VLAN Registration Protocol) support DECnet Support ANSI/IEEE 802.2 LLC type 2 Support The IPX protocol Appletalk protocol support CCITT X.25 Packet Layer (EXPERIMENTAL) LAPB Data Link Driver (EXPERIMENTAL) Acorn Econet/AUN protocols (EXPERIMENTAL) WAN router Phonet protocols family IEEE Std 802.15.4 Low-Rate Wireless Personal Area Networks support (EXPERIâ”‚ [ ] QoS and/or fair queueing â€” é€šè¿‡IPRoute åˆ‡æ¢ç½‘ç»œè®¾å¤‡ä¸Šçš„Qos ç­–ç•¥ï¼Œæˆ‘ä¸æ‰“ç®—ä½¿ç”¨IP è·¯ç”± [ ] Data Center Bridging support -*- DNS Resolver support B.A.T.M.A.N. Advanced Meshing Protocol Network testing â€”8.2ã€[ ] Amateur Radio support â€” æˆ‘æ²¡æœ‰æ— çº¿ç”µ 8.3ã€ CAN bus subsystem support â€” 8.4ã€ IrDA (infrared) subsystem support â€” 8.5ã€ Bluetooth subsystem support â€” 8.6ã€ RxRPC session sockets 8.7ã€- - Wireless â€” æˆ‘æ²¡æœ‰ä½¿ç”¨æ— çº¿ç½‘å¡ 8.8ã€ WiMAX Wireless Broadband support â€” 8.9ã€ RF switch subsystem support â€” æˆ‘æ²¡æœ‰RF åˆ‡æ¢è®¾å¤‡ 8.10ã€ Plan 9 Resource Sharing Support (9P2000) (Experimental) â€” 8.11ã€ CAIF support â€” 8.12ã€ Ceph core library (EXPERIMENTAL)9ã€Device Drivers â€” 9.1ã€Generic Driver Options â€” 9.1.1ã€() path to uevent helper 9.1.2ã€[ ] Maintain a devtmpfs filesystem to mount at /dev 9.1.3ã€[*] Select only drivers that donâ€™t need compile-time external firmware 9.1.4ã€[*] Prevent firmware from being built 9.1.5ã€-*- Userspace firmware loading support 9.1.6ã€[*] Include in-kernel firmware blobs in kernel binary 9.1.7ã€() External firmware blobs to build into the kernel binary 9.1.8ã€[ ] Driver Core verbose debug messages 9.1.9ã€[ ] Managed device resources verbose debug messages ç®¡ç†è®¾å¤‡èµ„æºçš„å†—é•¿è°ƒè¯•ä¿¡æ¯ï¼Œæˆ‘ä¸éœ€è¦9.2ã€* Connector - unified userspace - kernelspace linker â€” å†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´çš„ä¿¡é“ 9.2.1ã€[*] Report process events to userspace æŠ¥å‘Šå¤„ç†æ—¶é—´ç»™ç”¨æˆ·ç©ºé—´9.3ã€ Memory Technology Device (MTD) support â€”9.4ã€ Parallel port support â€”9.5ã€-*- Plug and Play support â€” [ ] PNP debugging messages è°ƒè¯•ä¿¡æ¯ï¼Œè€è§„çŸ© 9.6ã€[ ] Block devices â€” æˆ‘æ²¡æœ‰æƒ³è¦æ”¯æŒçš„å—è®¾å¤‡ï¼Œæ¯”å¦‚ramdisk , ç£ç›˜é˜µåˆ—ï¼ŒCD/DVD åˆ»å½•ç­‰ï¼Œè¯¦è§å†…éƒ¨é€‰é¡¹9.7ã€[ ] Misc devices â€” æ²¡æœ‰éœ€è¦æ”¯æŒçš„æ‚é¡¹è®¾å¤‡9.8ã€ ATA/ATAPI/MFM/RLL support (DEPRECATED) â€”9.9ã€SCSI device support â€” RAID Transport Class -*- SCSI device support [] legacy /proc /scsi / support === æˆ‘æ²¡æœ‰SCSI è®¾å¤‡ * SCSI support type (disk, tape, CD-ROM) * * SCSI disk support // å°±ç®—ä½ ç”¨SATA ï¼Œæ­¤é€‰é¡¹ä¹Ÿå¿…é€‰ SCSI tape support SCSI OnStream SC-x0 tape support SCSI CDROM support === æˆ‘æ²¡æœ‰SCSI è®¾å¤‡ SCSI generic support === æˆ‘æ²¡æœ‰SCSI è®¾å¤‡ SCSI media changer support [ ] Probe all LUNs on each SCSI device [] Verbose SCSI error reporting (kernel size +=12K) === æˆ‘æ²¡æœ‰SCSI è®¾å¤‡ [ ] SCSI logging facility [ ] Asynchronous SCSI scanning SCSI Transports â€” Parallel SCSI (SPI) Transport Attributes === æˆ‘æ²¡æœ‰SCSI è®¾å¤‡ FiberChannel Transport Attributes iSCSI Transport Attributes SAS Domain Transport Attributes SRP Transport Attributes [ ] SCSI low-level drivers â€” SCSI Device Handlers â€” OSD-Initiator library9.10ã€ Serial ATA and Parallel ATA drivers â€” [*] Verbose ATA error reporting [*] ATA ACPI Support [ ] SATA Port Multiplier support === æˆ‘åªæœ‰ä¸€æšSATA è®¾å¤‡ï¼Œæ²¡æœ‰ä½¿ç”¨ å¤šè·¯SATA/SATA Hub çš„éœ€æ±‚ã€‚Port Multiplier æ˜¯å—æ¡¥èŠ¯ç‰‡æä¾›çš„ä¸€ç§æ”¯æŒå¤šå—SATA è®¾å¤‡ï¼Œå¹¶å…±äº«æ€»å¸¦å®½çš„æŠ€æœ¯ã€‚ * AHCI SATA support Platform AHCI SATA support Inito 162x SATA support Silicon Image 3124/3132 SATA support [*] ATA SFF support // é€‰æ‹©è‡ªå·±ç¡¬ä»¶å¯¹åº”çš„é©±åŠ¨å³å¯ ServerWorks Frodo / Apple K2 SATA support * Intel ESB, ICH, PIIX3, PIIX4 PATA/SATA support // Intel ICH ï¼ŒG ç³»åˆ—chipset driver Marvell SATA support NVIDIA SATA support Pacific Digital ADMA support Pacific Digital SATA QStor support Promise SATA TX2/TX4 support Silicon Image SATA support SiS 964/965/966/180 SATA support ULi Electronics SATA support VIA SATA support VITESSE VSC-7174 / INTEL 31244 SATA support Initio 162x SATA support ACPI firmware driver for PATA ALi PATA support AMD/NVidia PATA support === æˆ‘ç”¨çš„æ˜¯SATA ï¼Œå–æ¶ˆPATA æ”¯æŒ ARTOP 6210/6260 PATA support ATI PATA support CMD64x PATA support CS5510/5520 PATA support CS5530 PATA support CS5536 PATA support EFAR SLC90E66 support Generic ATA support HPT 366/368 PATA support HPT 343/363 PATA support IT8211/2 PATA support JMicron PATA support Compaq Triflex PATA support Marvell PATA support via legacy mode Intel PATA MPIIX support === æˆ‘ç”¨çš„æ˜¯SATA ï¼Œå–æ¶ˆPATA æ”¯æŒ Intel PATA old PIIX support === æˆ‘ç”¨çš„æ˜¯SATA ï¼Œå–æ¶ˆPATA æ”¯æŒ NETCELL Revolution RAID support Nat Semi NS87410 PATA support Nat Semi NS87415 PATA support Older Promise PATA controller support PC Tech RZ1000 PATA support SC1200 PATA support SERVERWORKS OSB4/CSB5/CSB6/HT1000 PATA support Promise PATA 2027x support CMD / Silicon Image 680 PATA support SiS PATA support VIA PATA support Winbond SL82C105 PATA support Intel SCH PATA support === æˆ‘ç”¨çš„æ˜¯SATA ï¼Œå–æ¶ˆPATA æ”¯æŒ9.11ã€[ ] Multiple devices driver support (RAID and LVM) â€” æš‚æ—¶æ²¡æœ‰è¦ä½¿ç”¨Raid ï¼ˆç£ç›˜é˜µåˆ—ï¼‰å’ŒLVM ï¼ˆé€»è¾‘å·ç®¡ç†å™¨ï¼Œæ·»åŠ ï¼Œåˆ é™¤é€»è¾‘åˆ†åŒºï¼‰çš„éœ€æ±‚9.12ã€[ ] Fusion MPT device support â€”9.13ã€IEEE 1394 (FireWire) support â€”9.14ã€ I2O device support â€”9.15ã€[ ] Macintosh device drivers â€” Mac ç³»ç»Ÿç¡¬ä»¶è®¾å¤‡é©±åŠ¨ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå…³9.16ã€-*- Network device support â€” Dummy net driver support Bonding driver support EQL (serial line load balancing) support Universal TUN/TAP device driver support Virtual ethernet pair device General Instruments Surfboard 1000 ARCnet support â€” -*- PHY Device support and infrastructure â€” === PHY ( ç‰©ç†å±‚æ§åˆ¶èŠ¯ç‰‡) ï¼Œé‡Œé¢æ²¡æœ‰æˆ‘å¯¹åº”çš„ç¡¬ä»¶ [ ] Ethernet (10 or 100Mbit) â€” === å¦‚æœä½ æ˜¯ç™¾ M å¡ï¼Œè¯·è‡ªè¡Œé€‰æ‹© [*] Ethernet (1000 Mbit) â€” // é€‰æ‹©è‡ªå·±å¯¹åº”çš„ç¡¬ä»¶ [ ] Ethernet (10000 Mbit) â€” === å¦‚æœä½ æ˜¯ä¸‡M å¡ï¼Œè¯·è‡ªè¡Œé€‰æ‹© Token Ring driver support â€” === IBM çš„ä»¤ç‰Œç¯ç½‘ï¼Œç”¨ä»¥å¤ªç½‘çš„å¿½ç•¥ [ ] Wireless LAN â€” === ä¸ç”¨æ— çº¿ç½‘ç»œ * Enable WiMAX (Networking options) to see the WiMAX drivers * USB Network Adapters â€” [ ] Wan interfaces support â€” FDDI driver support === å…‰çº¤å¡é©±åŠ¨ï¼Œç›¸ä¿¡æ²¡å‡ ä¸ªäººèƒ½ç”¨ä¸Šè¿™ç©æ„ PPP (point-to-point protocol) support SLIP (serial line) support [ ] Fibre Channel driver support [ ] Network console logging support [ ] VMware VMXNET3 ethernet driver9.17ã€[ ] ISDN support â€”9.18ã€ Telephony support â€” 9.19ã€Input device support â€” -*- Generic input layer (needed for keyboard, mouse, â€¦) -*- Support for memoryless force-feedback devices Polled input device skeleton === ä¸€ç§å‘¨æœŸæ€§è½®è¯¢ç¡¬ä»¶çŠ¶æ€çš„é©±åŠ¨ï¼Œå»æ‰åæ²¡ä»€ä¹ˆå‰¯ä½œç”¨ * Userland interfaces * -*- Mouse interface [ ] Provide legacy /dev /psaux device (1024) Horizontal screen resolution (768) Vertical screen resolution Joystick interface * Event interface // å°†è¾“å…¥è®¾å¤‡çš„äº‹ä»¶å­˜å‚¨åˆ°/dev /input/eventX ä¾›åº”ç”¨ç¨‹åºè¯»å– Event debugging * Input Device Drivers * -*- Keyboards â€” [*] Mice â€” [] Joysticks/Gamepads â€” === æ¸¸æˆè®¾å¤‡ [] Tablets â€” === å¹³æ¿PC [] Touchscreens â€” === è§¦æ‘¸å± [] Miscellaneous devices â€” === æ‚ä¸ƒæ‚å…«çš„é©±åŠ¨ï¼Œæ‰¬å£°å™¨ï¼Œç¬”è®°æœ¬æ‰©å±•æŒ‰é”®ç­‰ Hardware I/O ports â€”9.20ã€Character devices â€” -*- Virtual terminal [*] Support for binding and unbinding console drivers // åœ¨æŸäº›ç³»ç»Ÿä¸Šå¯ä»¥ä½¿ç”¨å¤šä¸ªæ§åˆ¶å°é©±åŠ¨ç¨‹åº( å¦‚framebuffer æ§åˆ¶å°é©±åŠ¨ç¨‹åº), è¯¥é€‰é¡¹ä½¿å¾—ä½ å¯ä»¥é€‰æ‹©å…¶ä¸­ä¹‹ä¸€ ï¼Œæˆ‘ä¸€èˆ¬åªç”¨é»˜è®¤çš„è™šæ‹Ÿç»ˆç«¯ [] /dev /kmem virtual device support === æ”¯æŒ/dev /kmem è®¾å¤‡ï¼Œå¾ˆå°‘ç”¨ [] Non-standard serial port support === æˆ‘æ²¡æœ‰éæ ‡å‡†çš„ä¸²å£è®¾å¤‡ Serial drivers â€” 8250/16550 and compatible serial support === å…¼å®¹ä¸€äº›è€å¼çš„ä¸²å£è®¾å¤‡ï¼Œæˆ‘ä¸€èˆ¬ä¸ç”¨ * Non-8250 serial port support * Digi International NEO PCI Support -*- Unix98 PTY support [ ] Support multiple instances of devpts [ ] Legacy (BSD) PTY support IPMI top-level message handler â€” * Hardware Random Number Generator Core support Timer IOMEM HW Random Number Generator support * Intel HW Random Number Generator support AMD HW Random Number Generator support === æˆ‘æ˜¯intel ä¸»æ¿ AMD Geode HW Random Number Generator support === æˆ‘æ˜¯intel ä¸»æ¿ VIA HW Random Number Generator support === æˆ‘æ˜¯intel ä¸»æ¿ /dev /nvram support === ç›´æ¥å­˜å–CMOS ï¼Œå¤ªå±é™©ï¼Œå…³ Siemens R3964 line discipline Applicom intelligent fieldbus card support ACP Modem (Mwave ) support NatSemi PC8736x GPIO Support NatSemi Base GPIO Support AMD CS5535/CS5536 GPIO (Geode Companion Device) RAW driver (/dev /raw/rawN ) [*] HPET - High Precision Event Timer [ ] Allow mmap of HPET Hangcheck timer9.21ã€M I2C support â€” æ„ŸçŸ¥ç¡¬ä»¶çŠ¶æ€ï¼Œæ¯”å¦‚æ¸©åº¦ï¼Œé£æ‰‡è½¬é€Ÿ9.22ã€[ ] SPI support â€”9.23ã€PPS support â€”9.24ã€[ ] GPIO Support â€”9.25ã€* Power supply class support â€”9.26ã€* Hardware Monitoring support â€”9.27ã€-*- Generic Thermal sysfs driver â€”9.28ã€[*] Watchdog Timer Support â€” ç³»ç»Ÿç›‘è§†ç¨‹åºï¼Œæˆ‘ä¸€èˆ¬ä¸ç”¨9.29ã€Sonics Silicon Backplane â€”9.30ã€ Multimedia support â€”9.31ã€[ ] Voltage and Current Regulator Support â€”9.32ã€ Multimedia support â€” /dev /agpgart (AGP Support) â€” â€” virtualboxä¸æ”¯æŒè™šæ‹Ÿç‹¬ç«‹æ˜¾å¡ -*- VGA arbitration (16) Maximium number of GPU [ ] Latop Hybird Graphics â€“ GPU switch support * Direct Rendering Manager (XFree86 4.1.0 and higher DRI support) â€” Lowlevel video output switch controls Support for frame buffer devices â€” [ ] Backlight LCD device support â€” â€” æ”¯æŒèƒŒå…‰è®¾ç½®ï¼Œæ¯”å¦‚pdaç­‰ã€‚æˆ‘ç”¨ä¸åˆ° Display device support â€” Console display driver support â€” [ ] Enable Scrollback Buffer in System RAM9.33ã€ Sound card support â€” ç”¨ä¸åˆ°å£°å¡9.34ã€[ ] HID Devices â€” ç”¨ä¸åˆ°äººåŠ›å·¥ç¨‹å­¦è®¾å¤‡9.35ã€[] USB support â€” === è¿™ä¸ªé€‰é¡¹ï¼Œå¯¹äºè·‘ç‰©ç†æœºå»ºè®® å¼€å¯ï¼Œå› ä¸ºæœ‰å¯èƒ½ä½ çš„é”®ç›˜æ˜¯USB çš„ï¼Œæˆ‘æ˜¯è·‘è™šæ‹Ÿæœºçš„ï¼Œæ‰€ä»¥å…³äº†9.36ã€ MMC/SD/SDIO card support â€”9.37ã€ Sony MemoryStick card support (EXPERIMENTAL) â€”9.38ã€[] LED Support â€” === å‘å…‰äºŒçº§ç®¡ï¼Œåº”è¯¥æ˜¯è·Ÿæ˜¾ç¤ºå™¨ç›¸å…³çš„é©±åŠ¨ï¼Œç”±äºæˆ‘è¿è¡Œ çš„æ˜¯è™šæ‹Ÿæœºï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©å…³é—­9.39ã€[ ] Accessibility support â€”9.40ã€ InfiniBand support â€” 9.41ã€[*] EDAC (Error Detection And Correction) reporting â€” // ç¡¬ä»¶æ•…éšœrepoting9.42ã€* Real Time Clock â€”9.43ã€[*] DMA Engine support â€”9.44ã€[ ] Auxiliary Display support â€”9.45ã€ Userspace I/O drivers â€”9.46ã€TI VLYNQ â€”9.47ã€[ ] Staging drivers â€”9.48ã€[] X86 Platform Specific Device Drivers â€” === ä¸€äº›ç¬”è®°æœ¬çš„é©±åŠ¨ï¼Œæˆ‘æ²¡æœ‰ç›¸å…³è®¾å¤‡10ã€Firmware Drivers â€” BIOS Enhanced Disk Drive calls determine boot disk BIOS update support for DELL systems via sysfs Dell Systems Management Base Driver [*] Export DMI identification via sysfs to userspace // å°†BIOS é‡Œçš„DMI åŒºä¿¡æ¯å¯¼å‡ºåˆ°ç”¨æˆ·ç©ºé—´ï¼Œéƒ¨åˆ†ç³»ç»Ÿç®¡ç†å·¥å…·å¯èƒ½ä¼šç”¨åˆ° [ ] iSCSI Boot Firmware Table Attributes11ã€File systems â€” Second extended fs support Ext3 journalling file system support === æˆ‘ä½¿ç”¨çš„æ˜¯ext4 FS * The Extended 4 (ext4) filesystem [ ] Enable ext4dev compatibility [*] Ext4 extended attributes [*] Ext4 POSIX Access Control Lists [] Ext4 Security Labels === å–æ¶ˆ SELinux æ”¯æŒ [ ] JBD (ext3) debugging support [ ] JBD2 (ext4) debugging support Reiserfs support JFS filesystem support XFS filesystem support OCFS2 file system support [*] Dnotify support [*] Inotify support for userspace [] Quota support === ç£ç›˜é…é¢æ”¯æŒ , é™åˆ¶æŸä¸ªç”¨æˆ·æˆ–è€…æŸç»„ç”¨æˆ·çš„ç£ç›˜å ç”¨ç©ºé—´ï¼Œæš‚æ—¶æ²¡è¿™ä¸ªéœ€æ±‚ï¼Œä½ å¯ä»¥æŠŠå®ƒç¼–è¯‘æˆæ¨¡å— Kernel automounter support * Kernel automounter version 4 support (also supports v3) FUSE (Filesystem in Userspace ) support Caches â€” CD-ROM/DVD Filesystems â€” ISO 9660 CDROM file system support === åœ¨è™šæ‹Ÿæœºå†…ï¼Œæˆ‘ä¸ç”¨CDROM UDF file system support DOS/FAT/NT Filesystems â€” MSDOS fs support === æˆ‘æ²¡æœ‰å¾®è½¯fs çš„è®¾å¤‡ VFAT (Windows-95) fs support === æˆ‘æ²¡æœ‰å¾®è½¯fs çš„è®¾å¤‡ NTFS file system support Pseudo filesystems â€” [] Miscellaneous filesystems â€” === å¦‚æœä½ æ²¡æœ‰å…¶ä»–FS çš„æ”¯æŒéœ€æ±‚ï¼Œå…³ [*] Network File Systems â€” === å¦‚æœä½ æ²¡æœ‰NFS çš„æ”¯æŒéœ€æ±‚ï¼Œå…³ Partition Types â€” [ ] Advanced partition selection === å¦‚æœä¸æ˜¯å’Œå…¶ä»–ç³»ç»Ÿå…±å­˜ï¼Œå¯ä»¥ä¸é€‰ -*- Native language support â€” // é€‰ä¸ŠChinese12ã€Kernel hacking [] Show timing information on printks === åœ¨printk çš„è¾“å‡ºä¸­åŒ…å«æ—¶é—´ä¿¡æ¯, å¯ä»¥ç”¨æ¥åˆ†æå†…æ ¸å¯åŠ¨è¿‡ç¨‹å„æ­¥éª¤æ‰€ç”¨æ—¶é—´ , æˆ‘ä¸éœ€è¦debug å†…æ ¸ [ ] Enable __deprecated logic [*] Enable __must_check logic (2048) Warn for stack frames larger than (needs gcc 4.4) [] Magic SysRq key === ä¸€ç§é€šè¿‡å¿«æ·é”®æ§åˆ¶ç³»ç»Ÿæ–¹å¼ï¼Œé™¤éä½ éå¸¸æ¸…æ¥šè¿™ä¸ªé€‰é¡¹ï¼Œå®˜æ–¹ä¸æ¨èé€‰æ‹© [ ] Enable unused/obsolete exported symbols [ ] Debug Filesystem [ ] Run â€˜make headers_check â€™ when building vmlinux [ ] Kernel debugging === å†…æ ¸è°ƒè¯•ï¼Œå…³ [ ] Enable SLUB performance statistics [] Compile the kernel with frame pointers === è¿˜æ˜¯è·Ÿå†…æ ¸å¼€å‘æœ‰å…³ [ ] Delay each boot printk message by N milliseconds torture tests for RCU [ ] Check for stalled CPUs delaying RCU grace periods Self test for the backtrace code [ ] Force extended block device numbers and spread them [ ] Fault-injection framework [ ] Latency measuring infrastructure [*] Sysctl checks [] Tracers â€” [] Remote debugging over FireWire early on boot === å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œå…è®¸è¿œç¨‹è°ƒè¯•å†…æ ¸ [ ] Enable dynamic printk ( ) support [ ] Enable debugging of DMA-API usage [ ] Sample kernel code â€” [ ] Filter access to /dev /mem [] Enable verbose x86 bootup info messages === åœ¨å†…æ ¸é•œåƒè§£å‹ç¼©é˜¶æ®µè¾“å‡ºå¯åŠ¨ä¿¡æ¯ï¼Œå…³é—­åç›¸å½“äºæ— å£°å¯åŠ¨(Slient Bootup ) -*- Early printk [] Early printk via EHCI debug port === å…è®¸printk é€šè¿‡EHCI è°ƒè¯•ç«¯å£è¾“å‡ºå†…æ ¸æ—¥å¿—ï¼Œè°ƒè¯•çš„ä¸€å¾‹å…³ [ ] Use 4Kb for kernel stacks instead of 8Kb [ ] Enable IOMMU stress-test mode IO delay type (port 0x80 based port-IO delay [recommended]) â€” [*] Allow gcc to uninline functions marked â€˜inlineâ€™13ã€Security options å®‰å…¨ç‰¹æ€§ï¼Œæˆ‘é€‰æ‹©å…¨å…³ï¼Œå½“ç„¶ï¼Œè¿™äº›é€‰é¡¹ä¸ä¼šå½±å“ä½ çš„æ—¥å¸¸å¼€å‘ï¼ŒåŠå…¬ [] Enable access key retention support === å…³é—­ [] Enable different security models === å…³é—­ [ ] Enable the securityfs filesystem [] File POSIX Capabilities === å…³é—­ [ ] Integrity Measurement Architecture( IMA) Cryptographic API â€” // åŠ å¯†API ï¼Œè¿™éƒ¨åˆ†é€‰é¡¹ä¼šæ ¹æ®æ­¤å‰çš„ä¼˜åŒ–è‡ªåŠ¨è°ƒæ•´ï¼Œé»˜è®¤å³å¯ 14ã€[] Virtualization æˆ‘çš„ç³»ç»Ÿå·²ç»è¿è¡Œåœ¨è™šæ‹Ÿæœºä¸­ï¼Œä¸éœ€è¦å†æ”¯æŒè™šæ‹ŸåŒ– 15ã€Library routines â€” åº“å­ç¨‹åºï¼Œè¿™éƒ¨åˆ†é€‰é¡¹ä¼šæ ¹æ®æ­¤å‰çš„ä¼˜åŒ–è‡ªåŠ¨è°ƒæ•´ï¼Œé»˜è®¤å³å¯","tags":["clippings"],"categories":["1.å¹³å°ç³»ç»Ÿ","Linux"]},{"title":"HTMLå†…åµŒMarkdownç¼–è¾‘å™¨_htmlåµŒå…¥markdown-CSDNåšå®¢","path":"/2025/02/22/2-ç¼–ç¨‹è¯­è¨€-å…¶ä»–è¯­æ³•-HTMLå†…åµŒMarkdownç¼–è¾‘å™¨-htmlåµŒå…¥markdown-CSDNåšå®¢/","content":"å®ç°æ­¥éª¤1ã€è·å–markdownçš„å¼€æºåº“ï¼Œè¿™é‡Œç”¨çš„æ˜¯å¼€æºé¡¹ç›®showdownã€‚å°†showdown.min.jsæ‹·è´åˆ°é¡¹ç›®ä¸­ï¼Œéœ€è¦çš„å…¶ä»–æ‰©å±•å¯é€šè¿‡setOption(â€œæ‰©å±•åâ€,true)å»å¯åŠ¨ã€‚ showdown: https://github.com/showdownjs/showdown 2ã€é€‰æ‹©å–œæ¬¢çš„Markdownæ ·å¼ï¼Œä¸‹è½½å¼•ç”¨è¯¥cssåˆ°è‡ªå·±çš„é¡¹ç›®ï¼Œè¿˜å¯ä»¥é€‚å½“ä¿®æ”¹æ ·å¼ã€‚ æç¬‘æ¥è€å¸ˆçš„https://gist.github.com/xiaolai/aa190255b7dde302d10208ae247fc9f2 å°‘æ•°æ´¾ä¸»é¢˜: https://cdn.sspai.com/sspai.css Mwebä¸»é¢˜: https://cdn.sspai.com/MWeb.css Githubä¸»é¢˜: https://github.com/sindresorhus/github-markdown-css typoraä¸»é¢˜åˆé›†ä¸‹è½½: https://theme.typora.io/ 3ã€æŒ‰ç…§showdownå’Œé€‰æ‹©çš„æ ·å¼è¦æ±‚çš„æ ¼å¼æ¥ä¹¦å†™htmlæ–‡ä»¶ã€‚æˆ‘è¿™é‡Œç”¨çš„æ˜¯Githubä¸»é¢˜ã€‚Githubä¸»é¢˜çš„ä½¿ç”¨æ–¹å¼ï¼šshowdown.min.jsçš„ä½¿ç”¨æ–¹å¼ï¼šå…¶ä»–æ‰©å±•é€‰é¡¹ï¼šå®ç°ä»£ç ï¼š !DOCTYPE htmlhtmlhead meta charset=UTF-8 meta name=viewport content=width=device-width, initial-scale=1 titlehtmlå†…åµŒmarkdown/title script src=showdown.min.js/script link rel=stylesheet type=text/css href=github-markdown.css/headbody style #editor display: flex; min-height: 600px; width: 100%; #md-area width: 100%; background: #f5f5f5; border: 1px solid #111; #view-area width: 100%; border: 1px solid #111; /*Githubä¸»é¢˜è¦æ±‚çš„æ ·å¼å¼•å…¥*/ .markdown-body box-sizing: border-box; min-width: 200px; max-width: 980px; margin: 0 auto; padding: 45px; @media (max-width: 767px) .markdown-body padding: 15px; /stylediv id=editor textarea id=md-area onkeyup=mdConverter()/textarea !-- é”®ç›˜æ¯æ¬¡ç‚¹å‡»å®æ—¶è°ƒç”¨ -- article id=view-area class=markdown-body !-- githubä¸»é¢˜æ ·å¼åº”ç”¨ -- /article/divscript function mdConverter() var md = document.getElementById(md-area).value; var converter = new showdown.Converter(); //å¢åŠ æ‹“å±•table converter.setOption(tables, true); //å¯ç”¨è¡¨æ ¼é€‰é¡¹ã€‚ä»showdown 1.2.0ç‰ˆå¼€å§‹ï¼Œè¡¨æ”¯æŒå·²ä½œä¸ºå¯é€‰åŠŸèƒ½ç§»å…¥æ ¸å¿ƒæ‹“å±•ï¼Œshowdown.table.min.jsæ‰©å±•å·²è¢«å¼ƒç”¨ var view = converter.makeHtml(md); document.getElementById(view-area).innerHTML = view; /script/body/html æ•ˆæœï¼š å‚è€ƒæ–‡ç« ï¼šhttps://www.jianshu.com/p/a57114bd9380https://www.jianshu.com/p/7bb05fc9b7f0","tags":["clippings"],"categories":["2.ç¼–ç¨‹è¯­è¨€","å…¶ä»–è¯­æ³•"]},{"title":"å­—èŠ‚åº(byte order)å’Œä½åº(bit order)_å­—èŠ‚åºèµ·å§‹ä½è®¡ç®—-CSDNåšå®¢","path":"/2025/01/16/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-ä½è¿ç®—-å­—èŠ‚åº-byte-order-å’Œä½åº-bit-order-å­—èŠ‚åºèµ·å§‹ä½è®¡ç®—-CSDNåšå®¢/","content":"å­—èŠ‚åº(byte order)å’Œä½åº(bit order) åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ç»å¸¸ä¼šæåˆ°ç½‘ç»œå­—èŠ‚åºå’Œä¸»æœºåºï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä¸€ä¸ªå¯¹è±¡ç”±å¤šä¸ªå­—èŠ‚ç»„æˆçš„æ—¶å€™éœ€è¦æ³¨æ„å¯¹è±¡çš„å¤šä¸ªå­—èŠ‚åœ¨å†…å­˜ä¸­çš„é¡ºåºã€‚â€ƒä»¥å‰æˆ‘ä¹ŸåŸºæœ¬åªäº†è§£è¿‡å­—èŠ‚åºï¼Œä½†æ˜¯æœ‰ä¸€å¤©å½“æˆ‘çœ‹åˆ°ip.hä¸­å¯¹IPå¤´éƒ¨ç»“æ„ä½“struct iphdrçš„å®šä¹‰æ—¶ï¼Œæˆ‘å‘ç°å…¶ä¸­ç«Ÿç„¶å¯¹ä¸€ä¸ªå­—èŠ‚ä¸­çš„8ä¸ªæ¯”ç‰¹ä½ä¹ŸåŒºåˆ†äº†å¤§å°ç«¯ï¼Œè¿™æ—¶æˆ‘å°±è¿·ç³Šäº†ï¼Œä¸æ˜¯è¯´å¤§å°ç«¯åªæœ‰åœ¨å¤šä¸ªå­—èŠ‚ä¹‹é—´æ‰ä¼šæœ‰åŒºåˆ†çš„å—ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œçš„å®šä¹‰å´å¯¹ä¸€ä¸ªå­—èŠ‚ä¸­çš„æ¯”ç‰¹ä½ä¹ŸåŒºåˆ†å¤§å°ç«¯å‘¢?â€ƒä¸‹é¢æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹struct iphdrçš„å®šä¹‰ï¼Œåæ–‡ä¼šè§£æƒ‘ä¸ºä»€ä¹ˆè¦åœ¨ä¸€ä¸ªå­—èŠ‚ä¸­åŒºåˆ†å¤§å°ç«¯ã€‚ struct iphdr #if defined(__LITTLE_ENDIAN_BITFIELD) __u8 ihl:4, version:4;#elif defined (__BIG_ENDIAN_BITFIELD) __u8 version:4, ihl:4;#else#error Please fix asm/byteorder.h#endif __u8 tos; __be16 tot_len; __be16 id; __be16 frag_off; __u8 ttl; __u8 protocol; __sum16 check; __be32 saddr; __be32 daddr; /*The options start here. */;12345678910111213141516171819202122 å­—èŠ‚åº(Byte order)â€ƒå…³äºå­—èŠ‚åºçš„æ–‡ç« å·²ç»æœ‰å¾ˆå¤šäº†ï¼Œåœ¨æˆ‘è¿™ç¯‡æ–‡ç« ä¸­ä¸æ‰“ç®—è¿‡å¤šçš„è¯´å­—èŠ‚åºï¼Œä½†æ˜¯ä¹Ÿä¸èƒ½å®Œå…¨è„±ç¦»å­—èŠ‚åºå› ä¸ºåé¢çš„é‡ç‚¹éƒ¨åˆ†æ¯”ç‰¹åºè·Ÿå­—èŠ‚åºä¹Ÿæœ‰ä¸€å®šçš„ç›¸ä¼¼åº¦å’Œè”ç³»ã€‚â€ƒå­—èŠ‚åºå°±æ˜¯è¯´ä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå­—èŠ‚åœ¨å†…å­˜ä¸­å¦‚ä½•æ’åºå­˜æ”¾ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦æƒ³å¾€ä¸€ä¸ªåœ°å€aä¸­å†™å…¥ä¸€ä¸ªæ•´å½¢æ•°æ®0x12345678ï¼Œé‚£ä¹ˆæœ€ååœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜æ”¾è¿™å››ä¸ªå­—èŠ‚çš„å‘¢ï¼Ÿâ€ƒ0x12è¿™ä¸ªå­—èŠ‚å€¼ä¸ºæœ€é«˜æœ‰æ•ˆå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯æ•´æ•°å€¼çš„æœ€é«˜ä½(åœ¨æœ¬æ–‡ä¸­0x120x12000000)ï¼Œ0x78ä¸ºæœ€ä½æœ‰æ•ˆå­—èŠ‚ã€‚ å›¾1ï¼šå¤§ç«¯å­—èŠ‚åºä¸Šå›¾æ˜¯å¤§ç«¯å­—èŠ‚åºçš„ç¤ºæ„å›¾ï¼Œæ‰€è°“â€å¤§ç«¯å­—èŠ‚åºâ€ï¼Œä¾¿æ˜¯æŒ‡æœ€é«˜æœ‰æ•ˆå­—èŠ‚è½åœ¨ä½åœ°å€ä¸Šçš„å­—èŠ‚å­˜æ”¾æ–¹å¼ã€‚ å›¾2ï¼šå°ç«¯å­—èŠ‚åºâ€ƒè€Œå°ç«¯å­—èŠ‚åºå°±æ˜¯æœ€ä½æœ‰æ•ˆå­—èŠ‚è½åœ¨ä½åœ°å€ä¸Šçš„å­—èŠ‚å­˜æ”¾æ–¹å¼ã€‚â€ƒ0x123456780x12000000 + 0x340000 + 0x5600 + 0x78ï¼Œæ‰€ä»¥è¦æƒ³ä¿æŒä¸€ä¸ªå¯¹è±¡çš„å€¼åœ¨å¤§å°ç«¯ç³»ç»Ÿä¹‹é—´ä¸å˜ï¼Œé‚£ä¹ˆå°±å¿…é¡»ç¡®ä¿ä¸åŒçš„ç³»ç»Ÿèƒ½å¤Ÿæ­£ç¡®çš„è¯†åˆ«æœ€é«˜æœ‰æ•ˆå­—èŠ‚å’Œæœ€ä½æœ‰æ•ˆå­—èŠ‚(ä¸èƒ½é”™è¯¯çš„è¯†åˆ«æœ€é«˜ã€æœ€ä½æœ‰æ•ˆå­—èŠ‚)ã€‚â€ƒåŒæ ·çš„å­—èŠ‚åº12 34 56 78åœ¨å¤§ç«¯åºæœºå™¨ä¸­ä¼šè¯†åˆ«ä¸º0x12345678(0x12000000 + 0x340000 + 0x5600 + 0x780x12345678)ï¼Œåœ¨å°ç«¯åºæœºå™¨ä¸­è¯†åˆ«ä¸º0x78563412(0x12 + 0x3400 + 0x5600 00+ 0x780000000x78563412)ã€‚â€ƒæ‰€ä»¥è¦æƒ³ä¸¤è€…ä¿æŒä¸€è‡´å°±å¿…é¡»ç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿæ­£ç¡®çš„è¯†åˆ«æœ€é«˜æœ‰æ•ˆå­—èŠ‚0x12å’Œæœ€ä½æœ‰æ•ˆå­—èŠ‚0x78ï¼Œé‚£ä¹ˆåœ¨å°ç«¯ç³»ç»Ÿä¸­å­—èŠ‚å­˜æ”¾çš„é¡ºåºåº”è¯¥ä¸º78 56 34 12ã€‚ æ¯”ç‰¹åº(bit order)â€ƒå­—èŠ‚åºæ˜¯ä¸€ä¸ªå¯¹è±¡ä¸­çš„å¤šä¸ªå­—èŠ‚ä¹‹é—´çš„é¡ºåºé—®é¢˜ï¼Œæ¯”ç‰¹åºå°±æ˜¯ä¸€ä¸ªå­—èŠ‚ä¸­çš„8ä¸ªæ¯”ç‰¹ä½(bit)ä¹‹é—´çš„é¡ºåºé—®é¢˜ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ç³»ç»Ÿçš„æ¯”ç‰¹åºå’Œå­—èŠ‚åºæ˜¯ä¿æŒä¸€è‡´çš„ã€‚â€ƒä¸€ä¸ªå­—èŠ‚ç”±8ä¸ªbitç»„æˆï¼Œè¿™8ä¸ªbitä¹Ÿå­˜åœ¨å¦‚ä½•æ’åºçš„æƒ…å†µï¼Œè·Ÿå­—èŠ‚åºç±»ä¼¼çš„æœ‰æœ€é«˜æœ‰æ•ˆæ¯”ç‰¹ä½ã€æœ€ä½æœ‰æ•ˆæ¯”ç‰¹ä½ã€‚â€ƒæ¯”ç‰¹åº1 0 0 1 0 0 1 0åœ¨å¤§ç«¯ç³»ç»Ÿä¸­æœ€é«˜æœ‰æ•ˆæ¯”ç‰¹ä½ä¸º1ã€æœ€ä½æœ‰æ•ˆæ¯”ç‰¹ä½ä¸º0ï¼Œå­—èŠ‚çš„å€¼ä¸º0x92ã€‚åœ¨å°ç«¯ç³»ç»Ÿä¸­æœ€é«˜ã€æœ€ä½æœ‰æ•ˆæ¯”ç‰¹ä½åˆ™ç›¸åä¸º0ã€1ï¼Œå­—èŠ‚çš„å€¼ä¸º0x49ã€‚â€ƒè·Ÿå­—èŠ‚åºç±»ä¼¼ï¼Œè¦æƒ³ä¿æŒä¸€ä¸ªå­—èŠ‚å€¼ä¸å˜é‚£ä¹ˆå°±è¦ä½¿ç³»ç»Ÿèƒ½æ­£ç¡®çš„è¯†åˆ«æœ€é«˜ã€æœ€ä½æœ‰æ•ˆæ¯”ç‰¹ä½ã€‚ å­—èŠ‚åºè½¬æ¢å‡½æ•°ntohl(s)ã€htonl(s)â€ƒåœ¨socketç¼–ç¨‹ä¸­ç»å¸¸è¦ç”¨åˆ°ç½‘ç»œå­—èŠ‚åºè½¬æ¢å‡½æ•°ntohlã€htonlæ¥è¿›è¡Œä¸»æœºåºå’Œç½‘ç»œåº(å¤§ç«¯åº)çš„è½¬æ¢ï¼Œåœ¨ä¸»æœºåºä¸ºå°ç«¯çš„ç³»ç»Ÿä¸­å­—èŠ‚åºåˆ—78 56 34 12(val0x12345678)ç»è¿‡htonlè½¬æ¢åå­—èŠ‚åºåˆ—å˜æˆ12 34 56 78ï¼š å›¾3ï¼šhtonlå‡½æ•°â€ƒå­—èŠ‚åºè½¬æ¢åæˆ‘åœ¨æƒ³æ˜¯ä¸æ˜¯æ¯”ç‰¹åºä¹Ÿä¸€åŒè¿›è¡Œäº†è½¬æ¢?â€ƒä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªç–‘é—®å‘¢ï¼Œå› ä¸ºå‰æ–‡å¯çŸ¥ç³»ç»Ÿçš„æ¯”ç‰¹åºå’Œå­—èŠ‚åºæ˜¯ä¸€è‡´çš„ï¼Œç°åœ¨å­—èŠ‚åºå·²ç»ä»å°ç«¯å˜æˆäº†å¤§ç«¯é‚£ä¹ˆæ¯”ç‰¹åºåº”è¯¥ä¹Ÿè¦ä¸€èµ·è½¬æ¢ã€‚è€Œä¸”å¦‚æœæ¯”ç‰¹åºä¸å˜åŒ–é‚£ä¹ˆå½“è¿™äº›å­—èŠ‚åˆ°äº†ç›®æ ‡å¤§ç«¯åºç³»ç»Ÿä¸­åæ¯ä¸€ä¸ªå­—èŠ‚çš„å€¼éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå› ä¸ºåŒæ ·çš„æ¯”ç‰¹åºåˆ—åœ¨å°ç«¯å’Œå¤§ç«¯ç³»ç»Ÿä¸­è¯†åˆ«çš„å­—èŠ‚å€¼ä¼šä¸ä¸€æ ·ã€‚â€ƒé¦–å…ˆä»htonlã€ntohlçš„æºç æ¥çœ‹ç¡®å®åªè¿›è¡Œäº†å­—èŠ‚åºçš„è½¬æ¢å¹¶æ²¡æœ‰è¿›è¡Œæ¯”ç‰¹åºçš„è½¬æ¢ï¼Œå†æœ‰å°±æ˜¯ä»¥å‰socketç¼–ç¨‹çš„æ—¶å€™åªè°ƒç”¨äº†ntohlã€htonlç­‰å‡½æ•°å¹¶æ²¡æœ‰è°ƒç”¨(è€Œä¸”ç³»ç»Ÿä¹Ÿæ²¡æœ‰æä¾›)æ¯”ç‰¹åºè½¬æ¢å‡½æ•°ï¼Œä½†æ˜¯æœ€åçš„ç»“æœéƒ½æ˜¯æ­£ç¡®çš„ï¼Œå¹¶æ²¡æœ‰å‘ç°ä¸Šé¢æåˆ°çš„å­—èŠ‚å€¼å‘ç”Ÿå˜åŒ–çš„é—®é¢˜ã€‚â€ƒé‚£ä¹ˆè¿™ä¸ªâ€ç¥å¥‡â€çš„äº‹æƒ…æ˜¯æ€ä¹ˆè§£å†³çš„å‘¢ï¼Œå¥½åƒç³»ç»Ÿæœ¬èº«å°±ç»™æˆ‘ä»¬â€æ‚„æ‚„â€çš„è§£å†³äº†æˆ‘æ‹…å¿ƒçš„é—®é¢˜ã€‚ç­”æ¡ˆæˆ‘ä»¬ä¸‹æ–‡æ­æ™“ã€‚ æ¯”ç‰¹(bit)çš„å‘é€å’Œæ¥æ”¶é¡ºåºâ€ƒæ¯”ç‰¹çš„å‘é€ã€æ¥æ”¶é¡ºåºæ˜¯æŒ‡ä¸€ä¸ªå­—èŠ‚ä¸­çš„bitåœ¨ç½‘ç»œç”µç¼†ä¸­æ˜¯å¦‚ä½•å‘é€ã€æ¥æ”¶çš„ã€‚åœ¨ä»¥å¤ªç½‘(Ethernet)ä¸­ï¼Œæ˜¯ä»æœ€ä½æœ‰æ•ˆæ¯”ç‰¹ä½åˆ°æœ€é«˜æœ‰æ•ˆæ¯”ç‰¹ä½çš„å‘é€é¡ºåºï¼Œä¹Ÿå°±æ˜¯æœ€ä½æœ‰æ•ˆæ¯”ç‰¹ä½é¦–å…ˆå‘é€ï¼Œå‚è€ƒèµ„æ–™ï¼šframeã€‚â€ƒåœ¨ä»¥å¤ªç½‘ä¸­è¿™ä¸ªè§„å®šæœ‰ç‚¹å¥‡æ€ªï¼Œå› ä¸ºå­—èŠ‚åºæˆ‘ä»¬æ˜¯æŒ‰ç…§å¤§ç«¯åºæ¥å‘é€ï¼Œä½†æ˜¯æ¯”ç‰¹åºå´æ˜¯æŒ‰ç…§å°ç«¯åºçš„æ–¹å¼æ¥å‘é€ï¼Œä¸‹å›¾æ˜¯ç›´æ¥ä»ç½‘ä¸Šæ‰¾æ¥çš„ä¸€å¼ å›¾ï¼Œä¸»æœºåºæœ¬èº«æ˜¯å¤§ç«¯åºï¼š å›¾4ï¼šæ¯”ç‰¹å‘é€ã€æ¥å—ç¤ºæ„å›¾â€ƒæ¯”ç‰¹çš„å‘é€ã€æ¥æ”¶é¡ºåºå¯¹CPUã€è½¯ä»¶éƒ½æ˜¯ä¸å¯è§çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç½‘å¡ä¼šç»™æˆ‘ä»¬å¤„ç†è¿™ç§è½¬æ¢ï¼Œåœ¨å‘é€çš„æ—¶å€™æŒ‰ç…§å°ç«¯åºå‘é€æ¯”ç‰¹ä½ï¼Œåœ¨æ¥æ”¶çš„æ—¶å€™ä¼šæŠŠæ¥æ”¶åˆ°çš„æ¯”ç‰¹åºè½¬æ¢æˆä¸»æœºçš„æ¯”ç‰¹åºï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå°ç«¯æœºå™¨å‘é€ä¸€ä¸ªintæ•´å‹ç»™ä¸€ä¸ªå¤§ç«¯æœºå™¨çš„ç¤ºæ„å›¾ï¼š å›¾5ï¼šå°ç«¯-å¤§ç«¯æ¯”ç‰¹å‘é€ç¤ºä¾‹â€ƒå› ä¸ºå¯¹ç½‘å¡å¯¹æ¯”ç‰¹åºçš„å‘é€ã€æ¥æ”¶æ‰€åšçš„è½¬æ¢æ²¡æœ‰æ·±å…¥çš„äº†è§£æ‰€ä»¥ä¸Šå›¾å¾ˆæœ‰å¯èƒ½ä¼šæœ‰é”™è¯¯ä¹‹å¤„ã€‚â€ƒç°åœ¨æ¥å›ç­”ä¸€ä¸‹ç¬¬3èŠ‚ä¸­çš„é‚£ä¸ªç–‘é—®ï¼š htonlã€ntohlå‡½æ•°è‚¯å®šæ˜¯ä¸ä¼šåŒæ­¥è½¬æ¢ä¸€ä¸ªå­—èŠ‚ä¸­çš„æ¯”ç‰¹åºçš„ï¼Œå› ä¸ºå¦‚æœæ¯”ç‰¹åºä¹Ÿå‘ç”Ÿäº†è½¬æ¢çš„è¯é‚£ä¹ˆè¿™ä¸ªå­—èŠ‚çš„å€¼ä¹Ÿå°±å‘ç”Ÿäº†å˜åŒ–ï¼Œè®°ä½htonlã€ntohlåªæ˜¯å­—èŠ‚åºè½¬æ¢å‡½æ•°ã€‚ æ¯”ç‰¹åºæŒ‰ç…§å°ç«¯çš„æ–¹å¼å‘é€ï¼Œé¦–å…ˆå‘é€çš„æ˜¯æœ€ä½æœ‰æ•ˆæ¯”ç‰¹ä½ï¼Œæœ€åå‘é€çš„æ˜¯æœ€é«˜æœ‰æ•ˆæ¯”ç‰¹ä½ï¼Œæ¥æ”¶ç«¯çš„ç½‘å¡åœ¨æ¥æ”¶åˆ°æ¯”ç‰¹åºåˆ—åæŒ‰ç…§ä¸»æœºçš„æ¯”ç‰¹åºæŠŠæ¥æ”¶åˆ°çš„â€å°ç«¯åºâ€æ¯”ç‰¹æµè½¬æ¢æˆä¸»æœºå¯¹åº”çš„æ¯”ç‰¹åºåˆ—ã€‚â€ƒå¯ä»¥å‡è®¾å­˜åœ¨ntohbã€htonb(bä»£è¡¨bit)è¿™æ ·çš„ä¸¤ä¸ªå‡½æ•°ï¼Œç½‘å¡è¿›è¡Œäº†æ¯”ç‰¹åºçš„è½¬æ¢ï¼Œä¸è¿‡æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°æ˜¯ç½‘å¡è‡ªåŠ¨è°ƒç”¨çš„ï¼Œæˆ‘ä»¬å¹³æ—¶ä¸ç”¨å…³æ³¨ã€‚ æŒ‰ç…§è§„åˆ™ï¼Œå‘é€ã€æ¥æ”¶çš„æ—¶å€™è¿›è¡Œæ¯”ç‰¹åºçš„è½¬æ¢ï¼Œé‚£ä¹ˆå°±èƒ½ä¿è¯åœ¨ä¸åŒçš„æœºå™¨ä¹‹é—´è¿›è¡Œé€šä¿¡ä¸ä¼šå‘ç”Ÿæˆ‘æ‹…å¿ƒçš„å­—èŠ‚å€¼å‘ç”Ÿå˜åŒ–çš„é—®é¢˜ã€‚ ç»“æ„ä½“çš„ä½åŸŸâ€ƒå…³äºCè¯­è¨€ä¸­ç»“æ„ä½“çš„ä½åŸŸå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šhttp://tonybai.com/2013/05/21/talk-about-bitfield-in-c-again/ï¼Œå¯¹äºä½åŸŸçš„å…·ä½“ç”¨æ³•ã€è¯­æ³•å‚è€ƒè¿™ç¯‡æ–‡ç« å³å¯æœ‰ã€‚â€ƒå¯¹äºä½åŸŸæœ‰ä¸€ä¸ªçº¦å®šï¼šåœ¨Cè¯­è¨€çš„ç»“æ„ä½“ä¸­å¦‚æœåŒ…å«äº†ä½åŸŸï¼Œå¦‚æœä½åŸŸAå®šä¹‰åœ¨ä½åŸŸBä¹‹å‰ï¼Œé‚£ä¹ˆä½åŸŸAæ€»æ˜¯å‡ºç°åœ¨ä½åºçš„æ¯”ç‰¹ä½ã€‚åœ¨è®¡ç®—æœºä¸­å¯å¯»å€çš„æœ€å°å•ä½ä¸ºå­—èŠ‚ï¼Œbitæ˜¯æ— æ³•å¯»å€çš„ï¼Œä½†æ˜¯ä¸ºäº†æŠ½è±¡æˆ‘ä»¬å¯ä»¥æŠŠè®¡ç®—æœºçš„æœ€å°å¯»å€å•ä½å˜æˆbitï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥å•ç‹¬è·å¾—ä¸€ä¸ªbitä½ã€‚â€ƒæˆ‘ä»¬æœ‰å¦‚ä¸‹çš„ä¸€æ®µä»£ç ï¼š #includestdio.hstruct bit_order unsigned char a: 2, b: 3, c: 3;;int main(int argc, char *argv[]) unsigned char ch = 0x79; struct bit_order *ptr = (struct bit_order *)ch; printf(bit_order-a : %u , ptr-a); printf(bit_order-b : %u , ptr-b); printf(bit_order-c : %u , ptr-c); return 0;1234567891011121314151617181920 æˆ‘ä»¬æŠŠä»£ç åœ¨gentoo(intelå°ç«¯æœºå™¨)ã€hu-unix(å¤§ç«¯æœºå™¨)ä¸¤ä¸ªæœºå™¨ä¸Šé¢ç¼–è¯‘ã€è¿è¡Œï¼Œç»“æœå¦‚ä¸‹ï¼š liuxingen@ V6-Dev ~station $ .bitfiledbit_order-a : 1bit_order-b : 6bit_order-c : 3ä¸‹é¢æ˜¯hp-unixçš„è¿è¡Œç»“æœ# .bitfiledbit_order-a : 1bit_order-b : 7bit_order-c : 1 æˆ‘ä»¬å…ˆåˆ†æä¸€ä¸‹gentooä¸Šé¢çš„ç»“æœï¼š å›¾6ï¼šå°ç«¯æœºå™¨çš„ä½åŸŸç¤ºä¾‹â€ƒä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¾ˆå®¹æ˜“å°±èƒ½ç†è§£gentooä¸Šé¢çš„è¾“å‡ºç»“æœï¼Œä¸‹é¢æ˜¯hp-unixä¸Šé¢ç¤ºæ„å›¾ï¼š å›¾7ï¼šå¤§ç«¯æœºå™¨çš„ä½åŸŸç¤ºä¾‹â€ƒä»ä¸Šé¢çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°åŒæ ·çš„ä»£ç åœ¨ä¸åŒçš„æœºå™¨ä¸­è¾“å‡ºäº†ä¸åŒçš„ç»“æœï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„ä»£ç åœ¨ä¸åŒçš„å¹³å°ä¸èƒ½ç›´æ¥ç§»æ¤ï¼Œå¯¼è‡´è¿™ä¸ªé—®é¢˜çš„åŸå› å°±æ˜¯æˆ‘ä»¬å‰é¢æåˆ°çš„å…³äºä½åŸŸçš„ä¸€ä¸ªçº¦å®šï¼Œå®šä¹‰åœ¨å‰é¢çš„ä½åŸŸæ€»æ˜¯å‡ºç°åœ¨ä½åœ°å€çš„bitä½ä¸­ï¼Œå› ä¸ºä¸åŒçš„å¹³å°çš„æ¯”ç‰¹åºæ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯æˆ‘ä»¬å®šä¹‰çš„ä½åŸŸæ²¡æœ‰æ ¹æ®å¹³å°çš„å¤§å°ç«¯è¿›è¡Œè½¬æ¢ï¼Œæœ€åå°±å¯¼è‡´äº†é—®é¢˜ã€‚é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯åœ¨å®šä¹‰ç»“æ„ä½“ä¸­çš„ä½åŸŸæ—¶åˆ¤æ–­å¹³å°çš„å¤§å°ç«¯ï¼š #includestdio.h#includeasm/byteorder.hstruct bit_order#if defined(__LITTLE_ENDIAN_BITFIELD) unsigned char a: 2, b: 3, c: 3;#elif defined (__BIG_ENDIAN_BITFIELD) unsigned char c: 3, b: 3, a: 2;#else#error Please fix asm/byteorder.h#endif;int main(int argc, char *argv[]) unsigned char ch = 0x79; struct bit_order *ptr = (struct bit_order *)ch; printf(bit_order-a : %u , ptr-a); printf(bit_order-b : %u , ptr-b); printf(bit_order-c : %u , ptr-c); return 0;1234567891011121314151617181920212223242526272829 åˆ°æ­¤æˆ‘ä»¬ä¹Ÿå°±è§£é‡Šäº†æ–‡ç« å¼€å¤´å…³äºstruct iphdrå®šä¹‰ä¸­çš„é‚£ä¸ªç–‘é—®ã€‚â€ƒæœ€åç»™å¤§å®¶éš†é‡ä»‹ç»ä¸€ç¯‡æ–‡ç« ï¼Œå¯¹æˆ‘å¯å‘å¾ˆå¤§ï¼Œæ–‡ä¸­çš„å¾ˆå¤šçŸ¥è¯†æ¥è‡ªäºå®ƒï¼šbyte order and bit order","tags":["clippings"],"categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","ä½è¿ç®—"]},{"title":"å­—èŠ‚åºä¸ä½åºè¯¦è§£-CSDNåšå®¢","path":"/2025/01/16/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-ä½è¿ç®—-å­—èŠ‚åºä¸ä½åºè¯¦è§£-CSDNåšå®¢/","content":"Endiannesså­—èŠ‚åºå¤§å®¶è§å¾—æ¯”è¾ƒå¤šï¼Œç½‘ç»œä¸Šè®ºè¿°ä¹Ÿæ¯”è¾ƒå¤šã€‚è¿™é‡Œç®€è¦ä»‹ç»ï¼šä¹¦å†™åå…­è¿›åˆ¶æ•°æ®æ—¶ï¼Œæˆ‘ä»¬ä¹ æƒ¯ä¸Š MSB åœ¨å·¦ï¼Œè€Œ LSB åœ¨å³ã€‚ LSB: least significant byte MSB: most significant byte å¤§ç«¯ï¼šBig-endianæ•°æ®åœ¨å†…å­˜ä¸­(åœ°å€ç”±ä½åˆ°é«˜)çš„å­˜æ”¾é¡ºåºå’Œä¹¦å†™é¡ºåºæ˜¯ä¸€è‡´çš„ã€‚è®°å¿†æ–¹æ³•ï¼šä½åœ°å€æ”¾çš„æ˜¯æ•°æ®çš„ MSBï¼Œæ‰€ä»¥ç§°ä½œå¤§ç«¯ã€‚ä½åœ°å€å­˜ MSBï¼Œé«˜åœ°å€å­˜ LSBã€‚ å°ç«¯ï¼šLitthle-endianæ•°æ®åœ¨å†…å­˜ä¸­(åœ°å€ç”±ä½åˆ°é«˜)çš„å­˜æ”¾é¡ºåºå’Œä¹¦å†™é¡ºåºæ˜¯ç›¸åçš„ã€‚è®°å¿†æ–¹æ³•ï¼šä½åœ°å€æ”¾çš„æ˜¯æ•°æ®çš„ LSBï¼Œæ‰€ä»¥ç§°ä½œå°ç«¯ã€‚å³â€œé«˜é«˜ä½ä½â€ã€‚ä½åœ°å€å­˜ LSBï¼Œé«˜åœ°å€å­˜ MSBã€‚ å¦‚ä½•å†™å‡ºå…¼å®¹å¤§å°ç«¯çš„ä»£ç ç¼–ç æ—¶å¦‚æœä¸æ³¨æ„å¤§å°ç«¯çš„é—®é¢˜ï¼Œå®¹æ˜“åœ¨å¯ç§»æ¤æ€§ä¸Šæ‰“æŠ˜æ‰£ï¼Œå¹¶ä¸”å‡ºé—®é¢˜æ—¶ä¸å®¹æ˜“å®šä½ã€‚ç‰¹åˆ«æ˜¯æŒ‡é’ˆæ“ä½œï¼Œå¸¸è§çš„é—®é¢˜å¦‚ä¸‹ï¼š å°†é•¿ç±»å‹æ•°æ®å¼ºè½¬æˆçŸ­ç±»å‹çš„æŒ‡é’ˆè¿›è¡Œæ“ä½œ long long val = 0;void func((int *)val);...check(val);1234 ä¸Šé¢çš„ä»£ç åœ¨å¤§ç«¯æƒ…å†µä¸‹å°±å®¹æ˜“å‡ºé—®é¢˜ã€‚ä¾‹å¦‚ func é‡Œå°† val å¤„èµ‹å€¼ int ç±»å‹çš„æ•°æ® 0x1122,3344ã€‚check(val) æ—¶ï¼Œç”±äº val ä¸º 8 å­—èŠ‚çš„æ•°æ®ï¼Œæ­¤æ—¶å®é™…è¯»å–åˆ°çš„å€¼ä¸º 0x1122,3344,0000,0000ã€‚å°ç«¯åœºæ™¯åˆ™æ— æ­¤é—®é¢˜ï¼Œè¯»è€…å¯ä»¥è‡ªå·±æ€è€ƒä¸€ä¸‹ä¸ºä»€ä¹ˆã€‚ Bit numberingæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªå­—èŠ‚æœ‰ 8 ä¸ªæ¯”ç‰¹ä½ã€‚ä»ç¬¬ 0 ä½åˆ°ç¬¬ 7 ä½å…± 8 ä½ã€‚ä½åºæè¿°æ¯”ç‰¹ä½åœ¨å­—èŠ‚ä¸­çš„å­˜æ”¾é¡ºåºã€‚å¯å‚é˜… ç»´åŸºç™¾ç§‘ä¸­å…³äºä½åºçš„æè¿°ã€‚ è¿™é‡Œçš„ LSB åŠ MSB çš„ç”¨è¯ä»£è¡¨çš„æ˜¯ï¼š LSBæ˜¯æŒ‡ least significant bit MSBæ˜¯æŒ‡ most significant bit ä½åºåˆ†ä¸ºä¸¤ç§ï¼š LSB 0å­—èŠ‚çš„ç¬¬ 0 ä½å­˜æ”¾æ•°æ®çš„ least significant bitï¼Œå³æˆ‘ä»¬çš„æ•°æ®çš„æœ€ä½ä½å­˜æ”¾åœ¨å­—èŠ‚çš„ç¬¬ 0 ä½ã€‚ä»¥åè¿›åˆ¶150ä¸ºä¾‹ï¼Œ0b10010110ã€‚åœ¨LSB 0æ–¹å¼ä¸‹å­˜æ”¾å½¢å¼ä¸ºï¼š | 7 0 |---------------------------------| 1 | 0 | 0 | 1 | 0 | 1 | 1 | 0 |---------------------------------1234 Least Significant Bit First means that the least significant bit will arrive first. æ•°æ®æµä» bit0 å¼€å§‹ä¼ é€ï¼Œæ•…æ•°æ®æµå‡ºç°çš„é¡ºåºæ˜¯ 01101001ã€‚ MSB 0å­—èŠ‚çš„ç¬¬ 0 ä½å­˜æ”¾æ•°æ®çš„ most significant bitï¼Œå³æˆ‘ä»¬çš„æ•°æ®çš„æœ€é«˜ä½å­˜æ”¾åœ¨å­—èŠ‚çš„ç¬¬ 0 ä½ã€‚ä»¥åè¿›åˆ¶150ä¸ºä¾‹ï¼Œ0b10010110ã€‚åœ¨MSB 0æ–¹å¼ä¸‹å­˜æ”¾å½¢å¼ä¸ºï¼š | 7 0 |---------------------------------| 0 | 1 | 1 | 0 | 1 | 0 | 0 | 1 |---------------------------------1234 Most Significant Bit First means that the most significant bit will arrive first. ä¹Ÿå°±æ˜¯è¯´æ•°æ®æµå‡ºç°çš„é¡ºåºæ˜¯ 10010110ã€‚ å®é™…æœºå™¨ç±»å‹å­—èŠ‚åºæ˜¯å°ç«¯çš„ CPU é€šå¸¸å…¶ä½åºä¸º LSB 0ã€‚æ•°æ®ä¸ä»…åœ¨å†…å­˜ä¸­æ˜¯â€œé«˜é«˜ä½ä½â€å­˜æ”¾ï¼Œå…¶ä½åºä¹Ÿæ˜¯â€œé«˜é«˜ä½ä½â€æ”¾ç½®çš„ï¼Œå³ msb æ”¾åœ¨ bit7 ä½ç½®ä¸Šï¼Œlsb æ”¾ç½®åœ¨ bit0 ä½ç½®ä¸Šã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå­—èŠ‚åºæ˜¯å¤§ç«¯çš„ CPU é‡‡ç”¨çš„ä½åºå´ä¸æ˜¯é‚£ä¹ˆç»Ÿä¸€ï¼Œæ—¢æœ‰ MSB 0ï¼Œä¹Ÿè¦ LSB 0 çš„æœºå™¨ã€‚ Bit order usually follows the same endianness as the byte order for a given computer system. That is, in a big endian system the most significant bit is stored at the lowest bit address; in a little endian system, the least significant bit is stored at the lowest bit address. å¦‚æœæˆ‘ä»¬è¦è¡¨ç¤ºä¸€ä¸ªæ•´æ•° 0xabcdã€‚ Write Integer for Big Endian System byte addr 0 1 2 3bit offset 01234567 01234567 01234567 01234567 binary 00001010 00001011 00001100 00001101 hex 0a 0b 0c 0d1234 Write Integer for Little Endian System byte addr 3 2 1 0bit offset 76543210 76543210 76543210 76543210 binary 00001010 00001011 00001100 00001101 hex 0a 0b 0c 0d1234 ä½åŸŸ Bit Fields For big-endian mode, bit fields are packed into registers from most significant bit (MSB) to least significant bit (LSB) in the order in which they are defined. Bit fields are packed in memory from most significant byte (MSbyte) to least significant byte (LSbyte).For little-endian mode, bit fields are packed into registers from the LSB to the MSB in the order in which they are defined, and packed in memory from LSbyte to MSbyte. å¤§å°ç«¯å¯¹ä½åŸŸæ‰“åŒ…æ–¹å¼çš„å½±å“ å¤§ç«¯åœºæ™¯ä¸‹æ ¹æ®å®šä¹‰çš„é¡ºåºï¼Œä» MSB å¼€å§‹æ’å¸ƒåˆ° LSBã€‚å°ç«¯åœºæ™¯ä¸‹æ ¹æ®å®šä¹‰çš„é¡ºåºï¼Œä» LSB å¼€å§‹æ’å¸ƒåˆ° MSBã€‚ ä½åŸŸçš„ç±»å‹å¯ä»¥æ˜¯ unsigned signed åŒ…å«ä½åŸŸçš„ç»“æ„ä½“çš„å¤§å°å’Œå¯¹é½å€¼å–å†³äºå®šä¹‰ä½åŸŸæ‰€ä½¿ç”¨çš„æ•°æ®ç±»å‹å¦‚ struct st { int a:4 }; è¯¥ç»“æ„ä½“çš„å¤§å°ä¸º4ï¼Œå¯¹é½å€¼ä¸º4ã€‚ æ— åä½åŸŸä¼šå½±å“ç»“æ„ä½“æˆ–è”åˆä½“çš„å¤§å°å’Œå¯¹é½å€¼å¦‚ struct st { char a:4; int :22; }; è¯¥ç»“æ„ä½“çš„å¤§å°ä¸º4ï¼Œå¯¹é½å€¼ä¸º4ã€‚ struct int A:7;\tint B:10;\tint C:3;\tint D:2;\tint E:9; x;1234567 LEGEND: X = not used, MS = most significant, LS = least significantBig-endian register MS LSA A\tA A\tA A\tA B\tB B\tB B\tB B\tB B\tB C\tC C\tD D\tE E\tE E\tE E\tE E\tE X6 5\t4 3\t2 1\t0 9 8 7 6 5\t4 3\t2 1\t0 2\t1 0\t1 0\t8 7 6 5\t4 3\t2 1\t0 X31 0Big-endian memory Byte 0 Byte 1 Byte 2 Byte 3A A\tA A A A A B B B B B B B B B B C C C D D E E E E\tE E\tE E\tE X6 5\t4 3\t2 1\t0 9\t8 7\t6 5\t4 3\t2 1\t0 2\t1 0\t1 0\t8 7\t6 5\t4 3\t2 1\t0 XLittle-endian register MS LSX E\tE E\tE E\tE E\tE E\tD D\tC C\tC B\tB B\tB B\tB B\tB B\tB A\tA A\tA A\tA AX 8\t7 6\t5 4\t3 2\t1 0\t1 0\t2 1\t0 9\t8 7\t6 5\t4 3\t2 1\t0 6\t5 4\t3 2\t1 031 0Little-endian memory Byte 0 Byte 1 Byte 2 Byte 3B A\tA A\tA A\tA A\tB B\tB B\tB B\tB B\tE E\tD D\tC C\tC B\tX E\tE E\tE E\tE E0 6\t5 4\t3 2\t1 0\t8 7\t6 5\t4 3\t2 1\t1 0\t1 0\t2 1\t0 9\tX 8\t7 6\t5 4\t3 21234567891011121314151617181920212223 ä»¥ä¸‹é¢çš„æ•°æ®ç±»å‹ä¸ºä¾‹ã€‚ union unsigned short value;\tunsigned char byte[2];\tstruct unsigned short one : 1; unsigned short two : 2; unsigned short three : 3; unsigned short four : 4; unsigned short five : 5; field; u;1234567891011 å…¶æ’å¸ƒä¸ºï¼šå¤§ç«¯åœºæ™¯ å°ç«¯åœºæ™¯ å¯ä»¥é€šè¿‡ä¸‹é¢çš„ç¨‹åºæ¥éªŒè¯ä¸€ä¸‹ã€‚ #include stdio.hint main() union unsigned short value; unsigned char byte[2]; struct unsigned short one : 1; unsigned short two : 2; unsigned short three : 3; unsigned short four : 4; unsigned short five : 5; field; u;\tu.value = 0;\tu.field.one = 1;\tu.field.two = 2;\tu.field.three = 3;\tu.field.four = 4;\tu.field.five = 5;\tprintf(The fields are 1, 2, 3, 4, 5. );\tprintf(The entire hex value is 0x%04x , u.value);\tprintf(The first byte is 0x%02x , u.byte[0]);\tprintf(The second byte is 0x%02x , u.byte[1]);\treturn 0;1234567891011121314151617181920212223242526272829 åœ¨ x86 å°ç«¯ï¼Œarmï¼Œaarch64 å¤§å°ç«¯åœºæ™¯ä¸‹çš„æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š // x86 å°ç«¯The fields are 1, 2, 3, 4, 5.The entire hex value is 0x151dThe first byte is 0x1dThe second byte is 0x15// aarch64_beThe fields are 1, 2, 3, 4, 5.The entire hex value is 0xcd0aThe first byte is 0xcdThe second byte is 0x0a// armebThe fields are 1, 2, 3, 4, 5.The entire hex value is 0xcd0aThe first byte is 0xcdThe second byte is 0x0a// armThe fields are 1, 2, 3, 4, 5.The entire hex value is 0x151dThe first byte is 0x1dThe second byte is 0x15// aarch64The fields are 1, 2, 3, 4, 5.The entire hex value is 0x151dThe first byte is 0x1dThe second byte is 0x15 å­—èŠ‚åºæµ‹è¯•#include stdio.hint main() union char c; int i; u; u.i = 0x11223344; if(u.c == 0x44) printf(little-endian ); else if (u.c == 0x11) printf(big-endian ); else printf(unknown ); return 0;123456789101112131415161718 ä½åºæµ‹è¯•union struct unsigned char a1:2; unsigned char a2:3; unsigned char a3:3; x;\tunsigned char b; d;int main (void)\td.b = 150;\tprintf(0x%x 0x%x 0x%x , d.x.a1, d.x.a2, d.x.a3); return 0;123456789101112131415 ç»“æœå¦‚ä¸‹ï¼š // 150 == 0b1001 0110arm, aarch64/* bit numbering: lsb 0 * 0x2 ï¼ˆ== 10ï¼‰ * 0x5 ï¼ˆ== 101ï¼‰ * 0x4 ï¼ˆ== 110ï¼‰ * /armeb, aarch64_be/* bit numbering: lsb 0 * 0x2 ï¼ˆ== 10ï¼‰ * 0x2 ï¼ˆ== 010ï¼‰ * 0x6 ï¼ˆ== 100ï¼‰ * /123456789101112131415","tags":["clippings"],"categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","ä½è¿ç®—"]},{"title":"é¢å‘å¯¹è±¡åŸºç¡€","path":"/2025/01/10/2-ç¼–ç¨‹è¯­è¨€-ç»“æ„ç®—æ³•-é¢å‘å¯¹è±¡åŸºç¡€/","content":"ç±»ä¸å®ä¾‹å¯¹è±¡æ˜¯ä¸€ä¸ªè‡ªåŒ…å«çš„å®ä½“ï¼Œç”¨ä¸€ç»„å¯è¯†åˆ«çš„ç‰¹æ€§å’Œè¡Œä¸ºæ¥æ ‡è¯†ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå…·æœ‰â€œåç§°â€ã€â€œå¹´é¾„â€å’Œâ€œé¢œè‰²â€å±æ€§çš„çŒ«å¯è¢«è§†ä¸ºå¯¹è±¡ã€‚ ç±»æ˜¯æŒ‡å…·æœ‰ç›¸åŒå±æ€§å’ŒåŠŸèƒ½çš„å¯¹è±¡çš„æŠ½è±¡é›†åˆã€‚å®ƒå®šä¹‰äº†å¯¹è±¡çš„ç‰¹æ€§ï¼ˆå±æ€§ï¼‰å’Œå¯èƒ½æ‰§è¡Œçš„æ“ä½œï¼ˆæ–¹æ³•ï¼‰ã€‚ç±»çš„å®šä¹‰é€šå¸¸ä½¿ç”¨ class å…³é”®å­—ã€‚ ç±»çš„åç§°é€šå¸¸ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œå¤šä¸ªå•è¯æ—¶é‡‡ç”¨é©¼å³°å¼å‘½åæ³•ï¼ˆä¾‹å¦‚ï¼ŒAnimal æˆ– DogHouseï¼‰ã€‚ å¯¹å¤–å…¬å¼€çš„æ–¹æ³•éœ€è¦ä½¿ç”¨ public ä¿®é¥°ç¬¦ï¼Œä»¥ä¾¿å…è®¸å…¶ä»–ç±»è®¿é—®ã€‚ å®ä¾‹æ˜¯ä¸€ç§çœŸå®çš„å¯¹è±¡ï¼Œå®ä¾‹åŒ–æ˜¯åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ã€‚ä½¿ç”¨ new å…³é”®å­—å¯ä»¥åˆ›å»ºç±»çš„å®ä¾‹ã€‚ä¾‹å¦‚ï¼ŒCat myCat = new Cat(); ä¾¿æ˜¯åˆ›å»ºä¸€ä¸ª Cat ç±»çš„å®ä¾‹ã€‚ public ä¿®é¥°ç¬¦æ„å‘³ç€è¯¥ç±»æˆå‘˜å¯ä»¥è¢«ä»»ä½•å…¶ä»–ç±»è®¿é—®ã€‚ private ä¿®é¥°ç¬¦åˆ™è¡¨ç¤ºæˆå‘˜åªèƒ½åœ¨æœ¬ç±»ä¸­è®¿é—®ï¼Œå…¶ä»–ç±»åŒ…æ‹¬å­ç±»éƒ½æ— æ³•è®¿é—®ã€‚è‹¥ç±»çš„æˆå‘˜æ²¡æœ‰æŒ‡å®šä¿®é¥°ç¬¦ï¼Œåˆ™é»˜è®¤ä¸º privateã€‚é€šå¸¸é‡‡ç”¨å¤§å†™å­—æ¯å¼€å¤´çš„å‘½åçº¦å®šæ¥å®šä¹‰å±æ€§ï¼ˆAgeï¼‰ï¼Œè€Œå­—æ®µåˆ™é€šå¸¸ä»¥å°å†™å­—æ¯å¼€å¤´æˆ–å‰åŠ ä¸‹åˆ’çº¿ï¼ˆ_ageï¼‰ã€‚ æ„é€ æ–¹æ³•æ„é€ æ–¹æ³•ï¼Œä¹Ÿç§°ä¸ºæ„é€ å‡½æ•°ï¼Œæ˜¯ç”¨äºåˆå§‹åŒ–ç±»çš„ç‰¹æ®Šæ–¹æ³•ã€‚æ„é€ æ–¹æ³•çš„åç§°ä¸ç±»åç›¸åŒï¼Œä¸”æ²¡æœ‰è¿”å›å€¼ï¼Œè°ƒç”¨æ—¶ä¸éœ€è¦æŒ‡å®š voidã€‚ æ‰€æœ‰ç±»éƒ½æœ‰æ„é€ æ–¹æ³•ã€‚è‹¥æ²¡æœ‰æ˜¾å¼å®šä¹‰æ„é€ æ–¹æ³•ï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤æ„é€ æ–¹æ³•ã€‚å¦‚æœå®šä¹‰äº†è‡ªå®šä¹‰æ„é€ æ–¹æ³•ï¼Œåˆ™é»˜è®¤æ„é€ æ–¹æ³•å°†å¤±æ•ˆã€‚ ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ª Car ç±»ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰æ„é€ æ–¹æ³•ï¼Œåˆ™ç³»ç»Ÿå°†ä¼šè‡ªåŠ¨æä¾›ä¸€ä¸ªé»˜è®¤æ„é€ æ–¹æ³•ã€‚è‹¥éœ€è¦ç‰¹å®šçš„åˆå§‹åŒ–è¡Œä¸ºï¼Œåˆ™å¯è‡ªå®šä¹‰æ„é€ æ–¹æ³•ï¼Œå¦‚ï¼š class Car public: Car(string color) this-color = color; private: string color;; æ–¹æ³•é‡è½½æ–¹æ³•é‡è½½å…è®¸åœ¨åŒä¸€ä¸ªç±»ä¸­åˆ›å»ºå¤šä¸ªåŒåæ–¹æ³•ï¼Œä½†å®ƒä»¬å¿…é¡»å…·æœ‰ä¸åŒçš„å‚æ•°ç±»å‹æˆ–æ•°é‡ã€‚è¿™ç§ç‰¹æ€§å¢åŠ äº†å‡½æ•°çš„çµæ´»æ€§å’Œå¯è¯»æ€§ã€‚ æ–¹æ³•é‡è½½ä½¿å¾—ä¸éœ€è¦æ”¹å˜æ–¹æ³•åç§°ä¾¿èƒ½å¼•å…¥æ–°åŠŸèƒ½ï¼Œä¾¿äºå¯¹å¤–æ¥å£çš„ç»´æŠ¤ä¸æ‹“å±•ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½æœ‰ä¸€ä¸ª CalculateArea æ–¹æ³•ï¼Œå¯ä»¥æ ¹æ®è¾“å…¥å‚æ•°çš„ä¸åŒï¼Œé‡è½½ä¸ºï¼š double CalculateArea(int radius); // è®¡ç®—åœ†çš„é¢ç§¯double CalculateArea(double length, double width); // è®¡ç®—çŸ©å½¢çš„é¢ç§¯ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¿æŒæ–¹æ³•åä¸€è‡´ä½¿å¾—ç†è§£å˜å¾—ç®€å•ã€‚ å±æ€§å±æ€§çš„å®šä¹‰æ˜¯ä¸ºäº†ç®€åŒ–å­—æ®µçš„è®¿é—®ï¼Œæä¾›äº†ä¸€ç»„æ–¹æ³•ä»¥ä¾¿æ§åˆ¶å¯¹ç±»å†…å­—æ®µçš„è®¿é—®ã€‚å˜é‡ç§æœ‰çš„ç§°ä¸ºå­—æ®µï¼Œå…¬å¼€çš„åˆ™ç§°ä¸ºå±æ€§ã€‚ å±æ€§é€šå¸¸ç”±ä¸¤ä¸ªè®¿é—®å™¨æ–¹æ³•ç»„æˆï¼šget å’Œ setã€‚get è®¿é—®å™¨è¿”å›ä¸å£°æ˜çš„å±æ€§ç›¸åŒçš„æ•°æ®ç±»å‹ï¼Œå…è®¸é€šè¿‡å®ƒè·å–å­—æ®µçš„å€¼ã€‚ set è®¿é—®å™¨åˆ™åŒ…å«ä¸€ä¸ªéšå¼å‚æ•° valueï¼Œå¯ä»¥å°†å€¼èµ‹ç»™å­—æ®µã€‚ä¾‹å¦‚ï¼š private int age;public int Age get return age; set age = value; åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¯ä»¥é€šè¿‡ myCat.Age è®¿é—®å’Œä¿®æ”¹ age å±æ€§ï¼Œè€Œæ— éœ€ç›´æ¥æ“ä½œç§æœ‰å­—æ®µã€‚ å°è£…å°è£…æ˜¯æŒ‡æ¯ä¸ªå¯¹è±¡å°†å®ƒæ“ä½œæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯å°è£…åœ¨ä¸€èµ·ï¼Œä»è€Œæ— éœ€ä¾èµ–å¤–éƒ¨å› ç´ æ¥æ‰§è¡Œæ“ä½œã€‚è‰¯å¥½çš„å°è£…èƒ½å¤Ÿå‡å°‘è€¦åˆï¼Œè®©ç±»çš„å†…éƒ¨å®ç°å¯ä»¥è‡ªç”±æ›´æ”¹ï¼ŒåŒæ—¶å¤–éƒ¨è°ƒç”¨æ¥å£ä¿æŒä¸å˜ã€‚ ä¸€ä¸ªå®é™…ä¾‹å­æ˜¯ï¼Œä¸€ä¸ªæ™ºèƒ½æ‰‹æœºåº”ç”¨é‡Œç”¨æˆ·ä¿¡æ¯çš„ç®¡ç†ã€‚åº”ç”¨å¯ä»¥æä¾›æ–¹æ³•æ¥è·å–å’Œæ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼Œä½†å…¶å†…éƒ¨å¦‚ä½•å­˜å‚¨å’Œå¤„ç†è¿™äº›ä¿¡æ¯åˆ™å¯¹ç”¨æˆ·ä¿æŒéšè—ï¼Œä»è€Œç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚ ç»§æ‰¿ç»§æ‰¿æ˜¯æŒ‡å¯¹è±¡ä¹‹é—´ä¸€ç§ is-a çš„å…³ç³»ã€‚è‹¥å¯¹è±¡ A å’Œå¯¹è±¡ B çš„å…³ç³»å¯ä»¥æè¿°ä¸º B æ˜¯ Aï¼Œé‚£ä¹ˆ B å°±èƒ½ç»§æ‰¿ Aã€‚ç»§æ‰¿ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯åœ¨è¢«ç»§æ‰¿è€…çš„åŸºç¡€ä¸Šå¯¹å…¶è¿›è¡ŒæŸç§ç¨‹åº¦çš„ç‰¹æ®ŠåŒ–ã€‚ ç»§æ‰¿å…è®¸ç±»ä¹‹é—´å…±äº«ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®šä¹‰äº†ä¸€ä¸ª Animal åŸºç±»ï¼ŒDog å’Œ Cat å°±å¯ä»¥ä½œä¸ºå…¶å­ç±»ï¼Œç»§æ‰¿ Animal ç±»çš„ç‰¹æ€§ï¼Œå¦‚ Age å’Œ Soundï¼Œä¸”è¿˜å¯ä»¥å®šä¹‰å„è‡ªç‹¬æœ‰çš„ç‰¹æ€§ã€‚ å­ç±»ç»§æ‰¿çˆ¶ç±»çš„é private å±æ€§å’ŒåŠŸèƒ½ï¼Œå…·æœ‰è‡ªå·±çš„å±æ€§å’ŒåŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥å®ç°æ–¹æ³•çš„é‡å†™ã€‚ä¾‹å¦‚ï¼š class Dog : Animal public: void Bark() Console.WriteLine(Woof!); éœ€è¦æ³¨æ„ï¼Œè™½ç„¶ç»§æ‰¿å¸¦æ¥ä»£ç çš„é‡ç”¨æ€§ï¼Œä½†çˆ¶ç±»çš„å˜æ›´å¯èƒ½ä¼šå½±å“å­ç±»ï¼Œå¯¼è‡´ç±»ä¹‹é—´çš„è€¦åˆæ€§å¢åŠ ã€‚ å¤šæ€å¤šæ€æ˜¯æŒ‡ä¸åŒç±»å‹çš„å¯¹è±¡å¯ä»¥æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œä½†å®ƒä»¬çš„å…·ä½“å®ç°æ˜¯ç”±å„è‡ªçš„ä»£ç æ¥å†³å®šçš„ã€‚è¿™ç§ç‰¹æ€§ä½¿å¾—ç¼–ç¨‹æ›´åŠ çµæ´»å’Œå¯æ‰©å±•ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåŠ¨ç‰©ç±»çš„ speak æ–¹æ³•å¯ä»¥åœ¨çŒ«ç±»å’Œç‹—ç±»ä¸­æœ‰ä¸åŒçš„å®ç°ï¼ŒçŒ«ç±»å¯èƒ½è¾“å‡ºâ€œå–µâ€ï¼Œè€Œç‹—ç±»åˆ™è¾“å‡ºâ€œæ±ªâ€ã€‚å°½ç®¡ä¸¤è€…éƒ½è°ƒç”¨äº† speak æ–¹æ³•ï¼Œå¾—åˆ°çš„ç»“æœå´æ˜¯å®Œå…¨ä¸åŒçš„ã€‚ åœ¨å¤šæ€çš„å®ç°ä¸­ï¼Œå­ç±»å¯ä»¥è¢«è§†ä¸ºå…¶çˆ¶ç±»çš„å®ä¾‹ã€‚ç„¶è€Œï¼Œå­ç±»ç‹¬æœ‰çš„å±æ€§å’Œæ–¹æ³•åœ¨çˆ¶ç±»çš„ä¸Šä¸‹æ–‡ä¸­æ˜¯ä¸å¯ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œå½“å‡ºç°ä¸€ä¸ª Animal ç±»å‹çš„å˜é‡æ—¶ï¼Œå¯ä»¥èµ‹å€¼ä¸º Cat æˆ– Dog çš„å®ä¾‹ï¼Œä½†æ— æ³•ç›´æ¥è®¿é—® Cat æˆ– Dog ä¸­ç‹¬æœ‰çš„æ–¹æ³•ï¼Œå¦‚ Cat çš„ chaseMouseã€‚ è™šæ–¹æ³•ä¸ºäº†è®©å­ç±»èƒ½å¤Ÿå®Œå…¨æ¥ç®¡çˆ¶ç±»çš„æˆå‘˜ï¼Œçˆ¶ç±»ä¸­çš„æˆå‘˜éœ€è¦è¢«å£°æ˜ä¸ºè™šæ‹Ÿã€‚è¿™æ˜¯é€šè¿‡åœ¨æ–¹æ³•å‰æ·»åŠ  virtual å…³é”®å­—æ¥å®ç°çš„ã€‚è™šæ‹Ÿæ–¹æ³•å¯ä»¥æœ‰æ–¹æ³•ä½“ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥åŒ…å«æ‰§è¡Œçš„å…·ä½“ä»£ç ã€‚å¯ä»¥è€ƒè™‘ä¸€ä¸ª Shape ç±»ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª Draw æ–¹æ³•è¢«å®šä¹‰ä¸ºè™šæ‹Ÿçš„ï¼Œå…·ä½“çš„å›¾å½¢ç±»å¦‚ Circle å’Œ Square å¯ä»¥å„è‡ªå®ç°ä¸åŒçš„ç»˜åˆ¶æ–¹å¼ã€‚ å°½ç®¡å­—æ®µä¸èƒ½æ˜¯è™šæ‹Ÿçš„ï¼Œä½†å±æ€§ã€äº‹ä»¶å’Œç´¢å¼•å™¨éƒ½æ˜¯å¯ä»¥å£°æ˜ä¸ºè™šæ‹Ÿçš„ã€‚è¿™æ ·ï¼Œå­ç±»å°±å¯ä»¥æä¾›è‡ªå·±çš„å®ç°ï¼Œä»è€Œå¢å¼ºäº†çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚ æ–¹æ³•é‡å†™å­ç±»èƒ½å¤Ÿé€‰æ‹©ä½¿ç”¨ override å…³é”®å­—æ¥æ›¿æ¢çˆ¶ç±»çš„å®ç°ã€‚è¿™æ„å‘³ç€ï¼Œå³ä¾¿çˆ¶ç±»å®šä¹‰äº†æŸä¸ªæ–¹æ³•ï¼Œå­ç±»å¯ä»¥æ ¹æ®éœ€æ±‚æä¾›ä¸€ä¸ªæ–°çš„å®ç°ã€‚ä¾‹å¦‚ï¼Œçˆ¶ç±» Animal æœ‰ä¸€ä¸ª MakeSound æ–¹æ³•ï¼Œå­ç±» Cat å¯ä»¥é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œä½¿å…¶è¾“å‡ºâ€œå–µâ€ã€‚è¿™æ ·ï¼Œåœ¨è°ƒç”¨ MakeSound æ–¹æ³•æ—¶ï¼Œå…·ä½“çš„å®ç°ä¼šä¾æ®å¯¹è±¡çš„å®é™…ç±»å‹ã€‚ åœ¨å¤šæ€çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå½“æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå³ä½¿å¯¹è±¡è¢«è½¬æ¢ä¸ºçˆ¶ç±»ç±»å‹ï¼Œä¹Ÿåªæœ‰ç»§æ‰¿é“¾ä¸­æœ€æœ«ç«¯ï¼ˆå­ç±»ï¼‰çš„æ–¹æ³•å®ç°ä¼šè¢«è°ƒç”¨ã€‚è¿™ä½“ç°äº†è™šæ–¹æ³•åœ¨è¿è¡Œæ—¶ç±»å‹ï¼ˆè€Œéç¼–è¯‘æ—¶ç±»å‹ï¼‰ä¸Šçš„åŠ¨æ€ç»‘å®šç‰¹æ€§ã€‚ é‡æ„ä»€ä¹ˆæ˜¯é‡æ„é‡æ„æ˜¯æ”¹å–„å·²æœ‰ä»£ç è®¾è®¡çš„ä¸€ç§æ–¹æ³•ã€‚ç›®æ ‡æ˜¯å¢å¼ºä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ŒåŒæ—¶ä¸æ”¹å˜å…¶å¤–éƒ¨è¡Œä¸ºã€‚é€šè¿‡é‡æ„ï¼Œä»£ç çš„ç»“æ„å¯ä»¥å˜å¾—æ›´åŠ æ¸…æ™°ï¼Œä½¿åç»­çš„å¼€å‘å’Œç»´æŠ¤å·¥ä½œæ›´åŠ é«˜æ•ˆã€‚ ä»€ä¹ˆæ˜¯æ•æ·å¼€å‘æ•æ·å¼€å‘æ˜¯ä¸€ç§çµæ´»çš„è½¯ä»¶å¼€å‘æ–¹æ³•è®ºï¼Œå¼ºè°ƒé€šè¿‡å¿«é€Ÿè¿­ä»£å’ŒæŒç»­åé¦ˆæ¥æ»¡è¶³å®¢æˆ·éœ€æ±‚ã€‚å®ƒé‡è§†å›¢é˜Ÿä¹‹é—´çš„åä½œä»¥åŠé€‚åº”å˜åŒ–çš„èƒ½åŠ›ã€‚é‡æ„å¸¸å¸¸åœ¨æ•æ·å¼€å‘è¿‡ç¨‹ä¸­è¢«ä½œä¸ºä¸€ç§å®è·µï¼Œç”¨äºæ”¹å–„å’Œé€‚åº”ä¸æ–­å˜åŒ–çš„éœ€æ±‚ã€‚ æŠ½è±¡ç±»å’Œæ¥å£æŠ½è±¡ç±»ä¸æ¥å£çš„åŒºåˆ«æŠ½è±¡ç±»å¯ä»¥å®ç°æŸäº›æˆå‘˜çš„æ–¹æ³•ï¼Œè€Œæ¥å£åˆ™ä¸åŒ…å«ä»»ä½•å®ç°ã€‚æŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æˆå‘˜å¯ä»¥è¢«å­ç±»éƒ¨åˆ†å®ç°ï¼Œè€Œæ¥å£çš„æˆå‘˜å¿…é¡»è¢«å®ç°ç±»å®Œå…¨å®ç°ã€‚æ­¤å¤–ï¼Œä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä½†å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚åœ¨è®¾è®¡ä¸­ï¼Œç±»æ˜¯å¯¹å¯¹è±¡çš„æŠ½è±¡ï¼ŒæŠ½è±¡ç±»æ˜¯å¯¹ç±»çš„æŠ½è±¡ï¼Œæ¥å£åˆ™æ˜¯å¯¹è¡Œä¸ºçš„æŠ½è±¡æè¿°ã€‚ åœ¨é€‰æ‹©ä½¿ç”¨æ¥å£æˆ–æŠ½è±¡ç±»æ—¶ï¼Œå¦‚æœéœ€è¦è·¨è¶Šä¸åŒç±»çš„å¯¹è±¡ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ¥å£ï¼›å¯¹äºä¸€äº›ç›¸ä¼¼çš„ç±»å¯¹è±¡ï¼Œç»§æ‰¿æŠ½è±¡ç±»åˆ™æ›´åŠ åˆé€‚ã€‚æŠ½è±¡ç±»ä»å­ç±»ä¸­å‘ç°äº†å…¬å…±ç‰¹æ€§å¹¶æ³›åŒ–å‡ºçˆ¶ç±»ï¼Œæ¥å£åˆ™æ˜¯åœ¨æ–¹æ³•å®ç°ä¸Šä¿æŒä¸ç¡®å®šæ€§ï¼Œä»…é€šè¿‡é¢„å®šä¹‰çš„æ–¹æ³•å£°æ˜æ¥ä¿ƒè¿›å®ç°ã€‚ æŠ½è±¡ç±»åœ¨ç±»çš„å®ä¾‹åŒ–æ²¡æœ‰æ„ä¹‰çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å°†ç±»å’Œæ–¹æ³•å£°æ˜ä¸ºæŠ½è±¡ï¼Œå³å®ƒä»¬è¢«å®šä¹‰ä¸º abstractã€‚æŠ½è±¡ç±»ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼ŒæŠ½è±¡æ–¹æ³•å¿…é¡»è¢«å­ç±»å®ç°ã€‚å¦‚æœä¸€ä¸ªç±»ä¸­åŒ…å«æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥ç±»å¿…é¡»è¢«æ ‡è¯†ä¸ºæŠ½è±¡ç±»ã€‚ è®¾è®¡æŠ½è±¡ç±»æ—¶ï¼Œåº”å°½å¯èƒ½åœ°é›†ä¸­å…±åŒçš„ä»£ç ï¼Œå¹¶å‡å°‘ä¸å¿…è¦çš„æ•°æ®ã€‚æŠ½è±¡ç±»é€šå¸¸ä»£è¡¨ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œä¸ºç±»çš„ç»§æ‰¿æä¾›åŸºç¡€ã€‚åœ¨ä¸€ä¸ªç»§æ‰¿ç»“æ„ä¸­ï¼Œæœ«ç«¯çš„å¶å­èŠ‚ç‚¹åº”ä¸ºå…·ä½“ç±»ï¼Œè€Œæ ‘æèŠ‚ç‚¹åˆ™åº”ä¸ºæŠ½è±¡ç±»ã€‚ æ¥å£æ¥å£æ˜¯ä¸€ç§ç»„åˆéšå¼å…¬å…±æ–¹æ³•å’Œå±æ€§çš„é›†åˆï¼Œç”¨äºå°è£…ç‰¹å®šåŠŸèƒ½ã€‚å®ç°æ¥å£çš„ç±»å¿…é¡»æ¶µç›–æ¥å£ä¸­æ‰€æœ‰çš„æ–¹æ³•å’Œå±æ€§ã€‚æ¥å£çš„å®šä¹‰åœ¨è¯­æ³•ä¸Šä¸æŠ½è±¡ç±»ç›¸ä¼¼ï¼Œä½†ä¸èƒ½æä¾›å…·ä½“çš„å®ç°ï¼Œæ„å‘³ç€æ¥å£æ— æ³•è¢«å®ä¾‹åŒ–ï¼Œä¹Ÿä¸å¾—åŒ…å«æ„é€ æ–¹æ³•å’Œå­—æ®µã€‚ å®ç°æ¥å£çš„ç±»å¿…é¡»å®ç°æ‰€æœ‰æ¥å£æ–¹æ³•ï¼Œå¤šä¸ªç±»å¯ä»¥å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œæ¥å£çš„å‘½åé€šå¸¸ä»¥å¤§å†™å­—æ¯ I å¼€å¤´ã€‚å£°æ˜æ¥å£æ—¶ä½¿ç”¨ interface å…³é”®è¯ï¼Œæ¥å£ä¸­çš„æ–¹æ³•å’Œå±æ€§ä¸åº”åŒ…å«ä»»ä½•ä¿®é¥°ç¬¦ï¼Œæ–¹æ³•ä½“ä¹Ÿä¸è¢«å…è®¸ã€‚è¿™ç§æ¸…æ™°çš„ç»“æ„ä½¿å¾—æ¥å£åœ¨è®¾è®¡å¯æ‰©å±•æ€§å’Œçµæ´»æ€§æ—¶æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚ æ³›å‹æ³›å‹æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ç‰¹æ€§ï¼Œå®ƒå…è®¸åœ¨å®šä¹‰ç±»ã€ç»“æ„ã€æ¥å£å’Œæ–¹æ³•æ—¶ä½¿ç”¨å ä½ç¬¦ï¼Œè¿™äº›å ä½ç¬¦é€šå¸¸è¢«ç§°ä¸ºç±»å‹å‚æ•°ã€‚é€šè¿‡ç±»å‹å‚æ•°ï¼Œå¼€å‘è€…èƒ½å¤Ÿå®šä¹‰é€šç”¨çš„ç®—æ³•å’Œæ•°æ®ç»“æ„ï¼Œè¿™äº›ç®—æ³•å’Œæ•°æ®ç»“æ„å¯ä»¥å¤„ç†ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œè€Œæ— éœ€åœ¨æ¯ç§æƒ…å†µä¸‹éƒ½é‡æ–°ç¼–å†™ä»£ç ã€‚ åœ¨æ³›å‹çš„å®ç°ä¸­ï¼Œå¼€å‘è€…å¯ä»¥æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªç±»å‹å‚æ•°ã€‚ä¾‹å¦‚ï¼Œç±»æˆ–æ–¹æ³•å£°æ˜ä¸­é€šå¸¸ä¼šä½¿ç”¨å¦‚ä¸‹è¯­æ³•ï¼š class GenericClassT T field; public void SetField(T value) field = value; public T GetField() return field; åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒGenericClassT å®šä¹‰äº†ä¸€ä¸ªæ³›å‹ç±»ï¼Œå…¶ä¸­çš„ T æ˜¯ç±»å‹å‚æ•°ã€‚è¿™ä¸ªç±»å‹å‚æ•°å¯ä»¥åœ¨ä½¿ç”¨æ—¶è¢«æ›¿æ¢ä¸ºä»»ä½•å…·ä½“ç±»å‹ï¼Œä¾‹å¦‚ intã€string æˆ–è€…ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ã€‚å½“åˆ›å»º GenericClassint å®ä¾‹æ—¶ï¼ŒT ä¼šè¢«æ›¿æ¢ä¸º intï¼Œè¿™æ„å‘³ç€æ­¤ç±»ä¼šä¸“é—¨å­˜å‚¨æ•´æ•°ç±»å‹çš„å€¼ã€‚ æ³›å‹é›†åˆç±»æ˜¯æ³›å‹çš„ä¸€ä¸ªé‡è¦åº”ç”¨ï¼Œå…è®¸å­˜å‚¨ç‰¹å®šç±»å‹çš„å¯¹è±¡è€Œæ— éœ€è½¬æ¢æˆ–å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ä¾‹å¦‚ï¼Œåœ¨ C#ä¸­ï¼ŒListT å°±æ˜¯ä¸€ä¸ªæ³›å‹é›†åˆç±»ï¼Œå®ƒå¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„å…ƒç´ ã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ³›å‹é›†åˆç±»ï¼š Liststring stringList = new Liststring();stringList.Add(Hello);stringList.Add(World); åœ¨è¿™é‡Œï¼ŒListstring è¡¨ç¤ºä¸€ä¸ªä¸“é—¨å­˜å‚¨å­—ç¬¦ä¸²çš„åˆ—è¡¨ã€‚ä½¿ç”¨æ³›å‹é›†åˆç±»çš„å¥½å¤„åœ¨äºç±»å‹å®‰å…¨æ€§ï¼Œå¼€å‘è€…ä¸éœ€æ‹…å¿ƒå› ç±»å‹ä¸åŒ¹é…è€Œå¯¼è‡´çš„è¿è¡Œæ—¶é”™è¯¯ã€‚ ç±»å‹å‚æ•°åœ¨æ³›å‹ä¸­åŒæ—¶ç”¨äºå®šä¹‰å­—æ®µå’Œæ–¹æ³•çš„å‚æ•°ç±»å‹ï¼Œè¿™ä½¿å¾—ä»£ç æ›´åŠ çµæ´»ã€‚ä¾‹å¦‚ï¼Œæ³›å‹æ–¹æ³•çš„å®šä¹‰å¯ä»¥å¦‚ä¸‹æ‰€ç¤ºï¼š public void PrintValueT(T value) Console.WriteLine(value.ToString()); åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPrintValueT æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œå…¶æ¥å—å‚æ•° value çš„å…·ä½“ç±»å‹åœ¨è°ƒç”¨æ—¶ç¡®å®šã€‚è¿™ç§æ–¹å¼ä½¿å¾—æ–¹æ³•èƒ½å¤Ÿæ¥å—å„ç§ç±»å‹çš„è¾“å…¥ï¼Œè€Œæ— é¡»ä¸ºä¸åŒçš„ç±»å‹ç¼–å†™å¤šä¸ªé‡è½½ç‰ˆæœ¬ã€‚ é€šè¿‡ä½¿ç”¨æ³›å‹ï¼Œå¼€å‘è€…å¯ä»¥åœ¨æé«˜ä»£ç å¤ç”¨æ€§çš„åŒæ—¶ï¼Œç¡®ä¿ç¨‹åºè¿è¡Œæ—¶çš„ç±»å‹å®‰å…¨ï¼Œå‡å°‘æ½œåœ¨çš„é”™è¯¯ã€‚è¿™ç§ç‰¹æ€§åœ¨æ•°æ®ç»“æ„ä¸ç®—æ³•è®¾è®¡ä¸­å°¤å…¶é‡è¦ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿæœ‰æ•ˆåº”å¯¹å¤šç§æ•°æ®ç±»å‹çš„éœ€æ±‚ï¼Œè€Œæ— éœ€é‡å¤ä»£ç ç¼–å†™ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","ç»“æ„ç®—æ³•"]},{"title":"äº”ç§å­˜å‚¨ç±»","path":"/2025/01/08/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-äº”ç§å­˜å‚¨ç±»/","content":"1. å­˜å‚¨ç±»å‹ä¸ä½œç”¨åŸŸçš„åŒºåˆ«ä¿®æ”¹å˜é‡çš„å­˜å‚¨ç±»å‹ï¼Œä¾‹å¦‚å°†å…¶ä»æ ˆä¸Šè½¬æ¢åˆ°é™æ€æ•°æ®åŒºï¼Œå¹¶ä¸æ”¹å˜å˜é‡çš„ä½œç”¨åŸŸã€‚å°½ç®¡ static å…³é”®å­—ä½¿å¾—å˜é‡çš„ç”Ÿå‘½å‘¨æœŸåœ¨ç¨‹åºè¿è¡ŒæœŸé—´æŒç»­å­˜åœ¨ï¼Œä½†å®ƒä»åªèƒ½åœ¨å®šä¹‰å®ƒçš„å‡½æ•°å†…éƒ¨é€šè¿‡åå­—è®¿é—®ã€‚ autoï¼šå­˜å‚¨åœ¨æ ˆä¸Šï¼Œç”Ÿå‘½å‘¨æœŸé™åˆ¶äºå…¶ä½œç”¨åŸŸå†…ï¼Œå½“å‡½æ•°æ‰§è¡Œç»“æŸåï¼Œè¿™äº›å˜é‡ä¼šè‡ªåŠ¨é‡Šæ”¾ã€‚ registerï¼šå£°æ˜ä¸ºå¯„å­˜å™¨å˜é‡ï¼Œæ„å›¾å°†å…¶å­˜å‚¨åœ¨æ›´å¿«çš„å¯„å­˜å™¨ä¸­ã€‚è™½ç„¶å¯ä»¥è¯·æ±‚å°†å˜é‡å­˜å‚¨åœ¨å¯„å­˜å™¨ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå»ºè®®ï¼Œå¹¶ä¸ä¿è¯æˆåŠŸã€‚å¦‚æœæ²¡æœ‰ç”³è¯·åˆ°å¯„å­˜å™¨ç©ºé—´ï¼Œregister å˜é‡çš„è¡Œä¸ºä¸ auto å˜é‡ç›¸åŒã€‚æ­¤å¤–ï¼Œregister å˜é‡ä¸èƒ½ä½¿ç”¨ è¿ç®—ç¬¦è·å–å…¶åœ°å€ï¼Œå› ä¸ºå¯„å­˜å™¨å¹¶ä¸æ˜¯å†…å­˜åœ°å€çš„æ¦‚å¿µã€‚ 2. static å…³é”®å­—çš„ä½œç”¨å½“ä½¿ç”¨ static ä¿®é¥°ä¸€ä¸ªå±€éƒ¨å˜é‡æ—¶ï¼Œè¯¥å˜é‡å°†å­˜å‚¨åœ¨ç¨‹åºçš„é™æ€å­˜å‚¨åŒºåŸŸã€‚å…¶ä¸­çš„å€¼å°†åœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´ä¿æŒä¸å˜ï¼Œå¹¶å¯ä»¥åœ¨è¯¥å‡½æ•°å¤šæ¬¡è°ƒç”¨æ—¶è¿›è¡ŒæŒç»­æ€§å­˜å–ã€‚ç„¶è€Œï¼Œå®ƒçš„ä½œç”¨åŸŸè¢«é™åˆ¶åœ¨è¯¥å‡½æ•°å†…éƒ¨ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®ã€‚ é™åˆ¶ä½œç”¨åŸŸï¼šé€šè¿‡ä½¿ç”¨ staticï¼Œå¯ä»¥ç¡®è®¤è¯¥å˜é‡ä»…åœ¨å®šä¹‰å®ƒçš„å‡½æ•°å†…å¯è§ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå‡½æ•°ä¸­ï¼š void fun() static int x = 0; x++; printf(%d , x); æ¯æ¬¡è°ƒç”¨ fun() æ—¶ï¼Œx çš„å€¼éƒ½ä¼šé€’å¢ï¼Œä½†å¤–éƒ¨ä»£ç æ— æ³•ç›´æ¥è®¿é—®æˆ–ä¿®æ”¹ xã€‚ 3. extern å…³é”®å­—å’Œä½œç”¨åŸŸextern å…³é”®å­—ç”¨äºå£°æ˜ä¸€ä¸ªå¤–éƒ¨å˜é‡ï¼Œè¯¥å˜é‡åœ¨å…¶ä»–æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå…è®¸è·¨æ–‡ä»¶è®¿é—®ã€‚ ä½¿ç”¨ extern å£°æ˜ï¼š extern int i; // å£°æ˜ i æ˜¯åœ¨å…¶ä»–æ–‡ä»¶å®šä¹‰çš„å…¨å±€å˜é‡ å¦‚æœåœ¨ fun å‡½æ•°ä¸­å£°æ˜ extern int i; åˆ™è¡¨ç¤ºå°†å¼•ç”¨å…¨å±€å˜é‡ iï¼Œè€Œä¸åœ¨ fun ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å±€éƒ¨å˜é‡ iã€‚è‹¥ä¸å£°æ˜ externï¼Œå˜é‡ i å°†è¢«è§†ä½œå±€éƒ¨å˜é‡ã€‚ 4. const å…³é”®å­—çš„ä½œç”¨ä½¿ç”¨ const å£°æ˜å˜é‡å¯ç¡®ä¿å½“å‰çº¿ç¨‹æ— æ³•æ”¹å˜è¯¥å˜é‡çš„å€¼ã€‚ä¾‹å¦‚ï¼š const int maxLimit = 100; åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒmaxLimit çš„å€¼åœ¨å½“å‰çº¿ç¨‹ä¸­ä¸å¯ä¿®æ”¹ï¼Œä½†å…¶ä»–çº¿ç¨‹æˆ–ç³»ç»Ÿä»£ç å¯èƒ½ä»ç„¶ä¼šå¯¹å…¶è¿›è¡Œæ”¹å˜ã€‚ 5. å˜é‡ä½œç”¨åŸŸä¸é®è”½åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¦‚æœå£°æ˜äº†ä¸€ä¸ªå±€éƒ¨å˜é‡ä¸å½¢å‚åŒåï¼Œç”±äºä½œç”¨åŸŸç›¸åŒï¼Œè¿™ä¸ªå±€éƒ¨å˜é‡å°†è‡ªåŠ¨é®è”½å¤–éƒ¨æˆ–å…¨å±€çš„åŒåå˜é‡ã€‚ å±€éƒ¨å˜é‡é®è”½å…¨å±€å˜é‡ï¼šè‹¥åœ¨ fun å‡½æ•°å†…éƒ¨å£°æ˜ä¸€ä¸ªä¸å…¨å±€å˜é‡ç›¸åŒåå­—çš„å±€éƒ¨å˜é‡ï¼Œæ‰€æœ‰å¯¹è¯¥åå­—çš„å¼•ç”¨å°†æŒ‡å‘å±€éƒ¨å˜é‡è€Œéå…¨å±€å˜é‡ã€‚ static å®šä¹‰çš„å˜é‡æ˜¯å¦å¯ä»¥ç”¨ extern è¿›è¡Œå¼•ç”¨åœ¨ C å’Œ C++ç¼–ç¨‹ä¸­ï¼Œstatic å…³é”®å­—ç”¨äºå®šä¹‰å…·æœ‰é™æ€å­˜å‚¨æœŸçš„å˜é‡ã€‚è¿™æ ·çš„å˜é‡åœ¨å…¶å®šä¹‰çš„æ–‡ä»¶å†…å…·æœ‰å†…éƒ¨é“¾æ¥æ€§ï¼Œæ„å‘³ç€è¿™äº›å˜é‡ä»…åœ¨å®šä¹‰å®ƒä»¬çš„æºæ–‡ä»¶ä¸­å¯è§ã€‚ä½¿ç”¨ static å…³é”®å­—å®šä¹‰çš„å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä»ç¨‹åºå¼€å§‹ä¸€ç›´æŒç»­åˆ°ç¨‹åºç»“æŸï¼Œå³ä¾¿å®ƒä»¬çš„ä½œç”¨åŸŸå¯èƒ½æ˜¯åœ¨ç‰¹å®šçš„å‡½æ•°å†…éƒ¨ã€‚ ç›¸å¯¹è€Œè¨€ï¼Œextern å…³é”®å­—ç”¨äºå£°æ˜ä¸€ä¸ªå˜é‡åœ¨å…¶ä»–æ–‡ä»¶ä¸­å®šä¹‰ï¼Œä»è€Œå…è®¸è·¨æ–‡ä»¶å¼•ç”¨ã€‚åœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼Œextern æŒ‡ç¤ºç¼–è¯‘å™¨è¯¥å˜é‡çš„å®šä¹‰åœ¨å…¶ä»–æŸå¤„ï¼Œé€šå¸¸æ˜¯åœ¨å¦ä¸€ä¸ªæºæ–‡ä»¶ä¸­ã€‚ å› æ­¤ï¼Œå¦‚æœåœ¨æŸä¸ªæºæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªé™æ€å˜é‡ï¼Œå¹¶å°è¯•åœ¨å¦ä¸€ä¸ªæºæ–‡ä»¶ä¸­ä½¿ç”¨ extern è¿›è¡Œå¼•ç”¨ï¼Œå°†ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºé™æ€å˜é‡çš„é“¾æ¥æ€§ä»…é™äºå®šä¹‰å®ƒçš„æ–‡ä»¶ã€‚ä½¿ç”¨ extern å¼•ç”¨æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå¯»æ‰¾è¯¥å˜é‡çš„å¤–éƒ¨å®šä¹‰ï¼Œä½†ç”±äºé™æ€å˜é‡ä¸ä¼šè¢«å¯¼å‡ºåˆ°å…¶ä»–æ–‡ä»¶ï¼Œæ‰€ä»¥ä¼šæ— æ³•æ‰¾åˆ°ã€‚ ç¤ºä¾‹åˆ†æï¼š é™æ€å˜é‡å®šä¹‰ç¤ºä¾‹ï¼š // file1.cstatic int count = 0; // countæ˜¯ä¸€ä¸ªé™æ€å˜é‡ï¼Œä»…åœ¨file1.cå¯è§ extern å¼•ç”¨ç¤ºä¾‹ï¼š // file2.cextern int count; // å°è¯•é€šè¿‡externå¼•ç”¨ä¸€ä¸ªåœ¨file1.cä¸­å®šä¹‰çš„é™æ€å˜é‡ åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œfile2.c ä¸­çš„ extern int count; æ— æ³•æˆåŠŸå¼•ç”¨ file1.c ä¸­çš„ count å˜é‡ï¼Œå› ä¸º count æ˜¯é™æ€çš„ï¼Œåªåœ¨ file1.c ä¸­å¯è§ï¼Œç¼–è¯‘å™¨åœ¨ file2.c ä¸­å°†æ— æ³•æ‰¾åˆ°å¯¹åº”çš„å®šä¹‰ã€‚ æ€»ç»“æ¥è¯´ï¼Œstatic å®šä¹‰çš„å˜é‡ä¸èƒ½ç”¨ extern è¿›è¡Œå¼•ç”¨ï¼Œå› ä¸º static é™åˆ¶äº†å˜é‡çš„å¯è§æ€§ï¼Œä½¿å…¶æ— æ³•è¢«å…¶ä»–æ–‡ä»¶è®¿é—®ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€"]},{"title":"Simulinkè½¬Cä»£ç çš„å®ç°_æ€ä¹ˆæŠŠsimulinkæ¨¡å‹è½¬æ¢æˆcè¯­è¨€-CSDNåšå®¢","path":"/2024/12/26/2-ç¼–ç¨‹è¯­è¨€-Matlab-Simulinkè½¬Cä»£ç çš„å®ç°-æ€ä¹ˆæŠŠsimulinkæ¨¡å‹è½¬æ¢æˆcè¯­è¨€-CSDNåšå®¢/","content":"Matlab ä»¿çœŸæ¡†å›¾è½¬ C ä»£ç å®ç°è¯´æ˜æ–‡æ¡£å®ç°æ­¥éª¤ æ­å»ºæ¡†å›¾ ä½¿ç”¨ Matlab 2016b æ­å»ºä»¿çœŸæ¡†å›¾ï¼Œå‘½åä¸º test.dllã€‚ä»¥ä¸‹æ˜¯ä»¿çœŸæ¡†å›¾çš„ç¤ºæ„å›¾ï¼š å›¾ 1: Simulink æ¨¡å‹ åˆå§‹è®¾ç½® é€‰æ‹©èœå•æ  Simulink - Model Configuration Parametersï¼Œè®¾ç½®å‚æ•°ä¸ºå›ºå®šæ­¥é•¿ï¼Œé‡‡ç”¨å››é˜¶é¾™æ ¼åº“å¡”æ–¹æ³•è§£ç®—å¾®åˆ†æ–¹ç¨‹ã€‚å…·ä½“æ­¥é•¿å¯ä»¥åœ¨åæœŸè¿›è¡ŒäºŒæ¬¡è®¾ç½®ã€‚ å›¾ 2: è®¾ç½®æ±‚è§£å™¨å‚æ•° ç³»ç»Ÿçš„ç›®æ ‡æ–‡ä»¶é€‰æ‹©ä¸º ert.tlcï¼Œå³é‡‡ç”¨åµŒå…¥å½¢å¼çš„ CC++ ä»£ç ç”Ÿæˆã€‚ç”Ÿæˆçš„è¯­è¨€å¯é€‰æ‹© C æˆ– C++ã€‚ å›¾ 3: ä»£ç ç”Ÿæˆçš„å‚æ•°è®¾ç½® æ¥å£æ¨¡å—è¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼Œéœ€è¦é€‰ä¸­ continuoustime é€‰é¡¹ã€‚è‡³æ­¤ï¼Œå‚æ•°è®¾ç½®å·¥ä½œå®Œæ¯•ï¼Œå…¶ä½™è®¾ç½®é‡‡ç”¨é»˜è®¤è®¾ç½®æ–¹å¼ã€‚ å›¾ 4: æ¥å£å‚æ•°è®¾ç½® ä»£ç ç”Ÿæˆ ç›´æ¥ç‚¹å‡»ä»£ç ç”ŸæˆåŠŸèƒ½é”®ï¼Œç”Ÿæˆä»£ç æˆåŠŸåä¼šæ”¶åˆ°å¦‚å›¾ 5 æ‰€ç¤ºçš„æç¤ºã€‚æ­¤æ—¶ï¼Œåœ¨ç¤ºä¾‹æ–‡ä»¶ test.mdl çš„ç›®å½•ä¸‹ä¼šå‡ºç°åä¸º slprj å’Œ test_ert_rtw çš„æ–‡ä»¶å¤¹ï¼Œå¦‚å›¾ 6 æ‰€ç¤ºï¼ŒåŒ…å«äº†ç”Ÿæˆçš„ C ä»£ç çš„ç›¸å…³æ–‡ä»¶ã€‚ å›¾ 5: ä»£ç ç”ŸæˆæˆåŠŸæç¤º å›¾ 6: ç”Ÿæˆæ–‡ä»¶ ä»£ç åº”ç”¨ ä»£ç å¯åœ¨ Visual Studio 2013 ä¸Šè¿è¡Œï¼Œé€šè¿‡ æ–‡ä»¶ - æ‰“å¼€ - é¡¹ç›®/è§£å†³æ–¹æ¡ˆï¼Œæ‰¾åˆ° test_ert_rtw\\msvc ç›®å½•ä¸‹çš„ test.sln æ–‡ä»¶å¹¶æ·»åŠ ï¼Œæ·»åŠ æˆåŠŸå¦‚ä¸‹æ‰€ç¤ºã€‚ å›¾ 6: ç”Ÿæˆæ–‡ä»¶ ä¸»æ–‡ä»¶ç»è¿‡åˆå§‹åŒ–åï¼Œåœ¨ while å¾ªç¯ä¸­è°ƒç”¨ test_step() å‡½æ•°æŒ‰å•æ­¥æ‰§è¡Œï¼Œæœ€åé€šè¿‡ test_terminate ç»ˆæ­¢ã€‚åœ¨å¸¦æœ‰ç§¯åˆ†ç¯èŠ‚çš„æ¨¡å‹ä¸­ï¼Œè¿˜å¯ä»¥é€šè¿‡æ‰¾åˆ° test_M-Timing.stepSize0 é‡æ–°è®¾ç½®ä»¿çœŸæ­¥é•¿ã€‚å›¾ 7 æ˜¾ç¤ºï¼Œæ¯æ¬¡ç»™è¾“å…¥è®¾ç½®å¸¸å€¼ï¼Œç»ç¬¬äº”æ¬¡è°ƒç”¨åçš„è¾“å‡ºç»“æœã€‚ å›¾ 7: ä»£ç æµ‹è¯• ç»“è®ºé‡‡ç”¨ Matlab å’Œ C æ··åˆç¼–ç¨‹ï¼Œè®¾è®¡ç®€å•ï¼Œç»“æ„æ¸…æ™°ï¼Œä¿®æ”¹æ–¹ä¾¿ï¼ŒåŒæ—¶å¤§å¤§é™ä½äº†ç¼–ç¨‹å¤±è¯¯å¸¦æ¥çš„é£é™©ï¼Œä¸ºä¿è¯é¡¹ç›®æœ‰æ•ˆè¿›è¡Œæä¾›äº†ä¿éšœã€‚ MATLAB åŠ¨æ€é“¾æ¥åº“è½¬æ¢æ­¥éª¤ é…ç½® MATLAB ç¼–è¯‘å™¨ åœ¨ MATLAB çš„å‘½ä»¤è¡Œçª—å£è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š mbuild -setupmex -setupdeploytool é€‰æ‹© C++ é€‰é¡¹ã€‚ä»¥ä¸‹æ˜¯å‘½ä»¤ç•Œé¢ï¼š å›¾ 8: MATLAB å‘½ä»¤ç•Œé¢ åˆ›å»ºåŠ¨æ€é“¾æ¥åº“ è¿è¡Œ deploytool åï¼Œé€‰æ‹© Library Compiler é€‰é¡¹ï¼Œè¿›å…¥å¦‚ä¸‹ç•Œé¢ï¼š å›¾ 9: Compiler ç•Œé¢ é€‰æ‹© .NET Assemblyï¼Œæ·»åŠ ç›¸å…³è„šæœ¬æ–‡ä»¶ï¼Œå°†ç±»çš„åå­—å®šä¹‰ä¸º airplaneï¼ˆè‡ªå®šä¹‰ï¼‰ï¼Œç¡®è®¤åé€‰æ‹© Package æŒ‰é’®è¿›è¡Œæ‰“åŒ…ã€‚ å›¾ 10: æ“ä½œç•Œé¢ ç”Ÿæˆ DLL æ–‡ä»¶ æ‰“åŒ…å®Œæˆåï¼Œä¼šç”Ÿæˆå‡ ä¸ªæ–‡ä»¶å¤¹ï¼ŒåŒ…å«è°ƒç”¨åˆ°çš„ dll æ–‡ä»¶ã€‚ å›¾ 11: è¾“å‡ºç•Œé¢ æ€»ç»“é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå¯ä»¥å°† Matlab ä»¿çœŸæ¡†å›¾æˆåŠŸè½¬æ¢ä¸º C ä»£ç ï¼Œå¹¶ç”ŸæˆåŠ¨æ€é“¾æ¥åº“ï¼Œæ–¹ä¾¿åœ¨å…¶ä»–é¡¹ç›®ä¸­è°ƒç”¨ã€‚è¿™ç§æ–¹æ³•ä¸ä»…æé«˜äº†å¼€å‘æ•ˆç‡ï¼Œè¿˜é™ä½äº†ç¼–ç¨‹é”™è¯¯çš„é£é™©ï¼Œæ˜¯ä¸€ç§é«˜æ•ˆå¯é çš„å¼€å‘æ–¹å¼ã€‚","tags":["clippings"],"categories":["2.ç¼–ç¨‹è¯­è¨€","Matlab"]},{"title":"Docker Compose","path":"/2024/12/26/1-å¹³å°ç³»ç»Ÿ-Docker-Docker-Compose/","content":"Docker ComposeDocker Compose æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šä¸ª Docker å®¹å™¨çš„åº”ç”¨ç¨‹åºã€‚ docker-compose éœ€è¦ç¼–å†™ yml è„šæœ¬ï¼Œå®šä¹‰é…ç½®ä»¥åŠå¤šä¸ªå®¹å™¨ä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œç½‘ç»œè¿æ¥ * æ³¨æ„ï¼šyml æ–‡ä»¶å¯¹ç¼©è¿›æœ‰ä¸¥æ ¼è¦æ±‚ é€šè¿‡å‘½ä»¤æ§åˆ¶ docker-composeä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ docker-compose.yml æ–‡ä»¶ç¤ºä¾‹ï¼š version: 3.9services: db: image: mysql:5.7 volumes: - ./db_data:/var/lib/mysql restart: always environment: MYSQL_ROOT_PASSWORD: somewordpress MYSQL_DATABASE: wordpress MYSQL_USER: wordpress MYSQL_PASSWORD: wordpress wordpress: depends_on: - db image: wordpress:latest volumes: - ./wordpress_data:/var/www/html ports: - 80:80 - 443:443 restart: always environment: WORDPRESS_DB_HOST: db WORDPRESS_DB_USER: wordpress WORDPRESS_DB_PASSWORD: wordpress WORDPRESS_DB_NAME: wordpressvolumes: db_data: wordpress_data: è¿™é‡Œç”¨åˆ°äº† mysql:5.7 å’Œ wordpress:latest ä¸¤ä¸ª Docker é•œåƒï¼ŒWordPress é•œåƒä¾èµ– depends_on äº MySQL é•œåƒã€‚ restart: always å‚æ•°è¡¨æ˜å®¹å™¨æœåŠ¡å®•æœºåä¼šè‡ªåŠ¨é‡å¯ã€‚ MYSQL_ROOT_PASSWORD ä¸ºæ•°æ®åº“çš„ root å¯†ç ï¼ŒMYSQL_PASSWORD ä¸ºæ•°æ®åº“çš„æ™®é€šç”¨æˆ·å¯†ç ï¼Œè¯·è‡ªè¡Œä¿®æ”¹ï¼Œå¯¹åº”çš„ WORDPRESS_DB_PASSWORD ä¹Ÿè¦åŒæ—¶ä¿®æ”¹ã€‚MYSQL_USER ä¸ºæ•°æ®åº“æ™®é€šç”¨æˆ·çš„ç”¨æˆ·åï¼Œå¦‚æœæœ‰éœ€è¦ä¹Ÿå¯ä»¥ä¿®æ”¹ï¼Œå¯¹åº”çš„ WORDPRESS_DB_USER ä¹Ÿè¦åŒæ—¶ä¿®æ”¹ã€‚ 80:80 çš„æ„æ€æ˜¯æŠŠå®¿ä¸»æœºçš„ 80 ç«¯å£æ˜ å°„åˆ°å®¹å™¨å†…éƒ¨çš„ 80 ç«¯å£ã€‚å¦‚éœ€é€šè¿‡å…¶ä»–ç«¯å£è®¿é—®ï¼Œåªéœ€ä¿®æ”¹å‰é¢çš„ 80ã€‚æ¯”å¦‚ï¼Œè¦é€šè¿‡ 8080 ç«¯å£è®¿é—® WordPressï¼Œå¡«å†™ 8080:80 å³å¯ã€‚ volumes ä¼šå°†ä¸»æœºä¸­æŒ‡å®šçš„ç›®å½• ./wordpress_data å’Œå®¹å™¨ä¸­çš„æŒ‡å®šç›®å½• /var/www/html å…±äº«ï¼Œç±»ä¼¼äºè™šæ‹Ÿæœºä¸­çš„å…±äº«æ–‡ä»¶å¤¹ã€‚å¹¶ä¸”åœ¨å®¹å™¨é”€æ¯åç›®å½•ä¸­çš„æ–‡ä»¶ä¾æ—§å­˜åœ¨ã€‚ åœ¨ Docker Compose ç‰ˆæœ¬ 3 åŠä»¥ä¸Šçš„é…ç½®ä¸­ï¼Œä¸å†ä½¿ç”¨ links å­—æ®µæ¥å®šä¹‰å®¹å™¨ä¹‹é—´çš„è¿æ¥ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ä½¿ç”¨ Docker ç½‘ç»œæ¥å®ç°å®¹å™¨ä¹‹é—´çš„é€šä¿¡ã€‚ç°åœ¨ï¼ŒDocker Compose é»˜è®¤åˆ›å»ºä¸€ä¸ªé¡¹ç›®çº§åˆ«çš„é»˜è®¤ç½‘ç»œï¼Œå…¶ä¸­æ¯ä¸ªæœåŠ¡ï¼ˆserviceï¼‰éƒ½å¯ä»¥ä½¿ç”¨å®ƒã€‚ åªéœ€ä¿è¯ db å’Œ wordpress å±äºåŒä¸€ä¸ªé¡¹ç›®ï¼ˆå³åœ¨åŒä¸€ä¸ª docker-compose.yml æ–‡ä»¶ä¸­å®šä¹‰ï¼‰ï¼Œå®ƒä»¬å°†è‡ªåŠ¨è¿æ¥åˆ°é»˜è®¤ç½‘ç»œï¼Œå¹¶å¯ä»¥é€šè¿‡æœåŠ¡åç§°ï¼ˆdb å’Œ wordpressï¼‰ç›¸äº’è®¿é—®ã€‚ è„šæœ¬Docker Composeå®˜æ–¹æ–‡æ¡£ Docker Compose å‘½ä»¤è§£æ **docker-compose up -d**ï¼šæ­¤å‘½ä»¤æ ¹æ®å½“å‰ç›®å½•ä¸­çš„ yml æ–‡ä»¶é…ç½®å¯åŠ¨æ‰€æœ‰æœåŠ¡å®¹å™¨ã€‚ä½¿ç”¨ -d å‚æ•°ä½¿å®¹å™¨åœ¨åå°è¿è¡Œï¼Œç”¨æˆ·å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–å‘½ä»¤è€Œä¸å¿…ç­‰å¾…å®¹å™¨å¯åŠ¨å®Œæˆã€‚ **docker-compose ps**ï¼šæ­¤å‘½ä»¤ç”¨äºæŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨çŠ¶æ€ã€‚å®ƒå°†åˆ—å‡ºé¡¹ç›®ä¸­æ‰€æœ‰å®¹å™¨çš„å½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬å·²åœæ­¢çŠ¶æ€ã€‚è¿™å¯¹äºç›‘æ§å®¹å™¨è¿è¡Œæƒ…å†µéå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦æ£€æŸ¥å·²åœæ­¢å®¹å™¨æ—¶ï¼Œè€Œä¸ä»…é™äºåªæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„çŠ¶æ€ã€‚ **docker-compose stop**ï¼šé€šè¿‡æ­¤å‘½ä»¤å¯ä»¥åœæ­¢æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œç›¸å½“äºä¸€ç§ä¾¿æ·çš„å…³é—­æ–¹å¼ã€‚ **docker-compose restart**ï¼šè¯¥å‘½ä»¤ç”¨äºé‡å¯æ‰€æœ‰å®¹å™¨ï¼Œéå¸¸é€‚åˆç®€å•çš„æœåŠ¡æ›´æ–°æˆ–é…ç½®å˜æ›´åéœ€è¦åˆ·æ–°æœåŠ¡çš„åœºåˆã€‚ **docker-compose restart service-name**ï¼šé‡å¯æŒ‡å®šçš„å•ä¸ªæœåŠ¡ã€‚è¿™åœ¨éœ€è¦ä»…æ›´æ–°æŸä¸ªæœåŠ¡è€Œä¸å½±å“å…¶ä»–æœåŠ¡æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚ **docker-compose exec service-name sh**ï¼šå…è®¸ç”¨æˆ·è¿›å…¥ç‰¹å®šæœåŠ¡çš„å‘½ä»¤è¡Œç¯å¢ƒï¼Œä¾¿äºè¿›è¡Œåº”ç”¨çº§åˆ«çš„ç›´æ¥æ“ä½œï¼Œå¦‚è°ƒè¯•æˆ–æ‰‹åŠ¨æ‰§è¡ŒæŸäº›å‘½ä»¤ã€‚ **docker-compose logs [service-name]**ï¼šæŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„æ—¥å¿—ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ -f å‚æ•°æŒ‡å®šç‰¹å®šçš„æ—¥å¿—æ–‡ä»¶ã€‚æ­¤å‘½ä»¤å¯¹äºæ’æŸ¥è¿è¡Œæ—¶é”™è¯¯å’Œè¯Šæ–­é—®é¢˜éå¸¸é‡è¦ã€‚ **docker-compose build**ï¼šç”¨äºæ„å»ºæˆ–é‡å»ºæœåŠ¡æ‰€éœ€çš„é•œåƒã€‚è¯¥å‘½ä»¤ä¼šæ ¹æ® Dockerfile é…ç½®æ–‡ä»¶åˆ›å»ºæ–°çš„é•œåƒï¼Œä»¥ç¡®ä¿æ‰€éœ€çš„æœåŠ¡ç‰ˆæœ¬ã€‚ **docker-compose build service_a**ï¼šä¸“é—¨åˆ›å»ºåä¸º service_a çš„é•œåƒï¼Œé€‚åˆé’ˆå¯¹æŸä¸ªç‰¹å®šæœåŠ¡è¿›è¡Œæ„å»ºã€‚ **docker-compose kill**ï¼šå¼ºè¡Œåœæ­¢æœåŠ¡ï¼Œé€šè¿‡å‘å®¹å™¨å‘é€ SIGKILL ä¿¡å·ï¼Œé€‚ç”¨äºéœ€è¦ç«‹å³ç»ˆæ­¢å®¹å™¨è€Œä¸äºˆä»¥æ¸…ç†çš„æƒ…å†µã€‚ **docker-compose pause/unpause**ï¼š docker-compose pauseï¼šå°†æœåŠ¡æš‚åœï¼Œæ‰€æœ‰æœåŠ¡å®¹å™¨çš„è¿›ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œèµ„æºä½¿ç”¨ä¼šæ˜¾è‘—é™ä½ã€‚ docker-compose unpauseï¼šæ¢å¤è¢«æš‚åœçš„æœåŠ¡ï¼Œè®©æœåŠ¡é‡æ–°å¼€å§‹å¤„ç†è¯·æ±‚ã€‚ **docker-compose port**ï¼šç”¨äºæŸ¥çœ‹æœåŠ¡å†…çš„ç‰¹å®šç«¯å£ä¸ç‰©ç†æœºä¸Šç«¯å£çš„æ˜ å°„å…³ç³»ã€‚ä¾‹å¦‚ï¼Œæ‰§è¡Œ docker-compose port nginx_web 80 ä¼šå±•ç¤º Nginx æœåŠ¡çš„ 80 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„å“ªä¸ªç«¯å£ã€‚ **docker-compose ps**ï¼šè¯¥å‘½ä»¤ä¸“æ³¨äºæ˜¾ç¤ºå½“å‰é¡¹ç›®ä¸‹çš„å®¹å™¨çŠ¶æ€ï¼ŒåŒ…æ‹¬å·²åœæ­¢çŠ¶æ€çš„å®¹å™¨ï¼Œå’Œ docker ps ç›¸æ¯”ï¼Œè¿™é‡Œæä¾›æ›´å¤šé¡¹ç›®ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ **docker-compose pull**ï¼šç”¨äºæ‹‰å–æœåŠ¡ä¾èµ–çš„é•œåƒï¼Œç¡®ä¿æœ¬åœ°ç¯å¢ƒä¸è¿œç¨‹ä»“åº“ä¿æŒä¸€è‡´ã€‚è¿™å¯¹äºæ›´æ–°æˆ–éƒ¨ç½²æ—¶è·å–æœ€æ–°é•œåƒéå¸¸é‡è¦ã€‚ **docker-compose restart service_name**ï¼šé‡å¯å•ä¸ªæœåŠ¡ä¸­çš„æ‰€æœ‰å®¹å™¨ã€‚å½“æœåŠ¡å°šåœ¨è¿è¡Œæ—¶ï¼Œæ­¤å‘½ä»¤æœ‰æ•ˆï¼Œåœæ­¢çš„æœåŠ¡æ— æ³•è¢«é‡å¯ã€‚ **docker-compose rm**ï¼šåˆ é™¤å·²åœæ­¢çš„æœåŠ¡å®¹å™¨ï¼Œä¿æŒç¯å¢ƒçš„æ•´æ´ã€‚å¯ä»¥ä½¿ç”¨å‚æ•° -f å¼ºåˆ¶åˆ é™¤ï¼Œæˆ–ä½¿ç”¨ -v åˆ é™¤ä¸å®¹å™¨ç›¸å…³çš„å·ï¼Œä»¥é‡Šæ”¾æ›´å¤šå­˜å‚¨ç©ºé—´ã€‚ **docker-compose run**ï¼šè¯¥å‘½ä»¤ç”¨äºåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œæ‰§è¡Œä¸€æ¬¡æ€§å‘½ä»¤ã€‚å…¶é…ç½®ä¸å®šä¹‰åœ¨ yml æ–‡ä»¶ä¸­çš„æœåŠ¡ä¸€è‡´ï¼Œä½†ä¼šè¦†ç›–æœåŠ¡ä¸­å®šä¹‰çš„å‘½ä»¤ã€‚æ­¤å¤–ï¼Œæ–°å®¹å™¨ä¸ä¼šä½¿ç”¨æœåŠ¡é…ç½®ä¸­æŒ‡å®šçš„ç«¯å£ï¼Œè‹¥éœ€è¦ä½¿ç”¨è¿™äº›ç«¯å£ï¼Œå¯æ·»åŠ  --service-ports å‚æ•°ã€‚ **docker-compose start/stop**ï¼š **docker-compose start**ï¼šç”¨äºå¯åŠ¨æŒ‡å®šæœåŠ¡çš„æ‰€æœ‰å®¹å™¨ã€‚ **docker-compose stop**ï¼šåˆ™å¯åœæ­¢ç‰¹å®šæœåŠ¡çš„æ‰€æœ‰å®¹å™¨ã€‚ **docker-compose scale**ï¼šå…è®¸ç”¨æˆ·æŒ‡å®šæŸä¸ªæœåŠ¡å¯åŠ¨çš„å®¹å™¨æ•°é‡ã€‚å°½ç®¡è¯¥å‘½ä»¤æ­£åœ¨è¢«å¼ƒç”¨ï¼Œä½†å¯é€šè¿‡ --help æŸ¥çœ‹ç”¨æ³•ç¤ºä¾‹ï¼Œå¦‚ docker-compose scale web=2 worker=3ï¼Œè¿™å°†åˆ›å»ºä¸¤ä¸ª web å®¹å™¨å’Œä¸‰ä¸ª worker å®¹å™¨ã€‚ éƒ¨ç½² nginx ä»£ç† Tomcat é›†ç¾¤ï¼Œå®ç°è´Ÿè½½å‡è¡¡å¤§ä½“æ­¥éª¤æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹å››ä¸ªä¸»è¦æ­¥éª¤ï¼š ä¸‹è½½æ‰€éœ€çš„è½¯ä»¶åŒ… éœ€è¦ä¸‹è½½çš„æ–‡ä»¶åŒ…æ‹¬ Tomcat å’Œ JDKï¼ˆJava Development Kitï¼‰ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯æ„å»º Java åº”ç”¨ç¨‹åºçš„åŸºç¡€å·¥å…·ã€‚Tomcat ä½œä¸º Java çš„ Servlet å®¹å™¨ï¼Œé€šå¸¸ç”¨äºè¿è¡Œ Java EE Web åº”ç”¨ç¨‹åºã€‚ ç¼–å†™ Dockerfile ä»¥éƒ¨ç½² Tomcat å’Œ Java ç¯å¢ƒ Dockerfile å®šä¹‰äº† Docker é•œåƒçš„æ„å»ºè¿‡ç¨‹ã€‚æœ¬ç¤ºä¾‹ä½¿ç”¨ä¸€ä¸ªåŸºäº CentOS çš„é•œåƒæ·»åŠ  Java å’Œ Tomcatã€‚é€šè¿‡è¿™ä¸€è¿‡ç¨‹ç”Ÿæˆçš„é•œåƒå°†åŒ…å«æ‰€éœ€çš„è¿è¡Œç¯å¢ƒã€‚ ç¼–å†™ docker-compose.yml é…ç½®æ–‡ä»¶ æ­¤é…ç½®æ–‡ä»¶ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šä¸ª Docker å®¹å™¨ã€‚å®ƒæŒ‡å®šäº†éœ€è¦å¯åŠ¨çš„æœåŠ¡ï¼ŒåŒ…æ‹¬ nginx å’Œä¸¤ä¸ª Tomcat å®ä¾‹ï¼Œå¹¶é…ç½®äº†å®ƒä»¬ä¹‹é—´çš„ç½‘ç»œé“¾æ¥ã€‚ æµ‹è¯•è´Ÿè½½å‡è¡¡ éƒ¨ç½²å®Œæˆåï¼Œé€šè¿‡è®¿é—® nginx ä»£ç†ï¼ŒéªŒè¯è´Ÿè½½å‡è¡¡çš„æ•ˆæœï¼Œç¡®ä¿è¯·æ±‚åœ¨ Tomcat é›†ç¾¤ä¹‹é—´å¾—åˆ°åˆç†åˆ†é…ã€‚ å…·ä½“é…ç½®æ–‡ä»¶ç›®å½•ç»“æ„[root@master java]# tree ././â”œâ”€â”€ docker-compose.ymlâ”œâ”€â”€ etcâ”‚ â””â”€â”€ localtimeâ”œâ”€â”€ nginxâ”‚ â””â”€â”€ nginx.confâ”œâ”€â”€ tomcatâ”‚ â”œâ”€â”€ apache-tomcat-8.5.31.tar.gzâ”‚ â”œâ”€â”€ Dockerfileâ”‚ â””â”€â”€ jdk-8u144-linux-x64.tar.gzâ””â”€â”€ webserver â”œâ”€â”€ tomcatA â”‚ â””â”€â”€ index.jsp â””â”€â”€ tomcatB â””â”€â”€ index.jsp æµ‹è¯•é¦–é¡µæ–‡ä»¶å¯¹äºä¸¤ä¸ª Tomcat å®ä¾‹ï¼Œåˆ†åˆ«æä¾›äº†ç®€å•çš„æµ‹è¯•é¡µé¢ï¼š Tomcat A ä¸»é¡µ: welcome to tomcat-A server Tomcat B ä¸»é¡µ: welcome to tomcat-B server docker-compose.yml é…ç½®æ–‡ä»¶è¯¥é…ç½®æ–‡ä»¶è¯¦ç»†æè¿°äº†æœåŠ¡çš„è®¾å®šï¼Œä¸‹é¢æ˜¯é…ç½®æ–‡ä»¶çš„å†…å®¹ï¼š version: 3services: nginx: image: nginx:1.14 restart: always ports: - 80:80 links: - tomcat1:tomcat1 - tomcat2:tomcat2 volumes: - ./webserver:/webserver - ./nginx/nginx.conf:/etc/nginx/nginx.conf - ./etc/localtime:/etc/localtime depends_on: - tomcat1 - tomcat2 tomcat1: hostname: tomcat1 build: ./tomcat volumes: - ./webserver/tomcatA:/usr/local/apache-tomcat-8.5.31/webapps/ROOT - ./etc/localtime:/etc/localtime tomcat2: hostname: tomcat2 build: ./tomcat volumes: - ./webserver/tomcatB:/usr/local/apache-tomcat-8.5.31/webapps/ROOT - ./etc/localtime:/etc/localtime å®‰è£… Java ç¯å¢ƒçš„ Dockerfileä»¥ä¸‹ Dockerfile ç”¨äºåˆ›å»º Tomcat å®¹å™¨æ—¶çš„ Java è¿è¡Œç¯å¢ƒï¼š FROM centosADD jdk-8u144-linux-x64.tar.gz /usr/localENV JAVA_HOME /usr/local/jdk1.8.0_144ADD apache-tomcat-8.5.31.tar.gz /usr/localEXPOSE 8080ENTRYPOINT [/usr/local/apache-tomcat-8.5.31/bin/catalina.sh, run] å®¹å™¨æœåŠ¡çš„å¯åŠ¨é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨æ‰€æœ‰å®šä¹‰çš„æœåŠ¡ï¼š [root@master java]# docker-compose up åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒDocker å°†é¦–å…ˆæ„å»º Tomcat çš„é•œåƒï¼Œéšåé€æ­¥å¯åŠ¨ nginx å’Œä¸¤ä¸ª Tomcat å®ä¾‹ã€‚ å¯åŠ¨æƒ…å†µæ£€æŸ¥å¯åŠ¨åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å„ä¸ªæœåŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼š [root@master java]# docker-compose ps Name Command State Ports ----------------------------------------------------------------------------java_nginx_1 nginx -g daemon off; Up 0.0.0.0:80-80/tcpjava_tomcat1_1 /usr/local/apache-tomcat-8 ... Up 8080/tcp java_tomcat2_1 /usr/local/apache-tomcat-8 ... Up 8080/tcp æ£€æµ‹è´Ÿè½½å‡è¡¡è®¿é—® localhost å¯æµ‹è¯•è´Ÿè½½å‡è¡¡æ•ˆæœï¼š [root@master java]# curl http://localhostwelcome to tomcat-A server[root@master java]# curl http://localhostwelcome to tomcat-B server ä¸€ç³»åˆ—è¯·æ±‚å°†äº¤æ›¿è¿”å› Tomcat A å’Œ Tomcat B çš„é¦–é¡µå†…å®¹ï¼ŒéªŒè¯è´Ÿè½½å‡è¡¡åŠŸèƒ½æ­£å¸¸ã€‚ æŸ¥çœ‹æ—¥å¿—è¾“å‡ºä¿¡æ¯å¯ä»¥é€šè¿‡ Docker logs æ¥æŸ¥çœ‹ nginx çš„è®¿é—®è®°å½•ï¼Œå…¶ä¸­åŒ…å«æ¯æ¬¡è¯·æ±‚çš„ IP åœ°å€å’Œè¯·æ±‚çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š nginx_1 | 192.168.22.170 - - [08/Jun/2018:02:14:36 +0000] GET / HTTP/1.1 200 27 - Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36 - è¿™äº›ä¿¡æ¯è®°å½•äº†æ¯ä¸€è¯·æ±‚çš„æ—¶é—´ã€çŠ¶æ€ç å’Œç”¨æˆ·ä»£ç†ï¼Œæ–¹ä¾¿åç»­çš„ç›‘æ§ä¸åˆ†æã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Docker"]},{"title":"æ¶ˆæ¯é˜Ÿåˆ—è¯¦è§£ä¸å®ä¾‹-CSDNåšå®¢","path":"/2024/12/25/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-æ¶ˆæ¯é˜Ÿåˆ—è¯¦è§£ä¸å®ä¾‹-CSDNåšå®¢/","content":"å‰è¨€ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§ç”¨äºè¿›ç¨‹é—´é€šä¿¡çš„æœºåˆ¶ï¼Œå¯ä»¥å°†å…¶è§†ä¸ºä¸€ä¸ªæœ‰åºçš„æ¶ˆæ¯é“¾è¡¨ã€‚æ¯æ¡æ¶ˆæ¯éƒ½åƒä¸€ä¸ªè®°å½•ï¼ŒåŒ…å«ç‰¹å®šçš„æ ¼å¼å’Œä¼˜å…ˆçº§ã€‚å…·æœ‰å†™æƒé™çš„è¿›ç¨‹å¯ä»¥æŒ‰ç…§ä¸€å®šçš„è§„åˆ™å°†æ–°æ¶ˆæ¯æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œå…·æœ‰è¯»æƒé™çš„è¿›ç¨‹åˆ™å¯ä»¥ä»é˜Ÿåˆ—ä¸­è¯»å–æ¶ˆæ¯ã€‚è¿™ç§æœºåˆ¶åœ¨å¤šè¿›ç¨‹ç¯å¢ƒä¸­éå¸¸æœ‰ç”¨ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°å®ç°æ•°æ®çš„å¼‚æ­¥ä¼ è¾“å’Œå¤„ç†ã€‚ å‡½æ•°ï¼š1. åˆ›å»ºæ–°æ¶ˆæ¯é˜Ÿåˆ—æˆ–å–å¾—å·²å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—åŸå‹ï¼š int msgget(key_t key, int msgflg); å‚æ•°ï¼š keyï¼šå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œç±»ä¼¼äºç½‘ç»œä¸­çš„ç«¯å£å·ã€‚è¿™ä¸ªå€¼å¯ä»¥é€šè¿‡å‡½æ•° ftok ç”Ÿæˆï¼Œç¡®ä¿åœ¨ä¸åŒè¿›ç¨‹ä¸­å”¯ä¸€ã€‚ msgflgï¼šç”¨äºæ§åˆ¶æ¶ˆæ¯é˜Ÿåˆ—çš„åˆ›å»ºå’Œè®¿é—®è¡Œä¸ºã€‚ IPC_CREATï¼šå¦‚æœæ¶ˆæ¯é˜Ÿåˆ—ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„æ¶ˆæ¯é˜Ÿåˆ—å¹¶è¿”å›å…¶æ ‡è¯†ç¬¦ï¼›å¦‚æœå·²å­˜åœ¨ï¼Œåˆ™è¿”å›ç°æœ‰çš„æ ‡è¯†ç¬¦ã€‚ IPC_EXCLï¼šå¦‚æœæ¶ˆæ¯é˜Ÿåˆ—ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› -1ï¼›å¦‚æœå·²å­˜åœ¨ï¼Œåˆ™è¿”å› 0ã€‚ 2. å‘é˜Ÿåˆ—è¯»å†™æ¶ˆæ¯åŸå‹ï¼š ssize_t msgrcv(int msqid, void *msgp, size_t msgsz, long msgtyp, int msgflg); int msgsnd(int msqid, const void *msgp, size_t msgsz, int msgflg); å‚æ•°ï¼š msqidï¼šæ¶ˆæ¯é˜Ÿåˆ—çš„æ ‡è¯†ç¬¦ï¼Œé€šå¸¸æ˜¯é€šè¿‡ msgget å‡½æ•°è·å–çš„ã€‚ msgpï¼šæŒ‡å‘æ¶ˆæ¯ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œç”¨äºæš‚æ—¶å­˜å‚¨å‘é€å’Œæ¥æ”¶çš„æ¶ˆæ¯ã€‚è¿™ä¸ªç¼“å†²åŒºçš„ç»“æ„é€šå¸¸å®šä¹‰å¦‚ä¸‹ï¼š struct msgstru long mtype; // æ¶ˆæ¯ç±»å‹ char mtext[1]; // æ¶ˆæ¯å†…å®¹; msgszï¼šæ¶ˆæ¯çš„å¤§å°ï¼Œé€šå¸¸æ˜¯ struct msgstru çš„å¤§å°ã€‚ msgtypï¼šæŒ‡å®šè¦è¯»å–çš„æ¶ˆæ¯ç±»å‹ã€‚å¦‚æœå€¼ä¸ºé›¶ï¼Œåˆ™è¡¨ç¤ºè¯»å–é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ¶ˆæ¯ã€‚ msgflgï¼šæŒ‡ç¤ºåœ¨é˜Ÿåˆ—æ²¡æœ‰æ•°æ®æ—¶çš„è¡Œä¸ºã€‚ å¦‚æœä¸ IPC_NOWAIT ä¸€èµ·ä½¿ç”¨ï¼Œmsgsnd() åœ¨é˜Ÿåˆ—å·²æ»¡æ—¶ä¸ä¼šé˜»å¡ï¼Œè€Œæ˜¯ç«‹å³è¿”å› -1ï¼›msgrcv() åœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ä¹Ÿä¼šç«‹å³è¿”å› -1ï¼Œå¹¶è®¾ç½®é”™è¯¯ç ä¸º ENOMSGã€‚ å¦‚æœ msgflg ä¸º 0ï¼Œmsgsnd() å’Œ msgrcv() ä¼šåœ¨é˜Ÿåˆ—æ»¡æˆ–ç©ºæ—¶é˜»å¡ç­‰å¾…ã€‚ 3. è®¾ç½®æ¶ˆæ¯é˜Ÿåˆ—å±æ€§åŸå‹ï¼š int msgctl(int msgqid, int cmd, struct msqid_ds *buf); å‚æ•°ï¼š msgqidï¼šæ¶ˆæ¯é˜Ÿåˆ—çš„æ ‡è¯†ç¬¦ã€‚ cmdï¼šæŒ‡å®šè¦æ‰§è¡Œçš„æ“ä½œï¼Œç³»ç»Ÿå®šä¹‰äº†ä¸‰ç§æ“ä½œï¼š IPC_STATï¼šè·å–æ¶ˆæ¯é˜Ÿåˆ—çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ buf æŒ‡å‘çš„åœ°å€ç©ºé—´ã€‚ IPC_SETï¼šè®¾ç½®æ¶ˆæ¯é˜Ÿåˆ—çš„å±æ€§ï¼Œå±æ€§ä¿¡æ¯å­˜å‚¨åœ¨ buf ä¸­ã€‚ IPC_RMIDï¼šä»å†…æ ¸ä¸­åˆ é™¤æŒ‡å®šçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ å®ä¾‹ï¼šä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„ç®€å•ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—ã€å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚ #include stdio.h#include sys/types.h#include sys/ipc.h#include sys/msg.h#include errno.h#define MSGKEY 1024struct msgstru long msgtype; // æ¶ˆæ¯ç±»å‹ char msgtext[2048]; // æ¶ˆæ¯å†…å®¹;void childproc() struct msgstru msgs; int msgid, ret_value; char str[512]; while (1) msgid = msgget(MSGKEY, IPC_EXCL); if (msgid 0) printf(æ¶ˆæ¯é˜Ÿåˆ—ä¸å­˜åœ¨! errno=%d [%s] , errno, strerror(errno)); sleep(5); continue; ret_value = msgrcv(msgid, msgs, sizeof(struct msgstru), 0, 0); printf(æ¥æ”¶åˆ°çš„æ¶ˆæ¯: [%s] è¿›ç¨‹ID: [%d] , msgs.msgtext, getpid()); return;int main() int i, cpid; for (i = 0; i 5; i++) cpid = fork(); if (cpid 0) printf(åˆ›å»ºå­è¿›ç¨‹å¤±è´¥ ); else if (cpid == 0) childproc(); å¦ä¸€ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—å¹¶å‘é€æ¶ˆæ¯ï¼š #include stdio.h#include sys/types.h#include sys/ipc.h#include sys/msg.h#include errno.h#define MSGKEY 1024struct msgstru long msgtype; // æ¶ˆæ¯ç±»å‹ char msgtext[2048]; // æ¶ˆæ¯å†…å®¹;int main() struct msgstru msgs; int msg_type; char str[256]; int ret_value; int msqid; msqid = msgget(MSGKEY, IPC_EXCL); if (msqid 0) msqid = msgget(MSGKEY, IPC_CREAT | 0666); if (msqid 0) printf(åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—å¤±è´¥ | errno=%d [%s] , errno, strerror(errno)); exit(-1); while (1) printf(è¾“å…¥æ¶ˆæ¯ç±»å‹[0=ç»“æŸè¿›ç¨‹]: ); scanf(%d, msg_type); if (msg_type == 0) break; printf(è¾“å…¥è¦å‘é€çš„æ¶ˆæ¯: ); scanf(%s, str); msgs.msgtype = msg_type; strcpy(msgs.msgtext, str); ret_value = msgsnd(msqid, msgs, sizeof(struct msgstru), IPC_NOWAIT); if (ret_value 0) printf(msgsnd() å‘é€æ¶ˆæ¯å¤±è´¥, errno=%d [%s] , errno, strerror(errno)); exit(-1); msgctl(msqid, IPC_RMID, 0); // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ— åœ¨è¿™äº›ç¤ºä¾‹ä¸­ï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åé€šè¿‡ msgsnd() å‡½æ•°å‘é€æ¶ˆæ¯ï¼Œæ¥ç€é€šè¿‡ msgrcv() å‡½æ•°æ¥æ”¶æ¶ˆæ¯ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼Œå±•ç¤ºäº†æ¶ˆæ¯é˜Ÿåˆ—åœ¨å¤šè¿›ç¨‹é€šä¿¡ä¸­çš„æœ‰æ•ˆæ€§ã€‚","tags":["clippings"],"categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€"]},{"title":"æ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡ç¤ºä¾‹-CSDNåšå®¢","path":"/2024/12/25/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-æ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡ç¤ºä¾‹-CSDNåšå®¢/","content":"/* msglucy.c */#include sys/ipc.h // å¼•å…¥IPCç›¸å…³çš„å¤´æ–‡ä»¶#include sys/msg.h // å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ç›¸å…³çš„å¤´æ–‡ä»¶#include sys/stat.h // å¼•å…¥æ–‡ä»¶çŠ¶æ€ç›¸å…³çš„å¤´æ–‡ä»¶#include sys/types.h // å¼•å…¥æ•°æ®ç±»å‹ç›¸å…³çš„å¤´æ–‡ä»¶#include stdio.h // å¼•å…¥æ ‡å‡†è¾“å…¥è¾“å‡ºåº“#include fcntl.h // å¼•å…¥æ–‡ä»¶æ§åˆ¶ç›¸å…³çš„å¤´æ–‡ä»¶#include signal.h // å¼•å…¥ä¿¡å·å¤„ç†ç›¸å…³çš„å¤´æ–‡ä»¶#include stdlib.h // å¼•å…¥æ ‡å‡†åº“#include string.h // å¼•å…¥å­—ç¬¦ä¸²å¤„ç†ç›¸å…³çš„å¤´æ–‡ä»¶#define PROJID 0XFF // å®šä¹‰é¡¹ç›®IDï¼Œç”¨äºç”Ÿæˆå”¯ä¸€çš„æ¶ˆæ¯é˜Ÿåˆ—é”®#define LUCY 1 // å®šä¹‰LUCYçš„æ¶ˆæ¯ç±»å‹#define PETER 2 // å®šä¹‰PETERçš„æ¶ˆæ¯ç±»å‹int mqid; // æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦// ç»ˆæ­¢å¤„ç†å‡½æ•°void terminate_handler(int signo) msgctl(mqid, IPC_RMID, NULL); // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ— exit(0); // é€€å‡ºç¨‹åºint main() char filenm[] = msg; // å®šä¹‰ç”¨äºç”Ÿæˆæ¶ˆæ¯é˜Ÿåˆ—é”®çš„æ–‡ä»¶å key_t mqkey; // æ¶ˆæ¯é˜Ÿåˆ—é”® struct msgbuf long mtype; // æ¶ˆæ¯ç±»å‹ char mtext[256]; // æ¶ˆæ¯å†…å®¹ msg; int ret; // ç”Ÿæˆæ¶ˆæ¯é˜Ÿåˆ—é”® mqkey = ftok(filenm, PROJID); if (mqkey == -1) perror(ftok error:); // è¾“å‡ºé”™è¯¯ä¿¡æ¯ exit(-1); // é€€å‡ºç¨‹åº // åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º mqid = msgget(mqkey, IPC_CREAT | IPC_EXCL | 0666); if (mqid == -1) perror(msgget error:); // è¾“å‡ºé”™è¯¯ä¿¡æ¯ exit(-1); // é€€å‡ºç¨‹åº // æ³¨å†Œä¿¡å·å¤„ç†å‡½æ•° signal(SIGINT, terminate_handler); // å¤„ç†ç»ˆç«¯ä¸­æ–­ä¿¡å· signal(SIGTERM, terminate_handler); // å¤„ç†ç»ˆæ­¢ä¿¡å· while (1) printf(Lucy:); fgets(msg.mtext, 256, stdin); // ä»æ ‡å‡†è¾“å…¥è·å–æ¶ˆæ¯å†…å®¹ if (strncmp(quit, msg.mtext, 4) == 0) msgctl(mqid, IPC_RMID, NULL); // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—å’Œæ•°æ® exit(0); // é€€å‡ºç¨‹åº msg.mtext[strlen(msg.mtext) - 1] = \\0; // å»æ‰æ¢è¡Œç¬¦ msg.mtype = LUCY; // è®¾ç½®æ¶ˆæ¯ç±»å‹ä¸ºLUCY msgsnd(mqid, msg, strlen(msg.mtext) + 1, 0); // å‘é€æ¶ˆæ¯ msgrcv(mqid, msg, 256, PETER, 0); // æ¥æ”¶æ¥è‡ªPETERçš„æ¶ˆæ¯ printf(Peter: %s , msg.mtext); // è¾“å‡ºPETERçš„æ¶ˆæ¯ /* msgpeter.c */#include sys/ipc.h // å¼•å…¥IPCç›¸å…³çš„å¤´æ–‡ä»¶#include sys/msg.h // å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ç›¸å…³çš„å¤´æ–‡ä»¶#include sys/stat.h // å¼•å…¥æ–‡ä»¶çŠ¶æ€ç›¸å…³çš„å¤´æ–‡ä»¶#include sys/types.h // å¼•å…¥æ•°æ®ç±»å‹ç›¸å…³çš„å¤´æ–‡ä»¶#include stdio.h // å¼•å…¥æ ‡å‡†è¾“å…¥è¾“å‡ºåº“#include fcntl.h // å¼•å…¥æ–‡ä»¶æ§åˆ¶ç›¸å…³çš„å¤´æ–‡ä»¶#include signal.h // å¼•å…¥ä¿¡å·å¤„ç†ç›¸å…³çš„å¤´æ–‡ä»¶#include stdlib.h // å¼•å…¥æ ‡å‡†åº“#include string.h // å¼•å…¥å­—ç¬¦ä¸²å¤„ç†ç›¸å…³çš„å¤´æ–‡ä»¶#define PROJID 0XFF // å®šä¹‰é¡¹ç›®IDï¼Œç”¨äºç”Ÿæˆå”¯ä¸€çš„æ¶ˆæ¯é˜Ÿåˆ—é”®#define LUCY 1 // å®šä¹‰LUCYçš„æ¶ˆæ¯ç±»å‹#define PETER 2 // å®šä¹‰PETERçš„æ¶ˆæ¯ç±»å‹int main() char filenm[] = msg; // å®šä¹‰ç”¨äºç”Ÿæˆæ¶ˆæ¯é˜Ÿåˆ—é”®çš„æ–‡ä»¶å int mqid; // æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦ key_t mqkey; // æ¶ˆæ¯é˜Ÿåˆ—é”® struct msgbuf long mtype; // æ¶ˆæ¯ç±»å‹ char mtext[256]; // æ¶ˆæ¯å†…å®¹ msg; int ret; // ç”Ÿæˆæ¶ˆæ¯é˜Ÿåˆ—é”® mqkey = ftok(filenm, PROJID); if (mqkey == -1) perror(ftok error:); // è¾“å‡ºé”™è¯¯ä¿¡æ¯ exit(-1); // é€€å‡ºç¨‹åº // è·å–æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦ mqid = msgget(mqkey, 0); if (mqid == -1) perror(msgget error:); // è¾“å‡ºé”™è¯¯ä¿¡æ¯ exit(-1); // é€€å‡ºç¨‹åº while (1) msgrcv(mqid, msg, 256, LUCY, 0); // æ¥æ”¶æ¥è‡ªLUCYçš„æ¶ˆæ¯ printf(LUCY: %s , msg.mtext); // è¾“å‡ºLUCYçš„æ¶ˆæ¯ printf(Peter:); fgets(msg.mtext, 256, stdin); // ä»æ ‡å‡†è¾“å…¥è·å–æ¶ˆæ¯å†…å®¹ if (strncmp(quit, msg.mtext, 4) == 0) msgctl(mqid, IPC_RMID, NULL); // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ— exit(0); // é€€å‡ºç¨‹åº msg.mtext[strlen(msg.mtext) - 1] = \\0; // å»æ‰æ¢è¡Œç¬¦ msg.mtype = PETER; // è®¾ç½®æ¶ˆæ¯ç±»å‹ä¸ºPETER msgsnd(mqid, msg, strlen(msg.mtext) + 1, 0); // å‘é€æ¶ˆæ¯ ä»£ç è§£æ å¤´æ–‡ä»¶å¼•å…¥ï¼š ä»£ç ä¸­å¼•å…¥äº†å¤šä¸ªç³»ç»Ÿå¤´æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºå¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·ã€è¾“å…¥è¾“å‡ºç­‰åŠŸèƒ½ã€‚ å®å®šä¹‰ï¼š PROJIDã€LUCY å’Œ PETER åˆ†åˆ«å®šä¹‰äº†é¡¹ç›® ID å’Œæ¶ˆæ¯ç±»å‹ï¼Œç”¨äºæ ‡è¯†ä¸åŒçš„æ¶ˆæ¯å‘é€è€…ã€‚ æ¶ˆæ¯é˜Ÿåˆ—çš„åˆ›å»ºä¸ç®¡ç†ï¼š ä½¿ç”¨ ftok å‡½æ•°ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„æ¶ˆæ¯é˜Ÿåˆ—é”®ï¼Œè‹¥å¤±è´¥åˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶é€€å‡ºã€‚ ä½¿ç”¨ msgget åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè‹¥é˜Ÿåˆ—å·²å­˜åœ¨åˆ™è¿”å›é”™è¯¯ã€‚ ä¿¡å·å¤„ç†ï¼š æ³¨å†Œä¿¡å·å¤„ç†å‡½æ•° terminate_handlerï¼Œç”¨äºå¤„ç†ç¨‹åºç»ˆæ­¢æ—¶çš„æ¸…ç†å·¥ä½œï¼Œç¡®ä¿æ¶ˆæ¯é˜Ÿåˆ—è¢«åˆ é™¤ã€‚ æ¶ˆæ¯å‘é€ä¸æ¥æ”¶ï¼š åœ¨ while å¾ªç¯ä¸­ï¼Œç¨‹åºä¸æ–­è¯»å–ç”¨æˆ·è¾“å…¥å¹¶å‘é€æ¶ˆæ¯ã€‚ ä½¿ç”¨ fgets è·å–è¾“å…¥ï¼Œå¹¶é€šè¿‡ msgsnd å‘é€æ¶ˆæ¯ã€‚ ä½¿ç”¨ msgrcv æ¥æ”¶æ¥è‡ªå¦ä¸€è¿›ç¨‹çš„æ¶ˆæ¯ï¼Œå¹¶è¾“å‡ºã€‚ é€€å‡ºæœºåˆ¶ï¼š ç”¨æˆ·è¾“å…¥ â€œquitâ€ æ—¶ï¼Œç¨‹åºä¼šåˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—å¹¶é€€å‡ºã€‚ ä½¿ç”¨è¯´æ˜ åœ¨è¿è¡Œç¨‹åºä¹‹å‰ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªåä¸º msg çš„ç©ºæ–‡ä»¶ã€‚ é¦–å…ˆè¿è¡Œ lucy ç¨‹åºï¼Œç„¶åå†è¿è¡Œ peter ç¨‹åºï¼ŒäºŒè€…å¯ä»¥ç›¸äº’å‘é€ä¿¡æ¯ã€‚","tags":["clippings"],"categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€"]},{"title":"Dockerçš„GUIæ˜¾ç¤º","path":"/2024/12/23/1-å¹³å°ç³»ç»Ÿ-Docker-Dockerçš„GUIæ˜¾ç¤º/","content":"Docker å®¹å™¨å›¾å½¢ç•Œé¢æ˜¾ç¤ºçš„é…ç½®æ–¹æ³•Docker ä¸»è¦åŸºäºå‘½ä»¤è¡Œæ“ä½œï¼Œå¸¸ç”¨äºæœåŠ¡å™¨åç«¯ç®¡ç†ï¼Œå› æ­¤å®ƒåœ¨ä¼ ç»Ÿåº”ç”¨åœºæ™¯ä¸­å¯¹å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰è½¯ä»¶çš„éœ€æ±‚è¾ƒå°‘ã€‚ç„¶è€Œï¼Œç‰¹å®šæƒ…å†µï¼Œä¾‹å¦‚åœ¨ Docker å®¹å™¨å†…è¿è¡Œ GUI è½¯ä»¶æˆ–æ“ä½œæ‘„åƒå¤´è¾“å‡ºå›¾åƒæ—¶ï¼Œå¤„ç† Docker çš„â€œå¯è§†åŒ–â€é—®é¢˜å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚æ­¤å¤„æ‰€è¿°çš„â€œå¯è§†åŒ–â€å¹¶éé€šå¸¸æ‰€è§çš„ç½‘ç»œå¯è§†åŒ–ç®¡ç†å·¥å…·ã€‚ æ–¹å¼ä¸€ï¼šå¯åŠ¨å®¹å™¨æ—¶æ·»åŠ é…ç½®é€‰é¡¹å¯ä»¥æ¯”å–» Docker é•œåƒä¸ºä¸€å°æœªè¿æ¥æ˜¾ç¤ºå™¨çš„è®¡ç®—æœºï¼Œå°½ç®¡ç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œç¼ºä¹æ˜¾ç¤ºç»ˆç«¯ä½¿å¾—è¾“å‡ºç»“æœæ— å¤„å±•ç¤ºã€‚ç›®å‰ï¼Œä¸»æµçš„ Linux å›¾å½¢ç•Œé¢æœåŠ¡ X11 é‡‡ç”¨å®¢æˆ·ç«¯æœåŠ¡å™¨ï¼ˆClientServerï¼‰æ¨¡å¼ã€‚åœ¨å®¹å™¨å¯åŠ¨æ—¶å…±äº« Unix ç«¯å£æˆ–è®¾ç½®ä¸»æœºåå’Œç«¯å£ï¼Œä½¿å¾— Docker å¯è·å–æ˜¾ç¤ºè¾“å‡ºä½ç½®ï¼Œä»è€Œå®ç°ä¸ Linux ç³»ç»Ÿå…±äº«æ˜¾ç¤ºèµ„æºã€‚ åœ¨ä¸»ç³»ç»Ÿä¸­å…ˆå®‰è£…å¿…éœ€çš„å·¥å…·ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤å®Œæˆï¼š sudo apt-get install x11-xserver-utils å¼€æ”¾æƒé™ï¼Œä½¿æ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬ Dockerï¼‰èƒ½å¤Ÿè®¿é—® X11 æ˜¾ç¤ºæ¥å£ã€‚å¦‚æœæƒé™è®¾å®šå¤±è´¥ï¼Œå¯ä»¥è€ƒè™‘å¦‚ä¸‹è®¾ç½®ï¼Œå°†ç¯å¢ƒå˜é‡ DISPLAY è®¾ç½®ä¸ºé»˜è®¤æ˜¾ç¤ºï¼š xhost +æˆ–xhost +SI:localuser:$(id -un) #å…è®¸æœ¬åœ°ç”¨æˆ·è®¿é—®æ˜¾ç¤º $(id -un) å°†è¿”å›å½“å‰ç”¨æˆ·çš„ç”¨æˆ·å å¯åŠ¨ Docker å®¹å™¨æ—¶ï¼Œéœ€æ·»åŠ ä»¥ä¸‹é€‰é¡¹ï¼š -v /tmp/.X11-unix:/tmp/.X11-unix \\ # å…±äº«æœ¬åœ°çš„ Unix ç«¯å£-e DISPLAY=unix$DISPLAY \\ # è®¾ç½®ç¯å¢ƒå˜é‡ DISPLAY-e GDK_SCALE \\ # è®¾ç½® GDK çš„ç¼©æ”¾å› å­-e GDK_DPI_SCALE \\ # è®¾ç½® DPI çš„ç¼©æ”¾å› å­ é€šè¿‡æ­¤æ­¥éª¤å¯åŠ¨çš„å®¹å™¨å¯ä»¥å¦‚æœ¬åœ°åº”ç”¨ç¨‹åºèˆ¬è‡ªç”±æ˜¾ç¤ºå›¾å½¢ç•Œé¢ã€‚éœ€æ³¨æ„ï¼Œæ¯æ¬¡ç³»ç»Ÿé‡å¯åï¼Œéœ€åœ¨ä¸»æœºä¸Šå†æ¬¡æ‰§è¡Œ xhost + æ¥é‡æ–°æ‰“å¼€æƒé™ã€‚ $ docker run -d \\ -v /etc/localtime:/etc/localtime:ro \\ -v /tmp/.X11-unix:/tmp/.X11-unix \\ -e DISPLAY=unix$DISPLAY \\ -e GDK_SCALE \\ -e GDK_DPI_SCALE \\ --name libreoffice \\ jess/libreoffice docker run -it -e XDG_RUNTIME_DIR=/home/wangjl \\ -e WAYLAND_DISPLAY=$WAYLAND_DISPLAY \\ -v $XDG_RUNTIME_DIR/$WAYLAND_DISPLAY:/home/wangjl/$WAYLAND_DISPLAY \\ --user=`id -u`:`id -g` \\ -e QT_QPA_PLATFORM=wayland \\ -v /home/wangjl/:/home/wangjl \\ -e DISPLAY=:0 \\ --name gui -v /tmp/.X11-unix/:/tmp/.X11-unix/ \\ -e LANG=zh_CN.UTF-8 \\ --network host \\ ubuntu:20.04.gui /bin/bash -e XDG_RUNTIME_DIR=/home/wangjl: è®¾ç½® XDG è¿è¡Œæ—¶ç›®å½•ï¼Œç”¨äºå­˜æ”¾ä¸´æ—¶æ–‡ä»¶å’Œ Unix Socketã€‚ -e WAYLAND_DISPLAY=$WAYLAND_DISPLAY: å°† Wayland æ˜¾ç¤ºç¯å¢ƒå˜é‡ä¼ é€’ç»™å®¹å™¨ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºå¯ä½¿ç”¨ Waylandã€‚ -v $XDG_RUNTIME_DIR/$WAYLAND_DISPLAY:/home/wangjl/$WAYLAND_DISPLAY: å°†è¿è¡Œæ—¶çš„ Wayland Socket æŒ‚è½½åˆ°å®¹å™¨æŒ‡å®šè·¯å¾„ï¼Œæ”¯æŒå›¾å½¢ç•Œé¢ã€‚ --userï¼šä½¿ç”¨å½“å‰ç”¨æˆ·çš„ UID å’Œ GIDï¼Œç¡®ä¿æ–‡ä»¶æƒé™ä¸€è‡´ã€‚ -e QT_QPA_PLATFORM=wayland: ä¸º Qt åº”ç”¨ç¨‹åºé…ç½® Wayland å¹³å°ï¼Œç¡®ä¿åœ¨ Wayland ç¯å¢ƒä¸­æ¸²æŸ“ã€‚ -v /home/wangjl/:/home/wangjl: å°†ä¸»æœºç”¨æˆ·ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ï¼Œä»¥ä¾¿è®¿é—®ä¸»æœºæ–‡ä»¶ã€‚ -e DISPLAY=:0: è®¾ç½® X æ˜¾ç¤ºç¯å¢ƒå˜é‡ä¸º 0ï¼ŒæŒ‡å‘ X11 å›¾å½¢ä¼šè¯ã€‚ -v /tmp/.X11-unix/:/tmp/.X11-unix/: å°†ä¸»æœºçš„ X11 Unix Socket ç›®å½•æŒ‚è½½åˆ°å®¹å™¨ï¼Œæ”¯æŒ X11 åº”ç”¨ç¨‹åºã€‚ -e LANG=zh_CN.UTF-8: å°†å®¹å™¨çš„è¯­è¨€è®¾ç½®ä¸ºä¸­æ–‡ï¼Œç¡®ä¿ä¸­æ–‡å­—ç¬¦çš„æ­£å¸¸æ˜¾ç¤ºã€‚ --network host: ä½¿ç”¨ä¸»æœºç½‘ç»œï¼Œä»¤å®¹å™¨èƒ½ç›´æ¥è®¿é—®ä¸»æœºç½‘ç»œèµ„æºã€‚ ç¯å¢ƒå˜é‡ XDG_RUNTIME_DIR å’Œ WAYLAND_DISPLAY æ˜¯ Wayland è¿è¡Œæ‰€å¿…éœ€çš„ï¼Œå®ƒä»¬å…±åŒæŒ‡å‘ Wayland çš„ Unix Socket è·¯å¾„ã€‚åŒæ—¶ï¼Œå°† QT_QPA_PLATFORM è®¾ç½®ä¸º wayland å€Ÿä»¥ç¡®ä¿ Qt åº”ç”¨ç¨‹åºçš„å…¼å®¹æ€§ã€‚DISPLAY=:0 å’Œ /tmp/.X11-unix/ åˆ™æŒ‡å‘ X11 Socket è·¯å¾„ï¼Œä»¥ä¾¿è¿è¡Œä¾èµ– X11 çš„å›¾å½¢åº”ç”¨ã€‚ æ–¹å¼äºŒï¼šå·²å¯åŠ¨å®¹å™¨ä¿®æ”¹ç³»ç»Ÿå‚æ•°è‹¥åœ¨å·²è¿è¡Œå®¹å™¨ä¸­éœ€æ˜¾ç¤ºå›¾åƒï¼Œåˆ™å¯åº”ç”¨ä¸Šè¿°æ–¹æ³•ï¼Œè€Œæ— éœ€é‡å¯å®¹å™¨ã€‚è¿™ä¸€æ“ä½œæ€è·¯ä¾æ—§ä»¥ä¸»æœºä¸ Docker ä¸ºå®¢æˆ·ç«¯æœåŠ¡å™¨å…³ç³»ï¼Œé€šè¿‡ IP åœ°å€è¿›è¡Œæ˜ å°„ã€‚ ä½¿ç”¨ ifconfig å‘½ä»¤æ£€æŸ¥ä¸»æœºå’Œå®¹å™¨çš„ IP åœ°å€ç¤ºä¾‹ï¼š ä¸»æœº IPï¼šxxx Docker IPï¼šYYY åœ¨ Docker å®¹å™¨å†…éƒ¨ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†ç¯å¢ƒå˜é‡æ˜ å°„è‡³ä¸»æœº IPï¼š export DISPLAY=XXX åœ¨ä¸»æœºä¸­ä¿®æ”¹ LightDM é…ç½®ï¼Œä»¥å…è®¸ TCP è¿æ¥ï¼š sudo gedit /etc/lightdm/lightdm.conf # å¢åŠ ä¸€è¡Œ xserver-allow-tcp=truesudo systemctl restart lightdmxhost + # æ³¨æ„åŠ å·å‰çš„ç©ºæ ¼ é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œæ¯æ¬¡é‡å¯åä»éœ€åœ¨ä¸»æœºæ‰§è¡Œ xhost +ï¼Œå¹¶åœ¨ Docker å†…æ‰§è¡Œ export DISPLAY=XXXã€‚è¯¥æ–¹æ³•ä¾èµ– IP åœ°å€ï¼Œè‹¥ç³»ç»Ÿæœªè”ç½‘ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ— æ³•è·å–æœ‰æ•ˆ IPã€‚ æ–¹å¼ä¸‰ï¼šVNC åœ¨ä¸»ç³»ç»Ÿä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…å¿…è¦å·¥å…·ï¼ŒåŒ…æ‹¬ X11 æœåŠ¡å™¨çš„ç›¸å…³å®ç”¨ç¨‹åºï¼Œé€šå¸¸ç”¨äºç®¡ç† GUIï¼š sudo apt-get install x11-xserver-utils å¼€æ”¾æƒé™ï¼Œä»¥ä½¿æ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬ Dockerï¼‰èƒ½å¤Ÿä½¿ç”¨ X11 æ˜¾ç¤ºæ¥å£ï¼Œå¹¶ç¡®ä¿ VNC çš„æ­£å¸¸è¿è¡Œã€‚å¦‚æœæƒé™è®¾å®šå¤±è´¥ï¼Œå¯å°†æ˜¾ç¤ºç¯å¢ƒå˜é‡è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼š export DISPLAY=:0.0 ç„¶åç»™äºˆè®¿é—®æƒé™ï¼š xhost + å®‰è£… VNC æœåŠ¡å™¨ï¼Œä»¥æ”¯æŒè¿œç¨‹æ¡Œé¢ç®¡ç†ï¼š sudo apt install tigervnc-standalone-server åˆ›å»ºé…ç½®æ–‡ä»¶å­˜å‚¨ VNC å¯åŠ¨å‚æ•°ï¼š touch $HOME/.vnc/xstartup ç¼–è¾‘è¯¥é…ç½®æ–‡ä»¶ä»¥æ·»åŠ å¿…è¦çš„å¯åŠ¨ä»£ç ã€‚æ‰“å¼€é…ç½®æ–‡ä»¶å¹¶ä½¿ç”¨ VIM ç¼–è¾‘ï¼š vim $HOME/.vnc/xstartup æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š #!/bin/shunset SESSION_MANAGERunset DBUS_SESSION_BUS_ADDRESS/etc/X11/xinit/xinitrc# å‡è®¾ç³»ç»Ÿä¸­é¢„è£…äº† Gnome æˆ– KDEï¼Œå¯åŠ¨é»˜è®¤æ¡Œé¢ç¯å¢ƒ# ç”¨æˆ·æ³¨é”€æ—¶è‡ªåŠ¨ç»ˆæ­¢ä¼šè¯if [ -e /usr/bin/gnome-session -o -e /usr/bin/startkde ]; then vncserver -kill $DISPLAYfi ä¸ºæ–°åˆ›å»ºçš„å¯åŠ¨æ–‡ä»¶æ·»åŠ æ‰§è¡Œæƒé™ï¼Œä»¥ç¡®ä¿æ­£ç¡®æ‰§è¡Œï¼š chmod u+x $HOME/.vnc/xstartup å¯åŠ¨ VNC æœåŠ¡å™¨ï¼Œè®¾å®šæ˜¾ç¤ºå±å·å’Œåˆ†è¾¨ç‡ï¼Œå‚æ•°ä¸­å¯å®šä¹‰æ‰€éœ€æ˜¾ç¤ºçš„åˆ†è¾¨ç‡ä¸é¢œè‰²æ·±åº¦ã€‚ä¾‹å¦‚ï¼Œé€šå¸¸å¯è®¾ç½®ä¸º 1920x1000 åˆ†è¾¨ç‡ã€24 ä½é¢œè‰²æ·±åº¦ï¼Œå¹¶å…è®¸å¤–éƒ¨è®¿é—®ï¼š vncserver :1 -geometry 1920x1000 -depth 24 -localhost no å¯åŠ¨ Docker å®¹å™¨å¹¶å°†å…¶è¿æ¥è‡³ VNC æœåŠ¡å™¨ï¼Œå®ç°è¿œç¨‹æ“ä½œã€‚ä»¥ä¸‹å‘½ä»¤å¯åŠ¨æŒ‡å®š Docker å®¹å™¨ï¼Œç¡®ä¿é…ç½®äº†å‡†ç¡®çš„ç¯å¢ƒå˜é‡å’Œæ–‡ä»¶æŒ‚è½½ï¼š docker run -dit -P \\ -e DISPLAY=$DISPLAY \\ --privileged \\ --network=host \\ -v /tmp/.X11-unix:/tmp/.X11-unix:rw \\ -v /dev/bus/usb:/dev/bus/usb \\ -v /home/lfxs/StudioData:/StudioData \\ --name qoriq/arm64-ubuntu mydb:0.1 /bin/bash è§£æ Docker å¯åŠ¨å‚æ•°ï¼š -d: å°†å®¹å™¨è®¾ç½®ä¸ºåå°è¿è¡Œï¼Œå¹¶è¿”å›å®¹å™¨ IDã€‚ -i: è¡¨ç¤ºå®¹å™¨ä»¥äº¤äº’æ¨¡å¼è¿è¡Œï¼Œé€šå¸¸ç»“åˆ -t ä½¿ç”¨ï¼Œä»¥å¯ç”¨ä¼ªç»ˆç«¯ã€‚ -P: éšæœºç«¯å£æ˜ å°„ï¼Œå°†å®¹å™¨å†…éƒ¨ç«¯å£éšæœºæ˜ å°„åˆ°å®¿ä¸»æœºç«¯å£ã€‚ -p: è‡ªå®šä¹‰ç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸ºï¼šä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ã€‚ -e: è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä»¥å†³å®šå®¹å™¨çš„æ“ä½œç¯å¢ƒã€‚ --privileged: ä½¿å®¹å™¨è·å¾— root æƒé™ï¼Œå…è®¸æ›´å¹¿æ³›çš„æ“ä½œã€‚ --network: æŒ‡å®šå®¹å™¨ç½‘ç»œè¿æ¥ç±»å‹ï¼Œæ”¯æŒ bridgeã€hostã€none å’Œ container ç­‰ç±»å‹ã€‚ -v: ç»‘å®šå·ï¼Œä»¥å®ç°å®¿ä¸»æœºä¸å®¹å™¨ä¹‹é—´çš„æ–‡ä»¶å…±äº«ã€‚ --name: å®šä¹‰å®¹å™¨åç§°ï¼Œä¾¿äºåç»­ç®¡ç†ã€‚ æµ‹è¯•å›¾åƒç•Œé¢æ˜¾ç¤ºåœ¨ Docker ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å®‰è£…å¹¶æµ‹è¯•ï¼š sudo apt-get install xarclock # å®‰è£… xarclock å°ç¨‹åºxarclock # è¿è¡Œæµ‹è¯• å¯åŠ¨æŒ‡å®š GUI åº”ç”¨ç¨‹åºå®¹å™¨å¯åŠ¨å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤åœ¨å®¹å™¨å†…è¿è¡Œå›¾å½¢ç•Œé¢ç¨‹åºï¼š docker exec -it gui calibredocker exec -it gui /opt/deepinwine/apps/Deepin-WeChat/run.sh docker exec å‘½ä»¤å…è®¸åœ¨å·²ç»è¿è¡Œçš„å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤ï¼Œå…¶ä¸­ gui ä¸ºå®¹å™¨åç§°ã€‚é€šè¿‡æ­¤å‘½ä»¤å¯å¯åŠ¨å›¾å½¢ç¨‹åºï¼Œè¯¥ç¨‹åºè¡¨ç°å¦‚åŒæœ¬åœ°åº”ç”¨ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Docker"]},{"title":"Dockeréƒ¨ç½²","path":"/2024/12/20/1-å¹³å°ç³»ç»Ÿ-Docker-Dockeréƒ¨ç½²/","content":"ç¯å¢ƒåœ¨å®‰è£… docker æ—¶ï¼Œå‘ç° docker æœ‰å¤šä¸ªç‰ˆæœ¬ï¼š docker.ioï¼šdebianubuntu å®˜æ–¹åŸºäº docker ç¤¾åŒºæºç å°è£…çš„ç‰ˆæœ¬ï¼Œå°† docker çš„ä¾èµ–ç›´æ¥è½¬æ¥åˆ°ä¸»ç³»ç»Ÿä¸Šã€‚docker.ioÂ é‡‡ç”¨ apt çš„æ–¹å¼ç®¡ç†ä¾èµ– ã€‚ docker-ceï¼šdocker.com æ”¾å‡ºæ¥çš„ç¤¾åŒºç‰ˆï¼Œä½¿ç”¨ golang å°†ä¾èµ–å°è£…åœ¨ä¸€ä¸ªåŒ…ä¸­ã€‚ç”¨ go çš„æ–¹å¼ç®¡ç†ä¾èµ–ï¼Œä¼šè‡ªå·±ç®¡ç†æ‰€æœ‰çš„ä¾èµ–ã€‚ docker-eeï¼šdocker.com ç»´æŠ¤çš„å•†ä¸šç‰ˆ å®‰è£… Docker åŠ Docker-composeDocker Compose æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨å®ƒè½»æ¾å®šä¹‰å’Œå¯åŠ¨ Docker ä¸­çš„å¤šå®¹å™¨åº”ç”¨ç¨‹åºã€‚ ä½¿ç”¨ Composeï¼Œå¯ä»¥åœ¨å•ä¸ª YAML æ–‡ä»¶ä¸­å®šä¹‰æ‰€æœ‰æœåŠ¡ï¼Œå¹¶ä¸”ä½¿ç”¨å•ä¸ªå‘½ä»¤ï¼Œå¯ä»¥å¯åŠ¨æˆ–æ‹†é™¤æ‰€æœ‰æœåŠ¡ã€‚ åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œä»¬å°†ä½¿ç”¨ Docker Compose åœ¨éš”ç¦»çš„å®¹å™¨åŒ–ç¯å¢ƒä¸­å¹¶æ’è¿è¡Œä¸¤ä¸ªå®¹å™¨ï¼ˆWordPress å’Œ MySQLï¼‰ã€‚ å®‰è£… dockerï¼Œå¦‚æœä¹‹å‰å·²ç»å®‰è£…è¿‡æ—§ç‰ˆæœ¬çš„ dockerï¼Œåœ¨å®‰è£…çš„æ—¶å€™éœ€è¦å¸è½½æ—§ç‰ˆæœ¬ apt install docker.ioapt install docker-compose ç¡®è®¤ç‰ˆæœ¬ docker versiondocker-compose version å¯åŠ¨ docker sudo service docker start Docker â€“ å®ˆæŠ¤å¼å®¹å™¨ä»€ä¹ˆæ˜¯å®ˆæŠ¤å¼å®¹å™¨å®ˆæŠ¤å¼å®¹å™¨æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å®¹å™¨ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹å¾ï¼š èƒ½å¤Ÿé•¿æœŸè¿è¡Œï¼šä¸äº¤äº’å¼å®¹å™¨ä¸åŒï¼Œå®ˆæŠ¤å¼å®¹å™¨è®¾è®¡ä¸ºåœ¨åå°æŒç»­è¿è¡Œï¼Œè€Œä¸éœ€è¦ç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚æ­¤ç‰¹æ€§ä½¿å¾—å®ˆæŠ¤å¼å®¹å™¨é€‚åˆæ‰¿è½½é•¿æœŸæ‰§è¡Œçš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚ æ²¡æœ‰äº¤äº’å¼ä¼šè¯ï¼šå®ˆæŠ¤å¼å®¹å™¨ä¸€æ—¦å¯åŠ¨ï¼Œä¾¿æ— éœ€ä»»ä½•ç›´æ¥çš„å‘½ä»¤è¾“å…¥æˆ–è¾“å‡ºã€‚é€‚ç”¨äºéœ€è¦å®šæ—¶ä»»åŠ¡ã€æœåŠ¡å™¨ã€å¾®æœåŠ¡ç­‰åœºæ™¯ã€‚ ä»¥å®ˆæŠ¤å½¢å¼è¿è¡Œå®¹å™¨ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä»¥äº¤äº’æ¨¡å¼å¯åŠ¨å®¹å™¨ï¼Œç„¶åå¯ä»¥é€šè¿‡å¿«æ·é”®é€€å‡ºï¼š docker run -i -t IMAGE /bin/bash Ctrl + P + Ctrl + Qï¼šä½¿ç”¨ Ctrl + P ç´§æ¥ç€æŒ‰ Ctrl + Q çš„ç»„åˆé”®å¯ä»¥å®‰å…¨é€€å‡ºäº¤äº’å¼å®¹å™¨çš„ bash è€Œä¸åœæ­¢å®¹å™¨ã€‚æ­¤æ“ä½œå°†å®¹å™¨æ”¾ç½®äºåå°è¿è¡Œã€‚ è¦ä»¥å®ˆæŠ¤å½¢å¼è¿è¡Œå®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š docker run -d é•œåƒå [COMMAND] [ARG...] -dï¼šæŒ‡ç¤ºè¯¥å®¹å™¨åœ¨åå°è¿è¡Œã€‚ä¸€æ—¦æ‰§è¡Œçš„å‘½ä»¤å®Œæˆï¼Œå®¹å™¨ä¾ç„¶å¯èƒ½ä¼šåœæ­¢ï¼Œå¦‚æœéœ€è¦æŒç»­è¿è¡Œï¼Œå°±è¦é€‰ç”¨å¯ä»¥é•¿æ—¶é—´æ‰§è¡Œçš„å‘½ä»¤ã€‚ é™„åŠ åˆ°è¿è¡Œä¸­çš„å®¹å™¨åœ¨éœ€è¦å¯¹æ­£åœ¨è¿è¡Œçš„å®¹å™¨è¿›è¡Œè¿›ä¸€æ­¥æ“ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š docker attach å®¹å™¨å é€šè¿‡æ­¤å‘½ä»¤ï¼Œå¯å°†å½“å‰ç»ˆç«¯é™„åŠ è‡³æŒ‡å®šå®¹å™¨ï¼Œä»è€Œç›´æ¥ä¸ä¹‹äº¤äº’ã€‚ å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨ï¼š docker run -d é•œåƒå [COMMAND] [ARG...] å°†å‘½ä»¤ä»¥åå°å½¢å¼è¿è¡Œï¼ŒåŒæ ·éµå¾ªå®¹å™¨è¿è¡Œç»“æŸåå°†åœæ­¢çš„æƒ…å†µã€‚ æŸ¥çœ‹å®¹å™¨æ—¥å¿—è¦æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„è¿è¡Œæ—¥å¿—ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š docker logs [-f] [-t] [--tail] å®¹å™¨å ä»¥ä¸‹æ˜¯å„å‚æ•°çš„å…·ä½“å«ä¹‰ï¼š -fï¼šè¡¨ç¤ºå®æ—¶è·Ÿè¸ª(container logs)ï¼ŒæŒç»­è¾“å‡ºæ—¥å¿—çš„æ›´æ–°ã€‚é»˜è®¤è®¾ç½®ä¸º falseï¼Œå¦‚éœ€å®æ—¶æ›´æ–°ï¼Œå¯è®¾ä¸º trueã€‚ -tï¼šåœ¨æ—¥å¿—ä¿¡æ¯å‰åŠ ä¸Šæ—¶é—´æˆ³ï¼Œæ–¹ä¾¿è¿½è¸ªäº‹ä»¶çš„å‘ç”Ÿæ—¶é—´ï¼Œé»˜è®¤ä¸ºå…³é—­çŠ¶æ€ã€‚ â€“tailï¼šæŒ‡å®šè¿”å›æ—¥å¿—çš„æœ€åéƒ¨åˆ†ï¼Œæ¯”å¦‚ --tail=100 å°†åªè¿”å›æœ€å 100 æ¡æ—¥å¿—ã€‚å¦‚æœä¸æŒ‡å®šï¼Œåˆ™è¿”å›æ‰€æœ‰æ—¥å¿—ã€‚ æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œä¸­çš„è¿›ç¨‹æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨å†…çš„è¿›ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š docker top å®¹å™¨å æ­¤å‘½ä»¤ä¼šæ˜¾ç¤ºå®¹å™¨ä¸­æ´»è·ƒçš„è¿›ç¨‹åˆ—è¡¨ï¼Œä¾¿äºç”¨æˆ·ç†è§£å½“å‰å®¹å™¨çŠ¶æ€ã€‚ åœ¨è¿è¡Œä¸­çš„å®¹å™¨å†…å¯åŠ¨æ–°è¿›ç¨‹è¦åœ¨å·²è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œæ–°å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ï¼š docker exec [-d] [-i] [-t] å®¹å™¨å [COMMAND] [ARG...] ä½¿ç”¨ exec åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ç°æœ‰å®¹å™¨å†…å¯åŠ¨æ–°è¿›ç¨‹ï¼Œå¢å¼ºå®¹å™¨çš„çµæ´»æ€§ã€‚ å¦‚ä½•åœæ­¢å®ˆæŠ¤å¼å®¹å™¨åœæ­¢å®ˆæŠ¤å¼å®¹å™¨å¯é€šè¿‡ä»¥ä¸‹ä¸¤ç§å‘½ä»¤å®ç°ï¼š docker stop å®¹å™¨å åœæ­¢å‘½ä»¤ä¼šå‘è¯¥å®¹å™¨å‘é€ä¿¡å·ï¼Œè¦æ±‚å…¶ä¼˜é›…åœ°åœæ­¢è¿è¡Œï¼Œé€šå¸¸ä¼šæœ‰å‡ ç§’é’Ÿçš„ç­‰å¾…. docker kill å®¹å™¨å kill å‘½ä»¤åˆ™ç›´æ¥å¼ºåˆ¶åœæ­¢å®¹å™¨ï¼Œé€‚ç”¨äºå¿«èŠ‚å¥çš„å¼€å‘åœºæ™¯ï¼Œä½†ä¸å¤ªé€‚åˆç”Ÿäº§ç¯å¢ƒã€‚ Docker è®¾ç½®å›½å†…é•œåƒæºï¼ˆdocker pull è¶…æ—¶ï¼‰ä¿®æ”¹ Docker çš„é…ç½®æ–‡ä»¶è¦ä¿®æ”¹ Docker çš„è½¯ä»¶æºï¼Œéœ€è¦è°ƒæ•´ Docker çš„é…ç½®æ–‡ä»¶ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„é…ç½®æ–‡ä»¶ã€‚ä¿®æ”¹é•œåƒä»“åº“åœ°å€ï¼š sudo vim /etc/docker/daemon.json ä»¥ä¸‹æ˜¯é…ç½®æ–‡ä»¶çš„åŸºæœ¬å†…å®¹ç¤ºä¾‹ï¼š registry-mirrors: [ https://YOUR_ID.mirror.aliyuncs.com,//éœ€æ³¨å†Œ https://mirror.ccs.tencentyun.com,//éœ€æ³¨å†Œ https://docker.mirrors.ustc.edu.cn,\thttps://do.nark.eu.org,\thttps://dc.j8.work,\thttps://docker.m.daocloud.io,\thttps://dockerproxy.com,\thttps://docker.nju.edu.cn,\thttps://registry.docker-cn.com ] åœ¨å°† YOUR_ID.mirror.aliyuncs.com æ›¿æ¢ä¸ºå®é™…çš„é˜¿é‡Œäº‘åŠ é€Ÿå™¨åœ°å€ä¹‹åï¼Œä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚ é‡å¯ Docker æœåŠ¡å®Œæˆé…ç½®ä¿®æ”¹åï¼Œéœ€è¦é‡å¯ Docker æœåŠ¡ï¼Œä»¥åº”ç”¨æ–°çš„è®¾ç½®ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤é‡å¯ Dockerï¼š sudo systemctl daemon-reloadsudo systemctl restart docker æ‰§è¡Œå®Œè¿™äº›å‘½ä»¤åï¼ŒDocker å°†ä½¿ç”¨æ–°çš„é•œåƒæºã€‚ éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆå¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ Docker çš„ä¿¡æ¯ï¼Œä»¥ç¡®è®¤è½¯ä»¶æºæ˜¯å¦è®¾ç½®æˆåŠŸï¼š docker info åœ¨è¾“å‡ºä¿¡æ¯ä¸­ï¼Œå¯ä»¥æ‰¾åˆ° â€œRegistryâ€ éƒ¨åˆ†ï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«äº†åˆšæ‰è®¾ç½®çš„é•œåƒæºã€‚å¦‚æœæ˜¾ç¤ºäº†æ–°çš„é•œåƒåœ°å€ï¼Œè¯´æ˜è®¾ç½®å·²ç»æˆåŠŸã€‚ Docker ç½‘ç»œæ¨¡å¼Docker é€šè¿‡ä½¿ç”¨ Linux æ¡¥æ¥å®ç°å®¹å™¨ä¹‹é—´çš„ç›¸äº’é€šä¿¡ã€‚Docker æä¾›äº†å››ç§ç½‘ç»œæ¨¡å¼ï¼š host æ¨¡å¼ï¼Œä½¿ç”¨ --net=host æŒ‡å®šã€‚ container æ¨¡å¼ï¼Œä½¿ç”¨ --net=container:NAMEorID æŒ‡å®šã€‚ none æ¨¡å¼ï¼Œä½¿ç”¨ --net=none æŒ‡å®šã€‚ bridge æ¨¡å¼ï¼Œä½¿ç”¨ --net=bridge æŒ‡å®šï¼Œè¿™ä¹Ÿæ˜¯ Docker çš„é»˜è®¤é…ç½®ã€‚ host æ¨¡å¼åœ¨ host æ¨¡å¼ä¸‹ï¼Œå®¹å™¨ä¸ä¼šè·å–ç‹¬ç«‹çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œè€Œæ˜¯ä¸å®¿ä¸»æœºå…±äº«ç½‘ç»œå‘½åç©ºé—´ã€‚è¿™æ„å‘³ç€å®¹å™¨å°†ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ IP åœ°å€å’Œç«¯å£ï¼Œè€Œä¸éœ€è¦ä¸ºå®¹å™¨åˆ›å»ºè™šæ‹Ÿç½‘å¡æˆ–é…ç½® IP åœ°å€ã€‚å®é™…ä¸Šï¼Œå®¹å™¨çš„ç½‘ç»œåŠŸèƒ½è¡¨ç°å¾—å¦‚åŒç›´æ¥åœ¨å®¿ä¸»æœºä¸Šè¿è¡Œçš„ç¨‹åºä¸€æ ·ã€‚ç„¶è€Œï¼Œå®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿå’Œè¿›ç¨‹åˆ—è¡¨ä»ç„¶ä¸å®¿ä¸»æœºæ˜¯éš”ç¦»çš„ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå®¿ä¸»æœºçš„ IP åœ°å€æ˜¯ 192.168.0.10ï¼Œåˆ™åœ¨ host æ¨¡å¼ä¸‹è¿è¡Œçš„å®¹å™¨ä¹Ÿä¼šä½¿ç”¨è¯¥ IPï¼Œè€Œä¸éœ€è¦é¢å¤–çš„é…ç½®ã€‚è¿™ç§æ¨¡å¼é€‚åˆéœ€è¦é«˜æ€§èƒ½ç½‘ç»œé€šè®¯çš„åœºæ™¯ï¼Œæ¯”å¦‚è¿è¡Œæ•°æ®åº“æˆ–è€…é«˜ååé‡çš„æœåŠ¡ã€‚ container æ¨¡å¼container æ¨¡å¼å…è®¸æ–°åˆ›å»ºçš„å®¹å™¨ä¸å·²å­˜åœ¨çš„ä¸€ä¸ªå®¹å™¨å…±äº«åŒä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´ã€‚è¿™å¹¶ä¸æ„å‘³ç€æ–°å®¹å™¨ä¼šå’Œå®¿ä¸»æœºå…±äº«ç½‘ç»œï¼Œè€Œæ˜¯ä¸æŒ‡å®šçš„å®¹å™¨å…±äº« IP åœ°å€å’Œç«¯å£èŒƒå›´ã€‚æ–°å®¹å™¨åœ¨åˆ›å»ºæ—¶ä¸ä¼šåˆ†é…ç‹¬ç«‹çš„ç½‘å¡æˆ– IPï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨å…±äº«å®¹å™¨çš„ç½‘ç»œé…ç½®ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªå·²æœ‰çš„åä¸º my-container çš„å®¹å™¨ï¼Œå¦‚æœæƒ³è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è®©å®ƒä¸ my-container å…±äº«ç½‘ç»œï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š docker run -d --net=container:my-container nginx è¿™æ ·ï¼Œæ–°å®¹å™¨å°†èƒ½å¤Ÿä½¿ç”¨ my-container çš„ IP åœ°å€å’Œç«¯å£ï¼Œé€‚ç”¨äºéœ€è¦ç›¸äº’é€šä¿¡çš„å®¹å™¨åœºæ™¯ã€‚ none æ¨¡å¼åœ¨ none æ¨¡å¼ä¸‹ï¼ŒDocker å®¹å™¨ä¼šæ‹¥æœ‰è‡ªå·±çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œç„¶è€Œå®ƒä¸ä¼šè¢«åˆ†é…ä»»ä½•ç½‘ç»œé…ç½®ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ç§æ¨¡å¼ä¸‹å®¹å™¨æ²¡æœ‰ä»»ä½•ç½‘ç»œè¿æ¥ï¼Œéœ€è¦æ‰‹åŠ¨ä¸ºå®¹å™¨æ·»åŠ ç½‘å¡å¹¶é…ç½® IP åœ°å€ã€‚å®ƒé€‚åˆäºéœ€è¦å®Œå…¨è‡ªå®šä¹‰ç½‘ç»œé…ç½®çš„åœºæ™¯ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡æ­¤æ¨¡å¼è¿è¡Œä¸€ä¸ªå®¹å™¨è€Œä¸å¸Œæœ›å®ƒä¸ä»»ä½•å…¶ä»–ç½‘ç»œæœåŠ¡è¿›è¡Œè¿æ¥ï¼Œè¿›è¡Œéš”ç¦»æµ‹è¯•æ—¶ä¼šç”¨åˆ°è¿™ç§æ¨¡å¼ã€‚å‘½ä»¤å½¢å¼å¦‚ä¸‹ï¼š docker run -d --net=none nginx bridge æ¨¡å¼bridge æ¨¡å¼æ˜¯ Docker çš„é»˜è®¤ç½‘ç»œè®¾ç½®ï¼Œå®ƒä¼šä¸ºæ¯ä¸ªå®¹å™¨åˆ†é…ç‹¬ç«‹çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œå¹¶å°†å®¹å™¨è¿æ¥åˆ°ä¸€ä¸ªè™šæ‹Ÿç½‘æ¡¥ä¸Šã€‚æ¯å½“æ–°çš„å®¹å™¨è¢«åˆ›å»ºï¼ŒDocker ä¼šåœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªæ¡¥æ¥ç½‘ç»œï¼Œå®¹å™¨é€šè¿‡æ¡¥æ¥ç½‘ç»œä¸å®¿ä¸»æœºåŠå…¶ä»–å®¹å™¨è¿›è¡Œé€šä¿¡ã€‚ è¿™ç§æ¨¡å¼çš„å¸¸è§ç”¨æ³•æ˜¯åˆ©ç”¨é»˜è®¤çš„æ¡¥æ¥ç½‘ç»œåˆ›å»ºäº’è”çš„å¤šå®¹å™¨åº”ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå®¹å™¨éƒ½æ˜¯è®¾å¤‡è‡ªå·±çš„ç½‘ç»œå †æ ˆï¼Œå…·æœ‰ç‹¬ç«‹çš„ IP åœ°å€ã€‚ä¾‹å¦‚ï¼Œå½“æ‚¨åœ¨ bridge æ¨¡å¼ä¸‹å¯åŠ¨ä¸€ä¸ª Nginx å®¹å™¨æ—¶ï¼Œé‚£ä¹ˆå®ƒå°†æœ‰è‡ªå·±çš„ IP åœ°å€ï¼Œä»è€Œä¸å®¿ä¸»æœºçš„ IP åœ°å€ç›¸äº’åŒºåˆ«ã€‚ è¿è¡Œå®¹å™¨ç¤ºä¾‹è¿è¡Œå®¹å™¨çš„åŸºæœ¬å‘½ä»¤å¦‚ä¸‹ï¼š [root@centos7 ~]# docker run -d -P nginx æ­¤å‘½ä»¤å°†å¯åŠ¨ä¸€ä¸ª Nginx å®¹å™¨ï¼Œå°†å…¶å¯åŠ¨ä¸ºåå°è¿›ç¨‹ã€‚å‘½ä»¤æ‰§è¡Œåï¼Œä¼šå¾—åˆ°ä¸€ä¸ªå®¹å™¨ IDï¼š 6135db66a7d7c1237901a79974f88f1079b3d467c14ce83fc46bc6b4eb8b3240 å¯ä»¥é€šè¿‡æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨æ¥ç¡®è®¤å®¹å™¨çš„çŠ¶æ€ï¼š [root@centos7 ~]# docker ps è¾“å‡ºå¯èƒ½å¦‚ä¸‹ï¼š CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES6135db66a7d7 nginx nginx -g daemon off 33 seconds ago Up 31 seconds 0.0.0.0:32769-80/tcp, 0.0.0.0:32768-443/tcp gigantic_meitner å¦‚ä¸Šæ‰€ç¤ºï¼ŒNginx å®¹å™¨çš„ç«¯å£ 80 å’Œ 443 è¢«éšæœºæ˜ å°„åˆ°å®¿ä¸»æœºçš„ 32769 å’Œ 32768ã€‚ å‚æ•°è¯´æ˜ -Pï¼šéšæœºç«¯å£æ˜ å°„ä¸ºå®¹å™¨ç«¯å£ï¼Œé€‚åˆæƒ³å¿«é€Ÿæµ‹è¯•æœåŠ¡çš„æƒ…æ™¯ã€‚ -pï¼šæŒ‡å®šç«¯å£æ˜ å°„ï¼Œå…è®¸ç”¨æˆ·è‡ªå®šä¹‰ä¸»æœºç«¯å£ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å°† Nginx å¯åŠ¨äºå®¿ä¸»æœº 81 ç«¯å£ï¼š [root@centos7 ~]# docker run -d -p 81:80 nginx è¿è¡Œåï¼Œè¾“å‡ºçš„å®¹å™¨ ID å°†ç±»ä¼¼äºï¼š 3ca9f847bebec3684952b0f2c081d31f84b9489de50b635246d9a592cc06d46c å†æ¬¡è¿è¡Œ docker ps å‘½ä»¤å¯ä»¥æŸ¥çœ‹ï¼š CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES3ca9f847bebe nginx nginx -g daemon off 8 seconds ago Up 6 seconds 443/tcp, 0.0.0.0:81-80/tcp goofy_mcnulty å¯ä»¥é€šè¿‡å®¿ä¸»æœºçš„ http://localhost:81 åœ°å€æ¥è®¿é—® Nginx æœåŠ¡ã€‚ Docker æ•°æ®å­˜å‚¨ç®¡ç†æ•°æ®çš„æ–¹å¼Docker æä¾›ä¸¤ç§ç®¡ç†æ•°æ®çš„æ–¹å¼ï¼šæ•°æ®å· å’Œ æ•°æ®å·å®¹å™¨ã€‚ æ•°æ®å·æ•°æ®å·æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä¸“é—¨æŒ‡å®šçš„ç›®å½•ï¼Œè¿™äº›ç›®å½•ç»•è¿‡äº† Union File Systemï¼Œä¸ºæŒç»­æ€§æˆ–å…±äº«æ•°æ®æä¾›äº†è¯¸å¤šåŠŸèƒ½ï¼š æ•°æ®å…±äº«ä¸é‡ç”¨ï¼šæ•°æ®å·å¯ä»¥åœ¨å¤šä¸ªå®¹å™¨ä¹‹é—´å…±äº«ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®å·åœ¨ç”Ÿäº§ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒä¸­åå¤ä½¿ç”¨ç›¸åŒçš„æ•°æ®åº“å†…å®¹ã€‚ ç›´æ¥æ•°æ®ä¿®æ”¹ï¼šå¯¹æ•°æ®å·ä¸­çš„æ•°æ®è¿›è¡Œæ›´æ”¹æ—¶ï¼Œä¼šç›´æ¥åœ¨æ•°æ®å·ä¸­åæ˜ ï¼Œè€Œæ— éœ€å°†æ•°æ®ä»å®¹å™¨ä¸­å¯¼å‡ºå†å¯¼å…¥ã€‚è¿™ç§æ“ä½œçš„é«˜æ•ˆæ€§éå¸¸é€‚åˆæ•°æ®åº“ç­‰é«˜é¢‘æ¬¡è®¿é—®çš„åº”ç”¨åœºæ™¯ã€‚å¦‚æœä¸€ä¸ªå®¹å™¨æ­£åœ¨è¿è¡Œå¹¶ä¿®æ”¹äº†å·ä¸­æ•°æ®ï¼Œå…¶ä»–å®¹å™¨å¯ä»¥ç«‹å³çœ‹åˆ°è¿™äº›ä¿®æ”¹ã€‚ æ•°æ®ç‹¬ç«‹æ€§ï¼šæ•°æ®å·ä¸­çš„æ•°æ®å¹¶ä¸è¢«åŒ…å«åœ¨å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸä¸­ã€‚å› æ­¤ï¼Œå³ä½¿å®¹å™¨è¢«åˆ é™¤ï¼Œæ•°æ®å·ä¸­çš„æ•°æ®ä¾ç„¶å­˜åœ¨ï¼Œç›´åˆ°æ‰€æœ‰å¼•ç”¨è¯¥æ•°æ®å·çš„å®¹å™¨éƒ½è¢«åˆ é™¤ä¸ºæ­¢ã€‚ å‚æ•°è¯´æ˜ -v /dataï¼šç›´æ¥å°†å®¿ä¸»æœºçš„ /data ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ /data ç›®å½•ã€‚ -v src:dstï¼šå°†å®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªç‰©ç†ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ç›®å½•ï¼Œå…¶ä¸­ src æ˜¯å®¿ä¸»æœºä¸Šçš„ç›®å½•ï¼Œdst æ˜¯å®¹å™¨å†…çš„ç›®å½•ã€‚ å®ä¾‹æ“ä½œå¯åŠ¨ä¸€ä¸ªæ–°çš„ CentOS å®¹å™¨ï¼Œå¹¶æŒ‚è½½å®¿ä¸»æœºä¸Šçš„ /data ç›®å½•ï¼š [root@centos7 ~]# docker run -it --name test-001 -v /data centos è¿›å…¥å®¹å™¨åï¼ŒæŸ¥çœ‹ /data ç›®å½•ï¼š [root@4578675314b9 /]# ls -l /data/total 0 æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ï¼š [root@centos7 ~]# docker ps è¿è¡Œç»“æœå¦‚ä¸‹ï¼š CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES4578675314b9 centos /bin/bash 2 minutes ago Up 2 minutes test-001 ä½¿ç”¨ docker inspect å‘½ä»¤æŸ¥çœ‹å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯ï¼š [root@centos7 ~]# docker inspect 4578675314b9 è¾“å‡ºä¸­çš„ Mounts å­—æ®µæ˜¾ç¤ºäº†å·²æŒ‚è½½çš„æ•°æ®å·ä¿¡æ¯ï¼š Mounts: [ Name: ab2f85f900a68813c4fdbf3b0fe88242247e7e8320bb75035b1367ab82804115, Source: /var/lib/docker/volumes/ab2f85f900a68813c4fdbf3b0fe88242247e7e8320bb75035b1367ab82804115/_data, Destination: /data, Driver: local, Mode: , RW: true, Propagation: ] è¿™è¡¨ç¤ºå®¹å™¨çš„å­˜å‚¨ç›®å½•å·²æŒ‚è½½åˆ°å®¿ä¸»æœºçš„ /dataã€‚ åœ¨å®¿ä¸»æœºä¸Šè¿›å…¥æ•°æ®å·çš„ç‰©ç†è·¯å¾„ï¼š [root@centos7 ~]# cd /var/lib/docker/volumes/ab2f85f900a68813c4fdbf3b0fe88242247e7e8320bb75035b1367ab82804115/_data[root@centos7 _data]# lltotal 0 åˆ›å»ºä¸€ä¸ªç›®å½•ï¼š [root@centos7 _data]# mkdir test åœ¨å®¹å™¨å†…æ£€æŸ¥åˆšåˆšåˆ›å»ºçš„ç›®å½•ï¼š [root@4578675314b9 /]# cd /data/[root@4578675314b9 data]# lltotal 0drwxr-xr-x 2 root root 6 Apr 10 08:54 test å¯ä»¥çœ‹åˆ°å®¹å™¨çš„æ•°æ®ç›®å½•ä¸­ä¹Ÿå­˜åœ¨åˆšåˆšåœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºçš„ test ç›®å½•ã€‚ æ­¤å¤–ï¼Œè¿˜å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æŒ‚è½½æ•°æ®ï¼š docker run -it -v /data1:/mnt centos æ­¤å‘½ä»¤ä¸­ï¼Œå‰è€…æ˜¯å®¿ä¸»æœºçš„ç›®å½•ï¼Œåè€…æ˜¯å®¹å™¨å†…çš„ç›®å½•ã€‚æŒ‚è½½æˆåŠŸåï¼Œå®¿ä¸»æœºä¸Šçš„ /data1 ç›®å½•ä¼šè‡ªåŠ¨åˆ›å»ºã€‚ [root@centos7 ~]# docker run -it -v /data1:/mnt centos[root@425569ce9eef /]# cd /mnt/[root@425569ce9eef mnt]# lltotal 0 åœ¨å®¿ä¸»æœºä¸Šå‘ /data1 å†™å…¥æ–‡ä»¶ï¼š [root@centos7 ~]# cd /data1/[root@centos7 data1]# echo hellotest.txt æ£€æŸ¥å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶å†…å®¹ï¼š [root@centos7 data1]# cat test.txthello åœ¨å®¹å™¨å†…æ£€æŸ¥ /mnt ç›®å½•ï¼š [root@425569ce9eef mnt]# lltotal 4-rw-r--r-- 1 root root 6 Apr 10 09:09 test.txt[root@425569ce9eef mnt]# cat test.txt hello è·å–å½“å‰å·¥ä½œç›®å½•å’Œå®¹å™¨ä¸»æœºåï¼š [root@425569ce9eef mnt]# pwd/mnt[root@425569ce9eef mnt]# hostname425569ce9eef è¿™ç§æ–¹æ³•éå¸¸é€‚åˆä»£ç å¼€å‘ç®¡ç†ï¼Œå¼€å‘è€…å¯ä»¥å°†ä»£ç ç›®å½•ç›´æ¥æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œæ–¹ä¾¿å®æ—¶ä¿®æ”¹ WEB ç«™ç‚¹ç›®å½•ã€‚ æŒ‡å®šæŒ‚è½½æƒé™ docker run -it -v /data2:/opt:ro centos æ­¤å‘½ä»¤å°† /data2 ä»¥åªè¯»æƒé™æŒ‚è½½åˆ° /opt ä¸­ã€‚ docker run -it -v /data2:/opt:rw centos æ­¤å‘½ä»¤å°† /data2 ä»¥è¯»å†™æƒé™æŒ‚è½½åˆ° /opt ä¸­ã€‚ æŒ‚è½½å•ä¸ªæ–‡ä»¶ docker run -it -v /root/file1:file1 centos è¿™ç§æ–¹æ³•ç”¨äºå°†å•ä¸ªæ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨ç›®å½•ä¸­ã€‚ å®¹å™¨å·çš„æ–¹å¼ä½¿ç”¨ --volumes-from é€‰é¡¹å¯ä»¥å…±äº«å…¶ä»–å®¹å™¨çš„ç›®å½•ï¼š [root@centos7 ~]# docker run -d --name mydocker -v /data centos æ¥ä¸‹æ¥ï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶å…±äº« mydocker çš„æ•°æ®å·ï¼š [root@centos7 ~]# docker run -it --name mynfs --volumes-from mydocker centos è¿›å…¥åˆ° mynfs å®¹å™¨å†…ï¼ŒæŸ¥çœ‹ /data ç›®å½•ï¼š [root@82a489adb07a /]# ll /data/total 0 ç„¶åè¿›å…¥ mydocker å®¹å™¨ï¼Œå†™å…¥æµ‹è¯•æ•°æ®ï¼š [root@centos7~]# cd /var/lib/docker/volumes/8421a48b58337a30ac4750c06748e01a3f328bdc2fa3b945d7f9737d9bc1b002/_data[root@centos7 _data]# echo welcome to herefile ç¡®è®¤å†™å…¥çš„æ•°æ®ï¼š [root@centos7 _data]# lltotal 4-rw-r--r-- 1 root root 16 Apr 10 17:34 file æœ€åæ£€æŸ¥ mynfs å®¹å™¨çš„æ•°æ®ç›®å½•ï¼š [root@82a489adb07a /]# cd /data/[root@82a489adb07a data]# lltotal 4-rw-r--r-- 1 root root 16 Apr 10 09:34 file[root@82a489adb07a data]# cat file welcome to here","categories":["1.å¹³å°ç³»ç»Ÿ","Docker"]},{"title":"å…³äº3568çš„OpenGL SC","path":"/2024/12/19/3-å¼€å‘æ¡†æ¶-OpenGL-å…³äº3568çš„OpenGL-SC/","content":"OpenGL çš„ç¡¬ä»¶å®ç°3568 èŠ¯ç‰‡é‡‡ç”¨çš„ GPU æ–¹æ¡ˆä¸º Mali-G52-2EEï¼Œè¯¥èŠ¯ç‰‡ç¡¬ä»¶æ¸²æŸ“é©±åŠ¨ä¸åŒ…å« SC ç‰ˆæœ¬ RK3568 è¯¦æƒ…é¡µé¢ https://www.forlinx.net/product/126.html è¯¥ GPU èŠ¯ç‰‡ç¡¬ä»¶æ¸²æŸ“éƒ¨åˆ†æ”¯æŒä»¥ä¸‹å‡ ä¸ªç‰ˆæœ¬ï¼š OpenGL ES 1.1, 2.0, 3.2 Vulkan 1.0,1.1 OpenCL 2.0 å…¶ä¸­ä¸åŒ…å« SC ç‰ˆæœ¬ï¼Œä¸” OpenGL ES ç‰ˆæœ¬å¹¶ä¸å…¼å®¹ SC ç‰ˆæœ¬ï¼ŒSC ç‰ˆæœ¬é’ˆå¯¹å®‰å…¨æ€§æ–¹é¢è¿›è¡Œäº†å¤šé¡¹æ”¹è¿›ã€‚éœ€è¦ç¡¬ä»¶å‚å•†æä¾›æ”¯æŒã€‚ OpenGL çš„è½¯ä»¶æ¸²æŸ“ç›®å‰å¼€æºçš„ä¸»æµ OpenGL è½¯ä»¶æ¸²æŸ“æ–¹æ¡ˆä¸º mesaï¼Œmesa æ–¹æ¡ˆä¸æ”¯æŒ SC mesa è½¯ä»¶æ¸²æŸ“æ–¹æ¡ˆä¸»è¦æ”¯æŒçš„ API åŒ…å« OpenGL ES OpenCLOpenMAXVDPAUVA-API Vulkan EGL Mesa è¯¦æƒ…é¡µé¢ https://docs.mesa3d.org/ æ‰€ä»¥è½¯ä»¶æ¸²æŸ“çš„å®ç°æ–¹æ¡ˆåªæœ‰æ ¹æ® OpenGL çš„è§„èŒƒå’Œæä¾›çš„ API å¤´æ–‡ä»¶è‡ªè¡Œç¼–å†™ç›¸åº”çš„å‡½æ•°å®ç°æ–¹å¼ã€‚ é¡¹ç›®åœ°å€ https://github.com/KhronosGroup/OpenGL-Registry å¼€å‘ SC ç‰ˆæœ¬éœ€é€šè¿‡ Khronos å®šä¹‰çš„ä¸€è‡´æ€§æµ‹è¯•å®˜æ–¹æ‰ä¼šæ‰¿è®¤ã€‚ ä¸€è‡´æ€§æµ‹è¯•è¯´æ˜é¡µé¢ https://www.khronos.org/adopters/conformance ç›®å‰å¸‚é¢ä¸Šæä¾›çš„ OpenGL SC çš„è§£å†³æ–¹æ¡ˆCoreAVI æä¾›çš„æ”¯æŒ OpenGL SC çš„èŠ¯ç‰‡ https://coreavi.com/product_category/gpus-socs-for-safety-critical/","categories":["3.å¼€å‘æ¡†æ¶","OpenGL"]},{"title":"åƒåœ¾å›æ”¶ï¼ˆGCï¼‰çš„ä¸‰ç§åŸºæœ¬æ–¹å¼  å¡ç“¦é‚¦å™¶ï¼","path":"/2024/12/19/6-å¼€å‘å·¥å…·-è°ƒè¯•-åƒåœ¾å›æ”¶ï¼ˆGCï¼‰çš„ä¸‰ç§åŸºæœ¬æ–¹å¼-å¡ç“¦é‚¦å™¶ï¼/","content":"åƒåœ¾ï¼ˆGarbageï¼‰å°±æ˜¯ç¨‹åºéœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡ä¸åœ¨è¢«ç›´æ¥æˆ–é—´æ¥åœ°å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±æˆä¸ºäº†ã€Œåƒåœ¾ã€ï¼Œå®ƒå ç”¨çš„å†…å­˜éœ€è¦åŠæ—¶åœ°é‡Šæ”¾ï¼Œå¦åˆ™å°±ä¼šå¼•èµ·ã€Œå†…å­˜æ³„éœ²ã€ã€‚æœ‰äº›è¯­è¨€éœ€è¦ç¨‹åºå‘˜æ¥æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ï¼ˆå›æ”¶åƒåœ¾ï¼‰ï¼Œæœ‰äº›è¯­è¨€æœ‰åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰ã€‚æœ¬æ–‡å°±æ¥è®¨è®º GC å®ç°çš„ä¸‰ç§åŸºæœ¬æ–¹å¼ã€‚ å…¶å®è¿™ä¸‰ç§æ–¹å¼ä¹Ÿå¯ä»¥å¤§ä½“å½’ä¸ºä¸¤ç±»ï¼šè·Ÿè¸ªå›æ”¶ï¼Œå¼•ç”¨è®¡æ•°ã€‚ç¾å›½ IBM çš„æ²ƒæ£®ç ”ç©¶ä¸­å¿ƒ David F.Bacon ç­‰äººå‘å¸ƒçš„ ã€Œåƒåœ¾å›æ”¶ç»Ÿä¸€ç†è®ºã€ ä¸€æ–‡é˜è¿°äº†ä¸€ä¸ªç†è®ºï¼šä»»ä½•åƒåœ¾å›æ”¶çš„æ€è·¯ï¼Œæ— éä»¥ä¸Šä¸¤ç§çš„ç»„åˆï¼Œå…¶ä¸­ä¸€ç§çš„æ”¹å–„å’Œè¿›æ­¥ï¼Œå¿…ç„¶ä¼´éšç€å¦ä¸€ç§çš„æ”¹å–„å’Œè¿›æ­¥ã€‚ è·Ÿè¸ªå›æ”¶è·Ÿè¸ªå›æ”¶çš„æ–¹å¼ç‹¬ç«‹äºç¨‹åºï¼Œå®šæœŸè¿è¡Œæ¥æ£€æŸ¥åƒåœ¾ï¼Œéœ€è¦è¾ƒé•¿æ—¶é—´çš„ä¸­æ–­ã€‚ æ ‡è®°æ¸…é™¤æ ‡è®°æ¸…é™¤çš„æ–¹å¼éœ€è¦å¯¹ç¨‹åºçš„å¯¹è±¡è¿›è¡Œä¸¤æ¬¡æ‰«æï¼Œç¬¬ä¸€æ¬¡ä»æ ¹ï¼ˆRootï¼‰å¼€å§‹æ‰«æï¼Œè¢«æ ¹å¼•ç”¨äº†çš„å¯¹è±¡æ ‡è®°ä¸ºä¸æ˜¯åƒåœ¾ï¼Œä¸æ˜¯åƒåœ¾çš„å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡åŒæ ·æ ‡è®°ä¸ºä¸æ˜¯åƒåœ¾ï¼Œä»¥æ­¤é€’å½’ã€‚æ‰€æœ‰ä¸æ˜¯åƒåœ¾çš„å¯¹è±¡çš„å¼•ç”¨éƒ½æ‰«æå®Œäº†ä¹‹åã€‚å°±è¿›è¡Œç¬¬äºŒæ¬¡æ‰«æï¼Œç¬¬ä¸€æ¬¡æ‰«æä¸­æ²¡æœ‰å¾—åˆ°æ ‡è®°çš„å¯¹è±¡å°±æ˜¯åƒåœ¾äº†ï¼Œå¯¹æ­¤è¿›è¡Œå›æ”¶ã€‚ å¤åˆ¶æ”¶é›†å¤åˆ¶æ”¶é›†çš„æ–¹å¼åªéœ€è¦å¯¹å¯¹è±¡è¿›è¡Œä¸€æ¬¡æ‰«æã€‚å‡†å¤‡ä¸€ä¸ªã€Œæ–°çš„ç©ºé—´ã€ï¼Œä»æ ¹å¼€å§‹ï¼Œå¯¹å¯¹è±¡è¿›è¡Œæ‰«ï¼Œå¦‚æœå­˜åœ¨å¯¹è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå°±æŠŠå®ƒå¤åˆ¶åˆ°ã€Œæ–°ç©ºé—´ä¸­ã€ã€‚ä¸€æ¬¡æ‰«æç»“æŸä¹‹åï¼Œæ‰€æœ‰å­˜åœ¨äºã€Œæ–°ç©ºé—´ã€çš„å¯¹è±¡å°±æ˜¯æ‰€æœ‰çš„éåƒåœ¾å¯¹è±¡ã€‚ è¿™ä¸¤ç§æ–¹å¼å„æœ‰åƒç§‹ï¼Œæ ‡è®°æ¸…é™¤çš„æ–¹å¼èŠ‚çœå†…å­˜ä½†æ˜¯ä¸¤æ¬¡æ‰«æéœ€è¦æ›´å¤šçš„æ—¶é—´ï¼Œå¯¹äºåƒåœ¾æ¯”ä¾‹è¾ƒå°çš„æƒ…å†µå ä¼˜åŠ¿ã€‚å¤åˆ¶æ”¶é›†æ›´å¿«é€Ÿä½†æ˜¯éœ€è¦é¢å¤–å¼€è¾Ÿä¸€å—ç”¨æ¥å¤åˆ¶çš„å†…å­˜ï¼Œå¯¹åƒåœ¾æ¯”ä¾‹è¾ƒå¤§çš„æƒ…å†µå ä¼˜åŠ¿ã€‚ç‰¹åˆ«çš„ï¼Œå¤åˆ¶æ”¶é›†æœ‰ã€Œå±€éƒ¨æ€§ã€çš„ä¼˜ç‚¹ã€‚ åœ¨å¤åˆ¶æ”¶é›†çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæŒ‰ç…§å¯¹è±¡è¢«å¼•ç”¨çš„é¡ºåºå°†å¯¹è±¡å¤åˆ¶åˆ°æ–°ç©ºé—´ä¸­ã€‚äºæ˜¯ï¼Œå…³ç³»è¾ƒè¿‘çš„å¯¹è±¡è¢«æ”¾åœ¨è·ç¦»è¾ƒè¿‘çš„å†…å­˜ç©ºé—´çš„å¯èƒ½æ€§ä¼šæé«˜ï¼Œè¿™å«åšå±€éƒ¨æ€§ã€‚å±€éƒ¨æ€§é«˜çš„æƒ…å†µä¸‹ï¼Œå†…å­˜ç¼“å­˜ä¼šæ›´æœ‰æ•ˆåœ°è¿ä½œï¼Œç¨‹åºçš„æ€§èƒ½ä¼šæé«˜ã€‚ å¯¹äºæ ‡è®°æ¸…é™¤ï¼Œæœ‰ä¸€ç§ æ ‡è®°-å‹ç¼©ç®—æ³• çš„è¡ç”Ÿç®—æ³•ï¼š å¯¹äºå‹ç¼©é˜¶æ®µï¼Œå®ƒçš„å·¥ä½œå°±æ˜¯ç§»åŠ¨æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡åˆ°å †å†…å­˜çš„åŒä¸€ä¸ªåŒºåŸŸä¸­ï¼Œä½¿ä»–ä»¬ç´§å‡‘çš„æ’åˆ—åœ¨ä¸€èµ·ï¼Œä»è€Œå°†æ‰€æœ‰éå¯è¾¾å¯¹è±¡é‡Šæ”¾å‡ºæ¥çš„ç©ºé—²å†…å­˜éƒ½é›†ä¸­åœ¨ä¸€èµ·ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼æ¥è¾¾åˆ°å‡å°‘å†…å­˜ç¢ç‰‡çš„ç›®çš„ã€‚ å¼•ç”¨è®¡æ•°å¼•ç”¨è®¡æ•°æ˜¯æŒ‡ï¼Œé’ˆå¯¹æ¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¿å­˜ä¸€ä¸ªå¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œè¯¥å¯¹è±¡çš„å¼•ç”¨å¢åŠ ï¼Œåˆ™ç›¸åº”çš„å¼•ç”¨è®¡æ•°å¢åŠ ã€‚å¦‚æœå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸ºé›¶ï¼Œåˆ™å›æ”¶è¯¥å¯¹è±¡ã€‚ ä¼˜ç‚¹ï¼šå¼•ç”¨è®¡æ•°æœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯å®¹æ˜“å®ç°ï¼ŒC++ç¨‹åºå‘˜åº”è¯¥éƒ½å®ç°è¿‡ç±»ä¼¼çš„æœºåˆ¶ã€‚äºŒæ˜¯æˆæœ¬å°ï¼ŒåŸºæœ¬ä¸Šå¼•ç”¨è®¡æ•°ä¸º 0 çš„æ—¶å€™åƒåœ¾ä¼šè¢«ç«‹å³å›æ”¶ï¼Œè€Œå…¶ä»–æ–¹æ³•éš¾ä»¥é¢„æµ‹å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œåƒåœ¾å­˜åœ¨çš„æ—¶é—´éƒ½ä¼šæ¯”è¿™ä¸ªæ–¹æ³•é«˜ã€‚å¦ï¼Œè¿™ç§åƒåœ¾å›æ”¶æ–¹å¼äº§ç”Ÿçš„ä¸­æ–­æ—¶é—´æœ€çŸ­ã€‚ ç¼ºç‚¹ï¼šæœ€è‘—åçš„ç¼ºç‚¹å°±æ˜¯å¦‚æœå¯¹è±¡ä¸­å­˜åœ¨å¾ªç¯å¼•ç”¨ï¼Œå°±æ— æ³•è¢«å›æ”¶ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢ä¸‰ä¸ªå¯¹è±¡äº’ç›¸å¼•ç”¨ï¼Œä½†æ˜¯ä¸å­˜åœ¨ä»æ ¹ï¼ˆRootï¼‰æŒ‡å‘çš„å¼•ç”¨ï¼Œæ‰€ä»¥å·²ç»æ˜¯åƒåœ¾äº†ã€‚ä½†æ˜¯å¼•ç”¨è®¡æ•°ä¸ä¸º 0. è¿˜æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯ï¼Œå¼•ç”¨è®¡æ•°ä¸é€‚åˆåœ¨å¹¶è¡Œä¸­ä½¿ç”¨ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œå¼•ç”¨è®¡æ•°ï¼Œä¼šå¼•èµ·æ•°å€¼ä¸ä¸€æ ·çš„é—®é¢˜ä»è€Œå¯¼è‡´å†…å­˜é”™è¯¯ã€‚æ‰€ä»¥å¼•ç”¨è®¡æ•°å¿…é¡»é‡‡ç”¨ç‹¬å æ–¹å¼ï¼Œå¦‚æœå¼•ç”¨æ“ä½œé¢‘ç¹ï¼Œé‚£ä¹ˆåŠ é”ç­‰å¹¶å‘æ§åˆ¶æœºåˆ¶çš„å¼€é”€æ˜¯ç›¸å½“å¤§çš„ã€‚ Perl å’Œ Python é‡‡ç”¨äº†è¿™ç§ GC æœºåˆ¶ã€‚ å®ƒä»¬çš„è¡ç”Ÿç®—æ³•åˆ†ä»£å›æ”¶è¿™ç§å›æ”¶æ–¹å¼ç”¨äº†ç¨‹åºçš„ä¸€ç§ç‰¹æ€§ï¼šå¤§éƒ¨åˆ†å¯¹è±¡ä¼šä»äº§ç”Ÿå¼€å§‹åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…å˜æˆåƒåœ¾ï¼Œè€Œå­˜åœ¨çš„å¾ˆé•¿æ—¶é—´çš„å¯¹è±¡å¾€å¾€éƒ½æœ‰è¾ƒé•¿çš„ç”Ÿå‘½å‘¨æœŸã€‚é«˜é¢‘å¯¹æ–°ç”Ÿæˆçš„å¯¹è±¡è¿›è¡Œå›æ”¶ï¼Œç§°ä¸ºã€Œå°å›æ”¶ã€ï¼Œä½é¢‘å¯¹æ‰€æœ‰å¯¹è±¡å›æ”¶ï¼Œç§°ä¸ºã€Œå¤§å›æ”¶ã€ã€‚æ¯ä¸€æ¬¡ã€Œå°å›æ”¶ã€è¿‡åï¼Œå°±æŠŠå­˜æ´»ä¸‹æ¥çš„å¯¹è±¡å½’ä¸ºã€Œè€ç”Ÿä»£ã€ï¼Œã€Œå°å›æ”¶ã€çš„æ—¶å€™ï¼Œé‡åˆ°è€ç”Ÿä»£ç›´æ¥è·³è¿‡ã€‚å¤§å¤šæ•°åˆ†ä»£å›æ”¶ç®—æ³•éƒ½é‡‡ç”¨çš„ã€Œå¤åˆ¶æ”¶é›†ã€æ–¹æ³•ï¼Œå› ä¸ºå°å›æ”¶ä¸­åƒåœ¾çš„æ¯”ä¾‹è¾ƒå¤§ã€‚ è¿™ç§æ–¹å¼å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœåœ¨æŸä¸ªæ–°ç”Ÿä»£çš„å¯¹è±¡ä¸­ï¼Œå­˜åœ¨ã€Œè€ç”Ÿä»£ã€çš„å¯¹è±¡å¯¹å®ƒçš„å¼•ç”¨ï¼Œå®ƒå°±ä¸æ˜¯åƒåœ¾äº†ï¼Œé‚£ä¹ˆæ€ä¹ˆåˆ¶æ­¢ã€Œå°å›æ”¶ã€å¯¹å…¶å›æ”¶å‘¢ï¼Ÿè¿™é‡Œç”¨åˆ°äº†ä¸€ä¸­å«åšå†™å±éšœçš„æ–¹å¼ã€‚ ç¨‹åºå¯¹æ‰€æœ‰æ¶‰åŠä¿®æ”¹å¯¹è±¡å†…å®¹çš„åœ°æ–¹è¿›è¡Œä¿æŠ¤ï¼Œè¢«ç§°ä¸ºã€Œå†™å±éšœã€ï¼ˆWrite Barrierï¼‰ã€‚å†™å±éšœä¸ä»…ç”¨äºåˆ†ä»£å›æ”¶ï¼Œä¹Ÿç”¨äºå…¶ä»– GC ç®—æ³•ä¸­ã€‚ åœ¨æ­¤ç®—æ³•çš„è¡¨ç°æ˜¯ï¼Œç”¨ä¸€ä¸ªè®°å½•é›†æ¥è®°å½•ä»æ–°ç”Ÿä»£åˆ°è€ç”Ÿä»£çš„å¼•ç”¨ã€‚å¦‚æœæœ‰ä¸¤ä¸ªå¯¹è±¡ A å’Œ Bï¼Œå½“å¯¹ A çš„å¯¹è±¡å†…å®¹è¿›è¡Œä¿®æ”¹å¹¶åŠ å…¥ B çš„å¼•ç”¨æ—¶ï¼Œå¦‚æœâ‘ A æ˜¯ã€Œè€ç”Ÿä»£ã€â‘¡B æ˜¯ã€Œæ–°ç”Ÿä»£ã€ã€‚åˆ™å°†è¿™ä¸ªå¼•ç”¨åŠ å…¥åˆ°è®°å½•é›†ä¸­ã€‚ã€Œå°å›æ”¶ã€çš„æ—¶å€™ï¼Œå› ä¸ºè®°å½•é›†ä¸­æœ‰å¯¹ B çš„å¼•ç”¨ï¼Œæ‰€ä»¥ B ä¸å†æ˜¯åƒåœ¾ã€‚ å¢é‡å›æ”¶ä¸Šé¢çš„ç®—æ³•ç¼©çŸ­äº†ã€ŒGC å¹³å‡ä¸­æ–­æ—¶é—´ã€ï¼Œä½†æ˜¯åœ¨å¯¹å®æ—¶æ€§è¦æ±‚å¾ˆé«˜çš„ç¨‹åºä¸­ï¼Œå¯¹ã€ŒGC æœ€é«˜ä¸­æ–­æ—¶é—´ã€çš„è¦æ±‚æ›´é«˜ã€‚æ¯”å¦‚ï¼Œè‡ªåŠ¨é©¾é©¶è½¯ä»¶ï¼Œå¦‚æœæŸæ¬¡ GC ä¸­æ–­äº† 0.1sï¼Œé‚£ä¹ˆæŸå¤±å¯èƒ½æ˜¯è‡´å‘½çš„ã€‚ å¢é‡å›æ”¶å°±æ˜¯å°† GC åˆ†æˆå‡ éƒ¨åˆ†æ¥æ‰§è¡Œã€‚è®¾ç½®ã€ŒGC æœ€å¤šä¸­æ–­ 10msã€è¿™æ ·çš„æ¡ä»¶é™åˆ¶æ¥ä½¿ GC çš„ç»ˆç«¯æ—¶é—´è§†ä½œå¯é¢„æµ‹çš„ã€‚ ä½†æ˜¯ï¼Œåœ¨ä¸¤æ®µçš„ GC ç¨‹åºä¹‹é—´ï¼Œå¼•ç”¨å…³ç³»å¯èƒ½å‘ç”Ÿäº†å˜åŒ–ã€‚æ‰€ä»¥ï¼Œè¿™ç§ GC ç®—æ³•ä¹Ÿè¦å†™å±éšœï¼Œæ¥è®°å½•å¼•ç”¨å…³ç³»çš„å˜åŒ–ã€‚è™½ç„¶è¿™ç§æ–¹å¼æ§åˆ¶äº†ä¸­æ–­æœ€é«˜æ—¶é—´ï¼Œä½†æ˜¯ç”±äºä¸­æ–­æ¬¡æ•°å¢åŠ ï¼ŒGC æ€»æ—¶é—´æ˜¯å¢åŠ çš„ã€‚ å¹¶è¡Œå›æ”¶åŸºæœ¬åŸç†æ˜¯ï¼Œåœ¨ç¨‹åºè¿è¡Œçš„åŒæ—¶è¿›è¡Œ GC å·¥ä½œï¼Œæœ€å¤§åŒ– CPU çš„æ€§èƒ½ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¹Ÿè¦é¢å¯¹å¢é‡å›æ”¶çš„é—®é¢˜ï¼Œæ‰€ä»¥ä¹Ÿè¦è¿›è¡Œå†™å±éšœæ“ä½œã€‚ ç„¶è€Œè¿™ç§æ–¹å¼ä¹Ÿå¹¶æœªåšåˆ°å®Œå…¨ä¸æš‚åœåŸç¨‹åºçš„è¿è¡Œï¼Œåœ¨æŸäº›ç‰¹å®šçš„ GC é˜¶æ®µè¿˜æ˜¯è¦æš‚åœåŸç¨‹åºã€‚å¤šæ ¸åŒ–è¿…é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œè¿™ç§ç®—æ³•ä¹Ÿåœ¨ä¸æ–­ä¼˜åŒ–ã€‚ä¸é—´æ–­åŸç¨‹åºå®ç°å¹¶è¡Œå›æ”¶è¿™ä¸ªé¢†åŸŸæ˜¯ç›¸å½“å€¼å¾—æœŸå¾…çš„ã€‚","tags":["clippings"],"categories":["6.å¼€å‘å·¥å…·","è°ƒè¯•"]},{"title":"etcç›®å½•","path":"/2024/12/18/1-å¹³å°ç³»ç»Ÿ-Linux-æ–‡ä»¶ç³»ç»Ÿ-etcç›®å½•/","content":"etc ç›®å½•åœ¨ Linux ä¸­çš„è§’è‰²/etc ç›®å½•è¢«å¹¿æ³›è®¤ä¸ºæ˜¯ Linux ç³»ç»Ÿä¸­çš„é…ç½®æ–‡ä»¶ä¹‹å®¶ã€‚è¿™ä¸ªç›®å½•åŒ…å«äº†å¤§é‡ç”¨äºç³»ç»Ÿç®¡ç†çš„é…ç½®æ–‡ä»¶ï¼Œç³»ç»Ÿç®¡ç†å‘˜å’Œç”¨æˆ·éœ€è¦åœ¨è¿™é‡Œè¿›è¡Œä¿®æ”¹ï¼Œä»¥ä¾¿ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½å’Œå®‰å…¨æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®çš„ç½‘ç»œé…ç½®æ–‡ä»¶åŠå…¶ä½œç”¨ã€‚ ç½‘ç»œé…ç½®æ–‡ä»¶1 etchosts/etc/hosts æ–‡ä»¶æ ¼å¼: IPaddress hostname aliasesã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯æä¾›ä¸»æœºåä¸ IP åœ°å€ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œç¡®ä¿åœ¨æ²¡æœ‰ DNS çš„æƒ…å†µä¸‹ï¼Œä»ç„¶å¯ä»¥é€šè¿‡ä¸»æœºåè®¿é—®ç‰¹å®šçš„ä¸»æœºã€‚å°†å¸¸ç”¨çš„ä¸»æœºæ·»åŠ åˆ°æ­¤æ–‡ä»¶ä¸­å¯ä»¥æœ‰æ•ˆåœ°æé«˜ç½‘ç»œåº”ç”¨çš„ä¾¿æ·æ€§ã€‚ä¾‹å¦‚ï¼š 127.0.0.1 localhost localhost.localdomain202.118.66.81 helius.dlut.edu.cn helius åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ127.0.0.1 æŒ‡å‘æœ¬åœ°è®¡ç®—æœºï¼Œè€Œ 202.118.66.81 åˆ™æŒ‡å‘ç‰¹å®šçš„è¿œç¨‹ä¸»æœº helius.dlut.edu.cnã€‚ 2 etcresolv.confè¿™ä¸ªæ–‡ä»¶çš„åŠŸèƒ½æ˜¯é…ç½® DNS å®¢æˆ·ç«¯ï¼Œé‡Œé¢å¯ä»¥è®¾ç½® DNS æœåŠ¡å™¨çš„ IP åœ°å€å’Œ DNS åŸŸåã€‚/etc/resolv.conf æ–‡ä»¶çš„æ ¼å¼å¦‚ä¸‹ï¼š domainname åŸŸåsearch åŸŸånameserver Primary_DNS_Server_IP_addressnameserver Second_DNS_Server_IP_address ä¾‹å¦‚ï¼š search dlut.edu.cnnameserver 202.118.66.6 åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œsearch æŒ‡ä»¤å…è®¸ç³»ç»Ÿåœ¨æœªæä¾›å®Œæ•´åŸŸåçš„æƒ…å†µä¸‹è‡ªåŠ¨è¡¥å…¨ï¼Œè€Œ nameserver æŒ‡å®šäº†ä½¿ç”¨çš„ DNS æœåŠ¡å™¨ IPã€‚ 3 etchost.conf/etc/host.conf æ–‡ä»¶çš„åŠŸèƒ½æ˜¯æŒ‡å®šä¸»æœºåæŸ¥æ‰¾çš„é¡ºåºï¼Œé€šå¸¸å…ˆæ£€æŸ¥ /etc/hosts æ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œç³»ç»Ÿå†å‘ DNS æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚å¯¹äºå¤§å¤šæ•°ç”¨æˆ·æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶çš„é»˜è®¤å†…å®¹å¾€å¾€æ˜¯è¶³å¤Ÿçš„ï¼Œä¾‹å¦‚ï¼š order hosts, bindmulti on åœ¨è¿™ä¸ªé…ç½®ä¸­ï¼Œorder hosts, bind æŒ‡å®šäº†æ–‡ä»¶ä¼˜å…ˆçº§ï¼Œmulti on å…è®¸æ·»åŠ å¤šä¸ªç›¸åŒä¸»æœºåçš„æ¡ç›®ã€‚ 4 etcHOSTNAME (Linux Redhat 5.x Distribution)è¿™ä¸ªæ–‡ä»¶ç”¨äºè®¾ç½®ä¸»æœºåã€‚ä¸åŒ Linux å‘è¡Œç‰ˆå¯èƒ½ä¼šç¨æœ‰å·®å¼‚ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ç›¸åº”çš„è®¾ç½®æ–‡ä»¶ï¼š egrep hostname /etc/rc.d/init.d/* æˆ–è€… egrep hostname /etc/init.d/* å¯¹äº Linux Redhat 5.xï¼Œè¿™ä¸ªé…ç½®é€šå¸¸åœ¨ /etc/sysconfig/network æ–‡ä»¶ä¸­çš„ HOSTNAME æ¡ç›®ä¸­æ‰¾åˆ°ã€‚ 5 etcinetd.conf/etc/inetd.conf æ–‡ä»¶ç”¨äºé…ç½® Internet è¶…çº§æœåŠ¡å™¨ï¼Œè¿™æ˜¯ä¸€ä¸ªç›‘å¬å’Œç®¡ç†å¤šç§ç½‘ç»œæœåŠ¡çš„ç¨‹åºï¼Œè·¯å¾„ä¸º /usr/sbin/inetdã€‚åœ¨æ­¤é…ç½®æ–‡ä»¶ä¸­ï¼Œåˆ—å‡ºäº†è®¸å¤šç½‘ç»œæœåŠ¡çš„è®¾ç½®ï¼Œä¾‹å¦‚ï¼š ftp stream tcp nowait root /usr/sbin/tcpd in.ftpd -l -atelnet stream tcp nowait root /usr/sbin/tcpd in.telnetd è¿™äº›è¡Œå®šä¹‰äº†å¦‚ä½•å¯åŠ¨ ftp å’Œ telnet æœåŠ¡ã€‚æŸäº›æœåŠ¡å¦‚ r ç³»åˆ—çš„è¿œç¨‹æœåŠ¡ï¼ˆå¦‚ rsh, rloginï¼‰å»ºè®®å…³é—­ï¼Œä»¥å¢å¼ºç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚ 6 etcservices/etc/services æ–‡ä»¶æè¿°äº†å„ç§ç½‘ç»œæœåŠ¡ä»¥åŠç›¸åº”çš„ç«¯å£å·å’Œåè®®ã€‚åœ¨ Linux ç¯å¢ƒä¸‹ï¼Œè¯¥æ–‡ä»¶çš„æ ¼å¼å¦‚ä¸‹ï¼š æœåŠ¡åç§° ç«¯å£å·/åè®® æœåŠ¡åˆ«å ä¾‹å¦‚ï¼š ftp 21/tcptelnet 23/tcpsmtp 25/tcp mail æ­¤æ–‡ä»¶åŸºæœ¬ä¸ŠåŒ…å«äº†ç³»ç»Ÿæ”¯æŒçš„æ‰€æœ‰ç½‘ç»œæœåŠ¡ï¼Œé€šå¸¸ç”¨æˆ·æ— éœ€ä¿®æ”¹ã€‚è™½ç„¶ Linux è‡ªå¸¦çš„å†…å®¹å·²è¦†ç›–ç»å¤§å¤šæ•°éœ€æ±‚ï¼Œä½†åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¦‚åœ¨ Solaris ç³»ç»Ÿä¸Šï¼‰å¯èƒ½éœ€è¦æ‰‹åŠ¨æ·»åŠ æœåŠ¡ã€‚ 7 etchosts.allow å’Œ etchosts.denyåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå°¤å…¶æ˜¯åœ¨å¯ç”¨ tcpd æœåŠ¡ç®¡ç†å™¨çš„æƒ…å†µä¸‹ï¼Œè®¿é—®æ§åˆ¶é€šè¿‡ /etc/hosts.allow å’Œ /etc/hosts.deny æ–‡ä»¶è¿›è¡Œç®¡ç†ã€‚ /etc/hosts.allow æ–‡ä»¶åˆ—å‡ºäº†å…è®¸ä½¿ç”¨ inetd æœåŠ¡çš„ä¸»æœºã€‚ä¾‹å¦‚ï¼Œè®¾ç½® All: 202.118 è¡¨ç¤ºå…è®¸æ‰€æœ‰æ¥è‡ª IP åœ°å€ä»¥ 202.118 å¼€å¤´çš„è¯·æ±‚ã€‚ ç›¸å¯¹åœ°ï¼Œ/etc/hosts.deny åˆ™å®šä¹‰äº†ä¸å…è®¸è®¿é—®è¿™äº›æœåŠ¡çš„ä¸»æœºã€‚åœ¨å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„ç¯å¢ƒä¸­ï¼Œåˆç†é…ç½®è¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯è‡³å…³é‡è¦çš„ã€‚å…·ä½“é…ç½®é¡ºåºå’Œè¯­æ³•è¯·å‚è§ç›¸å…³æ‰‹å†Œï¼š man tcpd man hosts.allow man hosts.deny éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºå®‰å…¨æ€§è¦æ±‚æ›´ä¸ºä¸¥æ ¼çš„æœåŠ¡å™¨ï¼Œå»ºè®®ä½¿ç”¨ xinetd ä»£æ›¿ä¼ ç»Ÿçš„ inetdã€‚xinetd é€šå¸¸åœ¨ Debian ç³»ç»Ÿä¸­é¢„è£…ï¼›è‹¥åœ¨å…¶ä»–ç³»ç»Ÿä¸Šï¼Œåˆ™å¯ä»¥ä»æºä»£ç è¿›è¡Œç¼–è¯‘å’Œå®‰è£…ã€‚ 8 etcnetworks å’Œ etcnetmasks/etc/networks å’Œ /etc/netmasks æ–‡ä»¶ç”¨äºåˆ—å‡ºè·¯ç”±æ‰€éœ€çš„ç½‘ç»œåœ°å€ã€‚è™½ç„¶è¿™äº›æ–‡ä»¶å¯ä»¥å¸®åŠ©ç®¡ç†è·¯ç”±è¡¨ï¼Œä½†ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…· /usr/sbin/route æ¥å®Œæˆç›¸åº”çš„æ“ä½œã€‚ ç¤ºä¾‹é…ç½®æ–‡ä»¶/etc/networksdlrin 202.199.128.0/etc/netmasks202.199.128.0 255.255.240.0 åŠ å…¥é™æ€è·¯ç”±è¡¨é¡¹çš„åŸºæœ¬ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š +---------------+ DDN| Cisco 2511 +--------------DLMU 202.118.64.0/255.255.255.0| +--------------DLNA 210.47.192.0/255.255.240.0+-------+-------+| 202.118.66.254| 202.118.66.16+-------+-------+| Switch/HUB +-------+ç½‘ç»œä¸­å¿ƒ +-----+ LAN Router++-------+-------+ +-------------+ +-----------+| ||| 202.118.68.0/255.255.252.0| +--------------++--------------+ 202.118.66.81+ (æµ‹è¯•æœºå™¨)| +--------------+||| 202.118.66.1(Default Router)+-------+-------+| è·¯ç”±å™¨ ++-------+-------+| 202.112.30.65/255.255.255.252| DDN | PPP|| 202.112.30.66/255.255.255.252 åœ¨è¿™ä¸ªå›¾ç¤ºä¸­ï¼Œæ¯ä¸ª IP åœ°å€å‡åˆ†é…ç»™ä¸åŒçš„è®¾å¤‡æˆ–ç½‘ç»œæ®µã€‚æ¯”å¦‚ï¼Œ202.118.66.1 æ˜¯é»˜è®¤è·¯ç”±ï¼Œè€Œ 202.118.66.81 å¯ä»¥æ˜¯ä¸€å°è¿›è¡Œæµ‹è¯•çš„æœºå™¨ã€‚ ç›¸å…³å‘½ä»¤ç¤ºä¾‹$ netstat -rnKernel IP routing tableDestination Gateway Genmask Flags MSS Window irtt Iface202.118.66.0 0.0.0.0 255.255.255.0 U 1500 0 0 eth0127.0.0.0 0.0.0.0 255.0.0.0 U 3584 0 0 lo0.0.0.0 202.118.66.1 0.0.0.0 UG 1500 0 0 eth0 åœ¨ä¸Šè¿°è¡¨æ ¼ä¸­ï¼ŒDestination åˆ—æ˜¾ç¤ºç›®æ ‡ç½‘ç»œåœ°å€ï¼ŒGateway åˆ—åˆ™åŒ…å«å®ƒæ‰€æŒ‡å‘çš„ç½‘å…³ã€‚0.0.0.0 ä»£è¡¨æ‰€æœ‰é»˜è®¤è·¯ç”±ã€‚ åŠ å…¥é™æ€è·¯ç”±è¦åŠ å…¥é™æ€è·¯ç”±ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š /sbin/route add -net 202.118.66.0 netmask 255.255.255.0 eth0/sbin/route add -net 202.199.128.0 netmask 255.255.240.0 gw 202.118.66.254 ä¹Ÿå¯ä»¥é€šè¿‡åˆ«åæ–¹å¼æ·»åŠ ï¼š /sbin/route add -net dlrin gw 202.118.66.254 9. etcpasswdæ­¤æ–‡ä»¶ç”¨äºå­˜å‚¨ç³»ç»Ÿä¸­æ¯ä¸ªç”¨æˆ·çš„è´¦æˆ·ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·åã€ç”¨æˆ· IDï¼ˆUIDï¼‰ã€ç»„ IDï¼ˆGIDï¼‰ã€ç”¨æˆ·æè¿°ã€ä¸»ç›®å½•åŠç”¨æˆ·çš„ shellã€‚ 10. etcshadowå¦‚æœç³»ç»Ÿæ”¯æŒé˜´å½±å¯†ç æœºåˆ¶ï¼Œè¯¥æ–‡ä»¶ç”¨äºå­˜å‚¨åŠ å¯†çš„ç”¨æˆ·å¯†ç åŠå¯†ç æ›´æ”¹ä¿¡æ¯ã€‚æƒé™è®¾ç½®ä¸º -rwx------ ç¡®ä¿åªæœ‰ root ç”¨æˆ·å¯ä»¥è®¿é—®æ­¤æ–‡ä»¶ã€‚ 11. etcfstabè¿™æ˜¯æ–‡ä»¶ç³»ç»Ÿè¡¨ï¼ŒåŒ…å«å„ç§æ–‡ä»¶ç³»ç»Ÿçš„è®¾å¤‡åã€æŒ‚è½½ç‚¹ã€æ–‡ä»¶ç³»ç»Ÿç±»å‹å’Œå¯é€‰çš„åŠ è½½é€‰é¡¹ã€‚ä¾‹å¦‚ï¼š # è®¾å¤‡å MountPoint FileSystem Type åŠ è½½é€‰é¡¹ fsckæ ‡å¿—/dev/hda1 / ext2 defaults 1 1/dev/hda6 /home ext2 defaults 1 2/dev/hda3 /usr ext2 defaults 1 2/dev/hda5 /var ext2 defaults 1 2/dev/hda2 swap swap defaults 0 0 12. etcexportsæ­¤æ–‡ä»¶ç”¨äºé…ç½® NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼‰æœåŠ¡å™¨çš„è¾“å‡ºæ–‡ä»¶ç³»ç»Ÿè¡¨ã€‚é€šå¸¸å»ºè®®é¿å…ä½¿ç”¨ NFSï¼ŒåŸå› åœ¨äºå®ƒçš„å®‰å…¨æ€§ç›¸æ¯”å…¶ä»–æ–‡ä»¶å…±äº«æœºåˆ¶è¾ƒä½ã€‚ 13. etcdefaultrouter (Solaris 2.x)æ­¤æ–‡ä»¶å­˜å‚¨é»˜è®¤è·¯ç”±çš„ IP åœ°å€ã€‚åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œè¿™é€šå¸¸ä¼šåœ¨ /etc/sysconfig/network æˆ– /etc/init.d/network ä¸­é…ç½®ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š GATEWAY=202.118.66.1GATEWAYDEV=eth0 14. etcbashrc, etccsh.cshrc, etcprofileè¿™äº›æ–‡ä»¶ç”¨äºè®¾ç½®ç”¨æˆ·çš„é»˜è®¤ç¯å¢ƒï¼Œå®šä¹‰äº†å¦‚ PATHã€umask å’Œ TERM ç­‰ç¯å¢ƒå˜é‡ã€‚ 15. etcftpaccessæ­¤æ–‡ä»¶ç”¨äºæ§åˆ¶ FTP è®¿é—®ï¼Œå…·ä½“è®¿é—®é…ç½®ä¼šæ ¹æ® FTP æœåŠ¡å™¨çš„é…ç½®è¿›è¡Œè®¾å®šã€‚ 16. etcftpusersæ­¤æ–‡ä»¶åŒ…æ‹¬è¢«ç¦æ­¢é€šè¿‡ FTP ç™»å½•çš„ç”¨æˆ·åˆ—è¡¨ï¼Œé€šå¸¸åŒ…æ‹¬ root, uucp, bin ç­‰ã€‚ 17. etcftpconvions å’Œ etcftpgroupsè¿™äº›æ˜¯ FTP æœåŠ¡å™¨ç”¨äºç®¡ç†ç”¨æˆ·æƒé™å’Œç»„çš„é…ç½®æ–‡ä»¶ã€‚ 18. etcgroupæ­¤æ–‡ä»¶åŒ…å«ç”¨æˆ·ç»„çš„ç›¸å…³ä¿¡æ¯ï¼Œå®šä¹‰äº†ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·æ‰€å±çš„ç»„ã€‚ 19. etcsendmail.cfè¿™æ˜¯ Sendmailï¼ˆé‚®ä»¶æœåŠ¡å™¨ï¼‰çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­ /etc/sendmail.cw åŒ…å«æœ¬åœ°ä¸»æœºåçš„ç›¸å…³ä¿¡æ¯ã€‚ 20. etcissueè¯¥æ–‡ä»¶å®šä¹‰äº†ç”¨æˆ·åœ¨ç³»ç»Ÿç™»å½•æ—¶çœ‹åˆ°çš„æç¤ºä¿¡æ¯ï¼Œè€Œ /etc/motd åˆ™æ˜¯ç”¨æˆ·ç™»å½•åæ˜¾ç¤ºçš„æ¬¢è¿ä¿¡æ¯ã€‚ 21. etcnamed.bootæ­¤æ–‡ä»¶æ˜¯ DNS (BIND 4.9.x) çš„å¯åŠ¨æ–‡ä»¶ï¼Œå®šä¹‰äº† DNS æœåŠ¡å™¨çš„å·¥ä½œç›®å½•å’Œç¼“å­˜è®¾ç½®ã€‚ 22. etchost.equiv å’Œ $HOME.rhostsè¿™ä¸¤ä¸ªæ–‡ä»¶ç”¨äº R ç³»åˆ—æœåŠ¡ï¼ˆå¦‚ rlogin å’Œ rsh ç­‰ï¼‰çš„ä¸»æœºä¿¡ä»»é…ç½®ã€‚ 23. etcld.so.confè¿™ä¸ªæ–‡ä»¶å®šä¹‰åŠ¨æ€é“¾æ¥åº“çš„è·¯å¾„ï¼Œä¿®æ”¹åéœ€è¦ä½¿ç”¨ ldconfig å‘½ä»¤æ›´æ–°åº“æ–‡ä»¶ã€‚ 24. etcpam.dloginæ­¤æ–‡ä»¶æ¶‰åŠåˆ° Linux ä¸­çš„èº«ä»½éªŒè¯ç®¡ç†è®¾ç½®ï¼Œå¯èƒ½ä¼šæ ¹æ®ä¸åŒçš„å‘è¡Œç‰ˆå­˜åœ¨ä¸åŒé…ç½®æ–¹å¼ã€‚ 25. Linux Loader etclilo.confè¯¥æ–‡ä»¶ç”¨äºå¤šé‡å¯åŠ¨é…ç½®ï¼Œä¿®æ”¹åéœ€æ‰§è¡Œ lilo å‘½ä»¤ä»¥ä½¿æ”¹åŠ¨ç”Ÿæ•ˆã€‚ 26. etcsyslog.confè¿™æ˜¯ syslogd çš„é…ç½®æ–‡ä»¶ï¼Œç”¨äºç³»ç»Ÿæ—¥å¿—çš„ç®¡ç†ã€‚ 27. etcsmb.confæ­¤é…ç½®æ–‡ä»¶ç”¨äº Samba æœåŠ¡å™¨ï¼Œä½¿ Linux ç³»ç»Ÿçš„æ–‡ä»¶ä¸ Windows ç³»ç»Ÿå…±äº«ã€‚ 28. etcnologinç³»ç»Ÿå…³æœºæ—¶åˆ›å»ºæ­¤æ–‡ä»¶ï¼Œå†…å®¹ä¸ºæ‹’ç»ç”¨æˆ·ç™»å½•çš„ä¿¡æ¯ã€‚ 29. etcsecurityæ­¤æ–‡ä»¶å®šä¹‰äº†å“ªäº›ç»ˆç«¯è®¾å¤‡å¯ä»¥è®© root ç™»å½•ã€‚ 30. etcX11*ç”¨äº XFree86 çš„é…ç½®æ–‡ä»¶ï¼Œæ¶‰åŠå›¾å½¢ç•Œé¢è®¾ç½®ã€‚ 31. etcshellsåˆ—å‡ºäº†ç³»ç»Ÿä¸­å¯ç”¨çš„ shell ç¨‹åºï¼Œæœªåœ¨æ­¤åˆ—è¡¨ä¸­çš„ shell å°†æ— æ³•é€šè¿‡ FTP ä½¿ç”¨ã€‚ 32. etcmtabè¿™æ˜¯ä¸€ä¸ªåŠ¨æ€æ›´æ–°çš„ä¿¡æ¯æ–‡ä»¶ï¼Œè®°å½•ç³»ç»Ÿå½“å‰å·²æŒ‚è½½çš„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","æ–‡ä»¶ç³»ç»Ÿ"]},{"title":"sysç›®å½•","path":"/2024/12/17/1-å¹³å°ç³»ç»Ÿ-Linux-æ–‡ä»¶ç³»ç»Ÿ-sysç›®å½•/","content":"sys ç›®å½•ä¸‹çš„å­ç›®å½•sys ç›®å½•ä¸ proc ç›®å½•çš„æ¯”è¾ƒsys ç›®å½•ä¸“é—¨ç”¨æ¥å°†å†…æ ¸ä¸­çš„ä¿¡æ¯æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ï¼Œä¾›åº”ç”¨ç¨‹åºè¿›è¡Œè®¿é—®ã€‚è¿™ä¸ proc æ–‡ä»¶ç³»ç»Ÿå½¢æˆå¯¹æ¯”ï¼Œåè€…æ˜¯ä¸€ä¸ªå®Œå…¨å­˜åœ¨äºå†…å­˜ä¸­çš„ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œæ²¡æœ‰å ç”¨ä»»ä½•å¤–éƒ¨å­˜å‚¨ã€‚åœ¨ proc ä¸­ï¼Œä»¥æ–‡ä»¶å’Œç›®å½•çš„å½¢å¼æä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œå…è®¸ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºè·å–å®æ—¶çš„ç³»ç»Ÿå†…æ ¸æ•°æ®ï¼Œå¹¶åœ¨æŸäº›æƒ…å†µä¸‹ä¿®æ”¹å†…æ ¸å‚æ•°ã€‚è¿™æ˜¯ç”±äºç³»ç»Ÿä¿¡æ¯ç»å¸¸æ˜¯åŠ¨æ€çš„ï¼Œæ¯”å¦‚è¿›ç¨‹çš„çŠ¶æ€ã€‚å½“ç”¨æˆ·è¯»å– proc ä¸­çš„æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿä¼šå®æ—¶åœ°ä»å†…æ ¸ä¸­æå–æ‰€éœ€çš„ä¿¡æ¯å¹¶è¿”å›ã€‚ sysdevicessysdevices ç›®å½•åŒ…å«äº†ä¸€ä¸ªå…¨å±€çš„è®¾å¤‡ç»“æ„ä½“ç³»ï¼Œæ³¨å†Œäº†æ‰€æœ‰åœ¨ä¸åŒæ€»çº¿ä¸Šçš„ç‰©ç†è®¾å¤‡ã€‚è®¾å¤‡æŒ‰ç…§å…¶åœ¨æ€»çº¿ä¸Šçš„æ‹“æ‰‘ç»“æ„è¿›è¡Œå±•ç¤ºï¼Œä½†æœ‰ä¸¤ä¸ªç‰¹ä¾‹ï¼šplatform devices å’Œ system devicesã€‚ platform devices é€šå¸¸æ˜¯æŒ‚è½½åœ¨èŠ¯ç‰‡å†…éƒ¨é«˜é€Ÿæˆ–ä½é€Ÿæ€»çº¿ä¸Šçš„æ§åˆ¶å™¨å’Œå¤–è®¾ï¼Œè¿™äº›è®¾å¤‡å¯ä»¥è¢« CPU ç›´æ¥è®¿é—®ã€‚ä¾‹å¦‚ï¼ŒæŸä¸ªåµŒå…¥å¼ç³»ç»Ÿä¸­çš„ GPIO æ§åˆ¶å™¨å¯èƒ½å°±å±äºè¿™ä¸€ç±»ã€‚ system devices åˆ™æ˜¯æŒ‡èŠ¯ç‰‡å†…éƒ¨çš„æ ¸å¿ƒç»„ä»¶ï¼Œä¾‹å¦‚ CPUã€å®šæ—¶å™¨ç­‰ã€‚è¿™äº›ç»„ä»¶é€šå¸¸æ²¡æœ‰ç‹¬ç«‹çš„é©±åŠ¨ç¨‹åºï¼Œä½†ä¼šæœ‰ä¸ä½“ç³»ç»“æ„ç›¸å…³çš„ä»£ç è´Ÿè´£é…ç½®å®ƒä»¬ã€‚ è¿™ä¸€ç›®å½•æ˜¯å†…æ ¸å¯¹æ‰€æœ‰è®¾å¤‡çš„åˆ†å±‚è¡¨è¾¾æ¨¡å‹ï¼Œä¹Ÿæ˜¯ sys æ–‡ä»¶ç³»ç»Ÿä¸­æœ€é‡è¦çš„è®¾å¤‡ç®¡ç†ç»“æ„ã€‚ sysdevè¯¥ç›®å½•ç»´æŠ¤ä¸€ä¸ªç¬¦å·é“¾æ¥çš„æ–‡ä»¶åˆ—è¡¨ï¼Œè¿™äº›é“¾æ¥æŒ‰å­—ç¬¦è®¾å¤‡å’Œå—è®¾å¤‡çš„ä¸»æ¬¡å·ç ï¼ˆmajor:minorï¼‰è¿æ¥åˆ°çœŸå®è®¾å¤‡ï¼ˆsysdevicesï¼‰ã€‚è¿™æ„å‘³ç€ç”¨æˆ·å¯ä»¥é€šè¿‡è¿™äº›é“¾æ¥è½»æ¾è®¿é—®ç°å®ä¸­çš„è®¾å¤‡ï¼Œæ–¹ä¾¿ç®¡ç†å’Œæ“ä½œã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè™šæ‹Ÿè®¾å¤‡çš„ç¬¦å·é“¾æ¥å¯ä»¥è¿æ¥åˆ°å®é™…çš„å—è®¾å¤‡ï¼Œä½¿å¾—ç”¨æˆ·æ— éœ€ç›´æ¥æ“ä½œåº•å±‚çš„è®¾å¤‡æ–‡ä»¶ã€‚ sysclasssysclass ç›®å½•åŒ…å«ç³»ç»Ÿä¸­æ³¨å†Œçš„æ‰€æœ‰è®¾å¤‡ç±»å‹ï¼Œå¹¶æ ¹æ®è®¾å¤‡åŠŸèƒ½è¿›è¡Œåˆ†ç±»ã€‚æ¯ä¸ªè®¾å¤‡ç±»å‹éƒ½æœ‰è‡ªå·±çš„å­ç›®å½•ï¼Œå…¶ä¸­åŒ…å«æŒ‡å‘å…·ä½“è®¾å¤‡çš„ç¬¦å·é“¾æ¥ã€‚ä¾‹å¦‚ï¼Œæ‰€æœ‰è¾“å…¥è®¾å¤‡æ— è®ºæ˜¯é€šè¿‡ USBã€PS2 è¿˜æ˜¯å…¶ä»–æ–¹å¼è¿æ¥çš„ï¼Œéƒ½å°†åœ¨ sysclassinput ä¸‹å‡ºç°ã€‚è¿™ä¸ªç›®å½•æ˜¯ Linux ç»Ÿä¸€è®¾å¤‡æ¨¡å‹çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä½¿å¾—ä¸åŒç±»å‹çš„è®¾å¤‡å¯ä»¥é€šè¿‡ç»Ÿä¸€çš„æ–¹å¼è¿›è¡Œç®¡ç†ã€‚ sysblockè¯¥ç›®å½•ä¸‹çš„å­ç›®å½•ä»£è¡¨å½“å‰ç³»ç»Ÿä¸­æ£€æµ‹åˆ°çš„æ‰€æœ‰å—è®¾å¤‡ã€‚å°½ç®¡æ›´åˆç†çš„åˆ†ç±»åº”åœ¨ sysclass ä¸‹ï¼Œè¿™éƒ¨åˆ†è®¾å¤‡å†å²ä¸Šä¸€ç›´ä¿ç•™åœ¨ sysblock ä¸‹ã€‚ä» Linux 2.6.22 å†…æ ¸ç‰ˆæœ¬å¼€å§‹ï¼Œè¯¥ç›®å½•è¢«æ ‡è®°ä¸ºè¿‡æ—¶ï¼Œä»…åœ¨å¼€å¯ CONFIG_SYSFS_DEPRECATED é…ç½®æ—¶æ‰ä¼šå­˜åœ¨ã€‚å®é™…ä¸Šï¼Œä» Linux 2.6.26 å¼€å§‹ï¼Œç›¸å…³ä¿¡æ¯å·²è¢«è¿ç§»è‡³ sysclassblockï¼Œå› æ­¤ sysblock ç›®å½•ä¸­çš„å†…å®¹ä»…ä¿ç•™æŒ‡å‘çœŸå®è®¾å¤‡çš„ç¬¦å·é“¾æ¥ï¼Œä»¥ä¿æŒå‘åå…¼å®¹æ€§ã€‚ sysbusè¯¥ç›®å½•ä¸‹çš„æ¯ä¸ªå­ç›®å½•å¯¹åº”å†…æ ¸æ”¯æŒä¸”å·²æ³¨å†Œçš„æ€»çº¿ç±»å‹ã€‚æ‰€æœ‰è®¾å¤‡åœ¨ sysdevices ä¸­éƒ½ä¸æŸç§æ€»çº¿è¿æ¥ã€‚æ¯ä¸ªæ€»çº¿ç±»å‹çš„å­ç›®å½•ä¸‹ï¼Œé€šå¸¸åŒ…å«ä¸¤ä¸ªå­ç›®å½•ï¼šdevices å’Œ driversã€‚ devices å­ç›®å½•ä¸‹åˆ—å‡ºäº†è¯¥æ€»çº¿ç±»å‹ä¸‹æ‰€æœ‰è®¾å¤‡çš„ç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘çœŸå®è®¾å¤‡æ‰€åœ¨çš„ sysdevices ç›®å½•ã€‚ drivers å­ç›®å½•åŒ…å«æ‰€æœ‰æ³¨å†Œåˆ°è¯¥æ€»çº¿çš„é©±åŠ¨ç¨‹åºã€‚æ¯ä¸ªé©±åŠ¨å­ç›®å½•ä¸‹éƒ½æä¾›ä¸€äº›å¯ä»¥è§‚å¯Ÿå’Œä¿®æ”¹çš„å‚æ•°ã€‚ æ­¤ç›®å½•åŒæ ·æ˜¯ Linux ç»Ÿä¸€è®¾å¤‡æ¨¡å‹çš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚ sysfsè¯¥ç›®å½•æ—¨åœ¨æè¿°ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿæœ¬èº«åŠå…¶æŒ‰ç±»åˆ«åˆ†ç±»å­˜æ”¾çš„å·²æŒ‚è½½ç‚¹ã€‚è¿™ä¸ºç³»ç»Ÿç®¡ç†å‘˜æä¾›äº†ä¸€ä¸ªæ¸…æ™°çš„è§†å›¾ï¼Œå¯ä»¥å¿«é€Ÿäº†è§£å½“å‰æ–‡ä»¶ç³»ç»Ÿçš„çŠ¶æ€åŠå…¶æŒ‚è½½æƒ…å†µã€‚ syskernelsyskernel ç›®å½•å­˜æ”¾çš„æ˜¯å†…æ ¸ä¸­æ‰€æœ‰å¯è°ƒèŠ‚çš„å‚æ•°ï¼Œè¿™äº›å‚æ•°å¯ç”¨äºç³»ç»Ÿè°ƒä¼˜å’Œèµ„æºç®¡ç†ã€‚é€šè¿‡è°ƒæ•´è¿™äº›å‚æ•°ï¼Œå¯ä»¥æ”¹å–„ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚ sysfirmwareè¯¥ç›®å½•æä¾›å¯¹å›ºä»¶å¯¹è±¡å’Œå±æ€§çš„æ“ä½œæ¥å£ï¼Œæ˜¯ç³»ç»ŸåŠ è½½å›ºä»¶æœºåˆ¶çš„ç”¨æˆ·ç©ºé—´æ¥å£ï¼Œæ—¨åœ¨ç®¡ç†å’Œæ›´æ–°å›ºä»¶ã€‚ syshypervisoræ­¤ç›®å½•ä¸“é—¨ä¸è™šæ‹ŸåŒ–ç³»ç»Ÿ Xen ç›¸å…³ã€‚Xen æ˜¯ä¸€ä¸ªå¼€æºè™šæ‹Ÿæœºç›‘è§†å™¨ï¼Œèƒ½å¤Ÿåœ¨å•ä¸ªç‰©ç†æœºå™¨ä¸ŠåŒæ—¶è¿è¡Œå¤šä¸ªæ“ä½œç³»ç»Ÿï¼Œä»¥ä¾¿æ›´é«˜æ•ˆåœ°åˆ©ç”¨èµ„æºã€‚ sysmodulesysmodule ç›®å½•åŒ…å«ç³»ç»Ÿä¸­æ‰€æœ‰æ¨¡å—çš„ä¿¡æ¯ï¼Œæ¨¡å—å¯ä»¥æ˜¯ç›´æ¥ç¼–è¯‘å…¥å†…æ ¸æ˜ åƒä¸­çš„å†…è”æ¨¡å—ï¼Œä¹Ÿå¯ä»¥æ˜¯ä½œä¸ºå¤–éƒ¨æ¨¡å—ï¼ˆ.ko æ–‡ä»¶ï¼‰åŠ è½½ã€‚æ­¤ç›®å½•æä¾›äº†æ¨¡å—çš„å½“å‰çŠ¶æ€å’Œé…ç½®ï¼Œæœ‰åŠ©äºç³»ç»Ÿç®¡ç†å‘˜è¿›è¡Œæ¨¡å—ç®¡ç†å’Œæ•…éšœæ’é™¤ã€‚ syspowerè¯¥ç›®å½•æè¿°ç³»ç»Ÿä¸­çš„ç”µæºé€‰é¡¹ï¼Œè¦†ç›–å½“å‰æ­£åœ¨ä½¿ç”¨çš„ç”µæºå­ç³»ç»Ÿã€‚è¿™é‡Œæä¾›äº†å¤šä¸ªå±æ€§æ–‡ä»¶ï¼Œè®©ç”¨æˆ·æ§åˆ¶æœºå™¨çš„ç”µæºçŠ¶æ€ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡å‘å±æ€§æ–‡ä»¶å†™å…¥ç‰¹å®šæŒ‡ä»¤æ¥å®ç°å…³æœºæˆ–é‡å¯ç­‰æ“ä½œã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","æ–‡ä»¶ç³»ç»Ÿ"]},{"title":"task_structå’Œæ–‡ä»¶ç³»ç»Ÿ","path":"/2024/12/16/1-å¹³å°ç³»ç»Ÿ-Linux-æ–‡ä»¶ç³»ç»Ÿ-task-structå’Œæ–‡ä»¶ç³»ç»Ÿ/","content":"Linux ä¸­ task_struct å’Œæ–‡ä»¶ç³»ç»Ÿçš„å…³ç³»åœ¨ Linux å†…æ ¸ä¸­ï¼Œtask_struct æ˜¯è¡¨ç¤ºæ¯ä¸ªè¿›ç¨‹çš„æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚åœ¨è¿›ç¨‹è¿è¡Œæ—¶ï¼Œå¯ä»¥é€šè¿‡ current å®è·å–å½“å‰æ‰§è¡Œçš„è¿›ç¨‹çš„ task_struct ç»“æ„ã€‚è¿™ä¸€æ•°æ®ç»“æ„ä¸æ–‡ä»¶ç³»ç»Ÿä¹‹é—´æœ‰ç€å¯†åˆ‡çš„å…³è”ï¼Œå½±å“ç€è¿›ç¨‹å¦‚ä½•è®¿é—®å’Œç®¡ç†å…¶æ‰“å¼€çš„æ–‡ä»¶ã€‚ è¿›ç¨‹ä¸æ–‡ä»¶ç³»ç»Ÿçš„è¿æ¥1. fs_structæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ª fs_struct ç»“æ„ï¼Œç”¨äºæè¿°å…¶æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ã€‚æ­¤ç»“æ„ä½“ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªå­—æ®µï¼š countï¼šè¡¨ç¤ºå…±äº«åŒä¸€ fs_struct çš„è¿›ç¨‹æ•°é‡ã€‚ umaskï¼šç”± umask() ç³»ç»Ÿè°ƒç”¨ä½¿ç”¨ï¼Œå…¶ä½œç”¨æ˜¯è®¾å®šæ–°åˆ›å»ºæ–‡ä»¶çš„é»˜è®¤æƒé™ã€‚ rootã€pwdã€altrootï¼šåˆ†åˆ«è¡¨ç¤ºè¿›ç¨‹çš„æ ¹ç›®å½•ã€å½“å‰å·¥ä½œç›®å½•å’Œæ›¿ä»£æ ¹ç›®å½•ã€‚ åœ¨ Linux 2.4 ä¸­ï¼Œfs_struct çš„å®šä¹‰å¦‚ä¸‹ï¼š struct fs_struct atomic_t count; rwlock_t lock; int umask; struct dentry *root, *pwd, *altroot; struct vfsmount *rootmnt, *pwdmnt, *altrootmnt;; è¿™ä¸‰ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘ dentry ç»“æ„ï¼Œåè€…ç”¨äºæè¿°ç›®å½•é¡¹ã€‚ä¾‹å¦‚ï¼Œè¿›ç¨‹çš„æ ¹ç›®å½•å¯èƒ½æŒ‡å‘ä½äº / ä¸‹çš„ Ext2 æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œå½“å‰å·¥ä½œç›®å½•å¯ä»¥åœ¨ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ¯”å¦‚æŒ‚è½½ç‚¹ /msdos ä¸Šçš„ DOS æ–‡ä»¶ç³»ç»Ÿã€‚è¿™ç§è®¾è®¡å…è®¸è¿›ç¨‹åœ¨åŒä¸€è¿è¡ŒæœŸé—´è·¨è¶Šå¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè€Œ rootmntã€pwdmnt å’Œ altrootmnt åˆ™æè¿°äº†è¿™äº›ç›®å½•çš„æŒ‚è½½ç‚¹ã€‚ 2. files_structæ¯ä¸ªè¿›ç¨‹è¿˜æ‹¥æœ‰ä¸€ä¸ª files_struct ç»“æ„ï¼Œè®°å½•å…¶æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ä¿¡æ¯ï¼Œå®é™…ä¸Šæ˜¯ä¸€å¼ ç”¨æˆ·æ‰“å¼€æ–‡ä»¶çš„è¡¨æ ¼ã€‚è¯¥ç»“æ„åœ¨ include/linux/sched.h ä¸­å®šä¹‰ä¸ºï¼š struct files_struct atomic_t count; rwlock_t file_lock; int max_fds; int max_fdset; int next_fd; fd_set *close_on_exec; fd_set *open_fds; struct file **fd; struct file *fd_array[32];; fd_setï¼šæŒ‡å‘æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦çš„æŒ‡é’ˆæ•°ç»„ï¼Œé€šå¸¸é•¿åº¦ä¸º 32ã€‚å½“æ‰“å¼€çš„æ–‡ä»¶æ•°è¶…å‡ºè¿™ä¸ªé™åˆ¶æ—¶ï¼Œå†…æ ¸ä¼šä¸ºå…¶åˆ†é…æ›´å¤§çš„æ•°ç»„ã€‚ next_fdï¼šè·Ÿè¸ªä¸‹ä¸€ä¸ªå¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ç´¢å¼•ï¼Œç¡®ä¿æ¯æ¬¡æ‰“å¼€æ–°æ–‡ä»¶æ—¶å¯ä»¥æ­£ç¡®åˆ†é…æè¿°ç¬¦ã€‚ open_fdsï¼šç»´æŠ¤å½“å‰å·²æ‰“å¼€æ–‡ä»¶çš„ä½å›¾ï¼Œä½æ•°å–å†³äº max_fdset çš„å€¼ã€‚è¯¥ä½å›¾é€šå¸¸åŒ…å« 1024 ä½ï¼Œè¶³ä»¥è¦†ç›–å¤§å¤šæ•°æƒ…å†µã€‚ åœ¨è¯¥ç»“æ„ä¸­ï¼Œå‰ 3 ä¸ªæ–‡ä»¶æè¿°ç¬¦é€šå¸¸ç”¨ä½œæ ‡å‡†è¾“å…¥ï¼ˆ0ï¼‰ã€æ ‡å‡†è¾“å‡ºï¼ˆ1ï¼‰å’Œæ ‡å‡†é”™è¯¯ï¼ˆ2ï¼‰ã€‚é€šè¿‡ç³»ç»Ÿè°ƒç”¨å¦‚ dup() å’Œ dup2()ï¼Œå¤šä¸ªæ–‡ä»¶æè¿°ç¬¦å¯ä»¥æŒ‡å‘åŒä¸€æ‰“å¼€çš„æ–‡ä»¶ï¼Œä»è€Œå®ç°æ–‡ä»¶é‡å®šå‘ç­‰åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå‘½ä»¤ 21 å¯ä»¥å°†æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºã€‚ 3. struct filestruct file åœ¨ include/linux/fs.h ä¸­å®šä¹‰ï¼Œæè¿°æ¯ä¸ªæ‰“å¼€æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œç»“æ„å¦‚ä¸‹ï¼š struct file struct list_head f_list; struct dentry *f_dentry; struct vfsmount *f_vfsmnt; struct file_operations *f_op; mode_t f_mode; loff_t f_pos; unsigned short f_flags; unsigned short f_count; int f_owner; uid_t f_uid; gid_t f_gid; unsigned long f_version; void *private_data;; f_listï¼šæŒ‡å‘æ‰€æœ‰å·²æ‰“å¼€æ–‡ä»¶çš„é“¾è¡¨ã€‚ f_dentryï¼šæŒ‡å‘æ–‡ä»¶å¯¹åº”çš„ç›®å½•é¡¹ï¼Œç”¨äºæŸ¥æ‰¾æ–‡ä»¶åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä½ç½®ã€‚ f_opï¼šæŒ‡å‘æ–‡ä»¶æ“ä½œè¡¨ï¼ŒåŒ…æ‹¬æ–‡ä»¶çš„å„ç§æ“ä½œæ–¹æ³•ï¼Œå¦‚è¯»å–ã€å†™å…¥ã€å…³é—­ç­‰ã€‚ f_posï¼šè®°å½•æ–‡ä»¶å½“å‰çš„è¯»å–ä½ç½®ã€‚ f_modeï¼šæŒ‡å®šæ–‡ä»¶çš„æ‰“å¼€æ¨¡å¼ï¼ˆå¦‚åªè¯»ã€è¯»å†™ç­‰ï¼‰ã€‚ è¯¥ç»“æ„ä½“ä½¿å¾— Linux å†…æ ¸åœ¨æ–‡ä»¶æ“ä½œæ—¶èƒ½å¤Ÿç®¡ç†æ–‡ä»¶çš„çŠ¶æ€å’Œç›¸å…³ä¿¡æ¯ï¼Œç¡®ä¿è¿›ç¨‹é—´æ–‡ä»¶è®¿é—®çš„åè°ƒå’Œæ•ˆç‡ã€‚ é€šè¿‡ä»¥ä¸Šç»“æ„å’Œæè¿°ï¼Œå¯ä»¥çœ‹åˆ° Linux çš„è¿›ç¨‹ä¸æ–‡ä»¶ç³»ç»Ÿä¹‹é—´çš„ç²¾å¯†è”ç³»ï¼Œä½¿å¾—æ“ä½œç³»ç»Ÿèƒ½å¤Ÿé«˜æ•ˆåœ°ç®¡ç†å¤šè¿›ç¨‹ç¯å¢ƒä¸‹çš„æ–‡ä»¶æ“ä½œã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","æ–‡ä»¶ç³»ç»Ÿ"]},{"title":"å†…å­˜ç®¡ç†","path":"/2024/12/13/1-å¹³å°ç³»ç»Ÿ-Linux-ç¨‹åº-å†…å­˜ç®¡ç†/","content":"ç‰©ç†å†…å­˜ç®¡ç†ï¼ˆé¡µç®¡ç†ï¼‰Linux å†…æ ¸é€šè¿‡åˆ†é¡µæœºåˆ¶ç®¡ç†ç‰©ç†å†…å­˜ï¼Œå°†æ•´ä¸ªå†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ª 4KB å¤§å°çš„é¡µé¢ï¼ˆè¿™æ˜¯åœ¨ i386 ä½“ç³»ç»“æ„ä¸­çš„æ ‡å‡†å¤§å°ï¼‰ã€‚åœ¨è¿™ç§æœºåˆ¶ä¸‹ï¼Œå†…å­˜çš„åŸºæœ¬åˆ†é…å’Œå›æ”¶å•ä½ä¾¿æ˜¯è¿™äº›å†…å­˜é¡µã€‚è¿™ç§åˆ†é¡µç®¡ç†æ–¹å¼å¸¦æ¥äº†çµæ´»çš„å†…å­˜åœ°å€åˆ†é…ï¼Œè¿›ç¨‹åœ¨éœ€è¦å†…å­˜æ—¶ï¼Œå¯ä»¥ä¸å¿…ä¾èµ–äºå¤§å—è¿ç»­çš„å†…å­˜ã€‚åœ¨å®é™…æ“ä½œä¸­ï¼Œç³»ç»Ÿèƒ½å¤Ÿå°†å¥½å‡ å—é›¶æ•£çš„é¡µé¢ç»„åˆèµ·æ¥ï¼Œæ»¡è¶³è¿›ç¨‹çš„å†…å­˜éœ€æ±‚ã€‚ è™½ç„¶åˆ†é¡µç®¡ç†æ”¯æŒåˆ†æ•£çš„å†…å­˜åˆ†é…ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç³»ç»Ÿå€¾å‘äºåˆ†é…è¿ç»­çš„å†…å­˜å—ã€‚è¿™æ˜¯å› ä¸ºåœ¨åˆ†é…è¿ç»­å†…å­˜æ—¶ï¼Œé¡µè¡¨çš„ç»“æ„ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä»è€Œé™ä½äº†ç¿»è¯‘åå¤‡ç¼“å†²åŒºï¼ˆTLBï¼‰çš„åˆ·æ–°é¢‘ç‡ã€‚TLB åˆ·æ–°å¾—è¶Šé¢‘ç¹ï¼Œè®¿é—®é€Ÿåº¦å°±è¶Šæ…¢ï¼Œå› æ­¤ç³»ç»Ÿé€šè¿‡æ­¤æ–¹å¼ä¼˜åŒ–äº†æ€»ä½“æ€§èƒ½ã€‚ ä¸ºäº†å‡å°‘ä¸è¿ç»­å†…å­˜åˆ†é…çš„æƒ…å†µï¼ŒLinux å†…æ ¸é‡‡ç”¨äº†ä¸€ç§ç§°ä¸ºâ€œä¼™ä¼´â€å…³ç³»çš„ç®—æ³•æ¥ç®¡ç†ç©ºé—²é¡µæ¡†ã€‚ä¼™ä¼´å…³ç³»åˆ†é…ç®—æ³•æ˜¯æ“ä½œç³»ç»Ÿé¢†åŸŸçš„ç»å…¸ç†è®ºï¼Œå‡ ä¹æ‰€æœ‰ç›¸å…³æ•™æéƒ½ä¼šä»‹ç»è¿™ä¸€å†…å®¹ã€‚åœ¨ Linux ä¸­ï¼Œç©ºé—²é¡µé¢çš„ç»„ç»‡å’Œç®¡ç†ä¾èµ–äºè¿™ç§ä¼™ä¼´å…³ç³»ã€‚å› æ­¤ï¼Œåœ¨åˆ†é…ç©ºé—²é¡µé¢æ—¶ï¼Œå¿…é¡»éµå¾ªä¼™ä¼´å…³ç³»çš„åŸåˆ™ï¼Œæœ€å°çš„åˆ†é…å•ä½æ˜¯ 2 çš„å¹‚å€ï¼Œå³é¡µé¢å¤§å°å¿…é¡»ä¸º 2ã€4ã€8â€¦512 ç­‰ã€‚ å†…æ ¸ä¸­è´Ÿè´£åˆ†é…ç©ºé—²é¡µæ¡†çš„åŸºæœ¬å‡½æ•°æ˜¯ get_free_page å’Œ get_free_pagesã€‚å‰è€…ç”¨äºåˆ†é…å•ä¸ªé¡µé¢ï¼Œè€Œåè€…å¯ç”¨äºåˆ†é…æŒ‡å®šæ•°é‡çš„é¡µæ¡†ï¼Œæ¯”å¦‚ 2ã€4ã€8ï¼Œç›´è‡³ 512 é¡µã€‚è¿™ä¸¤ä¸ªå‡½æ•°çš„ä½¿ç”¨ä¸ç”¨æˆ·ç©ºé—´çš„å†…å­˜åˆ†é…æœºåˆ¶æ˜¾è‘—ä¸åŒã€‚get_free_page åœ¨å†…æ ¸ä¸­åˆ†é…å†…å­˜ï¼Œè€Œ malloc åˆ™æ˜¯åœ¨ç”¨æˆ·ç©ºé—´è¿›è¡Œåˆ†é…ã€‚malloc ä¾æ‰˜äºå †åŠ¨æ€åˆ†é…å†…å­˜ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡è°ƒç”¨ brk() ç³»ç»Ÿè°ƒç”¨æ¥å®ç°çš„ã€‚ brk() ç³»ç»Ÿè°ƒç”¨å¯ä»¥æ‰©å¤§æˆ–ç¼©å°è¿›ç¨‹çš„å †ç©ºé—´ï¼Œä¿®æ”¹è¿›ç¨‹çš„ brk åŸŸã€‚å¦‚æœå½“å‰å†…å­˜åŒºåŸŸä¸è¶³ä»¥å®¹çº³æ–°è¯·æ±‚çš„å †ç©ºé—´ï¼Œåˆ™ä¼šä»¥é¡µé¢å¤§å°çš„å€æ•°æ”¹å˜å†…å­˜åŒºåŸŸçš„å¤§å°ã€‚ç„¶è€Œï¼Œbrk çš„ä¿®æ”¹å¹¶ä¸ä¸€å®šä¸¥æ ¼æŒ‰é¡µé¢å¤§å°ï¼Œè€Œæ˜¯ä¾æ®å®é™…è¯·æ±‚æ¥è°ƒæ•´ã€‚è¿™æ„å‘³ç€ï¼Œè™½ç„¶ç”¨æˆ·ç©ºé—´çš„å†…å­˜åˆ†é…å¯ä»¥ä»¥å­—èŠ‚ä¸ºå•ä½è¿›è¡Œï¼Œä½†å†…æ ¸å†…éƒ¨åˆ†é…ä»ç„¶æ˜¯ä»¥é¡µé¢ä¸ºå•ä½è¿›è¡Œã€‚ æ­¤å¤–ï¼Œç‰©ç†é¡µåœ¨ç³»ç»Ÿä¸­ç”±ä¸€ä¸ªåä¸º struct page çš„ç»“æ„æè¿°ã€‚ç³»ç»Ÿä¸­çš„æ‰€æœ‰é¡µæ¡†è¢«å­˜å‚¨åœ¨ä¸€ä¸ªæ•°ç»„ mem_map[] ä¸­ï¼Œé€šè¿‡è¯¥æ•°ç»„å¯è®¿é—®ç³»ç»Ÿä¸­çš„æ¯ä¸€é¡µï¼Œæ— è®ºæ˜¯ç©ºé—²é¡µè¿˜æ˜¯æ­£åœ¨ä½¿ç”¨çš„é¡µã€‚ç©ºé—²é¡µæ¡†åˆ™é€šè¿‡ä»¥ä¼™ä¼´å…³ç³»ç»„ç»‡çš„ç©ºé—²é¡µé“¾è¡¨ ï¼ˆfree_area[MAX_ORDER]ï¼‰ ç´¢å¼•ï¼Œä½¿å¾—å†…å­˜ç®¡ç†æ›´åŠ é«˜æ•ˆä¸ç³»ç»ŸåŒ–ã€‚ å†…æ ¸å†…å­˜ä½¿ç”¨Slabå†…æ ¸åœ¨ç®¡ç†ç‰©ç†å†…å­˜æ—¶ï¼Œä»¥é¡µä¸ºæœ€å°å•ä½æ¥åˆ†é…å†…å­˜ç¡®å®æ–¹ä¾¿ï¼Œä½†å†…æ ¸é€šå¸¸éœ€æ±‚çš„å°å†…å­˜å—å¾€å¾€è¿œå°äºä¸€ä¸ªé¡µé¢ã€‚æ¯”å¦‚ï¼Œæ–‡ä»¶æè¿°ç¬¦ã€è¿›ç¨‹æè¿°ç¬¦å’Œè™šæ‹Ÿå†…å­˜åŒºåŸŸæè¿°ç¬¦ç­‰ï¼Œè¿™äº›éƒ½åªéœ€æå°çš„å†…å­˜ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ä»…å ç”¨ 64 å­—èŠ‚ï¼Œè€Œä¸€ä¸ªå®Œæ•´çš„é¡µé¢é€šå¸¸æ˜¯ 4KBã€‚å› æ­¤ï¼Œå°†è¿™äº›å°å—å†…å­˜è§†ä¸ºé¢åŒ…å±‘ï¼Œæ•°é‡ä¼—å¤šä¸”é¢‘ç¹å˜åŒ–ï¼Œè¿œè¿œèµ‹äºˆå®ƒä»¬æ›´å¤§çš„çµæ´»æ€§ã€‚ ä¸ºäº†æ›´é«˜æ•ˆåœ°æ»¡è¶³è¿™ç§å°å†…å­˜å—çš„éœ€è¦ï¼ŒLinux æ“ä½œç³»ç»Ÿå¼•å…¥äº†è¢«ç§°ä¸ºSlab åˆ†é…å™¨çš„æŠ€æœ¯ã€‚è™½ç„¶ Slab çš„å®ç°è¾ƒä¸ºå¤æ‚ï¼Œä½†å…¶åŸºæœ¬åŸç†ç›¸å¯¹ç®€å•ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯å»ºç«‹ä¸€ä¸ªâ€œå­˜å‚¨æ± â€ï¼Œåœ¨è¿™ä¸ªæ± ä¸­ï¼Œå†…å­˜ç‰‡æ®µï¼ˆæˆ–å°å—å†…å­˜ï¼‰è¢«è§†ä¸ºå¯¹è±¡ã€‚ä½¿ç”¨å®Œè¿™äº›å¯¹è±¡åï¼Œå®ƒä»¬å¹¶ä¸ç›´æ¥é‡Šæ”¾ï¼Œè€Œæ˜¯å­˜æ”¾åœ¨â€œå­˜å‚¨æ± â€ä¸­ä»¥å¾…ä¸‹æ¬¡ä½¿ç”¨ã€‚è¿™ç§åšæ³•æ˜¾è‘—å‡å°‘äº†é¢‘ç¹åˆ›å»ºå’Œé”€æ¯å¯¹è±¡æ—¶æ‰€äº§ç”Ÿçš„é¢å¤–å¼€é”€ã€‚ Slab åˆ†é…å™¨çš„å¼•å…¥ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘å¯¹ä¼™ä¼´ç³»ç»Ÿåˆ†é…ç®—æ³•çš„è°ƒç”¨é¢‘ç‡ï¼Œé¢‘ç¹çš„åˆ†é…å’Œå›æ”¶å®¹æ˜“å¯¼è‡´å†…å­˜ç¢ç‰‡åŒ–é—®é¢˜ã€‚æ­¤å¤–ï¼ŒSlab è¿˜èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨ç¡¬ä»¶ç¼“å­˜ï¼Œæå‡å†…å­˜è®¿é—®é€Ÿåº¦ã€‚Slab å¹¶éç‹¬ç«‹äºä¼™ä¼´ç³»ç»Ÿçš„å­˜åœ¨ï¼Œå®ƒä»ç„¶ä¾èµ–äºé¡µé¢çš„åŸºæœ¬ç»“æ„ï¼Œå®é™…ä¸Šï¼ŒSlab åœ¨ä¼™ä¼´å…³ç³»ç®¡ç†çš„ç©ºé—²é¡µæ¡†é“¾åŸºç¡€ä¸Šï¼Œå°†ä¸€ä¸ªå®Œæ•´é¡µé¢åˆ’åˆ†ä¸ºå¤šä¸ªå¯ç”¨çš„å°å†…å­˜å—ï¼Œä»¥æ»¡è¶³å†…æ ¸å†…å­˜åˆ†é…çš„éœ€æ±‚ã€‚Slab ä¸­å¯¹è±¡çš„åˆ†é…å’Œé‡Šæ”¾åˆ™é€šè¿‡ kmem_cache_alloc ä¸ kmem_cache_free æ¥è¿›è¡Œã€‚ KmaloKmallocæ˜¯ Slab åˆ†é…å™¨å¯¹å°å—å†…å­˜ï¼ˆç‰¹åˆ«æ˜¯å°äºä¸€ä¸ªé¡µé¢çš„å†…å­˜ï¼‰çš„è¯·æ±‚å¤„ç†æ¥å£ã€‚è™½ç„¶ Kmalloc çš„åˆ†é…èŒƒå›´ä» 32 å­—èŠ‚åˆ° 131072 å­—èŠ‚ä¸ç­‰ï¼Œä½†å®ƒé€šå¸¸ç”¨äºç”³è¯·å°äºä¸€é¡µçš„å†…å­˜ã€‚å®ƒä¸ºå†…æ ¸ç¨‹åºæä¾›äº†æ¯” get_free_page æ›´çµæ´»çš„å†…å­˜åˆ†é…æ–¹å¼ï¼Œå¡«è¡¥äº†ä¸åŒå†…å­˜éœ€æ±‚ä¹‹é—´çš„ç©ºç™½ã€‚å®é™…ä¸Šï¼Œä»å†…æ ¸å†…å­˜åˆ†é…çš„è§’åº¦æ¥çœ‹ï¼ŒKmalloc ä¸ get_free_page äº’ä¸ºè¡¥å……ï¼Œæä¾›äº†ä¸åŒç²’åº¦çš„å†…å­˜åˆ†é…ã€‚ åœ¨ /proc/slabinfo è·¯å¾„ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°æœ‰å…³å½“å‰å†…æ ¸è¿è¡Œæ—¶æ‰€ä½¿ç”¨çš„å„ç±» Slab çš„ä¿¡æ¯ç»Ÿè®¡ã€‚è¿™äº›æ•°æ®æ˜¾ç¤ºäº†é™¤ä¸“ç”¨ç»“æ„ä½“ä½¿ç”¨çš„ Slab å¤–ï¼Œè¿˜æœ‰å¤§é‡ä¸º Kmalloc æ‰€å‡†å¤‡çš„ Slab å¯¹è±¡ï¼ŒåŒ…æ‹¬æŸäº›ä¸“ä¸º DMAï¼ˆç›´æ¥å†…å­˜å­˜å–ï¼‰æ“ä½œè®¾è®¡çš„ Slabã€‚ å†…æ ¸éè¿ç»­å†…å­˜åˆ†é…ï¼ˆVmallocï¼‰ä»å†…å­˜ç®¡ç†çš„ç†è®ºå‡ºå‘ï¼Œæ— è®ºæ˜¯ä¼™ä¼´å…³ç³»è¿˜æ˜¯ Slab æŠ€æœ¯ï¼Œéƒ½æ—¨åœ¨é¿å…â€œåˆ†ç‰‡â€é—®é¢˜ã€‚å†…éƒ¨åˆ†ç‰‡é€šå¸¸æ˜¯ç”±äºç³»ç»Ÿä¸ºæ»¡è¶³å°èŒƒå›´çš„å†…å­˜éœ€æ±‚ï¼Œä¸å¾—ä¸åˆ†é…è¾ƒå¤§çš„å†…å­˜æ®µï¼Œä»è€Œé€ æˆç©ºé—´çš„æµªè´¹ã€‚è€Œå¤–éƒ¨åˆ†ç‰‡åˆ™æ˜¯æŒ‡å°½ç®¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œä½†ç”±äºåˆ†æ•£çš„ç¢ç‰‡æ— æ³•æ»¡è¶³å¯¹å¤§å—è¿ç»­å†…å­˜çš„è¯·æ±‚ã€‚ä¸¤ç§åˆ†ç‰‡å½¢å¼éƒ½æ˜¯å†…å­˜é«˜æ•ˆåˆ©ç”¨çš„éšœç¢ã€‚ Slab åˆ†é…å™¨ä½¿å¾—ä¸€ä¸ªé¡µé¢å¯ä»¥å®¹çº³è®¸å¤šå°å†…å­˜å—ï¼Œé¿å…ä½æ•ˆçš„å†…éƒ¨åˆ†ç‰‡ï¼ŒèŠ‚çº¦äº†å†…å­˜ã€‚è€Œä¼™ä¼´å…³ç³»é€šè¿‡å°†å†…å­˜å—æŒ‰å¤§å°åˆ†ç»„è¿›è¡Œç®¡ç†ï¼Œå°½é‡ç¼“è§£å¤–éƒ¨åˆ†ç‰‡çš„å½±å“ã€‚ä½†å³ä¾¿å¦‚æ­¤ï¼Œä¼™ä¼´å…³ç³»å¹¶æœªå®Œå…¨æ¶ˆé™¤å¤–éƒ¨åˆ†ç‰‡çš„é—®é¢˜ã€‚åæ˜ åœ¨å¤šæ¬¡åˆ†é…åï¼Œå‰©ä½™çš„ç©ºé—²å†…å­˜å¯èƒ½ä¾æ—§åˆ†å¸ƒä¸å‡ï¼Œéš¾ä»¥æ»¡è¶³å¤§å†…å­˜å—çš„è¯·æ±‚ã€‚ è¦è§£å†³å¤–éƒ¨åˆ†ç‰‡çš„é—®é¢˜ï¼Œæœ€ç»ˆçš„æ–¹æ¡ˆåœ¨äºå¦‚ä½•å°†ä¸è¿ç»­çš„å†…å­˜å—ç»„åˆæˆé€»è¾‘ä¸Šçœ‹ä¼¼â€œè¿ç»­â€çš„å¤§å†…å­˜å—ã€‚è¿™ä¸€ç†å¿µå’Œç”¨æˆ·ç©ºé—´çš„è™šæ‹Ÿå†…å­˜åˆ†é…ç›¸ä¼¼ï¼Œå†…å­˜é€»è¾‘ä¸Šè¿ç»­ï¼Œå®é™…ä¸Šå´å¯èƒ½æ˜ å°„åˆ°ä¸è¿è´¯çš„ç‰©ç†å†…å­˜ä¸Šã€‚Linux å†…æ ¸å€Ÿç”¨æ­¤æŠ€æœ¯ï¼Œå…è®¸åœ¨å†…æ ¸åœ°å€ç©ºé—´ä¸­ç”³è¯·è™šæ‹Ÿåœ°å€ï¼Œå¹¶é€šè¿‡å†…æ ¸é¡µè¡¨å°†è¿™äº›è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°æ•£å¸ƒçš„ç‰©ç†é¡µä¸Šï¼Œå·§å¦™åœ°è§£å†³äº†å¤–éƒ¨åˆ†ç‰‡çš„é—®é¢˜ã€‚ å†…æ ¸æä¾›äº† vmalloc å‡½æ•°æ¥åˆ†é…å†…æ ¸è™šæ‹Ÿå†…å­˜ã€‚ä¸ Kmalloc ä¸åŒï¼Œvmalloc èƒ½å¤Ÿåˆ†é…æ›´å¤§ï¼Œé€šå¸¸è¶…è¿‡ 128K çš„å†…å­˜ç©ºé—´ï¼Œä½†å¿…é¡»æ˜¯é¡µé¢å¤§å°çš„å€æ•°ã€‚ç”±äºè¦æ›´æ–°å†…æ ¸é¡µè¡¨ä»¥å®ç°è™šæ‹Ÿåœ°å€çš„æ˜ å°„ï¼Œvmalloc çš„åˆ†é…æ•ˆç‡è¾ƒ Kmalloc ä½ã€‚è¿™ç§â€œç”¨ç©ºé—´æ¢æ—¶é—´â€çš„ç­–ç•¥ä½¿å¾—å†…æ ¸åœ¨é¢å¯¹è¾ƒå¤§çš„å†…å­˜éœ€æ±‚æ—¶ï¼Œå¯é€šè¿‡æ˜ å°„æ— åºçš„ç‰©ç†å†…å­˜é¡µæ¥å®ç°çµæ´»åˆ†é…ã€‚ ç±»ä¼¼äºç”¨æˆ·è¿›ç¨‹ï¼Œå†…æ ¸ä¹Ÿç»´æŠ¤ä¸€ä¸ªåä¸º init_mm çš„ mm_struct ç»“æ„æ¥æè¿°å…¶åœ°å€ç©ºé—´ï¼Œé¡µè¡¨é¡¹ pdgï¼ˆswapper_pg_dirï¼‰åˆ—å‡ºäº†ç³»ç»Ÿå†…æ ¸ç©ºé—´ï¼ˆ3G-4Gï¼‰çš„æ˜ å°„å…³ç³»ã€‚å› æ­¤ï¼Œvmalloc éœ€è¦æ›´æ–°å†…æ ¸é¡µè¡¨ä»¥å®Œæˆè™šæ‹Ÿåœ°å€çš„åˆ†é…ï¼Œè€Œ kmalloc æˆ– get_free_page å› ä¸ºåˆ†é…çš„æ˜¯è¿ç»­å†…å­˜ï¼Œè‡ªç„¶ä¸éœ€è¿›è¡Œé¡µè¡¨æ›´æ–°ã€‚ å†…æ ¸è™šæ‹Ÿå†…å­˜åˆ†é…åœ¨å†…æ ¸ç©ºé—´ä¸­ï¼Œå†…å­˜åˆ†é…é‡‡ç”¨äº†ä¸åŒçš„æœºåˆ¶ï¼Œå…¶ä¸­ vmalloc æ‰€åˆ†é…çš„å†…æ ¸è™šæ‹Ÿå†…å­˜å’Œå…¶ä»–æ–¹æ³•å¦‚ kmalloc åŠ get_free_page åˆ†é…çš„å†…å­˜æ˜¯ä½äºä¸åŒçš„åœ°å€åŒºé—´ï¼Œå½¼æ­¤ä¹‹é—´ä¸ä¼šå‘ç”Ÿé‡å ã€‚è¿™æ˜¯å› ä¸ºå†…æ ¸è™šæ‹Ÿç©ºé—´å¿…é¡»ç»è¿‡æœ‰æ•ˆçš„åˆ†åŒºç®¡ç†ï¼Œä»¥ç¡®ä¿æ¯ç§åˆ†é…æ–¹æ³•èƒ½é«˜æ•ˆä¸”å®‰å…¨åœ°è¿è¡Œå„è‡ªçš„åŠŸèƒ½ã€‚ è™šæ‹Ÿåœ°å€åˆ†å¸ƒè¿›ç¨‹ç©ºé—´è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´é€šå¸¸åˆ†å¸ƒåœ¨ 0 åˆ° 3GB çš„åŒºé—´ã€‚å¯¹äº x86 æ¶æ„ï¼Œå…·ä½“æ¥è¯´ï¼Œå®é™…çš„åˆ†ç•Œä¼šåœ¨ PAGE_OFFSETï¼Œå…¶å€¼ä¸º 0xC0000000ã€‚è¿™ä¸ªèŒƒå›´ä¸»è¦ç”¨äºè¿›ç¨‹è‡ªèº«çš„ä½¿ç”¨ï¼ŒåŒ…æ‹¬ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„äº¤äº’ã€‚ ç‰©ç†å†…å­˜æ˜ å°„åŒº3GB åˆ° vmalloc_start çš„åœ°å€æ®µåˆ™æ˜¯ç‰©ç†å†…å­˜æ˜ å°„åŒºåŸŸï¼Œåœ¨æ­¤åŒºåŸŸå†…åŒ…æ‹¬äº†è®¸å¤šé‡è¦çš„ç³»ç»Ÿèµ„æºï¼Œæ¯”å¦‚å†…æ ¸é•œåƒå’Œç‰©ç†é¡µæ¡†è¡¨ mem_map ç­‰ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå¯ç”¨ç³»ç»Ÿå†…å­˜ä¸º 64MB çš„æƒ…å†µä¸‹ï¼ˆå¯ä»¥é€šè¿‡å‘½ä»¤ free è¿›è¡ŒæŸ¥çœ‹ï¼‰ï¼Œåˆ™è¿™æ®µåœ°å€çš„æ˜ å°„ç‰©ç†å†…å­˜æ˜¯ä» 3GB åˆ° 3GB + 64MBã€‚è¿™æ„å‘³ç€åœ¨æ­¤ç‰©ç†å†…å­˜æ˜ å°„åŒºï¼Œå†…å­˜çš„å®é™…ä½¿ç”¨æƒ…å†µæ˜¯å¯ä»¥è¢«è¯»å†™çš„ã€‚ vmalloc åŒºåŸŸé€šå¸¸ï¼Œvmalloc_start åº”è¯¥ä¼šä½äº 3GB + 64MB é™„è¿‘ã€‚è¿™ä¸ªâ€é™„è¿‘â€çš„å®šä¹‰æ˜¯å› ä¸ºåœ¨ç‰©ç†å†…å­˜æ˜ å°„åŒºå’Œ vmalloc_start ä¹‹é—´å­˜åœ¨ä¸€ä¸ªçº¦ 8MB çš„é—´éš™ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢åœ°å€çš„äº¤å‰å’Œæ½œåœ¨çš„é”™è¯¯ã€‚ vmalloc_endç›¸åº”åœ°ï¼Œvmalloc_end çš„ä½ç½®é€šå¸¸æ¥è¿‘ 4GBã€‚è¿™ä¸ªæ¥è¿‘çš„è¡¨è¿°æ˜¯ç”±äºç³»ç»Ÿéœ€ä¿ç•™ä¸€ä¸ª 128KB çš„ä¸“ç”¨é¡µé¢æ˜ å°„åŒºåŸŸã€‚æ­¤å¤–ï¼Œä¹Ÿå¯èƒ½ä¼šæ¶‰åŠé«˜ç«¯å†…å­˜æ˜ å°„åŒºåŸŸï¼Œå…·ä½“ç»†èŠ‚åœ¨æ­¤ä¸å†æ·±å…¥æ¢è®¨ã€‚è¿™æ ·è®¾è®¡çš„ä¸»è¦ç›®çš„æ˜¯ç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿé«˜æ•ˆåœ°è¿›è¡Œå†…å­˜ç®¡ç†ã€‚ ä»¥ä¸Šå›¾åƒæ¸…æ¥šåœ°å±•ç¤ºäº†å†…å­˜åˆ†å¸ƒçš„æ¨¡ç³Šè½®å»“ï¼Œä½¿å¾—æ•´ä½“ç»“æ„ä¸€ç›®äº†ç„¶ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸åŒçš„å†…å­˜åˆ†é…åŒºåŸŸåœ¨åœ°å€ç©ºé—´ä¸­çš„å…³ç³»å’Œå¸ƒå±€ï¼Œä»è€Œæœ‰åŠ©äºæ›´å¥½åœ°ç†è§£å†…æ ¸å†…å­˜çš„åˆ†é…æœºåˆ¶ã€‚ ç”± get_free_page æˆ– kmalloc å‡½æ•°æ‰€åˆ†é…çš„è¿ç»­å†…å­˜å±äºç‰©ç†æ˜ å°„åŒºåŸŸï¼Œè¿™æ„å‘³ç€å®ƒä»¬åœ¨å†…å­˜ä¸­çš„å†…æ ¸è™šæ‹Ÿåœ°å€å’Œå®é™…çš„ç‰©ç†åœ°å€ä¹‹é—´ä»…ç›¸å·®ä¸€ä¸ªå›ºå®šçš„åç§»é‡ï¼Œç§°ä¸º PAGE_OFFSETã€‚è¿™ä¸€ç‰¹æ€§ä½¿å¾—åœ¨è¿›è¡Œå†…å­˜ç®¡ç†æ—¶èƒ½å¤Ÿå¾ˆæ–¹ä¾¿åœ°è¿›è¡Œå†…æ ¸è™šæ‹Ÿåœ°å€ä¸ç‰©ç†å†…å­˜åœ°å€ä¹‹é—´çš„è½¬æ¢ã€‚å†…æ ¸è¿˜æä¾›äº† virt_to_phys() å‡½æ•°ï¼Œä¸“é—¨ç”¨äºå°†å†…æ ¸è™šæ‹Ÿç©ºé—´ä¸­çš„ç‰©ç†æ˜ å°„åŒºåœ°å€è½¬åŒ–ä¸ºå®é™…çš„ç‰©ç†åœ°å€ã€‚ åœ¨ç‰©ç†å†…å­˜æ˜ å°„åŒºåŸŸä¸­çš„æ¯ä¸ªåœ°å€ä¸å†…æ ¸é¡µè¡¨æœ‰åºå¯¹åº”ï¼Œè¿™æ ·ç³»ç»Ÿä¸­çš„æ¯ä¸ªç‰©ç†é¡µæ¡†éƒ½èƒ½å¤Ÿè¢«æ˜ å°„åˆ°å®ƒå¯¹åº”çš„å†…æ ¸è™šæ‹Ÿåœ°å€ã€‚è¿™ç§æ˜ å°„å…³ç³»ç¡®ä¿äº†å†…å­˜ç®¡ç†çš„é«˜æ•ˆæ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œå‡è®¾ç‰©ç†åœ°å€ 0x1F000 é€šè¿‡å†…æ ¸é¡µè¡¨å¯ä»¥æŸ¥æ‰¾åˆ°å…¶å¯¹åº”çš„è™šæ‹Ÿåœ°å€ 0xC000F000ï¼Œå¼€å‘è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€æ˜ å°„å…³ç³»æ›´è½»æ¾åœ°å¯¹å†…å­˜è¿›è¡Œæ“ä½œã€‚ ä¸ get_free_page å’Œ kmalloc çš„å†…å­˜åˆ†é…ä¸åŒï¼Œvmalloc åˆ†é…çš„åœ°å€åªæ˜¯åœ¨ vmalloc_start ä¸ vmalloc_end ä¹‹é—´ã€‚æ¯ä¸€å—é€šè¿‡ vmalloc åˆ†é…çš„å†…æ ¸è™šæ‹Ÿå†…å­˜éƒ½å¯¹åº”ä¸€ä¸ª vm_struct ç»“æ„ä½“ã€‚éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œä¸è¦å°† vm_struct ä¸ vm_area_struct æ··æ·†ï¼Œåè€…æ˜¯ç”¨äºæè¿°è¿›ç¨‹è™šæ‹Ÿå†…å­˜åŒºåŸŸçš„ç»“æ„ä½“ã€‚ä¸ºäº†é˜²æ­¢å†…å­˜è¶Šç•Œï¼Œvmalloc åˆ†é…çš„å†…æ ¸è™šæ‹Ÿåœ°å€é—´éš”ç€ 4k å­—èŠ‚å¤§å°çš„ç©ºé—²åŒºï¼ˆè¯·å‚è§ä¸‹å›¾ï¼‰ã€‚ è¿™äº›å†…æ ¸è™šæ‹Ÿåœ°å€çš„è¡Œä¸ºç±»ä¼¼äºè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ï¼ŒäºŒè€…ä¹‹é—´å¹¶æ²¡æœ‰ç®€å•çš„ä½ç§»å…³ç³»ã€‚å¿…é¡»é€šè¿‡å†…æ ¸é¡µè¡¨è¿›è¡Œè½¬æ¢ï¼Œä»¥è·å–ç›¸åº”çš„ç‰©ç†åœ°å€æˆ–ç‰©ç†é¡µã€‚è¿™æ„å‘³ç€è¿™äº›è™šæ‹Ÿåœ°å€åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½å°šæœªè¢«æ˜ å°„ï¼Œå½“å‘ç”Ÿç¼ºé¡µå¼‚å¸¸æ—¶æ‰ä¼šçœŸæ­£åˆ†é…ç‰©ç†é¡µæ¡†ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªå°ç¨‹åºï¼Œå¸®åŠ©ç†è§£ä¸Šè¿°å‡ ç§å†…å­˜åˆ†é…å‡½æ•°æ‰€å¯¹åº”çš„åŒºåŸŸï¼š #include linux/module.h#include linux/slab.h#include linux/vmalloc.hunsigned char *pagemem;unsigned char *kmallocmem;unsigned char *vmallocmem;int init_module(void) pagemem = get_free_page(0); printk(1 pagemem = %s , pagemem); kmallocmem = kmalloc(100, GFP_KERNEL); printk(1 kmallocmem = %s , kmallocmem); vmallocmem = vmalloc(1000000); printk(1 vmallocmem = %s , vmallocmem); return 0;void cleanup_module(void) free_page(pagemem); kfree(kmallocmem); vfree(vmallocmem); åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼š get_free_page(0) åˆ†é…ä¸€ä¸ªç‰©ç†é¡µï¼Œå¹¶è¿”å›å…¶å†…æ ¸è™šæ‹Ÿåœ°å€ã€‚ kmalloc(100, GFP_KERNEL) ä¸ºå†…æ ¸åˆ†é… 100 å­—èŠ‚çš„è¿ç»­å†…å­˜ã€‚ vmalloc(1000000) åˆ†é…ä¸€ä¸ªè™šæ‹Ÿåœ°å€èŒƒå›´ï¼Œèƒ½å¤Ÿå®¹çº³ 1,000,000 å­—èŠ‚ï¼Œä½†å…¶å¯¹åº”çš„ç‰©ç†å†…å­˜ä¸ä¸€å®šæ˜¯è¿ç»­çš„ã€‚ åœ¨æ¨¡å—å¸è½½æ—¶ï¼Œç›¸åº”çš„èµ„æºè¢«é‡Šæ”¾ï¼Œä»¥é˜²æ­¢å†…å­˜æ³„æ¼ã€‚è¿™ç§ä¼˜é›…çš„å†…å­˜ç®¡ç†ç¡®ä¿äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œé«˜æ•ˆæ€§ã€‚ å†…å­˜ç®¡ç†å®ä¾‹ä»£ç åŠŸèƒ½ä»‹ç»ç›®æ ‡æ˜¯é€šè¿‡è®¿é—®ç”¨æˆ·ç©ºé—´çš„å†…å­˜æ¥è¯»å–å†…æ ¸æ•°æ®ï¼Œå®ç°å†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´ä¹‹é—´çš„å¤§è§„æ¨¡ä¿¡æ¯ä¼ è¾“ã€‚å…·ä½“è€Œè¨€ï¼Œåˆ©ç”¨å†…å­˜æ˜ å°„åŠŸèƒ½ï¼Œå°†ç³»ç»Ÿå†…æ ¸ä¸­çš„ä¸€éƒ¨åˆ†è™šæ‹Ÿå†…å­˜æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ï¼Œä»è€Œä½¿å¾—ç”¨æˆ·ç©ºé—´åœ°å€ä¸è¢«æ˜ å°„çš„å†…æ ¸å†…å­˜åœ°å€ç›¸ç­‰ã€‚ ä»£ç ç»“æ„ä½“ç³»ä»‹ç»å†…æ ¸ç©ºé—´å†…å­˜åˆ†é…è®¡åˆ’ç¼–å†™ä¸€ä¸ªè™šæ‹Ÿå­—ç¬¦è®¾å¤‡é©±åŠ¨ç¨‹åºï¼Œé€šè¿‡è¯¥ç¨‹åºå°†ç³»ç»Ÿå†…æ ¸ç©ºé—´æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ã€‚è¿™æ„å‘³ç€å°†å†…æ ¸è™šæ‹Ÿå†…å­˜æ˜ å°„åˆ°ç”¨æˆ·è™šæ‹Ÿåœ°å€ã€‚åœ¨è¿›è¡Œæ˜ å°„æ—¶ï¼Œéœ€è¦å‡†ç¡®å®šä½å†…æ ¸ç©ºé—´å¯¹åº”çš„ç‰©ç†åœ°å€ï¼Œå¹¶å»ºç«‹æ–°çš„ç”¨æˆ·é¡µè¡¨é¡¹ã€‚è¿™æ ·ï¼Œç”¨æˆ·è¿›ç¨‹åœ¨å¯»å€æ—¶èƒ½æ‰¾åˆ°å¯¹åº”çš„ç‰©ç†å†…å­˜ã€‚ ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼Œæ‰€éœ€çš„å…³é”®æ•°æ®ä¸ºï¼š è¢«æ˜ å°„å†…æ ¸ç©ºé—´çš„ç‰©ç†åœ°å€ å¯¹åº”çš„ç”¨æˆ·è¿›ç¨‹é¡µè¡¨ åœ¨å†…æ ¸ç©ºé—´ä¸­ï¼Œä¸»è¦å­˜åœ¨ä¸¤ç§å†…å­˜åˆ†é…æ–¹å¼ï¼škmalloc å’Œ vmallocã€‚ kmallocï¼šåˆ†é…çš„æ˜¯ç‰©ç†è¿ç»­çš„å†…å­˜ï¼Œé€šå¸¸è¢«ç§°ä¸ºå†…æ ¸é€»è¾‘åœ°å€ã€‚è¿™ç§åˆ†é…æ–¹å¼ç›´æ¥å¤„ç†ç‰©ç†é¡µæ¡†ï¼Œå› æ­¤å…¶åˆ†é…é¦–åœ°å€æ˜¯å›ºå®šçš„ã€‚é€šè¿‡å†…æ ¸æä¾›çš„ virt_to_phys å‡½æ•°ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è·å¾—å¯¹åº”çš„ç‰©ç†åœ°å€ã€‚å®ƒçš„è™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€ä¹‹é—´çš„å…³ç³»ç®€å•æ¸…æ™°ï¼šç‰©ç†åœ°å€ å†…æ ¸è™šæ‹Ÿåœ°å€ - PAGE_OFFSETï¼ˆ0xC0000000ï¼‰ï¼Œå…¶ä¸­ swapper_pg_dir è¡¨ç¤ºå¯¹åº”çš„é¡µè¡¨å·²ç»åœ¨ç³»ç»Ÿåˆå§‹åŒ–æ—¶å»ºç«‹ï¼Œçœå»äº†é¡µè¡¨å»ºç«‹çš„æ­¥éª¤ã€‚ vmallocï¼šåˆ†é…çš„æ˜¯éè¿ç»­çš„ç‰©ç†å†…å­˜ç©ºé—´ï¼Œè¢«ç§°ä¸ºå†…æ ¸è™šæ‹Ÿåœ°å€ã€‚å…¶ç®¡ç†æœºåˆ¶ç›¸å¯¹å¤æ‚ï¼Œå› ä¸º vmalloc åˆ†é…çš„å†…æ ¸è™šæ‹Ÿå†…å­˜é€»è¾‘ä¸Šæ˜¯è¿ç»­çš„ï¼Œä½†æ˜¯å¯¹åº”çš„ç‰©ç†å†…å­˜å¹¶ä¸è¿ç»­ã€‚è¿™ä½¿å¾—å…¶ç‰©ç†åœ°å€åœ¨åˆ†é…å‰æ— æ³•ç¡®å®šã€‚å°½ç®¡ vmalloc å’Œ kmalloc éƒ½ä½¿ç”¨å†…æ ¸é¡µè¡¨è¿›è¡Œæ˜ å°„ï¼Œä½† vmalloc åœ¨å†…å­˜åˆ†é…æ—¶è¿˜å¿…é¡»æ›´æ–°å†…æ ¸é¡µè¡¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œvmalloc åˆ†é…çš„å†…æ ¸è™šæ‹Ÿå†…å­˜ä¸ kmalloc åˆ†é…çš„å†…æ ¸é€»è¾‘å†…å­˜ä½äºä¸åŒåœ°å€åŒºé—´ï¼Œé¿å…é‡å ã€‚ æ³¨é‡Šï¼šå†…å­˜ç©ºé—´çš„åˆ†åŒºç®¡ç†ä½¿å¾—ä¸åŒçš„å†…å­˜åˆ†é…æ–¹å¼å„å¸å…¶èŒã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿›ç¨‹ç©ºé—´åœ°å€èŒƒå›´ä» 0 åˆ° 3Gï¼ˆå®è´¨ä¸Šæ˜¯åˆ° PAGE_OFFSETï¼Œçº¦ç­‰äº 0xC0000000ï¼‰ï¼Œè€Œç‰©ç†å†…å­˜æ˜ å°„åŒºåŸŸåˆ™ä½äº 3G åˆ° vmalloc_start ä¹‹é—´ã€‚è¿™ä¸€åŒºåŸŸåŒ…å«äº†å†…æ ¸é•œåƒå’Œç‰©ç†é¡µæ¡†è¡¨ï¼ˆmem_mapï¼‰ã€‚ä»¥ç³»ç»Ÿå†…å­˜ 64M ä¸ºä¾‹ï¼Œå†…å­˜æ˜ å°„åŒºä» (3G - 3G + 64M) å°†æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œè€Œ vmalloc_start ä½ç½®åº”ä½äº 3G + 64M é™„è¿‘ã€‚ å¦ä¸€ä¸ªéœ€è¦æ¾„æ¸…çš„é—®é¢˜æ˜¯ï¼švmalloc åˆ†é…çš„å†…æ ¸ç©ºé—´çš„ç»“æ„æ˜¯ vm_areaï¼Œä¸è¦ä¸ç”¨æˆ·ç©ºé—´çš„ malloc åˆ†é…ç»“æ„ä½“ vm_area_struct æ··æ·†ã€‚å‰è€…é€šè¿‡å†…æ ¸é¡µè¡¨æ˜ å°„ï¼Œåè€…åˆ™ç”±ç”¨æˆ·é¡µè¡¨æ˜ å°„ã€‚ å†…å­˜åˆ†å¸ƒç¤ºæ„è¿›ç¨‹åœ°å€ç©ºé—´ç‰©ç†å†…å­˜æ˜ å°„åŒº kmalloc åˆ†é…|--------------------------|| 0 ||--------------------------|| 3G ||------- page_offset -----|| å†…æ ¸è™šæ‹Ÿç©ºé—´ || vmalloc_start || vmalloc_end ||--------------------------| ä¸Šå›¾å±•ç¤ºäº†å†…å­˜åˆ†å¸ƒçš„åŸºæœ¬è½®å»“ï¼Œå¼ºè°ƒäº†ä¸åŒåˆ†é…æ–¹å¼ä¹‹é—´çš„å·®å¼‚ã€‚ å®ä¾‹è“å›¾ä¸ºäº†ä¸°å¯Œæˆ‘ä»¬çš„ä¾‹å­ç¨‹åºçš„åœºæ™¯ï¼Œé€‰æ‹©å°† vmalloc åˆ†é…çš„å†…æ ¸è™šæ‹Ÿç©ºé—´ï¼ˆä»¥ä¸‹ç®€ç§°ä¸º vk åœ°å€ï¼‰æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´æ˜¯ä¸€é¡¹é‡è¦ä»»åŠ¡ã€‚ ç”¨æˆ·è¿›ç¨‹æ“ä½œçš„æ˜¯å…¶è™šæ‹Ÿå†…å­˜åŒºåŸŸ vm_area_structã€‚åœ¨æ­¤é˜¶æ®µï¼Œéœ€è¦å°†ç”¨æˆ·çš„ vma åŒºé—´åˆ©ç”¨ç”¨æˆ·é¡µè¡¨æ˜ å°„åˆ° vk å¯¹åº”çš„ç‰©ç†å†…å­˜ã€‚æ­¤è¿‡ç¨‹æ¶‰åŠè‹¥å¹²æ­¥éª¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ä¸»è¦å·¥ä½œæ˜¯å»ºç«‹ç”¨æˆ·é¡µè¡¨é¡¹ä»¥å®Œæˆæ˜ å°„ï¼Œè¿™ä¸€è¿‡ç¨‹ä¾èµ–äº vma-nopage æ“ä½œã€‚è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯å¸®åŠ©ç³»ç»Ÿåœ¨å‘ç”Ÿâ€œç¼ºé¡µâ€æ—¶ï¼ŒåŠ¨æ€æ„é€ æ‰€éœ€çš„ç‰©ç†å†…å­˜é¡µè¡¨é¡¹ã€‚ ç”¨æˆ·è™šæ‹Ÿç©ºé—´: vm_area_struct ç»“æ„ã€‚ vk ç©ºé—´: vm_structã€‚ ç‰©ç†å†…å­˜: ç³»ç»Ÿå®é™…å¯ç”¨çš„å†…å­˜ã€‚ nopage æ–¹æ³•çš„å®ç°ä¸ºäº†æˆåŠŸå®ç°è¿™ä¸ªè¿‡ç¨‹ï¼Œéœ€è¦ç¼–å†™ nopage æ–¹æ³•ï¼ŒåŠ¨æ€å»ºç«‹å¯¹åº”çš„é¡µè¡¨ã€‚æ ¸å¿ƒä»»åŠ¡æ˜¯æ‰¾åˆ° vk åœ°å€å¯¹åº”çš„å†…æ ¸é€»è¾‘åœ°å€ã€‚è¿™éœ€è¦å®Œæˆä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š å®šä½ vmalloc è™šæ‹Ÿå†…å­˜çš„å†…æ ¸é¡µè¡¨: é¦–å…ˆéœ€è¦è®¿é—®å†…æ ¸ä¸­ä¸ vmalloc å†…å­˜åŒºç›¸å…³çš„é¡µè¡¨ã€‚è¿™æœ‰åŠ©äºç¡®å®šå…·ä½“çš„åœ°å€æ˜ å°„å…³ç³»å’Œé¡µè¡¨é¡¹ã€‚ è·å–å†…æ ¸é¡µè¡¨é¡¹å¯¹åº”çš„ç‰©ç†é¡µæ¡†æŒ‡é’ˆ: ä¸€æ—¦æ‰¾åˆ°é¡µè¡¨ï¼Œéœ€æå–å¯¹åº”çš„ç‰©ç†é¡µæ¡†æŒ‡é’ˆï¼Œä¾›åç»­çš„åœ°å€æ˜ å°„ä½¿ç”¨ã€‚ ä»é¡µæ¡†å¾—åˆ°å†…æ ¸é€»è¾‘åœ°å€: æœ€åï¼Œé€šè¿‡é¡µæ¡†ä¿¡æ¯ï¼Œè·å–ç›¸å…³çš„å†…æ ¸é€»è¾‘åœ°å€ï¼Œä¸ºåç»­çš„è®¿é—®æä¾›åŸºç¡€ã€‚ åŸºæœ¬å‡½æ•°çš„è®¾è®¡åœ¨è¿™ä¸€å®ä¾‹ä¸­ï¼Œå°†åˆ©ç”¨ä¸€ä¸ªè™šæ‹Ÿå­—ç¬¦é©±åŠ¨ç¨‹åºï¼Œé©±åŠ¨è´Ÿè´£å°†ä¸€å®šé•¿çš„å†…æ ¸è™šæ‹Ÿåœ°å€ï¼ˆvmalloc åˆ†é…çš„ç©ºé—´ï¼‰æ˜ å°„åˆ°è®¾å¤‡æ–‡ä»¶ã€‚è¿™ç§è®¾è®¡å…è®¸é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ¥å£è®¿é—®å†…å­˜ï¼Œä»è€Œæ˜¾è‘—æé«˜å†…å­˜è®¿é—®é€Ÿåº¦ï¼Œé™ä½å¼€å‘çš„å¤æ‚åº¦ã€‚ é©±åŠ¨ç¨‹åºçš„æ„å»ºmap_driver.c æ˜¯æˆ‘ä»¬çš„è™šæ‹Ÿå­—ç¬¦é©±åŠ¨ç¨‹åºã€‚è¯¥ç¨‹åºéœ€è¦å®ç°æ–‡ä»¶æ“ä½œè¡¨ï¼ˆfile_operationsï¼‰ï¼Œè¯¥ç»“æ„ä¸­çš„ä¸»è¦ä»»åŠ¡æ˜¯å®Œæˆç›¸å…³æ¨èæ“ä½œã€‚ä¸ºäº†å®ç°å†…å­˜æ˜ å°„ï¼Œé™¤äº†å¸¸è§„çš„ open å’Œ release æ“ä½œå¤–ï¼Œè¿˜å¿…é¡»è‡ªå®šä¹‰å®ç° mmap æ“ä½œã€‚æ­¤å‡½æ•°çš„ä¸»è¦èŒè´£æ˜¯å°†æŒ‡å®šçš„æ–‡ä»¶æ˜ å°„åˆ°ç›®æ ‡åœ°å€ç©ºé—´ï¼Œå°¤å…¶æ˜¯å°† vmalloc åˆ†é…çš„å†…æ ¸åœ°å€æ˜ å°„åˆ°å¯¹åº”çš„è®¾å¤‡æ–‡ä»¶ä¸Šã€‚ mmap æ“ä½œçš„å…·ä½“å®ç°æ–‡ä»¶æ“ä½œçš„ mmap æ“ä½œåœ¨ç”¨æˆ·å‘èµ·ç³»ç»Ÿè°ƒç”¨ mmap æ—¶è§¦å‘ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå†…æ ¸å·²ç»ä¸ºç”¨æˆ·åˆ†é…äº†åˆé€‚çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸ vm_area_structï¼Œè¯¥åŒºåŸŸä»£è¡¨ç€æ–‡ä»¶å†…å®¹ã€‚æ¥ä¸‹æ¥çš„å…³é”®åœ¨äºå¦‚ä½•å°†è™šæ‹ŸåŒºåŸŸä¸ç‰©ç†å†…å­˜è¿æ¥èµ·æ¥ï¼Œä¹Ÿå°±æ˜¯æ„å»ºé¡µè¡¨ã€‚ ç”±äºå‰è¿°åŸå› ï¼Œç³»ç»Ÿä¸­çš„é¡µè¡¨éœ€è¦åŠ¨æ€åˆ†é…ï¼Œå› æ­¤æ— æ³•ä¸€æ¬¡æ€§ä½¿ç”¨ remap_page_range å‡½æ•°åˆ†é…é¡µè¡¨é¡¹ï¼Œè€Œå¿…é¡»ä¾èµ–äºè™šæ‹Ÿå†…å­˜åŒºåŸŸæœ¬èº«æä¾›çš„ nopage æ–¹æ³•ä»¥åœ¨éœ€è¦æ—¶åŠ¨æ€æ„é€ é¡µè¡¨ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ–‡ä»¶æ“ä½œçš„ mmap æ–¹æ³•åªéœ€å®Œæˆä¸ºå…¶è·å–çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸç»‘å®šå¯¹åº”çš„æ“ä½œè¡¨ vm_operations çš„å·¥ä½œã€‚ nopage æ–¹æ³•çš„æ ¸å¿ƒåŠŸèƒ½å¦‚å‰æ‰€è¿°ï¼Œnopage æ–¹æ³•çš„æ ¸å¿ƒå†…å®¹æ˜¯â€œå¯»æ‰¾åˆ° vk åœ°å€å¯¹åº”çš„å†…æ ¸é€»è¾‘åœ°å€â€ã€‚æ­¤é¡¹å·¥ä½œæ¶‰åŠè§£æå†…æ ¸é¡µè¡¨ï¼Œé€šå¸¸éœ€è¦ç¼–å†™è¾…åŠ©å‡½æ•° vaddr_to_kaddr æ¥å®Œæˆã€‚è¯¥å‡½æ•°çš„ä¸»è¦ä»»åŠ¡æ˜¯ä¾ç…§ä¹‹å‰æåˆ°çš„ä¸‰ä¸ªæ­¥éª¤ï¼šå®šä½é¡µè¡¨é¡¹ã€è·å–ç‰©ç†é¡µé¢æ¡†æŒ‡é’ˆä»¥åŠè·å¾—å†…æ ¸é€»è¾‘åœ°å€ã€‚ æ‰§è¡Œè·¯å¾„çš„ç¤ºæ„å›¾ STEP BY STEP: ç¼–è¯‘ map_driver.c ä¸º map_driver.o æ¨¡å—ï¼Œå…·ä½“å‚æ•°å¯å‚è€ƒ Makefileã€‚ åŠ è½½æ¨¡å—ï¼šinsmod map_driver.oã€‚ ç”Ÿæˆå¯¹åº”çš„è®¾å¤‡æ–‡ä»¶ï¼š åœ¨ /proc/devices ä¸‹æŸ¥æ‰¾ map_driver å¯¹åº”çš„è®¾å¤‡åå’Œè®¾å¤‡å·ï¼šgrep mapdrv /proc/devicesã€‚ ä½¿ç”¨å‘½ä»¤ mknod mapfile c 254 0ï¼ˆåœ¨æ­¤ç³»ç»Ÿä¸­ï¼Œè®¾å¤‡å·ä¸º 254ï¼‰åˆ›å»ºè®¾å¤‡æ–‡ä»¶ã€‚ é€šè¿‡ maptest è¯»å–è®¾å¤‡æ–‡ä»¶ mapfileï¼Œå°†å†…æ ¸ä¿¡æ¯ï¼ˆå¦‚â€œokâ€â€”â€”æˆ‘ä»¬åœ¨ vmalloc åˆ†é…çš„ç©ºé—´ä¸­å¡«æ”¾çš„ä¿¡æ¯ï¼‰æ‰“å°åˆ°ç”¨æˆ·å±å¹•ï¼Œä»¥éªŒè¯æ˜ å°„æ˜¯å¦æˆåŠŸã€‚ è¿™ç§è®¾è®¡ä¸ä»…å®Œæˆäº†å†…å­˜åˆ°æ–‡ä»¶çš„æ˜ å°„ï¼Œè¿˜å¤§å¹…åº¦æé«˜äº†å†…å­˜è®¿é—®çš„æ•ˆç‡ï¼ŒåŒæ—¶åˆ©ç”¨äº† Linux ä¸­è®¾å¤‡ä½œä¸ºç‰¹æ®Šæ–‡ä»¶çš„å¤„ç†æ–¹å¼ï¼Œé™ä½äº†å¼€å‘çš„å¤æ‚åº¦ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç¨‹åº"]},{"title":"librkcrypto","path":"/2024/12/10/1-å¹³å°ç³»ç»Ÿ-Linux-åŠ å¯†-librkcrypto/","content":"librkcryptolibrkcrypto æä¾›äº†ä¸€å¥—åŸºäºç¡¬ä»¶çš„åŠ å¯†ç®—æ³•æ¥å£ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°ä½¿ç”¨ç›´æ¥å†…å­˜è®¿é—®ï¼ˆDMAï¼‰æ–¹å¼è¿›è¡Œæ•°æ®å¤„ç†ã€‚è¿™ä¸€ç‰¹æ€§ä½¿å¾— librkcrypto å¯å¹¿æ³›åº”ç”¨äºåŠ å¯†ã€è§£å¯†ã€æ•°æ®è®¤è¯ç­‰å¤šç§åœºæ™¯ï¼Œæå‡äº†æ•°æ®å¤„ç†çš„æ•ˆç‡å’Œå®‰å…¨æ€§ã€‚ librkcrypto çš„è®¾è®¡ä¾èµ–äºå†…æ ¸åŠ å¯†é©±åŠ¨çš„å®ç°ã€‚å¯¹äºé©±åŠ¨å¼€å‘ä»¥åŠåº”ç”¨ API çš„å¼€å‘ï¼Œå»ºè®®å‚è€ƒåä¸º Rockchip_Developer_Guide_Crypto_HWRNG_CN.pdf çš„æ–‡æ¡£ï¼Œè¯¥æ–‡æ¡£ä¸ºå¼€å‘è€…æä¾›äº†è¯¦å°½çš„æŒ‡å¯¼ã€‚ ç‰ˆæœ¬å·æŸ¥è¯¢è‹¥éœ€æŸ¥è¯¢å½“å‰ API çš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è¿›è¡ŒéªŒè¯ã€‚ ä½¿ç”¨ strings å‘½ä»¤ # åœ¨ 64 ä½ Linux å¹³å°ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤$ strings /lib64/librkcrypto.so | grep api | grep versionrkcrypto api version 1.2.0 æ‰§è¡Œä»¥ä¸Šå‘½ä»¤åï¼Œå°†è·å¾—å½“å‰çš„ API ç‰ˆæœ¬ï¼Œå…¶æ ¼å¼ä¸º â€œrkcrypto api version x.x.xâ€ã€‚ æŸ¥çœ‹æ—¥å¿—è¾“å‡º å½“ä»»ä¸€è¿›ç¨‹é¦–æ¬¡è°ƒç”¨ librkcrypto çš„æ¥å£æ—¶ï¼Œè¯¥æ¥å£ä¼šåœ¨æ—¥å¿—ä¸­è¾“å‡ºå½“å‰ç‰ˆæœ¬å·ã€‚ä¾‹å¦‚ï¼š RKCRYPTO I[rk_crypto_init, 262]: rkcrypto api version 1.2.0 æ­¤ä¿¡æ¯ç¡®ä¿å¼€å‘è€…èƒ½å¤Ÿè¿…é€Ÿç¡®è®¤æ­£åœ¨ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚ é€‚ç”¨èŠ¯ç‰‡å¹³å°librkcrypto æ”¯æŒä»¥ä¸‹å¤šä¸ªèŠ¯ç‰‡å¹³å°ï¼Œè¿™äº›å¹³å°åŒ…æ‹¬ä½†ä¸é™äºï¼š RK3588 RK356x RV1109 RV1126 RK3326PX30 RK3308 RV110603 è¯·æ³¨æ„ï¼Œéƒ¨åˆ† API å¯èƒ½ä¸é€‚ç”¨äºæŸäº›ç‰¹å®šçš„èŠ¯ç‰‡å¹³å°ï¼Œç”¨æˆ·åº”å‚è€ƒåº”ç”¨å¼€å‘è¯´æ˜æ–‡æ¡£ä»¥è·å–è¯¦ç»†ä¿¡æ¯ã€‚ ç‰ˆæœ¬ä¾èµ–V1.2.0 å¯¹äº kernel 4.19 ç‰ˆæœ¬ï¼šéœ€è¦æ›´æ–°åˆ°ä»¥ä¸‹æäº¤ï¼š c255a0aa097a crypto: rockchip: rk3326/px30 add aes gcm support å¯¹äº kernel 5.10 ç‰ˆæœ¬ï¼šéœ€æ›´æ–°è‡³ä»¥ä¸‹æäº¤ï¼š 47e85085826d crypto: rockchip: rk3326/px30 add aes gcm support V1.1.0 å¯¹äº kernel 4.19 ç‰ˆæœ¬ï¼šéœ€è¿›è¡Œå¦‚ä¸‹æ›´æ–°ï¼š 1e549d833bc3 crypto: rockchip: v2: ahash init/update/final use hardware crypto å¯¹äº kernel 5.10 ç‰ˆæœ¬ï¼šéœ€æ›´æ–°è‡³ï¼š 4d2020372e7e crypto: rockchip: v2: ahash fix hash_algo2name setting error. æ­¤å¤–ï¼Œè‹¥éœ€è¦ä½¿ç”¨ OTP key çš„åŠ è§£å¯†åŠŸèƒ½ï¼Œè¯·ç¡®ä¿ rkbin æ›´æ–°è‡³ç›¸åº”çš„æäº¤ç‰ˆæœ¬ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š å¯¹äº RK3588ï¼š 23ca562 rk3588: bl32: update version to v1.07 å¯¹äº RK356xï¼š 86e9bb7 rk3568: bl32: update version to v2.07 å¯¹äº RV1109RV1126ï¼š 42eea81 rv1126: tee: update version to v2.05 ç›®å½•è¯´æ˜é¡¹ç›®ç›®å½•ç»“æ„ç®€æ´æ˜äº†ï¼ŒåŒ…å«ä»¥ä¸‹é‡è¦éƒ¨åˆ†ï¼š demo: æä¾› API ä½¿ç”¨ç¤ºä¾‹ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹ã€‚ docs: åŒ…å«åº”ç”¨å¼€å‘è¯´æ˜æ–‡æ¡£ï¼Œè¯¦ç»†ä»‹ç»å„ç±»æ¥å£çš„ä½¿ç”¨ã€‚ include: åŒ…å«å¤´æ–‡ä»¶ï¼Œä¾›å¤–éƒ¨ç¨‹åºè°ƒç”¨ã€‚ src: ç”¨æˆ·ç©ºé—´çš„é©±åŠ¨åŠ API å®ç°ä»£ç ã€‚ test: åŒ…å« API æµ‹è¯•ä»£ç ï¼Œç¡®ä¿åŠŸèƒ½çš„æ­£ç¡®æ€§ã€‚ third_party: åŒ…å«ç¬¬ä¸‰æ–¹å¼€æºä»£ç ä»¥ä¾›å¼•ç”¨ã€‚ ç¼–è¯‘è¯´æ˜Androidè¦åœ¨ Android å¹³å°ä¸Šç¼–è¯‘ librkcryptoï¼ŒåŒ…æ‹¬åº“ã€æµ‹è¯•å’Œç¤ºä¾‹ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š # é¦–å…ˆï¼Œåœ¨ Android å·¥ç¨‹ç›®å½•ä¸‹æ‰§è¡Œ$ source build/envsetup.sh$ lunch rk3588_s-userdebug # é€‰æ‹© RK3588 å¹³å°# ç„¶å cd åˆ° librkcrypto ç›®å½•å¹¶æ‰§è¡Œç¼–è¯‘$ mm ç¼–è¯‘æˆåŠŸåï¼Œå°†æ ¹æ®é€‰æ‹©çš„èŠ¯ç‰‡å¹³å°ç”Ÿæˆç›¸åº”çš„ 32 ä½æˆ– 64 ä½ç›®æ ‡æ–‡ä»¶ï¼ŒåŒ…æ‹¬ librkcrypto.soã€librkcrypto_test å’Œ librkcrypto_demoã€‚ç¼–è¯‘æ—¥å¿—ä¸­ä¼šæ ‡æ˜è¿™äº›ç›®æ ‡æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚ Linuxè¦åœ¨ Linux å¹³å°ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š # åœ¨ librkcrypto çš„ç›®å½•ä¸‹æ‰§è¡Œ$ ./build.sh # ç¼–è¯‘ 32 ä½å’Œ 64 ä½$ ./build.sh 32 # ä»…ç¼–è¯‘ 32 ä½$ ./build.sh 64 # ä»…ç¼–è¯‘ 64 ä½ æˆåŠŸç¼–è¯‘åï¼Œç›®æ ‡æ–‡ä»¶å°†ä½äº librkcrypto/out/target ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åŒ…æ‹¬ librkcrypto.soã€librkcrypto.a ä»¥åŠ librkcrypto_testã€‚ ç¼–è¯‘ demo # è¿›å…¥ demo ç›®å½•è¿›è¡Œç¼–è¯‘$ cd demo$ make 32 # æˆ–ç›´æ¥ $ makeï¼Œç¼–è¯‘ 32 ä½$ make 64 # ä»…ç¼–è¯‘ 64 ä½$ make clean # æ¸…é™¤ç›®æ ‡æ–‡ä»¶ ç¼–è¯‘åï¼Œlibrkcrypto/demo ç›®å½•å°†ç”Ÿæˆç›®æ ‡æ–‡ä»¶ librkcrypto_demoã€‚ ä½¿ç”¨è¯´æ˜ å¤´æ–‡ä»¶ åœ¨ä½¿ç”¨ librkcrypto API æ—¶ï¼Œéœ€åŒ…å«ä»¥ä¸‹å¤´æ–‡ä»¶ï¼š #include rkcrypto_common.h // åŒ…å«é€šç”¨å‡½æ•°#include rkcrypto_core.h // ä½¿ç”¨ cipherã€hashã€hmac ç­‰æ¥å£#include rkcrypto_mem.h // ä½¿ç”¨æ”¯æŒ dma_fd çš„æ¥å£#include rkcrypto_otp_key.h // ä½¿ç”¨ otp_key ç›¸å…³æ¥å£#include rkcrypto_random.h // ä½¿ç”¨éšæœºæ•°æ¥å£ åº“æ–‡ä»¶ åŒ…æ‹¬ï¼š librkcrypto.so librkcrypto.a (ä»…é™äº Linux å¹³å°) æ—¥å¿—æ‰“å° librkcrypto è®¾ç½®äº†å¤šç§æ—¥å¿—ç­‰çº§ï¼Œæ–¹ä¾¿å¼€å‘è€…è°ƒè¯•å’Œè·å–è¿è¡Œä¿¡æ¯ï¼š ç­‰çº§ 1 - TRACE_ERRORï¼šè¡¨ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œå…³é”®ä¿¡æ¯ç”¨ä»¥è°ƒè¯•ã€‚ ç­‰çº§ 2 - TRACE_INFOï¼šåŒ…å«å¸¸ç”¨ä¿¡æ¯ï¼Œæ¯”å¦‚ç‰ˆæœ¬å·ç­‰ï¼Œé»˜è®¤çº§åˆ«ã€‚ ç­‰çº§ 3 - TRACE_DEBUGï¼šæä¾›æ›´æ·±å…¥çš„ä¸€èˆ¬è°ƒè¯•ä¿¡æ¯ã€‚ ç­‰çº§ 4 - TRACE_VERBOSEï¼šåŒ…æ‹¬è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œåˆ©äºè¿½è¸ªé—®é¢˜ã€‚ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è‡ªå®šä¹‰æ—¥å¿—ç­‰çº§ï¼Œè®¾ç½®åå°†æ‰“å°è¯¥ç­‰çº§åŠå…¶ä»¥ä¸‹ç­‰çº§çš„æ—¥å¿—ã€‚è¯·æ³¨æ„ï¼Œè®¾å¤‡é‡å¯åæ—¥å¿—ç­‰çº§å°†æ¢å¤ä¸ºé»˜è®¤çš„ç­‰çº§ 2ã€‚ ä½¿ç”¨ API è®¾ç½®ï¼š RK_RES rkcrypto_set_trace_level(enum RKCRYPTO_TRACE_LEVEL level); ä½¿ç”¨æŒ‡ä»¤è®¾ç½®ï¼š # Androidsetprop vendor.rkcrypto.trace.level 1/2/3/4# Linuxexport rkcrypto_trace_level=1/2/3/4 åº”ç”¨å¼€å‘è¯´æ˜æ–‡æ¡£ å¼€å‘è€…å¯ä»¥å‚è€ƒ Rockchip_Developer_Guide_Crypto_HWRNG_CN.pdf æ–‡æ¡£ï¼Œä»¥è·å–å…·ä½“çš„åº”ç”¨å¼€å‘ä¿¡æ¯å’ŒæŒ‡å¯¼ã€‚ FAQ ç¼–è¯‘é“¾ä¾èµ– æœ¬é¡¹ç›®çš„ CMake é»˜è®¤ä½¿ç”¨çš„ç¼–è¯‘é“¾ä¸º gcc 10.3 ç‰ˆæœ¬ï¼Œé€šè¿‡å¦‚ä¸‹è·¯å¾„è¿›è¡Œè®¿é—®ï¼š gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu å¦‚æœçš„ç³»ç»Ÿä¸­æ²¡æœ‰ç›¸åº”çš„ç¼–è¯‘é“¾ç‰ˆæœ¬ï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹æŠ¥é”™ä¿¡æ¯ï¼š make[2]: librkcrypto/../../prebuilts/gcc/linux-x86/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/bin/arm-none-linux-gnueabihf-gcc: Command not found å¯ä»¥é€šè¿‡ä¿®æ”¹ CMakeLists.txt æ–‡ä»¶ä¸­çš„ç¼–è¯‘é“¾è·¯å¾„å’Œç‰ˆæœ¬æ¥è§£å†³æ­¤é—®é¢˜ï¼š set (TOOLCHAIN_PREBUILTS $CMAKE_CURRENT_SOURCE_DIR/../../prebuilts)set (TOOLCHAIN_PATH_ARM32 gcc/linux-x86/arm/gcc-arm-10.3-2021.07-x86_64-arm-none-linux-gnueabihf/bin)set (TOOLCHAIN_PATH_AARCH64 gcc/linux-x86/aarch64/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin) è‹¥åœ¨è¿è¡Œæ—¶é‡åˆ°å¦‚ä¸‹æŠ¥é”™ï¼Œè¯´æ˜ç¼–è¯‘é“¾çš„ GLIBC ç‰ˆæœ¬ä¸è®¾å¤‡ä¸Šçš„ GLIBC ç‰ˆæœ¬ä¸ä¸€è‡´ã€‚éœ€è¦ä¿®æ”¹ç¼–è¯‘é“¾çš„ç‰ˆæœ¬æˆ–è°ƒæ•´è®¾å¤‡ä¸Šçš„ GLIBC ç‰ˆæœ¬ã€‚ version GLIBC_2.29 not found (required by /lib/librkcrypto.so)","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","åŠ å¯†"]},{"title":"é€»è¾‘åœ°å€ã€çº¿æ€§åœ°å€åŠç‰©ç†åœ°å€çš„åŒºåˆ«","path":"/2024/12/09/1-å¹³å°ç³»ç»Ÿ-Linux-ç¨‹åº-é€»è¾‘åœ°å€ã€çº¿æ€§åœ°å€åŠç‰©ç†åœ°å€çš„åŒºåˆ«/","content":"é€»è¾‘åœ°å€ã€çº¿æ€§åœ°å€åŠç‰©ç†åœ°å€çš„åŒºåˆ«ä¸€ã€é€»è¾‘åœ°å€è½¬çº¿æ€§åœ°å€åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰çš„æœºå™¨è¯­è¨€æŒ‡ä»¤ä¸­çš„å†…å­˜åœ°å€éƒ½æ˜¯é€»è¾‘åœ°å€ã€‚è¿™äº›åœ°å€å¿…é¡»ç»è¿‡è½¬åŒ–æ‰èƒ½è¢«å®é™…è®¿é—®ï¼Œå…·ä½“è¿‡ç¨‹æ˜¯å…ˆå°†é€»è¾‘åœ°å€è½¬æ¢æˆçº¿æ€§åœ°å€ï¼Œå†é€šè¿‡å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼Œå°† CPU ä¸ä¸»å­˜è¿æ¥çš„ç»„ä»¶ï¼‰å°†å…¶è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œç¼–å†™ä¸€ä¸ªç®€å•çš„ â€œHello Worldâ€ ç¨‹åºå¹¶ä½¿ç”¨ GCC ç¼–è¯‘åï¼Œåæ±‡ç¼–å¾—åˆ°çš„æŒ‡ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š mov 0x80495b0, %eax è¿™é‡Œçš„ 0x80495b0 æ˜¯ä¸€ä¸ªé€»è¾‘åœ°å€ã€‚ä¸ºäº†å°†è¿™ä¸ªé€»è¾‘åœ°å€è½¬æ¢ä¸ºçº¿æ€§åœ°å€ï¼Œéœ€è¦åŠ ä¸Šéšå«çš„æ•°æ®æ®µï¼ˆDSï¼‰çš„åŸºåœ°å€ã€‚è¿™æ„å‘³ç€ 0x80495b0 å®é™…ä¸Šæ˜¯å½“å‰ä»»åŠ¡åœ¨æ•°æ®æ®µä¸­çš„åç§»é‡ã€‚ åœ¨ x86 ä¿æŠ¤æ¨¡å¼ä¸‹ï¼Œæ®µæè¿°ç¬¦åŒ…å«æ®µçš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ®µåŸºç¡€çº¿æ€§åœ°å€ã€é•¿åº¦å’Œæƒé™ç­‰ï¼Œæ¯ä¸ªæ®µæè¿°ç¬¦å ç”¨ 8 ä¸ªå­—èŠ‚ï¼Œè€Œæ®µå¯„å­˜å™¨åˆ™ä»…æœ‰ 2 å­—èŠ‚ã€‚Intel çš„æ¶æ„è®¾è®¡ä½¿å¾—æ®µæè¿°ç¬¦é›†ä¸­å­˜æ”¾äºå…¨å±€æè¿°ç¬¦è¡¨ GDT æˆ–å±€éƒ¨æè¿°ç¬¦è¡¨ LDT ä¸­ï¼Œè€Œæ®µå¯„å­˜å™¨åˆ™ä¿å­˜çš„æ˜¯åœ¨ GDT æˆ– LDT ä¸­çš„ç´¢å¼•å€¼ã€‚ åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œé€»è¾‘åœ°å€ä¸çº¿æ€§åœ°å€æ˜¯ç›¸ç­‰çš„ï¼Œè¿™èƒŒåçš„åŸå› åœ¨äºï¼ŒLinux æ‰€æœ‰çš„æ®µâ€”â€”æ— è®ºæ˜¯ç”¨æˆ·ä»£ç æ®µã€ç”¨æˆ·æ•°æ®æ®µï¼Œè¿˜æ˜¯å†…æ ¸ä»£ç æ®µã€å†…æ ¸æ•°æ®æ®µâ€”â€”çš„çº¿æ€§åœ°å€å‡ä» 0x00000000 å¼€å§‹ï¼Œé•¿åº¦è¾¾åˆ° 4GBã€‚å› æ­¤ï¼Œçº¿æ€§åœ°å€å¯ä»¥è¡¨ç¤ºä¸º é€»è¾‘åœ°å€ + 0x00000000ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€»è¾‘åœ°å€ä¸çº¿æ€§åœ°å€å®Œå…¨ç›¸åŒã€‚ ç”±äºè¿™ç§è®¾è®¡ï¼ŒLinux ä»…ä½¿ç”¨ GDTï¼Œåœ¨ç”¨æˆ·ä»»åŠ¡å’Œå†…æ ¸ä»»åŠ¡ä¸­å‡ä¸éœ€è¦ä½¿ç”¨ LDTã€‚GDT ä¸­çš„ç¬¬ 12 å’Œç¬¬ 13 é¡¹æ®µæè¿°ç¬¦åˆ†åˆ«æ˜¯ __KERNEL_CS å’Œ __KERNEL_DSï¼Œè€Œç¬¬ 14 å’Œç¬¬ 15 é¡¹åˆ™æ˜¯ __USER_CS å’Œ __USER_DSã€‚å†…æ ¸ä»»åŠ¡ä½¿ç”¨çš„æ®µæè¿°ç¬¦æ‹¥æœ‰æœ€é«˜ç‰¹æƒï¼ˆDPL å€¼ä¸º 0ï¼‰ï¼Œè€Œç”¨æˆ·ä»»åŠ¡åˆ™å…±äº«åŒä¸€ä¸ªç”¨æˆ·æ®µæè¿°ç¬¦ï¼ŒDPL å€¼ä¸º 3ã€‚ ä½¿ç”¨ GDB è°ƒè¯•ç¨‹åºæ—¶ï¼Œå¯ä»¥é€šè¿‡ info reg å‘½ä»¤æŸ¥çœ‹å½“å‰å¯„å­˜å™¨çš„å€¼ï¼š cs 0x73 115ss 0x7b 123ds 0x7b 123es 0x7b 123 åœ¨æ­¤è¾“å‡ºä¸­ï¼Œå¯ä»¥æ³¨æ„åˆ° ds çš„å€¼æ˜¯ 0x7bï¼Œå°†å…¶è½¬æ¢ä¸ºäºŒè¿›åˆ¶å¾—åˆ° 00000000 01111011ã€‚TI å­—æ®µå€¼ä¸º 0ï¼Œè¡¨æ˜ä½¿ç”¨çš„æ˜¯ GDTï¼Œå¹¶ä¸” GDT çš„ç´¢å¼•å€¼ä¸º 01111ï¼Œå³åè¿›åˆ¶çš„ 15ã€‚è¿™å¯¹åº”äº GDT ä¸­çš„ __USER_DS ç”¨æˆ·æ•°æ®æ®µæè¿°ç¬¦ã€‚ é€šè¿‡ä¸Šè¿°åˆ†æå¯ä»¥çœ‹å‡ºï¼Œå°½ç®¡ Linux åœ¨ x86 ä½“ç³»ç»“æ„ä¸­è¿è¡Œï¼Œä»ç„¶é€šè¿‡ç²¾å·§çš„æ–¹å¼è§„é¿äº†å¤æ‚çš„åˆ†æ®µæœºåˆ¶ï¼Œè€Œä¸»è¦ä¾èµ–äºåˆ†é¡µæœºåˆ¶æ¥å®ç°å†…å­˜ç®¡ç†ã€‚ äºŒã€çº¿æ€§åœ°å€è½¬ç‰©ç†åœ°å€æ—¢ç„¶åœ¨ Linux ä¸­é€»è¾‘åœ°å€ç­‰äºçº¿æ€§åœ°å€ï¼Œé‚£ä¹ˆçº¿æ€§åœ°å€å¦‚ä½•è½¬æ¢ä¸ºç‰©ç†åœ°å€å‘¢ï¼Ÿè¿™ä¸ªè¿‡ç¨‹é€šè¿‡åˆ†é¡µæœºåˆ¶å®ç°ï¼Œè€Œåˆ†é¡µæœºåˆ¶åˆ™æ˜¯ç”± CPU æä¾›çš„ä¸€ç§å†…å­˜ç®¡ç†æ–¹æ¡ˆã€‚å…·ä½“æ¥è¯´ï¼Œçº¿æ€§åœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢æ˜¯é€šè¿‡é¡µè¡¨æŸ¥æ‰¾æ¥å®Œæˆçš„ã€‚ åœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ï¼Œæ§åˆ¶å¯„å­˜å™¨ CR0 çš„æœ€é«˜ä½ PG æŒ‡å®šåˆ†é¡µç®¡ç†æœºåˆ¶çš„çŠ¶æ€ã€‚å¦‚æœ PG 1ï¼Œè¯´æ˜åˆ†é¡µæœºåˆ¶ç”Ÿæ•ˆï¼Œéœ€è¦é€šè¿‡é¡µè¡¨æŸ¥æ‰¾åˆ°ç‰©ç†åœ°å€ï¼›å¦‚æœ PG 0ï¼Œåˆ™åˆ†é¡µæœºåˆ¶æ— æ•ˆï¼Œæ­¤æ—¶çº¿æ€§åœ°å€ç›´æ¥ä½œä¸ºç‰©ç†åœ°å€ã€‚ åˆ†é¡µçš„åŸºæœ¬æ¦‚å¿µæ˜¯å°†å†…å­˜åˆ’åˆ†æˆå¤§å°å›ºå®šçš„å¤šä¸ªå•å…ƒï¼Œæ¯ä¸ªå•å…ƒç§°ä¸ºä¸€é¡µï¼ˆpageï¼‰ï¼Œæ¯é¡µé€šå¸¸åŒ…å« 4KB çš„åœ°å€ç©ºé—´ã€‚ä¸ºäº†å°†çº¿æ€§åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼ŒCPU éœ€è¦è®¿é—®é¡µç›®å½•è¡¨å’Œé¡µè¡¨ï¼Œè¿™ä¸¤ä¸ªè¡¨æ ¼å……å½“å½“å‰ä»»åŠ¡çš„çº¿æ€§åœ°å€åˆ°ç‰©ç†åœ°å€çš„æŸ¥æ‰¾è¡¨ã€‚ åœ¨ x86 ä½“ç³»ç»“æ„ä¸­ï¼Œçº¿æ€§åœ°å€çš„è½¬æ¢é‡‡ç”¨åŒçº§æŸ¥æ‰¾æ–¹å¼ã€‚32 ä½çš„çº¿æ€§åœ°å€åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š æœ€é«˜ 10 ä½ï¼šç”¨äºé¡µç›®å½•è¡¨åç§»é‡ã€‚ ä¸­é—´ 10 ä½ï¼šç”¨äºé¡µè¡¨åç§»é‡ã€‚ æœ€ä½ 12 ä½ï¼šè¡¨ç¤ºç‰©ç†é¡µå†…çš„å­—èŠ‚åç§»é‡ã€‚ é¡µç›®å½•è¡¨çš„å¤§å°ä¸º 4KBï¼ŒåŒ…å« 1024 é¡¹ï¼Œæ¯ä¸€é¡¹å ç”¨ 4 å­—èŠ‚ï¼Œè¿™äº›é¡¹ç›®ä¸­å­˜æ”¾çš„æ˜¯é¡µè¡¨çš„ç‰©ç†åœ°å€ã€‚è‹¥é¡µç›®å½•è¡¨ä¸­çš„æŸé¡¹å°šæœªåˆ†é…ï¼Œåˆ™å¯¹åº”çš„ç‰©ç†åœ°å€ä¸º 0ã€‚é¡µè¡¨çš„ç»“æ„ç±»ä¼¼ï¼Œä¹Ÿä¸º 4KBï¼ŒåŒæ ·åŒ…å« 1024 é¡¹ï¼Œä¸”æ¯é¡¹ä¹Ÿå ç”¨ 4 å­—èŠ‚ï¼Œå†…å®¹ä¸ºæœ€ç»ˆç‰©ç†é¡µçš„ç‰©ç†å†…å­˜èµ·å§‹åœ°å€ã€‚ æ¯ä¸ªæ´»åŠ¨ä»»åŠ¡å¿…é¡»æ‹¥æœ‰è‡ªå·±çš„é¡µç›®å½•è¡¨ï¼Œå¹¶å°†å…¶ç‰©ç†åœ°å€å­˜å…¥ CR3 å¯„å­˜å™¨ã€‚é¡µè¡¨å¯ä»¥åœ¨éœ€è¦æ—¶åŠ¨æ€åˆ†é…ï¼Œæˆ–è€…åœ¨ä»»åŠ¡åˆ›å»ºæ—¶æå‰åˆ†é…ã€‚ ä»¥ mov 0x80495b0, %eax ä¸­çš„åœ°å€ä¸ºä¾‹ï¼Œåˆ†æçº¿æ€§åœ°å€è½¬ç‰©ç†åœ°å€çš„è¿‡ç¨‹ã€‚å‰é¢æåˆ°ï¼ŒLinux ä¸­çš„é€»è¾‘åœ°å€ç­‰äºçº¿æ€§åœ°å€ï¼Œå› æ­¤éœ€è¦è½¬æ¢çš„çº¿æ€§åœ°å€æ˜¯ 0x80495b0ã€‚è¿™ä¸ªè½¬æ¢è¿‡ç¨‹ç”± CPU è‡ªåŠ¨å®Œæˆï¼Œè€Œ Linux ä»…éœ€å‡†å¤‡ç›¸å…³çš„é¡µç›®å½•è¡¨å’Œé¡µè¡¨ï¼ˆå‡è®¾è¿™äº›è¡¨å·²ç»å‡†å¤‡å¥½ï¼‰ã€‚ å†…æ ¸é¦–å…ˆå°†å½“å‰ä»»åŠ¡çš„é¡µç›®å½•è¡¨ç‰©ç†åœ°å€å¡«å…¥ CR3 å¯„å­˜å™¨ã€‚å°†çº¿æ€§åœ°å€ 0x80495b0 è½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œå¾— 0000 1000 0000 0100 1001 0101 1011 0000ã€‚æœ€é«˜ 10 ä½ 0000 1000 00 çš„åè¿›åˆ¶ä¸º 32ï¼ŒCPU å°†æŸ¥çœ‹é¡µç›®å½•è¡¨çš„ç¬¬ 32 é¡¹ï¼Œè·å–çš„å†…å®¹ä¸ºé¡µè¡¨çš„ç‰©ç†åœ°å€ã€‚ä¸­é—´çš„ 10 ä½ 00 0100 1001 çš„åè¿›åˆ¶ä¸º 73ï¼Œé¡µè¡¨ç¬¬ 73 é¡¹åˆ™å­˜å‚¨æœ€ç»ˆç‰©ç†é¡µçš„ç‰©ç†èµ·å§‹åœ°å€ã€‚é€šè¿‡ç‰©ç†é¡µçš„åŸºåœ°å€åŠ ä¸Šçº¿æ€§åœ°å€æœ€ä½ 12 ä½çš„åç§»é‡ï¼ŒCPU æ‰¾åˆ°äº†å¯¹åº”çš„ç‰©ç†å†…å­˜å•å…ƒã€‚ åœ¨ Linux ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹çš„çº¿æ€§åœ°å€èŒƒå›´ä¸º 0 åˆ° 3GBï¼Œæ˜¯å¦éœ€è¦æå‰åˆ›å»ºè¿™ 3GB è™šæ‹Ÿå†…å­˜çš„æ‰€æœ‰é¡µè¡¨å‘¢ï¼Ÿå®é™…ä¸Šï¼Œç‰©ç†å†…å­˜é€šå¸¸è¿œå°äº 3GBï¼Œå¹¶ä¸”å¤šä¸ªè¿›ç¨‹åŒæ—¶è¿è¡Œï¼Œæ— æ³•ä¸ºæ¯ä¸ªè¿›ç¨‹éƒ½å»ºç«‹å®Œæ•´çš„é¡µè¡¨ã€‚Linux é€šè¿‡ CPU çš„â€œç¼ºé¡µå¼‚å¸¸â€æœºåˆ¶å·§å¦™è§£å†³äº†è¿™ä¸ªéš¾é¢˜ã€‚å½“è¿›ç¨‹åˆ›å»ºæ—¶ï¼Œå¯ä»¥å°†é¡µç›®å½•è¡¨çš„æ¡ç›®éƒ½è®¾ä¸º 0ã€‚å½“è¿›ç¨‹è¯•å›¾è®¿é—®æœªåˆ†é…çš„é¡µæ—¶ï¼Œè‹¥é¡µè¡¨é¡¹ä¸­çš„å†…å®¹ä¸º 0ï¼Œå°±ä¼šå¼•å‘ç¼ºé¡µå¼‚å¸¸ï¼Œè¿›ç¨‹ä¼šåœ¨æ­¤æ—¶æš‚åœã€‚Linux å†…æ ¸ä¼šæ ¹æ®ä¸€ç³»åˆ—å¤æ‚çš„ç®—æ³•åˆ†é…ä¸€ä¸ªç‰©ç†é¡µï¼Œå¹¶å°†è¯¥ç‰©ç†é¡µåœ°å€å¡«å†™åˆ°é¡µè¡¨é¡¹ä¸­ï¼Œéšåè¿›ç¨‹ç»§ç»­æ‰§è¡Œã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œè™½ç„¶å‘ç”Ÿäº†å¼‚å¸¸ï¼Œè¿›ç¨‹å¹¶æœªæ„ŸçŸ¥åˆ°ï¼Œä»ç„¶åƒæ­£å¸¸è®¿é—®ç‰©ç†å†…å­˜ä¸€æ ·è¿›è¡Œæ“ä½œã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç¨‹åº"]},{"title":"ç”¨æˆ·ç®¡ç†","path":"/2024/12/05/1-å¹³å°ç³»ç»Ÿ-Linux-ç³»ç»Ÿå‚æ•°-ç”¨æˆ·ç®¡ç†/","content":"ç”¨æˆ·ä¸ç”¨æˆ·ç»„Linux å¦‚ä½•åˆ†è¾¨ç”¨æˆ·åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å¹¶ä¸æ˜¯é€šè¿‡ä»–ä»¬çš„ç”¨æˆ·åè¢«è¯†åˆ«çš„ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªç§°ä¸º UIDï¼ˆç”¨æˆ· IDï¼‰çš„æ•°å­—ã€‚è®¡ç®—æœºæ›´å®¹æ˜“å¤„ç†æ•°å­—ï¼Œè€Œäººç±»åˆ™æ›´æ˜“è®°ä½æ–‡å­—ã€‚è¿™å°±æ˜¯ä¸ºä½•ä»¬é€šå¸¸ä½¿ç”¨ç”¨æˆ·åçš„åŸå› ã€‚æ¯ä¸ªæ–‡ä»¶å…¶å®æ˜¯é€šè¿‡ UID æ¥æ ‡è¯†ç”¨æˆ·ï¼Œæ˜¾ç¤ºçš„ç”¨æˆ·åå¦‚â€vagrantâ€æˆ–â€rootâ€ï¼Œæ˜¯å› ä¸ºç›¸å…³ä¿¡æ¯è¢«å­˜å‚¨åœ¨ /etc/passwd è¿™ä¸€æ–‡ä»¶ä¸­ã€‚å…·ä½“æ¥è¯´ï¼Œls å‘½ä»¤åœ¨æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯æ—¶ï¼Œä¼šæŸ¥è¯¢ /etc/passwd æ–‡ä»¶ï¼Œå°† UID è½¬æ¢ä¸ºä»¬ç†Ÿæ‚‰çš„ç”¨æˆ·åã€‚å¦‚æœä¿®æ”¹äº† /etc/passwd ä¸­çš„ UIDï¼Œls å°±ä¼šæ˜¾ç¤º UID è€Œéç”¨æˆ·åã€‚ ä»¥ä¸‹æ˜¯ç”¨æˆ·ç™»å½•åˆ° Linux ç³»ç»Ÿçš„æµç¨‹ï¼š ç”¨æˆ·è¾“å…¥ç”¨æˆ·åã€‚ ç³»ç»ŸæŸ¥æ‰¾ /etc/passwdï¼ŒéªŒè¯ç”¨æˆ·ä¿¡æ¯ã€‚ ä»æ–‡ä»¶ä¸­è¯»å– UID å’Œ GIDï¼ˆç»„ IDï¼‰ï¼Œä»¥åŠç”¨æˆ·çš„ä¸»ç›®å½•å’Œé»˜è®¤ shellã€‚ ç³»ç»ŸæŸ¥æ‰¾ /etc/shadowï¼Œæ ¸å¯¹ä¸ç”¨æˆ·å…³è”çš„å¯†ç ã€‚ ç™»å½•æˆåŠŸåï¼Œç”¨æˆ·è¿›å…¥ shellã€‚ vagrant@saltmaster:~$ ls -ltotal 256-rw-r--r-- 1 root root 256191 Nov 13 06:26 bootstrap-salt.sh-rw-rw-r-- 1 vagrant vagrant 0 Nov 26 08:44 file_a-rw-r--r-- 1 root root 100 Nov 20 06:30 nettools.sls åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å„ä¸ªæ–‡ä»¶çš„æ‹¥æœ‰è€…æ˜¯é€šè¿‡ UID è¯†åˆ«å¹¶æ˜¾ç¤ºç”¨æˆ·åçš„ã€‚ å½“æŸ¥çœ‹ /etc/passwd æ–‡ä»¶å†…å®¹æ—¶ï¼š vagrant@saltmaster:~$ cat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologin... æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªè´¦æˆ·ï¼Œå­—æ®µé€šè¿‡å†’å·è¿›è¡Œåˆ†å‰²ã€‚æ€»å…±æœ‰ 7 ä¸ªå­—æ®µï¼Œåˆ†åˆ«ä¸ºï¼š ç”¨æˆ·å å¯†ç å ä½ç¬¦ï¼ˆé€šå¸¸ä¸º xï¼‰ UID GID ç”¨æˆ·ä¿¡æ¯è¯´æ˜ ä¸»ç›®å½•ï¼ˆç”¨æˆ·ç™»å½•åé»˜è®¤æ‰€åœ¨çš„ä½ç½®ï¼‰ shellï¼ˆç”¨æˆ·ç™»å½•åå¯åŠ¨çš„ shellï¼Œå¦‚ /bin/bashï¼‰ passwd æ–‡ä»¶å’Œ shadow æ–‡ä»¶æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨ /etc/passwd æ–‡ä»¶ä¸­ï¼Œè€Œå¯†ç ä¿¡æ¯åˆ™è¢«æ›´å®‰å…¨åœ°å­˜å‚¨åœ¨ /etc/shadow ä¸­ï¼Œä»¥å¢å¼ºå®‰å…¨æ€§ã€‚å¯†ç ç§»åŠ¨åˆ° /etc/shadow åï¼Œ/etc/passwd ä¸­åªä¿ç•™ä¸€ä¸ªå ä½ç¬¦â€xâ€ã€‚ /etc/shadow æ–‡ä»¶çš„æ ¼å¼å¦‚ä¸‹ï¼š vagrant@saltmaster:~$ sudo head -n 4 /etc/shadowroot:!:17466:0:99999:7:::daemon:*:17379:0:99999:7:::bin:*:17379:0:99999:7:::sys:*:17379:0:99999:7::: æ¯è¡Œå¯¹åº”ä¸€ä¸ªè´¦æˆ·ï¼Œå­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š è´¦æˆ·åç§° å¯†ç ï¼ˆç”¨ç¬¦å·å¦‚ ! æˆ– * è¡¨ç¤ºç”¨æˆ·ç¦ç”¨ï¼‰ æœ€è¿‘æ”¹åŠ¨å¯†ç çš„æ—¥æœŸï¼ˆä»¥ 1970 å¹´ 1 æœˆ 1 æ—¥ä¸ºåŸºå‡†ï¼‰ å¯†ç ä¸å¯æ”¹åŠ¨çš„æ—¥æœŸï¼ˆ0 åˆ™å¯ä»¥éšæ—¶ä¿®æ”¹ï¼‰ å¯†ç è¿‡æœŸå‰çš„æé†’æ—¶é—´ è¿‡æœŸå®½é™æœŸ è´¦æˆ·å¤±æ•ˆæ—¥æœŸ ä¿ç•™å­—æ®µ æœ‰æ•ˆç”¨æˆ·ç»„ä¸åˆå§‹ç”¨æˆ·ç»„åœ¨ Linux ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªç”¨æˆ·ç»„ã€‚ä¸ UID ç›¸ä¼¼ï¼Œç”¨æˆ·ç»„æ˜¯é€šè¿‡ GIDï¼ˆç»„ IDï¼‰æ¥è¯†åˆ«çš„ã€‚åŒæ ·ï¼Œå¯¹äºç”¨æˆ·ç»„ï¼ŒLinux ä¹Ÿæœ‰ç›¸åº”çš„æ–‡ä»¶ /etc/group å’Œ /etc/gshadowã€‚ æŸ¥çœ‹ /etc/group æ–‡ä»¶ï¼š vagrant@saltmaster:~$ cat /etc/groupwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin æ¯ä¸€è¡Œè®°å½•ä¸€ä¸ªç”¨æˆ·ç»„çš„ä¿¡æ¯ï¼Œå­—æ®µåˆ†åˆ«ä¸ºï¼š ç”¨æˆ·ç»„åç§° å¯†ç ï¼ˆé€šå¸¸ç”¨ x å ä½ï¼‰ GID ç”¨æˆ·ç»„æˆå‘˜åˆ—è¡¨ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ /etc/gshadow æ–‡ä»¶å†…å®¹ç¤ºä¾‹ï¼š vagrant@saltmaster:~$ sudo head -n 4 /etc/gshadowroot:*::daemon:*::bin:*::sys:*:: åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œç¬¬äºŒä¸ªå­—æ®µä¹Ÿæ˜¯å¯†ç ï¼Œå¦‚æœè¿™ä¸ªå­—æ®µä¸º !ï¼Œåˆ™è¡¨ç¤ºè¯¥ç”¨æˆ·ç»„æ²¡æœ‰ç»„ç®¡ç†å‘˜çš„æƒé™ã€‚ ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯ï¼Œä¸ºä»€ä¹ˆ /etc/passwd ä¸­ç”¨æˆ·çš„ç”¨æˆ·ç»„ ID å¹¶ä¸åœ¨ /etc/group ä¸­åˆ—å‡ºï¼Ÿè¿™æ˜¯å› ä¸ºï¼Œ/etc/passwd ä¸­çš„ç”¨æˆ·ç»„ç§°ä¸ºâ€åˆå§‹ç”¨æˆ·ç»„â€ï¼Œæ„å‘³ç€å½“ç”¨æˆ·ç™»å½•åˆ° shell æ—¶ï¼Œæ‰€ä¾æ®çš„ç”¨æˆ·ç»„ã€‚è¯¥ç”¨æˆ·ç»„ä¸éœ€è¦åœ¨ /etc/group åˆ—è¡¨ä¸­æ˜¾ç¤ºã€‚ å½“ç”¨æˆ·å±äºå¤šä¸ªç”¨æˆ·ç»„æ—¶ï¼Œä»–ä¼šè·å¾—æ‰€æœ‰è¿™äº›ç»„çš„æƒé™ã€‚æ–‡ä»¶çš„é»˜è®¤ç»„æ˜¯â€æœ‰æ•ˆç”¨æˆ·ç»„â€ã€‚å¯ä»¥é€šè¿‡å‘½ä»¤ groups æŸ¥çœ‹åˆ°å½“å‰ç”¨æˆ·çš„æ‰€æœ‰ç”¨æˆ·ç»„ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªç”¨æˆ·ç»„æ˜¯æœ‰æ•ˆç”¨æˆ·ç»„ï¼Œç”¨äºåˆ›å»ºæ–°æ–‡ä»¶ã€‚ ç¤ºä¾‹å‘½ä»¤ï¼š vagrant@saltmaster:~$ groupsadm cdrom sudo dip plugdev lxd lpadmin sambashare vagrant ä½¿ç”¨ newgrp å‘½ä»¤å¯ä»¥åœ¨æ–°çš„ shell ä¸­åˆ‡æ¢ç”¨æˆ·ç»„ï¼Œæœ€åé€šè¿‡ä½¿ç”¨ exit å¯ä»¥è¿”å›åˆ°ä¹‹å‰çš„ç”¨æˆ·ç»„ã€‚ vagrant@saltmaster:~$ newgrp sudovagrant@saltmaster:~$ touch test_b ä»¥ä¸Šå‘½ä»¤ä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿåœ¨ sudo ç”¨æˆ·ç»„ä¸‹åˆ›å»ºæ–‡ä»¶ test_bï¼Œè¯¥æ–‡ä»¶çš„å±æ€§å¦‚ä¸‹ï¼š vagrant@saltmaster:~$ ll test_*-rw-rw-r-- 1 vagrant adm 0 Nov 26 15:46 test_a-rw-rw-r-- 1 vagrant sudo 0 Nov 26 15:47 test_b é€šè¿‡è¿™äº›è¿‡ç¨‹ï¼Œå¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°åœ¨ Linux ä¸­ï¼Œç”¨æˆ·å’Œç”¨æˆ·ç»„çš„å¤„ç†æ˜¯å¦‚ä½•è¿›è¡Œçš„ï¼ŒåŠå…¶å¦‚ä½•ä¿æŒç³»ç»Ÿçš„å®‰å…¨æ€§ä¸ç»„ç»‡æ€§ã€‚ åˆ›å»ºä¸ç®¡ç†ç”¨æˆ·useraddåœ¨ç†Ÿæ‚‰äº†ç”¨æˆ·å’Œç”¨æˆ·ç»„çš„åŸºæœ¬æ¦‚å¿µåï¼Œä»¬ç°åœ¨è¿›å…¥ç”¨æˆ·ç®¡ç†çš„å®é™…æ“ä½œéƒ¨åˆ†ã€‚åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·è´¦æˆ·çš„å‘½ä»¤æ˜¯ useraddã€‚è¯·æ³¨æ„ï¼Œè¯¥å‘½ä»¤éœ€è¦å¯¹ç³»ç»Ÿæ–‡ä»¶ï¼ˆå¦‚ /etc/passwd ç­‰ï¼‰å…·æœ‰è¯»å†™æƒé™ï¼Œå› æ­¤ä¸€èˆ¬éœ€è¦ä»¥ root ç”¨æˆ·èº«ä»½æ‰§è¡Œã€‚ ä»¥ä¸‹æ˜¯ä½¿ç”¨ useradd åˆ›å»ºä¸€ä¸ªåä¸º tom çš„è´¦æˆ·çš„ç¤ºä¾‹ï¼š vagrant@saltmaster:/home$ useradd tomuseradd: Permission denied.useradd: cannot lock /etc/passwd; try again later. åœ¨å°è¯•æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œç³»ç»Ÿæé†’æƒé™ä¸è¶³ï¼Œè¿™è¯´æ˜å½“å‰ç”¨æˆ·æ²¡æœ‰è¶³å¤Ÿæƒé™ã€‚æ¥ç€ï¼Œä»¬å¯ä»¥ä½¿ç”¨ sudo -s åˆ‡æ¢åˆ° root ç”¨æˆ·ï¼š vagrant@saltmaster:/home$ sudo -sroot@saltmaster:/home# useradd tom åœ¨æˆåŠŸæ‰§è¡Œåï¼Œä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ–°åˆ›å»ºçš„ç”¨æˆ·åœ¨ç³»ç»Ÿä¸­çš„è®°å½•ï¼š root@saltmaster:/home# grep tom /etc/passwd/etc/passwd: tom:x:1001:1001::/home/tom: è¿™è¡Œè¾“å‡ºæ˜¾ç¤ºï¼Œç³»ç»Ÿä¸ºç”¨æˆ· tom åœ¨ /etc/passwd æ–‡ä»¶ä¸­æ·»åŠ äº†ä¸€æ¡è®°å½•ï¼Œå…¶ä¸­åŒ…å«äº†ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œåœ¨ /etc/shadow ä¸­ä¹Ÿæœ‰ç›¸åº”çš„æ¡ç›®ï¼Œå¯†ç å­—æ®µä¸ºç©ºï¼Œè¡¨ç¤ºè¯¥ç”¨æˆ·å°šæœªè®¾ç½®å¯†ç ï¼š root@saltmaster:/home# grep tom /etc/shadow/etc/shadow: tom:!:17496:0:99999:7::: ç”¨æˆ·ç»„ä¿¡æ¯ä¹Ÿè¢«æ·»åŠ åˆ°äº† /etc/group ä¸­ï¼š /etc/group: tom:x:1001: å°½ç®¡æ‰§è¡Œå‘½ä»¤æˆåŠŸï¼Œä½†æ²¡æœ‰ä¸º tom ç”¨æˆ·åˆ›å»ºå®¶ç›®å½•ï¼Œè¿™åœ¨ CentOS ç³»ç»Ÿä¸­æ˜¯å¸¸è§çš„æƒ…å†µã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹ç³»ç»Ÿé…ç½®æ¥æ”¹å˜è¿™ä¸€é»˜è®¤è¡Œä¸ºã€‚ å¦å¤–ï¼Œä½¿ç”¨ useradd å‘½ä»¤æ—¶ï¼ŒLinux ç³»ç»Ÿä¼šè‡ªåŠ¨åº”ç”¨ä¸€äº›é»˜è®¤å‚æ•°ã€‚é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹è¿™äº›é»˜è®¤é…ç½®ï¼š vagrant@saltmaster:~$ useradd -D æ¯”å¦‚ï¼Œç³»ç»Ÿä¼šè®¾ç½®ç»„ IDï¼ˆGROUPï¼‰ã€å®¶ç›®å½•ï¼ˆHOMEï¼‰ã€é»˜è®¤ shellï¼ˆSHELLï¼‰ç­‰ï¼Œå…·ä½“é»˜è®¤å€¼ä¸€èˆ¬å­˜å‚¨åœ¨ /etc/default/useradd æ–‡ä»¶ä¸­ã€‚ passwdåˆ›å»ºç”¨æˆ·åï¼Œéœ€è¦ä¸ºæ–°è´¦æˆ·è®¾ç½®å¯†ç ï¼Œè¿™éœ€è¦ä½¿ç”¨ passwd å‘½ä»¤ã€‚ä¾‹å¦‚ï¼š root@saltmaster:/home# passwd tom åœ¨æ‰§è¡Œè¯¥å‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šæç¤ºè¾“å…¥ tom ç”¨æˆ·çš„æ–°å¯†ç ã€‚æ™®é€šç”¨æˆ·åœ¨ä¿®æ”¹è‡ªå·±å¯†ç æ—¶éœ€è¦è¾“å…¥æ—§å¯†ç ï¼Œè€Œ root ç”¨æˆ·åˆ™ä¸éœ€è¦ã€‚ å…¶ä»–ä¿®æ”¹è´¦æˆ·çš„å‘½ä»¤ï¼ˆsudoï¼‰é™¤äº†åˆ›å»ºç”¨æˆ·å’Œè®¾ç½®å¯†ç å¤–ï¼ŒLinux è¿˜æä¾›äº†ä¸€äº›å‘½ä»¤æ¥ä¿®æ”¹è´¦æˆ·å±æ€§ï¼š chageï¼šç”¨äºä¿®æ”¹ä¸å¯†ç æœ‰å…³çš„è´¦æˆ·å‚æ•°ï¼Œä¾‹å¦‚å¯†ç çš„å¤±æ•ˆæ—¥æœŸç­‰ã€‚ usermodï¼šå¯ä»¥ç”¨æ¥ä¿®æ”¹ç”¨æˆ·çš„æœ‰æ•ˆç»„ã€åˆå§‹ç»„å’Œä¸»ç›®å½•ç­‰ä¿¡æ¯ã€‚ userdelï¼šæ­¤å‘½ä»¤ç”¨äºåˆ é™¤ç”¨æˆ·ï¼Œéœ€è°¨æ…ä½¿ç”¨ï¼Œå› ä¸ºä¼šå°†ç”¨æˆ·ç›¸å…³çš„è®°å½•ä» /etc/passwd å’Œ /etc/shadow ä¸­åˆ é™¤ï¼Œå¹¶ä¸”ä¼šåˆ é™¤ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯ä»¥å…ˆå°†è´¦æˆ·çŠ¶æ€è®¾ç½®ä¸ºä¸å¯ç”¨ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ é™¤ã€‚ å¦‚æœç¡®å®éœ€è¦åˆ é™¤ç”¨æˆ·ï¼Œä½¿ç”¨ userdel -r username å‘½ä»¤å¯ä»¥åŒæ—¶åˆ é™¤ç”¨æˆ·ä»¥åŠå…¶ä¸»ç›®å½•åŠç›¸å…³æ–‡ä»¶ã€‚ ç”¨æˆ·å¯ä»¥ä½¿ç”¨çš„ä¸€äº›å‘½ä»¤é™¤äº†ç®¡ç†è´¦æˆ·çš„å‘½ä»¤å¤–ï¼Œæ™®é€šç”¨æˆ·ä¹Ÿå¯ä»¥æ‰§è¡Œä¸€äº›åŸºæœ¬å‘½ä»¤ï¼š passwdï¼šç”¨æˆ·å¯ä»¥ç”¨è¯¥å‘½ä»¤ä¿®æ”¹è‡ªå·±çš„å¯†ç ã€‚ chage -l usernameï¼šæŸ¥çœ‹ç”¨æˆ·çš„å¯†ç å’Œå¸æˆ·ä¿¡æ¯ã€‚ fingerï¼šæŸ¥è¯¢ç”¨æˆ·ç›¸å…³çš„ä¿¡æ¯ã€‚ chfnï¼šä¿®æ”¹ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚ chshï¼šæ”¹å˜é»˜è®¤ç™»å½•çš„ shellã€‚ idï¼šæŸ¥è¯¢ç”¨æˆ·çš„ ID ä¿¡æ¯ã€‚ ç”¨æˆ·ç»„çš„ç®¡ç†å…³äºç”¨æˆ·ç»„çš„ç®¡ç†ï¼Œå‘½ä»¤ä¸ç”¨æˆ·ç®¡ç†ç›¸ä¼¼ï¼Œä¸»è¦æ¶‰åŠ /etc/group å’Œ /etc/gshadow æ–‡ä»¶ã€‚ä½¿ç”¨ newgrp å‘½ä»¤å¯ä»¥å¼€å¯ä¸€ä¸ªæ–°çš„ shellï¼Œä»¥æ–°ç¯å¢ƒç™»å½•ç”¨æˆ·å’Œç”¨æˆ·ç»„ã€‚è¿™ä¸ªå‘½ä»¤çš„ä½¿ç”¨å¯ä»¥è®©ç”¨æˆ·åœ¨ä¸åŒçš„ç»„ä¸­åˆ‡æ¢ï¼Œä½†å®é™…çš„ç»„æƒé™æ£€éªŒæ˜¯åŸºäºè¿›ç¨‹çš„æœ‰æ•ˆç»„ IDã€‚ ç²¾ç¡®çš„æƒé™æ§åˆ¶ - ACLåœ¨ Linux æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œé»˜è®¤çš„æƒé™ç®¡ç†æ˜¯åŸºäºâ€æ‰€æœ‰è€…ã€ç»„å’Œå…¶ä»–äººâ€ä¸‰ç»„æƒé™çš„ã€‚å¯¹äºåŒä¸€ä¸ªç”¨æˆ·ç»„å†…çš„æˆå‘˜æˆ–å±äºâ€å…¶ä»–äººâ€çš„æˆå‘˜ï¼Œæƒé™çš„ç»†è‡´æ§åˆ¶æ˜¯æœ‰é™çš„ï¼Œå› æ­¤å¼•å…¥äº† ACLï¼ˆAccess Control Listï¼‰ã€‚ACL èƒ½å¤Ÿé’ˆå¯¹ç‰¹å®šç”¨æˆ·å’Œç‰¹å®šæ–‡ä»¶æˆ–ç›®å½•è®¾ç½®è¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€‚ä½¿ç”¨ ACL éœ€è¦ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿçš„æ”¯æŒï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤ mount | grep acl æ£€æŸ¥å½“å‰æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦æ”¯æŒæ­¤åŠŸèƒ½ã€‚ ç”¨æˆ·åˆ‡æ¢ - su, su - å’Œ sudoç”¨æˆ·åœ¨ Linux ä¸­åˆ‡æ¢èº«ä»½çš„å¸¸ç”¨å‘½ä»¤æ˜¯ suã€‚å‘½ä»¤çš„æ ¼å¼ä¸º su - usernameï¼Œå…¶ä¸­ - è¡¨ç¤ºå°†ç”¨æˆ·çš„æ‰€æœ‰ç¯å¢ƒå˜é‡åˆ‡æ¢ä¸ºç›®æ ‡ç”¨æˆ·çš„ç¯å¢ƒï¼Œå¦‚ su - vagrant å°†åˆ‡æ¢åˆ° vagrant ç”¨æˆ·ï¼Œæ”¹å˜æ‰€æœ‰çš„ç¯å¢ƒå˜é‡ã€‚ ä½¿ç”¨ su - root å¯ç›´æ¥ä»¥ root èº«ä»½ç™»å½•ã€‚å¦‚æœåªéœ€è¦ä¸´æ—¶è¿è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ su - root -c command æ ¼å¼ï¼Œå…¶ä¸­çš„ root å¯ä»¥çœç•¥ã€‚ ç„¶è€Œï¼Œæ¯ä¸ªäººéƒ½ä½¿ç”¨ root æƒé™çš„éœ€æ±‚å¯èƒ½å¯¼è‡´ä¸å®‰å…¨ï¼Œæ‰€ä»¥å¼•å…¥äº† sudo å‘½ä»¤ã€‚sudo å…è®¸ç”¨æˆ·ä»¥å…¶ä»–ç”¨æˆ·çš„èº«ä»½ï¼ˆé€šå¸¸æ˜¯ rootï¼‰æ‰§è¡Œå‘½ä»¤ã€‚åœ¨ä½¿ç”¨ sudo ä¹‹å‰ï¼Œç”¨æˆ·å¿…é¡»åœ¨ /etc/sudoers æ–‡ä»¶ä¸­è¿›è¡Œæˆæƒã€‚ sudores æ–‡ä»¶æ”¯æŒå¯¹ç”¨æˆ·ç»„çš„æˆæƒï¼Œä½¿ç”¨ % ç¬¦å·æ¥è¡¨ç¤ºç”¨æˆ·ç»„ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è®¾ç½®æŸä¸ªç”¨æˆ·ç»„çš„æƒé™ï¼š root ALL=(ALL) ALL æ­¤å¤–ï¼Œå¯ä»¥åœ¨æ¡ç›®ä¸­æ·»åŠ  NOPASSWD: ALL æ¥å…é™¤æ¯æ¬¡ä½¿ç”¨ sudo æ—¶è¾“å…¥å¯†ç çš„è¦æ±‚ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç³»ç»Ÿå‚æ•°"]},{"title":"HTTPæ•°æ®åŒ…å¤´","path":"/2024/12/04/1-å¹³å°ç³»ç»Ÿ-Linux-ç½‘ç»œ-HTTPæ•°æ®åŒ…å¤´/","content":"ä¸€ã€è¿æ¥è‡³ Web æœåŠ¡å™¨åœ¨ Web æŠ€æœ¯çš„ä¸–ç•Œä¸­ï¼Œå®¢æˆ·ç«¯åº”ç”¨ï¼ˆå¦‚ Web æµè§ˆå™¨ï¼‰é¦–å…ˆéœ€è¦è¿æ¥åˆ° Web æœåŠ¡å™¨çš„ HTTP ç«¯å£ï¼Œé»˜è®¤ç«¯å£ä¸º 80ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿æ¥çš„åœ°å€å¯èƒ½åŒ…æ‹¬ç‰¹å®šçš„ç«¯å£å·ï¼Œä¾‹å¦‚ï¼š http://www.myweb.com:8080/index.html åœ¨ Java ä»£ç ä¸­å»ºç«‹è¿æ¥çš„ç›¸åº”æ–¹å¼å¦‚ä¸‹ï¼š Socket socket = new Socket(www.myweb.com, 8080); è¿™é‡Œï¼Œé€šè¿‡ socket ç±»çš„æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªåˆ°æŒ‡å®šä¸»æœºå’Œç«¯å£çš„è¿æ¥ã€‚ äºŒã€å‘é€ HTTP è¯·æ±‚ä¸€æ—¦å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ã€‚HTTP è¯·æ±‚æ˜¯ ASCII æ–‡æœ¬æ ¼å¼ï¼Œé€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼šè¯·æ±‚è¡Œã€è¯·æ±‚å¤´æ ‡ã€ç©ºè¡Œå’Œè¯·æ±‚æ•°æ®ã€‚ è¯·æ±‚è¡Œï¼šè¯·æ±‚è¡Œç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š è¯·æ±‚æ–¹æ³•ï¼ˆå¦‚ GETã€POST ç­‰ï¼‰ è¯·æ±‚ URIï¼ˆè¯·æ±‚èµ„æºçš„è·¯å¾„ï¼‰ HTTP ç‰ˆæœ¬ï¼ˆå¦‚ HTTP1.1ï¼‰ ç¤ºä¾‹è¯·æ±‚è¡Œï¼š GET /index.html HTTP/1.1 HTTP è§„èŒƒå®šä¹‰äº†å¸¸ç”¨çš„è¯·æ±‚æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼š GETï¼šç”¨äºæ£€ç´¢èµ„æºã€‚ HEADï¼šä¸ GET ç›¸ä¼¼ï¼Œä½†æœåŠ¡å™¨åªè¿”å›å“åº”å¤´ã€‚ POSTï¼šç”¨äºæäº¤æ•°æ®ç»™æœåŠ¡å™¨ã€‚ PUTï¼šç”¨äºä¸Šä¼ æ–‡ä»¶åˆ°æŒ‡å®šè·¯å¾„ã€‚ DELETEï¼šåˆ é™¤æŒ‡å®š URI èµ„æºã€‚ OPTIONSï¼šæŸ¥è¯¢æœåŠ¡å™¨æ”¯æŒçš„è¯·æ±‚æ–¹æ³•ã€‚ TRACEï¼šç¯å›è¯·æ±‚ï¼Œç”¨äºè¯Šæ–­ã€‚ CONNECTï¼šç”¨äºå»ºç«‹ä¸€ä¸ªç½‘ç»œè¿æ¥çš„éš§é“ï¼ˆå¦‚ HTTPSï¼‰ã€‚ è¯·æ±‚å¤´æ ‡ï¼šè¯·æ±‚å¤´æ ‡ç”±å…³é”®å­—å’Œå¯¹åº”çš„å€¼ç»„æˆï¼Œé€šå¸¸é‡‡ç”¨â€œå…³é”®å­—: å€¼â€çš„æ ¼å¼ã€‚å¸¸è§çš„è¯·æ±‚å¤´æ ‡åŒ…æ‹¬ï¼š User-Agentï¼šæŒ‡ç¤ºå®¢æˆ·ç«¯è½¯ä»¶çš„ä¿¡æ¯ï¼ˆå¦‚æµè§ˆå™¨ç±»å‹å’Œç‰ˆæœ¬ï¼‰ã€‚ Acceptï¼šå®¢æˆ·ç«¯å¯ä»¥å¤„ç†çš„å†…å®¹ç±»å‹åˆ—è¡¨ï¼Œå¦‚ Accept: text/html, application/jsonã€‚ Content-Lengthï¼šè¯·æ±‚ä½“ä¸­æ•°æ®çš„é•¿åº¦ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚ ç©ºè¡Œï¼šè¯·æ±‚å¤´æ ‡ç»“æŸåï¼Œå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªç©ºè¡Œï¼Œè¡¨ç¤ºå¤´éƒ¨ä¿¡æ¯å®Œç»“ã€‚è¿™ä¸ªç©ºè¡Œé€šå¸¸æ˜¯ä¸€ä¸ªå›è½¦ç¬¦å’Œæ¢è¡Œç¬¦çš„ç»„åˆã€‚ è¯·æ±‚æ•°æ®ï¼šå½“ä½¿ç”¨ POST æ–¹æ³•æ—¶ï¼Œè¯·æ±‚æ•°æ®å°†éšä¹‹è€Œæ¥ã€‚å¸¸å¸¸ä¼´éšç€ Content-Type å’Œ Content-Length å¤´æ ‡ï¼ŒæŒ‡æ˜æ•°æ®çš„åª’ä½“ç±»å‹åŠå…¶å­—èŠ‚é•¿åº¦ã€‚ Socket socket = new Socket(www.myweb.com, 8080);InputStream in = socket.getInputStream();OutputStream out = socket.getOutputStream(); ä¸‰ã€æœåŠ¡ç«¯æ¥å—è¯·æ±‚å¹¶è¿”å› HTTP å“åº”Web æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šè§£æè¿™äº›ä¿¡æ¯å¹¶å®šä½æ‰€è¯·æ±‚çš„èµ„æºã€‚éšåï¼ŒæœåŠ¡å™¨ä¼šå°†èµ„æºçš„å‰¯æœ¬å†™å…¥åˆ°å¥—æ¥å­—ä¸­ï¼Œå…è®¸å®¢æˆ·ç«¯è¯»å–ã€‚ ä¸€ä¸ªå“åº”é€šå¸¸åŒ…å«å››ä¸ªéƒ¨åˆ†ï¼šçŠ¶æ€è¡Œã€å“åº”å¤´æ ‡ã€ç©ºè¡Œå’Œå“åº”æ•°æ®ã€‚ çŠ¶æ€è¡Œï¼šçŠ¶æ€è¡Œç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š HTTP ç‰ˆæœ¬ å“åº”ä»£ç ï¼ˆä¸‰ä½æ•°å­—ï¼‰ å“åº”æè¿° ä¾‹å¦‚ï¼š HTTP/1.1 200 OK å“åº”ä»£ç çš„åˆ†ç±»ï¼š 1xxï¼šä¿¡æ¯æ€§ï¼Œè¡¨ç¤ºè¯·æ±‚å·²è¢«æ¥æ”¶ä¸”æ­£åœ¨å¤„ç†ã€‚ 2xxï¼šæˆåŠŸï¼Œè¡¨ç¤ºè¯·æ±‚æˆåŠŸè¢«æ¥å—å’Œå¤„ç†ã€‚ 3xxï¼šé‡å®šå‘ï¼Œè¡¨ç¤ºåç»­æ“ä½œéœ€è¦ç»§ç»­è¿›è¡Œã€‚ 4xxï¼šå®¢æˆ·ç«¯é”™è¯¯ï¼Œè¡¨ç¤ºè¯·æ±‚æœ‰è¯¯æˆ–æ— æ³•æ»¡è¶³ã€‚ 5xxï¼šæœåŠ¡å™¨é”™è¯¯ï¼Œè¡¨ç¤ºæœåŠ¡å™¨æ— æ³•æ»¡è¶³è¯·æ±‚ã€‚ å“åº”å¤´æ ‡ï¼šå“åº”å¤´æ ‡ç±»ä¼¼äºè¯·æ±‚å¤´æ ‡ï¼Œæä¾›å…³äºå“åº”æ•°æ®çš„ç»†èŠ‚å’ŒæœåŠ¡å™¨çš„å±æ€§ã€‚ä¾‹å¦‚ï¼š Dateï¼šè¡¨ç¤ºå“åº”ç”Ÿæˆçš„æ—¶é—´ã€‚ Content-Lengthï¼šå†…å®¹çš„å­—èŠ‚é•¿åº¦ã€‚ Content-Typeï¼šèµ„æºçš„ç±»å‹ï¼Œå¦‚ Content-Type: text/htmlã€‚ ç©ºè¡Œï¼šå“åº”å¤´æ ‡åé¢çš„ç©ºè¡Œï¼Œè¡¨æ˜åç»­æ•°æ®ä¸ºå“åº”ä½“ã€‚ å“åº”æ•°æ®ï¼šå®é™…è¿”å›çš„æ•°æ®ä½“ï¼Œä¾‹å¦‚ HTML æ–‡æ¡£æˆ–å›¾åƒæ–‡ä»¶ã€‚ å››ã€æœåŠ¡å™¨å…³é—­è¿æ¥ï¼Œæµè§ˆå™¨è§£æå“åº” æµè§ˆå™¨è§£æçŠ¶æ€è¡Œï¼Œä»¥æ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸï¼ˆé€šè¿‡çŠ¶æ€ä»£ç åˆ¤å®šï¼‰ã€‚ æ¥ç»­æµè§ˆå™¨è§£ææ¯ä¸ªå“åº”å¤´æ ‡ï¼Œè¿™äº›å¤´æ ‡è¡¨æ˜æ¥ä¸‹æ¥çš„æ•°æ®å­—èŠ‚æ•°ã€‚ è¯»å–å“åº”æ•°æ®åï¼Œæµè§ˆå™¨ä¼šä¾ç…§ HTML è¯­æ³•å¯¹å…¶è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¹¶åœ¨çª—å£ä¸­å±•ç¤ºã€‚ è‹¥ HTML æ–‡æ¡£ä¸­åŒ…å«å…¶ä»–èµ„æºï¼ˆå¦‚ CSS æ ·å¼è¡¨ã€å›¾åƒï¼‰ï¼Œæµè§ˆå™¨ä¼šå‘èµ·é¢å¤–çš„è¯·æ±‚åŠ è½½è¿™äº›èµ„æºï¼Œè€Œè¯¥è¿‡ç¨‹å¯èƒ½é‡å¤å¤šæ¬¡ã€‚ äº”ã€æ— çŠ¶æ€è¿æ¥HTTP åè®®çš„æ— çŠ¶æ€ç‰¹æ€§æ„å‘³ç€æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼ŒæœåŠ¡å™¨ä¸ä¼šä¿å­˜ä»»ä½•å…³äºå…ˆå‰è¯·æ±‚çš„çŠ¶æ€ã€‚æ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ç¦»æ•£çš„ï¼Œæ²¡æœ‰ä¸Šä¸‹æ–‡å…³è”ã€‚ å…­ã€å®ä¾‹ç¤ºä¾‹ 1 - é¦–æ¬¡è¯·æ±‚ æµè§ˆå™¨å‘é€è¯·æ±‚ï¼š GET /index.html HTTP/1.1 æœåŠ¡å™¨è¿”å›å“åº”ï¼š HTTP/1.1 200 OKDate: Apr 11 2006 15:32:08 GMTServer: Apache/2.0.46(win32)Content-Length: 119Content-Type: text/htmlHTMLHEADLINK REL=stylesheet HREF=index.css/HEADBODYIMG SRC=image/logo.png/BODY/HTML ç¤ºä¾‹ 2 - è¯·æ±‚ CSS æ–‡ä»¶ æµè§ˆå™¨å‘é€è¯·æ±‚ï¼š GET /index.css HTTP/1.1 æœåŠ¡å™¨è¿”å›å“åº”ï¼š HTTP/1.1 200 OKDate: Apr 11 2006 15:32:08 GMTServer: Apache/2.0.46(win32)Connection: Keep-alive, closeContent-Length: 70Content-Type: text/plainh3 font-size: 20px; font-weight: bold; color: #005A9C; ç¤ºä¾‹ 3 - è¯·æ±‚å›¾åƒæ–‡ä»¶ æµè§ˆå™¨å‘é€è¯·æ±‚ï¼š GET image/logo.png HTTP/1.1 æœåŠ¡å™¨è¿”å›å“åº”ï¼š HTTP/1.1 200 OKDate: Apr 11 2006 15:32:08 GMTServer: Apache/2.0.46(win32)Connection: Keep-alive, closeContent-Length: 1280Content-Type: image/pngBinary image data follows é™„å½•1. HTTP è§„èŒƒHTTP åè®®çš„æ ‡å‡†æ–‡æ¡£ç”± Internet å·¥ç¨‹åˆ¶å®šç»„ç»‡ï¼ˆIETFï¼‰å‘å¸ƒçš„ RFCï¼ˆè¯·æ±‚è¯„è®ºï¼‰æ–‡ä»¶æ¥è§„èŒƒã€‚ç”±äºè¿™äº› RFC åœ¨ç½‘ç»œè¡Œä¸šè¢«å¹¿æ³›æ¥å—ï¼Œå› æ­¤è¢«èª‰ä¸ºæ ‡å‡†æ–‡æ¡£ã€‚ 2. RFCRFC æ–‡æ¡£ç¼–å†™åå°±ä¼šè¢«åˆ†é…ä¸€ä¸ªå·ç å¹¶ä¿æŒä¸å˜ï¼Œå½“æ–°ç‰ˆæœ¬å‘å¸ƒæ—¶ï¼Œæ—§ç‰ˆä¼šè·å¾—æ–°çš„ RFC ç¼–å·ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œæ ‡å‡†å¯èƒ½ä¼šéšç€æŠ€æœ¯çš„å‘å±•è€Œæ›´æ–°æ¼”å˜ã€‚ 3. HTTP çš„å‡ ä¸ªé‡è¦ RFC RFC1945ï¼šæè¿°äº† HTTP 1.0 çš„åŸºæœ¬ç‰¹æ€§ã€‚ RFC2068ï¼šåˆæ­¥æè¿° HTTP 1.1ã€‚ RFC2616ï¼šæ­£å¼è§„èŒƒ HTTP 1.1ã€‚ 4. èµ„æºæ ‡è¯†ç¬¦ URIç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼ˆURIï¼‰ç”¨äºæ ‡è¯†äº’è”ç½‘ä¸Šçš„èµ„æºã€‚ HTTP å“åº”ç å“åº”ç æ˜¯ç”±ä¸‰ä½æ•°å­—ç»„æˆï¼Œè¡¨ç¤ºè¯·æ±‚çš„å¤„ç†ç»“æœï¼ŒæŒ‰ç¬¬ä¸€ä½æ•°å­—åˆ†ç±»ä¸ºä»¥ä¸‹äº”ç§ç±»å‹ï¼š 1xxï¼šä¿¡æ¯æ€§ï¼ˆè¯·æ±‚å·²æ¥æ”¶ï¼Œç»§ç»­å¤„ç†ï¼‰ 2xxï¼šæˆåŠŸï¼ˆè¯·æ±‚å·²æˆåŠŸå¤„ç†ï¼‰ 3xxï¼šé‡å®šå‘ï¼ˆéœ€è¦è¿›ä¸€æ­¥æ“ä½œä»¥å®Œæˆè¯·æ±‚ï¼‰ 4xxï¼šå®¢æˆ·ç«¯é”™è¯¯ï¼ˆè¯·æ±‚ä¸åˆæ³•æˆ–æ— æ³•å®Œæˆï¼‰ 5xxï¼šæœåŠ¡å™¨é”™è¯¯ï¼ˆæœåŠ¡å™¨æœªèƒ½å®Œæˆåˆæ³•çš„è¯·æ±‚ï¼‰ å“åº”ä»£ç  å«ä¹‰ 100 ç»§ç»­ 200 OK 301 æ°¸ä¹…æ€§ç§»åŠ¨ 404 æœªæ‰¾åˆ°èµ„æº 500 å†…éƒ¨æœåŠ¡å™¨é”™è¯¯ HTTP å¤´æ ‡HTTP å¤´æ ‡ç”±ä¸»é”®ä¸å€¼å¯¹æ„æˆï¼Œæè¿°å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨çš„å±æ€§ã€ä¼ è¾“çš„èµ„æºã€ä»¥åŠè¿æ¥ä¿¡æ¯ã€‚å¤´æ ‡å¯åˆ†ä¸ºä»¥ä¸‹å››ç§ç±»å‹ï¼š é€šç”¨å¤´æ ‡ï¼šå¯ç”¨äºè¯·æ±‚å’Œå“åº”ã€‚ è¯·æ±‚å¤´æ ‡ï¼šå…è®¸å®¢æˆ·ç«¯ä¼ é€’è‡ªèº«çš„ç›¸å…³ä¿¡æ¯ã€‚ å“åº”å¤´æ ‡ï¼šæœåŠ¡å™¨ç”¨äºä¼ é€’è‡ªèº«ä¿¡æ¯ã€‚ å®ä½“å¤´æ ‡ï¼šå®šä¹‰è¢«ä¼ é€èµ„æºçš„ä¿¡æ¯ã€‚ å¤´æ ‡çš„æ ¼å¼é€šå¸¸æ˜¯ï¼š name:valueCRLF å¤´æ ‡å æè¿° Accept å®¢æˆ·ç«¯å¯ä»¥å¤„ç†çš„åª’ä½“ç±»å‹åˆ—è¡¨ Content-Length è¯·æ±‚æˆ–å“åº”ä¸­æ•°æ®çš„å­—èŠ‚é•¿åº¦ User-Agent å‘èµ·è¯·æ±‚çš„è½¯ä»¶ç±»å‹ï¼ˆå¦‚æµè§ˆå™¨ï¼‰ Content-Type å‘é€æˆ–æ¥æ”¶çš„å®ä½“çš„ MIME ç±»å‹ æ­¤å¤–ï¼ŒHTTP çš„å¤´æ ‡æœ‰åŠ©äºæ›´å¥½åœ°è¯†åˆ«å’Œå¤„ç†è¯·æ±‚å’Œå“åº”ï¼Œä»è€Œæé«˜ Web åº”ç”¨çš„æ•ˆç‡å’Œç”¨æˆ·ä½“éªŒã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç½‘ç»œ"]},{"title":"SambaæœåŠ¡","path":"/2024/12/03/1-å¹³å°ç³»ç»Ÿ-Linux-ç½‘ç»œ-SambaæœåŠ¡/","content":"SMB åè®®å’Œ Samba SMB åè®®ï¼ˆServer Message Blockï¼ŒæœåŠ¡ä¿¡æ¯å—ï¼‰æ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œå®ƒå…è®¸ä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´å…±äº«æ–‡ä»¶ã€æ‰“å°æœºå’Œå…¶ä»–ç½‘ç»œèµ„æºã€‚SMB åœ¨å„ç§ç¯å¢ƒä¸­å¹¿æ³›ä½¿ç”¨ï¼ŒåŒ…æ‹¬ä¼ä¸šå†…ç½‘å’Œäº‘è®¡ç®—æœåŠ¡ã€‚å®ƒå¯ä»¥å®ç°è¯¸å¦‚æ–‡ä»¶ä¼ è¾“ã€è®¿é—®å…±äº«ç›®å½•å’Œæ‰“å°æœºç­‰åŠŸèƒ½ã€‚ Sambaæ˜¯ä¸€å¥—è®© Linux ç³»ç»Ÿèƒ½å¤Ÿæ”¯æŒ SMB åè®®çš„è½¯ä»¶é›†åˆã€‚å®ƒå®ç°äº† TCPIP åè®®æ ˆï¼Œæˆä¸º Windows ç½‘ç»œä¸­è¿›è¡Œæ–‡ä»¶å’Œæ‰“å°å…±äº«çš„æ ¸å¿ƒç»„ä»¶ã€‚Samba ä¸ä»…å…è®¸ Linux ç³»ç»Ÿè®¿é—® Windows å…±äº«ï¼Œè¿˜å¯ä»¥è®© Windows è®¡ç®—æœºè®¿é—® Linux å…±äº«èµ„æºã€‚ Samba çš„æ ¸å¿ƒç”±ä¸¤ä¸ªå®ˆæŠ¤è¿›ç¨‹ç»„æˆï¼š smbdï¼šè¿™ä¸ªè¿›ç¨‹ç›‘å¬ TCP ç«¯å£ 139ï¼Œä¸»è¦å¤„ç†è¿›å…¥çš„ SMB æ•°æ®åŒ…ï¼Œè´Ÿè´£æä¾›æ–‡ä»¶æœåŠ¡ã€‚ nmbdï¼šè¿™ä¸ªè¿›ç¨‹ç›‘å¬ UDP ç«¯å£ 137 å’Œ 138ï¼Œå¸®åŠ©å…¶ä»–è®¡ç®—æœºå‘ç°å’Œè®¿é—® Linux Samba æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬æä¾›å·¥ä½œç»„å’Œåç§°è§£ææœåŠ¡ã€‚ å®‰è£… Samba å¿…è£…åŒ…ï¼šå®‰è£… Samba çš„åŸºæœ¬åŒ…æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š # rpm -ivh samba-common-2.2.7a-7.9.0.i386.rpm# rpm -ivh samba-2.2.7a-7.9.0.i386.rpm# rpm -ivh samba-client-2.2.7a-7.9.0.i386.rpm é€‰è£…åŒ…ï¼šä¸€äº›åŠŸèƒ½æ€§æ‰©å±•çš„åŒ…å¯ä»¥é€‰æ‹©æ€§å®‰è£…ï¼Œä»¥å¢å¼º Samba çš„åŠŸèƒ½ï¼š # rpm -ivh redhat-config-samba-1.0.4-1.noarch.rpm# rpm -ivh samba-swat-2.2.7a-7.9.0.i386.rpm Red Hat 9.0 ä¸­ Samba çš„é»˜è®¤é…ç½® é…ç½®æ–‡ä»¶ï¼šSamba çš„ä¸»è¦é…ç½®æ–‡ä»¶ä½äº /etc/samba/smb.confã€‚ é»˜è®¤è®¾ç½®ï¼š å·¥ä½œç»„ï¼šMYGROUP å®‰å…¨ç­‰çº§ï¼šuserï¼ˆæ„å‘³ç€éœ€è¦ç”¨æˆ·è®¤è¯ï¼‰ å¯†ç åŠ å¯†è®¾ç½®ï¼šYesï¼ˆå¯ç”¨ç”¨æˆ·å¯†ç åŠ å¯†ï¼‰ å£ä»¤æ–‡ä»¶è·¯å¾„ï¼šetcsambasmbpasswdï¼ˆå­˜å‚¨ç”¨æˆ·å‡­è¯çš„æ–‡ä»¶ï¼‰ PAM è®¤è¯éµå¾ªï¼šYesï¼ˆè®¤è¯è¿‡ç¨‹éµå¾ª PAM ç®¡ç†ï¼‰ å®¢æˆ· DNS æŸ¥è¯¢ï¼šNoï¼ˆä¸å…è®¸ DNS æŸ¥è¯¢ï¼‰ ä¸»ç›®å½•å…±äº«ï¼šæ¯ä¸ªç”¨æˆ·çš„ä¸»ç›®å½•å‡è¢«å…±äº« æ‰“å°æœºå…±äº«ï¼šæ‰€æœ‰æ‰“å°æœºå‡å¯å…±äº« å»ºç«‹ Samba å¯†ç æ–‡ä»¶è®¾ç½® Samba è´¦æˆ· å»ºç«‹ Samba å¯†ç æ–‡ä»¶çš„å¿…è¦æ€§ï¼šå½“è®¾ç½®ç”¨æˆ·å¯†ç åŠ å¯†ä¸º Yes å’Œå®‰å…¨ç­‰çº§ä¸º user æ—¶ï¼Œéœ€å»ºç«‹å¯†ç æ–‡ä»¶ã€‚ æ·»åŠ  Samba è´¦æˆ·ï¼šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸ºç”¨æˆ·æ·»åŠ  Samba è´¦æˆ·ï¼š # smbpasswd -a username ä¿®æ”¹ Samba è´¦æˆ·å¯†ç ï¼š # smbpasswd username åˆ›å»ºç³»ç»Ÿè´¦æˆ·ï¼šå¦‚æœæŒ‡å®šçš„ Samba ç”¨æˆ·çš„ç³»ç»Ÿè´¦å·ä¸å­˜åœ¨ï¼Œéœ€å…ˆç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ ï¼š # useradd username æ£€æµ‹é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨ Samba æœåŠ¡å™¨ æ£€æµ‹é…ç½®æ–‡ä»¶ï¼šè¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ Samba é…ç½®æ–‡ä»¶çš„æ­£ç¡®æ€§ï¼š # testparm å¯åŠ¨å’Œç®¡ç† Samba æœåŠ¡ï¼šRed Hat çš„ Samba é€šå¸¸ä»¥ç‹¬ç«‹æœåŠ¡çš„æ–¹å¼è¿è¡Œï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ã€åœæ­¢æˆ–é‡å¯ Samba æœåŠ¡ï¼š # service smb start# service smb stop# service smb restart ä»å®¢æˆ·æœºè®¿é—® Samba å…±äº« æ£€æŸ¥ Samba æœåŠ¡å™¨èµ„æºï¼šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å…±äº«èµ„æºï¼š # smbclient -L IP -U username è®¿é—®å…±äº«ï¼šå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ä½¿ç”¨ smbclient è®¿é—®å…±äº«èµ„æºï¼š smbclient //NetBIOSåæˆ–IPåœ°å€/å…±äº«å -U ç”¨æˆ·å æŒ‚è½½å…±äº«ï¼šä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å°†å…±äº«æŒ‚è½½åˆ°æœ¬åœ°ç›®å½•ï¼š smbmount //IP/share /æŒ‚è½½ç‚¹ -o username=ç”¨æˆ·å æ³¨æ„äº‹é¡¹ï¼š å½“è®¿é—® Windows å…±äº«æ—¶ï¼Œsmbclient å‘½ä»¤çš„ -U é€‰é¡¹åæŒ‡å®šçš„ username éœ€è¦æ˜¯ Windows è®¡ç®—æœºä¸­çš„ç”¨æˆ·è´¦æˆ·ï¼ŒéªŒè¯å£ä»¤ä¸ºè¯¥ Windows è´¦æˆ·çš„å£ä»¤ã€‚ å½“è®¿é—® Linux çš„ Samba å…±äº«æ—¶ï¼Œsmbclient çš„ -U é€‰é¡¹åæŒ‡å®šçš„ username åº”ä¸º Linux è®¡ç®—æœºä¸­ Samba ç”¨æˆ·è´¦æˆ·ï¼ŒéªŒè¯å£ä»¤ä¸ºè¯¥ Samba è´¦æˆ·çš„å£ä»¤ã€‚ Samba é…ç½®åŸºç¡€ï¼smb.conf æ–‡ä»¶çš„ç»“æ„ smb.conf æ–‡ä»¶ç»“æ„ï¼šè¯¥æ–‡ä»¶é‡‡ç”¨åˆ†èŠ‚çš„ç»“æ„ï¼Œç±»ä¼¼äº Windows ä¸­çš„.INI æ–‡ä»¶ï¼Œæ–¹ä¾¿ç”¨æˆ·è¿›è¡Œé…ç½®å’Œç®¡ç†ã€‚ ä¸»è¦èŠ‚å†…å®¹ï¼š [Userdefined_ShareName]ï¼šç”¨æˆ·è‡ªå®šä¹‰çš„å…±äº«åç§°ï¼Œå¯ä»¥æœ‰å¤šä¸ªå…±äº«å®šä¹‰ã€‚ [Printers]ï¼šç”¨äºé…ç½®æ‰“å°æœºå…±äº«ã€‚ [Homes]ï¼šç”¨äºå®šä¹‰æ¯ä¸ªç”¨æˆ·çš„ Home ç›®å½•å…±äº«ã€‚ [Global]ï¼šç”¨äºé…ç½®å…¨å±€å‚æ•°å’Œç¼ºçœå€¼ã€‚ é…ç½® Samba æ–‡ä»¶å…±äº«ä¸¾ä¾‹ ä¸ºæ‰€æœ‰ç”¨æˆ·é…ç½®åªè¯»å…±äº«ï¼šå¯ä»¥è®¾ç½®å…±äº«ç›®å½•çš„æƒé™ä¸ºåªè¯»ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šè¢«ä¿®æ”¹ã€‚ ä¸ºæ‰€æœ‰ç”¨æˆ·é…ç½®è¯»å†™å…±äº«ï¼šå…è®¸ç”¨æˆ·å¯¹å…±äº«æ–‡ä»¶äº«æœ‰è¯»å’Œå†™çš„æƒé™ï¼Œé€‚åˆéœ€è¦åä½œç¼–è¾‘çš„åœºæ™¯ã€‚ ä¸ºæŒ‡å®šç”¨æˆ·é…ç½® Samba å…±äº«ï¼šå¯ä»¥ä¸ºç‰¹å®šç”¨æˆ·è®¾ç½®è®¿é—®æƒé™ï¼Œåªæœ‰è¯¥ç”¨æˆ·å¯ä»¥è®¿é—®æŒ‡å®šçš„å…±äº«ç›®å½•ã€‚ ä¸ºæŒ‡å®šç»„é…ç½® Samba å…±äº«ï¼šé€šè¿‡ç»„æƒé™ç®¡ç†ï¼Œå®ç°å¯¹å¤šä¸ªç”¨æˆ·çš„ç»Ÿä¸€ç®¡ç†ã€‚ ä¸ºæŒ‡å®šç”¨æˆ·å’Œç»„é…ç½® Samba å…±äº«ï¼šç»“åˆç”¨æˆ·ä¸ç»„æƒé™ï¼Œå®ç°æ›´åŠ çµæ´»çš„å…±äº«ç­–ç•¥ã€‚ é…ç½®è®¿é—® Samba å…±äº«ç»„ç”¨æˆ·çš„ä¸åŒæƒé™ï¼šé€šè¿‡ç»†ç²’åº¦çš„æƒé™è®¾ç½®ï¼Œç¡®ä¿æ¯ä¸ªç”¨æˆ·åœ¨å…±äº«ä¸­çš„æƒé™åˆ¶è¡¡ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç½‘ç»œ"]},{"title":"tcpdumpæŠ“åŒ…","path":"/2024/12/02/1-å¹³å°ç³»ç»Ÿ-Linux-ç½‘ç»œ-tcpdumpæŠ“åŒ…/","content":"Linux ç¯å¢ƒä¸‹æŠ“åŒ…å·¥å…·çš„ä½¿ç”¨1. Tcpdump å·¥å…·çš„ä»‹ç»Tcpdump æ˜¯ä¸€ç§ç”¨äºåˆ†æç½‘ç»œæµé‡çš„å¼ºå¤§å‘½ä»¤è¡Œå·¥å…·ã€‚åœ¨ Linux ç¯å¢ƒä¸­ï¼Œå®ƒä¸ºç½‘ç»œç®¡ç†å‘˜å’Œå¼€å‘äººå‘˜æä¾›äº†ç›‘æ§å’Œè°ƒè¯•åŠŸèƒ½ã€‚Tcpdump çš„åŸºæœ¬å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š tcpdump [ -adeflnNOpqStvx ] [ -c æ•°é‡ ] [ -F æ–‡ä»¶å ] [ -i ç½‘ç»œæ¥å£ ] [ -r æ–‡ä»¶å] [ -s snaplen ] [ -T ç±»å‹ ] [ -w æ–‡ä»¶å ] [è¡¨è¾¾å¼] 2. Tcpdump çš„é€‰é¡¹ä»‹ç»Tcpdump æä¾›å¤šç§é€‰é¡¹ï¼Œå¯ä»¥çµæ´»æ§åˆ¶æŠ“åŒ…è¡Œä¸ºï¼Œä¸‹é¢æ˜¯ä¸€äº›ä¸»è¦é€‰é¡¹ï¼š -a: å°†ç½‘ç»œåœ°å€å’Œå¹¿æ’­åœ°å€è½¬æ¢ä¸ºå¯è¯»çš„åç§°ï¼Œä¾¿äºç†è§£ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°† IP åœ°å€è½¬æ¢ä¸ºä¸»æœºåã€‚ -d: ä»¥äººç±»å¯è¯»çš„æ±‡ç¼–ä»£ç æ ¼å¼æ˜¾ç¤ºåŒ¹é…çš„æ•°æ®åŒ…çš„ä¿¡æ¯ï¼Œä¾¿äºå¼€å‘è€…ç†è§£æ•°æ®åŒ…çš„ä½œç”¨ã€‚ -dd: è¾“å‡º C è¯­è¨€ç¨‹åºæ®µçš„å½¢å¼ï¼Œè¿™å¯¹äºéœ€è¦è¿›ä¸€æ­¥ç¼–ç¨‹åˆ†æçš„ç”¨æˆ·éå¸¸æœ‰æ•ˆã€‚ -ddd: æ˜¾ç¤ºåŒ¹é…ä¿¡æ¯åŒ…çš„åè¿›åˆ¶æ ¼å¼ï¼Œå¯¹äºåŸå§‹æ•°æ®å¤„ç†éå¸¸å®ç”¨ã€‚ -e: åœ¨è¾“å‡ºä¸­åŒ…å«æ•°æ®é“¾è·¯å±‚çš„å¤´éƒ¨ä¿¡æ¯ï¼Œæä¾›æ›´ä½å±‚æ¬¡çš„æ•°æ®ç»†èŠ‚ã€‚ -n: ä¸å°†ç½‘ç»œåœ°å€è½¬æ¢ä¸ºåç§°ï¼Œä»è€Œæé«˜æ•è·é€Ÿåº¦ï¼Œé€‚åˆå¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚ -v: æä¾›æ¯”é»˜è®¤æ›´è¯¦ç»†çš„è¾“å‡ºä¿¡æ¯ï¼Œä¾‹å¦‚ TTLï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰å’ŒæœåŠ¡ç±»å‹ã€‚ -w: å°†æ•è·çš„æ•°æ®åŒ…ç›´æ¥å†™å…¥æ–‡ä»¶ï¼Œä¾¿äºåç»­åˆ†æã€‚ è¡¨è¾¾å¼Tcpdump çš„ç­›é€‰è¡¨è¾¾å¼å¯åˆ†ä¸ºä¸‰ç±»ï¼š ç±»å‹çš„å…³é”®å­—: host 210.27.48.2: æŒ‡å®šæŸä¸€ä¸»æœºçš„æµé‡ã€‚ net 202.0.0.0: æŒ‡å®šæŸä¸€ç½‘ç»œçš„æ‰€æœ‰æµé‡ã€‚ port 23: æŒ‡å®šæŸä¸€ç‰¹å®šç«¯å£çš„æµé‡ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸æŒ‡å®šç±»å‹æ—¶å°†ä½¿ç”¨ hostã€‚ ä¼ è¾“æ–¹å‘çš„å…³é”®å­—: src 210.27.48.2: æŒ‡å®šæºåœ°å€ä¸ºè¯¥ IP çš„æ•°æ®åŒ…ã€‚ dst net 202.0.0.0: æŒ‡å®šç›®çš„åœ°å€ä¸ºè¯¥ç½‘ç»œçš„æ•°æ®åŒ…ã€‚ ä¼ è¾“æ–¹å‘å…³é”®å­—çš„ç»„åˆå¯ç”¨äºçµæ´»è¿‡æ»¤æ•°æ®åŒ…ã€‚ åè®®çš„å…³é”®å­—: tcp, udp, arp, ip ç­‰ï¼šç”¨äºæŒ‡å®šåè®®ç±»å‹ï¼ŒæŠ“å–ç‰¹å®šåè®®çš„æ•°æ®åŒ…ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸æŒ‡å®šåè®®ï¼ŒTcpdump å°†ç›‘å¬æ‰€æœ‰åè®®çš„æ•°æ®åŒ…ã€‚ é€»è¾‘è¿ç®—Tcpdump æ”¯æŒä¸‰ç§é€»è¾‘è¿ç®—ç¬¦ï¼Œç”¨äºæ„å»ºå¤æ‚çš„æŠ“åŒ…æ¡ä»¶ï¼š NOT: ä½¿ç”¨ not æˆ– ! è¿›è¡Œå–åã€‚ AND: ä½¿ç”¨ and æˆ– è¿æ¥å¤šä¸ªæ¡ä»¶ã€‚ OR: ä½¿ç”¨ or æˆ– || è¾¾æˆé€»è¾‘æˆ–çš„æ•ˆæœã€‚ ç¤ºä¾‹å‘½ä»¤ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº† Tcpdump çš„å…·ä½“ç”¨æ³•ï¼š å¯åŠ¨ Tcpdump ç›‘å¬æ‰€æœ‰æ•°æ®åŒ…: tcpdump æŒ‡å®šç½‘å¡ç›‘å¬: tcpdump -i eth0 æ ¹æ®ä¸»æœºæˆªè·æ•°æ®: tcpdump host 210.27.48.1 æˆªè·å’Œä¸¤å°ä¸»æœºä¹‹é—´çš„é€šä¿¡: tcpdump host 210.27.48.1 and (host 210.27.48.2 or host 210.27.48.3) è·å– IP åŒ…ï¼Œæ’é™¤ç‰¹å®šä¸»æœº: tcpdump ip host 210.27.48.1 and not 210.27.48.2 ç›‘æ§ Telnet æµé‡: tcpdump tcp port 23 host 210.27.48.1 ç›‘æ§ NTP æœåŠ¡æµé‡: tcpdump udp port 123 é€šè¿‡ç½‘å…³ç›‘æ§æ•°æ®åŒ…: tcpdump -i eth0 gateway Gatewayname æŠ“å–åˆ°ç‰¹å®šç«¯å£çš„ TCP æˆ– UDP æ•°æ®åŒ…: tcpdump -i eth0 host hostname and port 80 æ•°æ®åŒ…æ•è·çš„æ³¨æ„äº‹é¡¹åœ¨ä½¿ç”¨ Tcpdump æ—¶ï¼Œåº”æ³¨æ„ç³»ç»Ÿçš„å­˜å‚¨ç©ºé—´ï¼Œä»¥é˜²æ•°æ®åŒ…è¶…è¿‡ç¡¬ç›˜å®¹é‡ã€‚æ­¤å¤–ï¼Œå¦‚æœéœ€è¦åˆ†ææ•è·çš„æ•°æ®åŒ…ï¼Œå»ºè®®ä½¿ç”¨ -w å‚æ•°å°†æ•°æ®åŒ…ä¿å­˜åˆ°æ–‡ä»¶ï¼Œç„¶åå€ŸåŠ©å…¶ä»–å·¥å…·è¿›è¡Œæ·±å…¥åˆ†æã€‚ ä¾‹å¦‚ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†æŠ“å–çš„æ•°æ®åŒ…ä¿å­˜ä¸ºæ–‡ä»¶ï¼š tcpdump -w captured_packets.pcap ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ Wireshark ç­‰å·¥å…·å¯¹æ–‡ä»¶è¿›è¡Œè¯¦ç»†è§£ç åˆ†æã€‚ é€šè¿‡é€‚å½“åœ°ä½¿ç”¨ Tcpdump çš„å„ç§åŠŸèƒ½ï¼Œå¯ä»¥é«˜æ•ˆã€å‡†ç¡®åœ°å¯¹ç½‘ç»œæµé‡è¿›è¡Œç›‘æ§å’Œè°ƒè¯•ï¼Œä¸ºç½‘ç»œå®‰å…¨å’Œæ€§èƒ½ä¼˜åŒ–æä¾›æ”¯æŒã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç½‘ç»œ"]},{"title":"å±€åŸŸç½‘æ‰«æ","path":"/2024/11/29/1-å¹³å°ç³»ç»Ÿ-Linux-ç½‘ç»œ-å±€åŸŸç½‘æ‰«æ/","content":"ä½¿ç”¨ Nmap è¿›è¡Œå±€åŸŸç½‘æ‰«æä½¿ç”¨ Nmap è¿›è¡Œå±€åŸŸç½‘æ‰«ææ˜¯ä¸€ç§å¸¸è§ä¸”æœ‰æ•ˆçš„æ–¹æ³•ï¼Œå¯ä»¥å¸®åŠ©ç¡®å®šç½‘ç»œä¸­æ´»è·ƒçš„è®¾å¤‡åŠå…¶ç›¸åº”çš„ MAC åœ°å€ã€‚è¿™ä¸€è¿‡ç¨‹æ¶‰åŠå¤šç§å‘½ä»¤ï¼Œç”¨äºä¸åŒç±»å‹çš„æ‰«æå’Œä¿¡æ¯æ”¶é›†ã€‚ åŸºç¡€æ‰«ææ­¥éª¤ å±€åŸŸç½‘æ‰«æ:ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æ‰«ææ•´ä¸ªå­ç½‘å¹¶æ‰“å°å‡ºå“åº”çš„ä¸»æœºï¼š nmap -sP 192.168.1.0/24 æ­¤å‘½ä»¤ä½¿ç”¨ -sP å‚æ•°è¿›è¡Œ ping æ‰«æï¼Œç›®æ ‡æ˜¯åœ¨æŒ‡å®šçš„å­ç½‘ï¼ˆ192.168.1.024ï¼‰ä¸­å¯»æ‰¾å­˜æ´»çš„ä¸»æœºã€‚è¿è¡Œè¿™æ¡å‘½ä»¤æ—¶ï¼Œéœ€è¦è¾“å…¥æ‰§è¡Œè¿™ä¸€æ“ä½œçš„ç”¨æˆ·çš„å¯†ç ã€‚ä»¥ä¸‹æ˜¯å‘½ä»¤æ‰§è¡Œåç”Ÿæˆçš„æŠ¥å‘Šç¤ºä¾‹ï¼š Nmap scan report for promote.cache-dns.local (192.168.1.1)Host is up (0.066s latency).MAC Address: A8:57:4E:A7:53:F8 (Unknown) ä»è¾“å‡ºç»“æœå¯ä»¥çœ‹åˆ°ï¼Œnmap æŠ¥å‘Šäº†å¤šä¸ª IP åœ°å€ä»¥åŠå¯¹åº”çš„ MAC åœ°å€å’Œå»¶è¿Ÿã€‚ä¾‹å¦‚ï¼ŒIP åœ°å€ 192.168.1.1 æ˜¯æ´»åŠ¨çš„ï¼Œå»¶è¿Ÿä¸º 0.066 ç§’ï¼Œè€Œå…¶ MAC åœ°å€ä¸º A8:57:4E:A7:53:F8ã€‚æœ‰äº›è®¾å¤‡çš„åˆ¶é€ å•†ä¿¡æ¯ä¹Ÿå¯ä»¥è¢«è¯†åˆ«å‡ºæ¥ï¼Œä¾‹å¦‚ï¼š Nmap scan report for promote.cache-dns.local (192.168.1.100)Host is up (0.91s latency).MAC Address: 90:4C:E5:C6:92:71 (Hon Hai Precision Ind. Co.) è¿™é‡Œï¼ŒHon Hai Precision Ind. Co. æ˜¯è®¾å¤‡çš„åˆ¶é€ å•†ã€‚æœ€ç»ˆæŠ¥å‘Šæ˜¾ç¤ºï¼Œæ€»å…±æ‰«æäº† 256 ä¸ª IP åœ°å€ï¼Œå…¶ä¸­æœ‰ 7 å°è®¾å¤‡å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œè€—æ—¶çº¦ 15.85 ç§’ã€‚ å¯ä»¥é€šè¿‡ç®¡é“å°†è¾“å‡ºç»“æœä¸ grep ç»“åˆï¼Œä»¥è¿‡æ»¤å‡ºå­˜æ´»çš„ä¸»æœºï¼Œä¾‹å¦‚ï¼š nmap -sP 192.168.1.0/24 | grep up è¿™å°†åªè¿”å›çŠ¶æ€ä¸ºâ€œupâ€çš„ä¸»æœºï¼Œæœ‰åŠ©äºå¿«é€Ÿè¯†åˆ«æ´»åŠ¨è®¾å¤‡ã€‚ åˆ—å‡ºä¸»æœº:å¦‚æœæƒ³ä»…åˆ—å‡ºç½‘ç»œä¸­çš„æ‰€æœ‰ä¸»æœºï¼Œè€Œä¸å‘é€ä»»ä½•æŠ¥æ–‡åˆ°ç›®æ ‡ä¸»æœºï¼Œå¯ä»¥ä½¿ç”¨ï¼š nmap -sL 192.168.1.0/24 ç«¯å£æ‰«æ:ä¸ºäº†æ¢æµ‹ç›®æ ‡ä¸»æœºå¼€æ”¾çš„ç‰¹å®šç«¯å£ï¼Œå¯ä»¥æŒ‡å®šç«¯å£åˆ—è¡¨ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š nmap -PS 192.168.1.234 -p 22,23,25,80 è¯¥å‘½ä»¤ä¼šæ¢æµ‹ IP ä¸º 192.168.1.234 çš„ä¸»æœºæ˜¯å¦å¼€æ”¾äº† 22ã€23ã€25 å’Œ 80 ç«¯å£ã€‚-PS è¡¨ç¤ºä½¿ç”¨ TCP SYN åŒ…è¿›è¡Œæ¢æµ‹ã€‚ UDP æ¢æµ‹:ä½¿ç”¨ UDP ping æ¢æµ‹ä¸»æœºçš„å‘½ä»¤å¦‚ä¸‹ï¼š nmap -PU 192.168.1.0/24 UDP æ¢æµ‹èƒ½å¤Ÿè¯†åˆ«å‡ºé‚£äº›æœªå“åº” TCP è¯·æ±‚çš„è®¾å¤‡ã€‚ åŠå¼€æ”¾æ‰«æ:åŒæ ·å¸¸ç”¨çš„è¿˜æœ‰å£°ç§°ä¸º SYN æ‰«æçš„åŠå¼€æ”¾æ‰«æã€‚è¿™ç§æ‰«ææ–¹å¼ä¸ä¼šå®Œæˆ TCP ä¸‰æ¬¡æ¡æ‰‹ï¼Œå› æ­¤æ‰§è¡Œé€Ÿåº¦éå¸¸å¿«ï¼š nmap -sS 192.168.1.0/24 ARP ç¼“å­˜æŸ¥çœ‹åœ¨æ‰§è¡Œå®Œæ‰«æåï¼Œå¯ä»¥æŸ¥çœ‹ ARP ç¼“å­˜è¡¨ï¼Œä»¥è·å– IP åœ°å€å¯¹åº”çš„ MAC åœ°å€ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š cat /proc/net/arp æ­¤æ—¶æ˜¾ç¤ºçš„è¡¨æ ¼å°†æä¾›å·²çŸ¥ä¸»æœºçš„ IP å’Œç›¸åº”çš„ MAC åœ°å€ã€‚ Nmap åœ¨ Linux ä¸­çš„ä½¿ç”¨å®‰è£… Nmapåœ¨ CentOS ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£… Nmapï¼š yum install nmap å¸¸ç”¨æ‰«æå‘½ä»¤ç¤ºä¾‹ä»¥ä¸‹æ˜¯å‡ ç§å¸¸ç”¨çš„ Nmap æ‰«æä¸¾ä¾‹ï¼š é’ˆå¯¹ C æ®µå­˜æ´»ä¸»æœºçš„æ¢æµ‹: nmap -sP 1.1.1.1/24 SYN æ‰«ææŒ‡å®šç«¯å£:è¿™å°†æ‰«ææŒ‡å®š IP èŒƒå›´å†…çš„ç«¯å£ 80ï¼š nmap -sS 1.1.1.1-30 -p 80 ç«¯å£æœåŠ¡åŠç‰ˆæœ¬æ¢æµ‹:æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯æ‰«ææ‰€æœ‰ 1 è‡³ 65535 ç«¯å£ï¼ŒæŠ“å–æœåŠ¡ç‰ˆæœ¬ä¿¡æ¯ï¼š nmap -sV 1.1.1.1 -p 1-65535 æ“ä½œç³»ç»Ÿæ¢æµ‹:ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æ¢æµ‹æ“ä½œç³»ç»Ÿç±»å‹å’Œç‰ˆæœ¬ï¼š nmap -O 1.1.1.1 æˆ–ä½¿ç”¨ï¼š nmap -A 1.1.1.1 åè€…ä¸ä»…æ¢æµ‹æ“ä½œç³»ç»Ÿï¼Œè¿˜ä¼šè¿›è¡ŒæœåŠ¡ç‰ˆæœ¬ã€è„šæœ¬æ‰«æç­‰å…¨é¢ä¿¡æ¯æ”¶é›†ã€‚ ä½¿ç”¨ shell è„šæœ¬ç¼–å†™ shell è„šæœ¬æ˜¯ä¸€ç§æœ‰æ•ˆçš„æ–¹æ³•ï¼Œå¯ä»¥æ‰¹é‡å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œç‰¹åˆ«æ˜¯ç½‘ç»œæ‰«æã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„è„šæœ¬ ip_disc.shï¼Œå®ƒé€šè¿‡å‘é€ ping è¯·æ±‚æ¥æ£€æŸ¥ç‰¹å®šå­ç½‘ä¸­çš„è®¾å¤‡æ˜¯å¦åœ¨çº¿ï¼š $ cat ip_disc.sh#!/bin/bashfor i in `seq 1 254`doping -c5 192.168.1.$i /dev/null echo 192.168.1.$i is alivedonewait è¿™ä¸ªè„šæœ¬ä½¿ç”¨ for å¾ªç¯éå† 1 åˆ° 254 çš„æ‰€æœ‰ IP åœ°å€ã€‚å¯¹äºæ¯ä¸ªåœ°å€ï¼Œå®ƒæ‰§è¡Œ ping å‘½ä»¤ï¼Œå‘é€ 5 ä¸ªåŒ…ï¼ˆ-c5ï¼‰ï¼Œå¹¶å°†è¾“å‡ºé‡å®šå‘åˆ° /dev/null ä»¥é¿å…å¹²æ‰°ã€‚åœ¨ ping æˆåŠŸåï¼Œè„šæœ¬ä¼šè¾“å‡ºç›¸åº”çš„ IP åœ°å€ï¼Œè¡¨ç¤ºè¯¥è®¾å¤‡æ˜¯å­˜æ´»çš„ã€‚åœ¨è„šæœ¬çš„ç»“å°¾ï¼Œwait å‘½ä»¤ç¡®ä¿æ‰€æœ‰åå°è¿›ç¨‹å®Œæˆåå†ç»“æŸæ‰§è¡Œã€‚ æ‰§è¡Œè¯¥è„šæœ¬åï¼Œè¾“å‡ºç»“æœå¯èƒ½å¦‚ä¸‹ï¼š $ ./ip_disc.sh192.168.1.113 is alive192.168.1.111 is alive192.168.1.1 is alive192.168.1.114 is alive192.168.1.110 is alive192.168.1.100 is alive192.168.1.105 is alive192.168.1.122 is alive è¿™æ ·ï¼Œè„šæœ¬æˆåŠŸè¯†åˆ«äº†å¤šä¸ªæœ‰æ•ˆçš„è®¾å¤‡ IP åœ°å€ï¼Œä¾¿äºç®¡ç†å‘˜è¿›è¡Œåç»­çš„ç½‘ç»œç®¡ç†å’Œæ•…éšœæ’æŸ¥ã€‚ Nmap æ¦‚è¿°Nmapï¼ˆç½‘ç»œæ˜ å°„å·¥å…·ï¼‰æ”¯æŒå¤šç§æ‰«ææŠ€æœ¯ï¼Œèƒ½å¤Ÿæœ‰æ•ˆæ¢æµ‹ç½‘ç»œä¸­çš„è®¾å¤‡ä¸æœåŠ¡ã€‚è¿™äº›æŠ€æœ¯åŒ…æ‹¬ï¼š UDP æ‰«æ TCP connect()æ‰«æ TCP SYNï¼ˆåŠå¼€æ‰«æï¼‰ FTP ä»£ç†ï¼ˆBounce æ”»å‡»ï¼‰ åå‘æ ‡å¿—æ‰«æ ICMP æ‰«æ FIN æ‰«æ ACK æ‰«æ åœ£è¯æ ‘ï¼ˆXmas Treeï¼‰æ‰«æ Null æ‰«æ æ­¤å¤–ï¼ŒNmap è¿˜æä¾›äº†ä¸€äº›é«˜çº§ç‰¹æ€§ï¼ŒåŒ…æ‹¬ï¼š æ“ä½œç³»ç»Ÿæ¢æµ‹ï¼šæ ¹æ® TCPIP åè®®æ ˆçš„ç‰¹å¾è¯†åˆ«ä¸»æœºæ“ä½œç³»ç»Ÿç±»å‹ã€‚ ç§˜å¯†æ‰«æï¼šéšè”½æ–¹å¼æ¢æµ‹æœåŠ¡ã€‚ åŠ¨æ€å»¶æ—¶ä¸é‡ä¼ è®¡ç®—ï¼šä¼˜åŒ–æ¢æµ‹æ–¹æ³•ã€‚ å¹¶è¡Œæ‰«æï¼šåŒæ—¶æ¢æµ‹å¤šä¸ªä¸»æœºã€‚ è¯±é¥µæ‰«æï¼šé€šè¿‡ä¼ªè£…è¯·æ±‚ç»•è¿‡é˜²ç«å¢™æ£€æµ‹ã€‚ ç›´æ¥ RPC æ‰«æï¼šæ— éœ€è¿›è¡Œç«¯å£æ˜ å°„ã€‚ ç¢ç‰‡æ‰«æï¼šåˆ†æ®µæ•°æ®åŒ…ä¼ è¾“ï¼Œä»¥è§„é¿æŸäº›ç±»å‹çš„ç›‘æ§ã€‚ Nmap é€šå¸¸ä¼šè¿”å›çŸ¥åç«¯å£çš„æœåŠ¡åç§°ã€ç«¯å£å·ã€çŠ¶æ€å’Œåè®®ç­‰ä¿¡æ¯ã€‚ç«¯å£çš„å¯èƒ½çŠ¶æ€åŒ…æ‹¬ï¼š openï¼šè¡¨ç¤ºç›®æ ‡ä¸»æœºçš„ç«¯å£å¯è¢«è¿æ¥ã€‚ filteredï¼šé˜²ç«å¢™æˆ–åŒ…è¿‡æ»¤å™¨é˜»æ­¢ Nmap æ¢æµ‹è¯¥ç«¯å£çŠ¶æ€ã€‚ unfilteredï¼šç«¯å£å…³é—­ï¼Œä½†æœªå—åˆ°é˜²ç«å¢™çš„é˜»éš”ã€‚ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæœªè¢«è¿‡æ»¤çš„ç«¯å£ä¼šå‘ˆç°ä¸º unfiltered çŠ¶æ€ï¼Œä½†å¦‚æœå¤§å¤šæ•°ç«¯å£å—é™ï¼Œåˆ™è¯¥çŠ¶æ€çš„ç«¯å£æ‰ä¼šè¢«æŠ¥å‘Šã€‚ æ­¤å¤–ï¼ŒNmap è¿˜å¯ä»¥æŠ¥å‘Šå…¶ä»–è¯¸å¦‚æ“ä½œç³»ç»Ÿã€TCP åºåˆ—ã€è¿è¡Œåœ¨æ¯ä¸ªç«¯å£ä¸Šçš„åº”ç”¨ç¨‹åºçš„ç”¨æˆ·åã€DNS åã€ä¸»æœºåœ°å€ç­‰ä¿¡æ¯ã€‚å¯ä»¥ä½¿ç”¨å‘½ä»¤ nmap -h å¿«é€ŸæŸ¥çœ‹æ‰€æœ‰åŠŸèƒ½é€‰é¡¹çš„åˆ—è¡¨ã€‚ Nmap è¯­æ³•Nmap çš„åŸºæœ¬æ‰«æå‘½ä»¤ç»“æ„ä¸ºï¼š nmap [Scan Type(s)] [Options] æ‰«æç±»å‹-sTTCP connect()æ‰«æï¼šè¿™æ˜¯æœ€åŸºç¡€çš„ TCP æ‰«ææ–¹å¼ã€‚é€šè¿‡æ“ä½œç³»ç»Ÿæä¾›çš„ connect()ç³»ç»Ÿè°ƒç”¨æ‰“å¼€è¿æ¥ã€‚å¦‚æœç›®æ ‡ç«¯å£ä¸Šæœ‰ç¨‹åºç›‘å¬ï¼Œconnect()å°±ä¼šæˆåŠŸè¿”å›ï¼Œå¦åˆ™å°†æŠ¥å‘Šè¯¥ç«¯å£ä¸å¯è¾¾ã€‚æ­¤æ–¹æ³•çš„ä¸€ä¸ªæ˜æ˜¾ä¼˜ç‚¹æ˜¯ï¼Œä¸éœ€è¦ root æƒé™ï¼Œä»»æ„ UNIX ç”¨æˆ·å‡å¯ä½¿ç”¨ã€‚ç„¶è€Œï¼Œå› ä¸ºä¼šåœ¨ç›®æ ‡ä¸»æœºçš„æ—¥å¿—ä¸­ç•™ä¸‹è¿æ¥è¯·æ±‚çš„ç—•è¿¹ï¼Œè¿™ç§æ‰«ææ–¹å¼å®¹æ˜“è¢«ç›‘æµ‹åˆ°ã€‚ -sSTCP SYN æ‰«æï¼šæ­¤ç±»æ‰«æè¢«ç§°ä¸ºåŠå¼€æ‰«æï¼ˆhalf-openï¼‰ï¼Œå› ä¸ºå®ƒå‘é€ä¸€ä¸ª TCP SYN åŒ…ã€‚ä½†åªæœ‰æ”¶åˆ°çš„å“åº”ä¼šè¢«è®°å½•ï¼šå¦‚æœå¯¹æ–¹è¿”å› SYN|ACK åŒ…ï¼Œè¡¨ç¤ºç›®æ ‡ç«¯å£æ­£åœ¨ç›‘å¬ï¼›å¦‚æœè¿”å› RST åŒ…ï¼Œåˆ™è¡¨æ˜æ²¡æœ‰ç¨‹åºåœ¨ç›‘å¬ã€‚æ“ä½œç³»ç»Ÿå†…æ ¸ä¼šè‡ªåŠ¨å‘é€ RST åŒ…ä»¥æ–­å¼€è¿æ¥ï¼Œä¸ä¼šè¢«è®°å½•åˆ°æ—¥å¿—ã€‚è¿™ç§æŠ€æœ¯è™½ç„¶éšè”½ï¼Œä½†éœ€è¦ root æƒé™ä»¥å‘é€è‡ªå®šä¹‰ SYN åŒ…ã€‚ -sF, -sX, -sNç§˜å¯† FIN æ•°æ®åŒ…æ‰«æã€åœ£è¯æ ‘ï¼ˆXmas Treeï¼‰æ‰«æã€Null æ‰«æï¼šè¿™äº›æ‰«ææ–¹å¼åœ¨ä½¿ç”¨ SYN æ‰«ææœªæœæ—¶ï¼Œä½œä¸ºé«˜çº§æ‰‹æ®µè¿›è¡Œæ¢æµ‹ã€‚å®ƒä»¬åˆ©ç”¨äº†ä»¥ä¸‹åŸç†ï¼šå…³é—­çš„ç«¯å£éœ€è¦å¯¹æ¢æµ‹åŒ…è¿”å› RST åŒ…ï¼Œè€Œå¼€æ”¾çš„ç«¯å£ä¼šé€‰æ‹©å¿½ç•¥è¿™äº›å¼‚å¸¸åŒ…ï¼ˆå‚è€ƒ RFC 793 ç¬¬ 64 é¡µï¼‰ã€‚FIN æ‰«æå‘é€ FIN åŒ…ï¼Œè€Œåœ£è¯æ ‘æ‰«æåˆ™æ‰“å¼€ FINã€URG å’Œ PUSH æ ‡å¿—ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒWindows ç³»ç»Ÿä¸å®Œå…¨éµå¾ªæ­¤æ ‡å‡†ï¼Œå› æ­¤è¿™äº›æ‰«æåœ¨ Windows å¹³å°ä¸Šå¾€å¾€æ— æ•ˆã€‚ -sPPing æ‰«æï¼šä¸ºç¡®è®¤ç½‘ç»œä¸­çš„æ´»è·ƒä¸»æœºï¼ŒNmap ä¼šå‘æ¯ä¸ª IP åœ°å€å‘é€ ICMP echo è¯·æ±‚ã€‚è‹¥ç›®æ ‡ä¸»æœºæ­£å¸¸è¿è¡Œï¼Œå®ƒå°†å“åº”è¯·æ±‚ã€‚ç„¶è€Œï¼Œä¸€äº›åŸŸåï¼ˆå¦‚ microsoft.comï¼‰å¯èƒ½é˜»æ­¢ ICMP è¯·æ±‚ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼ŒNmap è¿˜ä¼šå°è¯•å‘ 80 ç«¯å£å‘é€ TCP ACK åŒ…ä»¥è·å–å“åº”ã€‚å¸¸è§„ä¸Šï¼Œå¯¹äºé root ç”¨æˆ·ï¼ŒNmap å°†ä½¿ç”¨ connect()æ–¹æ³•è¿›è¡Œæ¢æµ‹ã€‚ ä»¥é»˜è®¤è®¾ç½®ï¼ˆroot ç”¨æˆ·ï¼‰ï¼ŒNmap å°†å¹¶è¡Œä½¿ç”¨ ICMP ä¸ ACK æŠ€æœ¯è¿›è¡Œæ¢æµ‹ã€‚ä»…åœ¨ä¸»æœºå¤„äºè¿è¡ŒçŠ¶æ€æ—¶ï¼ŒNmap æ‰ä¼šè¿›è¡Œåç»­æ‰«æã€‚ -sUUDP æ‰«æï¼šè‹¥éœ€äº†è§£ä¸»æœºå¼€æ”¾çš„ UDP æœåŠ¡ï¼ŒNmap ä¼šå‘æ¯ä¸ª UDP ç«¯å£å‘é€ä¸€ä¸ª 0 å­—èŠ‚åŒ…ã€‚è‹¥æ¥æ”¶åˆ°ç«¯å£ä¸å¯è¾¾çš„ ICMP æ¶ˆæ¯ï¼Œåˆ™è®¤ä¸ºè¯¥ç«¯å£å…³é—­ï¼›å¦åˆ™å‡è®¾ä¸ºå¼€æ”¾ã€‚UDP æœåŠ¡å¦‚ SNMPã€TFTPã€NFS ç­‰å‡åŸºäº UDP åè®®ã€‚UDP æ‰«æå¯èƒ½è¾ƒæ…¢ï¼Œå› ä¸ºè®¸å¤šä¸»æœºå¯¹ ICMP é”™è¯¯æ¶ˆæ¯çš„è¿”å›é¢‘ç‡æœ‰æ‰€é™åˆ¶ã€‚ä¾‹å¦‚ï¼ŒLinux ç³»ç»Ÿæ¯ 4 ç§’è¿”å›ä¸è¶…è¿‡ 80 æ¡ ICMP ä¸å¯è¾¾æ¶ˆæ¯ï¼Œè€Œ Solaris æ¯ç§’ä»…å…è®¸å¤§çº¦ 2 æ¡ï¼Œè¿™å¯¼è‡´ UDP æ‰«æå˜å¾—æ…¢ï¼Œè€Œå¯¹äº Windows ç³»ç»Ÿåˆ™æ²¡æœ‰æ­¤é™åˆ¶ã€‚ -sAACK æ‰«æï¼šè¿™é¡¹é«˜çº§æ‰«ææŠ€æœ¯å¸®åŠ©ç©¿é€é˜²ç«å¢™ï¼Œé€šå¸¸ç”¨äºåˆ¤æ–­é˜²ç«å¢™çš„å¤æ‚ç¨‹åº¦ã€‚å‘ç‰¹å®šç«¯å£å‘é€ ACK åŒ…, è‹¥è¿”å› RST åŒ…ï¼Œåˆ™æ ‡è®°ä¸º unfiltered çŠ¶æ€ï¼›è‹¥æ— å“åº”æˆ–æ”¶åˆ°ä¸å¯è¾¾çš„ ICMP æ¶ˆæ¯ï¼Œåˆ™æ ‡è®°ä¸º filtered çŠ¶æ€ã€‚ -sWæ»‘åŠ¨çª—å£æ‰«æï¼šè¯¥æŠ€æœ¯ä¸ ACK æ‰«æç›¸ä¼¼ï¼Œä½†æœ‰æ—¶å¯ä»¥è¯†åˆ«å¼€æ”¾ç«¯å£ï¼Œå› ä¸ºæŸäº›æ“ä½œç³»ç»Ÿå¯æŠ¥å‘Šå…¶æ»‘åŠ¨çª—å£çš„å¤§å°ã€‚è¿™ç§æ–¹æ³•é€‚ç”¨äºå¤šç§æ“ä½œç³»ç»Ÿï¼Œä¸€äº›å¦‚ AIX å’Œ OpenBSD ç­‰ã€‚ -sRRPC æ‰«æï¼šæ­¤æ–¹æ³•ä¸å…¶ä»–æ‰«æç»“åˆï¼Œå‘æ‰€æœ‰å¼€æ”¾çš„ç«¯å£å‘å‡º RPC ç¨‹åºçš„ NULL å‘½ä»¤ï¼Œç¡®å®šå…¶æ˜¯å¦ä¸º RPC ç«¯å£ï¼Œå¹¶è·å–å¯¹åº”è½¯ä»¶åŠç‰ˆæœ¬ä¿¡æ¯ã€‚é€šè¿‡æ­¤æŠ€æœ¯ï¼Œå¯èƒ½è·å¾—ä¸€äº›é˜²ç«å¢™çš„ä¿¡æ¯ã€‚ -bFTP åå¼¹æ”»å‡»ï¼ˆBounce æ”»å‡»ï¼‰ï¼šFTP åè®®å…è®¸é€šè¿‡ä»£ç† FTP è¿æ¥ï¼Œåˆ©ç”¨æ­¤ç‰¹æ€§è¿›è¡Œ TCP ç«¯å£æ‰«æã€‚åªéœ€è¿æ¥åˆ°å‰ç½® FTP æœåŠ¡å™¨ï¼Œä¾¿å¯ä»¥å¯¹ç›®æ ‡è¿›è¡Œæ‰«æï¼Œç”šè‡³å‘ç›®æ ‡ç«¯å£å‘é€æ•°æ®ã€‚æ­¤åŠŸèƒ½éœ€è¦æŒ‡å®šä¸€ä¸ªå…·å¤‡å¯è¯»å†™ç›®å½•çš„ä»£ç† FTP æœåŠ¡å™¨ã€‚ é€šç”¨é€‰é¡¹è¿™äº›é€‰é¡¹ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†å¯æä¾›é¢å¤–çš„åŠŸèƒ½ï¼š -P0ï¼šåœ¨æ‰«æå‰ä¸è¿›è¡Œ pingï¼Œä»¥ä¾¿åœ¨ ICMP è¢«é˜»æ­¢çš„ç½‘ç»œä¸­æ‰§è¡Œæ‰«æã€‚ -PTï¼šåœ¨æ‰«æå‰ä½¿ç”¨ TCP ping ç¡®è®¤ä¸»æœºæ˜¯å¦è¿è¡Œï¼Œé€šå¸¸å‘ç«¯å£ 80 å‘é€ ACK åŒ…ã€‚ -PSï¼šå¯¹äº root ç”¨æˆ·ï¼Œä½¿ç”¨ SYN åŒ…æ›¿ä»£ ACK åŒ…è¿›è¡Œæ‰«æï¼Œæ”¶åˆ° RST åŒ…å³è¡¨ç¤ºä¸»æœºè¿è¡Œã€‚ -PIï¼šä½¿ç”¨ ICMP echo è¯·æ±‚ç¡®è®¤ä¸»æœºè¿è¡Œï¼Œæ­¤é€‰é¡¹è¿˜èƒ½è§‚å¯Ÿå­ç½‘å¹¿æ’­åœ°å€ã€‚ -PBï¼šé»˜è®¤çš„ ping æ‰«æé€‰é¡¹ï¼Œç»“åˆ ACK ä¸ ICMP ä¸¤ç§æ–¹æ³•å¹¶è¡Œæ‰«æã€‚ -Oæ¿€æ´» TCPIP æŒ‡çº¹ç‰¹å¾æ‰«æï¼Œè¯†åˆ«è¿œç¨‹ä¸»æœºçš„æ“ä½œç³»ç»Ÿå’Œç½‘ç»œåè®®æ ˆç‰¹å¾ï¼Œé€šè¿‡æ¯”è¾ƒå·²çŸ¥æŒ‡çº¹æ•°æ®åº“ç¡®å®šç›®æ ‡ä¸»æœºçš„æ“ä½œç³»ç»Ÿç±»å‹ã€‚ -Iå¼€å¯åå‘æ ‡å¿—æ‰«æï¼Œåˆ©ç”¨ ident åè®®ç¡®å®šè¿›ç¨‹æ‹¥æœ‰è€…çš„ç”¨æˆ·åã€‚è¿™ä¸€æ‰«æéœ€åœ¨ç›®æ ‡ç«¯å£å»ºç«‹å®Œæ•´çš„ TCP è¿æ¥æ‰èƒ½æˆåŠŸã€‚ -fä½¿ç”¨åˆ†ç‰‡ IP æ•°æ®åŒ…å‘é€å„ç§æ¢æµ‹åŒ…ï¼ˆå¦‚ SYNã€FINã€XMASã€NULLï¼‰ï¼Œå¢åŠ åŒ…è¿‡æ»¤å’Œå…¥ä¾µæ£€æµ‹ç³»ç»Ÿè¯†åˆ«æ¢æµ‹æ„å›¾çš„éš¾åº¦ã€‚ç„¶è€Œï¼Œä½¿ç”¨æ­¤é€‰é¡¹å¯èƒ½å¯¼è‡´æŸäº›ç¨‹åºè¿è¡Œä¸Šçš„é—®é¢˜ã€‚ -vå†—ä½™æ¨¡å¼ï¼Œæä¾›æ‰«æè¿‡ç¨‹ä¸­çš„è¯¦ç»†ä¿¡æ¯ï¼Œä½¿å¾—ç”¨æˆ·æ›´æ¸…æ¥šæ“ä½œè¿›åº¦ã€‚ä½¿ç”¨ -d é€‰é¡¹å¯æé«˜è¯¦ç»†ç¨‹åº¦ã€‚ -hå¿«é€Ÿå‚è€ƒé€‰é¡¹ï¼Œç®€æ´å±•ç¤ºæ‰€æœ‰å¯ç”¨çš„å‘½ä»¤ä¸å‚æ•°ã€‚ -oN -oMé‡å®šå‘æ‰«æç»“æœï¼Œå‰è€…ä¸ºå¯è¯»æ–‡ä»¶ï¼Œåè€…ä¸ºæœºå™¨å¯è§£æçš„æ–‡ä»¶æ ¼å¼ã€‚å¯ä»¥è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼Œè¦†ç›–æ­£å¸¸è¾“å‡ºå¹¶å°†é”™è¯¯ä¿¡æ¯å‘é€åˆ°æ ‡å‡†é”™è¯¯ã€‚ ä½¿ç”¨ç¤ºä¾‹ä»¥ä¸‹å‘½ä»¤å¯ç”¨äºæ‰«æå±€åŸŸç½‘ä¸Šçš„ MAC åœ°å€ï¼š nmap -sP -PI -PT -oN ipandmaclist.txt 192.168.1.0/24 æ‰§è¡Œåï¼Œç»“æœå°†ä¿å­˜åœ¨æ–‡ä»¶ ipandmaclist.txt ä¸­ï¼Œä»¥ä¾¿æŸ¥é˜…å„ IP å¯¹åº”çš„ MAC åœ°å€ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç½‘ç»œ"]},{"title":"é‚®ä»¶åè®®å’ŒSendMail","path":"/2024/11/28/1-å¹³å°ç³»ç»Ÿ-Linux-ç½‘ç»œ-é‚®ä»¶åè®®å’ŒSendMail/","content":"ç”µå­é‚®ä»¶ç³»ç»Ÿçš„ç»„æˆç”µå­é‚®ä»¶ç³»ç»Ÿçš„åŸºæœ¬æ„æˆåŒ…æ‹¬å¤šä¸ªç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶åœ¨é‚®ä»¶çš„å‘é€ã€æ¥æ”¶ã€å­˜å‚¨å’Œç®¡ç†ä¸­æ‰®æ¼”é‡è¦è§’è‰²ï¼š é‚®ä»¶ç”¨æˆ·ä»£ç†ï¼ˆMail User Agent, MUAï¼‰MUA æ˜¯ç”¨æˆ·ä¸é‚®ä»¶ç³»ç»Ÿäº¤äº’çš„å·¥å…·ï¼Œå¦‚ Microsoft Outlook å’Œ Mozilla Thunderbirdã€‚å®ƒæä¾›äº†ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„ç•Œé¢ï¼Œå…è®¸ç”¨æˆ·é˜…è¯»ã€æ’°å†™å’Œç®¡ç†ä»–ä»¬çš„ç”µå­é‚®ä»¶ã€‚ é‚®ä»¶ä¼ è¾“ä»£ç†ï¼ˆMail Transfer Agent, MTAï¼‰MTA è´Ÿè´£åœ¨é‚®ä»¶æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“é‚®ä»¶ã€‚å®ƒç¡®ä¿é‚®ä»¶ä»å‘ä»¶æ–¹è½¬å‘åˆ°æ¥æ”¶æ–¹ã€‚ä¾‹å¦‚ï¼ŒPostfix å’Œ Exim éƒ½æ˜¯å¸¸è§çš„ MTAã€‚ é‚®ä»¶æäº¤ä»£ç†ï¼ˆMail Submission Agent, MSA, 587 ç«¯å£ï¼‰MSA é€šå¸¸åœ¨ç«¯å£ 587 è¿è¡Œï¼Œä¸“é—¨ç”¨äºç”¨æˆ·å‘é‚®ä»¶æœåŠ¡å™¨æäº¤é‚®ä»¶ã€‚å®ƒå¤„ç†ç”¨æˆ·çš„è®¤è¯å’Œé‚®ä»¶çš„åˆæ­¥å‘é€ã€‚ é‚®ä»¶æŠ•é€’ä»£ç†ï¼ˆMail Delivery Agent, MDAï¼‰MDA å°†é‚®ä»¶æŠ•é€’åˆ°æœ€ç»ˆç”¨æˆ·çš„é‚®ç®±ã€‚å®ƒä¼šå°†é‚®ä»¶å­˜å‚¨åœ¨ç‰¹å®šçš„é‚®ç®±ä¸­ï¼Œä¾›ç”¨æˆ·åç»­è®¿é—®ï¼Œç¤ºä¾‹åŒ…æ‹¬ procmail å’Œ Dovecotã€‚ é‚®ä»¶è®¿é—®ä»£ç†ï¼ˆMail Access Agent, MAAï¼‰MAA ä½¿ç”¨æˆ·èƒ½å¤Ÿè®¿é—®ä»–ä»¬çš„é‚®ä»¶ã€‚é€šè¿‡ IMAP æˆ– POP3 åè®®ï¼Œç”¨æˆ·å¯ä»¥ä»å„ç§è®¾å¤‡ä¸ŠæŸ¥çœ‹å’Œç®¡ç†é‚®ä»¶ã€‚ é‚®ä»¶åè®®ç”µå­é‚®ä»¶çš„ä¼ è¾“å’Œäº¤äº’ä¾èµ–è‹¥å¹²å…³é”®åè®®ï¼š SMTPï¼ˆSimple Mail Transfer Protocolï¼Œç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼‰SMTP æ˜¯å®ç°é‚®ä»¶å‘é€çš„åŸºç¡€åè®®ã€‚å®ƒè§„å®šäº†é‚®ä»¶å¦‚ä½•åœ¨ä¸åŒçš„é‚®ä»¶æœåŠ¡å™¨ä¹‹é—´ä¼ é€’ï¼Œç¡®ä¿é‚®ä»¶èƒ½å¤Ÿè¢«å‡†ç¡®è·¯ç”±åˆ°ç›®æ ‡åœ°å€ã€‚ POP3ï¼ˆPost Office Protocolï¼Œé‚®å±€åè®®ï¼Œç¬¬ 3 ç‰ˆæœ¬ï¼‰POP3 å…è®¸ç”¨æˆ·ä»é‚®ä»¶æœåŠ¡å™¨ä¸Šä¸‹è½½ç”µå­é‚®ä»¶ã€‚ä¸‹è½½åï¼Œé‚®ä»¶ä¸€èˆ¬ä¼šä»æœåŠ¡å™¨ä¸Šåˆ é™¤ï¼Œç”¨æˆ·åªèƒ½åœ¨æœ¬åœ°è®¾å¤‡ä¸ŠæŸ¥çœ‹ã€‚ IMAPï¼ˆInternet Message Access Protocolï¼Œç½‘é™…æ¶ˆæ¯è®¿é—®åè®®ï¼Œç¬¬ 4 ç‰ˆæœ¬ï¼‰IMAP å…è®¸ç”¨æˆ·åœ¨ä¸åŒè®¾å¤‡ä¸ŠåŒæ­¥å’Œç®¡ç†é‚®ä»¶ã€‚ç”¨æˆ·å¯ä»¥æŸ¥çœ‹ã€æ ‡è®°å’Œåˆ†ç±»é‚®ä»¶ï¼Œè€Œé‚®ä»¶å§‹ç»ˆä¿ç•™åœ¨æœåŠ¡å™¨ä¸Šã€‚ MIMEï¼ˆMultipurpose Internet Mail Extensionï¼Œå¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ï¼‰MIME æ‰©å±•äº†ç”µå­é‚®ä»¶çš„åŠŸèƒ½ï¼Œä½¿å…¶èƒ½å¤Ÿå¤„ç†æ–‡æœ¬ä»¥å¤–çš„å†…å®¹ï¼Œå¦‚å›¾åƒã€éŸ³é¢‘å’Œè§†é¢‘ã€‚å®ƒé€šè¿‡æ ‡è¯†å†…å®¹ç±»å‹è®©ç”µå­é‚®ä»¶æ”¯æŒå„ç§æ–‡ä»¶æ ¼å¼ã€‚ sendmail ç®€ä»‹sendmail çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š æ¥æ”¶ SMTP é‚®ä»¶sendmail å¯ä»¥æ¥æ”¶æ¥è‡ªå…¶ä»–é‚®ä»¶æœåŠ¡å™¨çš„é‚®ä»¶ï¼Œç¡®ä¿é‚®ä»¶èƒ½å¤Ÿå‡†ç¡®é€è¾¾ã€‚ ä¸ºé‚®ä»¶é€‰æ‹©è·¯ç”±sendmail æ ¹æ®é¢„è®¾è§„åˆ™å’ŒçŠ¶æ€é€‰æ‹©æœ€ä½³è·¯çº¿ï¼Œç¡®ä¿å¿«é€Ÿæœ‰æ•ˆçš„é‚®ä»¶ä¼ é€’ã€‚ ä¼ è¾“ SMTP é‚®ä»¶ä¿ƒè¿›é‚®ä»¶åœ¨ç½‘ç»œä¸­çš„ä¼ é€’ï¼Œä¿è¯é‚®ä»¶ä¸è¢«ä¸¢å¤±ã€‚ ä½¿ç”¨é‚®ä»¶åˆ«åæ”¯æŒä½¿ç”¨åˆ«åå’Œé‚®ä»¶åˆ—è¡¨ï¼Œç®€åŒ–é‚®ä»¶åœ°å€çš„ç®¡ç†ã€‚ é”™è¯¯æ£€æµ‹åŠä¼˜åŒ–sendmail èƒ½å¤Ÿæ£€æµ‹å¹¶æŠ¥å‘Šä¼ è¾“é”™è¯¯ï¼ŒåŒæ—¶ä¼˜åŒ–å‘é€é€Ÿåº¦å’Œæˆæœ¬ã€‚ å®‰è£…å’Œå¯åŠ¨ sendmailåœ¨ RedHat AS 4 ç³»ç»Ÿä¸­ï¼Œsendmail æä¾›äº† RPM åŒ…ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤è¿›è¡Œå®‰è£…ï¼š å®‰è£… sendmail å’Œç›¸å…³å·¥å…·ï¼š # rpm -ivh m4-1.4.1-13.i386.rpm# rpm -ivh sendmail-8.12.8-4.i386.rpm# rpm -ivh sendmail-cf-8.12.8-4.i386.rpm# rpm -ivh sendmail-doc-8.12.8-4.i386.rpm å¯åŠ¨å’Œåœæ­¢ sendmail æœåŠ¡ï¼š # service sendmail start# service sendmail stop# service sendmail restart RedHat9 ä¸­ sendmail çš„é»˜è®¤é…ç½®åŸºäºå®‰å…¨è€ƒè™‘ï¼Œsendmail åœ¨ RedHat 9 ä¸­å°†å…¶å®ˆæŠ¤è¿›ç¨‹åˆ†ä¸ºä¸¤ç±»ï¼š sendmailå¤„ç†é‚®ä»¶ä¼ è¾“ä»»åŠ¡ï¼ˆMTAï¼‰ã€‚ Sm-clientè´Ÿè´£å¤„ç†é‚®ä»¶æäº¤ä»»åŠ¡ï¼ˆMSPï¼‰ã€‚ è¿™ä¸¤ä¸ªå®ˆæŠ¤è¿›ç¨‹åˆ†åˆ«ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶å’Œé‚®ä»¶é˜Ÿåˆ—ï¼Œç¡®ä¿å„è‡ªåŠŸèƒ½çš„é«˜æ•ˆè¿è¡Œï¼š é‚®ä»¶é˜Ÿåˆ—ç›®å½•ï¼š MTA é‚®ä»¶é˜Ÿåˆ—ï¼š/var/spool/mqueue MSP é‚®ä»¶é˜Ÿåˆ—ï¼š/var/spool/clientmqueue é…ç½®æ–‡ä»¶ï¼š MTA é…ç½®ï¼š/etc/mail/sendmail.cf MSP é…ç½®ï¼š/etc/mail/submit.cf å¯åŠ¨å‘½ä»¤è¡Œä¸­ï¼ŒMTA å’Œ MSP çš„å®ˆæŠ¤è¿›ç¨‹é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿è¡Œï¼š MTAï¼š sendmail -L sm-mta -bd -q1h MSPï¼š sendmail -L sm-msp-queue -Ac -q30m å®‰è£…é…ç½®å’Œå¯åŠ¨ MAAä¸ºäº†é…ç½®é‚®ä»¶è®¿é—®ä»£ç†ï¼ˆMAAï¼‰ï¼Œéœ€è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š vi /etc/dovecot.conf#protocols = imap pop3 å¯åŠ¨ MAA æœåŠ¡ï¼š service dovecot start æµ‹è¯• MAA æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š æµ‹è¯• POP3ï¼š # telnet localhost 110 æµ‹è¯• IMAPï¼š # telnet localhost 143 sendmail çš„é…ç½®æ–¹æ³•sendmail çš„é…ç½®æ–¹æ³•ä¸»è¦æœ‰ä¸‰ç§ï¼š ç›´æ¥ä¿®æ”¹ cf é…ç½®æ–‡ä»¶ç›´æ¥å¯¹ /etc/mail/sendmail.cf è¿›è¡Œä¿®æ”¹ä»¥å®ç°ç‰¹å®šé…ç½®ã€‚ ç¼–å†™ mc å®é…ç½®æ–‡ä»¶ç¼–å†™åç¼€ä¸º .mc çš„å®æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ m4 å·¥å…·å°†å…¶è½¬æ¢ä¸º .cf æ–‡ä»¶ã€‚è¿™ä¸ªæ–¹æ³•èƒ½æå‡é…ç½®çš„å¯è¯»æ€§å’Œæ˜“ç”¨æ€§ã€‚ ä½¿ç”¨ sendmail æ•°æ®åº“æ›´æ–°é…ç½®sendmail æ”¯æŒä½¿ç”¨æ•°æ®åº“æ–‡ä»¶å¯¹é…ç½®è¿›è¡Œç®¡ç†å’Œæ›´æ–°ã€‚ ä½¿ç”¨ sendmail æ•°æ®åº“æ›´æ–°é…ç½®local-host-names æ•°æ®åº“ ä½œç”¨ï¼šå°†æ‰€æœ‰å†…å®¹è§†ä¸ºæœ¬åœ°ä¸»æœºåã€‚è¯¥æ•°æ®åº“ç›¸å½“äºé…ç½®æ–‡ä»¶ä¸­çš„ Cw ï¼ˆè®¾å®šæœ¬åœ°ä¸»æœºåé€‰é¡¹ï¼‰ã€‚ ä¿®æ”¹å’Œæµ‹è¯•ç¤ºä¾‹ï¼š ä¿®æ”¹æ–‡ä»¶ /etc/mail/local-host-namesï¼Œæ·»åŠ ä¸‹åˆ—å†…å®¹ï¼š # vi /etc/mail/local-host-namesshrike.jamond.netjamond.net æµ‹è¯•æœ¬åœ°ä¸»æœºåé…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼š netstat -ln | grep 25 access æ•°æ®åº“ å®‰å…¨æ€§è€ƒè™‘ï¼šç”±äº SMTP åè®®ä¸è¦æ±‚èº«ä»½è®¤è¯ï¼Œä»»ä½•äººå¯ä»¥é€šè¿‡ telnet è®¿é—®æœ¬åœ°æœåŠ¡å™¨çš„ 25 ç«¯å£ï¼Œä»è€Œå‘é€é‚®ä»¶ã€‚ä¸ºäº†é˜²æ­¢ä¸æ˜èº«ä»½ç”¨æˆ·åˆ©ç”¨æœåŠ¡å™¨å‘é€åƒåœ¾é‚®ä»¶ï¼Œsendmail é»˜è®¤ç¦æ­¢éè®¤è¯ç”¨æˆ·çš„é‚®ä»¶å‘é€ã€‚ é…ç½®è¯´æ˜ï¼šsendmail è¯»å– /etc/mail/access.db æ–‡ä»¶å†…å®¹ï¼Œæ ¹æ®è®¾ç½®å†³å®šæ˜¯å¦ä¸­ç»§é‚®ä»¶ã€‚å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼Œç”±æ–‡æœ¬æ–‡ä»¶ /etc/mail/access ç”Ÿæˆ access.dbï¼š makemap hash /etc/mail/access /etc/mail/access.txt aliases æ•°æ®åº“ åŠŸèƒ½ï¼šå®ç° sendmail åˆ«ååŠŸèƒ½ï¼Œå®ƒå…è®¸å°†é‚®ä»¶æŒ‰ç…§åˆ«åè½¬å‘åˆ°ç‰¹å®šç”¨æˆ·ã€‚ æ“ä½œæ­¥éª¤ï¼š é…ç½®æ–‡ä»¶ /etc/aliasesï¼Œå¯ä½¿ç”¨ newaliases å‘½ä»¤ç”Ÿæˆæ•°æ®åº“æ–‡ä»¶ï¼š # vi /etc/aliaseslrj: osmondpostmaster: rootabc: abc@yyy.com.cnnet_group: osmond, tom, stillman, patrcko åˆ«åçš„ç”¨é€”ï¼š ä¸ºç”¨æˆ·æŒ‡å®šç»°å·ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ lrj ä»£æ›¿å®Œæ•´é‚®ç®±ï¼‰ã€‚ å°†å‘ç»™ç‰¹æ®Šç”¨æˆ·çš„é‚®ä»¶è‡ªåŠ¨è½¬å‘ç»™å®é™…ç”¨æˆ·ï¼ˆä¾‹å¦‚ï¼Œå°† postmaster çš„é‚®ä»¶è½¬å‘åˆ° rootï¼‰ã€‚ å®ç°é‚®ä»¶åˆ—è¡¨ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ net_group åŒæ—¶å‘é€é‚®ä»¶ç»™å¤šä½ç”¨æˆ·ï¼‰ã€‚ å‘åŒ¿åé‚®ä»¶å‘é€åŒ¿åé‚®ä»¶çš„åŸºæœ¬è¿‡ç¨‹å¦‚ä¸‹ï¼š HeloMail from: a@a.comRcpt to: it@nit-pro.orgDataé‚®ä»¶å†…å®¹é‚®ä»¶å†…å®¹è¾“å…¥ç»“æŸå¦èµ·ä¸€è¡Œæ•²å…¥ä¸€ä¸ªâ€œ.â€å›è½¦å³å¯å‘é€ è¿™æ˜¯é€šè¿‡ SMTP äº¤äº’çš„åŸºæœ¬æ ¼å¼ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥åœ¨æ²¡æœ‰æ˜¾å¼èº«ä»½çš„æƒ…å†µä¸‹å‘é€é‚®ä»¶ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç½‘ç»œ"]},{"title":"TFTPé…ç½®","path":"/2024/11/21/1-å¹³å°ç³»ç»Ÿ-Linux-ç½‘ç»œ-FTP-TFTPé…ç½®/","content":"æœåŠ¡ç«¯ Server ç½‘ç»œåˆå§‹åŒ– ç­‰å¾…å®¢æˆ·è¿æ¥ æ¥å—å‘½ä»¤ å‘½ä»¤ åŠ¨ä½œ get filename åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå‘é€é”™è¯¯ç¼–å·ï¼›å¦‚æœå­˜åœ¨ï¼Œæ‰“å¼€æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶ï¼Œå†™åˆ°è¯»å†™å¥—æ¥å­—ï¼Œå…³é—­æ–‡ä»¶ put filename åˆ›å»ºæ–‡ä»¶ï¼Œè¯»å¥—æ¥å­—ï¼Œå†™å…¥æ–‡ä»¶ï¼Œå…³é—­æ–‡ä»¶ list æ‰“å¼€æœåŠ¡å™¨å…±äº«ç›®å½•ï¼Œè¯»ç›®å½•ï¼Œå‘é€åˆ°å¥—æ¥å­—ï¼Œå…³ç›®å½• å®¢æˆ·æœº Client ç½‘ç»œåˆå§‹åŒ– è¿æ¥æœåŠ¡å™¨ åˆ¤æ–­å‘½ä»¤ å‘½ä»¤ åŠ¨ä½œ get filename åœ¨å½“å‰ç›®å½•åˆ›å»ºæ–‡ä»¶ï¼Œè¯»å¥—æ¥å­—ï¼Œå†™å…¥æ–‡ä»¶ï¼Œå…³é—­æ–‡ä»¶ put filename æ‰“å¼€æ–‡ä»¶ï¼Œå†™å…¥å¥—æ¥å­—ï¼Œå…³é—­æ–‡ä»¶ list è¯»å¥—æ¥å­— quit é€€å‡º help æ‰“å°å¸®åŠ©ä¿¡æ¯ é€šä¿¡å†…å®¹ID+æ–‡ä»¶å†…å®¹ FileContent ID å«ä¹‰ 0 æ­£å¸¸é€šä¿¡ 1 è¡¨ç¤ºæœ‰é”™è¯¯ 2 è¡¨ç¤ºæ–‡ä»¶ç»“æŸ é…ç½® TFTPï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰TFTPï¼ˆTrivial File Transfer Protocolï¼‰æ˜¯ä¸€ä¸ªç®€å•çš„æ–‡ä»¶ä¼ è¾“åè®®ï¼Œå¸¸ç”¨äºåœ¨è®¡ç®—æœºç½‘ç»œä¸­è¿›è¡Œæ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½ã€‚ä¸‹é¢æ˜¯è¯¦ç»†çš„é…ç½®æ­¥éª¤ï¼Œç¡®ä¿é¡ºåˆ©åœ°å®ç°æ–‡ä»¶ä¼ è¾“åŠŸèƒ½ã€‚ 1) å®‰è£… TFTPï¼ˆå·²å®‰è£…ï¼‰é¦–å…ˆï¼Œæ£€æŸ¥ TFTP æ˜¯å¦å·²ç»å®‰è£…ã€‚å¦‚æœæœªå®‰è£…ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…æ‰€éœ€çš„ç›¸å…³è½¯ä»¶åŒ…ï¼š sudo apt-get install tftp-hpa tftpd-hpa è¿™é‡Œï¼Œtftp-hpa æ˜¯ TFTP å®¢æˆ·ç«¯ï¼Œè€Œ tftpd-hpa æ˜¯ TFTP æœåŠ¡å™¨ã€‚é€šè¿‡è¿™æ¡å‘½ä»¤å¯ä»¥ç¡®ä¿çš„ç³»ç»Ÿä¸­æœ‰é€‚å½“çš„å·¥å…·æ¥è¿›è¡Œæ–‡ä»¶ä¼ è¾“ã€‚ 2) é…ç½® TFTPæ¥ä¸‹æ¥ï¼Œéœ€è¦é…ç½® TFTP æœåŠ¡å™¨ã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ‰“å¼€é…ç½®æ–‡ä»¶ï¼š sudo vi /etc/default/tftpd-hpa åœ¨æ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ°å¹¶ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š TFTP_DIRECTORY=/tftpboot æ³¨æ„äº‹é¡¹å¦‚æœ /tftpboot ç›®å½•ä¸å­˜åœ¨ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºå®ƒï¼š sudo mkdir /tftpboot æ·»åŠ æƒé™ï¼šç¡®ä¿ TFTP æœåŠ¡å™¨èƒ½å¤Ÿè®¿é—®è¯¥ç›®å½•ï¼Œå¹¶å…è®¸è¯»å†™æ“ä½œã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ›´æ”¹ç›®å½•æƒé™ï¼š sudo chmod 777 /tftpboot -R è¿™é‡Œï¼Œ-R å‚æ•°è¡¨ç¤ºé€’å½’æ›´æ”¹æƒé™ï¼Œä½¿æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶éƒ½ç»§æ‰¿è¿™ä¸ªæƒé™è®¾ç½®ã€‚é€‰æ‹© 777 æƒé™æ„å‘³ç€æ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬æ™®é€šç”¨æˆ·ï¼‰éƒ½æœ‰è¯»ã€å†™å’Œæ‰§è¡Œæƒé™ï¼Œæ–¹ä¾¿è¿›è¡Œæ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œä½†åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®æ ¹æ®å®‰å…¨éœ€æ±‚è®¾ç½®æ›´ä¸¥æ ¼çš„æƒé™ã€‚ 3) é‡å¯æœåŠ¡å®Œæˆé…ç½®åï¼Œéœ€è¦é‡å¯ TFTP æœåŠ¡ï¼Œä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é‡å¯æœåŠ¡ï¼š sudo /etc/init.d/tftpd-hpa restart é‡å¯æœåŠ¡åï¼ŒTFTP æœåŠ¡å™¨å°†ä½¿ç”¨æ–°çš„é…ç½®è¿›è¡Œå·¥ä½œã€‚ 4) æµ‹è¯•æµ‹è¯•æ­¥éª¤ç¡®ä¿ TFTP åœ¨æœ¬æœºæ­£å¸¸è¿è¡Œã€‚é¦–å…ˆï¼Œé€‰æ‹©ä¸€ä¸ªç›®å½•ï¼š cd ~ æ¥ä¸‹æ¥ï¼Œè¿æ¥åˆ°æœ¬åœ° TFTP æœåŠ¡å™¨ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š tftp 127.0.0.1 è¿™é‡Œçš„ 127.0.0.1 æ˜¯æœ¬åœ°å›ç¯åœ°å€ï¼ŒæŒ‡å‘æœ¬æœºã€‚è¿æ¥åï¼Œå°†è¿›å…¥ TFTP äº¤äº’ç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ–‡ä»¶ transferï¼š ä» tftpboot ä¸‹è½½æ–‡ä»¶ï¼š tftp get xx è¿™æ¡å‘½ä»¤ä¼šå°è¯•ä» /tftpboot ç›®å½•ä¸­ä¸‹è½½åä¸º xx çš„æ–‡ä»¶åˆ°å½“å‰ç›®å½•ã€‚ å°†æ–‡ä»¶ä¸Šä¼ åˆ° tftpbootï¼š tftp put xx è¿™æ¡å‘½ä»¤ä¼šå°†å½“å‰ç›®å½•ä¸‹çš„åä¸º xx çš„æ–‡ä»¶ä¸Šä¼ åˆ° /tftpboot ç›®å½•ä¸­ã€‚ é€€å‡º TFTP ç¯å¢ƒï¼š tftp quit è¾“å…¥ quit å‘½ä»¤å¯ä»¥å®‰å…¨é€€å‡º TFTP å®¢æˆ·ç«¯ã€‚ é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œå¯ä»¥é¡ºåˆ©é…ç½®å¹¶æµ‹è¯• TFTP å®ˆæŠ¤ç¨‹åºã€‚ç¡®ä¿åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæ£€æŸ¥ä»»ä½•é”™è¯¯ä¿¡æ¯å¹¶æ ¹æ®éœ€è¦è°ƒæ•´é…ç½®æˆ–æƒé™è®¾ç½®ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç½‘ç»œ"]},{"title":"NFSæœåŠ¡çš„æ­å»º","path":"/2024/11/12/1-å¹³å°ç³»ç»Ÿ-Linux-ç½‘ç»œ-NFS-NFSæœåŠ¡çš„æ­å»º/","content":"NFS ç®€ä»‹NFSï¼Œå³ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNetwork File Systemï¼‰ï¼Œæ˜¯ä¸€ç§å¹¿æ³›æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿã€‚å®ƒå…è®¸ä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´å…±äº«æ–‡ä»¶å’Œç›®å½•ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿåƒè®¿é—®æœ¬åœ°æ–‡ä»¶ä¸€æ ·ï¼Œä¾¿æ·åœ°è®¿é—®è¿œç¨‹ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚è¿™ç§åŠŸèƒ½ä½¿å¾— NFS åœ¨ç½‘ç»œç¯å¢ƒä¸­è‡³å…³é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨ä¼ä¸šå’Œå¼€å‘è€…çš„æ—¥å¸¸å·¥ä½œä¸­ã€‚ NFS çš„å…±äº«æœºåˆ¶å»ºç«‹åœ¨å¯¹äºä¿¡ä»»çš„åŸºç¡€ä¸Šï¼Œå› æ­¤åœ¨å‘å…¶ä»–ç”¨æˆ·å¼€æ”¾å…±äº«èµ„æºä¹‹å‰ï¼Œå¿…é¡»ä»”ç»†ç¡®è®¤å¯¹æ–¹çš„å¯é æ€§ã€‚æŸäº›æ•æ„Ÿæˆ–é‡è¦æ•°æ®ä¸åº”åœ¨ä¸ä¿¡ä»»çš„ç¯å¢ƒä¸‹å…±äº«ï¼Œä»¥é¿å…æ•°æ®æ³„éœ²çš„é£é™©ã€‚ NFS çš„åº”ç”¨åœºæ™¯åœ¨åµŒå…¥å¼å¼€å‘ä¸­ï¼ŒNFS æ‰®æ¼”ç€ä¸å¯æˆ–ç¼ºçš„è§’è‰²ã€‚é€šè¿‡å°†â€æ ¹æ–‡ä»¶ç³»ç»Ÿâ€ä¿ç•™åœ¨ä¸»æœºä¸Šï¼Œå¯ä»¥åœ¨å¼€å‘æ¿å¯åŠ¨æ—¶ï¼Œé€šè¿‡ NFS è½»æ¾æŒ‚è½½ä¸»æœºä¸Šçš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚è¿™ä¸€è¿‡ç¨‹ä¸ä»…èŠ‚çœäº†æ—¶é—´ï¼Œå› ä¸ºä¸éœ€è¦æ¯æ¬¡éƒ½æŠŠæ–‡ä»¶ç³»ç»Ÿçƒ§å†™åˆ°å¼€å‘æ¿çš„å­˜å‚¨è®¾å¤‡ä¸Šï¼Œè€Œä¸”è¿˜æé«˜äº†å¼€å‘çš„çµæ´»æ€§å’Œæ•ˆç‡ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œä½¿ç”¨ TFTPï¼ˆTrivial File Transfer Protocolï¼‰éœ€è¦å¤šæ¬¡è¿›è¡Œå•ç‹¬çš„æ–‡ä»¶ä¼ è¾“ï¼Œè€Œ NFS æä¾›äº†ä¸€ä¸ªæ›´ä¸ºç®€ä¾¿çš„è§£å†³æ–¹æ¡ˆã€‚ NFS çš„é…ç½®è¿‡ç¨‹ä»¥ Ubuntu ä¸ºä¾‹ï¼Œå°†è¯¦ç»†è®²è§£å¦‚ä½•é…ç½® NFS æœåŠ¡ã€‚ Serverï¼ˆæœåŠ¡å™¨ç«¯ï¼‰ï¼š PCClientï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼š ARM (è¿™é‡Œä½¿ç”¨åŒä¸€å°æœºå™¨è¿›è¡Œæ¨¡æ‹Ÿï¼Œä¸»è¦å±•ç¤ºå®‰è£…è¿‡ç¨‹)ä¸€ã€é…ç½®æœåŠ¡å™¨ç«¯é¦–å…ˆï¼Œéœ€è¦å®‰è£… NFS æœåŠ¡å™¨ç¨‹åºã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š sudo apt-get install nfs-kernel-server åœ¨æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šæç¤ºè¾“å…¥å¯†ç ã€‚å¦‚æœä¹‹å‰å·²ç»å®‰è£…è¿‡ NFSï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºâ€NFS kernel server is already the newest version.â€ï¼Œè¿™æ„å‘³ç€æ— éœ€é‡å¤å®‰è£…ã€‚ äºŒã€é…ç½® NFS èµ„æºNFS å…è®¸æŒ‚è½½çš„ç›®å½•å’Œæƒé™åœ¨ /etc/exports æ–‡ä»¶ä¸­è¿›è¡Œå®šä¹‰ã€‚å› æ­¤ï¼Œé…ç½® NFS æœåŠ¡å™¨çš„å…³é”®åœ¨äºç¼–è¾‘æ­¤æ–‡ä»¶ã€‚ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å’Œç¼–è¾‘ /etc/exports æ–‡ä»¶ï¼š cat /etc/exports åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œéœ€è¦æŒ‰ç…§ä»¥ä¸‹æ–¹å¼å®šä¹‰å…±äº«ç›®å½•ï¼š å…±äº«ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œä¾‹å¦‚ /home/fs/qiangã€‚ ç½‘ç»œè®¿é—®æ§åˆ¶ï¼Œä½¿ç”¨ * è¡¨ç¤ºå…è®¸æ‰€æœ‰ IP åœ°å€è®¿é—®ï¼Œæˆ–æŒ‡æ˜ç‰¹å®šçš„ IP åœ°å€ï¼Œä¾‹å¦‚ 192.168.3.51(rw)ã€‚ å…¶ä»–å‚æ•°ï¼Œå¦‚ï¼š insecure è¡¨ç¤º NFS å°†é€šè¿‡ 1024 ä»¥ä¸Šçš„ç«¯å£è¿›è¡Œé€šä¿¡ã€‚ rw è¡¨ç¤ºç»™äºˆè¯»å†™æƒé™ã€‚ async å…è®¸ç³»ç»Ÿåœ¨å†™å…¥æ•°æ®ä¹‹å‰å¤„ç†è¯·æ±‚ã€‚ root_squash æ„å‘³ç€ root ç”¨æˆ·çš„æƒé™è¢«é™åˆ¶ï¼Œä»…èƒ½ä»¥æ™®é€šç”¨æˆ·èº«ä»½è®¿é—®å…±äº«ç›®å½•ã€‚ å¯ä»¥åœ¨ /etc/exports æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š /home/fs/qiang 192.168.3.51(rw)/home/fs/qiang *(insecure,rw,async,root_squash) ä¸‰ã€æ‰‹åŠ¨å¯åŠ¨å’Œåœæ­¢ NFS æœåŠ¡å®Œæˆé…ç½®åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ NFS æœåŠ¡ï¼š sudo /etc/init.d/nfs-kernel-server start å¯åŠ¨æœåŠ¡åï¼Œç³»ç»Ÿä¼šè¾“å‡ºæ­£åœ¨å¯¼å‡ºç›®å½•çš„ä¿¡æ¯ã€‚å¦‚æœé…ç½®æ²¡æœ‰é—®é¢˜ï¼Œä¼šæ˜¾ç¤º [ OK ]ã€‚ è¦åœæ­¢ NFS æœåŠ¡ï¼Œè¯·ä½¿ç”¨ï¼š sudo /etc/init.d/nfs-kernel-server stop è‹¥è¦é‡æ–°å¯åŠ¨ NFS æœåŠ¡ï¼Œå¯ä»¥ç®€å•åœ°æ‰§è¡Œï¼š sudo /etc/init.d/nfs-kernel-server restart è¦æŸ¥çœ‹ NFS æœåŠ¡å½“å‰çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š sudo /etc/init.d/nfs-kernel-server status å››ã€æŸ¥çœ‹ NFS æœåŠ¡å™¨çš„å…±äº«èµ„æºä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹ NFS æœåŠ¡å™¨å½“å‰å¯¼å‡ºçš„å…±äº«èµ„æºï¼š showmount -e 192.168.3.51 è¿™å°†æ˜¾ç¤ºæœåŠ¡å™¨ä¸Šå…±äº«çš„æ–‡ä»¶å’Œç›®å½•ã€‚ äº”ã€æŒ‚è½½å…±äº«èµ„æºåœ¨å®¢æˆ·ç«¯ï¼Œå¯ä»¥ä½¿ç”¨ mount å‘½ä»¤æ¥æŒ‚è½½ NFS å…±äº«èµ„æºã€‚å‘½ä»¤å¦‚ä¸‹ï¼š sudo mount -t nfs 192.168.3.51:/home/fs/qiang /mnt/nfs è¿™é‡Œï¼Œ-t æŒ‡æ˜æ–‡ä»¶ç³»ç»Ÿç±»å‹ä¸º NFSï¼Œ192.168.3.51 æ˜¯æœåŠ¡ç«¯çš„ IP åœ°å€ï¼Œ/home/fs/qiang æ˜¯æœåŠ¡ç«¯çš„å…±äº«ç›®å½•ï¼Œè€Œ /mnt/nfs æ˜¯å®¢æˆ·ç«¯çš„æŒ‚è½½ç‚¹ã€‚ æŒ‚è½½æˆåŠŸåï¼Œå®¢æˆ·ç«¯å¯¹æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œå°†ä¸æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ²¡æœ‰åŒºåˆ«ï¼Œç”¨æˆ·å¯ä»¥è‡ªç”±åœ°è¯»å–å’Œå†™å…¥æ•°æ®ã€‚ å…­ã€å¸è½½å…±äº«èµ„æºå½“å®Œæˆå¯¹å…±äº«èµ„æºçš„æ“ä½œåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¸è½½ï¼š sudo umount /mnt/nfs è¯·æ³¨æ„ï¼Œå¦‚æœæœ‰å…¶ä»–ç”¨æˆ·æ­£åœ¨ä½¿ç”¨è¯¥å…±äº«ç›®å½•çš„æ–‡ä»¶ï¼Œåˆ™æ— æ³•æˆåŠŸå¸è½½ã€‚å¦‚æœç¡®å®éœ€è¦å¼ºåˆ¶å¸è½½ï¼Œå¯ä»¥ä½¿ç”¨ï¼š sudo umount -f /mnt/nfs é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå¯ä»¥é¡ºåˆ©é…ç½®å’Œä½¿ç”¨ NFSï¼Œå®ç°é«˜æ•ˆçš„æ–‡ä»¶å…±äº«ä¸ç®¡ç†ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç½‘ç»œ"]},{"title":"NFSç¯å¢ƒé…ç½®","path":"/2024/11/11/1-å¹³å°ç³»ç»Ÿ-Linux-ç½‘ç»œ-NFS-NFSç¯å¢ƒé…ç½®/","content":"é…ç½® TFTP æœåŠ¡a. å®‰è£… TFTP æœåŠ¡ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ç³»ç»Ÿä¸­å®‰è£… TFTP æœåŠ¡åŠå…¶å®ˆæŠ¤è¿›ç¨‹ï¼š sudo apt-get install tftp tftpd-hpa è¿™ä¸€æ­¥éª¤ç¡®ä¿æ‹¥æœ‰ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„ TFTPï¼ˆç®€æ˜“æ–‡ä»¶ä¼ è¾“åè®®ï¼‰æœåŠ¡ï¼Œèƒ½å¤Ÿåœ¨ç½‘ç»œç¯å¢ƒä¸­è¿›è¡Œæ–‡ä»¶çš„ä¼ è¾“å’Œå…±äº«ã€‚ b. ä¿®æ”¹é…ç½®æ–‡ä»¶ç¼–è¾‘ TFTP çš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œä»¥ä¾¿äºè°ƒæ•´æœåŠ¡å‚æ•°ï¼š sudo vi /etc/default/tftpd-hpa åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œå¯ä»¥è®¾ç½® TFTP æœåŠ¡å™¨çš„åŸºæœ¬å±æ€§ï¼Œä¾‹å¦‚æœåŠ¡å¯åŠ¨çš„æ–¹å¼ã€ç›‘å¬çš„ IP åœ°å€ç­‰ã€‚ç¡®ä¿æ ¹æ®è‡ªå·±çš„éœ€æ±‚å¯¹è¿™äº›å‚æ•°è¿›è¡Œé€‚å½“çš„é…ç½®ã€‚ c. ä¿®æ”¹æœåŠ¡ç›®å½•æŒ‡å®š TFTP æœåŠ¡çš„æ ¹ç›®å½•ï¼Œä¸åŒäºé»˜è®¤ç›®å½•ï¼š /home/fs/tftpboot ç¡®ä¿è¯¥ç›®å½•çš„å­˜åœ¨ï¼Œå¹¶å…·å¤‡è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´ä»¥å­˜æ”¾è¦å…±äº«çš„æ–‡ä»¶ã€‚ d. é‡å¯ TFTP æœåŠ¡ä¿å­˜é…ç½®æ–‡ä»¶åï¼Œé€šè¿‡ä¸‹é¢çš„å‘½ä»¤é‡å¯ TFTP æœåŠ¡ï¼Œä»¥åº”ç”¨ä¸Šè¿°é…ç½®ï¼š sudo service tftpd-hpa restart è¿™å°†é‡æ–°åŠ è½½ TFTP æœåŠ¡ï¼Œç¡®ä¿æ–°çš„é…ç½®è¢«æ­£ç¡®åº”ç”¨ã€‚ e. æ‹·è´å†…æ ¸æ–‡ä»¶ä¸ºäº†ä¿è¯å¼€å‘ç¯å¢ƒèƒ½å¤Ÿä»è™šæ‹Ÿæœºä¸­ä¸‹è½½å†…æ ¸æ–‡ä»¶ï¼Œéœ€è¦å°† zImage æ–‡ä»¶æ‹·è´åˆ° TFTP æœåŠ¡çš„æ ¹ç›®å½•ï¼š cp /path/to/zImage /home/fs/tftpboot/ ç¡®ä¿åœ¨æ‹·è´ä¹‹å‰ï¼ŒzImage æ–‡ä»¶å·²ç»å­˜åœ¨äºæŒ‡å®šè·¯å¾„ã€‚ å¸¸è§æŠ¥é”™ æƒé™ä¸å…è®¸æ£€æŸ¥æƒé™è®¾ç½®ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ›´æ”¹ tftpboot ç›®å½•åŠå…¶å­ç›®å½•çš„è®¿é—®æƒé™ï¼š chmod 777 /home/fs/tftpboot -R æ–‡ä»¶åæœªæ‰¾åˆ°ç¡®ä¿ zImage æ–‡ä»¶ç¡®å®å­˜åœ¨äº TFTP æ ¹ç›®å½•ã€‚ ç¡®è®¤é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„æœåŠ¡ç›®å½•ä¸å®é™…è¿è¡Œçš„ç›®å½•ä¸€è‡´ã€‚ æŒ‚è½½ç›®å½•a. é…ç½® NFS æ–‡ä»¶ç¼–è¾‘ NFS å¯¼å‡ºæ–‡ä»¶ä»¥å®šä¹‰è¦å…±äº«çš„ç›®å½•ï¼š sudo vi /etc/exports æ·»åŠ å…±äº«ç›®å½•çš„é…ç½®ï¼š /home/fs/nfsboot *(rw,sync,no_subtree_check) è¿™é‡Œ *(rw,sync,no_subtree_check) çš„å«ä¹‰æ˜¯æ‰€æœ‰å®¢æˆ·ç«¯å¯ä»¥ä»¥è¯»å†™æ¨¡å¼è®¿é—®è¿™ä¸ªç›®å½•ï¼Œä¸”æ–‡ä»¶åŒæ­¥æ—¶ä¸ä¼šæ£€æŸ¥å­ç›®å½•ã€‚ b. é‡å¯ NFS æœåŠ¡è™½ç„¶ NFS æœåŠ¡é»˜è®¤æƒ…å†µä¸‹ä¼šä¸€ç›´è¿è¡Œï¼Œä½†åœ¨æ›´æ”¹é…ç½®åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥ç¡®ä¿æ›´æ”¹ç”Ÿæ•ˆï¼š sudo service nfs-kernel-server restart c. æ‹·è´æ–‡ä»¶ç³»ç»Ÿå°† rootfs.tgz æ–‡ä»¶ç³»ç»Ÿæ‹·è´åˆ° NFS çš„å…±äº«ç›®å½•ä¸­ï¼š cp /path/to/rootfs.tgz /home/fs/nfsboot/ d. è§£å‹æ–‡ä»¶è§£å‹åˆšæ‰æ‹·è´çš„ rootfs.tgz æ–‡ä»¶ï¼Œä»¥ä¾¿ä½¿ç”¨ï¼š sudo tar -zxvf /home/fs/nfsboot/rootfs.tgz æ­¤å‘½ä»¤å°†æ–‡ä»¶è§£å‹åˆ° nfsboot ç›®å½•ï¼Œæ–¹ä¾¿åç»­è®¿é—®ã€‚ e. æ”¹å˜æ–‡ä»¶æƒé™ç¡®ä¿æ–‡ä»¶ç³»ç»Ÿå†…çš„æ–‡ä»¶å’Œç›®å½•å¯¹æ‰€æœ‰ç”¨æˆ·å¼€æ”¾è®¿é—®æƒé™ï¼š sudo chmod 777 /home/fs/nfsboot/rootfs -R å¼€å‘æ¿è®¾ç½®a. è®¾ç½®å¼€å‘ç›¸å…³ IPåœ¨å¼€å‘æ¿çš„ç¯å¢ƒä¸­è®¾ç½®ç›¸å…³çš„ç½‘ç»œå‚æ•°ï¼š setenv serverip 192.168.2.2 // æœåŠ¡å™¨ IP åœ°å€setenv ipaddr 192.168.2.3 // å¼€å‘æ¿ IP åœ°å€setenv netmask 255.255.255.0 // å­ç½‘æ©ç setenv gatewayip 192.168.1.1 // ç½‘å…³ è¿™äº›ç¯å¢ƒå˜é‡å°†ç¡®ä¿å¼€å‘æ¿èƒ½å¤Ÿè¿æ¥åˆ°ç½‘ç»œå’ŒæœåŠ¡å™¨ã€‚ b. è®¾ç½®å¼€å‘æ¿å¯åŠ¨å‚æ•°å®šä¹‰å¯åŠ¨å‘½ä»¤ï¼Œä»¥é€šè¿‡ TFTP ä»æœåŠ¡å™¨ä¸‹è½½å†…æ ¸æ–‡ä»¶å¹¶å¯åŠ¨ï¼š setenv bootcmd tftp 20008000 zImage; go 20008000 å½“å¼€å‘æ¿å¯åŠ¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œé€šè¿‡ TFTP ä»æœåŠ¡å™¨ï¼ˆ192.168.2.2ï¼‰ä¸‹è½½ zImage æ–‡ä»¶åˆ°å¼€å‘æ¿å†…å­˜åœ°å€ 0x20008000ï¼Œä¸‹è½½å®Œæˆåï¼ŒCPU ä»è¯¥åœ°å€å¼€å§‹æ‰§è¡Œå†…æ ¸ã€‚ å¦‚æœæƒ³ä½¿ç”¨ zImage_all å†…æ ¸è¿›è¡Œå¯åŠ¨ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š é‡å¯å¼€å‘æ¿ã€‚ è®¾ç½®æ–°çš„å¯åŠ¨å‘½ä»¤ï¼š setenv bootcmd tftp 20008000 zImage_all; go 20008000 ä½¿ç”¨å‘½ä»¤ä¿å­˜æ›´æ”¹ï¼š save å¯åŠ¨å¼€å‘æ¿ï¼š boot c. è®¾ç½®æ–‡ä»¶ç³»ç»ŸæŒ‚è½½æ–¹å¼é…ç½®å¼€å‘æ¿çš„å¯åŠ¨å‚æ•°ï¼Œä»¥æŒ‡å®š NFS æ–‡ä»¶ç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯ï¼š setenv bootargs root=nfs nfsroot=192.168.2.2:/home/fs/nfsboot/rootfs ip=192.168.2.3 init=/linuxrc console=ttySAC0,115200 è¿™äº›è®¾ç½®å°†ç¡®ä¿å¼€å‘æ¿åœ¨å¯åŠ¨æ—¶é€šè¿‡ NFS æŒ‚è½½æŒ‡å®šçš„æ–‡ä»¶ç³»ç»Ÿã€‚ d. ä¿å­˜è®¾ç½®æ³¨æ„ï¼Œä»¥ä¸Šæ‰€æœ‰è®¾ç½®ä»…åœ¨å†…å­˜ä¸­ç”Ÿæ•ˆï¼Œé‡å¯åå°†ä¼šä¸¢å¤±ã€‚å› æ­¤ï¼Œéœ€è¦å°†è®¾ç½®ä¿å­˜åˆ°éæ˜“å¤±æ€§å­˜å‚¨ä¸­ï¼š saveenv å„ç§æ–¹å¼å¯åŠ¨å¼€å‘æ¿ æŒ‰ç”µæºé”®é‡å¯å¼€å‘æ¿ã€‚ åœ¨å¯åŠ¨å‘½ä»¤è¡Œè¾“å…¥ boot å‘½ä»¤ã€‚ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä» TFTP ä¸‹è½½å†…æ ¸ï¼š tftp 20008000 zImagego 20008000 é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå¯ä»¥è½»æ¾é…ç½®å’Œå¯åŠ¨å¼€å‘æ¿ï¼Œä»¥ä¾¿äºè¿›è¡Œå¼€å‘å’Œæµ‹è¯•ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç½‘ç»œ"]},{"title":"NFSé…ç½®","path":"/2024/11/08/1-å¹³å°ç³»ç»Ÿ-Linux-ç½‘ç»œ-NFS-NFSé…ç½®/","content":"é…ç½® NFSï¼ˆç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼‰NFSï¼ˆNetwork File Systemï¼‰æ˜¯ä¸€ç§å…è®¸ç”¨æˆ·åœ¨ç½‘ç»œä¸­è®¿é—®å’Œå…±äº«æ–‡ä»¶çš„åè®®ã€‚å®ƒä½¿å¾—è·¨ä¸åŒæœºå™¨è®¿é—®æ–‡ä»¶æˆä¸ºå¯èƒ½ï¼Œç®€åŒ–äº†æ–‡ä»¶ç®¡ç†ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ¯”å¦‚åœ¨ä¼ä¸šç¯å¢ƒä¸­ï¼Œå¸¸å¸¸éœ€è¦å°†é…ç½®æ–‡ä»¶ã€å…±äº«æ–‡æ¡£æˆ–åº”ç”¨ç¨‹åºé›†ä¸­ç®¡ç†ã€‚ ä¸»è¦åŠŸèƒ½ å…±äº«ï¼šé€šè¿‡ç½‘ç»œå°†æ–‡ä»¶ç³»ç»Ÿå…±äº«ç»™æ‰€æœ‰éœ€è¦çš„ç”¨æˆ·æˆ–è®¡ç®—æœºã€‚ æŒ‚è½½ï¼šä½¿å¾—è¿œç¨‹çš„æ–‡ä»¶ç³»ç»Ÿåƒæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸€æ ·è¢«è®¿é—®ã€‚ 1. å®‰è£… NFSé¦–å…ˆç¡®ä¿å·²ç»å®‰è£…äº† NFS æœåŠ¡å™¨ï¼Œå¦‚æœæœªå®‰è£…ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š sudo apt-get install nfs-kernel-server è¯·æ³¨æ„ï¼Œå¯èƒ½éœ€è¦æœ‰ç®¡ç†å‘˜æƒé™æ‰èƒ½æ‰§è¡Œæ­¤å‘½ä»¤ï¼Œé€šå¸¸éœ€è¦è¾“å…¥å¯†ç ã€‚ 2. é…ç½® NFSå®‰è£…å®Œæˆåï¼Œæ¥ä¸‹æ¥éœ€è¦é…ç½® NFSã€‚éœ€è¦ç¼–è¾‘ NFS æœåŠ¡å™¨çš„å¯¼å‡ºæ–‡ä»¶ /etc/exportsï¼Œè¿™æ˜¯ä¸€ä¸ªä¿å­˜å…±äº«ç›®å½•åŠå…¶æƒé™çš„é…ç½®æ–‡ä»¶ã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ‰“å¼€æ–‡ä»¶ï¼š sudo vi /etc/exports åœ¨æ–‡ä»¶çš„æœ€åä¸€è¡Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œä»¥å…±äº« /nfsboot ç›®å½•ï¼š /nfsboot * (rw,sync,no_subtree_check) nfsbootï¼šè¿™æ˜¯å¸Œæœ›å…±äº«çš„ç›®å½•ã€‚ *****ï¼šè¡¨ç¤ºå…è®¸æ‰€æœ‰ä¸»æœºè®¿é—®è¯¥ç›®å½•ã€‚å¯ä»¥ä¿®æ”¹ä¸ºæŒ‡å®šçš„ IP åœ°å€æˆ–ä¸»æœºåæ¥é™åˆ¶è®¿é—®ã€‚ rwï¼šè¡¨ç¤ºè¯»å†™è®¿é—®æƒé™ã€‚ syncï¼šç¡®ä¿æ•°æ®åœ¨å“åº”è¯·æ±‚ä¹‹å‰å†™å…¥ç£ç›˜ï¼Œå¢åŠ æ•°æ®çš„å®‰å…¨æ€§ã€‚ no_subtree_checkï¼šå…³é—­å­ç›®å½•æ£€æŸ¥ï¼Œå¯æé«˜æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å½“ä¸€ä¸ªå¤§çš„ç›®å½•è¢«å…±äº«æ—¶ã€‚ å¦‚æœ /nfsboot ç›®å½•ä¸å­˜åœ¨ï¼Œéœ€è¦å…ˆåˆ›å»ºå®ƒã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š sudo mkdir /nfsboot ç„¶åï¼Œä¿®æ”¹å…¶æƒé™ä»¥ç¡®ä¿å…¶ä»–ç”¨æˆ·å¯ä»¥è®¿é—®ï¼š sudo chmod 777 /nfsboot -R è¿™é‡Œçš„ 777 æƒé™å…è®¸æ‰€æœ‰ç”¨æˆ·è¿›è¡Œè¯»ã€å†™å’Œæ‰§è¡Œæ“ä½œã€‚ä½¿ç”¨ -R é€‰é¡¹å¯ä»¥é€’å½’åœ°æ›´æ”¹æƒé™ï¼Œä»¥ç¡®ä¿ç›®å½•å†…çš„æ–‡ä»¶ä¹Ÿç»§æ‰¿è¯¥æƒé™ã€‚ 3. é‡å¯ NFS æœåŠ¡ä¿®æ”¹é…ç½®åï¼Œéœ€è¦é‡å¯ NFS æœåŠ¡ä»¥åº”ç”¨æ›´æ”¹ã€‚æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š sudo /etc/init.d/nfs-kernel-server restart å½“çœ‹åˆ° 4 ä¸ªè¿ç»­çš„ â€œOKâ€ æ¶ˆæ¯æ—¶ï¼Œè¯´æ˜æœåŠ¡å·²ç»æˆåŠŸå¯åŠ¨ï¼Œä¸”é…ç½®ç”Ÿæ•ˆã€‚ 4. æµ‹è¯• NFS é…ç½®æ¥ä¸‹æ¥ï¼Œè¿›è¡Œ NFS çš„æŒ‚è½½æµ‹è¯•ã€‚é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªä¸´æ—¶æŒ‚è½½ç‚¹ï¼š cd /mntsudo mkdir /mnt/tempsudo chmod 777 /mnt/temp -R ç„¶åï¼Œæ‰§è¡ŒæŒ‚è½½æ“ä½œï¼Œå°†è¿œç¨‹ NFS ç›®å½•æŒ‚è½½åˆ°æœ¬åœ°çš„ /mnt/tempï¼š sudo mount -t nfs 127.0.0.1:/nfsboot /mnt/temp åœ¨è¿™é‡Œï¼Œ127.0.0.1 æ˜¯æœ¬åœ°ä¸»æœºçš„ IP åœ°å€ï¼Œ/nfsboot æ˜¯ä¹‹å‰é…ç½®çš„å…±äº«ç›®å½•ï¼Œ/mnt/temp æ˜¯æœ¬åœ°æŒ‚è½½ç‚¹ã€‚ å®Œæˆæµ‹è¯•åï¼Œåˆ«å¿˜äº†å¸è½½ NFS ç›®å½•ä»¥é‡Šæ”¾æŒ‚è½½ï¼š sudo umount /mnt/temp é€šè¿‡è¿™äº›æ­¥éª¤ï¼Œå¯ä»¥æˆåŠŸé…ç½®å’Œæµ‹è¯• NFSã€‚è¿™æ ·ï¼Œçš„ç½‘ç»œä¸­çš„å…¶ä»–æœºå™¨ä¾¿å¯ä»¥è½»æ¾è®¿é—®å…±äº«çš„æ–‡ä»¶ç³»ç»Ÿã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç½‘ç»œ"]},{"title":"Linuxé©±åŠ¨ç¼–å†™","path":"/2024/11/07/1-å¹³å°ç³»ç»Ÿ-Linux-é©±åŠ¨-Linuxé©±åŠ¨ç¼–å†™/","content":"ä¸€ã€Linux é©±åŠ¨ç®€è¿°åŠå­—ç¬¦å‹é©±åŠ¨çš„æ¡†æ¶ï¼ˆä¸€ï¼‰è®¾å¤‡é©±åŠ¨æ¦‚å¿µè®¾å¤‡é©±åŠ¨ç¨‹åºæ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸å’Œæœºå™¨ç¡¬ä»¶ä¹‹é—´çš„æ¥å£ï¼Œä¸ºåº”ç”¨ç¨‹åºå±è”½ ç¡¬ä»¶ç»†èŠ‚ï¼Œä½¿ç¡¬ä»¶è®¾å¤‡åœ¨åº”ç”¨ç¨‹åº ä¸­è¡¨ç°ä¸ºè®¾å¤‡æ–‡ä»¶ï¼Œå¯åƒæ“ä½œæ™®é€šæ–‡ä»¶ä¸€æ ·æ“ä½œç¡¬ä»¶ã€‚ä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡è®¾å¤‡é©±åŠ¨ç¨‹åº å‘æ‰“å°æœºå‘é€æ‰“å°æŒ‡ä»¤ï¼Œè€Œæ— éœ€äº†è§£æ‰“å°æœºçš„ç¡¬ä»¶ å®ç°ç»†èŠ‚ã€‚è®¾å¤‡é©±åŠ¨ç¨‹åºä½œä¸ºå†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œå…·å¤‡ä»¥ä¸‹åŠŸèƒ½ï¼š è®¾å¤‡åˆå§‹åŒ–å’Œé‡Šæ”¾ï¼šå¦‚åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶åˆå§‹åŒ–è®¾å¤‡ ï¼Œåœ¨è®¾å¤‡åœ æ­¢ä½¿ç”¨æ—¶é‡Šæ”¾ç›¸å…³èµ„æºã€‚ æ•°æ®ä¼ è¾“ï¼š å®ç°å†…æ ¸ä¸ç¡¬ä»¶ä¹‹é—´çš„æ•°æ®äº¤äº’ï¼ŒåŒ…æ‹¬å°†æ•°æ®ä»å†…æ ¸ ä¼ é€åˆ°ç¡¬ä»¶ ä»¥åŠä»ç¡¬ä»¶è¯»å–æ•°æ®ã€‚ æ•°æ®å¤„ç†ï¼šè¯»å–åº”ç”¨ç¨‹åºä¼ é€ ç»™è®¾å¤‡ æ–‡ä»¶çš„æ•°æ®ï¼Œå¹¶å›é€åº”ç”¨ç¨‹åºè¯·æ±‚çš„æ•°æ®ã€‚ *é”™è¯¯æ£€æµ‹ä¸å¤„ç† *ï¼šåŠæ—¶æ£€æµ‹è®¾å¤‡å‡ºç°çš„é”™è¯¯ï¼Œå¹¶è¿› è¡Œç›¸åº”å¤„ç†ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ è®¾å¤‡ã€é©±åŠ¨ã€å†…æ ¸å’Œåº”ç”¨ç¨‹åºä¹‹é—´å­˜åœ¨ç‰¹å®šçš„è°ƒç”¨å…³ç³»ï¼Œå½¢æˆäº†ä¸€ä¸ªå¤æ‚ä½†é«˜æ•ˆçš„æ¥å£ç³»ç»Ÿã€‚è®¾å¤‡é©±åŠ¨ä½œä¸ºå†…æ ¸ä¸ç”¨æˆ·ç©ºé—´ä¹‹é—´çš„æ¡¥æ¢ï¼Œå®ç°äº†ç¡¬ä»¶å’Œè½¯ä»¶çš„æœ‰æ•ˆäº’åŠ¨ã€‚ä»¥ä¸‹æ˜¯å¯¹å…³é”®ç¯èŠ‚çš„è¯¦ç»†è¯´æ˜å’Œç¤ºä¾‹ã€‚ å†…æ ¸æ¨¡å—ä¸è®¾å¤‡æ³¨å†Œå†…æ ¸æ¨¡å—é€šè¿‡ init_module() å‡½æ•°è¿›è¡Œè®¾å¤‡æ³¨å†Œï¼Œè¿™æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„æ­¥éª¤ã€‚ä¾‹å¦‚ï¼Œå½“æ’å…¥ USB è®¾å¤‡æ—¶ï¼Œå®ƒçš„é©±åŠ¨ç¨‹åºä¼šä½¿ç”¨è¯¥å‡½æ•°å‘ŠçŸ¥å†…æ ¸ä¸€ä¸ªæ–°çš„è®¾å¤‡å·²è¿æ¥ã€‚å†…æ ¸å°†æ­¤ä¿¡æ¯è®°å½•åœ¨å…¶è®¾å¤‡æ ‘ä¸­ï¼Œä»¥ä¾¿åç»­å¤„ç†ã€‚è¿™ä¸€è¿‡ç¨‹ç¡®ä¿äº†è®¾å¤‡èƒ½è¢«æ­£ç¡®è¯†åˆ«å¹¶è¿›è¡Œç›¸åº”çš„é©±åŠ¨ã€‚ é©±åŠ¨ç¨‹åºçš„åŠŸèƒ½ä¸åº”ç”¨ç¨‹åºçš„äº¤äº’é©±åŠ¨ç¨‹åºä¸ºåº”ç”¨ç¨‹åºæä¾›äº†å¯¹è®¾å¤‡çš„ç›´æ¥åŠŸèƒ½ã€‚åº”ç”¨ç¨‹åºé€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥å£ä¸è®¾å¤‡é©±åŠ¨è¿›è¡Œäº¤äº’ï¼Œå¸¸è§çš„ç³»ç»Ÿè°ƒç”¨åŒ…æ‹¬ï¼š **write**ï¼šå°†æ•°æ®å†™å…¥è®¾å¤‡ï¼Œä¾‹å¦‚å°†æ–‡ä»¶å†…å®¹å†™å…¥æ‰“å°æœºã€‚ **read**ï¼šä»è®¾å¤‡è¯»å–æ•°æ®ï¼Œå¦‚ä»ä¼ æ„Ÿå™¨è·å–æ¸©åº¦ä¿¡æ¯ã€‚ **ioctl**ï¼šæ‰§è¡Œè®¾å¤‡ç‰¹å®šçš„æ§åˆ¶æ“ä½œï¼Œä¾‹å¦‚è°ƒæ•´æ‘„åƒå¤´çš„ç„¦è·ã€‚ è¿™äº›æ¥å£ç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ï¼Œåº”ç”¨ç¨‹åºå¼€å‘è€…ä¸å¿…æ·±å…¥æŒæ¡ç¡¬ä»¶ç»†èŠ‚å³å¯åˆ©ç”¨å¤æ‚çš„è®¾å¤‡åŠŸèƒ½ã€‚ æ ‡å‡†æ ¸å¿ƒæœåŠ¡çš„åˆ©ç”¨è®¾å¤‡é©±åŠ¨ç¨‹åºå¹¿æ³›ä½¿ç”¨å†…æ ¸æä¾›çš„æ ‡å‡†æ ¸å¿ƒæœåŠ¡ã€‚è¿™åŒ…æ‹¬ï¼š å†…å­˜åˆ†é…ï¼šè®¾å¤‡é©±åŠ¨å¯ä»¥åŠ¨æ€åˆ†é…å†…å­˜ï¼Œä»¥å­˜å‚¨æ¥æ”¶çš„æ•°æ®æˆ–é…ç½®å‚æ•°ï¼Œä½¿ç”¨å†…å­˜æ± ç­‰æœºåˆ¶ç¡®ä¿æ›´é«˜æ•ˆçš„å†…å­˜ç®¡ç†ã€‚ ä¸­æ–­å‘é€ï¼šç¡¬ä»¶è®¾å¤‡å¯ä»¥é€šè¿‡ä¸­æ–­è¯·æ±‚ï¼ˆIRQï¼‰å‘å†…æ ¸æŠ¥å‘Šäº‹ä»¶ï¼Œé©±åŠ¨ç¨‹åºåœ¨å¤„ç†è¿™äº›ä¸­æ–­æ—¶èƒ½å¤Ÿå“åº”è®¾å¤‡çŠ¶æ€çš„å˜åŒ–ã€‚ ç­‰å¾…é˜Ÿåˆ—ï¼šå½“æ²¡æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œé©±åŠ¨ç¨‹åºå¯ä»¥è®©åº”ç”¨ç¨‹åºè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°æœ‰æ•°æ®å¯ç”¨ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ•´ä½“æ•ˆç‡ã€‚ åŠ¨æ€åŠ è½½ä¸ç”¨æˆ·é…ç½®å¤šæ•° Linux è®¾å¤‡é©±åŠ¨ç¨‹åºæ”¯æŒåŠ¨æ€åŠ è½½ï¼Œè¿™æ„å‘³ç€é©±åŠ¨å¯ä»¥åœ¨éœ€è¦æ—¶è¢«åŠ è½½è‡³å†…æ ¸ï¼Œä»è€Œå‡å°‘å¯åŠ¨æ—¶æ‰€éœ€çš„èµ„æºã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·æ’å…¥æ–°è®¾å¤‡æ—¶ï¼Œç›¸åº”çš„é©±åŠ¨å°†è‡ªåŠ¨åŠ è½½ï¼Œè€Œå½“è®¾å¤‡æ‹”å‡ºåï¼Œè¯¥é©±åŠ¨å¯ä»¥è¢«å¸è½½ã€‚è¿™ç§æœºåˆ¶æå¤§åœ°æé«˜äº†ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ä¸çµæ´»æ€§ã€‚ æ­¤å¤–ï¼Œç”¨æˆ·èƒ½å¤Ÿæ ¹æ®éœ€æ±‚é…ç½® Linux è®¾å¤‡é©±åŠ¨ã€‚è¿™ç§çµæ´»æ€§è¡¨ç°ä¸ºå¯ä»¥å¼€å¯æˆ–å…³é—­ç‰¹å®šçš„é©±åŠ¨åŠŸèƒ½ï¼Œæ¯”å¦‚ä¿®æ”¹è®¾å¤‡çš„å·¥ä½œæ¨¡å¼ã€å¸¦å®½é™åˆ¶æˆ–å…¶ä»–å‚æ•°ï¼Œä»¥æ›´å¥½åœ°é€‚åº”ç‰¹å®šåº”ç”¨åœºæ™¯ã€‚ ï¼ˆäºŒï¼‰Linux è®¾å¤‡åˆ†ç±» å­—ç¬¦è®¾å¤‡ï¼šå­—ç¬¦è®¾å¤‡å®Œæˆè¾“å…¥è¾“å‡ºæ“ä½œæ—¶æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½è¿›è¡Œçš„ã€‚å®ƒä»¬é€šå¸¸ä¸ä½¿ç”¨ç¼“å­˜ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡æ“ä½œéƒ½ç›´æ¥ä¸ç¡¬ä»¶äº¤äº’ï¼Œæ‰€ä»¥é€Ÿåº¦å¯èƒ½è¾ƒæ…¢ã€‚ç”±äºä¸æ”¯æŒéšæœºè®¿é—®ï¼Œå­—ç¬¦è®¾å¤‡åœ¨å¤„ç†æ•°æ®æ—¶ä¸€èˆ¬æ˜¯é¡ºåºè¿›è¡Œçš„ã€‚ä¸€ä¸ªå¸¸è§çš„ä¾‹å­æ˜¯ä¸²å£è®¾å¤‡ï¼Œå¦‚ /dev/ttyS0ï¼Œå®ƒç”¨äºä¸è°ƒåˆ¶è§£è°ƒå™¨å’Œå…¶ä»–ä¸²è¡Œè®¾å¤‡é€šä¿¡ã€‚åœ¨ä¸å­—ç¬¦è®¾å¤‡äº¤äº’æ—¶ï¼Œæ•°æ®å¾€å¾€ä¸€å­—èŠ‚ä¸€å­—èŠ‚åœ°æµåŠ¨ï¼Œå› æ­¤åœ¨æ•°æ®ä¼ è¾“æ—¶ï¼Œå¯èƒ½éœ€è¦è€ƒè™‘æ•ˆç‡å’Œæ—¶å»¶é—®é¢˜ã€‚ å—è®¾å¤‡ï¼šå—è®¾å¤‡åˆ™ä¸å­—ç¬¦è®¾å¤‡æˆªç„¶ä¸åŒï¼Œé‡‡ç”¨äº†å—ä¸ºå•ä½çš„æ•°æ®ä¼ è¾“æ–¹å¼ï¼Œé€šå¸¸å…è®¸å¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œé«˜æ•ˆçš„è¯»å†™ã€‚å®ƒä»¬ä½¿ç”¨ buffer å’Œ cache æ¥æå‡æ€§èƒ½ï¼Œæ”¯æŒéšæœºè®¿é—®ï¼Œè¿™æ„å‘³ç€å¯ä»¥ç›´æ¥è®¿é—®å­˜å‚¨åª’ä½“ä¸Šçš„ä»»æ„ä½ç½®ï¼Œè€Œä¸ç”¨ä¾èµ–äºé¡ºåºè¯»å–ã€‚å—è®¾å¤‡çš„ä¸€ä¸ªå…¸å‹ä¾‹å­æ˜¯ IDE ç¡¬ç›˜ï¼Œé€šå¸¸è¢«æŒ‚è½½åœ¨å¦‚ /dev/sda1 çš„èŠ‚ç‚¹ä¸Šã€‚ç”±äºå…¶çµæ´»æ€§ï¼Œå—è®¾å¤‡ä¸ä»…å¯ä»¥å­˜å‚¨æ•°æ®ï¼Œè¿˜å¯ä»¥åŒæ—¶è¿›è¡Œå¤šä¸ªè¯»å†™æ“ä½œï¼Œæé«˜äº†æ“ä½œç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ï¼Œä½¿ç”¨æˆ·èƒ½å¤ŸåŒæ—¶ä½¿ç”¨å¤šä¸ªåº”ç”¨ç¨‹åºè€Œä¸æ„Ÿåˆ°å»¶è¿Ÿã€‚ ç½‘ç»œè®¾å¤‡ï¼šç½‘ç»œè®¾å¤‡ä¸å‰ä¸¤ç§è®¾å¤‡å®Œå…¨ä¸åŒï¼Œå®ƒä»¬é€šè¿‡ BSD å¥—æ¥å­—æ¥å£è¿›è¡Œäº¤äº’ï¼Œä¸“é—¨ç”¨äºç½‘ç»œæ•°æ®çš„å¤„ç†ã€‚ç½‘ç»œè®¾å¤‡çš„å·¥ä½œä¸ä¾èµ–äºä¼ ç»Ÿçš„è¾“å…¥è¾“å‡ºæ¨¡å¼ï¼Œè€Œæ˜¯å›´ç»•æ•°æ®åŒ…çš„å‘é€å’Œæ¥æ”¶è¿›è¡Œç»„ç»‡ã€‚ä¾‹å¦‚ï¼Œeth0 æ˜¯ä¸€ä¸ªå¸¸è§çš„ç½‘ç»œæ¥å£ï¼Œä»£è¡¨ç³»ç»Ÿä¸­çš„ä»¥å¤ªç½‘è¿æ¥ã€‚ä½¿ç”¨ç½‘ç»œè®¾å¤‡æ—¶ï¼Œå†…æ ¸ä¼šè°ƒç”¨ä¸æ•°æ®åŒ…å¤„ç†ç›¸å…³çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°è´Ÿè´£å‘é€ã€æ¥æ”¶ä»¥åŠå¯èƒ½çš„é‡ä¼ è¯·æ±‚ï¼Œç¡®ä¿æ•°æ®åœ¨ç½‘ç»œä¸­çš„æ­£ç¡®ä¼ è¾“ã€‚è¿™ç§è®¾å¤‡çš„è®¾è®¡ä½¿å¾—ç½‘ç»œé€šä¿¡é«˜æ•ˆä¸”å¯æ‰©å±•ï¼Œé€‚åˆå¤„ç†ç°ä»£ç½‘ç»œåº”ç”¨çš„å¤æ‚éœ€æ±‚ã€‚ ï¼ˆä¸‰ï¼‰ Linux è®¾å¤‡æ–‡ä»¶æ¦‚å¿µåœ¨ Linux æ“ä½œç³»ç»Ÿä¸­ï¼Œç¡¬ä»¶è®¾å¤‡å¹¶ä¸æ˜¯ç›´æ¥ä¸åº”ç”¨ç¨‹åºäº¤äº’ï¼Œè€Œæ˜¯é€šè¿‡æŠ½è±¡ä¸ºæ™®é€šæ–‡ä»¶çš„æ–¹å¼è¿›è¡Œç®¡ç†ã€‚è¿™ç§è®¾è®¡ç†å¿µä½¿å¾—è®¾å¤‡çš„æ“ä½œä¸æ–‡ä»¶ç³»ç»Ÿçš„æ–¹æ³•ç›¸ä¼¼ï¼Œç”¨æˆ·å’Œç¨‹åºé€šè¿‡æ ‡å‡†çš„ç³»ç»Ÿè°ƒç”¨æ¥å£æ¥è¿›è¡Œè®¾å¤‡çš„è¯»å†™æ“ä½œã€‚åœ¨è¿™ä¸€æœºåˆ¶ä¸‹ï¼Œæ–‡ä»¶èŠ‚ç‚¹æˆä¸ºè®¿é—®å„ç§ç¡¬ä»¶è®¾å¤‡çš„æ¡¥æ¢ï¼Œå…¶ä¸­åŒ…æ‹¬å­—ç¬¦è®¾å¤‡å’Œå—è®¾å¤‡ã€‚è¿™äº›å¯¹åº”çš„æ–‡ä»¶ç»Ÿç§°ä¸ºè®¾å¤‡æ–‡ä»¶ï¼Œå­˜å‚¨äº /dev ç›®å½•ä¸­ã€‚ æ¯ä¸ªè®¾å¤‡æ–‡ä»¶éƒ½æœ‰ä¸¤ä¸ªé‡è¦çš„æ ‡è¯†ç¬¦ï¼šä¸»è®¾å¤‡å·å’Œæ¬¡è®¾å¤‡å·ã€‚ä¸»è®¾å¤‡å·ç”¨äºæ ‡è¯†è®¾å¤‡çš„ç§ç±»ä»¥åŠä¸ä¹‹å¯¹åº”çš„é©±åŠ¨ç¨‹åºï¼Œè€Œæ¬¡è®¾å¤‡å·åˆ™ç”¨äºåŒºåˆ†åŒä¸€é©±åŠ¨ç¨‹åºä¸‹çš„ä¸åŒç¡¬ä»¶è®¾å¤‡ã€‚ä¾‹å¦‚ï¼Œ/dev/tty1 ä»£è¡¨ä¸€ä¸ªå­—ç¬¦è®¾å¤‡æ–‡ä»¶ã€‚å…¶ä¸»è®¾å¤‡å·æŒ‡å‘çš„æ˜¯å­—ç¬¦ç»ˆç«¯è®¾å¤‡çš„é©±åŠ¨ç¨‹åºï¼Œè€Œæ¬¡è®¾å¤‡å·ç”¨äºåŒºåˆ† /dev/tty1 å’Œå…¶ä»–ç»ˆç«¯è®¾å¤‡ï¼Œæ¯”å¦‚ /dev/tty2ã€/dev/tty3 ç­‰ï¼Œä»è€Œå®ç°å¯¹å¤šä¸ªç»ˆç«¯çš„ç®¡ç†ã€‚ å®é™…åº”ç”¨ç¤ºä¾‹ï¼š å­—ç¬¦è®¾å¤‡æ–‡ä»¶ï¼š ä¾‹å¦‚ï¼Œé”®ç›˜å’Œé¼ æ ‡éƒ½è¢«è§†ä¸ºå­—ç¬¦è®¾å¤‡ã€‚æ¯å½“é”®ç›˜è¾“å…¥æ•°æ®æ—¶ï¼ŒLinux ä¼šé€šè¿‡å­—ç¬¦è®¾å¤‡æ–‡ä»¶å°†è¾“å…¥çš„å­—ç¬¦ä¼ é€’ç»™æ­£åœ¨è¿è¡Œçš„ç¨‹åºã€‚é€šè¿‡è¯»å–æ–‡ä»¶ /dev/input/event0ï¼Œç³»ç»Ÿèƒ½å¤Ÿæ¥æ”¶åˆ°æ¥è‡ªé”®ç›˜çš„å®æ—¶è¾“å…¥ä¿¡å·ã€‚ å—è®¾å¤‡æ–‡ä»¶ï¼š ç›¸æ¯”ä¹‹ä¸‹ï¼Œå—è®¾å¤‡ï¼ˆå¦‚ç¡¬ç›˜å’Œé—ªå­˜ï¼‰åˆ™ä»¥å—ä¸ºå•ä½è¿›è¡Œæ•°æ®ç®¡ç†ã€‚æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆå¦‚è¯»ã€ä¸ç®¡æ˜¯å†™è¿˜æ˜¯æ ¼å¼åŒ–æ“ä½œï¼‰é€šå¸¸é€šè¿‡å—è®¾å¤‡æ–‡ä»¶è¿›è¡Œã€‚ä¾‹å¦‚ï¼Œ/dev/sda1 ä»£è¡¨ç¬¬ä¸€ä¸ªç¡¬ç›˜çš„ç¬¬ä¸€ä¸ªåˆ†åŒºï¼Œå…è®¸ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºé€šè¿‡è¯¥è®¾å¤‡æ–‡ä»¶è¿›è¡Œæ•°æ®å­˜å‚¨å’Œæ£€ç´¢ã€‚ è¿™ç§è®¾è®¡ä¸ä»…æé«˜äº†ç³»ç»Ÿçš„çµæ´»æ€§ï¼Œè¿˜ç®€åŒ–äº†è®¾å¤‡çš„ä½¿ç”¨æ–¹å¼ï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡æ ‡å‡†çš„æ–‡ä»¶æ“ä½œå‘½ä»¤ï¼Œå¦‚ catã€echo å’Œ dd ç­‰ï¼Œè½»æ¾åœ°ä¸ç¡¬ä»¶è®¾å¤‡è¿›è¡Œäº’åŠ¨ã€‚ ï¼ˆå››ï¼‰Linux å­—ç¬¦å‹é©±åŠ¨ç¨‹åºæ¡†æ¶Linux å­—ç¬¦å‹é©±åŠ¨ç¨‹åºæ¡†æ¶æ˜¯ä¸å­—ç¬¦è®¾å¤‡è¿›è¡Œäº¤äº’çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸»è¦æ¶‰åŠæ³¨å†Œè®¾å¤‡ã€å®šä¹‰åŠŸèƒ½å‡½æ•°ï¼ˆå¦‚ openã€readã€writeã€ioctl ç­‰ï¼‰ä»¥åŠå¸è½½è®¾å¤‡ã€‚å­—ç¬¦è®¾å¤‡é€šå¸¸æŒ‡çš„æ˜¯èƒ½å¤Ÿä»¥å­—ç¬¦æµçš„å½¢å¼è¿›è¡Œæ•°æ®ä¼ è¾“çš„ç¡¬ä»¶è®¾å¤‡ï¼Œæ¯”å¦‚ä¸²å£ã€é”®ç›˜æˆ–ä¸€äº›ä¼ æ„Ÿå™¨ç­‰ã€‚ ä¸€ä¸ªç®€å•çš„å­—ç¬¦é©±åŠ¨ç¨‹åºç”±ä¸ƒä¸ªä¸»è¦å‡½æ•°å’Œä¸€ä¸ªç»“æ„ä½“ç»„æˆã€‚å…·ä½“å¦‚ä¸‹ï¼š **Open**ï¼šè¯¥å‡½æ•°åœ¨æ‰“å¼€è®¾å¤‡æ–‡ä»¶æ—¶è¢«è°ƒç”¨ï¼Œå¹¶è´Ÿè´£è®¾å¤‡åˆå§‹åŒ–çš„å·¥ä½œã€‚å®ƒé€šå¸¸ä¼šæ£€æŸ¥è®¾å¤‡çš„çŠ¶æ€ï¼Œç¡®ä¿è®¾å¤‡å¯ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨æ‰“å¼€ä¸€ä¸ªä¸²å£è®¾å¤‡æ—¶ï¼ŒOpen å‡½æ•°å¯èƒ½éœ€è¦é…ç½®æ³¢ç‰¹ç‡ã€æ•°æ®ä½å’Œåœæ­¢ä½ç­‰å‚æ•°ã€‚ **Release**ï¼šåœ¨å…³é—­è®¾å¤‡æ–‡ä»¶æ—¶ä¼šè°ƒç”¨æ­¤å‡½æ•°ã€‚å…¶ä¸»è¦ä½œç”¨æ˜¯é‡Šæ”¾è®¾å¤‡èµ„æºï¼Œä¾‹å¦‚å…³é—­ä¸²å£è¿æ¥å¹¶ä¿å­˜é…ç½®ä¿¡æ¯ã€‚ **Write**ï¼šè´Ÿè´£å°†æ•°æ®ä»ç”¨æˆ·ç©ºé—´å†™å…¥è®¾å¤‡ã€‚æ­¤å‡½æ•°é€šå¸¸éœ€è¦å°†ç”¨æˆ·æä¾›çš„æ•°æ®å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´ï¼Œå¹¶å¤„ç†å…·ä½“çš„å†™å…¥æ“ä½œï¼Œæ¯”å¦‚å°†æ•°æ®å‘é€åˆ°ä¸²å£ã€‚ **Read**ï¼šä¸ Write ç›¸å¯¹åº”ï¼Œè´Ÿè´£ä»è®¾å¤‡è¯»å–æ•°æ®å¹¶å°†å…¶ä¼ è¾“å›ç”¨æˆ·ç©ºé—´ã€‚æ­¤å‡½æ•°å¯èƒ½å®ç°ç¼“å†²æœºåˆ¶ï¼Œä»¥ç¡®ä¿æ•°æ®çš„é«˜æ•ˆè¯»å–ã€‚ **Ioctl**ï¼šå®ç°è®¾å¤‡ç‰¹å®šçš„æ§åˆ¶å‘½ä»¤ã€‚ç§°ä¸ºè¾“å…¥è¾“å‡ºæ§åˆ¶ï¼ˆIO Controlï¼‰ï¼Œè¿™ä¸ªå‡½æ•°å…è®¸ç”¨æˆ·ç©ºé—´çš„ç¨‹åºå‘é©±åŠ¨å‘é€å‘½ä»¤ï¼Œæ¯”å¦‚è·å–è®¾å¤‡ä¿¡æ¯æˆ–æ›´æ”¹è®¾å¤‡å‚æ•°ã€‚ **Init**ï¼šåœ¨é©±åŠ¨ç¨‹åºåŠ è½½æ—¶è°ƒç”¨ï¼Œç”¨äºåˆå§‹åŒ–è®¾å¤‡å¹¶æ³¨å†Œåˆ°å†…æ ¸ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒInit å‡½æ•°ä¼šè°ƒç”¨ register_chrdev() å‡½æ•°è¿›è¡Œè®¾å¤‡æ³¨å†Œï¼Œå¹¶åˆå§‹åŒ–å¿…è¦çš„æ•°æ®ç»“æ„ã€‚ **Exit**ï¼šç”¨äºæ¸…ç†å’Œå¸è½½è®¾å¤‡ã€‚æ­¤å‡½æ•°ä¼šåœ¨é©±åŠ¨ç¨‹åºè¢«å¸è½½æ—¶è°ƒç”¨ï¼Œé€šå¸¸æ‰§è¡Œåæ³¨å†Œæ“ä½œï¼Œç¡®ä¿è®¾å¤‡èµ„æºè¢«æ­£ç¡®é‡Šæ”¾ã€‚ æ­¤å¤–ï¼Œé©±åŠ¨ç¨‹åºè¿˜éœ€è¦å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ struct file_operationsï¼Œå®ƒåŒ…å«å¯¹ä¸Šé¢æ‰€è¿°çš„æ“ä½œè¿›è¡Œå‡½æ•°æŒ‡é’ˆçš„å®šä¹‰ã€‚è¿™ä¸ªç»“æ„ä½“æ˜¯ä¸å†…æ ¸è¿›è¡Œäº¤äº’çš„æ¡¥æ¢ï¼Œä¾‹å¦‚ï¼š struct file_operations my_fops = .owner = THIS_MODULE, .open = my_open, .release = my_release, .write = my_write, .read = my_read, .unlocked_ioctl = my_ioctl,; åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œmy_fops å®šä¹‰äº†å„ä¸ªå‡½æ•°çš„å®ç°ï¼Œä½¿å¾—å†…æ ¸èƒ½å¤Ÿåœ¨ç›¸åº”æ“ä½œæ—¶è°ƒç”¨è¿™äº›å‡½æ•°ã€‚é€šè¿‡å®ç°è¿™äº›å‡½æ•°ï¼Œé©±åŠ¨ç¨‹åºä¸ºè®¾å¤‡æä¾›äº†å…·ä½“çš„æ“ä½œåŠŸèƒ½ï¼Œä½¿å¾—ç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿæ–¹ä¾¿åœ°ä¸ç¡¬ä»¶è®¾å¤‡é€šä¿¡ã€‚è¿™ä¸ªæ¡†æ¶ä¸ºå„ç§å­—ç¬¦è®¾å¤‡æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œå¤§å¤§ç®€åŒ–äº†è®¾å¤‡é©±åŠ¨çš„å¼€å‘è¿‡ç¨‹ã€‚ äºŒã€åŸºäº Gpio çš„ Linux å­—ç¬¦å‹é©±åŠ¨è®¾è®¡ï¼ˆä¸€ï¼‰æµæ°´ç¯ Linux é©±åŠ¨æ­¥éª¤ ç¼–å†™å­—ç¬¦è®¾å¤‡é©±åŠ¨åœ¨ /linux-3.2/drivers/char/sep4020_char/ ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªåä¸º sep4020_flowled.c çš„æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶éœ€è¦å®šä¹‰ä¸€ä¸ªè®¾å¤‡ç›¸å…³çš„ç»“æ„ä½“ï¼Œé€šå¸¸åŒ…æ‹¬è®¾å¤‡çš„åŸºæœ¬ä¿¡æ¯å’ŒçŠ¶æ€ã€‚é©±åŠ¨ç¨‹åºéœ€è¦å®ç°å¦‚ä¸‹å…³é”®å‡½æ•°ï¼š openï¼šè®¾å¤‡æ‰“å¼€æ—¶è°ƒç”¨ã€‚åœ¨æ­¤å‡½æ•°ä¸­ï¼Œå¯ä»¥åˆå§‹åŒ–è®¾å¤‡çš„ç¡¬ä»¶çŠ¶æ€ã€‚ releaseï¼šè®¾å¤‡å…³é—­æ—¶è°ƒç”¨ï¼Œé€šå¸¸ç”¨äºé‡Šæ”¾èµ„æºå’Œæ¸…ç†çŠ¶æ€ã€‚ writeï¼šç”¨äºå®ç°å‘è®¾å¤‡å†™å…¥æ•°æ®çš„åŠŸèƒ½ï¼Œå½“å‰å¯ä»¥å…ˆç½®ç©ºï¼Œä»¥åæ ¹æ®éœ€æ±‚æ·»åŠ åŠŸèƒ½ã€‚ readï¼šç”¨äºä»è®¾å¤‡è¯»å–æ•°æ®ï¼Œå½“å‰ä¹Ÿå¯ä»¥å…ˆç½®ç©ºã€‚ ioctlï¼šç”¨äºå‘é€è®¾å¤‡æ§åˆ¶å‘½ä»¤ï¼Œå¤„ç†ç”¨æˆ·ç©ºé—´çš„è¯·æ±‚å’Œè®¾å¤‡çš„å…·ä½“æ“ä½œã€‚ æ­¤å¤–ï¼Œä»£ç ä¸­è¿˜éœ€è¦åŒ…å«è®¾å¤‡çš„åˆå§‹åŒ–å’Œæ³¨é”€å‡½æ•°ï¼Œä»¥ä¾¿åœ¨æ¨¡å—åŠ è½½å’Œå¸è½½æ—¶æ­£ç¡®åœ°ç®¡ç†è®¾å¤‡èµ„æºã€‚ åŠ è½½é©±åŠ¨ç¨‹åºé©±åŠ¨ç¨‹åºå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼åŠ è½½åˆ°å†…æ ¸ä¸­ï¼š é™æ€åŠ è½½ï¼šåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œå°†é©±åŠ¨ç¨‹åºç¼–è¯‘è¿›å†…æ ¸ã€‚éœ€è¦åœ¨å†…æ ¸é…ç½®ä¸­é€‰æ‹©è¯¥é©±åŠ¨ï¼Œå¹¶é‡æ–°ç¼–è¯‘å†…æ ¸ã€‚åœ¨å®Œæˆé…ç½®åï¼Œè¿è¡Œ make å‘½ä»¤ï¼Œç¼–è¯‘å†…æ ¸é•œåƒã€‚åœ¨è®¾å¤‡å¯åŠ¨åï¼Œä¼šè‡ªåŠ¨åŠ è½½è¿™ä¸ªé©±åŠ¨ã€‚ åŠ¨æ€åŠ è½½ï¼šé€šå¸¸åœ¨ç³»ç»Ÿå¯åŠ¨åä½¿ç”¨ insmod å‘½ä»¤æ‰‹åŠ¨åŠ è½½é©±åŠ¨æ¨¡å—ã€‚é’ˆå¯¹è°ƒè¯•é˜¶æ®µï¼ŒåŠ¨æ€åŠ è½½å¯ä»¥ä¾¿äºé¢‘ç¹åœ°æµ‹è¯•å’Œæ›´æ–°é©±åŠ¨ã€‚å®ä¾‹æ‰§è¡Œ insmod sep4020_flowled.ko åï¼Œå¯ä½¿ç”¨ cat /proc/devices å‘½ä»¤æŸ¥çœ‹é©±åŠ¨æ˜¯å¦åŠ è½½æˆåŠŸã€‚ ç¼–å†™åº”ç”¨ç¨‹åºæµ‹è¯•è®¾å¤‡é©±åŠ¨æ–°å»ºä¸€ä¸ªåä¸º flowled.c çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æµ‹è¯•ä¾èµ–é©±åŠ¨çš„åº”ç”¨ç¨‹åºä»£ç ã€‚åœ¨ main å‡½æ•°ä¸­ï¼Œå®ç°å¦‚ä¸‹åŠŸèƒ½ï¼š ä½¿ç”¨ open ç³»ç»Ÿè°ƒç”¨æ‰“å¼€è®¾å¤‡æ–‡ä»¶ï¼Œç¡®ä¿è®¾å¤‡å·²å‡†å¤‡å°±ç»ªã€‚ é€šè¿‡ ioctl ç³»ç»Ÿè°ƒç”¨å‘è®¾å¤‡å‘é€æ§åˆ¶å‘½ä»¤ï¼Œå®ç°æµæ°´ç¯çš„äº®ç­æ•ˆæœã€‚ æœ€åï¼Œä½¿ç”¨ close å…³é—­è®¾å¤‡æ–‡ä»¶ï¼Œç¡®ä¿èµ„æºçš„é‡Šæ”¾ã€‚ ä½¿ç”¨äº¤å‰ç¼–è¯‘å·¥å…·ï¼Œä¾‹å¦‚ arm-linux-gccï¼Œå°†åº”ç”¨ç¨‹åºç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶å°†å…¶æ‹·è´åˆ°å¼€å‘æ¿ä¸Šè¿è¡Œè¿›è¡Œæµ‹è¯•ã€‚ ï¼ˆäºŒï¼‰é©±åŠ¨ç¨‹åºå®ç°ç»†èŠ‚ è®¾å¤‡ç»“æ„ä½“å®šä¹‰å®šä¹‰åä¸º struct led_dev çš„ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“é€šå¸¸åŒ…å«ï¼š struct cdev cdevï¼šLinux å­—ç¬¦è®¾å¤‡ç»“æ„ä½“ï¼Œå¸®åŠ©å†…æ ¸ç®¡ç†è®¾å¤‡ã€‚ int valueï¼šè¡¨ç¤º LED å½“å‰çŠ¶æ€çš„å€¼ï¼Œå¯èƒ½å–å€¼ 0 è¡¨ç¤ºå…³é—­ï¼Œ1 è¡¨ç¤ºå¼€å¯ã€‚ æ“ä½œå‡½æ•°å®ç° open å’Œ release å‡½æ•°ï¼šè¿™ä¸¤ä¸ªå‡½æ•°åœ¨è®¾å¤‡æ‰“å¼€å’Œå…³é—­æ—¶è¢«è°ƒç”¨ã€‚åœ¨ open å‡½æ•°ä¸­ï¼Œå¯ä»¥æ‰§è¡Œè®¾å¤‡åˆå§‹åŒ–çš„ç›¸å…³æ“ä½œã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ sep4020_flowled_open å‡½æ•°è°ƒç”¨ sep4020_flowled_setup å‡½æ•°å®ç°å…·ä½“çš„ç¡¬ä»¶åˆå§‹åŒ–æ­¥éª¤ï¼Œå¯èƒ½æ¶‰åŠé…ç½® GPIO å¼•è„šçš„æ¨¡å¼å’ŒçŠ¶æ€ã€‚ write å’Œ read å‡½æ•°ï¼šç›®å‰å¯ä»¥å…ˆä¿æŒä¸ºç©ºã€‚åœ¨è¿›è¡Œè¿›ä¸€æ­¥è®¾è®¡æ—¶ï¼Œå¯ä»¥æ·»åŠ å…·ä½“çš„æ•°æ®å†™å…¥å’Œè¯»å–é€»è¾‘ï¼Œä»¥æ”¯æŒç‰¹å®šçš„åŠŸèƒ½ã€‚ ioctl å‡½æ•°ï¼šè¯¥å‡½æ•°ç”¨äºç®¡ç†è®¾å¤‡æ§åˆ¶æ“ä½œã€‚å…·ä½“å®ç°ä¸­ï¼Œsep4020_flowled_ioctl å‡½æ•°æ ¹æ®ä¼ å…¥çš„å‘½ä»¤ cmdï¼ˆä¾‹å¦‚å®šä¹‰å¸¸é‡ LED_ONã€LED_OFFï¼‰æ¥æ§åˆ¶ LED ç¯çš„ç‚¹äº®æˆ–ç†„ç­ã€‚è¿™é€šå¸¸é€šè¿‡å¯¹ GPIO_PORTE_DATA_V å¯„å­˜å™¨çš„æ“ä½œæ¥å®ç°ã€‚ è®¾å¤‡åˆå§‹åŒ–å’Œæ³¨é”€ è®¾å¤‡åˆå§‹åŒ–å‡½æ•° sep4020_flowled_init æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š åŠ¨æ€ç”³è¯·è®¾å¤‡å·ï¼Œæˆ–è€…æŒ‰ç…§å…ˆå‰é¢„ç•™çš„é™æ€è®¾å¤‡å·è¿›è¡Œæ³¨å†Œã€‚ åŠ¨æ€åˆ†é…è®¾å¤‡ç»“æ„ä½“çš„å†…å­˜ä»¥å­˜å‚¨è®¾å¤‡çŠ¶æ€ã€‚ è°ƒç”¨ç¡¬ä»¶åˆå§‹åŒ–å‡½æ•°ï¼ˆå¯ä»¥åœ¨ open å‡½æ•°ä¸­è°ƒæ•´å®ç°æ—¶æœºï¼‰ï¼Œä¾‹å¦‚è®¾ç½® GPIO å¼•è„šã€‚ æ³¨å†Œå­—ç¬¦è®¾å¤‡ï¼Œåˆ›å»ºè®¾å¤‡æ–‡ä»¶èŠ‚ç‚¹ï¼Œé€šå¸¸åœ¨ /dev/ ç›®å½•ä¸‹è®¿é—®ã€‚ è®¾å¤‡æ³¨é”€å‡½æ•° sep4020_flowled_exit ä¸­ï¼Œæ‰§è¡Œæ³¨é”€è®¾å¤‡æ“ä½œï¼š åˆ é™¤è®¾å¤‡æ–‡ä»¶ï¼Œç¡®ä¿ä¸å†è®¿é—®è®¾å¤‡ã€‚ é‡Šæ”¾åˆ†é…ç»™è®¾å¤‡ç»“æ„ä½“çš„å†…å­˜ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚ æ³¨é”€è®¾å¤‡å·ï¼Œç¡®ä¿è¯¥è®¾å¤‡å·åç»­ä¸è¢«å ç”¨ã€‚ ï¼ˆä¸‰ï¼‰é©±åŠ¨åŠ è½½ä¸åº”ç”¨ç¨‹åºæµ‹è¯• é©±åŠ¨åŠ è½½ åŠ¨æ€åŠ è½½ï¼š åœ¨å¼€å‘æ¿ä¸Šï¼Œå°† sep4020_flowled.ko æ–‡ä»¶å¤åˆ¶åˆ°ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ /demo/ ç›®å½•ä¸­ã€‚ åœ¨ /dev/ ç›®å½•åˆ›å»ºåä¸º flowled çš„è®¾å¤‡èŠ‚ç‚¹ï¼Œä½¿ç”¨å‘½ä»¤ mknod flowled c 249 0ã€‚ é€šè¿‡ insmod sep4020_flowled.ko å‘½ä»¤åŠ è½½é©±åŠ¨ç¨‹åºï¼Œä½¿ç”¨ cat /proc/devices å‘½ä»¤ç¡®è®¤é©±åŠ¨ç¨‹åºæ˜¯å¦å·²æˆåŠŸåŠ è½½ã€‚ é™æ€åŠ è½½ï¼š åœ¨ç»ˆç«¯ä¸­å¯¼èˆªè‡³ Linux æ ¹ç›®å½•ï¼Œè¾“å…¥ make menuconfigï¼Œå°†åŠ©æ‰‹é©±åŠ¨é…ç½®ä¸ºåœ¨å†…æ ¸ä¸­é™æ€ç¼–è¯‘ï¼ˆé€‰æ‹© *ï¼‰ã€‚ è¿è¡Œ make å‘½ä»¤ç¼–è¯‘å†…æ ¸ä»¥ç”Ÿæˆæ–°é•œåƒã€‚ ä½¿ç”¨ mkimage å‘½ä»¤é‡æ–°ç”Ÿæˆèƒ½å¤Ÿè¢« uboot å¼•å¯¼çš„å†…æ ¸ã€‚ å°†ç¼–è¯‘å¥½çš„æ–°å†…æ ¸æ‹·è´åˆ° tftp ç›®å½•ï¼Œé‡å¯å¼€å‘æ¿ï¼Œè®¿é—® /dev/ ç›®å½•ï¼Œåˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ flowledã€‚ åº”ç”¨ç¨‹åºæµ‹è¯• æ–°å»ºä¸€ä¸ªåä¸º flowled.c çš„æ–‡ä»¶ã€‚ åœ¨ main å‡½æ•°ä¸­ï¼Œå®ç°å¦‚ä¸‹æ­¥éª¤ï¼š ä½¿ç”¨ open ç³»ç»Ÿè°ƒç”¨æ‰“å¼€è®¾å¤‡æ–‡ä»¶ï¼Œç¡®ä¿è®¾å¤‡å·²æˆåŠŸåŠ è½½ã€‚ é€šè¿‡ ioctl è°ƒç”¨æ§åˆ¶æµæ°´ç¯çš„äº®ç­çŠ¶æ€ã€‚ æœ€åï¼Œä½¿ç”¨ close å…³é—­è®¾å¤‡æ–‡ä»¶ï¼Œé‡Šæ”¾æ‰€å èµ„æºã€‚ ä½¿ç”¨äº¤å‰ç¼–è¯‘å·¥å…· arm-linux-gcc å°†æµ‹è¯•ç¨‹åºç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ flowledï¼Œæ‹·è´è‡³å¼€å‘æ¿çš„ nfs æ–‡ä»¶å¤¹ä¸‹ï¼Œè¿è¡Œåè§‚å¯Ÿè¾“å‡ºç»“æœå¹¶è¿›è¡ŒåŠŸèƒ½æµ‹è¯•ã€‚ ä¸‰ã€Linux é”®ç›˜é©±åŠ¨çš„è®¾è®¡ï¼ˆä¸€ï¼‰é”®ç›˜ç¡¬ä»¶åŸç†ä¸é©±åŠ¨è®¾è®¡è¦ç‚¹5X5 é”®ç›˜é‡‡ç”¨åˆ—ä¸­æ–­å’Œè¡Œæ‰«æåŸç†ã€‚åœ¨æ­¤è®¾è®¡ä¸­ï¼Œæ¯è¡Œå’Œæ¯åˆ—è¿æ¥è‡³æ§åˆ¶å™¨ã€‚å½“æŸä¸ªæŒ‰é”®è¢«æŒ‰ä¸‹æ—¶ï¼Œåˆ—çº¿å°†äº§ç”Ÿä¸­æ–­ä¿¡å·ã€‚æ¥ç€ï¼Œç³»ç»Ÿä¼šä½¿ç”¨ä¸­æ–­å¤„ç†å‡½æ•°æ‰«ææ‰€æœ‰è¡Œçº¿ï¼Œä»¥ç¡®å®šæŒ‰é”®çš„ç¡®åˆ‡ä½ç½®ã€‚ä¸ºäº†æ¶ˆé™¤æŒ‰é”®æŠ–åŠ¨ï¼Œå³åœ¨æŒ‰é”®åŠ¨ä½œæ—¶å¯èƒ½äº§ç”Ÿçš„è¯¯åˆ¤ï¼Œè®¾è®¡ä¸­ä¼šå¼•å…¥è½¯ä»¶å»¶æ—¶ã€‚å½“ç³»ç»Ÿåˆ¤æ–­æœ‰æŒ‰é”®æŒ‰ä¸‹åï¼Œå†æ¬¡ç¡®è®¤é”®ç›˜çš„çŠ¶æ€ä»¥ç¡®ä¿æŒ‰é”®ç¡®å®æœ‰æ•ˆè¢«æŒ‰ä¸‹ã€‚è¿™ä¸€è¿‡ç¨‹æœ‰æ•ˆåœ°å‡å°‘äº†è¯¯è§¦å‘çš„æ¦‚ç‡ã€‚ Linux é”®ç›˜é©±åŠ¨è®¾è®¡æ¶‰åŠè¯¸å¤šçŸ¥è¯†ç‚¹ï¼ŒåŒ…æ‹¬ä¸­æ–­ä½¿ç”¨ã€å®šæ—¶å™¨ä½¿ç”¨å’Œä¿¡å·é‡ç®¡ç†ã€‚åŒæ—¶ï¼Œä¹Ÿéœ€è¦è®¾è®¡é«˜æ•ˆçš„ç¼“å†²åŒºï¼Œè€ƒè™‘ç”¨æˆ·çš„é˜»å¡ä¸éé˜»å¡è¯»å–æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤šç”¨æˆ·ç¯å¢ƒä¸‹ï¼Œå¦‚å¤šäººåŒæ—¶ä½¿ç”¨ç³»ç»Ÿæˆ–é¢‘ç¹æ“ä½œé”®ç›˜çš„æƒ…å†µä¸‹ï¼Œåˆç†çš„ç¼“å†²åŒºè®¾è®¡èƒ½å¤Ÿæœ‰æ•ˆé˜²æ­¢æ•°æ®çš„ä¸¢å¤±æˆ–æ··ä¹±ï¼Œç¡®ä¿æ¯ä¸ªç”¨æˆ·çš„è¾“å…¥éƒ½èƒ½è¢«å‡†ç¡®æ•æ‰ã€‚ ï¼ˆäºŒï¼‰Linux ä¸­æ–­ä¸å®šæ—¶å™¨ä½¿ç”¨ ä¸­æ–­ä½¿ç”¨ æ³¨å†Œä¸­æ–­å¤„ç†ç¨‹åºï¼šä½¿ç”¨ request_irq å‡½æ•°æ¥æ³¨å†Œä¸­æ–­ï¼Œä¼ å…¥ä¸­æ–­å·ã€ä¸­æ–­å¤„ç†å‡½æ•°çš„æŒ‡é’ˆå’Œä¸­æ–­çš„æ ‡å¿—ç­‰å‚æ•°ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨è¯¥è¯­å¥ request_irq(INTSRC_EXTINT0, sep4020_key_irqhandler, SA_INTERRUPT, 4020KEY, NULL) æ¥å®Œæˆä¸­æ–­çš„æ³¨å†Œã€‚ ä¸­æ–­å¤„ç†å‡½æ•°ï¼šå³åœ¨ä¸­æ–­å‘ç”Ÿæ—¶æ‰§è¡Œçš„å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œsep4020_key_irqhandler å‡½æ•°ä¼šåœ¨ä¸­æ–­å‘ç”Ÿæ—¶æ¸…é™¤ä¸­æ–­æ ‡å¿—ï¼Œå¹¶å¯èƒ½å¯åŠ¨å®šæ—¶å™¨ç­‰å¤„ç†ã€‚ æ³¨é”€ä¸­æ–­ï¼šé€šè¿‡ free_irq å‡½æ•°é‡Šæ”¾ä¸­æ–­èµ„æºï¼Œå¦‚è¯­å¥ free_irq(INTSRC_EXTINT0, NULL) é‡å¤è¿›è¡Œä¸­æ–­æ³¨é”€æ“ä½œï¼Œç¡®ä¿é‡Šæ”¾ç›¸å…³èµ„æºã€‚ å®šæ—¶å™¨ä½¿ç”¨ å®šä¹‰å®šæ—¶å™¨ï¼šå¯é€šè¿‡å®šä¹‰ struct timer_list ç±»å‹çš„å˜é‡æ¥å®ç°å®šæ—¶å™¨ï¼Œå¦‚ key_timerã€‚ åˆå§‹åŒ–å®šæ—¶å™¨ï¼šä½¿ç”¨ setup_timer å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ï¼Œè®¾ç½®å®šæ—¶å™¨çš„å¤„ç†å‡½æ•°å’Œç›¸å…³å‚æ•°ï¼Œä¾‹å¦‚ï¼š setup_timer(key_timer, key_timer_handler, 0)ã€‚ å®šæ—¶å™¨å¤„ç†å‡½æ•°ï¼šå½“å®šæ—¶å™¨åˆ°æœŸæ—¶æ‰§è¡Œçš„å‡½æ•°ï¼Œä¾‹å¦‚ key_timer_handler å‡½æ•°å†…ä¼šè¿›è¡ŒæŒ‰é”®çŠ¶æ€çš„åˆ¤æ–­å’Œé”®å€¼çš„è·å–ç­‰æ“ä½œã€‚ å¯åŠ¨å’Œåˆ é™¤å®šæ—¶å™¨ï¼šä½¿ç”¨ add_timer å‡½æ•°å¯åŠ¨å®šæ—¶å™¨ï¼Œä½¿ç”¨ del_timer å‡½æ•°æ¥åˆ é™¤ä¸å†éœ€è¦çš„å®šæ—¶å™¨ã€‚ ï¼ˆä¸‰ï¼‰é”®ç›˜é©±åŠ¨å‡½æ•°å®ç° Init åŠ è½½å‡½æ•°ï¼šè´Ÿè´£æ³¨å†Œä¸­æ–­å‡½æ•°ï¼Œåˆå§‹åŒ–å­—ç¬¦è®¾å¤‡ç»“æ„ä½“ï¼Œè®¾ç½®å®šæ—¶å™¨ï¼Œå®Œæˆå­—ç¬¦è®¾å¤‡çš„æ³¨å†Œï¼Œå¹¶åˆ›å»ºè®¾å¤‡æ–‡ä»¶èŠ‚ç‚¹ã€‚ exit å¸è½½å‡½æ•°ï¼šæ­¤å‡½æ•°ç”¨äºé‡Šæ”¾ä¸­æ–­èµ„æºã€åˆ é™¤å­—ç¬¦è®¾å¤‡ã€é‡Šæ”¾è®¾å¤‡ç»“æ„ä½“çš„å†…å­˜ï¼Œå¹¶æ³¨é”€è®¾å¤‡å·ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿèµ„æºçš„æœ‰æ•ˆå›æ”¶ã€‚ Open å‡½æ•°ï¼šåˆå§‹åŒ–æŒ‰é”®çŠ¶æ€ï¼Œå¹¶è°ƒç”¨ sep4020_key_setup å‡½æ•°è¿›è¡Œç›¸å…³è®¾ç½®ï¼ŒåŒ…æ‹¬åˆå§‹åŒ– GPIO å£çº¿ã€è®¾ç½®è¾“å…¥è¾“å‡ºæ–¹å‘ã€æŒ‡å®šä¸­æ–­è§¦å‘æ–¹å¼ç­‰ã€‚ ä¸­æ–­å¤„ç†å‡½æ•°ï¼šåœ¨è¿™é‡Œï¼Œåº”å½“å±è”½æŒ‰é”®ä¸­æ–­ï¼Œæ¸…é™¤ä¸­æ–­æ ‡å¿—ï¼Œç¡®å®šæŒ‰é”®çŠ¶æ€ä¸ºä¸ç¡®å®šï¼Œç„¶åå¯åŠ¨å®šæ—¶å™¨ã€‚ç”±äºè¿™æ˜¯ä¸€ä¸ªå…³é”®æ­¥éª¤ï¼Œä¿è¯åœ°ä½çš„ç¨³å®šä¸å‡†ç¡®ï¼Œç¡®ä¿åç»­çš„æ•°æ®èƒ½å¤Ÿæ­£ç¡®å¤„ç†ã€‚ Timer åˆ°æœŸçš„ä¸­æ–­å¤„ç†å‡½æ•°ï¼šå½“å®šæ—¶å™¨åˆ°æœŸæ—¶ï¼Œæ­¤å‡½æ•°ä¼šè¯»å–æŒ‰é”®çŠ¶æ€ï¼Œå¹¶æ ¹æ®çŠ¶æ€åˆ¤æ–­æŒ‰é”®æ˜¯å¦è¢«æŒ‰ä¸‹ã€‚å¦‚æœåˆ¤æ–­ä¸ºæŒ‰ä¸‹ï¼Œåˆ™è·å–é”®å€¼ã€æ›´æ–°æŒ‰é”®çŠ¶æ€ï¼Œå¹¶å†æ¬¡å¯åŠ¨å®šæ—¶å™¨ä»¥å¤‡ä¸‹æ¬¡æ£€æµ‹ã€‚ **è·å–é”®å€¼å‡½æ•° key_event**ï¼šé€šè¿‡è¯»å–ç‰¹å®šå¯„å­˜å™¨è·å–å½“å‰æŒ‰é”®ä¿¡æ¯ï¼Œé¦–å…ˆè¯†åˆ«åˆ—æ•°ä¸è¡Œæ•°ï¼Œè¿›è€Œè®¡ç®—å¹¶è¿”å›é”®å€¼ã€‚ Read å‡½æ•°ï¼šæ­¤å‡½æ•°ä½¿ç”¨ä¿¡å·é‡æ¥ä¿æŠ¤ä¸´ç•ŒåŒºï¼Œå°†å½“å‰æŒ‰é”®çŠ¶æ€å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¹¶è¿”å›æ“ä½œç»“æœä»¥ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚ ï¼ˆå››ï¼‰ä¿¡å·é‡ä¸ç”¨æˆ·ç©ºé—´å†…æ ¸ç©ºé—´äº¤äº’ ä¿¡å·é‡ä½¿ç”¨ å®šä¹‰ä¿¡å·é‡ï¼šå¯å®šä¹‰ struct semaphore ç±»å‹çš„å˜é‡ï¼Œä¾‹å¦‚ key_semã€‚ åˆå§‹åŒ–ä¿¡å·é‡ï¼šé€šè¿‡ sema_init æˆ–ä½¿ç”¨å® DECLARE_MUTEX æ¥åˆå§‹åŒ–ä¿¡å·é‡ï¼Œä»¥ä¾¿åç»­æ“ä½œã€‚ è·å–ä¿¡å·é‡ï¼šä½¿ç”¨ downã€down_interruptible æˆ– down_trylock å‡½æ•°è·å–ä¿¡å·é‡ï¼Œå…¶ä¸­ down_interruptible å¯ä»¥åœ¨è·å–å¤±è´¥æ—¶ä½¿å¾—è¿›ç¨‹è¢«ä¿¡å·æ‰“æ–­ã€‚è‹¥è¿”å›é 0 åˆ™åº”å½“åŠæ—¶è¿”å›é”™è¯¯ç ã€‚ é‡Šæ”¾ä¿¡å·é‡ï¼šé€šè¿‡ up å‡½æ•°é‡Šæ”¾ä¿¡å·é‡ï¼Œå”¤é†’æ­£åœ¨ç­‰å¾…çš„è¿›ç¨‹ï¼Œç¡®ä¿å¹¶å‘ç¯å¢ƒä¸‹çš„èµ„æºæœ‰æ•ˆåˆ©ç”¨ã€‚ ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´äº’è®¿ï¼šç”±äºå†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´çš„å†…å­˜ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œå› æ­¤éœ€è¦é€šè¿‡ç³»ç»Ÿæä¾›çš„å‡½æ•°æ¥è¿›è¡Œæ•°æ®äº¤æ¢ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ copy_from_user è¿›è¡Œå¤šå­—èŠ‚çš„æ•°æ®å¤åˆ¶ä»ç”¨æˆ·ç©ºé—´åˆ°å†…æ ¸ç©ºé—´ï¼Œä½¿ç”¨ copy_to_user åˆ™è¿›è¡Œä»å†…æ ¸ç©ºé—´å›ç”¨æˆ·ç©ºé—´çš„å¤šå­—èŠ‚å¤åˆ¶ã€‚æ­¤å¤–ï¼Œput_user å’Œ get_user å‡½æ•°ç”¨äºç®€å•æ•°æ®ç±»å‹çš„è½¬æ¢ã€‚ ï¼ˆäº”ï¼‰é”®ç›˜é©±åŠ¨éªŒè¯åœ¨éªŒè¯é˜¶æ®µï¼Œå°†é”®ç›˜é©±åŠ¨é€šè¿‡æ¨¡å—åŠ è½½æˆ–é™æ€æ–¹å¼åŠ è½½è‡³å†…æ ¸ï¼Œå¹¶ç¼–å†™ä¸ä¹‹é…åˆçš„åº”ç”¨ç¨‹åºã€‚å°†åº”ç”¨ç¨‹åºè¿›è¡Œäº¤å‰ç¼–è¯‘åï¼Œéƒ¨ç½²è‡³å¼€å‘æ¿ä¸Šè¿è¡Œã€‚åº”ç”¨ç¨‹åºé¦–å…ˆé€šè¿‡ open æ‰“å¼€è®¾å¤‡æ–‡ä»¶ï¼Œç„¶ååˆ©ç”¨ read å‡½æ•°è¯»å–æŒ‰é”®å€¼ï¼Œæœ€ç»ˆå…³é—­è®¾å¤‡æ–‡ä»¶ã€‚è¿™ä¸€ç³»åˆ—æ“ä½œèƒ½å¤Ÿæœ‰æ•ˆéªŒè¯é”®ç›˜é©±åŠ¨æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œç¡®ä¿é©±åŠ¨çš„ç¨³å®šæ€§ä¸å¯é æ€§ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","é©±åŠ¨"]},{"title":"ä¸­æ–­ç”³è¯·","path":"/2024/11/06/1-å¹³å°ç³»ç»Ÿ-Linux-é©±åŠ¨-ä¸­æ–­ç”³è¯·/","content":"åœ¨ Linux ä¸­ï¼Œä¸­æ–­å¤„ç†æœºåˆ¶çš„è®¾è®¡æ—¨åœ¨æé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦å’Œæ•ˆç‡ã€‚è¯¥æœºåˆ¶åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼šé¡¶åŠï¼ˆtop halfï¼‰å’Œåº•åŠï¼ˆbottom halfï¼‰ã€‚é¡¶åŠè´Ÿè´£å¤„ç†ä¼˜å…ˆçº§è¾ƒé«˜çš„ä»»åŠ¡ï¼Œå¹¶è¦æ±‚åœ¨ä¸­æ–­è§¦å‘åå°½å¯èƒ½ç¼©çŸ­å¤„ç†æ—¶é—´ã€‚å®Œæˆé¡¶åŠä»»åŠ¡åï¼Œç³»ç»Ÿä¼šæ¿€æ´»åº•åŠï¼Œç”¨äºå¤„ç†å…¶ä½™çš„ä»»åŠ¡ã€‚ åº•åŠçš„å¤„ç†æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§ï¼šsoft_irqã€tasklet å’Œ workqueueã€‚æ¯ç§æ–¹å¼çš„ä½¿ç”¨åœºæ™¯å’Œé€‚ç”¨æ¡ä»¶ä¸åŒã€‚soft_irq é€šå¸¸ç”¨äºé‚£äº›å¯¹å¤„ç†æ—¶é—´è¦æ±‚è¾ƒç´§è¿«çš„é‡è¦ä»»åŠ¡ï¼Œä¸»è¦æ¶‰åŠç³»ç»Ÿçš„ä¸€äº›å­æ¨¡å—ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè®¾å¤‡é©±åŠ¨è¾ƒå°‘ä½¿ç”¨ soft_irqã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œtasklet å’Œ workqueue åœ¨å¸¸è§„è®¾å¤‡é©±åŠ¨ä¸­ä½¿ç”¨è¾ƒå¤šã€‚å®ƒä»¬ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼štasklet æ˜¯åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œè€Œ workqueue åˆ™æ˜¯åœ¨è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œå› æ­¤ workqueue èƒ½å¤Ÿå¤„ç†å¯èƒ½ä¼šå¯¼è‡´é˜»å¡çš„æ“ä½œã€‚ åœ¨ Linux å†…æ ¸ 2.6.30 ä¹‹åï¼Œæ–°å¢äº†ä¸€ä¸ªåä¸º request_threaded_irq() çš„ IRQ å¤„ç† APIã€‚è¿™ä¸€æ›´æ–°å…·æœ‰é‡è¦æ„ä¹‰ï¼Œèƒ½å¤Ÿå°†ä¸­æ–­å¤„ç†çš„æŸäº›å¯é‡å…¥æ€§é—®é¢˜å¾—åˆ°æœ‰æ•ˆç®¡ç†ã€‚ å¦‚ä½•ä½¿ç”¨ request_threaded_irq()è¦å¯ç”¨ request_threaded_irq()ï¼Œå¿…é¡»åœ¨ Linux å†…æ ¸é…ç½®ä¸­å®šä¹‰ CONFIG_GENERIC_HARDIQSã€‚è¿™ä¸€é…ç½®çš„å­˜åœ¨ç¡®ä¿çº¿ç¨‹å¼ä¸­æ–­ï¼ˆthreaded IRQï¼‰èƒ½å¤Ÿåœ¨å†…æ ¸ä¸­å¾—åˆ°æ”¯æŒã€‚ èƒŒæ™¯request_threaded_irq() çš„å¼•å…¥æ—¨åœ¨å‡å°‘å†…æ ¸åœ¨ç­‰å¾…ç¡¬ä»¶ä¸­æ–­å¤„ç†æ—¶æ‰€äº§ç”Ÿçš„å»¶è¿Ÿã€‚è¿™ä¸€æœºåˆ¶çš„é€»è¾‘æ˜¯ï¼Œå°†ä¸­æ–­åç»­çš„å·¥ä½œäº¤ç»™å†…æ ¸çº¿ç¨‹å¤„ç†ï¼Œä»è€Œé¿å…ç›´æ¥åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­å®Œæˆæ‰€æœ‰ä»»åŠ¡ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œç³»ç»Ÿå¯ä»¥ä¿æŒé«˜æ•ˆçš„å“åº”ï¼Œå¹¶é™ä½å› é•¿æ—¶é—´å¤„ç†è€Œå¼•å‘çš„å†…æ ¸å»¶è¿Ÿã€‚ ä¼˜ç‚¹åŒ…æ‹¬ï¼š å‡å°‘å†…æ ¸å»¶è¿Ÿæ—¶é—´ï¼šå·¥ä½œè¢«åˆ†é…åˆ°çº¿ç¨‹ä¸­å¤„ç†ï¼Œä½¿å¾—å†…æ ¸èƒ½å¤Ÿæ›´å¿«åœ°å“åº”æ–°çš„ä¸­æ–­ã€‚ ç®€åŒ–ä¸­æ–­ç±»å‹åˆ¤åˆ«ï¼šåœ¨å¤„ç†ä¸­æ–­æ—¶ä¸å†éœ€è¦åˆ†è¾¨æ˜¯ç¡¬ä»¶ä¸­æ–­è¿˜æ˜¯è½¯ä»¶ä¸­æ–­ã€‚ ä¾¿äºé™¤é”™ï¼šå†…æ ¸ä¸­æ–­å¤„ç†çš„é€»è¾‘æ›´åŠ æ¸…æ™°ï¼Œæœ‰åŠ©äºæ‰¾åˆ°æ½œåœ¨çš„é—®é¢˜ã€‚ ä¼ ç»Ÿçš„ä¸­æ–­å¤„ç†å°†ä»»åŠ¡åˆ†ä¸ºä¸ŠåŠéƒ¨å’Œä¸‹åŠéƒ¨ï¼Œè¦æ±‚åœ¨ä¸ŠåŠéƒ¨çš„ç¡¬ä»¶ä¸­æ–­å¤„ç†ä¸­å°½é‡ä¿æŒç®€å•ï¼Œä»¥åŠ å¿«ç³»ç»Ÿååº”é€Ÿåº¦ã€‚é€šè¿‡ request_threaded_irq()ï¼Œä¸ŠåŠéƒ¨çš„ç¡¬ä»¶ä¸­æ–­å¤„ç†ä»…éœ€ç¡®è®¤æ­£åœ¨å¤„ç†çš„è®¾å¤‡ï¼Œéšåå”¤é†’ä¸€ä¸ªå†…æ ¸çº¿ç¨‹æ¥å®Œæˆåç»­ä»»åŠ¡ã€‚ ç¼ºç‚¹åˆ™åŒ…æ‹¬ï¼š ç›¸è¾ƒäºé IRQ ä¸­æ–­ï¼Œå†…æ ¸çº¿ç¨‹éœ€è¦åœ¨åŸæœ¬çš„ task_struct ä¸­æ–°å¢ struct irqactionï¼Œè¿™ä½¿å¾—å†…å­˜å ç”¨å¢åŠ  4 åˆ° 8 å­—èŠ‚ã€‚ å…³é”®å·®å¼‚request_threaded_irq() ä¸ä¼ ç»Ÿçš„é¡¶åŠå’Œåº•åŠå¤„ç†æœºåˆ¶ä¸åŒï¼Œå› ä¸ºå®ƒå—åˆ° Linux å†…æ ¸è°ƒåº¦çš„æ§åˆ¶ã€‚è¿™æ„å‘³ç€é”™è¯¯çš„åº•åŠä»£ç å°†ä¸å†å¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„å»¶è¿Ÿã€‚æ­¤å¤–ï¼Œä½¿ç”¨ RTï¼ˆå®æ—¶ï¼‰è°ƒåº¦ç­–ç•¥ä»¥åŠ nice å€¼ç­‰å·¥å…·ï¼Œå¯ä»¥çµæ´»è°ƒèŠ‚å„ä¸ªçº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œå°†å…¶åˆ†é…ç»™è´Ÿè½½è¾ƒä½çš„ CPUï¼Œåˆ©ç”¨å†…æ ¸æœ¬èº«å¯¹çº¿ç¨‹çš„å„ç§ç®¡ç†èƒ½åŠ›ï¼ŒåŒ…æ‹¬ä¼‘çœ ã€åŠ é”å’Œç”³è¯·æ–°çš„å†…å­˜åŒºåŸŸã€‚ çº¿ç¨‹åŒ–çš„ä¸­æ–­ç‰¹åˆ«é€‚åˆå…·æœ‰å…±äº«ä¸­æ–­çº¿çš„æƒ…å†µã€‚åœ¨è¿™äº›æƒ…å¢ƒä¸‹ï¼Œå®ƒä¸ä»…æå‡äº†å“åº”é€Ÿåº¦ï¼Œè¿˜ç®€åŒ–äº†åœ¨åŒä¸€æ®µä»£ç ä¸­å¤„ç†å¤šä¸ªè®¾å¤‡ä¸­æ–­çš„å¤æ‚æ€§ã€‚ä¸ tasklet å’Œ workqueue ç›¸æ¯”ï¼Œthreaded IRQ åœ¨ä½¿ç”¨ä¸Šæ›´ä¸ºçµæ´»ï¼Œå› ä¸ºåä¸¤è€…éœ€è¦åœ¨é¡¶åŠå’Œåº•åŠä¹‹é—´å»ºç«‹è”ç³»ã€‚ å‡½æ•°åŸå‹int request_threaded_irq(unsigned int irq, irq_handler_t handler, irq_handler_t thread_fn, unsigned long irqflags, const char *devname, void *dev_id); IRQF_SHAREDï¼šåœ¨å…±äº«ä¸­æ–­çš„æƒ…å†µä¸‹ï¼Œdev_id ä¸èƒ½ä¸ºç©ºã€‚å› ä¸ºé‡Šæ”¾ IRQ æ—¶ï¼Œéœ€è¦åŒºåˆ†å„ä¸ªå…±äº«ä¸­æ–­çš„è®¾å¤‡ã€‚ irqï¼šä¸­æ–­å·ã€‚ handlerï¼šé¦–æ¬¡æ‰§è¡Œçš„ç¡¬ä¸­æ–­å¤„ç†å‡½æ•°ã€‚è¯¥å‡½æ•°å¯ä»¥é€šè¿‡è¿”å› IRQ_WAKE_THREADED å”¤é†’çº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥è¿”å› IRQ_HANDLED è€Œä¸æ‰§è¡Œä¸­æ–­çº¿ç¨‹ã€‚ thread_fnï¼šä¸­æ–­çº¿ç¨‹ï¼Œç±»ä¼¼äºåº•åŠéƒ¨çš„åŠŸèƒ½ã€‚ æœ€åä¸‰ä¸ªå‚æ•°ä¸ request_irq() ä¸­çš„ä¸€è‡´ã€‚ IRQF_ONESHOTä¾‹å¦‚ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œçº¿ç¨‹å‡½æ•°æ‰§è¡Œå®Œæˆå‰ï¼ŒIRQ ä¸ä¼šé‡æ–°å¯ç”¨ã€‚IRQF_ONESHOT æ ‡è®°çš„åŠ å…¥ï¼Œç›®çš„æ˜¯ä½¿ä»£ç çš„å®é™…æƒ…å†µæ˜¾è€Œæ˜“è§ã€‚å®ƒå¯ä»¥ç¡®ä¿è¯†åˆ«å‡ºåœ¨ irq å†²çªæƒ…å†µä¸‹ï¼Œä¸¤é©±åŠ¨æƒ³è¦å…±äº«åŒä¸€ä¸­æ–­æ—¶æ‰€ä½¿ç”¨çš„æ ‡å¿—ã€‚ IRQF_ONESHOT å’Œ IRQF_SHARED ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚ç”±äº IRQF_ONESHOT ä¼šç¦ç”¨ä¸­æ–­çº¿ç¨‹çš„ä¸­æ–­ï¼Œå› è€Œåœ¨å¤„ç†æ—¶é—´è¾ƒé•¿çš„æƒ…å†µä¸‹ä¸é€‚ç”¨ã€‚å½“ hardirq å‡½æ•°ä¸º NULL æ—¶ï¼Œå¿…é¡»å£°æ˜ IRQF_ONESHOTï¼Œç¡®ä¿çº¿ç¨‹æ‰§è¡Œæ—¶ç¦æ­¢è¯¥ä¸­æ–­ï¼Œè¿™åœ¨å¤„ç†ä½ç”µå¹³ä¿¡å·æ—¶å°¤ä¸ºå¿…è¦ã€‚ ä½¿ç”¨ç¤ºä¾‹request_threaded_irq(gpio_irq.irq, gpio_irqhandler, gpio_threadhandler, gpio_irq.flags, gpio_irq.name, (void*)0); åœ¨ hardirq å’Œ thread_fn åŒæ—¶å­˜åœ¨æ—¶ï¼Œå¤„ç† thread_fn æ—¶ï¼Œè¯¥ä¸­æ–­æ˜¯æ‰“å¼€çš„ã€‚ err = request_threaded_irq(gpio_irq.irq, NULL, gpio_threadhandler, gpio_irq.flags, gpio_irq.name, (void*)0); ä½†å½“ hardirq å’Œ thread_fn åªæœ‰ä¸€ä¸ªå­˜åœ¨æ—¶ï¼Œå¤„ç† thread_fn æ—¶ï¼Œä¸­æ–­æ˜¯å…³é—­çš„ã€‚ è¿™ç§è®¾è®¡æ–¹å¼æ˜¾è‘—æå‡äº†ä¸­æ–­å¤„ç†çš„å¯é æ€§ä¸çµæ´»æ€§ï¼Œè®©è®¾å¤‡é©±åŠ¨çš„å¼€å‘æ›´ä¸ºé«˜æ•ˆï¼Œå¢å¼ºäº† Linux å†…æ ¸å¯¹å®æ—¶åº”ç”¨çš„æ”¯æŒã€‚ /* * gpio_irqTest.c * PB27 receive this signal as IRQ and make the LED linking on PB17 turn on or turn off * */ #include linux/types.h#include linux/kernel.h#include linux/module.h#include linux/init.h#include linux/platform_device.h#include linux/cdev.h#include linux/ioctl.h#include linux/fs.h#include linux/gpio.h#include linux/delay.h#include linux/cdev.h#include linux/interrupt.h#include asm/io.h#include asm/io.h#include mach/gpio.h#include mach/hardware.h#include mach/board.h#include mach/gpio.h#include mach/at91_pio.h#include mach/at91_aic.h#include mach/at91_pmc.hvoid led_on()// at91_set_gpio_output(AT91_PIN_PB17,1); printk(led on ); void led_off()// at91_set_gpio_output(AT91_PIN_PB17 ,0); printk(led off. ); struct light_dev *light_devp;int light_major = 200; struct light_dev struct cdev cdev; unsigned char value;; static void io_init(void) at91_set_GPIO_periph(AT91_PIN_PB27, 0); at91_set_gpio_input(AT91_PIN_PB27, 1); at91_set_deglitch(AT91_PIN_PB27, 1); struct gpio_irq_desc int pin; int irq; unsigned long flags; char *name;; static struct gpio_irq_desc gpio_irq=AT91_PIN_PB27, AT91_PIN_PB27,IRQF_TRIGGER_FALLING|IRQF_TRIGGER_RISING|IRQF_ONESHOT,PB27;static irqreturn_t gpio_irqhandler(int irq, void *dev_id) printk(KERN_INFO In hard irq handler. ); return IRQ_WAKE_THREAD;static irqreturn_t gpio_threadhandler(int irq, void *dev_id) int rst; rst = at91_get_gpio_value(gpio_irq.pin); printk(KERN_INFO gpio stat: %d , rst); if(rst == 0) led_on(); else led_off(); printk(KERN_INFO sleep 3000ms ); msleep(3000); printk(KERN_INFO awake after sleep ); return IRQ_HANDLED; int light_open(struct inode *inode,struct file *filp) int err; struct light_dev *dev; dev = container_of(inode-i_cdev,struct light_dev,cdev); filp-private_data = dev; printk(KERN_DEBUG %s, __FUNCTION__); io_init();// err = request_threaded_irq(gpio_irq.irq,gpio_irqhandler,gpio_threadhandler,gpio_irq.flags,gpio_irq.name,(void*)0); err = request_threaded_irq(gpio_irq.irq,NULL,gpio_threadhandler,gpio_irq.flags,gpio_irq.name,(void*)0); if(err) // free_irq(gpio_irq.irq,(void*)0); printk(KERN_DEBUG request irq failed. ); return -EBUSY; return 0; int light_release(struct inode *inode,struct file *filp) free_irq(gpio_irq.irq,(void*)0); return 0; int light_ioctl(struct inode *inode,struct file *filp,unsigned int cmd, unsigned long arg) struct light_dev *dev = filp-private_data; switch(cmd) case 0: at91_set_gpio_output(AT91_PIN_PB19,0); break; case 1: at91_set_gpio_output(AT91_PIN_PB19,1); led_off(); break; default: return -ENOTTY; // break; return 0; struct file_operations light_fops = .owner = THIS_MODULE, .open = light_open, .release = light_release, .unlocked_ioctl = light_ioctl,; static void light_setup_cdev(struct light_dev *dev,int index) int err,devno = MKDEV(light_major,index); cdev_init(dev-cdev,light_fops); dev-cdev.owner = THIS_MODULE; dev-cdev.ops = light_fops; err = cdev_add(dev-cdev,devno,1); if(err) printk(KERN_NOTICE Error %d adding LED%d,err,index); int __init light_init(void) int result; dev_t dev = MKDEV(light_major,0); if(light_major) result = register_chrdev_region(dev,1,gpio); if(result 0) printk(KERN_DEBUG %s: register char dev failed. , __FUNCTION__); return result; light_devp = kmalloc(sizeof(struct light_dev),GFP_KERNEL); if(!light_devp) result = - ENOMEM; goto fail_malloc; memset(light_devp,0,sizeof(struct light_dev)); light_setup_cdev(light_devp,0); printk(KERN_DEBUG %s done , __FUNCTION__); return 0; fail_malloc:unregister_chrdev_region(dev,light_devp); return result; void __exit light_cleanup(void) cdev_del(light_devp-cdev); kfree(light_devp); unregister_chrdev_region(MKDEV(light_major,0),1); module_init(light_init);module_exit(light_cleanup);MODULE_AUTHOR(Enzo Fang);MODULE_LICENSE(Dual BSD/GPL);","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","é©±åŠ¨"]},{"title":"å—è®¾å¤‡é©±åŠ¨","path":"/2024/11/05/1-å¹³å°ç³»ç»Ÿ-Linux-é©±åŠ¨-å—è®¾å¤‡é©±åŠ¨/","content":"#include linux/module.h#include linux/moduleparam.h#include linux/init.h#include linux/sched.h#include linux/kernel.h\t/* ç”¨äºæ‰“å°è°ƒè¯•ä¿¡æ¯çš„printk() */#include linux/slab.h /* åˆ†é…å†…å­˜çš„kmalloc() */#include linux/fs.h /* å¤„ç†æ–‡ä»¶ç³»ç»Ÿçš„æ‰€æœ‰åŠŸèƒ½ */#include linux/errno.h\t/* é”™è¯¯ä»£ç  */#include linux/timer.h#include linux/types.h\t/* å®šä¹‰æ•°æ®ç±»å‹ï¼Œå¦‚size_t */#include linux/fcntl.h\t/* æ–‡ä»¶æ§åˆ¶å¸¸é‡ï¼Œä¾‹å¦‚O_ACCMODE */#include linux/hdreg.h\t/* è·å–ç¡¬ç›˜å‡ ä½•ä¿¡æ¯çš„HDIO_GETGEO */#include linux/kdev_t.h#include linux/vmalloc.h#include linux/genhd.h\t/* é€šç”¨å—è®¾å¤‡æ“ä½œ */#include linux/blkdev.h\t/* å—è®¾å¤‡æ¥å£ */#include linux/buffer_head.h\t/* invalidate_bdevï¼Œå¤„ç†ç¼“å­˜çš„å— */#include linux/bio.h /* ç”Ÿç‰©è¾“å…¥è¾“å‡ºç»“æ„ä½“ */#include linux/version.h\t/* è·å–Linuxå†…æ ¸ç‰ˆæœ¬ä¿¡æ¯ */#define SIMP_BLKDEV_DEVICEMAJOR COMPAQ_SMART2_MAJOR // å®šä¹‰å—è®¾å¤‡çš„ä¸»è®¾å¤‡å·#define SIMP_BLKDEV_DISKNAME sbull // å®šä¹‰å—è®¾å¤‡çš„åç§°#define SIMP_BLKDEV_BYTES (16*1024*1024) // å®šä¹‰å—è®¾å¤‡çš„æ€»å­—èŠ‚æ•°static struct request_queue *simp_blkdev_queue; // å®šä¹‰è¯·æ±‚é˜Ÿåˆ—static struct gendisk *simp_blkdev_disk; // å®šä¹‰é€šç”¨å—è®¾å¤‡ç»“æ„unsigned char simp_blkdev_data[SIMP_BLKDEV_BYTES]; // ç”¨äºåœ¨RAMä¸­å­˜å‚¨æ•°æ®çš„æ•°ç»„/** * simp_blkdev_make_request - å¤„ç†è¾“å…¥è¾“å‡ºè¯·æ±‚ * @q: è¯·æ±‚é˜Ÿåˆ— * @bio: è¾“å…¥è¾“å‡ºæ¥ç”Ÿç‰©ï¼ˆbioï¼‰ç»“æ„ä½“ï¼ŒåŒ…å«è¯»å†™è¯·æ±‚çš„ä¿¡æ¯ * * è¯¥å‡½æ•°æ˜¯è¯·æ±‚å¤„ç†çš„æ ¸å¿ƒï¼Œè´Ÿè´£å¤„ç†ä»ä¸Šå±‚å‘æ¥çš„æ‰€æœ‰IOè¯·æ±‚ã€‚ */static int simp_blkdev_make_request(struct request_queue *q, struct bio *bio) struct bio_vec *bvec; int i; void *dsk_mem; // ç”¨äºåç»­è·å–å†…å­˜çš„æŒ‡é’ˆ // æ£€æŸ¥è¯·æ±‚æ˜¯å¦è¶…å‡ºäº†è®¾å¤‡çš„è¾¹ç•Œ if ((bio-bi_sector 9) + bio-bi_size SIMP_BLKDEV_BYTES) printk(KERN_ERR SIMP_BLKDEV_DISKNAME : bad request: block=%llu, count=%u , (unsigned long long)bio-bi_sector, bio-bi_size);#if LINUX_VERSION_CODE KERNEL_VERSION(2, 6, 24) bio_endio(bio, 0, -EIO); // å¤„ç†é”™è¯¯ç»“æŸIO#else bio_endio(bio, -EIO); // å¤„ç†é”™è¯¯ç»“æŸIO#endif return 0; // è¿”å›0ä»¥è¡¨ç¤ºå¤„ç†å®Œæˆ // è®¡ç®—å½“å‰è¯·æ±‚åœ¨è®¾å¤‡æ•°æ®ä¸­çš„èµ·å§‹åœ°å€ dsk_mem = simp_blkdev_data + (bio-bi_sector 9); // éå†bioä¸­çš„æ¯ä¸ªæ•°æ®ç‰‡æ®µ bio_for_each_segment(bvec, bio, i) void *iovec_mem; switch (bio_rw(bio)) case READ: // å¤„ç†è¯»å–è¯·æ±‚ case READA: // å°†é¡µæŒ‡é’ˆè½¬æ¢æˆå®é™…çš„è™šæ‹Ÿåœ°å€ iovec_mem = kmap(bvec-bv_page) + bvec-bv_offset; memcpy(iovec_mem, dsk_mem, bvec-bv_len); // ä»å—è®¾å¤‡å†…å­˜å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ kunmap(bvec-bv_page); // è§£é”é¡µ break; case WRITE: // å¤„ç†å†™å…¥è¯·æ±‚ iovec_mem = kmap(bvec-bv_page) + bvec-bv_offset; memcpy(dsk_mem, iovec_mem, bvec-bv_len); // ä»ç”¨æˆ·ç©ºé—´å¤åˆ¶åˆ°å—è®¾å¤‡å†…å­˜ kunmap(bvec-bv_page); // è§£é”é¡µ break; default: // å¤„ç†æœªçŸ¥çš„IOè¯·æ±‚ç±»å‹ printk(KERN_ERR SIMP_BLKDEV_DISKNAME : unknown value of bio_rw: %lu , bio_rw(bio));#if LINUX_VERSION_CODE KERNEL_VERSION(2, 6, 24) bio_endio(bio, 0, -EIO); // å¤„ç†é”™è¯¯ç»“æŸIO#else bio_endio(bio, -EIO); // å¤„ç†é”™è¯¯ç»“æŸIO#endif return 0; dsk_mem += bvec-bv_len; // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ•°æ®æ®µ #if LINUX_VERSION_CODE KERNEL_VERSION(2, 6, 24) bio_endio(bio, bio-bi_size, 0); // æ­£å¸¸ç»“æŸIO#else bio_endio(bio, 0); // æ­£å¸¸ç»“æŸIO#endif return 0; // è¿”å›0ä»¥è¡¨ç¤ºå¤„ç†å®Œæˆ// å®šä¹‰å—è®¾å¤‡çš„æ“ä½œå‡½æ•°struct block_device_operations simp_blkdev_fops = .owner = THIS_MODULE, // æ¨¡å—æ‹¥æœ‰è€…;/** * simp_blkdev_init - åˆå§‹åŒ–å—è®¾å¤‡ * * åœ¨æ¨¡å—åŠ è½½æ—¶è°ƒç”¨ï¼Œåˆ†é…è¯·æ±‚é˜Ÿåˆ—å’Œé€šç”¨å—è®¾å¤‡ç»“æ„ã€‚ * åˆ†é…æˆåŠŸåï¼Œè®¾ç½®ç›¸å…³å‚æ•°ï¼Œå¹¶æ·»åŠ åˆ°ç³»ç»Ÿä¸­ã€‚ */static int __init simp_blkdev_init(void) int ret; // åˆ†é…è¯·æ±‚é˜Ÿåˆ— simp_blkdev_queue = blk_alloc_queue(GFP_KERNEL); if (!simp_blkdev_queue) ret = -ENOMEM; // å†…å­˜åˆ†é…å¤±è´¥ goto err_alloc_queue; // è®¾ç½®è¯·æ±‚å¤„ç†å‡½æ•° blk_queue_make_request(simp_blkdev_queue, simp_blkdev_make_request); // åˆ†é…é€šç”¨å—è®¾å¤‡ simp_blkdev_disk = alloc_disk(1); // åˆ›å»º1ä¸ªå—è®¾å¤‡ if (!simp_blkdev_disk) ret = -ENOMEM; // å†…å­˜åˆ†é…å¤±è´¥ goto err_alloc_disk; // è®¾ç½®å—è®¾å¤‡çš„å‚æ•° strcpy(simp_blkdev_disk-disk_name, SIMP_BLKDEV_DISKNAME); simp_blkdev_disk-major = SIMP_BLKDEV_DEVICEMAJOR; simp_blkdev_disk-first_minor = 0; simp_blkdev_disk-fops = simp_blkdev_fops; // è®¾ç½®æ“ä½œå‡½æ•° simp_blkdev_disk-queue = simp_blkdev_queue; // è®¾ç½®è¯·æ±‚é˜Ÿåˆ— set_capacity(simp_blkdev_disk, SIMP_BLKDEV_BYTES 9); // è®¾ç½®å—è®¾å¤‡å®¹é‡ add_disk(simp_blkdev_disk); // å°†è®¾å¤‡æ·»åŠ åˆ°ç³»ç»Ÿä¸­ return 0; // åˆå§‹åŒ–æˆåŠŸerr_alloc_disk: blk_cleanup_queue(simp_blkdev_queue); // æ¸…ç†è¯·æ±‚é˜Ÿåˆ—err_alloc_queue: return ret; // è¿”å›é”™è¯¯ä»£ç /** * simp_blkdev_exit - æ¨¡å—å¸è½½æ—¶è°ƒç”¨ * * æ¸…ç†æ¨¡å—ä½¿ç”¨çš„èµ„æºï¼ŒåŒ…æ‹¬åˆ é™¤å—è®¾å¤‡å’Œæ¸…ç†è¯·æ±‚é˜Ÿåˆ—ã€‚ */static void __exit simp_blkdev_exit(void) del_gendisk(simp_blkdev_disk); // ä»ç³»ç»Ÿä¸­å¸è½½å—è®¾å¤‡ put_disk(simp_blkdev_disk); // é‡Šæ”¾å—è®¾å¤‡çš„å¼•ç”¨ blk_cleanup_queue(simp_blkdev_queue); // æ¸…ç†è¯·æ±‚é˜Ÿåˆ—// æŒ‡å®šæ¨¡å—åŠ è½½å’Œå¸è½½çš„å‡½æ•°module_init(simp_blkdev_init);module_exit(simp_blkdev_exit);","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","é©±åŠ¨"]},{"title":"ARP","path":"/2024/11/04/1-å¹³å°ç³»ç»Ÿ-Linux-ç½‘ç»œ-ARP/","content":"ARP åè®®è§£æARP åˆ—è¡¨å»ºç«‹ä¸æŸ¥è¯¢åŸç†é¦–å…ˆï¼Œæ¯å°ä¸»æœºéƒ½ä¼šåœ¨è‡ªå·±çš„ ARP ç¼“å†²åŒºä¸­å»ºç«‹ä¸€ä¸ª ARP åˆ—è¡¨ï¼Œä»¥è¡¨ç¤º IP åœ°å€å’Œ MAC åœ°å€çš„å¯¹åº”å…³ç³»ã€‚ ARP è¯·æ±‚ä¸å“åº”æµç¨‹ å½“æºä¸»æœºéœ€è¦å°†ä¸€ä¸ªæ•°æ®åŒ…å‘é€åˆ°ç›®çš„ä¸»æœºæ—¶ï¼Œä¼šé¦–å…ˆæ£€æŸ¥è‡ªå·± ARP åˆ—è¡¨ä¸­æ˜¯å¦å­˜åœ¨è¯¥ IP åœ°å€å¯¹åº”çš„ MAC åœ°å€ å¦‚æœå­˜åœ¨ï¼Œå°±ç›´æ¥å°†æ•°æ®åŒ…å‘é€åˆ°è¿™ä¸ª MAC åœ°å€ å¦‚æœä¸å­˜åœ¨ï¼Œå°±å‘æœ¬åœ°ç½‘æ®µå‘èµ·ä¸€ä¸ª ARP è¯·æ±‚çš„å¹¿æ’­åŒ…ï¼ŒæŸ¥è¯¢æ­¤ç›®çš„ä¸»æœºå¯¹åº”çš„ MAC åœ°å€ æ­¤ ARP è¯·æ±‚æ•°æ®åŒ…é‡ŒåŒ…æ‹¬æºä¸»æœºçš„ IP åœ°å€ã€ç¡¬ä»¶åœ°å€ã€ä»¥åŠç›®çš„ä¸»æœºçš„ IP åœ°å€ ARP å“åº”å¤„ç†æœºåˆ¶ ç½‘ç»œä¸­æ‰€æœ‰çš„ä¸»æœºæ”¶åˆ°è¿™ä¸ª ARP è¯·æ±‚åï¼Œä¼šæ£€æŸ¥æ•°æ®åŒ…ä¸­çš„ç›®çš„ IP æ˜¯å¦å’Œè‡ªå·±çš„ IP åœ°å€ä¸€è‡´ å¦‚æœä¸ç›¸åŒï¼Œå°±ä¼šå¿½ç•¥æ­¤æ•°æ®åŒ… å¦‚æœç›¸åŒï¼Œåˆ™ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š å°†å‘é€ç«¯çš„ MAC åœ°å€å’Œ IP åœ°å€æ·»åŠ åˆ°è‡ªå·±çš„ ARP åˆ—è¡¨ä¸­ å¦‚æœ ARP è¡¨ä¸­å·²ç»å­˜åœ¨è¯¥ IP çš„ä¿¡æ¯ï¼Œåˆ™å°†å…¶è¦†ç›– å‘æºä¸»æœºå‘é€ä¸€ä¸ª ARP å“åº”æ•°æ®åŒ…ï¼Œå‘Šè¯‰å¯¹æ–¹è‡ªå·±æ˜¯å®ƒéœ€è¦æŸ¥æ‰¾çš„ MAC åœ°å€ æºä¸»æœºæ”¶åˆ°è¿™ä¸ª ARP å“åº”æ•°æ®åŒ…åï¼š å°†å¾—åˆ°çš„ç›®çš„ä¸»æœºçš„ IP åœ°å€å’Œ MAC åœ°å€æ·»åŠ åˆ°è‡ªå·±çš„ ARP åˆ—è¡¨ä¸­ åˆ©ç”¨æ­¤ä¿¡æ¯å¼€å§‹æ•°æ®çš„ä¼ è¾“ ARP æŸ¥è¯¢å¤±è´¥çš„å¤„ç† å¦‚æœæºä¸»æœºä¸€ç›´æ²¡æœ‰æ”¶åˆ° ARP å“åº”æ•°æ®åŒ…ï¼Œè¡¨ç¤º ARP æŸ¥è¯¢å¤±è´¥ å…·ä½“ç¤ºä¾‹ä¾‹å¦‚ï¼š - A çš„åœ°å€ä¸ºï¼šIPï¼š192.168.10.1 MAC: AA-AA-AA-AA-AA-AA - B çš„åœ°å€ä¸ºï¼šIPï¼š192.168.10.2 MAC: BB-BB-BB-BB-BB-BB æ ¹æ®ä¸Šé¢çš„æ‰€è®²çš„åŸç†ï¼ŒA è¦å’Œ B é€šè®¯æ—¶çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š- A éœ€è¦çŸ¥é“ B çš„ä»¥å¤ªç½‘åœ°å€ï¼Œäºæ˜¯ A å‘é€ä¸€ä¸ª ARP è¯·æ±‚å¹¿æ’­ï¼ˆè°æ˜¯ 192.168.10.2ï¼Œè¯·å‘Šè¯‰ 192.168.10.1ï¼‰- B æ”¶åˆ°è¯¥å¹¿æ’­åï¼Œæ£€æŸ¥å‘ç°ä¸è‡ªå·±çš„ä¸€è‡´ï¼Œç„¶åå°±å‘ A å‘é€ä¸€ä¸ª ARP å•æ’­åº”ç­”ï¼ˆ192.168.10.2 åœ¨ BB-BB-BB-BB-BB-BBï¼‰","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç½‘ç»œ"]},{"title":"ç½‘ç»œé©±åŠ¨å‡½æ•°åŠŸèƒ½åˆ†æ","path":"/2024/11/01/1-å¹³å°ç³»ç»Ÿ-Linux-é©±åŠ¨-ç½‘ç»œé©±åŠ¨å‡½æ•°åŠŸèƒ½åˆ†æ/","content":"open å‡½æ•°åœ¨ Linux å†…æ ¸ä¸­çš„è®¾å¤‡é©±åŠ¨ç¨‹åºä¸­ï¼Œopen å‡½æ•°æ‰¿æ‹…ç€å…³é”®ä½œç”¨ï¼Œä¸»è¦è´Ÿè´£å¤„ç†ç”¨æˆ·è¿›ç¨‹å¯¹è®¾å¤‡æ–‡ä»¶çš„æ‰“å¼€è¯·æ±‚ã€‚å…·ä½“æ¥çœ‹ï¼Œopen å‡½æ•°çš„ä¸»è¦ä»»åŠ¡åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š 1. æ£€æŸ¥è®¾å¤‡çŠ¶æ€é¦–å…ˆï¼Œopen å‡½æ•°ä¼šæ£€æŸ¥æ‰€è¯·æ±‚æ‰“å¼€çš„è®¾å¤‡æ˜¯å¦å¤„äºå¯ç”¨çŠ¶æ€ã€‚è¿™æ„å‘³ç€å‡½æ•°éœ€è¦ç¡®è®¤è®¾å¤‡æ²¡æœ‰è¢«å…¶ä»–è¿›ç¨‹é”å®šï¼Œä¸”æ²¡æœ‰å‘ç”Ÿç¡¬ä»¶æ•…éšœã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªè®¾å¤‡æ­£ç”±å¦ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨æ—¶ï¼Œè‹¥å†æ¬¡å°è¯•æ‰“å¼€è¯¥è®¾å¤‡ï¼Œopen å‡½æ•°å°†è¿”å›ä¸€ä¸ªé”™è¯¯ç ï¼Œé€šå¸¸æ˜¯ -EBUSYã€‚è¿™ç§æœºåˆ¶å¯ä»¥é¿å…èµ„æºå†²çªï¼Œä¿è¯è®¾å¤‡çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚ 2. åˆå§‹åŒ–è®¾å¤‡åœ¨ç¡®è®¤è®¾å¤‡çŠ¶æ€åï¼Œopen å‡½æ•°è¿›è¡Œå¿…è¦çš„è®¾å¤‡åˆå§‹åŒ–ã€‚è¿™å¯èƒ½åŒ…æ‹¬è®¾ç½®è®¾å¤‡ç‰¹å®šçš„å¯„å­˜å™¨çŠ¶æ€ï¼Œå‡†å¤‡æ•°æ®ç¼“å†²åŒºç­‰æ“ä½œã€‚ä¾‹å¦‚ï¼Œåœ¨æŸäº›è®¾å¤‡ï¼ˆå¦‚ç½‘ç»œæ¥å£ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ‰“å¼€è®¾å¤‡ä¹‹å‰éœ€è¦é…ç½®å…¶ç½‘ç»œåè®®æ ˆï¼Œä»¥ç¡®ä¿åç»­çš„æ•°æ®ä¼ è¾“æ­£å¸¸å·¥ä½œã€‚ 3. ç®¡ç†èµ„æºopen å‡½æ•°éœ€è¦åˆ†é…å’Œåˆå§‹åŒ–ä¸æ‰“å¼€çš„è®¾å¤‡å®ä¾‹ç›¸å…³çš„èµ„æºã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°ä¸ºè®¾å¤‡åˆ†é…å†…å­˜ï¼Œåˆå§‹åŒ–æ•°æ®ç»“æ„ä»¥å­˜å‚¨è®¾å¤‡çŠ¶æ€æˆ–ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œè®¾å¤‡é©±åŠ¨ç¨‹åºå¯èƒ½éœ€è¦åˆ†é…ä¸€ä¸ªç»“æ„ä½“ï¼Œæ¥ä¿å­˜æœ‰å…³è®¾å¤‡çš„å½“å‰çŠ¶æ€ä¿¡æ¯ï¼Œä¾›åç»­æ“ä½œä½¿ç”¨ã€‚ 4. è·Ÿè¸ªè®¾å¤‡ä½¿ç”¨æƒ…å†µæ­¤å¤–ï¼Œopen å‡½æ•°è´Ÿè´£è·Ÿè¸ªè®¾å¤‡çš„ä½¿ç”¨æƒ…å†µï¼Œä¾‹å¦‚å¢åŠ è®¾å¤‡çš„æ‰“å¼€è®¡æ•°ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œé©±åŠ¨ç¨‹åºå¯ä»¥ç›‘æ§è®¾å¤‡çš„æ‰“å¼€æ¬¡æ•°ï¼Œä»¥åŠæ˜¯å¦åº”å½“æ‹’ç»æ–°çš„æ‰“å¼€è¯·æ±‚ã€‚è®¾å¤‡çš„çŠ¶æ€ç®¡ç†æœ‰åŠ©äºé¿å…å¯¹è®¾å¤‡çš„é”™è¯¯æˆ–ä¸å½“ä½¿ç”¨ï¼Œç¡®ä¿å…¶æ­£å¸¸è¿è¡Œã€‚ open å‡½æ•°é€šå¸¸æ˜¯é€šè¿‡ file_operations ç»“æ„ä½“ä¸­çš„ open æˆå‘˜æ¥å®ç°çš„ã€‚file_operations ç»“æ„ä½“æ˜¯ Linux è®¾å¤‡é©±åŠ¨ä¸­ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒå®šä¹‰äº†ä¸€ç³»åˆ—è®¾å¤‡æ–‡ä»¶çš„æ“ä½œé›†åˆï¼ŒåŒ…æ‹¬æ‰“å¼€ã€å…³é—­ã€è¯»å†™ç­‰æ“ä½œã€‚open å‡½æ•°çš„ä¸€èˆ¬åŸå‹å¦‚ä¸‹ï¼š int (*open)(struct inode *inode, struct file *filp); ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•å­—ç¬¦è®¾å¤‡é©±åŠ¨ç¨‹åºä¸­ open å‡½æ•°çš„ç¤ºä¾‹ï¼š static int my_device_open(struct inode *inode, struct file *filp) // æ£€æŸ¥è®¾å¤‡æ˜¯å¦å·²ç»è¢«æ‰“å¼€ if (device_open) return -EBUSY; // è®¾å¤‡å¤„äºå¿™ç¢ŒçŠ¶æ€ï¼Œæ— æ³•å†æ¬¡æ‰“å¼€ // æ ‡è®°è®¾å¤‡ä¸ºæ‰“å¼€çŠ¶æ€ device_open++; // è¿›è¡Œå¿…è¦çš„åˆå§‹åŒ– try_module_get(THIS_MODULE); // å¢åŠ æ¨¡å—ä½¿ç”¨è®¡æ•° return 0; // æ‰“å¼€æˆåŠŸstatic int my_device_release(struct inode *inode, struct file *filp) // æ ‡è®°è®¾å¤‡ä¸ºå…³é—­çŠ¶æ€ device_open--; // è¿›è¡Œæ¸…ç†æ“ä½œ module_put(THIS_MODULE); // é‡Šæ”¾æ¨¡å—ä½¿ç”¨è®¡æ•° return 0; // å…³é—­æˆåŠŸstatic struct file_operations fops = .open = my_device_open, .release = my_device_release, // å…¶ä»–æ“ä½œå‡½æ•°;static int __init my_device_init(void) int ret; // æ³¨å†Œå­—ç¬¦è®¾å¤‡ ret = register_chrdev(MAJOR_NUM, my_device, fops); if (ret 0) printk(KERN_ALERT æ³¨å†Œå­—ç¬¦è®¾å¤‡å¤±è´¥ ); // è¾“å‡ºé”™è¯¯æ—¥å¿— return ret; // è¿”å›é”™è¯¯ç  printk(KERN_INFO å­—ç¬¦è®¾å¤‡æ³¨å†ŒæˆåŠŸ ); // è¾“å‡ºæˆåŠŸæ—¥å¿— return 0; // åˆå§‹åŒ–æˆåŠŸstatic void __exit my_device_exit(void) // æ³¨é”€å­—ç¬¦è®¾å¤‡ unregister_chrdev(MAJOR_NUM, my_device); printk(KERN_INFO å­—ç¬¦è®¾å¤‡å·²æ³¨é”€ ); // è¾“å‡ºæ³¨é”€æ—¥å¿—module_init(my_device_init);module_exit(my_device_exit); åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œmy_device_open å‡½æ•°å¤„ç†è®¾å¤‡æ–‡ä»¶çš„æ‰“å¼€æ“ä½œï¼Œè€Œ my_device_release å‡½æ•°åˆ™è´Ÿè´£å¤„ç†è®¾å¤‡æ–‡ä»¶çš„å…³é—­ã€‚è¿™ä¸¤ä¸ªå‡½æ•°è¢«å®šä¹‰åœ¨ file_operations ç»“æ„ä½“ fops ä¸­ï¼Œä»¥å°†å®ƒä»¬ä¸è®¾å¤‡æ–‡ä»¶çš„æ“ä½œå…³è”ã€‚ç”¨æˆ·è¿›ç¨‹è¯·æ±‚æ‰“å¼€è®¾å¤‡æ–‡ä»¶æ—¶ï¼Œé©±åŠ¨ç¨‹åºä¸­çš„ open å‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„å‡½æ•°ä»¥æ»¡è¶³è¯·æ±‚ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œé©±åŠ¨ç¨‹åºèƒ½å¤Ÿæœ‰æ•ˆåœ°ç®¡ç†è®¾å¤‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œç¡®ä¿å…¶å¯ç”¨æ€§å’Œç¨³å®šæ€§ã€‚ probe å‡½æ•°åœ¨ Linux å†…æ ¸ä¸­ï¼Œprobe å‡½æ•°æ˜¯è®¾å¤‡é©±åŠ¨ç¨‹åºä¸­çš„ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œä¸»è¦ç”¨äºåœ¨è®¾å¤‡ä¸é©±åŠ¨ç¨‹åºæˆåŠŸåŒ¹é…æ—¶è¿›è¡Œå„ç§åˆå§‹åŒ–æ“ä½œã€‚å…·ä½“è€Œè¨€ï¼Œprobe å‡½æ•°åŒ…å«å‡ ä¸ªé‡è¦ä»»åŠ¡ï¼Œç¡®ä¿è®¾å¤‡èƒ½å¤Ÿåœ¨ç³»ç»Ÿä¸­æ­£å¸¸è¿è¡Œã€‚ä»¥ä¸‹æ˜¯è¿™äº›ä»»åŠ¡çš„è¯¦ç»†è¯´æ˜ï¼š èµ„æºåˆ†é…probe å‡½æ•°é¦–å…ˆè´Ÿè´£ä¸ºè®¾å¤‡åˆ†é…å¿…è¦çš„èµ„æºã€‚è¿™åŒ…æ‹¬ IO å†…å­˜ã€IRQï¼ˆä¸­æ–­è¯·æ±‚çº¿ï¼‰å’Œå…¶ä»–ç¡¬ä»¶èµ„æºã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªæ–°çš„è®¾å¤‡è¿æ¥åˆ°ç³»ç»Ÿæ—¶ï¼Œprobe å‡½æ•°ä¼šè¯·æ±‚åˆ†é…ç‰¹å®šçš„å†…å­˜åœ°å€ï¼Œä»¥ä¾¿é©±åŠ¨ç¨‹åºèƒ½å¤Ÿä¸è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚èµ„æºåˆ†é…çš„æˆåŠŸä¸å¦ç›´æ¥å½±å“è®¾å¤‡çš„åç»­æ“ä½œã€‚ ç¡¬ä»¶åˆå§‹åŒ–probe å‡½æ•°è¿˜æ‰§è¡Œç¡¬ä»¶å±‚é¢çš„åˆå§‹åŒ–ï¼Œä»¥ç¡®ä¿è®¾å¤‡çš„åŸºæœ¬åŠŸèƒ½æ­£å¸¸ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå›¾å½¢å¡ï¼Œprobe å‡½æ•°å¯èƒ½ä¼šè®¾ç½®æ˜¾å¡çš„å·¥ä½œæ¨¡å¼ï¼Œé…ç½®æ˜¾å­˜çš„åœ°å€ç­‰ã€‚è¿™ä¸€æ­¥éª¤é€šå¸¸æ¶‰åŠè®¾ç½®å¯„å­˜å™¨ï¼Œä»¥ä¾¿è®¾å¤‡èƒ½å¤ŸæŒ‰ç…§é¢„æœŸçš„æ–¹å¼è¿›è¡Œæ“ä½œã€‚ è®¾å¤‡æ³¨å†Œä¸€æ—¦è®¾å¤‡è¢«æˆåŠŸåˆå§‹åŒ–ï¼Œprobe å‡½æ•°ä¼šåœ¨å†…æ ¸ä¸­æ³¨å†Œè¯¥è®¾å¤‡ã€‚è¿™ä¸€æ­¥ä½¿å¾—è®¾å¤‡å¯ä»¥è¢«ç³»ç»Ÿä¸­çš„å…¶ä»–ç»„ä»¶è®¿é—®å’Œä½¿ç”¨ï¼Œè¿™å¯¹äºç³»ç»Ÿçš„ç¨³å®šæ€§å’Œåè°ƒæ€§è‡³å…³é‡è¦ã€‚æ³¨å†Œçš„è¿‡ç¨‹é€šå¸¸æ¶‰åŠå°†è®¾å¤‡çš„ä¿¡æ¯æ·»åŠ åˆ°å†…æ ¸çš„è®¾å¤‡åˆ—è¡¨ä¸­ã€‚ æ•°æ®ç»“æ„åˆå§‹åŒ–æœ€åï¼Œprobe å‡½æ•°ä¼šåˆå§‹åŒ–é©±åŠ¨ç¨‹åºæ‰€éœ€çš„å†…éƒ¨æ•°æ®ç»“æ„ã€‚è¿™äº›æ•°æ®ç»“æ„å­˜å‚¨æœ‰å…³è®¾å¤‡çŠ¶æ€ã€é©±åŠ¨ç¨‹åºçŠ¶æ€å’Œå…¶ä»–è¿è¡Œæ—¶ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œè®¾å¤‡çš„çŠ¶æ€å¯èƒ½åŒ…æ‹¬æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œæˆ–æ˜¯å¦å…è®¸æŸäº›ç‰¹å®šæ“ä½œã€‚åˆå§‹åŒ–è¿™äº›ç»“æ„ä¸ä»…æå‡äº†é©±åŠ¨ç¨‹åºçš„æ•ˆç‡ï¼Œä¹Ÿå¢å¼ºäº†å¯¹è®¾å¤‡æ“ä½œçš„ç®¡ç†èƒ½åŠ›ã€‚ å‡½æ•°è°ƒç”¨è¿‡ç¨‹probe å‡½æ•°é€šå¸¸åœ¨è®¾å¤‡é©±åŠ¨ç¨‹åºæ³¨å†Œæ—¶è¢«è°ƒç”¨ã€‚å½“å†…æ ¸æ£€æµ‹åˆ°æ–°è®¾å¤‡å¹¶æ‰¾åˆ°åˆé€‚çš„é©±åŠ¨ç¨‹åºæ—¶ï¼Œå†…æ ¸ä¼šè§¦å‘è¯¥é©±åŠ¨ç¨‹åºçš„ probe å‡½æ•°ã€‚å…¶å‡½æ•°åŸå‹é€šå¸¸å¦‚ä¸‹æ‰€ç¤ºï¼š int (*probe)(struct platform_device *pdev); ç¤ºä¾‹ï¼šPCI è®¾å¤‡é©±åŠ¨ç¨‹åºä»¥ä¸€ä¸ª PCI è®¾å¤‡é©±åŠ¨ç¨‹åºä¸ºä¾‹ï¼Œprobe å‡½æ•°å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š static int my_pci_probe(struct pci_dev *pdev, const struct pci_device_id *ent) int err; // å¯ç”¨è®¾å¤‡ err = pci_enable_device(pdev); if (err) return err; // è¯·æ±‚ I/O ç«¯å£ã€å†…å­˜ç­‰èµ„æº err = pci_request_regions(pdev, my_driver); if (err) goto disable_device; // åˆå§‹åŒ–è®¾å¤‡çš„å…¶ä»–éƒ¨åˆ† err = my_device_init(pdev); if (err) goto release_regions; return 0;release_regions: pci_release_regions(pdev);disable_device: pci_disable_device(pdev); return err; åœ¨ä¸Šè¿°ä»£ç ç¤ºä¾‹ä¸­ï¼Œmy_pci_probe å‡½æ•°è´Ÿè´£å¯ç”¨è®¾å¤‡ã€è¯·æ±‚æ‰€éœ€çš„èµ„æºï¼Œå¹¶å¯¹è®¾å¤‡è¿›è¡Œåˆæ­¥çš„è®¾ç½®å’Œé…ç½®ã€‚å¦‚æœåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä»»ä½•æ­¥éª¤å¤±è´¥ï¼Œä¾‹å¦‚æ— æ³•å¯ç”¨è®¾å¤‡æˆ–è¯·æ±‚èµ„æºå¤±è´¥ï¼Œå‡½æ•°ä¼šæœ‰æ•ˆåœ°è¿›è¡Œæ¸…ç†æ“ä½œï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œé˜²æ­¢æœªæ­£å¸¸åˆå§‹åŒ–çš„è®¾å¤‡é€ æˆé—®é¢˜ã€‚ é€šè¿‡ä»¥ä¸Šæ–¹å¼ï¼Œprobe å‡½æ•°ç¡®ä¿äº†è®¾å¤‡åœ¨ä¸é©±åŠ¨ç¨‹åºåŒ¹é…åèƒ½å¤Ÿæ­£ç¡®åˆå§‹åŒ–å¹¶é¡ºåˆ©æŠ•å…¥ä½¿ç”¨ã€‚è¿™ä¸€è¿‡ç¨‹å¯¹äºæ•´ä¸ªæ“ä½œç³»ç»Ÿä¸ç¡¬ä»¶ä¹‹é—´çš„äº¤äº’è‡³å…³é‡è¦ã€‚ netdev_priv(ndev);netdev_priv(ndev) æ˜¯ä¸€ä¸ªå†…æ ¸å®ï¼Œç”¨ä»¥è·å–ä¸ç½‘ç»œè®¾å¤‡ (net_device) ç›¸å…³è”çš„ç§æœ‰æ•°æ®ç»“æ„çš„æŒ‡é’ˆã€‚åœ¨ Linux ç½‘ç»œè®¾å¤‡é©±åŠ¨ç¨‹åºä¸­ï¼Œå¼€å‘äººå‘˜é€šå¸¸å®šä¹‰ä¸€ä¸ªç§æœ‰æ•°æ®ç»“æ„æ¥å­˜å‚¨ç‰¹å®šäºè¯¥é©±åŠ¨ç¨‹åºçš„çŠ¶æ€ä¿¡æ¯å’Œèµ„æºï¼Œä»¥ä¾¿åœ¨å¤„ç†ç½‘ç»œè®¾å¤‡æ—¶å¯ä»¥æ–¹ä¾¿åœ°è®¿é—®è¿™äº›ä¿¡æ¯ã€‚è¿™ç§è®¾è®¡ä¸ä»…æœ‰åŠ©äºæé«˜ä»£ç çš„ç»„ç»‡æ€§ï¼Œè¿˜å°†ç›¸å…³æ•°æ®ä¸ç½‘ç»œè®¾å¤‡å®ä¾‹å…³è”ï¼Œä½¿å¾—å„ä¸ªéƒ¨åˆ†ä¹‹é—´çš„ä¿¡æ¯æµåŠ¨æ›´åŠ æ¸…æ™°ã€‚ netdev_priv(ndev) çš„å·¥ä½œåŸç†ä¾èµ–äºåç§»é‡çš„è®¡ç®—ï¼Œå…·ä½“æ¥è¯´ï¼Œå®ƒé€šè¿‡è®¿é—® net_device ç»“æ„ä½“æœ«å°¾çš„ç§æœ‰æ•°æ®éƒ¨åˆ†æ¥è·å–æŒ‡é’ˆã€‚åœ¨æ­¤ï¼Œndev æ˜¯æŒ‡å‘ net_device ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œè¿™ä½¿å¾—å®ƒèƒ½å¤Ÿç›´æ¥è¿”å›æŒ‡å‘ç§æœ‰æ•°æ®ç»“æ„çš„åœ°å€ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªç½‘ç»œè®¾å¤‡é©±åŠ¨ç¨‹åºçš„ç§æœ‰æ•°æ®ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š struct my_priv_data int some_field; // å­˜å‚¨è®¾å¤‡çŠ¶æ€çš„å­—æ®µ // å…¶ä»–ç‰¹å®šäºé©±åŠ¨ç¨‹åºçš„æ•°æ®; åœ¨è®¾ç½®ç½‘ç»œè®¾å¤‡æ—¶ï¼Œå¼€å‘äººå‘˜éœ€è¦åˆ†é…å’Œåˆå§‹åŒ– net_device ç»“æ„ä½“ï¼Œå¹¶å°†ç§æœ‰æ•°æ®ç»“æ„çš„å¤§å°ä¼ é€’ç»™ alloc_netdev å‡½æ•°ã€‚è¯¥å‡½æ•°è´Ÿè´£ä¸ºè®¾å¤‡çš„ç»“æ„ä½“åˆ†é…å†…å­˜ï¼Œå¹¶ä¸ºç§æœ‰æ•°æ®åˆ†é…é¢å¤–çš„ç©ºé—´ã€‚ struct net_device *ndev;struct my_priv_data *priv;ndev = alloc_netdev(sizeof(struct my_priv_data), my_netdev, NET_NAME_UNKNOWN, my_setup);if (!ndev) printk(KERN_ERR Failed to allocate net_device ); return -ENOMEM; // å†…å­˜åˆ†é…å¤±è´¥æ—¶è¿”å›é”™è¯¯priv = netdev_priv(ndev);priv-some_field = 0; // å°†ç§æœ‰æ•°æ®çš„åˆå§‹å€¼è®¾ä¸º0 åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œalloc_netdev å‡½æ•°ä¸ä»…åˆ†é…äº† net_device ç»“æ„ä½“çš„å†…å­˜ï¼Œè¿˜åœ¨å…¶æœ«å°¾é™„åŠ äº†ä¸€å—ä¸ struct my_priv_data å¤§å°ç›¸ç­‰çš„å†…å­˜åŒºåŸŸã€‚é€šè¿‡ netdev_priv(ndev)ï¼Œå¯ä»¥è·å¾—ä¸€ä¸ªæŒ‡å‘è¿™ä¸€å†…å­˜åŒºåŸŸçš„æŒ‡é’ˆï¼Œä»è€Œæ–¹ä¾¿åœ°è®¿é—®å’Œæ“ä½œç§æœ‰æ•°æ®ã€‚ åœ¨é©±åŠ¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ï¼Œå¯ä»¥åˆ©ç”¨ netdev_priv å®æ¥è¯»å–å’Œæ›´æ–°ç§æœ‰æ•°æ®ã€‚ä¾‹å¦‚ï¼Œåœ¨ç½‘ç»œè®¾å¤‡æ‰“å¼€æˆ–å…³é—­æ—¶ï¼Œå¯èƒ½éœ€è¦è®¿é—®å’Œä¿®æ”¹è¿™äº›æ•°æ®ï¼š static int my_open(struct net_device *ndev) struct my_priv_data *priv = netdev_priv(ndev); // åœ¨è®¾å¤‡æ‰“å¼€æ—¶è®¿é—®å’Œä¿®æ”¹ç§æœ‰æ•°æ® priv-some_field = 1; // è®¾ç½®çŠ¶æ€ä¸ºå·²å¼€å¯ return 0; // æˆåŠŸæ‰“å¼€è®¾å¤‡static int my_stop(struct net_device *ndev) struct my_priv_data *priv = netdev_priv(ndev); // åœ¨è®¾å¤‡åœæ­¢æ—¶è¿›è¡Œæ¸…ç† priv-some_field = 0; // é‡ç½®çŠ¶æ€ return 0; // æˆåŠŸåœæ­¢è®¾å¤‡static const struct net_device_ops my_netdev_ops = .ndo_open = my_open, .ndo_stop = my_stop, // å…¶ä»–ç½‘ç»œè®¾å¤‡æ“ä½œçš„å®ç°; é€šè¿‡ netdev_priv(ndev)ï¼Œé©±åŠ¨ç¨‹åºèƒ½å¤Ÿæœ‰æ•ˆåœ°è®¿é—®å’Œç®¡ç†ä¸ç‰¹å®šç½‘ç»œè®¾å¤‡å®ä¾‹ç›¸å…³çš„ç§æœ‰æ•°æ®ï¼Œä»è€Œå®ç°å¯¹è®¾å¤‡çŠ¶æ€å’Œèµ„æºçš„å…¨é¢æ§åˆ¶ã€‚è¿™ç§è®¾è®¡æ¨¡å¼å€¼å¾—åœ¨å¤šç§è®¾å¤‡é©±åŠ¨ç¨‹åºå¼€å‘ä¸­é‡‡ç”¨ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚ ndev-netdev_ops = rockchip_can_netdev_ops;ndev-netdev_ops = rockchip_can_netdev_ops; è¿™ä¸€è¡Œä»£ç çš„ç›®çš„æ˜¯å°†ç½‘ç»œè®¾å¤‡æ“ä½œå‡½æ•°é›† rockchip_can_netdev_ops èµ‹å€¼ç»™ ndevï¼ˆå³ç½‘ç»œè®¾å¤‡å®ä¾‹ï¼‰çš„ netdev_ops æˆå‘˜ã€‚è¿™ç§åšæ³•æ˜¯å®ç°ç½‘ç»œè®¾å¤‡ä¸å…¶å¯¹åº”çš„æ“ä½œçš„å…³é”®æ­¥éª¤ï¼Œå®ƒå…è®¸æ“ä½œç³»ç»Ÿæœ‰æ•ˆåœ°ç®¡ç†å’Œäº¤äº’è¿™ä¸ªç½‘ç»œè®¾å¤‡ã€‚ åœ¨ Linux å†…æ ¸ä¸­ï¼Œæ¯ä¸ªç½‘ç»œè®¾å¤‡å®ä¾‹éƒ½æ˜¯é€šè¿‡ struct net_device ç»“æ„ä½“æ¥è¡¨ç¤ºçš„ã€‚è¿™ä¸ªç»“æ„ä½“ä¸­åŒ…å«ä¸€ä¸ªåä¸º netdev_ops çš„æˆå‘˜ï¼Œå®ƒæ˜¯æŒ‡å‘ net_device_ops ç»“æ„ä½“çš„æŒ‡é’ˆã€‚net_device_ops ç»“æ„ä½“åŒ…å«äº†ä¸€ç³»åˆ—çš„å‡½æ•°æŒ‡é’ˆï¼Œè¿™äº›æŒ‡é’ˆæŒ‡å‘å®šä¹‰äº†ç‰¹å®šç½‘ç»œæ“ä½œçš„å‡½æ•°ï¼ŒåŒ…æ‹¬è®¾å¤‡çš„å¯åŠ¨ã€åœæ­¢ã€æ•°æ®åŒ…å‘é€å’Œæ¥æ”¶ç­‰åŠŸèƒ½ã€‚ ä»¥ä¸‹æ˜¯ net_device_ops ç»“æ„ä½“çš„ç®€åŒ–å®šä¹‰ï¼Œå±•ç¤ºäº†å…¶ä¸­çš„ä¸€äº›å…³é”®æ“ä½œï¼š struct net_device_ops int (*ndo_init)(struct net_device *dev); void (*ndo_uninit)(struct net_device *dev); int (*ndo_open)(struct net_device *dev); int (*ndo_stop)(struct net_device *dev); netdev_tx_t (*ndo_start_xmit)(struct sk_buff *skb, struct net_device *dev); // å…¶ä»–æ“ä½œå‡½æ•°...; é€šè¿‡å°† rockchip_can_netdev_ops èµ‹å€¼ç»™ ndev-netdev_opsï¼Œå†…æ ¸èƒ½å¤Ÿåœ¨å¯¹è¿™ä¸ªç½‘ç»œè®¾å¤‡è¿›è¡Œæ“ä½œæ—¶ä½¿ç”¨ rockchip_can_netdev_ops ä¸­é¢„å…ˆå®šä¹‰å¥½çš„å‡½æ•°ã€‚å…·ä½“åœ°ï¼Œå½“è®¾å¤‡éœ€è¦è¢«æ‰“å¼€æ—¶ï¼Œå†…æ ¸ä¼šè‡ªåŠ¨è°ƒç”¨ rockchip_can_netdev_ops ä¸­çš„ ndo_open å‡½æ•°ã€‚å½“æœ‰æ•°æ®åŒ…éœ€è¦å‘é€æ—¶ï¼Œåˆ™ä¼šè°ƒç”¨ ndo_start_xmit å‡½æ•°ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº† rockchip_can_netdev_ops çš„ç»“æ„ä½“å®šä¹‰å’Œåˆå§‹åŒ–è¿‡ç¨‹ï¼š static const struct net_device_ops rockchip_can_netdev_ops = .ndo_open = rockchip_can_open, // è®¾å¤‡æ‰“å¼€æ“ä½œ .ndo_stop = rockchip_can_stop, // è®¾å¤‡å…³é—­æ“ä½œ .ndo_start_xmit = rockchip_can_start_xmit, // æ•°æ®åŒ…å‘é€æ“ä½œ // å…¶ä»–æ“ä½œå‡½æ•°...; æ¥ä¸‹æ¥æ˜¯ rockchip_can_probe å‡½æ•°çš„ç¤ºä¾‹ï¼Œå®ƒè´Ÿè´£åˆ†é…ã€åˆå§‹åŒ–ç½‘ç»œè®¾å¤‡å®ä¾‹ ndevï¼Œå¹¶å°†æ“ä½œå‡½æ•°é›†èµ‹å€¼ç»™è¿™ä¸ªå®ä¾‹çš„ netdev_ops æˆå‘˜ï¼š static int rockchip_can_probe(struct platform_device *pdev) struct net_device *ndev; struct rockchip_can_priv *priv; ndev = alloc_netdev(sizeof(struct rockchip_can_priv), can%d, NET_NAME_UNKNOWN, rockchip_can_setup); if (!ndev) return -ENOMEM; // å¦‚æœåˆ†é…å¤±è´¥ï¼Œè¿”å›å†…å­˜ä¸è¶³é”™è¯¯ priv = netdev_priv(ndev); // è·å–ç½‘ç»œè®¾å¤‡çš„ç§æœ‰æ•°æ®åŒºåŸŸ // åˆå§‹åŒ–ç§æœ‰æ•°æ®ç»“æ„ priv-pdev = pdev; // å°†å¹³å°è®¾å¤‡æŒ‡é’ˆå­˜å‚¨åœ¨ç§æœ‰ç»“æ„ä¸­ // å°†æ“ä½œå‡½æ•°é›†èµ‹å€¼ç»™ net_device å®ä¾‹ ndev-netdev_ops = rockchip_can_netdev_ops; // æ³¨å†Œç½‘ç»œè®¾å¤‡åˆ°å†…æ ¸ register_netdev(ndev); return 0; // æˆåŠŸå®Œæˆ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œrockchip_can_probe å‡½æ•°é¦–å…ˆé€šè¿‡ alloc_netdev å‡½æ•°åˆ†é…å†…å­˜å¹¶åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ç½‘ç»œè®¾å¤‡å®ä¾‹ ndevã€‚æ¥ç€ï¼Œå®ƒä¼šå°† rockchip_can_netdev_ops èµ‹å€¼ç»™ ndev-netdev_opsï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“å†…æ ¸éœ€è¦å¯¹è¿™ä¸ªè®¾å¤‡è¿›è¡Œæ“ä½œæ—¶ï¼Œå°±ä¼šè°ƒç”¨ç›¸åº”çš„åŠŸèƒ½å®ç°ã€‚æœ€åï¼Œé€šè¿‡è°ƒç”¨ register_netdev(ndev) å°†æ–°åˆ›å»ºçš„ç½‘ç»œè®¾å¤‡æ³¨å†Œåˆ°å†…æ ¸ï¼Œä½¿å…¶å¯ä»¥è¢«å…¶ä»–éƒ¨åˆ†çš„ç³»ç»Ÿè¯†åˆ«å¹¶ä½¿ç”¨ã€‚è¿™ä¸ªæ­¥éª¤å¯¹äºç¡®ä¿è®¾å¤‡çš„æ­£å¸¸è¿è¡Œå’Œç®¡ç†æ˜¯è‡³å…³é‡è¦çš„ã€‚ register interrupt handlererr = devm_request_irq(pdev-dev, ndev-irq, rockchip_can_interrupt, 0, ndev-name, ndev);if (err) dev_err(pdev-dev, request_irq err: %d , err);\treturn err;rcan-reset = devm_reset_control_array_get(pdev-dev, false, false);if (IS_ERR(rcan-reset)) if (PTR_ERR(rcan-reset) != -EPROBE_DEFER) dev_err(pdev-dev, failed to get rcan reset lines );\treturn PTR_ERR(rcan-reset);rcan-num_clks = devm_clk_bulk_get_all(pdev-dev, rcan-clks);if (rcan-num_clks 1) dev_err(pdev-dev, bus clock not found );\treturn -ENODEV;rcan-dev = pdev-dev;rcan-can.clock.freq = clk_get_rate(rcan-clks[0].clk);rcan-can.bittiming_const = rockchip_can_bittiming_const;rcan-can.do_set_mode = rockchip_can_set_mode;rcan-can.do_get_berr_counter = rockchip_can_get_berr_counter;rcan-can.ctrlmode_supported = CAN_CTRLMODE_BERR_REPORTING | CAN_CTRLMODE_LISTENONLY | CAN_CTRLMODE_LOOPBACK | CAN_CTRLMODE_3_SAMPLES;rcan-base = addr;platform_set_drvdata(pdev, ndev);SET_NETDEV_DEV(ndev, pdev-dev);pm_runtime_enable(pdev-dev);err = pm_runtime_get_sync(pdev-dev);if (err 0) dev_err(pdev-dev, %s: pm_runtime_get failed(%d) , __func__, err);\tgoto err_pmdisable; è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯åœ¨é©±åŠ¨ç¨‹åºçš„æ¢æµ‹å‡½æ•°ï¼ˆprobe å‡½æ•°ï¼‰ä¸­è¿›è¡Œä¸€ç³»åˆ—çš„ç¡¬ä»¶åˆå§‹åŒ–å’Œèµ„æºåˆ†é…ï¼Œä»¥ä¾¿æ­£ç¡®åœ°è®¾ç½®å’Œä½¿ç”¨è®¾å¤‡ã€‚å…·ä½“æ¥è¯´ï¼š æ³¨å†Œä¸­æ–­å¤„ç†ç¨‹åºï¼šerr = devm_request_irq(pdev-dev, ndev-irq, rockchip_can_interrupt, 0, ndev-name, ndev);if (err) dev_err(pdev-dev, request_irq err: %d , err); return err; è¿™éƒ¨åˆ†ä»£ç æ³¨å†Œä¸€ä¸ªä¸­æ–­å¤„ç†ç¨‹åºã€‚å½“è®¾å¤‡äº§ç”Ÿä¸­æ–­æ—¶ï¼Œrockchip_can_interrupt å‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚devm_request_irq å‡½æ•°ä¼šè‡ªåŠ¨ç®¡ç†ä¸­æ–­çš„åˆ†é…å’Œé‡Šæ”¾ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚ è·å–å¤ä½æ§åˆ¶çº¿ï¼šrcan-reset = devm_reset_control_array_get(pdev-dev, false, false);if (IS_ERR(rcan-reset)) if (PTR_ERR(rcan-reset) != -EPROBE_DEFER) dev_err(pdev-dev, failed to get rcan reset lines ); return PTR_ERR(rcan-reset); è¿™éƒ¨åˆ†ä»£ç è·å–è®¾å¤‡çš„å¤ä½æ§åˆ¶çº¿ã€‚devm_reset_control_array_get å‡½æ•°ä¼šè·å–ä¸è®¾å¤‡å…³è”çš„å¤ä½æ§åˆ¶çº¿ï¼Œå¹¶åœ¨è®¾å¤‡é‡Šæ”¾æ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚å¦‚æœè·å–å¤±è´¥ï¼Œä¼šæ‰“å°é”™è¯¯ä¿¡æ¯å¹¶è¿”å›é”™è¯¯ç ã€‚ è·å–æ—¶é’Ÿèµ„æºï¼šrcan-num_clks devm_clk_bulk_get_all(pdev-dev, rcan-clks); if (rcan-num_clks 1) { dev_err(pdev-dev, bus clock not found ); return -ENODEV; } è¿™éƒ¨åˆ†ä»£ç è·å–ä¸è®¾å¤‡ç›¸å…³çš„æ‰€æœ‰æ—¶é’Ÿèµ„æºã€‚devm_clk_bulk_get_all å‡½æ•°ä¼šè¿”å›æ—¶é’Ÿèµ„æºçš„æ•°é‡ï¼Œå¦‚æœæ•°é‡å°‘äº 1ï¼Œåˆ™è¡¨ç¤ºæœªæ‰¾åˆ°æ—¶é’Ÿèµ„æºï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯å¹¶è¿”å›é”™è¯¯ç ã€‚ è®¾ç½® CAN æ§åˆ¶å™¨çš„å‚æ•°ï¼šrcan-dev = pdev-dev;rcan-can.clock.freq = clk_get_rate(rcan-clks[0].clk);rcan-can.bittiming_const = rockchip_can_bittiming_const;rcan-can.do_set_mode = rockchip_can_set_mode;rcan-can.do_get_berr_counter = rockchip_can_get_berr_counter;rcan-can.ctrlmode_supported = CAN_CTRLMODE_BERR_REPORTING | CAN_CTRLMODE_LISTENONLY | CAN_CTRLMODE_LOOPBACK | CAN_CTRLMODE_3_SAMPLES; è¿™éƒ¨åˆ†ä»£ç è®¾ç½® CAN æ§åˆ¶å™¨çš„å„ç§å‚æ•°ï¼ŒåŒ…æ‹¬æ—¶é’Ÿé¢‘ç‡ã€ä½å®šæ—¶å¸¸æ•°ã€æ¨¡å¼è®¾ç½®å‡½æ•°ã€é”™è¯¯è®¡æ•°å™¨è·å–å‡½æ•°ä»¥åŠæ”¯æŒçš„æ§åˆ¶æ¨¡å¼ã€‚ è®¾ç½®è®¾å¤‡åŸºåœ°å€å’Œå…¶ä»–å‚æ•°ï¼šrcan-base = addr;platform_set_drvdata(pdev, ndev);SET_NETDEV_DEV(ndev, pdev-dev); è¿™éƒ¨åˆ†ä»£ç è®¾ç½®è®¾å¤‡çš„åŸºåœ°å€ï¼Œå¹¶å°†ç½‘ç»œè®¾å¤‡å®ä¾‹ä¸å¹³å°è®¾å¤‡å…³è”èµ·æ¥ã€‚platform_set_drvdata å‡½æ•°ç”¨äºå°†ç½‘ç»œè®¾å¤‡å®ä¾‹å­˜å‚¨åœ¨å¹³å°è®¾å¤‡çš„ç§æœ‰æ•°æ®ä¸­ï¼ŒSET_NETDEV_DEV å®ç”¨äºå°†ç½‘ç»œè®¾å¤‡ä¸è®¾å¤‡æ¨¡å‹ä¸­çš„è®¾å¤‡å¯¹è±¡å…³è”ã€‚ å¯ç”¨ç”µæºç®¡ç†ï¼špm_runtime_enable(pdev-dev);err = pm_runtime_get_sync(pdev-dev);if (err 0) dev_err(pdev-dev, %s: pm_runtime_get failed(%d) , __func__, err); goto err_pmdisable; è¿™éƒ¨åˆ†ä»£ç å¯ç”¨è®¾å¤‡çš„è¿è¡Œæ—¶ç”µæºç®¡ç†ï¼Œå¹¶åŒæ­¥è·å–è®¾å¤‡çš„ç”µæºçŠ¶æ€ã€‚å¦‚æœè·å–ç”µæºçŠ¶æ€å¤±è´¥ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯å¹¶è·³è½¬åˆ°é”™è¯¯å¤„ç†ä»£ç ã€‚ æ€»ç»“èµ·æ¥ï¼Œè¿™æ®µä»£ç çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºè®¾å¤‡åˆ†é…å’Œåˆå§‹åŒ–æ‰€éœ€çš„èµ„æºï¼Œè®¾ç½®è®¾å¤‡å‚æ•°ï¼Œå¹¶ç¡®ä¿è®¾å¤‡çš„ç”µæºçŠ¶æ€å’Œä¸­æ–­å¤„ç†éƒ½å·²æ­£ç¡®é…ç½®ã€‚è¿™äº›æ­¥éª¤æ˜¯ç¡®ä¿è®¾å¤‡èƒ½å¤Ÿæ­£å¸¸å·¥ä½œçš„åŸºç¡€ã€‚ æ¥æ”¶struct net_device *ndev = (struct net_device *)dev_id;\tstruct rockchip_can *rcan = netdev_priv(ndev);\tstruct net_device_stats *stats = ndev-stats;\tu8 err_int = ERR_WARN_INT | RX_BUF_OV | PASSIVE_ERR | TX_LOSTARB | BUS_ERR_INT;\tu8 isr;\tisr = readl(rcan-base + CAN_INT);\tif (isr TX_FINISH) /* transmission complete interrupt */ stats-tx_bytes += readl(rcan-base + CAN_TX_FRM_INFO) CAN_DLC_MASK; stats-tx_packets++; rockchip_can_write_cmdreg(rcan, 0); can_get_echo_skb(ndev, 0); netif_wake_queue(ndev); can_led_event(ndev, CAN_LED_EVENT_TX); if (isr RX_FINISH) rockchip_can_rx(ndev);\tif (isr err_int) rockchip_can_clean_rx_info(rcan); if (rockchip_can_err(ndev, isr)) netdev_err(ndev, cant allocate buffer - clearing pending interrupts ); writel(isr, rcan-base + CAN_INT);\trockchip_can_clean_rx_info(rcan);\tnetdev_dbg(ndev, isr: 0x%x , isr);\treturn\tIRQ_HANDLED; è¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ªä¸­æ–­å¤„ç†å‡½æ•°ï¼Œç”¨äºå¤„ç† Rockchip CAN æ§åˆ¶å™¨çš„ä¸­æ–­äº‹ä»¶ã€‚å…·ä½“ä½œç”¨å¦‚ä¸‹ï¼š è·å–è®¾å¤‡å’Œç§æœ‰æ•°æ®ç»“æ„ï¼šstruct net_device *ndev = (struct net_device *)dev_id;struct rockchip_can *rcan = netdev_priv(ndev);struct net_device_stats *stats = ndev-stats; è¿™éƒ¨åˆ†ä»£ç é€šè¿‡ä¸­æ–­å¤„ç†å‡½æ•°çš„å‚æ•° dev_id è·å–ç½‘ç»œè®¾å¤‡å®ä¾‹ ndevï¼Œç„¶åé€šè¿‡ netdev_priv(ndev) è·å–ä¸è¯¥ç½‘ç»œè®¾å¤‡å…³è”çš„ç§æœ‰æ•°æ®ç»“æ„ rcanã€‚åŒæ—¶ï¼Œè·å–ç½‘ç»œè®¾å¤‡çš„ç»Ÿè®¡æ•°æ®ç»“æ„ statsã€‚ å®šä¹‰é”™è¯¯ä¸­æ–­æ ‡å¿—ï¼šu8 err_int = ERR_WARN_INT | RX_BUF_OV | PASSIVE_ERR | TX_LOSTARB | BUS_ERR_INT; è¿™éƒ¨åˆ†ä»£ç å®šä¹‰äº†ä¸€äº›é”™è¯¯ä¸­æ–­æ ‡å¿—ï¼Œåˆ†åˆ«è¡¨ç¤ºä¸åŒç±»å‹çš„é”™è¯¯ä¸­æ–­ã€‚ è¯»å–ä¸­æ–­çŠ¶æ€å¯„å­˜å™¨ï¼šu8 isr;isr = readl(rcan-base + CAN_INT); è¿™éƒ¨åˆ†ä»£ç ä» CAN æ§åˆ¶å™¨çš„ä¸­æ–­çŠ¶æ€å¯„å­˜å™¨è¯»å–å½“å‰çš„ä¸­æ–­çŠ¶æ€ã€‚ å¤„ç†ä¼ è¾“å®Œæˆä¸­æ–­ï¼šif (isr TX_FINISH) /* transmission complete interrupt */ stats-tx_bytes += readl(rcan-base + CAN_TX_FRM_INFO) CAN_DLC_MASK; stats-tx_packets++; rockchip_can_write_cmdreg(rcan, 0); can_get_echo_skb(ndev, 0); netif_wake_queue(ndev); can_led_event(ndev, CAN_LED_EVENT_TX); å¦‚æœä¸­æ–­çŠ¶æ€åŒ…å« TX_FINISH æ ‡å¿—ï¼Œè¡¨ç¤ºä¼ è¾“å®Œæˆä¸­æ–­ã€‚æ­¤æ—¶ï¼š æ›´æ–°ç»Ÿè®¡æ•°æ® tx_bytes å’Œ tx_packetsã€‚ é€šè¿‡ rockchip_can_write_cmdreg å†™å…¥å‘½ä»¤å¯„å­˜å™¨ï¼Œå®Œæˆä¼ è¾“æ“ä½œã€‚ è°ƒç”¨ can_get_echo_skb è·å–å›æ˜¾æ•°æ®åŒ…ã€‚ è°ƒç”¨ netif_wake_queue é‡æ–°å¯åŠ¨ç½‘ç»œé˜Ÿåˆ—ã€‚ è°ƒç”¨ can_led_event æŒ‡ç¤ºä¼ è¾“äº‹ä»¶ã€‚ å¤„ç†æ¥æ”¶å®Œæˆä¸­æ–­ï¼šif (isr RX_FINISH) rockchip_can_rx(ndev); å¦‚æœä¸­æ–­çŠ¶æ€åŒ…å« RX_FINISH æ ‡å¿—ï¼Œè¡¨ç¤ºæ¥æ”¶å®Œæˆä¸­æ–­ã€‚æ­¤æ—¶è°ƒç”¨ rockchip_can_rx å‡½æ•°å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®ã€‚ å¤„ç†é”™è¯¯ä¸­æ–­ï¼šif (isr err_int) rockchip_can_clean_rx_info(rcan); if (rockchip_can_err(ndev, isr)) netdev_err(ndev, cant allocate buffer - clearing pending interrupts ); å¦‚æœä¸­æ–­çŠ¶æ€åŒ…å«é”™è¯¯ä¸­æ–­æ ‡å¿—ï¼Œè¡¨ç¤ºå‘ç”Ÿé”™è¯¯ä¸­æ–­ã€‚æ­¤æ—¶ï¼š è°ƒç”¨ rockchip_can_clean_rx_info æ¸…ç†æ¥æ”¶ä¿¡æ¯ã€‚ è°ƒç”¨ rockchip_can_err å¤„ç†é”™è¯¯ï¼Œå¦‚æœå¤„ç†å¤±è´¥ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯ã€‚ æ¸…é™¤ä¸­æ–­æ ‡å¿—ï¼šwritel(isr, rcan-base + CAN_INT);rockchip_can_clean_rx_info(rcan); è¿™éƒ¨åˆ†ä»£ç å°†ä¸­æ–­çŠ¶æ€å†™å›ä¸­æ–­çŠ¶æ€å¯„å­˜å™¨ï¼Œä»¥æ¸…é™¤ä¸­æ–­æ ‡å¿—ï¼Œå¹¶å†æ¬¡è°ƒç”¨ rockchip_can_clean_rx_info æ¸…ç†æ¥æ”¶ä¿¡æ¯ã€‚ æ‰“å°è°ƒè¯•ä¿¡æ¯å¹¶è¿”å›ï¼šnetdev_dbg(ndev, isr: 0x%x , isr);return IRQ_HANDLED; æ‰“å°è°ƒè¯•ä¿¡æ¯ï¼Œå¹¶è¿”å› IRQ_HANDLED è¡¨ç¤ºä¸­æ–­å·²è¢«å¤„ç†ã€‚ æ€»ä½“è€Œè¨€ï¼Œè¿™æ®µä»£ç å®ç°äº†å¯¹ Rockchip CAN æ§åˆ¶å™¨ä¸­æ–­çš„å…¨é¢å¤„ç†ï¼ŒåŒ…æ‹¬ä¼ è¾“å®Œæˆã€æ¥æ”¶å®Œæˆå’Œé”™è¯¯ä¸­æ–­çš„å¤„ç†ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","é©±åŠ¨"]},{"title":"OpenMediaVault","path":"/2024/10/31/1-å¹³å°ç³»ç»Ÿ-NAS-OpenMediaVault/","content":"OpenMediaVaulté¡¹ç›®åœ°å€ï¼šOpenMediaVault OpenMediaVault æ˜¯ä¸€ä¸ªåŸºäº Debian Linux çš„å¼€æºç½‘ç»œé™„åŠ å­˜å‚¨ï¼ˆNASï¼‰è§£å†³æ–¹æ¡ˆï¼Œç”± FreeNAS æ ¸å¿ƒå¼€å‘è€… Volker Theile é¢†å¯¼å¼€å‘ã€‚æ­¤é¡¹ç›®ç‰¹åˆ«å…³æ³¨äºå®¶åº­ç”¨æˆ·å’Œå°å‹åŠå…¬ç¯å¢ƒï¼Œæ—¨åœ¨ç®€å•æ˜“ç”¨ï¼Œæä¾›ç›´è§‚çš„ç•Œé¢å’Œé«˜æ•ˆçš„åŠŸèƒ½ã€‚ é•œåƒå®‰è£…æ‰‹å†Œå®‰è£… OpenMediaVault å…¶å®å¹¶ä¸å¤æ‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªè¯¦ç»†çš„æ­¥éª¤æŒ‡å—ï¼Œå¸®åŠ©ç”¨æˆ·é¡ºåˆ©å®Œæˆå®‰è£…ã€‚ å‡†å¤‡æœåŠ¡å™¨ç¡¬ä»¶ ç¡®ä¿çš„è®¡ç®—æœºæˆ–æœåŠ¡å™¨å…·å¤‡è¶³å¤Ÿçš„ç¡¬ä»¶èµ„æºã€‚æ¨èçš„æœ€ä½é…ç½®åŒ…æ‹¬ï¼š CPUï¼šåŒæ ¸å¤„ç†å™¨ï¼ˆå¦‚ Intel Core i3 æˆ– AMD Athlon åŒæ ¸ï¼‰ å†…å­˜ï¼šè‡³å°‘ 2GB RAMï¼ˆæ›´é«˜æ›´å¥½ï¼Œä»¥æ”¯æŒå¤šä¸ªæœåŠ¡ï¼‰ å­˜å‚¨ï¼š200GB ä»¥ä¸Šçš„ç¡¬ç›˜é©±åŠ¨å™¨ï¼ˆHDD æˆ–å›ºæ€ç¡¬ç›˜ SSDï¼‰ ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨æ—§çš„å°å¼æœºï¼Œé…å¤‡ 4GB å†…å­˜å’Œ 500GB ç¡¬ç›˜æ¥éƒ¨ç½² OpenMediaVaultã€‚ ä¸‹è½½ OpenMediaVault é•œåƒ è®¿é—® OpenMediaVault å®˜æ–¹ä¸‹è½½é¡µé¢ï¼Œä¸‹è½½æœ€æ–°çš„ ISO é•œåƒæ–‡ä»¶ã€‚ å¯é€‰æ‹©ä½¿ç”¨é•œåƒå†™å…¥å·¥å…·ï¼ˆå¦‚ Rufus æˆ– balenaEtcherï¼‰åˆ›å»ºä¸€ä¸ªå¯å¯åŠ¨çš„ USB é©±åŠ¨å™¨ã€‚ åˆ›å»ºå®‰è£…åª’ä½“ ä½¿ç”¨ USB é©±åŠ¨å™¨å°†ä¸‹è½½çš„ ISO æ–‡ä»¶å†™å…¥ã€‚æ’å…¥ USB é©±åŠ¨å™¨ï¼Œå¯åŠ¨ Rufusï¼Œé€‰æ‹© ISO æ–‡ä»¶å¹¶ç‚¹å‡»â€å¼€å§‹â€ã€‚ åˆ›å»ºå®Œæˆåï¼Œç¡®ä¿è®¾ç½® BIOSUEFI ä½¿å…¶ä» USB é©±åŠ¨å™¨å¯åŠ¨ã€‚ å¯åŠ¨å®‰è£…ç¨‹åº å¯åŠ¨è®¡ç®—æœºï¼Œç¡®ä¿é€‰å®šçš„ USB é©±åŠ¨å™¨ä¸ºå¯åŠ¨ä»‹è´¨ã€‚ å®‰è£…ç•Œé¢ä¼šå‡ºç°ï¼Œè·Ÿéšæç¤ºè¿›è¡Œè¯­è¨€ã€åœ°åŒºåŠæ—¶é—´è®¾ç½®çš„é€‰æ‹©ã€‚ é€‰æ‹©å®‰è£…ç±»å‹ åœ¨â€åˆ†åŒºâ€æ­¥éª¤ä¸­ï¼Œå¯ä»¥é€‰æ‹©æ•´ä¸ªç¡¬ç›˜æˆ–æ‰‹åŠ¨åˆ†åŒºã€‚æ ¹æ®éœ€æ±‚é€‰æ‹©é€‚åˆçš„åˆ†åŒºæ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœç¡¬ç›˜ä¸Šæ²¡æœ‰å…¶ä»–æ•°æ®ï¼Œå¯ä»¥é€‰æ‹©å°†æ•´ä¸ªç¡¬ç›˜ç”¨äº OpenMediaVaultã€‚ å®Œæˆå®‰è£… å®‰è£…è¿‡ç¨‹é€šå¸¸éœ€è¦ 10 åˆ° 20 åˆ†é’Ÿã€‚å®Œæˆåï¼Œç³»ç»Ÿä¼šæç¤ºé‡å¯ã€‚ å–å‡º USB é©±åŠ¨å™¨ï¼Œé‡å¯ç³»ç»Ÿã€‚ è®¿é—® Web ç•Œé¢ ä½¿ç”¨æµè§ˆå™¨è®¿é—® http://your-server-ipï¼Œå…¶ä¸­ your-server-ip æ˜¯å®‰è£… OpenMediaVault çš„è®¾å¤‡ IP åœ°å€ã€‚ é»˜è®¤ç”¨æˆ·åä¸º adminï¼Œå¯†ç ä¸º openmediavaultã€‚é¦–æ¬¡ç™»å½•åå»ºè®®ç«‹å³æ›´æ”¹å¯†ç ä»¥æé«˜å®‰å…¨æ€§ã€‚ é…ç½®å­˜å‚¨å’ŒæœåŠ¡ ç™»å½•åï¼Œå¯ä»¥åœ¨ç•Œé¢ä¸­è®¾ç½®å­˜å‚¨è®¾å¤‡ã€å…±äº«æ–‡ä»¶å¤¹ã€ç”¨æˆ·æƒé™ä»¥åŠå…¶ä»–ç½‘ç»œæœåŠ¡ï¼ˆå¦‚ FTPã€Sambaï¼‰ã€‚ ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªå…±äº«æ–‡ä»¶å¤¹ç”¨äºå¤‡ä»½ï¼Œå°†å…¶è®¾ç½®ä¸º SMBCIFSï¼Œä»¥ä¾¿åœ¨ Windows è®¡ç®—æœºä¸Šè®¿é—®ã€‚ é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œç”¨æˆ·å¯ä»¥è½»æ¾å®‰è£…å¹¶å¼€å§‹ä½¿ç”¨ OpenMediaVaultï¼Œäº«å—ç®€æ´é«˜æ•ˆçš„ NAS è§£å†³æ–¹æ¡ˆã€‚æ— è®ºæ˜¯ä¸ªäººæ–‡ä»¶å­˜å‚¨è¿˜æ˜¯å®¶åº­åª’ä½“å…±äº«ï¼ŒOpenMediaVault éƒ½èƒ½æä¾›å¯é çš„æœåŠ¡ã€‚ Docker ä¸‹çš„ OpenMediaVault éƒ¨ç½²æ‰‹å†Œç¯å¢ƒå‡†å¤‡åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š æ“ä½œç³»ç»Ÿ: æ¨èä½¿ç”¨åŸºäº Debian çš„ç³»ç»Ÿï¼ˆå¦‚ Ubuntu 20.04 æˆ– Debian 10ï¼‰ã€‚ Docker: ç¡®ä¿å·²å®‰è£… Dockerï¼ˆç‰ˆæœ¬åº”ä¸º 19.03 åŠä»¥ä¸Šï¼‰ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š sudo apt-get updatesudo apt-get install -y apt-transport-https ca-certificates curl software-properties-commoncurl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -add-apt-repository deb [arch=amd64] https://download.docker.com/linux/debian $(lsb_release -cs) stablesudo apt-get updatesudo apt-get install -y docker-ce Docker Compose: ä¸ºäº†ä¾¿äºç®¡ç†å¤šä¸ªå®¹å™¨ï¼Œå°†ä½¿ç”¨ Docker Composeã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š sudo apt-get install -y docker-compose æ‹‰å– OpenMediaVault é•œåƒæ¥ä¸‹æ¥ï¼Œéœ€è¦ä» Docker Hub ä¸Šæ‹‰å– OpenMediaVault çš„é•œåƒã€‚åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š docker pull openmediavault è¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå…·ä½“å–å†³äºçš„ç½‘ç»œé€Ÿåº¦å’Œç³»ç»Ÿæ€§èƒ½ã€‚ é…ç½® Docker ç½‘ç»œä¸ºäº†è®© OMV èƒ½å¤Ÿè®¿é—®ç½‘ç»œå’Œå…¶ä»–å®¹å™¨ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ Docker ç½‘ç»œã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š docker network create omv-network é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒOMV å®¹å™¨å°†èƒ½å’Œå…¶ä»–åº”ç”¨ï¼ˆå¦‚åª’ä½“æœåŠ¡å™¨æˆ–å¤‡ä»½è½¯ä»¶ï¼‰æ›´é«˜æ•ˆåœ°é€šä¿¡ã€‚ åˆ›å»º Docker Compose æ–‡ä»¶åœ¨çš„å·¥ä½œç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª docker-compose.yml æ–‡ä»¶ï¼Œå¹¶è¾“å…¥ä»¥ä¸‹é…ç½®ï¼š version: 3.3services: openmediavault: image: openmediavault container_name: openmediavault networks: - omv-network ports: - 80:80 - 443:443 volumes: - omv_data:/var/lib/openmediavault - /etc/localtime:/etc/localtime:ro restart: unless-stoppednetworks: omv-network:volumes: omv_data: åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œè®¾å®šäº†ä»¥ä¸‹å†…å®¹ï¼š æœåŠ¡åç§°ï¼šopenmediavaultï¼ŒæŒ‡å®šäº†ä½¿ç”¨çš„é•œåƒã€‚ ç½‘ç»œè®¾ç½®ï¼šè®¾ç½®ä¸ºä¹‹å‰åˆ›å»ºçš„ omv-networkã€‚ ç«¯å£æ˜ å°„ï¼šå°†æœ¬åœ° 80 å’Œ 443 ç«¯å£æ˜ å°„åˆ°å®¹å™¨å†…çš„ç›¸åº”ç«¯å£ï¼Œä»¥ä¾¿å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® OMVï¼ˆHTTP å’Œ HTTPSï¼‰ã€‚ æ•°æ®æŒä¹…åŒ–ï¼šä½¿ç”¨ Docker å· omv_data æ¥ç¡®ä¿ OMV çš„æ•°æ®åœ¨å®¹å™¨é‡å¯æ—¶ä¾ç„¶å¯ç”¨ã€‚ é‡å¯ç­–ç•¥ï¼šè®¾ç½®ä¸º unless-stoppedï¼Œæ„å‘³ç€é™¤éæ‰‹åŠ¨åœæ­¢ï¼Œå¦åˆ™å®¹å™¨ä¼šåœ¨å´©æºƒåè‡ªåŠ¨é‡å¯ã€‚ å¯åŠ¨ OpenMediaVaultåœ¨ docker-compose.yml æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å¯åŠ¨ OMV å®¹å™¨ï¼š docker-compose up -d ä½¿ç”¨ -d é€‰é¡¹å¯ä»¥è®©å®¹å™¨åœ¨åå°è¿è¡Œã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å®¹å™¨çš„è¿è¡ŒçŠ¶æ€ï¼š docker ps è®¿é—® OpenMediaVaultæ‰“å¼€çš„æµè§ˆå™¨ï¼Œåœ¨åœ°å€æ ä¸­è¾“å…¥ http://çš„æœåŠ¡å™¨IPï¼Œå°†çœ‹åˆ° OpenMediaVault çš„ç™»å½•ç•Œé¢ã€‚é»˜è®¤çš„ç”¨æˆ·åæ˜¯ adminï¼Œå¯†ç æ˜¯ openmediavaultã€‚é¦–æ¬¡ç™»å½•åï¼Œè¯·åŠ¡å¿…æ”¹å˜é»˜è®¤å¯†ç ä»¥ç¡®ä¿å®‰å…¨ã€‚ é…ç½®å­˜å‚¨å’ŒæœåŠ¡ç™»å½•åï¼Œå¯ä»¥é€šè¿‡ OMV çš„ Web ç•Œé¢é…ç½®å­˜å‚¨ã€å…±äº«æ–‡ä»¶å¤¹å’Œå„ç§æœåŠ¡ï¼Œä¾‹å¦‚ FTPã€SMBCIFSã€NFS ç­‰ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›åŸºæœ¬è®¾ç½®ç¤ºä¾‹ï¼š æ·»åŠ å­˜å‚¨ä»‹è´¨ï¼šåœ¨å·¦ä¾§èœå•ä¸­é€‰æ‹©â€å­˜å‚¨è®¾å¤‡â€ï¼Œç„¶åç‚¹å‡»â€åˆ›å»ºâ€ï¼Œé€‰æ‹©éœ€è¦æ ¼å¼åŒ–çš„ç£ç›˜ï¼Œè®¾ç½®ä¸º EXT4 æ ¼å¼ã€‚ åˆ›å»ºå…±äº«æ–‡ä»¶å¤¹ï¼šåœ¨â€å…±äº«æ–‡ä»¶å¤¹â€é€‰é¡¹ä¸­ï¼Œç‚¹å‡»â€æ·»åŠ â€ï¼Œå¹¶æŒ‡å®šåˆšæ‰åˆ›å»ºçš„å­˜å‚¨è®¾å¤‡ã€‚ è®¾ç½®æœåŠ¡ï¼šé€‰æ‹©â€æœåŠ¡â€é€‰é¡¹ï¼Œå¯ç”¨ SMBCIFS å…±äº«ï¼Œä»¥ä¾¿ Windows è®¾å¤‡å¯ä»¥è®¿é—® OMV ä¸Šçš„æ–‡ä»¶ã€‚ åç»­ç®¡ç†åœ¨ä½¿ç”¨ OpenMediaVault çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½éœ€è¦å®šæœŸæ£€æŸ¥ç³»ç»Ÿæ›´æ–°ä¸æœåŠ¡çŠ¶æ€ã€‚å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ›´æ–° Docker å®¹å™¨ï¼š docker-compose pull ç„¶åé‡å¯æœåŠ¡ï¼š docker-compose up -d","categories":["1.å¹³å°ç³»ç»Ÿ","NAS"]},{"title":"RK3568 è½¯è·¯ç”±-OpenWRT","path":"/2024/10/30/1-å¹³å°ç³»ç»Ÿ-NAS-RK3568-è½¯è·¯ç”±-OpenWRT/","content":"Firefly Linux å¼€å‘æŒ‡å— 1.1. æ”¯æŒè®¾å¤‡åˆ—è¡¨ ä¸»æ§ æ¿å¡å‹å· RK3568 ROC-RK3568-PCStation-P2 1.2. ç™»å½• IP ã€ç™»å½•å¯†ç å’Œ WIFI åç§°å›ºä»¶é»˜è®¤ç™»å½• IP ä¸º 192.168.1.1ï¼Œç™»å½•å¯†ç ä¸º fireflyã€‚ é»˜è®¤ WIFI åç§°ä¸º OpenWRT-XXXXï¼Œæ— å¯†ç  1.3. WAN å£å’Œ LAN å£æ˜ å°„Station P2/ROC-3568-PCï¼š å¤–å£³ Linux ç½‘å¡ WAN å£ ç½‘å£ 1 eth0 LAN å£ ç½‘å£ 2 eth1 1.5. å›ºä»¶çƒ§å½•1.5.1. çƒ§å†™åˆ° SD å¡ï¼ˆæ¨èï¼‰1.5.1.2. ä½¿ç”¨ balenaEtcher åˆ¶ä½œ SD å¯åŠ¨å¡ 1.5.2. çƒ§å†™åˆ° EMMC1.5.2.1. ä¸‹è½½ RK çƒ§å½•å·¥å…· å®‰è£… RK é©±åŠ¨åŠ©æ‰‹ ä¸‹è½½åœ°å€ï¼šhttps://www.t-firefly.com/doc/download/103.html#other_432 å®‰è£… Android Tools çƒ§å†™å·¥å…· ä¸‹è½½åœ°å€ï¼šhttps://www.t-firefly.com/doc/download/103.html#other_431 ä¸‹è½½ RK3566/RK3568 NorFlash2eMMCLoader ä¸‹è½½åœ°å€ï¼šhttps://www.t-firefly.com/doc/download/103.html#other_551 åˆ‡æ¢åˆ° EMMC å­˜å‚¨å™¨ æ–­å¼€ç”µæºï¼Œå°† type-c çº¿æ¥å…¥å¼€å‘æ¿ï¼Œé•¿æŒ‰ recovery æŒ‰é”®ï¼Œæ’ä¸Šç”µæºä¸Šç”µï¼Œè¿›å…¥ maskrom æ¨¡å¼ çƒ§å†™ RK356x_NorFlash2eMMC-Loader_xxx.img çƒ§å†™æˆåŠŸåç­‰å¾… 20s å·¦å³ï¼Œç³»ç»Ÿè¿›å…¥ Loader æ¨¡å¼ çƒ§å†™åˆ° EMMC å­˜å‚¨å™¨ è§£å‹å›ºä»¶ï¼ˆæ³¨æ„çƒ§å†™åˆ° EMMC çš„å›ºä»¶å¿…é¡»è¿›è¡Œè§£å‹ï¼‰ æŒ‰ä¸‹å›¾å³é”®æ·»åŠ ä¸€ä¸ªâ€OpenWRTâ€œé€‰é¡¹ï¼Œåœ°å€ä¸º 0ï¼Œé€‰æ‹©è§£å‹çš„å›ºä»¶ï¼Œç„¶åçƒ§å½• 1.6. å›ºä»¶ç¼–è¯‘1.6.1. å¿…è¦æ¡ä»¶ å®‰è£…å¥½ Ubuntu18.04 åŠå…¶ä»¥ä¸Šç‰ˆæœ¬çš„ç³»ç»Ÿ 1.6.2. ç¯å¢ƒæ­å»ºsudo apt update -ysudo apt full-upgrade -ysudo apt install -y ack antlr3 asciidoc autoconf automake autopoint binutils bison build-essential \\bzip2 ccache cmake cpio curl device-tree-compiler fastjar flex gawk gettext gcc-multilib g++-multilib \\git gperf haveged help2man intltool libc6-dev-i386 libelf-dev libglib2.0-dev libgmp3-dev libltdl-dev \\libmpc-dev libmpfr-dev libncurses5-dev libncursesw5-dev libreadline-dev libssl-dev libtool lrzsz \\mkisofs msmtp nano ninja-build p7zip p7zip-full patch pkgconf python2.7 python3 python3-pip libpython3-dev qemu-utils \\rsync scons squashfs-tools subversion swig texinfo uglifyjs upx-ucl unzip vim wget xmlto xxd zlib1g-dev 1.6.3. æºç ä¸‹è½½git clone https://github.com/FireflyTeam/ledecd lede./scripts/feeds update -a./scripts/feeds install -amake download -j$(nproc) 1.6.4. æºç ç¼–è¯‘ ç¼–è¯‘ ROC-RK3568-PC/Station-P2 cp config/station_p2_base_defconfig .configmake defconfigmake V=s -j$(nproc) 1.6.5. ç¼–è¯‘æˆåŠŸä¹‹åç¼–è¯‘æˆåŠŸä¹‹åï¼Œå›ºä»¶æ‰€åœ¨è·¯å¾„ï¼šbin/targets/rockchip/armv8/ -rw-r--r-- 1 user1 user1 26085956 8æœˆ 17 09:49 Station_P2_LEDE_GPT_RAW_20220817.zip 1.7. æ‰©å±•åˆ†åŒºçƒ§å½•å®Œå›ºä»¶ä¹‹åï¼Œä¸€èˆ¬åªæœ‰å‡ ç™¾ MB çš„ç©ºé—´ä¾›ä½¿ç”¨ï¼Œå› æ­¤éœ€è¦å°†åˆ†åŒºè¿›è¡Œæ‰©å±•ã€‚è¿™ä¸€æ­¥æ“ä½œå¯ä»¥åœ¨ luci ç•Œé¢è¿›è¡Œé…ç½®ï¼š è¿›å…¥ç£ç›˜ç®¡ç†ï¼Œå°†å‰©ä½™çš„ç©ºé—´åˆ›å»ºä¸ºä¸€ä¸ªæ–°åˆ†åŒº ç‚¹å‡»ç£ç›˜ç®¡ç† ä¿®æ”¹ç£ç›˜ åˆ›å»ºä¸€ä¸ªæ–°åˆ†åŒº æ ¼å¼åŒ–æ–°åˆ†åŒºä¸º ext4 æ–‡ä»¶ç³»ç»Ÿ è¿›å…¥æŒ‚è½½ç‚¹ï¼Œå°†æ–°åˆ†åŒºæŒ‚è½½åˆ° /overlay ç‚¹å‡»æŒ‚è½½ç‚¹ æ·»åŠ ä¸€ä¸ªæ–°çš„æŒ‚è½½ç‚¹ å¯ç”¨æ­¤æŒ‚è½½ç‚¹ï¼Œå¹¶æŠŠ UUID æ‰€åœ¨åˆ†åŒºæ–°åˆ›å»ºåˆ†åŒºï¼ŒæŒ‚è½½ç‚¹ä¸º /overlay è®°å¾—ä¿å­˜å¹¶åº”ç”¨ ä¿å­˜æŒ‚è½½ç‚¹ä¿¡æ¯","tags":["clippings"],"categories":["1.å¹³å°ç³»ç»Ÿ","NAS"]},{"title":"CANé©±åŠ¨500kæ¥æ”¶å¯¼è‡´CPUæŸæ ¸å¿ƒæ»¡è½½","path":"/2024/10/29/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-CANé©±åŠ¨500kæ¥æ”¶å¯¼è‡´CPUæŸæ ¸å¿ƒæ»¡è½½/","content":"å½“ CAN ä½œä¸ºæ¥æ”¶ç«¯æ—¶ï¼Œå¿«é€Ÿçš„æ•°æ®æ¥æ”¶ä¼šå¯¼è‡´ CPU 4 å¤„äºæ»¡è½½çŠ¶æ€ã€‚è¿™ç§æƒ…å†µåœ¨æ–­å¼€ CAN æ¥å£æˆ–è€…å¤–éƒ¨è®¾å¤‡åæ¢å¤æ­£å¸¸ã€‚åœ¨ CAN æ¥æ”¶ä¸­æ–­ä¸­è®°å½•çš„æ—¥å¿—æ˜¾ç¤ºï¼Œæ—¥å¿—çš„æ‰“å°æ—¶é—´æ˜¯ä¸æ¥æ”¶åˆ°çš„æ•°æ®çš„æ—¶é—´ç´§å¯†ç›¸å…³ã€‚æ¥æ”¶çš„æ•°æ®é€Ÿç‡è¿‡é«˜å¯èƒ½åœ¨æŸç§ç¨‹åº¦ä¸Šå½±å“äº† CPU çš„å¤„ç†èƒ½åŠ›ï¼Œå¯¼è‡´å…¶æ— æ³•æœ‰æ•ˆç®¡ç†å¤„ç†å™¨èµ„æºï¼Œä»è€Œå‡ºç°è¿‡è½½ç°è±¡ã€‚ åœ¨é©±åŠ¨ç¨‹åº rockchip_canfd.c ä¸­ç¦ç”¨ NAPI åï¼Œç³»ç»Ÿæ¢å¤æ­£å¸¸ã€‚NAPIï¼ˆæ–°å‹è‡ªé€‚åº”ä¸­æ–­å¤„ç†æœºåˆ¶ï¼‰æ—¨åœ¨æé«˜ç½‘ç»œå¤„ç†æ€§èƒ½ï¼Œé’ˆå¯¹ä¸åŒç¡¬ä»¶å’Œè½¯ä»¶ç¯å¢ƒï¼ŒNAPI çš„æ•ˆæœå’Œè¡¨ç°å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œå¯èƒ½ä¸æ˜¯æœ€ä½³é€‰æ‹©ã€‚ ä¾‹å¦‚ï¼ŒæŸäº›ç¡¬ä»¶å¯èƒ½åŸæœ¬è®¾è®¡ç”¨äºå¤„ç†ä½é€Ÿç‡æ•°æ®ï¼Œè¿™å°±ä½¿å¾—åœ¨é«˜é€Ÿæ•°æ®æ¥æ”¶æ—¶ï¼Œå³ä¾¿ä½¿ç”¨äº† NAPIï¼Œåè€Œä¼šå› é¢‘ç¹çš„ä¸­æ–­å’Œå¤„ç†å¯¼è‡´ CPU è´Ÿè½½è¿‡é‡ï¼Œæœ€ç»ˆå¼•å‘æ€§èƒ½ç“¶é¢ˆã€‚åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦é‡æ–°è¯„ä¼°æ•°æ®æ¥æ”¶å’Œä¸­æ–­ç®¡ç†ç­–ç•¥ï¼Œä¸ºç‰¹å®šçš„ç¡¬ä»¶ç¯å¢ƒä¼˜åŒ–æ¥æ”¶æ–¹æ¡ˆæˆ–ä¸­æ–­å¤„ç†æ–¹å¼ã€‚ // SPDX-License-Identifier: GPL-2.0/* * Copyright (c) 2020 Rockchip Electronics Co. Ltd. * Rockchip CANFD driver */#include linux/delay.h#include linux/iopoll.h#include linux/pinctrl/consumer.h#include linux/clk.h#include linux/errno.h#include linux/init.h#include linux/interrupt.h#include linux/io.h#include linux/kernel.h#include linux/module.h#include linux/netdevice.h#include linux/of.h#include linux/of_device.h#include linux/platform_device.h#include linux/skbuff.h#include linux/spinlock.h#include linux/string.h#include linux/types.h#include linux/can/dev.h#include linux/can/error.h#include linux/can/led.h#include linux/reset.h#include linux/pm_runtime.h#include linux/rockchip/cpu.h/* registers definition */enum rockchip_canfd_reg CAN_MODE = 0x00,\tCAN_CMD = 0x04,\tCAN_STATE = 0x08,\tCAN_INT = 0x0c,\tCAN_INT_MASK = 0x10,\tCAN_LOSTARB_CODE = 0x28,\tCAN_ERR_CODE = 0x2c,\tCAN_RX_ERR_CNT = 0x34,\tCAN_TX_ERR_CNT = 0x38,\tCAN_IDCODE = 0x3c,\tCAN_IDMASK = 0x40,\tCAN_TX_CHECK_FIC = 0x50,\tCAN_NBTP = 0x100,\tCAN_DBTP = 0x104,\tCAN_TDCR = 0x108,\tCAN_TSCC = 0x10c,\tCAN_TSCV = 0x110,\tCAN_TXEFC = 0x114,\tCAN_RXFC = 0x118,\tCAN_AFC = 0x11c,\tCAN_IDCODE0 = 0x120,\tCAN_IDMASK0 = 0x124,\tCAN_IDCODE1 = 0x128,\tCAN_IDMASK1 = 0x12c,\tCAN_IDCODE2 = 0x130,\tCAN_IDMASK2 = 0x134,\tCAN_IDCODE3 = 0x138,\tCAN_IDMASK3 = 0x13c,\tCAN_IDCODE4 = 0x140,\tCAN_IDMASK4 = 0x144,\tCAN_TXFIC = 0x200,\tCAN_TXID = 0x204,\tCAN_TXDAT0 = 0x208,\tCAN_TXDAT1 = 0x20c,\tCAN_TXDAT2 = 0x210,\tCAN_TXDAT3 = 0x214,\tCAN_TXDAT4 = 0x218,\tCAN_TXDAT5 = 0x21c,\tCAN_TXDAT6 = 0x220,\tCAN_TXDAT7 = 0x224,\tCAN_TXDAT8 = 0x228,\tCAN_TXDAT9 = 0x22c,\tCAN_TXDAT10 = 0x230,\tCAN_TXDAT11 = 0x234,\tCAN_TXDAT12 = 0x238,\tCAN_TXDAT13 = 0x23c,\tCAN_TXDAT14 = 0x240,\tCAN_TXDAT15 = 0x244,\tCAN_RXFIC = 0x300,\tCAN_RXID = 0x304,\tCAN_RXTS = 0x308,\tCAN_RXDAT0 = 0x30c,\tCAN_RXDAT1 = 0x310,\tCAN_RXDAT2 = 0x314,\tCAN_RXDAT3 = 0x318,\tCAN_RXDAT4 = 0x31c,\tCAN_RXDAT5 = 0x320,\tCAN_RXDAT6 = 0x324,\tCAN_RXDAT7 = 0x328,\tCAN_RXDAT8 = 0x32c,\tCAN_RXDAT9 = 0x330,\tCAN_RXDAT10 = 0x334,\tCAN_RXDAT11 = 0x338,\tCAN_RXDAT12 = 0x33c,\tCAN_RXDAT13 = 0x340,\tCAN_RXDAT14 = 0x344,\tCAN_RXDAT15 = 0x348,\tCAN_RXFRD = 0x400,\tCAN_TXEFRD = 0x500,;enum ROCKCHIP_CANFD_MODE = 0,\tROCKCHIP_CAN_MODE,\tROCKCHIP_RK3568_CAN_MODE,\tROCKCHIP_RK3568_CAN_MODE_V2,;#define DATE_LENGTH_12_BYTE\t(0x9)#define DATE_LENGTH_16_BYTE\t(0xa)#define DATE_LENGTH_20_BYTE\t(0xb)#define DATE_LENGTH_24_BYTE\t(0xc)#define DATE_LENGTH_32_BYTE\t(0xd)#define DATE_LENGTH_48_BYTE\t(0xe)#define DATE_LENGTH_64_BYTE\t(0xf)#define CAN_TX0_REQ BIT(0)#define CAN_TX1_REQ BIT(1)#define CAN_TX_REQ_FULL ((CAN_TX0_REQ) | (CAN_TX1_REQ))#define MODE_FDOE BIT(15)#define MODE_BRSD BIT(13)#define MODE_SPACE_RX BIT(12)#define MODE_AUTO_RETX BIT(10)#define MODE_RXSORT BIT(7)#define MODE_TXORDER BIT(6)#define MODE_RXSTX BIT(5)#define MODE_LBACK BIT(4)#define MODE_SILENT BIT(3)#define MODE_SELF_TEST BIT(2)#define MODE_SLEEP BIT(1)#define RESET_MODE 0#define WORK_MODE BIT(0)#define RX_FINISH_INT BIT(0)#define TX_FINISH_INT BIT(1)#define ERR_WARN_INT BIT(2)#define RX_BUF_OV_INT BIT(3)#define PASSIVE_ERR_INT BIT(4)#define TX_LOSTARB_INT BIT(5)#define BUS_ERR_INT BIT(6)#define RX_FIFO_FULL_INT\tBIT(7)#define RX_FIFO_OV_INT BIT(8)#define BUS_OFF_INT BIT(9)#define BUS_OFF_RECOVERY_INT\tBIT(10)#define TSC_OV_INT BIT(11)#define TXE_FIFO_OV_INT BIT(12)#define TXE_FIFO_FULL_INT\tBIT(13)#define WAKEUP_INT BIT(14)#define ERR_TYPE_MASK GENMASK(28, 26)#define ERR_TYPE_SHIFT 26#define BIT_ERR 0#define STUFF_ERR 1#define FORM_ERR 2#define ACK_ERR 3#define CRC_ERR 4#define ERR_DIR_RX BIT(25)#define ERR_LOC_MASK GENMASK(15, 0)/* Nominal Bit Timing Prescaler Register (NBTP) */#define NBTP_MODE_3_SAMPLES\tBIT(31)#define NBTP_NSJW_SHIFT 24#define NBTP_NSJW_MASK (0x7f NBTP_NSJW_SHIFT)#define NBTP_NBRP_SHIFT 16#define NBTP_NBRP_MASK (0xff NBTP_NBRP_SHIFT)#define NBTP_NTSEG2_SHIFT\t8#define NBTP_NTSEG2_MASK\t(0x7f NBTP_NTSEG2_SHIFT)#define NBTP_NTSEG1_SHIFT\t0#define NBTP_NTSEG1_MASK\t(0x7f NBTP_NTSEG1_SHIFT)/* Data Bit Timing Prescaler Register (DBTP) */#define DBTP_MODE_3_SAMPLES\tBIT(21)#define DBTP_DSJW_SHIFT 17#define DBTP_DSJW_MASK (0xf DBTP_DSJW_SHIFT)#define DBTP_DBRP_SHIFT 9#define DBTP_DBRP_MASK (0xff DBTP_DBRP_SHIFT)#define DBTP_DTSEG2_SHIFT\t5#define DBTP_DTSEG2_MASK\t(0xf DBTP_DTSEG2_SHIFT)#define DBTP_DTSEG1_SHIFT\t0#define DBTP_DTSEG1_MASK\t(0x1f DBTP_DTSEG1_SHIFT)/* Transmitter Delay Compensation Register (TDCR) */#define TDCR_TDCO_SHIFT 1#define TDCR_TDCO_MASK (0x3f TDCR_TDCO_SHIFT)#define TDCR_TDC_ENABLE BIT(0)#define TX_FD_ENABLE BIT(5)#define TX_FD_BRS_ENABLE\tBIT(4)#define FIFO_ENABLE BIT(0)#define RX_FIFO_CNT0_SHIFT\t4#define RX_FIFO_CNT0_MASK\t(0x7 RX_FIFO_CNT0_SHIFT)#define RX_FIFO_CNT1_SHIFT\t5#define RX_FIFO_CNT1_MASK\t(0x7 RX_FIFO_CNT1_SHIFT)#define FORMAT_SHIFT 7#define FORMAT_MASK (0x1 FORMAT_SHIFT)#define RTR_SHIFT 6#define RTR_MASK (0x1 RTR_SHIFT)#define FDF_SHIFT 5#define FDF_MASK (0x1 FDF_SHIFT)#define BRS_SHIFT 4#define BRS_MASK (0x1 BRS_SHIFT)#define DLC_SHIFT 0#define DLC_MASK (0xF DLC_SHIFT)#define CAN_RF_SIZE 0x48#define CAN_TEF_SIZE 0x8#define CAN_TXEFRD_OFFSET(n)\t(CAN_TXEFRD + CAN_TEF_SIZE * (n))#define CAN_RXFRD_OFFSET(n)\t(CAN_RXFRD + CAN_RF_SIZE * (n))#define CAN_RX_FILTER_MASK\t0x1fffffff#define NOACK_ERR_FLAG 0xc200800#define CAN_BUSOFF_FLAG 0x20#define DRV_NAME\trockchip_canfd/* rockchip_canfd private data structure */struct rockchip_canfd struct can_priv can;\tstruct device *dev;\tstruct napi_struct napi;\tstruct clk_bulk_data *clks;\tint num_clks;\tstruct reset_control *reset;\tvoid __iomem *base;\tu32 irqstatus;\tunsigned long mode;\tint rx_fifo_shift;\tu32 rx_fifo_mask;\tbool txtorx;\tu32 tx_invalid[4];\tstruct delayed_work tx_err_work;\tu32 noack_cnt;\tu32 delay_time_ms;;static inline u32 rockchip_canfd_read(const struct rockchip_canfd *priv, enum rockchip_canfd_reg reg)\treturn readl(priv-base + reg);static inline void rockchip_canfd_write(const struct rockchip_canfd *priv, enum rockchip_canfd_reg reg, u32 val)\twritel(val, priv-base + reg);static const struct can_bittiming_const rockchip_canfd_bittiming_const = .name = DRV_NAME,\t.tseg1_min = 1,\t.tseg1_max = 128,\t.tseg2_min = 1,\t.tseg2_max = 128,\t.sjw_max = 128,\t.brp_min = 1,\t.brp_max = 256,\t.brp_inc = 2,;static const struct can_bittiming_const rockchip_canfd_data_bittiming_const = .name = DRV_NAME,\t.tseg1_min = 1,\t.tseg1_max = 32,\t.tseg2_min = 1,\t.tseg2_max = 16,\t.sjw_max = 16,\t.brp_min = 1,\t.brp_max = 256,\t.brp_inc = 2,;static int set_reset_mode(struct net_device *ndev)\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\treset_control_assert(rcan-reset);\tudelay(2);\treset_control_deassert(rcan-reset);\trockchip_canfd_write(rcan, CAN_MODE, 0);\tnetdev_dbg(ndev, %s MODE=0x%08x , __func__, rockchip_canfd_read(rcan, CAN_MODE));\treturn 0;static int set_normal_mode(struct net_device *ndev)\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tu32 val;\tval = rockchip_canfd_read(rcan, CAN_MODE);\tval |= WORK_MODE;\trockchip_canfd_write(rcan, CAN_MODE, val);\tnetdev_dbg(ndev, %s MODE=0x%08x , __func__, rockchip_canfd_read(rcan, CAN_MODE));\treturn 0;/* bittiming is called in reset_mode only */static int rockchip_canfd_set_bittiming(struct net_device *ndev)\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tconst struct can_bittiming *bt = rcan-can.bittiming;\tconst struct can_bittiming *dbt = rcan-can.data_bittiming;\tu16 brp, sjw, tseg1, tseg2;\tu32 reg_btp;\tbrp = (bt-brp 1) - 1;\tsjw = bt-sjw - 1;\ttseg1 = bt-prop_seg + bt-phase_seg1 - 1;\ttseg2 = bt-phase_seg2 - 1;\treg_btp = (brp NBTP_NBRP_SHIFT) | (sjw NBTP_NSJW_SHIFT) | (tseg1 NBTP_NTSEG1_SHIFT) | (tseg2 NBTP_NTSEG2_SHIFT);\tif (rcan-can.ctrlmode CAN_CTRLMODE_3_SAMPLES) reg_btp |= NBTP_MODE_3_SAMPLES;\trockchip_canfd_write(rcan, CAN_NBTP, reg_btp);\tif (rcan-can.ctrlmode CAN_CTRLMODE_FD) reg_btp = 0; brp = (dbt-brp 1) - 1; sjw = dbt-sjw - 1; tseg1 = dbt-prop_seg + dbt-phase_seg1 - 1; tseg2 = dbt-phase_seg2 - 1; if (dbt-bitrate 2200000) u32 tdco; /* Equation based on Boschs ROCKCHIP_CAN User Manuals * Transmitter Delay Compensation Section */ tdco = (rcan-can.clock.freq / dbt-bitrate) * 2 / 3; /* Max valid TDCO value is 63 */ if (tdco 63) tdco = 63; rockchip_canfd_write(rcan, CAN_TDCR, (tdco TDCR_TDCO_SHIFT) | TDCR_TDC_ENABLE); reg_btp |= (brp DBTP_DBRP_SHIFT) | (sjw DBTP_DSJW_SHIFT) | (tseg1 DBTP_DTSEG1_SHIFT) | (tseg2 DBTP_DTSEG2_SHIFT); if (rcan-can.ctrlmode CAN_CTRLMODE_3_SAMPLES) reg_btp |= DBTP_MODE_3_SAMPLES; rockchip_canfd_write(rcan, CAN_DBTP, reg_btp); if (bt-bitrate 200000) rcan-delay_time_ms = 1;\telse if (bt-bitrate 50000) rcan-delay_time_ms = 5;\telse rcan-delay_time_ms = 20;\tnetdev_dbg(ndev, %s NBTP=0x%08x, DBTP=0x%08x, TDCR=0x%08x , __func__, rockchip_canfd_read(rcan, CAN_NBTP), rockchip_canfd_read(rcan, CAN_DBTP), rockchip_canfd_read(rcan, CAN_TDCR));\treturn 0;static int rockchip_canfd_get_berr_counter(const struct net_device *ndev, struct can_berr_counter *bec)\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tint err;\terr = pm_runtime_get_sync(rcan-dev);\tif (err 0) netdev_err(ndev, %s: pm_runtime_get failed(%d) , __func__, err); return err; bec-rxerr = rockchip_canfd_read(rcan, CAN_RX_ERR_CNT);\tbec-txerr = rockchip_canfd_read(rcan, CAN_TX_ERR_CNT);\tpm_runtime_put(rcan-dev);\tnetdev_dbg(ndev, %s RX_ERR_CNT=0x%08x, TX_ERR_CNT=0x%08x , __func__, rockchip_canfd_read(rcan, CAN_RX_ERR_CNT), rockchip_canfd_read(rcan, CAN_TX_ERR_CNT));\treturn 0;static int rockchip_canfd_start(struct net_device *ndev)\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tu32 val;\t/* we need to enter the reset mode */\tset_reset_mode(ndev);\trockchip_canfd_write(rcan, CAN_INT_MASK, 0);\t/* RECEIVING FILTER, accept all */\trockchip_canfd_write(rcan, CAN_IDCODE, 0);\trockchip_canfd_write(rcan, CAN_IDMASK, CAN_RX_FILTER_MASK);\trockchip_canfd_write(rcan, CAN_IDCODE0, 0);\trockchip_canfd_write(rcan, CAN_IDMASK0, CAN_RX_FILTER_MASK);\trockchip_canfd_write(rcan, CAN_IDCODE1, 0);\trockchip_canfd_write(rcan, CAN_IDMASK1, CAN_RX_FILTER_MASK);\trockchip_canfd_write(rcan, CAN_IDCODE2, 0);\trockchip_canfd_write(rcan, CAN_IDMASK2, CAN_RX_FILTER_MASK);\trockchip_canfd_write(rcan, CAN_IDCODE3, 0);\trockchip_canfd_write(rcan, CAN_IDMASK3, CAN_RX_FILTER_MASK);\trockchip_canfd_write(rcan, CAN_IDCODE4, 0);\trockchip_canfd_write(rcan, CAN_IDMASK4, CAN_RX_FILTER_MASK);\t/* set mode */\tval = rockchip_canfd_read(rcan, CAN_MODE);\t/* rx fifo enable */\trockchip_canfd_write(rcan, CAN_RXFC, rockchip_canfd_read(rcan, CAN_RXFC) | FIFO_ENABLE);\t/* Mode */\tval |= MODE_FDOE;\t/* Loopback Mode */\tif (rcan-can.ctrlmode CAN_CTRLMODE_LOOPBACK) val |= MODE_SELF_TEST | MODE_LBACK;\t/* Listen-only mode */\tif (rcan-can.ctrlmode CAN_CTRLMODE_LISTENONLY) val |= MODE_SILENT;\trockchip_canfd_write(rcan, CAN_MODE, val);\trockchip_canfd_set_bittiming(ndev);\tset_normal_mode(ndev);\trcan-can.state = CAN_STATE_ERROR_ACTIVE;\tnetdev_dbg(ndev, %s MODE=0x%08x, INT_MASK=0x%08x , __func__, rockchip_canfd_read(rcan, CAN_MODE), rockchip_canfd_read(rcan, CAN_INT_MASK));\treturn 0;static int rockchip_canfd_stop(struct net_device *ndev)\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\trcan-can.state = CAN_STATE_STOPPED;\t/* we need to enter reset mode */\tset_reset_mode(ndev);\t/* disable all interrupts */\trockchip_canfd_write(rcan, CAN_INT_MASK, 0xffff);\tnetdev_dbg(ndev, %s MODE=0x%08x, INT_MASK=0x%08x , __func__, rockchip_canfd_read(rcan, CAN_MODE), rockchip_canfd_read(rcan, CAN_INT_MASK));\treturn 0;static int rockchip_canfd_set_mode(struct net_device *ndev, enum can_mode mode)\tint err;\tswitch (mode) case CAN_MODE_START: err = rockchip_canfd_start(ndev); if (err) netdev_err(ndev, starting CAN controller failed! ); return err; if (netif_queue_stopped(ndev)) netif_wake_queue(ndev); break;\tdefault: return -EOPNOTSUPP; return 0;static void rockchip_canfd_tx_err_delay_work(struct work_struct *work)\tstruct rockchip_canfd *rcan = container_of(work, struct rockchip_canfd, tx_err_work.work);\tstruct net_device *ndev = dev_get_drvdata(rcan-dev); rockchip_canfd_write(rcan, CAN_MODE, rockchip_canfd_read(rcan, CAN_MODE) | MODE_SPACE_RX);\trockchip_canfd_write(rcan, CAN_CMD, CAN_TX0_REQ);\trockchip_canfd_write(rcan, CAN_MODE, rockchip_canfd_read(rcan, CAN_MODE) (~MODE_SPACE_RX));\trcan-noack_cnt++;\tschedule_delayed_work(rcan-tx_err_work, msecs_to_jiffies(rcan-delay_time_ms));\tif (rcan-noack_cnt 50) cancel_delayed_work(rcan-tx_err_work); rockchip_canfd_write(rcan, CAN_INT_MASK, 0xffff); can_bus_off(ndev); rcan-noack_cnt = 0;\t/* transmit a CAN message * message layout in the sk_buff should be like this: * xx xx xx xx ff ll 00 11 22 33 44 55 66 77 * [ can_id ] [flags] [len] [can data (up to 8 bytes] */static int rockchip_canfd_start_xmit(struct sk_buff *skb, struct net_device *ndev)\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tstruct canfd_frame *cf = (struct canfd_frame *)skb-data;\tu32 id, dlc;\tu32 cmd = CAN_TX0_REQ;\tint i;\tunsigned long flags;\tif (can_dropped_invalid_skb(ndev, skb)) return NETDEV_TX_OK;\tnetif_stop_queue(ndev);\tif (rockchip_canfd_read(rcan, CAN_CMD) CAN_TX0_REQ) cmd = CAN_TX1_REQ;\t/* Watch carefully on the bit sequence */\tif (cf-can_id CAN_EFF_FLAG) /* Extended CAN ID format */ id = cf-can_id CAN_EFF_MASK; dlc = can_len2dlc(cf-len) DLC_MASK; dlc |= FORMAT_MASK; /* Extended frames remote TX request */ if (cf-can_id CAN_RTR_FLAG) dlc |= RTR_MASK; else /* Standard CAN ID format */ id = cf-can_id CAN_SFF_MASK; dlc = can_len2dlc(cf-len) DLC_MASK; /* Standard frames remote TX request */ if (cf-can_id CAN_RTR_FLAG) dlc |= RTR_MASK; if ((rcan-can.ctrlmode CAN_CTRLMODE_FD) can_is_canfd_skb(skb)) dlc |= TX_FD_ENABLE; if (cf-flags CANFD_BRS) dlc |= TX_FD_BRS_ENABLE; if (rcan-txtorx rcan-mode = ROCKCHIP_RK3568_CAN_MODE cf-can_id CAN_EFF_FLAG) rockchip_canfd_write(rcan, CAN_MODE, rockchip_canfd_read(rcan, CAN_MODE) | MODE_RXSTX);\telse rockchip_canfd_write(rcan, CAN_MODE, rockchip_canfd_read(rcan, CAN_MODE) (~MODE_RXSTX));\tif (!rcan-txtorx rcan-mode = ROCKCHIP_RK3568_CAN_MODE cf-can_id CAN_EFF_FLAG) /* Two frames are sent consecutively. * Before the first frame is tx finished, * the register of the second frame is configured. * Dont be interrupted in the middle. */ local_irq_save(flags); rockchip_canfd_write(rcan, CAN_TXID, rcan-tx_invalid[1]); rockchip_canfd_write(rcan, CAN_TXFIC, rcan-tx_invalid[0]); rockchip_canfd_write(rcan, CAN_TXDAT0, rcan-tx_invalid[2]); rockchip_canfd_write(rcan, CAN_TXDAT1, rcan-tx_invalid[3]); rockchip_canfd_write(rcan, CAN_CMD, CAN_TX0_REQ); rockchip_canfd_write(rcan, CAN_TXID, id); rockchip_canfd_write(rcan, CAN_TXFIC, dlc); for (i = 0; i cf-len; i += 4) rockchip_canfd_write(rcan, CAN_TXDAT0 + i, *(u32 *)(cf-data + i)); can_put_echo_skb(skb, ndev, 0); rockchip_canfd_write(rcan, CAN_CMD, CAN_TX1_REQ); local_irq_restore(flags); return NETDEV_TX_OK; rockchip_canfd_write(rcan, CAN_TXID, id);\trockchip_canfd_write(rcan, CAN_TXFIC, dlc);\tfor (i = 0; i cf-len; i += 4) rockchip_canfd_write(rcan, CAN_TXDAT0 + i, *(u32 *)(cf-data + i));\tcan_put_echo_skb(skb, ndev, 0);\trockchip_canfd_write(rcan, CAN_MODE, rockchip_canfd_read(rcan, CAN_MODE) | MODE_SPACE_RX);\trockchip_canfd_write(rcan, CAN_CMD, cmd);\trockchip_canfd_write(rcan, CAN_MODE, rockchip_canfd_read(rcan, CAN_MODE) (~MODE_SPACE_RX));\tschedule_delayed_work(rcan-tx_err_work, msecs_to_jiffies(rcan-delay_time_ms));\treturn NETDEV_TX_OK;static int rockchip_canfd_rx(struct net_device *ndev)\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tstruct net_device_stats *stats = ndev-stats;\tstruct canfd_frame *cf;\tstruct sk_buff *skb;\tu32 id_rockchip_canfd, dlc;\tint i = 0;\tu32 __maybe_unused ts, ret;\tu32 data[16];\tdlc = rockchip_canfd_read(rcan, CAN_RXFRD);\tid_rockchip_canfd = rockchip_canfd_read(rcan, CAN_RXFRD);\tts = rockchip_canfd_read(rcan, CAN_RXFRD);\tfor (i = 0; i ARRAY_SIZE(data); i++) data[i] = rockchip_canfd_read(rcan, CAN_RXFRD);\tif (rcan-mode = ROCKCHIP_RK3568_CAN_MODE) /* may be an empty frame */ if (!dlc !id_rockchip_canfd) return 1; if (rcan-txtorx) if (rockchip_canfd_read(rcan, CAN_TX_CHECK_FIC) FORMAT_MASK) ret = rockchip_canfd_read(rcan, CAN_TXID) CAN_SFF_MASK; if ((id_rockchip_canfd == ret) !(dlc FORMAT_MASK)) rockchip_canfd_write(rcan, CAN_TX_CHECK_FIC, ts | CAN_TX0_REQ); return 1; /* create zeroed CAN frame buffer */\tif (dlc FDF_MASK) skb = alloc_canfd_skb(ndev, cf);\telse skb = alloc_can_skb(ndev, (struct can_frame **)cf);\tif (!skb) stats-rx_dropped++; return 1; /* Change CAN data length format to socketCAN data format */\tif (dlc FDF_MASK) cf-len = can_dlc2len(dlc DLC_MASK);\telse cf-len = get_can_dlc(dlc DLC_MASK);\t/* Change CAN ID format to socketCAN ID format */\tif (dlc FORMAT_MASK) /* The received frame is an Extended format frame */ cf-can_id = id_rockchip_canfd; cf-can_id |= CAN_EFF_FLAG; if (dlc RTR_MASK) cf-can_id |= CAN_RTR_FLAG; else /* The received frame is a standard format frame */ cf-can_id = id_rockchip_canfd; if (dlc RTR_MASK) cf-can_id |= CAN_RTR_FLAG; if (dlc BRS_MASK) cf-flags |= CANFD_BRS;\tif (!(cf-can_id CAN_RTR_FLAG)) /* Change CAN data format to socketCAN data format */ for (i = 0; i cf-len; i += 4) *(u32 *)(cf-data + i) = data[i / 4]; stats-rx_packets++;\tstats-rx_bytes += cf-len;\tnetif_rx(skb);\tcan_led_event(ndev, CAN_LED_EVENT_RX);\treturn 1;static int rockchip_canfd_get_rx_fifo_cnt(struct net_device *ndev)\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tint quota = 0;\tif (read_poll_timeout_atomic(rockchip_canfd_read, quota, (quota rcan-rx_fifo_mask) rcan-rx_fifo_shift, 0, 500000, false, rcan, CAN_RXFC)) netdev_dbg(ndev, Warning: get fifo cnt failed );\tquota = (quota rcan-rx_fifo_mask) rcan-rx_fifo_shift;\treturn quota;/* rockchip_canfd_rx_poll - Poll routine for rx packets (NAPI) * @napi:\tnapi structure pointer * @quota:\tMax number of rx packets to be processed. * * This is the poll routine for rx part. * It will process the packets maximux quota value. * * Return: number of packets received */static int rockchip_canfd_rx_poll(struct napi_struct *napi, int quota)\tstruct net_device *ndev = napi-dev;\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tint work_done = 0;\tquota = rockchip_canfd_get_rx_fifo_cnt(ndev);\tif (quota 6) quota = 6;\tif (quota) while (work_done quota) work_done += rockchip_canfd_rx(ndev); if (work_done) can_led_event(ndev, CAN_LED_EVENT_RX);\tif (work_done 6) napi_complete_done(napi, work_done); rockchip_canfd_write(rcan, CAN_INT_MASK, 0); return work_done;static void rockchip_canfd_tx_retry(struct net_device *ndev, u32 isr)\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tu32 err_code = rockchip_canfd_read(rcan, CAN_ERR_CODE);\tu32 data[4], mode;\tint i = 0;\tif ((isr TX_LOSTARB_INT) || ((!(err_code 0x2000000)) (err_code 0x1ff0000))) mode = rockchip_canfd_read(rcan, CAN_MODE); for (i = 0; i ARRAY_SIZE(data); i++) data[i] = rockchip_canfd_read(rcan, CAN_TXFIC + i * 4); rockchip_canfd_write(rcan, CAN_INT_MASK, 0xffff); rockchip_canfd_start(ndev); rockchip_canfd_write(rcan, CAN_MODE, mode); for (i = 0; i ARRAY_SIZE(data); i++) rockchip_canfd_write(rcan, CAN_TXFIC + i * 4, data[i]);\tstatic int rockchip_canfd_err(struct net_device *ndev, u32 isr)\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tstruct net_device_stats *stats = ndev-stats;\tstruct can_frame *cf;\tstruct sk_buff *skb;\tunsigned int rxerr, txerr;\tu32 sta_reg;\tskb = alloc_can_err_skb(ndev, cf);\trxerr = rockchip_canfd_read(rcan, CAN_RX_ERR_CNT);\ttxerr = rockchip_canfd_read(rcan, CAN_TX_ERR_CNT);\tsta_reg = rockchip_canfd_read(rcan, CAN_STATE);\tif (skb) cf-data[6] = txerr; cf-data[7] = rxerr; if (isr BUS_OFF_INT) rcan-can.state = CAN_STATE_BUS_OFF; rcan-can.can_stats.bus_off++; cf-can_id |= CAN_ERR_BUSOFF; else if (isr ERR_WARN_INT) rcan-can.can_stats.error_warning++; rcan-can.state = CAN_STATE_ERROR_WARNING; /* error warning state */ if (likely(skb)) cf-can_id |= CAN_ERR_CRTL; cf-data[1] = (txerr rxerr) ? CAN_ERR_CRTL_TX_WARNING : CAN_ERR_CRTL_RX_WARNING; cf-data[6] = txerr; cf-data[7] = rxerr; else if (isr PASSIVE_ERR_INT) rcan-can.can_stats.error_passive++; rcan-can.state = CAN_STATE_ERROR_PASSIVE; /* error passive state */ cf-can_id |= CAN_ERR_CRTL; cf-data[1] = (txerr rxerr) ? CAN_ERR_CRTL_TX_WARNING : CAN_ERR_CRTL_RX_WARNING; cf-data[6] = txerr; cf-data[7] = rxerr; if (rcan-can.state = CAN_STATE_BUS_OFF || ((sta_reg CAN_BUSOFF_FLAG) == CAN_BUSOFF_FLAG)) cancel_delayed_work(rcan-tx_err_work); rockchip_canfd_write(rcan, CAN_INT_MASK, 0xffff); can_bus_off(ndev); stats-rx_packets++;\tstats-rx_bytes += cf-can_dlc;\tnetif_rx(skb);\treturn 0;static irqreturn_t rockchip_canfd_interrupt(int irq, void *dev_id)\tstruct net_device *ndev = (struct net_device *)dev_id;\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tstruct net_device_stats *stats = ndev-stats;\tu32 err_int = ERR_WARN_INT | RX_BUF_OV_INT | PASSIVE_ERR_INT | BUS_ERR_INT | BUS_OFF_INT;\tu32 isr;\tu32 dlc = 0;\tu32 quota, work_done = 0;\tisr = rockchip_canfd_read(rcan, CAN_INT);\tif (isr TX_FINISH_INT) cancel_delayed_work(rcan-tx_err_work); dlc = rockchip_canfd_read(rcan, CAN_TXFIC); /* transmission complete interrupt */ if (dlc FDF_MASK) stats-tx_bytes += can_dlc2len(dlc DLC_MASK); else stats-tx_bytes += (dlc DLC_MASK); stats-tx_packets++; if (rcan-txtorx rcan-mode = ROCKCHIP_RK3568_CAN_MODE dlc FORMAT_MASK) rockchip_canfd_write(rcan, CAN_TX_CHECK_FIC, FORMAT_MASK); quota = rockchip_canfd_get_rx_fifo_cnt(ndev); if (quota) while (work_done quota) work_done += rockchip_canfd_rx(ndev); if (rockchip_canfd_read(rcan, CAN_TX_CHECK_FIC) CAN_TX0_REQ) rockchip_canfd_write(rcan, CAN_CMD, CAN_TX1_REQ); rockchip_canfd_write(rcan, CAN_TX_CHECK_FIC, 0); if (read_poll_timeout_atomic(rockchip_canfd_read, quota, !(quota 0x3), 0, 5000000, false, rcan, CAN_CMD)) netdev_err(ndev, Warning: wait tx req timeout! ); rockchip_canfd_write(rcan, CAN_CMD, 0); can_get_echo_skb(ndev, 0); netif_wake_queue(ndev); can_led_event(ndev, CAN_LED_EVENT_TX); rcan-noack_cnt = 0; if ((isr RX_FINISH_INT) || (isr RX_FIFO_OV_INT) || (isr RX_FIFO_FULL_INT)) if (rcan-mode == ROCKCHIP_RK3568_CAN_MODE_V2) //rockchip_canfd_write(rcan, CAN_INT_MASK, 0x1); work_done = 0; quota = (rockchip_canfd_read(rcan, CAN_RXFC) rcan-rx_fifo_mask) rcan-rx_fifo_shift; if (quota) while (work_done quota) work_done += rockchip_canfd_rx(ndev); else work_done = 0; quota = (rockchip_canfd_read(rcan, CAN_RXFC) rcan-rx_fifo_mask) rcan-rx_fifo_shift; if (quota) while (work_done quota) work_done += rockchip_canfd_rx(ndev); if (isr err_int) /* error interrupt */ if (rockchip_canfd_err(ndev, isr)) netdev_err(ndev, cant allocate buffer - clearing pending interrupts ); rockchip_canfd_tx_retry(ndev, isr);\trockchip_canfd_write(rcan, CAN_INT, isr);\treturn IRQ_HANDLED;static int rockchip_canfd_open(struct net_device *ndev)\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tint err;\t/* common open */\terr = open_candev(ndev);\tif (err) return err;\terr = pm_runtime_get_sync(rcan-dev);\tif (err 0) netdev_err(ndev, %s: pm_runtime_get failed(%d) , __func__, err); goto exit; err = rockchip_canfd_start(ndev);\tif (err) netdev_err(ndev, could not start CAN peripheral ); goto exit_can_start; can_led_event(ndev, CAN_LED_EVENT_OPEN);//\tif (rcan-mode == ROCKCHIP_RK3568_CAN_MODE_V2)// napi_enable(rcan-napi);\tnetif_start_queue(ndev);\tnetdev_dbg(ndev, %s , __func__);\treturn 0;exit_can_start:\tpm_runtime_put(rcan-dev);exit:\tclose_candev(ndev);\treturn err;static int rockchip_canfd_close(struct net_device *ndev)\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tnetif_stop_queue(ndev);//\tif (rcan-mode == ROCKCHIP_RK3568_CAN_MODE_V2)// napi_disable(rcan-napi);\trockchip_canfd_stop(ndev);\tclose_candev(ndev);\tcan_led_event(ndev, CAN_LED_EVENT_STOP);\tpm_runtime_put(rcan-dev);\tcancel_delayed_work_sync(rcan-tx_err_work);\tnetdev_dbg(ndev, %s , __func__);\treturn 0;static const struct net_device_ops rockchip_canfd_netdev_ops = .ndo_open = rockchip_canfd_open,\t.ndo_stop = rockchip_canfd_close,\t.ndo_start_xmit = rockchip_canfd_start_xmit,\t.ndo_change_mtu = can_change_mtu,;/** * rockchip_canfd_suspend - Suspend method for the driver * @dev:\tAddress of the device structure * * Put the driver into low power mode. * Return: 0 on success and failure value on error */static int __maybe_unused rockchip_canfd_suspend(struct device *dev)\tstruct net_device *ndev = dev_get_drvdata(dev);\tif (netif_running(ndev)) netif_stop_queue(ndev); netif_device_detach(ndev); rockchip_canfd_stop(ndev); return pm_runtime_force_suspend(dev);/** * rockchip_canfd_resume - Resume from suspend * @dev:\tAddress of the device structure * * Resume operation after suspend. * Return: 0 on success and failure value on error */static int __maybe_unused rockchip_canfd_resume(struct device *dev)\tstruct net_device *ndev = dev_get_drvdata(dev);\tint ret;\tret = pm_runtime_force_resume(dev);\tif (ret) dev_err(dev, pm_runtime_force_resume failed on resume ); return ret; if (netif_running(ndev)) ret = rockchip_canfd_start(ndev); if (ret) dev_err(dev, rockchip_canfd_chip_start failed on resume ); return ret; netif_device_attach(ndev); netif_start_queue(ndev); return 0;/** * rockchip_canfd_runtime_suspend - Runtime suspend method for the driver * @dev:\tAddress of the device structure * * Put the driver into low power mode. * Return: 0 always */static int __maybe_unused rockchip_canfd_runtime_suspend(struct device *dev)\tstruct net_device *ndev = dev_get_drvdata(dev);\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tclk_bulk_disable_unprepare(rcan-num_clks, rcan-clks);\treturn 0;/** * rockchip_canfd_runtime_resume - Runtime resume from suspend * @dev:\tAddress of the device structure * * Resume operation after suspend. * Return: 0 on success and failure value on error */static int __maybe_unused rockchip_canfd_runtime_resume(struct device *dev)\tstruct net_device *ndev = dev_get_drvdata(dev);\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tint ret;\tret = clk_bulk_prepare_enable(rcan-num_clks, rcan-clks);\tif (ret) dev_err(dev, Cannot enable clock. ); return ret; return 0;static const struct dev_pm_ops rockchip_canfd_dev_pm_ops = SET_SYSTEM_SLEEP_PM_OPS(rockchip_canfd_suspend, rockchip_canfd_resume)\tSET_RUNTIME_PM_OPS(rockchip_canfd_runtime_suspend, rockchip_canfd_runtime_resume, NULL);static const struct of_device_id rockchip_canfd_of_match[] = .compatible = rockchip,canfd-1.0, .data = (void *)ROCKCHIP_CANFD_MODE\t, .compatible = rockchip,can-2.0, .data = (void *)ROCKCHIP_CAN_MODE\t, .compatible = rockchip,rk3568-can-2.0, .data = (void *)ROCKCHIP_RK3568_CAN_MODE\t,\t,;MODULE_DEVICE_TABLE(of, rockchip_canfd_of_match);static int rockchip_canfd_probe(struct platform_device *pdev)\tstruct net_device *ndev;\tstruct rockchip_canfd *rcan;\tstruct resource *res;\tvoid __iomem *addr;\tint err, irq;\tirq = platform_get_irq(pdev, 0);\tif (irq 0) dev_err(pdev-dev, could not get a valid irq ); return -ENODEV; res = platform_get_resource(pdev, IORESOURCE_MEM, 0);\taddr = devm_ioremap_resource(pdev-dev, res);\tif (IS_ERR(addr)) return -EBUSY;\tndev = alloc_candev(sizeof(struct rockchip_canfd), 1);\tif (!ndev) dev_err(pdev-dev, could not allocate memory for CANFD device ); return -ENOMEM; rcan = netdev_priv(ndev);\t/* register interrupt handler */\terr = devm_request_irq(pdev-dev, irq, rockchip_canfd_interrupt, 0, ndev-name, ndev);\tif (err) dev_err(pdev-dev, request_irq err: %d , err); return err; rcan-reset = devm_reset_control_array_get(pdev-dev, false, false);\tif (IS_ERR(rcan-reset)) if (PTR_ERR(rcan-reset) != -EPROBE_DEFER) dev_err(pdev-dev, failed to get canfd reset lines ); return PTR_ERR(rcan-reset); rcan-num_clks = devm_clk_bulk_get_all(pdev-dev, rcan-clks);\tif (rcan-num_clks 1) return -ENODEV;\trcan-mode = (unsigned long)of_device_get_match_data(pdev-dev);\tif ((cpu_is_rk3566() || cpu_is_rk3568()) (rockchip_get_cpu_version() == 3)) rcan-mode = ROCKCHIP_RK3568_CAN_MODE_V2;\trcan-base = addr;\trcan-can.clock.freq = clk_get_rate(rcan-clks[0].clk);\trcan-dev = pdev-dev;\trcan-can.state = CAN_STATE_STOPPED;\tswitch (rcan-mode) case ROCKCHIP_CANFD_MODE: rcan-can.bittiming_const = rockchip_canfd_bittiming_const; rcan-can.data_bittiming_const = rockchip_canfd_data_bittiming_const; rcan-can.do_set_mode = rockchip_canfd_set_mode; rcan-can.do_get_berr_counter = rockchip_canfd_get_berr_counter; rcan-can.do_set_bittiming = rockchip_canfd_set_bittiming; rcan-can.do_set_data_bittiming = rockchip_canfd_set_bittiming; rcan-can.ctrlmode = CAN_CTRLMODE_FD; /* IFI CANFD can do both Bosch FD and ISO FD */ rcan-can.ctrlmode_supported = CAN_CTRLMODE_LOOPBACK | CAN_CTRLMODE_FD; rcan-rx_fifo_shift = RX_FIFO_CNT0_SHIFT; rcan-rx_fifo_mask = RX_FIFO_CNT0_MASK; break;\tcase ROCKCHIP_CAN_MODE:\tcase ROCKCHIP_RK3568_CAN_MODE:\tcase ROCKCHIP_RK3568_CAN_MODE_V2: rcan-can.bittiming_const = rockchip_canfd_bittiming_const; rcan-can.do_set_mode = rockchip_canfd_set_mode; rcan-can.do_get_berr_counter = rockchip_canfd_get_berr_counter; rcan-can.ctrlmode_supported = CAN_CTRLMODE_BERR_REPORTING | CAN_CTRLMODE_LISTENONLY | CAN_CTRLMODE_LOOPBACK | CAN_CTRLMODE_3_SAMPLES; rcan-rx_fifo_shift = RX_FIFO_CNT0_SHIFT; rcan-rx_fifo_mask = RX_FIFO_CNT0_MASK; break;\tdefault: return -EINVAL; if (rcan-mode == ROCKCHIP_CAN_MODE) rcan-rx_fifo_shift = RX_FIFO_CNT1_SHIFT; rcan-rx_fifo_mask = RX_FIFO_CNT1_MASK; if (device_property_read_u32_array(pdev-dev, rockchip,tx-invalid-info, rcan-tx_invalid, 4)) rcan-txtorx = 1;\tif (rcan-mode == ROCKCHIP_RK3568_CAN_MODE_V2) rcan-txtorx = 0; //netif_napi_add(ndev, rcan-napi, rockchip_canfd_rx_poll, 6); ndev-netdev_ops = rockchip_canfd_netdev_ops;\tndev-irq = irq;\tndev-flags |= IFF_ECHO;\trcan-can.restart_ms = 100;\trcan-noack_cnt = 0;\tirq_set_affinity_hint(irq, get_cpu_mask(num_online_cpus() - 1));\tINIT_DELAYED_WORK(rcan-tx_err_work, rockchip_canfd_tx_err_delay_work);\tplatform_set_drvdata(pdev, ndev);\tSET_NETDEV_DEV(ndev, pdev-dev);\tpm_runtime_enable(pdev-dev);\terr = pm_runtime_get_sync(pdev-dev);\tif (err 0) dev_err(pdev-dev, %s: pm_runtime_get failed(%d) , __func__, err); goto err_pmdisable; err = register_candev(ndev);\tif (err) dev_err(pdev-dev, registering %s failed (err=%d) , DRV_NAME, err); goto err_disableclks; devm_can_led_init(ndev);\treturn 0;err_disableclks:\tpm_runtime_put(pdev-dev);err_pmdisable:\tpm_runtime_disable(pdev-dev);\tfree_candev(ndev);\treturn err;static int rockchip_canfd_remove(struct platform_device *pdev)\tstruct net_device *ndev = platform_get_drvdata(pdev);//\tstruct rockchip_canfd *rcan = netdev_priv(ndev);\tunregister_netdev(ndev);\tpm_runtime_disable(pdev-dev);//\tif (rcan-mode == ROCKCHIP_RK3568_CAN_MODE_V2)// netif_napi_del(rcan-napi);\tfree_candev(ndev);\treturn 0;static struct platform_driver rockchip_canfd_driver = .driver = .name = DRV_NAME, .pm = rockchip_canfd_dev_pm_ops, .of_match_table = rockchip_canfd_of_match,\t,\t.probe = rockchip_canfd_probe,\t.remove = rockchip_canfd_remove,;module_platform_driver(rockchip_canfd_driver);MODULE_AUTHOR(Elaine Zhang zhangqing@rock-chips.com);MODULE_LICENSE(GPL);MODULE_DESCRIPTION(Rockchip CANFD Drivers);","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"CSæ¨¡å‹","path":"/2024/10/28/1-å¹³å°ç³»ç»Ÿ-Linux-ç½‘ç»œ-CSæ¨¡å‹/","content":"","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç½‘ç»œ"]},{"title":"ç½‘ç»œåè®®","path":"/2024/10/24/1-å¹³å°ç³»ç»Ÿ-Linux-ç½‘ç»œ-ç½‘ç»œåè®®/","content":"å››å±‚ç½‘ç»œåè®®TCPIPï¼ˆä¼ è¾“æ§åˆ¶åè®®å› ç‰¹ç½‘åè®®ï¼‰å‚è€ƒæ¨¡å‹ï¼ˆå››å±‚æ¨¡å‹ï¼‰ï¼š å››å±‚æ¨¡å‹ï¼ˆTCPIP å‚è€ƒæ¨¡å‹ï¼‰æ˜¯å®é™…äº’è”ç½‘é€šä¿¡ä¸­ä½¿ç”¨è¾ƒä¸ºå¹¿æ³›çš„æ¨¡å‹ã€‚ TCPIP å‚è€ƒæ¨¡å‹æ˜¯äº’è”ç½‘é€šä¿¡æ‰€ä½¿ç”¨çš„ä¸€ç§åè®®å‚è€ƒæ¨¡å‹ï¼Œç”±äº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ï¼ˆIETFï¼‰å®šä¹‰ã€‚å®ƒå°†ç½‘ç»œé€šä¿¡åˆ’åˆ†ä¸ºå››ä¸ªå±‚æ¬¡ï¼Œæ¯ä¸ªå±‚æ¬¡è´Ÿè´£ä¸åŒçš„åŠŸèƒ½ï¼Œä»åº•å±‚åˆ°åº”ç”¨å±‚ï¼Œä¾æ¬¡ä¸ºï¼š ç½‘ç»œæ¥å£å±‚ï¼šå¤„ç†ç‰©ç†ç½‘ç»œæ¥å£å’Œé“¾è·¯å±‚åè®®ï¼Œä¾‹å¦‚ä»¥å¤ªç½‘ã€‚ ç½‘ç»œå±‚ï¼šè´Ÿè´£ IP åè®®ã€è·¯ç”±å’Œåˆ†ç»„è½¬å‘ç­‰ã€‚ ä¼ è¾“å±‚ï¼šæä¾›ç«¯åˆ°ç«¯çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼ŒåŒ…æ‹¬ TCP å’Œ UDP åè®®ã€‚ åº”ç”¨å±‚ï¼šåŒ…æ‹¬å„ç§åº”ç”¨å±‚åè®®ï¼Œä¾‹å¦‚ HTTPã€FTPã€SMTP ç­‰ã€‚ ä¸ƒå±‚ç½‘ç»œåè®®OSIï¼ˆå¼€æ”¾ç³»ç»Ÿäº’è”ï¼‰å‚è€ƒæ¨¡å‹ï¼ˆä¸ƒå±‚æ¨¡å‹ï¼‰ï¼š ä¸ƒå±‚æ¨¡å‹ï¼ˆOSI å‚è€ƒæ¨¡å‹ï¼‰æä¾›äº†æ›´ç»†ç²’åº¦çš„åˆ†å±‚å’ŒåŠŸèƒ½åˆ’åˆ†ã€‚ OSI å‚è€ƒæ¨¡å‹æ˜¯å›½é™…æ ‡å‡†åŒ–ç»„ç»‡ï¼ˆISOï¼‰åˆ¶å®šçš„ä¸€ç§ç½‘ç»œåè®®å‚è€ƒæ¨¡å‹ï¼Œç”¨äºæè¿°è®¡ç®—æœºç½‘ç»œä¸­ä¸åŒå±‚æ¬¡çš„åŠŸèƒ½å’Œåè®®ã€‚å®ƒå°†ç½‘ç»œé€šä¿¡åˆ’åˆ†ä¸ºä¸ƒä¸ªä¸åŒçš„å±‚æ¬¡ï¼Œæ¯ä¸ªå±‚æ¬¡è´Ÿè´£ä¸åŒçš„ä»»åŠ¡ï¼Œä»ç‰©ç†ä¼ è¾“åˆ°åº”ç”¨å±‚ï¼Œä¾æ¬¡ä¸ºï¼š ç‰©ç†å±‚ï¼šè´Ÿè´£ç‰©ç†ä»‹è´¨ä¼ è¾“å’Œç”µä¿¡å·ä¼ è¾“ã€‚ æ•°æ®é“¾è·¯å±‚ï¼šå¤„ç†æ•°æ®å¸§çš„ä¼ è¾“ã€ç‰©ç†å¯»å€å’Œé”™è¯¯æ£€æµ‹ç­‰ã€‚ ç½‘ç»œå±‚ï¼šè´Ÿè´£é€»è¾‘å¯»å€ã€è·¯ç”±å’Œåˆ†ç»„è½¬å‘ç­‰ã€‚ ä¼ è¾“å±‚ï¼šæä¾›å¯é çš„ç«¯åˆ°ç«¯æ•°æ®ä¼ è¾“ï¼ŒåŒ…æ‹¬æµé‡æ§åˆ¶å’Œé”™è¯¯æ¢å¤ç­‰ã€‚ ä¼šè¯å±‚ï¼šç®¡ç†ä¸åŒåº”ç”¨ç¨‹åºä¹‹é—´çš„ä¼šè¯å’Œæ•°æ®äº¤æ¢ã€‚ è¡¨ç¤ºå±‚ï¼šå¤„ç†æ•°æ®çš„è¡¨ç¤ºå’Œè½¬æ¢ï¼ŒåŒ…æ‹¬æ•°æ®åŠ å¯†å’Œè§£å¯†ç­‰ã€‚ åº”ç”¨å±‚ï¼šæä¾›ç‰¹å®šåº”ç”¨ç¨‹åºçš„æœåŠ¡å’Œæ¥å£ã€‚ ç½‘ç»œæ¥å£å’Œç‰©ç†å±‚MAC åœ°å€ï¼ˆData Link Layerï¼‰ï¼šMAC åœ°å€æ˜¯ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç½‘ç»œè®¾å¤‡ï¼ˆå¦‚ç½‘å¡ï¼‰çš„ç‰©ç†åœ°å€ã€‚ å®ƒå±äºæ•°æ®é“¾è·¯å±‚ï¼Œåœ¨å±€åŸŸç½‘ä¸­ç”¨äºå”¯ä¸€æ ‡è¯†è®¾å¤‡å¹¶å®ç°ç›´æ¥é€šä¿¡ã€‚ PPPï¼ˆPoint-to-Point Protocolï¼‰ï¼ˆData Link Layerï¼‰ï¼šPPP ç”¨äºåœ¨ç‚¹å¯¹ç‚¹è¿æ¥ä¸Šè¿›è¡Œæ•°æ®é€šä¿¡ã€‚ å®ƒå±äºæ•°æ®é“¾è·¯å±‚ï¼Œç”¨äºå»ºç«‹å’Œç®¡ç†ç‚¹å¯¹ç‚¹è¿æ¥ï¼Œé€šå¸¸ç”¨äºæ‹¨å·ã€ä¸²å£ç­‰é€šä¿¡ã€‚ ARPï¼ˆAddress Resolution Protocolï¼‰ï¼ˆNetwork Layerï¼‰ï¼šARP ç”¨äºå°† IP åœ°å€è§£æä¸ºå¯¹åº”çš„ MAC åœ°å€ã€‚ å®ƒå±äºç½‘ç»œå±‚ï¼Œåœ¨å±€åŸŸç½‘ä¸­å®ç° IP åœ°å€å’Œ MAC åœ°å€ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚ RARPï¼ˆReverse Address Resolution Protocolï¼‰ï¼ˆNetwork Layerï¼‰ï¼šRARP å…è®¸æ ¹æ® MAC åœ°å€è·å–å¯¹åº”çš„ IP åœ°å€ã€‚ å®ƒå±äºç½‘ç»œå±‚ï¼Œåœ¨ç‰¹å®šåœºæ™¯ä¸‹ï¼ˆå¦‚æ— ç£ç›˜ç»ˆç«¯è®¾å¤‡å¼•å¯¼ï¼‰ç”¨äºè·å– IP åœ°å€ã€‚ IP åœ°å€(Internet protocol)ï¼ˆNetwork Layerï¼‰ï¼šIP åœ°å€æ˜¯ä¸€ä¸ªç”¨äºåœ¨äº’è”ç½‘ä¸­å”¯ä¸€æ ‡è¯†è®¾å¤‡å’Œç½‘ç»œçš„é€»è¾‘åœ°å€ã€‚ å®ƒå±äºç½‘ç»œå±‚ï¼Œåœ¨ç½‘ç»œä¸­è¿›è¡Œå¯»å€å’Œè·¯ç”±é€‰æ‹©ï¼Œå®ç°è·¨ç½‘ç»œçš„é€šä¿¡ã€‚ ICMPï¼ˆInternet Control Message Protocolï¼‰ï¼ˆNetwork Layerï¼‰ï¼šICMP Inetrnet æ§åˆ¶ç®¡ç†åè®®ï¼ˆping å‘½ä»¤ï¼‰ ç”¨äºåœ¨ IP ç½‘ç»œä¸Šä¼ é€’æ§åˆ¶æ¶ˆæ¯å’Œé”™è¯¯æŠ¥å‘Šã€‚ å®ƒå±äºç½‘ç»œå±‚ï¼Œåœ¨ IP é€šä¿¡ä¸­æä¾›ç½‘ç»œçŠ¶å†µã€é”™è¯¯æ£€æµ‹ã€æ’é”™ç­‰åŠŸèƒ½ã€‚ IGMPï¼ˆInternet Group Management Protocolï¼‰ï¼ˆNetwork Layerï¼‰ï¼šIGMP Inetrnet åˆ†ç»„ç®¡ç†åè®®ï¼ˆå¹¿æ’­ç»„æ’­ï¼‰ ç”¨äºåœ¨ IP ç½‘ç»œä¸Šè¿›è¡Œç»„æ’­ï¼ˆMulticastï¼‰ç®¡ç†ã€‚ å®ƒå±äºç½‘ç»œå±‚ï¼Œåœ¨å¤šæ’­é€šä¿¡ä¸­ï¼Œç”¨äºä¸»æœºå’Œè·¯ç”±å™¨ä¹‹é—´çš„ç»„æ’­ç»„ç®¡ç†ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç½‘ç»œ"]},{"title":"nmcliè¿›è¡Œæ— çº¿ç½‘ç»œç®¡ç†","path":"/2024/10/23/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-nmcliè¿›è¡Œæ— çº¿ç½‘ç»œç®¡ç†/","content":"nmcli ç®€ä»‹nmcli æ˜¯ NetworkManager çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ç»ˆç«¯ç•Œé¢ä¾¿æ·åœ°ç®¡ç†ç½‘ç»œè¿æ¥ã€‚å®ƒæä¾›äº†ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥é…ç½®ç½‘ç»œè®¾å¤‡ï¼Œå°¤å…¶åœ¨ä½¿ç”¨å›¾å½¢ç”¨æˆ·ç•Œé¢ä¸æ–¹ä¾¿æˆ–èµ„æºæœ‰é™çš„æƒ…å†µä¸‹ã€‚ 1. å®‰è£… nmcliè¦å®‰è£… nmcliï¼Œé¦–å…ˆéœ€è¦ç¡®ä¿çš„ç³»ç»Ÿä¸­æœ‰ NetworkManagerã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ Ubuntu ç³»ç»Ÿä¸Šå®‰è£…ï¼š sudo apt-get install network-manager å®‰è£…å®Œ NetworkManager åï¼Œnmcli é€šå¸¸ä¼šéšä¹‹å®‰è£…ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸï¼š nmcli --version è¿™æ¡å‘½ä»¤ä¼šè¿”å› nmcli çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¯´æ˜å®‰è£…æˆåŠŸã€‚ 2. æŸ¥çœ‹ç½‘ç»œè®¾å¤‡è¦æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰çš„ç½‘ç»œè®¾å¤‡ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š sudo nmcli dev æ‰§è¡Œåï¼Œç³»ç»Ÿä¼šåˆ—å‡ºæ‰€æœ‰ç½‘ç»œè®¾å¤‡çš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š DEVICE TYPE STATE CONNECTIONeth0 ethernet connected Wired connection 1wlan0 wifi disconnected -- è¿™ä¸ªåˆ—è¡¨ä¼šæ˜¾ç¤ºæ¯ä¸ªè®¾å¤‡çš„åç§°ã€ç±»å‹ã€çŠ¶æ€ä»¥åŠè¿æ¥çš„ç½‘ç»œï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚ 3. å¼€å¯ WiFiå¦‚æœ WiFi å¤„äºå…³é—­çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ‰“å¼€ï¼š sudo nmcli r wifi on ä½¿ç”¨æ­¤å‘½ä»¤åï¼Œç³»ç»Ÿå°†é‡æ–°å¯ç”¨æ— çº¿ç½‘ç»œåŠŸèƒ½ã€‚ç¡®è®¤ WiFi æ˜¯å¦å·²å¼€å¯ï¼Œå¯ä»¥ä½¿ç”¨ nmcli dev å‘½ä»¤ï¼Œå†æ¬¡æŸ¥çœ‹è®¾å¤‡çŠ¶æ€ã€‚ 4. æ‰«æ WiFiä¸€æ—¦ WiFi åŠŸèƒ½å¼€å¯ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰«æå¯ç”¨çš„æ— çº¿ç½‘ç»œï¼š sudo nmcli dev wifi è¿™æ¡å‘½ä»¤ä¼šæ˜¾ç¤ºé™„è¿‘å¯ç”¨ WiFi ç½‘ç»œçš„åˆ—è¡¨ï¼ŒåŒ…å«å®ƒä»¬çš„åç§°ï¼ˆSSIDï¼‰ã€ä¿¡å·å¼ºåº¦å’Œå®‰å…¨ç±»å‹ã€‚ä¾‹å¦‚ï¼š SSID BSSID MODE CH RATE SIGNAL BARS SECURITY MyNetwork 00:11:22:33:44:55 Infra 6 54 Mb/s 70 â–‚â–„â–†_ WPA1 WPA2 AnotherNetwork 66:77:88:99:AA:BB Infra 11 130 Mb/s 80 â–„â–„â–†â–† WPA2 ä¿¡å·å¼ºåº¦ä»¥ dBm è¡¨ç¤ºï¼Œæ•°å€¼è¶Šé«˜ï¼ˆè¶Šæ¥è¿‘ 0ï¼‰è¡¨ç¤ºä¿¡å·è¶Šå¼ºã€‚ 5. è¿æ¥ WiFiè¦è¿æ¥åˆ°æŸä¸ª WiFi ç½‘ç»œï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š sudo nmcli dev wifi connect wifiå password å¯†ç  è¯·å°† wifiå æ›¿æ¢ä¸ºè¦è¿æ¥çš„ WiFi åç§°ï¼Œå°† å¯†ç  æ›¿æ¢ä¸ºè¯¥ç½‘ç»œçš„å¯†ç ã€‚ä¾‹å¦‚ï¼š sudo nmcli dev wifi connect MyNetwork password mypassword123 æˆåŠŸè¿æ¥åï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š Successfully activated connection MyNetwork. è¿™è¯´æ˜å·²ç»æˆåŠŸè¿æ¥åˆ°æŒ‡å®šçš„ WiFi ç½‘ç»œã€‚ä½¿ç”¨ nmcli å‘½ä»¤éå¸¸æ–¹ä¾¿ï¼Œå°¤å…¶æ˜¯åœ¨æ²¡æœ‰å›¾å½¢ç•Œé¢çš„æƒ…å†µä¸‹ï¼Œèƒ½å¿«é€Ÿç®¡ç†å’Œè¿æ¥ç½‘ç»œã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"QEMU","path":"/2024/10/22/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-QEMU/","content":"QEMU ç®€ä»‹QEMUï¼ˆQuick EMUlatorï¼‰æ˜¯ä¸€ä¸ªå¼€æºã€è·¨å¹³å°çš„è™šæ‹ŸåŒ–å·¥å…·å’Œä»¿çœŸå™¨ï¼Œæœ€åˆç”± Fabrice Bellard äº 2003 å¹´å¼€å‘ã€‚QEMU çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå…¶èƒ½å¤Ÿåœ¨å¤šç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿç¯å¢ƒä¸­è¿è¡Œï¼Œä½¿ç”¨å„ç§è™šæ‹ŸåŒ–å’Œä»¿çœŸæŠ€æœ¯å®ç°ç¡¬ä»¶è®¾å¤‡çš„è™šæ‹ŸåŒ–ï¼Œä¸»è¦åº”ç”¨äºç³»ç»Ÿå¼€å‘ã€æµ‹è¯•åŠå­¦ä¹ è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚ QEMU çš„ä¸¤ä¸ªä¸»è¦åŠŸèƒ½æ˜¯ï¼š ä»¿çœŸå™¨æ¨¡å¼ï¼ˆEmulationï¼‰ï¼šå®ƒèƒ½æ¨¡æ‹Ÿå¤šç§ç¡¬ä»¶æ¶æ„ï¼Œå…è®¸ç”¨æˆ·åœ¨ä¸€ç§ç¡¬ä»¶å¹³å°ä¸Šè¿è¡Œå…¶ä»–æ¶æ„çš„æ“ä½œç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥åœ¨ x86 æ¶æ„çš„è®¡ç®—æœºä¸Šè¿è¡ŒåŸºäº ARM æˆ– MIPS æ¶æ„çš„æ“ä½œç³»ç»Ÿï¼Œè¿™å¯¹äºå¼€å‘ä¸æµ‹è¯•è·¨å¹³å°åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚ è™šæ‹ŸåŒ–æ¨¡å¼ï¼ˆVirtualizationï¼‰ï¼šåˆ©ç”¨ç¡¬ä»¶è¾…åŠ©çš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå¦‚ Intel VT-x å’Œ AMD SVMï¼ŒQEMU èƒ½å¤Ÿæ˜¾è‘—æå‡è™šæ‹Ÿæœºçš„æ€§èƒ½ã€‚è¿™ç§å¼ºå¤§çš„æ€§èƒ½åŠ é€Ÿä½¿å¾—ç”¨æˆ·åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å¯ä»¥æµç•…è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå‡ ä¹æ²¡æœ‰æ€§èƒ½æŸå¤±ã€‚ QEMU çš„ç‰¹æ€§ å¤šæ¶æ„æ”¯æŒï¼šQEMU æ”¯æŒå¤šç§ CPU æ¶æ„ï¼ŒåŒ…æ‹¬ x86ã€ARMã€PowerPCã€MIPS å’Œ RISC-V ç­‰ã€‚è¿™ç§çµæ´»æ€§éå¸¸é€‚åˆå¼€å‘äººå‘˜éœ€è¦æµ‹è¯•ä¸åŒå¹³å°å…¼å®¹æ€§æ—¶çš„éœ€æ±‚ã€‚ ä¸ KVM ç»“åˆä½¿ç”¨ï¼šå½“ QEMU ä¸ KVMï¼ˆKernel-based Virtual Machineï¼‰é…åˆæ—¶ï¼Œå¯ä»¥æä¾›å“è¶Šçš„è™šæ‹ŸåŒ–æ€§èƒ½ã€‚KVM åˆ©ç”¨ç¡¬ä»¶è™šæ‹ŸåŒ–åŠŸèƒ½ï¼Œå‡ ä¹å°†è™šæ‹Ÿæœºæ€§èƒ½æå‡åˆ°è¿‘ä¹åŸç”Ÿç¯å¢ƒçš„æ°´å¹³ã€‚ ç”¨æˆ·ç©ºé—´ä»¿çœŸï¼šQEMU æ”¯æŒåœ¨ç”¨æˆ·ç©ºé—´ä¸­ä»¿çœŸï¼Œå¯ä»¥è¿è¡Œä¸åŒå¹³å°ä¸Šçš„å•ä¸ªç”¨æˆ·ç¨‹åºï¼Œè¿™å¯¹äºè½¯ä»¶æµ‹è¯•å’Œå¼€å‘è€…è°ƒè¯•å¤§å‹è½¯ä»¶é¡¹ç›®éå¸¸æœ‰å¸®åŠ©ã€‚ å¹¿æ³›åº”ç”¨åœºæ™¯ï¼šQEMU è¢«å¹¿æ³›åº”ç”¨äºåµŒå…¥å¼å¼€å‘ã€æ“ä½œç³»ç»Ÿæµ‹è¯•ã€ç³»ç»Ÿé•œåƒè°ƒè¯•ç­‰ã€‚å¼€å‘è€…å¯ä»¥ä½¿ç”¨å®ƒæ¥æ¨¡æ‹Ÿç¡¬ä»¶ç¯å¢ƒï¼Œä»è€Œåœ¨ä¸»æœºä¸Šä¾¿æ·åœ°æµ‹è¯•åµŒå…¥å¼ç³»ç»Ÿæˆ–æ–°æ“ä½œç³»ç»Ÿã€‚ QEMU çš„ç®€è¦ä½¿ç”¨æ–¹å¼1. å®‰è£… QEMUåœ¨ Linux æ“ä½œç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡å…¶åŒ…ç®¡ç†å™¨è½»æ¾å®‰è£… QEMUã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§æ“ä½œç³»ç»Ÿå®‰è£…çš„ç¤ºä¾‹ï¼š UbuntuDebianï¼š sudo apt updatesudo apt install qemu qemu-system qemu-user-static è¿™æ¡å‘½ä»¤ä¼šå®‰è£… QEMU åŠå…¶ç›¸å…³çš„ç³»ç»Ÿå’Œç”¨æˆ·æ¨¡å¼æ¨¡æ‹Ÿå·¥å…·ã€‚ CentOSRHELï¼š sudo yum install qemu-kvm qemu-img ç›¸åº”åœ°ï¼Œè¿™å°†å®‰è£… KVM æ”¯æŒçš„ QEMUã€‚ Windowsï¼š åœ¨ QEMUå®˜æ–¹é¡µé¢ ä¸‹è½½ Windows ç‰ˆ QEMUï¼Œå¹¶åœ¨å®‰è£…è¿‡ç¨‹ä¸­ç¡®ä¿å…¶è·¯å¾„æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­ï¼Œè¿™æ ·å¯ä»¥åœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹è½»æ¾è¿è¡Œ QEMUã€‚ 2. è¿è¡ŒåŸºæœ¬ QEMU è™šæ‹Ÿæœºä»¥ä¸‹æ˜¯åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªç®€å•è™šæ‹Ÿæœºçš„ç¤ºä¾‹å‘½ä»¤ï¼š qemu-system-x86_64 -boot d -cdrom /path/to/your.iso -m 1024 qemu-system-x86_64ï¼šæŒ‡å®šè¦è¿è¡Œ x86_64 æ¶æ„çš„è™šæ‹Ÿæœºã€‚ -boot dï¼šæŒ‡å®šä»å…‰ç›˜å¯åŠ¨ã€‚ -cdromï¼šç”¨æ¥æŒ‡å®š ISO æ–‡ä»¶çš„è·¯å¾„ã€‚ -m 1024ï¼šä¸ºè™šæ‹Ÿæœºåˆ†é… 1GB å†…å­˜ï¼Œè¿™å¯¹äºè¿è¡Œå¤§å¤šæ•°æ“ä½œç³»ç»Ÿæ¥è¯´æ˜¯è¶³å¤Ÿçš„ã€‚ è¿™ç§ç®€å•çš„å‘½ä»¤ä½¿å¾—ä»»ä½•äººéƒ½èƒ½å¿«é€Ÿè®¾ç½®ä¸€ä¸ªè™šæ‹Ÿæœºæ¥æµ‹è¯•ä¸åŒçš„æ“ä½œç³»ç»Ÿæˆ–è½¯ä»¶ç¯å¢ƒã€‚ 3. åˆ›å»ºè™šæ‹Ÿç£ç›˜é•œåƒä½¿ç”¨ qemu-img å·¥å…·åˆ›å»ºè™šæ‹Ÿç£ç›˜çš„å‘½ä»¤å¦‚ä¸‹ï¼š qemu-img create -f qcow2 mydisk.qcow2 10G -f qcow2ï¼šæŒ‡å®šç£ç›˜çš„æ ¼å¼ï¼Œqcow2 æ˜¯ QEMU çš„é»˜è®¤æ ¼å¼ï¼Œæ”¯æŒå¿«ç…§ç­‰é«˜çº§åŠŸèƒ½ã€‚ mydisk.qcow2ï¼šè¿™æ˜¯åˆ›å»ºçš„è™šæ‹Ÿç£ç›˜æ–‡ä»¶çš„åç§°ã€‚ 10Gï¼šæŒ‡å®šè™šæ‹Ÿç£ç›˜çš„å¤§å°ä¸º 10GBï¼Œé€‚åˆå­˜æ”¾å¤šä¸ªæ–‡ä»¶æˆ–ç³»ç»Ÿæ˜ åƒã€‚ æ¥ç€å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿è¡Œè™šæ‹Ÿæœºå¹¶æŒ‚è½½è¿™ä¸ªæ–°åˆ›å»ºçš„ç£ç›˜ï¼š qemu-system-x86_64 -hda mydisk.qcow2 -cdrom /path/to/your.iso -boot d -m 1024 è¿™æ¡å‘½ä»¤å°†æ–°åˆ›å»ºçš„è™šæ‹Ÿç£ç›˜ä½œä¸ºä¸»ç¡¬ç›˜æŒ‚è½½ï¼Œä»è€Œå¯ä»¥å®‰è£…æ“ä½œç³»ç»Ÿæˆ–è¿è¡Œåº”ç”¨ç¨‹åºã€‚ 4. åŠ é€Ÿè™šæ‹ŸåŒ–ä¸ºäº†åˆ©ç”¨ KVM åŠ é€Ÿ QEMU è™šæ‹Ÿæœºï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š qemu-system-x86_64 -enable-kvm -hda mydisk.qcow2 -m 1024 -enable-kvmï¼šå¯ç”¨ KVM åŠ é€ŸåŠŸèƒ½ï¼Œè¿™æ ·ç”¨æˆ·å¯ä»¥å……åˆ†åˆ©ç”¨ç°ä»£ CPU æä¾›çš„ç¡¬ä»¶è™šæ‹ŸåŒ–ç‰¹æ€§ï¼Œä»è€Œæ˜¾è‘—æå‡è™šæ‹Ÿæœºæ€§èƒ½ã€‚ è¿™ç§æ–¹æ³•å¯¹éœ€è¦é«˜å®æ—¶æ€§èƒ½çš„åº”ç”¨åœºæ™¯å°¤ä¸ºé‡è¦ï¼Œæ¯”å¦‚è¿è¡Œæ•°æ®åº“æˆ–é«˜è´Ÿè½½ç½‘ç»œæœåŠ¡å™¨ã€‚ å­¦ä¹  QEMU çš„é€”å¾„å­¦ä¹  QEMU çš„å»ºè®®é€”å¾„æœ‰ï¼š é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼šQEMU çš„å®˜æ–¹æ–‡æ¡£å†…å®¹è¯¦å®ï¼Œæ¶µç›–äº†ä»å®‰è£…åˆ°ä½¿ç”¨æŠ€å·§çš„å„ä¸ªæ–¹é¢ã€‚è®¿é—® QEMUå®˜æ–¹æ–‡æ¡£ æ˜¯äº†è§£å…¶åŠŸèƒ½çš„æœ€ä½³æ–¹å¼ã€‚ å®éªŒå’Œå®è·µï¼šåŠ¨æ‰‹å°è¯•åœ¨ QEMU ä¸­è¿è¡Œä¸åŒæ¶æ„çš„æ“ä½œç³»ç»Ÿï¼Œä¾‹å¦‚ ARM å’Œ MIPSï¼Œå®æ“ä¸­æŒæ¡å…¶å·¥ä½œåŸç†ã€‚ ä¸ KVM ç»“åˆå­¦ä¹ è™šæ‹ŸåŒ–ï¼šæ·±å…¥ç†è§£ QEMU å’Œ KVM çš„ç»“åˆä½¿ç”¨ï¼Œå­¦ä¹ å¦‚ä½•é€šè¿‡è°ƒä¼˜é…ç½®æ¥æå‡æ€§èƒ½ã€‚ è°ƒè¯•å’Œä»¿çœŸåµŒå…¥å¼ç³»ç»Ÿï¼šåˆ©ç”¨ QEMU æ¨¡æ‹Ÿ ARM å¼€å‘æ¿æˆ– RISC-V ç­‰å¹³å°ï¼Œè¿›è¡ŒåµŒå…¥å¼é¡¹ç›®å¼€å‘ï¼Œå¯ä»¥è®©åœ¨ä¸»æœºä¸Šè°ƒè¯•å’Œæµ‹è¯•åµŒå…¥å¼åº”ç”¨ã€‚ QEMU çš„ä¼˜åŠ¿ çµæ´»æ€§ï¼šèƒ½å¤Ÿæ”¯æŒå¤šç§æ¶æ„å’Œç¡¬ä»¶å¹³å°ï¼Œå¯¹å¼€å‘éœ€è¦å…¼å®¹æ€§æµ‹è¯•çš„åº”ç”¨ç¨‹åºéå¸¸å‹å¥½ã€‚ å¼€æºï¼šQEMU æ˜¯å¼€æºè½¯ä»¶ï¼Œä»£ç é€æ˜ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦å¯¹è½¯ä»¶è¿›è¡Œå®šåˆ¶å’Œå­¦ä¹ ã€‚ ä¼˜ç§€æ€§èƒ½ï¼šç»“åˆ KVM å¯ä»¥æä¾›æé«˜çš„è™šæ‹ŸåŒ–æ€§èƒ½ï¼Œä½¿å¾—å¼€å‘å’Œæµ‹è¯•è¿‡ç¨‹é«˜æ•ˆæµç•…ã€‚ QEMU ä¸ä»…æ˜¯å­¦ä¹ æ“ä½œç³»ç»Ÿå¼€å‘ã€åµŒå…¥å¼å¼€å‘å’Œç¡¬ä»¶è™šæ‹ŸåŒ–çš„å¼ºå¤§å·¥å…·ï¼Œä¹Ÿä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªä»¿çœŸå’Œè°ƒè¯•çš„å¹³å°ã€‚é€šè¿‡ä¸æ–­åœ°å®è·µï¼Œç”¨æˆ·èƒ½æ›´æ·±å…¥ç†è§£è™šæ‹ŸåŒ–å’Œä»¿çœŸæŠ€æœ¯çš„æ ¸å¿ƒåŸç†ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"å¯åŠ¨è¿‡ç¨‹åˆ†æ","path":"/2024/10/21/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-å¯åŠ¨è¿‡ç¨‹åˆ†æ/","content":"åµŒå…¥å¼ Linux ç³»ç»Ÿç»„ç»‡ç»“æ„åµŒå…¥å¼ Linux ç³»ç»Ÿçš„ç»„ç»‡ç»“æ„ä»è½¯ä»¶è§’åº¦å¯åˆ’åˆ†ä¸ºå››ä¸ªå…³é”®ç»„æˆéƒ¨åˆ†ï¼šå¼•å¯¼åŠ è½½ç¨‹åºï¼ˆBootloaderï¼‰ã€Linux å†…æ ¸ã€æ–‡ä»¶ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºã€‚è¿™å››ä¸ªéƒ¨åˆ†ç´§å¯†åä½œï¼Œç¡®ä¿åµŒå…¥å¼ç³»ç»Ÿèƒ½å¤Ÿé«˜æ•ˆå¹¶å¯é åœ°å¯åŠ¨å’Œè¿è¡Œã€‚ 1. å¼•å¯¼åŠ è½½ç¨‹åºï¼ˆBootloaderï¼‰å¼•å¯¼åŠ è½½ç¨‹åºåœ¨åµŒå…¥å¼ç³»ç»Ÿå¯åŠ¨æ—¶èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚å®ƒè´Ÿè´£åŠ è½½æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œå¹¶ä¸ºå…¶æä¾›å¿…è¦çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚å¼•å¯¼åŠ è½½ç¨‹åºé€šå¸¸åœ¨ç³»ç»Ÿä¸Šç”µæˆ–é‡å¯æ—¶é¦–å…ˆæ‰§è¡Œï¼Œå®ƒå°†å†…å­˜ä¸­çš„ç¨‹åºå¼•å¯¼è‡³ CPU ä¸­ã€‚åµŒå…¥å¼ç³»ç»Ÿä¸­å¸¸ç”¨çš„å¼•å¯¼åŠ è½½ç¨‹åºåŒ…æ‹¬ï¼š Blobï¼šè¿™æ˜¯ä¸€ä¸ªç®€å•çš„å¼•å¯¼å·¥å…·ï¼Œä¸»è¦ç”¨äºä¸€äº›ç‰¹å®šçš„ç¡¬ä»¶å¹³å°ï¼Œå®ƒèƒ½å¤Ÿå¿«é€Ÿåœ°åŠ è½½å’Œè¿è¡Œå†…æ ¸æ˜ åƒã€‚ RedBootï¼šè¿™ä¸ªå¼•å¯¼åŠ è½½ç¨‹åºå…·æœ‰ç½‘ç»œæ”¯æŒï¼Œå¯ç”¨äºé€šè¿‡ç½‘ç»œè¿›è¡Œç³»ç»Ÿåˆå§‹åŒ–å’Œè°ƒè¯•ã€‚å®ƒå…è®¸å¼€å‘è€…é€šè¿‡ç½‘ç»œåŠ è½½åº”ç”¨ç¨‹åºï¼Œæé«˜äº†å¼€å‘çš„çµæ´»æ€§ã€‚ U-Bootï¼šU-Boot æ˜¯ç›®å‰æœ€æµè¡Œçš„å¼€æºå¼•å¯¼åŠ è½½ç¨‹åºï¼Œå¹¿æ³›åº”ç”¨äºå¤šç§ç¡¬ä»¶æ¶æ„ï¼ŒåŒ…æ‹¬ ARM å’Œ PowerPCã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„é…ç½®é€‰é¡¹ï¼ŒåŒ…æ‹¬æ”¯æŒå¤šç§æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œå¯åŠ¨ä»¥åŠä¸å…¶ä»–æ¨¡å—çš„é›†æˆèƒ½åŠ›ã€‚ 2. Linux å†…æ ¸Linux å†…æ ¸æ˜¯åµŒå…¥å¼ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†ç¡¬ä»¶èµ„æºã€æä¾›ç³»ç»Ÿè°ƒç”¨æ¥å£ï¼Œå¹¶å®ç°è¿›ç¨‹è°ƒåº¦å’Œå†…å­˜ç®¡ç†ç­‰åŠŸèƒ½ã€‚å†…æ ¸ç¡®ä¿å„ä¸ªåº”ç”¨ç¨‹åºèƒ½å¤Ÿé«˜æ•ˆåœ°ä½¿ç”¨ç³»ç»Ÿèµ„æºï¼Œä¾‹å¦‚ CPUã€å†…å­˜å’Œè¾“å…¥è¾“å‡ºè®¾å¤‡ã€‚å†…æ ¸å°†ä½œä¸ºç³»ç»Ÿçš„å®ˆæŠ¤è€…ï¼Œä¸ä»…ä¿éšœå®‰å…¨æ€§ï¼Œè¿˜å¢å¼ºç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚å¸¸è§çš„åµŒå…¥å¼ Linux å†…æ ¸æœ‰ï¼š å®æ—¶å†…æ ¸ï¼ˆRTLinuxï¼‰ï¼šå®ƒæ˜¯ä¼˜åŒ–è¿‡çš„ç‰ˆæœ¬ï¼Œä¸“é—¨ç”¨äºéœ€è¦ä¸¥æ ¼æ—¶åºæ§åˆ¶çš„åº”ç”¨åœºæ™¯ï¼Œå¦‚å·¥ä¸šæ§åˆ¶ã€‚ å®šåˆ¶å†…æ ¸ï¼šè®¸å¤šåµŒå…¥å¼å¼€å‘äººå‘˜æ ¹æ®é¡¹ç›®è¦æ±‚ï¼Œè‡ªè¡Œè£å‰ªå’Œé…ç½®å†…æ ¸ï¼Œä»¥ä»…åŒ…å«æ‰€éœ€çš„é©±åŠ¨å’ŒåŠŸèƒ½ï¼Œä»è€Œå‡å°å†…æ ¸çš„ä½“ç§¯å¹¶æé«˜æ€§èƒ½ã€‚ 3. æ–‡ä»¶ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿæ˜¯åµŒå…¥å¼ Linux ç³»ç»Ÿçš„å¦ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œè´Ÿè´£æ•°æ®å­˜å‚¨å’Œç®¡ç†ã€‚å®ƒå®šä¹‰äº†å¦‚ä½•åœ¨å­˜å‚¨è®¾å¤‡ä¸­ç»„ç»‡å’Œå­˜å–æ–‡ä»¶ï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§ä¸å¯é æ€§ã€‚å¸¸ç”¨çš„åµŒå…¥å¼æ–‡ä»¶ç³»ç»ŸåŒ…æ‹¬ï¼š JFFS2ï¼ˆJournaling Flash File System 2ï¼‰ï¼šä¸“ä¸ºé—ªå­˜è®¾å¤‡è®¾è®¡ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°ç®¡ç†é—ªå­˜çš„ç£¨æŸï¼Œä¿éšœæ•°æ®åœ¨ç”µæºæ•…éšœæ—¶ä¸ä¼šä¸¢å¤±ã€‚ SquashFSï¼šä¸€ç§é«˜å‹ç¼©æ¯”çš„åªè¯»æ–‡ä»¶ç³»ç»Ÿï¼Œé€‚ç”¨äºéœ€è¦èŠ‚çœå­˜å‚¨ç©ºé—´çš„åœºæ™¯ï¼Œå¸¸è§äºåµŒå…¥å¼è®¾å¤‡çš„å›ºä»¶åˆ†å‘ã€‚ 4. åº”ç”¨ç¨‹åºåº”ç”¨ç¨‹åºæ˜¯ç”¨æˆ·ä¸åµŒå…¥å¼ Linux ç³»ç»Ÿäº’åŠ¨çš„ç•Œé¢ï¼Œè´Ÿè´£å®ç°å®é™…çš„åŠŸèƒ½éœ€æ±‚ã€‚åµŒå…¥å¼ç³»ç»Ÿä¸­çš„åº”ç”¨ç¨‹åºå¯åŒ…æ‹¬ï¼š ç½‘ç»œæœåŠ¡åº”ç”¨ï¼šå¦‚ HTTP æœåŠ¡å™¨ï¼Œèƒ½å¤Ÿå®ç°æ•°æ®çš„è¿œç¨‹æ“æ§ä¸ç›‘æ§ã€‚ è§†è§‰å’Œå›¾åƒå¤„ç†åº”ç”¨ï¼šåœ¨ä¸€äº›å·¥ä¸šå’ŒåŒ»ç–—åº”ç”¨ä¸­ï¼ŒåµŒå…¥å¼ç³»ç»Ÿéœ€è¦å¤„ç†å›¾åƒæ•°æ®ï¼Œä½¿ç”¨ä¸“é—¨çš„ç®—æ³•è¿›è¡Œåˆ†æã€‚ ç”¨æˆ·æ¥å£åº”ç”¨ï¼šåœ¨åµŒå…¥å¼è®¾å¤‡ä¸­ï¼Œå¾€å¾€éœ€è¦ä¸€ä¸ªå‹å¥½çš„ç”¨æˆ·ç•Œé¢ï¼Œä»¥æé«˜å¯ç”¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚ è¿™å››ä¸ªæ–¹é¢çš„ç»„æˆéƒ¨åˆ†åœ¨åµŒå…¥å¼ Linux ç³»ç»Ÿä¸­å‘æŒ¥ç€å„è‡ªçš„ä½œç”¨ï¼ŒååŒå·¥ä½œï¼Œä»è€Œå®ç°é«˜æ•ˆçš„ç³»ç»Ÿå¯åŠ¨ä¸è¿è¡Œã€‚åœ¨æ•´ä¸ªç³»ç»Ÿæ¶æ„ä¸­ï¼Œå¼•å¯¼åŠ è½½ç¨‹åºæ„å»ºäº†ç³»ç»Ÿçš„åˆå§‹ç¯å¢ƒï¼ŒLinux å†…æ ¸é€šè¿‡å®‰å…¨çš„èµ„æºç®¡ç†è¿›è¡Œè°ƒåº¦ï¼Œè€Œæ–‡ä»¶ç³»ç»Ÿåˆ™ä¸ºæ•°æ®çš„ç»„ç»‡å’Œå­˜å‚¨æä¾›äº†åŸºç¡€ä¿éšœï¼Œæœ€ç»ˆå„ç±»åº”ç”¨ç¨‹åºåˆ™å®ç°äº†ç³»ç»Ÿçš„æ™ºèƒ½åŒ–å’Œè‡ªåŠ¨åŒ–ã€‚ å¸¸è§çš„åµŒå…¥å¼ Linux Bootloader åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š 1. BlobBlob æ˜¯ä¸€ç§å¾®å‹ Bootloaderï¼Œé€šå¸¸ç”¨äºé©±åŠ¨ç‰¹å®šç¡¬ä»¶å¹³å°çš„å¯åŠ¨è¿‡ç¨‹ã€‚å®ƒçš„è®¾è®¡æ—¨åœ¨å¿«é€ŸåŠ è½½å’Œæ‰§è¡Œï¼Œä»…æ”¯æŒåŸºæœ¬çš„å¼•å¯¼åŠŸèƒ½ã€‚Blob é€šå¸¸ç”±ç¡¬ä»¶åˆ¶é€ å•†æä¾›ï¼Œé’ˆå¯¹ç‰¹å®šè®¾å¤‡è¿›è¡Œä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œåœ¨æŸäº›æ™ºèƒ½æ‰‹æœºå’Œå¹³æ¿ç”µè„‘ä¸­ï¼ŒBlob å¯èƒ½è´Ÿè´£åœ¨å¼€æœºæ—¶åˆå§‹åŒ–è®¾å¤‡çš„ç¡¬ä»¶ç»„ä»¶ï¼Œç„¶ååŠ è½½ä¸»è¦æ“ä½œç³»ç»Ÿã€‚ 2. RedBootRedBoot æ˜¯ä¸€ä¸ªçµæ´»ä¸”åŠŸèƒ½å¼ºå¤§çš„ Bootloaderï¼Œä¸»è¦ä¸ºåµŒå…¥å¼å¼€å‘è®¾è®¡ã€‚å®ƒæ”¯æŒå¤šç§ç½‘ç»œåè®®ï¼Œä½¿å¾—åœ¨ä¸åŒçš„ç½‘ç»œç¯å¢ƒä¸‹è¿›è¡Œæ“ä½œç³»ç»Ÿçš„ä¸‹è½½å’Œæ›´æ–°å˜å¾—å®¹æ˜“ã€‚RedBoot å…·æœ‰å¯åŠ¨å¤šç§æ ¼å¼çš„æ˜ åƒæ–‡ä»¶çš„èƒ½åŠ›ï¼Œè¿™è®©å¼€å‘äººå‘˜å¯ä»¥åœ¨è°ƒè¯•å’Œæµ‹è¯•è¿‡ç¨‹ä¸­è½»æ¾ç®¡ç†ä¸åŒç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿã€‚ä¾‹å¦‚ï¼ŒRedBoot å¯ä»¥é€šè¿‡ TFTPï¼ˆTrivial File Transfer Protocolï¼‰ä»ç½‘ç»œæœåŠ¡å™¨ä¸‹è½½æ˜ åƒæ–‡ä»¶ï¼Œå¯¹äºéœ€è¦å¿«é€Ÿè¿­ä»£å¼€å‘çš„é¡¹ç›®å°¤ä¸ºé‡è¦ã€‚ 3. U-BootU-Boot æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„å¼€æº Bootloaderï¼Œåœ¨åµŒå…¥å¼ Linux å¼€å‘ä¸­éå¸¸æµè¡Œã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§å¤„ç†å™¨æ¶æ„å’Œç¡¬ä»¶å¹³å°ã€‚U-Boot çš„çµæ´»æ€§ä½¿å…¶èƒ½å¤Ÿåœ¨å¤šç§å­˜å‚¨ä»‹è´¨ä¸Šå¼•å¯¼ç³»ç»Ÿï¼Œæ¯”å¦‚é—ªå­˜ã€SD å¡å’Œç½‘ç»œã€‚å®ƒè¿˜æ”¯æŒç¯å¢ƒå˜é‡çš„é…ç½®ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®éœ€è¦ä»»æ„ä¿®æ”¹å¯åŠ¨å‚æ•°ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ U-Bootï¼Œå¯ä»¥è½»æ¾åˆ‡æ¢å¯åŠ¨çš„ Linux å†…æ ¸ç‰ˆæœ¬æˆ–è€…åŠ è½½ä¸åŒçš„æ ¹æ–‡ä»¶ç³»ç»Ÿä»¥æ»¡è¶³ä¸åŒçš„å¼€å‘éœ€æ±‚ã€‚ é€šè¿‡äº†è§£è¿™ä¸‰ç§ Bootloader çš„ç‰¹ç‚¹å’ŒåŠŸèƒ½ï¼Œå¼€å‘è€…èƒ½å¤Ÿé€‰æ‹©æœ€é€‚åˆè‡ªå·±é¡¹ç›®çš„å¼•å¯¼æ–¹æ¡ˆï¼Œä»è€Œåœ¨åµŒå…¥å¼ Linux ç¯å¢ƒä¸­å®ç°æ›´é«˜æ•ˆçš„ç³»ç»Ÿå¯åŠ¨å’Œç®¡ç†ã€‚ Linux å†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹Linux å†…æ ¸ä¸»è¦æœ‰ä¸¤ç§æ˜ åƒæ ¼å¼ï¼šä¸€ç§æ˜¯éå‹ç¼©å†…æ ¸ï¼Œç§°ä¸º Imageï¼Œå¦ä¸€ç§æ˜¯å‹ç¼©ç‰ˆæœ¬ï¼Œç§°ä¸º zImageã€‚æ ¹æ®å†…æ ¸æ˜ åƒçš„ä¸åŒï¼ŒLinux å†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹åœ¨æœ€åˆé˜¶æ®µè¡¨ç°å¾—æœ‰æ‰€ä¸åŒã€‚ zImage æ˜¯é€šè¿‡å¯¹ Image è¿›è¡Œå‹ç¼©å¾—åˆ°çš„ï¼Œå…¶å¤§å°é€šå¸¸å°äº Imageã€‚ä¸ºäº†ä½¿ç”¨ zImageï¼Œå¿…é¡»åœ¨å…¶å¼€å¤´æ·»åŠ è§£å‹ç¼©çš„ä»£ç ï¼Œè¿™æ · zImage æ‰èƒ½è¢«è§£å‹ç¼©å¹¶æ‰§è¡Œï¼Œå› æ­¤å…¶æ‰§è¡Œé€Ÿåº¦é€šå¸¸æ¯” Image è¦æ…¢ã€‚å°½ç®¡å¦‚æ­¤ï¼Œåœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œç”±äºå­˜å‚¨ç©ºé—´é€šå¸¸è¾ƒå°ï¼Œä½¿ç”¨ zImage æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´æ›´å°‘ï¼Œè¿™æ ·åœ¨å­˜å‚¨ç©ºé—´å’Œæ€§èƒ½ä¹‹é—´çš„å–èˆæ˜¯ç›¸å¯¹å¯æ¥å—çš„ã€‚å› æ­¤ï¼Œè®¸å¤šåµŒå…¥å¼ç³»ç»Ÿé€‰æ‹©ä½¿ç”¨å‹ç¼©å†…æ ¸çš„æ–¹å¼ã€‚ åœ¨ Bootloader å°† Linux å†…æ ¸æ˜ åƒå¤åˆ¶åˆ° RAM ä¹‹åï¼Œå†…æ ¸æ˜ åƒä¼šè¢«è§£å‹å¹¶è¿›è¡Œåˆå§‹åŒ–ï¼Œåç»­çš„ç¡¬ä»¶å¹³å°ç›¸å…³çš„åˆå§‹åŒ–å·¥ä½œå®Œæˆã€‚æ¥ç€ï¼Œä¼šè¿›è¡Œå†…æ ¸ç›¸å…³çš„ä¸€ç³»åˆ—åˆå§‹åŒ–ï¼Œæœ€åä¼šè°ƒç”¨ç¬¬ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹â€”â€”init è¿›ç¨‹ï¼Œå¹¶ç­‰å¾…å…¶æ‰§è¡Œã€‚è¿™æ ·ï¼Œæ•´ä¸ª Linux å†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹å°±å®Œæˆäº†ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ç®€å•çš„ shell è„šæœ¬æ¥å¯åŠ¨æ‰€éœ€çš„åµŒå…¥å¼åº”ç”¨ç¨‹åºã€‚ æ¯å½“ç³»ç»Ÿä¸Šç”µæˆ–å¤ä½æ—¶ï¼Œå¤„ç†å™¨ä¼šæ‰§è¡Œä¸€æ®µå­˜å‚¨åœ¨ FlashROM ä¸­çš„å·²çŸ¥ä½ç½®çš„ä»£ç ï¼Œè¿™æ®µä»£ç å³ä¸º Bootloaderã€‚å…¶ä¸»è¦èŒè´£æ˜¯åˆå§‹åŒ–å¤„ç†å™¨å’Œå¤–è®¾ï¼Œéšåè°ƒç”¨ Linux å†…æ ¸ã€‚Linux å†…æ ¸åœ¨å®Œæˆç³»ç»Ÿçš„åˆå§‹åŒ–ä¹‹åï¼Œéœ€è¦æŒ‚è½½æŸä¸ªæ–‡ä»¶ç³»ç»Ÿä½œä¸ºæ ¹æ–‡ä»¶ç³»ç»Ÿï¼ˆRoot Filesystemï¼‰ï¼Œå¹¶åŠ è½½å¿…è¦çš„å†…æ ¸æ¨¡å—ï¼Œæœ€ç»ˆå¯åŠ¨åº”ç”¨ç¨‹åºã€‚ç”±æ­¤å¯è§ï¼ŒBootloader åœ¨æ•´ä¸ªåµŒå…¥å¼ Linux ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ã€‚ Bootloader ç§ç±»åµŒå…¥å¼ Linux ç³»ç»Ÿä¸­ï¼Œæ ¹æ®ä¸åŒçš„å¤„ç†å™¨æ¶æ„ï¼Œå­˜åœ¨å¤šç§ Bootloaderã€‚ä»¥ä¸‹æ˜¯æ ¹æ®å¤„ç†å™¨ä½“ç³»ç»“æ„åˆ’åˆ†çš„ Bootloader ç§ç±»å’Œå®ƒä»¬çš„ç‰¹æ€§ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š Bootloader Mointor æè¿° X86 ARM PowerPC LILO å¦ Linux ç£ç›˜å¼•å¯¼ç¨‹åº æ˜¯ å¦ å¦ Grub å¦ GNU å¼•å¯¼çš„ LILO æ›¿ä»£ç¨‹åº æ˜¯ å¦ å¦ Loadlin å¦ ä» DOS å¼•å¯¼ Linux æ˜¯ å¦ å¦ ROLO å¦ ä» ROM å¼•å¯¼ Linux è€Œä¸éœ€è¦ BIOS æ˜¯ å¦ å¦ Etherboot å¦ é€šè¿‡ä»¥å¤ªç½‘å¯åŠ¨ Linux å¼•å¯¼ç¨‹åº æ˜¯ å¦ å¦ Linux BIOS å¦ å®Œå…¨æ›¿ä»£ BIOS çš„ Linux å¼•å¯¼ç¨‹åº æ˜¯ å¦ å¦ Blob å¦ LART ç­‰ç¡¬ä»¶å¹³å°çš„å¼•å¯¼ç¨‹åº å¦ æ˜¯ å¦ U-Boot æ˜¯ é€šç”¨å¼•å¯¼ç¨‹åº æ˜¯ æ˜¯ æ˜¯ RedBoot æ˜¯ åŸºäº eCos çš„å¼•å¯¼ç¨‹åº æ˜¯ æ˜¯ æ˜¯ å¼•å¯¼åŠ è½½ç¨‹åºï¼ˆBootloaderï¼‰å½“åµŒå…¥å¼ç³»ç»Ÿé¦–æ¬¡å¼•å¯¼æˆ–è¢«é‡ç½®æ—¶ï¼Œå¤„ç†å™¨ä¼šè‡ªåŠ¨æ‰§è¡Œå­˜æ”¾åœ¨ Flash æˆ– ROM ä¸­å·²çŸ¥ä½ç½®çš„å¼•å¯¼åŠ è½½ç¨‹åºï¼Œè¿™æ˜¯ç³»ç»Ÿå¯åŠ¨çš„ç¬¬ä¸€é“ç¨‹åºï¼Œç±»ä¼¼äºä¸ªäººè®¡ç®—æœºä¸Šçš„ BIOS åŠŸèƒ½ã€‚Bootloader çš„åŸºæœ¬ç›®çš„åœ¨äºåˆå§‹åŒ–å¤„ç†å™¨åŠå¤–è®¾ï¼Œå¹¶éšåè°ƒç”¨ Linux å†…æ ¸ã€‚äº†è§£ Bootloader çš„åŠŸèƒ½ï¼Œæ˜¯ç†è§£åµŒå…¥å¼ Linux ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹çš„å…³é”®ã€‚ Bootloader çš„åŸºæœ¬åŠŸèƒ½Bootloader çš„ä¸»è¦ä»»åŠ¡åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š åˆå§‹åŒ– RAM Linux å†…æ ¸é€šå¸¸ä¼šåœ¨éšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆRAMï¼‰ä¸­è¿è¡Œã€‚å› æ­¤ï¼ŒBootloader éœ€è¦å¯¹ RAM è¿›è¡Œåˆå§‹åŒ–ï¼Œä»¥ç¡®ä¿ä¸º Linux å†…æ ¸çš„å¯åŠ¨åšå¥½å……åˆ†å‡†å¤‡ã€‚è¿™æ­¥åŒ…æ‹¬è®¾ç½® CPU çš„æ§åˆ¶å¯„å­˜å™¨å’Œæ£€æµ‹ RAM çš„å¤§å°ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ RAMã€‚ åˆå§‹åŒ–ä¸²å£ ä¸²å£åœ¨ Linux å¯åŠ¨è¿‡ç¨‹ä¸­æ‰®æ¼”å…³é”®è§’è‰²ï¼Œä¸»è¦ä½œä¸º Linux å†…æ ¸ä¸ç”¨æˆ·äº¤äº’çš„ä¿¡æ¯é€šé“ã€‚é€šè¿‡ä¸²å£è¾“å‡ºï¼Œç”¨æˆ·å¯ä»¥è¿½è¸ªå’Œè°ƒè¯•ç³»ç»Ÿå¯åŠ¨çš„ç»†èŠ‚ï¼Œäº†è§£å†…æ ¸çš„åŠ è½½çŠ¶æ€ã€‚ æ£€æµ‹å¤„ç†å™¨ç±»å‹ åœ¨è°ƒç”¨ Linux å†…æ ¸å‰ï¼ŒBootloader éœ€è¦æ£€æµ‹ç³»ç»Ÿçš„å¤„ç†å™¨ç±»å‹ï¼Œå¹¶å°†ä¿¡æ¯ä¿å­˜ä»¥ä¾›å†…æ ¸ä½¿ç”¨ã€‚è¿™å¯¹äºç¡®ä¿å†…æ ¸èƒ½å¤Ÿæ­£ç¡®åˆå§‹åŒ–å’Œé…ç½®å„ä¸ªç»„ä»¶è‡³å…³é‡è¦ã€‚ è®¾ç½® Linux å¯åŠ¨å‚æ•° Bootloader åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¿˜éœ€è®¾ç½®å’Œåˆå§‹åŒ– Linux å†…æ ¸çš„å¯åŠ¨å‚æ•°ï¼Œä»¥ä¾¿å†…æ ¸èƒ½å¤Ÿæ ¹æ®ç¡¬ä»¶é…ç½®è¿›è¡Œé€‚é…ã€‚ è°ƒç”¨ Linux å†…æ ¸æ˜ åƒ Bootloader çš„æœ€ç»ˆä»»åŠ¡ä¾¿æ˜¯è°ƒç”¨ Linux å†…æ ¸ã€‚å¦‚æœå†…æ ¸å­˜å‚¨åœ¨ Flash ä¸­ä¸”å¯ä»¥ç›´æ¥æ‰§è¡Œï¼ŒBootloader ä¼šç›´æ¥è·³è½¬åˆ°å†…æ ¸è¿›è¡Œæ‰§è¡Œã€‚ç„¶è€Œï¼Œç”±äº Flash å†³å®šäº†æ‰§è¡Œä¸Šçš„ä¸€äº›é™åˆ¶ï¼Œé€šå¸¸åµŒå…¥å¼ç³»ç»Ÿä¼šå°†å†…æ ¸æ‹·è´åˆ° RAM ä¸­å†æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥å……åˆ†åˆ©ç”¨ RAM çš„é€Ÿåº¦ä¼˜åŠ¿ã€‚ Bootloader çš„å¯åŠ¨è¿‡ç¨‹åµŒå…¥å¼ Linux ç³»ç»Ÿçš„å¯åŠ¨å¼€å§‹äº Bootloader çš„æ‰§è¡Œã€‚å½“ç³»ç»Ÿä¸Šç”µï¼ŒBootloader å¼€å§‹åˆå§‹åŒ–ç³»ç»Ÿã€‚åœ¨å®Œæˆç³»ç»Ÿåˆå§‹åŒ–ä»»åŠ¡åï¼Œå®ƒä¼šå°†å­˜å‚¨åœ¨éæ˜“å¤±æ€§å­˜å‚¨å™¨ï¼ˆå¦‚ Flash æˆ– DOCï¼‰ä¸­çš„ Linux å†…æ ¸æ‹·è´åˆ° RAM ä¸­ï¼Œç„¶åè·³è½¬åˆ°å†…æ ¸çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ï¼Œå¯åŠ¨ Linux å†…æ ¸ã€‚ Bootloader å¯åŠ¨è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š Stage 1: åˆå§‹åŒ–åŸºæœ¬ç¡¬ä»¶ ä¸ºåŠ è½½ Stage 2 å‡†å¤‡ RAM ç©ºé—´ å°†å†…æ ¸æ˜ åƒå’Œæ–‡ä»¶ç³»ç»Ÿæ˜ åƒæ‹·è´åˆ° RAM ä¸­ è®¾ç½®å †æ ˆæŒ‡é’ˆï¼ˆSPï¼‰ è·³è½¬åˆ° Stage 2 çš„å…¥å£ç‚¹ Stage 2: åˆå§‹åŒ–æœ¬é˜¶æ®µæ‰€éœ€çš„ç¡¬ä»¶è®¾å¤‡ æ£€æµ‹ç³»ç»Ÿçš„å†…å­˜æ˜ å°„ åŠ è½½å†…æ ¸æ˜ åƒå’Œæ–‡ä»¶ç³»ç»Ÿæ˜ åƒ è®¾ç½®å†…æ ¸çš„å¯åŠ¨å‚æ•° Bootloader é€šå¸¸å­˜æ”¾åœ¨ Flash çš„èµ·å§‹ä½ç½®ï¼Œç¡®ä¿ç³»ç»Ÿä¸Šç”µæˆ–å¤ä½åæ‰§è¡Œçš„ç¬¬ä¸€æ®µç¨‹åºä¸º Bootloaderã€‚å…¶åœ¨ Flash ä¸­çš„å­˜å‚¨ç¤ºæ„å›¾å¯è§†ä¸ºï¼š +------------------+| Bootloader |+------------------+| Linux Kernel |+------------------+| File System |+------------------+ Bootloader çš„å¯åŠ¨æ–¹å¼ä¸åŒçš„å¯åŠ¨æ–¹å¼é€‚åº”ä¸åŒçš„ç³»ç»Ÿéœ€æ±‚ï¼Œä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„ Bootloader å¯åŠ¨æ–¹å¼ï¼š 1. ç½‘ç»œå¯åŠ¨æ–¹å¼è¿™ç§å¯åŠ¨æ–¹æ³•è®©å¼€å‘æ¿æ— éœ€æ­è½½å¤§é‡å­˜å‚¨ä»‹è´¨ï¼Œåƒæ— ç›˜å·¥ä½œç«™ä¸€æ ·ï¼Œä¸åŒçš„æ˜¯ï¼Œå¿…é¡»åœ¨ EPROM æˆ– Flash ä¸­å®‰è£… Bootloaderã€‚é€šè¿‡ä»¥å¤ªç½‘æ¥å£è¿œç¨‹ä¸‹è½½ Linux å†…æ ¸æ˜ åƒæˆ–æ–‡ä»¶ç³»ç»Ÿï¼Œé€šå¸¸ä½¿ç”¨ TFTP ç½‘ç»œåè®®ï¼Œå¹¶é€šè¿‡ DHCP é…ç½® IP åœ°å€ã€‚ 2. ç¡¬ç›˜å¯åŠ¨æ–¹å¼ä¼ ç»Ÿ Linux ç³»ç»Ÿé€šå¸¸è¿è¡Œåœ¨å°å¼æœºæˆ–æœåŠ¡å™¨ä¸Šï¼Œè¿™äº›è®¡ç®—æœºä½¿ç”¨ BIOS å¼•å¯¼å¹¶åˆ©ç”¨ç¡¬ç›˜ä½œä¸ºå­˜å‚¨ä»‹è´¨ã€‚ç»å…¸çš„å¼•å¯¼ç¨‹åºå¦‚ LILOï¼ˆLinux Loaderï¼‰å’Œ GRUBï¼ˆGrand Unified Bootloaderï¼‰å¹¿æ³›åº”ç”¨äº x86 æ¶æ„çš„ Linux ç³»ç»Ÿã€‚ 3. Flash å¯åŠ¨æ–¹å¼ç»å¤§å¤šæ•°åµŒå…¥å¼ç³»ç»Ÿä½¿ç”¨ Flash å­˜å‚¨è®¾å¤‡ã€‚Flash å­˜å‚¨çš„ç±»å‹åŒ…æ‹¬ NOR Flashã€NAND Flash å’Œå…¶ä»–åŠå¯¼ä½“å­˜å‚¨è®¾å¤‡ã€‚å®ƒä»¬ä¹‹é—´çš„ä¸»è¦å·®åˆ«åœ¨äºï¼š NOR Flash æ”¯æŒèŠ¯ç‰‡å†…æ‰§è¡Œï¼ˆXIPï¼ŒeXecute In Placeï¼‰ï¼Œä½¿å¾—ä»£ç å¯ä»¥ç›´æ¥åœ¨ Flash ä¸Šæ‰§è¡Œï¼Œæ— éœ€æ‹·è´åˆ° RAMã€‚ NAND Flash ä¸æ”¯æŒ XIPï¼Œå› æ­¤æ‰§è¡Œ NAND Flash ä¸Šçš„ä»£ç é¡»é¦–å…ˆå°†å…¶æ‹·è´åˆ° RAMï¼Œå†è·³è½¬åˆ° RAM ä¸­æ‰§è¡Œã€‚ NOR Flash çš„ä½¿ç”¨æœ€ä¸ºæ™®éã€‚Bootloader é€šå¸¸æ”¾åœ¨ Flash çš„åº•ç«¯æˆ–é¡¶ç«¯ï¼Œå…·ä½“å–å†³äºå¤„ç†å™¨çš„å¤ä½å‘é‡ã€‚å¯ä»¥å°† Flash è®¾ç½®ä¸º MTDï¼ˆMemory Technology Deviceï¼‰è®¾å¤‡ï¼Œä»¥ä¾¿è¿›è¡Œ Flash åˆ†åŒºçš„è®¿é—®ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"åµŒå…¥å¼äº¤å‰ç¼–è¯‘","path":"/2024/10/18/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-åµŒå…¥å¼äº¤å‰ç¼–è¯‘/","content":"Firefly Linux å¼€å‘æŒ‡å— å®˜æ–¹å‘å¸ƒçš„ Buildroot å›ºä»¶ï¼Œé»˜è®¤æ”¯æŒ Wayland æ¡Œé¢ç¯å¢ƒå’Œä¸€äº› Qt åº”ç”¨ï¼Œå¦‚ä¸‹å›¾ï¼š 1.1. multivideoplayerå¤šè·¯è§†é¢‘æ’­æ”¾å™¨ç”¨äºæµ‹è¯•è®¾å¤‡çš„å¤šè·¯è§†é¢‘æ’­æ”¾èƒ½åŠ›ã€æ˜¾ç¤ºèƒ½åŠ›ä»¥åŠç¡¬ä»¶è§£ç èƒ½åŠ›ã€‚ 1.2. qfmqfm æ˜¯ä¸€ä¸ªæ–‡ä»¶æµè§ˆåº”ç”¨ 1.3. qplayerqplayer æ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½æ’­æ”¾å™¨ï¼Œå¯ä»¥æ’­æ”¾è§†é¢‘ã€éŸ³é¢‘å’Œæµè§ˆå›¾ç‰‡ã€‚ 1.4. qcameraqcamera æ˜¯ä¸€æ¬¾ç›¸æœºåº”ç”¨ï¼Œå¯ä»¥è¿›è¡Œæ‹æ‘„å’Œå½•åƒã€‚ è®¾å¤‡è¿æ¥æ‘„åƒå¤´çš„æƒ…å†µä¸‹å¯åŠ¨ qcamera å°†è‡ªåŠ¨æ˜¾ç¤ºæ‘„åƒå¤´ç”»é¢ï¼Œå³ä¾§æŒ‰é’®ï¼š Image Mode: ç…§ç›¸æ¨¡å¼ï¼Œç‚¹å‡»å¯åˆ‡æ¢ä¸º Video Mode è§†é¢‘å½•åˆ¶æ¨¡å¼ã€‚ Capture: æ•æ‰å›¾åƒï¼Œåœ¨ Video Mode ä¸‹ä¼šå˜ä¸º Record å½•åˆ¶æŒ‰é’®ã€‚ Exit: é€€å‡ºã€‚ 1.5. qsettingqsetting æ˜¯ç³»ç»Ÿè®¾ç½®å·¥å…·ï¼Œå¯ä»¥è®¾ç½® WiFi ï¼Œè“ç‰™ï¼Œæ¢å¤å‡ºå‚ä»¥åŠå›ºä»¶å‡çº§ã€‚ 2. ç”¨æˆ·å’Œå¯†ç  ç”¨æˆ·ï¼šroot å¯†ç ï¼šfirefly 3. ä»¥å¤ªç½‘é…ç½®Buildroot çš„ç½‘ç»œé…ç½®éœ€è¦ä½¿ç”¨åˆ° /etc/network/interfaces é…ç½®æ–‡ä»¶ï¼Œé…ç½®å®Œæˆä¹‹åï¼Œè¿è¡Œ /etc/init.d/S40network restart å³å¯é‡å¯ç½‘ç»œã€‚æ‰‹åŠ¨è°ƒè¯•å¯ä»¥ç›´æ¥ä½¿ç”¨ ifdown -a å’Œ ifup -a æ¥é‡å¯ç½‘ç»œã€‚ 3.1. å¸¸ç”¨é…ç½®é…ç½®æ–‡ä»¶ä¸¾ä¾‹ï¼šå¦‚ä¸‹é…ç½®æ–‡ä»¶å°† eth0 ç½‘å¡è®¾ç½®ä¸ºåŠ¨æ€ IP åœ°å€ï¼Œå°† eth1 è®¾ç½®ä¸ºé™æ€ IP åœ°å€ æ³¨æ„ï¼š/etc/network/interfaces çš„æ–‡ä»¶æ ¼å¼è¦æ±‚æ¯”è¾ƒä¸¥æ ¼ï¼Œå¦‚æœé‡åˆ° Error: either local is duplicate, or /24 is a garbage.ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯é…ç½®æ–‡ä»¶ä¸­å¤šäº†ä¸€ä¸ªç©ºæ ¼ auto loiface lo inet loopbackauto eth0iface eth0 inet dhcpauto eth1iface eth1 inet staticaddress 168.168.110.137netmask 255.255.0.0broadcast 168.168.1.255gateway 168.168.0.1 ï¼ˆ1ï¼‰inet staticï¼šå®šä¹‰é™æ€ IP åœ°å€ã€‚æ”¯æŒçš„é€‰é¡¹æœ‰ï¼š address address Address (dotted quad/netmask) requirednetmask mask Netmask (dotted quad or number of bits) deprecatedbroadcast broadcast_address Broadcast address (dotted quad, + or -) deprecated. Default value: +metric metric Routing metric for default gateway (integer)gateway address Default gateway (dotted quad)pointopoint address Address of other end point (dotted quad). Note the spelling of point-to.hwaddress address Link local address or random.mtu size MTU sizescope Address validity scope. Possible values: global, link, host ï¼ˆ2ï¼‰inet dhcpï¼šé€šè¿‡ DHCP åè®®è·å– IP åœ°å€ã€‚æ”¯æŒçš„é€‰é¡¹æœ‰ï¼š hostname hostname Hostname to be requested (pump, dhcpcd, udhcpc)metric metric Metric for added routes (dhclient)leasehours leasehours Preferred lease time in hours (pump)leasetime leasetime Preferred lease time in seconds (dhcpcd)vendor vendor Vendor class identifier (dhcpcd)client client Client identifier (dhcpcd)hwaddress address Hardware address. ï¼ˆ3ï¼‰inet manualï¼šæ²¡æœ‰ä¸ºæ¥å£å®šä¹‰ IP åœ°å€ã€‚é€šå¸¸ç”±ä½œä¸ºæ¡¥æ¥æˆ–èšåˆæˆå‘˜çš„æ¥å£ï¼Œéœ€è¦ä»¥æ··æ‚æ¨¡å¼è¿è¡Œçš„æ¥å£ï¼ˆ ä¾‹å¦‚ï¼Œç«¯å£é•œåƒæˆ–ç½‘ç»œ TAP ï¼‰æˆ–åœ¨å…¶ä¸Šé…ç½®äº† VLAN è®¾å¤‡çš„æ¥å£ä½¿ç”¨ã€‚è¿™æ˜¯ä¿æŒæ¥å£ä¸å¸¦ IP åœ°å€çš„ä¸€ç§æ–¹æ³•ã€‚æ”¯æŒçš„é€‰é¡¹æœ‰ï¼š hwaddress address Link local address or random.mtu size MTU size 3.2. é«˜çº§è®¾ç½®/etc/network/interfaces æ”¯æŒè®¾ç½®åœ¨ç½‘å¡å…³é—­å¯åŠ¨æ—¶ï¼Œè¿è¡Œ Linux å‘½ä»¤è¡ŒæŒ‡ä»¤ã€‚ç”±äº /etc/network/interfaces æ”¯æŒçš„åŠŸèƒ½ç›¸å¯¹æœ‰é™ï¼Œè¿™åœ¨é…ç½®é™æ€è·¯ç”±ã€é»˜è®¤è·¯ç”±ç­‰ç½‘ç»œé…ç½®æ—¶å°†ä¼šéå¸¸æœ‰å¸®åŠ©ã€‚ æ”¯æŒçš„å¯é€‰é€‰é¡¹æœ‰ï¼špre-upã€upã€post-upã€pre-downã€downã€post-downï¼Œåœ¨è¿™äº›é€‰é¡¹ä¹‹åï¼ŒåŠ ä¸Šå‘½ä»¤è¡Œå³å¯ã€‚ pre-up\tç½‘å¡å¯ç”¨å‰çš„åŠ¨ä½œup\tå¯ç”¨æ—¶å€™çš„åŠ¨ä½œpost-up\tå¯ç”¨åçš„åŠ¨ä½œpre-down\tå…³é—­å‰çš„åŠ¨ä½œdown\tå…³é—­æ—¶åŠ¨ä½œpost-down\tå…³é—­ååŠ¨ä½œè¯´æ˜ï¼š$IFACEè‡ªé€‚åº”å¯¹äºç›¸åº”çš„ç½‘å¡èŠ‚ç‚¹ é…ç½®ä¸¾ä¾‹ï¼šç»™ eth1 ç½‘å¡é…ç½®ä¸€æ¡é™æ€è·¯ç”± auto eth1iface eth1 inet staticaddress 192.168.3.1netmask 255.255.255.0broadcast 192.168.3.255post-up ip route add 192.168.4.0/24 via 192.168.3.2 dev $IFACE é…ç½®ä¸¾ä¾‹ï¼šåˆ›å»ºä¸€ä¸ªç½‘æ¡¥ï¼Œå°† eth0ï¼Œeth1 ç»‘å®šåˆ°ç½‘æ¡¥ï¼Œå°†å…¶ä½œä¸º LAN å£ auto loiface lo inet loopbackauto eth0iface eth0 inet manualpre-up ifconfig $IFACE uppost-down ifconfig $IFACE downauto eth1iface eth1 inet manualpre-up ifconfig $IFACE uppost-down ifconfig $IFACE downauto br0iface br0 inet staticaddress 192.168.2.1netmask 255.255.255.0broadcast 192.168.2.255pre-up brctl addbr $IFACEpre-up brctl addif $IFACE eth0pre-up brctl addif $IFACE eth1bridge_ports eth0 eth1post-down brctl delif $IFACE eth0post-down brctl delif $IFACE eth1post-down ifconfig $IFACE downpost-down brctl delbr $IFACE 4. WiFi è¿æ¥4.1. ä¿®æ”¹é…ç½®æ–‡ä»¶çš„æ–¹å¼4.1.1. æ–¹å¼ 1é€šè¿‡ qsetting QT åº”ç”¨è¿›è¡Œé…ç½®ã€‚ 4.1.2. æ–¹å¼ 2ä¿®æ”¹å¦‚ä¸‹æ–‡ä»¶ï¼š vi /data/cfg/wpa_supplicant.confctrl_interface=/var/run/wpa_supplicantap_scan=1 æ·»åŠ å¦‚ä¸‹é…ç½®é¡¹ network=ssid=WiFi-AP // WiFi åå­—psk=12345678 // WiFi å¯†ç key_mgmt=WPA-PSK\t// åŠ å¯†æ–¹å¼# key_mgmt=NONE // ä¸åŠ å¯† å¯åŠ¨ wpa_supplicant è¿›ç¨‹ wpa_supplicant -B -i wlan0 -c /data/cfg/wpa_supplicant.conf 4.2. ä¸´æ—¶ä¿®æ”¹çš„æ–¹å¼ä¿®æ”¹å¦‚ä¸‹æ–‡ä»¶ï¼š vi /data/cfg/wpa_supplicant.confctrl_interface=/var/run/wpa_supplicantap_scan=1 å¯åŠ¨ wpa_supplicant è¿›ç¨‹ï¼š wpa_supplicant -B -i wlan0 -c /data/cfg/wpa_supplicant.conf 4.2.1. é€šè¿‡ wpa_cli é…ç½® WiFiå¸¸ç”¨å‘½ä»¤ï¼š wpa_cli -i wlan0 scan // æœç´¢é™„è¿‘wifiç½‘ç»œwpa_cli -i wlan0 scan_result // æ‰“å°æœç´¢wifiç½‘ç»œwpa_cli -i wlan0 add_network // æ·»åŠ ä¸€ä¸ªç½‘ç»œè¿æ¥ å¦‚æœè¦è¿æ¥åŠ å¯†æ–¹å¼æ˜¯[WPA-PSK-CCMP+TKIP][WPA2-PSK-CCMP+TKIP][ESS] (wpa åŠ å¯†)ï¼Œwifi åç§°æ˜¯ nameï¼Œwifi å¯†ç æ˜¯ï¼špskã€‚æ“ä½œå¦‚ä¸‹ï¼š wpa_cli -i wlan0 set_network 0 ssid namewpa_cli -i wlan0 set_network 0 psk pskwpa_cli -i wlan0 set_network 0 key_mgmt WPA-PSKwpa_cli -i wlan0 enable_network 0 //ä½¿èƒ½WiFi å¦‚æœè¦è¿æ¥åŠ å¯†æ–¹å¼æ˜¯[WEP][ESS] (wep åŠ å¯†)ï¼Œwifi åç§°æ˜¯ nameï¼Œwifi å¯†ç æ˜¯ pskã€‚æ“ä½œå¦‚ä¸‹ï¼š wpa_cli -i wlan0 set_network 0 ssid namewpa_cli -i wlan0 set_network 0 key_mgmt NONEwpa_cli -i wlan0 set_network 0 wep_key0 pskwpa_cli -i wlan0 enable_network 0 å¦‚æœè¦è¿æ¥åŠ å¯†æ–¹å¼æ˜¯[ESS] (æ— åŠ å¯†)ï¼Œwifi åç§°æ˜¯ nameã€‚æ“ä½œå¦‚ä¸‹ï¼š wpa_cli -i wlan0 set_network 0 ssid namewpa_cli -i wlan0 set_network 0 key_mgmt NONEwpa_cli -i wlan0 enable_network 0 ä½¿èƒ½ä¿å­˜ WIFI è¿æ¥ä¿¡æ¯ wpa_cli -i wlan0 set update_config 1 ä¿å­˜ WIFI è¿æ¥ä¿¡æ¯ wpa_cli -i wlan0 save_config è¿æ¥å·²æœ‰çš„è¿æ¥ wpa_cli -i wlan0 list_network // åˆ—ä¸¾æ‰€æœ‰ä¿å­˜çš„è¿æ¥wpa_cli -i wlan0 select_network 0 // è¿æ¥ç¬¬1ä¸ªä¿å­˜çš„è¿æ¥wpa_cli -i wlan0 enable_network 0 // ä½¿èƒ½ç¬¬1ä¸ªä¿å­˜çš„è¿æ¥ å…³é—­ WiFi 5. éŸ³è§†é¢‘æ’­æ”¾# æ’­æ”¾ wavaplay test.wavgstwavplay.sh test.wav# æ’­æ”¾ mp3mp3play.sh test.mp3gstmp3play.sh test.mp3# æ’­æ”¾ mp4gstmp4play.sh test.mp4gstvideoplay.sh test.mp4 6. SSHå®˜æ–¹å‘å¸ƒçš„ SDK é»˜è®¤å·²å¼€å¯ sshï¼Œç”¨æˆ·ä¸ºâ€rootâ€ï¼Œå¯†ç ä¸ºâ€fireflyâ€ã€‚å¦‚æœä¸éœ€è¦ä¿®æ”¹ç”¨æˆ·ç™»å½•å¯†ç ï¼Œå¯ä»¥è·³è¿‡æ­¤ç« èŠ‚ã€‚ 6.1. ä¿®æ”¹æ–¹æ³• ä½¿èƒ½ SSH ç›¸å…³é€‰é¡¹ openssh é…ç½®ç™»å½•çš„è´¦æˆ· root å’Œå¯†ç  BR2_TARGET_ENABLE_ROOT_LOGIN=yBR2_TARGET_GENERIC_ROOT_PASSWD=firefly ä¿®æ”¹é…ç½®æ–‡ä»¶ ä¿®æ”¹æ¿å¡é‡Œ /etc/ssh/sshd_config æ–‡ä»¶ 7. å¤–éƒ¨å­˜å‚¨è®¾å¤‡Buildroot æ”¯æŒè‡ªåŠ¨æŒ‚è½½å¤–éƒ¨å­˜å‚¨è®¾å¤‡ï¼š U ç›˜æŒ‚è½½è·¯å¾„ï¼š/udisk TF å¡æŒ‚è½½è·¯å¾„ï¼š/sdcard 8. æ¢å¤å‡ºå‚è®¾ç½®æ³¨æ„ï¼šæ­¤å‡ºå‚è®¾ç½®è¡¨ç¤ºæ¢å¤ä¸ºè®¾å¤‡æœ€åä¸€æ¬¡å‡çº§å›ºä»¶ä¹‹åçš„åˆå§‹çŠ¶æ€ã€‚ 8.1. æ–¹æ³• 1é€šè¿‡ qsetting QT åº”ç”¨è¿›è¡Œé…ç½®ï¼Œç‚¹å‡» â€œFactory Resetâ€ åŠŸèƒ½é€‰é¡¹è¿›è¡Œæ“ä½œã€‚ 8.2. æ–¹æ³• 2é€šè¿‡ update å‘½ä»¤ update# æˆ–è€…update factory / update reset 9. å›ºä»¶æœ¬åœ°å‡çº§Buildroot æ”¯æŒä»å¤–éƒ¨å­˜å‚¨è®¾å¤‡å‡çº§å›ºä»¶ï¼Œä»¥ä¸‹æ˜¯å‡çº§æµç¨‹è¯´æ˜ã€‚å…³äºå¦‚ä½•ç¼–è¯‘ Buildroot å›ºä»¶è¯·ç”¨æˆ·å‚è€ƒç›¸åº”æ¿å¡ç»´åŸºçš„ç¼–è¯‘ Buildroot å›ºä»¶é¡µé¢ã€‚ 9.1. åˆ¶ä½œå‡çº§å›ºä»¶æŒ‰ç…§æ­£å¸¸çš„å›ºä»¶ç¼–è¯‘æµç¨‹ï¼Œåˆ¶ä½œç”¨äºå‡çº§çš„å›ºä»¶ã€‚ å‡çº§å›ºä»¶ä¸ä¸€å®šè¦å…¨åˆ†åŒºå‡çº§ï¼Œå¯ä¿®æ”¹ package-file æ–‡ä»¶ï¼Œå°†ä¸è¦å‡çº§çš„åˆ†åŒºæ³¨é‡Šæ‰ï¼Œæˆ–è€…æ”¹ä¸º RESERVED ï¼ˆ1ï¼‰ä¿®æ”¹æ–‡ä»¶ tools/linux/Linux_Pack_Firmware/rockdev/package-file ä¾‹å¦‚ï¼Œå°† rootfs çš„ç›¸å¯¹è·¯å¾„æ”¹ä¸º RESERVEDï¼Œè¿™æ ·å°±ä¸ä¼šæ‰“åŒ…æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œå³ä¸å‡çº§æ ¹æ–‡ä»¶ç³»ç»Ÿåˆ†åŒºã€‚ # name relative path##hwdef hwdefpackage-file package-filebootloader image/miniloaderall.binparameter image/parameter.txttrust image/trust.imguboot image/uboot.imgmisc image/misc.imgboot image/boot.imgrecovery image/recovery.imgrootfs RESERVEDoem image/oem.imguserdata:grow image/userdata.imgbackup RESERVED ï¼ˆ2ï¼‰ç¼–è¯‘å›ºä»¶ å°†åˆ¶ä½œå¥½çš„å‡çº§å›ºä»¶æ‹·è´åˆ° U ç›˜ã€TF å¡æˆ–è€…è®¾å¤‡çš„ /userdata/ ç›®å½•ä¸‹ï¼Œé‡å‘½åä¸º update.imgã€‚ æ³¨æ„ï¼š è‹¥å°†å‡çº§å›ºä»¶æ”¾è‡³è®¾å¤‡çš„ /userdata/ ç›®å½•ï¼Œåˆ™ä¸è¦æ‰“åŒ… userdata.imgï¼Œå°† image/userdata.img æ”¹ä¸º RESERVEDã€‚ 9.2. å‡çº§è¿‡ç¨‹9.2.1. æ–¹æ³• 1é€šè¿‡ qsetting QT åº”ç”¨è¿›è¡Œé…ç½®ã€‚ç‚¹å‡» â€œUpdateâ€ åŠŸèƒ½é€‰é¡¹è¿›è¡Œæ“ä½œã€‚ 9.2.2. æ–¹æ³• 2é€šè¿‡ update å‘½ä»¤ã€‚ # U ç›˜update ota /udisk/update.img# TF å¡update ota /sdcard/update.img# /userdata/update ota /userdata/update.img ç­‰å¾…å‡çº§å®Œæˆï¼Œå‡çº§æˆåŠŸåï¼Œè®¾å¤‡ä¼šé‡æ–°å¯åŠ¨è¿›å…¥ç³»ç»Ÿã€‚ 10. Weston é…ç½®ä»¬å¯ä»¥é€šè¿‡é…ç½® Weston å¯¹æ˜¾ç¤ºè¿›è¡Œä¸€äº›è‡ªå®šä¹‰è®¾ç½®ï¼Œä¸‹æ–‡å¯¹éƒ¨åˆ†è®¾ç½®è¿›è¡Œè¯´æ˜ã€‚ 10.1. çŠ¶æ€æ è®¾ç½®Weston æ”¯æŒåœ¨ weston.ini é…ç½®æ–‡ä»¶çš„ shell æ®µè®¾ç½®çŠ¶æ€æ çš„èƒŒæ™¯è‰²ã€ä½ç½®ï¼Œä»¥åŠåœ¨ launcher æ®µè®¾ç½®å¿«æ·å¯åŠ¨ç¨‹åºï¼Œå¦‚ï¼š # /etc/xdg/weston/weston.ini[shell]# é¢œè‰²æ ¼å¼ä¸º ARGB8888panel-color=0xff002244# top|bottom|left|right|nonepanel-position=bottom[launcher]icon=/usr/share/weston/terminal.pngpath=/usr/bin/weston-terminal[launcher]# å›¾æ ‡è·¯å¾„icon=/usr/share/weston/icon_flower.png# å¿«æ·å¯åŠ¨å‘½ä»¤path=/usr/bin/qsetting 10.2. èƒŒæ™¯è®¾ç½®Weston æ”¯æŒåœ¨ weston.ini é…ç½®æ–‡ä»¶çš„ shell æ®µè®¾ç½®èƒŒæ™¯å›¾æ¡ˆã€é¢œè‰²ï¼Œå¦‚ï¼š # /etc/xdg/weston/weston.ini[shell]# èƒŒæ™¯å›¾æ¡ˆ(å£çº¸)ç»å¯¹è·¯å¾„background-image=/usr/share/weston/background.png# scale|scale-crop|tilebackground-type=scale# é¢œè‰²æ ¼å¼ä¸º ARGB8888ï¼Œæœªè®¾ç½®èƒŒæ™¯å›¾æ¡ˆæ—¶ç”Ÿæ•ˆbackground-color=0xff002244 10.3. å¾…æœºåŠé”å±é…ç½®Weston çš„è¶…æ—¶å¾…æœºæ—¶é•¿å¯ä»¥åœ¨å¯åŠ¨å‚æ•°ä¸­é…ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨ weston.ini çš„ core æ®µé…ç½®ï¼Œå¦‚ï¼š # /etc/init.d/S50launcher start) ... # 0 ä¸ºç¦æ­¢å¾…æœºï¼Œå•ä½ä¸ºç§’ weston --tty=2 -B=drm-backend.so --idle-time=0 æˆ–è€…ï¼š # /etc/xdg/weston/weston.ini[core]# è®¾ç½® 5 ç§’æœªæ“ä½œåè¿›å…¥å¾…æœºçŠ¶æ€idle-time=5 10.4. æ˜¾ç¤ºé¢œè‰²æ ¼å¼é…ç½®Buildroot SDK å†… Weston ç›®å‰é»˜è®¤æ˜¾ç¤ºæ ¼å¼ä¸º ARGB8888ï¼Œå¯¹äºæŸäº›ä½æ€§èƒ½å¹³å°ï¼Œå¯ä»¥åœ¨ weston.ini çš„ core æ®µé…ç½®ä¸º RGB565ï¼Œå¦‚ï¼š # /etc/xdg/weston/weston.ini[core]# xrgb8888|rgb565|xrgb2101010gbm-format=rgb565 ä¹Ÿå¯ä»¥åœ¨ weston.ini çš„ output æ®µå•ç‹¬é…ç½®æ¯ä¸ªå±å¹•çš„æ˜¾ç¤ºæ ¼å¼ï¼Œå¦‚ï¼š # /etc/xdg/weston/weston.ini[output]# output çš„ name å¯ä»¥æŸ¥çœ‹ /sys/class/drm/card0-namename=LVDS-1# xrgb8888|rgb565|xrgb2101010gbm-format=rgb565 10.5. å±å¹•æ–¹å‘è®¾ç½®Weston çš„å±å¹•æ˜¾ç¤ºæ–¹å‘å¯ä»¥åœ¨ weston.ini çš„ output æ®µé…ç½®ï¼Œå¦‚ï¼š # /etc/xdg/weston/weston.ini[output]name=LVDS-1# normal|90|180|270|flipped|flipped-90|flipped-180|flipped-270transform=180 å¦‚æœéœ€è¦åŠ¨æ€é…ç½®å±å¹•æ–¹å‘ï¼Œå¯ä»¥é€šè¿‡åŠ¨æ€é…ç½®æ–‡ä»¶ï¼Œå¦‚ï¼š echo output:all:rotate90 /tmp/.weston_drm.conf # æ‰€æœ‰å±å¹•æ—‹è½¬ 90 åº¦echo output:eDP-1:rotate180 /tmp/.weston_drm.conf # eDP-1 æ—‹è½¬ 180 åº¦ 10.6. åˆ†è¾¨ç‡åŠç¼©æ”¾é…ç½®Weston çš„å±å¹•åˆ†è¾¨ç‡åŠç¼©æ”¾å¯ä»¥åœ¨ weston.ini çš„ output æ®µé…ç½®ï¼Œå¦‚ï¼š # /etc/xdg/weston/weston.ini[output]name=HDMI-A-1# éœ€ä¸ºå±å¹•æ”¯æŒçš„æœ‰æ•ˆåˆ†è¾¨ç‡mode=1920x1080# éœ€ä¸ºæ•´æ•°å€æ•°scale=2 å¦‚æœéœ€è¦åŠ¨æ€é…ç½®åˆ†è¾¨ç‡åŠç¼©æ”¾ï¼Œå¯ä»¥é€šè¿‡åŠ¨æ€é…ç½®æ–‡ä»¶ï¼Œå¦‚ï¼š echo output:HDMI-A-1:mode=800x600 /tmp/.weston_drm.conf # ä¿®æ”¹ HDMI-A-1 åˆ†è¾¨ç‡ä¸º800x600 è¿™ç§æ–¹å¼ç¼©æ”¾æ—¶éœ€è¦ä¾èµ– RGA åŠ é€Ÿã€‚ 10.7. å†»ç»“å±å¹•åœ¨å¯åŠ¨ Weston æ—¶ï¼Œå¼€æœº logo åˆ° UI æ˜¾ç¤ºä¹‹é—´å­˜åœ¨çŸ­æš‚åˆ‡æ¢é»‘å±ã€‚å¦‚éœ€è¦é˜²æ­¢é»‘å±ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ç§åŠ¨æ€é…ç½®æ–‡ä»¶æ–¹å¼çŸ­æš‚å†»ç»“ Weston å±å¹•å†…å®¹ï¼š # /etc/init.d/S50launcher start) ... export WESTON_FREEZE_DISPLAY=/tmp/.weston_freeze # è®¾ç½®ç‰¹æ®Šé…ç½®æ–‡ä»¶è·¯å¾„ touch /tmp/.weston_freeze # å†»ç»“æ˜¾ç¤º weston --tty=2 -B=drm-backend.so --idle-time=0 ... sleep 1 rm /tmp/.weston_freeze # 1 ç§’åè§£å†» 10.8. å¤šå±é…ç½®Buildroot SDK çš„ Weston æ”¯æŒå¤šå±åŒå¼‚æ˜¾åŠçƒ­æ‹”æ’ç­‰åŠŸèƒ½ï¼Œä¸åŒæ˜¾ç¤ºå™¨å±å¹•çš„åŒºåˆ†æ ¹æ® drm çš„ name (é€šè¿‡ sysclassdrmcard0-name è·å–)ï¼Œç›¸å…³é…ç½®é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®ï¼Œå¦‚ï¼š # /etc/init.d/S50launcher start) ... export WESTON_DRM_PRIMARY=HDMI-A-1 # æŒ‡å®šä¸»æ˜¾ä¸º HDMI-A-1 export WESTON_DRM_MIRROR=1 # ä½¿ç”¨é•œåƒæ¨¡å¼(å¤šå±åŒæ˜¾)ï¼Œä¸è®¾ç½®æ­¤ç¯å¢ƒå˜é‡å³ä¸ºå¼‚æ˜¾ export WESTON_DRM_KEEP_RATIO=1 # é•œåƒæ¨¡å¼ä¸‹ç¼©æ”¾ä¿æŒçºµæ¨ªæ¯”ï¼Œä¸è®¾ç½®æ­¤å˜é‡å³ä¸ºå¼ºåˆ¶å…¨å± export WESTON_DRM_PREFER_EXTERNAL=1 # å¤–ç½®æ˜¾ç¤ºå™¨è¿æ¥æ—¶è‡ªåŠ¨å…³é—­å†…ç½®æ˜¾ç¤ºå™¨ export WESTON_DRM_PREFER_EXTERNAL_DUAL=1 # å¤–ç½®æ˜¾ç¤ºå™¨è¿æ¥æ—¶é»˜è®¤ä»¥ç¬¬ä¸€ä¸ªå¤–æ˜¾ä¸ºä¸»æ˜¾ weston --tty=2 -B=drm-backend.so --idle-time=0 é•œåƒæ¨¡å¼ç¼©æ”¾æ˜¾ç¤ºå†…å®¹æ—¶éœ€è¦ä¾èµ– RGA åŠ é€Ÿã€‚ åŒæ—¶ä¹Ÿæ”¯æŒåœ¨ weston.ini çš„ output æ®µå•ç‹¬ç¦ç”¨æŒ‡å®šå±å¹•ï¼š # /etc/xdg/weston/weston.ini[output]name=LVDS-1mode=off# off|current|preferred|WIDTHxHEIGHT@RATE 10.9. è¾“å…¥è®¾å¤‡ç›¸å…³é…ç½®Weston æœåŠ¡é»˜è®¤éœ€è¦è‡³å°‘ä¸€ä¸ªè¾“å…¥è®¾å¤‡ï¼Œå¦‚æ— è¾“å…¥è®¾å¤‡ï¼Œåˆ™éœ€è¦åœ¨ weston.ini ä¸­çš„ core æ®µç‰¹æ®Šè®¾ç½®ï¼š # /etc/xdg/weston/weston.ini[core]require-input=false 11. Buildroot å¼€å‘Buildroot æ˜¯ Linux å¹³å°ä¸Šä¸€ä¸ªæ„å»ºåµŒå…¥å¼ Linux ç³»ç»Ÿçš„æ¡†æ¶ã€‚æ•´ä¸ª Buildroot æ˜¯ç”± Makefile(*.mk) è„šæœ¬å’Œ Kconfig(Config.in) é…ç½®æ–‡ä»¶æ„æˆçš„ã€‚å¯ä»¥å’Œç¼–è¯‘ Linux å†…æ ¸ä¸€æ ·ï¼Œé€šè¿‡ buildroot é…ç½®ï¼Œmenuconfig ä¿®æ”¹ï¼Œç¼–è¯‘å‡ºä¸€ä¸ªå®Œæ•´çš„å¯ä»¥ç›´æ¥çƒ§å†™åˆ°æœºå™¨ä¸Šè¿è¡Œçš„ Linux ç³»ç»Ÿè½¯ä»¶ï¼ˆåŒ…å« bootã€kernelã€rootfs ä»¥åŠ rootfs ä¸­çš„å„ç§åº“å’Œåº”ç”¨ç¨‹åºï¼‰ã€‚è‹¥è¦äº†è§£æ›´å¤š Buildroot å¼€å‘ç›¸å…³å†…å®¹ï¼Œå¯ä»¥å‚è€ƒ Buildroot å®˜æ–¹çš„ ã€Šå¼€å‘æ‰‹å†Œã€‹ã€‚ ä¸‹é¢ä»¥ RK356x å¹³å°çš„ Buildroot å¼€å‘ä¸ºä¾‹è¿›è¡Œé˜è¿°ã€‚ 11.1. ç›®å½•ç»“æ„Buildroot SDK ä½äº Firefly_Linux_SDK ç›®å½•ï¼Œå…¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š buildroot/â”œâ”€â”€ arch # CPU æ¶æ„çš„æ„å»ºã€é…ç½®æ–‡ä»¶â”œâ”€â”€ board # å…·ä½“å•æ¿ç›¸å…³çš„æ–‡ä»¶â”œâ”€â”€ boot # Bootloaders çš„æ„å»ºã€é…ç½®æ–‡ä»¶â”œâ”€â”€ buildâ”œâ”€â”€ CHANGES # Buildroot ä¿®æ”¹æ—¥å¿—â”œâ”€â”€ Config.inâ”œâ”€â”€ Config.in.legacyâ”œâ”€â”€ configs # å…·ä½“å•æ¿çš„ Buildroot é…ç½®æ–‡ä»¶â”œâ”€â”€ COPYINGâ”œâ”€â”€ DEVELOPERSâ”œâ”€â”€ dl # ä¸‹è½½çš„ç¨‹åºã€æºç å‹ç¼©åŒ…ã€è¡¥ä¸ç­‰â”œâ”€â”€ docs # æ–‡æ¡£â”œâ”€â”€ fs # å„ç§æ–‡ä»¶ç³»ç»Ÿçš„æ„å»ºã€é…ç½®æ–‡ä»¶â”œâ”€â”€ linux # Linux çš„æ„å»ºã€é…ç½®æ–‡ä»¶â”œâ”€â”€ Makefileâ”œâ”€â”€ Makefile.legacyâ”œâ”€â”€ output # ç¼–è¯‘è¾“å‡ºç›®å½•â”œâ”€â”€ package # æ‰€æœ‰è½¯ä»¶åŒ…çš„æ„å»ºã€é…ç½®æ–‡ä»¶â”œâ”€â”€ README # Buildroot ç®€å•è¯´æ˜â”œâ”€â”€ support # ä¸º Bulidroot æä¾›åŠŸèƒ½æ”¯æŒçš„è„šæœ¬ã€é…ç½®æ–‡ä»¶â”œâ”€â”€ system # åˆ¶ä½œæ ¹æ–‡ä»¶ç³»ç»Ÿçš„æ„å»ºã€é…ç½®æ–‡ä»¶â”œâ”€â”€ toolchain # äº¤å‰ç¼–è¯‘å·¥å…·é“¾çš„æ„å»ºã€é…ç½®æ–‡ä»¶â””â”€â”€ utils # å®ç”¨å·¥å…· 11.2. é…ç½®é€‰æ‹©é»˜è®¤é…ç½®æ–‡ä»¶ï¼š # è¿›å…¥ Firefly_Linux_SDK æ ¹ç›®å½•cd path/to/Firefly_Linux_SDK/# é€‰æ‹©é…ç½®æ–‡ä»¶# \\`configs/rockchip_rk3568_defconfig\\`source envsetup.sh rockchip_rk3568 æ‰§è¡Œå®Œæˆåä¼šç”Ÿæˆç¼–è¯‘è¾“å‡ºç›®å½•ï¼Œoutput/rockchip_rk3568ï¼Œåç»­ä¹Ÿå¯ä»¥åœ¨è¯¥ç›®å½•ä¸‹æ‰§è¡Œ make ç›¸å…³æ“ä½œã€‚ 11.2.1. è½¯ä»¶åŒ…é…ç½®æ‰“å¼€é…ç½®ç•Œé¢ï¼š ä»¬å¯ä»¥åœ¨é…ç½®ç•Œé¢æ·»åŠ æˆ–è£å‰ªä¸€äº›å·¥å…·ï¼ŒæŒ‰éœ€æ±‚å®šåˆ¶ç³»ç»ŸåŠŸèƒ½ã€‚ä»¥æ·»åŠ  qt53d ä¸ºä¾‹ï¼š è¾“å…¥ / è¿›å…¥æœç´¢ç•Œé¢ï¼Œè¾“å…¥è¦æŸ¥æ‰¾çš„å†…å®¹ qt53dï¼ŒæŒ‰å›è½¦è¿›è¡Œæœç´¢ï¼š é€‰æ‹© 1 è·³è½¬åˆ°å¯¹åº”é¡µé¢ï¼ŒæŒ‰ç©ºæ ¼é€‰ä¸­é…ç½®ï¼š é…ç½®å®Œæˆåï¼Œç§»åŠ¨åˆ° Save æŒ‰å›è½¦ä¿å­˜åˆ° .configï¼›ç§»åŠ¨åˆ° Exit æŒ‰å›è½¦é€€å‡ºã€‚ ä¿å­˜é…ç½®æ–‡ä»¶ï¼š å°†ä¿®æ”¹ä¿å­˜åˆ°é…ç½®æ–‡ä»¶ configs/rockchip_rk3568_defconfigã€‚ 11.2.2. Busybox é…ç½®æ‰“å¼€é…ç½®ç•Œé¢ï¼Œè¿›è¡Œé…ç½®ï¼š é…ç½®å®Œæˆåï¼Œç§»åŠ¨åˆ° Exit æŒ‰å›è½¦é€€å‡ºï¼Œåœ¨å¼¹çª—é¡µé¢é€‰æ‹© Yes ä¿å­˜åˆ° .configã€‚ ä¿å­˜é…ç½®æ–‡ä»¶ï¼š make busybox-update-config å°†ä¿®æ”¹ä¿å­˜åˆ°é…ç½®æ–‡ä»¶ board/rockchip/common/base/busybox.configã€‚ 11.3. ç¼–è¯‘é…ç½®å¥½ Buildroot åï¼Œç›´æ¥è¿è¡Œ make è¿›è¡Œç¼–è¯‘ã€‚ 11.3.1. ç¼–è¯‘è¯´æ˜è¿è¡Œ make è¿›è¡Œç¼–è¯‘æ—¶ï¼Œä¼šæ‰§è¡Œä»¥ä¸‹è¿‡ç¨‹ï¼š ä¸‹è½½æºç ï¼› é…ç½®ã€ç¼–è¯‘ã€å®‰è£…äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼› é…ç½®ã€ç¼–è¯‘ã€å®‰è£…é€‰æ‹©çš„è½¯ä»¶åŒ…ï¼› æŒ‰é€‰æ‹©çš„æ ¼å¼ç”Ÿæˆæ ¹æ–‡ä»¶ç³»ç»Ÿï¼› å…³äº make çš„æ›´å¤šç”¨æ³•ï¼Œå¯é€šè¿‡ make help è·å¾—ã€‚ 11.3.2. ç¼–è¯‘è½¯ä»¶åŒ…ä»¬å¯ä»¥æ‰§è¡Œ make package å•ç‹¬ç¼–è¯‘æŸä¸ªè½¯ä»¶åŒ…ã€‚è½¯ä»¶åŒ…çš„ç¼–è¯‘ä¸»è¦åŒ…æ‹¬ä¸‹è½½ï¼Œè§£å‹ï¼Œæ‰“è¡¥ä¸ï¼Œé…ç½®ï¼Œç¼–è¯‘ï¼Œå®‰è£…ç­‰è¿‡ç¨‹ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹ package/pkg-generic.mkã€‚ ä¸‹è½½ Buildroot ä¼šæ ¹æ®é…ç½® package/package/package.mkï¼Œè‡ªåŠ¨ä»ç½‘ç»œè·å–å¯¹åº”çš„è½¯ä»¶åŒ…ï¼ŒåŒ…æ‹¬ä¸€äº›ç¬¬ä¸‰æ–¹åº“ï¼Œæ’ä»¶ï¼Œå®ç”¨å·¥å…·ç­‰ï¼Œæ”¾åœ¨ dl/ ç›®å½•ã€‚ è§£å‹ è½¯ä»¶åŒ…ä¼šè§£å‹åœ¨ output/rockchip_rk3568/build/package-version ç›®å½•ä¸‹ã€‚ æ‰“è¡¥ä¸ è¡¥ä¸é›†ä¸­æ”¾åœ¨ package/packgae/ ç›®å½•ï¼ŒBuildroot ä¼šåœ¨è§£å‹è½¯ä»¶åŒ…åä¸ºå…¶æ‰“ä¸Šç›¸åº”çš„è¡¥ä¸ã€‚å¦‚æœè¦ä¿®æ”¹æºç ï¼Œå¯ä»¥é€šè¿‡æ‰“è¡¥ä¸çš„æ–¹å¼è¿›è¡Œä¿®æ”¹ã€‚ é…ç½® ç¼–è¯‘ å®‰è£… ç¼–è¯‘å®Œæˆåï¼Œä¼šå°†éœ€è¦çš„ç¼–è¯‘ç”Ÿæˆæ–‡ä»¶æ‹·è´åˆ° output/rockchip_rk3568/target/ ç›®å½•ã€‚ å¯¹äºæŸä¸ªè½¯ä»¶åŒ…ï¼Œä»¬å¯ä»¥é€šè¿‡ make package-target è°ƒç”¨è½¯ä»¶åŒ…æ„å»ºä¸­çš„æŸä¸€æ­¥éª¤ï¼Œå¦‚ä¸‹ï¼š Package-specific: pkg - Build and install pkg and all its dependencies pkg-source - Only download the source files for pkg pkg-extract - Extract pkg sources pkg-patch - Apply patches to pkg pkg-depends - Build pkgs dependencies pkg-configure - Build pkg up to the configure step pkg-build - Build pkg up to the build step pkg-graph-depends - Generate a graph of pkgs dependencies pkg-dirclean - Remove pkg build directory pkg-reconfigure - Restart the build from the configure step pkg-rebuild - Restart the build from the build step 11.4. ç¼–è¯‘è¾“å‡ºç›®å½•ç¼–è¯‘å®Œæˆåï¼Œåœ¨ç¼–è¯‘è¾“å‡ºç›®å½• output/rockchip_rk3568 ä¼šç”Ÿæˆå­ç›®å½•ï¼Œè¯´æ˜å¦‚ä¸‹ï¼š build/ åŒ…å«æ‰€æœ‰çš„æºæ–‡ä»¶ï¼ŒåŒ…æ‹¬ Buildroot æ‰€éœ€ä¸»æœºå·¥å…·å’Œé€‰æ‹©çš„è½¯ä»¶åŒ…ï¼Œè¿™ä¸ªç›®å½•åŒ…å«æ‰€æœ‰è½¯ä»¶åŒ…æºç ã€‚ host/ ä¸»æœºç«¯ç¼–è¯‘éœ€è¦çš„å·¥å…·ï¼ŒåŒ…æ‹¬äº¤å‰ç¼–è¯‘å·¥å…·ã€‚ images/ åŒ…å«å‹ç¼©å¥½çš„æ ¹æ–‡ä»¶ç³»ç»Ÿé•œåƒæ–‡ä»¶ã€‚ staging/ è¿™ä¸ªç›®å½•ç±»ä¼¼æ ¹æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç»“æ„ï¼ŒåŒ…å«ç¼–è¯‘ç”Ÿæˆçš„æ‰€æœ‰å¤´æ–‡ä»¶å’Œåº“ï¼Œä»¥åŠå…¶ä»–å¼€å‘æ–‡ä»¶ï¼Œä¸è¿‡å®ƒä»¬æ²¡æœ‰è£å‰ªï¼Œæ¯”è¾ƒåºå¤§ï¼Œä¸é€‚ç”¨äºç›®æ ‡æ–‡ä»¶ç³»ç»Ÿã€‚ target/ åŒ…å«å®Œæ•´çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œå¯¹æ¯” staging/ï¼Œå®ƒæ²¡æœ‰å¼€å‘æ–‡ä»¶ï¼Œä¸åŒ…å«å¤´æ–‡ä»¶ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¹Ÿç»è¿‡ strip å¤„ç†ã€‚ 11.5. äº¤å‰ç¼–è¯‘å·¥å…·Buildroot ç¼–è¯‘å®Œæˆåï¼Œä¼šåœ¨ output/rockchip_rk3568/host/ ç›®å½•ä¸‹ï¼Œç”Ÿæˆäº¤å‰ç¼–è¯‘å·¥å…·ï¼Œä»¬å¯ä»¥ç”¨æ¥ç¼–è¯‘ç›®æ ‡ç¨‹åºã€‚ äº¤å‰ç¼–è¯‘å·¥å…·ç›®å½• output/rockchip_rk3568/host/bin/ ç¼–è¯‘ç¤ºä¾‹ hello.c #include stdio.h#include stdlib.hint main(int argc, char *argv[]) printf(Hello World! ); return 0; ç¼–è¯‘ .../host/bin/arm-buildroot-linux-gnueabihf-gcc hello.c -o hello è¿è¡Œ å°†å¯æ‰§è¡Œç¨‹åº hello æ‹·è´åˆ°è®¾å¤‡ï¼Œè¿è¡Œ ./helloï¼Œåˆ™ä¼šçœ‹åˆ°æ‰“å°ä¿¡æ¯ Hello World!ã€‚ 11.6. é‡å»ºå¯¹äºé‡å»ºçš„å…·ä½“è¯´æ˜ï¼Œå¯ä»¥æŸ¥çœ‹æ–‡æ¡£ buildroot/docs/manual/rebuilding-packages.txtã€‚ 11.6.1. é‡å»ºè½¯ä»¶åŒ…åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè‹¥ä¿®æ”¹äº†æŸä¸ªè½¯ä»¶åŒ…çš„æºç ï¼ŒBuildroot æ˜¯ä¸ä¼šé‡æ–°ç¼–è¯‘è¯¥è½¯ä»¶åŒ…çš„ã€‚å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æ“ä½œï¼š æ–¹å¼ä¸€ æ–¹å¼äºŒ # åˆ é™¤è½¯ä»¶åŒ…çš„ç¼–è¯‘è¾“å‡ºç›®å½•rm -rf output/rockchip_rk3568/build/package-version# ç¼–è¯‘make package 11.6.2. å®Œå…¨é‡å»ºå½“é€šè¿‡ make menuconfigï¼Œmake xconfig æˆ–å…¶ä»–é…ç½®å·¥å…·ä¹‹ä¸€æ›´æ”¹ç³»ç»Ÿé…ç½®æ—¶ï¼ŒBuildroot ä¸ä¼šå°è¯•æ£€æµ‹åº”é‡å»ºç³»ç»Ÿçš„å“ªäº›éƒ¨åˆ†ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒBuildroot åº”è¯¥é‡å»ºæ•´ä¸ªç³»ç»Ÿï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä»…åº”é‡å»ºè½¯ä»¶åŒ…çš„ç‰¹å®šå­é›†ã€‚ä½†æ˜¯ä»¥å®Œå…¨å¯é çš„æ–¹å¼æ£€æµ‹åˆ°è¿™ä¸€ç‚¹éå¸¸å›°éš¾ï¼Œå› æ­¤ Buildroot å¼€å‘äººå‘˜å·²å†³å®šä¸å°è¯•è¿™æ ·åšã€‚ 11.6.2.1. ä½•æ—¶éœ€è¦å®Œå…¨é‡å»º æ›´æ”¹ç›®æ ‡ä½“ç³»ç»“æ„é…ç½®æ—¶ï¼Œéœ€è¦å®Œå…¨é‡å»ºï¼› æ›´æ”¹å·¥å…·é“¾é…ç½®æ—¶ï¼Œéœ€è¦å®Œå…¨é‡å»ºï¼› å°†å…¶ä»–è½¯ä»¶åŒ…æ·»åŠ åˆ°é…ç½®ä¸­æ—¶ï¼Œä¸ä¸€å®šéœ€è¦å®Œå…¨é‡å»ºï¼› ä»é…ç½®ä¸­åˆ é™¤è½¯ä»¶åŒ…æ—¶ï¼ŒBuildroot ä¸ä¼šæ‰§è¡Œä»»ä½•ç‰¹æ®Šæ“ä½œã€‚å®ƒä¸ä¼šä»ç›®æ ‡æ ¹æ–‡ä»¶ç³»ç»Ÿæˆ–å·¥å…·é“¾ä¸­åˆ é™¤æ­¤è½¯ä»¶åŒ…å®‰è£…çš„æ–‡ä»¶ã€‚éœ€è¦å®Œå…¨é‡å»ºæ‰èƒ½åˆ é™¤è¿™äº›æ–‡ä»¶ï¼› æ›´æ”¹è½¯ä»¶åŒ…çš„å­é€‰é¡¹æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨é‡å»ºè½¯ä»¶åŒ…ï¼› å¯¹æ ¹æ–‡ä»¶ç³»ç»Ÿæ¡†æ¶è¿›è¡Œæ›´æ”¹æ—¶ï¼Œéœ€è¦å®Œå…¨é‡å»ºï¼› ä¸€èˆ¬è€Œè¨€ï¼Œå½“é‡åˆ°æ„å»ºé”™è¯¯å¹¶ä¸”ä¸ç¡®å®šæ‰€åšçš„é…ç½®æ›´æ”¹å¯èƒ½å¸¦æ¥çš„åæœæ—¶ï¼Œè¯·è¿›è¡Œå®Œå…¨é‡å»ºã€‚å…·ä½“è¯´æ˜å¯ä»¥æŸ¥çœ‹æ–‡æ¡£ rebuilding-packages.txtã€‚ 11.6.2.2. å¦‚ä½•å®Œå…¨é‡å»º æ–¹å¼ä¸€ ç›´æ¥åˆ é™¤ç¼–è¯‘è¾“å‡ºç›®å½•ï¼Œä¹‹åé‡æ–°è¿›è¡Œé…ç½®ã€ç¼–è¯‘ã€‚ æ–¹å¼äºŒ æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œä¼šåˆ é™¤ç¼–è¯‘è¾“å‡ºå¹¶é‡æ–°ç¼–è¯‘ã€‚ 11.7. æ–°å¢æœ¬åœ°æºç åŒ…å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒBuildroot è‡ªå¸¦çš„è½¯ä»¶åŒ…æœ‰æ—¶å¯èƒ½æ— æ³•æ»¡è¶³ä»¬çš„éœ€æ±‚ï¼Œä¸ºæ­¤ä»¬éœ€è¦æ·»åŠ è‡ªå®šä¹‰çš„è½¯ä»¶åŒ…ã€‚Buildroot æ”¯æŒå¤šç§æ ¼å¼çš„è½¯ä»¶åŒ…ï¼ŒåŒ…æ‹¬ generic-packageã€cmake-packageã€autotools-package ç­‰ï¼Œä»¬ä»¥ generic-package ä¸¾ä¾‹è¯´æ˜ã€‚ åˆ›å»ºå·¥ç¨‹ç›®å½• cd path/to/Firefly_Linux_SDK/mkdir buildroot/package/rockchip/firefly_demo/ æ–°å»º Config.in åœ¨ firefly_demo/ ä¸‹æ·»åŠ  Config.inï¼š config BR2_PACKAGE_FIREFLY_DEMO bool Simple Firefly Demo æ–°å»º firefly_demo.mk åœ¨ firefly_demo/ ä¸‹æ·»åŠ  firefly_demo.mkï¼š ################################################################# firefly_demo##############################################################ifeq ($(BR2_PACKAGE_FIREFLY_DEMO), y) FIREFLY_DEMO_VERSION:=1.0.0 FIREFLY_DEMO_SITE=$(TOPDIR)/../external/firefly_demo/src FIREFLY_DEMO_SITE_METHOD=localdefine FIREFLY_DEMO_BUILD_CMDS $(TARGET_MAKE_ENV) $(MAKE) CC=$(TARGET_CC) CXX=$(TARGET_CXX) -C $(@D)endefdefine FIREFLY_DEMO_CLEAN_CMDS $(TARGET_MAKE_ENV) $(MAKE) -C $(@D) cleanendefdefine FIREFLY_DEMO_INSTALL_TARGET_CMDS $(TARGET_MAKE_ENV) $(MAKE) -C $(@D) installendefdefine FIREFLY_DEMO_UNINSTALL_TARGET_CMDS $(TARGET_MAKE_ENV) $(MAKE) -C $(@D) uninstallendef$(eval $(generic-package))endif åˆ›å»ºæºç ç›®å½• ä¸Šæ–‡çš„ Makefile æ–‡ä»¶é‡Œå·²ç»æŒ‡å®šäº†æºç ç›®å½• external/firefly_demo/srcã€‚ cd path/to/Firefly_Linux_SDK/mkdir external/firefly_demo/src ç¼–å†™æºç  firefly_demo.c åœ¨ firefly_demo/src/ ä¸‹æ·»åŠ  firefly_demo.cï¼š #include stdio.h#include stdlib.hint main(int argc, char *argv[]) printf(Hello World! ); return 0; ç¼–å†™ Makefile åœ¨ firefly_demo/src/ ä¸‹æ·»åŠ  Makefileï¼š DEPS =OBJ = firefly_demo.oCFLAGS =%.o: %.c $(DEPS) $(CC) -c -o $@ $ $(CFLAGS)firefly_demo: $(OBJ) $(CXX) -o $@ $^ $(CFLAGS).PHONY: cleanclean: rm -f *.o *~ firefly_demo.PHONY: installinstall: cp -f firefly_demo $(TARGET_DIR)/usr/bin/.PHONY: uninstalluninstall: rm -f $(TARGET_DIR)/usr/bin/firefly_demo ä¿®æ”¹ä¸Šä¸€çº§ Config.in åœ¨ buildroot/package/rockchip/Config.in æœ«å°¾æ·»åŠ ä¸€è¡Œï¼š source package/rockchip/firefly_demo/Config.in é…ç½®è½¯ä»¶åŒ… æ‰“å¼€é…ç½®èœå• make menuconfigï¼Œæ‰¾åˆ° firefly_demo å¹¶é€‰ä¸­é…ç½®ã€‚ ç¼–è¯‘ # ç¼–è¯‘ firefly_demomake firefly_demo# æ‰“åŒ…è¿›æ ¹æ–‡ä»¶ç³»ç»Ÿmake# è‹¥ä¿®æ”¹æºç ï¼Œé‡æ–°ç¼–è¯‘è½¯ä»¶åŒ…make firefly_demo-rebuild 11.8. rootfs-overlayrootfs-overly æ˜¯ä¸€ä¸ªç›¸å½“ä¸é”™çš„åŠŸèƒ½ï¼Œå®ƒèƒ½å¤Ÿåœ¨ç›®æ ‡æ–‡ä»¶ç³»ç»Ÿç¼–è¯‘å®Œæˆåå°†æŒ‡å®šæ–‡ä»¶è¦†ç›–åˆ°æŸä¸ªç›®å½•ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä»¬å¯ä»¥æ–¹ä¾¿åœ°æ·»åŠ æˆ–ä¿®æ”¹ä¸€äº›æ–‡ä»¶åˆ°æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚ å‡è®¾ä»¬è¦åœ¨æ ¹æ–‡ä»¶ç³»ç»Ÿçš„ /etc/ ç›®å½•ä¸‹æ·»åŠ æ–‡ä»¶ overlay-testï¼Œå¯ä»¥æŒ‰å¦‚ä¸‹æ­¥éª¤æ“ä½œï¼š è®¾ç½® rootfs-overlay æ ¹ç›®å½• æ‰“å¼€é…ç½®èœå• make menuconfigï¼Œé€šè¿‡è®¾ç½® BR2_ROOTFS_OVERLAY é€‰é¡¹ï¼Œæ·»åŠ ç”¨äºè¦†ç›–çš„æ ¹ç›®å½•ã€‚å¯¹äº RK3568ï¼Œé»˜è®¤å·²æ·»åŠ äº†ç›®å½• board/rockchip/rk356x/fs-overlay/ã€‚ æ·»åŠ æ–‡ä»¶åˆ°è¦†ç›–ç›®å½• cd buildroot/board/rockchip/rk356x/fs-overlay/mkdir etc/touch etc/overlay-test ç¼–è¯‘ ä¸‹è½½æ ¹æ–‡ä»¶ç³»ç»Ÿ å°†ç¼–è¯‘å¥½çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ output/rockchip_rk3568/images/rootfs.ext2 ä¸‹è½½åˆ°è®¾å¤‡ã€‚å¯åŠ¨è®¾å¤‡ï¼Œå¯ä»¥çœ‹åˆ°å·²æ·»åŠ æ–‡ä»¶ /etc/overlay-testã€‚ ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥çœ‹ target/ ç›®å½•ï¼ŒéªŒè¯æ˜¯å¦æ·»åŠ æˆåŠŸï¼š ls buildroot/output/rockchip_rk3568/target/etc/overlay-test 11.9. Qt äº¤å‰ç¼–è¯‘ç¯å¢ƒæ”¯æŒFirefly æå–äº† Buildroot çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œæ”¯æŒ EGLFSã€LinuxFBã€Wayland ç­‰æ’ä»¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥å·¥å…·é“¾å¼€å‘ Buildroot ä¸Šçš„ Qt åº”ç”¨ç¨‹åºï¼Œè€Œæ— éœ€ä¸‹è½½ç¼–è¯‘ SDK ä»£ç ã€‚ ç‰ˆæœ¬ï¼šQt-5.15.2ä¸»æœºï¼šx86-64 / Ubuntu 18.04è®¾å¤‡ï¼šFirefly RK3568 RK3566 / Buildroot ä¸‹è½½åœ°å€ï¼šBuildroot Qt ç¯å¢ƒéƒ¨ç½²ï¼šè¯¦è§ Qt5.1x.x_Release.md æ–‡ä»¶ã€‚","tags":["clippings"],"categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"åµŒå…¥å¼åˆå§‹é…ç½®","path":"/2024/10/17/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-åµŒå…¥å¼åˆå§‹é…ç½®/","content":"Firefly Linux å¼€å‘æŒ‡å— 1.1. Ubuntu Desktop ç³»ç»ŸUbuntu Desktop ç³»ç»Ÿå¼€æœºå¯åŠ¨åï¼Œè‡ªåŠ¨ç™»å½•åˆ° firefly ç”¨æˆ·ã€‚ å¦‚æœæœ‰è¿æ¥è°ƒè¯•ä¸²å£ï¼Œä¸²å£ç»ˆç«¯è‡ªåŠ¨ç™»å½• root ç”¨æˆ·ã€‚ firefly ç”¨æˆ·å¯†ç ï¼š firefly root ç”¨æˆ·ï¼šé»˜è®¤æ²¡æœ‰è®¾ç½® root å¯†ç ï¼Œfirefly ç”¨æˆ·é€šè¿‡ sudo passwd root å‘½ä»¤è‡ªè¡Œé…ç½® root å¯†ç ã€‚ 1.2. Ubuntu Minimal ç³»ç»Ÿ Ubuntu Minimal ç³»ç»Ÿå¼€æœºå¯åŠ¨åï¼Œè‡ªåŠ¨ç™»å½•åˆ° root ç”¨æˆ·ï¼Œå¯†ç ä¸º fireflyã€‚ ç³»ç»Ÿå·²ç»æ·»åŠ  OpenGL ES, OpenCL, DRM æ”¯æŒã€‚ 1.3. Buildroot ç³»ç»Ÿ ç”¨æˆ·ï¼šroot å¯†ç ï¼šfirefly 2. ADB ä½¿ç”¨2.1. ADBç”¨ Type-C data cable è¿æ¥è®¾å¤‡å’Œä¸»æœºï¼Œç„¶åè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š 2.2. ç½‘ç»œ ADBæŸ¥çœ‹å¼€å‘æ¿ IP åœ°å€ï¼ŒPC ç«¯é€šè¿‡ç½‘ç»œè®¿é—®ï¼š adb connect + IPadb shell æ³¨æ„ç‚¹ï¼š AIO-3399-JD4 AIO-3399J è¦æ”¯æŒä½¿ç”¨ ADB éœ€è¦ä¿®æ”¹ kernel/arch/arm64/boot/dts/rockchip/rk3399-firefly-aio.dtsiï¼Œå°† usbdrd_dwc3_0 è®¾ç½®ä¸º peripheral æ¨¡å¼ï¼Œä¹‹åè¯¥ usb åªèƒ½ä½œä¸ºä»è®¾å¤‡ä½¿ç”¨ã€‚ usbdrd_dwc3_0 dr_mode = peripheral;; åŒç†ï¼ŒAIO-3399Pro-JD4 è¦æ”¯æŒä½¿ç”¨ ADB éœ€è¦ä¿®æ”¹ kernel/arch/arm64/boot/dts/rockchip/rk3399pro-firefly-aioc.dtsã€‚ ç„¶åé‡æ–°ç¼–è¯‘å’Œçƒ§å†™ Kernelã€‚ 4. å¯¼å‡ºè®¾å¤‡ç³»ç»Ÿå½“ç”¨æˆ·å·²ç»åœ¨ä¸€å°è®¾å¤‡ä¸Šå®Œæˆå·¥ä½œç¯å¢ƒçš„éƒ¨ç½²ï¼Œéœ€è¦å°†å½“å‰ç¯å¢ƒå®Œæ•´å¯¼å‡ºï¼Œä»¥æ‰¹é‡éƒ¨ç½²åˆ°å…¶å®ƒåŒè®¾å¤‡ä¸Šï¼Œå¯ä»¥é€šè¿‡å¯¼å‡ºè®¾å¤‡æ–‡ä»¶ç³»ç»Ÿæ¥å¤‡ä»½å½“å‰çš„å¼€å‘ç¯å¢ƒã€‚ å¯¼å‡ºè®¾å¤‡ç³»ç»Ÿåˆ†ä¸ºä¸¤æ­¥ï¼š åœ¨è®¾å¤‡ä¸Šå¯¼å‡º Ubuntu æ ¹æ–‡ä»¶ç³»ç»Ÿ rootfsï¼› äºŒæ¬¡æ‰“åŒ…å®Œæ•´å›ºä»¶ï¼Œå°† Ubuntu rootfs ä¸å‘å¸ƒå›ºä»¶çš„å…¶ä»–åˆ†åŒºç»„åˆï¼Œå®ŒæˆäºŒæ¬¡æ‰“åŒ…ï¼Œç”Ÿæˆæ–°çš„å®Œæ•´å›ºä»¶ã€‚ 4.1. å¯¼å‡º rootfsæ³¨æ„ä»¥ä¸‹æ“ä½œå‡åœ¨è®¾å¤‡ç«¯ä¸Šæ“ä½œï¼ åœ¨è®¾å¤‡çš„ Ubuntu ç¯å¢ƒä¸‹ï¼Œå®‰è£… fireflydevï¼š sudo apt updatesudo apt install fireflydev å®‰è£… fireflydev åï¼Œå°±èƒ½ä½¿ç”¨ ff_export_rootfs è„šæœ¬å¯¼å‡ºæ ¹æ–‡ä»¶ç³»ç»Ÿ å»ºè®®ä½¿ç”¨å®¹é‡è¾ƒå¤§çš„ç§»åŠ¨ç¡¬ç›˜ å¯¼å‡ºå·¥å…·ä¼šæ‰§è¡Œ apt clean ç­‰æ“ä½œä»¥å‡å°æ–‡ä»¶ç³»ç»Ÿå¤§å° å°†æ ¹æ–‡ä»¶ç³»ç»Ÿå¯¼å‡ºï¼Œä¾‹å¦‚å¯¼å‡ºåˆ° /media/firefly/AC91-C4AE/ ç›®å½•ï¼ˆéœ€è¦ç­‰å¾…ä¸€å®šæ—¶é—´ï¼‰ï¼š ff_export_rootfs /media/firefly/AC91-C4AE/ å‹ç¼©æ–‡ä»¶ç³»ç»Ÿï¼Œåˆ é™¤ä¸å¿…è¦çš„ç©ºç™½ç©ºé—´ä»¥å‡å°‘å­˜å‚¨å™¨èµ„æºçš„å ç”¨ï¼š # æœ‰éƒ¨åˆ†å®¢æˆ·è¯´å¯¼å‡ºçš„ rootfs å¤§å°ä¸º 3.3Gï¼Œå¯å®é™…åªç”¨äº† 3Gï¼ŒåŸå› æ˜¯æ²¡æœ‰å¯¹ rootfs è¿›è¡Œå‹ç¼©e2fsck -p -f Firefly_Ubuntu_18.04.6_rootfs.imgresize2fs -M Firefly_Ubuntu_18.04.6_rootfs.img 4.2. äºŒæ¬¡æ‰“åŒ…å®Œæ•´å›ºä»¶æ³¨æ„ä»¥ä¸‹æ“ä½œå‡åœ¨ PC æœºç«¯ï¼ˆx86-64 æ¶æ„ï¼‰ä¸Šæ“ä½œï¼ å®‰è£…å¿…è¦çš„è½¯ä»¶åŒ…ï¼šsudo apt-get install lib32stdc++6 ä¸‹è½½äºŒæ¬¡æ‰“åŒ…å·¥å…·ï¼šfirefly-linux-repackï¼ˆæå–ç ï¼š1234ï¼‰ è§£å‹äºŒæ¬¡æ‰“åŒ…å·¥å…·ï¼š tar -xzf firefly-linux-repack.tgzcd firefly-linux-repack ç›®å½•å¦‚ä¸‹ï¼š firefly-linux-repack â”œâ”€â”€ bin â”‚ â”œâ”€â”€ afptool â”‚ â””â”€â”€ rkImageMaker â”œâ”€â”€ pack.sh # æ‰“åŒ…è„šæœ¬ â”œâ”€â”€ Readme_en.md â”œâ”€â”€ Readme.md â””â”€â”€ unpack.sh # è§£åŒ…è„šæœ¬ è§£åŒ…æ“ä½œï¼š æŠŠå®˜æ–¹å‘å¸ƒçš„ Ubuntu å›ºä»¶æ‹·è´åˆ° firefly-linux-repack æ ¹ç›®å½•ï¼Œé‡å‘½åä¸º update.imgï¼Œæ‰§è¡Œè§£åŒ…è„šæœ¬ unpack.shã€‚è§£åŒ…å®Œæˆåï¼Œå„åˆ†åŒºæ–‡ä»¶åœ¨ output ç›®å½•ä¸‹ã€‚ mv /path/to/ROC-RK3566-PC_Ubuntu18.04-r21156_v1.2.4a_220519.img update.img./unpack.sh æ‰“åŒ…æ“ä½œï¼šä¿æŒå½“å‰ç›®å½•ç»“æ„ï¼Œæ–‡ä»¶åç­‰ä¸å˜ï¼Œæ¥å…¥ç§»åŠ¨ç¡¬ç›˜åˆ° PC æœºï¼ŒæŠŠå‰é¢å¯¼å‡ºçš„ Ubuntu rootfs æ›¿æ¢ output/Image/rootfs.imgï¼Œç„¶åæ‰§è¡Œæ‰“åŒ…è„šæœ¬ pack.shã€‚ cp /media/customer/1878-4615/Firefly_Ubuntu_18.04.6_rootfs.img /path/to/firefly-linux-repack/output/Image/rootfs.img./pack.sh æ–°çš„å®Œæ•´å›ºä»¶ä¸ºå½“å‰ç›®å½•çš„ new_update.imgã€‚ 5. GPIO é…ç½®ä¸ä½¿ç”¨GPIO, å…¨ç§° General-Purpose InputOutputï¼ˆé€šç”¨è¾“å…¥è¾“å‡ºï¼‰ï¼Œæ˜¯ä¸€ç§è½¯ä»¶è¿è¡ŒæœŸé—´èƒ½å¤ŸåŠ¨æ€é…ç½®å’Œæ§åˆ¶çš„é€šç”¨å¼•è„šã€‚ ä»¥ä¸‹é€šè¿‡æ§åˆ¶ ROC-RK3399-PC Pro çš„ LED ä¸ºä¾‹ï¼Œå¯¹äºå…¶ä»–è®¾å¤‡ï¼Œæ–¹æ³•æ˜¯ç±»ä¼¼çš„ã€‚ ROC-RK3399-PC Pro çš„ä¸»æ§æ˜¯ RK3399ï¼ŒRK3399 æœ‰ 5 ç»„ GPIO bankï¼šGPIO0GPIO4ï¼Œæ¯ç»„åˆä»¥ A0A7, B0B7, C0C7, D0~D7 ä½œä¸ºç¼–å·åŒºåˆ†ã€‚ 5.1. GPIO ç¼–å·è®¡ç®—ROC-RK3399-PC Pro æ¿è½½ä¸¤ä¸ª LEDï¼Œå¦‚ä¸‹ï¼š DIY_LED ç½‘ç»œæ˜¯æ¥åˆ°å¼•è„š GPIO0_B5ï¼š PIO pin è„šè®¡ç®—å…¬å¼ï¼š GPIO å°ç»„ç¼–å·è®¡ç®—å…¬å¼ï¼š ä¾‹å¦‚ GPIO0_B5ï¼š bank = 0; // GPIO0_B5 = 0, bank âˆˆ [0,4]group = 1; // GPIO0_B5 = 1, group âˆˆ (A=0), (B=1), (C=2), (D=3)X = 5; // GPIO0_B5 = 5, X âˆˆ [0,7]number = group * 8 + X = 1 * 8 + 5 = 13;pin = bank * 32 + number = 0 * 32 + 13 = 13; æ³¨æ„ï¼šè¿™ä¸ªå¼•è„šåœ¨å®˜æ–¹å‘å¸ƒçš„å›ºä»¶ä¸­é»˜è®¤å·²è¢« LED å­ç³»ç»Ÿå ç”¨ï¼Œå› æ­¤é¦–å…ˆéœ€è¦æ‰¾åˆ°ä»¥ä¸‹èŠ‚ç‚¹å°†å…¶ disableï¼ ROC-RK3399-PC Pro æ˜¯å®šä¹‰åœ¨ arch/arm64/boot/dts/rockchip/rk3399-roc-pc.dtsiï¼š user status = disabled; // æ·»åŠ è¿™ä¸€è¡Œ label = firefly:yellow:user; linux,default-trigger = ir-user-click; default-state = off; gpios = gpio0 13 GPIO_ACTIVE_HIGH; pinctrl-names = default; pinctrl-0 = led_user;; ç„¶åç¼–è¯‘ä¸é‡æ–°çƒ§å†™å†…æ ¸å›ºä»¶ã€‚ 5.2. ç”¨æˆ·æ€ä½¿ç”¨ GPIO1ã€ç”³è¯· GPIO echo 13 /sys/class/gpio/export 2ã€é…ç½®å¼•è„šæ–¹å‘ æŸ¥çœ‹é»˜è®¤å¼•è„šæ–¹å‘ï¼š cat /sys/class/gpio/gpio13/direction é…ç½®æˆè¾“å‡ºæ–¹å‘ï¼š echo out /sys/class/gpio/gpio13/direction 3ã€é…ç½®å¼•è„šè¾“å‡ºç”µå¹³ ä»å‰é¢çš„åŸç†å›¾å¯çŸ¥ï¼Œè¾“å‡ºé«˜ç”µå¹³ä¸ºç‚¹äº® LEDï¼š echo 1 /sys/class/gpio/gpio13/value ç†„ç­ LEDï¼š echo 0 /sys/class/gpio/gpio13/value 5.3. è®¾å¤‡æ ‘ä½¿ç”¨ GPIOåœ¨è®¾å¤‡æ ‘ä¸­é…ç½® GPIOï¼Œéœ€è¦é…ç½®å¼•è„šçš„åŠŸèƒ½å¤ç”¨ä¸ç”µæ°”å±æ€§ å¯¹äº rockchip å¼•è„šï¼Œé…ç½®å¦‚ä¸‹ï¼š rockchip,pins = PIN_BANK PIN_BANK_IDX MUX phandle å…¶ä¸­ï¼š PIN_BANKï¼šå¼•è„šæ‰€åœ¨çš„ bank PIN_BANK_IDXï¼šå¼•è„šæ‰€åœ¨ bank çš„å¼•è„šå· MUXï¼šåŠŸèƒ½å¤ç”¨é…ç½®ï¼Œ0 è¡¨ç¤ºæ™®é€š GPIOï¼Œ1-N è¡¨ç¤ºç‰¹æ®Šçš„åŠŸèƒ½å¤ç”¨ phandleï¼šå¼•è„šä¸€èˆ¬é…ç½®ï¼Œä¾‹å¦‚å†…éƒ¨ä¸Šæ‹‰ã€ç”µæµå¼ºåº¦ç­‰ï¼Œåœ¨ Documentation/devicetree/bindings/pinctrl/pinctrl-bindings.txt æ–‡ä»¶ä¸­æè¿° é…ç½® GPIO0_B5 å¼•è„šï¼š rockchip,pins = 0 13 RK_FUNC_GPIO pcfg_pull_none; æ­¤å¤„çš„å«ä¹‰ï¼š PIN_BANK ç­‰äº 0 PIN_BANK_IDX ç­‰äº 13 RK_FUNC_GPIO ä»£è¡¨ä½¿ç”¨æ™®é€š GPIO åŠŸèƒ½ pcfg_pull_none ä»£è¡¨æ™®é€šé…ç½® å¯¹äº LEDï¼ŒLinux å®šä¹‰äº†ä¸€å¥— GPIO å­ç³»ç»Ÿï¼Œè®¾å¤‡æ ‘çš„é…ç½®å¦‚ä¸‹ï¼š / gpio_led: gpio-led compatible = gpio-leds; diy_led: diy-led label = diy-led; default-state = on; // é»˜è®¤æ‰“å¼€ linux,default-trigger = default-on; // é»˜è®¤è§¦å‘ gpios = gpio0 13 GPIO_ACTIVE_HIGH; // å¼•è„šè®¾ç½® pinctrl-names = default; pinctrl-0 = diy_led_pin; // å¼•ç”¨ pinctrl ;\t;;pinctrl gpio-led-pin diy_led_pin: diy-led-pin rockchip,pins = 0 13 RK_FUNC_GPIO pcfg_pull_none; ;\t;; ç„¶åç¼–è¯‘ä¸é‡æ–°çƒ§å†™å†…æ ¸å›ºä»¶ï¼Œé‡å¯ç³»ç»Ÿä¼šçœ‹åˆ° LED é»˜è®¤ç‚¹äº®ã€‚ å¦‚æœå¸Œæœ› LED å…·æœ‰é—ªçƒæ•ˆæœï¼Œå¯ä»¥ä¿®æ”¹ linux,default-trigger å±æ€§å®ç°ï¼š linux,default-trigger = timer; é…ç½®è¯¥å±æ€§åï¼ŒLED é»˜è®¤æ¯ 500ms é—´éš”é—ªçƒã€‚ æ›´å¤šå±æ€§é…ç½®å¯ä»¥å‚è€ƒ Documentation/devicetree/bindings/leds/leds-gpio.txtã€‚ ä»¥ä¸Šè®¾å¤‡æ ‘é…ç½®å¯ä»¥åœ¨ arch/arm64/boot/dts/rockchip/firefly-gpio-demo.dtsi æ‰¾åˆ°ï¼æœ‰éœ€æ±‚çš„ç”¨æˆ·åœ¨æ¿æè®¾å¤‡æ ‘ä¸­åŒ…å«è¯¥æ–‡ä»¶å³å¯ï¼ˆè®°å¾—è¦é¦–å…ˆ disable rk3399-roc-pc.dtsi é‡Œé¢å†²çªéƒ¨åˆ†ï¼‰ï¼š #include firefly-gpio-demo.dtsi 6. ç½‘ç»œé…ç½®6.1. ä»¥å¤ªç½‘å£é€šç”¨å‚æ•°é…ç½®6.1.1. æŸ¥çœ‹ä»¥å¤ªç½‘é€šç”¨å‚æ•°ä»¥å¤ªç½‘çš„é€šç”¨å‚æ•°åŒ…æ‹¬ï¼šè‡ªåå•†ï¼ŒåŒå·¥æ¨¡å¼å’Œæ¥å£é€Ÿç‡ 6.1.2. é…ç½®ä»¥å¤ªç½‘é€šç”¨å‚æ•°6.1.2.1. æ‰“å¼€æˆ–å…³é—­è‡ªåå•†ethtool -s port_name autoneg on | off 6.1.2.2. ä¿®æ”¹åŒå·¥æ¨¡å¼ethtool -s port_name duplex half | full æ³¨æ„ï¼š å½“ä»¥å¤ªç½‘æ¥å£å·¥ä½œåœ¨è‡ªåå•†æ¨¡å¼æ—¶ï¼Œç¼ºçœæƒ…å†µä¸‹åŒå·¥æ¨¡å¼æ˜¯å’Œå¯¹ç«¯æ¥å£åå•†å¾—åˆ°çš„ã€‚ å½“ä»¥å¤ªç½‘æ¥å£å·¥ä½œåœ¨éè‡ªåå•†æ¨¡å¼æ—¶ï¼Œç¼ºçœæƒ…å†µä¸‹åŒå·¥æ¨¡å¼ä¸ºå…¨åŒå·¥æ¨¡å¼ã€‚ 6.1.2.3. ä¿®æ”¹é€Ÿç‡ethtool -s port_name speed 10 | 100 | 1000 æ³¨æ„ï¼š å½“ä»¥å¤ªç½‘æ¥å£å·¥ä½œåœ¨è‡ªåå•†æ¨¡å¼æ—¶ï¼Œç¼ºçœæƒ…å†µä¸‹æ¥å£é€Ÿç‡æ˜¯å’Œå¯¹ç«¯æ¥å£åå•†å¾—åˆ°çš„ã€‚ å½“ä»¥å¤ªç½‘æ¥å£å·¥ä½œåœ¨éè‡ªåå•†æ¨¡å¼æ—¶ï¼Œç¼ºçœæƒ…å†µä¸‹æ¥å£é€Ÿç‡ä¸ºæ¥å£æ”¯æŒçš„æœ€å¤§æ¥å£é€Ÿç‡ã€‚ 6.1.3. é…ç½®ä¸¾ä¾‹æ‰‹åŠ¨è®¾ç½® eth0 çš„æ¥å£é€Ÿç‡ä¸º 100ï¼Œå·¥ä½œåœ¨å…¨åŒå·¥æ¨¡å¼ä¸‹ã€‚ ethtool -s eth0 autoneg offethtool -s eth0 speed 100ethtool -s eth0 duplex full 6.2. ä½¿ç”¨ Netplan ç®¡ç†ç½‘ç»œNetplan æ˜¯ä¸€ä¸ªç”¨äºåœ¨ linux ç³»ç»Ÿä¸Šè½»æ¾é…ç½®ç½‘ç»œçš„å®ç”¨ç¨‹åºã€‚åªéœ€åˆ›å»ºæ‰€éœ€ç½‘ç»œæ¥å£çš„ YAML æè¿°ä»¥åŠæ¯ä¸ªåº”é…ç½®çš„åŠŸèƒ½ã€‚æ ¹æ®æ­¤æè¿°ï¼ŒNetplan å°†ä¸ºé€‰æ‹©çš„æ¸²æŸ“å™¨å·¥å…·ç”Ÿæˆæ‰€æœ‰å¿…è¦çš„é…ç½®ã€‚åœ¨ Ubuntu18.04 åŠå…¶ä»¥ä¸Šç‰ˆæœ¬è¿›è¡Œäº†æ”¯æŒã€‚ 6.2.1. é…ç½®è¦é…ç½® netplanï¼Œè¯· /etc/netplan/ ä½¿ç”¨ .yaml æ‰©å±•åï¼ˆä¾‹å¦‚ /etc/netplan/config.yamlï¼‰ä¿å­˜é…ç½®æ–‡ä»¶ï¼Œç„¶åè¿è¡Œ sudo netplan apply.Â æ­¤å‘½ä»¤è§£æé…ç½®å¹¶å°†å…¶åº”ç”¨äºç³»ç»Ÿã€‚ æ³¨æ„ï¼š å¦‚æœ netplan apply æŠ¥é”™ï¼Œè¯´æ˜çš„ yaml é…ç½®æ–‡ä»¶æœªè¢«ç³»ç»Ÿæ”¯æŒï¼Œè¯·ä»”ç»†æ£€æŸ¥ å¯¹äºä»¥å¤ªç½‘å£ï¼Œå¿…é¡»ä¿è¯æœ‰ç½‘çº¿æ¥å…¥ï¼Œå¹¶ä¸”ç½‘å¡ç¯é—ªçƒï¼Œæ‰èƒ½ä¿è¯ Netplan é…ç½®ç”Ÿæ•ˆ ä¸‹é¢æ ¹æ®æœ€å¸¸ä½¿ç”¨çš„å·¥ä½œåœºæ™¯è¿›è¡Œé…ç½®ï¼Œéœ€è¦æ›´å¤šçš„é…ç½®æ¡ˆä¾‹æ•™ç¨‹ï¼Œè¯·é˜…è¯» netplanå®˜æ–¹å®ä¾‹ 6.2.2. åŸºç¡€é…ç½®Netplan æ”¯æŒ networkd å’Œ NetworkManager ä¸¤ç§ç½‘ç»œåç«¯ï¼Œä¸€èˆ¬ä¸º networkd network: version: 2 renderer: networkd å¦‚æœä¸å­˜åœ¨ networkdï¼Œå¯ä»¥ä½¿ç”¨ NetworkManagerï¼Œéƒ½æ˜¯ä¸€æ ·çš„ã€‚ network: version: 2 renderer: NetworkManager 6.2.3. ä»¥å¤ªç½‘è¿æ¥ï¼šåŠ¨æ€ IPnetwork: version: 2 renderer: networkd ethernets: eth0: dhcp4: yes eth1: dhcp4: yes 6.2.4. ä»¥å¤ªç½‘è¿æ¥ï¼šé™æ€ IPnetwork: version: 2 renderer: networkd ethernets: eth0: addresses: - 10.10.10.3/24 nameservers: addresses: [202.96.128.86] routes: - to: 0.0.0.0/0 via: 10.10.10.1 eth1: addresses: - 10.10.10.2/24 nameservers: addresses: [202.96.128.86] routes: - to: 0.0.0.0/0 via: 10.10.10.1 6.2.5. WIFI è¿æ¥ï¼šé™æ€ IPnetwork: version: 2 renderer: networkd wifis: wlan0: dhcp4: no dhcp6: no addresses: [192.168.1.200/24] nameservers: addresses: [202.96.128.86] access-points: NETGEAR25: password: ceshizhuanyong routes: - to: 0.0.0.0/0 via: 192.168.1.1 6.2.6. WIFI è¿æ¥ï¼šåŠ¨æ€ IPnetwork: version: 2 renderer: networkd wifis: wlan0: dhcp4: yes access-points: NETGEAR25: password: ceshizhuanyong 6.3. ä½¿ç”¨ nmcli ç®¡ç†ç½‘ç»œnmcli æ˜¯ç”¨æ¥ç®¡ç† NetworkManager ç½‘ç»œè¿æ¥çš„å‘½ä»¤è¡Œå·¥å…· 6.3.1. å¸¸ç”¨å‘½ä»¤ æ˜¾ç¤ºæ‰€æœ‰è¿æ¥ æ˜¾ç¤ºè¿æ¥ä¿¡æ¯ nmcli connection show connection_name æ˜¾ç¤ºç½‘ç»œè®¾å¤‡åˆ—è¡¨ã€å…¶çŠ¶æ€ä»¥åŠä½¿ç”¨è¯¥è®¾å¤‡çš„è¿æ¥ æ¿€æ´»è¿æ¥ nmcli connection up connection_name å–æ¶ˆæ¿€æ´»è¿æ¥ nmcli connection down connection_name åˆ é™¤è¿æ¥ nmcli connection del connection_name 6.3.2. ä»¥å¤ªç½‘è¿æ¥ï¼šé™æ€ IPå‡è®¾è¿›è¡Œé…ç½®ä»¥å¤ªç½‘ç½‘å¡ä¸º eth0ï¼ŒIP ä¸º 192.168.1.1024ï¼Œé»˜è®¤ç½‘å…³ä¸º 192.168.1.1ï¼ŒDNS æœåŠ¡å™¨ä¸º 202.96.128.86 ä¸ºä»¥å¤ªç½‘è¿æ¥æ·»åŠ æ–°çš„è¿æ¥ nmcli connection add con-name Example-Connection ifname eth0 type ethernet è®¾ç½® IPv4 åœ°å€ nmcli connection modify Example-Connection ipv4.addresses 192.168.1.10/24 å°† IPv4 è¿æ¥æ–¹æ³•è®¾ç½®ä¸º manual nmcli connection modify Example-Connection ipv4.method manual è®¾ç½® IPv4 é»˜è®¤ç½‘å…³ nmcli connection modify Example-Connection ipv4.gateway 192.168.1.1 è®¾ç½® IPv4 DNS æœåŠ¡å™¨åœ°å€ nmcli connection modify Example-Connection ipv4.dns 202.96.128.86 æ¿€æ´»è¿æ¥ nmcli connection up Example-Connection 6.3.3. ä»¥å¤ªç½‘è¿æ¥ï¼šåŠ¨æ€ IP ä¸ºä»¥å¤ªç½‘è¿æ¥æ·»åŠ æ–°çš„è¿æ¥ nmcli connection add con-name Example-Connection ifname eth0 type ethernet æ¿€æ´»è¿æ¥ nmcli connection up Example-Connection 6.3.4. WIFI è¿æ¥ï¼šåŠ¨æ€ IP ç¡®ä¿ WiFi è¢«å¯ç”¨ï¼ˆé»˜è®¤ï¼‰ åˆ·æ–°å¯ç”¨çš„ Wi-Fi è¿æ¥åˆ—è¡¨ï¼š æŸ¥çœ‹å¯ç”¨çš„ Wi-Fi æ¥å…¥ç‚¹ï¼š nmcli dev wifi listIN-USE SSID MODE CHAN RATE SIGNAL BARS SECURITY... MyCafe Infra 3 405 Mbit/s 85 â–‚â–„â–†â–ˆ WPA1 WPA2 ä½¿ç”¨ nmcli è¿æ¥åˆ° Wi-Fi è¿æ¥ï¼š nmcli dev wifi connect SSID-Name password wireless-password ä¾‹å¦‚ï¼š nmcli dev wifi connect MyCafe password wireless-password è¯·æ³¨æ„ï¼Œå¦‚æœè¦ç¦ç”¨ Wi-Fi çŠ¶æ€ï¼š 6.4. å¿«é€Ÿåˆ›å»ºæ— çº¿ AP çƒ­ç‚¹6.4.1. å¯¹æ— çº¿çƒ­ç‚¹çš„ IP å±€åŸŸç½‘æ®µæ— è¦æ±‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªéœ€è¦ä½¿ç”¨ nmcli å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ— çº¿ AP çƒ­ç‚¹å³å¯ï¼š nmcli device wifi hotspot ifname wlan0 con-name MyHostspot ssid MyHostspotSSID password 12345678 è¯´æ˜ï¼š con-nameï¼šè¿æ¥åç§°ï¼šè¿™é‡Œè®¾ç½®ä¸º MyHostspotï¼ˆå¯è‡ªå®šä¹‰ï¼‰ ssidï¼šåˆ›å»ºçš„ AP çƒ­ç‚¹çš„åç§°ï¼šè¿™é‡Œè®¾ç½®ä¸º MyHostspotSSIDï¼ˆå¯è‡ªå®šä¹‰ï¼‰ passwordï¼šåˆ›å»ºçš„ AP çƒ­ç‚¹çš„å¯†ç ï¼šè¿™é‡Œè®¾ç½®ä¸º 12345678ï¼ˆå¯è‡ªå®šä¹‰ï¼‰ 6.4.2. å¯¹æ— çº¿çƒ­ç‚¹çš„ IP å±€åŸŸç½‘æ®µæœ‰è¦æ±‚è¯·é˜…è¯»ç« èŠ‚ã€Šåˆ›å»ºæ¡¥æ¥æ— çº¿ APã€‹ 6.5. åˆ›å»ºæ¡¥æ¥æ— çº¿ AP çƒ­ç‚¹6.5.1. åŠŸèƒ½éœ€æ±‚å‡è®¾æœ‰ä¸€å±€åŸŸç½‘ï¼Œç½‘æ®µä¸º 10.10.0.0ï¼Œæ©ç ä¸º 255.255.255.0ã€‚Firefly çš„å¼€å‘æ¿ï¼Œä»¥ä¸‹ç®€ç§° Firefly Boardï¼Œå…¶ç½‘å£é€šè¿‡è·¯ç”±å™¨ Routerï¼Œè·å–åˆ°æœ¬å±€åŸŸç½‘å†…çš„åŠ¨æ€ IP åœ°å€ï¼šä¸º 10.10.0.2ã€‚ éœ€æ±‚ï¼šå°†ç³»ç»Ÿé…ç½®æˆè½¯è·¯ç”±ï¼Œå…·ä½“è¦æ±‚å¦‚ä¸‹ï¼š ï¼ˆ1ï¼‰Firefly Board å¼€å¯ä¸€ä¸ªæ— çº¿ AP çƒ­ç‚¹ï¼Œå¹³æ¿å’Œæ‰‹æœºç­‰å¤–è®¾é€šè¿‡è¯¥æ— çº¿ AP çƒ­ç‚¹è®¿é—®ç½‘ç»œï¼Œè¿›è¡Œä¸Šç½‘ã€‚ ï¼ˆ2ï¼‰Firefly Board å¼€å¯çš„æ— çº¿çƒ­ç‚¹å±€åŸŸç½‘ä¸ºï¼š192.168.4.1 ï¼ˆ3ï¼‰Firefly Board å¦‚æœæœ‰å¤šä¸ªç½‘å£ï¼Œè¦æ±‚ eth0 ä½œä¸º WAN å£åŠŸèƒ½ï¼Œè‡ªåŠ¨ä»è·¯ç”±å™¨è·å– IP åœ°å€ï¼Œeth1 ä½œä¸º LAN å£åŠŸèƒ½ï¼Œèƒ½å¤Ÿä¸ºæ¥å…¥çš„è®¾å¤‡åˆ†é… 192.168.4.0/24 ç½‘æ®µçš„ IP åœ°å€ã€‚ ç½‘ç»œæ‹“æ‰‘å¦‚ä¸‹ï¼š 6.5.2. å®‰è£…ç®¡ç† AP çƒ­ç‚¹å¿…è¦çš„è½¯ä»¶åŒ…å®‰è£… hostapdï¼šhostapd å¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿè½¯ APï¼Œæ‰€ä»¥æ˜¯å®ç°è¯¥åŠŸèƒ½å¿…é¡»çš„ï¼š å…è®¸ hostapd å¼€æœºå¯åŠ¨ï¼Œè¿™æ ·é‡å¯ä¹‹åæ— çº¿ AP çƒ­ç‚¹ä¼šè‡ªåŠ¨æ‰“å¼€ systemctl unmask hostapdsystemctl enable hostapd å®‰è£… isc-dhcp-serverï¼šisc-dhcp-server ç”¨äºä¸ºæ¥å…¥æ— çº¿ AP çš„è®¾å¤‡è‡ªåŠ¨åˆ†é… IP åœ°å€å’Œ DNS æœåŠ¡å™¨åœ°å€ apt install isc-dhcp-server å…è®¸ isc-dhcp-server å¼€å¯å¯åŠ¨ systemctl enable isc-dhcp-server å®‰è£… netfilter-persistent iptables-persistentï¼šç”¨äºä¿å­˜é˜²ç«å¢™è§„åˆ™ apt install netfilter-persistent iptables-persistent å®‰è£… bridge-utilsï¼šç”¨äºåˆ›å»ºè™šæ‹Ÿç½‘æ¡¥ 6.5.3. é…ç½® Netplanç›®çš„æ˜¯åˆ›å»ºç½‘æ¡¥ br0ï¼Œç½‘æ¡¥ IP ä¸º 192.168.4.1ã€‚å…è®¸ç³»ç»Ÿ eth0 ç½‘å¡åˆ†é… IP åœ°å€ï¼Œç¦æ­¢ç³»ç»Ÿä¸º eth1 ç½‘å¡åˆ†é… IP åœ°å€ï¼Œå°† eth1 ç½‘å¡ç»‘å®šåˆ°ç½‘æ¡¥ br0ã€‚ å‡è®¾ netplan çš„é…ç½®æ–‡ä»¶ä¸ºï¼š/etc/netplan/netplan.yamlï¼Œå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š network: version: 2 renderer: networkd ethernets: eth0: dhcp4: yes eth1: dhcp4: no bridges: br0: dhcp4: no addresses: - 192.168.4.1/24 interfaces: - eth1 æ¥ç€è¿è¡Œå¦‚ä¸‹å‘½ä»¤å¯ç”¨ç½‘ç»œé…ç½®ï¼š 6.5.4. é…ç½® hostapdåˆ›å»ºä¸€ä¸ª hostapd.conf é…ç½®æ–‡ä»¶ï¼Œç”¨æ¥è®¾ç½®æ— çº¿çƒ­ç‚¹çš„åç§°ï¼Œå¯†ç ï¼Œä¿¡é“ç­‰å±æ€§ åœ¨å…¶ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š country_code=CNinterface=wlan0bridge=br0ssid=Example-Wifi-Namehw_mode=gchannel=11macaddr_acl=0auth_algs=1ignore_broadcast_ssid=0wpa=2wpa_passphrase=12345678wpa_key_mgmt=WPA-PSKwpa_pairwise=TKIPrsn_pairwise=CCMP é‡è¦å‚æ•°è¯´æ˜ï¼š country_codeï¼šå›½å®¶ç ï¼Œä¸­å›½ä½¿ç”¨ CN interfaceï¼šå¼€å¯æ— çº¿ AP çƒ­ç‚¹çš„æ— çº¿ç½‘å¡ bridgeï¼šç»‘å®šåˆ° br0 ç½‘æ¡¥ï¼Œä½¿å¾—æ— çº¿ AP çƒ­ç‚¹å’Œä»¥å¤ªç½‘å£åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†… hw_modeï¼šè®¾ç½®æ— çº¿æ¨¡å¼ channelï¼šä¿¡é“ ssidï¼šæ— çº¿ AP åç§°ï¼Œè¿™é‡Œè®¾ç½® Example-Wifi-Name wpa_passphraseï¼šæ— çº¿ AP å¯†ç ï¼Œè¿™é‡Œè®¾ç½®ä¸º 12345678 å…³äºæ›´å¤šï¼Œhostapd.conf çš„é…ç½®æ— ç–‘æ˜¯éå¸¸å¤æ‚çš„ï¼Œhw_mode æ”¯æŒçš„æ¨¡å¼æœ‰ aï¼Œgï¼Œchannel ä¿¡é“ä¸ hw_modeï¼Œcountry_code ç­‰éƒ½æœ‰å…³ç³»ï¼Œè¿™é‡Œä¸å†å±•å¼€ã€‚å¦‚æœéœ€è¦å¯¹è¿™äº›æ— çº¿å‚æ•°è¿›è¡Œæ›´è‡ªåŠ¨åŒ–ä¸”ç´§å¯†çš„é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨ OpenWRT è½¯è·¯ç”±ç³»ç»Ÿæ¥ä»£æ›¿ Ubuntu ç³»ç»Ÿã€‚ æ¥ä¸‹æ¥ï¼Œéœ€è¦é…ç½® hostapd çš„å…¨å±€é…ç½®æ–‡ä»¶ å–æ¶ˆ DAEMON_CONF çš„æ³¨é‡Šï¼Œè®¾ç½®å®ƒçš„å€¼ä¸ºä¸Šé¢åˆ›å»ºçš„ /etc/hostapd.conf # Defaults for hostapd initscript# # See /usr/share/doc/hostapd/README.Debian for information about alternative# methods of managing hostapd.## Uncomment and set DAEMON_CONF to the absolute path of a hostapd configuration# file and hostapd will be started during system boot. An example configuration# file can be found at /usr/share/doc/hostapd/examples/hostapd.conf.gz#DAEMON_CONF=/etc/hostapd.conf# Additional daemon options to be appended to hostapd command:-# -d show more debug messages (-dd for even more)# -K include key data in debug messages# -t include timestamps in some debug messages## Note that -B (daemon mode) and -P (pidfile) options are automatically# configured by the init.d script and must not be added to DAEMON_OPTS.##DAEMON_OPTS= é‡å¯ hostapd æœåŠ¡ systemctl restart hostapd åˆ°æ­¤ï¼Œå·²ç»å¯ä»¥é€šè¿‡æ‰‹æœºç­‰è®¾å¤‡ï¼ŒæŸ¥çœ‹åˆ°æœ‰ä¸€ä¸ªæ— çº¿ AP çƒ­ç‚¹å¼€å¯ï¼Œåç§°ä¸ºâ€Example-Wifi-Nameâ€œï¼Œä½†æ˜¯è¿æ¥ä¹‹åæ— æ³•ä¸ºè®¾å¤‡åˆ†é… IP åœ°å€ï¼Œè®¾å¤‡ä¼šç«‹å³æ–­å¼€ã€‚ 6.5.5. é…ç½® isc-dhcp-serverisc-dhcp-server ä½œä¸ºä¸€ä¸ª dhcp æœåŠ¡å™¨ï¼Œä¸ºæ¥å…¥æ— çº¿ AP èŠ‚ç‚¹çš„è®¾å¤‡ï¼Œæ¯”å¦‚æ‹“æ‰‘å›¾ä¸­çš„ Laptop1 å’Œ Laptop2 è‡ªåŠ¨åˆ†é… IP åœ°å€å’Œ DNS æœåŠ¡å™¨åœ°å€ã€‚ ç¼–è¾‘ /etc/dhcp/dhcpd.confï¼Œ ç”¨å¦‚ä¸‹å†…å®¹è¿›è¡Œæ›¿æ¢ï¼š # ä¸ºè®¾å¤‡æŒ‡å®šDNSåœ°å€ï¼Œå¤šä¸ªDNSä½¿ç”¨,éš”å¼€option domain-name-servers 202.96.128.86,202.96.128.166,8.8.8.8,114.114.114.114;default-lease-time 600;max-lease-time 7200;ddns-update-style none; ddns-updates off;subnet 192.168.4.0 netmask 255.255.255.0 range 192.168.4.2 192.168.4.200; option routers 192.168.4.1; option broadcast-address 192.168.4.255; option subnet-mask 255.255.255.0; é‡è¦å‚æ•°è¯´æ˜ï¼š domain-name-serversï¼šDNS æœåŠ¡å™¨åœ°å€åˆ—è¡¨ï¼Œä¸ºæ¥å…¥ 192.168.4.0/24 ç½‘æ®µçš„è®¾å¤‡ï¼Œåˆ†é… DNS subnet 192.168.4.0 netmask 255.255.255.0ï¼šå®šä¹‰å­ç½‘ç½‘æ®µ 192.168.4.0/24 range 192.168.4.2 192.168.4.200ï¼šåˆ†é…çš„ IP åœ°å€èŒƒå›´ option routers 192.168.4.1ï¼šé»˜è®¤è·¯ç”± option broadcast-address 192.168.4.255ï¼šå¹¿æ’­åœ°å€ option subnet-mask 255.255.255.0ï¼šå­ç½‘æ©ç  é‡å¯ isc-dhcp-serverï¼Œè®©é…ç½®ç”Ÿæ•ˆï¼š systemctl restart isc-dhcp-server 6.5.6. å¼€å¯ IP è½¬å‘ç»è¿‡å¦‚ä¸Šå†…å®¹çš„é…ç½®ï¼Œæ¥å…¥ eth1 çš„è®¾å¤‡ï¼Œå’Œè¿æ¥å…¥æ— çº¿ AP çƒ­ç‚¹çš„è®¾å¤‡ï¼Œéƒ½èƒ½è·å–åˆ° 192.168.4.0/24 ç½‘æ®µçš„ IPï¼Œä¸”éƒ½èƒ½ ping é€š 192.168.4.1ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹åˆ°è®¾å¤‡è·å–åˆ°çš„ DNS æœåŠ¡å™¨åœ°å€ã€‚ä½†æ˜¯è®¾å¤‡è¿˜æ— æ³•è®¿é—® internetã€‚ å¼€å¯ IP è½¬å‘ sysctl -w net.ipv4.ip_forward=1 è®¾ç½® MASQUERADEï¼ˆåœ°å€æ¬ºéª—ï¼‰ã€‚MASQUERADE ä¸ SNAT ä½œç”¨å¤§è‡´ä¸€æ ·ï¼ŒMASQUERADE ä¸ç”¨æŒ‡å®šæ˜ç¡®çš„ IPï¼Œä¼šåŠ¨æ€çš„å°†æŠ¥æ–‡çš„æºåœ°å€ä¿®æ”¹ä¸ºæŒ‡å®šç½‘å¡ä¸Šå¯ç”¨çš„ IP åœ°å€ã€‚ iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE æ³¨æ„ï¼Œè¿™é‡ŒæŒ‡å®šä¸º eth0ï¼Œè®© Firefly Board æ‰€æœ‰çš„ IP åŒ…å…¨éƒ¨è½¬å‘åˆ° eth0ï¼Œè®©å¤–è®¾èƒ½å¤Ÿè¿›è¡Œä¸Šç½‘ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥æŒ‡å®šä¸ºä»»ä½•èƒ½è®¿é—®å¤–ç½‘çš„ç½‘å¡ï¼Œæ¯”å¦‚ 4G ç½‘å¡ usb0ï¼Œwwan0ï¼Œä¸¾ä¸€åä¸‰ã€‚ ç°åœ¨ä¿å­˜ IPv4ï¼ˆåŒ…æ‹¬ä¸Šé¢çš„è§„åˆ™ï¼‰å’Œ IPv6 çš„å½“å‰é˜²ç«å¢™è§„åˆ™ï¼Œä»¥ä¾¿åœ¨å¯åŠ¨æ—¶ç”± netfilter-persistent æœåŠ¡åŠ è½½ï¼š netfilter-persistent save 6.6. ä½¿ç”¨ ip å’Œ netplan é…ç½® IP åœ°å€å’Œè·¯ç”±6.6.1. é™æ€ IP åœ°å€é…ç½®ä¸€ä¸ªç½‘å£æ¥å£ä¸Šå¯ä»¥åŒæ—¶é…ç½®å¤šä¸ª IP åœ°å€ï¼Œè¿™äº› IP åœ°å€å¯ä»¥å±äºåŒä¸€ç½‘ç»œï¼Œä¹Ÿå¯ä»¥ä¸å±äºåŒä¸€ç½‘ç»œã€‚ç¬¬ä¸€ä¸ªé…ç½®çš„ IP åœ°å€é»˜è®¤ä¸ºæ¥å£çš„ä¸» IP åœ°å€ï¼Œåé¢é…ç½®çš„ IP åœ°å€ä¸ºæ¥å£çš„ä» IP åœ°å€ã€‚ 6.6.1.1. å¸¸ç”¨çš„ IP é…ç½®å‘½ä»¤ï¼š// è®¾ç½®æ¥å£çš„ IP åœ°å€ip address add PREFIX [ broadcast ADDR ] dev IFNAME// åˆ é™¤æ¥å£çš„ IP åœ°å€ip address del PREFIX dev IFNAME// æŸ¥çœ‹æ¥å£çš„ IP åœ°å€ip address show/list [ dev IFNAME ]// æ¸…ç©ºæ¥å£çš„æ‰€æœ‰ IP åœ°å€ip address flush [ dev IFNAME ] 6.6.1.2. é…ç½®ä¸¾ä¾‹ï¼šä¸º eth0 æ¥å£é…ç½®ä¸» IPï¼š192.168.2.2ï¼Œä» IPï¼š192.168.2.3 ä¸´æ—¶é…ç½® ip address add 192.168.2.2/24 dev eth0ip address add 192.168.2.3/24 dev eth0 æŒä¹…åŒ–é…ç½®ï¼šä½¿ç”¨ Netplan network: version: 2 renderer: networkd ethernets: eth0: dhcp4: no addresses: - 192.168.2.2/24 - 192.168.2.3/24 6.6.2. åŠ¨æ€ IP åœ°å€é…ç½®æ“ä½œç³»ç»Ÿä¸€èˆ¬éƒ½ä¼šä¸ºç½‘ç»œæ¥å£è‡ªåŠ¨åˆ†é… IP åœ°å€ã€‚å¯¹äº buildroot ç³»ç»Ÿä¸­ï¼Œdhcpcd æœåŠ¡ä¼šå‘é€ dhcp è¯·æ±‚åˆ° DHCP æœåŠ¡å™¨ï¼ˆè¿™é‡Œçš„ DHCP æœåŠ¡å™¨å¤§æ¦‚ç‡æ˜¯çš„è·¯ç”±ï¼‰è¯·æ±‚æ¥å£çš„ IP åœ°å€ã€‚è€Œåœ¨ Ubuntu ç³»ç»Ÿä¸­ï¼Œä¼šç”± NetworkManager æ¥å®Œæˆè¿™ä¸€è¿‡ç¨‹ã€‚ ä¸´æ—¶é…ç½® udhcpc -i eth0/eth1# æˆ–è€…dhclient eth0/eth1 æŒä¹…åŒ–é…ç½®ï¼šä½¿ç”¨ netplan network: version: 2 renderer: networkd ethernets: eth0: dhcp4: yes 6.6.3. é™æ€è·¯ç”±é…ç½®ä¸é™æ€è·¯ç”±ç›¸å¯¹çš„æ˜¯åŠ¨æ€è·¯ç”±ï¼ŒåŠ¨æ€è·¯ç”±æœ‰ OSPF å’Œ RIPï¼Œè¿™ä¸¤ä¸ªåè®®åªå­˜åœ¨äºè·¯ç”±å™¨ä¸­ã€‚å¯¹äºéè·¯ç”±å™¨è®¾å¤‡ï¼Œå¦‚æœæŸä¸ªç›®çš„ç½‘æ®µæ— æ³•ç›´æ¥åˆ°è¾¾ï¼Œéœ€è¦é…ç½®é™æ€è·¯ç”±ï¼Œå‘Šè¯‰è®¾å¤‡ç›®çš„ç½‘æ®µï¼Œå‡ºæ¥å£ï¼Œä¸‹ä¸€è·³çš„ IP åœ°å€ã€‚ 6.6.3.1. å¸¸ç”¨çš„é…ç½®å‘½ä»¤ï¼š# æŸ¥çœ‹è·¯ç”±è¡¨route -n # æˆ–è€…netstat -rn# æ·»åŠ  IP é™æ€è·¯ç”±ip route add PREFIX via ADDRESS dev IFNAME [ metric METRIC ]# åˆ é™¤ IP é™æ€è·¯ç”±ip route del PREFIX via ADDRESS dev IFNAME [ metric METRIC ]# æ¸…ç©º IP è·¯ç”±ip route flush dev IFNAME 6.6.3.2. é…ç½®ä¸¾ä¾‹ï¼šå‡è®¾å­˜åœ¨è¿™æ ·çš„ä¸€ä¸ªç½‘ç»œæ‹“æ‰‘ï¼Œå›¾ä¸­çš„ Router1 å’Œ Router2 æ˜¯ä»¬çš„å¼€å‘æ¿è®¾å¤‡ï¼Œè¿è¡Œçš„ç³»ç»Ÿæ˜¯ Ubuntu æ“ä½œç³»ç»Ÿã€‚åœ¨è¿™ä¸ªç½‘ç»œä¸­ï¼Œå¯¹äº Router1ï¼Œç½‘æ®µ 192.168.2.024 å’Œç½‘æ®µ 192.168.3.024ï¼Œå®ƒä»¬å¯¹äº Router1 å±äºç›´è¿ç½‘æ®µï¼Œæ„å‘³ç€å¯¹äº PC-A æ¥è¯´ï¼Œè®¿é—®ç½‘æ®µ 192.168.2.024 å’Œç½‘æ®µ 192.168.3.024 æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯å´ä¸èƒ½è®¿é—®ç½‘æ®µ 192.168.4.024ã€‚è¿™æ˜¯å› ä¸ºå¯¹äºç½‘æ®µ 192.168.4.024ï¼Œå¯¹ Router1 æ¥è¯´æ˜¯ä¸å¯è§çš„ã€‚éœ€è¦åœ¨ Router1 é…ç½®é™æ€è·¯ç”±ï¼Œè¿™æ¡é™æ€è·¯ç”±è¡¨æ˜åˆ°ç›®çš„ç½‘æ®µ 192.168.4.024ï¼Œéœ€è¦ç»è¿‡ä¸‹ä¸€æ¡ IP åœ°å€ä¸º 192.168.3.224ï¼Œå‡ºæ¥å£ä¸º Router1 çš„ eth1ã€‚åŒæ ·çš„ï¼Œå¯¹äº Router2 æ¥è¯´ï¼Œç½‘æ®µ 192.168.3.024 å’Œç½‘æ®µ 192.168.4.024 å±äºç›´è¿ç½‘æ®µï¼ŒPC-B ä¹ŸåŒæ ·æ— æ³•è®¿é—® 192.168.2.024 ç½‘æ®µï¼Œéœ€è¦åœ¨ Router2 é…ç½®ä¸€æ¡é™æ€è·¯ç”±ï¼Œè¡¨æ˜åˆ°ç›®çš„ç½‘ç»œ 192.168.2.024ï¼Œéœ€è¦ç»è¿‡ä¸‹ä¸€è·³ IP åœ°å€ä¸º 192.168.3.124ï¼Œå‡ºæ¥å£ä¸ºä¸º Router2 çš„ eth1ã€‚ ä¸´æ—¶é…ç½® å¯¹äº Router1ï¼š # å¼€å¯IPè½¬å‘åŠŸèƒ½echo 1 /proc/sys/net/ipv4/ip_forward# è®¾ç½®eth0, eth1çš„IPåœ°å€ip addr add 192.168.2.1/24 dev eth0ip addr add 192.168.3.1/24 dev eth1# é…ç½®é™æ€è·¯ç”±ip route add 192.168.4.0/24 via 192.168.3.2 dev eth1 å¯¹äº Router2ï¼š # å¼€å¯IPè½¬å‘åŠŸèƒ½echo 1 /proc/sys/net/ipv4/ip_forward# è®¾ç½®eth0, eth1çš„IPåœ°å€ip addr add 192.168.4.1/24 dev eth0ip addr add 192.168.3.2/24 dev eth1# é…ç½®é™æ€è·¯ç”±ip route add 192.168.2.0/24 via 192.168.3.1 dev eth1 æŒä¹…åŒ–é…ç½® å¯¹ Router1 å’Œ Router2ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ°¸ä¹…å¼€å¯ IP è½¬å‘ sysctl -w net.ipv4.ip_forward=1 å¯¹äº Router1ï¼Œé…ç½® Netplan network: version: 2 renderer: networkd ethernets: eth0: addresses: - 192.168.2.1/24 eth1: addresses: - 192.168.3.1/24 routes: - to: 192.168.4.0/24 via: 192.168.3.2 å¯¹äº Router2ï¼Œé…ç½® Netplan network: version: 2 renderer: networkd ethernets: eth0: addresses: - 192.168.4.1/24 eth1: addresses: - 192.168.3.2/24 routes: - to: 192.168.2.0/24 via: 192.168.3.1 6.6.4. é»˜è®¤è·¯ç”±é…ç½® ä¸´æ—¶é…ç½® å¯¹äºé€šè¿‡ DCHP æœåŠ¡åŠ¨æ€è·å– IP åœ°å€çš„æ¥å£ï¼Œæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºå…¶åˆ†é…ä¸€æ¡é»˜è®¤è·¯ç”±ã€‚å¯¹äºé™æ€ IP åœ°å€é…ç½®ï¼Œéœ€è¦æ‰‹åŠ¨ä¸ºå…¶è®¾ç½®é»˜è®¤è·¯ç”±ã€‚ è¿˜æ˜¯ä»¥ä¸Šé¢çš„ä¾‹å­æ¥è®²è§£ï¼Œå‡è®¾ PC-A æ˜¯ä¸€ä¸ª Linux æ“ä½œç³»ç»Ÿï¼Œä»¬éœ€è¦è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š # é…ç½®ç½‘å¡ IPï¼Œå‡è®¾å…¶ç½‘å¡ä¸ºeth0ip addr add 192.168.2.2/24 dev eth0# é…ç½®é»˜è®¤è·¯ç”±ip route add 0.0.0.0/0 via 192.168.2.1 dev eth0 æŒä¹…åŒ–é…ç½®ï¼šä½¿ç”¨ Netplan network: version: 2 renderer: networkd ethernets: eth0: addresses: - 192.168.2.2/24 routes: - to: 0.0.0.0/0 via: 192.168.2.1 6.6.5. è°ƒæ•´é»˜è®¤è·¯ç”±é¡ºåºåœ¨åŒç½‘å£çš„å¼€å‘æ¿ä¸­ï¼Œå¦‚æœä¸¤ä¸ªç½‘å£çš„ IP åœ°å€æ˜¯é€šè¿‡ DHCP è‡ªåŠ¨è·å–çš„ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿä¼šç”Ÿæˆä¸¤æ¡é»˜è®¤è·¯ç”±ï¼Œæ¯ä¸ªç½‘å£åˆ†åˆ«æœ‰ä¸€æ¡é»˜è®¤è·¯ç”±ï¼Œå…ˆæ’å…¥ç½‘çº¿çš„ç½‘å£æˆ–è€…å…ˆè·å¾— IP çš„ç½‘å£ï¼Œä¼šè·å¾—æ›´é«˜çš„è·¯ç”±ä¼˜å…ˆçº§ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæœ‰ä¸¤æ¡é»˜è®¤è·¯ç”±ï¼Œeth0 ç½‘å¡çš„é»˜è®¤è·¯ç”±ä¼˜å…ˆçº§é«˜äº eth1ã€‚è¿™å°±æ„å‘³ç€å¼€å‘æ¿é»˜è®¤é€šä¿¡çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ eth0 ç½‘å¡ã€‚ root@firefly:~# ip route listdefault via 168.168.0.1 dev eth0 proto dhcp metric 100 default via 168.168.0.1 dev eth1 proto dhcp metric 101 168.168.0.0/16 dev eth0 proto kernel scope link src 168.168.110.72 metric 100 168.168.0.0/16 dev eth1 proto kernel scope link src 168.168.110.111 metric 101 6.6.5.1. é…ç½®ä¸¾ä¾‹ï¼šå‡è®¾å­˜åœ¨ä¸€ç§æƒ…å†µï¼ŒWireless Router1 çš„ç½‘æ®µä¸º 192.168.3.024ï¼ŒWireless Router2 çš„ç½‘æ®µä¸º 192.168.2.024ï¼Œæ­¤æ—¶å¯¹äº Firefly Board æ¥è¯´ï¼Œeth0 å’Œ eth1 éƒ½æ˜¯åŠ¨æ€è·å– IP åœ°å€ï¼Œå¦‚æœ eth0 çš„é»˜è®¤è·¯ç”±çš„ä¼˜å…ˆçº§æ¯” eth1 çš„é»˜è®¤è·¯ç”±ä¼˜å…ˆçº§é«˜ï¼Œé€šä¿¡æ—¶å°†ä½¿ç”¨ eth0 çš„é»˜è®¤è·¯ç”±ï¼Œç”±äº eth0 æ‰€åœ¨ç½‘ç»œæ— å¤–ç½‘è¿æ¥ï¼ŒFirefly Board å°±æ— æ³•è®¿é—® Internetï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ä¿®æ”¹é»˜è®¤è·¯ç”±çš„ä¼˜å…ˆçº§æ¥è§£å†³ã€‚ å…¶ Netplan é…ç½®å¦‚ä¸‹ï¼Œeth1 çš„ metric æ•°å€¼å°äº eth0ï¼Œæ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ network: version: 2 ethernets: eth0: dhcp4: yes dhcp4-overrides: route-metric: 200 eth1: dhcp4: yes dhcp4-overrides: route-metric: 100 6.7. iptables NAT é…ç½®ç½‘ç»œè½¬æ¢æŠ€æœ¯ä¹Ÿç§°ä¸º NATï¼ˆNetwork Address Translationï¼‰æŠ€æœ¯ï¼Œå®ƒçš„åŸºæœ¬ä½œç”¨å°±æ˜¯å®ç°ç§æœ‰ IP åœ°å€å’Œå…¬æœ‰ IP åœ°å€ä¹‹é—´çš„è½¬æ¢ã€‚ åœ¨ Linux ç³»ç»Ÿä¸­ï¼ŒNAT å¯ä»¥ç»†åŒ–ä¸º SNATï¼ˆSource Network Address Translationï¼‰å’Œ DNATï¼ˆDestinationnetwork address translationï¼‰ã€‚SNAT ä¹Ÿç§°ä¸ºæºåœ°å€è½¬æ¢æŠ€æœ¯ï¼Œç”¨äºå½“ç§ç½‘ä¸»æœºå‘å¤–ç½‘ä¸»æœºå‘èµ·ç½‘ç»œé€šä¿¡æ—¶ï¼ŒIP æ•°æ®åŒ…åœ¨åˆ°è¾¾å¤–ç½‘ç½‘ç»œä¹‹å‰ï¼Œå°† IP æ•°æ®åŒ…ä¸­çš„æº IP ä¿®æ”¹ä¸ºè·¯ç”±å™¨æˆ–è€…é˜²ç«å¢™çš„ IP åœ°å€ï¼Œè¿™æ ·å¤–ç½‘ä¸»æœºå°±æ— æ³•è·çŸ¥å†…ç½‘ä¸»æœºçš„ç§ç½‘ IP åœ°å€ã€‚DNAT ä¹Ÿç§°ä¸ºç›®æ ‡åœ°å€è½¬æ¢æŠ€æœ¯ï¼Œç”¨äºå½“å¤–ç½‘ä¸»æœºéœ€è¦è®¿é—®å†…ç½‘ä¸»æœºæä¾›çš„ç½‘ç»œæœåŠ¡æ—¶ï¼Œæ¯”å¦‚ httpï¼ŒIP æ•°æ®åŒ…åˆ°è¾¾è·¯ç”±å™¨æˆ–è€…é˜²ç«å¢™æ—¶ï¼Œç”±å®ƒä»¬å°† IP æ•°æ®åŒ…ä¸­çš„ç›®æ ‡ IP æ”¹ä¸ºæä¾›ç½‘ç»œæœåŠ¡çš„ç§ç½‘ä¸»æœº IPã€‚ 6.7.1. å¸¸ç”¨å‘½ä»¤ä»¬å¯ä»¥é€šè¿‡é…ç½® iptables çš„ nat è¡¨ï¼Œæ¥å®ç° SNAT å’Œ DNAT # æŸ¥çœ‹natè§„åˆ™iptables -t nat -vnL# æ¸…ç©ºnatè§„åˆ™iptables -t nat -F# æ·»åŠ ä¸€ä¸ªSNATè§„åˆ™ï¼Œå°†å†…ç½‘çš„IPï¼Œæ˜ å°„åˆ°å¤–ç½‘çš„IPiptables -t nat -A POSTROUTING -s LocalIP -j SNAT --to-source ExtIP# æ·»åŠ ä¸€ä¸ªDNATè§„åˆ™ï¼Œå°†å¤–ç½‘çš„IPå’Œç«¯å£ï¼Œæ˜ å°„åˆ°å†…ç½‘çš„IPå’Œç«¯å£iptables -t nat -A PREROUTING -d ExtIP -p tcp|udp --dport PORT -j DNAT --to-destination LocalIP[:PORT] iptables ä¹Ÿæ”¯æŒ MASQUERADEï¼ˆåœ°å€æ¬ºéª—ï¼‰ï¼Œå®ƒçš„ä½œç”¨ä¸ SNAT åŸºæœ¬ç›¸åŒï¼Œä¹Ÿå¯ä»¥èµ·åˆ°æºåœ°å€è½¬æ¢çš„ä½œç”¨ã€‚åœ¨ä¸€ç§ç‰¹æ®Šæƒ…å†µä¸­ï¼Œå¦‚æœå¤–ç½‘çš„ IP åœ°å€ä¸æ˜¯ä¸€ä¸ªå›ºå®šä¸”é•¿æœŸæœ‰æ•ˆçš„ IP åœ°å€ï¼Œæ¯”å¦‚æ˜¯é€šè¿‡ pppoe è¿›è¡Œæ‹¨å·åŠ¨æ€è·å–çš„ IP åœ°å€ï¼Œå°±å¯ä»¥ä½¿ç”¨ MASQUERADE æ¥å®ç°æºåœ°å€è½¬æ¢ã€‚MASQUERADE åˆ™ä¸ç”¨æŒ‡å®šæ˜ç¡®çš„ IPï¼Œä¼šåŠ¨æ€çš„å°†æŠ¥æ–‡çš„æºåœ°å€ä¿®æ”¹ä¸ºæŒ‡å®šç½‘å¡ä¸Šå¯ç”¨çš„ IP åœ°å€ã€‚ # æ·»åŠ ä¸€ä¸ªMASQUERADEè§„åˆ™ï¼Œå°†å†…ç½‘çš„IPï¼Œæ˜ å°„åˆ°å¤–ç½‘ç½‘å¡æ‰€åœ¨çš„IPï¼ˆè¿™é‡Œçš„å†…ç½‘IPå¯ä»¥çœç•¥ï¼Œåˆ™é»˜è®¤å°†æ‰€æœ‰å†…ç½‘çš„IPï¼Œéƒ½æ˜ å°„åˆ°å¤–ç½‘ç½‘å¡æ‰€åœ¨çš„IPï¼‰iptables -t nat -A POSTROUTING [-s LocalIP] -o IFNAME -j MASQUERADE 6.7.2. é…ç½®ä¸¾ä¾‹å‡è®¾å­˜åœ¨è¿™æ ·çš„ä¸€ä¸ªç½‘ç»œæ‹“æ‰‘ï¼Œç”¨ 10.1.0.016 æ¥æ¨¡æ‹Ÿä¸€ä¸ªå…¬ç½‘ç½‘ç»œï¼Œç”¨ 192.168.1.024 æ¥æ¨¡æ‹Ÿç§æœ‰ç½‘ç»œã€‚å›¾ä¸­çš„æœºå™¨éƒ½æ˜¯ç”¨ Linux ä¸»æœºè¿›è¡Œæ¨¡æ‹Ÿçš„æœºå™¨ã€‚ å¯¹äº Router1ï¼Œæ˜¯ä¸€ä¸ªè¿æ¥å†…å¤–ç½‘çš„è·¯ç”±å™¨ï¼Œå…¶ netplan é…ç½®å¦‚ä¸‹ï¼š network: version: 2 renderer: networkd ethernets: eth0: addresses: - 192.168.1.3/24 eth1: addresses: - 10.1.0.7/16 åŒæ—¶å¯¹äº Router1ï¼Œéœ€è¦å¼€å¯ IP è½¬å‘åŠŸèƒ½ï¼š echo 1 /proc/sys/net/ipv4/ip_forward å¯¹äº Internet PCï¼Œæ˜¯ä¸€ä¸ªå¤–ç½‘çš„ä¸ªäººä¸»æœºï¼Œå…¶ netplan é…ç½®å¦‚ä¸‹ï¼š network: version: 2 renderer: networkd ethernets: eth0: addresses: - 10.1.0.6/16 å¯¹äº Web Serverï¼Œæ˜¯ä¸€ä¸ªç§ç½‘æœåŠ¡å™¨ï¼Œæä¾› http æœåŠ¡ï¼Œå…¶ netplan é…ç½®å¦‚ä¸‹ï¼š network: version: 2 renderer: networkd ethernets: eth0: addresses: - 192.168.1.100/24 routes: - to: 0.0.0.0/0 via: 192.168.1.3/24 6.7.3. SNATéœ€æ±‚ï¼šç›®å‰çš„ç½‘ç»œç»“æ„ä¸­ï¼Œå†…ç½‘ä¸»æœºæ˜¯æ— æ³•è®¿é—®å¤–ç½‘çš„ã€‚ æ·»åŠ ä¸€æ¡ SNAT è§„åˆ™ï¼Œä¿®æ”¹å†…ç½‘ä¸»æœºå‘å¾€å¤–ç½‘çš„ IP æ•°æ®åŒ…ï¼Œå°†æº IP åœ°å€ä¸º 192.168.1.024 ç½‘æ®µçš„ IPï¼Œä¿®æ”¹ä¸º 10.1.0.7 iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -j SNAT --to-source 10.1.0.7 éªŒè¯æ–¹æ³•ï¼š åœ¨å†…ç½‘çš„ Web Serverï¼Œping å¤–ç½‘çš„ Internet PC ~ ping -c 4 10.1.0.6 ok PING 10.1.0.6 (10.1.0.6) 56(84) bytes of data.64 bytes from 10.1.0.6: icmp_seq=1 ttl=63 time=2.15 ms64 bytes from 10.1.0.6: icmp_seq=2 ttl=63 time=2.12 ms64 bytes from 10.1.0.6: icmp_seq=3 ttl=63 time=1.99 ms64 bytes from 10.1.0.6: icmp_seq=4 ttl=63 time=2.14 ms--- 10.1.0.6 ping statistics ---4 packets transmitted, 4 received, 0% packet loss, time 7msrtt min/avg/max/mdev = 1.989/2.098/2.147/0.063 ms åœ¨å†…ç½‘çš„ Web Serverï¼ŒæŠ“åŒ… root@firefly:/# tcpdump -i eth1 -nn icmp tcpdump: verbose output suppressed, use -v or -vv for full protocol decodelistening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes03:33:37.503348 IP 10.1.0.7 10.1.0.6: ICMP echo request, id 53287, seq 1, length 6403:33:37.503603 IP 10.1.0.6 10.1.0.7: ICMP echo reply, id 53287, seq 1, length 6403:33:38.503348 IP 10.1.0.7 10.1.0.6: ICMP echo request, id 53287, seq 2, length 6403:33:38.503560 IP 10.1.0.6 10.1.0.7: ICMP echo reply, id 53287, seq 2, length 6403:33:39.504601 IP 10.1.0.7 10.1.0.6: ICMP echo request, id 53287, seq 3, length 6403:33:39.504812 IP 10.1.0.6 10.1.0.7: ICMP echo reply, id 53287, seq 3, length 6403:33:40.505347 IP 10.1.0.7 10.1.0.6: ICMP echo request, id 53287, seq 4, length 6403:33:40.505557 IP 10.1.0.6 10.1.0.7: ICMP echo reply, id 53287, seq 4, length 64 6.7.4. DNATéœ€æ±‚ï¼šå†…ç½‘ Web Server æä¾› http æœåŠ¡ï¼Œå¤–ç½‘ä¸»æœºæƒ³è¦è®¿é—®å†…ç½‘çš„ web ç½‘é¡µã€‚ æ·»åŠ ä¸€æ¡ DNAT è§„åˆ™ï¼Œä¿®æ”¹å¤–ç½‘å‘å¾€å†…ç½‘çš„ IP æ•°æ®åŒ…ï¼Œå°†ç›®çš„ IP åœ°å€ï¼Œå’Œç«¯å£å·ï¼Œä¿®æ”¹ä¸ºå†…ç½‘ Web æœåŠ¡å™¨çš„ IP å’Œç«¯å£å·ã€‚ iptables -t nat -A PREROUTING -d 10.1.0.7 -p tcp --dport 8000 -j DNAT --to-destination 192.168.1.100:8000 éªŒè¯æ–¹æ³•ï¼š åœ¨å¤–ç½‘ Internet PC è®¿é—®å†…ç½‘ Web Server çš„ Web æœåŠ¡ root@firefly:/# wget http://10.1.0.7:8000/index.html--2021-02-19 03:31:12-- http://10.1.0.7:8000/index.htmlConnecting to 10.1.0.7:8000... connected.HTTP request sent, awaiting response... 200 OKLength: 41323 (40K) [text/html]Saving to: â€˜index.htmlâ€™index.html 100%[===================] 40.35K --.-KB/s in 0.001s 2021-02-19 03:31:12 (29.8 MB/s) - â€˜index.htmlâ€™ saved [41323/41323] 6.7.5. MASQUERADEéœ€æ±‚ï¼šå¦‚æœè¿æ¥å†…å¤–ç½‘çš„ Router1ï¼Œå®ƒçš„å¤–ç½‘ç½‘å¡åªæœ‰ä¸€ä¸ªï¼Œä¸º eth1ï¼Œä¸” IP åœ°å€åŠ¨æ€è·å–ã€‚ è§£å†³æ–¹æ³•ï¼šæ·»åŠ ä¸€æ¡ MASQUERADE è§„åˆ™ï¼Œå°†å†…ç½‘ 192.168.1.024 å‘å¾€å¤–ç½‘çš„ IP æ•°æ®åŒ…ï¼Œä¿®æ”¹å…¶æº IP åœ°å€ä¸º eth1 ç½‘å¡çš„ IP åœ°å€ã€‚ iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o eth1 -j MASQUERADE 6.8. iptables filter é…ç½®iptables çš„ filter è¡¨ï¼ˆè¿‡æ»¤è§„åˆ™è¡¨ï¼‰ï¼Œç”¨äºæ§åˆ¶æ•°æ®åŒ…æ˜¯å¦å…è®¸è¿›å‡ºåŠè½¬å‘ã€‚filter è¡¨å¯ä»¥æ§åˆ¶çš„é“¾è·¯æœ‰ INPUTã€FORWARD å’Œ OUTPUTã€‚å¸¸ç”¨çš„åŠ¨ä½œæœ‰ ACCEPTï¼ŒDROPï¼ŒREJECTã€‚ 6.8.1. é€šç”¨å‘½ä»¤# æ¸…ç©ºfilterè¡¨iptables -t filter -F# æ˜¾ç¤ºfilterè¡¨iptables -t filter -nvL 6.8.2. ACCEPTï¼šå…è®¸æ•°æ®åŒ…é€šè¿‡é…ç½®ä¸¾ä¾‹ï¼šé»˜è®¤æƒ…å†µä¸‹ ssh ä½¿ç”¨ 22 ç«¯å£è¿›è¡Œ tcp é€šä¿¡ï¼Œå¦‚æœè¦å¼€å¯è¿œç¨‹è®¿é—®ï¼Œéœ€è¦å¼€å¯ 22 ç«¯å£çš„ tcp è¿æ¥ã€‚ iptables -A INPUT -t filter -p tcp --dport 22 -j ACCEPT å¼€å¯ ssh è®¿é—®ï¼Œå…è®¸ 192.168.0.024 ç½‘æ®µè¿›è¡Œè®¿é—® iptables -A INPUT -t filter -p tcp -s 192.168.0.0/24 --dport 22 -j ACCEPT å¼€å¯ ssh è®¿é—®ï¼Œå…è®¸æ”¶åˆ°çš„æ•°æ®åŒ…æ¥æºäº eth0 ç½‘å¡ iptables -A INPUT -t filter -p tcp -i eth0 --dport 22 -j ACCEPT å¼€å¯ ssh è®¿é—®ï¼Œå…è®¸ 192.168.0.024 ç½‘æ®µä¸­ MAC åœ°å€ä¸º 00:50:8D:FD:E6:32 çš„ä¸»æœºè¿›è¡Œè®¿é—® iptables -A INPUT -t filter -p tcp -s 192.168.0.0/24 --dport 22 -m mac --mac-source 00:50:8D:FD:E6:32 -j ACCEPT 6.8.3. REJECTï¼šæ‹’ç»æ•°æ®åŒ…é€šè¿‡REJECT åŠ¨ä½œçš„å¸¸ç”¨é€‰é¡¹ä¸ºâ€“reject-withï¼ˆä½¿ç”¨â€“reject-with é€‰é¡¹ï¼Œå¯ä»¥è®¾ç½®æç¤ºä¿¡æ¯ï¼Œå½“å¯¹æ–¹è¢«æ‹’ç»æ—¶ï¼Œä¼šæç¤ºå¯¹æ–¹ä¸ºä»€ä¹ˆè¢«æ‹’ç»ï¼‰ å¯¹äº ICMP åè®®ï¼Œå¯ç”¨å€¼å¦‚ä¸‹ï¼Œå¦‚æœä¸æä¾›ï¼Œé»˜è®¤ä¸º icmp-port-unreachable icmp-net-unreachableicmp-host-unreachableicmp-port-unreachable,icmp-proto-unreachableicmp-net-prohibitedicmp-host-pro-hibitedicmp-admin-prohibited é…ç½®ä¸¾ä¾‹ï¼šæ‹’æ¥å¤–éƒ¨ pingï¼Œå¹¶æç¤ºâ€Destination Host Unreachableâ€ iptables -A INPUT -t filter -p icmp -j REJECT --reject-with icmp-host-unreachable 6.8.4. DROPï¼šä¸¢å¼ƒæ•°æ®åŒ…é…ç½®ä¸¾ä¾‹ï¼šç›´æ¥å°†å¤–éƒ¨ ping åŒ…ä¸¢å¼ƒ iptables -A INPUT -t filter -p icmp -j DROP 7. Qt æ”¯æŒ7.1. Qt ç¯å¢ƒæ”¯æŒFirefly è®¾å¤‡ç³»ç»Ÿå¦‚æœæ˜¯ Ubuntu 22.04 å¯ä»¥ç›´æ¥é€šè¿‡ apt å®‰è£… Qt ç¯å¢ƒï¼š # å®‰è£…åŸºç¡€ç¯å¢ƒapt updateapt install -y qtcreator qtbase5-dev# å®‰è£…é¢å¤–ç»„ä»¶ä¸å¼€å‘ç¯å¢ƒï¼Œä¾‹å¦‚apt install -y libqt5multimedia5 qtmultimedia5-dev libqt5quick5 qtdeclarative5-dev å®‰è£…åç›´æ¥åœ¨è®¾å¤‡ä¸Šè¿›è¡Œå¼€å‘ã€‚ Ubuntu 18.04 æˆ–è€… Ubuntu 20.04 éœ€è¦å€ŸåŠ©ç”µè„‘è¿›è¡Œäº¤å‰ç¼–è¯‘ï¼Œè¯¦æƒ…è¯·çœ‹ä¸‹ä¸€ç«  7.2. Qt äº¤å‰ç¼–è¯‘ç¯å¢ƒæ”¯æŒFirefly å‘å¸ƒäº†ä¸¤ä¸ª Qt äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œé€‚ç”¨äºä»¥ä¸‹ç¯å¢ƒï¼Œè¯·æ ¹æ®éœ€æ±‚é€‰æ‹©: Qt: 5.12.2 Host: x86-64 Ubuntu 18.04 Target: Firefly RK3568 RK3566 RK3399 RK3328 PX30 Ubuntu 18.04 MinimalDesktop å’Œ Qt: 5.15 Host: x86-64 Ubuntu 20.04 Target: Firefly RK3588 RK3568 RK3566 Ubuntu 20.04 Desktop å·¥å…·é“¾å®Œæ•´æ”¯æŒ wenEngine, æ”¯æŒ EGLFS LinuxFB XCB ç­‰ backendã€‚ ä¸‹è½½åœ°å€ ç‚¹å‡» ä¸‹è½½é“¾æ¥(æå–ç ï¼šFFQT) éƒ¨ç½² è¯¦æƒ…å‚è§å·¥å…·é“¾ä¸­çš„ Qt5.1x.x_Release.md æ–‡ä»¶ æ³¨æ„ï¼Œæ–‡æ¡£ä¸­æ‰€æœ‰è·¯å¾„çš„åç§°ä¸å¯æ›´æ”¹ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¼–è¯‘æˆ–è€…è¿è¡Œå‡ºé”™ã€‚ ç¼–è¯‘ åœ¨ host ç«¯ï¼Œè¿›å…¥ Qt å·¥ç¨‹ç›®å½•ï¼Œqmake make å³å¯. è¿è¡Œ å·¥å…·é“¾ä¸­å«æœ‰ä¾‹ç¨‹ï¼Œç”¨æˆ·åœ¨éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥åœ¨ host ç«¯ build demoï¼Œåœ¨ tartget ç«¯è¿è¡Œ demo ä»¥æµ‹è¯•éƒ¨ç½²æ˜¯å¦æˆåŠŸã€‚ ç¡®å®šäº†ä½¿ç”¨å“ªä¸ªåç«¯ï¼Œå°±å¯ä»¥ä¿®æ”¹è®¾å¤‡ä¸­ etcprofile.dtarget_qtEnv.sh æ–‡ä»¶ï¼Œå»é™¤å¯¹åº”å¹³å°ç¯å¢ƒå˜é‡å‰é¢çš„ # ä½¿å…¶ä¸€ç›´ç”Ÿæ•ˆ # ä¾‹å¦‚ï¼Œä½¿ç”¨ XCB ï¼Œåˆ™å°†æ–‡ä»¶å†… XCB éƒ¨åˆ†å‰é¢çš„ # åˆ é™¤#XCBexport QT_QPA_PLATFORM=XCBexport QT_QPA_EGLFS_INTEGRATION=XCB_EGL 7.3. Qt åŒå±å¼‚æ˜¾Firefly Ubuntu ç³»ç»Ÿå¯ä»¥ä½¿ç”¨ Qt åº”ç”¨å®ç°åŒå±æ˜¾ç¤ºå’Œæ“ä½œã€‚ ï¼ˆ1ï¼‰è¿›å…¥æ¡Œé¢ç¯å¢ƒ export XAUTHORITY=/home/firefly/.Xauthorityexport DISPLAY=:0 ï¼ˆ2ï¼‰è®¾ç½®ç¯å¢ƒå˜é‡ export QT_QPA_PLATFORM=xcbexport QT_QPA_EGLFS_INTEGRATION=XCB_EGL ï¼ˆ3ï¼‰è¿è¡Œ Demo ./firefly_arm64_qt5.12.2_18.04/demo/double_panel_demo ï¼ˆ4ï¼‰Demo ä»£ç ç›®å½• firefly_arm64_qt5.12.2_18.04/example/double_panel_demo ï¼ˆ5ï¼‰ä»£ç ç¼–è¯‘ ï¼ˆ6ï¼‰æ·»åŠ è‡ªå·±çš„ Qt å·¥ç¨‹ åœ¨ example ç›®å½•ä¸‹æ·»åŠ ç”¨æˆ·è‡ªå·±çš„ Qt é¡¹ç›®å·¥ç¨‹ã€‚ ç¼–è¾‘ example ç›®å½•ä¸‹ gui.pro æ–‡ä»¶ã€‚ å‡è®¾å·¥ç¨‹ç›®å½•åä¸º double_panel_demoï¼Œåˆ™åœ¨ gui.pro æ–‡ä»¶ä¸­è¿½åŠ  SUBDIRS += double_panel_demoã€‚ æ‰§è¡Œå‘½ä»¤ qmake makeã€‚ ï¼ˆ7ï¼‰è¿è¡Œæ•ˆæœ 7.4. Qt Creatorç›®æ ‡å¹³å°çš„ç³»ç»Ÿæ˜¯ Ubuntu 22.04 åˆ™ä¸ç”¨çœ‹æœ¬ç« èŠ‚ï¼Œç›´æ¥åœ¨è®¾å¤‡ä¸Šä½¿ç”¨ qtcreatorï¼Œæ— éœ€ç‰¹æ®Šè®¾ç½®ã€‚ å…¶ä»–ç‰ˆæœ¬ç³»ç»Ÿéœ€è¦äº¤å‰ç¼–è¯‘ qtï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹ï¼š ä¸‹é¢ä»‹ç»ä¸»æœºä¸Š Qt Creator çš„ä½¿ç”¨è¯´æ˜ï¼Œåœ¨æ“ä½œå‰ï¼Œè¯·å…ˆå®‰è£…ã€é…ç½®å¥½ Qt äº¤å‰ç¼–è¯‘ç¯å¢ƒå’Œè¿è¡Œç¯å¢ƒã€‚ 7.4.1. å®‰è£…è¿›å…¥ Qt å®˜æ–¹ä¸‹è½½é¡µé¢ï¼Œé€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬ä¸‹è½½ qt-creator-opensource-linux-x86_64-x.x.x.runï¼Œä¸‹è½½å®Œæˆä¹‹åï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œ ./xxxx.run è¿è¡Œå®‰è£…ï¼Œæ³¨æ„æ–‡ä»¶éœ€è¦æœ‰æ‰§è¡Œæƒé™ã€‚ 7.4.2. é…ç½®ä¸‹é¢ä»¥ firefly-qt-5.12.2-aarch64 ç¯å¢ƒä½œä¸ºä¾‹å­è¿›è¡Œé…ç½®ï¼Œç›®æ ‡å¹³å°æ˜¯ Buildroot ç³»ç»Ÿï¼š ç›®æ ‡å¹³å°ç³»ç»Ÿä¸åŒï¼Œé…ç½®ä¹Ÿç¨æœ‰ä¸åŒï¼Œæ‰€ä»¥è¯·ä»”ç»†æŸ¥çœ‹æ–‡å­—è¯´æ˜ï¼Œå›¾ç‰‡ä»…ä¾›å‚è€ƒï¼Œä¸è¦ç…§æ¬å›¾ç‰‡ä¸­çš„é…ç½® å®‰è£…å®Œæˆåï¼Œå¯åŠ¨ Qt Creatorï¼Œæ‰“å¼€èœå• Tools - Optionsï¼Œæ‰¾åˆ° Kitsã€‚ é…ç½® Qt Versions ç‚¹å‡»å³ä¾§ add æŒ‰é’®æ·»åŠ ï¼Œé€‰æ‹© Qt ç¯å¢ƒå®‰è£…ä½ç½®ä¸­çš„ qmake å³å¯ qmakeï¼š/opt/firefly-qt-5.12.2-aarch64/host/bin/qmake é…ç½® Compilers ç‚¹å‡»å³ä¾§ add æŒ‰é’®æ·»åŠ  gcc å’Œ g++ äº¤å‰ç¼–è¯‘å™¨çš„ä½ç½® å¦‚æœä¸»æœºå®‰è£…äº† crossbuild-essential-arm64ï¼Œåˆ™ç¼–è¯‘å™¨å°±åœ¨ /usr/bin/ ä¸‹ å¦‚æœä½¿ç”¨äº†ç¬¬ä¸‰æ–¹çš„äº¤å‰ç¼–è¯‘å™¨ï¼Œæ‰¾åˆ°å®‰è£…ä½ç½®å¹¶æ·»åŠ å³å¯ å¦‚æœç›®æ ‡å¹³å°æ˜¯ Buildrootï¼Œåˆ™éœ€è¦ä½¿ç”¨ Buildroot Qt ç¯å¢ƒåŒ…ä¸­çš„ç¼–è¯‘å™¨ g++ï¼š/opt/firefly-qt-5.12.2-aarch64/host/bin/aarch64-buildroot-linux-gnu-g++ gccï¼š/opt/firefly-qt-5.12.2-aarch64/host/bin/aarch64-buildroot-linux-gnu-gcc ä¸ºæ–¹ä¾¿è°ƒè¯•ï¼Œé…ç½® Debuggers å’Œ Devices ç”¨äºåœ¨çº¿è°ƒè¯•ï¼š é…ç½® Debuggers é¦–å…ˆä¸»æœºä¸­å®‰è£… gdb-multiarchï¼šapt install -y gdb-multiarch æ£€æŸ¥ç›®æ ‡æœºä¸Šæ˜¯å¦å­˜åœ¨ usrbingdbserverï¼Œæ²¡æœ‰çš„è¯éœ€è¦å®‰è£…ï¼šapt install -y gdbserver (Buildroot è‡ªå¸¦ï¼Œæ— éœ€å®‰è£…) å›åˆ°ä¸»æœºçš„ Qt Creatorï¼Œç‚¹å‡»å³ä¾§ add æŒ‰é’®æ·»åŠ  gdb é€‰æ‹©ä¸»æœºä¸­çš„ gdb-multiarch ï¼š/usr/bin/gdb-multiarch é…ç½® Devices è®¾ç½®å¥½è®¾å¤‡çš„ IPã€ç”¨æˆ·å (root) å’Œå¯†ç  (firefly) ã€‚ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œå¯ä»¥åœ¨è®¾å¤‡ä¸Šè®¾ç½®é™æ€ IPã€‚ GDB server è®¾ç½®ä¸º /usr/bin/gdbserver é…ç½® Kits å°†å‰é¢è®¾ç½®çš„é…ç½®é¡¹æ·»åŠ åˆ° Kitsã€‚ å¦‚æœç›®æ ‡å¹³å°æ˜¯ Ubuntu ç³»ç»Ÿï¼Œè¿™ä¸€æ­¥ä¹Ÿéœ€è¦æ·»åŠ  sysroot çš„è·¯å¾„ 7.4.3. ç¼–è¯‘è¿è¡Œæ‰“å¼€ demo ç¨‹åºï¼ŒWelcome - Open Projectï¼Œé€‰æ‹©è¦ä½¿ç”¨çš„ Kitsï¼š ä¹‹åæ‰“å¼€ Projects - Runï¼Œé…ç½®å‘½ä»¤è¡Œå‚æ•°ï¼Œè¿™é‡Œè®¾ç½®ä¸º -platform waylandï¼š ç›®æ ‡å¹³å°æ˜¯ Ubuntu åˆ™ä½¿ç”¨ -platform xcb (Ubuntu æ¡Œé¢ç¯å¢ƒ)ï¼Œæˆ–è€…æ ¹æ®éœ€è¦é€‰æ‹© linuxfbã€eglfs é…ç½®ç¯å¢ƒå˜é‡ï¼Œå³ export XDG_RUNTIME_DIR=/tmp/.xdgï¼š RK356X Buildroot åˆ™éœ€è¦ä½¿ç”¨ /var/run è€Œä¸æ˜¯ /tmp/.xdg ç›®æ ‡å¹³å°æ˜¯ Ubuntu åˆ™éœ€è¦æ ¹æ®ä¹‹å‰è®¾ç½®çš„ platform æ·»åŠ ä¸åŒçš„ç¯å¢ƒå˜é‡ï¼Œè¯¦æƒ…åœ¨ Qt ç¯å¢ƒåŒ…ä¸­çš„è¯´æ˜æ–‡ä»¶ä¸­ å¦‚æœç›®æ ‡å¹³å°çš„è¿è¡Œç¯å¢ƒ(æœ¬æ–‡å¼€å¤´æåˆ°çš„)ä¹‹å‰å·²ç»é…ç½®å¥½å¹¶æˆåŠŸè¿è¡Œ demoï¼Œæ­¤æ—¶å¯ä»¥ç›´æ¥ç‚¹å‡»å³ä¾§ Fetch Device Environment è·å–ç›®æ ‡çš„ç¯å¢ƒå˜é‡ ç¼–è¯‘è¿è¡Œï¼š ç‚¹å‡» Build äº¤å‰ç¼–è¯‘ Qt ç¨‹åºï¼›ç‚¹å‡» Run æˆ– Debug åœ¨è®¾å¤‡ä¸Šè¿è¡Œæˆ–è°ƒè¯•ç¨‹åºã€‚è¦é‡æ–°è¿è¡Œç¨‹åºæ—¶ï¼Œè®°å¾—æ‰‹åŠ¨ç‚¹å‡» Stop å…³é—­å·²ç»è¿è¡Œçš„ç¨‹åºã€‚ ç¼–è¯‘ç”Ÿæˆç›®å½•å’Œ demo ç›®å½•åœ¨åŒä¸€ä½ç½®ã€‚ 8. Docker æ”¯æŒFirefly å‘å¸ƒçš„æ™®é€šå›ºä»¶ä¸€èˆ¬ä¸æ»¡è¶³ Docker çš„è¿è¡Œè¦æ±‚ï¼Œå¦‚æœæœ‰éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ SDK æ‰“å¼€å†…æ ¸çš„ç›¸å…³é…ç½®ï¼Œé‡æ–°ç¼–è¯‘çƒ§å½•å†…æ ¸ä»¥æ”¯æŒ Dockerã€‚ ï¼ˆRK356X v1.2.4a åŠä»¥åç‰ˆæœ¬ ã€RK3399RK3588 é»˜è®¤æ”¯æŒ Dockerï¼Œå¯ç›´è·³åˆ° å®‰è£… Docker æ­¥éª¤ï¼‰ ä»¥ä¸‹æ¡ˆä¾‹æ˜¯åŸºäº Firefly Ubuntu 20.04ï¼Œå†…æ ¸é…ç½®éƒ¨åˆ†æ˜¯é€šç”¨çš„ï¼ 8.1. æ£€æŸ¥ Kernel é…ç½®é¦–å…ˆéœ€è¦é€šè¿‡å·¥å…·æ£€æŸ¥å½“å‰è®¾å¤‡çš„å†…æ ¸ç¼ºå°‘äº†å“ªäº› Docker éœ€è¦çš„é…ç½®ã€‚æ£€æµ‹è„šæœ¬ check-config.sh å¯ä»¥å‰å¾€ ç¤¾åŒºè®ºå› è·å–ã€‚ è·å–åˆ°è„šæœ¬ä¹‹åï¼Œå¼€å§‹è¿›è¡Œæ£€æµ‹ï¼š #å°†è„šæœ¬æ‹·è´åˆ°SDKçš„kernelç›®å½•ä¸‹cp check-config.sh PathToSDK/kernel/cd PathToSDK/kernelchmod +x check-config.sh#è·å–å½“å‰å†…æ ¸é…ç½®make ARCH=arm64 firefly_linux_defconfig#æ£€æµ‹./check-config.sh .config æ‰§è¡Œåçš„ç»“æœå¦‚ä¸‹ï¼Œä¸»è¦æ˜¯ä¸¤éƒ¨åˆ†ï¼š Generally Necessary:- cgroup hierarchy: properly mounted [/sys/fs/cgroup]- apparmor: enabled and tools installed- CONFIG_NAMESPACES: enabled- CONFIG_NET_NS: enabled- CONFIG_PID_NS: enabled- CONFIG_IPC_NS: enabled- CONFIG_UTS_NS: enabled- CONFIG_CGROUPS: enabled......Optional Features:- CONFIG_USER_NS: enabled- CONFIG_SECCOMP: enabled- CONFIG_SECCOMP_FILTER: enabled- CONFIG_CGROUP_PIDS: enabled- CONFIG_MEMCG_SWAP: enabled...... Generally Necessary: è¡¨ç¤ºå¿…è¦çš„é…ç½®ï¼Œå¦‚æœæœ‰æ˜¾ç¤º missing çš„åœ°æ–¹ï¼Œå°±éœ€è¦åœ¨å†…æ ¸é…ç½®ä¸­æ‰“å¼€å®ƒã€‚ Optional Features: æ˜¯å¯é€‰é…ç½®ï¼Œæ ¹æ®éœ€è¦æ‰“å¼€ã€‚ 8.1.1. å¼€å¯éœ€è¦çš„é…ç½®ä»ä¸Šé¢çš„æ£€æµ‹ç»“æœä¸­å¾—çŸ¥éœ€è¦æ‰“å¼€å“ªäº›é…ç½®åï¼Œå³å¯ä½¿ç”¨ make ARCH=arm64 menuconfig è¿›å…¥èœå•ï¼Œæœç´¢å¯¹åº”é¡¹ç›®å°†å…¶æ‰“å¼€ã€‚è¯·è®¤çœŸæŸ¥çœ‹èœå•ä¸­çš„æ“ä½œè¯´æ˜ï¼Œé‡åˆ°ä¸å¯é€‰ä¸­çš„é¡¹ç›®è¯·æ³¨æ„ä¾èµ–å…³ç³»ã€‚ å¼€å¯æ‰€æœ‰å¿…è¦é…ç½®ä»¥åŠéƒ¨åˆ†å¯é€‰é…ç½®åï¼Œæ³¨æ„ä¿å­˜ï¼š make ARCH=arm64 savedefconfigmv defconfig arch/arm64/configs/firefly_linux_defconfig ä¹‹åè¿›è¡Œç¼–è¯‘å†…æ ¸ï¼š #é€€å›åˆ°SDKç›®å½•cd ..#ç¼–è¯‘å†…æ ¸./build.sh kernel 8.2. å®‰è£… Dockerçƒ§å½•å®Œæ–°å†…æ ¸ä¹‹åï¼Œå¯ä»¥å¼€å§‹åœ¨è®¾å¤‡ä¸Šå®‰è£… Docker (æ­¤å®‰è£…æ–¹æ³•åŒæ ·é€‚ç”¨äº PC)ï¼š æ­¥éª¤ 1ï¼šå¿«é€Ÿå®‰è£… # è¿™é‡Œä»…ä»‹ç»ç›´æ¥ä½¿ç”¨è„šæœ¬å¿«é€Ÿå®‰è£…apt-get updatewget -qO- https://get.docker.com/ | sh ç­‰å¾…å®‰è£…æˆåŠŸä¹‹ååº”è¯¥ä¼šçœ‹è§ Docker ç‰ˆæœ¬ä¿¡æ¯ æ­¥éª¤ 2ï¼šæ£€æŸ¥ docker å­˜å‚¨ä½ç½®ï¼ˆè¯¥æ­¥éª¤ä»…é€‚ç”¨äº PC å®‰è£… dockerï¼‰ å¦‚æœåœ¨ Firefly è®¾å¤‡ä¸­å®‰è£… dockerï¼Œè¯·è·³è¿‡æ­¥éª¤ 2 # æ‰§è¡Œdocker info | grep -i dir# æ‰§è¡Œç»“æœ Docker Root Dir: /var/lib/docker è¿”å›çš„ä¿¡æ¯æ˜¾ç¤ºäº† docker çš„é»˜è®¤å­˜å‚¨ä½ç½®ï¼Œè¯¥ä½ç½®åœ¨ä¸åŒç”µè„‘ä¸Šå¯èƒ½ä¸ä¸€æ · é•œåƒå’Œå®¹å™¨ä¼šå ç”¨å¤§é‡ç©ºé—´ï¼Œå› æ­¤ï¼Œå¦‚æœé»˜è®¤çš„ä½ç½®ç©ºé—´ä¸å¤§ï¼Œéœ€è¦ä¿®æ”¹åˆ°ç©ºé—´å……è¶³çš„ä½ç½® å†æ¬¡å¼ºè°ƒï¼Œæ­¤æ­¥éª¤åªç”¨äº PCï¼ŒFirefly è®¾å¤‡ä¸­ï¼Œä¿®æ”¹æ­¤ä½ç½®ä¼šå¯¼è‡´ docker æ— æ³•å·¥ä½œï¼Œè¯·ç›´æ¥è·³åˆ°ä¸‹ä¸€æ­¥ # å…ˆå…³é—­ docker æœåŠ¡sudo systemctl stop docker# ä¿®æ”¹æ–‡ä»¶ /lib/systemd/system/docker.servicesudo vim /lib/systemd/system/docker.service# åœ¨è¿™ä¸€è¡Œæœ«å°¾æ·»åŠ æƒ³è¦ä¿®æ”¹çš„ä½ç½® --graph /home/firefly/docker/dataExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --graph /home/firefly/docker/data# é‡å¯ docker æœåŠ¡sudo systemctl daemon-reloadsudo systemctl start docker# æ£€æŸ¥ä½ç½®æ˜¯å¦ä¿®æ”¹æˆåŠŸdocker info | grep -i dir Docker Root Dir: /home/firefly/docker/data æ­¥éª¤ 3ï¼šå°†è‡ªå·±çš„ç”¨æˆ·æ·»åŠ åˆ° docker ç»„ sudo usermod -a -G docker firefly# æ·»åŠ åé‡å¯sudo reboot æ­¥éª¤ 4ï¼šé‡å¯åè¿è¡Œ demo æµ‹è¯•æ˜¯å¦æ­£å¸¸ï¼š firefly@firefly:~# docker run hello-worldUnable to find image hello-world:latest locallylatest: Pulling from library/hello-world93288797bd35: Pull completeDigest: sha256:cc15c5b292d8525effc0f89cb299f1804f3a725c8d05e158653a563f15e4f685Status: Downloaded newer image for hello-world:latestHello from Docker!This message shows that your installation appears to be working correctly.To generate this message, Docker took the following steps: 1. The Docker client contacted the Docker daemon. 2. The Docker daemon pulled the hello-world image from the Docker Hub. (arm64v8) 3. The Docker daemon created a new container from that image which runs the executable that produces the output you are currently reading. 4. The Docker daemon streamed that output to the Docker client, which sent it to your terminal.To try something more ambitious, you can run an Ubuntu container with: $ docker run -it ubuntu bashShare images, automate workflows, and more with a free Docker ID: https://hub.docker.com/For more examples and ideas, visit: https://docs.docker.com/get-started/ 9. ROS æ”¯æŒ9.1. å®‰è£… ROSé¦–å…ˆæŒ‰ç…§å®˜æ–¹å®‰è£…æ•™ç¨‹å®‰è£…ï¼Œæ ¹æ®ç³»ç»Ÿé€‰æ‹©å¯¹åº” ROS ç‰ˆæœ¬å®‰è£…ã€‚ å®˜æ–¹å®‰è£…æ•™ç¨‹ 9.1.1. å®‰è£… GLX åº“rviz,gazebo æ˜¯åŸºäº GLX ç¼–å†™çš„ï¼Œä»¬ç³»ç»Ÿç›®å‰åªæ”¯æŒ EGLï¼Œæ‰€ä»¥ä»–ä»¬æ— æ³•ä½¿ç”¨ GPU åŠ é€Ÿï¼ŒåŒæ—¶éœ€è¦å®‰è£… GLX åº“æ‰èƒ½èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚ apt install -y libgl1-mesa-glx libgl1-mesa-dri libglx-mesa0reboot 9.2. æ›´æ–° libqt5opengl5-devå¦‚æœé‡åˆ° rviz è¿˜ä¸èƒ½è¿è¡Œï¼Œrqt æŠ¥ QOpenGLTimeMonitor ç­‰é”™è¯¯ï¼Œéœ€è¦æ›´æ–°å®˜æ–¹çš„ libqt5opengl5-devï¼Œ æ‰§è¡Œä¸‹é¢æ“ä½œï¼Œå†å°è¯•è¿è¡Œ rqtã€rviz å’Œ gazebo ç­‰ç¨‹åº sed -i s/.*wiki.t-firefly.com.*/\\#/ /etc/apt/sources.listapt install libqt5opengl5-devsed -i /.*wiki.t-firefly.com.*/s/^#// /etc/apt/sources.list 9.3. wayland ä¸‹è¿è¡Œ rvizï¼Œrqt å’Œ gazebo ç­‰ç¨‹åºXWaylandè¯´æ˜ åŸºäº GLX çš„ç¨‹åºåœ¨ wayland è¿è¡Œï¼Œéœ€è¦ä½¿ç”¨ XWaylandã€‚ä½¿ç”¨ QT_QPA_PLATFORMxcb å¼ºåˆ¶ Qt åº”ç”¨ç¨‹åºä½¿ç”¨ X11 QT_QPA_PLATFORM=xcb rvizQT_QPA_PLATFORM=xcb rqtQT_QPA_PLATFORM=xcb gazebo# ä¹Ÿå¯ä»¥å°†è¯¥ç¯å¢ƒè®¾ç½®åˆ°.bashrcï¼Œå°±å¯ä»¥ç›´æ¥è¿è¡Œrvizç­‰ç¨‹åºã€‚echo export QT_QPA_PLATFORM=xcb /~/.bashrc 9.4. ROSæ•™ç¨‹10. æ˜¾ç¤ºæ¶æ„æ”¯æŒå¯¹äº Rockchip å¹³å°ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ˜¾ç¤ºæ¶æ„å¯ä¾›é€‰æ‹©ï¼š Qt + Wayland Qt + EGLFS EGL program + X11 Wayland None å¤šçª—å£çš„åŠŸèƒ½éœ€æ±‚ï¼Œé€‰æ‹©ï¼š X11 Wayland æ¡Œé¢çš„åŠŸèƒ½éœ€æ±‚ï¼Œé€‰æ‹©ï¼š X11 4K è§†é¢‘æ’­æ”¾ + å…¨å±ï¼š Qt + Wayland Qt + EGLFS X11 Wayland 4K è§†é¢‘æ’­æ”¾ + å¤šçª—å£ï¼š X11 Qt + Wayland Wayland å¦‚æœå¯¹æ˜¾ç¤ºæ¶æ„çš„æŠ€æœ¯ä¸å¤ªç†è§£ï¼Œå¯ä»¥ç»§ç»­å¾€ä¸‹é˜…è¯»ã€‚ 10.1. X11X11 æ˜¯ X æ˜¾ç¤ºåè®®çš„ç¬¬ 11 ä¸ªç‰ˆæœ¬ã€‚ X åè®®å·²ç»å»¶ç”¨äº† 30 å¹´ï¼ŒX åè®®çš„ ClientServer ç»“æ„èµ·åˆæ˜¯ä¸ºäº†åœ¨ä»¥å‰ç¡¬ä»¶æ€§èƒ½å¤ªå¼±çš„æƒ…å†µä¸‹ï¼Œè®¾å¤‡ï¼ˆClient ç«¯ï¼‰é€šè¿‡å‘é€æ¸²æŸ“è¯·æ±‚ç»™ X serverï¼ˆä»¥å‰ X server æ˜¯è¿è¡Œåœ¨å¦ä¸€ä¸ªç‹¬ç«‹çš„ç¡¬ä»¶ï¼‰æ¸²æŸ“æ˜¾ç¤ºã€‚ ä½†æ˜¯éšç€ç°ä»£ç¡¬ä»¶æ€§èƒ½ä¸æ–­æå‡ï¼ŒåŒä¸€ä¸ªç¡¬ä»¶ç³»ç»Ÿä¸Šå¯ä»¥åŒæ—¶è¿è¡Œ Client å’Œ Server äº†ï¼Œä½†æ˜¯è¿™ç§è¿œç¨‹é€šè®¯ç»“æ„è¿ç”¨åœ¨æœ¬åœ°æœºå™¨ä¸Šå¸¦æ¥çš„åæœå°±æ˜¯æ€§èƒ½çš„ä¸¢å¤±ï¼Œç›®å‰åœ¨ Debian å®˜æ–¹å·²ç»æœ‰åˆ†æ”¯åœ¨å¼€å‘ Wayland ç”¨äºæ›¿æ¢æ‰ X11ï¼Œä½†æ˜¯ç›®å‰ Wayland å¯¹ç°æœ‰è½¯ä»¶å…¼å®¹æ€§å¹¶ä¸å¥½æ‰€æœ‰è¿˜æ²¡æœ‰æ­£å¼æ›¿æ¢ä½¿ç”¨ã€‚ å‚è€ƒèµ„æ–™: https://en.wikipedia.org/wiki/X.Org_Serverhttps://www.comptechdoc.org/os/linux/howlinuxworks/linux_hlxwindows.htmlhttps://dri.freedesktop.org/wiki/DDX/https://www.freedesktop.org/wiki/Software/Glamor/https://en.wikipedia.org/wiki/X.Org_Server 10.2. Qt + EGLFSQt + EGLFS æ˜¯ Qt è‡ªå·±å®ç°çš„ä¸€ä¸ª GUI ç³»ç»Ÿï¼Œä¸æ”¯æŒå¤šçª—å£ï¼Œä½†ä¹Ÿå› æ­¤å°‘äº† window compositeã€‚ Qt + EGLFS å’Œ dri2 çš„æ–¹å¼ç±»ä¼¼ï¼ŒåŒºåˆ«å°±åœ¨äº Qt + EGLFS çš„ font buffer åœ¨è‡ªå·±ç”¨ gpu composite åï¼Œæ˜¯ç›´æ¥é€ç»™ DRM æ˜¾ç¤ºï¼Œè€Œ X é‡Œæ˜¯é€è‡³ Window manager åš compositeï¼Œæ‰€ä»¥ EGLFS åœ¨æ•ˆç‡ä¸Šæ˜¯æœ‰ä¼˜åŠ¿çš„ã€‚ 10.3. Qt + Waylandåœ¨ Wayland ä¸­ï¼ŒWeston æ˜¯ Wayland æ˜¾ç¤ºåè®®ä¸­çš„å…·ä½“å®ç°ï¼Œå…¶å¯¹åº”å…³ç³»å°±å¥½æ¯” Xorg ï¼ˆX serverï¼‰å’Œ X çš„å…³ç³»ä¸€æ ·ã€‚ ç›®å‰ Wayland å’Œ X å¯¹æ¯”å”¯ä¸€ç¼ºç‚¹å°±æ˜¯åœ¨å…¼å®¹æ€§ä¸Šäº†ï¼Œæ‰€ä»¥ç›®å‰ä¸»æµçš„ç³»ç»Ÿç‰ˆæœ¬ä¸­ä¾ç„¶å¤§éƒ¨åˆ†ä½¿ç”¨ Xã€‚ Weston ä¸å†ä½¿ç”¨ X çš„ ClientServer çš„ç»“æ„ï¼Œè€Œæ˜¯ç›´æ¥ç”±åˆæˆå™¨æ¥å—å†…æ ¸äº‹ä»¶ï¼Œå¹¶ä¼ é€’ç»™ Client ç«¯ï¼Œç”± Client ç«¯ç›´æ¥æ¸²æŸ“ï¼Œåªå‘åˆæˆå™¨å‘é€éœ€è¦æ›´æ–°çš„åŒºåŸŸï¼Œå†ç”±åˆæˆå™¨é€šçŸ¥å†…æ ¸å®‰æ’ç¿»é¡µã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ç”±äº UbuntuDebian å·²ç»æœ‰ X11ï¼Œæ‰€ä»¥ SDK é»˜è®¤æ˜¯åœ¨ Buildroot æ·»åŠ äº† Weston çš„æ”¯æŒï¼Œå®é™…ä¸Šå¦‚æœ UbuntuDebian éœ€è¦å®‰è£… Weston çš„è¯ä¹Ÿå¯ä»¥åœ¨ Minimal ç‰ˆæœ¬ä¸Šæ­å»ºã€‚ ï¼ˆFirefly Ubuntu 20.04ï¼Œå°†ä¼šé»˜è®¤è‡ªå¸¦ Wayland å’Œ Xï¼Œå¹¶ä¸”å¯ä»¥è‡ªç”±åˆ‡æ¢ã€‚ï¼‰ å»ºè®®ä½¿ç”¨ BuildrootYocto åš Wayland çš„å¼€å‘ã€‚æ•ˆç‡ä¸Š Wayland è¦æ¯” X11 å¥½ç‚¹ï¼Œä¸»è¦æ˜¯å…¼å®¹æ€§é—®é¢˜ã€‚ å¦‚æœä¸éœ€è¦æ¡Œé¢ï¼Œåˆè¦å¤šçª—å£ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ Waylandã€‚ 10.4. Noneé™¤äº† X11 å’Œ Wayland ä¹‹å¤–ï¼Œè¿˜æœ‰ Noneï¼Œè¿™ä¹Ÿæ˜¯åµŒå…¥å¼ä¸Šæ¥è§¦æ¯”è¾ƒå¤šçš„ã€‚æ¯”å¦‚ MiniGUIï¼ŒSDL çš†æ˜¯å¦‚æ­¤ã€‚ è‹¥è¦æ”¯æŒåˆ° DRM å’Œ opengl çš„è¯ï¼Œå°±åªèƒ½é€‰æ‹© Qt äº†ã€‚ MiniGUI æ˜¯ä¸€ä¸ªå®šä½äºè½»é‡çº§çš„åµŒå…¥å¼å›¾å½¢åº“ï¼Œå¯¹ç³»ç»Ÿèµ„æºçš„éœ€æ±‚å®Œå…¨è€ƒè™‘åˆ°äº†åµŒå…¥å¼è®¾å¤‡çš„ç¡¬ä»¶æƒ…å†µï¼Œå¦‚ MiniGUI åº“æ‰€å çš„ç©ºé—´æœ€å°å¯ä»¥è£å‰ªåˆ° 500K å·¦å³ã€‚ é’ˆå¯¹ Buildroot ç³»ç»Ÿé€‚é…åœ¨ç¡¬ä»¶èµ„æºæ¯”è¾ƒç´§å¼ çš„è®¾å¤‡ä¸Šçš„ç‰¹æ€§ï¼ŒMiniGUI æ­é… Buildroot æ˜¯å†é€‚åˆä¸è¿‡äº†ã€‚ å‚è€ƒèµ„æ–™: https://wayland.freedesktop.org/architecture.htmlhttps://en.wikipedia.org/wiki/Wayland","tags":["clippings"],"categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"Xenomaiå®æ—¶æ¡†æ¶","path":"/2024/10/16/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-RealTime-Xenomaiå®æ—¶æ¡†æ¶/","content":"Xenomai æ¦‚è¿°Xenomai æ˜¯ä¸€ä¸ªä¸“é—¨ä¸º Linux å¹³å°è®¾è®¡çš„å®æ—¶æ¡†æ¶ï¼Œå®ƒå…è®¸å„ç§å®æ—¶æ“ä½œç³»ç»Ÿï¼ˆRTOSï¼‰ï¼Œå¦‚ VxWorks å’Œ QNXï¼Œçš„åº”ç”¨ç¨‹åºæ¥å£ï¼ˆAPIï¼‰åœ¨ Linux ç¯å¢ƒä¸­ä½¿ç”¨ã€‚è¿™ç§åˆ›æ–°çš„æŠ€æœ¯é›†æˆæ˜¾è‘—æå‡äº† Linux ç³»ç»Ÿçš„å®æ—¶æ€§èƒ½ï¼Œæä¾›äº†ç¡¬å®æ—¶è°ƒåº¦çš„ä¿éšœï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨ Linux ä¸Šå®ç°ä¸¥æ ¼çš„æ—¶é—´å“åº”è¦æ±‚ã€‚è¿™å¯¹è®¸å¤šéœ€è¦å¿«é€Ÿååº”çš„åº”ç”¨æ¥è¯´è‡³å…³é‡è¦ï¼Œæ¯”å¦‚è‡ªåŠ¨åŒ–æ§åˆ¶ã€æœºå™¨äººæŠ€æœ¯å’Œé«˜é¢‘äº¤æ˜“ã€‚ Xenomai ä¸ä»…èƒ½å¤Ÿåœ¨ä¸»æµçš„ Linux å†…æ ¸ä¸Šè¿è¡Œï¼Œè¿˜æ”¯æŒå¤šç§åµŒå…¥å¼å¹³å°ã€‚è¿™ä¸€ç‚¹å¯¹äºå¤§å¤šæ•°å·¥ä¸šæˆ–æ¶ˆè´¹ç±»è®¾å¤‡è‡³å…³é‡è¦ï¼Œå› ä¸ºå¾ˆå¤šè®¾å¤‡ä¾èµ–åµŒå…¥å¼ç³»ç»Ÿæ¥æ‰§è¡Œå…³é”®ä»»åŠ¡ã€‚Xenomai å®˜æ–¹æ”¯æŒå¤šç§åµŒå…¥å¼ç¡¬ä»¶ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡è®¿é—® Xenomai å®˜æ–¹åµŒå…¥å¼è®¾å¤‡åˆ—è¡¨ æ¥äº†è§£é€‚åˆç‰¹å®šé¡¹ç›®çš„è®¾å¤‡ã€‚ æ€»ä½“æ¥çœ‹ï¼ŒXenomai ä¸ºå¼€å‘äººå‘˜æä¾›äº†å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©å®Œæˆä»¥ä¸‹å…³é”®ä»»åŠ¡ï¼š å®æ—¶åº”ç”¨ç¨‹åºçš„è®¾è®¡ä¸å¼€å‘ï¼šåˆ©ç”¨ Xenomai çš„å¼ºå¤§åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ Linux ä¸Šè®¾è®¡å’Œè¿è¡Œéœ€è¦é«˜å®æ—¶æ€§çš„åº”ç”¨ç¨‹åºã€‚ä¾‹å¦‚ï¼Œè‡ªåŠ¨åŒ–ç”Ÿäº§çº¿çš„æ§åˆ¶ç³»ç»Ÿå¿…é¡»åœ¨æ¯«ç§’å†…å¯¹ä¼ æ„Ÿå™¨è¾“å…¥åšå‡ºååº”ï¼ŒXenomai èƒ½å¤Ÿæä¾›æ‰€éœ€æ€§èƒ½ä»¥æ»¡è¶³è¿™äº›è¦æ±‚ã€‚ RTOS åº”ç”¨ç¨‹åºçš„ç§»æ¤ï¼šå¦‚æœå·²æœ‰åœ¨ RTOS ä¸Šå¼€å‘çš„åº”ç”¨ç¨‹åºï¼ŒXenomai ä½¿å¾—å®ƒä»¬é¡ºåˆ©è¿ç§»åˆ° Linux æˆä¸ºå¯èƒ½ã€‚æ¯”å¦‚ï¼Œè®¸å¤šæœºå™¨äººæ§åˆ¶ç¨‹åºæœ€åˆæ˜¯åœ¨ VxWorks ä¸Šå¼€å‘çš„ï¼Œé€šè¿‡ Xenomaiï¼Œå¼€å‘è€…å¯ä»¥ä¿ç•™åŸæœ‰ä»£ç å¹¶åœ¨ Linux ç¯å¢ƒä¸­ç»§ç»­ä½¿ç”¨ï¼Œæå¤§ç®€åŒ–äº†å¼€å‘æµç¨‹ã€‚ ä»¥ Linux åŸç”Ÿåº”ç”¨ç¨‹åºæ–¹å¼è¿è¡Œ RTOS åº”ç”¨ï¼šXenomai èƒ½å¤Ÿè®©åƒè¿è¡Œ Linux åº”ç”¨ä¸€æ ·ç›´æ¥è¿è¡Œ RTOS åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ VxWorksã€pSOSã€VRTXã€uITRON å’Œ POSIXã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœå›¢é˜Ÿå·²ç»ä¹ æƒ¯äºåœ¨ Linux ç¯å¢ƒä¸­å¼€å‘ï¼Œä¹Ÿå¯ä»¥è½»æ¾æ¥å…¥è¿™äº› RTOS ç³»ç»Ÿçš„åº”ç”¨ï¼Œæå‡å·¥ä½œæ•ˆç‡ï¼Œå‡å°‘å­¦ä¹ æˆæœ¬ã€‚ é€šè¿‡è¿™äº›åŠŸèƒ½ï¼ŒXenomai ä¸ä»…æå¤§æå‡äº† Linux çš„å®æ—¶å¤„ç†èƒ½åŠ›ï¼Œä¹Ÿä¸ºå¼€å‘è€…åˆ›é€ äº†ä¸€ä¸ªçµæ´»ä¸”é«˜æ•ˆçš„å·¥ä½œç¯å¢ƒã€‚ Xenomai æ¶æ„åŒå†…æ ¸ç»“æ„Xenomai é‡‡ç”¨åŒå†…æ ¸æ¶æ„æ¥å®ç°å…¶å®æ—¶æ“ä½œã€‚ä¸€ä¸ªæ˜¯é«˜ä¼˜å…ˆçº§çš„å¾®å†…æ ¸ï¼ˆco-kernelï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯ä¼ ç»Ÿçš„ Linux å†…æ ¸ã€‚co-kernel è´Ÿè´£æ‰§è¡Œå®æ—¶ä»»åŠ¡ï¼Œè€Œ Linux å†…æ ¸åˆ™ç»´æŒå…¶å¸¸è§„çš„æœåŠ¡åŠŸèƒ½ã€‚ä¸¤ä¸ªå†…æ ¸ç”± Adeos è¿›è¡Œç®¡ç†ï¼Œæ¯ä¸ªå†…æ ¸è¢«åˆ†é…åˆ°ä¸åŒçš„åŸŸã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¾®å†…æ ¸å¯èƒ½ä¼šåˆ‡æ¢åˆ° Linux å†…æ ¸åŸŸï¼Œè¿™ä¼šç ´å Xenomai çš„å®æ—¶æ€§ã€‚è¿™ç§æƒ…å†µå¯èƒ½å‘ç”Ÿåœ¨å®æ—¶ä»»åŠ¡ä¸­ä½¿ç”¨äº† Linux çš„ä¸€äº›ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå› æ­¤åœ¨è®¾è®¡å®æ—¶ä»»åŠ¡æ—¶ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨ Linux ç³»ç»Ÿè°ƒç”¨ã€‚ AdeosAdeosi-pipe æ˜¯å®ç°åŒå†…æ ¸ç»“æ„çš„æ ¸å¿ƒï¼Œå®ƒæ˜¯ Xenomai å’Œ RTAI ç­‰ç³»ç»Ÿçš„åŸºç¡€ã€‚åœ¨åŸºäº Adeos çš„ç³»ç»Ÿä¸­ï¼Œæ“ä½œç³»ç»Ÿåœ¨ç‹¬ç«‹çš„åŸŸå†…è¿è¡Œï¼Œæ¯ä¸ªåŸŸæœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´åŠç±»ä¼¼è¿›ç¨‹ã€è™šæ‹Ÿå†…å­˜ç­‰çš„è½¯ä»¶æŠ½è±¡å±‚ï¼Œä¸”è¿™äº›èµ„æºå¯ä»¥åœ¨åŸŸé—´å…±äº«ã€‚ åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œæ“ä½œçš„æ‰§è¡Œä¸»è¦ä¾èµ–äºå†…éƒ¨å’Œå¤–éƒ¨çš„ä¸­æ–­ä¸å¼‚å¸¸ï¼Œä¾‹å¦‚ç³»ç»Ÿæ—¶é’Ÿä¸­æ–­æ˜¯æ“ä½œç³»ç»Ÿä¸­æœ€é‡è¦çš„ä¸­æ–­ã€‚Adeos é€šè¿‡ç®¡ç†ç¡¬ä»¶ä¸­æ–­ï¼Œå¹¶æ ¹æ®åŸŸçš„ä¼˜å…ˆçº§ä¾æ¬¡è°ƒç”¨ç›¸åº”åŸŸçš„ä¸­æ–­æœåŠ¡ç¨‹åºï¼Œæ¥é©±åŠ¨ç³»ç»Ÿçš„è¿è¡Œã€‚åŒæ—¶ï¼ŒAdeos è¿˜æä¾›äº†åŸŸé—´é€šä¿¡æœºåˆ¶ï¼Œå®ç°åŸŸçš„è°ƒåº¦ç­‰åŠŸèƒ½ã€‚ ä¸ºäº†æœ‰æ•ˆç®¡ç†ä¸­æ–­åŠæ§åˆ¶åŸŸé—´çš„ä¼˜å…ˆï¼Œè¿™é‡Œå¼•å…¥äº†â€ä¸­æ–­ç®¡é“ï¼ˆInterrupt Pipeï¼‰â€çš„æ¦‚å¿µã€‚é€šè¿‡ä¸­æ–­ç®¡é“ï¼ŒAdeos åœ¨ä¸åŒåŸŸä¹‹é—´ä¼ æ’­ä¸­æ–­ï¼Œå¹¶æä¾›æœºåˆ¶è®©åŸŸèƒ½å¤Ÿè°ƒæ•´è‡ªèº«åœ¨ä¸­æ–­ç®¡é“ä¸­çš„ä¼˜å…ˆçº§ã€‚ Xenomai åœ¨ Adeos ç³»ç»Ÿä¸­çš„åŸŸä¼˜å…ˆçº§é«˜äº Linux åŸŸï¼Œæ„å‘³ç€æ¯å½“ä¸­æ–­å‘ç”Ÿæ—¶ï¼ŒAdeos é¦–å…ˆè°ƒåº¦ Xenomai æ¥å¤„ç†è¯¥ä¸­æ–­å¹¶æ‰§è¡Œç›¸åº”çš„å®æ—¶ä»»åŠ¡ï¼Œåªæœ‰åœ¨ Xenomai æ²¡æœ‰å®æ—¶ä»»åŠ¡å’Œä¸­æ–­éœ€è¦å¤„ç†æ—¶ï¼ŒAdeos æ‰ä¼šè°ƒåº¦ Linuxï¼Œè¿™ç¡®ä¿äº† Xenomai çš„ä¸­æ–­å“åº”é€Ÿåº¦å’Œå®æ—¶ä»»åŠ¡ä¸å— Linux çš„å¹²æ‰°ï¼Œä»è€Œæä¾›äº†å¯é¢„æµ‹çš„å®æ—¶æ€§èƒ½ã€‚ æ€§èƒ½æµ‹è¯•Xenomai æä¾›äº†ä¸€ç³»åˆ—æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œå®‰è£…å®Œ Xenomai åï¼Œè¿™äº›å·¥å…·ä¼šä½äº Xenomai å®‰è£…ç›®å½•çš„ bin/ æ–‡ä»¶å¤¹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®æµ‹è¯•å·¥å…·çš„åˆ—è¡¨åŠå…¶åŠŸèƒ½ï¼š clocktestï¼šç”¨äºæµ‹è¯• CPU æ—¶é’Ÿçš„ç²¾åº¦å’Œæ€§èƒ½ã€‚ cyclictestï¼šç”¨äºæµ‹è¯• Xenomai POSIX å‘¨æœŸå®šæ—¶å™¨çš„æ€§èƒ½ã€‚ dohellï¼šç”Ÿæˆç³»ç»Ÿè´Ÿè½½ä»¥æµ‹è¯•ç³»ç»Ÿçš„æ‰¿è½½èƒ½åŠ›ã€‚ irqbenchï¼šå¯¹ä¸­æ–­è¯·æ±‚ï¼ˆIRQï¼‰è¿›è¡Œæ€§èƒ½æµ‹è¯•ã€‚ irqloopï¼šç”¨äºæ›´æ·±å…¥çš„ IRQ æµ‹è¯•ã€‚ klatencyï¼šå†…æ ¸ç©ºé—´æ—¶å»¶æµ‹è¯•å·¥å…·ï¼Œè¯„ä¼°å†…æ ¸æ“ä½œçš„å»¶è¿Ÿã€‚ latencyï¼šç”¨äºæµ‹é‡å®šæ—¶å™¨çš„æ—¶å»¶ï¼Œç¡®ä¿å®šæ—¶å™¨ç²¾åº¦ã€‚ switchbenchï¼šæµ‹è¯•ä»»åŠ¡åˆ‡æ¢å»¶è¿Ÿï¼Œä»¥è¯„ä¼°ç³»ç»Ÿçš„åˆ‡æ¢æ•ˆç‡ã€‚ switchtestï¼šç”¨äºæµ‹é‡è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶é—´ã€‚ xeno-testï¼šè¿è¡Œç”¨æˆ·å®šä¹‰çš„è„šæœ¬ï¼Œä»¥è¯„ä¼°æœ€ä½³å’Œæœ€å·®å»¶è¿Ÿã€‚ è¿™äº›å·¥å…·ä¸ºå¼€å‘è€…æä¾›äº†å¼ºæœ‰åŠ›çš„æ‰‹æ®µï¼Œä»¥ç›‘æ§å’Œä¼˜åŒ–å®æ—¶åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨çœŸå®ç¯å¢ƒä¸­èƒ½å¤Ÿæ»¡è¶³é¢„æœŸçš„å®æ—¶æ€§è¦æ±‚ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿","RealTime"]},{"title":"åµŒå…¥å¼å®æ—¶æ€§ä¼˜åŒ–","path":"/2024/10/15/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-RealTime-åµŒå…¥å¼å®æ—¶æ€§ä¼˜åŒ–/","content":"Firefly Linux å¼€å‘æŒ‡å— ä¸ºäº†æ»¡è¶³ç”¨æˆ·å¯¹ç³»ç»Ÿå®æ—¶æ€§çš„éœ€æ±‚ï¼Œå®˜æ–¹åœ¨ SDK æºç çš„å†…æ ¸åŸºç¡€ä¸Šæ”¯æŒå‡çº§ Linux åˆ° RTLinuxã€‚ ä»¬ RTlinux æ”¯æŒæœ‰ preempt å’Œ xenomai ä¸¤ä¸ªç‰ˆæœ¬,ä¸‹é¢ä»¥ preempt ç‰ˆæœ¬æ¥æµ‹è¯•ã€‚ 1.1. RTLinux ç³»ç»Ÿå›ºä»¶æ”¯æŒæ”¯æŒ RK3562ã€RK356X åŠ RK3588 ç­‰èŠ¯ç‰‡å¹³å°ï¼Œå¯å‰å¾€å¯¹åº”æœºå™¨ç‰ˆå‹ä¸‹è½½å›ºä»¶é¡µé¢ä¸‹è½½å®æ—¶å›ºä»¶ã€‚å¦‚éœ€è¦æºç è¯·è”ç³»å•†åŠ¡ã€‚ 1.2. æµ‹è¯•å®æ—¶æ•ˆæœæµ‹è¯•å®æ—¶æ€§èƒ½éœ€è¦ cyclictest,å¯ä»¥ä½¿ç”¨ apt å®‰è£…ã€‚ apt updateapt install rt-tests 1.2.1. æµ‹è¯• RTLinux çš„å®æ—¶æ•ˆæœä½¿ç”¨ stress æˆ– stress-ng æ¨¡æ‹Ÿé€šç”¨çš„å‹åŠ›åœºæ™¯ï¼Œä½¿ CPU å¤„äºæ»¡è´Ÿè·çŠ¶æ€ã€‚ # æ ¹æ®èŠ¯ç‰‡æ ¸å¿ƒæ•°è¿è¡Œcpuå‹æµ‹çº¿ç¨‹ã€ioå‹æµ‹çº¿ç¨‹åŠå†…å­˜å‹æµ‹çº¿ç¨‹stress --cpu 4 --io 4 --vm 4 --vm-bytes 256M --timeout 259200s æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æµ‹è¯•æ¯ä¸ªæ ¸å¿ƒå®æ—¶å“åº”å»¶è¿Ÿï¼Œå°†è¿›è¡Œä¸ºæœŸ 3 å¤©çš„æµ‹è¯•ï¼Œæµ‹è¯•å®Œæˆåçš„æµ‹è¯•ç»“æœè¾“å‡ºåˆ° output æ–‡ä»¶ã€‚ cyclictest -m -S -p99 -i1000 -h800 -D3d -q output ä»¬æ‰§è¡Œä»¥ä¸Šæ“ä½œåˆ†åˆ«åœ¨ rk3568ã€rk3562 åŠ rk3588 è¿›è¡Œ 3 å¤©çš„å»¶è¿Ÿæµ‹è¯•ã€‚å…¶ä¸­ rk3568 å’Œ rk3562 å°† CPU3 ä»å†…æ ¸ SMP å¹³è¡¡å’Œè°ƒåº¦ç®—æ³•ä¸­å‰”é™¤ï¼Œè€Œ rk3588 å°† CPU6 å’Œ CPU7 ä»å†…æ ¸ SMP å¹³è¡¡å’Œè°ƒåº¦ç®—æ³•ä¸­å‰”é™¤ï¼Œä»¥ä¾¿è§‚å¯ŸèŠ¯ç‰‡æœ€å¥½çš„å®æ—¶æ€§èƒ½ã€‚ ä¸ºäº†ä¾¿äºè§‚å¯Ÿï¼Œä»¬å°† rk3568ã€rk3562 åŠ rk3588 çš„æµ‹è¯•ç»“æœè½¬æ¢æˆç›´æ–¹å›¾å’Œè¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ åœ¨æœ¬æ¬¡æµ‹è¯•ä¸­ï¼ŒRK3562 çš„ CPU2 æ ¸å¿ƒ Max Latencies å€¼æœ€å¤§ï¼Œä¸º 152usï¼Œéš”ç¦» CPU3 æ ¸å¿ƒï¼ˆä»å†…æ ¸ SMP å¹³è¡¡å’Œè°ƒåº¦ç®—æ³•ä¸­å‰”é™¤çš„æ ¸å¿ƒï¼‰çš„ Max Latencies å€¼æœ€å°ï¼Œä¸º 20usã€‚ RK3568 çš„ CPU0 æ ¸å¿ƒçš„ Max Latencies å€¼æœ€å¤§ï¼Œä¸º 135usï¼Œéš”ç¦» CPU3 æ ¸å¿ƒçš„ Max Latencies å€¼æœ€å°ï¼Œä¸º 18usã€‚ RK3588 çš„ CPU0 æ ¸å¿ƒçš„ Max Latencies å€¼æœ€å¤§ï¼Œä¸º 45usï¼Œéš”ç¦» CPU7 æ ¸å¿ƒçš„ Max Latencies å€¼æœ€å°ï¼Œä¸º 3usã€‚ ç”±æ­¤å¯è§ï¼Œåœ¨åŒèŠ¯ç‰‡å¹³å°ä¸‹éš”ç¦»æ ¸å¿ƒçš„å®æ—¶æ€§æœ€å¥½ã€‚æ‰€ä»¥å°½é‡å°†ä»¬çš„å®æ—¶ä»»åŠ¡ç»‘å®šåˆ°éš”ç¦»æ ¸å¿ƒè¿è¡Œï¼Œä»¥è·å¾—æœ€å¥½çš„å®æ—¶æ•ˆæœã€‚ Latencies \\ Core CPU0 CPU1 CPU2 CPU3 Total 420738794 420738789 420738773 420738757 Min Latencies 00003 00003 00003 00002 Avg Latencies 00009 00008 000012 00003 Max Latencies 00074 00078 00152 00020 Latencies \\ Core CPU0 CPU1 CPU2 CPU3 Total 259200000 259199935 259199824 259199769 Min Latencies 00004 00003 00003 00003 Avg Latencies 000017 000015 000017 00004 Max Latencies 000135 000112 00107 00018 Latencies \\ Core CPU0 CPU1 CPU2 CPU3 CPU4 CPU5 CPU6 CPU7 Total 259200000 259199978 259199943 259199926 259199914 259199930 259199871 259199898 Min Latencies 00003 00003 00003 00003 00001 00001 00001 00001 Avg Latencies 00007 00006 00006 00006 00003 00003 00001 00001 Max Latencies 00045 00037 00035 00033 00024 00020 00004 00003 1.2.1.1. å…¶ä»–å‹åŠ›åœºæ™¯ä¸åŒåœºæ™¯çš„å»¶è¿Ÿæµ‹è¯•ç»“æœä¸å°½ç›¸åŒï¼Œä¸ºäº†å°½å¯èƒ½æ¥è¿‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒï¼Œå¯åŒæ—¶åˆ¶ä½œå…¶ä»–å‹åŠ›åœºæ™¯ï¼Œå¦‚ï¼š åˆ¶é€ ç½‘ç»œå‹åŠ›ï¼š #ä½¿ç”¨iperfè¿›è¡Œä¸Šä¸‹è¡ŒåŒæ—¶æµ‹è¯•ï¼Œä½¿ç½‘å¡çš„å‘é€å’Œæ¥æ”¶å¤„äºæ»¡è´Ÿè½½çŠ¶æ€iperf -c 192.168.1.220 -p 8001 -f m -i100 -d -t 259200 åˆ¶é€  gpu å‹åŠ›ï¼š #æ— é™åœ°è¿è¡Œï¼Œä»æœ€åä¸€ä¸ªåŸºå‡†å¾ªç¯åˆ°ç¬¬ä¸€ä¸ªåŸºå‡†glmark2-es2-wayland --run-forever 1.2.2. Cyclictest æ ‡å‡†æµ‹è¯•threads é€‰é¡¹(-t)ç”¨äºæŒ‡å®š Cyclictest åœ¨æ£€æµ‹å»¶è¿Ÿæ—¶å°†ä½¿ç”¨çš„æµ‹é‡çº¿ç¨‹æ•°ã€‚é€šå¸¸ï¼Œåœ¨ç³»ç»Ÿä¸Šçš„æ¯ä¸ª CPU ä¸Šåªè¿è¡Œä¸€ä¸ªæµ‹é‡çº¿ç¨‹æ˜¯ä¸€ä¸ªæ ‡å‡†çš„æµ‹è¯•æ–¹æ¡ˆã€‚å¯ä»¥ä½¿ç”¨äº²å’Œæ€§é€‰é¡¹(-a)æŒ‡å®šçº¿ç¨‹å¿…é¡»åœ¨å…¶ä¸Šæ‰§è¡Œçš„ cpuã€‚ è¿™äº›é€‰é¡¹å¯¹äºæœ€å°åŒ–è¿è¡Œ Cyclictest å¯¹è§‚å¯Ÿåˆ°çš„ç³»ç»Ÿçš„å½±å“è‡³å…³é‡è¦ã€‚åœ¨ä½¿ç”¨ Cyclictest æ—¶ï¼Œç¡®ä¿åœ¨ä»»ä½•ç»™å®šæ—¶é—´åªæ‰§è¡Œä¸€ä¸ªæµ‹é‡çº¿ç¨‹æ˜¯å¾ˆé‡è¦çš„ã€‚å¦‚æœä¸¤ä¸ªæˆ–å¤šä¸ª Cyclictest çº¿ç¨‹çš„é¢„æœŸæ‰§è¡Œæ—¶é—´é‡å ï¼Œåˆ™ Cyclictest çš„æµ‹é‡å°†å—åˆ°å…¶è‡ªå·±çš„æµ‹é‡çº¿ç¨‹æ‰€é€ æˆçš„å»¶è¿Ÿçš„å½±å“ã€‚ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´åªæ‰§è¡Œä¸€ä¸ªæµ‹é‡çº¿ç¨‹çš„æœ€å¥½æ–¹æ³•æ˜¯åœ¨ç»™å®šçš„ CPU ä¸Šåªæ‰§è¡Œä¸€ä¸ªæµ‹é‡çº¿ç¨‹ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœè¦åˆ†æä¸‰ä¸ªç‰¹å®š cpu çš„å»¶è¿Ÿï¼Œåˆ™æŒ‡å®šåº”è¯¥ä½¿ç”¨è¿™äº› cpu(ä½¿ç”¨-a é€‰é¡¹)ï¼Œå¹¶æŒ‡å®šåº”è¯¥ä½¿ç”¨ä¸‰ä¸ªæµ‹é‡çº¿ç¨‹(ä½¿ç”¨-t é€‰é¡¹)ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†æœ€å°åŒ– Cyclictest çš„å¼€é”€ï¼Œè¯·ç¡®ä¿æ”¶é›†åº¦é‡æ•°æ®çš„ä¸» Cyclictest çº¿ç¨‹æ²¡æœ‰è¿è¡Œåœ¨ä¸‰ä¸ªéš”ç¦»çš„ cpu ä¹‹ä¸€ä¸Šã€‚ä¸»çº¿ç¨‹çš„å…³è”æ€§å¯ä»¥ä½¿ç”¨ taskset ç¨‹åºè®¾ç½®ï¼Œå¦‚ä¸‹æ‰€è¿°ã€‚ 1.2.2.1. åœ¨è¯„ä¼°ä¸€ç»„éš”ç¦»çš„ cpu ä¸Šçš„å»¶è¿Ÿæ—¶ï¼Œå‡å° cyclictest çš„å½±å“åœ¨æµ‹é‡ cpu å­é›†ä¸Šçš„å»¶è¿Ÿæ—¶ï¼Œç¡®ä¿ä¸» Cyclictest çº¿ç¨‹æ­£åœ¨æœªè¢«è¯„ä¼°çš„ cpu ä¸Šè¿è¡Œã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªç³»ç»Ÿæœ‰ä¸¤ä¸ª CPUï¼Œå¹¶ä¸”æ­£åœ¨è¯„ä¼° CPU 0 ä¸Šçš„å»¶è¿Ÿï¼Œé‚£ä¹ˆä¸» Cyclictest çº¿ç¨‹åº”è¯¥å›ºå®šåœ¨ CPU 1 ä¸Šã€‚Cyclictest çš„ä¸»çº¿ç¨‹ä¸æ˜¯å®æ—¶çš„ï¼Œä½†æ˜¯å¦‚æœå®ƒåœ¨è¢«è¯„ä¼°çš„ CPU ä¸Šæ‰§è¡Œï¼Œå®ƒå¯èƒ½ä¼šå¯¹å»¶è¿Ÿäº§ç”Ÿå½±å“ï¼Œå› ä¸ºä¼šæœ‰é¢å¤–çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚åœ¨å¯åŠ¨ Cyclictest ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ taskset å‘½ä»¤å°†ä¸»çº¿ç¨‹é™åˆ¶ä¸ºåœ¨ cpu çš„æŸä¸ªå­é›†ä¸Šæ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œé’ˆå¯¹ CPU1 åˆ° CPU3 çš„å»¶æ—¶æµ‹è¯•: #CPU1åˆ°CPU3è¿è¡Œå®æ—¶ç¨‹åºï¼Œä¸»çº¿è¿è¡Œåœ¨CPU0ä¸Štaskset -c 0 ./cyclictest -t3 -p99 -a 1-3 taskset ç¨‹åºè¿˜å¯ä»¥ç”¨äºç¡®ä¿ç³»ç»Ÿä¸Šè¿è¡Œçš„å…¶ä»–ç¨‹åºä¸ä¼šå½±å“éš”ç¦» CPU ä¸Šçš„å»¶è¿Ÿã€‚ä¾‹å¦‚ï¼Œå¯åŠ¨ç¨‹åº top æŸ¥çœ‹çº¿ç¨‹å¹¶å›ºå®šåˆ° CPU 0 ä¸Šï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤: taskset --cpu 0 top -H -p PID#topæ‰“å¼€ä¹‹åç‚¹å‡»fé”®ï¼Œå…‰æ ‡ç§»åŠ¨åˆ° P é€‰é¡¹ï¼Œç©ºæ ¼é€‰ä¸­ï¼Œç„¶åç‚¹å‡» qå»ºé€€å‡ºï¼Œä¾¿å¯æŸ¥çœ‹åˆ°å®æ—¶çº¿ç¨‹åœ¨å“ªäº›CPUä¸Šè¿è¡Œã€‚ 1.3. æé«˜å®æ—¶ç­–ç•¥1.3.1. æŠ‘åˆ¶æ§åˆ¶å°æ¶ˆæ¯åŠç¦æ­¢å†…å­˜è¿‡åº¦ä½¿ç”¨#å¯ä»¥ä½¿ç”¨å†…æ ¸å‚æ•°quietå¯åŠ¨å†…æ ¸ï¼Œæˆ–è€…å¯åŠ¨ä¹‹åæŠ‘åˆ¶ï¼Œå¦‚ä¸‹ï¼šecho 1 /proc/sys/kernel/printk#ç¦ç”¨å†…å­˜è¿‡åº¦ä½¿ç”¨ä»¥é¿å… Out-of-Memory Killeräº§ç”Ÿçš„å»¶è¿Ÿecho 2 /proc/sys/vm/overcommit_memory 1.3.2. ä¸ä½¿ç”¨æ¡Œé¢æˆ–è€…ä½¿ç”¨è½»é‡çº§çª—å£ç®¡ç†å™¨ä¸ºäº†æ›´å¥½çš„å®æ—¶ï¼Œä»¬ä¸å»ºè®®ä½¿ç”¨å¸¦æ¡Œé¢çš„ç³»ç»Ÿï¼Œå› ä¸ºè¿™å°†ä¸º CPU å»¶è¿Ÿå¸¦æ¥å¾ˆå¤§çš„æŒ‘æˆ˜ã€‚å»ºè®®ä½¿ç”¨ minimal ubuntuã€è‡ªå·±çš„ QT ç¨‹åºç­‰ã€‚ 356x çš„ rt å›ºä»¶é»˜è®¤ä¸ä½¿ç”¨æ¡Œé¢ï¼Œè€Œæ˜¯ä½¿ç”¨çª—å£ç®¡ç†å™¨ westonï¼Œæ˜¾ç¤ºåè®®æ˜¯ Waylandã€‚ 1.3.2.1. åˆ‡æ¢ X11 ç¯å¢ƒå¦‚æœéœ€è¦ X11 çš„ç¯å¢ƒï¼Œå¯æ‰‹åŠ¨åˆ‡æ¢åˆ° X11 sudo set_display_server x11reboot#sudo set_display_server weston å¯å†æ¬¡åˆ‡æ¢å›westonï¼Œé‡å¯ç”Ÿæ•ˆ 1.3.2.1.1. ä½¿ç”¨ openbox çª—å£ç®¡ç†å™¨å¯åŠ¨åˆ‡æ¢åˆ° X11 ç¯å¢ƒé»˜è®¤ä½¿ç”¨æ¡Œé¢ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è½»é‡çº§çš„çª—å£ç®¡ç†å™¨ åœ¨etclightdmlightdm.conf æŒ‡å®š ession ä½¿ç”¨ openbox çª—å£ç®¡ç†å™¨ï¼š cat /etc/lightdm/lightdm.conf.d/20-autologin.conf [Seat:*]user-session=openboxautologin-user=firefly 1.3.2.1.2. åªè¿è¡Œè‡ªå·±çš„ X11 ç¨‹åºè‹¥æ˜¯ä¸ç”¨ç™»å½•ç®¡ç†å™¨å¯åŠ¨ X æ˜¾ç¤ºæœåŠ¡ï¼Œå¯ä½¿ç”¨ xinit æ‰‹åŠ¨å¯åŠ¨ Xorg æ˜¾ç¤ºæœåŠ¡ã€‚ æ‰§è¡Œ xinit å’Œ startx æ—¶ï¼Œå®ƒä»¬å°†å¯»æ‰¾.xinitrc åšä¸º shell è„šæœ¬è¿è¡Œä»¥å¯åŠ¨å®¢æˆ·ç«¯ç¨‹åºã€‚ è‹¥æ˜¯.xinitrc ä¸å­˜åœ¨ï¼Œstartx å°†è¿è¡Œé»˜è®¤å€¼etcX11xinitxinitrc(é»˜è®¤çš„ xinitrc å¯åŠ¨ä¸€ä¸ª Twmï¼Œxorg-xclock å’Œ Xterm ç¯å¢ƒ)ã€‚ é¦–å…ˆå…³é—­ lightdm æœåŠ¡ systemctl disable lightdm ç„¶åä½¿ç”¨ startx å¯åŠ¨è‡ªå·±çš„ç¨‹åº ä¹Ÿå¯ä¿®æ”¹é»˜è®¤ startx æŒ‡å®šçš„ client çš„ xinitrc æ–‡ä»¶,é»˜è®¤çš„ä¼šè¿è¡Œ Xorg vim /etc/X11/xinit/xinitrc-------------------------------------------------------------#!/bin/sh # /etc/X11/xinit/xinitrc## global xinitrc file, used by all X sessions started by xinit (startx)# invoke global X session script#. /etc/X11/Xsession#chromium --window-size=1920,1080chromium --start-maximized 1.3.3. ç»‘å®šæ ¸å¿ƒå®æ—¶è¦æ±‚é«˜çš„äº‹ä»¶å›ºå®šåˆ°æŸä¸ªæ ¸å¿ƒä¸Šå¤„ç†ï¼Œç³»ç»ŸåŠå…¶å®ƒå®æ—¶è¦æ±‚ä¸é«˜çš„äº‹ä»¶é›†ä¸­åˆ°ä¸€ä¸ªæ ¸å¿ƒä¸Šå¤„ç†ã€‚ä¾‹å¦‚ç‰¹å®šçš„ä¸­æ–­ï¼Œå®æ—¶ç¨‹åºç­‰äº‹ä»¶å¯ä»¥ç”¨ä¸“é—¨çš„æ ¸å¿ƒä¸ºä»–ä»¬æœåŠ¡ã€‚ 1.3.3.1. ä»»åŠ¡ç»‘å®šæ ¸å¿ƒrt åº”ç”¨å¯ç”±ç‰¹å®šæ ¸å¿ƒå¤„ç†ï¼Œå°† rt åº”ç”¨ç»‘å®šåˆ° cpu3 1.3.3.2. ä¸­æ–­ç»‘å®šæ ¸å¿ƒç”±äº arm å°†æ‰€æœ‰å¤–è®¾ä¸­æ–­å…¨éƒ¨ç”± cpu0 å¤„ç†ï¼Œå¯¹äºé‡è¦çš„ä¸­æ–­å¯ä»¥åœ¨ç³»ç»Ÿå¯åŠ¨ä¹‹åå°†ä¸­æ–­ç»‘å®šåˆ°å…¶ä»–æ ¸å¿ƒã€‚ ä¾‹å¦‚å°† eth0 ä¸­æ–­ç»‘å®šåˆ° cpu2 root@firefly:~# cat /proc/interrupts | grep eth0 38: 28600296 0 0 0 GICv3 64 Level eth0 39: 0 0 0 0 GICv3 61 Level eth0root@firefly:~# cat /proc/irq/38/smp_affinity_list 0-3root@firefly:~# echo 2 /proc/irq/38/smp_affinity_listroot@firefly:~# cat /proc/irq/38/smp_affinity_list 2root@firefly:~# cat /proc/interrupts | grep eth0 38: 29009292 0 52859 0 GICv3 64 Level eth0 39: 0 0 0 0 GICv3 61 Level eth0 1.3.4. ä½¿ç”¨ smp+amp æ–¹æ¡ˆå¯¹äºå®æ—¶è¦æ±‚æ›´é«˜çš„ï¼Œå¯ä»¥ä½¿ç”¨ amp æ–¹æ¡ˆï¼Œä»¥è¾¾åˆ°æ›´å¥½çš„å®æ—¶æ§åˆ¶ã€‚ rk3568 æ”¯æŒäº† ampï¼ˆéå¯¹ç§°å¤šæ ¸æ¶æ„ï¼‰ï¼Œå¯ä»¥å®šåˆ¶æŸäº›æ ¸å¿ƒè·‘å®šåˆ¶çš„ç³»ç»Ÿã€‚ æ¯”å¦‚ 0ï½2 æ ¸å¿ƒè·‘ kernelï¼Œ3 æ ¸å¿ƒè·‘ rt-thread ç­‰ï¼›æ”¯æŒ Linux(Kernel-4.19ã€rt-kernel-4.19)ã€ Baremetal(HAL)ã€RTOS(RT-Thread) ç»„åˆ AMP æ„å»ºå½¢å¼ï¼Œå¯ä»»æ„æ­é…ã€‚ ä¸åŒå†…æ ¸ä¹‹é—´å¯ä»¥ä½¿ç”¨æ ¸é—´é€šä¿¡æ¥è¿›è¡Œä¿¡æ¯äº¤äº’ã€‚","tags":["clippings"],"categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿","RealTime"]},{"title":"3399éƒ¨ç½²Tengineæ¡†æ¶","path":"/2024/10/14/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-åº”ç”¨è½¯ä»¶ç§»æ¤-3399éƒ¨ç½²Tengineæ¡†æ¶/","content":"Tengine ç®€ä»‹åŠå…¶ä¼˜åŠ¿Tengine æ˜¯ OPEN AI LAB å¼€å‘çš„ä¸€æ¬¾è½»é‡çº§ç¥ç»ç½‘ç»œæ¨ç†å¼•æ“ï¼Œç‰¹åˆ«é’ˆå¯¹ Arm åµŒå…¥å¼å¹³å°è¿›è¡Œäº†ä¼˜åŒ–ã€‚å®ƒä¸º Android å’Œ Linux ç³»ç»Ÿæä¾›äº†å‡ºè‰²æ”¯æŒï¼Œç¡®ä¿å¹¿æ³›é€‚ç”¨æ€§ã€‚æ›´ä¸ºé‡è¦çš„æ˜¯ï¼ŒTengine ä¸ä¾èµ–ä¸“ç”¨çš„ AI èŠ¯ç‰‡ï¼Œæ”¯æŒåˆ©ç”¨å…·æœ‰ AI åŠ é€ŸåŠŸèƒ½çš„ GPUã€NPU ç­‰æ¨¡å—è¿›è¡Œè¿ç®—ï¼ŒåŒæ—¶ä¹Ÿèƒ½åœ¨é€šç”¨ CPU ä¸Šè¿è¡Œã€‚è¿™ä½¿å¾—è®¸å¤š Arm å¹³å°çš„ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡ Tengine æ¡†æ¶æœ€å¤§ç¨‹åº¦åœ°æŒ–æ˜ç¡¬ä»¶ç®—åŠ›ï¼Œä»è€Œé«˜æ•ˆè¿è¡Œå„ç§ AI åº”ç”¨ã€‚ RK3399 å¼€å‘æ¿ç¯å¢ƒOPEN AI LAB åœ¨ GitHub ä¸Šæä¾›äº†å¼€æºçš„ Tengine ç‰ˆæœ¬ï¼Œå¹¶é™„æœ‰è¯¦ç»†çš„å‚è€ƒæ–‡æ¡£ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥ç›´æ¥ä¸‹è½½æºç å¹¶æŒ‰ç…§æ–‡æ¡£è¿›è¡Œç¼–è¯‘ã€‚ç”±äº RK3399 æ‹¥æœ‰å¼ºå¤§çš„æ€§èƒ½ï¼Œèƒ½å¤Ÿç›´æ¥åœ¨å¼€å‘æ¿ä¸Šä¸‹è½½å’Œç¼–è¯‘æºä»£ç ï¼Œè¿™é¿å…äº†å¤šæ•°äº¤å‰ç¼–è¯‘æ‰€å¸¦æ¥çš„ä¸ä¾¿ã€‚ Tengine AI æ¡†æ¶çš„éƒ¨ç½²åœ¨ RK3399 å¼€å‘æ¿ä¸Šéƒ¨ç½² Tengine AI æ¡†æ¶éœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š 1. ä¸‹è½½æºç git clone --recurse-submodules https://github.com/OAID/tengine/ åœ¨ä¸‹è½½æºç æ—¶ï¼Œç¡®è®¤ä½¿ç”¨ --recurse-submodules å‚æ•°ï¼Œç¡®ä¿ä»£ç å®Œæ•´ã€‚ 2. å®‰è£…ä¾èµ–æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…å¿…éœ€çš„åº“å’Œå·¥å…·ï¼š apt install libprotobuf-dev protobuf-compiler libopencv-dev pkg-config 3. ä¿®æ”¹é…ç½®æ–‡ä»¶Tengine æºç ä¸­ï¼Œdefault_config ç›®å½•æä¾›äº†é’ˆå¯¹ arm32ã€arm64 å’Œ x86 ä¸‰ä¸ªå¹³å°çš„é…ç½®æ–‡ä»¶ã€‚ç”±äº RK3399 æ˜¯ Arm64ï¼Œæ‰€éœ€çš„é…ç½®æ–‡ä»¶ä¸º arm64_linux_native.configã€‚åœ¨æ‰§è¡Œç¼–è¯‘å‰ï¼Œå¿…é¡»åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰“å¼€ BUILD_SERIALIZER=y é€‰é¡¹ï¼Œå¦‚æœé—æ¼å¯èƒ½ä¼šå¯¼è‡´è¿è¡Œæ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼šShared library not found: libcaffe-serializer.so: cannot open shared object file: No such file or directoryã€‚ 4. ç¼–è¯‘åœ¨æºç æ ¹ç›®å½•ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š ./linux_build.sh default_config/arm64_linux_native.config 5. æ¨¡å‹AI åº”ç”¨è¿è¡Œæ—¶éœ€è¦åŠ è½½ç›¸åº”çš„ model æ–‡ä»¶ã€‚å°† model æ–‡ä»¶æ”¾åœ¨ Tengine æºç æ ¹ç›®å½•ä¸‹çš„ models æ–‡ä»¶å¤¹ã€‚ 6. è¿è¡Œ benchmarkå®Œæˆç¼–è¯‘åï¼Œé»˜è®¤æƒ…å†µä¸‹åœ¨ build/benchmark/bin/ ç›®å½•ä¸‹ç”Ÿæˆä¸¤ä¸ªç”¨äºæµ‹è¯•çš„ benchmark æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œè¿™äº›æ–‡ä»¶ï¼ŒéªŒè¯æ˜¯å¦æˆåŠŸç¼–è¯‘ã€‚ ./build/benchmark/bin/bench_sqz./build/benchmark/bin/bench_mobilenet 7. ç¼–è¯‘å¹¶è¿è¡Œæµ‹è¯• DemoTengine çš„æºç ä¸­è¿˜åŒ…å«äº†ä¸€äº›å›¾åƒè¯†åˆ«ç›¸å…³çš„æµ‹è¯• Demoï¼Œé€‚åˆè¿›è¡Œ AI ç›¸å…³çš„åŸºç¡€å­¦ä¹ ã€‚è¿™äº› Demo çš„æºç å­˜æ”¾åœ¨ examples ç›®å½•ä¸­ã€‚ç¼–è¯‘å‰éœ€è¦ä¿®æ­£ linux_build.sh è„šæœ¬ï¼Œç¡®ä¿ Tengine çš„å‡†ç¡®è·¯å¾„ã€‚æ¯”å¦‚æˆ‘ä¸‹è½½ç¼–è¯‘çš„ Tengine ä»£ç åœ¨ /root/rockdev/tengine ç›®å½•ä¸‹ï¼Œç„¶ååœ¨ examples ç›®å½•ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š mkdir buildcd build/../linux_build.sh make ç¼–è¯‘åçš„ä¸»è¦ Demo åŒ…æ‹¬ faster_rcnnã€lighten_cnnã€mobilenet_ssdã€mtcnnã€ssdã€yolov2 å’Œ YuFaceDetectNetã€‚ Faster R-CNNï¼šç”± Ross B. Girshick äº 2016 å¹´æå‡ºçš„æ¨¡å‹ï¼Œæ˜¯åœ¨ RCNN å’Œ Fast RCNN çš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥å‘å±•ï¼Œå…·æœ‰æ›´é«˜çš„æ€§èƒ½å’Œæ›´å¿«çš„æ£€æµ‹é€Ÿåº¦ã€‚æ‰§è¡Œæ­¤ Demo ä¹‹åï¼Œå¯ä»¥ç›‘æµ‹åˆ°ç›®æ ‡ç‰©ä½“ï¼Œç”Ÿæˆä¸€å¼ å¯¹æ£€æµ‹åˆ°çš„ç‰©ä½“è¿›è¡Œæ ‡æ³¨åçš„å›¾åƒã€‚ä¾‹å¦‚è¯†åˆ«ç»“æœä¸º Dogã€Bicycleã€Carã€‚ **YOLO (You Only Look Once)**ï¼š2016 å¹´ CVPR ä¸Šå‘è¡¨çš„ç›®æ ‡æ£€æµ‹æ–¹æ³•ï¼ŒYOLO v2 åœ¨ 2017 å¹´å†æ¬¡æ¨å‡ºï¼Œè®ºæ–‡ã€ŠYOLO9000: Better, Faster, Strongerã€‹è·å¾— CVPR 2017 é¢å‘çš„æœ€ä½³è®ºæ–‡è£èª‰æåã€‚é‡‡ç”¨æ­¤æ¨¡å‹çš„æ£€æµ‹é€Ÿåº¦å‡ ä¹å¿«äº† 6 å€ã€‚ **SSD (Single Shot MultiBox Detector)**ï¼šç”± Wei Liu æå‡ºçš„é€šç”¨ç‰©ä½“æ£€æµ‹ç®—æ³•ã€‚ Mobilenet å’Œ SSD ç»“åˆï¼šè¿™ç§ç»„åˆæ›´å‹å¥½äºç§»åŠ¨è®¾å¤‡ã€‚åœ¨ç›¸åŒçš„æµ‹è¯•å›¾ç‰‡ä¸Šï¼Œè™½ç„¶æ£€æµ‹é€Ÿåº¦æ›´å¿«ï¼Œä½†ä»æœ‰é—æ¼ã€‚ YuFaceDetectNetï¼šç”±æ·±åœ³å¤§å­¦çš„äºä»•çªè€å¸ˆå¼€æºçš„äººè„¸æ£€æµ‹åº“ï¼Œå£°ç§°ä¸ºæœ€å¿«çš„äººè„¸æ£€æµ‹åº“ã€‚ MTCNNï¼šå¦ä¸€ç§äººè„¸æ£€æµ‹æ–¹æ¡ˆï¼Œå…¶ç»“æœä¸ YuFaceDetectNet ç›¸å½“ï¼Œæ—¶é—´å·®è·ä¸å¤§ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿","åº”ç”¨è½¯ä»¶ç§»æ¤"]},{"title":"MySQLç§»æ¤","path":"/2024/10/07/6-å¼€å‘å·¥å…·-æ•°æ®åº“-MySQLç§»æ¤/","content":"å…³æ³¨ç‚¹åœ¨è¿›è¡Œ MySQL ç§»æ¤ä¹‹å‰ï¼Œæœ‰å‡ ä¸ªå…³é”®é—®é¢˜éœ€è¦ç‰¹åˆ«å…³æ³¨ï¼Œä»¥ç¡®ä¿æ•´ä¸ªè¿‡ç¨‹é¡ºåˆ©è¿›è¡Œï¼š -MySQL ç›®å‰å°šæœªæ”¯æŒäº¤å‰ç¼–è¯‘çš„ç‰ˆæœ¬**ï¼š - ç”±äº MySQL çš„æŸäº›ç‰ˆæœ¬ä¸æ”¯æŒäº¤å‰ç¼–è¯‘ï¼Œå› æ­¤åœ¨æ‰§è¡Œ configure è„šæœ¬æ—¶ï¼Œå¿…é¡»æ‰‹åŠ¨æ³¨é‡Šæ‰å¤šä¸ªä¸æ”¯æŒäº¤å‰ç¼–è¯‘çš„å‘½ä»¤ã€‚è¿™ä¸€æ­¥éª¤è‡³å…³é‡è¦ï¼Œå› ä¸ºå¦‚æœä¸å¤„ç†è¿™äº›å‘½ä»¤ï¼Œé…ç½®è¿‡ç¨‹å°†æ— æ³•é¡ºåˆ©å®Œæˆã€‚æ¯”å¦‚ï¼ŒæŸäº›ç‰¹å®šçš„åº“æˆ–åŠŸèƒ½åœ¨äº¤å‰ç¼–è¯‘ç¯å¢ƒä¸­å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œï¼Œå¯¼è‡´ç¼–è¯‘å¤±è´¥ã€‚ äº¤å‰ç¼–è¯‘éœ€è¦ libncurses.a åº“ï¼š libncurses.a æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†ç»ˆç«¯è¾“å…¥å’Œè¾“å‡ºçš„é™æ€åº“ã€‚åœ¨äº¤å‰ç¼–è¯‘ MySQL ä¹‹å‰ï¼Œå¿…é¡»ä½¿ç”¨ ncurses-5.6 ä¸­çš„ libncurses.a åº“ï¼Œè€Œä¸æ˜¯åŠ¨æ€é“¾æ¥åº“ libncurses.so.5ã€‚è¿™æ„å‘³ç€éœ€è¦å…ˆæ‰‹åŠ¨äº¤å‰ç¼–è¯‘ libncurses.aï¼Œä»¥ç¡®ä¿åœ¨ ARM å¹³å°ä¸Šèƒ½å¤Ÿæ­£ç¡®è¿è¡Œã€‚é™æ€åº“çš„ä½¿ç”¨å¯ä»¥é¿å…åœ¨è¿è¡Œæ—¶ä¾èµ–åŠ¨æ€åº“ï¼Œç¡®ä¿ç¨‹åºåœ¨ç›®æ ‡å¹³å°ä¸Šçš„å…¼å®¹æ€§ã€‚ gen_lex_hash å‘½ä»¤çš„å¤„ç†ï¼š åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è¿è¡Œ gen_lex_hash å‘½ä»¤ã€‚ç„¶è€Œï¼Œè¯¥å‘½ä»¤çš„ ARM æ ¼å¼ç‰ˆæœ¬æ— æ³•åœ¨ PC ä¸Šè¿è¡Œã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå»ºè®®å…ˆåœ¨ PC ä¸Šç¼–è¯‘å‡ºä¸€ä¸ªå¯ç”¨çš„ MySQL ç‰ˆæœ¬ï¼Œç„¶åä»ç›¸åº”ç›®å½•ä¸­æ‹·è´å¯ç”¨çš„ gen_lex_hash æ–‡ä»¶ï¼Œè¦†ç›–æ‰ ARM æ ¼å¼çš„æ–‡ä»¶ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨ ARM ç¼–è¯‘è¿‡ç¨‹ä¸­ä¸ä¼šå› ä¸ºç¼ºå°‘è¯¥æ–‡ä»¶è€Œå¯¼è‡´ç¼–è¯‘å¤±è´¥ã€‚ opensslï¼š OpenSSL æ˜¯ä¸ºåº”ç”¨ç¨‹åºæä¾›å®‰å…¨é€šä¿¡çš„åº“ï¼Œç¡®ä¿æ•°æ®åœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§ã€‚åœ¨ç¼–è¯‘ MySQL æ—¶ï¼Œç¡®ä¿ OpenSSL åº“çš„æ­£ç¡®ç‰ˆæœ¬å’Œè·¯å¾„æ˜¯è‡³å…³é‡è¦çš„ã€‚ boostï¼š Boost æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„ C++ åº“é›†ï¼Œæä¾›å¤šç§åŠŸèƒ½å¢å¼ºé¡¹ï¼ŒåŒ…æ‹¬æ•°æ®ç»“æ„ã€ç®—æ³•ã€æ–‡ä»¶ç³»ç»Ÿç­‰ã€‚MySQL çš„æŸäº›åŠŸèƒ½å¯èƒ½ä¾èµ–äº Boostï¼Œå› æ­¤ç¡®ä¿å…¶ç‰ˆæœ¬ä¸ MySQL å…¼å®¹æ˜¯å¿…è¦çš„ã€‚ ä¾èµ–åº“çš„ç‰ˆæœ¬ï¼š æ¯ä¸ª MySQL ç‰ˆæœ¬æ‰€ä¾èµ–çš„åº“ç‰ˆæœ¬ä¸èƒ½éšæ„é€‰æ‹©ï¼Œå…·ä½“ä¾èµ–å…³ç³»å¯ä»¥é€šè¿‡æŸ¥é˜… MySQL å®˜æ–¹æ–‡æ¡£æˆ–ç›¸å…³æ–‡çŒ®è·å¾—ã€‚ç¡®ä¿æ‰€æœ‰ä¾èµ–åº“çš„ç‰ˆæœ¬ä¸ MySQL ç‰ˆæœ¬åŒ¹é…ï¼Œå¯ä»¥é¿å…åœ¨ç¼–è¯‘å’Œè¿è¡Œæ—¶é‡åˆ°ä¸å¿…è¦çš„é”™è¯¯ã€‚ å‡†å¤‡å·¥ä½œ ä¸‹è½½ MySQL çš„ tar åŒ…ï¼šä¾‹å¦‚ï¼šmysql-5.1.51.tar.gz ä¸‹è½½é“¾æ¥ï¼šMySQL Tar åŒ… å’Œ MySQL Archivesã€‚é€‰æ‹©å¸¦æœ‰ Boost çš„ Generic Linux ç‰ˆæœ¬ï¼Œè¿™æ ·å¯ä»¥é¿å…é¢å¤–å®‰è£… Boost åº“ã€‚ http://www.mirrorservice.org/sites/ftp.mysql.com/Downloads/MySQL-5.1/mysql-5.1.51.tar.gzhttp://download.chinaunix.net/download.php?id=34712ResourceID=7159 ä¸‹è½½ ncurses-5.6 çš„ tar åŒ…ï¼šè®¿é—®å®˜æ–¹ç½‘ç«™æˆ–é•œåƒç«™ç‚¹ï¼Œç¡®ä¿ä¸‹è½½åˆ°æ­£ç¡®ç‰ˆæœ¬çš„ ncursesï¼Œä»¥ä¾¿åç»­ç¼–è¯‘ä½¿ç”¨ã€‚ å®‰è£… g++ ç¼–è¯‘å™¨ï¼šç¡®ä¿ç³»ç»Ÿä¸­å®‰è£…äº† g++ ç¼–è¯‘å™¨ï¼Œä»¥ä¾¿è¿›è¡Œ C++ ä»£ç çš„ç¼–è¯‘ã€‚ ç¡®ä¿å·²å®‰è£…äº¤å‰ç¼–è¯‘å™¨ï¼šç¡®ä¿äº¤å‰ç¼–è¯‘å™¨å·²æ­£ç¡®å®‰è£…ï¼Œå¹¶åœ¨ç»ˆç«¯ä¸­è®¾ç½®å¥½ç›¸åº”çš„ç¯å¢ƒå˜é‡ï¼Œä»¥ä¾¿åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­èƒ½å¤Ÿæ‰¾åˆ°äº¤å‰ç¼–è¯‘å·¥å…·ã€‚å¯ä»¥é€šè¿‡è¿è¡Œ arm-none-linux-gnueabi-gcc --version æ¥éªŒè¯äº¤å‰ç¼–è¯‘å™¨çš„å®‰è£…æƒ…å†µã€‚ ç¼–è¯‘ MySQL PC ç‰ˆæœ¬MySQL æºç åŒ…ï¼š æ­¥éª¤ a: è§£å‹ MySQL 5.1.51 tar zxvf mysql-5.1.51.tar.gz -C /opt/ æ­¥éª¤ b: è¿›å…¥è§£å‹åçš„ç›®å½• cd /opt/mysql-5.1.51 ç¼–è¯‘ æ­¥éª¤ c: é…ç½®ç¼–è¯‘ç›®å½• ./configure --prefix=/usr/local/mysql å®‰è£… MySQL æ•°æ®åº“æ—¶ï¼Œè¿è¡Œ ./configure å‘½ä»¤å¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹é”™è¯¯ä¿¡æ¯ï¼š error: No curses/termcap library found è¿™ä¸ªé”™è¯¯æç¤ºçš„åŸå› æ˜¯ç¼ºå°‘ ncurses å®‰è£…åŒ…ï¼Œncurses æ˜¯ä¸€ä¸ªç”¨äºç»ˆç«¯å¤„ç†çš„åº“ï¼ŒMySQL éœ€è¦è¿™ä¸ªåº“æ¥å®Œæˆç”¨æˆ·ç•Œé¢çš„æ˜¾ç¤ºå’Œæ§åˆ¶ã€‚ å®‰è£… ncurses é¦–å…ˆæ‰§è¡Œå‘½ä»¤æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼š sudo apt-get update æ¥ç€æ£€æŸ¥æ˜¯å¦å·²ç»å®‰è£… libncurses5-devï¼š sudo apt-cache search ncurses å®‰è£… libncurses5-devï¼š sudo apt-get install libncurses5-dev æ­¥éª¤ d: ç¼–è¯‘ make æ³¨æ„ï¼šæ­¤æ­¥éª¤ä¸éœ€è¦è¿è¡Œ make installï¼Œä¸»è¦ä¸ºäº†ç”Ÿæˆ gen_lex_hash åº“ã€‚ å®‰è£… æ­¥éª¤ e: é‡å‘½åæ–‡ä»¶å¤¹ä»¥å¤‡ä»½ mv mysql-5.1.51 mysql-5.1.51-pc ï¼ˆåŒæ—¶ç¡®ä¿ gen_lex_hash åº“è¢«å•ç‹¬å¤‡ä»½ã€‚ï¼‰ äº¤å‰ç¼–è¯‘ MySQL - ARM ç‰ˆæœ¬ç”±äº Boost åº“å·²ç»åŒ…å«åœ¨ä¸‹è½½çš„ MySQL åŒ…ä¸­ï¼Œå› æ­¤æ— éœ€å•ç‹¬å®‰è£… Boostã€‚åœ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ä¹‹å‰ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª mysqlbuild æ–‡ä»¶å¤¹ï¼Œå°†ä¸‹è½½çš„ MySQLã€ncurses å’Œ openssl åŒ…ä¼ å…¥è¯¥æ–‡ä»¶å¤¹ï¼Œä»¥ä¾¿äºç®¡ç†ã€‚ å®‰è£… ncurses æ­¥éª¤ a: ä¸‹è½½ ncurses wget ftp://ftp.gnu.org/gnu/ncurses/ncurses-5.9.tar.gz æ­¥éª¤ b: è§£å‹åˆ° opt tar zxvf ncurses-5.9.tar.gz -C /opt/ æ­¥éª¤ c: è¿›å…¥ ncurses ç›®å½• cd /opt/ncurses-5.9 æ­¥éª¤ d: é…ç½®ç¼–è¯‘é€‰é¡¹ ./configure --prefix=/home/farsight/ncurses CC=arm-none-linux-gnueabi-gcc --host=arm-none-linux-gnueabi --enable-static --enable-shared æ­¥éª¤ e: ç¼–è¯‘ make æ­¥éª¤ f: å®‰è£… ncurses sudo make install æ³¨æ„ï¼šå¯èƒ½ä¼šå‡ºç°æƒé™é”™è¯¯ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯ä»¥è¶…çº§ç”¨æˆ·èº«ä»½è¿è¡Œï¼š sudo -i; make install å®‰è£… OpenSSLå¯ä»¥é€šè¿‡ 3rd-part ä¸‹çš„è„šæœ¬è¿›è¡Œ OpenSSL çš„å®‰è£…ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å‰éœ€è¦ä¿®æ”¹ open_src_conf.xml æ–‡ä»¶ï¼Œå°† OpenSSL çš„ç‰ˆæœ¬å·æ›¿æ¢ä¸º openssl-1.1.1gï¼š cd /path/to/openssl./auto_install_opensrc.sh openssl ç¼–è¯‘ ARM ç‰ˆæœ¬çš„ MySQL æ­¥éª¤ a: è§£å‹ MySQL 5.1.51 tar zxvf mysql-5.1.51.tar.gz -C /opt/cd /opt/mysql-5.1.51 æ­¥éª¤ b: ä¿®æ”¹é…ç½®æ–‡ä»¶ ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ configure æ–‡ä»¶ï¼ŒæŸ¥æ‰¾ä»¥ä¸‹å‡ è¡Œå¹¶è¿›è¡Œä¿®æ”¹ï¼šæ‰¾åˆ°ä»¥ä¸‹å››ä¸ªå¯¹åº”è¡Œï¼ˆ26453ã€48175ã€48282ã€48485ï¼‰ï¼Œå¹¶æ³¨é‡Šæ‰ä¸å…è®¸äº¤å‰ç¼–è¯‘çš„éƒ¨åˆ†ã€‚å¦‚æœä»£ç å—çœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·ï¼Œ if test $cross_compiling = yes; then # ...else ä¿®æ”¹ä¸ºï¼š if test $cross_compiling = yes; then echo skip .....! # ...else æ³¨æ„ï¼šå…±éœ€æ›¿æ¢å››éƒ¨åˆ†ä»£ç ï¼Œç¡®ä¿å…¨éƒ¨ä¿®æ”¹ã€‚ æ­¥éª¤ c: é…ç½® ARM ç‰ˆæœ¬çš„ MySQLï¼Œé…ç½®æ—¶ï¼Œå¢åŠ  ncurses åº“çš„è·¯å¾„ï¼š ./configure --host=arm-linux --enable-static --with-named-curseslibs=/usr/local/ncurse/lib/libncurses.a --prefix=/usr/local/mysql --without-debug --without-docs --without-man --without-bench --with-charset=gb2312 --with-extracharsets=ascii,latin1,utf8 æ­¥éª¤ d: ä¿®æ”¹ sql_parse.cc æ–‡ä»¶ä»¥å®šä¹‰ STACK_DIRECTION åœ¨ /opt/mysql-5.1.51/sql/sql_parse.cc çš„æŸè¡Œä¹‹å‰æ·»åŠ ï¼š #define STACK_DIRECTION 1 è¯¥å®åœ¨ ARM ä¸­è®¾å®šä»¥é˜²ç¼–è¯‘é”™è¯¯ã€‚ æ­¥éª¤ e: å¤åˆ¶ PC ç‰ˆæœ¬çš„ gen_lex_hash æ–‡ä»¶åˆ°å½“å‰ç›®å½•,ç”¨ PC ç‰ˆæœ¬çš„ gen_lex_hash æ–‡ä»¶è¦†ç›– ARM æ ¼å¼çš„æ–‡ä»¶ï¼Œä»¥ç¡®ä¿ç¼–è¯‘æˆåŠŸã€‚ cp /opt/mysql-5.1.51-pc/sql/gen_lex_hash sql/touch -m sql/gen_lex_hashcp /opt/mysql-5.1.51-pc/sql/lex_hash.h sql/touch -m sql/lex_hash.h è¿™æ ·å¯ä»¥é˜²æ­¢å› ç¼ºå°‘æ–‡ä»¶è€Œå¯¼è‡´çš„é”™è¯¯ã€‚ æ­¥éª¤ f: ç¼–è¯‘ ARM ç‰ˆæœ¬ make æ­¥éª¤ g: å®‰è£… ARM ç‰ˆæœ¬ sudo make install åœ¨æ„å»ºç›®å½•ä¸­åˆ›å»º mysql ç›®å½•å¹¶ç§»åŠ¨åˆ°è¯¥ç›®å½•ï¼š cd mysql-8.0.22mkdir buildcd build æ‰§è¡Œ CMake é…ç½®ç¼–è¯‘é€‰é¡¹ï¼š cmake ... -LH -DCMAKE_INSTALL_PREFIX=/home/mysqlbuild/mysql-8.0.22/install \\-DMYSQL_DATADIR=/home/mysqlbuild/mysql-8.0.22/install/data \\-DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci \\-DENABLED_LOCAL_INFILE=1 \\-DCMAKE_CXX_COMPILER=/opt/hisi-linux/x86-arm/aarch64-himix100-linux/bin/aarch64-himix100-linux-g++ \\-DCMAKE_C_COMPILER=/opt/hisi-linux/x86-arm/aarch64-himix100-linux/bin/aarch64-himix100-linux-gcc \\-DWITH_BOOST=/home/mysqlbuild/mysql-8.0.22/boost/boost_1_73_0 \\-DWITH_SSL=/home/mysqlbuild/install \\-DWITH_SASL=/home/mysqlbuild/install \\-DCMAKE_SYSTEM_PROCESSOR=arm \\-DCURSES_INCLUDE_PATH=/home/mysqlbuild/install/include \\-DCURSES_LIBRARY=/home/mysqlbuild/install/lib/libncurses.a \\-DCMAKE_BUILD_TYPE=RELEASE -DWITH_TEST_TRACE_PLUGIN=0 -DIGNORE_AIO_CHECK=1 -DBUILD_CONFIG=mysql_release \\-DWITH_UNIT_TESTS=0 -DWITH_LIBEVENT=bundled -DEVENT__DISABLE_TESTS=ON \\-DRESOLV_LIBRARY=/opt/hisi-linux/x86-arm/aarch64-himix100-linux/aarch64-linux-gnu/libc/usr/lib/libresolv.so åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°å¤šä¸ªé”™è¯¯ï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š é”™è¯¯å¤„ç† é”™è¯¯ï¼šCMake Error at CMakeLists.txt:1374ï¼ˆéœ€è¦å®‰è£… patchelf å·¥å…·ï¼‰ è§£å†³æ–¹æ³•ï¼šæ³¨é‡Šæ‰ CMakeLists.txt ä¸­çš„æ£€æŸ¥éƒ¨åˆ†ã€‚ é”™è¯¯ï¼šLIBEVENT version must be at least 2.1, found .l è§£å†³æ–¹æ³•ï¼šæ³¨é‡Šæ‰ libevent æ£€æŸ¥çš„ç›¸å…³ä»£ç æ®µï¼Œå› ä¸ºè‡ªå¸¦çš„ libevent ç‰ˆæœ¬å·²ç»æ˜¯ 2.1.11ã€‚ é”™è¯¯ï¼šcannot execute binary fileï¼ˆå¤šä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸èƒ½æ‰§è¡Œï¼‰ è§£å†³æ–¹æ³•ï¼šå°† x86-64 ç‰ˆå¯æ‰§è¡Œæ–‡ä»¶ä»å…ˆå‰çš„ç¼–è¯‘ç›®å½•å¤åˆ¶åˆ°ç¼–è¯‘ç›®å½•ä¸­ã€‚ä¾‹å¦‚ï¼š cp /home/mysqlbuild/mysql-8.0.22pc/mysql-8.0.22/runtime_output_directory/uca9dump /home/mysqlbuild/mysql-8.0.22/build/runtime_output_directory/ å…¶ä»–ç›¸ä¼¼çš„æ–‡ä»¶ï¼ˆå¦‚ json_schema_embedderã€comp_sqlã€gen_lex_token ç­‰ï¼‰åŒç†å¤„ç†ã€‚ é”™è¯¯ï¼šhomemysqlbuildmysql-8.0.22storageinnobaseincludeos0atomic.ic:194:2: error: #error â€œUnsupported platformâ€ è§£å†³æ–¹æ³•ï¼šåœ¨ storage/innobase/include/os0atomic.h ä¸­æ·»åŠ ä¸€ä¸ªå®å®šä¹‰ HAVE_ATOMIC_BUILTINSã€‚ é”™è¯¯ï¼šusrlib64libresolv.so: error adding symbols: File in wrong format è§£å†³æ–¹æ³•ï¼šåœ¨ CMake é…ç½®ä¸­æŒ‡å®šä½¿ç”¨äº¤å‰ç¼–è¯‘å·¥å…·é“¾é‡Œçš„ libresolv.soï¼š -DRESOLV_LIBRARY=/opt/hisi-linux/x86-arm/aarch64-himix100-linux/aarch64-linux-gnu/libc/usr/lib/libresolv.so é”™è¯¯ï¼šâ€˜os_compare_and_swap_thread_idâ€™ was not declared in this scope è§£å†³æ–¹æ³•ï¼šå°†æ‰€æœ‰å‡ºç°çš„ os_compare_and_swap_thread_id æ”¹ä¸º os_compare_and_swap_lintã€‚ å°†ç›¸åº”æ–‡ä»¶ç§»æ¤åˆ° ARM å¹³å° æ­¥éª¤ a: æ‹·è´ç¼–è¯‘å¥½çš„ MySQL è‡³å¼€å‘æ¿ å¦‚æœä½¿ç”¨ NFS è°ƒè¯•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š cp -r /usr/local/mysql /opt/EmbedSky/root_nfs/usr/local/mysql æ­¥éª¤ b: å°† ARM çš„ MySQL åº“æ‰“åŒ…å¤‡ä»½ tar -zcvf mysql-arm-5.1.51.tar.gz mysql æ­¥éª¤ c: å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡ç‰ˆ cp /opt/mysql-5.1.51/support-files/mymedium.cnf /opt/EmbedSky/root_nfs/etc/my.cnf my.cnf çš„ä½ç½®æ ¹æ®æ‰‹å†Œå»ºè®®ä¿®æ”¹ã€‚æ•°æ®ç›®å½•å’Œå®‰è£…ç›®å½•çš„é»˜è®¤ä½ç½®åˆ†åˆ«æ˜¯ /var/lib/mysql å’Œ /usr/local/mysqlã€‚ MySQL åˆå§‹åŒ– æ­¥éª¤ a: è¿›å…¥ MySQL BIN ç›®å½• cd /usr/local/mysql/bin æ­¥éª¤ b: è¿è¡Œåˆå§‹åŒ–å‘½ä»¤ ./mysql_install_db -u root å¯èƒ½é‡åˆ°çš„é”™è¯¯éœ€å¤„ç†ï¼Œæ¯”å¦‚ï¼š Neither host EmbedSky nor localhost could be looked up with ... è¿™å¯ä»¥é€šè¿‡è®¾ç½® hostname æˆ–è€…ä½¿ç”¨ --force é€‰é¡¹æ¥è§£å†³ã€‚ æ­¥éª¤ c: åˆ›å»ºå¿…è¦çš„ PID æ–‡ä»¶ mkdir /usr/local/mysql/var/run/mysqldtouch /usr/local/mysql/var/run/mysqld/mysqld.pid æ­¥éª¤ d: å¤åˆ¶å¯åŠ¨è„šæœ¬ cp /opt/mysql-5.1.51/support-files/mysql.server /opt/EmbedSky/root_nfs/etc/init.d/mysqld æ­¥éª¤ e: ä¿®æ”¹å¯åŠ¨æ–‡ä»¶å¹¶è®¾å®šæƒé™ chmod +x /opt/EmbedSky/root_nfs/etc/init.d/mysqld å¯åŠ¨ MySQL æœåŠ¡ç”±äºå¼€å‘æ¿ä¸æ”¯æŒ service æŒ‡ä»¤ï¼Œéœ€æ‰‹åŠ¨å¯åŠ¨ï¼š ./etc/init.d/mysqld start é‡åˆ°çš„é”™è¯¯å¦‚â€œERROR! Manager of pid-file quit without updating fileâ€éœ€æŸ¥çœ‹æ—¥å¿—è·å–æ›´å¤šä¿¡æ¯ï¼š tail -f /var/lib/mysql/[hostname].err åœ¨å®Œæˆç¼–è¯‘åŠè°ƒæ•´åï¼Œæ‰§è¡Œ ./mysqld æŸ¥çœ‹ç¨‹åºæ˜¯å¦å¯ä»¥æ­£å¸¸å¯åŠ¨ã€‚åˆæ¬¡è¿è¡Œæ—¶å¯èƒ½ä¼šé‡åˆ°ç¼ºå°‘å¦‚ libprotobuf-lite.so.3.11.4 çš„é”™è¯¯ï¼Œéœ€å°†è¯¥åº“æ‹·è´è‡³ lib64 ä¸‹ï¼Œå¹¶åˆ›å»ºè½¯é“¾æ¥ã€‚ä¹‹åï¼Œä½¿ç”¨ ldd mysqld ç¡®è®¤ä¾èµ–åº“æ²¡æœ‰é—®é¢˜ã€‚æœ€ç»ˆä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ MySQLï¼š ./mysqld --basedir=/usr/local/mysql --datadir=/home/rundir/mysql/data --plugin-dir=/home/rundir/arm_build/install/lib/plugin --user=mysql --innodb-flush-method=O_DIRECT --skip-ssl --auto-generate-certs=FALSE --skip-sha256-password-auto-generate-rsa-keys --log-error=/home/rundir/mysql/data/mysqld_safe.log --pid-file=/home/rundir/mysql/data/mysql.pid --innodb_force_recovery=0 --admin-ssl=FALSE --caching-sha2-password-auto-generate-rsa-keys=FALSE ç»è¿‡åå¤å°è¯•ï¼Œå‘ç°è¯¥å‘½ä»¤èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨ MySQL å®ä¾‹ï¼Œä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼Œå¯ä»¥è¿›è¡Œæ•°æ®åº“çš„å…·ä½“æ“ä½œã€‚ æµ‹è¯• ARM å¹³å°ä¸‹çš„ MySQL æ­¥éª¤ a: è®¾ç½® MySQL root å¯†ç  mysqladmin -u root password hahaha æ­¥éª¤ b: è¿›å…¥ MySQL ç¯å¢ƒ mysql -h 127.0.0.1 -u root -p æ­¥éª¤ c: åˆ›å»ºæ•°æ®åº“åŠè¡¨ show databases;create database at91;use at91;create table node (id int(5) auto_increment not null primary key, node_ID char(40), param_ID_values varchar(900));","categories":["6.å¼€å‘å·¥å…·","æ•°æ®åº“"]},{"title":"æ›´æ”¹è‡ªå¯åŠ¨å›¾ç‰‡","path":"/2024/10/03/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-åº”ç”¨è½¯ä»¶ç§»æ¤-æ›´æ”¹è‡ªå¯åŠ¨å›¾ç‰‡/","content":"ä¸€ã€å†…æ ¸æ–‡ä»¶ä¿®æ”¹æ›´æ¢å›¾ç‰‡æ ¼å¼ä¸º .ppmåœ¨å†…æ ¸æ–‡ä»¶çš„ä¿®æ”¹è¿‡ç¨‹ä¸­ï¼Œç¬¬ä¸€æ­¥æ˜¯å°†æ›´æ¢çš„å›¾ç‰‡è½¬æ¢ä¸º .ppm æ ¼å¼ï¼Œè¿™æ˜¯å†…æ ¸èƒ½å¤Ÿè¯»å–çš„æ ¼å¼ä¹‹ä¸€ã€‚ä¸ºäº†å®ç°è¿™ä¸€è½¬æ¢ï¼Œå¯ä»¥åˆ©ç”¨ netpbm å·¥å…·åŒ…ï¼Œè¿™æ˜¯ä¸€ç»„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸“é—¨ç”¨äºå›¾åƒçš„è½¬æ¢ã€å¤„ç†å’Œç”Ÿæˆã€‚ å®‰è£… netpbm å·¥å…·åŒ…å¦‚æœçš„ Linux å¼€å‘ä¸»æœºå°šæœªå®‰è£… netpbmï¼Œå¯ä»¥é€šè¿‡ç½‘ç»œè½»æ¾å®‰è£…ã€‚æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š linux@ubuntu:~$ sudo apt-get install netpbm æ‰§è¡Œå®Œè¿™ä¸ªå‘½ä»¤åï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…æ‰€éœ€çš„å·¥å…·åŒ…ã€‚å¦‚æœçš„ç³»ç»Ÿæ²¡æœ‰äº’è”ç½‘è¿æ¥ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨ä¸‹è½½å¹¶å®‰è£…è¿™äº›å·¥å…·ï¼Œè¿™é€šå¸¸ä¼šæ¯”è¾ƒå¤æ‚ã€‚ è½¬æ¢å›¾ç‰‡æ ¼å¼å®‰è£…å®Œæˆåï¼Œä¾¿å¯ä»¥å¼€å§‹è½¬æ¢å¸Œæœ›ç”¨ä½œå¯åŠ¨ logo çš„å›¾ç‰‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæƒ³è¦è½¬æ¢çš„å›¾ç‰‡åä¸º logo.pngï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œã€‚ æ­¥éª¤è¯´æ˜ æ–‡ä»¶å‡†å¤‡ï¼šé¦–å…ˆï¼Œå°†éœ€è¦è½¬æ¢çš„ logo.png æ–‡ä»¶æ‹·è´åˆ° Linux ä¸»æœºçš„ä¸»ç›®å½•ä¸‹ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š linux@ubuntu:~$ cp /path/to/your/logo.png ~/ è¿™é‡Œçš„ /path/to/your/ æ˜¯å­˜æ”¾ logo.png çš„è·¯å¾„ã€‚ æ‰§è¡Œè½¬æ¢å‘½ä»¤ï¼šæ¥ä¸‹æ¥ï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥ç”Ÿæˆæ‰€éœ€çš„ .ppm æ–‡ä»¶ï¼š linux@ubuntu:~$ pngtopnm logo.png | ppmquant 224 | pnmtoplainpnm logo_linux_clut224.ppm pngtopnm æ˜¯å°† .png æ–‡ä»¶è½¬æ¢ä¸º .pnm çš„å‘½ä»¤ã€‚ ppmquant 224 å¯¹å›¾åƒè¿›è¡Œé‡åŒ–å¤„ç†ï¼Œå°†å…¶è‰²å½©æ•°é‡ç²¾ç®€ä¸º 224 ç§ï¼Œä»¥å‡å°‘æ–‡ä»¶å¤§å°ä¸”ä¿æŒå›¾åƒè´¨é‡ã€‚ pnmtoplainpnm å°†é‡åŒ–åçš„æ•°æ®è½¬åŒ–ä¸ºçº¯å‡€çš„ .ppm æ ¼å¼ã€‚ logo_linux_clut224.ppm å°†æœ€ç»ˆç»“æœè¾“å‡ºä¸ºåä¸º logo_linux_clut224.ppm çš„æ–‡ä»¶ã€‚ ç”Ÿæˆçš„ logo_linux_clut224.ppm æ–‡ä»¶ä¼šå­˜å‚¨åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç¡®è®¤æ–‡ä»¶å·²åˆ›å»ºï¼š linux@ubuntu:~$ ls è¿™ä¸€ç³»åˆ—æ“ä½œå®Œæˆåï¼Œçš„å¯åŠ¨ logo å›¾ç‰‡å°±æˆåŠŸè½¬æ¢ä¸ºå†…æ ¸æ‰€éœ€çš„æ ¼å¼ï¼Œå¹¶å‡†å¤‡å¥½ç”¨äºåç»­æ­¥éª¤ã€‚ äºŒã€å†…æ ¸æ–‡ä»¶ç¼–è¯‘1. æ‹·è´å†…æ ¸æºç é¦–å…ˆï¼Œå°†å†…æ ¸æºç æ–‡ä»¶å¤åˆ¶åˆ°çš„å®¶ç›®å½•ä¸‹ã€‚ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œå»ºè®®åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„æ–‡ä»¶å¤¹å‘½åä¸º Linux_srcã€‚æ¥ä¸‹æ¥ï¼Œè¿›å…¥è¯¥æ–‡ä»¶å¤¹å¹¶è§£å‹å†…æ ¸æºç æ–‡ä»¶ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š linux@ubuntu:~/Linux_src$ tar xvf kernel-imx-3.14.28.tar.xz åœ¨è¿™ä¸ªæ­¥éª¤ä¸­ï¼Œå°†çœ‹åˆ°ä¸€ç³»åˆ—çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹è¢«è§£å‹å‡ºæ¥ã€‚è¿™äº›æ–‡ä»¶åŒ…å«äº†å†…æ ¸çš„æºä»£ç ä»¥åŠåç»­ç¼–è¯‘æ‰€éœ€çš„å„ç§å·¥å…·å’Œé…ç½®æ–‡ä»¶ã€‚ 2. æ›¿æ¢å›¾ç‰‡æ¥ä¸‹æ¥ï¼Œéœ€è¦æ›¿æ¢å†…æ ¸å¯åŠ¨æ—¶æ˜¾ç¤ºçš„å›¾åƒã€‚å°†å·²ç»è½¬æ¢å¥½çš„ logo_linux_clut224.ppm æ–‡ä»¶æ‹·è´åˆ°ä»¥ä¸‹ç›®å½•ä¸­ï¼š linux@ubuntu:~/Linux_src/kernel-imx-3.14.28/drivers/video/logo è¿™ä¸€æ­¥å°†åŸæœ‰çš„ logo_linux_clut224.ppm æ–‡ä»¶æ›¿æ¢æˆè‡ªå·±çš„æ–‡ä»¶ï¼Œä»è€Œå®ç°æ›´æ¢å†…æ ¸å¯åŠ¨ç”»é¢çš„ç›®çš„ã€‚ç¡®ä¿æ–°æ–‡ä»¶çš„æ ¼å¼å’Œå°ºå¯¸ä¸åŸæ–‡ä»¶ç›¸åŒ¹é…ï¼Œä»¥é¿å…å¯èƒ½çš„å…¼å®¹æ€§é—®é¢˜ã€‚ 3. è¿›è¡Œå†…æ ¸ç¼–è¯‘åœ¨å¼€å§‹ç¼–è¯‘ä¹‹å‰ï¼Œéœ€è¦åœ¨ç³»ç»Ÿçš„ /var ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œå‘½åä¸º tftpbootã€‚è¿™å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®Œæˆï¼š linux@ubuntu:/var$ sudo mkdir tftpboot åˆ›å»ºå¥½æ–‡ä»¶å¤¹åï¼Œå°±å¯ä»¥å¼€å§‹å†…æ ¸çš„ç¼–è¯‘è¿‡ç¨‹ã€‚è¿›å…¥å†…æ ¸æºç ç›®å½•ï¼Œæ‰§è¡Œç¼–è¯‘å‘½ä»¤ï¼š linux@ubuntu:~/Linux_src/kernel-imx-3.14.28$ sudo ./build.sh åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è€å¿ƒç­‰å¾…ç¼–è¯‘å®Œæˆã€‚ç¼–è¯‘æ—¶é—´å¯èƒ½å› ä¸ºè®¡ç®—æœºçš„æ€§èƒ½è€Œæœ‰æ‰€ä¸åŒï¼Œé€šå¸¸åœ¨å‡ åˆ†é’Ÿåˆ°æ•°å°æ—¶ä¹‹é—´ã€‚ å¦‚æœåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­é‡åˆ°å¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼š /bin/sh : 1: lzop: not found è¿™è¯´æ˜çš„ç³»ç»Ÿç¼ºå°‘ lzop å·¥å…·ï¼Œå¯¼è‡´ç¼–è¯‘æ— æ³•è¿›è¡Œã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼Œå¹¶å®‰è£… lzopï¼š linux@ubuntu:/var$ sudo rm /var/lib/apt/lists/* -vflinux@ubuntu:/var$ sudo apt-get updatelinux@ubuntu:/var$ sudo apt-get install lzop è¿™ä¸‰æ¡å‘½ä»¤çš„ä½œç”¨åˆ†åˆ«æ˜¯æ¸…ç†è½¯ä»¶åŒ…åˆ—è¡¨ï¼Œæ›´æ–°è½¯ä»¶åŒ…ä¿¡æ¯ï¼Œç„¶åå®‰è£…ç¼ºå¤±çš„ lzop å·¥å…·ã€‚å®Œæˆå®‰è£…åï¼Œå¯ä»¥é‡æ–°æ‰§è¡Œå†…æ ¸ç¼–è¯‘å‘½ä»¤ï¼ŒæˆåŠŸç¼–è¯‘å†…æ ¸åï¼Œä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œå°±å¯ä»¥ä½¿ç”¨æ–°å†…æ ¸æ¥å¯åŠ¨çš„ç³»ç»Ÿäº†ã€‚ ä¸‰ã€å…¶ä»–1. æ›´æ¢å¼€æœºè‡ªå¯å›¾ç‰‡ åœ¨æ›´æ¢å¼€æœºè‡ªå¯å›¾ç‰‡æ—¶ï¼ŒåŠ¡å¿…æ³¨æ„ä»¥ä¸‹æ­¥éª¤ï¼šé¦–å…ˆï¼Œä¸è¦å¯¹æºä»£ç åšä»»ä½•ä¿®æ”¹ï¼Œç›´æ¥è¿›è¡Œç¼–è¯‘ã€‚è¿™ä¸€æ­¥å¾ˆé‡è¦ï¼Œå› ä¸ºä»»ä½•ç»†å¾®çš„æ”¹åŠ¨éƒ½å¯èƒ½å¯¼è‡´æ„å¤–çš„ç¼–è¯‘é”™è¯¯ã€‚ç¼–è¯‘å®Œæˆå¹¶ç¡®è®¤æ— è¯¯åï¼Œå°†è½¬æ¢å¥½çš„ ppm æ ¼å¼çš„å›¾ç‰‡æ–‡ä»¶å¤åˆ¶åˆ°æŒ‡å®šç›®å½•ã€‚ç¡®ä¿æ–‡ä»¶è·¯å¾„å’Œåç§°å‡†ç¡®æ— è¯¯ï¼Œä¸€æ—¦å›¾ç‰‡è¢«æ”¾ç½®åˆ°æ­£ç¡®çš„ä½ç½®ï¼Œå†æ¬¡è¿›è¡Œç¼–è¯‘ï¼Œä»¥ä¿è¯æ›´æ¢ç”Ÿæ•ˆã€‚ 2. png æ ¼å¼å›¾ç‰‡è½¬æ¢é—®é¢˜ å½“ä½¿ç”¨ netpbm å·¥å…·å°† png æ ¼å¼çš„å›¾ç‰‡è½¬æ¢æˆ ppm æ ¼å¼æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°é”™è¯¯æˆ–å›¾åƒå¤±å¸§çš„ç°è±¡ã€‚è¿™é€šå¸¸ä¸ä»¥ä¸‹å‡ ä¸ªå› ç´ æœ‰å…³ï¼š å›¾ç‰‡åˆ†è¾¨ç‡é™åˆ¶ï¼šè¾“å…¥çš„ png å›¾ç‰‡åˆ†è¾¨ç‡å¿…é¡»ä¸è¶…è¿‡ LCD æ˜¾ç¤ºå™¨çš„åˆ†è¾¨ç‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœçš„ LCD åˆ†è¾¨ç‡æ˜¯ 800x600 åƒç´ ï¼Œé‚£ä¹ˆè¾“å…¥çš„ png å›¾åƒä¸èƒ½å¤§äºè¿™ä¸ªå°ºå¯¸ï¼Œå¯ä»¥å…è®¸å°ºå¯¸æ›´å°ï¼Œä½†ç»å¯¹ä¸èƒ½æ›´å¤§ã€‚ è°ƒè‰²æ¿é™åˆ¶ï¼šppm æ ¼å¼çš„å›¾åƒè°ƒè‰²æ¿æ˜¯ä» 0x20 å¼€å§‹ç¼–å†™çš„ï¼Œå› æ­¤æœ€å¤šèƒ½è¡¨ç¤º 224 ç§é¢œè‰²ã€‚0-0x1f çš„ 32 ç§é¢œè‰²æ˜¯ä¸å¯é çš„ï¼Œè¿™æ„å‘³ç€è¿™äº›é¢œè‰²çš„æ˜¾ç¤ºå¯èƒ½ä¼šå‡ºé”™æˆ–ä¸ä¸€è‡´ï¼Œå› æ­¤åœ¨è®¾è®¡å›¾åƒæ—¶è¦é¿å…ä½¿ç”¨è¿™äº›é¢œè‰²ä»£ç ã€‚ 3. logo æ˜¾ç¤ºä¸å±…ä¸­ ä¸ºäº†è§£å†³ logo æ˜¾ç¤ºä¸å±…ä¸­çš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤è°ƒæ•´ä»£ç ï¼š æ‰“å¼€æ–‡ä»¶ drivers/video/fbmem.cï¼Œæ‰¾åˆ°å‡½æ•° fb_show_logo_lineã€‚ æ›¿æ¢ä»¥ä¸‹ä¸¤è¡Œä»£ç ï¼š image.dx = 0; image.dy = y; ä¿®æ”¹ä¸ºï¼š image.dx = (info-var.xres / 2) - (X / 2); image.dy = (info-var.yres / 2) - (Y / 2); åœ¨è¿™é‡Œï¼Œinfo-var.xres å’Œ info-var.yres åˆ†åˆ«ä»£è¡¨æ˜¾ç¤ºå™¨çš„æ°´å¹³å’Œå‚ç›´åˆ†è¾¨ç‡ï¼Œè€Œ X å’Œ Y æ˜¯ logo å›¾ç‰‡çš„å°ºå¯¸ã€‚é€šè¿‡è®¡ç®—ï¼Œå°† logo å®šä½åˆ°å±å¹•çš„ä¸­å¿ƒã€‚ ç„¶åï¼Œåœ¨æ–‡ä»¶ drivers/video/console/fbcon.c ä¸­æ‰¾åˆ°å‡½æ•° fbcon_prepare_logoï¼Œåœ¨ä»¥ä¸‹ä»£ç è¡Œåæ·»åŠ å†…å®¹ï¼š logo_height = fb_prepare_logo(info, ops-rotate); ç´§æ¥ç€å¢åŠ è¿™ä¸€è¡Œï¼š logo_height += (info-var.yres / 2) - (Y / 2); è¿™æ ·å¯ä»¥ç¡®ä¿ logo çš„å‚ç›´ä½ç½®è°ƒæ•´å¾—å½“ã€‚ 4. å°†å¼€æœºå›¾ç‰‡æ›´æ”¹ä¸ºä¸€å¼  æ›´æ”¹å¼€æœºå›¾ç‰‡ä¸ºä¸€å¼ æ–°å›¾åƒæ—¶ï¼Œè¯·ç¡®ä¿å›¾åƒæ–‡ä»¶ç¬¦åˆä¸Šè¿° ppm æ ¼å¼çš„è¦æ±‚ï¼ŒåŒ…æ‹¬åˆ†è¾¨ç‡å’Œé¢œè‰²é™åˆ¶ã€‚åŒæ—¶ï¼Œè¿˜è¦ç¡®ä¿åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶èƒ½æ­£ç¡®æ‰¾åˆ°å¹¶åŠ è½½æ–°å›¾ç‰‡ï¼Œä»¥ä¾¿æ›¿æ¢åŸæœ‰çš„å¼€æœºå›¾åƒã€‚ 5. TF å¡åˆ¶ä½œé—®é¢˜ å¦‚æœ TF å¡åˆ¶ä½œæˆåŠŸï¼Œä½†åœ¨ SD æ¨¡å¼å¯åŠ¨æ—¶æ²¡æœ‰ååº”ï¼Œå»ºè®®ä½¿ç”¨ Class 4 ä½é€Ÿ TF å¡ã€‚å› ä¸ºé«˜é€Ÿ TF å¡å¯èƒ½åœ¨æŸäº›æƒ…å†µä¸‹å› ä¸ºé©±åŠ¨èƒ½åŠ›ä¸è¶³è€Œæ— æ³•è¢«è¯†åˆ«ã€‚æ­¤å¤–ï¼Œç¡®ä¿è¯¥ TF å¡åªæœ‰ä¸€ä¸ªåˆ†åŒºï¼Œå¹¶ä¸”æ ¼å¼åŒ–ä¸º FAT32ã€‚è¿™æ˜¯å› ä¸ºæŸäº›å¯åŠ¨ç¨‹åºå¯¹å­˜å‚¨è®¾å¤‡çš„åˆ†åŒºå’Œæ ¼å¼è¦æ±‚è¾ƒä¸ºä¸¥æ ¼ï¼Œé”™è¯¯çš„è®¾ç½®å¯èƒ½å¯¼è‡´å¯åŠ¨å¤±è´¥ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿","åº”ç”¨è½¯ä»¶ç§»æ¤"]},{"title":"æ„å»ºwestonæ¡Œé¢","path":"/2024/10/02/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-åº”ç”¨è½¯ä»¶ç§»æ¤-æ„å»ºwestonæ¡Œé¢/","content":"ç®€ä»‹Wayland æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æ˜¾ç¤ºæœåŠ¡å™¨åè®®ï¼Œç½‘ç«™åœ°å€ä¸º Waylandå®˜ç½‘ã€‚å®ƒçš„è®¾è®¡ç†å¿µæ˜¯å–ä»£å·²æœ‰è¿‘ä¸‰åå¹´å†å²çš„ X å›¾å½¢ç³»ç»Ÿã€‚ç›¸æ¯”äº Xï¼ŒWayland çš„æ¶æ„åœ¨çµæ´»æ€§å’Œæ€§èƒ½ä¸Šæœ‰æ˜¾è‘—æå‡ã€‚åœ¨ Wayland ä¸­ï¼ŒWayland compositor ä¸å®¢æˆ·ç«¯ä¹‹é—´ç›´æ¥è¿›è¡Œé€šä¿¡ï¼Œè€Œä¼ ç»Ÿçš„ X ç³»ç»Ÿåˆ™ä¾é ä¸€ä¸ªä¸­å¤®çš„ X Server æ¥è¿æ¥å®¢æˆ·ç«¯ã€ç¡¬ä»¶å’Œåˆæˆå™¨ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒX Server ä¸­è®¸å¤šåŠŸèƒ½å·²ç»é€æ¸è½¬ç§»è‡³å†…æ ¸æˆ–ç‹¬ç«‹åº“ä¹‹ä¸­ï¼Œä½¿å¾—å…¶æ˜¾å¾—è‡ƒè‚¿ä¸å ªã€‚Wayland é€šè¿‡å»æ‰è¿™ä¸€ä¸­é—´å±‚ï¼Œç®€åŒ–äº†æ¶æ„ï¼Œæå‡äº†ç³»ç»Ÿçš„æ•ˆç‡ã€‚ ç›¸å…³èµ„æº Wayland å®˜ç½‘: http://wayland.freedesktop.org/ æ„å»ºæŒ‡å—: Wayland Building Guide ä¸‹è½½å·¥å…·åº“åœ¨å¼€å§‹å®‰è£…å’Œæ„å»ºä¹‹å‰ï¼Œéœ€å‡†å¤‡å¥½ç›¸å…³å·¥å…·å’Œåº“ã€‚ä»¥ä¸‹å‘½ä»¤å°†å¸®åŠ©ç”¨æˆ·å®‰è£…å¿…éœ€çš„å·¥å…·ï¼š sudo apt install python3-pip git ninja-build cmakepip3 install --user mesonsudo apt install libffi-dev libxml2-dev graphviz doxygen xsltproc xmlto ä¸Šè¿°å‘½ä»¤ä¸­ï¼š python3-pip æ˜¯ Python çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¾¿äºå®‰è£… Python åº“ã€‚ git ç”¨äºç‰ˆæœ¬æ§åˆ¶å’Œä»£ç ç®¡ç†ï¼Œä¸‹è½½é¡¹ç›®ä»£ç ã€‚ ninja-build å’Œ cmake æ˜¯æ„å»ºå·¥å…·ï¼Œç”¨äºç®¡ç†è½¯ä»¶æ„å»ºæµç¨‹ã€‚ meson æ˜¯ä¸€ä¸ªé«˜æ•ˆã€ç”¨æˆ·å‹å¥½çš„æ„å»ºç³»ç»Ÿï¼Œé€‚åˆå¤„ç†å¤šç§ç¼–ç¨‹è¯­è¨€çš„é¡¹ç›®ã€‚ å®‰è£… Ninjaæ¥ä¸‹æ¥ï¼Œä¸‹è½½å¹¶å®‰è£… Ninja æ„å»ºç³»ç»Ÿï¼š git clone https://github.com/ninja-build/ninja.gitcd ninja./configure.py --bootstrapcp ./ninja /usr/bin/ è¿™é‡Œçš„æ­¥éª¤åŒ…æ‹¬ä» GitHub å…‹éš† Ninja çš„æºä»£ç ï¼Œé…ç½®æ„å»ºç¯å¢ƒï¼Œå¹¶å°†æ„å»ºå¥½çš„ ninja æ–‡ä»¶å¤åˆ¶åˆ°ç³»ç»Ÿå¯æ‰§è¡Œè·¯å¾„ä¸­ã€‚ è®¾ç½®ç¯å¢ƒå˜é‡åœ¨å®‰è£… Weston å‰ï¼Œéœ€æ ¹æ®æ˜¯å¦å¸Œæœ›å°†å…¶å®‰è£…åœ¨ç³»ç»Ÿè·¯å¾„ä¸­åšå‡ºç›¸åº”è®¾ç½®ã€‚ å¦‚æœå¸Œæœ›å®‰è£…åœ¨ç”¨æˆ·ç‰¹å®šè·¯å¾„export WLD=$HOME/installexport LD_LIBRARY_PATH=$WLD/libexport PKG_CONFIG_PATH=$WLD/lib/pkgconfig/:$WLD/share/pkgconfig/export PATH=$WLD/bin:$PATH åœ¨è¿™æ®µä»£ç ä¸­ï¼ŒWLD å˜é‡æŒ‡å®šäº†å®‰è£…ä½ç½®ï¼ŒLD_LIBRARY_PATH è´Ÿè´£é“¾æ¥åŠ¨æ€åº“ã€‚PKG_CONFIG_PATH ç”¨äºæ‰¾åˆ°åº“çš„é…ç½®æ–‡ä»¶ï¼Œè€Œ PATH åˆ™ç¡®ä¿å‘½ä»¤è¡Œå¯ä»¥æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶ã€‚ å¦‚æœå¸Œæœ›å°† Weston å®‰è£…åœ¨ç³»ç»Ÿè·¯å¾„export WLD=/usr# ä¹‹åæ‰€æœ‰ meson æ„å»ºå‘½ä»¤æ›´æ”¹ä¸ºä»¥ä¸‹å‘½ä»¤meson build/ --prefix=$WLD --libdir=/usr/lib --sysconfdir=/etcninja -C build/sudo ninja -C build/ install è¿™é‡Œè®¾ç½®äº† WLD ä¸ºç³»ç»Ÿè·¯å¾„ï¼Œåç»­çš„æ„å»ºå‘½ä»¤å°†ä¾æ®æ–°çš„è·¯å¾„å®‰è£… Westonã€‚ æ„å»º Waylandæ¥ä¸‹æ¥å¼€å§‹ä¸‹è½½å’Œæ„å»º Waylandï¼š git clone https://gitlab.freedesktop.org/wayland/wayland.gitcd waylandmeson build/ --prefix=$WLDninja -C build/ install åœ¨è¿™ä¸ªæ­¥éª¤ä¸­ï¼Œé¦–å…ˆæ˜¯ä¸‹è½½ Wayland çš„æºä»£ç ï¼Œæ¥ç€ä½¿ç”¨ Meson é…ç½®æ„å»ºç›®å½•ï¼Œå¹¶å®‰è£…æ„å»ºç»“æœã€‚ æ„å»º Wayland Protocolsæ„å»º Wayland çš„åè®®åº“ä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦æ­¥éª¤ï¼š git clone https://gitlab.freedesktop.org/wayland/wayland-protocols.gitcd wayland-protocolsmeson build/ --prefix=$WLDninja -C build/ install è¿™ä¸ªè¿‡ç¨‹å’Œæ„å»º Wayland å‡ ä¹ç›¸åŒï¼Œç¡®ä¿åè®®æ–‡ä»¶èƒ½å¤Ÿæ­£ç¡®å·¥ä½œã€‚ æ„å»º Westonæ¥ä¸‹æ¥ï¼Œä¸‹è½½å¹¶æ„å»º Westonï¼š git clone https://gitlab.freedesktop.org/wayland/weston.gitcd westonmeson build/ --prefix=$WLDninja -C build/ install é€šè¿‡è¿™äº›å‘½ä»¤ï¼ŒWeston å°†ä»æºä»£ç æ„å»ºå¹¶å‡†å¤‡å®‰è£…ã€‚ è¿è¡Œ Westonå®Œæˆå®‰è£…åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ Westonï¼š weston è¿è¡Œåï¼Œå°†ä¼šè¿›å…¥ Weston çš„æ¡Œé¢ç¯å¢ƒã€‚ Weston çš„ä¸€äº›æµ‹è¯•ç¨‹åºåœ¨ Weston çš„ç»ˆç«¯ä¸­ï¼Œå¯ä»¥é€šè¿‡è¾“å…¥ä¸‹åˆ—å‘½ä»¤å¯åŠ¨ä¸€äº›ç¤ºä¾‹åº”ç”¨ï¼Œæµ‹è¯•å…¶åŠŸèƒ½ï¼š weston-terminal: ä¸€ä¸ªç®€å•çš„ç»ˆç«¯ä»¿çœŸå™¨ï¼Œå°½ç®¡ä¸å®Œå…¨å…¼å®¹ï¼Œä½†å¯¹ä½¿ç”¨ bash çš„åŸºæœ¬éœ€æ±‚è¶³å¤Ÿæ»¡è¶³ã€‚ weston-flower: åœ¨å±å¹•ä¸Šç»˜åˆ¶ä¸€æœµèŠ±ï¼Œæ˜¯å¯¹æ¡†æ¶åè®®çš„æµ‹è¯•ã€‚ weston-gears: ç±»ä¼¼äº GLX Gearsï¼Œç”¨äºæµ‹è¯• Wayland çš„å›¾å½¢æ€§èƒ½ã€‚ weston-smoke: æµ‹è¯•å…±äº«å†…å­˜ (SHM) çš„ç¼“å†²åŒºã€‚ weston-image: åŠ è½½å¹¶æ˜¾ç¤ºé€šè¿‡å‘½ä»¤è¡Œä¼ é€’çš„å›¾åƒæ–‡ä»¶ã€‚ weston-view: å¯¹ PDF æ–‡ä»¶æ‰§è¡Œç±»ä¼¼æ“ä½œã€‚ weston-resizor: æ¼”ç¤ºå¹³æ»‘çš„çª—å£å¤§å°è°ƒæ•´ï¼Œå¯é€šè¿‡ä¸Šä¸‹é”®è°ƒæ•´ã€‚ weston-eventdemo: å°† libtoytoolkit çš„äº‹ä»¶æŠ¥å‘Šåˆ°æ§åˆ¶å°ï¼Œæä¾›ç›¸å…³å¸®åŠ©å¯é€šè¿‡ weston-eventdemo --help è·å–ã€‚ è¿™äº›æµ‹è¯•ç¨‹åºèƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·æ·±å…¥ç†è§£ Wayland çš„æ„å»ºæ•ˆæœåŠå…¶å·¥ä½œæ–¹å¼ã€‚ å‚æ•°é…ç½®weston å‚è€ƒæ–‡æ¡£ weston.ini weston-drm manpages.org for weston.ini weston çš„ä½¿ç”¨ CSDNåšå®¢å…³äºwestonä½¿ç”¨çš„æ–‡ç«  CSDNåšå®¢å…³äºwestonè®¾ç½®çš„æ–‡ç«  X Keyboardé…ç½® RK3399 å¹³å° weston æ¡Œé¢ å¹³å°ï¼š RK3399 ç³»ç»Ÿï¼š Linux 4.4 + Buildroot ç›¸å…³æ–‡ä»¶ /etc/init.d/S31weston - weston è‡ªå¯åŠ¨ç¨‹åº /etc/xdg/weston/weston.ini - weston é…ç½®æ–‡ä»¶ /etc/profile.d/env.sh - ç¯å¢ƒå˜é‡é…ç½® /etc/init.d/S31weston#!/bin/sh## Start linux launcher...#case $1 in start) printf Starting weston source /etc/profile.d/env.sh weston -c /etc/xdg/weston/weston.ini --tty=2 --idle-time=0 --log=/var/log/weston.log ;; stop) killall weston printf stop finished ;; *) echo Usage: $0 start|stop exit 1 ;;esacexit 0 /etc/xdg/weston/weston.ini[core]# Boards could have not any input device, and only use# removable input device like usb(keyboard, mouse).#require-input=false[shell]panel-position=none /etc/profile.d/env.sh#!/bin/sh export LC_ALL=zh_CN.utf8export QT_QPA_PLATFORM=wayland#export WESTON_DRM_MIRROR=1export WESTON_DRM_KEEP_RATIO=1export QT_GSTREAMER_WINDOW_VIDEOSINK=waylandsinkmkdir -p /tmp/.xdg chmod 0700 /tmp/.xdgexport XDG_RUNTIME_DIR=/tmp/.xdgexport PATH=$PATH:/usr/bin/cmdexport QT_QPA_GENERIC_PLUGINS=evdevkeyboard weston é…ç½®æ–‡ä»¶è§£æweston å¯ä»¥ä»å‘½ä»¤è¡Œå’Œé…ç½®æ–‡ä»¶ï¼ˆweston.iniï¼‰è·å–é…ç½®ä¿¡æ¯ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºä»¥åˆé€‚çš„æ–¹å¼å¯åŠ¨å’Œè¿è¡Œã€‚weston.ini çš„å¤šç§å­˜æ”¾è·¯å¾„ç¡®ä¿çµæ´»æ€§ï¼ŒåŒ…æ‹¬ï¼š $XDG_CONFIG_HOME/weston.iniï¼ˆå½“è®¾ç½®äº† $XDG_CONFIG_HOME æ—¶ï¼‰ $HOME/.config/weston.iniï¼ˆå½“è®¾ç½®äº† $HOME æ—¶ï¼‰ $XDG_CONFIG_DIR/weston/weston.iniï¼ˆå½“è®¾ç½®äº† $XDG_CONFIG_DIRS æ—¶ï¼‰ /etc/xdg/weston/weston.iniï¼ˆå½“æœªè®¾ç½® $XDG_CONFIG_DIRDS æ—¶ï¼‰ weston.ini æ–‡ä»¶çš„ç»„æˆéƒ¨åˆ†weston.ini æ–‡ä»¶ç”±å¤šä¸ªéƒ¨åˆ†æ„æˆï¼Œæ¯ä¸ªéƒ¨åˆ†è´Ÿè´£ä¸åŒçš„åŠŸèƒ½ï¼Œä¸åŒéƒ¨åˆ†çš„é¡ºåºæ— å…³ç´§è¦ã€‚ä¸»è¦éƒ¨åˆ†åŒ…æ‹¬ï¼š **[core]**ï¼šé€‰æ‹©å¯åŠ¨åˆæˆå™¨æ¨¡å—å’Œå¸¸è§„é€‰é¡¹ã€‚ **[libinput]**ï¼šç”¨äºé…ç½®è¾“å…¥è®¾å¤‡ã€‚ **[shell]**ï¼šè‡ªå®šä¹‰æ¡Œé¢ç¯å¢ƒã€‚ **[launcher]**ï¼šæ·»åŠ å¯åŠ¨å™¨åˆ°é¢æ¿ã€‚ **[output]**ï¼šé…ç½®è¾“å‡ºè®¾ç½®ã€‚ **[input-method]**ï¼šè®¾ç½®å±å¹•é”®ç›˜è¾“å…¥æ³•è·¯å¾„ã€‚ **[keyboard]**ï¼šè®¾ç½®é”®ç›˜æ ¼å¼å’Œå‚æ•°ã€‚ **[terminal]**ï¼šé…ç½®ç»ˆç«¯åº”ç”¨ç¨‹åºï¼ˆå¦‚ weston-terminalï¼‰ã€‚ **[xwayland]**ï¼šè®¾ç½® XWayland é€‰é¡¹ã€‚ **[screen-share]**ï¼šå±å¹•å…±äº«é€‰é¡¹ã€‚ æ—‹è½¬ weston æ¸²æŸ“çš„ qt ç¨‹åºé€šè¿‡é…ç½® output å­—æ®µå¹¶æ·»åŠ æ˜¾ç¤ºè®¾å¤‡åç§°åŠæ—‹è½¬è§’åº¦å³å¯å®ç° QT ç¨‹åºçš„æ—‹è½¬ã€‚ä¾‹å¦‚ï¼š [output]name=DSI-1transform=90 è¿è¡Œ weston çš„å‘½ä»¤å¦‚ä¸‹ï¼Œå¯åŠ¨æ—¥å¿—å°†è®°å½•åœ¨ /var/log/weston.log ä¸­ï¼š weston -c /etc/xdg/weston/weston.ini --tty=2 --idle-time=0 --log=/var/log/weston.log ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ˜¾ç¤ºè®¾å¤‡åç§°ï¼Œä»¥ç¡®è®¤æˆåŠŸé…ç½®ï¼š cat /var/log/weston.log | grep Output ç¤ºä¾‹è¾“å‡ºï¼š [06:35:51.270] Output repaint window is 15 ms maximum.[06:35:51.510] Output DSI-1, (connector 91, crtc 83) ç›¸å…³å†…å®¹æŸ¥çœ‹å½“å‰ DRM è®¾å¤‡çš„å‘½ä»¤ï¼š ls /sys/class/drm/ ç¤ºä¾‹è¾“å‡ºï¼š card0/ card0-DPI-1/ card0-HDMI-A-1/ card1/ controlD64/ renderD128/ renderD129/ version åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°å¤šä¸ªè¾“å‡ºè®¾å¤‡é…ç½®ï¼š [output] name=HDMI-A-1 virtualIndex=0[output] name=DSI-1 virtualIndex=1","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿","åº”ç”¨è½¯ä»¶ç§»æ¤"]},{"title":"å†…æ ¸ç§»æ¤","path":"/2024/10/01/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-ç³»ç»Ÿç§»æ¤-å†…æ ¸ç§»æ¤/","content":"ç¬¬ä¸€æ­¥ï¼šä» Linux å®˜ç½‘ä¸‹è½½å†…æ ¸è®¿é—® Linux å®˜ç½‘ kernel.orgï¼Œè¯¥ç½‘ç«™æ˜¯å¯»æ‰¾å¹¶è·å– Linux å†…æ ¸æºä»£ç çš„ä¸»è¦æ¸ é“ã€‚ä¸»é¡µä¸Šæ˜¾ç¤ºäº†å¤šä¸ªå†…æ ¸ç‰ˆæœ¬çš„ä¸‹è½½é€‰é¡¹ã€‚ä¸ºäº†ç¡®ä¿ç‰ˆæœ¬ä¸å…ˆå‰è®¾å¤‡æ ‘æ•™ç¨‹ä¸€è‡´ï¼Œé€‰æ‹©ç‰ˆæœ¬ 4.14.2ã€‚ç‚¹å‡»ä¸‹è½½é“¾æ¥åï¼Œä¸‹è½½å°†å¼€å§‹ã€‚ä¸‹è½½å®Œæˆåï¼Œå°†æ–‡ä»¶ä¿å­˜åˆ° Ubuntu ç³»ç»Ÿå†…ï¼Œè¿™æ ·åç»­æ­¥éª¤å¯ä»¥è½»æ¾è®¿é—®ã€‚å¯ä»¥é€‰æ‹©å°†å…¶å­˜æ”¾åœ¨ä¸ªäººå·¥ä½œç›®å½•æˆ–æŒ‡å®šçš„é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œæ–¹ä¾¿æ—¥åçš„ç»„ç»‡å’ŒæŸ¥æ‰¾ã€‚ ä¸‹è½½ç¤ºä¾‹ æ‰“å¼€ç»ˆç«¯ã€‚ è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå¼€å§‹ä¸‹è½½ï¼š wget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.14.2.tar.xz è¿™å°†ä½¿ç”¨ wget å‘½ä»¤ç›´æ¥ä»æœåŠ¡å™¨ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„ Linux å†…æ ¸ã€‚ ç¬¬äºŒæ­¥ï¼šå®‰è£…ç¼–è¯‘å™¨ç¼–è¯‘å™¨ç‰ˆæœ¬æ‰€éœ€çš„ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸º gcc-4.6.2-glibc-2.13-linaro-multilib-2011.12.tar.gzã€‚è¿™ä¸ªç‰ˆæœ¬çš„ GCC æ˜¯ç¼–è¯‘ ARM æ¶æ„å†…æ ¸å’Œåº”ç”¨ç¨‹åºçš„é‡è¦å·¥å…·ã€‚ Ubuntu ç‰ˆæœ¬ç¡®è®¤ä½¿ç”¨çš„ Ubuntu ç‰ˆæœ¬ä¸º Ubuntu 12.04ã€‚è™½ç„¶è¿™ä¸ªç‰ˆæœ¬æ¯”è¾ƒè€æ—§ï¼Œä½†åœ¨æŸäº›é¡¹ç›®ä¸­ä»ç„¶èƒ½æ»¡è¶³éœ€æ±‚ï¼Œå°¤å…¶æ˜¯é‚£äº›ä¾èµ–äºç‰¹å®šåº“å’Œå·¥å…·é“¾çš„æƒ…å†µã€‚ å°†ä¸‹è½½çš„ç¼–è¯‘å™¨å‹ç¼©åŒ…è§£å‹åˆ° /usr/local/arm/ ç›®å½•ä¸‹ã€‚è§£å‹åï¼Œä¼šåˆ›å»ºä¸€ä¸ªåä¸º gcc-4.6.2-glibc-2.13-linaro-multilib-2011.12 çš„ç›®å½•ï¼Œå…¶ä¸­åŒ…å«æ‰€éœ€çš„ç¼–è¯‘å™¨æ–‡ä»¶å’Œç›¸å…³å·¥å…·ã€‚ è§£å‹ç¤ºä¾‹ æ‰“å¼€ç»ˆç«¯ã€‚ åˆ‡æ¢åˆ°ç›®æ ‡ç›®å½•ä»¥ç¡®ä¿æ‰€éœ€çš„æ–‡ä»¶ä½ç½®ï¼š cd /usr/local/arm/ è§£å‹æ–‡ä»¶ï¼š tar -zxvf gcc-4.6.2-glibc-2.13-linaro-multilib-2011.12.tar.gz è¿™ä¸€æ­¥å°†ç”Ÿæˆç¼–è¯‘å™¨çš„ç›®å½•ï¼Œè¯¥ç›®å½•åŒ…å«æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶ä»¥åŠæ”¯æŒåº“ã€‚ ä¿®æ”¹ç¯å¢ƒå˜é‡ä¸ºç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿæ‰¾åˆ°æ–°å®‰è£…çš„ç¼–è¯‘å™¨ï¼Œéœ€è¦é…ç½®ç¯å¢ƒå˜é‡ã€‚æ‰“å¼€ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„ .bashrc æ–‡ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ°æ–‡ä»¶æœ«å°¾ã€‚è¿™å°†ç¡®ä¿æ–°ç¼–è¯‘å™¨çš„è·¯å¾„è¢«ç³»ç»Ÿæ­£ç¡®è¯†åˆ«ã€‚åŠ¡å¿…æ£€æŸ¥å¹¶æ³¨é‡Šæ‰å…¶ä»–å¯èƒ½å†²çªçš„ç¼–è¯‘å™¨è·¯å¾„ï¼Œé¿å…åœ¨ç¼–è¯‘æ—¶å‡ºç°ä¸å¿…è¦çš„é—®é¢˜ã€‚ # å…¶ä»–ç¼–è¯‘å™¨è®¾ç½®ï¼ˆå¦‚æœå­˜åœ¨ï¼Œè¯·å±è”½ï¼‰export PATH=/usr/local/arm/gcc-4.6.2-glibc-2.13-linaro-multilib-2011.12/bin:$PATH æ›´æ–°ç¯å¢ƒå˜é‡å®Œæˆä¿®æ”¹åï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤æ›´æ–°ç¯å¢ƒå˜é‡ï¼Œä½¿è®¾å®šç«‹å³ç”Ÿæ•ˆï¼š source ~/.bashrc ä¸ºäº†ç¡®ä¿æ‰€æœ‰è®¾ç½®ç”Ÿæ•ˆï¼Œå»ºè®®åœ¨æ­¤åçš„å·¥ä½œä¸­é‡å¯ Ubuntu ç³»ç»Ÿã€‚é‡å¯åï¼Œæ–°çš„ç¼–è¯‘å™¨å°†è¢«ç³»ç»Ÿè¯†åˆ«ã€‚å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯ç¼–è¯‘å™¨çš„å®‰è£…ï¼š gcc --version è¾“å‡ºåº”æ˜¾ç¤ºæ‰€éœ€çš„ GCC ç‰ˆæœ¬ï¼Œè¿™è¡¨æ˜å†…æ ¸ä¸‹è½½å’Œç¼–è¯‘å™¨å®‰è£…çš„å‡†å¤‡å·¥ä½œå·²å®Œæˆã€‚ ç¬¬ä¸‰æ­¥ï¼šé…ç½®å†…æ ¸ åœ¨ Ubuntu ä¸Šï¼Œè¿›å…¥è§£å‹åçš„ Linux æºä»£ç ç›®å½•ï¼Œæ‰“å¼€é¡¶å±‚çš„ Makefile æ–‡ä»¶ã€‚ åœ¨ Makefile ä¸­æ‰¾åˆ°ç¬¬ 251 å’Œ 252 è¡Œï¼Œä¿®æ”¹ ARCH å’Œ CROSS_COMPILE å˜é‡ï¼Œä»¥åŒ¹é…ç›®æ ‡å¹³å°å’Œäº¤å‰ç¼–è¯‘å·¥å…·ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½éœ€è¦å°† ARCH è®¾ç½®ä¸º armï¼ŒCROSS_COMPILE è®¾ç½®ä¸º arm-none-linux-gnueabi-ã€‚ ç”Ÿæˆé…ç½®æ–‡ä»¶ .configï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å®˜æ–¹æä¾›çš„é»˜è®¤é…ç½®ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š make exynos_defconfig é…ç½®å¹³å°å’Œè°ƒè¯•ä¸²å£ã€‚åœ¨å†…æ ¸æºä»£ç ç›®å½•ä¸‹è¾“å…¥å‘½ä»¤ make menuconfig ä»¥æ‰“å¼€é…ç½®èœå•ã€‚ é€‰æ‹©èŠ¯ç‰‡ç±»å‹ï¼Œå¯¼èˆªè‡³ System Typeï¼Œç„¶åé€‰æ‹© Samsung EXYNOSã€‚ é…ç½®è°ƒè¯•ä¸²å£ã€‚è¿”å› menuconfig çš„ä¸»èœå•ï¼Œè¿›å…¥ Kernel hacking é€‰é¡¹ï¼Œé€‰æ‹© Kernel low-level debugging functions (read help!)ï¼Œç´§æ¥ç€é€‰æ‹© Kernel low-level debugging port (Use Samsung S3C UART 0 for low-level debug)ï¼Œå°†è°ƒè¯•ä¸²å£é…ç½®ä¸ºä¸²å£ 2ã€‚ è¿”å›åˆ°ä¸»èœå•ï¼Œè¿›å…¥ Device Driversï¼Œç„¶åé€‰æ‹© Character devicesï¼Œé€‰ä¸­ Serial driversï¼Œç¡®ä¿ Samsung SoC serial debug (NEW) å’Œ Support for console on Samsung SoC serial port è¢«é€‰ä¸­ã€‚ å†æ¬¡è¿”å›åˆ°ä¸»èœå•ï¼Œå¹¶è¿›å…¥ Device Driversï¼Œç§»é™¤ DMA Engine support çš„é€‰é¡¹ã€‚ å®Œæˆæ‰€æœ‰è®¾ç½®åï¼Œä¿å­˜æ›´æ”¹å¹¶é€€å‡ºã€‚ ç¬¬å››æ­¥ï¼šç¼–è¯‘å†…æ ¸åœ¨å†…æ ¸æºä»£ç ç›®å½•ä¸‹è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä»¥è¿›è¡Œç¼–è¯‘ï¼Œå…¶ä¸­ LOADADDR=0x40007000 è¡¨ç¤ºæŒ‡å®šå†…æ ¸çš„åŠ è½½åœ°å€ï¼š make uImage ARCH=arm CROSS_COMPILE=arm-none-linux-gnueabi- LOADADDR=0x40007000 -j4 ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šå¹¶è¡Œå¤„ç†ä»»åŠ¡ï¼ˆé€šè¿‡ -j4 å‚æ•°ï¼‰ï¼ŒåŠ å¿«ç¼–è¯‘é€Ÿåº¦ã€‚å½“å‡ºç°æç¤º uImage is ready æ—¶ï¼Œè¡¨ç¤ºå†…æ ¸ç¼–è¯‘æˆåŠŸã€‚ ç¬¬äº”æ­¥ï¼šä¿®æ”¹ dts æ–‡ä»¶ è¿›å…¥å†…æ ¸ç›®å½•ä¸‹çš„ arch/arm/boot/dts/ï¼Œè¿™é‡Œä¼šæœ‰é»˜è®¤çš„è®¾å¤‡æ ‘æ–‡ä»¶ï¼Œä¾‹å¦‚ exynos4412-itop-scp-core.dtsiã€‚ æ‰“å¼€è®¾å¤‡æ ‘æ–‡ä»¶å¹¶è¿›è¡Œä»¥ä¸‹ä¿®æ”¹ï¼š æ³¨é‡Šæ‰ç¬¬ 29 åˆ° 32 è¡Œçš„ firmware èŠ‚ç‚¹ä»£ç ï¼Œé˜²æ­¢ä¸åç»­é…ç½®å†²çªã€‚ å°†ç¬¬ 71 è¡Œçš„ events å±æ€§ä¿®æ”¹ä¸º eventï¼Œä»¥ç¬¦åˆè®¾å¤‡è¦æ±‚ã€‚ æ ¹æ® SCP æ ¸å¿ƒæ¿çš„åŸç†å›¾ï¼Œé…ç½®æ ¸å¿ƒæ¿ç”µæºèŠ¯ç‰‡ï¼Œè¿™æ˜¯ç¡®ä¿ç¡¬ä»¶æ­£å¸¸å·¥ä½œçš„å…³é”®æ­¥éª¤ã€‚ ç¼–è¯‘è®¾å¤‡æ ‘ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š make dtbs ARCH=arm CROSS_COMPILE=arm-none-linux-gnueabi è¿™ä¸€å‘½ä»¤å°†æˆ‘ä¿®æ”¹åçš„è®¾å¤‡æ ‘æ–‡ä»¶ç¼–è¯‘æˆäºŒè¿›åˆ¶è®¾å¤‡æ ‘ï¼ˆDTBï¼‰æ–‡ä»¶ã€‚ ç¬¬å…­æ­¥ï¼šçƒ§å†™é•œåƒæœ€åï¼Œå°†ç¼–è¯‘ç”Ÿæˆçš„ uImage å’Œ dtb æ–‡ä»¶å¤åˆ¶åˆ°ä½¿ç”¨ Fastboot å·¥å…·çš„è®¾å¤‡ä¸­ã€‚è¿™å¯ä»¥é€šè¿‡ USB è¿æ¥ï¼Œç¡®ä¿ç›®æ ‡è®¾å¤‡èƒ½æ­£ç¡®è¯†åˆ«å’Œçƒ§å†™è¿™äº›æ˜ åƒæ–‡ä»¶ï¼Œç¡®ä¿æ•´ä¸ªè¿‡ç¨‹é¡ºåˆ©å®Œæˆã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿","ç³»ç»Ÿç§»æ¤"]},{"title":"æ–‡ä»¶ç³»ç»Ÿç§»æ¤","path":"/2024/09/30/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-ç³»ç»Ÿç§»æ¤-æ–‡ä»¶ç³»ç»Ÿç§»æ¤/","content":"æ ¹æ–‡ä»¶ç³»ç»Ÿæ¦‚è¿°æ ¹æ–‡ä»¶ç³»ç»Ÿæ˜¯æ‰€æœ‰ç±» Unix æ“ä½œç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå°¤å…¶åœ¨åµŒå…¥å¼ Linux ç³»ç»Ÿä¸­æ›´æ˜¯ä¸å…¶ä»–ä¼ ç»ŸåµŒå…¥å¼æ“ä½œç³»ç»Ÿçš„é‡è¦ç‰¹å¾ä¹‹ä¸€ã€‚æ ¹æ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡ä¸º Linux æä¾›äº†ä¼—å¤šå¼ºå¤§è€Œçµæ´»çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚åœ¨è¿›è¡Œå®šåˆ¶æ—¶ï¼Œéœ€è¦ç»†å¿ƒé€‰æ‹©å¿…è¦çš„ç³»ç»Ÿåº“ã€å†…æ ¸æ¨¡å—å’Œåº”ç”¨ç¨‹åºï¼Œå¹¶é…ç½®åˆå§‹åŒ–è„šæœ¬æ–‡ä»¶ï¼Œé€‰æ‹©é€‚åˆçš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ä»¥åŠå°†å…¶æ”¾ç½®åœ¨å®é™…å­˜å‚¨è®¾å¤‡çš„åˆé€‚ä½ç½®ã€‚ æ–‡ä»¶ç³»ç»Ÿçš„æ ‘å‹ç»“æ„Linux çš„æ ¹æ–‡ä»¶ç³»ç»Ÿé‡‡ç”¨æ ‘å‹ç»“æ„ï¼Œä¸ºå†…æ ¸å’Œç³»ç»Ÿç®¡ç†æä¾›äº†å„ç§å¿…éœ€çš„æ–‡ä»¶å’Œç¨‹åºã€‚æ ¹ç›®å½• / ä¸‹çš„é¡¶å±‚ç›®å½•é€šå¸¸æœ‰å›ºå®šçš„å‘½åå’Œç”¨é€”ã€‚ä»¥ä¸‹åˆ—å‡º Linux æ ¹æ–‡ä»¶ç³»ç»Ÿä¸­å¸¸è§çš„ç›®å½•ç»“æ„åŠå…¶ä½œç”¨ï¼š /binï¼šå­˜æ”¾äºŒè¿›åˆ¶å¯æ‰§è¡Œå‘½ä»¤çš„ç›®å½• åŒ…å«æ‰€æœ‰ç”¨æˆ·å¯ç”¨çš„åŸºæœ¬å‘½ä»¤ã€‚åœ¨æŒ‚è½½å…¶ä»–æ–‡ä»¶ç³»ç»Ÿä¹‹å‰ï¼Œè¿™äº›å‘½ä»¤å¿…é¡»å¯ç”¨ï¼Œå› æ­¤ /bin ç›®å½•éœ€ä¸æ ¹æ–‡ä»¶ç³»ç»Ÿåœ¨åŒä¸€åˆ†åŒºã€‚å¸¸ç”¨å‘½ä»¤åŒ…æ‹¬ï¼šcatã€chmodã€ls ç­‰ã€‚ /devï¼šå­˜æ”¾è®¾å¤‡æ–‡ä»¶çš„ç›®å½• è®¾å¤‡æ–‡ä»¶æ˜¯ Linux ä¸­ç‰¹æœ‰çš„æ–‡ä»¶ç±»å‹ï¼Œå…è®¸é€šè¿‡æ–‡ä»¶çš„å½¢å¼è®¿é—®å„ç§è®¾å¤‡ã€‚é€šè¿‡å¦‚ /dev/ttySAC0 æ–‡ä»¶ï¼Œå¯ä»¥æ“ä½œä¸²å£ï¼Œè€Œ /dev/mtdblock1 åˆ™ç”¨äºè®¿é—® MTD è®¾å¤‡çš„ç‰¹å®šåˆ†åŒºã€‚ /etcï¼šå­˜æ”¾ç³»ç»Ÿç®¡ç†å’Œé…ç½®æ–‡ä»¶çš„ç›®å½• å­˜å‚¨å¤šç§é…ç½®æ–‡ä»¶ã€‚åœ¨ PC çš„ Linux ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶æ•°é‡ä¼—å¤šï¼Œä½†åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­é€šå¸¸ä¼šå¤§å¹…ç²¾ç®€ï¼Œä»¥é€‚åº”èµ„æºå—é™çš„ç¯å¢ƒã€‚ /homeï¼šç”¨æˆ·ä¸»ç›®å½• æ¯ä¸ªæ™®é€šç”¨æˆ·åœ¨ /home ç›®å½•ä¸‹éƒ½æœ‰ä¸€ä¸ªä»¥ç”¨æˆ·åå‘½åçš„å­ç›®å½•ï¼Œå­˜æ”¾ç”¨æˆ·çš„ç›¸å…³é…ç½®æ–‡ä»¶ï¼Œå¦‚ç”¨æˆ· user çš„ä¸»ç›®å½•ä¸º /home/userã€‚ /libï¼šå­˜æ”¾åŠ¨æ€é“¾æ¥å…±äº«åº“çš„ç›®å½• å­˜æ”¾å…±äº«åº“å’Œå¯åŠ è½½çš„é©±åŠ¨ç¨‹åºï¼Œç»´æŒåŸºæœ¬çš„ç³»ç»Ÿå¯åŠ¨å’Œå…¶ä»–ç¨‹åºçš„è¿è¡Œã€‚ /sbinï¼šå­˜æ”¾ç®¡ç†å‘˜ä½¿ç”¨çš„ç®¡ç†ç¨‹åºçš„ç›®å½• å­˜æ”¾ç‰¹æ®Šçš„ç³»ç»Ÿå‘½ä»¤ï¼Œä»…ä¾›ç®¡ç†å‘˜ä½¿ç”¨ï¼Œå¦‚ shutdownã€rebootã€‚è¿™äº›å‘½ä»¤åœ¨æŒ‚æ¥å…¶ä»–æ–‡ä»¶ç³»ç»Ÿä¹‹å‰ä¹Ÿéœ€å¯ç”¨ã€‚ /tmpï¼šå…¬ç”¨çš„ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ç‚¹ å­˜æ”¾ä¸´æ—¶æ–‡ä»¶ï¼Œç¨‹åºç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶é€šå¸¸ä½äºæ­¤ï¼Œå¿…é¡»ç¡®ä¿å…¶å­˜åœ¨ä¸”å¯è®¿é—®ã€‚ /rootï¼šç³»ç»Ÿç®¡ç†å‘˜çš„ä¸»ç›®å½• æ ¹ç”¨æˆ·çš„é»˜è®¤ç›®å½•ï¼Œç›¸è¾ƒä¹‹ä¸‹ï¼Œæ™®é€šç”¨æˆ·çš„ä¸»ç›®å½•ä½äº /home ç›®å½•ä¸‹ã€‚ /mntï¼šä¸´æ—¶æŒ‚è½½å…¶ä»–æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚æ¥ç‚¹ ç”¨äºä¸´æ—¶æŒ‚è½½æŸäº›æ–‡ä»¶ç³»ç»Ÿï¼Œé€šå¸¸ä¸ºç©ºç›®å½•ï¼Œä¹Ÿå¯åœ¨å…¶ä¸­åˆ›å»ºå­ç›®å½•ã€‚ /procï¼šè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ ä½œä¸º proc æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚æ¥ç‚¹ï¼Œä¸å ç”¨ç‰©ç†å­˜å‚¨ï¼Œç›®å½•å’Œæ–‡ä»¶ç”±å†…æ ¸åŠ¨æ€ç”Ÿæˆï¼Œåæ˜ ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ã€‚ /usrï¼šå­˜æ”¾åº”ç”¨ç¨‹åºä¸æ–‡ä»¶çš„åºå¤§ç›®å½• æ­¤ç›®å½•é€‚åˆå­˜æ”¾å…±äº«çš„ã€åªè¯»çš„ç¨‹åºå’Œæ•°æ®ã€‚å†…å®¹å¯ä»¥åœ¨å¤šä¸ªä¸»æœºä¹‹é—´å…±äº«ï¼Œç¬¦åˆ Filesystem Hierarchy Standardï¼ˆFHSï¼‰ã€‚ /varï¼šå­˜æ”¾å¯å˜æ•°æ®çš„ç›®å½• ä¸ /usr ç›¸åï¼Œè¿™é‡Œå­˜å‚¨è¯¸å¦‚æ—¥å¿—æ–‡ä»¶å’Œé‚®ä»¶ç­‰åŠ¨æ€ç”Ÿæˆçš„æ•°æ®ã€‚ ç§»æ¤ç¯å¢ƒ å‘è¡Œç‰ˆï¼šUbuntu 10.10 å¼•å¯¼ç¨‹åºï¼šu-boot.bin ç›®æ ‡å¹³å°ï¼šFS4412 äº¤å‰ç¼–è¯‘å™¨ï¼šarm-none-linux-gnueabi-gcc ç§»æ¤æ­¥éª¤1. æºç ä¸‹è½½é€‰æ‹©ä¸‹è½½çš„ç‰ˆæœ¬ä¸º busybox-1.17.3.tar.bz2ï¼Œä¸‹è½½é“¾æ¥ä¸º http://busybox.net/downloads/ 2. è§£å‹æºç $ tar xvf busybox-1.17.3.tar.bz2 3. è¿›å…¥æºç ç›®å½•$ cd busybox-1.17.3 4. é…ç½®æºç é€šè¿‡ make menuconfig è¿›è¡Œç›¸å…³çš„é…ç½®ã€‚ 5. ç¼–è¯‘ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š $ make 6. å®‰è£…å®‰è£…ç¨‹åºå°†è¾“å‡ºåˆ° _install ç›®å½•ã€‚ 7. è¿›å…¥å®‰è£…ç›®å½•$ cd _install 8. åˆ›å»ºå¿…è¦çš„ç›®å½•$ mkdir dev etc mnt proc var tmp sys root 9. æ·»åŠ åº“åœ¨ _install ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª lib æ–‡ä»¶å¤¹ï¼Œæ‹·è´å·¥å…·é“¾ä¸­çš„åº“åˆ° lib ç›®å½•ä¸‹ã€‚ $ mkdir lib$ cp /home/linux/x-tools/arm-cortex_a8-linux-gnueabi/arm-cortex_a8-linux-gnueabi/lib/* ./lib/ è®¾ç½®é…ç½®é€‰é¡¹ä»¥æ„å»ºé™æ€ç‰ˆæœ¬çš„ BusyBoxï¼š $ make menuconfig# å¯ç”¨é™æ€äºŒè¿›åˆ¶æ„å»º ä¹‹åç¼–è¯‘å’Œå®‰è£…ï¼š $ make$ make install æ›´æ·±å…¥åœ°æ¸…ç†å®‰è£…ç›®å½•ï¼š $ cd _install$ rm *.o *.a$ arm-cortex_a8-linux-gnueabi-strip lib/* 10. æ·»åŠ ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶åœ¨ etc ç›®å½•ä¸‹æ·»åŠ æ–‡ä»¶ inittabï¼Œå†…å®¹å¦‚ä¸‹ï¼š # thisis run first except when booting in single-user mode.::sysinit:/etc/init.d/rcS# /bin/sh invocations on selected ttys# Start an askfirst shell on the console (whatever that may be).::askfirst:-/bin/sh# Stuff to do when restarting the init process::restart:/sbin/init# Stuff to do before rebooting::ctrlaltdel:/sbin/reboot åœ¨ etc ç›®å½•ä¸‹æ·»åŠ æ–‡ä»¶ fstabï¼Œå†…å®¹å¦‚ä¸‹ï¼š # device mount-point type options dump fsck orderproc /proc proc defaults 0 0tmpfs /tmp tmpfs defaults 0 0sysfs /sys sysfs defaults 0 0tmpfs /dev tmpfs defaults 0 0 11. è®¾å¤‡æ–‡ä»¶åˆ›å»ºåœ¨ /dev ä¸‹åˆ›å»º console èŠ‚ç‚¹ï¼Œè¿™æ˜¯æ ¹æ–‡ä»¶ç³»ç»Ÿä¸­å¿…é¡»å­˜åœ¨çš„è®¾å¤‡èŠ‚ç‚¹ã€‚ å¦‚æœæ–°çš„æ–‡ä»¶ç³»ç»Ÿå°ºå¯¸è¶…è¿‡ 8Mï¼Œåˆ™éœ€è¦åˆ é™¤ä¸éœ€è¦çš„åº“æ–‡ä»¶ä»¥ä¿æŒç³»ç»Ÿç²¾ç®€ã€‚ $ mknod dev/console c 51 1 æ­¤æ­¥éª¤ç¡®ä¿è®¾å¤‡æ–‡ä»¶æ­£ç¡®åˆ›å»ºï¼Œä½¿å¾—ç³»ç»Ÿåœ¨å¯åŠ¨æ—¶èƒ½å¤Ÿä¸ç¡¬ä»¶è¿›è¡Œäº¤äº’ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿","ç³»ç»Ÿç§»æ¤"]},{"title":"æ–‡ä»¶ç³»ç»Ÿè£å‰ªè®ºæ–‡å­¦ä¹ ","path":"/2024/09/27/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-ç³»ç»Ÿç§»æ¤-æ–‡ä»¶ç³»ç»Ÿè£å‰ªè®ºæ–‡å­¦ä¹ /","content":"Linuxæ ¹æ–‡ä»¶ç³»ç»Ÿè£å‰ªè®ºæ–‡é˜…è¯»ç¬”è®°Linuxè£å‰ªæ–¹æ³•ç ”ç©¶ 2006 2Linuxè£å‰ªåŸç†ï¼š 2LinuxåµŒå…¥å¼ç³»ç»Ÿæ ¹æ–‡ä»¶ç³»ç»Ÿçš„é€‰æ‹©ä¸åˆ¶ä½œ 2006 3LinuxåµŒå…¥å¼ç³»ç»Ÿæ ¹æ–‡ä»¶ç³»ç»Ÿçš„é€‰æ‹©ä¸åˆ¶ä½œ 2006 3åŸºäºARMçš„åµŒå…¥å¼Linuxæ“ä½œç³»ç»Ÿç§»æ¤çš„ç ”ç©¶ 2006 5åŸºäºARMçš„åµŒå…¥å¼æ–‡ä»¶ç³»ç»Ÿç ”ç©¶ä¸è®¾è®¡ 2010 6åŸºäºåµŒå…¥å¼Linuxçš„Ext2æ ¹æ–‡ä»¶ç³»ç»Ÿåˆ¶ä½œåˆ†æ 2015 6åµŒå…¥å¼Linuxè£å‰ªç ”ç©¶ 2009 7åµŒå…¥å¼Linuxæ ¹æ–‡ä»¶ç³»ç»Ÿçš„æ„å»ºä¸åˆ†æ 2015 8åµŒå…¥å¼Linuxå…±äº«åº“è£å‰ªæŠ€æœ¯åˆ†æä¸æ”¹è¿› 2009 8åµŒå…¥å¼Linuxç³»ç»Ÿçš„è£å‰ªä¼˜åŒ–å’Œæµ‹è¯•æŠ€æœ¯ 2012 10åµŒå…¥å¼Linuxç³»ç»Ÿçš„ç§»æ¤åŠå…¶æ ¹æ–‡ä»¶ç³»ç»Ÿçš„å®ç° 2005 10é¢å‘åº”ç”¨çš„åµŒå…¥å¼Linuxè£å‰ªæ–¹æ³•ç ”ç©¶ä¸å®ç° 2009 11å¾®å‹åµŒå…¥å¼å®æ—¶æ“ä½œç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿ 2015 12åŸºäºARMçš„åµŒå…¥å¼Linuxç§»æ¤æŠ€æœ¯ 2010 12åŸºäºARMçš„åµŒå…¥å¼Linuxç§»æ¤ä¸è£å‰ªç ”ç©¶ 2007 13åŸºäºARMçš„åµŒå…¥å¼å¹³å°çš„ç ”ç©¶ä¸å®ç° 2009 14åŸºäºARMçš„åµŒå…¥å¼é—ªå­˜é©±åŠ¨ä¸UBIFSæ–‡ä»¶ç³»ç»Ÿçš„åˆ†æä¸å®ç° 2014 14ç²¾ç®€å‹åµŒå…¥å¼æ–‡ä»¶ç³»ç»Ÿè®¾è®¡ 2010 15åµŒå…¥å¼Linuxå†…æ ¸è£å‰ªåŠç§»æ¤çš„ç ”ç©¶ä¸å®ç° 2009 18åµŒå…¥å¼å­˜å‚¨è®¾å¤‡ä¸Šæ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç° 2007 18åµŒå…¥å¼è®¾å¤‡ä¸­åŸºäºNAND Flashçš„æ–‡ä»¶ç³»ç»Ÿè®¾è®¡å’Œä¼˜åŒ– 2013 18åµŒå…¥å¼æ–‡ä»¶ç³»ç»Ÿçš„ç ”ç©¶ä¸è®¾è®¡ 2007 19åµŒå…¥å¼Linuxç³»ç»Ÿè£å‰ªæŠ€æœ¯çš„åˆ†æä¸ç ”ç©¶ 2011 19åµŒå…¥å¼Linuxç³»ç»Ÿå®šåˆ¶å’Œè£å‰ªæŠ€æœ¯çš„ç ”ç©¶ä¸å®ç° 2006 19åµŒå…¥å¼ç³»ç»Ÿä¸­NAND Flashæ–‡ä»¶ç³»ç»Ÿçš„ç ”ç©¶ 2010 19 Linux è£å‰ªæ–¹æ³•ç ”ç©¶ 2006Linux ç³»ç»Ÿçš„ä½¿ç”¨é€å¹´å¢åŠ ï¼Œç„¶è€Œå…¶åºå¤§çš„ä½“ç§¯å’Œå¤æ‚æ€§ä½¿å¾—è£å‰ªå’Œä¼˜åŒ–å˜å¾—å…·æœ‰æŒ‘æˆ˜æ€§ã€‚æ ¹æ®ä¿ç•™æ ¸å¿ƒå†…æ ¸å’Œç³»ç»Ÿå¿…éœ€æ–‡ä»¶çš„åŸåˆ™ï¼Œç°æœ‰çš„å‡ ç§å¹¿æ³›åº”ç”¨çš„è£å‰ªæ–¹æ³•è¢«è¯¦ç»†ä»‹ç»å¦‚ä¸‹ã€‚ Linux è£å‰ªåŸç†åœ¨è£å‰ª Linux ç³»ç»Ÿä¹‹å‰ï¼Œæœ‰å¿…è¦äº†è§£å…¶å¯åŠ¨è¿‡ç¨‹ã€æ–‡ä»¶ç»“æ„åŠè½¯ä»¶å®‰è£…æ–¹æ³•ã€‚Linux çš„å¯åŠ¨è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºå‡ ä¸ªä¸»è¦æ­¥éª¤ï¼ŒåŒ…æ‹¬ï¼š BIOS - åŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿè´Ÿè´£ç¡¬ä»¶è‡ªæ£€åŠå¼•å¯¼å¯åŠ¨ã€‚ å¼•å¯¼æ‰‡åŒº - è´Ÿè´£åŠ è½½ Linux å†…æ ¸ã€‚ å†…æ ¸ - å½“å†…æ ¸å¯åŠ¨åï¼Œå®ƒå°†åˆå§‹åŒ–ç³»ç»Ÿå¹¶æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚ æ ¹æ–‡ä»¶ç³»ç»Ÿ - åŒ…å«äº†ç³»ç»Ÿè¿è¡Œæ‰€éœ€çš„æ–‡ä»¶å’Œé©±åŠ¨ç¨‹åºã€‚ æ ¹æ–‡ä»¶ç›®å½•ç»“æ„ä¸»è¦åŒ…æ‹¬ï¼š /bin - å­˜æ”¾åŸºæœ¬ç”¨æˆ·å‘½ä»¤å’Œå·¥å…·ã€‚ /sbin - å­˜æ”¾ç³»ç»Ÿç®¡ç†åªéœ€çš„å‘½ä»¤ã€‚ /usr - å­˜æ”¾è½¯ä»¶åŒ…å’Œç”¨æˆ·å·¥å…·ã€‚ /etc - å­˜æ”¾ç³»ç»Ÿé…ç½®æ–‡ä»¶ã€‚ /dev - è®¾å¤‡æ–‡ä»¶ç›®å½•ã€‚ /mnt - æŒ‚è½½ç‚¹ã€‚ /proc - è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œæä¾›å†…æ ¸å’Œè¿›ç¨‹ä¿¡æ¯ã€‚ /lib - ç³»ç»Ÿåº“æ–‡ä»¶ã€‚ å¸¸è§çš„å‡ ç§è£å‰ªæ–¹æ³•åŒ…æ‹¬ï¼š å®šåˆ¶å®‰è£…æ³• - åœ¨å®‰è£…è¿‡ç¨‹ä¸­é€‰æ‹©æ€§å®‰è£…å¿…è¦çš„ç»„ä»¶ã€‚ rpm è£å‰ªæ³• - åˆ©ç”¨ RPM åŒ…ç®¡ç†å™¨ï¼Œé€‰æ‹©éœ€è¦çš„åº“å’Œè½¯ä»¶è¿›è¡Œå®‰è£…ã€‚ æ‰‹å·¥åˆ é™¤æ³• - æ‰‹åŠ¨å‰”é™¤ä¸å¿…è¦çš„æ–‡ä»¶å’Œç¨‹åºã€‚ ä½¿ç”¨ BusyBox å¯ä»¥æå¤§åœ°ç®€åŒ–ç³»ç»Ÿï¼Œä½†éœ€è°ƒæ•´åŸæœ‰çš„ç³»ç»Ÿåˆå§‹åŒ–è¿‡ç¨‹ã€‚è¿™æ˜¯å› ä¸º BusyBox ä¸­çš„å‘½ä»¤å’ŒåŠŸèƒ½å¯èƒ½ä¸ä¼ ç»Ÿ Linux å‘½ä»¤æœ‰æ‰€ä¸åŒï¼Œè¿™å¯èƒ½å¯¼è‡´ç³»ç»Ÿä¸èƒ½é¡ºåˆ©åˆå§‹åŒ–ã€‚æ­¤å¤–ï¼ŒBusyBox ä¹Ÿå¯ä»¥è¿›ä¸€æ­¥å‹ç¼©æ•´ä½“ç³»ç»Ÿä½“ç§¯ï¼Œä»è€ŒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚ Linux åµŒå…¥å¼ç³»ç»Ÿæ ¹æ–‡ä»¶ç³»ç»Ÿçš„é€‰æ‹©ä¸åˆ¶ä½œ 2006Linux çš„æ ¹æ–‡ä»¶ç³»ç»Ÿæ˜¯å†…æ ¸å¯åŠ¨è¿‡ç¨‹ä¸­æœ€åä¸€ç¯ï¼Œä¸ºåµŒå…¥å¼ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚å¯¹æ ¹æ–‡ä»¶ç³»ç»Ÿçš„ç±»å‹ã€å†…å®¹é€‰æ‹©å’Œåˆ¶ä½œæ–¹æ³•è¿›è¡Œç³»ç»Ÿæ€§åˆ†æï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿé«˜æ•ˆè¿ä½œã€‚ Linux åµŒå…¥å¼ç³»ç»Ÿä¼˜åŠ¿Linux åœ¨åµŒå…¥å¼ç³»ç»Ÿå¼€å‘ä¸­æä¾›äº†è¯¸å¤šä¼˜åŠ¿ï¼š å·¥å…·é“¾æ”¯æŒ - Linux æä¾›å®Œæ•´çš„å¼€å‘å·¥å…·é“¾ï¼Œä¾¿äºè‡ªå»ºå¼€å‘ç¯å¢ƒå’Œäº¤å‰ç¼–è¯‘ç¯å¢ƒï¼Œæ¯”æ–¹è¯´å·¥å…·å¦‚ GCC å’Œ Makefile èƒ½å¤Ÿè¿…é€Ÿå»ºç«‹äº¤å‰ç¼–è¯‘æµç¨‹ã€‚ å¼€æ”¾æ€§å†…æ ¸ - å®Œå…¨å¼€æ”¾çš„å†…æ ¸å…è®¸è®¾è®¡çœŸæ­£çš„ç¡¬å®æ—¶ç³»ç»Ÿï¼Œè½¯å®æ—¶ç³»ç»Ÿä¹Ÿå¯ä»¥é€šè¿‡ä¼˜å…ˆçº§è°ƒåº¦è½»æ¾å®ç°ã€‚ ç½‘ç»œæ”¯æŒ - å¼ºå¤§çš„ç½‘ç»œåè®®æ ˆæ”¯æŒï¼Œå¯ä»¥è½»æ¾å®ç°åµŒå…¥å¼ TCPIP é€šä¿¡ã€‚ å¯¹äºç‰¹å®šç›®å½•çš„é€‰æ‹©ï¼Œè€ƒè™‘åˆ°åµŒå…¥å¼ç³»ç»Ÿçš„éœ€æ±‚ï¼Œå¯ä»¥çœç•¥æŸäº›é’ˆå¯¹å¤šç”¨æˆ·çš„ç›®å½•å¦‚ /home, /mnt, /opt, /rootã€‚æ­¤å¤–ï¼Œæ˜¯å¦éœ€è¦ /boot ç›®å½•å–å†³äºå¼•å¯¼ç¨‹åºæ˜¯å¦ä»æ ¹æ–‡ä»¶ç³»ç»ŸåŠ è½½å†…æ ¸ã€‚ å…³äºå­˜æ”¾äºŒè¿›åˆ¶æ–‡ä»¶çš„ç›®å½•ï¼Œå­˜åœ¨å¦‚ä¸‹åŒºåˆ«ï¼š /bin - åŒ…å«ç”¨æˆ·åŠç®¡ç†å‘˜å¿…éœ€å‘½ä»¤ã€‚ /sbin - ä¸»è¦ä¾›ç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨ï¼Œæ™®é€šç”¨æˆ·æ— éœ€è®¿é—®çš„å‘½ä»¤ã€‚ /usr/bin - å­˜æ”¾éå¿…éœ€çš„ç”¨æˆ·å‘½ä»¤ã€‚ /usr/sbin - ä¸å±äºç®¡ç†å‘˜çš„å¿…éœ€å‘½ä»¤ã€‚ åº“æ–‡ä»¶çš„é€‰æ‹©ä¹Ÿæ˜¯è‡³å…³é‡è¦çš„ï¼Œå¯ä»¥é€‰æ‹© glibc æˆ– uClibcï¼Œåè€…ä½“ç§¯æ›´å°ä½†ä»ä¸å‰è€…å…¼å®¹ã€‚å¿…é¡»åŒ…å«çš„åº“æ–‡ä»¶æœ‰ï¼šlibc.so, libpthread.so, libutil.so ç­‰ï¼Œä»¥ä¿è¯ç¨‹åºè¿è¡Œæ‰€éœ€çš„åŸºæœ¬åŠŸèƒ½ã€‚ æ ¹æ–‡ä»¶ç³»ç»Ÿçš„é€‰æ‹©åŸåˆ™ å°‘ Flashï¼Œé‡ RAMï¼šå¦‚æœç³»ç»Ÿå†…å­˜å…è®¸ï¼Œé€‰æ‹© RAMdisk é€šå¸¸æ˜¯æœ€ä½³æ–¹æ¡ˆã€‚è™½ç„¶ RAMdisk æä¾›äº†é«˜å‹ç¼©æ¯”ï¼Œä½†å¿…é¡»æ³¨æ„ RAM çš„æ¶ˆè€—å’Œä»·æ ¼ã€‚ CRAMFS é€‰é¡¹ï¼šå¦‚æœç³»ç»Ÿæœ‰è¶³å¤Ÿçš„ Flash èµ„æºï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯ RAM çš„å¯ç”¨æ€§ï¼Œåˆ™ä½¿ç”¨ CRAMFS æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚è™½ç„¶å…¶å‹ç¼©æ•ˆç‡ç•¥é€Šäº RAMdiskï¼Œä½†å¯¹äºé€šå¸¸ä¸éœ€æŒä¹…å‚¨å­˜çš„åµŒå…¥å¼åº”ç”¨æ¥è¯´ï¼Œè¶³ä»¥æ»¡è¶³éœ€æ±‚ã€‚ JFFS2 é€‰æ‹©ï¼šå¦‚æœéœ€è¦é¢‘ç¹æ›´æ–°æ–‡ä»¶ç³»ç»Ÿï¼ŒJFFS2 ä»¥å…¶ä¼˜ç§€çš„åƒåœ¾å›æ”¶å’Œç”µæºä¿æŠ¤åŠŸèƒ½ï¼Œå°¤å…¶é€‚åˆé—ªå­˜è®¾å¤‡ã€‚ åŸºäº ARM çš„åµŒå…¥å¼ Linux æ“ä½œç³»ç»Ÿç§»æ¤çš„ç ”ç©¶ 2006ARM æ¶æ„çš„ Linux ç³»ç»Ÿæ”¯æŒå¤šç§ ARM å¤„ç†å™¨ç³»åˆ—ï¼ŒåŒ…æ‹¬ ARM7 å’Œ ARM9 ç­‰ã€‚è¿™äº›å¤„ç†å™¨æ™®éé…å¤‡å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰ï¼Œè€Œå¯¹äºä¸å¸¦ MMU çš„ CPUï¼Œå¸¸ç”¨çš„æ›¿ä»£æ–¹æ¡ˆæ˜¯ä½¿ç”¨ uClinuxã€‚ åŸºäº ARM çš„åµŒå…¥å¼æ–‡ä»¶ç³»ç»Ÿç ”ç©¶ä¸è®¾è®¡ 2010SD å¡åŠå…¼å®¹ TF å¡ä»¥å…¶å°ä½“ç§¯ã€ç®€å•æ¥å£ã€ä½æˆæœ¬å’Œä¼˜ç§€æ€§èƒ½åœ¨åµŒå…¥å¼å­˜å‚¨è®¾å¤‡å¸‚åœºä¸­å æ®é‡è¦åœ°ä½ã€‚FAT æ ¼å¼å› å…¶è‰¯å¥½çš„å…¼å®¹æ€§å’Œå®‰å…¨æ€§è¢«å¹¿æ³›åº”ç”¨äºåµŒå…¥å¼æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚ åŸºäºåµŒå…¥å¼ Linux çš„ Ext2 æ ¹æ–‡ä»¶ç³»ç»Ÿåˆ¶ä½œåˆ†æ 2015åœ¨ PowerPC æ¶æ„çš„ MPC8379E å¤„ç†å™¨ä¸Šï¼ŒåŸºäº Linux 2.6 å†…æ ¸åˆ¶ä½œ Ext2 æ ¹æ–‡ä»¶ç³»ç»Ÿçš„è¿‡ç¨‹ä¸ä»…è¯¦å°½æ¸…æ™°ï¼Œè¿˜åŒ…æ‹¬äº†å®é™…çš„çƒ§å†™æµ‹è¯•ç»“æœã€‚æ ¹æ–‡ä»¶ç³»ç»ŸåŒ…å«ç™¾ä½™ä¸ªå¸¸ç”¨å‘½ä»¤åŠåŸºæœ¬åº“ï¼Œå‹ç¼©åçš„é•œåƒä»…ä¸º 2.3MBï¼Œæ»¡è¶³äº†å¤§éƒ¨åˆ†ç³»ç»Ÿéœ€æ±‚ã€‚PowerPC æ¶æ„å…·æœ‰ä¼˜è¶Šæ€§èƒ½ã€ä½èƒ½è€—åŠä½çƒ­é‡æ’æ”¾çš„ç‰¹ç‚¹ï¼Œé€‚åˆå¤šç§åµŒå…¥å¼åº”ç”¨ã€‚ ä½¿ç”¨ BusyBox æ„å»ºæ ¹æ–‡ä»¶ç³»ç»Ÿï¼ŒåŸå§‹æ–‡ä»¶å¤§å°è¾¾åˆ° 14.1MBï¼Œä½†ç»è¿‡ Ext2 å‹ç¼©åæœ‰æ•ˆå‡å°è‡³ 2.3MBã€‚ åµŒå…¥å¼ Linux è£å‰ªç ”ç©¶ 2009å°½ç®¡ Linux æ“ä½œç³»ç»Ÿæœ€åˆè®¾è®¡ä¸ºæ¡Œé¢ç¯å¢ƒï¼Œå…¶é€šç”¨æ€§å¯¹äºåµŒå…¥å¼ç³»ç»Ÿæ„å»ºå¹¶ä¸å®Œå…¨é€‚ç”¨ã€‚ç”±äºåµŒå…¥å¼ç³»ç»Ÿå¯¹å®æ—¶æ€§ã€ç³»ç»Ÿä½“ç§¯ã€åŠŸèƒ½ã€å¯ç§»æ¤æ€§åŠå¯è£å‰ªæ€§ç­‰å¤šæ–¹é¢çš„ç‰¹æ®Šéœ€æ±‚ï¼Œå¼€å‘åµŒå…¥å¼ Linux ç³»ç»Ÿæ—¶éœ€è¿›è¡Œé¢å¤–çš„ä¼˜åŒ–å’Œè°ƒæ•´ã€‚ åµŒå…¥å¼ Linux ç³»ç»Ÿçš„å®æ—¶æ€§é—®é¢˜Linux æ“ä½œç³»ç»Ÿè¢«è®¾è®¡ä¸ºä¸€ç§åˆ†æ—¶ç³»ç»Ÿï¼Œèƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªè¿›ç¨‹ã€‚åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œæœ‰ä¸¤ç§è¿è¡Œæ¨¡å¼â€”â€”ç”¨æˆ·æ€å’Œå†…æ ¸æ€ã€‚å½“è¿›ç¨‹åœ¨ç”¨æˆ·æ€è¿è¡Œæ—¶ï¼Œå¦‚æœå®æ—¶è¿›ç¨‹å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œåˆ™å¯ä»¥æŠ¢å æ­£åœ¨è¿è¡Œçš„å…¶ä»–è¿›ç¨‹ã€‚ç„¶è€Œï¼Œå½“æ“ä½œç³»ç»Ÿè¿è¡Œåœ¨å†…æ ¸æ€æ—¶ï¼Œå®æ—¶è¿›ç¨‹æ— æ³•ä¼˜å…ˆäºå…¶ä»–è¿›ç¨‹è¿è¡Œã€‚æ­¤å¤–ï¼ŒLinux å®šæ—¶å™¨çš„å®ç°ä¹Ÿæš´éœ²å‡ºä¸€äº›ç¼ºé™·ï¼š å®šæ—¶å™¨é¢‘ç‡é™åˆ¶ï¼šLinux çš„å‘¨æœŸæ¨¡å¼å®šæ—¶å™¨çš„é¢‘ç‡ä»…ä¸º 100Hzï¼Œè¿™ä¸ªé¢‘ç‡å¯¹äºè®¸å¤šè¦æ±‚ä¸¥æ ¼çš„å®æ—¶åº”ç”¨è€Œè¨€æ˜¾å¾—ä¸è¶³ä»¥æ»¡è¶³éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨å‘åŠ¨æœºæ§åˆ¶ç³»ç»Ÿæˆ–ç½‘ç»œé€šä¿¡ç­‰åº”ç”¨ä¸­ï¼Œç†æƒ³çš„å®šæ—¶å™¨é¢‘ç‡åº”åœ¨å‡ åƒèµ«å…¹ä»¥ä¸Šã€‚ è½¯å®šæ—¶å™¨çš„é—®é¢˜ï¼šè½¯å®šæ—¶å™¨çš„è°ƒåº¦æ˜¯ä¾èµ–äºå…¨å±€æ—¶é’Ÿå®šæ—¶å™¨çš„ã€‚å½“ç³»ç»Ÿä¸­çš„è½¯å®šæ—¶å™¨æ•°é‡è¾ƒå¤šæ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´å› ä¸ºç«äº‰æ—¶é’Ÿèµ„æºè€Œå¼•å‘çš„å†²çªï¼Œè¿›è€Œå½±å“ç³»ç»Ÿçš„å“åº”èƒ½åŠ›å’Œå®æ—¶æ€§ã€‚ è°ƒåº¦ç®—æ³•çš„å½±å“ï¼šLinux ä½¿ç”¨å¤šçº§è½®è½¬è°ƒåº¦ç®—æ³•ï¼Œè‹¥ä¸€ä¸ªè¿›ç¨‹æœªåœ¨å…¶æ—¶é—´ç‰‡å†…å®Œæˆï¼Œä¼˜å…ˆçº§ä¼šé™ä½ã€‚è™½ç„¶å®æ—¶è¿›ç¨‹å­˜åœ¨è¾ƒé«˜çš„ä¼˜å…ˆçº§ï¼Œä½†ç³»ç»Ÿå¹¶æœªä¸ºå…¶è®¾å®šä¸¥æ ¼çš„æ—¶é—´é™åˆ¶ã€‚å¤§é‡çš„éå®æ—¶è¿›ç¨‹ä¹Ÿå¯èƒ½å¯¹å®æ—¶è¿›ç¨‹çš„æ‰§è¡Œé€ æˆé˜»å¡ã€‚ åµŒå…¥å¼ Linux ç³»ç»Ÿçš„ GUI æ”¯æŒé—®é¢˜åµŒå…¥å¼ GUI æ˜¯ä¸ºç‰¹å®šç¡¬ä»¶å’Œç¯å¢ƒè®¾è®¡çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ç³»ç»Ÿã€‚é€šå¸¸ï¼Œè¿™ç±»ç³»ç»Ÿå…·æœ‰è½»é‡çº§ã€èµ„æºå ç”¨å°ã€æ€§èƒ½ä¼˜è¶Šå’Œå¯é…ç½®çš„ç‰¹ç‚¹ã€‚ç°æœ‰äº›è¾ƒä¸ºæˆç†Ÿçš„åµŒå…¥å¼ GUI è§£å†³æ–¹æ¡ˆåŒ…æ‹¬ï¼š Microwindowsï¼šä¸€ä¸ªè½»é‡çº§çš„çª—å£ç³»ç»Ÿï¼Œé€‚ç”¨äºåµŒå…¥å¼ç¯å¢ƒã€‚ MiniGUIï¼šé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„ï¼Œé€‚åˆå„ç§åµŒå…¥å¼å¹³å°ã€‚ OpenGUIï¼šä¸€ä¸ªçµæ´»ä¸”å¯æ‰©å±•çš„ GUI ç³»ç»Ÿï¼Œé€‚åº”äºå¤šç§ç¡¬ä»¶é…ç½®ã€‚ åµŒå…¥å¼ Linux ç³»ç»Ÿçš„è£å‰ªé’ˆå¯¹åµŒå…¥å¼ Linux ç³»ç»Ÿçš„è£å‰ªç­–ç•¥ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š åŸºäºå·²å®‰è£…ç³»ç»Ÿçš„è£å‰ªï¼šåœ¨ä¸€ä¸ªå·²ç»å®‰è£…çš„ Linux ç³»ç»Ÿä¸Šï¼Œåˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶å’Œç»„ä»¶æ¥ç¼©å°ç³»ç»Ÿçš„æ€»ä½“å¤§å°ã€‚è¿™ç§æ–¹æ³•åœ¨å®è·µä¸­å¾€å¾€éš¾ä»¥å¥æ•ˆï¼Œå› ä¸ºéšæ„åˆ é™¤æ–‡ä»¶å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šã€‚ å…¨æ–°æ„å»ºç³»ç»Ÿï¼šä»é›¶å¼€å§‹ï¼Œæ ¹æ®éœ€æ±‚æ„å»ºæ‰€éœ€çš„åŠŸèƒ½å’Œåº”ç”¨ï¼Œé€æ­¥å®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…ã€‚è¿™é€šå¸¸åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼šLinux å†…æ ¸ã€æ ¹æ–‡ä»¶ç³»ç»Ÿå’Œå¼•å¯¼åŠ è½½ç¨‹åºã€‚ å†…æ ¸ï¼šæä¾›æ“ä½œç³»ç»Ÿçš„åŸºæœ¬åŠŸèƒ½ï¼ŒåŒ…æ‹¬å†…å­˜ç®¡ç†ã€è¿›ç¨‹è°ƒåº¦ã€æ–‡ä»¶ç³»ç»ŸåŠç½‘ç»œåŠŸèƒ½ï¼ŒåŒæ—¶è¿˜åŒ…æ‹¬è®¾å¤‡é©±åŠ¨ç¨‹åºã€‚ æ ¹æ–‡ä»¶ç³»ç»Ÿï¼šæ¶µç›–ç»´æŠ¤ç³»ç»Ÿè¿è½¬æ‰€éœ€çš„å„ç§å·¥å…·è½¯ä»¶ã€åº“æ–‡ä»¶ã€è„šæœ¬ä»¥åŠé…ç½®æ–‡ä»¶ç­‰ï¼Œé€šå¸¸æ ¹æ–‡ä»¶ç³»ç»Ÿä½äºç‰¹å®šçš„ç£ç›˜åˆ†åŒºä¸Šã€‚ å¼•å¯¼åŠ è½½ç¨‹åºï¼šè´Ÿè´£ä»å¼•å¯¼è®¾å¤‡åŠ è½½å†…æ ¸å¹¶å¼•å¯¼ç³»ç»Ÿè¿è¡Œã€‚å¸¸è§çš„å¼•å¯¼ç¨‹åºæœ‰ LILO å’Œ GRUBã€‚ åµŒå…¥å¼ Linux æ ¹æ–‡ä»¶ç³»ç»Ÿçš„æ„å»ºä¸åˆ†æï¼ˆ2015ï¼‰Linux ç³»ç»Ÿç§»æ¤åŒ…æ‹¬ä¸‰ä¸ªä¸»è¦ç¯èŠ‚ï¼šå¼•å¯¼åŠ è½½ç¨‹åºï¼ˆbootloaderï¼‰ç§»æ¤ã€å†…æ ¸ç§»æ¤å’Œæ ¹æ–‡ä»¶ç³»ç»Ÿç§»æ¤ã€‚ åµŒå…¥å¼ Linux å…±äº«åº“è£å‰ªæŠ€æœ¯åˆ†æä¸æ”¹è¿›ï¼ˆ2009ï¼‰åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œä¸»è¦çš„è£å‰ªæŠ€æœ¯åŒ…å«ï¼š åˆ é™¤å†—ä½™æ–‡ä»¶ï¼šå»é™¤å¸®åŠ©æ–‡æ¡£ã€é…ç½®æ–‡ä»¶åŠä¸å¿…è¦çš„è¾…åŠ©ç¨‹åºç­‰ã€‚ å…±äº«åº“è£å‰ªï¼šé’ˆå¯¹åµŒå…¥å¼ç³»ç»Ÿåº”ç”¨æœ‰é™çš„ç‰¹ç‚¹ï¼Œè£å‰ªæ‰å…±äº«åº“ä¸­æœªä½¿ç”¨çš„å†—ä½™ä»£ç ã€‚ æ›¿ä»£è½¯ä»¶åŒ…ï¼šé€šè¿‡é€‰æ‹©æ›´å°å­˜å‚¨å ç”¨çš„è½¯ä»¶åŒ…æ›¿ä»£åŸæœ‰è¾ƒå¤§åŠŸèƒ½é‡å¤çš„è½¯ä»¶åŒ…ï¼Œä»¥å®ç°æœ‰æ•ˆç®¡ç†èµ„æºã€‚ æºç ä¿®æ”¹ï¼šé€šè¿‡é‡æ–°é…ç½®å’Œç¼–è¯‘å»æ‰ä¸å¿…è¦çš„åŠŸèƒ½ï¼Œç²¾ç®€å†…æ ¸ã€‚ åº”ç”¨ç¨‹åºä¸åº“ä¹‹é—´å¯ä»¥é€‰æ‹©é™æ€é“¾æ¥æˆ–åŠ¨æ€é“¾æ¥ã€‚é™æ€é“¾æ¥æ—¶ï¼Œé“¾æ¥å™¨ä¼šå°†æ‰€éœ€ä»£ç ä»åº“ä¸­å¤åˆ¶åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œè¿™æ ·ç£ç›˜å’Œå†…å­˜ä¸­ä¼šå­˜åœ¨å¤šä¸ªå†—ä½™æ‹·è´ã€‚åŠ¨æ€é“¾æ¥åˆ™å…è®¸å¤šä¸ªåº”ç”¨ç¨‹åºå…±äº«å†…å­˜ä¸­çš„åº“ï¼Œä»è€ŒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚ åœ¨å…±äº«åº“å’Œå¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼ŒåŒ…å«å¤šä¸ªç¬¦å·è¡¨å®šä¹‰å¤–éƒ¨ç¬¦å·ï¼Œåˆ†ä¸ºå¯¼å‡ºç¬¦å·ï¼ˆå¯è¢«å…¶ä»–æ–‡ä»¶è°ƒç”¨çš„å‡½æ•°ï¼‰ä¸å¯¼å…¥ç¬¦å·ï¼ˆè¢«è°ƒç”¨ä½†æœªå®šä¹‰çš„å‡½æ•°ï¼‰ã€‚è£å‰ªè¿‡ç¨‹ä¸­çš„å¿…è¦æ­¥éª¤æ˜¯ä½¿ç”¨å·¥å…·å¦‚ nmã€readelf æˆ– objdump å¯¼å‡ºäºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„å¤–éƒ¨ç¬¦å·ï¼Œå¹¶é‡å¤æ“ä½œç›´åˆ°è¾¾åˆ°è£å‰ªçš„æé™ã€‚ ä¸è¶³ä¹‹å¤„åŒ…æ‹¬ï¼šè£å‰ªæŠ€æœ¯æœªèƒ½æ·±å…¥åˆ°ç›®æ ‡æ–‡ä»¶çº§åˆ«ï¼›ä»£ç çš„ç¼–å†™æœªæœ‰ç»Ÿä¸€æ ‡å‡†ï¼Œå¢åŠ äº†è£å‰ªéš¾åº¦ï¼›ä¸åŒæ¶æ„éœ€é‡‡å–ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚ åµŒå…¥å¼ Linux ç³»ç»Ÿçš„è£å‰ªä¼˜åŒ–å’Œæµ‹è¯•æŠ€æœ¯ï¼ˆ2012ï¼‰å†…æ ¸è£å‰ªæ–¹æ³•ä¼—å¤šã€‚å…¶ä¸­ï¼ŒåŸºäº Kbuild ä½“ç³»çš„è£å‰ªæ–¹æ³•é€šè¿‡é¢„å®šä¹‰å˜é‡å’Œç›®æ ‡ï¼Œä½¿å†…æ ¸çš„ç¼–è¯‘å’Œæ‰©å±•å˜å¾—æ›´ä¸ºæ–¹ä¾¿ï¼Œå…·å¤‡è‰¯å¥½çš„å¯å®šåˆ¶æ€§ã€‚ä¸»è¦çš„é€‰é¡¹åŒ…æ‹¬ï¼š Yï¼šå°†åŠŸèƒ½ç¼–è¯‘è¿›å†…æ ¸ï¼› Nï¼šä¸å°†åŠŸèƒ½ç¼–è¯‘è¿›å†…æ ¸ï¼› Mï¼šå°†åŠŸèƒ½ç¼–è¯‘ä¸ºå¯åœ¨éœ€è¦æ—¶åŠ¨æ€æ’å…¥çš„æ¨¡å—ã€‚ åµŒå…¥å¼ Linux ç³»ç»Ÿçš„ç§»æ¤åŠå…¶æ ¹æ–‡ä»¶ç³»ç»Ÿçš„å®ç°ï¼ˆ2005ï¼‰åœ¨å®¿ä¸»æœºä¸Šåˆ¶ä½œä¸€ä¸ª 4MB çš„éšæœºç£ç›˜æ ¹æ–‡ä»¶ç³»ç»Ÿçš„æµç¨‹å¦‚ä¸‹ï¼š dd if=/dev/zero of=my_ramdisk bs=1k count=4096 mke2fs -vm0 my_ramdisk 4096 mount -o loop my_ramdisk /mnt/my_ramdisk_directorygzip my_ramdisk é¢å‘åº”ç”¨çš„åµŒå…¥å¼ Linux è£å‰ªæ–¹æ³•ç ”ç©¶ä¸å®ç°ï¼ˆ2009ï¼‰å‡½æ•°è°ƒç”¨å…³ç³»å›¾ç”¨äºæå–ç¨‹åºä¸­å„å‡½æ•°çš„è°ƒç”¨å…³ç³»ï¼Œä»¥å±•ç°æ•´ä¸ªç¨‹åºçš„ç»“æ„ã€‚è¯¥æ–¹æ³•é€šè¿‡è‡ªä¸Šè€Œä¸‹çš„ä»£ç åˆ†æï¼Œèƒ½å¤Ÿé’ˆå¯¹ç‰¹å®šåº”ç”¨é‡èº«å®šåˆ¶ï¼Œè¾¾åˆ°è¾ƒé«˜çš„è£å‰ªç‡ã€‚è¿™åœ¨åˆæœŸå°±å·²æ˜ç¡®åº”ç”¨èŒƒå›´çš„åµŒå…¥å¼ç³»ç»Ÿä¸­å°¤ä¸ºæœ‰æ•ˆã€‚ åŸºäº ARM çš„åµŒå…¥å¼ Linux ç§»æ¤æŠ€æœ¯ï¼ˆ2010ï¼‰ç°å¦‚ä»Šï¼Œå—å¹¿æ³›åº”ç”¨çš„åµŒå…¥å¼æ“ä½œç³»ç»ŸåŒ…æ‹¬åµŒå…¥å¼ Linuxã€Windows CEã€VxWorksã€Î¼COS-II å’Œ Palm OS ç­‰ã€‚å®ƒä»¬å„å…·ç‰¹ç‚¹ï¼š åµŒå…¥å¼ Linuxï¼šå¼€æ”¾æºä»£ç ï¼ŒæŠ€æœ¯æ”¯æŒå¼ºï¼Œå†…æ ¸ç¨³å®šï¼Œç»è¿‡è£å‰ªåå¯ä»¥è¾¾åˆ°é«˜æ•ˆç‡ã€‚ Windows CEï¼šåŠŸèƒ½æ¨¡å—åŒ–ã€ç»“æ„åŒ–ï¼Œé€‚ç”¨äºä¸åŒå¤„ç†å™¨ï¼Œå…·æœ‰è‰¯å¥½çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ã€‚ VxWorksï¼šå…·å¤‡å¼ºå¤§çš„å®æ—¶æ€§å’Œé«˜å¯é æ€§ï¼Œé€‚åˆäºå·¥ä¸šæ§åˆ¶ç­‰éœ€æ±‚ã€‚ Î¼COS-IIï¼šä»¥ ANSI C ç¼–å†™ï¼Œæ”¯æŒå¤šç§å¹³å°ï¼Œç»“æ„å°å·§ä¸”å¯è£å‰ªã€‚ Palm OSï¼šçµæ´»æ€§å’Œç§»åŠ¨æ€§å¼ºï¼Œç¨³å®šæ€§é«˜ï¼Œæ“ä½œç®€å•ã€‚ å…³äº Linux å†…æ ¸è£å‰ªçš„æ–¹æ³•æœ‰ä¸‰ç§ï¼š ä½¿ç”¨è‡ªå¸¦çš„é…ç½®ç¼–è¯‘å·¥å…·ï¼› ç›´æ¥ä¿®æ”¹å†…æ ¸æºä»£ç ï¼› åŸºäºç³»ç»Ÿè°ƒç”¨å…³ç³»å¯¹å†…æ ¸è¿›è¡Œè£å‰ªã€‚ å¯¹äºæ ¹æ–‡ä»¶ç³»ç»Ÿçš„åŠ è½½ï¼ŒåµŒå…¥å¼ç³»ç»Ÿå¤§å¤šé€šè¿‡ä»¥ä¸‹æ–¹æ³•å®ç°ï¼š åˆ©ç”¨ Ramdisk å°†æ ¹æ–‡ä»¶ç³»ç»ŸåŠ è½½è‡³ RAMã€‚ é€šè¿‡ MTD é©±åŠ¨å®ç° Flash å¯åŠ¨ï¼Œä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿå¦‚ YAFFSã€JFFS2 ç­‰åº”ç”¨äºæ­¤ï¼ŒMTD è®¾å¤‡é©±åŠ¨æ‰¿æ‹…äº†è¯»å†™å’Œæ“¦é™¤çš„ä»»åŠ¡ï¼Œå¹¶ä¸ºç”¨æˆ·å±‚æä¾›è®¾å¤‡æ¥å£ã€‚ åŸºäº ARM çš„åµŒå…¥å¼å¹³å°çš„ç ”ç©¶ä¸å®ç° (2009)æœ¬è®ºæ–‡ä¸­è®²è¿°äº†ç§»æ¤ Bootloaderã€å†…æ ¸åŠæ ¹æ–‡ä»¶ç³»ç»Ÿçš„å…·ä½“æ¡ˆä¾‹ï¼Œè¿™ä¸€ç ”ç©¶ä¸å…¶ä»–ç›¸å…³æ–‡çŒ®æœ‰å…¶ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†ä¹Ÿå¼•å…¥äº†ä¸€äº›ç‹¬åˆ°çš„è§è§£ä¸å®è·µã€‚ åŸºäº ARM çš„åµŒå…¥å¼é—ªå­˜é©±åŠ¨ä¸ UBIFS æ–‡ä»¶ç³»ç»Ÿçš„åˆ†æä¸å®ç° (2014)åœ¨è¿™ä¸€å¹´ï¼Œé’ˆå¯¹ä¼ ç»Ÿé€šç”¨æ–‡ä»¶ç³»ç»Ÿçš„å±€é™æ€§è¿›è¡Œäº†æ·±å…¥åˆ†æã€‚å¤§å¤šæ•°é€šç”¨æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸ºé€Ÿåº¦è¾ƒæ…¢çš„æœºæ¢°ç¡¬ç›˜è®¾è®¡ï¼Œè¿™æ„å‘³ç€å®ƒä»¬åœ¨å¤„ç†åµŒå…¥å¼ç³»ç»Ÿæ—¶é¢ä¸´è®¸å¤šæŒ‘æˆ˜ã€‚åµŒå…¥å¼ç³»ç»Ÿé€šå¸¸åœ¨èµ„æºå—é™çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œä½¿ç”¨ç¼“å­˜æŠ€æœ¯çš„é«˜èµ„æºæ¶ˆè€—ä¸è¿™äº›ç³»ç»Ÿçš„è®¾è®¡ç›®æ ‡äº§ç”Ÿäº†å†²çªã€‚åŒæ—¶ï¼Œé€šç”¨æ–‡ä»¶ç³»ç»Ÿçš„å¯é æ€§å¾€å¾€æ— æ³•æ»¡è¶³æç«¯ç¯å¢ƒä¸‹çš„éœ€æ±‚ã€‚æ­¤å¤–ï¼ŒNAND Flash çš„æ¥å£è®¿é—®ä¸ä¼ ç»Ÿç¡¬ç›˜å­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼Œå¦‚æœç®€å•ä½¿ç”¨é€šç”¨æ–‡ä»¶ç³»ç»Ÿï¼Œå°†éš¾ä»¥å®ç°å¯¹ NAND Flash å¿…è¦çš„é”™è¯¯æ ¡éªŒåŠåå—ç®¡ç†åŠŸèƒ½ã€‚ ä¸ºäº†æé«˜ NAND Flash çš„ä½¿ç”¨å¯¿å‘½å¹¶ç¼©çŸ­æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½æ—¶é—´ï¼ŒUBIFSï¼ˆUnsorted Block Image File Systemï¼‰åº”è¿è€Œç”Ÿã€‚UBIFS é€šè¿‡æŸè€—å¹³è¡¡ã€åƒåœ¾æ”¶é›†å’Œåå—ç®¡ç†æœºåˆ¶ï¼Œå°†åµŒå…¥å¼æ–‡ä»¶ç³»ç»Ÿçš„æ€§èƒ½æå‡è‡³æ–°çš„é«˜åº¦ã€‚ä¸æ—©æœŸçš„ YAFFS å’Œ JFFS ç³»åˆ—ç›¸æ¯”ï¼ŒUBIFS åœ¨å¯åŠ¨é€Ÿåº¦å’Œå†…å­˜å ç”¨ä¸Šè¡¨ç°å¾—å°¤ä¸ºå‡ºè‰²ï¼Œå°¤å…¶é€‚åˆäºå¤§å®¹é‡ NAND Flash çš„åº”ç”¨åœºåˆã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒJFFS2 è™½ç„¶æä¾›äº†è‰¯å¥½çš„è¯»å†™é€Ÿåº¦ï¼Œä½†å…¶æŒ‚è½½é€Ÿåº¦çš„ç¼ºé™·ä»ç„¶æ˜¯åˆ¶çº¦å…¶å¹¿æ³›åº”ç”¨çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚ Raw Flash ä¸å…¶ä»– Flash çš„åŒºåˆ«UBIï¼ˆUnsorted Block Imageï¼‰ç³»ç»Ÿä»…èƒ½åœ¨ Raw Flash ä¸Šè¿è¡Œã€‚å®ƒåœ¨ MTDï¼ˆMemory Technology Deviceï¼‰åˆ†åŒºä¹‹ä¸Šæä¾›å·åˆ†åŒºã€åå—ç®¡ç†å’ŒæŸè€—å‡è¡¡æœºåˆ¶ï¼Œè€Œ UBIFS åˆ™åŸºäº UBI å·ï¼Œç®€åŒ–äº†ä¸ MTD å±‚å’Œ Flash å±‚çš„äº¤äº’ï¼Œæå‡äº†ç³»ç»Ÿçš„é«˜æ•ˆæ€§ã€‚UBIFS è¿˜å…·å¤‡å¼‚åœ°æ›´æ–°æœºåˆ¶ï¼Œè¿™æ„å‘³ç€æ–‡ä»¶çš„ä¿®æ”¹ä¸ä¼šç›´æ¥è¦†ç›–åŸæœ‰æ•°æ®ï¼Œä»è€Œæœ‰æ•ˆå‡å°‘æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚ ä»æ€§èƒ½æ¯”è¾ƒæ¥çœ‹ï¼ŒUBIFS æ¯” YAFFS2 å¯åŠ¨æ—¶é—´çº¦å¿« 5 ç§’ï¼Œè¿™åœ¨å®é™…æ“ä½œä¸­èƒ½å¤Ÿæ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒã€‚ ç²¾ç®€å‹åµŒå…¥å¼æ–‡ä»¶ç³»ç»Ÿè®¾è®¡ (2010)é¢å¯¹ Flash å­˜å‚¨ä»‹è´¨çš„å¯¿å‘½é—®é¢˜ï¼Œä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿæ— æ³•ç›´æ¥é€‚ç”¨ï¼Œå¿…é¡»æ·»åŠ  Flash è½¬æ¢å±‚ï¼ˆFTLï¼‰ï¼Œä½† FTL é€ æˆçš„æ€§èƒ½ç“¶é¢ˆé—®é¢˜ä¸å®¹å¿½è§†ã€‚åœ¨æ–‡ä»¶ä¿®æ”¹æˆ–æ–°å»ºæ—¶ï¼Œä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿé€šå¸¸å¹¶ä¸ä¼šç«‹å³å†™å…¥ç›¸å…³çš„å…ƒæ•°æ®ï¼ˆåŒ…å«æ–‡ä»¶ä¿¡æ¯ã€æƒé™ã€æ‰€æœ‰è€…åŠæ—¶é—´æˆ³ç­‰ï¼‰ï¼Œè€Œæ˜¯å¾…ç©ºé—²æ—¶å†è¿›è¡Œã€‚è¿™ç§è®¾è®¡åœ¨æ–­ç”µæ—¶ä¼šå¯¼è‡´ä¸¥é‡çš„ä¸ä¸€è‡´æ€§é—®é¢˜ï¼Œåæœå¯èƒ½ç›¸å½“è‡´å‘½ã€‚å› æ­¤ï¼Œæ—¥å¿—æ–‡ä»¶ç³»ç»Ÿæˆä¸ºè§£å†³è¯¥é—®é¢˜çš„æœ‰æ•ˆè·¯å¾„ã€‚ æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ç‹¬ç«‹çš„æ—¥å¿—æ–‡ä»¶è·Ÿè¸ªç£ç›˜å†…å®¹çš„å˜åŒ–ã€‚åœ¨æ¯æ¬¡å†™å…¥ä¹‹å‰ï¼Œç³»ç»Ÿä¼šé¦–å…ˆå°†æ”¹åŠ¨è®°å½•åˆ°æ—¥å¿—çš„å°¾éƒ¨ï¼Œç¡®ä¿åœ¨æ–­ç”µå‘ç”Ÿæ—¶ï¼Œåªéœ€æŸ¥çœ‹æ—¥å¿—å°¾éƒ¨å³å¯å¿«é€Ÿæ¢å¤æ•´ä¸ªç³»ç»Ÿï¼Œæå¤§ç¼©çŸ­äº†æ¢å¤æ—¶é—´ã€‚è¯¥ç±»æ–‡ä»¶ç³»ç»Ÿä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼š Log-Structured æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿï¼šå°†æ•´ä¸ªç£ç›˜è§†ä¸ºä¸€ä¸ªå¤§æ—¥å¿—ï¼Œæ‰€æœ‰å†™æ“ä½œéƒ½å‘ç”Ÿåœ¨æ—¥å¿—çš„å°¾éƒ¨ã€‚æ¯æ¬¡å†™å…¥åï¼Œæ•°æ®è®°å½•åœ¨æ–°åœ°å€ï¼Œä»è€Œå½¢æˆä¸€ç³»åˆ—è¿‡æ—¶çš„æ•°æ®å—ã€‚é€šè¿‡å®šæœŸæ¸…ç†ï¼Œè¿™äº›è¿‡æ—¶å—ä¼šè¢«å›æ”¶ï¼Œä¿æŒæ—¥å¿—çš„æ•´æ´æ€§ã€‚ MetaData æ—¥å¿—æ–‡ä»¶ç³»ç»Ÿï¼šä»…å…³æ³¨å…ƒæ•°æ®çš„å˜åŒ–ï¼Œé€šå¸¸åœ¨ç£ç›˜ä¸Šåˆ’åˆ†ä¸“é—¨åŒºåŸŸæˆ–åˆ›å»ºç‰¹æ®Šæ–‡ä»¶æ¥ä¿å­˜æ—¥å¿—ã€‚æ­¤ç±»æ–‡ä»¶ç³»ç»Ÿä½¿å¾—å…ƒæ•°æ®å˜æ›´çš„è¿½è¸ªæ›´ä¸ºé«˜æ•ˆã€‚ NTFS æ–‡ä»¶ç³»ç»Ÿçš„é‡è¦ç‰¹æ€§ é€šç”¨ç´¢å¼•åŠŸèƒ½ï¼šæ”¯æŒæ ¹æ®ä»»ä½•å±æ€§å»ºç«‹æ–‡ä»¶ç´¢å¼•ã€‚ å¤§ç£ç›˜å’Œå¤§æ–‡ä»¶æ”¯æŒï¼šæ›´æœ‰æ•ˆå¤„ç†éå¸¸å¤§çš„ç£ç›˜å’Œæ–‡ä»¶ã€‚ å¤šæ•°æ®æµï¼šæ–‡ä»¶çš„å®é™…å†…å®¹ä»¥å­—èŠ‚æµæ–¹å¼å¤„ç†ã€‚ å¯æ¢å¤æ€§ï¼šåœ¨å‘ç”Ÿæ•…éšœæ—¶ï¼ŒNTFS èƒ½å¤Ÿé‡å»ºæ–‡ä»¶å·å¹¶æ¢å¤è‡³ä¸€è‡´çŠ¶æ€ï¼ŒåŒæ—¶å¯¹é‡è¦æ•°æ®è¿›è¡Œå†—ä½™å­˜å‚¨ã€‚ å®‰å…¨æ€§ï¼šåˆ©ç”¨ Windows å¯¹è±¡æ¨¡å‹å®æ–½å¼ºå¤§çš„å®‰å…¨æœºåˆ¶ã€‚ REFS çš„ç‰¹æ€§REFSï¼ˆResilient File Systemï¼‰æ—¨åœ¨é’ˆå¯¹ NAND Flash å­˜å‚¨ä»‹è´¨ä¼˜åŒ–åµŒå…¥å¼æ–‡ä»¶ç³»ç»Ÿï¼Œå…¶ä¸»è¦ç‰¹æ€§åŒ…æ‹¬ï¼š æŸè€—å¹³è¡¡ã€‚ ç¬¦åˆ NAND Flash çš„é¡µè¯»å†™ä¸å—æ“¦é™¤ç‰¹ç‚¹ã€‚ åå—ç®¡ç†èƒ½åŠ›ã€‚ æ¢å¤æ–‡ä»¶ä¸ç³»ç»Ÿè‡ªæˆ‘ä¿®å¤èƒ½åŠ›ä»¥æé«˜å¯é æ€§ã€‚ è‰¯å¥½çš„æ—¶é—´æ€§èƒ½ã€‚ å¯ç§»æ¤å’Œå¯æ‰©å±•æ€§ã€‚ åµŒå…¥å¼è®¾å¤‡ä¸­åŸºäº NAND Flash çš„æ–‡ä»¶ç³»ç»Ÿè®¾è®¡å’Œä¼˜åŒ– (2013)Flash å­˜å‚¨å™¨çš„ä¼˜åŠ¿ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š ä¸€è‡´çš„è¯»æ€§èƒ½ï¼šç”±äºæ²¡æœ‰å¯»é“å’Œæ—‹è½¬æ“ä½œï¼Œéšæœºè¯»æ€§èƒ½ä¸é¡ºåºè¯»æ€§èƒ½æ¥è¿‘ã€‚ è¯»å†™å»¶è¿Ÿé™ä½ï¼šä¸æœºæ¢°ç£ç›˜ç›¸æ¯”ï¼ŒFlash çš„è¯»å†™å»¶è¿Ÿæ˜¾è‘—é™ä½ã€‚ é«˜å¯é æ€§ï¼šå¹³å‡æ— æ•…éšœæ—¶é—´ï¼ˆMTBFï¼‰æ¯”ä¼ ç»Ÿç£ç›˜é•¿ä¸€ä¸ªæ•°é‡çº§ã€‚ ä½èƒ½è€—ï¼šå•ä½æ—¶é—´å†…çš„èƒ½é‡æ¶ˆè€—è¿œä½äº RAM å’Œç£ç›˜å­˜å‚¨å™¨ã€‚ åµŒå…¥å¼ Linux ç³»ç»Ÿè£å‰ªæŠ€æœ¯çš„åˆ†æä¸ç ”ç©¶ (2011)ä»è½¯ä»¶å±‚é¢åˆ†æï¼ŒåµŒå…¥å¼ Linux é€šå¸¸ç”± Linux å†…æ ¸ã€æ–‡ä»¶ç³»ç»ŸåŠåº”ç”¨ç¨‹åºç»„æˆã€‚å› æ­¤ï¼Œç°æœ‰ Linux è£å‰ªå·¥ä½œä¸»è¦é›†ä¸­åœ¨ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š å†…æ ¸è£å‰ªï¼šå·²åœ¨å‰æ–‡è®¨è®ºä¸­æåŠã€‚ åº“è£å‰ªï¼šé€šè¿‡ä½¿ç”¨ uClibc æ„å»ºåµŒå…¥å¼ Linux ç³»ç»Ÿï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘å ç”¨ç©ºé—´ï¼Œç›¸æ¯” glibc æ›´ä¸ºé«˜æ•ˆã€‚ åº”ç”¨ç¨‹åºè£å‰ªï¼šé€šå¸¸ä½¿ç”¨ BusyBox æ›¿ä»£ä¼ ç»Ÿ shell ç¨‹åºï¼Œä»è€Œæ˜¾è‘—å‡å°ç³»ç»Ÿä½“ç§¯ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿","ç³»ç»Ÿç§»æ¤"]},{"title":"æ ¹æ–‡ä»¶ç³»ç»Ÿçš„åˆ¶ä½œ","path":"/2024/09/26/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-ç³»ç»Ÿç§»æ¤-æ ¹æ–‡ä»¶ç³»ç»Ÿçš„åˆ¶ä½œ/","content":"ARM Linux æ ¹æ–‡ä»¶ç³»ç»Ÿï¼ˆRoot Filesystemï¼‰çš„åˆ¶ä½œå…³äºæ ¹æ–‡ä»¶ç³»ç»Ÿçš„åˆ¶ä½œï¼Œç½‘ç»œä¸Šæœ‰è®¸å¤šç›¸å…³çš„èµ„æºã€‚ç„¶è€Œï¼Œè®¸å¤šæ–‡ç« å¾€å¾€åªæåˆ°åˆ›å»ºå‡ ä¸ªåŸºæœ¬ç›®å½•ï¼Œç„¶åä½¿ç”¨ Busybox æ­å»ºä¸€ä¸ªç®€å•çš„ Shell ï¼Œè€Œå¿½è§†äº†è®¸å¤šå…³é”®ç»†èŠ‚ã€‚ç»è¿‡é•¿æ—¶é—´çš„å°è¯•å’Œå®è·µï¼ŒæˆåŠŸå®ç°äº†ä»é›¶å¼€å§‹åˆ›å»ºæ ¹æ–‡ä»¶ç³»ç»Ÿã€‚å°½ç®¡å¯¹åŸç†å°šä¸å®Œå…¨ç†è§£ï¼Œä½†ä»¥ä¸‹æ˜¯å…·ä½“çš„åˆ¶ä½œè¿‡ç¨‹ï¼Œå…¶ä¸­å¯èƒ½å­˜åœ¨ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚ æ ¹æ–‡ä»¶ç³»ç»Ÿçš„ç»„æˆéƒ¨åˆ†æ ¹æ–‡ä»¶ç³»ç»Ÿä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼šç›®å½•ç»“æ„ã€Shellã€åº“æ–‡ä»¶å’Œè„šæœ¬ã€‚é€ä¸€ä»‹ç»å¦‚ä¸‹ã€‚ ç›®å½•æ ¹æ–‡ä»¶ç³»ç»Ÿå¿…é¡»åŒ…å«ä»¥ä¸‹åŸºæœ¬ç›®å½•ï¼š /dev /bin /usr /sbin /lib /etc /proc /sys dev ç›®å½•æ˜¯è®¾å¤‡æ–‡ä»¶ç³»ç»Ÿï¼ˆdevfsï¼‰æˆ– udev æŒ‚è½½ç‚¹ã€‚åœ¨ä½¿ç”¨ devfs å†…æ ¸çš„ç³»ç»Ÿä¸­ï¼Œå¦‚æœæ²¡æœ‰ /dev ç›®å½•ï¼ŒShell å¯åŠ¨æ—¶å°†æ— æ³•è¾“å‡ºä»»ä½•ä¿¡æ¯ï¼Œå› ä¸ºå†…æ ¸æ— æ³•æ‰¾åˆ° /dev/consoleã€‚åœ¨ä½¿ç”¨ udev çš„ç³»ç»Ÿä¸­ï¼Œä¹Ÿéœ€è¦æ‰‹åŠ¨åœ¨ /dev ä¸‹ç”Ÿæˆ console å’Œ null è¿™ä¸¤ä¸ªèŠ‚ç‚¹ã€‚å…³äº devfs å’Œ udev çš„åŒºåˆ«ï¼Œå¯ä»¥æŸ¥é˜…ç›¸å…³èµ„æ–™ã€‚å¦‚æœå†…æ ¸ä¸å†æ”¯æŒ devfsï¼ˆ2.6.12 ä¹‹åï¼‰ï¼Œå¯ä»¥æ‰‹åŠ¨ä½¿ç”¨ mknod å‘½ä»¤åˆ›å»ºé™æ€èŠ‚ç‚¹ã€‚ binã€usrbinã€usrsbin å’Œ sbin ç›®å½•åœ¨ç¼–è¯‘ Busybox æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œç”¨äºå­˜æ”¾äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ã€‚æ— éœ€å¤šåŠ è¯´æ˜ã€‚ lib ç›®å½•ç”¨äºå­˜æ”¾åŠ¨æ€é“¾æ¥åº“ã€‚è™½ç„¶å¾ˆå¤šæ–‡ç« å»ºè®®é™æ€ç¼–è¯‘ Busybox ä»¥ç®€åŒ–æ„å»ºæµç¨‹ï¼Œä½†è¿™å¹¶ä¸è¶³ä»¥æ»¡è¶³æ‰€æœ‰éœ€æ±‚ã€‚å³ä½¿é™æ€ç¼–è¯‘èƒ½å¤Ÿä½¿ Busybox å¯åŠ¨ï¼Œè‡ªå·±ç¼–å†™æˆ–ç¼–è¯‘çš„è½¯ä»¶åŒ…ä»éœ€ä¾èµ–åŠ¨æ€åº“ã€‚é™¤éæ‰€æœ‰ç»„ä»¶å‡é™æ€ç¼–è¯‘ï¼Œå¦åˆ™åŠ¨æ€åº“çš„å­˜åœ¨æ˜¯ä¸å¯é¿å…çš„ã€‚ etc ç›®å½•ç”¨äºå­˜æ”¾åˆå§‹åŒ–è„šæœ¬åŠå…¶ä»–é…ç½®æ–‡ä»¶ï¼Œå…·ä½“å†…å®¹å°†åœ¨åç»­éƒ¨åˆ†è¯¦ç»†è¯´æ˜ã€‚ proc ç›®å½•ç”¨äºæŒ‚è½½è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿâ€”â€”â€œproc æ–‡ä»¶ç³»ç»Ÿâ€ã€‚â€œproc æ–‡ä»¶ç³»ç»Ÿâ€å¯ä»¥åœ¨å†…æ ¸é…ç½®ä¸­å¯ç”¨ã€‚å¦‚æœæœªå¯ç”¨ï¼Œè®¸å¤š Shell å‘½ä»¤å°†æ— æ³•æ­£å¸¸è¿è¡Œï¼Œä¾‹å¦‚ ifconfigã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œâ€œproc æ–‡ä»¶ç³»ç»Ÿâ€ä¸ä¼šè‡ªåŠ¨æŒ‚è½½ï¼Œå¿…é¡»é€šè¿‡åˆå§‹åŒ–è„šæœ¬è¿›è¡ŒæŒ‚è½½ã€‚åŒæ—¶ï¼Œudev ä¹Ÿä¾èµ–äºâ€œproc æ–‡ä»¶ç³»ç»Ÿâ€ã€‚ sys ç›®å½•ç”¨äºæŒ‚è½½â€œsysfs æ–‡ä»¶ç³»ç»Ÿâ€ï¼ŒåŒæ ·éœ€è¦åœ¨å†…æ ¸ä¸­å¯ç”¨ã€‚è¿™ä¸€æ–‡ä»¶ç³»ç»Ÿé€šå¸¸ä¸º udev æä¾›æ”¯æŒï¼Œå¿…é¡»ä½¿ç”¨åˆå§‹åŒ–è„šæœ¬è¿›è¡ŒæŒ‚è½½ã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰å…¶ä»–éåµŒå…¥å¼ç³»ç»Ÿå¿…éœ€çš„ç›®å½•ï¼Œä¾‹å¦‚ /tmpã€/mntã€/swapã€/varï¼Œå°†åœ¨åç»­è®¨è®ºä¸­æåŠã€‚ ShellShell çš„é€‰æ‹©éå¸¸ç®€å•ï¼Œä½¿ç”¨ Busyboxã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹é“¾æ¥ä¸‹è½½ Busyboxï¼šBusybox ä¸‹è½½ã€‚æœ‰äººæåˆ° Busybox ä¸ arm-linux-gcc å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œä½†é€šå¸¸è¿™æ˜¯ç”±äºæ—©æœŸç‰ˆæœ¬é€ æˆçš„ã€‚æ ¹æ®å®é™…ä½¿ç”¨ç»éªŒï¼ŒBusybox 1.8.2 ä¸ arm-linux-gcc 3.4.13.3.2 å¯ä»¥è‰¯å¥½å…¼å®¹ã€‚ è§£å‹å®Œæˆåï¼Œéœ€æ‰¾åˆ° Makefile æ–‡ä»¶ï¼Œé…ç½® ARCH å’Œ CROSS_COMPILE å˜é‡ï¼š ARCH ?= armCROSS_COMPILE ?= /usr/local/arm/3.4.1/bin/arm-linux- CROSS_COMPILE åº”æ ¹æ®è‡ªå·±çš„ç¼–è¯‘å™¨è·¯å¾„è¿›è¡Œè®¾ç½®ã€‚æ¥ä¸‹æ¥çš„æ­¥éª¤å¦‚ä¸‹ï¼š # make menuconfig# make# make install åœ¨é…ç½®è¿‡ç¨‹ä¸­ï¼Œç¡®ä¿å»æ‰ä¸€äº›é’ˆå¯¹ uCLinux çš„é€‰é¡¹ï¼Œä»¥å…å¼•èµ·é”™è¯¯ã€‚å¦å¤–ï¼Œå¯ä»¥ä¿®æ”¹å®‰è£…è·¯å¾„ï¼Œé»˜è®¤åœ¨ Busybox çš„ _install ç›®å½•ä¸­ã€‚ æ¥ä¸‹æ¥ï¼Œå¯ä»¥åŸºäº Busybox ç”Ÿæˆçš„ Shell å¼€å§‹å»ºç«‹æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚æ¥ä¸‹æ¥çš„å‘½ä»¤å¦‚ä¸‹ï¼Œå‡è®¾ Busybox å­˜æ”¾åœ¨ /home/lxz/busyboxï¼Œè€Œæ ¹æ–‡ä»¶ç³»ç»Ÿåœ¨ /home/lxz/rootfsï¼š # mkdir /home/lxz/rootfs# cd /home/lxz/busybox/_install# cp -r ./ /home/lxz/rootfs # cd /home/lxz/rootfs# mkdir dev# mkdir etc# mkdir lib# mkdir proc# mkdir sys# mkdir tmp å¦‚æœä¸ä½¿ç”¨ devfsï¼Œéœ€æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¹¶ç¡®ä¿ä»¥ root ç”¨æˆ·èº«ä»½æ‰§è¡Œï¼š # cd /home/lxz/rootfs/dev# mknod -m 660 console c 5 1# mknod -m 660 null c 1 3 å¦‚ä¸åˆ›å»ºè¿™ä¸¤ä¸ªé™æ€èŠ‚ç‚¹ï¼Œconsole çš„æç¤ºä¿¡æ¯å°†æ— æ³•æ˜¾ç¤ºï¼Œå†…æ ¸å¯èƒ½ä¼šæç¤ºâ€œWarning: Unable to find an initial consoleâ€ç­‰ä¿¡æ¯ã€‚å¦‚æœä½¿ç”¨ udevï¼Œåˆ™éœ€å°† udevdã€udevstartã€udevadmin ä¸‰ä¸ªæ–‡ä»¶æ”¾åˆ° /sbin ç›®å½•ä¸‹ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚ åº“åº“çš„å¤„ç†å¯èƒ½æ˜¯æœ€å¤æ‚çš„éƒ¨åˆ†ã€‚åˆå­¦è€…å¯ä»¥å¤åˆ¶å·²è´­ä¹°å¼€å‘æ¿ä¸Šç°æœ‰çš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„åº“æ–‡ä»¶ã€‚å¦‚æœå¼€å‘æ¿çš„æ–‡ä»¶ç³»ç»Ÿä¸ºæ˜ åƒæ ¼å¼ï¼Œåªéœ€å°†å…¶æŒ‚è½½åˆ°æŸä¸ªç›®å½•å³å¯æ–¹ä¾¿è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ˜ åƒä¸º rootfs.cramfsï¼Œåˆ™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š # mkdir /home/lxz/evb_rootfs# mount -o loop rootfs.cramfs /home/lxz/evb_rootfs ç„¶åï¼Œåˆ‡æ¢è‡³æ™®é€šç”¨æˆ·åï¼Œå¤åˆ¶åº“æ–‡ä»¶ï¼š # cd /home/lxz/evb_rootfs/lib# cp -r ./ /home/lxz/rootfs/lib è™½ç„¶å¼€å‘æ¿é€šå¸¸ä¼šå¸¦æœ‰å¿…è¦çš„åº“ï¼Œä½†æ–‡ä»¶æ€»ä½“ç§¯å¯èƒ½è¾ƒå¤§ã€‚å¯ä»¥åˆ é™¤ä¸€äº›ä¸éœ€è¦çš„åº“ä»¥å‡å°ä½“ç§¯ï¼Œç„¶è€Œï¼Œåˆå­¦è€…é€šå¸¸å¯¹æ­¤ä¸å¤ªäº†è§£ã€‚ä¸ºäº†è‡ªå·±ç¼–è¯‘æ›´ç²¾ç®€çš„åº“ï¼Œå¯ä»¥ä½¿ç”¨ glibc æˆ– uclibcï¼Œè¿™äº›æ­¥éª¤ç›¸å¯¹å¤æ‚ã€‚æ¨èçš„æ›¿ä»£æ–¹æ¡ˆæ˜¯ä½¿ç”¨ cross-toolï¼Œå¯åœ¨ cross-tool ä¸‹è½½åœ°å€ è·å–ã€‚ åœ¨æˆåŠŸåˆ¶ä½œäº¤å‰ç¼–è¯‘å™¨åï¼Œå¯ä» cross-tool ç›®å½•ä¸­æå– glibcã€‚ä¾‹å¦‚ï¼Œå¦‚æœ cross-tool è·¯å¾„ä¸º /home/lxz/cross-toolï¼Œç¼–è¯‘å™¨ä¸º arm-linux-gnu-gccï¼ˆç‰ˆæœ¬ 3.4.5ï¼Œglibc ç‰ˆæœ¬ 2.3.6ï¼‰ï¼Œå¯æŒ‰ä»¥ä¸‹æ–¹å¼å¤åˆ¶æ‰€éœ€çš„åº“ï¼š # cd /home/lxz/cross-tool/build/arm-linux-gnu-gcc/gcc-3.4.5-glibc-2.3.6/build-glibc # ../glibc-2.3.6/configure --prefix=/home/lxz/glibc # make install å®Œæˆåï¼Œæ‰§è¡Œï¼š # cd /home/lxz/glibc # cp -r lib /home/lxz/rootfs è‡³æ­¤ï¼Œå¤§éƒ¨åˆ†åº“æ–‡ä»¶å·²æˆåŠŸå¤åˆ¶ï¼Œä½†ä»éœ€è¡¥å……å…¶å®ƒåº“æ–‡ä»¶ã€‚ç»§ç»­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š # cd /home/lxz/cross-tool/build/arm-linux-gnu-gcc/gcc-3.4.5-glibc-2.3.6/build-gcc/gcc # cp libgcc_s.so* /home/lxz/rootfs/lib æ¥ä¸‹æ¥ï¼Œå¤„ç†ç¼ºå¤±çš„ libtermcap åº“ï¼Œæºä»£ç åŒ…å¯ä»å¦‚ä¸‹é“¾æ¥è·å–ï¼šLibtermcap ä¸‹è½½åœ°å€ã€‚å‡è®¾å…¶å·²ä¸‹è½½è‡³ /home/lxz/libtermcapï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š # cd /home/lxz/libtermcap # rpm2cpio libtermcap-2.0.8-35.src.rpm | cpio -ivd# tar xvjf termcap-2.0.8.tar.bz2 æ¥ä¸‹æ¥ï¼Œéœ€è¦é€ä¸ªæŒ‰é¡ºåºåº”ç”¨ 13 ä¸ªè¡¥ä¸ï¼š # patch -p0 -i termcap-2.0.8-shared.patch# patch -p0 -i termcap-2.0.8-setuid.patch# patch -p0 -i termcap-2.0.8-instnoroot.patch# patch -p0 -i termcap-2.0.8-compat21.patch# patch -p0 -i termcap-2.0.8-xref.patch# patch -p0 -i termcap-2.0.8-fix-tc.patch# patch -p0 -i termcap-2.0.8-ignore-p.patch# patch -p0 -i termcap-buffer.patch# patch -p0 -i termcap-2.0.8-bufsize.patch# patch -p0 -i termcap-2.0.8-colon.patch# patch -p0 -i libtermcap-aaargh.patch# patch -p0 -i termcap-2.0.8-glibc22.patch# patch -p0 -i libtermcap-2.0.8-ia64.patch æ¥ç€ï¼Œä¿®æ”¹ /home/lxz/libtermcap/termcap-2.0.8 å†…çš„ Makefileï¼Œæ›´æ–° CC å’Œ AR çš„ä½ç½®ï¼š CC = /usr/local/arm/3.4.1/bin/arm-linux-gcc AR = /usr/local/arm/3.4.1/bin/arm-linux-ar æ›¿æ¢ä¸ºåˆé€‚çš„ç¼–è¯‘å™¨è·¯å¾„ã€‚è‹¥è§‰å¾—ç¹çï¼Œå¯ä»å…¶ä»–èµ„æ–™ç½‘ç«™ä¸‹è½½å·²ç»é€‚é…çš„åŒ…ï¼ˆå¯åœ¨ç›¸å…³èµ„æºç«™ç‚¹æŸ¥æ‰¾ï¼‰ã€‚ å®Œæˆåº“æ–‡ä»¶æ„å»ºåï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å‰¥ç¦»è°ƒè¯•ä¿¡æ¯ï¼Œå‡å°åº“çš„ä½“ç§¯ï¼ˆè™½ç„¶ä¿ç•™å¹¶æ— å½±å“ï¼‰ï¼š # cd /home/lxz/rootfs/lib # arm-linux-strip *.so* è‡³æ­¤ï¼Œåº“æ–‡ä»¶å·²å®Œæˆåˆ¶ä½œã€‚ è„šæœ¬åœ¨æ‹¥æœ‰ä»¥ä¸ŠåŸºæœ¬ç»“æ„åï¼ŒShell ä»å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œï¼Œé€šå¸¸ä¼šè¡¨ç°ä¸ºå†…æ ¸æç¤ºâ€œFree init memory: XXKâ€åæ²¡æœ‰ä»»ä½•è¾“å‡ºã€‚è¿™å¸¸å¸¸æ˜¯å› ä¸ºåˆå§‹åŒ–è„šæœ¬æœªèƒ½æˆåŠŸå¯åŠ¨ Shellã€‚æ¥ä¸‹æ¥éœ€é…ç½®è¿™äº›è„šæœ¬ã€‚ é¦–å…ˆæ˜¯ /etc/inittabã€‚è¿™æ˜¯å¯åŠ¨å†…æ ¸ã€æŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿåå¿…éœ€çš„æ–‡ä»¶ï¼ŒåŒ…å«äº†å¯åŠ¨ Shell å’Œè¿›è¡Œç³»ç»Ÿåˆå§‹åŒ–æ‰€éœ€çš„å‘½ä»¤ã€‚å¦‚æœå¸Œæœ›åœ¨å¯åŠ¨æ—¶å‡ºç° Shellï¼Œåªéœ€æ·»åŠ ä¸€è¡Œå¦‚ä¸‹é…ç½®ï¼š ::askfirst:/bin/ash åœ¨æ­¤è¡Œä»£ç ä¹‹å‰ï¼Œå†…æ ¸å·²å¯åŠ¨ï¼Œå…¶å®ƒåˆå§‹åŒ–è¿‡ç¨‹ä¸­å¯ä»¥è¿›ä¸€æ­¥é…ç½®ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹çš„ inittab å†…å®¹ï¼Œç”¨äºè¯´æ˜å…¶åŠŸèƒ½ï¼š # Startup the systemnull::sysinit:/bin/mount -o remount,rw /null::sysinit:/bin/mount -t proc proc /procnull::sysinit:/bin/mount -anull::sysinit:/bin/hostname -F /etc/hostname # Now run any rc scripts::sysinit:/etc/init.d/rcS # Now invoke shell::askfirst:/bin/ash # Logging systemnull::sysinit:/bin/touch /var/log/messagesnull::respawn:/sbin/syslogd -n -m 0null::respawn:/sbin/klogd -n # Handling 3-finger salute (Ctrl+Alt+Del)::ctrlaltdel:/sbin/reboot # System shutdown tasksnull::shutdown:/usr/bin/killall klogdnull::shutdown:/usr/bin/killall syslogdnull::shutdown:/bin/umount -a -rnull::shutdown:/sbin/swapoff -a å°†ä»¥ä¸Šå†…å®¹å‚¨å­˜ä¸º inittab åå¯åŠ¨ç³»ç»Ÿï¼Œæ­¤æ—¶åº”å‡ºç°ä¸¤ä¸ªæç¤ºã€‚ç¼ºå°‘ /etc/fstab å’Œ /etc/init.d/rcS æ–‡ä»¶ã€‚æ ¹æ®ç†è§£ï¼Œ/etc/fstab æ–‡ä»¶æ˜¯ç”¨äºæ‰§è¡Œ mount -a å‘½ä»¤çš„ï¼Œå…¶å†…å®¹æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½è¡¨ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹çš„ fstab å†…å®¹ï¼š # file system mount pt type options dump pass/dev/root / ext2 rw,noauto 0 1proc /proc proc defaults é€šè¿‡è¿™äº›æ­¥éª¤ï¼ŒåŸºæœ¬çš„ ARM Linux æ ¹æ–‡ä»¶ç³»ç»Ÿå·²æ­å»ºå®Œæˆï¼Œå°½ç®¡è¿˜æœ‰æ›´å¤šä¼˜åŒ–å’Œè°ƒæ•´çš„ç©ºé—´ï¼Œä½†å·²å…·å¤‡äº†åŸºæœ¬çš„åŠŸèƒ½å’Œç»“æ„ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿","ç³»ç»Ÿç§»æ¤"]},{"title":"ç§»æ¤æ­¥éª¤","path":"/2024/09/25/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-ç³»ç»Ÿç§»æ¤-ç§»æ¤æ­¥éª¤/","content":"åµŒå…¥å¼ Linux ç³»ç»Ÿç§»æ¤çš„å››å¤§æ­¥éª¤åœ¨å­¦ä¹ åµŒå…¥å¼ Linux ç³»ç»Ÿç§»æ¤æ—¶ï¼Œäº†è§£æ¯ä¸ªæ­¥éª¤çš„ç›®çš„å’Œè¿‡ç¨‹è‡³å…³é‡è¦ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å‘ç°äº†ä¸€äº›å¸¸è§é—®é¢˜ï¼Œå¹¶åŠªåŠ›æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚ä½†å¯¹äºå¼€å‘ç»“æœï¼Œå¸¸å¸¸ä¼šæ„Ÿåˆ°ä¸è§£ã€‚ç»è¿‡æ€è€ƒï¼Œæ„è¯†åˆ°å¯¹å¼€å‘ç¯å¢ƒçš„é€å½»ç†è§£æ˜¯éå¸¸å¿…è¦çš„ã€‚æœ‰æ—¶ä¸€ä¸ªç®€å•çš„å‘½ä»¤å¯ä»¥å®ç°å¤æ‚çš„åŠŸèƒ½ï¼Œä½†å¦‚æœæ²¡æœ‰æ·±å…¥æ€è€ƒè¿™äº›å‘½ä»¤çš„å·¥ä½œåŸç†ï¼Œä»¬å¯èƒ½åªæ˜¯æœºæ¢°åœ°å®Œæˆä»»åŠ¡ï¼Œè€Œæ— æ³•çœŸæ­£æŒæ¡ç³»ç»Ÿç§»æ¤çš„ç²¾é«“ã€‚ åœ¨è¿›è¡Œæ¯ä¸€æ­¥æ—¶ï¼Œåº”è¯¥å…ˆé—®è‡ªå·±ï¼šä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿæ­£åœ¨åšä»€ä¹ˆï¼Ÿä¸€æ—¦æ¾„æ¸…äº†è¿™äº›é—®é¢˜ï¼Œæ— è®ºä¹‹åé¢ä¸´ä½•ç§å¹³å°ã€èŠ¯ç‰‡æˆ–å¼€å‘ç¯å¢ƒï¼Œéƒ½èƒ½å¤Ÿè¿…é€Ÿä¸Šæ‰‹ã€‚çš„å­¦ä¹ æ–¹æ³•æ˜¯ï¼šä»å®è§‚ä¸ŠæŠŠæ¡ï¼ˆè§£å†³â€ä¸ºä»€ä¹ˆâ€çš„é—®é¢˜ï¼‰ï¼Œå†å¾®è§‚ä¸Šç ”ç©¶ï¼ˆè§£å†³â€æ­£åœ¨åšä»€ä¹ˆâ€çš„é—®é¢˜ï¼‰ã€‚ä»¥å­¦ä¹ çš„ ARM Cortex-A8 å¼€å‘æ¿ä¸ºä¾‹ï¼Œä¸‹é¢å°†è¯¦ç»†ä»‹ç»åµŒå…¥å¼ Linux ç³»ç»Ÿç§»æ¤çš„å››å¤§éƒ¨åˆ†ã€‚ æ­å»ºäº¤å‰å¼€å‘ç¯å¢ƒæ­å»ºäº¤å‰å¼€å‘ç¯å¢ƒæ˜¯ç§»æ¤çš„ç¬¬ä¸€æ­¥ã€‚ä¸ºäº†ç†è§£è¿™ä¸€éƒ¨åˆ†ï¼Œä»¬éœ€è¦é¦–å…ˆæ€è€ƒä¸¤ä¸ªé—®é¢˜ï¼šä»€ä¹ˆæ˜¯äº¤å‰å¼€å‘ç¯å¢ƒï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ ä»€ä¹ˆæ˜¯äº¤å‰å¼€å‘ç¯å¢ƒï¼Ÿåœ¨åµŒå…¥å¼å¼€å‘ä¸­ï¼Œäº¤å‰å¼€å‘æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚äº¤å‰å¼€å‘ç¯å¢ƒæŒ‡çš„æ˜¯åœ¨å¼€å‘ä¸»æœºï¼ˆé€šå¸¸æ˜¯ä¸ªäººç”µè„‘ï¼‰ä¸Šç¼–å†™çš„ç¨‹åºèƒ½å¤Ÿåœ¨ç›®æ ‡æœºï¼ˆé€šå¸¸æ˜¯å¼€å‘æ¿ï¼‰ä¸Šè¿è¡Œã€‚åµŒå…¥å¼ç³»ç»Ÿå¾€å¾€å› ä¸ºå…¶ç¡¬ä»¶é™åˆ¶ï¼Œæ— æ³•åœ¨è‡ªå·±èº«ä¸Šç›´æ¥è¿›è¡Œå¼€å‘ã€‚ä¾‹å¦‚ï¼Œå¤§å¤šæ•°å¼€å‘æ¿åœ¨åˆå§‹çŠ¶æ€ä¸‹æ— æ³•è¿è¡Œä»»ä½•ç¨‹åºï¼Œå› æ­¤ä»¬éœ€è¦åœ¨ PC ä¸Šè¿›è¡Œç¼–è¯‘ã€æ„å»ºï¼Œå¹¶ä¸”å°†çƒ§å½•åˆ°å¼€å‘æ¿ä¸­ã€‚ ä¸ºä»€ä¹ˆéœ€è¦äº¤å‰å¼€å‘ç¯å¢ƒï¼Ÿ ç¡¬ä»¶é™åˆ¶ï¼šåµŒå…¥å¼è®¾å¤‡çš„å¤„ç†é€Ÿåº¦å’Œå†…å­˜æœ‰é™ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨å‡ ç™¾ MHz ä¸»é¢‘çš„å¾®æ§åˆ¶å™¨å»ç¼–è¯‘ Linux å†…æ ¸ï¼Œç»“æœä¼šè®©äººåç­‰å¾—ä¸è€çƒ¦ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œä¸ªäººç”µè„‘é€šå¸¸æ‹¥æœ‰æ›´å¿«çš„å¤„ç†å™¨å’Œæ›´ä¸°å¯Œçš„å†…å­˜èµ„æºï¼Œè¿™è®©åœ¨è¿™æ ·çš„ä¸Šè¿›è¡Œå¼€å‘å˜å¾—æ›´ä¸ºé«˜æ•ˆã€‚ ä½“ç³»ç»“æ„å’ŒæŒ‡ä»¤é›†å·®å¼‚ï¼šå„ä¸ªåµŒå…¥å¼ç³»ç»Ÿçš„ MCUï¼ˆå¾®æ§åˆ¶å•å…ƒï¼‰å¾€å¾€æœ‰ä¸åŒçš„ä½“ç³»ç»“æ„å’ŒæŒ‡ä»¤é›†ã€‚å› æ­¤ï¼Œä»¬å¿…é¡»ä½¿ç”¨äº¤å‰ç¼–è¯‘å™¨æ¥ç”Ÿæˆå¯åœ¨ç›®æ ‡å¹³å°ï¼ˆå¦‚ ARMã€MIPSã€PowerPC ç­‰ï¼‰ä¸Šæ­£å¸¸è¿è¡Œçš„ç¨‹åºã€‚ ç¡¬ä»¶ç»„æˆäº¤å‰å¼€å‘ç¯å¢ƒä¸»è¦ç”±ä»¥ä¸‹ç»„æˆéƒ¨åˆ†ï¼š å¼€å‘ä¸»æœºï¼šé€šå¸¸æ˜¯ä»¬å¸¸ç”¨çš„ä¸ªäººç”µè„‘ã€‚ ç›®æ ‡æœºï¼ˆå¼€å‘æ¿ï¼‰ï¼šä»¬è¦ç§»æ¤ç³»ç»Ÿçš„è®¾å¤‡ã€‚ è¿æ¥ä»‹è´¨ï¼šå¸¸ç”¨çš„è¿æ¥æ–¹å¼åŒ…æ‹¬ï¼š ä¸²å£çº¿ USB çº¿ ç½‘ç»œçº¿ é’ˆå¯¹ä»¥ä¸Šç¡¬ä»¶éƒ¨åˆ†ï¼Œä»¬è¿˜å¿…é¡»å…·å¤‡ç›¸åº”çš„è½¯ä»¶æ”¯æŒï¼š ä¸²å£è°ƒè¯•åŠ©æ‰‹ï¼šé€šå¸¸ä¼šç”¨åˆ° Putty ç­‰å·¥å…·æ¥è¿›è¡Œä¸²å£é€šä¿¡ã€‚ USB é©±åŠ¨ï¼šä¾‹å¦‚ä¸‰æ˜ŸèŠ¯ç‰‡çš„ USB ä¸‹è½½å¯ä»¥ç”¨ DNW è½¯ä»¶å®Œæˆã€‚ ç½‘ç»œåè®®æ”¯æŒï¼š TFTP æœåŠ¡ï¼šç”¨äºå®ç°æ–‡ä»¶ä¸‹è½½ï¼Œå¯å°†éœ€è¦æµ‹è¯•çš„ bootloaderã€kernel å’Œæ–‡ä»¶ç³»ç»Ÿç›´æ¥ä¸‹è½½åˆ°å†…å­˜è¿è¡Œï¼Œè€Œä¸éœ€è¦æå‰çƒ§å½•åˆ° Flash ä¸­ã€‚è¿™ç§æ–¹å¼å¯¹äºé¢‘ç¹çš„æµ‹è¯•éå¸¸æœ‰ç”¨ï¼Œå› ä¸º Flash çš„æ“¦å†™æ¬¡æ•°æœ‰é™ã€‚ NFS æœåŠ¡ï¼šç”¨äºå®ç°ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ï¼Œæ–¹ä¾¿åœ¨å¼€å‘æ¿å’Œå¼€å‘ä¸»æœºä¹‹é—´å…±äº«æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯åœ¨åˆ¶ä½œæ–‡ä»¶ç³»ç»Ÿæµ‹è¯•æ—¶ï¼Œå¯ä»¥ç›´æ¥æŒ‚è½½ï¼Œè€Œä¸å¿…çƒ§å½•åˆ° Flash ä¸­ã€‚ è¿˜æœ‰ä¸€ä¸ªåä¸ºSambaçš„æœåŠ¡ä¹Ÿå€¼å¾—å…³æ³¨ï¼Œå®ƒå®ç°çš„æ˜¯ Windows ä¸»æœºå’Œ Linux è™šæ‹Ÿæœºä¹‹é—´çš„æ–‡ä»¶å…±äº«ï¼Œä¾¿äºè¿›è¡Œä¸åŒå¹³å°ä¹‹é—´çš„æ–‡ä»¶ä¼ è¾“ã€‚ é€šè¿‡ä¸Šè¿°å·¥å…·ï¼ŒåµŒå…¥å¼å¼€å‘çš„æ•ˆç‡å¾—åˆ°äº†æå¤§çš„æå‡ã€‚æ‰€æœ‰çš„å·¥ä½œè¿‡ç¨‹éƒ½æ˜¯å›´ç»•ç€æµ‹è¯•è¿›è¡Œçš„ã€‚æµ‹è¯•å®Œæˆåï¼Œä»¬æ‰ä¼šå°†ç›¸åº”çš„ç›®æ ‡æ–‡ä»¶çƒ§å½•åˆ° Flash ä¸­ã€‚ ä½¿ç”¨äº¤å‰ç¼–è¯‘å™¨çš„å¿…è¦æ€§åœ¨æ­å»ºå®Œäº¤å‰å¼€å‘ç¯å¢ƒåï¼Œå…³é”®çš„ä¸€æ­¥æ˜¯é€‰æ‹©äº¤å‰ç¼–è¯‘å™¨ã€‚äº¤å‰ç¼–è¯‘å™¨æ˜¯ä¸€ä¸ªèƒ½å¤Ÿåœ¨ä¸€ä¸ªå¹³å°ï¼ˆå¦‚ X86 æ¶æ„çš„ PCï¼‰ä¸Šç”Ÿæˆé€‚åˆå¦ä¸€ç§å¹³å°ï¼ˆå¦‚ ARM æ¶æ„çš„å¼€å‘æ¿ï¼‰ä¸Šè¿è¡Œçš„ç¨‹åºã€‚é€šå¸¸æ‰€ç§°çš„æœ¬åœ°ç¼–è¯‘åœ¨å½“å‰å¹³å°ä¸Šè¿›è¡Œï¼Œå› æ­¤ç¼–è¯‘å¾—åˆ°çš„ç¨‹åºè‡ªç„¶ä¹Ÿåªèƒ½åœ¨æœ¬åœ°æ‰§è¡Œã€‚ä¸ºäº†ç¡®ä¿åœ¨ç›®æ ‡æœºä¸Šè¿è¡Œçš„ç¨‹åºå¯ä»¥æ­£ç¡®ç”Ÿæˆï¼Œä»¬å¿…é¡»ä½¿ç”¨äº¤å‰ç¼–è¯‘å·¥å…·é“¾ã€‚ äº¤å‰ç¼–è¯‘å·¥å…·ä¸ä»…ä»…æ˜¯ç¼–è¯‘å™¨ï¼Œå®ƒåŒ…æ‹¬ç¼–è¯‘å™¨ã€é“¾æ¥å™¨å’Œè°ƒè¯•å™¨ç­‰ç»„æˆéƒ¨åˆ†ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„å¼€å‘ç¯å¢ƒã€‚å®ƒçš„æ ¸å¿ƒé€»è¾‘ç±»ä¼¼äºæ„å»ºåµŒå…¥å¼ Linux å†…æ ¸ï¼Œå…³æ³¨äºä»¬æ‰€éœ€çš„ç»„ä»¶ï¼Œå»æ‰ä¸éœ€è¦çš„éƒ¨åˆ†ã€‚ æ„å»ºäº¤å‰ç¼–è¯‘å·¥å…·é“¾çš„æ–¹æ³•æ„å»ºäº¤å‰å·¥å…·é“¾æœ‰ä¸‰ç§ä¸»è¦æ–¹æ³•ï¼š åˆ†æ­¥ç¼–è¯‘å’Œå®‰è£…ï¼šè¿™æ˜¯æœ€ä¼ ç»Ÿå’Œå›°éš¾çš„æ–¹æ³•ï¼Œé€‚åˆå¸Œæœ›æ·±å…¥å­¦ä¹ äº¤å‰å·¥å…·é“¾æ„å»ºçš„è¯»è€…ã€‚ ä½¿ç”¨ Crosstool-ng è„šæœ¬å·¥å…·ï¼šè¿™æ˜¯è¾ƒä¸ºç®€ä¾¿ä¸”æ˜“äºå®ç°çš„æ–¹æ³•ï¼Œæ›´é€‚åˆå¤§å¤šæ•°å¼€å‘è€…ã€‚ ä¸‹è½½ç°æˆçš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼šè™½ç„¶è¿™ç§æ–¹æ³•ç®€å•çœäº‹ï¼Œä½†å¾€å¾€å› å›ºå®šæ€§å’Œä¸çµæ´»ï¼Œå¯èƒ½å¼•å‘å„ç§æ„å¤–é”™è¯¯ã€‚ Crosstool-ng æ˜¯ä¸€ä¸ªæµè¡Œçš„è„šæœ¬å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä»¬åˆ›å»ºé€‚åˆä¸åŒå¹³å°çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾ã€‚åœ¨ä½¿ç”¨ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿ç¯å¢ƒä¸­å®‰è£…äº†ä¸€äº›ä¾èµ–è½¯ä»¶ï¼Œä¾‹å¦‚ï¼š $ sudo apt-get install g++ libncurses5-dev bison flex texinfo automake libtool patch gcj cvs cvsd gawk ä¸‹è½½ Crosstool-ng è„šæœ¬å·¥å…·åï¼Œè§£å‹å¹¶è¿›è¡Œé…ç½®ï¼Œä¸»è¦æµç¨‹åŒ…æ‹¬ï¼š è®¾å®šæºç åŒ…è·¯å¾„å’Œäº¤å‰ç¼–è¯‘å™¨çš„å®‰è£…è·¯å¾„ã€‚ ä¿®æ”¹äº¤å‰ç¼–è¯‘å™¨é’ˆå¯¹çš„æ¶æ„ã€‚ å¢åŠ å¹¶è¡Œç¼–è¯‘çš„è¿›ç¨‹æ•°ï¼Œä»¥æé«˜ç¼–è¯‘æ•ˆç‡ã€‚ å…³é—­ JAVA ç¼–è¯‘å™¨ï¼Œå‡å°‘ç¼–è¯‘æ—¶é—´ã€‚ å¼€å§‹ç¼–è¯‘ã€‚ æ·»åŠ ç¯å¢ƒå˜é‡å¹¶åˆ·æ–°ã€‚ æµ‹è¯•äº¤å‰å·¥å…·é“¾çš„æœ‰æ•ˆæ€§ã€‚ åˆ°è¿™é‡Œï¼ŒåµŒå…¥å¼ Linux ç³»ç»Ÿç§»æ¤çš„ç¬¬ä¸€éƒ¨åˆ†å·¥ä½œä¾¿å·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥å¯ä»¥è¿›è¡Œç”µæºé€‰æ‹©ã€bootloaderã€å†…æ ¸ç­‰å…¶ä»–æ­¥éª¤çš„å¼€å‘ã€‚ Bootloader çš„é€‰æ‹©å’Œç§»æ¤Boot Loader æ¦‚å¿µBootloader æ˜¯åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸è¿è¡Œä¹‹å‰çš„ä¸€æ®µå°ç¨‹åºã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯åˆå§‹åŒ–ç¡¬ä»¶è®¾å¤‡ã€å»ºç«‹å†…å­˜ç©ºé—´çš„æ˜ å°„å…³ç³»ï¼Œä»è€Œå°†ç³»ç»Ÿçš„è½¯ç¡¬ä»¶ç¯å¢ƒè°ƒæ•´åˆ°ä¸€ä¸ªåˆé€‚çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸ºæœ€ç»ˆè°ƒåŠ¨æ“ä½œç³»ç»Ÿå†…æ ¸å‡†å¤‡å¥½æ­£ç¡®çš„æ‰§è¡Œç¯å¢ƒã€‚å› æ­¤ï¼ŒBootloader è¢«ç§°ä¸ºå¼•å¯¼åŠ è½½ç¨‹åºï¼ˆBoot Loaderï¼‰ã€‚ ä¸ºä»€ä¹ˆç³»ç»Ÿç§»æ¤ä¹‹å‰è¦å…ˆç§»æ¤ Boot Loaderï¼ŸBootloader çš„ä»»åŠ¡æ˜¯å¼•å¯¼æ“ä½œç³»ç»Ÿï¼Œå…·ä½“æ¥è¯´ï¼Œå°±æ˜¯å°†å†…æ ¸åŠ è½½åˆ°å†…å­˜ï¼ˆRAMï¼‰ä¸­è¿è¡Œã€‚é‚£ä¹ˆé¦–å…ˆè¦æ˜ç¡®ä¸¤ä¸ªé—®é¢˜ï¼šè°è´Ÿè´£æŠŠå†…æ ¸æ¬åˆ°å†…å­˜ä¸­ï¼Ÿå†…å­˜æ˜¯ SDRAMï¼Œå’Œ SRAM æœ‰å“ªäº›ä¸åŒï¼ŸSRAM ä¸€ä¸Šç”µå°±èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œä½† SDRAM åˆ™éœ€è¦é€šè¿‡è½¯ä»¶åˆå§‹åŒ–ã€‚ç”±æ­¤ï¼Œ Bootloader é¦–å…ˆè¦åˆå§‹åŒ– SDRAMï¼Œç„¶åæ‰èƒ½å°†å†…æ ¸åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å› æ­¤ï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼šæ²¡æœ‰ Bootloaderï¼Œä»¬çš„ç³»ç»Ÿæ— æ³•å¯åŠ¨ã€‚ Bootloader çš„åˆ†ç±»é¦–å…ˆçº æ­£ä¸€ä¸ªå¸¸è§è¯¯è§£ï¼šBootloader å¹¶ä¸ç­‰åŒäº U-Bootï¼ŒU-Boot åªæ˜¯ Bootloader çš„ä¸€ç§ã€‚Bootloader æ‹¥æœ‰å¤šç§ä¸åŒçš„å®ç°å’Œç±»å‹ï¼Œä¸åŒç±»å‹çš„ Bootloader å„æœ‰å…¶ç‰¹å®šçš„ä½¿ç”¨èŒƒå›´ã€‚å…¶ä¸­æœ€å—å…³æ³¨çš„å°±æ˜¯ U-Bootï¼Œè¿™æ˜¯ä¸€æ¬¾é€šç”¨çš„å¼•å¯¼ç¨‹åºï¼Œæ”¯æŒå¤šç§å¤„ç†å™¨æ¶æ„ï¼ŒåŒ…æ‹¬ X86ã€ARM å’Œ PowerPC ç­‰ã€‚U-Bootï¼Œå…¨ç§° Universal Boot Loaderï¼Œéµå¾ª GPL æ¡æ¬¾ï¼Œæ˜¯ç”±å¾·å›½ DENX å›¢é˜Ÿå¼€å‘çš„å¼€æºé¡¹ç›®ã€‚å®ƒä¸ºå¤šç§åµŒå…¥å¼ CPU æä¾›æ”¯æŒï¼Œå¹¶å¯¹ Linux çš„å‘å±•åšå‡ºäº†é‡å¤§è´¡çŒ®ã€‚ U-Boot å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š å¼€æ”¾æºç ï¼šå¼€å‘è€…å¯ä»¥è‡ªç”±ä½¿ç”¨å’Œä¿®æ”¹æºä»£ç ã€‚ å¤šæ“ä½œç³»ç»Ÿæ”¯æŒï¼šæ”¯æŒå¤šç§åµŒå…¥å¼æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œå¦‚ Linuxã€NetBSDã€VxWorksã€QNXã€RTEMSã€ARTOS å’Œ LynxOSã€‚ å¤šå¤„ç†å™¨æ¶æ„å…¼å®¹æ€§ï¼šæœ¬èº«è®¾è®¡æˆå¯ä»¥æ”¯æŒ PowerPCã€ARMã€x86ã€MIPS å’Œ XScale ç­‰å¤šç§å¤„ç†å™¨ç³»åˆ—ã€‚ é«˜å¯é æ€§å’Œç¨³å®šæ€§ï¼šåœ¨å„ç±»è®¾å¤‡ä¸­çš„åº”ç”¨è¡¨ç°ç¨³å®šã€‚ çµæ´»æ€§ï¼šå…·æœ‰é«˜åº¦å¯é…ç½®çš„åŠŸèƒ½è®¾ç½®ï¼Œé€‚åˆè°ƒè¯•ã€ä¸åŒæ“ä½œç³»ç»Ÿçš„å¼•å¯¼éœ€æ±‚ï¼Œä»¥åŠäº§å“å‘å¸ƒã€‚ ä¸°å¯Œçš„è®¾å¤‡é©±åŠ¨ï¼šåŒ…æ‹¬ä¸²å£ã€ä»¥å¤ªç½‘ã€SDRAMã€FLASHã€LCDã€NVRAMã€EEPROMã€RTCã€é”®ç›˜ç­‰å¤šä¸ªå¤–è®¾é©±åŠ¨ã€‚ è¯¦å°½çš„å¼€å‘æ–‡æ¡£ï¼Œä»¥åŠå¼ºå¤§çš„ç½‘ç»œæŠ€æœ¯æ”¯æŒã€‚ ä»æŸç§ç¨‹åº¦ä¸Šè¯´ï¼Œå¯ä»¥æŠŠ U-Boot ç†è§£ä¸ºä¸€ä¸ªè½»é‡çº§çš„æ“ä½œç³»ç»Ÿã€‚ U-Boot çš„ç›®å½•ç»“æ„U-Boot çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š boardï¼šå­˜æ”¾ç›®æ ‡æ¿ç›¸å…³æ–‡ä»¶ï¼Œä¸»è¦åŒ…å« SDRAM å’Œ FLASH é©±åŠ¨ã€‚ commonï¼šåŒ…å«ç‹¬ç«‹äºå¤„ç†å™¨çš„é€šç”¨ä»£ç ï¼Œä¾‹å¦‚å†…å­˜å¤§å°æ¢æµ‹ä¸æ•…éšœæ£€æµ‹ã€‚ cpuï¼šä¸å¤„ç†å™¨ç›¸å…³çš„æ–‡ä»¶ï¼Œä¾‹å¦‚æŸå¤„ç†å™¨çš„ä¸²å£ã€ç½‘ç»œã€LCD é©±åŠ¨åŠä¸­æ–­åˆå§‹åŒ–ç­‰ã€‚ driverï¼šé€šç”¨è®¾å¤‡é©±åŠ¨ï¼Œæ¯”å¦‚ CFI FLASH é©±åŠ¨ï¼Œç›®å‰å¯¹ Intel FLASH æ”¯æŒç›¸å¯¹è¾ƒå¥½ã€‚ docï¼šU-Boot çš„è¯´æ˜æ–‡æ¡£ã€‚ examplesï¼šå¯åœ¨ U-Boot ä¸‹è¿è¡Œçš„ç¤ºä¾‹ç¨‹åºï¼Œå¦‚ hello_world.c å’Œ timer.cã€‚ includeï¼šU-Boot çš„å¤´æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯ configs å­ç›®å½•ä¸­ä¸ç›®æ ‡æ¿ç›¸å…³çš„é…ç½®å¤´æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶åœ¨ç§»æ¤è¿‡ç¨‹ä¸­ç»å¸¸éœ€è¦ä¿®æ”¹ã€‚ lib_xxxï¼šä¸å¤„ç†å™¨ä½“ç³»ç»“æ„ç›¸å…³çš„æ–‡ä»¶åº“ï¼Œä¾‹å¦‚ lib_ppc å’Œ lib_armï¼Œåˆ†åˆ«åŒ…å« PowerPC å’Œ ARM ç›¸å…³çš„ä»£ç ã€‚ netï¼šä¸ç½‘ç»œåŠŸèƒ½ç›¸å…³çš„æ–‡ä»¶ç›®å½•ï¼ŒåŒ…æ‹¬ bootpã€nfs å’Œ tftp ç­‰ã€‚ postï¼šä¸Šç”µè‡ªæ£€ç›¸å…³æ–‡ä»¶ç›®å½•ï¼Œå°šåœ¨å®Œå–„ä¸­ã€‚ rtcï¼šRTC é©±åŠ¨ç¨‹åºã€‚ toolsï¼šç”¨äºåˆ›å»º U-Boot S-RECORD å’Œ BIN é•œåƒæ–‡ä»¶çš„å·¥å…·ã€‚ U-Boot çš„å·¥ä½œæ¨¡å¼U-Boot çš„å·¥ä½œæ¨¡å¼ä¸»è¦åˆ†ä¸ºå¯åŠ¨åŠ è½½æ¨¡å¼å’Œä¸‹è½½æ¨¡å¼ã€‚åœ¨å¯åŠ¨åŠ è½½æ¨¡å¼ä¸‹ï¼ŒBootloader æ˜¯é»˜è®¤çš„å·¥ä½œæ¨¡å¼ï¼Œé€šå¸¸åœ¨åµŒå…¥å¼äº§å“å‘å¸ƒæ—¶ä½¿ç”¨ã€‚åœ¨è¿™ä¸€æ¨¡å¼ä¸‹ï¼ŒBootloader å°†åµŒå…¥å¼æ“ä½œç³»ç»Ÿè‡ªåŠ¨ä» FLASH åŠ è½½åˆ° SDRAM ä¸­è¿è¡Œã€‚ è€Œä¸‹è½½æ¨¡å¼åˆ™æ˜¯é€šè¿‡æŸäº›é€šä¿¡æ‰‹æ®µå°†å†…æ ¸æ˜ åƒã€æ ¹æ–‡ä»¶ç³»ç»Ÿæ˜ åƒç­‰ä» PC æœºä¸‹è½½åˆ°ç›®æ ‡æ¿çš„ SDRAM ä¸­ã€‚åœ¨è¿™ä¸€æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·å¯åˆ©ç”¨ Bootloader æä¾›çš„å‘½ä»¤æ¥å£å®Œæˆæ‰€éœ€æ“ä½œï¼Œä¸»è¦ç”¨äºå¼€å‘å’Œæµ‹è¯•ã€‚ U-Boot çš„å¯åŠ¨è¿‡ç¨‹å¤§å¤šæ•° Bootloader éƒ½è¢«åˆ’åˆ†ä¸ºé˜¶æ®µ 1ï¼ˆstage1ï¼‰å’Œé˜¶æ®µ 2ï¼ˆstage2ï¼‰ï¼ŒU-Boot ä¹Ÿä¸ä¾‹å¤–ã€‚é€šå¸¸ï¼Œä¾èµ–äº CPU ä½“ç³»ç»“æ„çš„åŸºç¡€ä»£ç ï¼ˆå¦‚è®¾å¤‡åˆå§‹åŒ–ä»£ç ï¼‰æ”¾åœ¨é˜¶æ®µ 1ï¼Œå¹¶ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™ï¼Œè€Œé˜¶æ®µ 2 åˆ™ç”¨ C è¯­è¨€å®ç°ï¼Œä»¥ä¾¿å®ç°æ›´å¤æ‚çš„åŠŸèƒ½å’Œæ›´å¥½çš„å¯è¯»æ€§ä¸ç§»æ¤æ€§ã€‚ Stage1ï¼ˆstart.s ä»£ç ç»“æ„ï¼‰U-Boot çš„ stage1 ä»£ç é€šå¸¸ç”¨æ±‡ç¼–è¯­è¨€å­˜æ”¾åœ¨ start.s æ–‡ä»¶ä¸­ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š å…¥å£å®šä¹‰ï¼šä¸€ä¸ªå¯æ‰§è¡Œçš„æ˜ åƒå¿…é¡»æœ‰ä¸€ä¸ªå…¥å£ç‚¹ï¼Œé€šå¸¸æ”¾ç½®åœ¨ ROMï¼ˆFlashï¼‰çš„ 0x0 åœ°å€ã€‚ è®¾ç½®å¼‚å¸¸å‘é‡ã€‚ è®¾ç½® CPU çš„é€Ÿåº¦ã€æ—¶é’Ÿé¢‘ç‡å’Œä¸­æ–­æ§åˆ¶å¯„å­˜å™¨ã€‚ åˆå§‹åŒ–å†…å­˜æ§åˆ¶å™¨ã€‚ å°† ROM ä¸­çš„ç¨‹åºå¤åˆ¶åˆ° RAM ä¸­ã€‚ åˆå§‹åŒ–å †æ ˆã€‚ è·³è½¬åˆ° RAM ä¸­æ‰§è¡Œï¼Œé€šå¸¸é€šè¿‡æŒ‡ä»¤ ldrpc å®ç°ã€‚ Stage2ï¼ˆC è¯­è¨€ä»£ç éƒ¨åˆ†ï¼‰åœ¨æ–‡ä»¶ lib_arm/board.c ä¸­ï¼Œstart_armboot æ˜¯ C è¯­è¨€å®ç°çš„å‡½æ•°ï¼Œä¹Ÿæ˜¯æ•´ä¸ªå¯åŠ¨ä»£ç ä¸­çš„ä¸»å‡½æ•°ã€‚å®ƒä¸»è¦å®Œæˆä»¥ä¸‹æ“ä½œï¼š è°ƒç”¨ä¸€ç³»åˆ—çš„åˆå§‹åŒ–å‡½æ•°ã€‚ åˆå§‹åŒ– FLASH è®¾å¤‡ã€‚ åˆå§‹åŒ–ç³»ç»Ÿå†…å­˜åˆ†é…å‡½æ•°ã€‚ å¦‚æœç›®æ ‡ç³»ç»ŸåŒ…å« NAND è®¾å¤‡ï¼Œåˆ™åˆå§‹åŒ–ç›¸åº”è®¾å¤‡ã€‚ å¦‚æœæœ‰æ˜¾ç¤ºè®¾å¤‡ï¼Œåˆ™è¿›è¡Œåˆå§‹åŒ–ã€‚ åˆå§‹åŒ–ç›¸å…³çš„ç½‘ç»œè®¾å¤‡ï¼Œå¡«å†™ IP åœ°å€ç­‰ä¿¡æ¯ã€‚ è¿›å…¥å‘½ä»¤å¾ªç¯ï¼Œæ¥å—ç”¨æˆ·é€šè¿‡ä¸²å£è¾“å…¥çš„å‘½ä»¤ï¼Œè¿›è¡Œç›¸åº”çš„æ“ä½œã€‚ åŸºäº Cortex-A8 çš„ S5PC100 Bootloader å¯åŠ¨è¿‡ç¨‹åˆ†æS5PC100 æ”¯æŒä¸¤ç§å¯åŠ¨æ–¹å¼ï¼šUSB å¯åŠ¨æ–¹å¼å’Œ NAND Flash å¯åŠ¨æ–¹å¼ã€‚ S5PC100 USB å¯åŠ¨è¿‡ç¨‹ æ‰§è¡Œ A8 resetï¼Œè¿è¡Œ iROM ä¸­çš„ç¨‹åºã€‚ iROM ç¨‹åºæ ¹æ® S5PC100 çš„é…ç½®ç®¡è„šï¼ˆSW1 å¼€å…³ 4ï¼Œæ‹¨åˆ° 4 å¯¹é¢ï¼‰ï¼Œåˆ¤æ–­å¯åŠ¨æ¥æºï¼ˆUSBï¼‰ã€‚ iROM ç¨‹åºåˆå§‹åŒ– USBï¼Œç­‰å¾… PC æœºä¸‹è½½ç¨‹åºã€‚ åˆ©ç”¨ DNW å·¥å…·ï¼Œä» PC ä¸‹è½½ SDRAM çš„åˆå§‹åŒ–ç¨‹åºåˆ° iRAM ä¸­è¿è¡Œï¼Œåˆå§‹åŒ– SDRAMã€‚ SDRAM åˆå§‹åŒ–å®Œæ¯•åï¼ŒiROM ç¨‹åºæ¥ç®¡ A8ï¼Œå¹¶ç­‰å¾… PC ä¸‹è½½ Bootloaderã€‚ PC åˆ©ç”¨ DNW ä¸‹è½½ Bootloader åˆ° SDRAM ä¸­ã€‚ åœ¨ SDRAM ä¸­è¿è¡Œ Bootloaderã€‚ S5PC100 NAND Flash å¯åŠ¨è¿‡ç¨‹ æ‰§è¡Œ A8 resetï¼Œè¿è¡Œ IROM ä¸­çš„ç¨‹åºã€‚ iROM ç¨‹åºæ ¹æ® S5PC100 çš„é…ç½®ç®¡è„šåˆ¤æ–­å¯åŠ¨æ¥æºï¼ˆNAND Flashï¼‰ã€‚ iROM ç¨‹åºé©±åŠ¨ NAND Flashã€‚ iROM ç¨‹åºæ‹·è´ NAND Flash çš„å‰ 16KB åˆ° iRAM ä¸­ã€‚ å‰ 16KB ç¨‹åºï¼ˆBootloader çš„å‰åŠéƒ¨åˆ†ï¼‰åˆå§‹åŒ– SDRAMï¼Œç„¶åæ‹·è´å®Œæ•´çš„ Bootloader åˆ° SDRAM å¹¶è¿è¡Œã€‚ Bootloader æ‹·è´å†…æ ¸åˆ° SDRAM ä¸­ï¼Œå¹¶è¿è¡ŒåŠ¨æ€åŠ è½½çš„å†…æ ¸ã€‚ å†…æ ¸è¿è¡Œåï¼ŒæŒ‚è½½ rootfsï¼Œå¹¶è¿è¡Œç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬ã€‚ U-Boot ç§»æ¤ï¼ˆåŸºäº Cortex-A8 çš„ S5PC100 ä¸ºä¾‹ï¼‰ ä¸‹è½½ç¨³å®šç‰ˆæœ¬çš„æºç åŒ…ï¼Œå¦‚ 2010.03 ç‰ˆæœ¬ã€‚ è§£å‹åï¼Œæ·»åŠ è‡ªå·±å¹³å°çš„ä¿¡æ¯ï¼Œå‚è€ƒ SMDKC100 è¿›è¡Œ S5PC100 å¼€å‘æ¿çš„ç§»æ¤ã€‚ ä¿®æ”¹ç›¸åº”ç›®å½•çš„æ–‡ä»¶ååŠ Makefileï¼ŒæŒ‡å®šäº¤å‰å·¥å…·é“¾ã€‚ ç¼–è¯‘ã€‚ é’ˆå¯¹å¹³å°è¿›è¡Œç›¸åº”ç§»æ¤ï¼Œä¸»è¦åŒ…æ‹¬ä¿®æ”¹ SDRAM çš„è¿è¡Œåœ°å€ï¼ˆé€šå¸¸ä» 0x20000000 å¼€å§‹ï¼‰ã€‚ å¼€å…³ç›¸åº”çš„å®å®šä¹‰ã€‚ æ·»åŠ  NAND å’Œç½‘å¡çš„é©±åŠ¨ä»£ç ã€‚ ä¼˜åŒ– go å‘½ä»¤ã€‚ é‡æ–°ç¼–è¯‘ï¼Œæ‰§è¡Œ make distcleanï¼ˆå½»åº•åˆ é™¤ä¸­é—´æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ï¼‰ï¼Œç„¶åæ‰§è¡Œ make s5pc100_configï¼ˆé…ç½®å¼€å‘æ¿ï¼‰å’Œ makeï¼ˆç”Ÿæˆ u-boot.bin é•œåƒæ–‡ä»¶ï¼‰ã€‚ è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå³å¯åŠ¨å‚æ•°ï¼Œå¹¶å°†ç¼–è¯‘å¥½çš„ u-boot ä¸‹è½½åˆ°å†…å­˜ä¸­ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š é…ç½®å¼€å‘æ¿ç½‘ç»œ IP åœ°å€é…ç½®: setenv ipaddr 192.168.0.6 ä¿å­˜ç¯å¢ƒå˜é‡åˆ° NAND Flash çš„å‚æ•°åŒºï¼š saveenv ç½‘ç»œæµ‹è¯•ï¼š ping 192.168.0.157 # è™šæ‹Ÿæœºçš„ IP åœ°å€ å¦‚æœç½‘ç»œæµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š ç½‘ç»œçº¿æ˜¯å¦è¿æ¥è‰¯å¥½ã€‚ å¼€å‘æ¿å’Œè™šæ‹Ÿæœºçš„ IP åœ°å€æ˜¯å¦åœ¨åŒä¸€ç½‘ç»œæ®µã€‚ è™šæ‹Ÿæœºç½‘ç»œè®¾ç½®å¿…é¡»é€‰æ‹©æ¡¥æ¥ï¼ˆVM â†’ Setting â†’ optionï¼‰ã€‚ è¿æ¥å¼€å‘æ¿æ—¶ï¼Œè™šæ‹Ÿæœºéœ€è¦è®¾ç½®ä¸ºé™æ€ IP åœ°å€ã€‚ åœ¨å¼€å‘æ¿ä¸Šé…ç½® TFTP æœåŠ¡å™¨ï¼ˆè™šæ‹Ÿæœºï¼‰çš„ IP åœ°å€ï¼š setenv serverip 192.168.0.157 # è™šæ‹Ÿæœºçš„ IP åœ°å€saveenv æ‹·è´ u-boot.bin åˆ° /tftpbootï¼ˆè™šæ‹Ÿæœºä¸Šçš„ç›®å½•ï¼‰ã€‚ é€šè¿‡ TFTP ä¸‹è½½ u-boot.bin åˆ°å¼€å‘æ¿å†…å­˜ï¼š tftp 20008000 u-boot.bin # ä¸‹è½½åˆ°æŒ‡å®šå†…å­˜åœ°å€ å¦‚æœä¸Šè¿°å‘½ä»¤æ— æ³•æ­£å¸¸ä¸‹è½½ï¼Œè¯·æ£€æŸ¥ï¼š serverip çš„é…ç½®æ˜¯å¦æ­£ç¡®ã€‚ TFTP æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼Œå¿…è¦æ—¶é‡å¯ TFTP æœåŠ¡ï¼š sudo service tftpd-hpa restart çƒ§å†™ u-boot.bin åˆ° NAND Flash çš„ 0 åœ°å€ï¼š nand erase 0 40000 # æ“¦é™¤ NAND Flash 0 - 256k çš„åŒºåŸŸnand write 20008000 0 40000 # çƒ§å†™å¤§å° åˆ‡æ¢å¼€å‘æ¿çš„å¯åŠ¨æ–¹å¼åˆ° NAND Flashï¼š å…³é—­å¼€å‘æ¿ã€‚ å°† SW1 å¼€å…³ 4 æ‹¨åˆ° 4 çš„é‚£è¾¹ã€‚ å¯åŠ¨å¼€å‘æ¿ï¼Œå®ƒå°†ä» NAND Flash å¯åŠ¨ã€‚ Kernel çš„é…ç½®ã€ç¼–è¯‘å’Œç§»æ¤Linux æºç é¦–å…ˆï¼Œå°†ä¸‹è½½ä¸‹æ¥çš„ linux-2.6.35.tar.bz2 æ–‡ä»¶ç§»åŠ¨æˆ–æ‹·è´åˆ°ä¸»ç›®å½•ä¸­ã€‚åœ¨ Linux ç¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®Œæˆè¿™ä¸€æ­¥éª¤ï¼š cp ~/Downloads/linux-2.6.35.tar.bz2 ~/ æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è§£å‹è¿™ä¸ªæ–‡ä»¶ï¼š tar -xvjf linux-2.6.35.tar.bz2 è§£å‹å®Œæˆåï¼Œä¼šåœ¨ä¸»ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ªåä¸º linux-2.6.35 çš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢åŒ…å«äº† Linux å†…æ ¸çš„æ‰€æœ‰æºä»£ç ã€‚ ä¿®æ”¹é¡¶å±‚ç›®å½•ä¸‹çš„ Makefileåœ¨è¿›å…¥ linux-2.6.35 çš„ç›®å½•åï¼Œä»¬éœ€è¦ä¿®æ”¹é¡¶å±‚ç›®å½•ä¸‹çš„ Makefileã€‚è¿™ä¸€æ­¥éª¤å¾ˆå…³é”®ï¼Œå› ä¸ºå®ƒå†³å®šäº†ä»¬è¦ç¼–è¯‘çš„å¹³å°æ¶æ„å’Œä½¿ç”¨çš„äº¤å‰ç¼–è¯‘å™¨ã€‚å¯ä»¥é€šè¿‡æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ Makefileï¼Œæ‰¾åˆ°å¦‚ä¸‹ä»£ç ï¼š ARCH ?= $(SUBARCH)CROSS_COMPILE ?=CROSS_COMPILE ?= $(CONFIG_CROSS_COMPILE:%=%) ä»¬è¦å°†è¿™äº›è¡Œä¿®æ”¹ä¸ºï¼š ARCH ?= arm # ä½“ç³»æ¶æ„æ˜¯ arm æ¶æ„CROSS_COMPILE ?= arm-cortex_a8-linux-gnueabi- # äº¤å‰ç¼–è¯‘å™¨æ˜¯ arm-cortex_a8 å¹³å°çš„ è¿™ä¸¤é¡¹è®¾ç½®éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒä»¬ä¼šç›´æ¥å½±å“åˆ° Makefile åœ¨ç¼–è¯‘æ—¶çš„è¡Œä¸ºã€‚ARCH å˜é‡å®šä¹‰äº†ç›®æ ‡ CPU çš„æ¶æ„ï¼Œè€Œ CROSS_COMPILE åˆ™æŒ‡æ˜äº†ä»¬å°†ä½¿ç”¨çš„äº¤å‰ç¼–è¯‘å™¨ï¼Œä»è€Œç¡®ä¿ç¼–è¯‘å‡ºçš„ä»£ç å¯ä»¥åœ¨ ARM çš„ Cortex-A8 å¹³å°ä¸Šè¿è¡Œã€‚ æ‹·è´æ ‡å‡†ç‰ˆé…ç½®æ–‡ä»¶æ¥ä¸‹æ¥ï¼Œä»¬éœ€è¦æ‹·è´ä¸€ä¸ªæ ‡å‡†ç‰ˆçš„é…ç½®æ–‡ä»¶ï¼Œä»¥ä¾¿è·å–ä¸ä»¬å¼€å‘æ¿ç›¸å…³çš„é…ç½®ä¿¡æ¯ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š cp arch/arm/configs/s5pc100_defconfig .config è¿™ä¸€å‘½ä»¤çš„ç›®çš„æ˜¯å°† s5pc100_defconfig æ–‡ä»¶å¤åˆ¶åˆ°é¡¶å±‚ç›®å½•ä¸‹ï¼Œå¹¶å‘½åä¸º .configã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå®ƒæä¾›äº†ä¸€ç§å¿«é€Ÿçš„æ–¹æ³•æ¥é€‰æ‹©ä¸ä»¬çš„å¼€å‘æ¿ç›¸å…³çš„ä»£ç ã€‚Linux æ”¯æŒçš„ç¡¬ä»¶å¹³å°éå¸¸åºå¤§ï¼Œä¸ä»…åŒ…æ‹¬ ARM æ¶æ„ï¼Œè¿˜åŒ…æ‹¬å¤šç§å…¶ä»–æ¶æ„ã€‚å› æ­¤ï¼Œåœ¨ç¼–è¯‘æ—¶ï¼Œä»¬åªå¸Œæœ›ä¸“æ³¨äºä¸ä»¬å…·ä½“å¼€å‘æ¿ç›¸å…³çš„ä»£ç ï¼Œè€Œä¸å¸Œæœ›æ— è°“åœ°ç¼–è¯‘ä¸ç›¸å…³çš„éƒ¨åˆ†ã€‚ è€ƒè™‘åˆ° Linux æºä»£ç çš„æ–‡ä»¶æ•°é‡è¶…è¿‡ä¸€ä¸‡ï¼Œä»¬éœ€è¦ç¡®ä¿é€‰æ‹©çš„é…ç½®æ–‡ä»¶èƒ½å¤Ÿæœ‰æ•ˆåœ°è¿‡æ»¤å‡ºæ‰€éœ€çš„ä»£ç ã€‚è¿™ä¸€è¿‡ç¨‹è®¾è®¡å¾—éå¸¸å·§å¦™ï¼Œå†…æ ¸å¼€å‘è€…æ—©å°±é¢„è§äº†è¿™ä¸ªéœ€æ±‚ï¼Œé’ˆå¯¹ä¸åŒçš„ç¡¬ä»¶å¹³å°è®¾å®šäº†å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œåªéœ€é€šè¿‡ç®€å•çš„æ–‡ä»¶å¤åˆ¶æ“ä½œï¼Œä»¬çš„ .config æ–‡ä»¶ä¾¿å¯è‡ªåŠ¨è®°å½•ä¸‹ä¸å¹³å°ç›¸å…³çš„ä¿¡æ¯ã€‚ å½“ä»¬é¦–æ¬¡æ‰§è¡Œ make menuconfig å‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è§£æ .config æ–‡ä»¶ä¸­çš„é…ç½®ï¼Œæ ¹æ®ä»¬ä¹‹å‰é€‰æ‹©çš„å¹³å°ä¿¡æ¯ï¼Œé€‰å–åˆé€‚çš„ä»£ç å’Œæ¨¡å—ã€‚æ­¤æ—¶ï¼Œä»¬åªéœ€è¦è¿›å…¥è¯¥é…ç½®ç•Œé¢ï¼Œåšä¸€äº›ç®€å•çš„ä¿®æ”¹ï¼Œæœ€åé€‰æ‹©ä¿å­˜å³å¯ã€‚è¿™æ ·ï¼Œç³»ç»Ÿä¼šå°†æ‰€æœ‰ä¸ä»¬ç›®æ ‡å¹³å°ç›¸å…³çš„ä¿¡æ¯ä¿å­˜åˆ°é¡¶å±‚ç›®å½•çš„ .config æ–‡ä»¶ä¸­ã€‚è¿™ç§æ“ä½œæ–¹å¼ä¸ä»…é«˜æ•ˆï¼Œè€Œä¸”å‡å°‘äº†äººä¸ºé”™è¯¯çš„å¯èƒ½ï¼Œä½¿å¾—å†…æ ¸çš„é…ç½®å’Œç¼–è¯‘å˜å¾—æ›´åŠ ç®€ä¾¿ã€‚ é…ç½®å†…æ ¸è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥è¿›å…¥é…ç½®ç•Œé¢ï¼š $ make menuconfig åœ¨ç¬¬ä¸€æ¬¡è¿›å…¥è¿™ä¸ªé…ç½®ç•Œé¢æ—¶ï¼Œæ— éœ€è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œç›´æ¥é€€å‡ºã€‚å½“ç³»ç»Ÿæç¤ºæ˜¯å¦ä¿å­˜é…ç½®ä¿¡æ¯æ—¶ï¼Œä¸€å®šè¦é€‰æ‹©â€YESâ€ã€‚é€šè¿‡æ­¤æ­¥éª¤ï¼Œä»¬å°†å¼€å‘å¹³å°çš„ä¿¡æ¯ä¿å­˜è‡³ .config æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶å¯¹äºåç»­çš„ç¼–è¯‘å’Œé…ç½®è‡³å…³é‡è¦ã€‚ make menuconfig çš„è¿‡ç¨‹åœ¨æ‰§è¡Œ make menuconfig æ—¶ï¼Œä»¬éœ€è¦ç†è§£ç³»ç»Ÿåˆ°åº•è¿›è¡Œäº†å“ªäº›æ“ä½œã€‚ç‰¹åˆ«åœ°ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°å›¾å½¢åŒ–çš„ç•Œé¢ï¼Ÿè€Œè¿™ä¸ªç•Œé¢ä¸­çš„å†…å®¹åˆæ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Ÿ å›¾å½¢åŒ–ç•Œé¢çš„å®ç°è¯¥å›¾å½¢åŒ–ç•Œé¢æ˜¯é€šè¿‡ä¸€ä¸ªåä¸º ncurses çš„å›¾å½¢åº“å®ç°çš„ã€‚å½“ä»¬é¦–æ¬¡æ‰§è¡Œ make menuconfig æ—¶ï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰å®‰è£… ncurses åº“ï¼Œä¼šå¯¼è‡´æŠ¥é”™å¹¶æ˜¾ç¤ºç¼ºå°‘ ncurses-devel çš„ä¿¡æ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…æ‰€éœ€çš„åº“ï¼š sudo apt-get install libncurses5-dev æœ‰äº† ncurses çš„æ”¯æŒï¼Œç³»ç»Ÿæ‰èƒ½æ­£å¸¸æ˜¾ç¤ºå›¾å½¢åŒ–ç•Œé¢ï¼Œè®©ç”¨æˆ·è¿›è¡Œé…ç½®ã€‚ å›¾å½¢ç•Œé¢å†…å®¹çš„æ¥æºåœ¨è§£å†³äº†å›¾å½¢ç•Œé¢é—®é¢˜åï¼Œä»¬å¿…é¡»æ˜ç¡®å›¾å½¢ç•Œé¢é‡Œçš„å†…å®¹æ˜¯å¦‚ä½•ç”Ÿæˆçš„ã€‚è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆä¸ Linux å†…æ ¸çš„è®¾è®¡ç†å¿µå¯†åˆ‡ç›¸å…³ã€‚Linux å†…æ ¸é‡‡ç”¨æ¨¡å—åŒ–çš„ç»„ç»‡æ–¹å¼ã€‚è¿™ç§è®¾è®¡ä½¿å¾—å†…æ ¸ä¸å†æ˜¯ä¸€ä¸ªåºå¤§çš„å•ä¸€å®ä½“ï¼Œè€Œæ˜¯ç”±å¤šä¸ªç‹¬ç«‹çš„æ¨¡å—ç»„æˆï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šçš„åŠŸèƒ½ã€‚ åœ¨ Linux 2.6 å†…æ ¸çš„æºç æ ‘ä¸­ï¼Œé€šå¸¸å¯ä»¥æ‰¾åˆ°ä¸¤ä¸ªé‡è¦çš„æ–‡ä»¶ï¼šKconfig å’Œ Makefileã€‚åˆ†å¸ƒåœ¨å„ä¸ªç›®å½•ä¸‹çš„å¤šä¸ª Kconfig æ–‡ä»¶å…±åŒæ„æˆäº†ä¸€ä¸ªåˆ†å¸ƒå¼çš„å†…æ ¸é…ç½®æ•°æ®åº“ã€‚æ¯ä¸ª Kconfig æè¿°äº†å…¶æ‰€åœ¨ç›®å½•ä¸‹æºæ–‡ä»¶ç›¸å…³çš„å†…æ ¸é…ç½®èœå•ã€‚è¿™æ„å‘³ç€æ¯ä¸ªç›®å½•éƒ½å¯å­˜æ”¾ä¸åŠŸèƒ½ç›¸å¯¹ç‹¬ç«‹çš„ä¿¡æ¯ã€‚ ä¾‹å¦‚ï¼Œåœ¨ /dev/char/ ç›®å½•ä¸‹ï¼Œå­˜æ”¾äº†æ‰€æœ‰å­—ç¬¦è®¾å¤‡çš„é©±åŠ¨ç¨‹åºã€‚è¿™äº›é©±åŠ¨ç¨‹åºçš„ä»£ç åœ¨å†…æ ¸ä¸­ä»¥æ¨¡å—çš„å½¢å¼å­˜åœ¨ã€‚è¿™å°±æ„å‘³ç€ï¼Œå½“ç³»ç»Ÿéœ€è¦æŸä¸ªé©±åŠ¨æ—¶ï¼Œä¼šå°†å…¶ä»¥æ¨¡å—çš„å½¢å¼ç¼–è¯‘è¿›å†…æ ¸ï¼Œåˆ†ä¸ºé™æ€ç¼–è¯‘å’ŒåŠ¨æ€ç¼–è¯‘ã€‚é™æ€ç¼–è¯‘çš„å†…æ ¸ä½“ç§¯æ™®éæ¯”åŠ¨æ€ç¼–è¯‘çš„å¤§ã€‚ Kconfig æ–‡ä»¶çš„ä½œç”¨Kconfig æ–‡ä»¶ä¸­ä¿å­˜äº†ç›®å½•ä¸‹å¯ç”¨æ¨¡å—çš„ä¿¡æ¯ã€‚å¦‚æœå°†æŸä¸ªç›®å½•çš„ Kconfig æ–‡ä»¶å†…å®¹å…¨éƒ¨åˆ é™¤ï¼Œå›¾å½¢åŒ–ç•Œé¢å°†æ— æ³•æ˜¾ç¤ºè¯¥æ¨¡å—çš„ä¿¡æ¯ï¼Œç”¨æˆ·ä¹Ÿå°±æ— æ³•è¿›è¡Œç›¸åº”çš„é…ç½®ã€‚ åœ¨å†…æ ¸é…ç½®è¿‡ç¨‹ï¼Œå¦‚è¿è¡Œ make menuconfig æˆ– xconfig æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä» Kconfig æ–‡ä»¶ä¸­è¯»å–é…ç½®èœå•ã€‚ç”¨æˆ·åœ¨ç•Œé¢ä¸­è¿›è¡Œçš„é…ç½®è¢«ä¿å­˜åˆ° .config æ–‡ä»¶ä¸­ï¼Œè¯¥æ–‡ä»¶ç”Ÿæˆåœ¨é¡¶å±‚ç›®å½•ã€‚.config æ–‡ä»¶åŒ…å«äº†æ‰€æœ‰çš„é…ç½®ä¿¡æ¯ï¼Œè®°å½•äº†ç”¨æˆ·å¯¹å†…æ ¸é…ç½®çš„å…·ä½“æƒ…å†µã€‚ä¸» Makefile ä¼šå¼•ç”¨ .configï¼Œä»¥äº†è§£ç”¨æˆ·çš„å†…æ ¸é…ç½®ã€‚ æ‰©å±•é©±åŠ¨çš„æ­¥éª¤å¦‚æœæƒ³è¦åœ¨å†…æ ¸æºç ä¸­æ·»åŠ æ–°é©±åŠ¨ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ Kconfig æ–‡ä»¶æ¥å¢è®¾è¯¥é©±åŠ¨çš„é…ç½®èœå•ï¼Œä»¥ä¾¿ç”¨æˆ·èƒ½å¤Ÿé€‰æ‹©ã€‚è€Œå¦‚æœå¸Œæœ›ä½¿è¿™ä¸ªé©±åŠ¨è¢«ç¼–è¯‘ï¼Œå¿…é¡»ä¿®æ”¹è¯¥é©±åŠ¨æ‰€åœ¨ç›®å½•ä¸‹çš„ Makefile æ–‡ä»¶ã€‚å½“æ·»åŠ æ–°çš„é©±åŠ¨æ—¶ï¼Œé€šå¸¸éœ€è¦å…³æ³¨ä¸¤ä¸ªæ–‡ä»¶ï¼šKconfig å’Œç›¸å…³ç›®å½•çš„ Makefileã€‚å°½ç®¡è¿™ä¸¤è€…æ˜¯æœ€ä¸ºå…³é”®çš„ï¼Œå®é™…ä¸Šï¼Œæ•´ä¸ªç³»ç»Ÿç§»æ¤è¿‡ç¨‹ä¸­è¿˜å¯èƒ½æ¶‰åŠå…¶ä»–å¤šä¸ªæ–‡ä»¶çš„ä¿®æ”¹ã€‚å› æ­¤ï¼ŒKconfig å’Œç›¸åº”ç›®å½•çš„ Makefile æ˜¯æ·»åŠ æˆ–åˆ é™¤å†…æ ¸æ¨¡å—çš„æ ¸å¿ƒæ–‡ä»¶ã€‚ ç¼–è¯‘å†…æ ¸é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š $ make zImage ä»¬èƒ½å¤Ÿåœ¨ arch/arm/boot ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª zImage æ–‡ä»¶ã€‚è¿™æ˜¯ç»è¿‡å‹ç¼©çš„å†…æ ¸é•œåƒï¼Œé€šå¸¸ç”¨äºåµŒå…¥å¼ç³»ç»Ÿã€‚zImage é€šå¸¸æ¯”æœªå‹ç¼©çš„å†…æ ¸é•œåƒå°ï¼Œèƒ½å¤Ÿæ›´å¿«åœ°åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä»è€Œæå‡ç³»ç»Ÿå¯åŠ¨é€Ÿåº¦ã€‚ å†…æ ¸çš„ç¼–è¯‘è¿‡ç¨‹ç›¸å½“å¤æ‚ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ç¼–è¯‘æ˜¯é™æ€ç¼–è¯‘ï¼Œä»¬æ‰§è¡Œçš„æ˜¯é¡¶å±‚ç›®å½•ä¸‹çš„ Makefile ä¸­å®šä¹‰çš„ zImage å‘½ä»¤ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘ç³»ç»Ÿä¼šä¾æ®å½“å‰ç›®å½•çš„ .config æ–‡ä»¶æ¥é€‰æ‹©éœ€è¦çš„æºä»£ç ï¼Œè€Œè¿™ä¸ª .config æ–‡ä»¶ä¸­åŒ…å«äº†å…³äºå†…æ ¸å„ä¸ªç»„ä»¶çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚å¯ç”¨æˆ–ç¦ç”¨ç‰¹å®šçš„é©±åŠ¨ç¨‹åºæˆ–åŠŸèƒ½æ¨¡å—ã€‚ æ•´ä¸ªç¼–è¯‘å†…æ ¸çš„è¿‡ç¨‹åŒ…æ‹¬å¤šä¸ªæ­¥éª¤ï¼Œå¦‚é…ç½®ã€ç¼–è¯‘å’Œé“¾æ¥ï¼Œå…·ä½“æ­¥éª¤è¯¸å¦‚ï¼š é…ç½®å†…æ ¸é€‰é¡¹ï¼šä½¿ç”¨ make menuconfig æˆ– make xconfig ç”Ÿæˆ .config æ–‡ä»¶ã€‚ ç¼–è¯‘å†…æ ¸ï¼šæ‰§è¡Œ make zImage å¼€å§‹ç¼–è¯‘ã€‚ ç”Ÿæˆå‹ç¼©é•œåƒï¼šæœ€ç»ˆç”Ÿæˆçš„ zImage æ–‡ä»¶å°†æ”¾ç½®åœ¨é€‚å½“çš„ç›®å½•ä¸­ã€‚ ç”±äºæ•´ä¸ªè¿‡ç¨‹çš„å¤æ‚æ€§ï¼Œç¼–è¯‘å†…æ ¸çš„ç»†èŠ‚ä»¬å¯ä»¥åœ¨åç»­çš„æ–‡ç« ä¸­è¿›è¡Œæ·±å…¥æ¢è®¨ã€‚ é€šè¿‡ TFTP ç½‘ç»œæœåŠ¡ä¸‹è½½æµ‹è¯•å†…æ ¸ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è®¾ç½®å¼•å¯¼å‚æ•°ï¼š setenv bootcmd tftp 20008000 zImage; go 20008000 åœ¨è¿™ä¸ªå‘½ä»¤ä¸­ï¼Œ20008000 æ˜¯ç›®æ ‡å†…å­˜åœ°å€ï¼Œè¿™ä¸ªåœ°å€æ˜¯åœ¨å¼€å‘æ¿çš„å†…å­˜ä¸­ç”¨äºåŠ è½½å†…æ ¸é•œåƒçš„ã€‚zImage æ˜¯ä»¬ä¹‹å‰ç¼–è¯‘å¾—åˆ°çš„å†…æ ¸é•œåƒã€‚go å‘½ä»¤ä¼šä»æŒ‡å®šçš„åœ°å€å¯åŠ¨å†…æ ¸ï¼Œæ•´ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡ TFTPï¼ˆTrivial File Transfer Protocolï¼‰å®Œæˆçš„ã€‚ æ¥ä¸‹æ¥ï¼Œä»¬è®¾ç½®å†…æ ¸å¯åŠ¨çš„å‚æ•°ï¼š setenv bootargs nfs nfsroot=192.168.1.199:/source/rootfs ip=192.168.1.200 init=/linuxrc ttySAC0,115200 è¿™é‡Œçš„ nfsroot æŒ‡æ˜äº† NFS æœåŠ¡å™¨çš„ IP åœ°å€å’Œæ ¹æ–‡ä»¶ç³»ç»Ÿçš„è·¯å¾„ã€‚ip ç”¨äºæŒ‡å®šå¼€å‘æ¿çš„ IP åœ°å€ï¼Œä»¥ä¾¿äºç½‘ç»œé€šä¿¡ã€‚init=/linuxrc è¡¨ç¤ºå¯åŠ¨åå°†æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹ï¼ŒttySAC0,115200 åˆ™è®¾ç½®äº†ä¸²å£çš„é…ç½®ï¼Œå…¶ä¸­ ttySAC0 æ˜¯å¼€å‘æ¿çš„ä¸²å£è®¾å¤‡ï¼Œæ³¢ç‰¹ç‡ä¸º 115200ã€‚ æœ€åï¼Œä¿å­˜ä»¥ä¸Šç¯å¢ƒå˜é‡å¹¶å¤ä½å¼€å‘æ¿ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š saveenvreset ç¡®è®¤ NFS æ–‡ä»¶ç³»ç»Ÿå·²è®¾ç½®å¥½ï¼Œå¹¶èƒ½å¤ŸæˆåŠŸæŒ‚è½½ã€‚è¿™ä¸ªè¿‡ç¨‹ç›¸å¯¹å¤æ‚ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠåˆ°ç½‘ç»œè®¾ç½®çš„é—®é¢˜ï¼Œå› æ­¤ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸éå¸¸å…³é”®ã€‚è¦ç¡®ä¿åœ¨å¯åŠ¨ä¹‹å‰ï¼Œç½‘ç»œä¸Šçš„ NFS æœåŠ¡å™¨æ˜¯å¯ä»¥è®¿é—®çš„ï¼Œå¦åˆ™å¯åŠ¨è¿‡ç¨‹å°†æ— æ³•å®Œæˆã€‚åœ¨åç»­çš„æ–‡ç« ä¸­ï¼Œä»¬å°†è¯¦ç»†ä»‹ç»å†…æ ¸æµ‹è¯•å’Œå¯åŠ¨çš„å…¶ä»–ç›¸å…³æ­¥éª¤ã€‚ æ ¹æ–‡ä»¶ç³»ç»Ÿçš„ä»‹ç»æœ¬éƒ¨åˆ†ä»¥ Flash å­˜å‚¨ä¸­å­˜æ”¾æ–‡ä»¶çš„åˆ†å¸ƒå›¾ä¸ºèµ·ç‚¹ï¼Œæ¢è®¨æ–‡ä»¶ç³»ç»Ÿçš„åˆ¶ä½œå’Œç§»æ¤ï¼Œè¿™é€šå¸¸æ˜¯ç³»ç»Ÿç§»æ¤è¿‡ç¨‹çš„æœ€åä¸€æ­¥ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œä»¬é¦–å…ˆéœ€è¦æ˜ç¡®å‡ ä¸ªå…³é”®é—®é¢˜ï¼š ä»€ä¹ˆæ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Ÿ å¦‚ä½•å®ç°æ–‡ä»¶ç³»ç»Ÿï¼Ÿ å¸¸ç”¨çš„æ–‡ä»¶ç³»ç»Ÿæœ‰å“ªäº›ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦è¿™äº›æ–‡ä»¶ç³»ç»Ÿï¼Ÿ æ¥ä¸‹æ¥ï¼Œä»¬å°†é€ä¸€è§£ç­”è¿™äº›é—®é¢˜ã€‚ æ–‡ä»¶ç³»ç»Ÿæ¦‚è¿°åœ¨ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œè™½ç„¶å¾ˆå°‘æœ‰äººç›´æ¥æåŠâ€æ–‡ä»¶ç³»ç»Ÿâ€è¿™ä¸ªåè¯ï¼Œä½†å…¶å®é™…ä¸Šæ— å¤„ä¸åœ¨ï¼Œæ—¥å¸¸æ‰€ç§°çš„èµ„æ–™åº“ä¾¿æ˜¯ä¸€ä¸ªå¸¸è§çš„ä¾‹å­ã€‚èµ„æ–™åº“ä¸­åŒ…å«å¤§é‡æ–‡ä»¶ï¼Œè€Œä»¬è¯¥å¦‚ä½•å¿«é€Ÿä¸”å‡†ç¡®åœ°æ‰¾åˆ°éœ€è¦çš„é‚£ä»½æ–‡ä»¶å‘¢ï¼Ÿè¿™æ­£æ˜¯æ–‡ä»¶ç³»ç»Ÿæ‰€è´Ÿè´£çš„ã€‚ç±»æ¯”äºå­¦æ ¡å›¾ä¹¦é¦†ï¼Œå…¶ä¸€æ¥¼å¯èƒ½æ˜¯å“²å­¦ç±»ä¹¦ç±ï¼ŒäºŒæ¥¼æ˜¯ç¤¾ç§‘ç±»ï¼Œä¸‰æ¥¼æ˜¯ç”µå­ç±»ï¼Œå››æ¥¼åˆ™æ˜¯è®¡ç®—æœºç±»ã€‚é‡‡å–è¿™ç§åˆ†ç±»å’Œç´¢å¼•çš„æ–¹æ³•çš„èµ„æ–™åº“ï¼Œä»¬ç§°ä¹‹ä¸ºæ–‡ä»¶ç³»ç»Ÿã€‚ åœ¨è®¡ç®—æœºç¯å¢ƒä¸­ï¼Œæ–‡ä»¶è¢«è§†ä½œæ•°æ®çš„é›†åˆï¼Œå­˜å‚¨äºç‰©ç†ä»‹è´¨ä¸Šï¼Œä¾‹å¦‚ç¡¬ç›˜ã€‚ç”¨æˆ·æ— æ³•ç›´æ¥è®¿é—®ç‰©ç†ä»‹è´¨ä¸Šçš„æ–‡ä»¶ï¼Œå› æ­¤ï¼Œæ‰€æœ‰æ–‡ä»¶çš„è¯»å†™æ“ä½œå‡éœ€è¦é€šè¿‡ç¨‹åºæ¥å®Œæˆã€‚ä¸ºç¡®ä¿è¿™ä¸€è¿‡ç¨‹çš„é¡ºç•…ï¼Œç¨‹åºè¢«åˆ’åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šç‰©ç†ä»‹è´¨é©±åŠ¨ç¨‹åºã€å†…å®¹å­˜å‚¨ç¨‹åºå’Œæ–‡ä»¶å†…å®¹å­˜å‚¨ç¨‹åºã€‚ç‰©ç†ä»‹è´¨é©±åŠ¨ç¨‹åºç”¨äºä»ç‰©ç†ä»‹è´¨è¯»å–å’Œå†™å…¥æ•°æ®ï¼›å†…å®¹å­˜å‚¨ç¨‹åºçš„ä»»åŠ¡æ˜¯å°†æ–‡ä»¶å†…å®¹å’Œå…¶å±æ€§ä¿¡æ¯è¿›è¡Œæ‰“åŒ…ï¼›æ–‡ä»¶å†…å®¹å­˜å‚¨ç¨‹åºåˆ™è´Ÿè´£æ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œä»è€Œå½¢æˆæ–‡ä»¶å†…å®¹ï¼Œæˆ–è€…å°†è¯»å–çš„æ–‡ä»¶å†…å®¹å±•ç¤ºç»™ç”¨æˆ·ã€‚ æ–‡ä»¶ç³»ç»Ÿçš„å±‚æ¬¡ç»“æ„æƒ³è±¡ä¸€ä¸‹ï¼Œä»¬å¯ä»¥å°†ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ˆå€’æ ‘å½¢ç»“æ„ï¼‰åˆ†è§£æˆå¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ˆå€’æ ‘å½¢ç»“æ„ï¼‰ï¼Œå¹¶å°†è¿™äº›å­ç³»ç»Ÿåˆ†åˆ«å­˜æ”¾è‡³ä¸åŒçš„å­˜å‚¨ä»‹è´¨ä¸Šã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿå­˜å‚¨åœ¨å…‰ç›˜ä¸­ï¼Œå¦ä¸€ä¸ªåˆ™å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­ã€‚åœ¨ä½¿ç”¨æ—¶ï¼Œä»¬å°†å…‰ç›˜ä¸­è¯¥æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•æŒ‚è½½åˆ°ç¡¬ç›˜æ–‡ä»¶ç³»ç»Ÿçš„æŸä¸ªç›®å½•ä¸‹ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œè®¿é—®è¿™ä¸ªç‰¹å®šç›®å½•å°±å¦‚åŒè®¿é—®å…‰ç›˜çš„æ ¹ç›®å½•ä¸€æ ·ï¼Œæ‰¾åˆ°äº†æ ¹ç›®å½•ï¼Œä»¬å°±èƒ½è®¿é—®æ•´ä¸ªå…‰ç›˜ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚ â€œåœ¨ Linux ç³»ç»Ÿä¸­ä¸€åˆ‡çš†æ˜¯æ–‡ä»¶â€ï¼Œè¿™å¥è¯åœ¨ä»¬å­¦ä¹  Linux æ—¶å¸¸å¸¸èƒ½å¤Ÿå¬åˆ°ï¼Œå®ƒè™½ç„¶ç•¥æ˜¾å¤¸å¼ ï¼Œå´æœ‰æ•ˆæ­ç¤ºäº†æ–‡ä»¶ç³»ç»Ÿåœ¨ Linux ä¸­çš„é‡è¦æ€§ã€‚å®é™…ä¸Šï¼Œæ–‡ä»¶ç³»ç»Ÿåœ¨æ‰€æœ‰æ“ä½œç³»ç»Ÿä¸­éƒ½è‡³å…³é‡è¦ï¼Œå®ƒä»¬é€šè¿‡æ–‡ä»¶çš„å½¢å¼ç®¡ç†å¤§éƒ¨åˆ†çš„ç¡¬ä»¶è®¾å¤‡å’Œè½¯ä»¶æ•°æ®ã€‚ä»¥ä¸‹æ˜¯ Linux ç³»ç»Ÿä¸­è®¾å¤‡å’Œæ•°æ®ç®¡ç†çš„æ¡†æ¶å›¾ï¼š Linux ç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿç»“æ„ **VFS (Virtual File System)**ï¼šè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œç®¡ç†ç‰¹æ®Šæ–‡ä»¶ï¼ˆå¦‚è™šæ‹Ÿæ–‡ä»¶ï¼‰ã€ç£ç›˜æ–‡ä»¶å’Œè®¾å¤‡æ–‡ä»¶ã€‚ fs_operations ç»“æ„ï¼šç”±ä¸€ç³»åˆ—æ–‡ä»¶æ“ä½œæ¥å£å‡½æ•°ç»„æˆï¼Œç”±æ–‡ä»¶ç³»ç»Ÿå±‚æ¥å®ç°ï¼Œä¸º VFS æä¾›æ–‡ä»¶æ“ä½œã€‚ æ–‡ä»¶ç³»ç»Ÿå±‚ï¼šåœ¨è¿™ä¸€å±‚ï¼Œç£ç›˜æ–‡ä»¶èƒ½å®ç°å¤šç§æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ ext2ï¼Œè€Œè®¾å¤‡æ–‡ä»¶åˆ™é¡»å®ç°å„ç§æŠ½è±¡çš„è®¾å¤‡é©±åŠ¨ã€‚ è®¾å¤‡é©±åŠ¨å±‚ï¼šé‡ç‚¹åœ¨äºç£ç›˜é©±åŠ¨ï¼Œéœ€å®ç°å¤šç§ç£ç›˜é©±åŠ¨ç¨‹åºï¼Œå…¶ä»–è®¾å¤‡é©±åŠ¨è´Ÿè´£å…·ä½“è®¾å¤‡çš„é©±åŠ¨ã€‚ ç‰©ç†å±‚ï¼šè¿™å°±æ˜¯è®¾å¤‡æœ¬èº«ã€‚ ä¸ºä»€ä¹ˆä¼šæœ‰ä¸åŒçš„æ–‡ä»¶ç±»å‹ï¼Ÿç”±äºå­˜åœ¨å¤šæ ·çš„å­˜å‚¨ä»‹è´¨ï¼Œå•ä¸€çš„æ–‡ä»¶ç³»ç»Ÿæ ¼å¼æ— æ³•é€‚ç”¨äºæ‰€æœ‰ä»‹è´¨ï¼Œå› æ­¤éœ€è¦è®¾è®¡å¤šç§ä¸åŒçš„å­˜å‚¨æ ¼å¼ï¼Œä»¥ä¼˜åŒ–å­˜å–æ•ˆç‡å’Œç©ºé—´åˆ©ç”¨ç‡ã€‚æ¯ç§å­˜å‚¨æ ¼å¼å¿…é¡»éµå¾ªç‰¹å®šçš„è§„èŒƒï¼Œè¿™äº›è§„èŒƒè¢«ç§°ä¸ºæ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚ å¸¸è§æ–‡ä»¶ç³»ç»Ÿç±»å‹ DOS ç³»åˆ—ï¼š FAT16 Windows ç³»åˆ—ï¼š FAT16ã€FAT32ã€NTFS Linux ç³»åˆ—ï¼š Minixã€extã€ext2ã€ext3ã€ISO9660ã€jffs2ã€yaffsã€yaffs2ã€cramfsã€romfsã€ramdiskã€rootfsã€procã€sysfsã€usbfsã€devptsã€tmpfs å’Œ ramfsã€NFS ç”±æ­¤å¯è§ï¼ŒLinux æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿç§ç±»æœ€ä¸ºä¸°å¯Œã€‚æ ¹æ®ä¸åŒçš„ä»‹è´¨è¿›è¡Œåˆ†ç±»å¦‚ä¸‹å±•ç¤ºï¼š ç£ç›˜ï¼šFAT16ã€FAT32ã€NTFSã€extã€ext2ã€ext3ã€Minix å…‰ç›˜ï¼šISO9660 Flash å­˜å‚¨ï¼šjffs2ã€yaffsã€yaffs2ã€cramfsã€romfs å†…å­˜ï¼šramdiskã€tmpfs å’Œ ramfs è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼šrootfsã€procã€sysfsã€usbfsã€devptsã€NFS ç†è®ºä¸Šï¼Œå¸¸ç”¨çš„å­˜å‚¨ä»‹è´¨éƒ½å¯ä»¥æ”¯æŒæ‰€åˆ—çš„ Linux æ–‡ä»¶ç³»ç»Ÿã€‚ä¸è¿‡åœ¨åµŒå…¥å¼ç³»ç»Ÿçš„åº”ç”¨ä¸­ï¼Œç”±äºå—é™äºä½“ç§¯å’Œä¾¿æºç‰¹æ€§ï¼Œæ— æ³•ä½¿ç”¨ç£ç›˜å’Œå…‰ç›˜ï¼Œå› è€Œåªèƒ½é€‰æ‹© Flash ç±»å‹çš„å­˜å‚¨è®¾å¤‡ã€å†…å­˜å’Œè™šæ‹Ÿå­˜å‚¨è®¾å¤‡ã€‚ Flash å­˜å‚¨å’Œå†…å­˜ä¸­çš„æ–‡ä»¶ç³»ç»ŸFlash èŠ¯ç‰‡çš„é©±åŠ¨ç¨‹åºç”±ç³»ç»Ÿæä¾›ï¼Œå› æ­¤å…¶å­˜å–ç‰¹æ€§å®Œå…¨å–å†³äº Flash æœ¬èº«ç‰¹ç‚¹ï¼Œå› æ­¤éœ€è¦æ›´é€‚åˆ Flash çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚ JFFSã€YAFFSã€CramFS å’Œ ROMFSã€‚è¿™äº›æ–‡ä»¶ç³»ç»Ÿéƒ½æ˜¯åœ¨åµŒå…¥å¼ Linux ç³»ç»Ÿä¸­å¸¸ç”¨çš„ï¼Œå¹¶å¯æ ¹æ®å„è‡ªç‰¹ç‚¹è¿›è¡Œé€‰æ‹©ï¼Œå…·ä½“ç‰¹ç‚¹å¦‚ä¸‹ï¼š å…±åŒç‰¹ç‚¹ åŸºäº MTD é©±åŠ¨ JFFS é’ˆå¯¹ NOR Flash çš„å®ç° åŸºäºå“ˆå¸Œè¡¨çš„æ—¥å¿—å‹æ–‡ä»¶ç³»ç»Ÿ é€šå¸¸é‡‡ç”¨æŸè€—å¹³è¡¡æŠ€æœ¯ç¡®ä¿å­˜å‚¨æ•ˆèƒ½ æ”¯æŒæ•°æ®å‹ç¼©ï¼Œå¯è¯»å†™ æä¾›å´©æºƒæ‰ç”µçš„å®‰å…¨ä¿æŠ¤ å½“æ–‡ä»¶ç³»ç»Ÿæ¥è¿‘æ»¡æ—¶ï¼Œç”±äºåƒåœ¾æ”¶é›†æœºåˆ¶å¯èƒ½ä¼šå½±å“è¿è¡Œé€Ÿåº¦ YAFFS é’ˆå¯¹ NAND Flash çš„å®ç° æ—¥å¿—å‹æ–‡ä»¶ç³»ç»Ÿ å®æ–½æŸè€—å¹³è¡¡ï¼Œç¡®ä¿å­˜å‚¨å‡è¡¡ å¯è¯»å†™ï¼Œä¸æ”¯æŒæ•°æ®å‹ç¼© æŒ‚è½½æ—¶é—´çŸ­ï¼Œå†…å­˜å ç”¨å°‘ è‡ªå¸¦ NAND Flash é©±åŠ¨ï¼Œæ— éœ€å¤–éƒ¨ VFS å’Œ MTD CramFS å•é¡µå‹ç¼©ï¼Œæ”¯æŒéšæœºè®¿é—®ï¼Œå‹ç¼©æ¯”æœ€é«˜å¯è¾¾ 2:1 é€Ÿåº¦å¿«ï¼Œæ•ˆç‡é«˜ åªè¯»ç‰¹æ€§æœ‰åŠ©äºä¿æŠ¤æ–‡ä»¶ç³»ç»Ÿï¼Œæé«˜ç³»ç»Ÿå¯é æ€§ï¼Œä½†æ— æ³•æ‰©å……å†…å®¹ ROMFS ç®€å•ã€ç´§å‡‘ã€åªè¯»æ–‡ä»¶ç³»ç»Ÿ é¡ºåºå­˜æ”¾æ•°æ®ï¼Œæ”¯æŒ XIPï¼ˆExecute In Placeï¼Œç‰‡å†…è¿è¡Œï¼‰ï¼Œåœ¨ç³»ç»Ÿè¿è¡Œæ—¶èŠ‚çœ RAM ç©ºé—´ ç‰¹æœ‰çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼šRamdisk æ–‡ä»¶ç³»ç»Ÿåœ¨ Linux ç³»ç»Ÿä¸­ï¼ŒRamdisk å¸¸ç”¨äºå­˜å‚¨æ–‡ä»¶ç³»ç»Ÿï¼ŒRamdisk åˆ†ä¸ºä¸¤ç§ï¼šä¸€ç§å°†ç‰©ç†å†…å­˜è§†ä½œç‰©ç†å­˜å‚¨ä»‹è´¨ï¼Œæ¨¡æ‹Ÿç£ç›˜ï¼›å¦ä¸€ç§åˆ™ä»…åœ¨å†…å­˜ä¸­å­˜å‚¨æ–‡ä»¶ç³»ç»Ÿçš„é€»è¾‘ç»“æ„ï¼Œè¿ç”¨ tmpfs å’Œ ramfs æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚ tmpfs ramfs æ¦‚è¿° ç‰©ç†å†…å­˜æ¨¡æ‹Ÿç£ç›˜åˆ†åŒºï¼ŒæŒ‚è½½åå¯åƒè¯»å†™ç£ç›˜æ–‡ä»¶ä¸€æ ·è¯»å†™æ–‡ä»¶ï¼Œå…¶æ“ä½œé€Ÿåº¦æ˜¾è‘—é«˜äºç£ç›˜æ–‡ä»¶ã€‚ ä¸€èˆ¬åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š é€Ÿåº¦è¦æ±‚å¿«çš„æ–‡ä»¶å¯æ”¾ç½®äºæ­¤æ–‡ä»¶ç³»ç»Ÿä¸­ å½“ç£ç›˜åˆ†åŒºä¸º Flash æ—¶ï¼Œå°†é¢‘ç¹è¯»å†™çš„æ–‡ä»¶æ”¾ç½®äºæ­¤ï¼Œå¹¶å®šæœŸå†™å› Flash ç³»ç»Ÿçš„ä¸´æ—¶æ–‡ä»¶ï¼Œå¦‚ /tmp å’Œ /var ç›®å½•ä¸‹çš„æ–‡ä»¶ /dev è®¾å¤‡æ–‡ä»¶ï¼ˆå› ä¸ºè®¾å¤‡æ–‡ä»¶éšé©±åŠ¨å’Œè®¾å¤‡åŠ è½½å¸è½½è€Œå˜åŒ–ï¼‰ ç‰¹ç‚¹ æ•°æ®ä¿å­˜åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œç³»ç»Ÿé‡å¯åï¼Œè¯¥æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®ä¼šå…¨éƒ¨ä¸¢å¤±ã€‚ ramfs åœ¨æ²¡æœ‰æŒ‡å®šæœ€å¤§å¤§å°æ—¶ä¼šè‡ªè¡Œå¢é•¿ï¼Œç›´è‡³å ç”¨æ‰€æœ‰ç‰©ç†å†…å­˜ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œå› æ­¤å»ºè®®åœ¨æŒ‚è½½æ—¶è®¾å®šæœ€å¤§å€¼ã€‚ tmpfs å¦‚æœæŒ‡å®šå¤§å°ï¼Œå°†åœ¨è¾¾åˆ°æœ€å¤§å€¼åä¸å†ç»§ç»­å¢é•¿ï¼Œä¸”å…¶å ç”¨çš„ç‰©ç†å†…å­˜é¡µå¯ä»¥æ¢å‡ºåˆ° swap åˆ†åŒºï¼Œè€Œ ramfs åˆ™ä¸å…·å¤‡è¿™ä¸€ç‰¹æ€§ã€‚ ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿæ‹¥æœ‰å„è‡ªçš„æ„å»ºæ–¹æ³•ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿","ç³»ç»Ÿç§»æ¤"]},{"title":"EMC","path":"/2024/09/24/1-å¹³å°ç³»ç»Ÿ-å¹³å°ç›¸å…³-EMC/","content":"EMCï¼ˆç”µç£å…¼å®¹æ€§ï¼‰çš„é‡è¦æ€§ç”µç£å…¼å®¹æ€§ï¼ˆEMCï¼‰æ˜¯ç¡®ä¿äº§å“åœ¨ç‰¹å®šç”µç£ç¯å¢ƒä¸­èƒ½å¤Ÿæ­£å¸¸å·¥ä½œçš„å…³é”®æ€§èƒ½æŒ‡æ ‡ã€‚EMC ä¸ä»…æ¶‰åŠåˆ°è®¾å¤‡èƒ½å¦æŠµå¾¡å¤–éƒ¨å¹²æ‰°ï¼Œè¿˜åŒ…æ‹¬è®¾å¤‡è‡ªèº«æ˜¯å¦ä¼šå‘å¤–ç•Œé‡Šæ”¾å¹²æ‰°ã€‚ä»»ä½•æœªèƒ½é€šè¿‡ EMC æµ‹è¯•çš„äº§å“éƒ½å¯èƒ½é¢ä¸´ä¸¥é‡åæœï¼ŒåŒ…æ‹¬åŠŸèƒ½å¤±å¸¸ã€è®¾å¤‡æŸåç”šè‡³å®‰å…¨éšæ‚£ã€‚ EMC çš„åŸºæœ¬æ¦‚å¿µç”µç£å…¼å®¹æ€§æ˜¯æŒ‡ç”µæ°”è®¾å¤‡åœ¨å…¶ç”µç£ç¯å¢ƒä¸­æ­£å¸¸å·¥ä½œçš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬ï¼š é™åˆ¶æ— æ„é—´äº§ç”Ÿçš„ç”µç£èƒ½é‡ï¼šè®¾å¤‡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šæ„å¤–åœ°é€šè¿‡ radiated æˆ– conducted æ–¹å¼é‡Šæ”¾å¯¹å…¶ä»–è®¾å¤‡çš„å¹²æ‰°ã€‚ æŠ—å¹²æ‰°èƒ½åŠ›ï¼šè®¾å¤‡åœ¨å—åˆ°æ¥è‡ªå¤–ç•Œçš„ç”µç£å¹²æ‰°ï¼ˆEMIï¼‰æ—¶ï¼Œä¿æŒç¨³å®šå’Œæ­£å¸¸çš„å·¥ä½œçŠ¶æ€ã€‚ ä¾‹å¦‚ï¼Œå¿ƒè„èµ·æå™¨è¿™æ ·çš„åŒ»ç–—è®¾å¤‡ï¼Œå…¶å¯¹ç”µç£å¹²æ‰°çš„æ•æ„Ÿæ€§æé«˜ã€‚å¦‚æœå‘¨å›´å­˜åœ¨å¼ºç”µç£å¹²æ‰°ï¼Œå®ƒå¯èƒ½ä¼šå½±å“èµ·æå™¨çš„å·¥ä½œï¼Œå¯¼è‡´å¿ƒè„åœè·³ç­‰ä¸¥é‡åæœï¼Œè¿™æ˜¯ EMC ä¿éšœç”Ÿå‘½å®‰å…¨çš„é‡è¦ä½“ç°ã€‚ EMC ç ”ç©¶çš„ä¸‰å¤§å…³é”®é—®é¢˜ èƒ½é‡æ¥æºï¼šç”µç£èƒ½é‡çš„äº§ç”Ÿå¯èƒ½æºäºå„ç±»ç”µæ°”è®¾å¤‡ï¼ŒåŒ…æ‹¬å®¶ç”¨ç”µå™¨ã€å·¥ä¸šæœºåºŠã€ç”šè‡³ç½‘ç»œè®¾å¤‡ã€‚è¯†åˆ«å¹¶æ§åˆ¶è¿™äº›å¹²æ‰°æºæ˜¯ EMC ç ”ç©¶çš„é‡è¦ä¸€ç¯ã€‚ æŠ—å¹²æ‰°èƒ½åŠ›ï¼šè®¾å¤‡åº”å…·å¤‡å¼ºå¤§çš„æŠ—å¹²æ‰°èƒ½åŠ›ï¼Œè¿™æ˜¯å†³å®šç”µæ°”è®¾å¤‡æ•…éšœç‡çš„é‡è¦å› ç´ ã€‚ä¾‹å¦‚ï¼ŒæŸäº›é«˜ç«¯æœåŠ¡å™¨æµ‹å¾—æŠ—å¹²æ‰°èƒ½åŠ›èƒ½åœ¨é­é‡ RFI æ—¶ï¼Œä¾ç„¶ä¿æŒ 99.9%çš„æ­£å¸¸è¿è¡Œæ—¶é—´ã€‚ è€¦åˆè·¯å¾„ï¼šç ”ç©¶å¹²æ‰°æ˜¯å¦‚ä½•é€šè¿‡ç”µç¼†ã€ç©ºæ°”æˆ–å…¶ä»–åª’ä»‹è€¦åˆåˆ°æ•æ„Ÿè®¾å¤‡ä¸Šçš„ï¼Œä»¥ä¾¿æœ‰æ•ˆå®æ–½é˜²æŠ¤æªæ–½ã€‚ å¸¸è§çš„ EMC æµ‹è¯• æŠ—æ‰°åº¦æµ‹è¯•ï¼šè¿™åŒ…æ‹¬äº†è¯¸å¦‚é™ç”µæ”¾ç”µæµ‹è¯•ã€è„‰å†²ç¾¤æŠ—æ‰°åº¦æµ‹è¯•ã€é›·å‡»æµªæ¶Œæµ‹è¯•ç­‰ã€‚é€šè¿‡å‘è®¾å¤‡æ–½åŠ ç‰¹å®šçš„ç”µç£å¹²æ‰°ï¼Œè§‚æµ‹å…¶æ˜¯å¦ä¾æ—§ä¿æŒæ­£å¸¸å·¥ä½œã€‚ ä¼ å¯¼è¾å°„æµ‹è¯•ï¼šæµ‹é‡è®¾å¤‡åœ¨å·¥ä½œçŠ¶æ€ä¸‹ï¼Œå‘å¤–é‡Šæ”¾çš„ç”µç£å¹²æ‰°æ°´å¹³ï¼Œä¾‹å¦‚ç”µæºçº¿çš„ä¼ å¯¼æµ‹è¯•ã€‚è¿™äº›æµ‹è¯•ç¡®ä¿è®¾å¤‡å¯¹å¤–ç•Œçš„å½±å“åœ¨è§„å®šæ ‡å‡†ä¹‹å†…ã€‚ ç”µç£å¤±æ•ˆçš„è¡¨ç°EMC å¹²æ‰°çš„å½±å“åƒä¸‡ä¸å¯å°è§‘ï¼Œå¯èƒ½å¯¼è‡´ä¸€ç³»åˆ—åŠŸèƒ½å¤±æ•ˆï¼š ç³»ç»Ÿæ­»æœºæ— å“åº”ï¼šä¾‹å¦‚ï¼ŒæŸåº”ç”¨å› è¯»å–åˆ°é”™è¯¯çš„è¾“å…¥å€¼ï¼Œç¨‹åºé™·å…¥æ­»é”è€Œæ— æ³•å“åº”ã€‚ æ‰§è¡Œæ„å¤–æŒ‡ä»¤ï¼šæ¯”å¦‚ï¼ŒæŒ‡å‘é”™è¯¯å†…å­˜åœ°å€ï¼Œæ•°æ®ä¸¢å¤±å¯¼è‡´è½¯ä»¶è¡Œä¸ºå¼‚å¸¸ã€‚ IO è¡¨ç°å¼‚å¸¸ï¼šè¿™å¯èƒ½è¡¨ç°ä¸ºæ˜¾ç¤ºå±é—ªçƒã€æŒ‰é”®å¤±çµã€ä¼ æ„Ÿå™¨æ•°æ®å‡ºç°å™ªå£°ç­‰ã€‚ è½¯ä»¶å¯¹ç­–çš„å®æ–½ çœ‹é—¨ç‹—æŠ€æœ¯ï¼šçœ‹é—¨ç‹—èƒ½å¤Ÿç›‘æµ‹ç³»ç»Ÿæ˜¯å¦æ­»æœºå¹¶é‡æ–°å¯åŠ¨ç³»ç»Ÿã€‚è¿™æ˜¯ä¸€ä¸ªåŠ¡å®çš„è§£å†³æ–¹æ¡ˆï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šä¸ª EMC æµ‹è¯•ç­‰çº§ä¸­ï¼Œåªè¦ç³»ç»Ÿèƒ½åœ¨å¹²æ‰°åæ¢å¤æ­£å¸¸ï¼Œå°±ç®—æ˜¯é€šè¿‡äº†ã€‚ æ•°æ®å†—ä½™æŠ€æœ¯ï¼šåœ¨å…³é”®åŠŸèƒ½æ“ä½œä¸­å¼•å…¥å¤‡ä»½å‚æ•°ã€‚ä¾‹å¦‚åœ¨èˆªç©ºã€åŒ»ç–—ç­‰é¢†åŸŸï¼Œå¼€å‘è€…å¾€å¾€ä¼šä¸ºå…³é”®æ•°æ®é‡‡ç”¨åŒé‡å­˜å‚¨æœºåˆ¶ï¼Œä»¥ç¡®ä¿å³ä½¿åœ¨æœ€å¤æ‚çš„ç”µç£å¹²æ‰°æƒ…å†µä¸‹ä¹Ÿèƒ½è¿…é€Ÿæ¢å¤ã€‚ ç®¡ç†æœªä½¿ç”¨çš„ä¸­æ–­ï¼šå¯¹äºç³»ç»Ÿä¸­æœªè¢«ä½¿ç”¨çš„ä¸­æ–­ï¼Œå…³é—­ç›¸åº”å¯„å­˜å™¨ï¼Œå¹¶é€šè¿‡å¼‚å¸¸ä¸­æ–­æœåŠ¡ä¾‹ç¨‹è®°å½•å¹¶å¤„ç†è¿™äº›ä¸­æ–­ã€‚ è°¨æ…çš„ IO ç­–ç•¥ï¼šå¯¹äºè¾“å…¥ä¿¡å·ï¼Œå¯ä»¥é‡‡ç”¨æ»¤æ³¢ç­–ç•¥ï¼Œæ¯”å¦‚å¤šæ¬¡é‡‡æ ·ä»¥æ¶ˆé™¤æŠ–åŠ¨ã€‚åœ¨æ¨¡æ‹Ÿä¿¡å·å¤„ç†ä¸­ï¼Œä½¿ç”¨æ•°å­—æ»¤æ³¢å™¨æŠ€æœ¯ä»¥ç¡®ä¿æ•°æ®çš„å‡†ç¡®æ€§ã€‚ æ‰ç”µæ£€æµ‹å­˜å‚¨æŠ€æœ¯ï¼šç»“åˆç¡¬ä»¶è®¾è®¡ï¼Œé‡‡ç”¨æ‰ç”µæ£€æµ‹åŠç¬æ—¶ UPS ç”µè·¯ã€‚ç³»ç»Ÿåœ¨äº¤æ›¿ä¾›ç”µçš„æ¡ä»¶ä¸‹ï¼Œå¦‚æœæ£€æµ‹åˆ°å³å°†æ‰ç”µï¼Œèƒ½åŠæ—¶ä¿å­˜å…³é”®å‚æ•°ä»¥é˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚ å¥å£®çš„é€šä¿¡åè®®è®¾è®¡ï¼šå¢åŠ  CRC æ ¡éªŒã€é”™è¯¯é‡ä¼ æœºåˆ¶å’Œé€šä¿¡æ•…éšœæ£€æµ‹ï¼Œä»¥æå‡è®¾å¤‡åœ¨é€šä¿¡è¿‡ç¨‹ä¸­çš„é²æ£’æ€§ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","å¹³å°ç›¸å…³"]},{"title":"Linuxå¯åŠ¨","path":"/2024/09/23/1-å¹³å°ç³»ç»Ÿ-å¹³å°ç›¸å…³-Linuxå¯åŠ¨/","content":"Linux ç³»ç»ŸLinux ç³»ç»Ÿå†…æ ¸Linux ç³»ç»Ÿå†…æ ¸æ˜¯è¿™ä¸ªæ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£ç®¡ç†è®¡ç®—æœºçš„ç¡¬ä»¶èµ„æºã€‚å†…æ ¸æä¾›äº†ç¡¬ä»¶æŠ½è±¡å±‚ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºå¯ä»¥æ–¹ä¾¿åœ°ä¸ç¡¬ä»¶äº’åŠ¨ï¼Œè€Œä¸å¿…å…³å¿ƒå…·ä½“çš„ç¡¬ä»¶å®ç°ç»†èŠ‚ã€‚ä¾‹å¦‚ï¼Œå†…æ ¸ä¼šç®¡ç† CPU çš„è°ƒåº¦ã€å†…å­˜çš„åˆ†é…ä»¥åŠç¡¬ç›˜çš„è¯»å†™æ“ä½œã€‚ æ­¤å¤–ï¼Œå†…æ ¸æ”¯æŒå¤šä»»åŠ¡åŠŸèƒ½ï¼Œå…è®¸å¤šä¸ªç¨‹åºåŒæ—¶è¿è¡Œï¼Œä»è€Œæå‡äº†è®¡ç®—æœºçš„ä½¿ç”¨æ•ˆç‡ã€‚åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå†…æ ¸å¤„ç†ä¸ç¡¬ä»¶çš„æ‰€æœ‰äº¤äº’ï¼Œè¿™æ ·ç”¨æˆ·å’Œå¼€å‘è€…å°±å¯ä»¥å…³æ³¨ä»–ä»¬çš„åº”ç”¨ç¨‹åºï¼Œè€Œä¸å¿…æ‹…å¿ƒåº•å±‚çš„ç¡¬ä»¶ç®¡ç†ã€‚ Linux å‘è¡Œå¥—ä»¶ç³»ç»ŸLinux å‘è¡Œå¥—ä»¶ç³»ç»Ÿï¼ˆLinux distributionï¼‰æ˜¯å¯¹ Linux å†…æ ¸åŠå…¶å‘¨è¾¹è½¯ä»¶çš„ä¸€ä¸ªé›†åˆã€‚å®ƒä¸ä»…åŒ…å«äº† Linux å†…æ ¸ï¼Œè¿˜åŒ…æ‹¬äº†å„ç§å¸¸ç”¨çš„è½¯ä»¶å·¥å…·å’Œåº“ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥ç›´æ¥å®‰è£…å’Œä½¿ç”¨ã€‚ä¾‹å¦‚ï¼ŒUbuntuã€CentOS å’Œ Fedora æ˜¯ä¸‰ç§æµè¡Œçš„ Linux å‘è¡Œç‰ˆï¼Œæ¯ç§éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯ã€‚ è¿™äº›å‘è¡Œç‰ˆé€šå¸¸ä¼šé¢„è£…ä¸€äº›æµè¡Œçš„è½¯ä»¶ï¼Œå¦‚æ–‡æœ¬ç¼–è¾‘å™¨ã€æµè§ˆå™¨å’Œå¼€å‘å·¥å…·ï¼Œä½¿å¾—ç”¨æˆ·åœ¨å®‰è£…ç³»ç»Ÿåï¼Œå¯ä»¥ç«‹å³å¼€å§‹ä½¿ç”¨ã€‚æ­¤å¤–ï¼Œè®¸å¤šå‘è¡Œç‰ˆè¿˜æä¾›äº†è½¯ä»¶åŒ…ç®¡ç†ç³»ç»Ÿï¼Œç”¨æˆ·å¯ä»¥è½»æ¾åœ°æ·»åŠ æˆ–æ›´æ–°è½¯ä»¶ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œçµæ´»æ€§ã€‚æ¯”å¦‚ï¼ŒUbuntu ä½¿ç”¨äº† APT åŒ…ç®¡ç†ç³»ç»Ÿï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ç®€å•çš„å‘½ä»¤æ¥å®‰è£…æ–°è½¯ä»¶ï¼Œè€Œæ— éœ€æ‰‹åŠ¨å¤„ç†ä¾èµ–å…³ç³»ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒLinux å‘è¡Œå¥—ä»¶ä¸ä»…ä½¿å¾—ç³»ç»Ÿçš„é…ç½®å˜å¾—æ›´åŠ ç®€å•ï¼Œè¿˜ä½¿å¾—æ–°ç”¨æˆ·èƒ½å¤Ÿæ›´å¿«åœ°ä¸Šæ‰‹ï¼Œé¿å…äº†ç¹ççš„è®¾ç½®æ­¥éª¤ã€‚ åˆ†åŒºLinux ç³»ç»ŸæŒ‰ç…§ FHSï¼ˆFilesystem Hierarchy Standardï¼Œæ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„æ ‡å‡†ï¼‰å¯¹ä¸åŒç›®å½•è¿›è¡Œäº†æ˜ç¡®çš„å®šä¹‰å’ŒåŠŸèƒ½åˆ’åˆ†ã€‚è¿™ç§ç»„ç»‡ç»“æ„ä½¿å¾—ç”¨æˆ·å’Œç®¡ç†å‘˜èƒ½å¤Ÿè½»æ¾æ‰¾åˆ°æ–‡ä»¶å’Œç¨‹åºï¼Œå¹¶ç¡®ä¿ç³»ç»Ÿçš„é«˜æ•ˆè¿ä½œã€‚ ä¸»è¦ç›®å½•åŠå…¶åŠŸèƒ½ ï¼ˆæ ¹ç›®å½•ï¼‰ æ ¹ç›®å½•æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„èµ·ç‚¹ï¼Œæ‰€æœ‰å…¶ä»–ç›®å½•éƒ½åœ¨è¿™ä¸ªç›®å½•ä¸­è¿›è¡Œå±‚çº§ç»„ç»‡ã€‚ä¾‹å¦‚ï¼Œ/homeã€/etcã€/var ç­‰éƒ½æºè‡ªäºæ ¹ç›®å½•ã€‚ bin å­˜æ”¾åŸºæœ¬çš„ç”¨æˆ·å‘½ä»¤å’Œç³»ç»Ÿå·¥å…·ï¼Œå¦‚ lsã€cp å’Œ mv ç­‰ã€‚è¿™äº›å‘½ä»¤æ˜¯ç³»ç»Ÿå¯åŠ¨å’Œæ“ä½œçš„å¿…è¦ç»„æˆéƒ¨åˆ†ã€‚ etc åŒ…å«ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ã€‚æ¯”å¦‚ï¼Œ/etc/fstab æ–‡ä»¶ä¸­å®šä¹‰äº†ç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹ï¼Œ/etc/hosts æ–‡ä»¶ç”¨äº DNS æŸ¥æ‰¾ã€‚ home æ¯ä¸ªç”¨æˆ·çš„ä¸ªäººç›®å½•éƒ½åœ¨æ­¤ç›®å½•ä¸‹ï¼Œç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œå­˜å‚¨è‡ªå·±çš„æ–‡æ¡£ã€è®¾ç½®å’Œé…ç½®ã€‚ä¾‹å¦‚ï¼Œ/home/username æ˜¯ç”¨æˆ· username çš„ä¸“å±ç©ºé—´ã€‚ lib å­˜æ”¾ç³»ç»Ÿè¿è¡Œæ‰€éœ€çš„å…±äº«åº“æ–‡ä»¶ï¼Œè¿™äº›åº“æ”¯æŒ /bin å’Œ /sbin ç›®å½•ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œ/lib/x86_64-linux-gnu/libc.so.6 æ˜¯å¸¸ç”¨çš„ C æ ‡å‡†åº“ã€‚ usr å­˜å‚¨ç”¨æˆ·ç¨‹åºå’Œæ•°æ®çš„ç›®å½•ï¼Œé€šå¸¸åŒ…å«è®¸å¤šé‡è¦çš„åº”ç”¨ç¨‹åºå’Œå·¥å…·ã€‚ä¾‹å¦‚ï¼Œ/usr/bin ç›®å½•ä¸­æ”¾ç½®äº†è®¸å¤šç”¨æˆ·å¯ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¦‚ gitã€python å’Œå…¶ä»–åº”ç”¨ç¨‹åºã€‚ var å­˜æ”¾ç»å¸¸å˜åŒ–çš„æ•°æ®ï¼Œä¾‹å¦‚æ—¥å¿—æ–‡ä»¶ (/var/log)ã€é‚®ä»¶ (/var/mail)ã€ç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶ã€‚æ—¥å¿—æ–‡ä»¶æœ‰åŠ©äºç³»ç»Ÿç®¡ç†å‘˜æ’æŸ¥é—®é¢˜ã€‚ tmp ç”¨äºå­˜æ”¾ä¸´æ—¶æ–‡ä»¶ï¼Œç³»ç»Ÿé‡å¯åä¼šè¢«æ¸…ç©ºã€‚æ¯”å¦‚ï¼Œå®‰è£…è½¯ä»¶æ—¶å¯èƒ½éœ€è¦åœ¨æ­¤ç›®å½•ä¸­å†™å…¥ä¸­é—´æ–‡ä»¶ã€‚ ä¸¾ä¾‹è¯´æ˜å‡è®¾æ˜¯ä¸€åç³»ç»Ÿç®¡ç†å‘˜ï¼Œéœ€è¦æ£€æŸ¥ç”¨æˆ·çš„ç™»å½•è®°å½•ã€‚çŸ¥é“ç™»å½•è®°å½•å­˜æ”¾åœ¨ /var/log/wtmp æ–‡ä»¶ä¸­ã€‚å¯ä»¥ä½¿ç”¨ last å‘½ä»¤æŸ¥çœ‹è¿™äº›è®°å½•ï¼Œè€Œ last å‘½ä»¤ä¼šä»è¯¥æ–‡ä»¶ä¸­æå–ä¿¡æ¯ï¼Œåˆ—å‡ºæ‰€æœ‰ç”¨æˆ·çš„ç™»å½•æ—¶é—´å’ŒæŒç»­æ—¶é•¿ã€‚ è¿™ç§æ¸…æ™°çš„ç›®å½•ç»“æ„ä¸ä»…ä½¿ç³»ç»Ÿçš„ç®¡ç†å˜å¾—ç®€å•æ˜äº†ï¼Œä¹Ÿæœ‰åŠ©äºæå‡å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å› æ­¤ï¼Œäº†è§£è¿™äº›ç›®å½•çš„ç”¨é€”å¯¹äºä»»ä½•ä½¿ç”¨æˆ–ç®¡ç† Linux ç³»ç»Ÿçš„äººæ¥è¯´éƒ½æ˜¯è‡³å…³é‡è¦çš„ã€‚ é‡ç½® root å¯†ç åœ¨è¿›è¡Œç³»ç»Ÿçš„å®‰å…¨ç®¡ç†æ—¶ï¼Œé‡ç½® root å¯†ç æ˜¯ä¸€é¡¹é‡è¦çš„æŠ€èƒ½ã€‚å¦‚æœå‘ç°è‡ªå·±å¿˜è®°äº† root ç”¨æˆ·çš„å¯†ç ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œé‡ç½®ã€‚ æ­¥éª¤å¦‚ä¸‹ï¼š å¯åŠ¨è®¡ç®—æœºåœ¨è®¡ç®—æœºå¯åŠ¨æ—¶ï¼Œæ³¨æ„è§‚å¯Ÿ GRUB å¼•å¯¼åŠ è½½å™¨çš„ç•Œé¢ã€‚è¿™ä¸ªç•Œé¢é€šå¸¸ä¼šæ˜¾ç¤ºå¤šä¸ªå¯åŠ¨é€‰é¡¹ï¼Œå°¤å…¶æ˜¯åœ¨æœ‰å¤šä¸ªæ“ä½œç³»ç»Ÿæ—¶ã€‚ è¿›å…¥ç¼–è¾‘æ¨¡å¼å½“ GRUB åŠ è½½å‡ºç°åœ¨å±å¹•ä¸Šæ—¶ï¼Œé€‰æ‹©æƒ³è¦å¯åŠ¨çš„å†…æ ¸é€‰é¡¹ï¼Œç„¶åæŒ‰ä¸‹ e é”®ã€‚è¿™å°†ä½¿è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œä¼šçœ‹åˆ°å‡ ä¸ªå‚æ•°é…ç½®ã€‚ ä¿®æ”¹å¯åŠ¨å‚æ•°æ‰¾åˆ°åŒ…å«â€roâ€ï¼ˆåªè¯»ï¼‰å­—æ¯çš„è¡Œï¼Œé€šå¸¸æ˜¯ä»¥â€linuxâ€å¼€å¤´çš„è¡Œã€‚å°†â€roâ€æ›´æ”¹ä¸ºâ€rwâ€ï¼Œè¿™æ ·å¯ä»¥è®©ç³»ç»Ÿä»¥è¯»å†™æ–¹å¼å¯åŠ¨ã€‚ç„¶ååœ¨è¿™ä¸€è¡Œçš„æœ«å°¾æ·»åŠ  init=/bin/bashã€‚è¿™ä¸€æ­¥æ˜¯ä¸ºäº†è®©ç³»ç»Ÿè¿›å…¥ä¸€ä¸ªå¸¦æœ‰ bash çš„ç´§æ€¥æ¨¡å¼ï¼Œæ–¹ä¾¿é‡ç½®å¯†ç ã€‚ ç¤ºä¾‹ï¼š linux /vmlinuz-xxx ro quiet ä¿®æ”¹ä¸ºï¼š linux /vmlinuz-xxx rw init=/bin/bash å¯åŠ¨ä¿®æ”¹åçš„å†…æ ¸ä¿®æ”¹å®Œåï¼ŒæŒ‰ä¸‹ Ctrl+x æˆ– F10 æ¥å¯åŠ¨ç³»ç»Ÿã€‚æ­¤æ—¶ï¼Œç³»ç»Ÿä¼šè¿›å…¥ bash å‘½ä»¤è¡Œç•Œé¢ã€‚ æ›´æ–° root å¯†ç åœ¨ bash å‘½ä»¤è¡Œç•Œé¢ä¸­ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥æ›´æ–° root ç”¨æˆ·çš„å¯†ç ï¼š passwd ç³»ç»Ÿä¼šæç¤ºè¾“å…¥æ–°çš„å¯†ç ã€‚è¯·åŠ¡å¿…é€‰æ‹©ä¸€ä¸ªå¼ºå¯†ç ï¼Œæœ€å¥½åŒ…å«å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ã€‚ç¡®è®¤è¾“å…¥åï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºå¯†ç å·²æˆåŠŸæ›´æ–°çš„æ¶ˆæ¯ã€‚ é‡å¯ç³»ç»Ÿæ›´æ–°å®Œå¯†ç åï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ä»¥é‡å¯ç³»ç»Ÿï¼š exec /sbin/init æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼š reboot ä½¿ç”¨æ–°å¯†ç ç™»å½•ç³»ç»Ÿé‡å¯åï¼Œä½¿ç”¨åˆšåˆšè®¾ç½®çš„æ–°å¯†ç è¿›è¡Œç™»å½•ã€‚ å®Œæˆè¿™äº›æ­¥éª¤åï¼ŒæˆåŠŸåœ°é‡ç½®äº† root å¯†ç ï¼Œèƒ½å¤Ÿé¡ºåˆ©è®¿é—®ç³»ç»Ÿã€‚åŠ¡å¿…æ³¨æ„ï¼Œé‡ç½® root å¯†ç éœ€è¦ä¸€å®šçš„æƒé™ï¼Œå› æ­¤è¯·ç¡®ä¿æ˜¯ç³»ç»Ÿçš„åˆæ³•ç®¡ç†å‘˜ã€‚ åˆå§‹åŒ–è¿›ç¨‹åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå¯åŠ¨è¿‡ç¨‹æ˜¯ä¸€ä¸ªå¤æ‚è€Œåˆé‡è¦çš„æµç¨‹ï¼Œæ¶‰åŠå¤šä¸ªé˜¶æ®µå’Œç»„ä»¶ã€‚æ•´ä¸ªå¯åŠ¨è¿‡ç¨‹é€šå¸¸éµå¾ªä»¥ä¸‹é¡ºåºï¼š BIOSï¼šè®¡ç®—æœºå¼€æœºæ—¶ï¼Œé¦–å…ˆä¼šé€šè¿‡ BIOSï¼ˆåŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿï¼‰è¿›è¡Œç¡¬ä»¶è‡ªæ£€å¹¶åˆå§‹åŒ–ç¡¬ä»¶ç»„ä»¶ã€‚ BootLoaderï¼šå®Œæˆç¡¬ä»¶åˆå§‹åŒ–åï¼ŒBIOS å°†æ§åˆ¶æƒäº¤ç»™ BootLoaderï¼ˆå¼•å¯¼åŠ è½½ç¨‹åºï¼‰ï¼Œä¾‹å¦‚ GRUBã€‚BootLoader è´Ÿè´£åŠ è½½æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚ åŠ è½½ç³»ç»Ÿå†…æ ¸ï¼šBootLoader åŠ è½½ Linux å†…æ ¸åˆ°å†…å­˜ä¸­ã€‚ å†…æ ¸åˆå§‹åŒ–ï¼šå†…æ ¸å¼€å§‹åˆå§‹åŒ–ç³»ç»Ÿç¡¬ä»¶ï¼ˆå¦‚ CPUã€å†…å­˜ã€ç¡¬ç›˜ç­‰ï¼‰ï¼Œå¹¶å‡†å¤‡è¿›è¡Œç”¨æˆ·ç©ºé—´çš„è¿è¡Œã€‚ å¯åŠ¨åˆå§‹åŒ–è¿›ç¨‹ï¼šå†…æ ¸å¯åŠ¨ç¬¬ä¸€ä¸ªç”¨æˆ·ç©ºé—´è¿›ç¨‹ï¼Œé€šå¸¸æ˜¯ initï¼Œè¿™æ—¶ Linux ç³»ç»Ÿçš„åˆå§‹åŒ–å·¥ä½œæ­£å¼å¼€å§‹ã€‚ åˆå§‹åŒ–è¿›ç¨‹åˆå§‹åŒ–è¿›ç¨‹æ˜¯ Linux ç³»ç»Ÿä¸­ç¬¬ä¸€ä¸ªè¢«åˆ›å»ºçš„è¿›ç¨‹ï¼Œå…¶è¿›ç¨‹ IDï¼ˆPIDï¼‰ä¸º 1ã€‚å®ƒçš„ä¸»è¦ä»»åŠ¡æ˜¯å®Œæˆå„ç§åˆå§‹åŒ–å·¥ä½œï¼Œä»¥ç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿæ‹¥æœ‰ä¸€ä¸ªç¨³å®šå’Œå¯ç”¨çš„å·¥ä½œç¯å¢ƒã€‚åœ¨ç°ä»£ Linux ç³»ç»Ÿä¸­ï¼Œsystemd å–ä»£äº†ä¼ ç»Ÿçš„ System V initï¼Œå¼•å…¥äº†ä¸€äº›æ›´ä¸ºé«˜æ•ˆå’Œçµæ´»çš„ç‰¹æ€§ã€‚ åˆå§‹åŒ–è¿›ç¨‹æœåŠ¡ç±»å‹System V initSystem V init é‡‡ç”¨ä¼ ç»Ÿçš„è¿è¡Œçº§åˆ«ï¼ˆrunlevelï¼‰æœºåˆ¶ï¼Œæ¯ä¸ªè¿è¡Œçº§åˆ«å®šä¹‰äº†ç³»ç»Ÿä¸åŒçš„çŠ¶æ€å’Œå¯ç”¨çš„æœåŠ¡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„è¿è¡Œçº§åˆ«åŠå…¶å¯¹åº”çš„ Systemd ç›®æ ‡åç§°å’Œä½œç”¨ï¼š System V Init è¿è¡Œçº§åˆ« Systemd ç›®æ ‡åç§° ä½œç”¨ 0 runlevel0.target, poweroff.target å…³æœº 1 runlevel1.target, rescue.target å•ç”¨æˆ·æ¨¡å¼ 2 runlevel2.target, multiuser.target ç­‰åŒäºçº§åˆ« 3 3 runlevel3.target, multiuser.target å¤šç”¨æˆ·çš„æ–‡æœ¬ç•Œé¢ 4 runlevel4.target, multiuser.target ç­‰åŒäºçº§åˆ« 3 5 runlevel5.target, graphical.target å¤šç”¨æˆ·çš„å›¾å½¢ç•Œé¢ 6 runlevel6.target, reboot.target é‡å¯ emergency emergency.target ç´§æ€¥ Shell systemdä¸ System V init ä¸åŒï¼Œsystemd é‡‡ç”¨å¹¶å‘å¯åŠ¨æœºåˆ¶ï¼Œèƒ½å¤Ÿå¹¶è¡Œå¯åŠ¨å¤šä¸ªæœåŠ¡ï¼Œä»è€Œæ˜¾è‘—åŠ å¿«å¯åŠ¨è¿‡ç¨‹ã€‚systemd ä½¿ç”¨ç›®æ ‡ï¼ˆtargetï¼‰æ¥æ›¿ä»£ä¼ ç»Ÿçš„è¿è¡Œçº§åˆ«ï¼Œæä¾›äº†æ›´çµæ´»çš„æœåŠ¡ç®¡ç†åŠŸèƒ½ã€‚ .systemctl å’Œ System V init çš„å¯¹æ¯”systemctl æ˜¯ systemd çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç†ç³»ç»ŸæœåŠ¡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ System V init å‘½ä»¤ä¸ç›¸åº”çš„ systemctl å‘½ä»¤çš„å¯¹æ¯”ï¼š System V init å‘½ä»¤ systemctl å‘½ä»¤ ä½œç”¨ service foo start systemctl start foo.service å¯åŠ¨æœåŠ¡ service foo restart systemctl restart foo.service é‡å¯æœåŠ¡ service foo stop systemctl stop foo.service åœæ­¢æœåŠ¡ service foo reload systemctl reload foo.service é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼ˆä¸ç»ˆæ­¢æœåŠ¡ï¼‰ service foo status systemctl status foo.service æŸ¥çœ‹æœåŠ¡çŠ¶æ€ chkconfig foo on systemctl enable foo.service å¼€æœºè‡ªåŠ¨å¯åŠ¨ chkconfig foo off systemctl disable foo.service å¼€æœºä¸è‡ªåŠ¨å¯åŠ¨ chkconfig foo systemctl is-enabled foo.service æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ˜¯å¦ä¸ºå¼€æœºè‡ªå¯åŠ¨ chkconfig â€“list systemctl list-unit-files â€“typeservice æŸ¥çœ‹å„ä¸ªçº§åˆ«ä¸‹æœåŠ¡çš„å¯åŠ¨ä¸ç¦ç”¨æƒ…å†µ é€šè¿‡ä½¿ç”¨ systemd å’Œ systemctlï¼Œç”¨æˆ·èƒ½å¤Ÿæ›´é«˜æ•ˆåœ°ç®¡ç†æœåŠ¡å’Œç³»ç»ŸçŠ¶æ€ï¼ŒåŒæ—¶ä¹Ÿç®€åŒ–äº†æœåŠ¡çš„æ§åˆ¶å’Œé…ç½®ã€‚ åŸºäº ARM ä½“ç³»çš„å†…æ ¸å¯åŠ¨è§£æBootloader çš„åŸºæœ¬åˆå§‹åŒ–å‡†å¤‡åœ¨å†…æ ¸è¢«å¼•å¯¼åŠ è½½ä¹‹å‰ï¼ŒBootloader å¿…é¡»å®Œæˆä»¥ä¸‹æ ¸å¿ƒä»»åŠ¡ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿé¡ºåˆ©å¯åŠ¨ã€‚ 1. è®¾ç½®å¹¶åˆå§‹åŒ– RAM (å¿…é¡»)å¼•å¯¼åŠ è½½ç¨‹åºå¿…é¡»æ‰¾åˆ°å¹¶åˆå§‹åŒ–ç³»ç»Ÿçš„æ‰€æœ‰ RAMï¼Œä»¥ä¾¿å®ƒå¯ä»¥ç”¨äºå­˜å‚¨æ˜“å¤±æ€§æ•°æ®ã€‚è¿™ä¸€è¿‡ç¨‹å–å†³äºæœºå™¨æ¶æ„ã€‚å¼•å¯¼åŠ è½½ç¨‹åºå¯ä»¥é‡‡ç”¨å†…éƒ¨ç®—æ³•è‡ªåŠ¨ç¡®å®š RAM çš„å¤§å°ï¼Œæˆ–è€…åˆ©ç”¨æœºå™¨çš„å·²çŸ¥ç‰¹æ€§æ¥å®Œæˆåˆå§‹åŒ–ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæŸäº› ARM è®¾å¤‡ï¼Œå¼•å¯¼åŠ è½½ç¨‹åºå¯èƒ½ä¼šè¯»å–ç¡¬ä»¶æä¾›çš„ RAM æ‰©å±•ä¿¡æ¯ï¼Œä»è€Œç¡®å®šå¯ç”¨çš„å†…å­˜èŒƒå›´ã€‚ 2. è®¾ç½®è®¾å¤‡æ ‘ dtb (å¿…é¡»)è®¾å¤‡æ ‘ Blobï¼ˆdtbï¼‰å¿…é¡»æŒ‰ç…§ 8 å­—èŠ‚å¯¹é½ï¼Œä¸”æœ€å¤§ä¸èƒ½è¶…è¿‡ 2 å…†å­—èŠ‚ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿è®¾å¤‡æ ‘èƒ½å¤Ÿè¢«æœ‰æ•ˆåœ°æ˜ å°„åˆ°ç³»ç»Ÿä¸­ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ v4.2 ä¹‹å‰çš„ç‰ˆæœ¬è¦æ±‚ dtb æ”¾ç½®åœ¨ 512 MB åŒºåŸŸå†…ã€‚æ‰€ä»¥ï¼Œåœ¨ç”¨æˆ·è®¾è®¡ç³»ç»Ÿæ—¶ï¼Œéœ€è¦å®¡æ ¸ dtb çš„ä½ç½®å’Œå¤§å°ï¼Œä»¥é¿å…åˆå§‹åŒ–å¤±è´¥ã€‚ 3. è§£å‹ç¼©å†…æ ¸æ˜ åƒ (å¯é€‰)ç›®å‰ AArch64 å†…æ ¸æ²¡æœ‰æä¾›å†…ç½®çš„è§£å‹ç¼©å™¨ï¼Œè¿™æ„å‘³ç€å¦‚æœä½¿ç”¨å‹ç¼©çš„å†…æ ¸æ˜ åƒï¼ˆå¦‚ Image.gzï¼‰ï¼Œå¼•å¯¼åŠ è½½ç¨‹åºå¿…é¡»è´Ÿè´£è§£å‹ã€‚å¯¹äºé‚£äº›æ²¡æœ‰å®ç°æ­¤åŠŸèƒ½çš„å¼•å¯¼åŠ è½½ç¨‹åºï¼Œå¯ä»¥é€‰æ‹©ç¼–è¯‘ä¸€ä¸ªä¸å‹ç¼©çš„å†…æ ¸æ˜ åƒã€‚ 4. è°ƒç”¨å†…æ ¸æ˜ åƒ (å¿…é¡»)å†…æ ¸æ˜ åƒçš„å¤´éƒ¨åŒ…å«å¤šé¡¹å¿…è¦çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š u32 code0; /* å¯æ‰§è¡Œä»£ç  */u32 code1; /* å¯æ‰§è¡Œä»£ç  */u64 text_offset; /* åŠ è½½åç§»ï¼Œå°ç«¯ */u64 image_size; /* æœ‰æ•ˆæ˜ åƒå°ºå¯¸ï¼Œå°ç«¯ */u64 flags; /* å†…æ ¸æ ‡å¿—, å°ç«¯ */ è¿›å…¥å†…æ ¸è¿›å…¥å†…æ ¸ä¹‹å‰ï¼Œå¿…é¡»æ»¡è¶³ä¸€ç³»åˆ—å…³é”®æ€§æ¡ä»¶ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šå’Œå®‰å…¨æ€§ã€‚ä¸‹é¢æ˜¯è¿™äº›æ¡ä»¶çš„è¯¦ç»†è¯´æ˜ï¼š ç¦æ­¢ DMA åŠŸèƒ½çš„è®¾å¤‡ä¸ºäº†é˜²æ­¢å†…å­˜å› è™šå‡çš„ç½‘ç»œæ•°æ®åŒ…æˆ–æŸåçš„ç£ç›˜æ•°æ®è€Œè¢«æ„å¤–æŸåï¼Œæ‰€æœ‰å…·æœ‰ DMAï¼ˆç›´æ¥å†…å­˜è®¿é—®ï¼‰åŠŸèƒ½çš„è®¾å¤‡å¿…é¡»è¢«ç¦ç”¨ã€‚ä¾‹å¦‚ï¼Œç½‘ç»œé€‚é…å™¨æˆ–å­˜å‚¨æ§åˆ¶å™¨åœ¨å†…æ ¸åŠ è½½å‰éƒ½åº”åœæ­¢æ•°æ®ä¼ è¾“ï¼Œä»¥é¿å…ä¸åˆè§„æ“ä½œé€ æˆçš„å†…å­˜æ±¡æŸ“ã€‚ ä¸» CPU é€šç”¨å¯„å­˜å™¨è®¾ç½®ä¸» CPU çš„é€šç”¨å¯„å­˜å™¨å¿…é¡»è¿›è¡Œç‰¹å®šçš„åˆå§‹åŒ–ã€‚å…·ä½“è®¾ç½®å¦‚ä¸‹ï¼š x0ï¼šéœ€è®¾ç½®ä¸ºç³»ç»Ÿ RAM ä¸­è®¾å¤‡æ ‘ Blobï¼ˆDevice Tree Blobï¼Œç®€ç§° dtbï¼‰çš„ç‰©ç†åœ°å€ã€‚è¿™ä¸€åœ°å€å¯¹äºå†…æ ¸åˆå§‹åŒ–è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒæä¾›äº†ç³»ç»Ÿç¡¬ä»¶çš„æè¿°ä¿¡æ¯ã€‚ x1x2x3ï¼šåº”è®¾ç½®ä¸º 0ï¼Œé¢„ç•™ä¾›å°†æ¥ä½¿ç”¨ã€‚è¿™é€šå¸¸æ„å‘³ç€ç›®å‰æœªå®šä¹‰çš„åŠŸèƒ½å¯ä»¥åœ¨å°†æ¥è¿›è¡Œæ‰©å±•å’Œä¼˜åŒ–ã€‚ CPU æ¨¡å¼åœ¨ CPU æ¨¡å¼æ–¹é¢ï¼Œä»¥ä¸‹è¦æ±‚å¿…é¡»å¾—åˆ°æ»¡è¶³ï¼š æ‰€æœ‰å½¢å¼çš„ä¸­æ–­éƒ½è¦åœ¨ PSTATE.DAIF ä¸­å±è”½ã€‚è¿™åŒ…æ‹¬è°ƒè¯•ä¸­æ–­ï¼ˆDebugï¼‰ï¼Œç³»ç»Ÿé”™è¯¯ï¼ˆSErrorï¼‰ï¼Œæ ‡å‡†ä¸­æ–­ï¼ˆIRQï¼‰å’Œå¿«é€Ÿä¸­æ–­ï¼ˆFIQï¼‰ã€‚é€šè¿‡é˜»æ­¢è¿™äº›ä¸­æ–­ï¼Œç³»ç»Ÿå¯ä»¥ä¸“æ³¨äºå†…æ ¸çš„å®‰å…¨åŠ è½½ã€‚ CPU å¿…é¡»åœ¨ EL2ï¼ˆå¼‚å¸¸çº§åˆ« 2ï¼‰æˆ–éå®‰å…¨çš„ EL1 ä¸‹è¿è¡Œã€‚é€‰æ‹© EL2 ä½œä¸ºæ¨èæ¨¡å¼æ˜¯å› ä¸ºè¿™ä¸ºè™šæ‹ŸåŒ–æ‰©å±•æä¾›äº†è®¿é—®æƒé™ï¼Œè¿™å¯¹äºç°ä»£ç³»ç»Ÿè‡³å…³é‡è¦ã€‚ Caches å’Œ MMUs MMUï¼ˆå†…å­˜ç®¡ç†å•å…ƒï¼‰å¿…é¡»å…³é—­ã€‚è¿™æ˜¯ç¡®ä¿å†…æ ¸èƒ½å¤Ÿå‡†ç¡®ç®¡ç†å†…å­˜æ˜ å°„çš„é‡è¦æ­¥éª¤ã€‚ æŒ‡ä»¤ç¼“å­˜å¯ä»¥é€‰æ‹©å¼€å¯æˆ–å…³é—­ï¼Œæ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯æ¥å†³å®šã€‚ ä¸åŠ è½½çš„å†…æ ¸æ˜ åƒç›¸å¯¹åº”çš„åœ°å€èŒƒå›´å¿…é¡»è¢«æ¸…é™¤åˆ° PoCï¼ˆä¸€è‡´æ€§ç‚¹ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŸä¸ªè®¾å¤‡æ­£åœ¨ä½¿ç”¨ç³»ç»Ÿç¼“å­˜ï¼Œè¿™äº›ç¼“å­˜å¿…é¡»ç¡®ä¿åœ¨å†…æ ¸åŠ è½½ä¹‹å‰å¤„äºå¹²å‡€çŠ¶æ€ã€‚ è‹¥å­˜åœ¨ç³»ç»Ÿç¼“å­˜æˆ–å¯ç”¨äº†ç¼“å­˜çš„å…¶ä»–ç›¸å…³ä¸»æœåŠ¡å™¨ï¼Œæ“ä½œæ—¶é€šå¸¸åº”é€šè¿‡è™šæ‹Ÿåœ°å€ï¼ˆVAï¼‰ç»´æŠ¤ç¼“å­˜ï¼Œè€Œéç›´æ¥é€šè¿‡ç‰©ç†åœ°å€ã€‚ æ¶æ„å®šæ—¶å™¨åœ¨å†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰ CPU ä¸Šçš„è®¡æ—¶å™¨å¿…é¡»æ ¹æ®å…¶é¢‘ç‡è®¾ç½® CNTFRQï¼Œå¹¶ä¸”å¿…é¡»ä¸€è‡´åœ°è®¾ç½® CNTVOFFã€‚å¦‚æœå†…æ ¸åœ¨ EL1 çº§åˆ«å¯åŠ¨ï¼Œåˆ™ CNTHCTL_EL2 çš„ EL1PCTEN ä½ï¼ˆå³ä½ 0ï¼‰å¿…é¡»åœ¨å¯ç”¨æ—¶è¢«è®¾ç½®ã€‚ è¿è´¯æ€§å½“å†…æ ¸å¯åŠ¨æ—¶ï¼Œæ‰€æœ‰ç”±å†…æ ¸å¼•å¯¼çš„ CPU å¿…é¡»å±äºåŒä¸€ä¸€è‡´æ€§åŸŸã€‚è¿™ä¸€è¦æ±‚ç¡®ä¿äº† CPU ä¹‹é—´åœ¨è®¿é—®å…±äº«å†…å­˜æ—¶çš„ä¸€è‡´æ€§ï¼Œé¿å…äº†æ½œåœ¨çš„æ•°æ®æŸåã€‚åˆå§‹åŒ–æ—¶ï¼Œæ¯ä¸ª CPU çš„ç»´æŠ¤æ“ä½œå¿…é¡»é€šè¿‡å®šä¹‰çš„å®ç°è¿›è¡Œã€‚ ç³»ç»Ÿå¯„å­˜å™¨æ‰€æœ‰å¤„äºå¼‚å¸¸çº§åˆ«çš„å¯å†™æ¶æ„ç³»ç»Ÿå¯„å­˜å™¨éƒ½å¿…é¡»ç”±æ›´é«˜å¼‚å¸¸çº§åˆ«çš„è½¯ä»¶åˆå§‹åŒ–ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢åœ¨ UNKNOWN çŠ¶æ€ä¸‹æ‰§è¡Œï¼Œé¿å…å‡ºç°æ— æ³•é¢„çŸ¥çš„ç³»ç»Ÿè¡Œä¸ºã€‚ CPU è¿›å…¥å†…æ ¸çš„æ¡ä»¶ æ‰€æœ‰ CPU å¿…é¡»ä»¥ç›¸åŒçš„å¼‚å¸¸çº§åˆ«è¿›å…¥å†…æ ¸ã€‚ ä¸» CPU ç›´æ¥è·³è½¬åˆ°å†…æ ¸æ˜ åƒçš„ç¬¬ä¸€æ¡æŒ‡ä»¤ï¼Œä»¥ç¡®ä¿é«˜æ•ˆå’Œè¿…é€Ÿçš„å¯åŠ¨è¿‡ç¨‹ã€‚ ä¸» CPU è¿˜éœ€ä¿è¯ä¼ é€’çš„è®¾å¤‡æ ‘ Blobï¼Œå¯¹äºæ¯ä¸ª CPU èŠ‚ç‚¹åŒ…å«ä¸€ä¸ªâ€å¯ç”¨æ–¹æ³•â€å±æ€§ã€‚æ”¯æŒçš„å¯ç”¨æ–¹æ³•å¦‚ä¸‹æ‰€è¿°ï¼Œä¸”è¿™äº›å±æ€§ç”±å¼•å¯¼åŠ è½½ç¨‹åºç”Ÿæˆï¼Œå¹¶åœ¨å†…æ ¸å…¥å£ä¹‹å‰æ’å…¥åˆ° blob ä¸­ã€‚ å¯ç”¨æ–¹æ³•ç¤ºä¾‹ æ—‹è½¬è¡¨ï¼ˆRotation Tableï¼‰å¯ç”¨æ–¹æ³•çš„ CPUï¼Œå…¶ cpu èŠ‚ç‚¹å¿…é¡»åŒ…å«â€cpu-release-addrâ€å±æ€§ã€‚æ­¤å±æ€§æŒ‡å‘ä¸€ä¸ªè‡ªç„¶å¯¹é½çš„ 64 ä½é›¶åˆå§‹åŒ–å†…å­˜ä½ç½®ï¼Œç”¨äº CPU çš„å®‰å…¨å¯ç”¨ã€‚ psciï¼ˆPower State Coordination Interfaceï¼‰å¯ç”¨æ–¹æ³•çš„ CPU åº”è¯¥åœ¨å†…æ ¸å¤–éƒ¨ä¿ç•™ï¼Œç¡®ä¿å…¶åœ¨å†…å­˜èŠ‚ç‚¹ä¹‹å¤–æˆ–é€šè¿‡ /memreserve/ æè¿°ç»™å†…æ ¸çš„å†…å­˜åŒºåŸŸã€‚ æ­¤å¤–ï¼Œå†…æ ¸å°†æ ¹æ® ARM æ–‡æ¡£ç¼–å· ARM DEN 0022A çš„è¯´æ˜å‘å‡º CPU_ON è°ƒç”¨ï¼Œä»¥å°† CPU å¼•å…¥å†…æ ¸ï¼Œç¡®ä¿ç³»ç»Ÿæ•´åˆçš„é¡ºç•…ã€‚ ç¬¬äºŒ CPU é€šç”¨å¯„å­˜å™¨è®¾ç½®å¯¹äºç¬¬äºŒä¸ª CPUï¼Œé€šç”¨å¯„å­˜å™¨ x0x1x2x3 éƒ½åº”è®¾ç½®ä¸º 0ï¼Œè¿›ä¸€æ­¥é¢„ç•™ä»¥ä¾¿æœªæ¥ä½¿ç”¨ã€‚ é€šè¿‡ç¡®ä¿ä¸Šè¿°æ‰€æœ‰æ¡ä»¶éƒ½å¾—ä»¥æ»¡è¶³ï¼Œå†…æ ¸èƒ½å¤Ÿåœ¨ä¸€ä¸ªå®‰å…¨ã€ç¨³å®šçš„ç¯å¢ƒä¸­é¡ºåˆ©å¯åŠ¨ï¼Œè¿›è€Œè¿›è¡Œåç»­æ“ä½œã€‚ å†…æ ¸å¯åŠ¨ init æ€»è¿‡ç¨‹å†…æ ¸å¯åŠ¨æœ‰ä¸¤ç§ä¸»è¦æ–¹å¼ï¼šå‹ç¼©æ ¼å¼å’Œä¸å‹ç¼©æ ¼å¼ã€‚åœ¨å‹ç¼©æ¨¡å¼ä¸‹ï¼Œå†…æ ¸çš„å…¥å£ä»£ç ä½äº arch/æ¶æ„å/boot/compressed/head.Sã€‚è¿™æ®µä»£ç çš„ä¸»è¦èŒè´£æ˜¯è¿›è¡Œå‰æœŸåˆå§‹åŒ–ï¼Œå‡†å¤‡å·¥ä½œæ˜¯è§£å‹å†…æ ¸å¹¶ä¸ºåç»­çš„å¯åŠ¨åšå¥½åŸºç¡€ç¯å¢ƒã€‚ ä¸€æ—¦è§£å‹å®Œæˆï¼Œæ§åˆ¶ä¾¿ä¼šè·³è½¬åˆ° arch/æ¶æ„å/kernel/head.Sï¼Œæ­¤å¤„åˆ™å¼€å§‹æ­£å¼å¯åŠ¨å†…æ ¸ã€‚è¿™ä¸€è¿‡ç¨‹ä¸­çš„æ¯ä¸€æ­¥éƒ½è‡³å…³é‡è¦ï¼Œå®ƒä¸ä»…å†³å®šäº†ç³»ç»Ÿçš„å¯åŠ¨æ•ˆç‡ï¼Œä¹Ÿç›´æ¥å…³ç³»åˆ°ç³»ç»Ÿèƒ½å¦æˆåŠŸè¿›å…¥æ­£å¸¸è¿è¡ŒçŠ¶æ€ã€‚ æœ¬æ–‡ä¸“æ³¨äºä¸å‹ç¼©æ–¹å¼çš„å†…æ ¸å¯åŠ¨è¿‡ç¨‹ã€‚é€šè¿‡å¯¹å†…æ ¸ä»£ç çš„é€è¡Œè§£æï¼Œèƒ½å¤Ÿæ•´ç†å‡ºå†…æ ¸å¯åŠ¨è¿‡ç¨‹çš„éƒ¨åˆ†é¡ºåºï¼Œä»¥å¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£è¿™ä¸€å¤æ‚çš„è¿‡ç¨‹ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€åŒ–çš„ä¸å‹ç¼©å¯åŠ¨è¿‡ç¨‹çš„æ¦‚è¿°ï¼š **å¼•å¯¼åŠ è½½ç¨‹åº(bootloader)**ï¼šé¦–å…ˆï¼Œç³»ç»Ÿçš„å¼•å¯¼åŠ è½½ç¨‹åºä¼šè¢«åŠ è½½åˆ°å†…å­˜ã€‚è¿™æ˜¯å¯åŠ¨æµç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œå¼•å¯¼åŠ è½½ç¨‹åºè´Ÿè´£æŠŠå†…æ ¸æ˜ åƒåŠ è½½åˆ°å†…å­˜ä¸­ã€‚ä¾‹å¦‚ï¼ŒGRUBï¼ˆGRand Unified Bootloaderï¼‰å°±å¸¸ç”¨äºè¿™ç§æƒ…å¢ƒã€‚ å†…æ ¸å…¥å£ç‚¹ï¼šä»å¼•å¯¼åŠ è½½ç¨‹åºä¸­ï¼Œç³»ç»Ÿå°†æ§åˆ¶æƒè½¬äº¤ç»™å†…æ ¸çš„å…¥å£ç‚¹ï¼Œé€šå¸¸æ˜¯ start_kernelã€‚è¿™æ˜¯å†…æ ¸æ„è¯†åˆ°è‡ªèº«è¢«å¯åŠ¨çš„åœ°æ–¹ã€‚ å†…æ ¸åˆå§‹åŒ–ï¼šåœ¨ start_kernel ä¸­ï¼Œæ ¹æœ¬çš„åˆå§‹åŒ–è¿‡ç¨‹å’Œè®¾ç½®å·¥ä½œè¿›è¡Œï¼Œä¾‹å¦‚è®¾ç½®å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰ã€ä¸­æ–­ç³»ç»Ÿï¼Œä»¥åŠåˆå§‹åŒ–è°ƒåº¦å™¨ç­‰ã€‚è¿™ä¸€é˜¶æ®µç¡®ä¿å†…æ ¸èƒ½å¤Ÿå¤„ç†å¤šä»»åŠ¡ã€‚ å¯åŠ¨è¿›ç¨‹ï¼šç»è¿‡ä¸€ç³»åˆ—å¿…è¦çš„åˆå§‹åŒ–æ­¥éª¤åï¼Œå†…æ ¸ä¼šå¯åŠ¨ç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œé€šå¸¸æ˜¯ init è¿›ç¨‹ã€‚è¿™ä¸€è¿›ç¨‹çš„ PIDï¼ˆè¿›ç¨‹æ ‡è¯†ç¬¦ï¼‰ä¸º 1ï¼Œæ˜¯æ‰€æœ‰ç”¨æˆ·ç©ºé—´è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚init è¿›ç¨‹è´Ÿè´£å¯åŠ¨å…¶ä»–ç”¨æˆ·ç©ºé—´æœåŠ¡å’Œè¿›ç¨‹ã€‚ æ­£å¸¸è¿è¡Œï¼šå½“ init è¿›ç¨‹å®Œæˆå¯åŠ¨åï¼Œç³»ç»Ÿä¾¿è¿›å…¥åˆ°æ­£å¸¸çš„è¿è¡ŒçŠ¶æ€ï¼Œå„ç§æœåŠ¡å’Œåº”ç”¨ç¨‹åºå¼€å§‹æ­£å¸¸åŠ è½½ã€‚ å†…æ ¸å¯åŠ¨æµç¨‹è¯¦è§£å†…æ ¸çš„å¯åŠ¨è¿‡ç¨‹ä¸ U-Boot çš„å¯åŠ¨æ–¹å¼ç±»ä¼¼ï¼Œå‰æœŸåŒæ ·æ˜¯ç”±ä¸€æ®µæ±‡ç¼–ä»£ç å¼€å§‹ï¼Œéšåè·³è½¬è‡³ C ä»£ç çš„æ‰§è¡Œã€‚æ±‡ç¼–ä»£ç çš„å…¥å£ç‚¹ä½äº ./arm/kernel/head.S æ–‡ä»¶ä¸­ï¼Œç¬¦å·åä¸º __HEADï¼Œè¯¥æ–‡ä»¶è¿˜åŒ…å«äº† head-common.Sã€‚ ä»å¯åŠ¨ç”¨æˆ·ç©ºé—´çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ init æ¥çœ‹ï¼Œå¯ä»¥å°†è¿™ä¸€è¿‡ç¨‹å¤§è‡´åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š head.S å¤„ç†ï¼šè¯¥æ­¥éª¤ä¸»è¦è¿›è¡Œé€šç”¨ç¯å¢ƒçš„åˆå§‹åŒ–ï¼Œè¿™ä¸€éƒ¨åˆ†ä¸å…·ä½“çš„èŠ¯ç‰‡æ¶æ„æ— å…³ã€‚ start_kernel å‡½æ•°ï¼šå½“ head.S å®Œæˆåï¼Œæ§åˆ¶ä¼šè·³è½¬åˆ° start_kernel å‡½æ•°ã€‚è¿™ä¸€å‡½æ•°å®šä¹‰åœ¨ ./init/main.c ä¸­ã€‚ rest_init å‡½æ•°ï¼šåœ¨è¿™ä¸€é˜¶æ®µï¼Œå†…æ ¸ä¼šåˆ›å»º init è¿›ç¨‹å’Œ kthreadd è¿›ç¨‹ï¼Œå…¶ä¸­ init è¿›ç¨‹çš„è¿›ç¨‹å·ä¸º 1ï¼Œè€Œ kthreadd æ˜¯å†…æ ¸çš„çº¿ç¨‹ç®¡ç†è¿›ç¨‹ã€‚ å¯åŠ¨è°ƒåº¦å™¨ï¼šæ­¤æ—¶å†…æ ¸è°ƒåº¦å™¨å¼€å§‹è¿è¡Œï¼Œå¹¶æ‰§è¡Œ kernel_init å‡½æ•°ã€‚kernel_init å‡½æ•°ä¼šè°ƒç”¨åŒ…å«åœ¨æ ¹æ–‡ä»¶ç³»ç»Ÿä¸­çš„ init è¿›ç¨‹ï¼Œè‡³æ­¤ï¼Œç”¨æˆ·ç©ºé—´çš„ init è¿›ç¨‹å¯åŠ¨å®Œæˆã€‚ head.S å’Œ head-common.S çš„ä½œç”¨æ·±å…¥åˆ†ææ±‡ç¼–ä»£ç çš„åŠŸèƒ½æœ‰äº›ç¹çï¼Œä½†å¯ä»¥ç®€è¦æ€»ç»“å…¶ä¸»è¦ä½œç”¨ï¼š æ£€æŸ¥æ¶æ„ï¼šéªŒè¯å¤„ç†å™¨å’Œæœºå™¨ç±»å‹ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿæ­£ç¡®è¯†åˆ«ç›®æ ‡ç¡¬ä»¶ã€‚ é…ç½® MMUï¼šè®¾ç½®å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰ï¼Œæ„å»ºé¡µè¡¨æ¡ç›®ï¼Œå¹¶å¯ç”¨è™šæ‹Ÿå†…å­˜ã€‚MMU æ˜¯ç°ä»£è®¡ç®—æœºä¸­ç”¨äºç®¡ç†ç‰©ç†å†…å­˜çš„å…³é”®ç»„ä»¶ï¼Œå®ƒå…è®¸æ“ä½œç³»ç»Ÿä½¿ç”¨è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè®©ç¨‹åºå½¼æ­¤éš”ç¦»ã€‚ è°ƒç”¨ start_kernelï¼šåœ¨ init/main.c æ–‡ä»¶ä¸­æ‰§è¡Œ start_kernel å‡½æ•°ã€‚ æ‰€æœ‰æ¶æ„çš„ä»£ç æ˜¯ç›¸åŒçš„ï¼Œå› æ­¤ä½¿ç”¨æ±‡ç¼–è¯­è¨€å¯ä»¥é¿å…ä¸ºä¸åŒèŠ¯ç‰‡ç®¡ç†å¤§é‡é‡å¤çš„ä»£ç ã€‚ start_kernel é˜¶æ®µåœ¨ start_kernel å‡½æ•°ä¸­ï¼Œå†…éƒ¨ä¸»è¦å®Œæˆäº†ä»¥ä¸‹å·¥ä½œï¼š é”ä¾èµ–æ£€æµ‹æ¨¡å—åˆå§‹åŒ–ï¼šåˆå§‹åŒ– Lockdep æ¨¡å—ï¼Œä»¥é˜²æ­¢å†…æ ¸ä¸­å¯èƒ½å‡ºç°çš„æ­»é”ã€‚åœ¨ Lockdep ä¸­ï¼Œå½“é”è¢«è·å–æˆ–é‡Šæ”¾æ—¶ï¼Œä¼šè®°å½•ä¸‹è¿™ä¸€äº‹ä»¶ä»¥åŠç›¸å…³è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚å½“æ—¶å¤„ç†å™¨æ˜¯å¦æ­£åœ¨å¤„ç†ä¸­æ–­ã€‚ RCU æœºåˆ¶åˆå§‹åŒ–ï¼šRCUï¼ˆRead-Copy Updateï¼Œè¯»-æ‹·è´ä¿®æ”¹ï¼‰æ˜¯ä¸€ç§ä¼˜åŒ–å¹¶å‘è¯»å†™æ“ä½œçš„æœºåˆ¶ã€‚å®ƒå…è®¸è¯»è€…åœ¨ä¸è·å–é”çš„æƒ…å†µä¸‹è®¿é—®è¢«ä¿æŠ¤çš„æ•°æ®ç»“æ„ï¼Œè€Œå†™è€…åˆ™éœ€å…ˆæ‹·è´æ•°æ®ï¼Œç„¶åä¿®æ”¹å‰¯æœ¬ï¼Œæœ€ååœ¨é€‚å½“çš„æ—¶æœºæ›´æ–°æŒ‡é’ˆã€‚è¿™ç§æœºåˆ¶çš„æœ‰æ•ˆæ€§åœ¨äºæ‰€æœ‰ CPU å®Œæˆå¯¹å…±äº«æ•°æ®çš„æ“ä½œåï¼Œæ‰ä¼šæ›´æ–°æŒ‡é’ˆã€‚ SMP åˆå§‹åŒ–ï¼šå¯¹ç§°å¤šå¤„ç†ï¼ˆSMPï¼‰åˆå§‹åŒ–ï¼Œå®Œæˆ CPU ID çš„åˆ›å»ºï¼Œç¡®ä¿åœ¨å¤šæ ¸ç³»ç»Ÿä¸­å„æ ¸å¿ƒèƒ½æœ‰æ•ˆåœ°è°ƒåº¦å’Œè¿è¡Œæ“ä½œã€‚ è°ƒè¯•å¯¹è±¡çš„æ—©æœŸåˆå§‹åŒ–ï¼šè®¾ç½®è°ƒè¯•å¯¹è±¡ï¼Œç¡®ä¿å†…æ ¸è°ƒè¯•å¯ä»¥é¡ºåˆ©è¿›è¡Œã€‚ è§£æä» bootloader ä¼ å…¥çš„å¼•å¯¼å‘½ä»¤è¡Œï¼šè°ƒç”¨ setup_arch(command_line) å‡½æ•°ï¼Œåˆå§‹åŒ–æ§åˆ¶å°ä»¥æ‰“å°å¯åŠ¨æ—¥å¿—ï¼Œå¹¶è®¾ç½®å…¶ä»–å­ç³»ç»Ÿï¼Œå¦‚è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆVFSï¼‰ã€è·Ÿè¸ªï¼ˆtraceï¼‰ã€å†…å­˜ç®¡ç†ã€è¿›ç¨‹æ§åˆ¶ç»„ï¼ˆcgroupï¼‰ã€ACPIï¼ˆé«˜çº§å¯æ‰©å±•å›ºä»¶æ¥å£ï¼‰ã€proc æ–‡ä»¶ç³»ç»Ÿç­‰ã€‚ è°ƒç”¨ rest_initï¼šéšåè¿›å…¥ rest_init é˜¶æ®µï¼Œåˆ›å»º init å’Œ kthreadd è¿›ç¨‹ï¼Œå¯åŠ¨å†…æ ¸è°ƒåº¦å™¨ã€‚ rest_init é˜¶æ®µåœ¨ rest_init å‡½æ•°ä¸­ï¼Œä¸»è¦è¡¨ç°å¦‚ä¸‹ï¼š static noinline void __init_refok rest_init(void) int pid; rcu_scheduler_starting(); smpboot_thread_init(); // åˆ›å»º init è¿›ç¨‹ï¼Œç¬¬ä¸€ä¸ªç”¨æˆ·ç©ºé—´è¿›ç¨‹ kernel_thread(kernel_init, NULL, CLONE_FS); numa_default_policy(); // åˆ›å»º kthreadd ç”¨äºç®¡ç†å†…æ ¸çº¿ç¨‹ pid = kernel_thread(kthreadd, NULL, CLONE_FS | CLONE_FILES); // è®©å†…æ ¸è¿›ç¨‹ kthreadd å¤„äºå°±ç»ªæ€ TASK_NORMAL complete(kthreadd_done); // å¯åŠ¨è°ƒåº¦å™¨ init_idle_bootup_task(current); schedule_preempt_disabled(); cpu_startup_entry(CPUHP_ONLINE); è¿™ä¸€æ®µä»£ç åˆ›å»ºäº†ç¬¬ä¸€ä¸ªç”¨æˆ·ç©ºé—´è¿›ç¨‹ initï¼Œè¿›ç¨‹å·ä¸º 1ï¼Œè´Ÿè´£åŠ è½½å’Œå¯åŠ¨å…¶ä»–ç”¨æˆ·ç©ºé—´åº”ç”¨ã€‚ä¹‹åï¼Œåˆ›å»º kthreadd è¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹çš„è¿›ç¨‹å·ä¸º 2ï¼Œå¹¶ç”¨äºç®¡ç†å†…æ ¸çº¿ç¨‹ã€‚æ‰€æœ‰å…¶ä»–å†…æ ¸çº¿ç¨‹éƒ½ä½œä¸º kthreadd çš„å­çº¿ç¨‹è¢«åˆ›å»ºï¼Œåˆ©ç”¨ kthread_create_list æ¥ç»´æŠ¤è¿™äº›å†…æ ¸è¿›ç¨‹ã€‚ kernel_init é˜¶æ®µå½“å†…æ ¸è°ƒåº¦å™¨å¼€å§‹è¿è¡Œåï¼Œæ§åˆ¶æƒè½¬ç§»åˆ° kernel_init å‡½æ•°ï¼š static int __ref kernel_init(void *unused) int ret; kernel_init_freeable(); // å®Œæˆæ‰€æœ‰åˆå§‹åŒ–æ“ä½œ async_synchronize_full(); // å¦‚æœä½¿èƒ½äº† ramdisk æ‰§è¡Œå‘½ä»¤å¯åŠ¨ init if (ramdisk_execute_command) ret = run_init_process(ramdisk_execute_command); if (!ret) return 0; pr_err(Failed to execute %s (error %d) , ramdisk_execute_command, ret); // å¦åˆ™æ ¹æ®é…ç½®å¯åŠ¨ init if (execute_command) ret = run_init_process(execute_command); if (!ret) return 0; panic(Requested init %s failed (error %d)., execute_command, ret); // å¦‚æœä¸Šè¿°ä¸¤é¡¹éƒ½æœªå¯ç”¨ï¼Œåˆ™ä¾æ¬¡åœ¨æ ¹æ–‡ä»¶ç³»ç»Ÿä¸‹å¯»æ‰¾ init if (!try_to_run_init_process(/sbin/init) || !try_to_run_init_process(/etc/init) || !try_to_run_init_process(/bin/init) || !try_to_run_init_process(/bin/sh)) return 0; panic(No working init found. Try passing init= option to kernel. See Linux Documentation/init.txt for guidance.); åœ¨è¿™ä¸€é˜¶æ®µï¼Œå†…æ ¸å°è¯•å¯åŠ¨ init è¿›ç¨‹ï¼Œå…·ä½“æ‰§è¡Œå“ªä¸ª init å¯æ‰§è¡Œæ–‡ä»¶åˆ™ä¾èµ–äºç³»ç»Ÿé…ç½®ã€‚å¸¸è§çš„è¿›ç¨‹åŒ…æ‹¬ BusyBox çš„ initã€SystemV çš„ init æˆ– SystemD çš„ init ç­‰ã€‚æ ¹æ®ä¸åŒçš„ Linux å‘è¡Œç‰ˆï¼Œæ‰€é€‰æ‹©çš„ init ç³»ç»Ÿä¼šæœ‰å·®å¼‚ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","å¹³å°ç›¸å…³"]},{"title":"Windowsçš„å¯åŠ¨","path":"/2024/09/20/1-å¹³å°ç³»ç»Ÿ-å¹³å°ç›¸å…³-Windowsçš„å¯åŠ¨/","content":"é›¶ã€boot çš„å«ä¹‰åœ¨è®¡ç®—æœºé¢†åŸŸï¼Œâ€å¯åŠ¨â€è¿™ä¸ªè¯ç”¨è‹±è¯­æ˜¯ bootã€‚ä½†è¿™ä¸ªè¯åŸæœ¬çš„æ„æ€æ˜¯â€é´å­â€ï¼Œé‚£ä¹ˆï¼Œå¯åŠ¨ä¸é´å­ä¹‹é—´æœ‰ä»€ä¹ˆè”ç³»å‘¢ï¼Ÿå…¶å®ï¼Œè¿™ä¸ªè¯æºè‡ªäº bootstrapï¼ˆé‹å¸¦ï¼‰çš„ç¼©å†™ï¼Œæ¥æºäºä¸€å¥è°šè¯­ï¼šâ€pull oneself up by oneâ€™s bootstrapsâ€œã€‚è¿™å¥è°šè¯­çš„å­—é¢æ„æ€æ˜¯â€æ‹‰ç€é‹å¸¦æŠŠè‡ªå·±æ‹‰èµ·æ¥â€ï¼Œæ˜¾ç„¶ï¼Œè¿™æ˜¯ä¸ªä¸å¯èƒ½å®Œæˆçš„ä»»åŠ¡ã€‚ åœ¨è®¡ç®—æœºçš„æ—©æœŸï¼Œå·¥ç¨‹å¸ˆä»¬ä½¿ç”¨è¿™ä¸ªæ¯”å–»æ¥æè¿°ä¸€ä¸ªçŸ›ç›¾çš„è¿‡ç¨‹ï¼šè¦å¯åŠ¨è®¡ç®—æœºï¼Œå¿…é¡»å…ˆè¿è¡Œç¨‹åºï¼Œä½†å¦‚æœè®¡ç®—æœºæœªå¯åŠ¨ï¼Œå°±æ— æ³•è¿è¡Œç¨‹åºã€‚å®é™…ä¸Šï¼Œæ—©æœŸè®¡ç®—æœºçš„å¯åŠ¨è¿‡ç¨‹ç¡®å®å¦‚æ­¤ã€‚å·¥ç¨‹å¸ˆä»¬éœ€æƒ³å°½åŠæ³•å°†ä¸€å°æ®µç¨‹åºè£…å…¥å†…å­˜ï¼Œä¹‹åè®¡ç®—æœºæ‰èƒ½æ­£å¸¸è¿è¡Œã€‚é€æ¸åœ°ï¼Œâ€æ‹‰é‹å¸¦â€çš„è¯´æ³•ä¾¿è¢«ç®€åŒ–ä¸º bootã€‚ å¯åŠ¨è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºå››ä¸ªé˜¶æ®µã€‚ ç¬¬ä¸€é˜¶æ®µï¼šBIOSåœ¨ä¸Šä¸–çºª 70 å¹´ä»£åˆï¼Œåªè¯»å†…å­˜ï¼ˆRead-Only Memoryï¼Œç®€ç§° ROMï¼‰è¢«å‘æ˜ã€‚å¼€æœºç¨‹åºè¢«å†™å…¥ ROM èŠ¯ç‰‡ä¸­ï¼Œå½“è®¡ç®—æœºé€šç”µåï¼Œç¬¬ä¸€ä»¶äº‹ä¾¿æ˜¯è¯»å–è¿™å—èŠ¯ç‰‡ã€‚è¿™å—èŠ¯ç‰‡ä¸­çš„ç¨‹åºç§°ä¸º åŸºæœ¬è¾“å…¥è¾“å‡ºç³»ç»Ÿï¼ˆBasic InputOutput Systemï¼‰ï¼Œç®€ç§°ä¸ºBIOSã€‚ 1.1 ç¡¬ä»¶è‡ªæ£€BIOS ç¨‹åºé¦–å…ˆè¿›è¡Œ ç¡¬ä»¶è‡ªæ£€ï¼ˆPower-On Self-Testï¼Œç®€ç§° POSTï¼‰ï¼Œç¡®è®¤è®¡ç®—æœºç¡¬ä»¶æ˜¯å¦èƒ½æ»¡è¶³è¿è¡Œçš„åŸºæœ¬æ¡ä»¶ã€‚å¦‚æœç¡¬ä»¶å‡ºç°é—®é¢˜ï¼Œä¸»æ¿ä¼šå‘é€ä¸åŒçš„èœ‚é¸£å£°éŸ³æ¥æç¤ºé”™è¯¯ï¼Œä»è€Œå¯åŠ¨è¿‡ç¨‹ä¹Ÿä¼šä¸­æ­¢ã€‚ åä¹‹ï¼Œå¦‚æœç¡¬ä»¶æ­£å¸¸ï¼Œå±å¹•ä¸Šå°†æ˜¾ç¤º CPUã€å†…å­˜ã€ç¡¬ç›˜ç­‰ç¡¬ä»¶ä¿¡æ¯ï¼Œç¡®ä¿ä¸€åˆ‡å°±ç»ªåï¼ŒBIOS ä¼šæŠŠæ§åˆ¶æƒè½¬ç»™ä¸‹ä¸€é˜¶æ®µçš„å¯åŠ¨ç¨‹åºã€‚ 1.2 å¯åŠ¨é¡ºåºç¡¬ä»¶è‡ªæ£€å®Œæˆåï¼ŒBIOS éœ€è¦ç¡®å®šâ€ä¸‹ä¸€é˜¶æ®µçš„å¯åŠ¨ç¨‹åºâ€å­˜æ”¾åœ¨å“ªä¸ªè®¾å¤‡ä¸Šã€‚ä¸ºæ­¤ï¼ŒBIOS ä¼šå‚è€ƒ å¯åŠ¨é¡ºåºï¼ˆBoot Sequenceï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªè®¾å¤‡çš„ä¼˜å…ˆçº§åˆ—è¡¨ï¼ŒæŒ‰ç…§æ­¤é¡ºåºæœç´¢å¯å¯åŠ¨çš„è®¾å¤‡ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ BIOS è®¾ç½®ç•Œé¢è‡ªå®šä¹‰æ­¤å¯åŠ¨é¡ºåºã€‚ ç¬¬äºŒé˜¶æ®µï¼šä¸»å¼•å¯¼è®°å½•BIOS æ ¹æ®å¯åŠ¨é¡ºåºï¼Œå°†æ§åˆ¶æƒè½¬äº¤ç»™ç¬¬ä¸€ä½çš„å­˜å‚¨è®¾å¤‡ã€‚è®¡ç®—æœºä¼šè¯»å–è¯¥è®¾å¤‡çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºï¼Œä¹Ÿå°±æ˜¯å‰é¢ 512 ä¸ªå­—èŠ‚ã€‚å¦‚æœè¿™ 512 ä¸ªå­—èŠ‚çš„æœ€åä¸¤ä¸ªå­—èŠ‚åˆ†åˆ«æ˜¯ 0x55 å’Œ 0xAAï¼Œè¿™è¡¨ç¤ºè¯¥è®¾å¤‡èƒ½å¤Ÿç”¨äºå¯åŠ¨ï¼›å¦‚æœä¸æ˜¯ï¼Œåˆ™ç»§ç»­æŸ¥æ‰¾å¯åŠ¨é¡ºåºä¸­çš„ä¸‹ä¸€ä¸ªè®¾å¤‡ã€‚ è¿™éƒ¨åˆ† 512 å­—èŠ‚çš„å†…å®¹ç§°ä¸º ä¸»å¼•å¯¼è®°å½•ï¼ˆMaster Boot Recordï¼Œç®€ç§° MBRï¼‰ã€‚ 2.1 ä¸»å¼•å¯¼è®°å½•çš„ç»“æ„MBR æ€»è®¡ 512 ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­ä¸»è¦æœ‰ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼š ç¬¬ 1-446 å­—èŠ‚ï¼šåŒ…å«è°ƒç”¨æ“ä½œç³»ç»Ÿçš„æœºå™¨ç ã€‚ ç¬¬ 447-510 å­—èŠ‚ï¼šç§°ä¸º åˆ†åŒºè¡¨ï¼ˆPartition Tableï¼‰ï¼Œè´Ÿè´£æè¿°ç¡¬ç›˜ä¸Šå„ä¸ªåˆ†åŒºçš„æƒ…å†µã€‚ ç¬¬ 511-512 å­—èŠ‚ï¼šä¸»å¼•å¯¼è®°å½•ç­¾åï¼Œè¡¨ç¤º MBR æ­£å¸¸ã€‚ 2.2 åˆ†åŒºè¡¨åˆ†åŒºçš„ä¸»è¦ä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿåœ¨ä¸€ä¸ªç¡¬ç›˜ä¸Šå®‰è£…å¤šä¸ªæ“ä½œç³»ç»Ÿã€‚åˆ†åŒºè¡¨é•¿ä»… 64 ä¸ªå­—èŠ‚ï¼Œæœ€å¤šå¯ä»¥å®šä¹‰å››ä¸ª ä¸»åˆ†åŒºã€‚æ¯ä¸ªä¸»åˆ†åŒºç”±ç‹¬ç«‹çš„ 16 ä¸ªå­—èŠ‚ç»„æˆï¼ŒåŒ…å«å¤šä¸ªä¿¡æ¯ï¼Œå¦‚æ¿€æ´»çŠ¶æ€ã€åˆ†åŒºç±»å‹ä»¥åŠä½ç½®ç­‰ã€‚ å¯¹äºæœ€å¤§åˆ†åŒºå®¹é‡çš„è®¡ç®—ï¼Œå¦‚æœæ¯ä¸ªæ‰‡åŒºä¸º 512 ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆæ¯ä¸ªä¸»åˆ†åŒºæœ€å¤§å¯è¾¾ 2TBï¼Œè€Œæ•´ä¸ªç¡¬ç›˜çš„å¯åˆ©ç”¨ç©ºé—´ä¹Ÿå—åˆ°æ­¤é™åˆ¶ã€‚å¦‚éœ€æ›´å¤§å®¹é‡ï¼Œå¯é€šè¿‡å¢åŠ æ‰‡åŒºå­—èŠ‚æ•°æˆ–åˆ†åŒºæ•°é‡æ¥å®ç°ã€‚ ç¬¬ä¸‰é˜¶æ®µï¼šç¡¬ç›˜å¯åŠ¨è®¡ç®—æœºæ­¤æ—¶éœ€å°†æ§åˆ¶æƒè½¬äº¤ç»™ç¡¬ç›˜è§¦å‘çš„æŸä¸ªåˆ†åŒºï¼Œæƒ…å†µå¤§è‡´åˆ†ä¸ºä¸‰ç§ã€‚ 3.1 æƒ…å†µ Aï¼šå·å¼•å¯¼è®°å½•åœ¨å››ä¸ªä¸»åˆ†åŒºä¸­ï¼Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæ˜¯è¢«æ¿€æ´»çš„ã€‚è®¡ç®—æœºè¯»å–æ¿€æ´»åˆ†åŒºçš„ç¬¬ä¸€ä¸ªæ‰‡åŒºï¼Œè¿™éƒ¨åˆ†æ•°æ®ç§°ä¸º å·å¼•å¯¼è®°å½•ï¼ˆVolume Boot Recordï¼Œç®€ç§° VBRï¼‰ã€‚VBR çš„å…³é”®ä½œç”¨åœ¨äºæŒ‡å‘æ“ä½œç³»ç»Ÿåœ¨è¯¥åˆ†åŒºå†…çš„å…·ä½“ä½ç½®ï¼Œéšåè®¡ç®—æœºä¼šåŠ è½½æ“ä½œç³»ç»Ÿã€‚ 3.2 æƒ…å†µ Bï¼šæ‰©å±•åˆ†åŒºä¸é€»è¾‘åˆ†åŒºéšç€ç¡¬ç›˜çš„å®¹é‡ä¸æ–­å¢åŠ ï¼Œå››ä¸ªä¸»åˆ†åŒºå·²æ˜¾ä¸è¶³ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‰©å±•åˆ†åŒºï¼ˆExtended Partitionï¼‰çš„æ¦‚å¿µåº”è¿è€Œç”Ÿã€‚æ‰©å±•åˆ†åŒºå†…å¯ä»¥åŒ…å«å¤šä¸ª é€»è¾‘åˆ†åŒºï¼ˆLogical Partitionï¼‰ã€‚ è®¡ç®—æœºé¦–å…ˆä¼šè¯»å–æ‰©å±•åˆ†åŒºçš„ç¬¬ä¸€ä¸ªæ‰‡åŒºï¼Œç§°ä¸º æ‰©å±•å¼•å¯¼è®°å½•ï¼ˆExtended Boot Recordï¼Œç®€ç§° EBRï¼‰ã€‚åœ¨è¿™ä¸ªè®°å½•ä¸­ï¼Œä¹Ÿæœ‰ä¸€ä¸ªåˆ†åŒºè¡¨ï¼Œä½†ä»…é™äºä¸¤é¡¹ï¼Œå³ä¸¤ä¸ªé€»è¾‘åˆ†åŒºã€‚è®¡ç®—æœºæ¥ä¸‹æ¥ä¼šç»§ç»­ä»é€»è¾‘åˆ†åŒºçš„åˆ†åŒºè¡¨ä¸­è¯»å–ï¼Œç›´åˆ°ä»…å‰©ä¸‹è‡ªå·±çš„å•ä¸€é¡¹ã€‚ 3.3 æƒ…å†µ Cï¼šå¯åŠ¨ç®¡ç†å™¨åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®¡ç®—æœºè¯»å– MBR å‰ 446 å­—èŠ‚çš„æœºå™¨ç åï¼Œä¸ä¼šç«‹å³äº¤ç»™æŸä¸€ç‰¹å®šåˆ†åŒºï¼Œè€Œæ˜¯è¿è¡Œé¢„å…ˆå®‰è£…çš„ å¯åŠ¨ç®¡ç†å™¨ï¼ˆBoot Loaderï¼‰ï¼Œç”±ç”¨æˆ·é€‰æ‹©æƒ³è¦å¯åŠ¨çš„æ“ä½œç³»ç»Ÿã€‚åœ¨ Linux ç¯å¢ƒä¸­ï¼Œæœ€æµè¡Œçš„å¯åŠ¨ç®¡ç†å™¨æ˜¯ Grubã€‚ ç¬¬å››é˜¶æ®µï¼šæ“ä½œç³»ç»Ÿå½“æ§åˆ¶æƒè¢«è½¬äº¤ç»™æ“ä½œç³»ç»Ÿåï¼Œæ“ä½œç³»ç»Ÿçš„å†…æ ¸é¦–å…ˆä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ä»¥Linuxä¸ºä¾‹ï¼Œç³»ç»Ÿä¼šé¦–å…ˆåŠ è½½ /boot ç›®å½•ä¸‹çš„å†…æ ¸æ–‡ä»¶ã€‚å†…æ ¸åŠ è½½æˆåŠŸåï¼Œç³»ç»Ÿä¼šå¯åŠ¨ç¬¬ä¸€ä¸ªç¨‹åº /sbin/initã€‚ /sbin/init çš„ä¸»è¦åŠŸèƒ½æ˜¯æ ¹æ®é…ç½®æ–‡ä»¶ï¼ˆå¦‚ Debian ç³»ç»Ÿä¸­çš„ /etc/inittabï¼‰ç”Ÿæˆ init è¿›ç¨‹ã€‚è¿™ä¸ªè¿›ç¨‹æ˜¯ Linux ç³»ç»Ÿå¯åŠ¨åç¬¬ä¸€ä¸ªè¢«æ¿€æ´»çš„è¿›ç¨‹ï¼Œå…¶è¿›ç¨‹ç¼–å·æ˜¯ 1ï¼Œä¹‹åæ‰€æœ‰å…¶ä»–è¿›ç¨‹å‡ä¸ºå…¶åä»£ã€‚ éšåï¼Œinit çº¿ç¨‹å°†ç³»ç»Ÿçš„å„ä¸ªæ¨¡å—åŠ è½½è¿›æ¥ï¼ŒåŒ…æ‹¬çª—å£ç¨‹åºå’Œç½‘ç»œç¨‹åºï¼Œæœ€ç»ˆæ‰§è¡Œ /bin/login ç¨‹åºï¼Œå±•ç¤ºç™»å½•ç•Œé¢ï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚ è‡³æ­¤ï¼Œæ•´ä¸ªè®¡ç®—æœºå¯åŠ¨è¿‡ç¨‹å°±æ­¤å®Œæˆã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","å¹³å°ç›¸å…³"]},{"title":"å¼€æºåè®®","path":"/2024/09/19/1-å¹³å°ç³»ç»Ÿ-å¹³å°ç›¸å…³-å¼€æºåè®®/","content":"å¸¸è§å¼€æºè®¸å¯è¯ä»‹ç»å¼€æºè½¯ä»¶è®¸å¯è¯æ˜¯è½¯ä»¶å¼€å‘ä¸­çš„æ³•å¾‹æ–‡ä»¶ï¼Œå®ƒè§„å®šäº†è½¯ä»¶çš„ä½¿ç”¨ã€å¤åˆ¶ã€ä¿®æ”¹å’Œåˆ†å‘çš„æ¡ä»¶ã€‚ä¸åŒç±»å‹çš„è®¸å¯è¯å…·æœ‰ä¸åŒçš„è§„åˆ™å’Œæ¡æ¬¾ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å¼€æºè®¸å¯è¯åŠå…¶ç‰¹ç‚¹ã€‚ LGPLï¼ˆè¾ƒå®½æ¾é€šç”¨å…¬å…±è®¸å¯è¯ï¼‰LGPLï¼Œå³â€Lesser General Public Licenseâ€ï¼Œå…è®¸å¼€å‘è€…åœ¨è½¯ä»¶ä¸­ä½¿ç”¨ LGPL æˆæƒçš„åº“ï¼Œè€Œä¸å¿…å°†æ•´ä¸ªè½¯ä»¶é¡¹ç›®éƒ½å¼€æ”¾æºä»£ç ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä½¿ç”¨äº†ä¸€ä¸ª LGPL æˆæƒçš„å›¾å½¢åº“æ¥å¼€å‘åº”ç”¨ç¨‹åºï¼Œå¯ä»¥é€‰æ‹©å°†çš„åº”ç”¨ä¿å¯†ï¼Œå‰ææ˜¯æä¾›äº†å¯¹å›¾å½¢åº“çš„è®¿é—®æƒé™ï¼Œå¹¶ä¸”åœ¨ç›¸åŒç‰ˆæœ¬ä¸‹å…è®¸ç”¨æˆ·å°†å…¶æ›¿æ¢ã€‚åœ¨è¿›è¡Œæ›´æ–°æˆ–ä¿®æ”¹æ—¶ï¼Œå¼€å‘è€…æœ‰ä¹‰åŠ¡ç¡®ä¿åº“çš„æºä»£ç èƒ½å¤Ÿè¢«è·å–ï¼Œä»è€Œç»´æŠ¤äº†ç¤¾åŒºå¯¹è½¯ä»¶çš„æŒç»­æ”¹è¿›ã€‚ Mozilla è®¸å¯è¯Mozilla è®¸å¯è¯æ˜¯ä¸€ç§å®½æ¾çš„å¼€æºè®¸å¯è¯ï¼Œå…è®¸å¼€å‘è€…è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹åŠåˆ†å‘åŸºäº Mozilla çš„å¼€æºè½¯ä»¶ã€‚ä¸ GPL ä¸åŒï¼ŒMozilla è®¸å¯è¯ä¸è¦æ±‚æ´¾ç”Ÿä½œå“ä¹Ÿå¿…é¡»æ˜¯å¼€æºã€‚è¿™æ„å‘³ç€ï¼Œä½¿ç”¨äº† Mozilla è®¸å¯è¯çš„è½¯ä»¶å¯ä»¥ä¸é—­æºè½¯ä»¶ç»“åˆä½¿ç”¨ã€‚ä¾‹å¦‚ï¼ŒMozilla Firefox æµè§ˆå™¨å°±æ˜¯åŸºäºæ­¤è®¸å¯è¯å‘å¸ƒçš„ï¼Œç”¨æˆ·å’Œå¼€å‘è€…å¯ä»¥æ„å»ºè‡ªå·±çš„æ’ä»¶æˆ–æ‰©å±•ï¼Œè€Œä¸å¿…å°†è‡ªå·±çš„ä»£ç å¼€æºã€‚ GPLï¼ˆé€šç”¨å…¬å…±è®¸å¯è¯ï¼‰GPLï¼ˆGeneral Public Licenseï¼‰æ˜¯æœ€æµè¡Œçš„å¼€æºè®¸å¯è¯ä¹‹ä¸€ï¼Œå¼ºè°ƒâ€å¦‚æœå‘å¸ƒä¿®æ”¹åçš„ä½œå“ï¼Œå¿…é¡»åŒæ ·ä»¥ GPL çš„æ¡æ¬¾å‘å¸ƒâ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ä½¿ç”¨ GPL æˆæƒçš„ä»£ç ï¼Œçš„æ‰€æœ‰æºä»£ç ä¹Ÿå¿…é¡»å¼€æ”¾ç»™ç”¨æˆ·ã€‚è¿™å¯ä»¥ç¡®ä¿è½¯ä»¶è‡ªç”±ä½¿ç”¨çš„æƒåˆ©è¢«ä¿æŠ¤ã€‚æ¯”å¦‚ï¼Œè‘—åçš„ Linux æ“ä½œç³»ç»Ÿå°±æ˜¯ä»¥ GPL æˆæƒå‘è¡Œï¼Œä½¿å¾—ç¤¾åŒºä¸­è®¸å¤šå¼€å‘è€…åŸºäºå…¶å†…æ ¸åˆ›å»ºäº†ä¸åŒç‰ˆæœ¬çš„ Linux å‘è¡Œç‰ˆã€‚ BSD è®¸å¯è¯BSD è®¸å¯è¯æ˜¯ä¸€ç§éå¸¸å®½æ¾çš„è®¸å¯åè®®ï¼Œå…è®¸ç”¨æˆ·è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘æºä»£ç ï¼Œç”šè‡³å¯ä»¥å°†å…¶ç”¨ä½œé—­æºè½¯ä»¶ã€‚BSD è®¸å¯è¯çš„ä¸€ä¸ªè‘—åå®ä¾‹æ˜¯ FreeBSD æ“ä½œç³»ç»Ÿï¼Œå®ƒæä¾›äº†ä¸€ç§çµæ´»çš„è®¸å¯æ–¹å¼ï¼Œè®©ä¼ä¸šå¯ä»¥åœ¨å…¶äº§å“ä¸­ä½¿ç”¨ BSD æˆæƒçš„è½¯ä»¶ï¼Œè€Œæ— éœ€å…¬å¼€æºä»£ç ã€‚è¿™ç§è‡ªç”±ä½¿å¾— BSD è®¸å¯è¯åœ¨å•†ä¸šåº”ç”¨ä¸­éå¸¸å—æ¬¢è¿ã€‚ MIT è®¸å¯è¯MIT è®¸å¯è¯åŒæ ·æ˜¯ä¸€ç§éå¸¸å®½æ¾çš„è®¸å¯è¯ï¼Œå…è®¸è½¯ä»¶çš„ä»»ä½•äººåœ¨ä»»ä½•æƒ…å†µä¸‹ä½¿ç”¨ã€å¤åˆ¶å’Œä¿®æ”¹è¯¥è½¯ä»¶ï¼Œå‡ ä¹æ²¡æœ‰é™åˆ¶ã€‚æœ‰å¾ˆå¤šç°ä»£çš„å¼€æºé¡¹ç›®ï¼Œå¦‚ Ruby on Rails å’Œ Node.jsï¼Œéƒ½æ˜¯åœ¨ MIT è®¸å¯è¯ä¸‹å‘å¸ƒçš„ã€‚è¿™ç§ç®€å•æ˜äº†çš„æˆæƒæ–¹å¼ï¼Œæœ‰åŠ©äºå¸å¼•æ›´å¤šçš„è´¡çŒ®è€…ï¼Œå› ä¸ºå®ƒå…è®¸å¼€å‘è€…å°†è‡ªå·±çš„é¡¹ç›®ä¸ä»»ä½•å…¶ä»–é¡¹ç›®æ— ç¼ç»“åˆã€‚ Apache è®¸å¯è¯Apache è®¸å¯è¯æä¾›äº†ä¸€ç§çµæ´»çš„ä½¿ç”¨å’Œåˆ†å‘æ¨¡å¼ï¼Œå…è®¸ç”¨æˆ·ä¿®æ”¹å’Œåˆ†å‘ä»£ç ï¼Œç”šè‡³åŒ…æ‹¬å•†ç”¨ã€‚ä¸ MIT å’Œ BSD ä¸åŒï¼ŒApache è®¸å¯è¯ç‰¹åˆ«é‡è§†è´¡çŒ®è€…çš„æƒåˆ©ï¼Œè¦æ±‚å¯¹è´¡çŒ®è€…çš„åå­—è¿›è¡Œç›¸åº”çš„æ ‡æ³¨ã€‚Apache HTTP æœåŠ¡å™¨æ˜¯åˆ©ç”¨è¯¥è®¸å¯è¯å‘å¸ƒçš„ï¼Œå®ƒè¢«å¹¿æ³›åº”ç”¨äºäº’è”ç½‘ï¼Œæ˜¯ä¸€ä¸ªäº‹å®ä¸Šçš„æ ‡å‡†é€‰æ‹©ã€‚ é€šè¿‡äº†è§£è¿™äº›å¼€æºè®¸å¯è¯ï¼Œå¼€å‘è€…å’Œç”¨æˆ·èƒ½å¤Ÿæ›´å¥½åœ°éµå¾ªæ³•å¾‹æ¡†æ¶ï¼ŒåŒæ—¶åœ¨è½¯ä»¶å¼€å‘ä¸­ä¿æŒå¼€æ”¾ä¸è‡ªç”±ï¼Œæ¨åŠ¨æŠ€æœ¯åˆ›æ–°ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","å¹³å°ç›¸å…³"]},{"title":"æ“ä½œç³»ç»Ÿ","path":"/2024/09/18/1-å¹³å°ç³»ç»Ÿ-å¹³å°ç›¸å…³-æ“ä½œç³»ç»Ÿ/","content":"æ“ä½œç³»ç»Ÿä»€ä¹ˆæ˜¯æ“ä½œç³»ç»Ÿï¼Ÿæ“ä½œç³»ç»Ÿï¼ˆOperating System, OSï¼‰æ˜¯è®¡ç®—æœºç³»ç»Ÿä¸­ç®¡ç†ç¡¬ä»¶å’Œè½¯ä»¶èµ„æºçš„æ ¸å¿ƒç¨‹åºã€‚å®ƒè´Ÿè´£è¿›è¡Œè¿›ç¨‹ç®¡ç†ã€å†…å­˜ç®¡ç†å’Œæ–‡ä»¶ç³»ç»Ÿç®¡ç†ç­‰å¤šé¡¹å…³é”®åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½å¸®åŠ©ç”¨æˆ·å’Œè®¡ç®—æœºä¹‹é—´è¿›è¡Œæœ‰æ•ˆçš„äº’åŠ¨ã€‚ æ“ä½œç³»ç»Ÿçš„ä¸»è¦ç»„æˆéƒ¨åˆ† å†…æ ¸ï¼šå†…æ ¸æ˜¯æ“ä½œç³»ç»Ÿä¸­æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œè´Ÿè´£ç›´æ¥ä¸è®¡ç®—æœºçš„ç¡¬ä»¶è¿›è¡Œäº¤äº’ã€‚å®ƒç®¡ç†ç€ç³»ç»Ÿè°ƒç”¨ã€è¿›ç¨‹è°ƒåº¦ã€å†…å­˜åˆ†é…ç­‰ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼ŒLinux å†…æ ¸æ”¯æŒå¤šç”¨æˆ·å’Œå¤šä»»åŠ¡ï¼Œç¡®ä¿æ¯ä¸ªè¿›ç¨‹å¯ä»¥åŒæ ·æœ‰æ•ˆåœ°è®¿é—® CPU æ—¶é—´ã€‚ é©±åŠ¨ç¨‹åºï¼šé©±åŠ¨ç¨‹åºä½¿æ“ä½œç³»ç»Ÿèƒ½å¤Ÿä¸ç¡¬ä»¶è®¾å¤‡é€šä¿¡ã€‚æ¯ç§ç¡¬ä»¶è®¾å¤‡ï¼ˆå¦‚æ‰“å°æœºã€æ˜¾å¡ï¼‰éƒ½éœ€è¦ç›¸åº”çš„é©±åŠ¨ç¨‹åºï¼Œä»¥å®ç°é«˜æ•ˆçš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œå®‰è£…æ˜¾å¡çš„é©±åŠ¨ç¨‹åºåï¼Œç”¨æˆ·å¯ä»¥å……åˆ†åˆ©ç”¨è®¾å¤‡çš„å›¾å½¢å¤„ç†èƒ½åŠ›ã€‚ æ¥å£åº“ï¼šæ¥å£åº“æä¾›äº†ä¸€ç³»åˆ— APIï¼ˆåº”ç”¨ç¨‹åºæ¥å£ï¼‰ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿé«˜æ•ˆåœ°ç¼–å†™è½¯ä»¶ï¼Œä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚é€šè¿‡æ¥å£ï¼Œç¨‹åºå¯ä»¥è½»æ¾è°ƒç”¨æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½ï¼Œå¦‚æ–‡ä»¶æ“ä½œã€ç½‘ç»œé€šä¿¡ç­‰ã€‚ ä»€ä¹ˆæ˜¯åµŒå…¥å¼æ“ä½œç³»ç»Ÿï¼ŸåµŒå…¥å¼æ“ä½œç³»ç»Ÿæ˜¯ç‰¹å®šç¡¬ä»¶è®¾å¤‡ä¸­ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿï¼Œè¿™äº›è®¾å¤‡é€šå¸¸å…·æœ‰ç‰¹å®šåŠŸèƒ½ï¼Œå¦‚æ™ºèƒ½å®¶å±…äº§å“ã€æ±½è½¦ç”µå­ç³»ç»Ÿç­‰ã€‚åµŒå…¥å¼æ“ä½œç³»ç»Ÿé€šå¸¸æ˜¯å¯è£å‰ªçš„ï¼Œè¿™æ„å‘³ç€å¼€å‘è€…å¯ä»¥æ ¹æ®è®¾å¤‡çš„éœ€æ±‚å®šåˆ¶å…¶åŠŸèƒ½ã€‚æ­¤å¤–ï¼Œå¯¹å¯é æ€§å’Œç¨³å®šæ€§çš„è¦æ±‚éå¸¸é«˜ã€‚ä¾‹å¦‚ï¼Œåœ¨åŒ»ç–—è®¾å¤‡ä¸­ï¼ŒåµŒå…¥å¼æ“ä½œç³»ç»Ÿå¿…é¡»ç¡®ä¿åœ¨å…³é”®æ—¶åˆ»ç¨³å®šè¿è¡Œï¼Œå…³ä¹æ‚£è€…çš„å®‰å…¨ã€‚ ä»€ä¹ˆæ˜¯äº¤æ¢åˆ†åŒºï¼Ÿäº¤æ¢åˆ†åŒºæ˜¯è®¡ç®—æœºåœ¨å†…å­˜ä¸è¶³æ—¶æ‰€ä½¿ç”¨çš„ä¸€éƒ¨åˆ†ç¡¬ç›˜ç©ºé—´ï¼Œä¸´æ—¶ç”¨äºå­˜æ”¾ä¸æ´»è·ƒæˆ–ä¼‘çœ çŠ¶æ€çš„è¿›ç¨‹æ•°æ®ã€‚é€šè¿‡å°†è¿™äº›æ•°æ®è½¬å­˜è‡³äº¤æ¢åˆ†åŒºï¼Œè®¡ç®—æœºèƒ½å¤Ÿé‡Šæ”¾å†…å­˜ï¼Œä¿è¯å…¶ä»–è¿è¡Œä¸­çš„è¿›ç¨‹èƒ½ç»§ç»­æµç•…æ‰§è¡Œã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæ‰“å¼€äº†å¤šä¸ªå¤§å‹åº”ç”¨ï¼Œç³»ç»Ÿä¼šå°†ä¸å†ä½¿ç”¨çš„åº”ç”¨çš„çŠ¶æ€å­˜æ”¾åœ¨äº¤æ¢åˆ†åŒºï¼Œä»è€Œä¿æŒç³»ç»Ÿçš„è¿è¡Œæ•ˆç‡ã€‚ ä»€ä¹ˆæ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Ÿæ–‡ä»¶ç³»ç»Ÿæ˜¯æ“ä½œç³»ç»Ÿä¸­è´Ÿè´£æ–‡ä»¶ç®¡ç†çš„è½¯ä»¶å’Œæ•°æ®çš„é›†åˆã€‚å®ƒæä¾›ä¸€ç§ç»„ç»‡å’Œå­˜å–æ–‡ä»¶çš„æ–¹å¼ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥è½»æ¾åœ°åˆ›å»ºã€è¯»å–ã€å†™å…¥å’Œåˆ é™¤æ–‡ä»¶ã€‚åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½è¢«ç»„ç»‡åœ¨ä¸€ä¸ªå±‚æ¬¡ç»“æ„çš„ç›®å½•ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è·¯å¾„è½»æ¾è®¿é—®æ–‡ä»¶ã€‚ Windows å’Œ Linux çš„æ–‡ä»¶ç³»ç»Ÿæœ‰ä½•åŒºåˆ«ï¼ŸWindows å’Œ Linux åœ¨æ–‡ä»¶ç³»ç»Ÿç»“æ„ä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼š åœ¨ Windows ä¸­ï¼Œç›®å½•ç»“æ„åœ¨åˆ†åŒºä¸‹è¿›è¡Œç»„ç»‡ï¼Œæ¯”å¦‚ C:\\ã€D:\\ ç­‰ã€‚å¦‚æœç”¨æˆ·ä¿å­˜äº†ä¸€ä¸ªæ–‡æ¡£ï¼Œåœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­ï¼Œå®ƒä¼šæ˜¾ç¤ºåœ¨ C:\\Documents\\MyFile.txt è¿™æ ·çš„è·¯å¾„ä¸­ã€‚ è€Œåœ¨ Linux ä¸­ï¼Œæ‰€æœ‰çš„è®¾å¤‡å’Œåˆ†åŒºéƒ½æŒ‚è½½åœ¨ä¸€ä¸ªç»Ÿä¸€çš„ç›®å½•ç»“æ„ä¸‹ï¼Œé€šå¸¸ä»¥æ ¹ç›®å½•ï¼ˆï¼‰ä¸ºèµ·ç‚¹ã€‚æ¯”å¦‚ï¼Œå¯ä»¥å°†ä¸€ä¸ªé™„åŠ çš„ç¡¬ç›˜åˆ†åŒºæŒ‚è½½åˆ° mnt ç›®å½•ï¼Œç”¨æˆ·çœ‹åˆ°çš„è·¯å¾„å¯ä»¥æ˜¯ mntexternal_driveMyFile.txtã€‚ ç¡¬ç›˜åˆ†åŒºç¡¬ç›˜åˆ†åŒºæ˜¯å°†ä¸€ä¸ªç‰©ç†ç¡¬ç›˜åˆ’åˆ†ä¸ºå¤šä¸ªé€»è¾‘å•å…ƒï¼Œä»¥ä¾¿æ›´å¥½åœ°ç®¡ç†å’Œä½¿ç”¨ç¡¬ç›˜ç©ºé—´ã€‚å¸¸è§çš„åˆ†åŒºç±»å‹åŒ…æ‹¬ï¼š ä¸»åˆ†åŒºï¼šç›´æ¥ä»ç¡¬ç›˜å¯åŠ¨çš„åˆ†åŒºï¼Œæœ€å¤šå¯ä»¥æœ‰å››ä¸ªä¸»åˆ†åŒºã€‚ é€»è¾‘åˆ†åŒºï¼šåœ¨æ‰©å±•åˆ†åŒºå†…åˆ›å»ºçš„åˆ†åŒºï¼Œå¯ä»¥æœ‰å¤šä¸ªé€»è¾‘åˆ†åŒºï¼Œä¾¿äºç®¡ç†å¤šé‡æ•°æ®ã€‚ æ‰©å±•åˆ†åŒºï¼šä¸€ç§ç‰¹æ®Šç±»å‹çš„åˆ†åŒºï¼Œå…è®¸åœ¨ç¡¬ç›˜ä¸Šåˆ›å»ºé¢å¤–çš„é€»è¾‘åˆ†åŒºã€‚ åˆ†åŒºæ ¼å¼ Windows é€šå¸¸ä½¿ç”¨ FATï¼ˆæ–‡ä»¶åˆ†é…è¡¨ï¼‰æˆ– NTFSï¼ˆæ–°æŠ€æœ¯æ–‡ä»¶ç³»ç»Ÿï¼‰æ ¼å¼ï¼Œä»¥æ”¯æŒæ–‡ä»¶æƒé™å’Œå…¶ä»–é«˜çº§ç‰¹æ€§ã€‚ Linux åˆ™ä¸»è¦ä½¿ç”¨ extï¼ˆæ‰©å±•æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå¦‚ ext2ã€ext3 å’Œ ext4ï¼Œå„è‡ªæ”¯æŒä¸åŒçš„åŠŸèƒ½ï¼Œå¦‚æ—¥å¿—è®°å½•ã€æ–‡ä»¶æƒé™ç®¡ç†ç­‰ã€‚ äº¤æ¢åˆ†åŒºå’Œè™šæ‹Ÿå†…å­˜äº¤æ¢åˆ†åŒºå’Œè™šæ‹Ÿå†…å­˜å¯†åˆ‡ç›¸å…³ã€‚äº¤æ¢åˆ†åŒºæ˜¯ç‰©ç†ç¡¬ç›˜ä¸Šçš„ä¸€å—ç©ºé—´ï¼Œè€Œè™šæ‹Ÿå†…å­˜æ˜¯æ“ä½œç³»ç»Ÿä¸ºæ¯ä¸ªè¿›ç¨‹åˆ›å»ºçš„ä¸€ä¸ªé€»è¾‘åœ°å€ç©ºé—´ã€‚å½“ç‰©ç†å†…å­˜ä¸è¶³æ—¶ï¼Œæ“ä½œç³»ç»Ÿå°†ä¸æ´»è·ƒçš„æ•°æ®æˆ–ç¨‹åºä» RAM ä¸­ç§»è‡³äº¤æ¢åˆ†åŒºï¼Œä½¿å¾—æœ‰æ•ˆåˆ©ç”¨å†…å­˜ï¼Œæé«˜ç³»ç»Ÿå¤„ç†èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤§é‡æ•°æ®å¤„ç†æ—¶ï¼Œç³»ç»Ÿå¯èƒ½ä¼šå°†ä¸å¸¸ç”¨çš„ç¨‹åºä»£ç ç§»å…¥äº¤æ¢åˆ†åŒºï¼Œä»¥ä¸ºæ´»è·ƒç¨‹åºè…¾å‡ºæ›´å¤šå†…å­˜ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","å¹³å°ç›¸å…³"]},{"title":"Apacheå’ŒMySQL","path":"/2024/09/17/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-åšå®¢-Apacheå’ŒMySQL/","content":"Web çš„å·¥ä½œæ–¹å¼ Web ç³»ç»Ÿæœ¬è´¨ä¸Šæ˜¯åŸºäºå®¢æˆ·ç«¯æœåŠ¡å™¨çš„æ¶æ„ï¼Œä½¿å¾—ç”¨æˆ·ç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰å¯ä»¥é€šè¿‡è¯·æ±‚è·å–ä½äºè¿œç¨‹æœåŠ¡å™¨ä¸Šçš„èµ„æºã€‚ åœ¨ä¸‡ç»´ç½‘ï¼ˆWWWï¼‰æœåŠ¡ä¸­ï¼Œç³»ç»Ÿéµå¾ª HTTP åè®®ï¼Œé»˜è®¤ä½¿ç”¨çš„ TCPIP ç«¯å£æ˜¯ TCP 80ï¼Œè¿™æ„å‘³ç€ä¸éœ€è¦åœ¨ URL ä¸­æŒ‡å®šç«¯å£ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥è¾“å…¥ç½‘å€å³å¯è®¿é—®ã€‚ å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è¿‡ç¨‹å¦‚ä¸‹ï¼š Web Client å‘é€ HTTP è¯·æ±‚ åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åè¿›è¡Œå¤„ç†ã€‚ æœåŠ¡å™¨å“åº” HTTP åº”ç­”ï¼Œå°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œé€šè¿‡ Internet å®Œæˆä¿¡æ¯çš„äº¤äº’ã€‚ ASFï¼ˆApache è½¯ä»¶åŸºé‡‘ä¼šï¼‰ æ—©æœŸç‰ˆæœ¬çš„ Apache æœåŠ¡å™¨æ˜¯ç”±ä¸€ä¸ªåä¸º Apache Group çš„å›¢é˜Ÿæ¥ç»´æŠ¤ã€‚éšç€æ—¶é—´çš„å‘å±•ï¼ŒApache è½¯ä»¶åŸºé‡‘ä¼šï¼ˆApache Software Foundationï¼Œç®€ç§° ASFï¼‰äº 1999 å¹´æˆç«‹ï¼Œæ—¨åœ¨æ”¯æŒå¼€æºè½¯ä»¶é¡¹ç›®ã€‚ ASF ç»´æŠ¤ç€åŒ…æ‹¬ Apache HTTP Server åœ¨å†…çš„å¤šä¸ªå¼€æºé¡¹ç›®ï¼Œä¾‹å¦‚ Perlã€PHPã€Javaã€Tcl å’Œ XML ç­‰ï¼Œè¿™äº›é¡¹ç›®å¹¿æ³›åº”ç”¨äºå¼€å‘å’ŒæœåŠ¡å™¨ç®¡ç†ä¸­ã€‚ ASF çš„å®˜æ–¹ç½‘ç«™æ˜¯ http://www.apache.orgï¼Œç”¨æˆ·å¯ä»¥åœ¨æ­¤æ‰¾åˆ°æ‰€æœ‰ä¸ Apache ç›¸å…³çš„èµ„æºå’Œæ–‡æ¡£ã€‚ Apache çš„ç‰¹æ€§ï¼1.3 ç‰ˆæœ¬ Apache 1.3 ç‰ˆæœ¬å¼•å…¥äº†åŠ¨æ€å…±äº«å¯¹è±¡ï¼ˆDSOï¼‰åŠŸèƒ½ï¼Œå…è®¸æœåŠ¡å™¨åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åŠ è½½ä¸åŒçš„åŠŸèƒ½æ¨¡å—ï¼Œä»¥å¢å¼ºæœåŠ¡å™¨çš„çµæ´»æ€§ã€‚ é€šè¿‡é‡‡ç”¨é¢„ç”Ÿæˆæ¨¡å¼çš„æŠ€æœ¯ï¼ŒApache 1.3 æå¤§åœ°æé«˜äº†å“åº”é€Ÿåº¦ï¼Œä½¿ç½‘ç«™è®¿é—®æ›´åŠ æµç•…ã€‚ æ”¯æŒæœ€æ–°çš„ HTTP 1.1 åè®®ï¼Œå…¶ä¸­åŒ…æ‹¬æ›´å¥½çš„è¿æ¥ç®¡ç†å’Œæ‰©å±•åŠŸèƒ½ï¼Œä¿ƒè¿›äº†æ›´å¤æ‚çš„ç½‘ç»œåº”ç”¨ã€‚ é…ç½®æ–¹é¢ä¹Ÿéå¸¸å‹å¥½ï¼Œç®€å•è€Œå¼ºå¤§çš„åŸºäºæ–‡ä»¶çš„é…ç½®è®©ç”¨æˆ·èƒ½å¤Ÿè½»æ¾å®šåˆ¶æœåŠ¡å™¨ç¯å¢ƒã€‚ æ”¯æŒè™šæ‹Ÿä¸»æœºåŠŸèƒ½ï¼Œä½¿å¾—åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šèƒ½å¤ŸåŒæ—¶è¿è¡Œå¤šä¸ªç½‘ç«™ã€‚ æä¾› HTTP è®¤è¯åŠŸèƒ½ï¼Œä¿æŠ¤æ•æ„Ÿæ•°æ®ä¸èµ„æºã€‚ æ”¯æŒè®¸å¤šç¬¬ä¸‰æ–¹è½¯ä»¶å¼€å‘è€…æä¾›çš„åŠŸèƒ½æ¨¡å—ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€æ±‚æ‰©å±• Apache çš„åŠŸèƒ½ã€‚ Apache çš„ç‰¹æ€§ï¼2.0 ç‰ˆæœ¬ Apache 2.0 å‡ ä¹ç»§æ‰¿äº† 1.3 ç‰ˆæœ¬çš„æ‰€æœ‰ç‰¹æ€§ï¼Œå¹¶è¿›è¡Œäº†å¤šé¡¹æ”¹è¿›ã€‚ æ–°å¢çš„ç»„ä»¶â€”â€”Apache Portable Runtimeï¼ˆAPRï¼‰ï¼Œè¿›ä¸€æ­¥æå‡äº† Apache çš„è·¨å¹³å°æ€§èƒ½ï¼Œå…è®¸å¼€å‘è€…åœ¨ä¸åŒå¹³å°ä¸Šä¿æŒç›¸ä¼¼çš„è¡Œä¸ºã€‚ 2.0 ç‰ˆæœ¬å¼•å…¥äº†æ–°çš„å¤šå¤„ç†æ¨¡å—ï¼ˆMulti-Processing Moduleï¼Œç®€ç§° MPMï¼‰ï¼Œel é€šè¿‡å®ƒå¯ä»¥æ§åˆ¶ Apache åœ¨å¤„ç†å¤šä¸ªè¯·æ±‚æ—¶çš„è¿è¡Œæ–¹å¼ã€‚Apache å¯ä»¥é‡‡ç”¨ä¸‰ç§å¤„ç†æ¨¡å¼ï¼š é¢„æ´¾ç”Ÿï¼ˆPreforkï¼‰MPMï¼šè¿™æ˜¯ Red Hat 9.0 åŠåç»­ç‰ˆæœ¬çš„é»˜è®¤æ¨¡å¼ï¼Œé€‚åˆéœ€è¦è¾ƒé«˜å…¼å®¹æ€§çš„æƒ…å†µï¼› å·¥ä½œè€…ï¼ˆWorkerï¼‰MPMï¼šç›¸æ¯” Prefork MPMï¼Œæ›´åŠ é«˜æ•ˆï¼Œé€‚åˆåŒæ—¶å¤„ç†å¤§é‡è¿æ¥ï¼› ç‹¬ç«‹å­è¿›ç¨‹ï¼ˆPerchildï¼‰MPMï¼šä¸ºæ¯ä¸ªè¯·æ±‚åˆ†é…ç‹¬ç«‹çš„å·¥ä½œè¿›ç¨‹ï¼Œä»è€Œå¢å¼ºäº†å®‰å…¨æ€§ã€‚ å®‰è£…å’Œå¯åŠ¨ Apache å®‰è£… Apache 2.0 çš„å‘½ä»¤å¦‚ä¸‹ï¼š # rpm -ivh httpd-2.0.40-21.i386.rpm# rpm -ivh httpd-manual-2.0.40-21.i386.rpm å¯åŠ¨ã€åœæ­¢å’Œé‡å¯ Apache çš„æ–¹æ³•ï¼š # service httpd start # å¯åŠ¨æœåŠ¡# service httpd stop # åœæ­¢æœåŠ¡# service httpd restart # é‡å¯æœåŠ¡# service httpd status # æ£€æŸ¥æœåŠ¡çŠ¶æ€# pstree | grep httpd # æŸ¥çœ‹å½“å‰ Apache è¿›ç¨‹ æ£€æµ‹ Apache é…ç½®æ–‡ä»¶è¯­æ³•çš„æ­£ç¡®æ€§ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š # apachectl configtest Apache é…ç½®æ–‡ä»¶ é…ç½®æ–‡ä»¶çš„é»˜è®¤æ‰€åœ¨ç›®å½•ä¸ºï¼š /etc/httpd/conf/ Apache çš„ä¸»é…ç½®æ–‡ä»¶åä¸º httpd.confï¼Œç”¨æˆ·å¯ä»¥åœ¨è¯¥æ–‡ä»¶ä¸­ä¿®æ”¹å„ç§è®¾ç½®ä»¥ä¼˜åŒ–å…¶æœåŠ¡å™¨ã€‚ Apache çš„åŸºæœ¬é…ç½® KeepAlive:å¼€å¯æ­¤é€‰é¡¹å…è®¸ä¸€ä¸ªè¿æ¥ä¸Šå‘é€å¤šä¸ªè¯·æ±‚ã€‚è¿™æ ·å¯ä»¥æ˜¾è‘—å‡å°‘è¿æ¥å¼€é”€ï¼Œæå‡æµè§ˆæ•ˆç‡ï¼Œå› ä¸ºé¿å…äº†ä¸ºæ¯ä¸ªè¯·æ±‚éƒ½å»ºç«‹æ–°çš„è¿æ¥ã€‚ MaxKeepAliveRequests:è®¾å®šæ¯ä¸ªè¿æ¥ä¸­å¯ä»¥å‘é€çš„æœ€å¤šè¯·æ±‚æ•°é‡ã€‚è®¾ç½®ä¸º 0ï¼Œåˆ™æ²¡æœ‰é™åˆ¶ï¼Œé»˜è®¤å€¼ä¸º 100ã€‚ KeepAliveTimeout:æ­¤è®¾ç½®è¡¡é‡åœ¨ä¸¤ä¸ªè¿ç»­è¯·æ±‚é—´çš„æœ€å¤§é—´éš”æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ï¼Œè‹¥è¶…è¿‡æ­¤æ—¶é—´ï¼Œåˆ™è§†ä¸ºè¿æ¥æ–­å¼€ã€‚ MaxClients:é™åˆ¶åœ¨åŒä¸€æ—¶é—´å†…å¯æ¥å…¥çš„æœ€å¤§è¿æ¥æ•°é‡ã€‚è¯¥å€¼è¿‡é«˜å¯èƒ½ä¼šå½±å“æœåŠ¡å™¨æ€§èƒ½ï¼Œé»˜è®¤è®¾ç½®ä¸º 150ã€‚ MinSpareServers å’Œ MaxSpareServers:è®¾ç½®ç©ºé—² httpd è¿›ç¨‹çš„æ•°é‡ï¼Œä¿è¯å§‹ç»ˆæœ‰ä¸€å®šæ•°é‡çš„ç©ºé—²è¿›ç¨‹ä»¥åº”å¯¹å¿«é€Ÿå¢é•¿çš„è¿æ¥è¯·æ±‚ã€‚è‹¥ç©ºé—²è¿›ç¨‹å°‘äº 5ï¼Œåˆ™ä¼šè‡ªåŠ¨å¢åŠ åˆ° 5ï¼Œè‹¥è¶…è¿‡ 20 åˆ™å‡å°‘åˆ° 20ã€‚ StartServers:å®šä¹‰ Apache å¯åŠ¨æ—¶åˆå§‹çš„ httpd è¿›ç¨‹æ•°ï¼Œé»˜è®¤å€¼æ˜¯ 8ã€‚ ServerName:é…ç½®æœåŠ¡å™¨çš„ä¸»æœºåï¼Œè¯¥åç§°å°†åœ¨è¿œç¨‹è¿æ¥ä¸­æ˜¾ç¤ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªåç§°æ˜¯ localhostã€‚ ServerAdmin:è¿™é‡Œå¡«å†™çš„æ˜¯æœåŠ¡å™¨ç®¡ç†å‘˜çš„é‚®ä»¶åœ°å€ã€‚å½“æœåŠ¡å™¨å‘ç”Ÿé”™è¯¯æ—¶ï¼Œå¯ä»¥å‘æ­¤é‚®ä»¶å‘é€é€šçŸ¥ã€‚ ServerRoot:æŒ‡å®š Apache çš„é…ç½®æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶å­˜æ”¾çš„è·¯å¾„ï¼Œé»˜è®¤æ˜¯ /etc/httpdã€‚ DocumentRoot:è¯¥é¡¹è®¾å®š Apache ç»™å®šçš„ç½‘é¡µæ–‡æ¡£æ ¹ç›®å½•ï¼Œæ‰€æœ‰ç½‘ç«™æ–‡ä»¶åº”æ”¾åœ¨æ­¤ç›®å½•æˆ–å…¶å­ç›®å½•ä¸­ã€‚ Listen:ç”¨äºè®¾ç½® Apache ç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯ 80 ç«¯å£ã€‚ User Group:è¿™ä¸¤ä¸ªé€‰é¡¹åˆ†åˆ«è®¾ç½® Apache çš„æ‰§è¡Œç”¨æˆ·å’Œç”¨æˆ·ç»„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒApache ä½¿ç”¨ apache ç”¨æˆ·å’Œ apache ç»„ã€‚ DirectoryIndex:ç”¨äºæŒ‡å®šå½“ç›®å½•ä¸­æ²¡æœ‰ç‰¹å®šæ–‡ä»¶æ—¶çš„é»˜è®¤ç´¢å¼•æ–‡ä»¶åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼š DirectoryIndex index.html index.htm Options:æ­¤é€‰é¡¹åŒ…æ‹¬å¤šç§è®¾ç½®ï¼Œä¾‹å¦‚ï¼š Indexesï¼šå½“æŒ‡å®šæ–‡ä»¶æ‰¾ä¸åˆ°æ—¶ï¼Œç”Ÿæˆç›®å½•åˆ—è¡¨ã€‚ FollowSymLinksï¼šå…è®¸æŸ¥è¯¢ä¸åœ¨å½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚ IndexOptions:æä¾›ç”¨æˆ·è‡ªå®šä¹‰ç›®å½•åˆ—è¡¨çš„æ–¹å¼ï¼ŒåŒ…æ‹¬æ ·å¼å’Œæ’åºåŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š FancyIndexingï¼šä¸ºç›®å½•ä¸­çš„æ–‡ä»¶æ·»åŠ å°å›¾æ ‡ä»¥è¡¨ç¤ºç±»å‹ã€‚ VersionSortï¼šå¯¹æ–‡ä»¶ç‰ˆæœ¬è¿›è¡Œæ’åºã€‚ **NameWidth***ï¼šè‡ªåŠ¨è°ƒæ•´æ–‡ä»¶åå­—æ®µçš„å®½åº¦ä»¥é€‚åº”æœ€é•¿æ–‡ä»¶åã€‚ FoldersFirstï¼šåœ¨åˆ—å‡ºç›®å½•çš„æ—¶å€™å°†æ–‡ä»¶å¤¹ä¼˜å…ˆå±•ç¤ºã€‚ é…ç½® Apacheï¼å®¹å™¨æŒ‡ä»¤ å®¹å™¨æŒ‡ä»¤é€šå¸¸åŒ…æ‹¬åœ¨ ... / çš„æ‹¬å·å†…ã€‚è¿™äº›å®¹å™¨å¯ä»¥ä¸ºé…ç½®æä¾›æ›´å…·ä½“çš„ä¸Šä¸‹æ–‡å’Œæ§åˆ¶ã€‚ä¾‹å¦‚ï¼š Directoryï¼šç”¨äºè®¾ç½®ç‰¹å®šç›®å½•çš„é…ç½®ã€‚ Filesï¼šç”¨äºè®¾ç½®ç‰¹å®šæ–‡ä»¶çš„é…ç½®ã€‚ Locationï¼šç”¨äºè®¾ç½® URL è·¯å¾„çš„é…ç½®ã€‚ VirtualHostï¼šä¸ºè™šæ‹Ÿä¸»æœºæä¾›é…ç½®ã€‚ é…ç½®æ¯ä¸ªç”¨æˆ·çš„ Web ç«™ç‚¹è¦ä¸ºæ¯ä¸ªç”¨æˆ·é…ç½® Web ç«™ç‚¹ï¼Œè¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶ï¼Œä»¥å¯ç”¨ä¸ªåˆ«ç”¨æˆ·ç«™ç‚¹çš„é…ç½®ã€‚ ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ¯ä¸ªç”¨æˆ·ç«™ç‚¹ç›®å½•çš„è®¿é—®æ§åˆ¶ã€‚ åœ¨ç”¨æˆ·çš„å®¶ç›®å½•ä¸‹åˆ›å»ºå…¶ç½‘ç«™çš„ç›®å½•åŠç›¸å…³ç½‘é¡µæ–‡ä»¶ã€‚ UserDir é…ç½®è¯­å¥ç¤ºä¾‹ï¼š UserDir disable root # ç¦æ­¢ root ç”¨æˆ·ä½¿ç”¨ä¸ªäººç«™ç‚¹UserDir public_html # æŒ‡å®šæ¯ä¸ªç”¨æˆ·çš„ç«™ç‚¹ç›®å½• ç»„ç»‡å’Œç®¡ç†ç«™ç‚¹å†…å®¹ ç¬¦å·é“¾æ¥ï¼šç¬¦å·é“¾æ¥å…è®¸å°†å­˜æ”¾åœ¨æ ¹æ–‡æ¡£ç›®å½•ä¹‹å¤–çš„å†…å®¹å¼•å…¥åˆ°ç«™ç‚¹ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®ç°ï¼š # cd /var/www/html# ln -s /usr/share/doc doc # å°† /usr/share/doc ç›®å½•é“¾æ¥åˆ°å½“å‰ç›®å½• åˆ«åï¼šåˆ«ååŠŸèƒ½å¦‚ä¸‹ï¼š å…è®¸å°†æ ¹æ–‡æ¡£ç›®å½•ä»¥å¤–çš„å†…å®¹åŠ å…¥åˆ°ç«™ç‚¹ã€‚ ç®€åŒ–ç”¨æˆ·è®¿é—®ç«™ç‚¹å†…å¤æ‚ä¸”æ·±å±‚çš„ URLã€‚ç¤ºä¾‹é…ç½®ï¼š Alias /ftp /var/ftp/pub # å°† /ftp URL æ˜ å°„åˆ° /var/ftp/pub ç›®å½• é…ç½®è®¿é—®æ§åˆ¶ è®¿é—®æ§åˆ¶çš„é…ç½®æŒ‡ä»¤:é€šè¿‡ä»¥ä¸‹æŒ‡ä»¤ç»†åŒ–è®¿é—®è§„åˆ™ï¼š Orderï¼šå®šä¹‰ä½•æ—¶æ‰§è¡Œå…è®¸è®¿é—®å’Œæ‹’ç»è®¿é—®çš„è§„åˆ™ã€‚ Denyï¼šå»ºç«‹æ‹’ç»è®¿é—®çš„åˆ—è¡¨ã€‚ Allowï¼šå»ºç«‹å…è®¸è®¿é—®çš„åˆ—è¡¨ã€‚ Order æŒ‡ä»¤çš„ä¸¤ç§å½¢å¼ï¼š Order Allow,Denyï¼šå…ˆæ‰§è¡Œå…è®¸è§„åˆ™ï¼Œå†æ‰§è¡Œæ‹’ç»è§„åˆ™ï¼Œé»˜è®¤ä¸ºæ‹’ç»æ‰€æœ‰æœªæ˜ç¡®å…è®¸çš„è®¿é—®ã€‚ Order Deny,Allowï¼šå…ˆæ‰§è¡Œæ‹’ç»è§„åˆ™ï¼Œå†æ‰§è¡Œå…è®¸è§„åˆ™ï¼Œé»˜è®¤ä¸ºå…è®¸æ‰€æœ‰æœªæ˜ç¡®æ‹’ç»çš„è®¿é—®ã€‚ Deny å’Œ Allowï¼šåœ¨è¿™ä¸¤ä¸ªæŒ‡ä»¤ä¸‹åˆ—å‡ºå…·ä½“çš„è®¿é—®åˆ—è¡¨ã€‚è®¿é—®åˆ—è¡¨å¯ä½¿ç”¨å¦‚ä¸‹å½¢å¼å®šä¹‰ï¼š Allï¼šå…è®¸æ‰€æœ‰å®¢æˆ·è®¿é—®ã€‚ åŸŸåï¼šå¦‚ jamond.netï¼Œå…è®¸åŸŸå†…çš„æ‰€æœ‰å®¢æˆ·è®¿é—®ã€‚ IP åœ°å€ï¼šå…è®¸å…·ä½“æˆ–éƒ¨åˆ†çš„ IP åœ°å€ã€‚ ç½‘ç»œå­ç½‘æ©ç ï¼šå¦‚ 192.168.1.0/255.255.255.0ã€‚ CIDR è§„èŒƒï¼šå¦‚ 192.168.1.0/24ã€‚ ä½¿ç”¨.htaccess æ–‡ä»¶åˆ†å‰²é…ç½®ä»»åŠ¡ ä½•æ—¶ä½¿ç”¨ .htaccess æ–‡ä»¶ï¼šå½“éœ€è¦åœ¨å¤šä¸ªç”¨æˆ·ä¹‹é—´åˆ†å‰²é…ç½®ï¼Œæˆ–å¸Œæœ›å®ç°ä¸éœ€è¦é‡å¯æœåŠ¡å™¨çš„é…ç½®å˜æ›´æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–‡ä»¶ã€‚ å¯ç”¨å¹¶æ§åˆ¶ä½¿ç”¨ .htaccess æ–‡ä»¶çš„é€‰é¡¹ï¼š AccessFileName .htaccessAllowOverride All # æ§åˆ¶å…è®¸åœ¨ .htaccess æ–‡ä»¶ä¸­ä½¿ç”¨çš„æŒ‡ä»¤ è®¤è¯æŒ‡ä»¤ è®¤è¯ç›¸å…³çš„é…ç½®æŒ‡ä»¤å¯ä»¥å‡ºç°åœ¨ä¸»é…ç½®æ–‡ä»¶çš„ Directory å®¹å™¨ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨ .htaccess æ–‡ä»¶ä¸­å®šä¹‰ã€‚ä»¥ä¸‹æ˜¯ Apache çš„è®¤è¯é…ç½®æŒ‡ä»¤ï¼š æŒ‡ä»¤ æŒ‡ä»¤è¯­æ³• è¯´æ˜ AuthName AuthName é¢†åŸŸåç§° å®šä¹‰å—ä¿æŠ¤é¢†åŸŸçš„åç§° AuthType AuthType Basic æˆ– Digest å®šä¹‰ä½¿ç”¨çš„è®¤è¯æ–¹æ³• AuthGroupFile AuthGroupFile æ–‡ä»¶å æŒ‡å®šè®¤è¯ç»„çš„å£ä»¤æ–‡ä»¶ä½ç½® AuthUserFile AuthUserFile æ–‡ä»¶å æŒ‡å®šè®¤è¯ç”¨æˆ·çš„å£ä»¤æ–‡ä»¶ æˆæƒæŒ‡ä»¤åœ¨ä½¿ç”¨è®¤è¯æŒ‡ä»¤åï¼Œéœ€ä¸ºç‰¹å®šç”¨æˆ·æˆ–ç»„è¿›è¡Œæˆæƒã€‚Require æŒ‡ä»¤æœ‰ä¸‰ç§ä½¿ç”¨æ ¼å¼ï¼š æŒ‡ä»¤è¯­æ³•æ ¼å¼ è¯´æ˜ Require user ç”¨æˆ·å [ç”¨æˆ·å] â€¦ æˆæƒç»™æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ· Require group ç»„å [ç»„å] â€¦ æˆæƒç»™æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªç»„ Require valid-user æˆæƒç»™è®¤è¯å£ä»¤æ–‡ä»¶ä¸­çš„æ‰€æœ‰ç”¨æˆ· ç®¡ç†è®¤è¯ç”¨æˆ·å£ä»¤æ–‡ä»¶å’Œè®¤è¯ç»„æ–‡ä»¶ åˆ›å»ºæ–°çš„è®¤è¯å£ä»¤æ–‡ä»¶: # htpasswd -c è®¤è¯å£ä»¤æ–‡ä»¶å ç”¨æˆ·å ä¿®æ”¹è®¤è¯å£ä»¤æ–‡ä»¶: # htpasswd è®¤è¯å£ä»¤æ–‡ä»¶å ç”¨æˆ·å è®¤è¯å£ä»¤æ–‡ä»¶æ ¼å¼:æ¯ä¸€è¡Œæ ¼å¼å¦‚ï¼šç”¨æˆ·åï¼šåŠ å¯†çš„å£ä»¤ã€‚ ç®¡ç†è®¤è¯ç»„æ–‡ä»¶:è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ¯ä¸€è¡Œçš„æ ¼å¼ä¸º ç»„åï¼šç”¨æˆ·å ç”¨æˆ·å â€¦ã€‚ MySQL ç®€ä»‹ MySQL æ˜¯ä¸€ç§é«˜æ•ˆã€å¤šç”¨æˆ·å’Œå¤šçº¿ç¨‹çš„ä¸­å°å‹ SQL æ•°æ®åº“ç³»ç»Ÿï¼Œç”±ä¸€ä¸ªæœåŠ¡å™¨å®ˆæŠ¤è¿›ç¨‹ mysqld å’Œå¤šä¸ªä¸åŒçš„å®¢æˆ·ç«¯ç¨‹åºåŠåº“ç»„æˆã€‚ å½“å‰æœ€æ–°ç‰ˆæœ¬ä¸º 4.0.13ï¼Œç”¨æˆ·å¯é€šè¿‡å®˜æ–¹ç½‘ç«™ http://www.mysql.com ä¸‹è½½ã€‚ MySQL çš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š æ”¯æŒå¤šå¹³å°è¿è¡Œï¼Œç”¨æˆ·å¯ä»¥åœ¨ Windowsã€Linux ç­‰å¤šç§æ“ä½œç³»ç»Ÿä¸Šä½¿ç”¨ MySQLã€‚ æä¾›å¯¹å¤šç§æ•°æ®åº“çš„æ”¯æŒï¼Œèƒ½å¤ŸåŠæ—¶æ»¡è¶³ç”¨æˆ·çš„å¤šæ ·éœ€æ±‚ã€‚ æ”¯æŒå¤šè¯­è¨€å¼€å‘ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨å¦‚ PHPã€Pythonã€Java ç­‰å¤šç§è¯­è¨€ä¸ MySQL è¿›è¡Œäº¤äº’ã€‚ æ‹¥æœ‰éå¸¸å®Œå–„çš„æƒé™ç³»ç»Ÿï¼Œå¯ä»¥é«˜æ•ˆåœ°ç®¡ç†ç”¨æˆ·å’Œæƒé™ã€‚ å®‰è£…å’Œå¯åŠ¨ MySQL å®‰è£… MySQL çš„æ­¥éª¤å¦‚ä¸‹ï¼š # rpm -ivh perl-CGI-2.81-88.i386.rpm# rpm -ivh perl-DBI-1.32-5.i386.rpm# rpm -ivh mysql-3.23.54a-11.i386.rpm perl-DBD-MySQL-2.1021-3.i386.rpm# rpm -ivh mysql-server-3.23.54a-11.i386.rpm å¯åŠ¨ã€åœæ­¢å’Œé‡å¯ MySQL æœåŠ¡å™¨çš„å‘½ä»¤ï¼š # service mysqld start # å¯åŠ¨æ•°æ®åº“æœåŠ¡# service mysqld stop # åœæ­¢æ•°æ®åº“æœåŠ¡# service mysqld restart # é‡å¯æ•°æ®åº“æœåŠ¡ åœ¨ Apache ä¸Šè¿è¡Œ CGI ç¨‹åº CGIï¼ˆå…¬å…±ç½‘å…³æ¥å£ï¼‰ï¼šè¿™æ˜¯ä¸€ç§å¹¿æ³›åº”ç”¨äºæ„å»ºåŠ¨æ€ Web ç«™ç‚¹çš„æŠ€æœ¯ï¼Œå®ƒæœ€åˆç”± NCSAï¼ˆå›½å®¶è¶…çº§è®¡ç®—æœºåº”ç”¨ä¸­å¿ƒï¼‰å¼€å‘ã€‚CGI å®šä¹‰äº†æœåŠ¡å™¨å¦‚ä½•ä¸ç”ŸæˆåŠ¨æ€å†…å®¹çš„ç¨‹åºäº¤äº’ï¼Œå¸¸ç”¨çš„ç¼–ç¨‹è¯­è¨€åŒ…æ‹¬ Perl å’Œ Cã€‚ åœ¨ Apache ä¸Šå¯ä»¥ä½¿ç”¨ mod_cgi æ¨¡å—æ¥è¿è¡Œè¿™äº› CGI ç¨‹åºã€‚ é…ç½®åŠ¨æ€ç½‘ç«™Apache + MySQL + PHPè¿™ç§ç»„åˆæ‹“å±•äº† Web æœåŠ¡å™¨çš„åŠŸèƒ½ï¼Œå½¢æˆäº†å¦‚ä¸‹æ¶æ„ï¼š Internet ä½¿ç”¨è€… - WebServer(Apache) - PHP - æ•°æ®åº“/ç½‘ç»œåŠŸèƒ½/å…¶ä»–åŠŸèƒ½åº“ åœ¨ Apache ä¸Šå®‰è£…å’Œè¿è¡Œ PHP å®‰è£… PHP æ—¶æ‰€éœ€çš„å‘½ä»¤ä¸ºï¼š # rpm -ivh curl-7.9.8-5.i386.rpm# rpm -ivh gd-1.8.4-11.i386.rpm# rpm -ivh php-4.2.2-17.i386.rpm# rpm -ivh php-imap-4.2.2-17.i386.rpm# rpm -ivh php-mysql-4.2.2-17.i386.rpm PHP ä½œä¸º Apache çš„ä¸€ä¸ªæ¨¡å—è¿è¡Œï¼Œåªéœ€å¯åŠ¨ Apache å³å¯è‡ªåŠ¨åŠ è½½ï¼Œä¸éœ€é¢å¤–æ‰‹åŠ¨å¯ç”¨ã€‚ phpMyAdmin phpMyAdmin æ˜¯ä¸€ç§ç”¨ PHP ç¼–å†™çš„åŸºäº Web çš„ MySQL ç®¡ç†å·¥å…·ï¼Œä¸ºç”¨æˆ·æä¾›äº†å›¾å½¢åŒ–ç•Œé¢æ¥ç®¡ç† MySQL æ•°æ®åº“ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è®¿é—® phpmyadmin.sourceforge.net ä¸‹è½½å·¥å…·ã€‚ å®‰è£…è¿‡ç¨‹ä¸­ï¼Œéœ€è§£å‹å’Œä¿®æ”¹é…ç½®æ–‡ä»¶ config.inc.php ä¸­çš„è®¾ç½®ï¼š $cfg[Servers][$i][auth_type] = http; $cfg[Servers][$i][password] = yourmysqlrootpasswd; Apache ä¸Šçš„è™šæ‹Ÿä¸»æœº è™šæ‹Ÿä¸»æœº æ˜¯æŒ‡åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šå®ç°å¤šä¸ªç½‘ç«™ï¼Œé€šè¿‡å¦‚ä¸‹æ–¹å¼å®ç°ï¼š ä¸åŒçš„è™šæ‹Ÿä¸»æœºå¯ä»¥æŒ‡å‘ä¸åŒçš„ IP åœ°å€å’Œç«¯å£å·ã€‚ ä¸åŒçš„è™šæ‹Ÿä¸»æœºé€šè¿‡ä¸åŒçš„ä¸»æœºå¤´ï¼ˆå³åŸŸåï¼‰è¯†åˆ«ã€‚ è™šæ‹Ÿä¸»æœºé…ç½®æŒ‡ä»¤è™šæ‹Ÿä¸»æœºé…ç½®ä¸­å¸¸ç”¨çš„æŒ‡ä»¤åŒ…æ‹¬ï¼š ServerAdminï¼šæŒ‡å®šè™šæ‹Ÿä¸»æœºç®¡ç†å‘˜çš„ E-mail åœ°å€ï¼› DocumentRootï¼šå®šä¹‰è™šæ‹Ÿä¸»æœºçš„æ ¹æ–‡æ¡£ç›®å½•ï¼› ServerNameï¼šè®¾ç½®è™šæ‹Ÿä¸»æœºçš„åç§°åŠå…¶æ‰€ç”¨çš„ç«¯å£å·ï¼› ErrorLogï¼šæŒ‡å®šè™šæ‹Ÿä¸»æœºçš„é”™è¯¯æ—¥å¿—å­˜æ”¾è·¯å¾„ï¼› CustomLogï¼šæŒ‡å®šè™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿—å­˜æ”¾è·¯å¾„ã€‚ è¿˜å¯ä»¥åœ¨ VirtualHost å®¹å™¨ä¸­ä½¿ç”¨ Directory å®¹å™¨è¿›è¡Œå¯¹ç›®å½•çš„è¿›ä¸€æ­¥è®¿é—®æ§åˆ¶é…ç½®ã€‚ é…ç½®è™šæ‹Ÿä¸»æœº å¯ä»¥æ ¹æ®éœ€è¦é…ç½®ç›¸åŒ IP ä½†ä¸åŒç«¯å£å·çš„è™šæ‹Ÿä¸»æœºï¼Œä¸åŒ IP ä½†ç›¸åŒç«¯å£å·çš„è™šæ‹Ÿä¸»æœºï¼Œæˆ–è€…åŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœºã€‚ é€šè¿‡è¿™äº›é…ç½®ï¼Œç”¨æˆ·èƒ½å¤Ÿæœ‰é’ˆå¯¹æ€§åœ°ä¼˜åŒ–è‡ªå·±çš„ Apache æœåŠ¡å™¨è®¾ç½®ï¼Œä»¥ç¡®ä¿åœ¨å„ç§ç¯å¢ƒä¸‹éƒ½èƒ½ç¨³å®šã€é«˜æ•ˆåœ°è¿è¡Œå„ç±» Web åº”ç”¨ä¸æœåŠ¡ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨"]},{"title":"Obsidianåœ¨iosç«¯åˆ©ç”¨git åŒæ­¥","path":"/2024/09/16/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-Obsidianåœ¨iosç«¯åˆ©ç”¨git-åŒæ­¥/","content":"åœ¨ Apple Store ä¸‹è½½å¹¶å®‰è£… iSH åº”ç”¨ç¨‹åºã€‚iSH æ˜¯ä¸€ä¸ªåŸºäº Alpine Linux çš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼Œå…è®¸ç”¨æˆ·åœ¨ iOS è®¾å¤‡ä¸Šä½¿ç”¨ Linux ç¯å¢ƒã€‚ æ‰“å¼€å·²å®‰è£…çš„ iSH åº”ç”¨ç¨‹åºï¼Œå¹¶æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ‰§è¡Œå‘½ä»¤ï¼š å®‰è£… GitGit æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå®ƒå¸®åŠ©å¼€å‘è€…ç®¡ç†å’Œè·Ÿè¸ªæ–‡ä»¶çš„å˜åŒ–ã€‚åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä»¥å®‰è£… Gitï¼š apk add git è¿™æ¡å‘½ä»¤ä¼šä» Alpine è½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ˆapkï¼‰ä¸­ä¸‹è½½å®‰è£… Gitã€‚ åˆ›å»ºåä¸º â€œobsidianâ€ çš„æ–°æ–‡ä»¶å¤¹é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œå¯ä»¥åœ¨å½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹å°†ç”¨äºå­˜å‚¨ä¸ Obsidian ç›¸å…³çš„æ•°æ®ï¼š cd ~ mkdir obsidian è¿™é‡Œçš„ cd ~ åˆ‡æ¢åˆ°ä¸»ç›®å½•ï¼Œmkdir obsidian åˆ™åˆ›å»ºä¸€ä¸ªåä¸º â€œobsidianâ€ çš„æ–°æ–‡ä»¶å¤¹ã€‚ è£…è½½æœ¬åœ°çš„ obsidian æ–‡ä»¶å¤¹åˆ° iSHè¾“å…¥ä»¥ä¸‹å‘½ä»¤ä¼šæ‰“å¼€æ‰‹æœºçš„æ–‡ä»¶ç®¡ç†å™¨ï¼Œè®©é€‰æ‹©æœ¬åœ°å­˜å‚¨ä¸­çš„ obsidian æ–‡ä»¶å¤¹ã€‚é€‰æ‹©åç‚¹å‡»å®Œæˆï¼Œè¿™ä¸€æ­¥éª¤ç¡®ä¿ Obsidian è½¯ä»¶ä¸­çš„ â€œmathâ€ æ–‡ä»¶å¤¹ä¸ iSH ä¸Šçš„ obsidian æ–‡ä»¶å¤¹ç›¸äº’è¿æ¥ã€‚è¿™æ ·ï¼Œåœ¨ Obsidian ä¸­å¯¹ â€œmathâ€ æ–‡ä»¶å¤¹çš„ä»»ä½•ä¿®æ”¹éƒ½å°†åŠæ—¶åŒæ­¥åˆ° iSH ç¯å¢ƒä¸­ï¼š mount -t ios . obsidian è¿›å…¥ obsidian æ–‡ä»¶å¤¹è¾“å…¥ä»¥ä¸‹å‘½ä»¤åˆ‡æ¢åˆ°åˆšæ‰åˆ›å»ºçš„ obsidian æ–‡ä»¶å¤¹ä¸­ï¼š cd ~/obsidian è¿™ä¸€æ­¥ä½¿å¯ä»¥åœ¨ iSH ä¸­æŸ¥çœ‹å’Œæ“ä½œè¯¥æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶ã€‚ å…‹éš† Git ä»“åº“åˆ° obsidian ç›®å½•å°†çš„ Git ä»“åº“å…‹éš†åˆ° obsidian æ–‡ä»¶å¤¹ä¸­ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤å¹¶åœ¨æç¤ºæ—¶è¾“å…¥çš„ GitHub è´¦å·å’Œä¸ªäººè®¿é—®å¯†é’¥ï¼ˆpersonal access tokenï¼‰ï¼š git clone https://xxxxxx.git ç¡®ä¿å°† https://xxxxxx.git æ›¿æ¢ä¸ºçš„å®é™… Git ä»“åº“ URLã€‚æˆåŠŸåï¼Œå°±èƒ½çœ‹åˆ°ä»“åº“ä¸­çš„æ‰€æœ‰æ–‡ä»¶åœ¨ obsidian æ–‡ä»¶å¤¹é‡Œã€‚ æ‰“å¼€ Obsidian å¹¶é…ç½® Git è´¦å·å¯†ç å¯åŠ¨ Obsidian åï¼Œå°†çœ‹åˆ°ä¹‹å‰å…‹éš†ä¸‹æ¥çš„ä»“åº“æ–‡ä»¶ã€‚æ¥ä¸‹æ¥ï¼Œæ‰“å¼€ Obsidian çš„ Git è®¾ç½®ï¼Œå¹¶è¾“å…¥çš„ Git è´¦å·å’Œå¯†ç ã€‚è¿™ä¸€æ­¥æ˜¯ä¸ºäº†ç¡®ä¿ä»»ä½•åœ¨ Obsidian ä¸­è¿›è¡Œçš„æ›´æ”¹éƒ½èƒ½é€šè¿‡ Git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶åŠåŒæ­¥ï¼Œä»è€Œæ›´å¥½åœ°ç®¡ç†å·¥ä½œã€‚","tags":["clippings"],"categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨"]},{"title":"WordPressæ­å»º","path":"/2024/09/13/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-åšå®¢-WordPressæ­å»º/","content":"æ­å»º WordPress ç½‘ç«™åœ¨å‡†å¤‡å·¥ä½œåé¦–å…ˆæ˜¯éƒ¨ç½² LNMP ç¯å¢ƒï¼ŒLNMP ç¯å¢ƒçš„éƒ¨ç½²è¯¦è§ LNMPç¯å¢ƒ MySQL æ•°æ®åº“é…ç½®é¦–å…ˆï¼Œä½¿ç”¨ root ç”¨æˆ·ç™»å½•åˆ° MySQL æ•°æ®åº“ã€‚ç¡®ä¿è¾“å…¥çš„æ˜¯åœ¨æ­å»ºç¯å¢ƒæ—¶ä¸ºæ•°æ®åº“è®¾ç½®çš„å¯†ç ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ç™»å½•ï¼š mysql -uroot -p ä¸º WordPress ç½‘ç«™åˆ›å»ºæ•°æ®åº“åœ¨ MySQL ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“ï¼Œä»¥ä¾¿å­˜æ”¾ WordPress ç½‘ç«™çš„æ•°æ®ã€‚æœ¬æ•™ç¨‹ä¸­ï¼Œæ•°æ®åº“åç§°ä¸º wordpressã€‚æ‰§è¡Œä»¥ä¸‹ SQL å‘½ä»¤ï¼š create database wordpress; åˆ›å»ºæ–°ç”¨æˆ·ç®¡ç† WordPress åº“ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·æ¥ç®¡ç† WordPress æ•°æ®åº“ã€‚ä» MySQL 5.7 ç‰ˆæœ¬å¼€å§‹ï¼Œç³»ç»Ÿé»˜è®¤å¯ç”¨å¯†ç å¼ºåº¦éªŒè¯æ’ä»¶ validate_passwordã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰çš„å¯†ç å¼ºåº¦è§„åˆ™ï¼š show variables like %password%; åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œå°†åˆ›å»ºä¸€ä¸ªç”¨æˆ·åä¸º user çš„æ–°ç”¨æˆ·ï¼Œå¯†ç è®¾ç½®ä¸º PASSword123.ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºæ–°ç”¨æˆ·ï¼š create user user@localhost identified by PASSword123.; æ¥ç€ï¼Œèµ‹äºˆæ–°ç”¨æˆ·å¯¹ wordpress æ•°æ®åº“çš„æ‰€æœ‰æƒé™ï¼š grant all privileges on wordpress.* to user@localhost; ä¸ºäº†ä½¿é…ç½®ç”Ÿæ•ˆï¼Œæ‰§è¡Œï¼š flush privileges; æœ€åï¼Œé€€å‡º MySQL ç³»ç»Ÿï¼š exit; WordPress é…ç½®æ¥ä¸‹æ¥ï¼Œä¸‹è½½ WordPress å¹¶å°†å…¶ç§»åŠ¨åˆ°ç½‘ç«™æ ¹ç›®å½•ã€‚é¦–å…ˆï¼Œè¿›å…¥ Nginx ç½‘ç«™æ ¹ç›®å½•ï¼Œä¸‹è½½ WordPress çš„å‹ç¼©åŒ…ã€‚æœ¬ç¤ºä¾‹ä¸­ä¸‹è½½çš„æ˜¯è‹±æ–‡ç‰ˆæœ¬ï¼š cd /usr/share/nginx/htmlwget https://wordpress.org/wordpress-5.4.2.zip å¦‚æœéœ€è¦å®‰è£… WordPress çš„ä¸­æ–‡ç‰ˆæœ¬ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š wget https://cn.wordpress.org/latest-zh_CN.zip è¯·æ³¨æ„ï¼Œåç»­æ“ä½œä¸­ï¼Œéœ€è¦å°†å‹ç¼©åŒ…çš„æ–‡ä»¶åæ›¿æ¢ä¸º latest-zh_CN.zipã€‚ è§£å‹ WordPress å‹ç¼©åŒ…ï¼š unzip wordpress-5.4.2.zip åœ¨ WordPress å®‰è£…ç›®å½•ä¸‹ï¼Œå°† wp-config-sample.php æ–‡ä»¶å¤åˆ¶ä¸º wp-config.phpï¼Œå¹¶å°†åŸæ–‡ä»¶ä½œä¸ºå¤‡ä»½ï¼š cd /usr/share/nginx/html/wordpresscp wp-config-sample.php wp-config.php æ¥ä¸‹æ¥ï¼Œç¼–è¾‘ wp-config.php æ–‡ä»¶ä»¥æ·»åŠ æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼š vim wp-config.php æŒ‰ i é”®åˆ‡æ¢è‡³ç¼–è¾‘æ¨¡å¼ï¼Œå¹¶æ ¹æ®å·²é…ç½®çš„ WordPress æ•°æ®åº“ä¿¡æ¯ï¼Œä¿®æ”¹ä»¥ä¸‹ MySQL ç›¸å…³é…ç½®ï¼š // ** MySQL è®¾ç½® - å…·ä½“ä¿¡æ¯æ¥è‡ªæ­£åœ¨ä½¿ç”¨çš„ä¸»æœº ** ///** WordPressæ•°æ®åº“çš„åç§° */define(DB_NAME, wordpress);/** MySQLæ•°æ®åº“ç”¨æˆ·å */define(DB_USER, user);/** MySQLæ•°æ®åº“å¯†ç  */define(DB_PASSWORD, PASSword123.);/** MySQLä¸»æœº */define(DB_HOST, localhost); å®Œæˆåï¼ŒæŒ‰ä¸‹ Esc é”®å¹¶è¾“å…¥ :wqï¼Œç„¶åæŒ‰å›è½¦é”®ä¿å­˜å¹¶é€€å‡ºé…ç½®æ–‡ä»¶ã€‚ Nginx é…ç½®æ¥ä¸‹æ¥ï¼Œéœ€è¦ä¿®æ”¹ Nginx çš„é…ç½®æ–‡ä»¶ä»¥é€‚é… WordPressã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰“å¼€ Nginx é…ç½®æ–‡ä»¶ï¼š vi /etc/nginx/conf.d/default.conf åœ¨æ–‡ä»¶ä¸­æŒ‰ i é”®è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œæ‰¾åˆ° location / å¤§æ‹¬å·å†…çš„ root æŒ‡ä»¤ï¼Œå°†å…¶æ›¿æ¢ä¸º WordPress çš„æ ¹ç›®å½•ã€‚ä¾‹å¦‚ï¼š root /usr/share/nginx/html/wordpress; åŒæ—¶ï¼Œåœ¨ location ~ \\.php$ å¤§æ‹¬å·å†…ï¼Œåšç›¸åŒçš„ä¿®æ”¹ã€‚å®Œæˆåï¼ŒæŒ‰ Esc é”®è¾“å…¥ :wq ä¿å­˜å¹¶é€€å‡ºã€‚ æœ€åï¼Œé‡å¯ Nginx æœåŠ¡ä»¥ä½¿é…ç½®ç”Ÿæ•ˆï¼š systemctl restart nginx å®‰è£…å¹¶ç™»å½• WordPressè®¿é—® https://localhost:80 ï¼Œè¿™å°†å¼•å¯¼è¿›å…¥ WordPress çš„å®‰è£…é¡µé¢ã€‚æŒ‰ç…§è¯´æ˜å¡«å†™ç½‘ç«™çš„åŸºæœ¬ä¿¡æ¯ï¼Œç„¶åå•å‡»â€å®‰è£… WordPressâ€æŒ‰é’®ã€‚å¡«å†™ä¿¡æ¯å‚æ•°è¯´æ˜ï¼š ç«™ç‚¹æ ‡é¢˜ï¼š WordPress ç½‘ç«™çš„åç§°ï¼Œä¾‹å¦‚ï¼šdemowpã€‚ ç”¨æˆ·åï¼šç”¨äºç™»å½• WordPress çš„ç”¨æˆ·åï¼Œå»ºè®®é€‰æ‹©å®‰å…¨æ€§é«˜çš„åç§°ï¼Œä¾‹å¦‚ï¼štestwpã€‚ å¯†ç ï¼šç™»å½• WordPress æ‰€éœ€çš„å¯†ç ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨å®‰å…¨æ€§é«˜çš„å¯†ç ï¼Œä¾‹å¦‚ï¼šWp.123456ã€‚ çš„ç”µå­é‚®ä»¶ï¼šç”¨äºæ¥æ”¶é‡è¦é€šçŸ¥çš„ç”µå­é‚®ä»¶ï¼Œä¾‹å¦‚ï¼š1234567890@aliyun.comã€‚ å®Œæˆä¿¡æ¯å¡«å†™åï¼Œå•å‡»â€ç™»å½•â€æŒ‰é’®ã€‚è¾“å…¥åˆšåˆšè®¾ç½®çš„ç”¨æˆ·åå’Œå¯†ç ï¼ŒæˆåŠŸåå°†è¿›å…¥ WordPress çš„ç®¡ç†åå°ã€‚ å…¶ä»–é—®é¢˜WordPress ä¸­è®¾ç½®å›ºå®šé“¾æ¥åï¼Œè·³è½¬é¡µé¢æ— æ³•è®¿é—®ã€‚ä¸ºäº†è®©æœç´¢å¼•æ“æ›´å¥½åœ°æ”¶å½•çš„ç½‘ç«™ï¼Œå»ºè®®åœ¨ WordPress ä¸­è®¾ç½®ä¼ªé™æ€é“¾æ¥ã€‚ä½†åœ¨è®¾ç½®å›ºå®šé“¾æ¥ä¹‹å‰ï¼Œéœ€è¦åœ¨ Nginx æœåŠ¡å™¨ä¸­é…ç½®ä¼ªé™æ€è§„åˆ™ã€‚æ‰“å¼€ Nginx é…ç½®æ–‡ä»¶ï¼š vi /etc/nginx/conf.d/default.conf æŒ‰ i é”®è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œåœ¨ location / å¤§æ‹¬å·å†…ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š if (-f $request_filename/index.html)\trewrite (.*) $1/index.html break;if (-f $request_filename/index.php)\trewrite (.*) $1/index.php;if (!-f $request_filename)\trewrite (.*) /index.php; ä¿å­˜é€€å‡ºæ–‡ä»¶åé‡å¯ Nginx æœåŠ¡ï¼š systemctl restart nginx WordPress ä¸­æ›´æ–°ç‰ˆæœ¬ã€ä¸Šä¼ ä¸»é¢˜æˆ–æ’ä»¶æ—¶ï¼Œæç¤ºéœ€è¦ FTP ç™»å½•å‡­è¯æˆ–æ— æ³•åˆ›å»ºç›®å½•ã€‚æ‰“å¼€ WordPress çš„é…ç½®æ–‡ä»¶ï¼š vim /usr/share/nginx/html/wordpress/wp-config.php åœ¨æ–‡ä»¶çš„æœ€ä¸‹æ–¹ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š define(FS_METHOD,direct);define(FS_CHMOD_DIR, 0777);define(FS_CHMOD_FILE, 0777); ä¿å­˜å¹¶é€€å‡ºé…ç½®æ–‡ä»¶ã€‚è¿”å› WordPress ä»ªè¡¨ç›˜ï¼Œåˆ·æ–°é¡µé¢ã€‚è¿™å°†æœ‰åŠ©äºè§£å†³éœ€è¦è¾“å…¥ FTP ç™»å½•å‡­è¯çš„é—®é¢˜ã€‚å¦‚æœé—®é¢˜ä¾ç„¶å­˜åœ¨ï¼Œå¯èƒ½éœ€è¦æ›´æ–° WordPress ç½‘ç«™æ ¹ç›®å½•çš„æƒé™ï¼Œå°†å…¶ç”¨æˆ·æ›´æ–°ä¸º Nginx å¯¹åº”çš„ç”¨æˆ·ã€‚åœ¨æœ¬ç¤ºä¾‹ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªç”¨æˆ·æ˜¯ nginxï¼š chown -R nginx /usr/share/nginx/html/wordpress","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨","åšå®¢"]},{"title":"davfs2æŒ‚è½½webdavä½œä¸ºæœ¬åœ°ç£ç›˜","path":"/2024/09/12/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-å·¥å…·-davfs2æŒ‚è½½webdavä½œä¸ºæœ¬åœ°ç£ç›˜/","content":"Linux ä½¿ç”¨ davfs2 æŒ‚è½½ webdav ä½œä¸ºæœ¬åœ°ç£ç›˜å¹¶å®ç°è‡ªåŠ¨æŒ‚è½½å½“ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿç¡¬ç›˜å®¹é‡æœ‰é™æ—¶ï¼Œä¾‹å¦‚åœ¨ä¸€äº›è½»é‡çº§çš„è®¾å¤‡æˆ–è™šæ‹Ÿæœºä¸Šï¼Œé™¤äº†æ·»åŠ ç‰©ç†æˆ–è™šæ‹Ÿç£ç›˜ä»¥å¢åŠ å­˜å‚¨ç©ºé—´ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé«˜æ•ˆä¸”ç»æµçš„è§£å†³æ–¹æ¡ˆï¼Œå³é€šè¿‡ WebDAV æ¥æŒ‚è½½ç½‘ç»œç£ç›˜ã€‚è¿™ç§æ–¹å¼ä¸ä»…æˆæœ¬ä½å»‰ï¼Œè€Œä¸”çµæ´»æ€§é«˜ï¼Œé€‚ç”¨æ€§å¹¿æ³›ã€‚ç›®å‰å¸‚åœºä¸Šæœ‰å¤šç§æ”¯æŒ WebDAV çš„äº‘å­˜å‚¨æœåŠ¡ï¼Œæ¯”å¦‚ Infini Cloudï¼ˆæ³¨å†Œæ—¶ä½¿ç”¨é‚€è¯·ç  32VVG å¯è·å¾—é¢å¤– 5GB çš„ç©ºé—´ï¼‰ï¼Œä»¥åŠå¾ˆå¤šè‡ªå»ºç½‘ç›˜ç¨‹åºï¼Œå¦‚ Cloudreveã€‚åŒæ—¶ï¼ŒAlist è¿™ç§å·¥å…·ä¹Ÿå¯ä»¥å°†å¤§éƒ¨åˆ†äº‘å­˜å‚¨æœåŠ¡è½¬æ¢æˆ WebDAV çš„å½¢å¼ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œåˆ©ç”¨ WebDAV æŒ‚è½½ç½‘ç»œç£ç›˜çš„æ–¹å¼æ˜¯ä¸€ä¸ªå€¼å¾—è€ƒè™‘çš„é€‰æ‹©ã€‚ ä½¿ç”¨ davfs2 æŒ‚è½½ç½‘ç›˜1. å®‰è£… davfs2åœ¨å®‰è£…ä¹‹å‰ï¼Œè¯·ç¡®ä¿ç³»ç»Ÿæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚ç„¶åæ ¹æ®ä½¿ç”¨çš„ Linux å‘è¡Œç‰ˆï¼Œé€‰æ‹©ç›¸åº”çš„å‘½ä»¤æ¥å®‰è£… davfs2ï¼š # CentOS ç³»ç»Ÿyum install davfs2# Ubuntu/Debian ç³»ç»Ÿapt install davfs2 2. åˆ›å»ºæŒ‚è½½ç›®å½•é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªç”¨äºæŒ‚è½½ WebDAV çš„ç›®å½•ã€‚è¿™å¯ä»¥æ˜¯ä»»ä½•ä½ç½®ï¼Œä½†å»ºè®®é€‰æ‹©ä¸€ä¸ªç®€æ´æ˜äº†çš„è·¯å¾„ï¼Œä¾‹å¦‚ï¼š mkdir /path/webdav è¿™ä¸ªç›®å½•å°†ä½œä¸º WebDAV å†…å®¹çš„è½½ä½“ï¼Œæ‰€æœ‰é€šè¿‡ WebDAV è®¿é—®çš„æ–‡ä»¶éƒ½ä¼šå±•ç°äºæ­¤ã€‚ 3. æŒ‚è½½ WebDAVè¦æŒ‚è½½ WebDAVï¼Œä½ éœ€è¦è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè®°å¾—å°† URL æ›¿æ¢ä¸ºå®é™…çš„ WebDAV åœ°å€ï¼š mount -t davfs https://webdav.drive.com/dav /path/webdav æ‰§è¡Œæ­¤å‘½ä»¤åï¼Œç³»ç»Ÿå°†æç¤ºè¾“å…¥ WebDAV çš„ç”¨æˆ·åå’Œå¯†ç ã€‚å»ºè®®æå‰æŸ¥é˜…ä½ çš„ç½‘ç›˜å®˜ç½‘æˆ–æ–‡æ¡£ï¼Œä»¥ç¡®ä¿è¾“å…¥çš„ä¿¡æ¯å‡†ç¡®æ— è¯¯ã€‚ å®Œæˆåï¼Œä½¿ç”¨ df -h å‘½ä»¤æ£€æŸ¥å½“å‰æŒ‚è½½çŠ¶æ€ã€‚æ­¤å‘½ä»¤å°†æ˜¾ç¤ºæ‰€æœ‰æŒ‚è½½çš„æ–‡ä»¶ç³»ç»ŸåŠå…¶ä½¿ç”¨æƒ…å†µï¼Œç¡®ä¿ä½ çš„ WebDAV å·²æˆåŠŸæŒ‚è½½ã€‚ é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½å¦‚æœæ¯æ¬¡é‡å¯åéƒ½éœ€æ‰‹åŠ¨æ‰§è¡ŒæŒ‚è½½å‘½ä»¤ï¼Œæ˜¾ç„¶ä¼šé€ æˆä¸ä¾¿ã€‚ä¸ºäº†å®ç°å¼€æœºè‡ªåŠ¨æŒ‚è½½ï¼Œå¯ä»¥é…ç½® davfs2 çš„ç›¸å…³æ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ systemd æœåŠ¡æ¥ç®€åŒ–è¿™ä¸€è¿‡ç¨‹ã€‚ 1. ä¿®æ”¹ davfs2.conf é…ç½®æ–‡ä»¶ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ davfs2 çš„ä¸»é…ç½®æ–‡ä»¶ï¼š nano /etc/davfs2/davfs2.conf åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ° use_locks å‚æ•°ï¼Œå°†å…¶å€¼ä» 1 ä¿®æ”¹ä¸º 0ã€‚è¿™ä¸€ä¿®æ”¹çš„ç›®çš„æ˜¯å…³é—­é”å®šæœºåˆ¶ï¼Œä»¥é¿å…åœ¨æŒ‚è½½æ—¶çš„æ½œåœ¨å†²çªã€‚ 2. ä¿®æ”¹ davfs2 çš„ secrets æ–‡ä»¶ï¼Œæ·»åŠ è®¤è¯ä¿¡æ¯æ¥ä¸‹æ¥ï¼Œæ·»åŠ  WebDAV çš„è®¤è¯ä¿¡æ¯ã€‚æ‰“å¼€ secrets æ–‡ä»¶ï¼š nano /etc/davfs2/secrets åœ¨æ–‡ä»¶çš„æœ«å°¾ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ä»¥æä¾› WebDAV åœ°å€åŠå…¶å¯¹åº”çš„ç”¨æˆ·åå’Œå¯†ç ï¼š https://webdav.drive.com/dav ç”¨æˆ·å å¯†ç  ç¡®ä¿ä¿¡æ¯æ— è¯¯ï¼Œè¿™æ ·å¯ä»¥åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å®Œæˆèº«ä»½éªŒè¯ã€‚ 3. é…ç½® systemd æ–‡ä»¶ä¸ºäº†ä½¿ WebDAV åœ¨æ¯æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚è½½ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª systemd æœåŠ¡æ–‡ä»¶ã€‚ä»¥ /path/webdav ä½œä¸ºæŒ‚è½½ç‚¹ï¼Œåˆ›å»ºåä¸º path-webdav.mount çš„é…ç½®æ–‡ä»¶ï¼š nano /etc/systemd/system/path-webdav.mount å»ºè®®éµå¾ªå‘½åçº¦å®šï¼Œé€šå¸¸æŒ‚è½½å•å…ƒæ–‡ä»¶çš„åç§°ä¸è¦æŒ‚è½½çš„è·¯å¾„ç›¸åŒ¹é…ï¼Œæ¯”å¦‚ /mnt/data æŒ‚è½½ç‚¹çš„å•å…ƒæ–‡ä»¶åº”å‘½åä¸º mnt-data.mountã€‚ åœ¨æ–‡ä»¶ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š [Unit]Description=Mount WebDAV ShareAfter=network-online.targetWants=network-online.target[Mount]What=https://webdav.drive.com/dav # æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹Where=/path/webdav # æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹Type=davfs Options=_netdev,users,rw[Install]WantedBy=multi-user.target ä¿å­˜æ–‡ä»¶åï¼Œé‡æ–°åŠ è½½ systemd çš„é…ç½®ï¼Œä»¥ç¡®ä¿æ–°è®¾ç½®ç”Ÿæ•ˆï¼š systemctl daemon-reload æ¥ä¸‹æ¥ï¼Œå¯ç”¨æ­¤æŒ‚è½½å•å…ƒï¼Œä½¿å…¶åœ¨æ¯æ¬¡å¯åŠ¨æ—¶éƒ½è‡ªåŠ¨æŒ‚è½½ï¼š systemctl enable path-webdav.mount é‡æ–°å¯åŠ¨ç³»ç»Ÿåï¼Œå†æ¬¡ä½¿ç”¨ df -h å‘½ä»¤æ£€æŸ¥ï¼Œè§‚å¯Ÿ WebDAV æ˜¯å¦å·²æˆåŠŸæŒ‚è½½ã€‚è¿™ä¸€è¿‡ç¨‹ç¡®ä¿åœ¨ç³»ç»Ÿé‡å¯åï¼Œç½‘ç»œç£ç›˜èƒ½å¤Ÿè‡ªåŠ¨è¿æ¥ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨","å·¥å…·"]},{"title":"å¾®ä¿¡å…¬ä¼—å·å¼€å‘å®Œæ•´æŒ‡å—","path":"/2024/09/06/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-å¾®ä¿¡å…¬ä¼—å·é…ç½®/","content":"æœåŠ¡æ–¹å¼å…¬ä¼—å·æä¾›ä¸¤ç§ä¸»è¦çš„æœåŠ¡æ–¹å¼ï¼š å…¬ä¼—å·æ¶ˆæ¯ä¼šè¯ï¼šè¿™ä¸€åŠŸèƒ½å…è®¸å…¬ä¼—å·ä¸ç”¨æˆ·ä¹‹é—´è¿›è¡Œæ¶ˆæ¯çš„åŒå‘äº¤æµã€‚åŒ…æ‹¬è¢«åŠ¨å›å¤ï¼Œå³ç”¨æˆ·ä¸»åŠ¨å‘é€ä¿¡æ¯åï¼Œå…¬ä¼—å·å¯ä»¥æ ¹æ®å†…å®¹è¿›è¡Œæ™ºèƒ½å›å¤ï¼Œè¿™æ ·å¯ä»¥æå¤§æå‡ç”¨æˆ·ä½“éªŒã€‚ å…¬ä¼—å·å†…åµŒç½‘é¡µï¼šé€šè¿‡å†…åµŒç½‘é¡µï¼Œå…¬ä¼—å·å¯ä»¥ç›´æ¥æä¾›ä¸€äº›æœåŠ¡ï¼Œå¦‚åœ¨çº¿å•†åŸã€æ´»åŠ¨æŠ¥åç­‰ï¼Œç”¨æˆ·å¯ä»¥åœ¨å¾®ä¿¡ä¸­å®Œæˆæ›´å¤šæ“ä½œï¼Œæ— éœ€è·³è½¬åˆ°å¤–éƒ¨æµè§ˆå™¨ã€‚ å…¬ä¼—å·æ¶ˆæ¯ç±»å‹å…¬ä¼—å·æ”¯æŒå¤šç§æ¶ˆæ¯ç±»å‹ï¼Œæ»¡è¶³ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ï¼š ç¾¤å‘æ¶ˆæ¯ï¼šå…¬ä¼—å·å¯ä»¥å®šæœŸå‘æ‰€æœ‰å…³æ³¨çš„ç”¨æˆ·å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œä¿æŒç”¨æˆ·çš„æ´»è·ƒåº¦å’Œå¯¹å“ç‰Œçš„å…³æ³¨ã€‚ è¢«åŠ¨å›å¤æ¶ˆæ¯ï¼šç”¨æˆ·ä¸»åŠ¨ç»™å…¬ä¼—å·å‘é€æ¶ˆæ¯åï¼Œå…¬ä¼—å·å¯ä»¥åœ¨ä¸ä¸»åŠ¨å‘å¸ƒå†…å®¹çš„æƒ…å†µä¸‹ï¼Œåšå‡ºç›¸åº”ã€‚è¿™è®©ç”¨æˆ·ä¸å…¬ä¼—å·çš„äº’åŠ¨æ˜¾å¾—è‡ªç„¶ä¸”æµç•…ã€‚ å®¢æœæ¶ˆæ¯ï¼šå½“ç”¨æˆ·ä¸»åŠ¨å‘æ¶ˆæ¯åˆ°å…¬ä¼—å·ï¼Œå…¬ä¼—å·åœ¨ 48 å°æ—¶å†…å¯ä»¥æ— é™åˆ¶åœ°å›å¤ã€‚è¿™å¯¹äºè§£å†³ç”¨æˆ·é—®é¢˜ã€æä¾›æ”¯æŒä»¥åŠåŠ å¼ºå®¢æˆ·å…³ç³»è‡³å…³é‡è¦ã€‚ æ¨¡æ¿æ¶ˆæ¯ï¼šå…¬ä¼—å·å¯ä»¥åˆ©ç”¨ç‰¹å®šçš„æ¨¡æ¿æ¥å‘ç”¨æˆ·å‘é€å†…å®¹ä¸°å¯Œçš„æ¶ˆæ¯ï¼Œæ¯”å¦‚è®¢å•çŠ¶æ€æ›´æ–°ã€æ´»åŠ¨é€šçŸ¥ç­‰ï¼Œä¿æŒç”¨æˆ·çš„ç³»ç»Ÿæ€§å…³æ³¨ã€‚ æ³¨å†Œä¸é…ç½®æ³¨å†Œå…¬ä¼—å·è®¿é—® æ³¨å†Œé¡µé¢ï¼ŒæŒ‰æ­¥éª¤å®Œæˆæ³¨å†Œã€‚ æ³¨å†Œæµ‹è¯•å·ï¼ˆæ¨èç”¨äºå¼€å‘ï¼‰æ³¨å†Œå¾®ä¿¡å…¬ä¼—å·æµ‹è¯•å·æ˜¯å¿«é€Ÿå¼€å§‹å¼€å‘çš„æœ€ä½³æ–¹å¼ã€‚è®¿é—® å¾®ä¿¡å…¬ä¼—å·å¹³å°çš„æµ‹è¯•å·ç”³è¯·é¡µé¢ï¼Œåˆ›å»ºæµ‹è¯•å·è¿›è¡Œå¼€å‘å’Œæµ‹è¯•ã€‚ è·å– appID å’Œ appsecretä¸€æ—¦æˆåŠŸæ³¨å†Œï¼Œå°†èƒ½å¤Ÿåœ¨å¾®ä¿¡å…¬ä¼—å·å¹³å°çš„åå°æŸ¥çœ‹åˆ°ç›¸å…³çš„ appID å’Œ appsecretã€‚è¿™ä¸¤ä¸ªå€¼æ˜¯è°ƒç”¨å¾®ä¿¡å…¬ä¼—å·æ¥å£çš„å‡­è¯ï¼Œç¡®ä¿å¦¥å–„ä¿å­˜ã€‚ å¾®ä¿¡å·è®¾ç½®è®¾ç½®åï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å¾®ä¿¡å·è½»æ¾æ‰¾åˆ°å…¬ä¼—å·ã€‚ ç¯å¢ƒæ­å»ºæœåŠ¡å™¨å‡†å¤‡æ‰¾ä¸€å°å…·æœ‰å…¬ç½‘ IP çš„æœåŠ¡å™¨ï¼ŒæœåŠ¡æä¾›å•†å¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘æˆ– AWS ç­‰éƒ½å¯ä»¥ã€‚ ä¿®æ”¹äº‘æœåŠ¡çš„å®‰å…¨ç»„ï¼Œç¡®ä¿å¼€æ”¾ 80 ç«¯å£ï¼ˆHTTPï¼‰æˆ– 443 ç«¯å£ï¼ˆHTTPSï¼‰ã€‚ å®‰è£… Python ç¯å¢ƒä½¿ç”¨ SSH è¿æ¥åˆ°æœåŠ¡å™¨åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š sudo apt updatesudo apt install python3 python3-pip nginxpip3 install flask uwsgi xmltodict requests Nginx + Flask + uWSGI é…ç½®åˆ›å»º uWSGI é…ç½®æ–‡ä»¶åˆ›å»º myapp.iniï¼š [uwsgi]module = wsgi:appmaster = trueprocesses = 5socket = myapp.sockchmod-socket = 660vacuum = truedie-on-term = true é…ç½® Nginxç¼–è¾‘ /etc/nginx/sites-available/defaultï¼š server listen 80 default_server; listen [::]:80 default_server; root /var/www/html; index index.html index.htm index.nginx-debian.html; location / try_files $uri $uri/ =404; location ~ ^/(wechat|get_*) proxy_pass http://localhost:9999; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Host $host; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; é‡å¯ Nginxï¼š sudo systemctl restart nginx æœåŠ¡å™¨é…ç½®å…¬ä¼—å·ç«¯é…ç½®åœ¨å…¬ä¼—å·ç®¡ç†åå°ï¼Œæ‰¾åˆ°æ¶ˆæ¯æœåŠ¡å™¨è®¾ç½®ï¼Œä¿®æ”¹ä»¥ä¸‹ä¿¡æ¯ï¼š URL: å¡«å…¥äº‘æœåŠ¡å™¨çš„ IP åœ°å€æˆ–åŸŸåï¼Œåé¢åŠ ä¸Šè·¯å¾„ï¼Œå¦‚ /wechatã€‚æ³¨æ„ï¼šç”±äºé»˜è®¤åªèƒ½ä½¿ç”¨ 80 ç«¯å£ï¼Œæ‰€ä»¥ä¸è¦åœ¨ URL åæ·»åŠ ç«¯å£å·ã€‚HTTP éœ€ä¸º 80 ç«¯å£ï¼ŒHTTPS åˆ™ä¸º 443 ç«¯å£ã€‚ Token: è¿™é‡Œå¡«å†™è‡ªå®šä¹‰çš„ tokenï¼Œç”¨äºç”Ÿæˆç­¾åï¼Œå¸®åŠ©å¾®ä¿¡æœåŠ¡å™¨è¯†åˆ«å…¬ä¼—å·çš„æœåŠ¡å™¨ï¼Œèµ·åˆ°è®¤è¯çš„ä½œç”¨ã€‚ EncodingAESKey: éšæœºç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨ä½œæ¶ˆæ¯åŠ è§£å¯†çš„å¯†é’¥ï¼Œç¡®ä¿æ¶ˆæ¯å®‰å…¨ã€‚ æœåŠ¡å™¨éªŒè¯éªŒè¯åŸç†å¼€å‘è€…éœ€è‡ªè¡Œæ¶è®¾æœåŠ¡å™¨ã€‚å½“å¡«å†™ URL å¹¶æäº¤åï¼Œå¾®ä¿¡æœåŠ¡å™¨å‘é€ GET è¯·æ±‚åˆ°å¼€å‘è€…çš„æœåŠ¡å™¨ï¼Œæºå¸¦å››ä¸ªå‚æ•°ï¼Œç”¨äºéªŒè¯ã€‚ æ ¡éªŒæµç¨‹ å¯¹ tokenã€timestampã€nonce ä¸‰ä¸ªå‚æ•°è¿›è¡Œå­—å…¸åºæ’åºã€‚ æ‹¼æ¥å­—ç¬¦ä¸²å¹¶è¿›è¡Œ SHA1 åŠ å¯†ã€‚ æ¯”è¾ƒåŠ å¯†åçš„å­—ç¬¦ä¸²ä¸å¾®ä¿¡è¿”å›çš„ signatureï¼Œç¡®è®¤è¯·æ±‚æ¥æºã€‚ æ ¡éªŒå‚æ•°è¯´æ˜ å‚æ•° æè¿° signature å¾®ä¿¡åŠ å¯†ç­¾åï¼Œç»“åˆ Tokenã€timestamp å’Œ nonce ç”Ÿæˆ timestamp è¯·æ±‚å‘é€çš„æ—¶é—´æˆ³ nonce éšæœºæ•° echostr éšæœºå­—ç¬¦ä¸²ï¼Œåœ¨æˆåŠŸéªŒè¯æ—¶è¿”å›è¯¥å€¼ æ ¡éªŒä»£ç å®ç°åŸºç¡€å®ç°import hashlibdef handle(request): try: signature = request.get(signature) timestamp = request.get(timestamp) nonce = request.get(nonce) echostr = request.get(echostr) token = your_token # è‡ªå®šä¹‰token params_list = [token, timestamp, nonce] params_list.sort() temp = .join(params_list) sha1 = hashlib.sha1(temp.encode(utf-8)) hashcode = sha1.hexdigest() if hashcode == signature: return echostr else: return except Exception as e: return str(e) Flask å®Œæ•´å®ç°from flask import Flask, requestimport hashlibapp = Flask(__name__)@app.route(/wechat, methods=[GET])def wechat_verify(): token = your_token data = request.args signature = data.get(signature) timestamp = data.get(timestamp) nonce = data.get(nonce) echostr = data.get(echostr) if not signature or not timestamp or not nonce: return False tmp_str = .join(sorted([token, timestamp, nonce])) tmp_str = hashlib.sha1(tmp_str.encode(UTF-8)).hexdigest() if tmp_str == signature: return echostr else: return Failedif __name__ == __main__: app.run(host=0.0.0.0, port=8000) ä½¿ç”¨ wechatpy å®ç°from wechatpy.utils import check_signaturefrom flask import Flask, requestapp = Flask(__name__)@app.route(/wechat_verify/, methods=[GET])def wechat_verify(): rq_dict = request.args if not rq_dict: return echostr = rq_dict.get(echostr) signature = rq_dict.get(signature) timestamp = rq_dict.get(timestamp) nonce = rq_dict.get(nonce) token = your_token try: check_signature(token, signature, timestamp, nonce) return echostr except InvalidSignatureException as e: return æ¶ˆæ¯å¤„ç†æ¶ˆæ¯å‘é€æµç¨‹å½“æ™®é€šç”¨æˆ·å‘å…¬ä¼—å·å‘æ¶ˆæ¯æ—¶ï¼Œå¾®ä¿¡æœåŠ¡å™¨ä¼šå°†æ¶ˆæ¯ä»¥ XML æ ¼å¼çš„ POST æ•°æ®åŒ…å‘é€ç»™å¼€å‘è€…è®¾å®šçš„ URLã€‚æ­¤æ—¶ï¼Œå…¬ä¼—å·å¯ä»¥è¦†ç›–å¾®ä¿¡æä¾›çš„è‡ªåŠ¨å›å¤åŠŸèƒ½ï¼Œå®ç°æ›´åŠ ä¸ªæ€§åŒ–çš„å“åº”ã€‚ XML æ¶ˆæ¯å¤„ç†å¾®ä¿¡æ¶ˆæ¯é€šä¿¡ä½¿ç”¨ XML æ•°æ®æ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨ xmltodict æ¨¡å—å¤„ç†ï¼š **xmltodict.parse()**ï¼šå°† XML æ•°æ®è½¬æ¢ä¸º Python å­—å…¸ã€‚ **xmltodict.unparse()**ï¼šå°†å­—å…¸è½¬æ¢ä¸º XML å­—ç¬¦ä¸²ã€‚ æ¥æ”¶æ¶ˆæ¯æ ¼å¼æ–‡æœ¬æ¶ˆæ¯xml ToUserName![CDATA[toUser]]/ToUserName FromUserName![CDATA[fromUser]]/FromUserName CreateTime1348831860/CreateTime MsgType![CDATA[text]]/MsgType Content![CDATA[this is a test]]/Content MsgId1234567890123456/MsgId/xml å‚æ•° æè¿° ToUserName å¼€å‘è€…å¾®ä¿¡å· FromUserName å‘é€æ–¹å¸å·ï¼ˆä¸€ä¸ª OpenIDï¼‰ CreateTime æ¶ˆæ¯åˆ›å»ºæ—¶é—´ ï¼ˆæ•´å‹ï¼‰ MsgType æ¶ˆæ¯ç±»å‹ï¼Œæ–‡æœ¬ä¸º text Content æ–‡æœ¬æ¶ˆæ¯å†…å®¹ MsgId æ¶ˆæ¯çš„ ID å›¾ç‰‡æ¶ˆæ¯xml ToUserName![CDATA[toUser]]/ToUserName FromUserName![CDATA[fromUser]]/FromUserName CreateTime1348831860/CreateTime MsgType![CDATA[image]]/MsgType PicUrl![CDATA[this is a url]]/PicUrl MediaId![CDATA[media_id]]/MediaId MsgId1234567890123456/MsgId/xml å‚æ•° æè¿° ToUserName å¼€å‘è€…çš„å¾®ä¿¡å· FromUserName å‘é€æ–¹å¸å·ï¼ˆä¸€ä¸ª OpenIDï¼‰ CreateTime æ¶ˆæ¯åˆ›å»ºæ—¶é—´ï¼ˆæ•´å‹ï¼‰ MsgType æ¶ˆæ¯ç±»å‹ï¼Œå€¼ä¸º image PicUrl å›¾ç‰‡é“¾æ¥ MediaId å›¾ç‰‡æ¶ˆæ¯åª’ä½“ ID MsgId æ¶ˆæ¯ IDï¼Œ64 ä½æ•´å‹ è¯­éŸ³æ¶ˆæ¯xml ToUserName![CDATA[toUser]]/ToUserName FromUserName![CDATA[fromUser]]/FromUserName CreateTime1357290913/CreateTime MsgType![CDATA[voice]]/MsgType MediaId![CDATA[media_id]]/MediaId Format![CDATA[Format]]/Format MsgId1234567890123456/MsgId/xml å‚æ•° æè¿° ToUserName å¼€å‘è€…çš„å¾®ä¿¡å· FromUserName å‘é€æ–¹å¸å·ï¼ˆä¸€ä¸ª OpenIDï¼‰ CreateTime æ¶ˆæ¯åˆ›å»ºæ—¶é—´ï¼ˆæ•´å‹ï¼‰ MsgType æ¶ˆæ¯ç±»å‹ï¼Œå€¼ä¸º voice MediaId è¯­éŸ³æ¶ˆæ¯åª’ä½“ ID Format è¯­éŸ³æ ¼å¼ï¼Œå¦‚ amrï¼Œspeex ç­‰ MsgId æ¶ˆæ¯ IDï¼Œ64 ä½æ•´å‹ è§†é¢‘æ¶ˆæ¯xml ToUserName![CDATA[toUser]]/ToUserName FromUserName![CDATA[fromUser]]/FromUserName CreateTime1357290913/CreateTime MsgType![CDATA[video]]/MsgType MediaId![CDATA[media_id]]/MediaId ThumbMediaId![CDATA[thumb_media_id]]/ThumbMediaId MsgId1234567890123456/MsgId/xml å‚æ•° æè¿° ToUserName å¼€å‘è€…çš„å¾®ä¿¡å· FromUserName å‘é€æ–¹å¸å·ï¼ˆä¸€ä¸ª OpenIDï¼‰ CreateTime æ¶ˆæ¯åˆ›å»ºæ—¶é—´ï¼ˆæ•´å‹ï¼‰ MsgType æ¶ˆæ¯ç±»å‹ï¼Œå€¼ä¸º video MediaId è§†é¢‘æ¶ˆæ¯åª’ä½“ ID ThumbMediaId è§†é¢‘æ¶ˆæ¯ç¼©ç•¥å›¾çš„åª’ä½“ ID MsgId æ¶ˆæ¯ IDï¼Œ64 ä½æ•´å‹ è¢«åŠ¨å›å¤æ¶ˆæ¯å›å¤æ–‡æœ¬æ¶ˆæ¯xml ToUserName![CDATA[toUser]]/ToUserName FromUserName![CDATA[fromUser]]/FromUserName CreateTime12345678/CreateTime MsgType![CDATA[text]]/MsgType Content![CDATA[ä½ å¥½]]/Content/xml å‚æ•° æ˜¯å¦å¿…é¡» æè¿° ToUserName æ˜¯ æ¥æ”¶æ–¹å¸å·ï¼ˆæ”¶åˆ°çš„ OpenIDï¼‰ FromUserName æ˜¯ å¼€å‘è€…å¾®ä¿¡å· CreateTime æ˜¯ æ¶ˆæ¯åˆ›å»ºæ—¶é—´ ï¼ˆæ•´å‹ï¼‰ MsgType æ˜¯ æ¶ˆæ¯ç±»å‹ï¼Œæ–‡æœ¬ä¸º text Content æ˜¯ å›å¤çš„æ¶ˆæ¯å†…å®¹ å›å¤å›¾ç‰‡æ¶ˆæ¯xml ToUserName![CDATA[toUser]]/ToUserName FromUserName![CDATA[fromUser]]/FromUserName CreateTime12345678/CreateTime MsgType![CDATA[image]]/MsgType Image MediaId![CDATA[media_id]]/MediaId /Image/xml å›å¤è¯­éŸ³æ¶ˆæ¯xml ToUserName![CDATA[toUser]]/ToUserName FromUserName![CDATA[fromUser]]/FromUserName CreateTime12345678/CreateTime MsgType![CDATA[voice]]/MsgType Voice MediaId![CDATA[media_id]]/MediaId /Voice/xml å›å¤è§†é¢‘æ¶ˆæ¯xml ToUserName![CDATA[toUser]]/ToUserName FromUserName![CDATA[fromUser]]/FromUserName CreateTime12345678/CreateTime MsgType![CDATA[video]]/MsgType Video MediaId![CDATA[media_id]]/MediaId Title![CDATA[title]]/Title Description![CDATA[description]]/Description /Video/xml Flask æ¶ˆæ¯å¤„ç†å®Œæ•´å®ç°from flask import Flask, requestimport hashlibimport xmltodictimport timeapp = Flask(__name__)@app.route(/wechat, methods=[GET, POST])def wechat(): if request.method == GET: token = your_token data = request.args signature = data.get(signature) timestamp = data.get(timestamp) nonce = data.get(nonce) echostr = data.get(echostr) temp = [timestamp, nonce, token] temp.sort() temp = .join(temp) if hashlib.sha1(temp.encode(utf8)).hexdigest() == signature: return echostr else: return error, 403 if request.method == POST: xml = request.data req = xmltodict.parse(xml)[xml] if text == req.get(MsgType): resp = ToUserName: req.get(FromUserName), FromUserName: req.get(ToUserName), CreateTime: int(time.time()), MsgType: text, Content: req.get(Content) xml = xmltodict.unparse(xml: resp) return xml else: resp = ToUserName: req.get(FromUserName, ), FromUserName: req.get(ToUserName, ), CreateTime: int(time.time()), MsgType: text, Content: æš‚ä¸æ”¯æŒæ­¤æ¶ˆæ¯ç±»å‹ xml = xmltodict.unparse(xml: resp) return xmlif __name__ == __main__: app.run(host=0.0.0.0, port=8000) å¼€å‘æ¡†æ¶é€‰æ‹©ä½¿ç”¨ werobot æ¡†æ¶werobot æ˜¯å¾®ä¿¡å…¬ä¼—å·å®˜æ–¹æ¨èçš„ç”¨äºè‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†çš„æ¨¡å—ã€‚ å®‰è£…pip install werobot åŸºç¡€ç¤ºä¾‹import werobotrobot = werobot.WeRoBot(token=your_token)@robot.handlerdef hello(messages): print(messages.content) return hello!robot.config[HOST] = 0.0.0.0robot.config[PORT] = 80robot.run() ChatGPT é›†æˆimport werobotfrom openai import OpenAIclient = OpenAI( api_key=YOUR_API_KEY, base_url=https://api.chatanywhere.tech/v1)robot = werobot.WeRoBot()class RobotConfig(object): HOST = 0.0.0.0 PORT = 80 TOKEN = your_tokenrobot.config.from_object(RobotConfig)def generate_response(prompt): messages = [role: user, content: prompt] completion = client.chat.completions.create( model=gpt-3.5-turbo, messages=messages ) return completion.choices[0].message.content@robot.handlerdef hello(messages): print(messages.content) return generate_response(messages.content)if __name__ == __main__: robot.run() ä¸»åŠ¨æ¶ˆæ¯æ¨é€è·å– access_tokenaccess_token æ˜¯å…¬ä¼—å·è°ƒç”¨å„ç±»æ¥å£çš„é‡è¦å‡­è¯ï¼Œå®ƒçš„æœ‰æ•ˆæœŸä¸º 2 å°æ—¶ã€‚è¦æœ€å¤§åŒ–åˆ©ç”¨è¿™ä¸ªå‡­è¯ï¼Œéœ€è¦æ—¶åˆ»ç›‘æ§å®ƒçš„æœ‰æ•ˆæœŸï¼Œå¹¶åœ¨è¿‡æœŸååŠæ—¶è·å–ã€‚æ¯å¤©æœ€å¤šå¯è·å– 2000 æ¬¡ access_tokenã€‚ API è°ƒç”¨GET https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credentialappid=APPIDsecret=APPSECRET ä»£ç å®ç°import requestsdef get_access_token(appid, appsecret): url = https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credentialappid=secret=.format(appid, appsecret) headers = User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.67 Safari/537.36 response = requests.get(url, headers=headers).json() access_token = response.get(access_token) return access_token è·å–ç²‰ä¸çš„ openidopenid æ˜¯å…³æ³¨å…¬ä¼—å·çš„ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ã€‚ API è°ƒç”¨GET https://api.weixin.qq.com/cgi-bin/user/get?access_token=ACCESS_TOKENnext_openid=NEXT_OPENID ä»£ç å®ç°import requestsimport jsondef get_openid(access_token): next_openid = url = https://api.weixin.qq.com/cgi-bin/user/get?access_token=%snext_openid=%s % (access_token, next_openid) ans = requests.get(url) open_ids = json.loads(ans.content)[data][openid] return open_ids å‘é€å®¢æœæ¶ˆæ¯API è°ƒç”¨POST https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token=ACCESS_TOKEN å‘é€æ–‡æœ¬æ¶ˆæ¯import requestsimport jsondef send_text_message(access_token, openid, content): url = https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token=.format(access_token) body = touser: openid, msgtype: text, text: content: content data = bytes(json.dumps(body, ensure_ascii=False).encode(utf-8)) response = requests.post(url, data=data) result = response.json() return result ä¸Šä¼ åª’ä½“æ–‡ä»¶def upload_media(access_token, media_type, media_path): url = https://api.weixin.qq.com/cgi-bin/media/upload?access_token=type=.format(access_token, media_type) media = media: open(media_path, rb) response = requests.post(url, files=media) parse_json = json.loads(response.content.decode()) return parse_json.get(media_id) å‘é€å›¾ç‰‡è¯­éŸ³æ¶ˆæ¯def send_media_message(access_token, openid, media_type, media_id): url = https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token=.format(access_token) if media_type == image: body = touser: openid, msgtype: image, image: media_id: media_id elif media_type == voice: body = touser: openid, msgtype: voice, voice: media_id: media_id data = bytes(json.dumps(body, ensure_ascii=False).encode(utf-8)) response = requests.post(url, data=data) result = response.json() return result å®Œæ•´çš„ SendMessage ç±»import requestsimport jsonclass SendMessage: def __init__(self, appid, appsecret): self.appid = appid self.appsecret = appsecret self.access_token = self.get_access_token() self.open_ids = self.get_openid() def get_access_token(self): url = https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credentialappid=secret=.format(self.appid, self.appsecret) headers = User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.67 Safari/537.36 response = requests.get(url, headers=headers).json() access_token = response.get(access_token) return access_token def get_openid(self): next_openid = url = https://api.weixin.qq.com/cgi-bin/user/get?access_token=%snext_openid=%s % (self.access_token, next_openid) ans = requests.get(url) open_ids = json.loads(ans.content)[data][openid] return open_ids def sendmsg(self, msg): url = https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token=.format(self.access_token) if self.open_ids: for open_id in self.open_ids: body = touser: open_id, msgtype: text, text: content: msg data = bytes(json.dumps(body, ensure_ascii=False).encode(utf-8)) response = requests.post(url, data=data) result = response.json() print(result) else: print(å½“å‰æ²¡æœ‰ç”¨æˆ·å…³æ³¨è¯¥å…¬ä¼—å·ï¼) def upload_media(self, media_type, media_path): url = https://api.weixin.qq.com/cgi-bin/media/upload?access_token=type=.format(self.access_token, media_type) media = media: open(media_path, rb) response = requests.post(url, files=media) parse_json = json.loads(response.content.decode()) return parse_json.get(media_id) def send_media_to_user(self, media_type, media_path): media_id = self.upload_media(media_type, media_path) url = https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token=.format(self.access_token) if self.open_ids: for open_id in self.open_ids: if media_type == image: body = touser: open_id, msgtype: image, image: media_id: media_id elif media_type == voice: body = touser: open_id, msgtype: voice, voice: media_id: media_id data = bytes(json.dumps(body, ensure_ascii=False).encode(utf-8)) response = requests.post(url, data=data) result = response.json() print(result) else: print(å½“å‰æ²¡æœ‰ç”¨æˆ·å…³æ³¨è¯¥å…¬ä¼—å·ï¼)if __name__ == __main__: data = Hello, World! sends = SendMessage(your_appid, your_appsecret) sends.sendmsg(data) sends.send_media_to_user(image, ./test.png) å†…åµŒç½‘é¡µå®ç°å†…åµŒç½‘é¡µçš„å®ç°åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š ç”¨æˆ·åŒæ„æˆæƒï¼Œè·å– codeï¼Œè¿™æ˜¯ç”¨æˆ·çš„æˆæƒä¹¦ã€‚ é€šè¿‡ code æ¢å–ç½‘é¡µæˆæƒ access_tokenï¼Œè¿™æ˜¯å¾®ä¿¡ä¸‹å‘çš„é€šä¿¡å‡­è¯ã€‚ æ‹‰å–ç”¨æˆ·ä¿¡æ¯ï¼ˆéœ€ scope ä¸º snsapi_userinfoï¼‰ã€‚ è®¾ç½®ç½‘é¡µæˆæƒå›è°ƒåŸŸåéœ€å¡«å†™åŸŸåï¼Œä¸åŒ…æ‹¬ http:// ç­‰å‰ç¼€ï¼Œä¹Ÿå¯å¡«å†™ IP å’Œç«¯å£ã€‚ å…¬ä¼—å·çš„ç½‘é¡µæ¥å£ æ¥å£ 1ï¼šè¯¥æ¥å£èƒ½è®©ç½‘é¡µè·å–ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œç®€åŒ–ç”¨æˆ·çš„ç™»å½•å’Œäº¤äº’ä½“éªŒã€‚å¼€å‘è€…éœ€è¦åœ¨å…¶ç½‘é¡µä¸­æ·»åŠ ç›¸å…³ä»£ç ã€‚ æ¥å£ 2ï¼šå¾®å‹ JS-SDK å…è®¸å¼€å‘è€…è½»æ¾ä½¿ç”¨å¾®ä¿¡çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æ‹ç…§ã€å½•éŸ³ã€å®šä½ç­‰ï¼Œå¢å¼ºç½‘é¡µç”¨æˆ·çš„äº’åŠ¨ä½“éªŒã€‚ API æ¥å£å‚è€ƒè·å– access_tokenGET https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credentialappid=APPIDsecret=APPSECRET è·å–å¾®ä¿¡ IP åœ°å€GET https://api.weixin.qq.com/cgi-bin/getcallbackip?access_token=ACCESS_TOKEN è‡ªå®šä¹‰èœå•POST https://api.weixin.qq.com/cgi-bin/menu/create?access_token=ACCESS_TOKEN éƒ¨ç½²ä¸è¿ç»´åå°è¿è¡Œæ–¹æ³•ä¸€ï¼šä½¿ç”¨ nohup å‘½ä»¤ï¼ˆæœ€ç®€å•ï¼‰nohup python3 app.py nohupï¼šå¿½ç•¥æŒ‚èµ·ä¿¡å·ï¼Œé˜²æ­¢ç»ˆç«¯å…³é—­æ—¶ç»ˆæ­¢è¿›ç¨‹ ï¼šåå°è¿è¡Œ è¾“å‡ºä¼šè‡ªåŠ¨ä¿å­˜åˆ°å½“å‰ç›®å½•çš„ nohup.out æ–‡ä»¶ä¸­ æ–¹æ³•äºŒï¼šä½¿ç”¨ screen å·¥å…·ï¼ˆæ¨èï¼‰ å®‰è£… screenï¼š sudo apt install screen åˆ›å»ºæ–°çš„ screen ä¼šè¯ï¼š screen -S wechat_session åœ¨ screen ä¼šè¯ä¸­è¿è¡Œè„šæœ¬ï¼š python3 app.py æŒ‰ Ctrl+A ç„¶åæŒ‰ D æš‚æ—¶ç¦»å¼€ä¼šè¯ï¼ˆè„šæœ¬ç»§ç»­è¿è¡Œï¼‰ åç»­å¯ä»¥éšæ—¶é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¢å¤ä¼šè¯ï¼š screen -r wechat_session æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ systemd æœåŠ¡ï¼ˆé€‚åˆé•¿æœŸç¨³å®šè¿è¡Œï¼‰åˆ›å»ºä¸€ä¸ª systemd æœåŠ¡é…ç½®æ–‡ä»¶ï¼š sudo nano /etc/systemd/system/wechat.service å†…å®¹å¦‚ä¸‹ï¼š [Unit]Description=WeChat Bot ServiceAfter=network.target[Service]ExecStart=/usr/bin/python3 /home/ubuntu/app.pyWorkingDirectory=/home/ubuntuRestart=alwaysUser=ubuntu[Install]WantedBy=multi-user.target ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š sudo systemctl daemon-reloadsudo systemctl start wechat.servicesudo systemctl enable wechat.service æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼š sudo systemctl status wechat.service ç¡®ä¿è„šæœ¬ç¨³å®šè¿è¡Œ åœ¨è„šæœ¬ä¸­æ·»åŠ å¼‚å¸¸æ•è·æœºåˆ¶ï¼š while True: try: app.run(host=0.0.0.0, port=8000) except Exception as e: print(fError: e) time.sleep(5) ä½¿ç”¨ systemd çš„ Restart=always é€‰é¡¹ï¼Œç¡®ä¿æœåŠ¡å´©æºƒåè‡ªåŠ¨é‡å¯ å®šæœŸæ£€æŸ¥è„šæœ¬è¿è¡ŒçŠ¶æ€ï¼Œæ·»åŠ å¥åº·æ£€æŸ¥æœºåˆ¶ è§†å›¾å¤„ç†åŸåˆ™å»ºè®®å°†æ™®é€šæ¶ˆæ¯å¤„ç†æ”¾åœ¨ä¸€ä¸ªè§†å›¾ä¸­è¿›è¡Œåˆ¤æ–­å’Œå¤„ç†ï¼Œç®€åŒ–è§†å›¾æ•°é‡ã€‚å½“å¤„ç†æ—¶é—´è¶…è¿‡ 5 ç§’æœªå®Œæˆæ—¶ï¼Œå…ˆè¿”å›æˆåŠŸæˆ–ç©ºå­—ç¬¦ä¸²ï¼Œé¿å…è§¦å‘å¾®ä¿¡çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚ å¾…è¡¥å……åŠŸèƒ½ å¢åŠ è¯­éŸ³æ¶ˆæ¯æ”¯æŒï¼ˆè¯­éŸ³æ¶ˆæ¯è¯†åˆ«è½¬æ–‡å­—ï¼‰ å‘é€å®šæ—¶æ¶ˆæ¯æé†’ å…¬ä¼—å·è¿”å›è¶…æ—¶é—®é¢˜ä¼˜åŒ– å¾®ä¿¡å¼€å‘æ–‡æ¡£æ¬²äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯å’Œæœ€æ–°æ›´æ–°ï¼Œè®¿é—® å¾®ä¿¡å¼€å‘æ–‡æ¡£ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨","å¾®ä¿¡"]},{"title":"Cè¯­è¨€å‡½æ•°é€ŸæŸ¥","path":"/2024/09/05/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-å‡½æ•°-Cè¯­è¨€å‡½æ•°é€ŸæŸ¥/","content":"å­—ç¬¦ä¸²å‡½æ•°ï¼ˆstringï¼‰ bcmpæ¯”è¾ƒå­—ç¬¦ä¸² s1 å’Œ s2 çš„å‰ n ä¸ªå­—èŠ‚æ˜¯å¦ç›¸ç­‰ã€‚è¿™å¯ç”¨äºæ£€éªŒä¸¤ä¸ªå­ä¸²æ˜¯å¦ç›¸åŒï¼Œå¸¸ç”¨äºéªŒè¯æ•°æ®å®Œæ•´æ€§æˆ–æ ¡éªŒã€‚ bcopyå°†å­—ç¬¦ä¸² src çš„å‰ n ä¸ªå­—èŠ‚å¤åˆ¶åˆ° dest ä¸­ã€‚è¿™ä¸ªå‡½æ•°ç”¨äºåœ¨å†…å­˜ä¸­å¿«é€Ÿåœ°ç§»åŠ¨æ•°æ®ï¼Œå¸¸è§äºæ“ä½œå­—ç¬¦ä¸²æˆ–ç¼“å†²åŒºæ—¶çš„å¤åˆ¶éœ€æ±‚ã€‚ bzeroå°†å­—èŠ‚å­—ç¬¦ä¸² s çš„å‰ n ä¸ªå­—èŠ‚ç½®ä¸ºé›¶ã€‚åœ¨åˆå§‹åŒ–æ•°æ®ç»“æ„æ—¶å¸¸ç”¨ï¼Œæ¯”å¦‚æ¸…ç©ºä¸€ä¸ªæ•°ç»„ï¼Œç¡®ä¿æ²¡æœ‰åƒåœ¾å€¼å­˜åœ¨ã€‚ memccpyä» src æ‰€æŒ‡å†…å­˜åŒºåŸŸå¤åˆ¶ä¸è¶…è¿‡ count ä¸ªå­—èŠ‚åˆ° destï¼Œå¦‚æœé‡åˆ°å­—ç¬¦ ch åˆ™åœæ­¢å¤åˆ¶ã€‚è¯¥å‡½æ•°å¯ä»¥åœ¨å¤åˆ¶é€”ä¸­æŸ¥æ‰¾ç‰¹å®šå­—ç¬¦ï¼Œååˆ†é€‚åˆå¤„ç†éœ€è¦åˆ†éš”çš„æ•°æ®ã€‚ memchrä» buf æ‰€æŒ‡å†…å­˜çš„å‰ count å­—èŠ‚ä¸­æŸ¥æ‰¾å­—ç¬¦ chã€‚è¿”å›æŒ‡å‘é¦–æ¬¡å‡ºç°è¯¥å­—ç¬¦çš„æŒ‡é’ˆï¼Œå¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å› NULLã€‚é€‚åˆæŸ¥æ‰¾æ•°æ®åŒ…ä¸­çš„ç‰¹å®šæ ‡å¿—ã€‚ memcmpæ¯”è¾ƒå†…å­˜åŒºåŸŸ buf1 å’Œ buf2 çš„å‰ count ä¸ªå­—èŠ‚ã€‚è¿™å¯ä»¥ç”¨äºäºŒè¿›åˆ¶æ•°æ®æ¯”è¾ƒï¼Œä¾‹å¦‚åœ¨ç½‘ç»œåè®®ä¸­æ ¡éªŒæ¥æ”¶æ•°æ®æ˜¯å¦æ­£ç¡®ã€‚ memcpyå°†ä» src æ‰€æŒ‡å†…å­˜åŒºåŸŸå¤åˆ¶ count ä¸ªå­—èŠ‚åˆ° dest ä¸­ã€‚è¿™ä¸ªå‡½æ•°è´Ÿè´£ç²¾å‡†æ— è¯¯çš„å­—èŠ‚æ‹·è´æ“ä½œï¼Œå¸¸ç”¨äºæ•°æ®ç®¡ç†å’Œç¼“å†²ã€‚ memicmpæ¯”è¾ƒå†…å­˜åŒºåŸŸ buf1 å’Œ buf2 çš„å‰ count ä¸ªå­—èŠ‚ï¼Œä½†ä¸åŒºåˆ†å­—æ¯çš„å¤§å°å†™ã€‚éå¸¸é€‚åˆéœ€è¦å¿½ç•¥å¤§å°å†™çš„å­—ç¬¦ä¸²æ¯”è¾ƒæƒ…å†µã€‚ memmoveç±»ä¼¼äº memcpyï¼Œä½†å®ƒæ”¯æŒåœ¨å†…å­˜é‡å æ—¶çš„å®‰å…¨å¤åˆ¶ã€‚è¿™æ„å‘³ç€æ•°æ®å¯ä»¥åœ¨é‡å å†…å­˜åŒºåŸŸé—´å®‰å…¨ç§»åŠ¨ï¼Œä¾‹å¦‚åœ¨æ•°ç»„å…ƒç´ æ’åºæ—¶ã€‚ memsetå°† buffer æ‰€æŒ‡å†…å­˜åŒºåŸŸçš„å‰ count ä¸ªå­—èŠ‚è®¾ç½®ä¸ºå­—ç¬¦ cã€‚å¯ä»¥å¿«é€Ÿæ¸…ç†æˆ–åˆå§‹åŒ–å†…å­˜ç©ºé—´ï¼Œä¾‹å¦‚å¡«å……æ•°ç»„ã€‚ movmemç”± src æ‰€æŒ‡å†…å­˜åŒºåŸŸå¤åˆ¶ count ä¸ªå­—èŠ‚åˆ° destã€‚å®ƒå’Œ memmove ç±»ä¼¼ï¼Œä¸»è¦ç”¨äºç‰¹å®šæƒ…å†µä¸‹çš„å†…å­˜ç§»åŠ¨ã€‚ setmemå°† buf æ‰€æŒ‡å†…å­˜åŒºåŸŸçš„å‰ count ä¸ªå­—èŠ‚è®¾ç½®ä¸ºå­—ç¬¦ chï¼Œæœ‰åŠ©äºç»Ÿä¸€æ•°æ®æ ¼å¼æˆ–åˆå§‹åŒ–ã€‚ stpcpyå°† src æ‰€æŒ‡çš„ä»¥ NULL ç»“æŸçš„å­—ç¬¦ä¸²å¤åˆ¶åˆ° dest æ‰€æŒ‡çš„æ•°ç»„ä¸­ï¼Œå¹¶è¿”å›æŒ‡å‘ç»“æœå­—ç¬¦ä¸²æœ«å°¾çš„æŒ‡é’ˆã€‚è¿™å¯¹äºå­—ç¬¦ä¸²çš„è¿›ä¸€æ­¥å¤„ç†å’Œæ‹¼æ¥ååˆ†æ–¹ä¾¿ã€‚ strcatå°† src æ‰€æŒ‡å­—ç¬¦ä¸²æ·»åŠ åˆ° dest ç»“å°¾ï¼Œå¹¶åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ª \\0ã€‚ä¾‹å¦‚ï¼Œå°†ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„é™„åŠ åˆ°æ ¹ç›®å½•è·¯å¾„åï¼Œå½¢æˆå®Œæ•´è·¯å¾„ã€‚ strchræŸ¥æ‰¾å­—ç¬¦ä¸² s ä¸­é¦–æ¬¡å‡ºç°å­—ç¬¦ c çš„ä½ç½®ï¼Œè¿”å›æŒ‡å‘è¯¥ä½ç½®çš„æŒ‡é’ˆã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œè¿”å› NULLã€‚è¿™ä¸ªåŠŸèƒ½å¯¹æŸ¥æ‰¾ç‰¹å®šå­—ç¬¦éå¸¸å®ç”¨ã€‚ strcmpæ¯”è¾ƒå­—ç¬¦ä¸² s1 å’Œ s2ï¼Œè¿”å›å€¼ç”¨äºåˆ¤æ–­å­—å…¸åºå…³ç³»ã€‚å®ƒæ˜¯å¤„ç†å­—ç¬¦ä¸²æ’åºå’ŒæŸ¥æ‰¾çš„é‡è¦å‡½æ•°ã€‚ strcmpiä¸åŒºåˆ†å­—æ¯å¤§å°å†™åœ°æ¯”è¾ƒ s1 å’Œ s2ã€‚å¯¹äºéœ€è¦ç”¨æˆ·è¾“å…¥ä¸æ•æ„Ÿçš„æ¯”è¾ƒåœºæ™¯éå¸¸æœ‰ç”¨ã€‚ strcpyå°† src æŒ‡å‘çš„ä»¥ NULL ç»“æŸçš„å­—ç¬¦ä¸²å¤åˆ¶åˆ° dest æŒ‡å‘çš„æ•°ç»„ä¸­ï¼Œé€‚åˆä¸€èˆ¬å­—ç¬¦ä¸²åˆå§‹åŒ–ã€‚ strcspnåœ¨å­—ç¬¦ä¸² s1 ä¸­æœå¯» s2 ä¸­å‡ºç°çš„å­—ç¬¦ï¼Œå¹¶è¿”å›é¦–æ¬¡å‡ºç°çš„ä½ç½®ï¼Œé€‚åˆè¿‡æ»¤ç‰¹å®šå­—ç¬¦é›†ã€‚ strdupå¤åˆ¶å­—ç¬¦ä¸²ï¼Œåˆ›å»ºè¯¥å­—ç¬¦ä¸²çš„æ–°å‰¯æœ¬ã€‚å¯ä»¥ç”¨äºåŠ¨æ€å†…å­˜ç®¡ç†ä¸­ï¼Œä¾‹å¦‚éœ€è¦å­˜å‚¨å¤åˆ¶å­—ç¬¦ä¸²è€Œä¸å½±å“åŸå­—ç¬¦ä¸²çš„åœºåˆã€‚ stricmpä¸åŒºåˆ†å­—æ¯å¤§å°å†™åœ°æ¯”è¾ƒ s1 å’Œ s2ï¼Œæœ‰åŠ©äºæ‰§è¡Œç”¨æˆ·è¾“å…¥çš„æ¯”è¾ƒæ—¶å¿½ç•¥å¤§å°å†™ã€‚ strlenè®¡ç®—å­—ç¬¦ä¸² s çš„é•¿åº¦ã€‚è¯¥å‡½æ•°åœ¨å­—ç¬¦ä¸²å¤„ç†æ—¶éå¸¸åŸºç¡€ä¸”å…³é”®ã€‚ strlwrå°†å­—ç¬¦ä¸² s è½¬æ¢ä¸ºå°å†™å½¢å¼ï¼Œé€‚åˆäºæ ‡è¯†ç¬¦è§„èŒƒåŒ–å’Œç»Ÿä¸€æ ¼å¼ã€‚ strncatå°† src å­—ç¬¦ä¸²çš„å‰ n ä¸ªå­—ç¬¦è¿½åŠ åˆ° dest çš„æœ«å°¾ï¼Œå¹¶æ·»åŠ  \\0ï¼Œæœ‰åŠ©äºæ§åˆ¶åˆå¹¶çš„é•¿åº¦ã€‚ strncmpæ¯”è¾ƒå­—ç¬¦ä¸² s1 å’Œ s2 çš„å‰ n ä¸ªå­—ç¬¦ï¼Œé€‚åˆéœ€è¦éƒ¨åˆ†æ¯”è¾ƒçš„åœºåˆã€‚ strncmpiç±»ä¼¼äº strncmp ï¼Œä½†ä¸åŒºåˆ†å­—æ¯å¤§å°å†™ï¼Œé’ˆå¯¹ç”¨æˆ·è¾“å…¥æ—¶å¯ç”¨ã€‚ strncpyå°† src æŒ‡å‘çš„ä»¥ NULL ç»“æŸçš„å­—ç¬¦ä¸²çš„å‰ n ä¸ªå­—èŠ‚å¤åˆ¶åˆ° dest ä¸­ï¼Œé€‚åˆåœ¨å®½åº¦é™åˆ¶ä¸‹å¤„ç†å­—ç¬¦ä¸²ã€‚ strnicmpä¸åŒºåˆ†å¤§å°å†™åœ°æ¯”è¾ƒ s1 å’Œ s2 çš„å‰ n ä¸ªå­—ç¬¦ï¼Œé€‚åˆåœ¨ä¸å…³æ³¨å¤§å°å†™çš„å‰æä¸‹æ‰§è¡Œéƒ¨åˆ†æ¯”è¾ƒã€‚ strpbrkåœ¨å­—ç¬¦ä¸² s1 ä¸­å¯»æ‰¾ s2 ä¸­çš„ä»»æ„å­—ç¬¦åŒ¹é…ï¼Œè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…å­—ç¬¦çš„ä½ç½®ï¼Œé€‚åˆè¡Œä¸ºåŒ¹é…æŸ¥æ‰¾ã€‚ strrevå°†å­—ç¬¦ä¸² s çš„æ‰€æœ‰å­—ç¬¦çš„é¡ºåºé¢ å€’ï¼ˆä¸åŒ…æ‹¬ NULLï¼‰ï¼Œæ­¤åŠŸèƒ½ç”¨äºåŠ å¯†å’ŒåŠ æ‰°æ•°æ®æ—¶éå¸¸å®ç”¨ã€‚ strsetå°†å­—ç¬¦ä¸² s ä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½è®¾ç½®æˆå­—ç¬¦ cï¼Œå¯ç”¨äºåˆå§‹åŒ–æˆ–æ ¼å¼åŒ–ã€‚ strsträ»å­—ç¬¦ä¸² haystack ä¸­å¯»æ‰¾ needle ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¹¶è¿”å›æŒ‡é’ˆï¼Œé€‚åˆç®€å•çš„å­ä¸²æŸ¥æ‰¾ã€‚ strtokåˆ†è§£å­—ç¬¦ä¸²ä¸ºä¸€ç»„æ ‡è®°ä¸²ï¼Œä½¿ç”¨æŒ‡å®šçš„åˆ†éš”ç¬¦ã€‚æ­¤å‡½æ•°å¯¹è§£æè¾“å…¥æ•°æ®æ ¼å¼å°¤å…¶æœ‰æ•ˆã€‚ struprå°†å­—ç¬¦ä¸² s è½¬æ¢ä¸ºå¤§å†™å½¢å¼ï¼Œé€‚åˆéœ€è¦å¤§å°å†™ç»Ÿä¸€çš„ç”³è¯·åœºåˆã€‚ æ•°å­¦å‡½æ•°ï¼ˆmathï¼‰ absè¿”å›æ•´æ•°çš„ç»å¯¹å€¼ï¼Œä¾‹å¦‚ abs(-5) è¿”å› 5ï¼Œç”¨äºå¤„ç†æ•°å€¼æ ‡å‡†åŒ–ã€‚ acosè®¡ç®—ç»™å®šå€¼çš„åä½™å¼¦å€¼ï¼Œååº”è§’åº¦çš„å¤§å°ï¼Œé€‚ç”¨äºä¸‰è§’å‡½æ•°å’Œç‰©ç†è®¡ç®—ã€‚ asinè®¡ç®—ç»™å®šå€¼çš„åæ­£å¼¦å€¼ï¼Œå¸¸ç”¨äºä¸‰è§’å‡½æ•°åº”ç”¨åœ¨å‡ ä½•å›¾å½¢è§£æä¸Šã€‚ atanè®¡ç®—ä¸€ä¸ªæ•°çš„åæ­£åˆ‡å€¼ï¼Œé€šå¸¸ç”¨äºç§‘å­¦è®¡ç®—å’Œå·¥ç¨‹åˆ†æã€‚ atan2åˆ©ç”¨ y å’Œ x å€¼è®¡ç®—åæ­£åˆ‡ï¼Œå¸¸åœ¨æåæ ‡å’Œç›´è§’åæ ‡ä¹‹é—´è½¬æ¢ã€‚ ceilè¿”å›å¤§äºæˆ–ç­‰äº x çš„æœ€å°æ•´æ•°ï¼Œé€‚ç”¨äºå‘ä¸Šå–æ•´çš„åœºåˆã€‚ cosè®¡ç®—ç»™å®šè§’åº¦çš„ä½™å¼¦å€¼ï¼Œå¹¿æ³›åº”ç”¨äºæ³¢å½¢å’Œå‘¨æœŸå‡½æ•°è®¡ç®—ã€‚ coshè®¡ç®—ç»™å®šå€¼çš„åŒæ›²ä½™å¼¦ï¼Œå¸¸åœ¨ç‰©ç†å’Œå·¥ç¨‹ç­‰é¢†åŸŸä½¿ç”¨ã€‚ expè®¡ç®— e çš„æŒ‡å®šæ¬¡å¹‚ï¼Œé€‚ç”¨äºæŒ‡æ•°å¢é•¿å’Œè¡°å‡è®¡ç®—ã€‚ fabsè¿”å›æµ®ç‚¹æ•°çš„ç»å¯¹å€¼ï¼Œé¿å…æ•°å€¼ä¸ºè´Ÿæ—¶å€™çš„è¯¯å¤„ç†ã€‚ floorè¿”å›å°äºæˆ–ç­‰äº x çš„æœ€å¤§æ•´æ•°ï¼Œé€‚åˆå‘ä¸‹å–æ•´ä½¿ç”¨ã€‚ fmodè®¡ç®—æµ®ç‚¹æ•°çš„ä½™æ•°ï¼Œå¸¸ç”¨äºå¾ªç¯å’Œæ’åˆ—è®¡ç®—ã€‚ frexpå°†æµ®ç‚¹æ•°åˆ†è§£ä¸ºå°¾æ•°å’ŒæŒ‡æ•°ï¼Œä¾¿äºç§‘å­¦è®¡æ•°å’Œå­˜å‚¨ã€‚ hypotæ ¹æ®ä¸¤æ¡ç›´è§’è¾¹è®¡ç®—æ–œè¾¹é•¿åº¦ï¼Œç›´æ¥é€‚ç”¨åœ¨æ¯•è¾¾å“¥æ‹‰æ–¯å®šç†ä¸­ã€‚ ldexpè½½å…¥æµ®ç‚¹æ•°ï¼Œå…è®¸ä»¥æŒ‡æ•°å½¢å¼è¿›è¡Œæµ®ç‚¹è¿ç®—ã€‚ logè®¡ç®—è‡ªç„¶å¯¹æ•°ï¼Œå¾ˆå¤šæ•°å­¦ã€ç‰©ç†å…¬å¼éƒ½ä¼šæ¶‰åŠå¯¹æ•°è¿ç®—ã€‚ log10è®¡ç®—å¸¸ç”¨å¯¹æ•°ï¼Œå¹¿æ³›åº”ç”¨äºç§‘å­¦å’Œå·¥ç¨‹é¢†åŸŸä¸­çš„æ•°æ®å¤„ç†ã€‚ modfåˆ†è§£æµ®ç‚¹æ•°ä¸ºæ•´æ•°å’Œå°æ•°éƒ¨åˆ†ï¼Œæœ‰åŠ©äºå¤„ç†å¤æ‚çš„æµ®ç‚¹ç®—å¼ã€‚ powè®¡ç®— x çš„ y æ¬¡æ–¹ï¼ŒåŸºç¡€çš„æŒ‡æ•°è¿ç®—åŠŸèƒ½ã€‚ pow10è®¡ç®— 10 çš„ x æ¬¡æ–¹ï¼Œä¾¿äºå¤§æ•°å¤„ç†å’Œç§‘å­¦è®¡ç®—ã€‚ sinè®¡ç®—ç»™å®šè§’åº¦çš„æ­£å¼¦å€¼ï¼Œé€‚ç”¨äºå‘¨æœŸæ€§ç°è±¡ã€‚ sinhè®¡ç®—åŒæ›²æ­£å¼¦çš„å€¼ï¼Œå¸¸ç”¨äºç›¸å¯¹è®ºå’Œæ³¢åŠ¨æ–¹ç¨‹ã€‚ sqrtè¿”å›ç»™å®šæ•°çš„å¹³æ–¹æ ¹ï¼Œå¤„ç†å‡ ä½•å’Œä»£æ•°è¿ç®—æ—¶ä¸å¯æˆ–ç¼ºã€‚ tanè®¡ç®—æ­£åˆ‡å€¼ï¼Œæ¶‰åŠè§’åº¦æ—¶çš„å„ç§ç‰©ç†ç°è±¡ã€‚ tanhè®¡ç®—ç»™å®šå€¼çš„åŒæ›²æ­£åˆ‡ï¼Œé€‚åˆåœ¨ä¿¡å·å¤„ç†ç­‰é¢†åŸŸã€‚ è¾“å…¥è¾“å‡ºå‡½æ•°ï¼ˆstdioï¼‰ getcharä»é”®ç›˜ä¸Šè¯»å–ä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶è¿”å›è¯¥å­—ç¬¦çš„é”®å€¼ï¼Œéå¸¸é€‚åˆç”¨æˆ·è¾“å…¥ã€‚ getchæ˜¯ getchar çš„å®å®šä¹‰ï¼Œé€šå¸¸ç”¨äºæ— å›æ˜¾æƒ…å†µä¸‹è·å–å•ä¸ªå­—ç¬¦ã€‚ kbhitæ£€æµ‹é”®ç›˜æ˜¯å¦æœ‰é”®æŒ‰ä¸‹ã€‚å¦‚æœæœ‰é”®æŒ‰ä¸‹ï¼Œè¿”å›å¯¹åº”é”®å€¼ï¼›å¦åˆ™è¿”å›é›¶ã€‚è¿™ä¸ªå‡½æ•°å¿«é€Ÿæœ‰æ•ˆï¼Œæ— éœ€ç­‰å¾…ç”¨æˆ·è¾“å…¥ã€‚ printfæ ¼å¼åŒ–å­—ç¬¦ä¸²è¾“å‡ºï¼Œæ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ï¼Œæä¾›äº†å¯¹æ•°æ®å±•ç¤ºçš„çµæ´»æ§åˆ¶ã€‚ä¾‹å¦‚ï¼š æ ¼å¼ æè¿° %c è¾“å‡ºå•ä¸ªå­—ç¬¦ %d è¾“å‡ºåè¿›åˆ¶æ•´æ•° %f è¾“å‡ºåè¿›åˆ¶æµ®ç‚¹æ•° %o è¾“å‡ºå…«è¿›åˆ¶æ•° %s è¾“å‡ºå­—ç¬¦ä¸² %u è¾“å‡ºæ— ç¬¦å·åè¿›åˆ¶æ•° %x è¾“å‡ºåå…­è¿›åˆ¶æ•° å¸¸ç”¨çš„ä¿®é¥°ç¬¦ï¼š ä¿®é¥°ç¬¦ å«ä¹‰ - å·¦å¯¹é½è¾“å‡º + è¾“å‡ºå¸¦ç¬¦å·æ•°æ—¶åŠ ä¸Šæ­£è´Ÿå· 0 ç”¨é›¶å¡«å……åŸŸå®½ putcharåœ¨å±å¹•ä¸Šæ˜¾ç¤ºå­—ç¬¦ cï¼Œå­—ç¬¦ä¼šåœ¨å½“å‰å…‰æ ‡ä½ç½®è¾“å‡ºã€‚å¯ä»¥é€šè¿‡ move æˆ– gotoxy ç§»åŠ¨å…‰æ ‡åˆ°æŒ‡å®šä½ç½®ã€‚ ç³»ç»Ÿå‡½æ•°system ClearScreenæ¸…å±ï¼Œæ¸…é™¤å±å¹•ç¼“å†²åŒºåŠæ¶²æ™¶æ˜¾ç¤ºç¼“å†²åŒºï¼Œå…‰æ ‡ä½ç½®å›åˆ°å±å¹•çš„å·¦ä¸Šè§’ã€‚è¿™åœ¨é‡ç½®æ˜¾ç¤ºå™¨çŠ¶æ€æ—¶éå¸¸æ–¹ä¾¿ã€‚ DispBCDç”¨äºåœ¨ä¸ƒæ®µæ•°ç ç®¡ä¸Šæ˜¾ç¤ºæ•°å­—ï¼Œæ ¹æ®è°ƒç”¨æ˜¾ç¤ºå¯¹åº”æ•°å­—ï¼Œæœ€å¤§ä¸º 999ï¼Œå¸¸ç”¨äºæ•°å­—æ˜¾ç¤ºã€‚ SetScrollBaræ˜¾ç¤ºä¸€ä¸ªæ»šåŠ¨æ¡ï¼Œå¯ä»¥ç”¨äºé•¿åˆ—è¡¨çš„ç›®çš„ã€‚ TextOutåœ¨å±å¹•ä¸Šçš„æŒ‡å®šä½ç½®è¾“å‡ºå­—ç¬¦ä¸²ï¼Œé€‚åˆåœ¨å›¾å½¢ç•Œé¢åº”ç”¨å¼€å‘ä¸­æ˜¾ç¤ºä¿¡æ¯ã€‚ UpdateLCDä»¥æŒ‡å®šæ¨¡å¼åˆ·æ–°å±å¹•ï¼Œé€‚ç”¨äºéœ€è¦æ›´æ–°æ˜¾ç¤ºå†…å®¹çš„åœºåˆã€‚ bellå‘å‡ºå£°éŸ³ä¿¡å·ã€‚ blockæ¶‰åŠç‰¹å®šçš„ç³»ç»Ÿæ“ä½œã€‚ clrscræ¸…é™¤å±å¹•ï¼Œç±»ä¼¼äº ClearScreen å‡½æ•°ã€‚ cursoræ§åˆ¶å…‰æ ‡çš„æ˜¾ç¤ºå’Œéšè—ã€‚ delayçŸ­æš‚å»¶æ—¶ï¼Œå»¶æ—¶ msec*4 æ¯«ç§’ï¼Œå¸¸ç”¨äºæ§åˆ¶ç¨‹åºè¿è¡ŒèŠ‚å¥ã€‚ get_chi_fontè·å–ä¸­æ–‡å­—ä½“è®¾ç½®ã€‚ get_eng_fontè·å–è‹±æ–‡å­—ä½“è®¾ç½®ã€‚ getkeyä»é”®ç›˜è¯»å–æŒ‰é”®ä¿¡æ¯ã€‚ getpixelè·å–æŒ‡å®šåæ ‡çš„åƒç´ å€¼ã€‚ gotoxyç§»åŠ¨å…‰æ ‡åˆ°æŒ‡å®šåæ ‡ä½ç½®ã€‚ lineåœ¨å±å¹•ä¸Šç»˜åˆ¶çº¿æ®µã€‚ moveæ“æ§å…‰æ ‡ä½ç½®ã€‚ noidleç¡®ä¿ç¨‹åºåœ¨æ— ç”¨æˆ·æ´»åŠ¨æ—¶ä¸è¿›å…¥ç©ºé—²çŠ¶æ€ã€‚ outtextxyåœ¨æŒ‡å®šåæ ‡è¾“å‡ºæ–‡æœ¬ã€‚ putpixelè®¾ç½®æŒ‡å®šåæ ‡çš„åƒç´ å€¼ã€‚ pyfcä¸è‡ªå®šä¹‰å‡½æ•°æœ‰å…³çš„æ“ä½œã€‚ rectangleåœ¨å±å¹•ä¸Šç»˜åˆ¶ä¸€ä¸ªçŸ©å½¢ã€‚ sleepæš‚åœç¨‹åºçš„æ‰§è¡Œï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚ textmodeè®¾ç½®æ–‡æœ¬æ˜¾ç¤ºæ¨¡å¼ã€‚ timeè·å–ç³»ç»Ÿå½“å‰æ—¶é—´ï¼Œè¿”å› struct tmï¼Œå…¶ä¸­åŒ…æ‹¬å°æ—¶ã€ç§’ã€åˆ†é’Ÿç­‰ä¿¡æ¯ï¼Œç”¨äºç²¾å‡†æ—¶é—´å¤„ç†ã€‚ struct tm int hsec; /* åŠç§’æ•° [0-119] */ int sec; /* ç§’ [0-59] */ int min; /* åˆ†é’Ÿ [0-59] */ int hour; /* å°æ—¶ [0-23] */ int day; /* å¤© [0-30] */ int wday; /* æ˜ŸæœŸ [0-6] */ int mon; /* æœˆ [0-11] */ int year; /* å¹´ - 1881 */; write_chi_fontå°†ä¸­æ–‡å­—ç¬¦è¾“å‡ºåˆ°å±å¹•ã€‚ write_eng_fontå°†è‹±æ–‡å­—ç¬¦è¾“å‡ºåˆ°å±å¹•ã€‚ stdlib exitç»“æŸç¨‹åºçš„æ‰§è¡Œï¼Œå¸¸ç”¨äºå¤„ç†å¼‚å¸¸æƒ…å†µæˆ–æ­£å¸¸é€€å‡ºã€‚ itoaå°†æ•´æ•° i è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œé€‚ç”¨äºéœ€è¦æ˜¾ç¤ºæ•°å­—çš„ UIã€‚ å­—ç¬¦å‡½æ•°ï¼ˆctypeï¼‰ isalnumåˆ¤æ–­å­—ç¬¦ c æ˜¯å¦ä¸ºå­—æ¯æˆ–æ•°å­—ï¼Œé€‚åˆè¾“å…¥æ ¡éªŒå’Œè¿‡æ»¤ã€‚ isalphaåˆ¤æ–­å­—ç¬¦ c æ˜¯å¦ä¸ºè‹±æ–‡å­—æ¯ï¼Œå¸¸ç”¨äºå­—ç¬¦é›†éªŒè¯ã€‚ iscntrlåˆ¤æ–­å­—ç¬¦ c æ˜¯å¦ä¸ºæ§åˆ¶å­—ç¬¦ï¼Œä¾‹å¦‚ 0x00-0x1F æˆ– 0x7Fï¼Œé€šå¸¸ç”¨äºæ•°æ®æ¸…ç†ã€‚ isdigitåˆ¤æ–­å­—ç¬¦ c æ˜¯å¦ä¸ºæ•°å­—å­—ç¬¦ï¼Œæœ‰åŠ©äºè¾“å…¥éªŒè¯ã€‚ isloweråˆ¤æ–­å­—ç¬¦ c æ˜¯å¦ä¸ºå°å†™å­—æ¯ï¼Œé€‚åˆå¯¹å­—æ¯å¤§å°å†™çš„å¤„ç†ã€‚ isasciiåˆ¤æ–­å­—ç¬¦ c æ˜¯å¦ä¸º ASCII å­—ç¬¦ï¼Œç¡®ä¿è¾“å…¥åœ¨åˆç†èŒƒå›´å†…ã€‚ isgraphåˆ¤æ–­å­—ç¬¦ c æ˜¯å¦ä¸ºå¯æ‰“å°å­—ç¬¦ï¼ˆä¸åŒ…æ‹¬ç©ºæ ¼ï¼‰ï¼Œæœ‰åŠ©äºå­—ç¬¦è¾“å‡ºæ§åˆ¶ã€‚ isprintåˆ¤æ–­å­—ç¬¦ c æ˜¯å¦ä¸ºå¯æ‰“å°å­—ç¬¦ï¼ˆåŒ…å«ç©ºæ ¼ï¼‰ï¼Œç”¨äºç•Œé¢è¾“å‡ºæ—¶çš„å­—ç¬¦å¤„ç†ã€‚ ispunctåˆ¤æ–­å­—ç¬¦ c æ˜¯å¦ä¸ºæ ‡ç‚¹ç¬¦å·ï¼Œæœ‰åŠ©äºåˆ†éš”æ–‡æœ¬ä¸­çš„é‡è¦éƒ¨åˆ†ã€‚ isspaceæ£€æŸ¥å­—ç¬¦æ˜¯å¦ä¸ºç©ºç™½ç¬¦ï¼Œå«ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ç­‰ï¼Œå¸¸åœ¨æ–‡æœ¬è§£æä¸­ä½¿ç”¨ã€‚ isupperåˆ¤æ–­å­—ç¬¦ c æ˜¯å¦ä¸ºå¤§å†™å­—æ¯ï¼Œé€‚ç”¨äºå¤§å°å†™è½¬æ¢çš„åœºæ™¯ã€‚ isxdigitåˆ¤æ–­å­—ç¬¦ c æ˜¯å¦ä¸ºåå…­è¿›åˆ¶æ•°å­—ï¼Œé€‚åˆå¤„ç†éœ€è¦åå…­è¿›åˆ¶æ•°æ®çš„åŠŸèƒ½ã€‚ toasciiå°†å­—ç¬¦ c è½¬æ¢ä¸º ASCII ç ï¼Œæ¸…é™¤é«˜ä½åªä¿ç•™ä½ä¸ƒä½ï¼Œç¡®ä¿æ•°æ®åœ¨æ ‡å‡†å­—ç¬¦é›†å†…ã€‚ tolowerå°†å­—æ¯ c è½¬æ¢ä¸ºå°å†™ï¼Œé€‚åˆç”¨æˆ·è¾“å…¥çš„ç»Ÿä¸€å¤„ç†ã€‚ toupperå°†å­—æ¯ c è½¬æ¢ä¸ºå¤§å†™ï¼Œé€‚åˆæ–‡æ¡£æ ‡è¯†ä¸­çš„è¦æ±‚ã€‚ å†…å­˜ç®¡ç†å‡½æ•°ï¼ˆallocï¼‰ callocä¸ºå…·æœ‰ num_elems ä¸ªé•¿åº¦ä¸º elem_size çš„æ•°ç»„åˆ†é…å†…å­˜ï¼Œç¡®ä¿æ‰€æœ‰åˆå§‹å€¼ä¸ºé›¶ï¼Œé¿å…æ•°æ®æ±¡æŸ“ã€‚ freeé‡Šæ”¾æŒ‡é’ˆ p æ‰€æŒ‡å‘çš„å†…å­˜ç©ºé—´ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚ mallocåˆ†é…é•¿åº¦ä¸º num_bytes å­—èŠ‚çš„å†…å­˜å—ï¼Œåˆ›é€ æ–°çš„å†…å­˜åŒºåŸŸï¼Œåç»­éœ€é€šè¿‡ free æ‰‹åŠ¨é‡Šæ”¾ã€‚ reallocæ”¹å˜ mem_address æ‰€æŒ‡çš„å†…å­˜åŒºåŸŸå¤§å°ä¸º newsizeï¼Œé€‚ç”¨äºåŠ¨æ€å¢é•¿æˆ–ç¼©å°æ•°æ®ç»“æ„çš„åœºæ™¯ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","å‡½æ•°"]},{"title":"manå¸®åŠ©æ‰‹å†Œ","path":"/2024/09/04/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-manå¸®åŠ©æ‰‹å†Œ/","content":"ä»€ä¹ˆæ˜¯ man å¸®åŠ©æ‰‹å†Œåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œâ€manâ€æ˜¯â€manualâ€çš„ç¼©å†™ï¼Œæ„æŒ‡æ‰‹å†Œã€‚å®ƒä¸ºç”¨æˆ·æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼æ¥æŸ¥æ‰¾å’Œæµè§ˆå·²ç»å®‰è£…åœ¨ç³»ç»Ÿä¸Šçš„å„ç§å‘½ä»¤ã€å‡½æ•°å’Œé…ç½®æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚â€manâ€å‘½ä»¤åˆ™æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºè®¿é—®è¿™äº›æ‰‹å†Œã€‚ å½“åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥â€manâ€åè·Ÿç‰¹å®šçš„å‘½ä»¤ã€å‡½æ•°æˆ–é…ç½®æ–‡ä»¶åæ—¶ï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºå‡ºç›¸åº”çš„å¸®åŠ©é¡µé¢ã€‚è¿™äº›é¡µé¢ä¸ä»…è§£é‡Šäº†è¯¥å‘½ä»¤æˆ–å‡½æ•°çš„åŸºæœ¬ç”¨æ³•ï¼Œè¿˜åˆ—å‡ºå…¶å„ç§é€‰é¡¹å’Œå‚æ•°ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å‘½ä»¤ man ls å¯ä»¥æŸ¥çœ‹å…³äº ls å‘½ä»¤çš„è¯¦å°½ä¿¡æ¯ã€‚é¡µé¢é€šå¸¸è¿˜ä¼šåŒ…å«ç¤ºä¾‹ï¼Œä»¥ä¾¿äºç”¨æˆ·ç†è§£å¦‚ä½•åœ¨å®é™…åº”ç”¨ä¸­ä½¿ç”¨è¯¥åŠŸèƒ½ã€‚ å¸®åŠ©é¡µé¢é€šå¸¸ä¾ç…§ä¸åŒå±‚çº§çš„è¯¦ç»†ç¨‹åº¦åˆ’åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œä»åŸºç¡€åˆ°å¤æ‚åº”æœ‰å°½æœ‰ã€‚å¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨â€manâ€å‘½ä»¤çš„é€‰é¡¹æ¥è®¿é—®ç‰¹å®šéƒ¨åˆ†çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥ man 1 ls å°†ä¸ºå±•ç¤ºå…³äºâ€lsâ€å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ï¼Œè€Œ man 2 open åˆ™å°†æä¾›æ›´æ·±å±‚æ¬¡çš„å…³äºâ€openâ€ç³»ç»Ÿè°ƒç”¨çš„è¯´æ˜ã€‚ â€œmanâ€å¸®åŠ©æ‰‹å†Œæ˜¯ Linux ç”¨æˆ·å¿…ä¸å¯å°‘çš„èµ„æºä¹‹ä¸€ã€‚æ— è®ºæ˜¯æ–°æ‰‹è¿˜æ˜¯ç»éªŒä¸°å¯Œçš„ç”¨æˆ·ï¼Œå®ƒéƒ½ä¸ºæä¾›äº†æ·±å…¥ç†è§£å’Œå­¦ä¹ å„ç§ç³»ç»Ÿå‘½ä»¤ã€å‡½æ•°ï¼Œä»¥åŠé‡åˆ°é—®é¢˜æ—¶çš„è§£å†³æ–¹æ¡ˆçš„é‡è¦æ”¯æŒã€‚ man åé¢åŠ æ•°å­—ä»£è¡¨ä»€ä¹ˆåœ¨ Linux ä¸­ï¼Œâ€manâ€å‘½ä»¤åé¢åŠ ä¸Šæ•°å­—ï¼Œè¡¨ç¤ºæƒ³æŸ¥çœ‹å¸®åŠ©é¡µé¢çš„ç‰¹å®šéƒ¨åˆ†ã€‚è¿™äº›éƒ¨åˆ†æ¶‰åŠåˆ°ä¸åŒç±»å‹çš„å‘½ä»¤å’ŒåŠŸèƒ½ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™é‡Œæœ‰ä¸€äº›å¸¸è§çš„æ•°å­—åŠå…¶å¯¹åº”çš„å¸®åŠ©é¡µéƒ¨åˆ†ï¼š 1ï¼šæ ‡å‡†å‘½ä»¤ã€‚è¿™éƒ¨åˆ†æä¾›äº†å¸¸è§å‘½ä»¤è¡Œå·¥å…·å’Œå¯æ‰§è¡Œç¨‹åºçš„ä¿¡æ¯ï¼Œå¦‚ lsã€cp ç­‰ã€‚ 2ï¼šç³»ç»Ÿè°ƒç”¨ã€‚è¿™é‡ŒåŒ…å«ä¸æ“ä½œç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½ç›¸å…³çš„å‡½æ•°çš„æ–‡æ¡£ï¼Œä¾‹å¦‚å¤„ç†æ–‡ä»¶å’Œè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚ open() å’Œ fork()ã€‚ 3ï¼šåº“å‡½æ•°ã€‚èšç„¦äº C è¯­è¨€ä¸­çš„æ ‡å‡†åº“å‡½æ•°ï¼Œæ¶µç›– printf() å’Œ malloc() ç­‰å‡½æ•°çš„ä½¿ç”¨ã€‚ 4ï¼šç‰¹æ®Šè®¾å¤‡ã€‚æ¶‰åŠè®¾å¤‡é©±åŠ¨ç¨‹åºã€å­—ç¬¦åŠå—è®¾å¤‡çš„è¯´æ˜ï¼Œå¸®åŠ©ç”¨æˆ·ç†è§£å¦‚ä½•ä¸ç¡¬ä»¶äº¤äº’ã€‚ 5ï¼šæ–‡ä»¶æ ¼å¼ã€‚è¿™éƒ¨åˆ†æè¿°ç³»ç»Ÿé…ç½®æ–‡ä»¶ã€æ•°æ®åº“æ–‡ä»¶åŠå…¶ä»–æ–‡ä»¶æ ¼å¼çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ passwd æ–‡ä»¶çš„æ ¼å¼å’Œç”¨æ³•ã€‚ 6ï¼šæ¸¸æˆå’Œç©å…·ã€‚è¿™éƒ¨åˆ†åˆ—å‡ºä¸€äº›åœ¨ç»ˆç«¯è¿è¡Œçš„å°æ¸¸æˆï¼Œåƒ nethack å’Œå…¶ä»–è¶£å‘³å‘½ä»¤ã€‚ 7ï¼šæ‚é¡¹ã€‚æä¾›å…¶ä»–æ–‡æ¡£ã€çº¦å®šå’Œæ ‡å‡†çš„ä¿¡æ¯ï¼Œå¯èƒ½åŒ…æ‹¬åå®šæˆ–è€…ç‰¹æ®Šæƒ…å†µä¸‹çš„ä½¿ç”¨è¯´æ˜ã€‚ 8ï¼šç®¡ç†å‘˜å‘½ä»¤ã€‚ä¸ºç³»ç»Ÿç®¡ç†å‘˜è®¾è®¡ï¼ŒåŒ…å«å¦‚ shutdown å’Œ useradd ç­‰å‘½ä»¤çš„æ–‡æ¡£ã€‚ 9ï¼šå…¶ä»–ä¸ Linux ç‰¹å®šç›¸å…³çš„å†…å®¹ï¼Œä¸»è¦åŒ…å«å†…æ ¸ä¾‹è¡Œç¨‹åºæ–‡æ¡£ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œä½¿ç”¨å‘½ä»¤ man 1 ls èƒ½è¿…é€Ÿå–å¾—å…³äº ls å‘½ä»¤çš„å…¨é¢æŒ‡å¯¼ï¼Œè€Œè¾“å…¥ man 5 passwd åˆ™èƒ½äº†è§£ passwd é…ç½®æ–‡ä»¶çš„è¯¦ç»†å†…å®¹ã€‚ è¯·æ³¨æ„ï¼Œå¹¶éæ‰€æœ‰å‘½ä»¤æˆ–ä¸»é¢˜éƒ½ä¸æ¯ä¸ªæ•°å­—å¯¹åº”æŸä¸ªå¸®åŠ©é¡µé¢ã€‚äº†è§£è¿™äº›ç»†åˆ†åŒºåŸŸå¯ä»¥å¸®åŠ©æ›´é«˜æ•ˆåœ°æŸ¥æ‰¾ä¿¡æ¯ï¼Œå¹¶åˆ©ç”¨ Linux ç³»ç»Ÿçš„å¼ºå¤§åŠŸèƒ½ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€"]},{"title":"statå‡½æ•°_è·å–æ–‡ä»¶ä¿¡æ¯","path":"/2024/09/03/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-å‡½æ•°-statå‡½æ•°-è·å–æ–‡ä»¶ä¿¡æ¯/","content":"Linux stat å‡½æ•°è¯¦è§£è¡¨å¤´æ–‡ä»¶åœ¨ä½¿ç”¨ stat å‡½æ•°ä¹‹å‰ï¼Œéœ€è¦åŒ…å«ä»¥ä¸‹å¤´æ–‡ä»¶ï¼š #include sys/stat.h#include unistd.h å®šä¹‰å‡½æ•°stat å‡½æ•°çš„åŸºæœ¬åŸå‹å¦‚ä¸‹ï¼š int stat(const char *file_name, struct stat *buf); å‡½æ•°è¯´æ˜stat å‡½æ•°ç”¨äºè·å–æŒ‡å®šæ–‡ä»¶ï¼ˆé€šè¿‡ file_name å‚æ•°ç»™å‡ºï¼‰çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶å°†è·å–åˆ°çš„ä¿¡æ¯ä¿å­˜åœ¨ buf æŒ‡å‘çš„ struct stat ç»“æ„ä½“ä¸­ã€‚è¿™ä¸€ç»“æ„ä½“åŒ…å«äº†æ–‡ä»¶çš„å¤šç§å±æ€§ï¼Œä¾‹å¦‚å¤§å°ã€æƒé™å’Œæ—¶é—´æˆ³ç­‰ã€‚ ç¤ºä¾‹ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ stat å‡½æ•°çš„ç®€å•ç¤ºä¾‹ï¼š #include sys/stat.h#include unistd.h#include stdio.hint main() struct stat buf; if (stat(/etc/hosts, buf) == 0) printf(/etc/hosts file size = %lld , (long long)buf.st_size); else perror(stat failed); åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œç¨‹åºå°è¯•è·å– /etc/hosts æ–‡ä»¶çš„ä¿¡æ¯ã€‚å¦‚æœæˆåŠŸï¼Œå°†æ‰“å°å‡ºæ–‡ä»¶çš„å¤§å°ï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚ è¿”å›å€¼ æˆåŠŸæ—¶ï¼šstat å‡½æ•°è¿”å› 0ã€‚ å¤±è´¥æ—¶ï¼šè¿”å› -1ï¼Œå¹¶ä¸”é”™è¯¯ä¿¡æ¯å­˜å‚¨åœ¨ errno ä¸­ã€‚ é”™è¯¯ä»£ç ä»¥ä¸‹æ˜¯ stat å‡½æ•°å¯èƒ½è¿”å›çš„ä¸€äº›é”™è¯¯ä»£ç ï¼ŒåŠå…¶å«ä¹‰ï¼š ENOENTï¼šæŒ‡å®šçš„ file_name ä¸å­˜åœ¨ã€‚ ENOTDIRï¼šè·¯å¾„ä¸­çš„æŸä¸ªéƒ¨åˆ†å­˜åœ¨ï¼Œä½†ä¸æ˜¯ä¸€ä¸ªç›®å½•ã€‚ ELOOPï¼šç”±äºè¿‡å¤šçš„ç¬¦å·é“¾æ¥è€Œå¯¼è‡´çš„å¾ªç¯é—®é¢˜ï¼Œé€šå¸¸ä¸Šé™ä¸º 16ã€‚ EFAULTï¼šbuf ä¸ºæ— æ•ˆæŒ‡é’ˆï¼ŒæŒ‡å‘æ— æ³•è®¿é—®çš„å†…å­˜ç©ºé—´ã€‚ EACCESSï¼šå°è¯•è®¿é—®æ–‡ä»¶æ—¶è¢«æ‹’ç»ã€‚ ENOMEMï¼šå†…å­˜ä¸è¶³ã€‚ ENAMETOOLONGï¼šæŒ‡å®šçš„è·¯å¾„åç§°è¿‡é•¿ã€‚ struct stat ç»“æ„ä½“struct stat æ˜¯ç”¨äºå­˜å‚¨æ–‡ä»¶ä¿¡æ¯çš„ç»“æ„ä½“ï¼ŒåŒ…å«ä»¥ä¸‹æˆå‘˜ï¼š struct stat dev_t st_dev; // æ–‡ä»¶æ‰€åœ¨è®¾å¤‡çš„ç¼–å· ino_t st_ino; // æ–‡ä»¶çš„èŠ‚ç‚¹å· mode_t st_mode; // æ–‡ä»¶ç±»å‹å’Œè®¿é—®æƒé™ nlink_t st_nlink; // è¿æ¥åˆ°è¯¥æ–‡ä»¶çš„ç¡¬è¿æ¥æ•° uid_t st_uid; // æ–‡ä»¶æ‰€æœ‰è€…çš„ç”¨æˆ·ID gid_t st_gid; // æ–‡ä»¶æ‰€æœ‰è€…çš„ç»„ID dev_t st_rdev; // è®¾å¤‡ç±»å‹ï¼ˆè‹¥è¯¥æ–‡ä»¶ä¸ºè®¾å¤‡æ–‡ä»¶ï¼‰ off_t st_size; // æ–‡ä»¶çš„å­—èŠ‚æ•°ï¼ˆå³æ–‡ä»¶å¤§å°ï¼‰ unsigned long st_blksize; // å—å¤§å°ï¼ˆæ–‡ä»¶ç³»ç»Ÿçš„ I/O ç¼“å†²åŒºå¤§å°ï¼‰ unsigned long st_blocks; // æ–‡ä»¶å ç”¨çš„å—æ•° time_t st_atime; // æœ€åè®¿é—®æ—¶é—´ time_t st_mtime; // æœ€åä¿®æ”¹æ—¶é—´ time_t st_ctime; // çŠ¶æ€æœ€åæ”¹å˜æ—¶é—´ï¼ˆåŒ…æ‹¬å±æ€§æ›´æ”¹ï¼‰; æ–‡ä»¶ç±»å‹å’Œæƒé™çš„å®šä¹‰st_mode å­—æ®µä¸­å®šä¹‰äº†ä¸€ç³»åˆ—ä¸åŒçš„æ–‡ä»¶ç±»å‹å’Œæƒé™ï¼Œå¦‚ä¸‹ï¼š S_IFMT 0170000ï¼šæ–‡ä»¶ç±»å‹çš„ä½é®ç½© S_IFSOCK 0140000ï¼šå¥—æ¥å­— S_IFLNK 0120000ï¼šç¬¦å·é“¾æ¥ S_IFREG 0100000ï¼šæ™®é€šæ–‡ä»¶ S_IFBLK 0060000ï¼šåŒºå—è®¾å¤‡ S_IFDIR 0040000ï¼šç›®å½• S_IFCHR 0020000ï¼šå­—ç¬¦è®¾å¤‡ S_IFIFO 0010000ï¼šå…ˆè¿›å…ˆå‡º S_ISUID 04000ï¼šæ–‡ä»¶çš„ set user-id on execution ä½ S_ISGID 02000ï¼šæ–‡ä»¶çš„ set group-id on execution ä½ S_ISVTX 01000ï¼šæ–‡ä»¶çš„ sticky ä½ S_IRUSR (S_IREAD) 00400ï¼šæ‰€æœ‰è€…å¯è¯» S_IWUSR (S_IWRITE) 00200ï¼šæ‰€æœ‰è€…å¯å†™ S_IXUSR (S_IEXEC) 00100ï¼šæ‰€æœ‰è€…å¯æ‰§è¡Œ S_IRGRP 00040ï¼šç”¨æˆ·ç»„å¯è¯» S_IWGRP 00020ï¼šç”¨æˆ·ç»„å¯å†™ S_IXGRP 00010ï¼šç”¨æˆ·ç»„å¯æ‰§è¡Œ S_IROTH 00004ï¼šå…¶ä»–ç”¨æˆ·å¯è¯» S_IWOTH 00002ï¼šå…¶ä»–ç”¨æˆ·å¯å†™ S_IXOTH 00001ï¼šå…¶ä»–ç”¨æˆ·å¯æ‰§è¡Œ åœ¨ POSIX ä¸­å®šä¹‰äº†æ£€æŸ¥è¿™äº›ç±»å‹çš„å®ï¼š S_ISLNK(st_mode)ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºç¬¦å·é“¾æ¥ S_ISREG(st_mode)ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºæ™®é€šæ–‡ä»¶ S_ISDIR(st_mode)ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºç›®å½• S_ISCHR(st_mode)ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºå­—ç¬¦è®¾å¤‡æ–‡ä»¶ S_ISBLK(st_mode)ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºåŒºå—è®¾å¤‡ S_ISSOCK(st_mode)ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºå¥—æ¥å­— åœ¨ä¸€ä¸ªç›®å½•ä¸Šè®¾ç½®äº† sticky ä½ï¼ˆç”± S_ISVTX è¡¨ç¤ºï¼‰æ—¶ï¼Œè¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶åªèƒ½è¢«æ–‡ä»¶æ‰€æœ‰è€…ã€ç›®å½•æ‰€æœ‰è€… æˆ– root ç”¨æˆ·åˆ é™¤æˆ–é‡å‘½åã€‚ struct statfs ç»“æ„ä½“é™¤äº†è·å–æ–‡ä»¶ä¿¡æ¯ï¼Œstatfs å‡½æ•°ä¹Ÿå¯ä»¥è·å–æ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œé€šè¿‡ä»¥ä¸‹ç»“æ„ä½“å®šä¹‰ï¼š struct statfs long f_type; // æ–‡ä»¶ç³»ç»Ÿç±»å‹ long f_bsize; // å—å¤§å° long f_blocks; // æ€»å—æ•° long f_bfree; // ç©ºé—²å—æ•° long f_bavail; // å¯ç”¨å—æ•° long f_files; // æ–‡ä»¶èŠ‚ç‚¹æ€»æ•° long f_ffree; // ç©ºé—²æ–‡ä»¶èŠ‚ç‚¹æ•° fsid_t f_fsid; // æ–‡ä»¶ç³»ç»Ÿ ID long f_namelen; // æ–‡ä»¶åæœ€å¤§é•¿åº¦ long f_spare[6]; // å¤‡ç”¨å­—æ®µ; statã€fstat å’Œ lstat å‡½æ•°åœ¨ UNIX ä¸­æœ‰ä¸‰ä¸ªç›¸å…³å‡½æ•°ï¼Œåˆ†åˆ«ä¸º statã€fstat å’Œ lstatã€‚ int stat(const char *restrict pathname, struct stat *restrict buf); æä¾›æ–‡ä»¶åï¼Œè·å–æ–‡ä»¶çš„å±æ€§ã€‚ä¸€èˆ¬ç”¨äºæ–‡ä»¶å°šæœªæ‰“å¼€æ—¶çš„æƒ…å†µã€‚ int fstat(int filedes, struct stat *buf); é€šè¿‡æ–‡ä»¶æè¿°ç¬¦è·å–æ–‡ä»¶çš„å±æ€§ã€‚é€‚ç”¨äºæ–‡ä»¶å·²ç»æ‰“å¼€çš„æƒ…å†µã€‚ int lstat(const char *restrict pathname, struct stat *restrict buf); è·å–æ–‡ä»¶å±æ€§ï¼Œæ¶‰åŠåˆ°ç¬¦å·è¿æ¥(directory symlink)æ—¶ï¼Œè¿”å›çš„æ˜¯ç¬¦å·è¿æ¥æœ¬èº«çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯è¿æ¥çš„ç›®æ ‡æ–‡ä»¶çš„ä¿¡æ¯ã€‚ å‡½æ•°è¿”å›å€¼è¿™ä¸‰ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¸€è‡´ï¼šæˆåŠŸåˆ™è¿”å› 0ï¼Œå‡ºé”™åˆ™è¿”å› -1ã€‚ èµ‹äºˆä¸€ä¸ª pathnameï¼Œstat å‡½æ•°ä¼šè¿”å›å…³äºè¿™ä¸ªæ–‡ä»¶çš„ä¿¡æ¯ï¼Œfstat é€‚ç”¨äºå·²ç»åœ¨æ–‡ä»¶æè¿°ç¬¦ filedes ä¸Šæ‰“å¼€çš„æ–‡ä»¶ï¼Œlstat åˆ™ä¸“é—¨å¤„ç†ç¬¦å·è¿æ¥ï¼Œå¹¶è¿”å›ç¬¦å·è¿æ¥çš„ä¿¡æ¯ã€‚ struct stat ç»“æ„ä½“ä¸­æˆå‘˜çš„è¯¦ç»†è¯´æ˜æ¯ä¸ªæˆå‘˜éƒ½æä¾›äº†å…³äºæ–‡ä»¶å±æ€§çš„é‡è¦æ•°æ®ï¼š st_modeï¼šæ–‡ä»¶ç±»å‹å’Œæƒé™ï¼Œè¡¨ç¤ºæ–‡ä»¶çš„ç§ç±»ï¼ˆå¦‚ç›®å½•æˆ–æ–‡ä»¶ï¼‰ä»¥åŠè®¿é—®æ§åˆ¶ã€‚ st_inoï¼šå”¯ä¸€çš„èŠ‚ç‚¹ç¼–å·ï¼Œç”¨äºåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ ‡è¯†æ–‡ä»¶ã€‚ st_rdevï¼šè®¾å¤‡ç¼–å·ï¼Œä¸“é—¨é’ˆå¯¹å­—ç¬¦å’Œå—è®¾å¤‡ã€‚ st_nlinkï¼šè¡¨ç¤ºå’Œè¯¥æ–‡ä»¶ç›¸å…³çš„ç¡¬é“¾æ¥æ•°é‡ã€‚ st_uid å’Œ st_gidï¼šæ–‡ä»¶æ‰€æœ‰è€…çš„ç”¨æˆ· ID å’Œç»„ IDï¼Œå¯¹äºæƒé™æ§åˆ¶éå¸¸é‡è¦ã€‚ st_sizeï¼šæ™®é€šæ–‡ä»¶çš„å­—èŠ‚æ•°ã€‚ st_atimeï¼šæœ€åä¸€æ¬¡è®¿é—®è¯¥æ–‡ä»¶çš„æ—¶é—´ï¼Œè¿™å¯¹äº†è§£æ–‡ä»¶ä½¿ç”¨æƒ…å†µå¾ˆå…³é”®ã€‚ st_mtimeï¼šæ–‡ä»¶å†…å®¹æœ€åä¸€æ¬¡è¢«ä¿®æ”¹çš„æ—¶é—´ã€‚ st_ctimeï¼šæ–‡ä»¶çŠ¶æ€å˜åŒ–çš„æ—¶é—´ï¼ŒåŒ…æ‹¬å…ƒæ•°æ®çš„ä¿®æ”¹ã€‚ st_blksizeï¼šæ–‡ä»¶ç³»ç»Ÿå®ç°é’ˆå¯¹æ–‡ä»¶çš„æœ€ä½³å—å¤§å°ã€‚ st_blocksï¼šå·²åˆ†é…ç»™è¯¥æ–‡ä»¶çš„ 512 å­—èŠ‚å—çš„æ•°é‡ã€‚ é€šè¿‡è¿™äº›å‡½æ•°å’Œç»“æ„ä½“ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°è·å–æ–‡ä»¶çš„å…¨æ–¹ä½ä¿¡æ¯ï¼Œç®¡ç†å’Œæ“ä½œæ–‡ä»¶ï¼Œä¹Ÿå› è€Œåœ¨ UNIXLinux ç³»ç»Ÿä¸­ stat å‡½æ•°æ˜¯ä¸å¯æˆ–ç¼ºçš„å·¥å…·ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","å‡½æ•°"]},{"title":"CPUå‚æ•°è¯´æ˜","path":"/2024/09/02/1-å¹³å°ç³»ç»Ÿ-Linux-ç³»ç»Ÿå‚æ•°-CPUå‚æ•°è¯´æ˜/","content":"åœ¨ Linux ç³»ç»Ÿä¸­ä½¿ç”¨ top å‘½ä»¤æŸ¥çœ‹ CPU ç›¸å…³å‚æ•°æ—¶æœ‰ä»¥ä¸‹å†…å®¹ us: â€œuser CPU timeâ€ ç”¨æˆ·ç©ºé—´å ç”¨ CPU ç™¾åˆ†æ¯” sy: â€œsystem CPU timeâ€ å†…æ ¸ç©ºé—´å ç”¨ CPU ç™¾åˆ†æ¯” ni: is meaning ofâ€ nice CPU timeâ€ ç”¨æˆ·è¿›ç¨‹ç©ºé—´å†…æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹å ç”¨ CPU ç™¾åˆ†æ¯” id: â€œidleâ€ ç©ºé—² CPU ç™¾åˆ†æ¯” wa: â€œiowaitâ€ ç­‰å¾…è¾“å…¥è¾“å‡ºçš„ CPU æ—¶é—´ç™¾åˆ†æ¯”å³ç­‰å¾…ç£ç›˜å†™å…¥å®Œæˆæ—¶é—´ hiï¼šâ€hardware irqâ€ ç¡¬ä»¶ä¸­æ–­æ¶ˆè€—æ—¶é—´ si : â€œsoftware irqâ€ è½¯ä»¶ä¸­æ–­æ¶ˆè€—æ—¶é—´ st : â€œsteal timeâ€ åˆ†é…ç»™å…¶ä»–è™šæ‹Ÿæœºçš„æ—¶é—´ ä½¿ç”¨ç‡ CPU åœ¨å¤„ç†ä»»åŠ¡æ—¶æ‰€èŠ±è´¹çš„æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ä¾‹ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š CPU ä½¿ç”¨ç‡ = us + sy + ni + hi + si è¿™è¡¨ç¤ºäº† CPU å¿™äºå®é™…å¤„ç†ä»»åŠ¡çš„æ—¶é—´ï¼Œä¸åŒ…æ‹¬ç©ºé—²æ—¶é—´ï¼ˆidï¼‰å’Œ IO ç­‰å¾…æ—¶é—´ï¼ˆwaï¼‰ã€‚ è´Ÿè½½è´Ÿè½½é€šå¸¸æŒ‡çš„æ˜¯ç³»ç»Ÿçš„ä»»åŠ¡æ’é˜Ÿæƒ…å†µï¼Œä¹Ÿå°±æ˜¯åœ¨ç­‰å¾… CPU å¤„ç†çš„è¿›ç¨‹æ•°ã€‚å®ƒé€šå¸¸ç”±æ“ä½œç³»ç»Ÿçš„è´Ÿè½½å‡è¡¡å™¨æ¥è®¡ç®—ï¼Œè€ƒè™‘åˆ°è¿è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ•°é‡å’Œå¹³å‡ç­‰å¾…æ—¶é—´ã€‚ CPU è´Ÿè½½éœ€è¦ç»“åˆä»»åŠ¡é˜Ÿåˆ—é•¿åº¦ã€ç­‰å¾…æ—¶é—´ä»¥åŠ CPU è°ƒåº¦æƒ…å†µæ¥è¡¡é‡ï¼Œå¯ä»¥é€šè¿‡ uptimeã€w å‘½ä»¤æŸ¥çœ‹ CPU å¹³å‡è´Ÿè½½ï¼Œä½¿ç”¨ top å‘½ä»¤è¿˜èƒ½çœ‹åˆ° CPU è´Ÿè½½æ€»ä½“ä½¿ç”¨ç‡ä»¥åŠå„ä¸ªè¿›ç¨‹å ç”¨ CPU çš„æ¯”ä¾‹ã€‚ å¦‚æœå•æ ¸ CPU çš„è¯ï¼Œè´Ÿè½½è¾¾åˆ° 1 å°±ä»£è¡¨ CPU å·²ç»è¾¾åˆ°æ»¡è´Ÿè·çš„çŠ¶æ€äº†ï¼Œè¶…è¿‡ 1ï¼Œåé¢çš„è¿›è¡Œå°±éœ€è¦æ’é˜Ÿç­‰å¾…å¤„ç†äº†ã€‚å¦‚æœæ˜¯å¤šæ ¸å¤š CPUï¼Œå‡è®¾ç°åœ¨æœåŠ¡å™¨æ˜¯ 2 ä¸ª CPUï¼Œæ¯ä¸ª CPU æœ‰ 2 ä¸ªæ ¸ï¼Œé‚£ä¹ˆæ€»è´Ÿè½½ä¸è¶…è¿‡ 4 éƒ½æ²¡ä»€ä¹ˆé—®é¢˜ã€‚ å‚æ•°æŸ¥çœ‹æŸ¥çœ‹ç‰©ç† CPU ä¸ªæ•° cat /proc/cpuinfo| grep physical id| sort | uniq| wc -l æŸ¥çœ‹æ¯ä¸ªç‰©ç† CPU ä¸­ core çš„ä¸ªæ•°(å³æ ¸æ•°) cat /proc/cpuinfo| grep cpu cores | uniq æŸ¥çœ‹é€»è¾‘ CPU çš„ä¸ªæ•° cat /proc/cpuinfo| grep processor| wc -l è´Ÿè½½é«˜åˆ©ç”¨ç‡ä½CPU è´Ÿè½½å¾ˆé«˜ï¼Œåˆ©ç”¨ç‡å´å¾ˆä½ï¼Œè¯´æ˜å¤„äºç­‰å¾…çŠ¶æ€çš„ä»»åŠ¡å¾ˆå¤šï¼Œè´Ÿè½½è¶Šé«˜ï¼Œä»£è¡¨å¯èƒ½å¾ˆå¤šåƒµæ­»çš„è¿›ç¨‹ã€‚é€šå¸¸è¿™ç§æƒ…å†µæ˜¯ IO å¯†é›†å‹çš„ä»»åŠ¡ï¼Œå¤§é‡ä»»åŠ¡åœ¨è¯·æ±‚ç›¸åŒçš„ IOï¼Œå¯¼è‡´ä»»åŠ¡é˜Ÿåˆ—å †ç§¯ã€‚ è´Ÿè½½ä½åˆ©ç”¨ç‡é«˜è¿™è¡¨ç¤º CPU çš„ä»»åŠ¡å¹¶ä¸å¤šï¼Œä½†æ˜¯ä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´å¾ˆé•¿ï¼Œå¤§æ¦‚ç‡å°±æ˜¯å†™çš„ä»£ç æœ¬èº«æœ‰é—®é¢˜ï¼Œé€šå¸¸æ˜¯è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œç”Ÿæˆäº†å¤§é‡è€—æ—¶çŸ­çš„è®¡ç®—ä»»åŠ¡ã€‚ é€šè¿‡ top æ‰¾åˆ° CPU å ç”¨ç‡é«˜çš„è¿›ç¨‹ é€šè¿‡ top -Hp pid å‘½ä»¤æŸ¥çœ‹ CPU å æ¯”é å‰çš„çº¿ç¨‹ ID å†æŠŠçº¿ç¨‹ ID è½¬åŒ–ä¸º 16 è¿›åˆ¶ï¼Œprintf â€œ0x%x â€ 74317ï¼Œå¾—åˆ° 0x1224d åœ¨æ¯”å¯¹ç¨‹åºä¸­çš„çº¿ç¨‹ ID æ‰¾åˆ°æœ‰é—®é¢˜çš„éƒ¨åˆ†","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç³»ç»Ÿå‚æ•°"]},{"title":"ç¼–è¯‘å†…å­˜ä¸è¶³","path":"/2024/08/30/1-å¹³å°ç³»ç»Ÿ-VMware-ç¼–è¯‘å†…å­˜ä¸è¶³/","content":"å½“åœ¨ Linux ç¯å¢ƒä¸‹ç¼–è¯‘ C++ç¨‹åºæ—¶é‡åˆ° fatal error: Killed signal terminated program cc1plus çš„é—®é¢˜ï¼Œå¯èƒ½æ˜¯å› ä¸ºå†…å­˜ä¸è¶³ã€‚è§£å†³æ–¹æ³•æ˜¯åˆ›å»º swap åˆ†åŒºï¼Œé€šè¿‡å¢åŠ è™šæ‹Ÿå†…å­˜æ¥ç¼“è§£ã€‚æ­¥éª¤åŒ…æ‹¬åˆ›å»º swap æ–‡ä»¶ï¼Œè®¾ç½®æƒé™ï¼Œæ¿€æ´» swapï¼Œæœ€åç¡®è®¤ swap å·²æ­£ç¡®é…ç½®ã€‚è‹¥ä¸å†éœ€è¦ï¼Œå¯ä½¿ç”¨ swapoff å’Œ rm å‘½ä»¤ç§»é™¤ã€‚ é—®é¢˜æè¿°åœ¨ Linux ç³»ç»Ÿä¸­è¿›è¡Œ C++ç¼–è¯‘æ—¶ï¼Œå‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼Œå¯¼è‡´ç¼–è¯‘ä¸­æ­¢ï¼š C++: fatal error: Killed signal terminated program cc1pluscompilation terminated. è§£å†³æ–¹æ³•æŸ¥é˜…ç›¸å…³ä¿¡æ¯åï¼Œè®¤ä¸ºæ˜¯è™šæ‹Ÿæœºå†…å­˜ä¸è¶³é€ æˆçš„ã€‚é€šè¿‡åˆ›å»º swap åˆ†åŒºè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œç¼–è¯‘æˆåŠŸã€‚ä¸‹é¢æ€»ç»“ä¸€ä¸‹ swap åˆ†åŒºçš„åˆ›å»ºå’Œæ¿€æ´»ç­‰æ“ä½œï¼š # åˆ›å»ºåˆ†åŒºè·¯å¾„sudo mkdir -p /var/cache/swap/# è®¾ç½®åˆ†åŒºçš„å¤§å°# bs=64Mæ˜¯å—å¤§å°ï¼Œcount=64æ˜¯å—æ•°é‡ï¼Œæ‰€ä»¥swapç©ºé—´å¤§å°æ˜¯bs*count=4096MB=4GBsudo dd if=/dev/zero of=/var/cache/swap/swap0 bs=64M count=64# è®¾ç½®è¯¥ç›®å½•æƒé™sudo chmod 0600 /var/cache/swap/swap0# åˆ›å»ºSWAPæ–‡ä»¶sudo mkswap /var/cache/swap/swap0# æ¿€æ´»SWAPæ–‡ä»¶sudo swapon /var/cache/swap/swap0# æŸ¥çœ‹SWAPä¿¡æ¯æ˜¯å¦æ­£ç¡®sudo swapon -s swap0 æ–‡ä»¶çš„è·¯å¾„åœ¨varcacheswapä¸‹ï¼Œç¼–è¯‘å®Œå, å¦‚æœä¸æƒ³è¦äº¤æ¢åˆ†åŒºäº†, å¯ä»¥åˆ é™¤ã€‚ åˆ é™¤äº¤æ¢åˆ†åŒºçš„å‘½ä»¤ï¼š sudo swapoff /var/cache/swap/swap0sudo rm /var/cache/swap/swap0 é‡Šæ”¾ç©ºé—´å‘½ä»¤ï¼š sudo swapoff -a#è¯¦ç»†çš„ç”¨æ³•ï¼šswapoff --help#æŸ¥çœ‹å½“å‰å†…å­˜ä½¿ç”¨æƒ…å†µï¼šfree -m","categories":["1.å¹³å°ç³»ç»Ÿ","VMware"]},{"title":"ä¸­æ–‡å­—ç¬¦æ— æ³•æ­£å¸¸æ˜¾ç¤º","path":"/2024/08/29/1-å¹³å°ç³»ç»Ÿ-WSL-ä¸­æ–‡å­—ç¬¦æ— æ³•æ­£å¸¸æ˜¾ç¤º/","content":"WSL ä¸­æ²¡æœ‰ç›¸åº”ä¸­æ–‡å­—ä½“åº“ï¼Œæ˜¾ç¤ºä¸ºå°æ–¹æ¡†ã€‚ ä»¬ç›´æ¥ä½¿ç”¨ Windows è‡ªå¸¦çš„å­—ä½“é“¾æ¥åˆ° WSL ä¸‹ sudo ln -s /mnt/c/Windows/Fonts /usr/share/fonts/font æ‰«æå­—ä½“ç›®å½•ï¼Œå¹¶ç”Ÿæˆå­—ä½“ä¿¡æ¯çš„ç¼“å­˜ fc-cache -fv","categories":["1.å¹³å°ç³»ç»Ÿ","WSL"]},{"title":"ä¿¡å·é‡","path":"/2024/08/28/1-å¹³å°ç³»ç»Ÿ-Linux-IO-ä¿¡å·é‡/","content":"ä»‹ç»Linux çš„ä¿¡å·é‡æ˜¯ä¸€ç§è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œç”¨äºæ§åˆ¶è¿›ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚ä¿¡å·é‡æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºè¡¨ç¤ºæŸä¸ªå…±äº«èµ„æºçš„å¯ç”¨æ•°é‡ã€‚è¿›ç¨‹å¯ä»¥ä½¿ç”¨ä¿¡å·é‡æ¥ç”³è¯·å…±äº«èµ„æºçš„è®¿é—®æƒé™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¿¡å·é‡æ¥é‡Šæ”¾å·²ç»ç”³è¯·åˆ°çš„èµ„æºã€‚ Linux ä¸­çš„ä¿¡å·é‡åŒ…æ‹¬ä¸¤ç§ç±»å‹ï¼šäºŒè¿›åˆ¶ä¿¡å·é‡å’Œè®¡æ•°ä¿¡å·é‡ã€‚äºŒè¿›åˆ¶ä¿¡å·é‡åªæœ‰ä¸¤ä¸ªå–å€¼ï¼Œåˆ†åˆ«è¡¨ç¤ºèµ„æºçš„ç©ºé—²å’Œå ç”¨çŠ¶æ€ã€‚è®¡æ•°ä¿¡å·é‡çš„å–å€¼å¯ä»¥æ˜¯ä»»æ„æ­£æ•´æ•°ï¼Œè¡¨ç¤ºå¯ç”¨èµ„æºçš„æ•°é‡ã€‚ è¿›ç¨‹å¯ä»¥ä½¿ç”¨ semget() å‡½æ•°åˆ›å»ºä¸€ä¸ªä¿¡å·é‡é›†ï¼Œä½¿ç”¨ semop() å‡½æ•°å¯¹ä¿¡å·é‡è¿›è¡Œæ“ä½œã€‚semop() å‡½æ•°å¯ä»¥å¯¹ä¿¡å·é‡è¿›è¡ŒåŠ é”å’Œè§£é”æ“ä½œï¼Œè¿˜å¯ä»¥ç­‰å¾…ä¿¡å·é‡çš„å€¼è¾¾åˆ°æŸä¸ªæ¡ä»¶ã€‚å½“æŸä¸ªè¿›ç¨‹å ç”¨äº†ä¸€ä¸ªèµ„æºæ—¶ï¼Œå®ƒéœ€è¦å¯¹ç›¸åº”çš„ä¿¡å·é‡è¿›è¡ŒåŠ é”æ“ä½œï¼Œä»¥é˜²æ­¢å…¶ä»–è¿›ç¨‹åŒæ—¶è®¿é—®è¯¥èµ„æºã€‚å½“è¿›ç¨‹é‡Šæ”¾èµ„æºæ—¶ï¼Œéœ€è¦å¯¹ç›¸åº”çš„ä¿¡å·é‡è¿›è¡Œè§£é”æ“ä½œï¼Œä»¥ä¾¿å…¶ä»–è¿›ç¨‹å¯ä»¥è®¿é—®è¯¥èµ„æºã€‚ SIG ç°‡å‡½æ•°åœ¨ Linux ä¸­ï¼Œä¿¡å·é‡é€šå¸¸ç”¨äºè¿›ç¨‹é—´çš„åŒæ­¥å’Œäº’æ–¥æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¤šä¸ªè¿›ç¨‹éœ€è¦è®¿é—®åŒä¸€ä¸ªå…±äº«æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¿¡å·é‡æ¥æ§åˆ¶å¯¹è¯¥æ–‡ä»¶çš„è®¿é—®ã€‚ åœ¨ Linux ä¸­ï¼ŒSIG ç°‡å‡½æ•°æ˜¯ä¸€ç»„ç”¨äºå¤„ç†ä¿¡å·çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥æ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°ã€å‘é€ä¿¡å·ã€é˜»å¡ä¿¡å·ç­‰æ“ä½œã€‚è¿™äº›å‡½æ•°çš„åç§°éƒ½ä»¥ â€œsigâ€ å¼€å¤´ï¼Œä¾‹å¦‚ sigactionã€sigprocmaskã€sigqueue ç­‰ã€‚ ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„ SIG ç°‡å‡½æ•°ï¼š sigaction å‡½æ•°ï¼šç”¨äºæ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°ã€‚è¯¥å‡½æ•°å¯ä»¥æŒ‡å®šä¸€ä¸ªå‡½æ•°æŒ‡é’ˆä½œä¸ºä¿¡å·å¤„ç†å‡½æ•°ï¼Œå½“æ¥æ”¶åˆ°æŒ‡å®šä¿¡å·æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨è¯¥å‡½æ•°è¿›è¡Œå¤„ç†ã€‚sigaction å‡½æ•°è¿˜å¯ä»¥è®¾ç½®ä¿¡å·çš„å¤„ç†æ–¹å¼ï¼Œä¾‹å¦‚å¿½ç•¥ä¿¡å·ã€æ‰§è¡Œé»˜è®¤æ“ä½œã€æ‰§è¡ŒæŒ‡å®šçš„å¤„ç†å‡½æ•°ç­‰ã€‚ sigprocmask å‡½æ•°ï¼šç”¨äºè®¾ç½®è¿›ç¨‹çš„ä¿¡å·å±è”½å­—ã€‚è¿›ç¨‹å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°å±è”½æŸäº›ä¿¡å·ï¼Œä»¥å…åœ¨å¤„ç†æŸä¸ªä¿¡å·æ—¶è¢«å…¶ä»–ä¿¡å·ä¸­æ–­ã€‚å½“æŸä¸ªä¿¡å·è¢«å±è”½åï¼Œå®ƒå°†è¢«æš‚æ—¶å¿½ç•¥ï¼Œç›´åˆ°è¯¥ä¿¡å·è¢«è§£é™¤å±è”½ã€‚ sigpending å‡½æ•°ï¼šç”¨äºè·å–å½“å‰è¿›ç¨‹çš„æœªå†³ä¿¡å·é›†ã€‚æœªå†³ä¿¡å·æ˜¯æŒ‡å·²ç»å‘é€ç»™è¿›ç¨‹ä½†å°šæœªå¤„ç†çš„ä¿¡å·ã€‚sigpending å‡½æ•°å¯ä»¥è·å–å½“å‰è¿›ç¨‹çš„æœªå†³ä¿¡å·é›†ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨ä¸€ä¸ª sigset_t ç±»å‹çš„å˜é‡ä¸­ã€‚ sigsuspend å‡½æ•°ï¼šç”¨äºæŒ‚èµ·å½“å‰è¿›ç¨‹ï¼Œç›´åˆ°æ”¶åˆ°æŒ‡å®šä¿¡å·ä¸ºæ­¢ã€‚è¯¥å‡½æ•°å¯ä»¥ç”¨äºç­‰å¾…æŸä¸ªä¿¡å·çš„åˆ°æ¥ï¼Œå¹¶é˜»å¡å½“å‰è¿›ç¨‹ï¼Œç›´åˆ°æ”¶åˆ°æŒ‡å®šä¿¡å·åæ‰ä¼šç»§ç»­æ‰§è¡Œã€‚ sigqueue å‡½æ•°ï¼šç”¨äºå‘æŒ‡å®šè¿›ç¨‹å‘é€ä¿¡å·ï¼Œå¹¶å¯ä»¥æºå¸¦ä¸€ä¸ªæ•´æ•°å€¼ä½œä¸ºé™„åŠ æ•°æ®ã€‚è¯¥å‡½æ•°å¯ä»¥ç”¨äºè¿›ç¨‹é—´çš„é€šä¿¡ï¼Œä¾‹å¦‚å‘å¦ä¸€ä¸ªè¿›ç¨‹å‘é€é€šçŸ¥æ¶ˆæ¯ç­‰ã€‚ è¿™äº› SIG ç°‡å‡½æ•°å¯ä»¥å¸®åŠ©ä»¬æ›´å¥½åœ°å¤„ç†ä¿¡å·ï¼Œå®ç°è¿›ç¨‹é—´çš„é€šä¿¡å’ŒåŒæ­¥æ“ä½œã€‚åœ¨ä½¿ç”¨è¿™äº›å‡½æ•°æ—¶ï¼Œéœ€è¦æ³¨æ„ä¿¡å·çš„å¤„ç†é¡ºåºå’Œä¼˜å…ˆçº§ï¼Œä»¥å…å‡ºç°æ„å¤–çš„ç»“æœã€‚ ä¿¡å·é‡ç”¨ä½œå®šæ—¶å™¨ä¿¡å·é‡å¯ä»¥ç”¨ä½œå®šæ—¶å™¨çš„ä¸€ç§å®ç°æ–¹å¼ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ setitimer å‡½æ•°è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå½“å®šæ—¶å™¨åˆ°æœŸæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å‘å½“å‰è¿›ç¨‹å‘é€ä¸€ä¸ªæŒ‡å®šçš„ä¿¡å·ï¼Œè¿›ç¨‹å¯ä»¥é€šè¿‡ä¿¡å·å¤„ç†å‡½æ•°æ¥å¤„ç†è¯¥ä¿¡å·ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ä¿¡å·é‡å®ç°å®šæ—¶å™¨çš„ç¤ºä¾‹ä»£ç ï¼š #include stdio.h#include stdlib.h#include signal.h#include unistd.h#include sys/time.h#include sys/sem.h#define SEM_KEY 0x12345678static int sem_id;union semun int val;\tstruct semid_ds *buf;\tunsigned short *array;;void handler(int signum)\tprintf(Timer expired. );void set_timer(int sec)\tstruct itimerval timer;\ttimer.it_value.tv_sec = sec;\ttimer.it_value.tv_usec = 0;\ttimer.it_interval.tv_sec = 0;\ttimer.it_interval.tv_usec = 0;\tsetitimer(ITIMER_REAL, timer, NULL);void init_sem()\tunion semun arg;\targ.val = 0;\tsem_id = semget(SEM_KEY, 1, IPC_CREAT | 0666);\tsemctl(sem_id, 0, SETVAL, arg);void wait_sem()\tstruct sembuf sb;\tsb.sem_num = 0;\tsb.sem_op = -1;\tsb.sem_flg = 0;\tsemop(sem_id, sb, 1);void post_sem()\tstruct sembuf sb;\tsb.sem_num = 0;\tsb.sem_op = 1;\tsb.sem_flg = 0;\tsemop(sem_id, sb, 1);int main()\tsignal(SIGALRM, handler);\tinit_sem();\tset_timer(5);\twait_sem();\tprintf(Exiting... );\treturn 0; åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œä»¬ä½¿ç”¨äº† setitimer å‡½æ•°æ¥è®¾ç½®ä¸€ä¸ª 5 ç§’çš„å®šæ—¶å™¨ï¼Œå½“å®šæ—¶å™¨åˆ°æœŸæ—¶ï¼Œç³»ç»Ÿä¼šå‘å½“å‰è¿›ç¨‹å‘é€ SIGALRM ä¿¡å·ã€‚ä»¬åœ¨ç¨‹åºä¸­æ³¨å†Œäº† SIGALRM ä¿¡å·çš„å¤„ç†å‡½æ•° handlerï¼Œå½“æ”¶åˆ°è¯¥ä¿¡å·æ—¶ï¼Œä¼šè¾“å‡ºä¸€æ¡æ¶ˆæ¯ã€‚ ä¸ºäº†å®ç°ç­‰å¾…å®šæ—¶å™¨åˆ°æœŸçš„åŠŸèƒ½ï¼Œä»¬ä½¿ç”¨äº†ä¿¡å·é‡ã€‚åœ¨ç¨‹åºå¼€å§‹æ—¶ï¼Œä»¬è°ƒç”¨äº† init_sem å‡½æ•°æ¥åˆå§‹åŒ–ä¿¡å·é‡ã€‚åœ¨ç¨‹åºä¸­ï¼Œä»¬ä½¿ç”¨äº† wait_sem å‡½æ•°æ¥ç­‰å¾…ä¿¡å·é‡çš„å€¼å˜ä¸º 0ï¼Œè¿™ä¸ªå‡½æ•°ä¼šé˜»å¡å½“å‰è¿›ç¨‹ç›´åˆ°æ”¶åˆ°ä¿¡å·é‡ä¸ºæ­¢ã€‚åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­ï¼Œä»¬è°ƒç”¨äº† post_sem å‡½æ•°æ¥å°†ä¿¡å·é‡çš„å€¼åŠ  1ï¼Œè¿™æ ·å°±å¯ä»¥è®©ç­‰å¾…ä¿¡å·é‡çš„è¿›ç¨‹ç»§ç»­æ‰§è¡Œäº†ã€‚ å½“ç¨‹åºè¿è¡Œæ—¶ï¼Œå®ƒä¼šç­‰å¾… 5 ç§’é’Ÿï¼Œç„¶åè¾“å‡ºä¸€æ¡æ¶ˆæ¯å¹¶é€€å‡ºã€‚å¦‚æœéœ€è¦æ›´é•¿æˆ–æ›´çŸ­çš„å®šæ—¶å™¨ï¼Œå¯ä»¥ä¿®æ”¹ set_timer å‡½æ•°ä¸­çš„å‚æ•°ã€‚ Linux ä¸­çš„ä¿¡å·é‡å’Œ Qt çš„ä¿¡å·æ§½æœºåˆ¶Linux ä¸­çš„ä¿¡å·é‡å’Œ Qt ä¸­çš„ä¿¡å·æ§½éƒ½æ˜¯ç”¨äºå®ç°è¿›ç¨‹é—´é€šä¿¡å’Œäº‹ä»¶å¤„ç†çš„æœºåˆ¶ï¼Œä½†å®ç°æ–¹å¼å’Œåº”ç”¨åœºæ™¯æœ‰æ‰€ä¸åŒã€‚ Linux ä¸­çš„ä¿¡å·é‡æ˜¯ä¸€ç§è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œç”¨äºæ§åˆ¶è¿›ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ã€‚ä¿¡å·é‡æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºè¡¨ç¤ºæŸä¸ªå…±äº«èµ„æºçš„å¯ç”¨æ•°é‡ã€‚è¿›ç¨‹å¯ä»¥ä½¿ç”¨ä¿¡å·é‡æ¥ç”³è¯·å…±äº«èµ„æºçš„è®¿é—®æƒé™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¿¡å·é‡æ¥é‡Šæ”¾å·²ç»ç”³è¯·åˆ°çš„èµ„æºã€‚Linux ä¸­çš„ä¿¡å·é‡é€šå¸¸ç”¨äºè¿›ç¨‹é—´çš„åŒæ­¥å’Œäº’æ–¥æ“ä½œï¼Œä¾‹å¦‚å¤šä¸ªè¿›ç¨‹éœ€è¦è®¿é—®åŒä¸€ä¸ªå…±äº«æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¿¡å·é‡æ¥æ§åˆ¶å¯¹è¯¥æ–‡ä»¶çš„è®¿é—®ã€‚ Qt ä¸­çš„ä¿¡å·æ§½æ˜¯ä¸€ç§äº‹ä»¶å¤„ç†æœºåˆ¶ï¼Œç”¨äºåœ¨å¯¹è±¡ä¹‹é—´ä¼ é€’æ¶ˆæ¯å’Œå¤„ç†äº‹ä»¶ã€‚å½“ä¸€ä¸ªå¯¹è±¡å‘ç”ŸæŸä¸ªäº‹ä»¶æ—¶ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªä¿¡å·ï¼Œå…¶ä»–å¯¹è±¡å¯ä»¥è¿æ¥åˆ°è¯¥ä¿¡å·å¹¶å®šä¹‰ä¸€ä¸ªæ§½å‡½æ•°æ¥å¤„ç†è¯¥äº‹ä»¶ã€‚Qt ä¸­çš„ä¿¡å·æ§½æœºåˆ¶å¯ä»¥ç”¨äºå®ç°å¯¹è±¡ä¹‹é—´çš„é€šä¿¡å’Œåä½œï¼Œä¾‹å¦‚åœ¨ä¸€ä¸ªçª—å£ä¸­ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®æ—¶ï¼Œå¯ä»¥å‘é€ä¸€ä¸ªä¿¡å·æ¥é€šçŸ¥å…¶ä»–å¯¹è±¡æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚ è™½ç„¶ Linux ä¸­çš„ä¿¡å·é‡å’Œ Qt ä¸­çš„ä¿¡å·æ§½æœºåˆ¶éƒ½å¯ä»¥ç”¨äºè¿›ç¨‹é—´é€šä¿¡å’Œäº‹ä»¶å¤„ç†ï¼Œä½†å®ƒä»¬çš„å®ç°æ–¹å¼å’Œåº”ç”¨åœºæ™¯æœ‰æ‰€ä¸åŒã€‚åœ¨ Linux ä¸­ï¼Œä¿¡å·é‡é€šå¸¸ç”¨äºæ§åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œè€Œåœ¨ Qt ä¸­ï¼Œä¿¡å·æ§½æœºåˆ¶é€šå¸¸ç”¨äºå¤„ç†äº‹ä»¶å’Œå®ç°å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ã€‚ sigactionsigaction å’Œ Qt çš„ä¿¡å·æ§½æœºåˆ¶éƒ½æ˜¯ç”¨äºå¤„ç†ä¿¡å·çš„æœºåˆ¶ï¼Œsigaction ä¸»è¦ç”¨äºå®ç°è¿›ç¨‹é—´é€šä¿¡å’Œäº‹ä»¶å¤„ç†ï¼Œè€Œ Qt çš„ä¿¡å·æ§½æœºåˆ¶ä¸»è¦ç”¨äºå¤„ç† GUI äº‹ä»¶å’Œå®ç°å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ã€‚ sigaction æ˜¯ Linux ä¸­ç”¨äºå¤„ç†ä¿¡å·çš„å‡½æ•°ï¼Œå¯ä»¥è®¾ç½®ä¿¡å·å¤„ç†å‡½æ•°ã€ä¿¡å·å±è”½å­—ç­‰ã€‚å½“è¿›ç¨‹æ¥æ”¶åˆ°æŸä¸ªä¿¡å·æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨å¯¹åº”çš„ä¿¡å·å¤„ç†å‡½æ•°æ¥å¤„ç†è¯¥ä¿¡å·ã€‚sigaction ä¸»è¦ç”¨äºå®ç°è¿›ç¨‹é—´é€šä¿¡å’Œäº‹ä»¶å¤„ç†ï¼Œä¾‹å¦‚åœ¨å¤šè¿›ç¨‹ç¼–ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ sigaction å®ç°è¿›ç¨‹é—´çš„åŒæ­¥å’Œäº’æ–¥æ“ä½œã€‚ Qt ä¸­çš„ä¿¡å·æ§½æœºåˆ¶æ˜¯ä¸€ç§äº‹ä»¶å¤„ç†æœºåˆ¶ï¼Œç”¨äºåœ¨å¯¹è±¡ä¹‹é—´ä¼ é€’æ¶ˆæ¯å’Œå¤„ç†äº‹ä»¶ã€‚å½“ä¸€ä¸ªå¯¹è±¡å‘ç”ŸæŸä¸ªäº‹ä»¶æ—¶ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªä¿¡å·ï¼Œå…¶ä»–å¯¹è±¡å¯ä»¥è¿æ¥åˆ°è¯¥ä¿¡å·å¹¶å®šä¹‰ä¸€ä¸ªæ§½å‡½æ•°æ¥å¤„ç†è¯¥äº‹ä»¶ã€‚Qt ä¸­çš„ä¿¡å·æ§½æœºåˆ¶å¯ä»¥ç”¨äºå®ç°å¯¹è±¡ä¹‹é—´çš„é€šä¿¡å’Œåä½œï¼Œä¾‹å¦‚åœ¨ä¸€ä¸ªçª—å£ä¸­ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®æ—¶ï¼Œå¯ä»¥å‘é€ä¸€ä¸ªä¿¡å·æ¥é€šçŸ¥å…¶ä»–å¯¹è±¡æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","IO"]},{"title":"è£¸æœºé©±åŠ¨çš„å¼€å‘æ­¥éª¤","path":"/2024/08/27/5-åµŒå…¥å¼å¼€å‘-ARMæ¶æ„-è£¸æœºé©±åŠ¨çš„å¼€å‘æ­¥éª¤/","content":"æœ€ç®€ä¾‹å­ LED ç¯æ§åˆ¶ çœ‹ç”µè·¯å›¾ æ‰¾åˆ°è¦æ§åˆ¶çš„è®¾å¤‡ æ‰¾åˆ°è®¾å¤‡åœ¨ CPU ä¾§çš„æ§åˆ¶ç®¡è„š(å¦‚ GPX27) çœ‹èŠ¯ç‰‡æ‰‹å†Œ å…ˆçœ‹ç›¸å…³çš„ä¸­æ–‡æ–‡æ¡£ï¼Œç†Ÿæ‚‰è®¾å¤‡å†çœ‹æ‰‹å†Œ) æœç´¢ç”µè·¯å›¾é‡Œå¯¹åº”æ§åˆ¶ç®¡è„šçš„åç§°(å¦‚ GPX2) çœ‹ç›®å½•æ‰¾åˆ°å¯¹åº”çš„æ§åˆ¶æ¨¡å—(å¦‚:6General Purpose InputOutput(GPIO)Control) çœ‹è¯¥æ¨¡å—çš„ overview äº†è§£è¯¥æ¨¡å—çš„å¤§æ¦‚åŠŸèƒ½ çœ‹æ§åˆ¶å¯„å­˜å™¨(REGISTER DESCRIPTION)é‡ç‚¹ï¼Œéš¾ç‚¹ å¦‚æœå¯„å­˜å™¨æ¯”è¾ƒå¤šï¼Œçœ‹æŠ€æœ¯æ”¯æŒæä¾›çš„ demoï¼Œæ‰¾åˆ°éœ€è¦ä¿®æ”¹çš„å¯„å­˜å™¨(é€šå¸¸æƒ…å†µä¸‹åªæœ‰å‡ ä¸ª)ã€‚éƒ¨åˆ†å‚å•†ä¼šæä¾›é…ç½®è½¯ä»¶ï¼Œé€šè¿‡ç•Œé¢å»é…ç½®åŠŸèƒ½ï¼Œä»¬åªéœ€ä½¿ç”¨é…ç½®å¥½çš„å¯„å­˜å™¨å€¼å°±å¯ä»¥ ç¼–ç¨‹ å®šä¹‰è¦æ§åˆ¶çš„å¯„å­˜å™¨çš„å®(ä¸æ‰‹å†Œé‡Œçš„å¯„å­˜å™¨åœ°å€å¯¹åº”èµ·æ¥) è®¾å¤‡åˆå§‹åŒ–(å¦‚è®¾ç½® GPI0 ä¸ºè¾“å‡ºçŠ¶æ€) æŠŠåŠŸèƒ½åˆ†æˆæœ€åŸºæœ¬çš„å°å—:é€ä¸ªå®ç°,å¦‚ç‚¹äº®ç¯-åœ¨ç­ç¯-åŠ å»¶æ—¶-é—ªçƒ-è·‘é©¬ç¯","categories":["5.åµŒå…¥å¼å¼€å‘","ARMæ¶æ„"]},{"title":"Linuxå­ç³»ç»Ÿçš„GUI","path":"/2024/08/26/1-å¹³å°ç³»ç»Ÿ-Windows-Linuxå­ç³»ç»Ÿçš„GUI/","content":"é¡¹ç›®åœ°å€WSLg GitHub é¡µé¢ WSLg ä»‹ç»WSLg æ˜¯ Windows Subsystem for Linux GUI çš„ç¼©å†™ã€‚è¯¥é¡¹ç›®çš„ä¸»è¦ç›®çš„æ˜¯æ”¯æŒåœ¨ Windows ç³»ç»Ÿä¸­æ— ç¼è¿è¡Œ Linux GUI åº”ç”¨ç¨‹åºï¼ŒåŒ…æ‹¬ä½†ä¸é™äº X11 å’Œ Wayland åº”ç”¨ç¨‹åºã€‚è¿™é¡¹æŠ€æœ¯æ˜¾è‘—æå‡äº†å¼€å‘è€…ã€ç§‘å­¦å®¶ä»¥åŠå¼€æºçˆ±å¥½è€…çš„å·¥ä½œæ•ˆç‡ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦åŒæ—¶ä½¿ç”¨ä¸¤ç§æ“ä½œç³»ç»Ÿå·¥å…·çš„åœºæ™¯ä¸­ã€‚ ç›®æ ‡ç”¨æˆ·WSLg å°¤å…¶é€‚åˆé‚£äº›éœ€è¦åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šè¿è¡Œ Windows å’Œ Linux åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ã€‚æ¯”å¦‚ï¼Œä¸€ä½æ•°æ®ç§‘å­¦å®¶å¯èƒ½éœ€è¦ä½¿ç”¨ Python æˆ– R åœ¨ Linux ä¸Šè¿›è¡Œæ•°æ®åˆ†æï¼Œè€ŒåŒæ—¶åˆå¸Œæœ›ä½¿ç”¨ Windows ä¸Šçš„å›¾å½¢åŒ–å·¥å…·è¿›è¡Œå¯è§†åŒ–ã€‚é€šè¿‡ä½¿ç”¨ WSLgï¼Œç”¨æˆ·å¯ä»¥é¿å…ç¹ççš„åŒç³»ç»Ÿæˆ–è™šæ‹ŸåŒ–è®¾ç½®ï¼ŒèŠ‚çœå¤§é‡æ—¶é—´å’Œç³»ç»Ÿèµ„æºã€‚ ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆçš„å±€é™æ€§åœ¨ä½¿ç”¨åŒç³»ç»Ÿè®¾ç½®æ—¶ï¼Œç”¨æˆ·éœ€è¦é‡å¯è®¡ç®—æœºæ¥åˆ‡æ¢æ“ä½œç³»ç»Ÿï¼Œè€Œåœ¨è™šæ‹Ÿæœºä¸­åˆ™å¯èƒ½é¢ä¸´æ€§èƒ½ä¸‹é™å’Œèµ„æºæ¶ˆè€—çš„é—®é¢˜ã€‚æ­¤å¤–ï¼Œä½¿ç”¨ XServer å°† Linux åº”ç”¨æŠ•å°„åˆ° Windows ä¸Šä¹Ÿå¸¸å¸¸éœ€è¦å¤æ‚çš„é…ç½®å’Œé¢å¤–çš„ç»´æŠ¤ï¼Œä½¿å¾—ç”¨æˆ·éš¾ä»¥è·å¾—æµç•…çš„ä½¿ç”¨ä½“éªŒã€‚ WSLg çš„ä¼˜åŠ¿WSLg çš„è®¾è®¡æ—¨åœ¨è®© Linux GUI åº”ç”¨ç¨‹åºåœ¨ Windows ä¸Šçš„ä½¿ç”¨ä½“éªŒåƒæœ¬åœ°åº”ç”¨ç¨‹åºä¸€æ ·è‡ªç„¶ã€‚å…·ä½“æ¥è¯´ï¼ŒWSLg æä¾›äº†ä»¥ä¸‹åŠŸèƒ½ï¼š â€œå¼€å§‹â€èœå•é›†æˆï¼šç”¨æˆ·å¯ä»¥è½»æ¾æ‰¾åˆ°å¹¶å¯åŠ¨ Linux åº”ç”¨ç¨‹åºï¼Œåƒè®¿é—®ä»»ä½• Windows åº”ç”¨ç¨‹åºä¸€æ ·æ–¹ä¾¿ã€‚ ä»»åŠ¡æ èåˆï¼šLinux åº”ç”¨ç¨‹åºçš„å›¾æ ‡å¯ä»¥åœ¨ Windows çš„ä»»åŠ¡æ ä¸Šæ˜¾ç¤ºï¼Œç”¨æˆ·å¯ä»¥ç›´è§‚åœ°è¯†åˆ«å’Œè®¿é—®å®ƒä»¬ã€‚ è·¨å¹³å°çš„å¿«æ·é”®åˆ‡æ¢ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡ alt-tab å¿«é€Ÿåˆ‡æ¢ Windows å’Œ Linux åº”ç”¨ç¨‹åºï¼Œä¿æŒé«˜æ•ˆçš„å·¥ä½œæµã€‚ æ— ç¼çš„å‰ªåˆ‡ç²˜è´´åŠŸèƒ½ï¼šä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥åœ¨ Windows ä¸Šå¤åˆ¶æ–‡æœ¬ï¼Œç„¶åç›´æ¥ç²˜è´´åˆ°è¿è¡Œåœ¨ WSLg ä¸­çš„ Linux åº”ç”¨ç¨‹åºé‡Œï¼Œåä¹‹äº¦ç„¶ã€‚ è¿™äº›åŠŸèƒ½å…±åŒä¸ºç”¨æˆ·æä¾›äº† Windows å’Œ Linux åº”ç”¨ç¨‹åºä¹‹é—´çš„æ— ç¼æ¡Œé¢ä½“éªŒï¼Œæ¶ˆé™¤äº†åœ¨å¤šç³»ç»Ÿç¯å¢ƒä¸­å¸¸è§çš„ç¹çå’Œä¸ä¾¿ã€‚æ— è®ºæ˜¯å¼€å‘åº”ç”¨ç¨‹åºè¿˜æ˜¯è¿›è¡Œæ—¥å¸¸ä»»åŠ¡ï¼ŒWSLg éƒ½èƒ½ä½¿ç”¨æˆ·çš„å·¥ä½œæ›´åŠ é¡ºç•…é«˜æ•ˆã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Windows"]},{"title":"å†…æ ¸è¡¥ä¸","path":"/2024/08/23/1-å¹³å°ç³»ç»Ÿ-Linux-å†…æ ¸-å†…æ ¸è¡¥ä¸/","content":"å†…æ ¸è¡¥ä¸ï¼ˆ.patch æ–‡ä»¶ï¼‰æ˜¯ç”¨äºå¯¹ Linux å†…æ ¸æºä»£ç è¿›è¡Œä¿®æ”¹çš„æ–‡ä»¶ã€‚è¡¥ä¸é€šå¸¸ç”¨äºä¿®å¤æ¼æ´ã€å¼•å…¥æ–°åŠŸèƒ½ã€ä¼˜åŒ–æ€§èƒ½æˆ–ä¿®æ­£é”™è¯¯ã€‚ ä»€ä¹ˆæ˜¯å†…æ ¸è¡¥ä¸å†…æ ¸è¡¥ä¸æ˜¯ä¸€ä¸ªåŒ…å«æºä»£ç æ›´æ”¹çš„æ–‡æœ¬æ–‡ä»¶ï¼Œé€šå¸¸ç”± diff æˆ– git diff ç”Ÿæˆã€‚å®ƒæè¿°äº†å¦‚ä½•ä»å½“å‰ç‰ˆæœ¬çš„æºä»£ç ç”Ÿæˆä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹çš„ä»£ç è¡Œã€‚ è¡¥ä¸æ–‡ä»¶é€šå¸¸åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š æ–‡ä»¶å¤´ï¼šæŒ‡ç¤ºè¡¥ä¸é€‚ç”¨äºå“ªä¸ªæ–‡ä»¶ã€‚ ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼šæ˜¾ç¤ºä¿®æ”¹çš„ä»£ç å‘¨å›´çš„å‡ è¡Œä»£ç ï¼Œä»¥å¸®åŠ©ç†è§£æ›´æ”¹çš„ä½ç½®ã€‚ æ›´æ”¹ä¿¡æ¯ï¼šå®é™…çš„ä»£ç å·®å¼‚ï¼Œæ ‡è®°ä¸ºæ·»åŠ ï¼ˆ+ï¼‰ã€åˆ é™¤ï¼ˆ-ï¼‰æˆ–ä¿®æ”¹ã€‚ å†…æ ¸è¡¥ä¸çš„ä½œç”¨ ä¿®å¤æ¼æ´å’Œé”™è¯¯ å†…æ ¸æ˜¯æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œä»»ä½•æ¼æ´æˆ–é”™è¯¯å¯èƒ½éƒ½ä¼šå¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šæˆ–å—åˆ°æ”»å‡»ã€‚é€šè¿‡åº”ç”¨è¡¥ä¸ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä¿®å¤è¿™äº›é—®é¢˜ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å®Œæ•´çš„æ–°å†…æ ¸ç‰ˆæœ¬å‘å¸ƒã€‚ æ·»åŠ æ–°åŠŸèƒ½ Linux å†…æ ¸æ˜¯ä¸€ä¸ªå¿«é€Ÿå‘å±•çš„é¡¹ç›®ï¼Œæ–°çš„ç¡¬ä»¶æ”¯æŒã€æ–°çš„æ–‡ä»¶ç³»ç»Ÿã€æ–°çš„å®‰å…¨åŠŸèƒ½ç­‰ï¼Œéƒ½æ˜¯é€šè¿‡è¡¥ä¸å¼•å…¥çš„ã€‚å¼€å‘äººå‘˜é€šè¿‡æäº¤è¡¥ä¸æ¥è´¡çŒ®æ–°åŠŸèƒ½ï¼Œå…¶ä»–å¼€å‘è€…å¯ä»¥åœ¨è‡ªå·±çš„å†…æ ¸ä¸­åº”ç”¨è¿™äº›è¡¥ä¸è¿›è¡Œæµ‹è¯•å’Œä½¿ç”¨ã€‚ æ€§èƒ½ä¼˜åŒ– è¡¥ä¸è¿˜å¯ä»¥ç”¨äºæ€§èƒ½ä¼˜åŒ–ï¼Œå°¤å…¶æ˜¯åœ¨é«˜æ€§èƒ½è®¡ç®—æˆ–åµŒå…¥å¼ç³»ç»Ÿä¸­ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡è°ƒæ•´å†…æ ¸ä»£ç ï¼Œä¼˜åŒ–èµ„æºä½¿ç”¨å’Œå“åº”æ—¶é—´ï¼Œä»è€Œæé«˜ç³»ç»Ÿæ•´ä½“æ€§èƒ½ã€‚ è‡ªå®šä¹‰å†…æ ¸ æœ‰äº›ç”¨æˆ·å’Œå¼€å‘äººå‘˜éœ€è¦å®šåˆ¶å†…æ ¸ä»¥æ»¡è¶³ç‰¹å®šéœ€æ±‚ï¼Œå¦‚åœ¨ç‰¹å®šç¡¬ä»¶ä¸Šè¿è¡Œã€å¯ç”¨ç‰¹å®šåŠŸèƒ½æˆ–ä¼˜åŒ–æŸäº›å·¥ä½œè´Ÿè½½ã€‚é€šè¿‡åº”ç”¨ç‰¹å®šçš„è¡¥ä¸ï¼Œå†…æ ¸å¯ä»¥è¢«è°ƒæ•´å’Œå®šåˆ¶ã€‚ å¦‚ä½•ä½¿ç”¨å†…æ ¸è¡¥ä¸ä»¥ä¸‹ä»¬ä½¿ç”¨ä¸€ä¸ª linux4.19 çš„å†…æ ¸åœ¨ ubuntu24 ä¸­ç¼–è¯‘æ—¶å‡ºç°æŠ¥é”™çš„ç¤ºä¾‹æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªå†…æ ¸è¡¥ä¸ã€‚ ç¼–è¯‘å†…æ ¸æºç ï¼Œåœ¨ç¼–è¯‘å†…æ ¸æºç æ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š 2024-08-24T13:51:26 In file included from /usr/include/signal.h:328,2024-08-24T13:51:26 from ./signal.h:52,2024-08-24T13:51:26 from c-stack.c:49:2024-08-24T13:51:26 c-stack.c:55:26: error: missing binary operator before token (2024-08-24T13:51:26 55 | #elif HAVE_LIBSIGSEGV SIGSTKSZ 163842024-08-24T13:51:26 | ^~~~~~~~......2024-08-24T13:51:26 make[4]: *** [Makefile:1674: all] Error 22024-08-24T13:51:26 make[3]: *** [Makefile:1572: all-recursive] Error 12024-08-24T13:51:26 make[2]: *** [Makefile:1528: all] Error 22024-08-24T13:51:26 make[1]: *** [package/pkg-generic.mk:231: /mnt/c/Users/Administrator/Desktop/12.GitHub/CodeWork/00.HoldDev/OK3568-linux-source/buildroot/output/OK3568/build/host-m4-1.4.18/.stamp_built] Error 22024-08-24T13:51:26 make: *** [/mnt/c/Users/Administrator/Desktop/12.GitHub/CodeWork/00.HoldDev/OK3568-linux-source/buildroot/output/OK3568/Makefile:16: _all] Error 2Command exited with non-zero status 1you take 7:43.42 to build builrootERROR: Running build_buildroot failed!ERROR: exit code 1 from line 565: /usr/bin/time -f you take %E to build builroot $COMMON_DIR/mk-buildroot.sh $BOARD_CONFIG ä¸‹è½½ä»¬éœ€è¦çš„è¡¥ä¸æ–‡ä»¶ cd OK3568-linux-sourcewget https://toolchains.bootlin.com/downloads/releases/sources/m4-1.4.18/0003-c-stack-stop-using-SIGSTKSZ.patch å…·ä½“è¡¥ä¸æ–‡ä»¶å†…å®¹å¦‚ä¸‹ c-stack: stop using SIGSTKSZItâ€™s been proposed to stop making SIGSTKSZ an integer constant:https://sourceware.org/pipermail/libc-alpha/2020-September/118028.htmlAlso, using SIGSTKSZ in #if did not conform to current POSIX.Also, avoiding SIGSTKSZ makes the code simpler and easier to grok.* lib/c-stack.c (SIGSTKSZ): Remove.(alternate_signal_stack): Now a 64 KiB array, for simplicity.All uses changed.[Retrieved (and backported) from:https://git.savannah.gnu.org/cgit/gnulib.git/patch/?id=f9e2b20a12a230efa30f1d479563ae07d276a94b]Signed-off-by: Fabrice Fontaine fontaine.fabrice@gmail.comdiff -Nura m4-1.4.18.orig/lib/c-stack.c m4-1.4.18/lib/c-stack.c--- m4-1.4.18.orig/lib/c-stack.c 2021-04-11 19:12:14.086494029 +0200+++ m4-1.4.18/lib/c-stack.c 2021-04-11 19:48:46.316862760 +0200@@ -50,15 +50,16 @@ #if ! HAVE_STACK_T ! defined stack_t typedef struct sigaltstack stack_t; #endif-#ifndef SIGSTKSZ-# define SIGSTKSZ 16384-#elif HAVE_LIBSIGSEGV SIGSTKSZ 16384-/* libsigsegv 2.6 through 2.8 have a bug where some architectures use- more than the Linux default of an 8k alternate stack when deciding- if a fault was caused by stack overflow. */-# undef SIGSTKSZ-# define SIGSTKSZ 16384-#endif++/* Storage for the alternate signal stack.+ 64 KiB is not too large for Gnulib-using apps, and is large enough+ for all known platforms. Smaller sizes may run into trouble.+ For example, libsigsegv 2.6 through 2.8 have a bug where some+ architectures use more than the Linux default of an 8 KiB alternate+ stack when deciding if a fault was caused by stack overflow. */+static max_align_t alternate_signal_stack[(64 * 1024+ + sizeof (max_align_t) - 1)+ / sizeof (max_align_t)]; #include stdlib.h #include string.h@@ -128,19 +129,6 @@ #if (HAVE_SIGALTSTACK HAVE_DECL_SIGALTSTACK \\ HAVE_STACK_OVERFLOW_HANDLING) || HAVE_LIBSIGSEGV-/* Storage for the alternate signal stack. */-static union-- char buffer[SIGSTKSZ];-- /* These other members are for proper alignment. Theres no- standard way to guarantee stack alignment, but this seems enough- in practice. */- long double ld;- long l;- void *p;- alternate_signal_stack;- static void null_action (int signo __attribute__ ((unused))) @@ -205,8 +193,8 @@ /* Always install the overflow handler. */ if (stackoverflow_install_handler (overflow_handler,- alternate_signal_stack.buffer,- sizeof alternate_signal_stack.buffer))+ alternate_signal_stack,+ sizeof alternate_signal_stack)) errno = ENOTSUP; return -1;@@ -279,14 +267,14 @@ stack_t st; struct sigaction act; st.ss_flags = 0;+ st.ss_sp = alternate_signal_stack;+ st.ss_size = sizeof alternate_signal_stack; # if SIGALTSTACK_SS_REVERSED /* Irix mistakenly treats ss_sp as the upper bound, rather than lower bound, of the alternate stack. */- st.ss_sp = alternate_signal_stack.buffer + SIGSTKSZ - sizeof (void *);- st.ss_size = sizeof alternate_signal_stack.buffer - sizeof (void *);-# else- st.ss_sp = alternate_signal_stack.buffer;- st.ss_size = sizeof alternate_signal_stack.buffer;+ st.ss_size -= sizeof (void *);+ char *ss_sp = st.ss_sp;+ st.ss_sp = ss_sp + st.ss_size; # endif r = sigaltstack (st, NULL); if (r != 0)diff -Nura m4-1.4.18.orig/lib/c-stack.h m4-1.4.18/lib/c-stack.h--- m4-1.4.18.orig/lib/c-stack.h 2021-04-11 19:12:14.098494042 +0200+++ m4-1.4.18/lib/c-stack.h 2021-04-11 19:17:42.138848378 +0200@@ -34,7 +34,7 @@ A null ACTION acts like an action that does nothing. ACTION must be async-signal-safe. ACTION together with its callees- must not require more than SIGSTKSZ bytes of stack space. Also,+ must not require more than 64 KiB bytes of stack space. Also, ACTION should not call longjmp, because this implementation does not guarantee that it is safe to return to the original stack. åœ¨åˆé€‚çš„ä½ç½®ä½¿ç”¨å†…æ ¸è¡¥ä¸ï¼ˆ.patch æ–‡ä»¶ï¼‰æ¥ä¿®æ”¹ Linux å†…æ ¸çš„æºä»£ç  patch -p1 /path/to/my_patch.patch -p1 æ˜¯ä¸€ä¸ªå¸¸ç”¨é€‰é¡¹ï¼Œå®ƒå‘Šè¯‰ patch å‘½ä»¤å¿½ç•¥è·¯å¾„å‰çš„ä¸€ä¸ªç›®å½•éƒ¨åˆ†ã€‚å¦‚æœè¡¥ä¸æ–‡ä»¶çš„è·¯å¾„ä¸æºä»£ç ç›®å½•ç»“æ„ä¸ä¸€è‡´ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ -p é€‰é¡¹çš„å€¼ã€‚ ç”¨æ¥å°†è¡¥ä¸æ–‡ä»¶çš„å†…å®¹ä¼ é€’ç»™ patch å‘½ä»¤ã€‚ åœ¨è¿™é‡Œï¼Œå®é™…åº”ç”¨æ—¶ï¼Œä»¬åœ¨ç¼–è¯‘æºç ç›®å½•ä¸‹ wget ä¸‹è½½è¡¥ä¸æ–‡ä»¶ï¼Œä¹‹åè¿›å…¥æŒ‡å®šä½ç½®åº”ç”¨è¡¥ä¸ï¼š OK3568-linux-source$ cd ./buildroot/output/OK3568/build/host-m4-1.4.18/OK3568-linux-source/buildroot/output/OK3568/build/host-m4-1.4.18$ patch -p1 ../../../../../0003-c-stack-stop-using-SIGSTKSZ.patchpatching file lib/c-stack.cpatching file lib/c-stack.h æ£€æŸ¥åº”ç”¨ç»“æœï¼Œå¯ä»¥æ£€æŸ¥åº”ç”¨è¡¥ä¸åçš„æ–‡ä»¶ï¼Œç¡®ä¿è¡¥ä¸å·²æ­£ç¡®åº”ç”¨ã€‚ å›æ»šè¡¥ä¸ï¼Œå¦‚æœè¡¥ä¸å¼•å…¥äº†é—®é¢˜æˆ–ä¸éœ€è¦äº†ï¼Œå¯ä»¥å›æ»šè¡¥ä¸ï¼š patch -p1 -R /path/to/patch.patch","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","å†…æ ¸"]},{"title":"Dockerä¸‹é…ç½®wordpress","path":"/2024/08/22/1-å¹³å°ç³»ç»Ÿ-Docker-Dockerä¸‹é…ç½®wordpress/","content":"DockerCompose æ–¹å¼å®‰è£… WordPress åŠ Mysqlå‡†å¤‡å­˜å‚¨ç›®å½•Docker å®¹å™¨ä¸­çš„æ•°æ®ä¸æ˜¯æŒä¹…çš„ã€‚è¿™æ„å‘³ç€å¦‚æœåœæ­¢å®¹å™¨å¹¶å†æ¬¡è¿è¡Œå®ƒï¼Œå°†ä¸¢å¤±æ‰€æœ‰æ•°æ®ï¼Œé‡Œé¢å°†ä¸å†æœ‰ä»»ä½•æ•°æ®ã€‚è¿™å¯ä»¥é€šè¿‡æ·»åŠ  Docker æ•°æ®å·æ¥é¿å…ã€‚ åˆ›å»º docker-compose.ymlåœ¨ Docker Compose ä¸­ï¼Œè¿è¡Œå®¹å™¨æ‰€éœ€çš„æ‰€æœ‰èµ„æºéƒ½å¿…é¡»åœ¨åä¸º .yaml çš„ YAML æ–‡ä»¶ä¸­å®šä¹‰ docker-compose.yamlã€‚ç„¶å Docker Compose å°†è¯»å–æ­¤ç±»æ–‡ä»¶å¹¶ä¸ Docker å®ˆæŠ¤ç¨‹åºé€šä¿¡ä»¥åˆ›å»ºã€é…ç½®æˆ–é”€æ¯å®šä¹‰çš„èµ„æºã€‚ åœ¨ä»¬çš„ä¾‹å­ä¸­ï¼Œè¯¥ docker-compose.yaml æ–‡ä»¶å°†åŒ…å«ä»¬çš„ dockerized WordPress è®¾ç½®çš„æœåŠ¡å®šä¹‰ã€‚æ­¤å¤–ï¼ŒDocker Compose å…è®¸ä»¬å°†è¿™äº›æœåŠ¡ä¸å…±äº«ç½‘ç»œå’Œå·é“¾æ¥åœ¨ä¸€èµ·ã€‚ å› æ­¤ï¼Œè®©ä»¬ä»ä½¿ç”¨ Vim ç¼–è¾‘å™¨åœ¨srvwordpress ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ docker-compose.yaml å¼€å§‹ ã€‚ç¤ºä¾‹å†…å®¹å¦‚ä¸‹ï¼š version: 3.3services:\tmysql: image: mysql:latest #å®‰è£…mysqlé•œåƒ volumes: #æ˜ å°„ä½ç½® mysql_data:/var/lib/mysql restart: always environment: #ç¯å¢ƒå˜é‡ MYSQL_ROOT_PASSWORD: liuluhua MYSQL_DATABASE: wordpress MYSQL_USER: liuluhua MYSQL_PASSWORD: liuluhua\twordpress: depends_on: #éœ€è¦mysql mysql image: wordpress:latest #å®‰è£…wordpressé•œåƒ ports: 80:80 #ç«¯å£æ˜ å°„ restart: always environment: #ç¯å¢ƒå˜é‡ WORDPRESS_DB_HOST: mysql:3306 WORDPRESS_DB_USER: liuluhua WORDPRESS_DB_PASSWORD: liuluhua WORDPRESS_DB_NAME: wordpressvolumes:\t./wp-content:/var/www/html/wp-contentvolumes:\tmysql_data: è¿™é‡Œå®šä¹‰äº†ä¸¤ä¸ªè‡ªåŠ¨äº’ç›¸é“¾æ¥çš„æœåŠ¡ mysql å’Œ wordpress ä½¿ç”¨æœ€æ–°çš„ mysql å’Œ wordpress çš„ docker é•œåƒ è®¾ç½®äº† MYSQL å’Œ WordPress çš„ç¯å¢ƒ WordPress æ˜ åƒåŸºäº Apacheï¼Œå®ƒé€šè¿‡ derfault åœ¨ç«¯å£ ä¸Šè¿è¡Œ 80ã€‚å°†é»˜è®¤ Apache ç«¯å£æ˜ å°„åˆ° 8080 æœ¬åœ°è®¡ç®—æœºçš„ç«¯å£ã€‚ mysql_dataï¼šæµå…¥è¿™ä¸ªæ•°æ®åº“çš„æ•°æ®å°†è¢«æŒä¹…åŒ–åˆ°ä¸€ä¸ªå‘½åå· mysql_dataï¼Œè¿™æ ·å³ä½¿åˆ é™¤äº†å®¹å™¨ï¼Œæ•°æ®ä»ç„¶å­˜åœ¨äºçš„æœºå™¨ä¸Šï¼Œå¹¶ä¸”å¯ä»¥å†æ¬¡å®‰è£…åœ¨æ–°çš„å®¹å™¨ä¸­ã€‚ volumes å‚æ•° wordpress æ˜¯å‘Šè¯‰ Docker çš„ wp-content åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­æ˜¾ç¤ºç›®å½•ã€‚ç°åœ¨ï¼Œä»¬ä¸º WordPress ç«™ç‚¹çš„æŸäº›éƒ¨åˆ†ï¼ˆä¾‹å¦‚ wp-content ç›®å½•ï¼‰æä¾›äº†æŒä¹…å­˜å‚¨ã€‚åœ¨ wp-content åŒ…å«æ‰€æœ‰ç”¨æˆ·æä¾›çš„å†…å®¹ã€‚åŸºæœ¬ä¸Šï¼Œå¯ä»¥ä¸Šä¼ åˆ°ç½‘ç«™çš„ä»»ä½•å†…å®¹éƒ½ä¼šåœ¨æ­¤å¤„ç»“æŸã€‚ åªè¦åŒæ—¶æ‹¥æœ‰æ•°æ®åº“å’Œ wp-content æ–‡ä»¶å¤¹ï¼Œå°±å¯ä»¥éšæ—¶æ¢å¤çš„ç«™ç‚¹ï¼Œå³ä½¿å…¶ä»–æ‰€æœ‰å†…å®¹éƒ½ä¸¢å¤±äº†ã€‚ å¯åŠ¨å’Œåœæ­¢docker-compose -f docker-compose.wordpress.yml up -d #åå°è¿è¡Œdocker-compose -f docker-compose.wordpress.yml down #åœæ­¢å¹¶åˆ é™¤æœåŠ¡````- å¦‚æœæœ‰é”™è¯¯ï¼ŒæŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼š```cppsudo docker-compose logs å¦‚æœéœ€è¦è¿›å…¥å®¹å™¨å†…å‘½ä»¤è¡Œï¼š sudo docker-compose exec -it å®¹å™¨åç§° /bin/bash Docker å‘½ä»¤è¡Œå‘½ä»¤è¡Œæ–¹å¼å®‰è£…docker pull wordpressdocker pull mysql å‘½ä»¤è¡Œæ–¹å¼å¯åŠ¨docker run -d --name mysql \\\t-v mysql-data:/var/lib/mysql \\\t-e MYSQL_ROOT_PASSWORD=liuluhua \\\t-e MYSQL_DATABASE=wordpress mysql \\docker run -d \\\t-e WORDPRESS_DB_HOST=mysql:3306 \\\t--link mysql \\\t-p 8000:80 wordpress å‚æ•°è¯´æ˜ -d åå°è¿è¡Œ-p ç«¯å£æ˜ å°„ è®¿é—® wordpressæ‰“å¼€ http://localhost æ’ä»¶é…ç½®WP Githuber MDæ”¯æŒ markdown é…ç½®ä¸Šä¼ æ–‡ä»¶å¤§å°åœ¨ yaml æ–‡ä»¶ä¸­ volumes ä¸­æ–°å¢ä¸€è¡Œï¼š ./uploads.ini:/usr/local/etc/php/conf.d/uploads.ini é»˜è®¤ä¸ºæ–‡ä»¶å¤¹ï¼Œåˆ é™¤ä¿®æ”¹ä¸ºæ–‡ä»¶å°±è¡Œï¼Œä¿®æ”¹æ–‡ä»¶å†…å®¹ä¸ºï¼š file_uploads = Onmemory_limit = 5Gupload_max_filesize = 5Gpost_max_size = 5Gmax_execution_time = 0 #ä¸Šä¼ æ—¶é—´é™åˆ¶ï¼Œä¿®æ”¹ä¸º0åˆ™æ— é™åˆ¶ ä¹‹åå®‰è£… WP Maximum Upload File Size æ’ä»¶è¿›è¡Œä¿®æ”¹å³å¯ï¼Œæœ€å¤§æ”¯æŒåˆ° 2GB å¦‚æœè¦ä¿®æ”¹è¶…è¿‡ 2GBï¼š å¸è½½ WP Maximum Upload File Size æ’ä»¶ï¼Œç¼–è¾‘ uploads.ini ç¼–è¾‘ html/wp-config.php @ini\\_set( upload\\_max\\_filesize , 4G );@ini\\_set( post\\_max\\_size, 4G);@ini\\_set( memory\\_limit, 8G );@ini\\_set( max\\_execution\\_time, 0 );@ini\\_set( max\\_input\\_time, 0 ); ç¼–è¾‘ html/wp-content/.htaccess php_value upload_max_filesize 4Gphp_value post_max_size 4Gphp_value memory_limit 8Gphp_value max_execution_time 0php_value max_input_time 0","categories":["1.å¹³å°ç³»ç»Ÿ","Docker"]},{"title":"keyringåº“","path":"/2024/08/21/1-å¹³å°ç³»ç»Ÿ-Linux-åŠ å¯†-keyringåº“/","content":"ä½¿ç”¨ keyring åº“å®‰å…¨åœ°å­˜å‚¨å’Œæ£€ç´¢æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ï¼‰ã€‚ keyring æä¾›äº†ä¸€ä¸ªå®‰å…¨çš„æ–¹å¼æ¥ç®¡ç†è¿™äº›ä¿¡æ¯ï¼Œè€Œä¸æ˜¯å°†æ˜æ–‡å­˜å‚¨åœ¨ä»£ç æˆ–é…ç½®æ–‡ä»¶ä¸­ã€‚ä½†æ˜¯ keyring åº“ä¸æ˜¯ Linux å†…æ ¸çš„å¯†é’¥ä¿ç•™æœåŠ¡ï¼Œè€Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ C++ åº“ï¼Œæä¾›äº†è·¨å¹³å°çš„å¯†ç ç®¡ç†åŠŸèƒ½ã€‚å®ƒé€šå¸¸ä¼šä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„å®‰å…¨å­˜å‚¨æœºåˆ¶ï¼ˆå¦‚ Linux çš„ Secret Service API æˆ– Windows çš„ Credential Managerï¼‰æ¥å®ç°å…¶åŠŸèƒ½ã€‚ #include keyring/keyring.h#include iostream#include stringint main() std::string service_name = foo; std::string account = bar; std::string password_input = password; std::string password_output = ; keyring::set_password(service_name, account, password_input); keyring::get_password(service_name, account, password_output); std::cout password_output std::endl; return 0;","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","åŠ å¯†"]},{"title":"å†…æ ¸å¯†é’¥ä¿ç•™æœåŠ¡","path":"/2024/08/20/1-å¹³å°ç³»ç»Ÿ-Linux-åŠ å¯†-å†…æ ¸å¯†é’¥ä¿ç•™æœåŠ¡/","content":"Linux å†…æ ¸æä¾›äº†å¯†é’¥ä¿ç•™æœåŠ¡(Key Retention Service),å¯ä»¥ç”¨äºåº”ç”¨ç¨‹åºåŠ å¯†ã€‚Linux å¯†é’¥ä¿ç•™æœåŠ¡ï¼ˆLinux key retention service æ˜¯åœ¨ Linux 2.6 ä¸­å¼•å…¥çš„ï¼Œå®ƒçš„ä¸»è¦æ„å›¾æ˜¯åœ¨ Linux å†…æ ¸ä¸­ç¼“å­˜èº«ä»½éªŒè¯æ•°æ®ã€‚è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿå’Œå…¶ä»–å†…æ ¸æœåŠ¡å¯ä»¥ä½¿ç”¨è¿™ä¸ªæœåŠ¡æ¥ç®¡ç†å¯†ç å­¦ã€èº«ä»½éªŒè¯æ ‡è®°ã€è·¨åŸŸç”¨æˆ·æ˜ å°„å’Œå…¶ä»–å®‰å…¨é—®é¢˜ã€‚å®ƒè¿˜ä½¿ Linux å†…æ ¸èƒ½å¤Ÿå¿«é€Ÿè®¿é—®æ‰€éœ€çš„å¯†é’¥ï¼Œå¹¶å¯ä»¥ç”¨æ¥å°†å¯†é’¥æ“ä½œï¼ˆæ¯”å¦‚æ·»åŠ ã€æ›´æ–°å’Œåˆ é™¤ï¼‰å§”æ‰˜ç»™ç”¨æˆ·ç©ºé—´ã€‚ å¯ç”¨å¯†é’¥ä¿ç•™æœåŠ¡ åœ¨å†…æ ¸é…ç½®ä¸­å¯ç”¨å¯†é’¥æœåŠ¡é€‰é¡¹: ## Security options#CONFIG_KEYS=yCONFIG_KEYS_DEBUG_PROC_KEYS=yCONFIG_SECURITY=yCONFIG_SECURITY_NETWORK=yCONFIG_SECURITY_CAPABILITIES=y å®‰è£… keyutils åŒ…,æä¾›å¯†é’¥ç®¡ç†å·¥å…·: sudo apt install keyutils å†…æ ¸å±‚ API register_key_type å®šä¹‰æ–°çš„å¯†é’¥ç±»å‹ã€‚å¦‚æœå­˜åœ¨åç§°ç›¸åŒçš„å¯†é’¥ç±»å‹ï¼Œè¿”å› EEXITã€‚ int register_key_type(struct key_type *type) unregister_key_type ç”¨æ¥å–æ¶ˆå¯†é’¥ç±»å‹çš„æ³¨å†Œ void unregister_key_type(struct key_type *type); key_alloc åˆ†é…æŒ‡å®šç±»å‹çš„å¯†é’¥ struct key *key_alloc(struct key_type *type, const char *desc, uid_t uid, gid_t gid, struct task_struct *ctx, key_perm_t perm, unsigned long flags); key_instantiate_and_link å¯¹å¯†é’¥è¿›è¡Œå®ä¾‹åŒ–å¹¶å°†å®ƒé“¾æ¥åˆ°ç›®æ ‡ keyring int key_instantiate_and_link(struct key *key, const void *data,size_t datalen, struct key *keyring,struct key *instkey); request_key æœç´¢ä¸ç»™å®šçš„æè¿°åŒ¹é…çš„å¯†é’¥ struct key *request_key(const struct key_type *type,const char *description,const char *callout_string); lookup_user_key ç”¨äºåœ¨å†…æ ¸ä¸­æŸ¥æ‰¾æŒ‡å®š ID çš„å¯†é’¥ key_ref_t lookup_user_key(key_serial_t id, unsigned long flags, key_perm_t perm) key_put å‘å¸ƒä¸€ä¸ªå¯†é’¥ void key_put(struct key *key); åº”ç”¨å±‚ APILinux å†…æ ¸æä¾›äº†å¯†é’¥ä¿ç•™æœåŠ¡(Key Retention Service)æœåŠ¡æä¾›ä¸‰ä¸ªæ–°çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨æ¥åœ¨ç”¨æˆ·ç©ºé—´ä¸­æ“ä½œå¯†é’¥ã€‚ add_key()ç”¨äºç”¨æˆ·ç©ºé—´ç¨‹åºå‘æŒ‡å®šçš„å¯†é’¥ç¯ä¸­æ·»åŠ æ–°å¯†é’¥æˆ–æ›´æ–°ç°æœ‰å¯†é’¥ã€‚ long add_key(const char *type, const char *description, const void *payload, size_t plen, key_serial_t keyring); add_key ç³»ç»Ÿè°ƒç”¨ç”¨æ¥åˆ›å»ºç±»å‹ä¸º typeã€é•¿åº¦ä¸º plen çš„å¯†é’¥ã€‚å¯†é’¥æè¿°ç”± desc å®šä¹‰ï¼Œå®ƒçš„æœ‰æ•ˆå†…å®¹ç”± payload æŒ‡å®šã€‚å¯†é’¥é“¾æ¥åˆ° keyring ringã€‚å¯†é’¥ç±»å‹å¯ä»¥æ˜¯ user æˆ– keyringã€‚å…¶ä»–ä»»ä½•å¯†é’¥ç±»å‹å¿…é¡»å·²ç»é€šè¿‡å†…æ ¸æœåŠ¡å‘å†…æ ¸æ³¨å†Œï¼Œç„¶åæ‰èƒ½ä½¿ç”¨ã€‚å¦‚æœå¯†é’¥æ˜¯ keyring ç±»å‹çš„ï¼Œæœ‰æ•ˆå†…å®¹å°±åº”è¯¥æ˜¯ NULLï¼Œplen åº”è¯¥æ˜¯é›¶ã€‚ request_key()ç”¨äºè¯·æ±‚è®¿é—®ä¸€ä¸ªå¯†é’¥ã€‚ key_serial_t request_key(const char *type, const char *description, const char *callout_info, key_serial_t dest_keyring); å®ƒå…è®¸ç¨‹åºè¯·æ±‚è®¿é—®ä¸€ä¸ªå·²å­˜åœ¨çš„å¯†é’¥ï¼Œå¦‚æœå¯†é’¥ä¸å­˜åœ¨ï¼Œè¿˜å¯ä»¥è§¦å‘åˆ›å»ºå¯†é’¥çš„è¿‡ç¨‹ã€‚ keyctl()å¤šåŠŸèƒ½ç³»ç»Ÿè°ƒç”¨,ç”¨äºæ‰§è¡Œå„ç§å¯†é’¥ç®¡ç†æ“ä½œã€‚å…¶åŸºæœ¬ç”¨æ³•å¦‚ä¸‹: long keyctl(int operation, ...); keyctl()æ”¯æŒå¤šç§æ“ä½œ,åŒ…æ‹¬ä½†ä¸é™äº: KEYCTL_DESCRIBE æè¿°ä¸€ä¸ªå¯†é’¥ã€‚ KEYCTL_READ ä»ä¸€ä¸ªå¯†é’¥è¯»å–æœ‰æ•ˆå†…å®¹æ•°æ®ã€‚ KEYCTL_UPDATE æ›´æ–°æŒ‡å®šçš„å¯†é’¥ã€‚ KEYCTL_LINK å°†ä¸€ä¸ªå¯†é’¥é“¾æ¥åˆ°ä¸€ä¸ª keyringã€‚ KEYCTL_UNLINK å°†å¯†é’¥æˆ– keyring ä¸å¦ä¸€ä¸ª keyring çš„é“¾æ¥å–æ¶ˆã€‚ KEYCTL_JOIN_SESSION_KEYRING å°†ä¸€ä¸ªä¼šè¯ keyring æ›¿æ¢ä¸ºæ–°çš„ä¼šè¯ keyringã€‚ KEYCTL_REVOKE å–æ¶ˆä¸€ä¸ªå¯†é’¥ã€‚ KEYCTL_CHOWN ä¿®æ”¹å¯†é’¥çš„æ‰€æœ‰è€…ã€‚ KEYCTL_SETPERM ä¿®æ”¹å¯†é’¥çš„æƒé™æ©ç ã€‚ KEYCTL_CLEAR æ¸…é™¤ä¸€ä¸ª keyringã€‚ KEYCTL_SEARCH åœ¨ä¸€ä¸ª keyring æ ‘ä¸­æœç´¢å¯†é’¥ã€‚ KEYCTL_INSTANTIATE å¯¹éƒ¨åˆ†æ„é€ å¥½çš„å¯†é’¥è¿›è¡Œå®ä¾‹åŒ–ã€‚ KEYCTL_NEGATE å–æ¶ˆå¯¹éƒ¨åˆ†æ„é€ å¥½çš„å¯†é’¥çš„å®ä¾‹åŒ–ã€‚ æŸ¥çœ‹å†…æ ¸ä¸­æ˜¯å¦æ”¯æŒä»¥ä¸‹å‡½æ•°ï¼š // è¯»å–å¯†é’¥å†…å®¹long keyctl_read(key_serial_t key, char *buffer, size_t buflen)// æ›´æ–°å¯†é’¥å†…å®¹ long keyctl_update(key_serial_t key, const void *payload, size_t plen)// æ’¤é”€å¯†é’¥long keyctl_revoke(key_serial_t key) ä½¿ç”¨å¯†é’¥ä¿ç•™æœåŠ¡åˆ›å»ºå¯†é’¥é€šè¿‡å¯†é’¥ä¿ç•™æœåŠ¡å¯†é’¥ä¼šè¢«å­˜å‚¨åœ¨å†…æ ¸ä¸­,è€Œä¸æ˜¯åº”ç”¨ç¨‹åºçš„å†…å­˜ç©ºé—´,æé«˜äº†å®‰å…¨æ€§ å†…æ ¸å±‚æ¨¡å—åœ¨å®ƒçš„ init å‡½æ•°ä¸­è°ƒç”¨ register_key_type() æ¥æ³¨å†Œè¿™ä¸ªæ–°å¯†é’¥ç±»å‹ï¼ˆåä¸º mykeyï¼‰ã€‚ #include linux/key-type.hstatic struct key_type my_key_type = .name = mykey,\t.instantiate = my_instantiate_key,\t.describe = my_key_describe,\t.match = my_key_match,\t.destroy = my_key_destroy,;static int __init my_module_init(void) int ret = register_key_type(my_key_type);\tif (ret) pr_err(Failed to register key type ); return ret; pr_info(My key type registered );\treturn 0;static void __exit my_module_exit(void) unregister_key_type(my_key_type);\tpr_info(My key type unregistered );module_init(my_module_init);module_exit(my_module_exit); å½“å†…æ ¸æ¨¡å—æ”¶åˆ° ioctl è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆè°ƒç”¨ key_alloc() æ¥åˆ†é…ä¸€ä¸ªæ–°çš„å¯†é’¥ï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªä¼šè¯ keyringã€‚ struct key *key;key = key_alloc(my_key_type, my_key, current_uid(), current_gid(), current_cred(), KEY_POS_ALL, 0);if (!IS_ERR(key)) const char *data = secret_data;\tkey_instantiate_and_link(key, data, strlen(data), NULL, NULL); åœ¨æˆåŠŸè°ƒç”¨ key_alloc() ä¹‹åï¼Œè°ƒç”¨ key_instantiate_and_link() å¯¹å¯†é’¥è¿›è¡Œå®ä¾‹åŒ–ã€‚ int ret = key_instantiate_and_link(key, NULL, 0, NULL, NULL);if (ret 0) key_put(key); return ret; åœ¨åˆ›å»ºå¹¶å®ä¾‹åŒ–ä¼šè¯ keyring ä¹‹åï¼Œä¸ºç”¨æˆ·çš„ä¼šè¯åˆ›å»ºå¯†é’¥ã€‚ åŒæ ·ï¼Œä¾æ¬¡è°ƒç”¨ key_alloc() å’Œ key_instantiate_and_link()ã€‚ æˆåŠŸå®Œæˆè¿™äº›è°ƒç”¨ä¹‹åï¼Œç”¨æˆ·ç©ºé—´ä¼šè¯å°±æœ‰äº†ä¸€ä¸ªæ–°å¯†é’¥ã€‚ åº”ç”¨å±‚keyctl add user mykey mysecretvalue @u ä½¿ç”¨å¯†é’¥åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å¯†é’¥: #include keyutils.h#include stdio.hint main() key_serial_t key; char buffer[256]; long buflen; key = request_key(user, mykey, NULL, KEY_SPEC_SESSION_KEYRING); if (key == -1) perror(request_key); return 1; buflen = keyctl_read(key, buffer, sizeof(buffer)); if (buflen == -1) perror(keyctl_read); return 1; printf(Key data: %.*s , (int)buflen, buffer); return 0; æ³¨æ„äº‹é¡¹ éœ€è¦å†…æ ¸æ”¯æŒ(2.6 åŠä»¥ä¸Šç‰ˆæœ¬) libkeyutils.so æ˜¯ C åº“ï¼Œåœ¨ C++å·¥ç¨‹ä¸­ä¼šå‡ºç° undefined reference add_key ç­‰é”™è¯¯ï¼Œå¤´æ–‡ä»¶ keyutils.h éœ€è¦ extern åŒ…å«ï¼Œä¸”éœ€è¦æ³¨æ„é“¾æ¥æ—¶éœ€è¦æ·»åŠ  LIB += -lkeyutils ä¸€å®šè¦åˆå§‹åŒ– keyutils åº“,å…·ä½“æ–¹æ³•å¦‚ä¸‹: int rc = 0;rc = keyctl(KEYCTL_LINK,KEY_SPEC_USER_KEYRING,KEY_SPEC_SESSION_KERING); åªæœ‰æ­¤å¤„è°ƒç”¨æˆåŠŸå,æ‰èƒ½è°ƒç”¨ add_key(â€œuserâ€,â€¦);å¦åˆ™,å³ä½¿ add_key æˆåŠŸ,æœ€åè°ƒç”¨ request_key ä¹Ÿä¼šå¤±è´¥ï¼Œæ‰¾ä¸åˆ°æ‰åŠ å…¥åˆ° keyring ä¸­çš„ KEY.åœ¨å†…æ ¸ä¸­è°ƒç”¨ request_key ä¹Ÿä¼šå¤±è´¥,è¿”å› NOKEY. çŠ¶æ€æŸ¥çœ‹[root@phoenix set.5]# keyctl showSession Keyring-3 --alswrv 0 0 keyring: session.262139044642 --alswrv 0 0 \\_ mykey: New key type[root@phoenix set.5]# cat /proc/keys00000001 I----- 1 perm 1f3f0000 0 0 keyring _uid_ses.0: 1/400000002 I----- 5 perm 1f3f0000 0 0 keyring _uid.0: empty0253c622 I--Q-- 1 perm 3f3f0000 0 0 mykey New key type: 011a490da I--Q-- 2 perm 3f3f0000 0 0 keyring session.2621: 1/413670439 I--Q-- 2 perm 1f3f0000 0 0 keyring _ses.1977: 1/4159d39b8 I--Q-- 5 perm 1f3f0000 0 0 keyring _ses.1976: 1/43a14f259 I--Q-- 3 perm 1f3f0000 0 0 keyring _ses.1978: 1/4[root@phoenix set.5]# cat /proc/key-users0: 8 7/7 5/100 136/1000043: 2 2/2 2/100 56/1000048: 2 2/2 2/100 56/1000081: 2 2/2 2/100 56/10000786: 4 4/4 4/100 113/10000keyctl describe ``Key`` command gives the description of key.[root@phoenix set.5]# keyctl describe -3-3: alswrvalswrv------------ 0 0 keyring: session.2621[root@phoenix set.5]# keyctl describe 3904464239044642: alswrvalswrv------------ 0 0 mykey: New key type[avinesh@phoenix set.5]$ keyctl search -3 mykey New key type39044642[root@phoenix set.5]# exitexitNow back to our previous state[root@phoenix set.5]# keyctl showSession Keyring-3 --alswrv 0 0 keyring: _ses.19762 --alswrv 0 0 \\_ keyring: _uid.0[root@phoenix set.5]# rmmod ./kernel.land/newkey.koUnloading the module.Unregistered learning_key å†…æ ¸ä¸­çš„å¯†é’¥ç®¡ç†å†…æ ¸å¯†é’¥ç®¡ç†åœ¨ proc æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºäº†ä¸¤ä¸ªåªè¯»æ–‡ä»¶ï¼šprockeys å’Œprockey-usersã€‚å®ƒä»¬æ²¡æœ‰è¢«åˆ›å»ºåœ¨procpid ç›®å½•ä¸‹ï¼Œè€Œæ˜¯è¢«ç›´æ¥åˆ›å»ºåœ¨äº† proc æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•ä¸‹ã€‚è¿™å°±é€ æˆäº†è¿›ç¨‹æ ¹æœ¬æ— æ³•æŸ¥çœ‹åˆ°åˆ«çš„è¿›ç¨‹çš„å¯†é’¥ã€‚ prockeys æ–‡ä»¶åˆ—å‡ºå½“å‰è¿›ç¨‹å¯æŸ¥çœ‹çš„å¯†é’¥ï¼Œæ‰€ä»¥ä¸åŒçš„è¿›ç¨‹è¯»å‡ºçš„å†…å®¹ä¼šä¸åŒã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹å¸Œæœ›äº†è§£å®ƒå¯ä»¥æŸ¥çœ‹å“ªäº›å¯†é’¥ï¼Œå®ƒå¯ä»¥é€šè¿‡è¯»å– prockeys è·å¾—è¿™äº›ä¿¡æ¯ã€‚åˆ—å‡ºçš„å†…å®¹åŒ…æ‹¬åºåˆ—å·ã€è¿‡æœŸæ—¶é—´ã€è®¿é—®å…è®¸ä½ã€uidã€gidã€ç±»å‹ã€æè¿°ç­‰ã€‚åœ¨é…ç½®å†…æ ¸æ—¶ï¼Œå¿…é¡»å¯ç”¨è¿™ä¸ªæ–‡ä»¶ï¼Œå› ä¸ºå®ƒå…è®¸ä»»ä½•ç”¨æˆ·åˆ—å‡ºå¯†é’¥æ•°æ®åº“ã€‚ prockey-users åˆ—å‡ºå¯†é’¥çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ uidã€ä½¿ç”¨è®¡æ•°ã€å¯†é’¥æ€»æ•°é‡å’Œå®ä¾‹åŒ–æ•°é‡ã€å¯†é’¥æ•°é‡çš„é…é¢ä¿¡æ¯ã€å¯†é’¥å ç”¨å†…å­˜çš„é…é¢ä¿¡æ¯ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","åŠ å¯†"]},{"title":"SSHæœåŠ¡","path":"/2024/08/19/1-å¹³å°ç³»ç»Ÿ-Windows-SSHæœåŠ¡/","content":"WindowsSSH æœåŠ¡ç«¯é…ç½®åœ¨ Windows ä¸­é…ç½® SSH æœåŠ¡ç«¯çš„æ­¥éª¤å¦‚ä¸‹ï¼ˆæ ¹æ® win ç‰ˆæœ¬ä¸ä¸€è‡´å¯èƒ½ä½ç½®ä¸åŒï¼‰ï¼š æ‰“å¼€â€è®¾ç½®â€ã€‚ é€‰æ‹©â€ç³»ç»Ÿâ€ã€‚ã€‚ é€‰æ‹©â€å¯é€‰åŠŸèƒ½â€ã€‚ ç‚¹å‡»â€æ·»åŠ åŠŸèƒ½â€ï¼Œç„¶åæœç´¢å¹¶å®‰è£…â€OpenSSH æœåŠ¡å™¨â€å’Œâ€OpenSSH å®¢æˆ·ç«¯â€ã€‚ æ‰‹åŠ¨å®‰è£…å¦‚æœæ— æ³•æ·»åŠ ï¼Œè¿™é‡Œæä¾›ä¸‹æ‰‹åŠ¨å®‰è£…çš„æ–¹å¼ ä¸‹è½½ OpenSSH https://github.com/PowerShell/Win32-OpenSSH/releases è§£å‹ç¼© OpenSSH-Win64.zipï¼Œä»¥ç®¡ç†å‘˜æƒé™æ‰“å¼€ cmdï¼Œæ‰§è¡Œ powershell.exe -ExecutionPolicy Bypass -File install-sshd.ps1 å¯åŠ¨ SSH æœåŠ¡ sc config sshd start= auto #è®¾ç½®SSHæœåŠ¡è‡ªåŠ¨å¯åŠ¨net start sshd #å¼€å¯SSHæœåŠ¡ éªŒè¯åœ¨å‘½ä»¤æç¤ºç¬¦ï¼ˆcmdï¼‰ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä»¥éªŒè¯ SSH å®¢æˆ·ç«¯æ˜¯å¦å·²æ­£ç¡®å®‰è£…ï¼š ssh localhost å¯åŠ¨ SSH æœåŠ¡è¦å¯åŠ¨ SSH æœåŠ¡ï¼Œè¯·åœ¨å‘½ä»¤æç¤ºç¬¦ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š net start sshd åœæ­¢ SSH æœåŠ¡è¦åœæ­¢ SSH æœåŠ¡ï¼Œè¯·åœ¨å‘½ä»¤æç¤ºç¬¦ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š net stop sshd SSH å®¢æˆ·ç«¯Windows 10 å’Œæ›´é«˜ç‰ˆæœ¬è‡ªå¸¦ SSH å®¢æˆ·ç«¯ï¼Œå¯ä»¥åœ¨å‘½ä»¤æç¤ºç¬¦ä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œè¿æ¥ï¼š ssh ç”¨æˆ·å@ç”¨æˆ·ip LinuxSSH æœåŠ¡ç«¯åœ¨ Linux ä¸­å®‰è£…å’Œé…ç½® SSH æœåŠ¡ç«¯çš„æ­¥éª¤å¦‚ä¸‹ï¼š æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼š sudo apt update å®‰è£… OpenSSH æœåŠ¡å™¨ï¼š sudo apt install openssh-server å¯åŠ¨ SSH æœåŠ¡ï¼š sudo systemctl start ssh è®¾ç½® SSH æœåŠ¡å¼€æœºè‡ªå¯ï¼š sudo systemctl enable ssh SSH å®¢æˆ·ç«¯åœ¨ Linux ä¸­ä½¿ç”¨ SSH å®¢æˆ·ç«¯è¿æ¥åˆ°è¿œç¨‹ä¸»æœºçš„å‘½ä»¤å¦‚ä¸‹ï¼š ssh ç”¨æˆ·å@ç”¨æˆ·ip ä¾‹å¦‚ï¼Œè¿æ¥åˆ°æœ¬åœ°æœºå™¨ï¼š ssh username@127.0.0.1 æ‹·è´ä½¿ç”¨ scp å‘½ä»¤ä» Linux æ‹·è´æ–‡ä»¶åˆ° Windowsï¼š scp /linux/folder/copyfilename Winusername@Winip:/c:/user/username/Desktop å…å¯†ç è¿æ¥è¦å®ç°å…å¯†ç è¿æ¥ï¼Œå¯ä»¥ä½¿ç”¨ sshpass å·¥å…·ã€‚é¦–å…ˆå®‰è£… sshpassï¼š sudo apt install sshpass ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå…å¯†ç æ‹·è´ï¼š sshpass -p passwd scp /linux/folder/copyfilename Winusername@Winip:/c:/user/username/Desktop é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå¯ä»¥åœ¨ Windows å’Œ Linux ç³»ç»Ÿä¸ŠæˆåŠŸé…ç½®å’Œä½¿ç”¨ SSH æœåŠ¡ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Windows"]},{"title":"FTP é…ç½®","path":"/2024/08/16/1-å¹³å°ç³»ç»Ÿ-Linux-ç½‘ç»œ-FTP-FTP-é…ç½®/","content":"FTP çš„æ•°æ®ä¼ è¾“æ¨¡å¼FTPï¼ˆFile Transfer Protocolï¼‰æ˜¯ä¸€ä¸ªåŸºäºå®¢æˆ·ç«¯æœåŠ¡å™¨æ¶æ„çš„æ–‡ä»¶ä¼ è¾“åè®®ï¼Œæ”¯æŒä¸¤ç§å·¥ä½œæ¨¡å¼ï¼š ä¸»åŠ¨æ¨¡å¼ï¼šå®¢æˆ·ç«¯å‘ FTP æœåŠ¡å™¨å‘é€ç«¯å£ä¿¡æ¯ï¼ŒæœåŠ¡å™¨ä¸»åŠ¨è¿æ¥è¯¥ç«¯å£ã€‚ è¢«åŠ¨æ¨¡å¼ï¼šFTP æœåŠ¡å™¨å¼€å¯å¹¶å‘é€ç«¯å£ä¿¡æ¯ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨çš„ç«¯å£ï¼ŒæœåŠ¡å™¨è¢«åŠ¨æ¥å—è¿æ¥ã€‚ è¯´æ˜ï¼šå¤§å¤šæ•° FTP å®¢æˆ·ç«¯è¿è¡Œåœ¨å±€åŸŸç½‘ä¸­ï¼Œé€šå¸¸æ²¡æœ‰ç‹¬ç«‹çš„å…¬ç½‘ IP åœ°å€ï¼Œå¹¶ä¸”å¯èƒ½ä¼šè¢«é˜²ç«å¢™æ‹¦æˆªã€‚åœ¨ä¸»åŠ¨æ¨¡å¼ä¸‹ï¼ŒFTP æœåŠ¡å™¨è¿æ¥å®¢æˆ·ç«¯å°†é¢ä¸´æ›´å¤šå›°éš¾ã€‚å› æ­¤ï¼Œé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå¦åˆ™å»ºè®®å°† FTP æœåŠ¡å™¨é…ç½®ä¸ºè¢«åŠ¨æ¨¡å¼ã€‚ Linux ç¯å¢ƒä¸‹çš„ FTP æœåŠ¡å™¨åœ¨ Linux ç¯å¢ƒä¸‹ï¼Œæœ‰å‡ ç§å¸¸ç”¨çš„ FTP æœåŠ¡å™¨è½¯ä»¶ï¼Œæ¯ç§éƒ½æœ‰å…¶ç‰¹ç‚¹å’Œç”¨é€”ï¼š Wu-ftpd ç‰¹ç‚¹ï¼šWu-ftpd æ˜¯å†å²æœ€ä¹…çš„éå•†ä¸š FTP æœåŠ¡å™¨ä¹‹ä¸€ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œæ”¯æŒå¤šç§ä¼ è¾“æ¨¡å¼å’Œç”¨æˆ·ç®¡ç†æ–¹å¼ã€‚ å®˜ç½‘ï¼šhttp://www.wu-ftpd.org/ Proftpd ç‰¹ç‚¹ï¼šProftpd æ˜¯ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹å¼€å‘çš„ FTP æœåŠ¡å™¨ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªå®‰å…¨ä¸”æ˜“äºé…ç½®çš„æ›¿ä»£å“ã€‚å®ƒæ”¯æŒå¤šç§è®¤è¯æ–¹å¼å’Œè®¿é—®æ§åˆ¶æœºåˆ¶ã€‚ å®˜ç½‘ï¼šhttp://www.proftpd.org/ vsftpd ç‰¹ç‚¹ï¼švsftpd ä»¥å…¶é«˜æ€§èƒ½å’Œç¨³å®šæ€§è‘—ç§°ï¼Œå°¤å…¶é€‚åˆéœ€è¦å¤„ç†å¤§é‡å¹¶å‘è¿æ¥çš„æœåŠ¡å™¨ã€‚å®ƒçš„é…ç½®æ–‡ä»¶ç®€å•ï¼Œæ˜“äºç®¡ç†ã€‚ å®˜ç½‘ï¼šhttp://vsftpd.beasts.org/ FTP æœåŠ¡çš„ä½¿ç”¨è€…FTP æ”¯æŒä»¥ä¸‹ä¸‰ç§è®¤è¯æ¨¡å¼ï¼š åŒ¿åç”¨æˆ·æ¨¡å¼ï¼šå…è®¸ä»»ä½•äººæ— éœ€å¯†ç ç›´æ¥ç™»å½• FTP æœåŠ¡å™¨ã€‚æ­¤æ¨¡å¼å®‰å…¨æ€§æœ€ä½ï¼Œé€šå¸¸åªç”¨äºå­˜æ”¾ä¸é‡è¦çš„å…¬å¼€æ–‡ä»¶ï¼Œç”Ÿäº§ç¯å¢ƒä¸­ä¸æ¨èä½¿ç”¨ã€‚ æœ¬åœ°ç”¨æˆ·æ¨¡å¼ï¼šä¾èµ–äº Linux ç³»ç»Ÿçš„æœ¬åœ°è´¦å·è¿›è¡ŒéªŒè¯ï¼Œç›¸è¾ƒäºåŒ¿åæ¨¡å¼æ›´ä¸ºå®‰å…¨ã€‚ è™šæ‹Ÿç”¨æˆ·æ¨¡å¼ï¼šFTP æœåŠ¡å™¨ä¸“ç”¨çš„ç”¨æˆ·ï¼Œé™åˆ¶è®¿é—® Linux ç³»ç»Ÿçš„å…¶ä»–èµ„æºï¼Œè¿›ä¸€æ­¥æå‡ FTP æœåŠ¡å™¨çš„å®‰å…¨æ€§ã€‚ FTP çš„å…¸å‹æ¶ˆæ¯ æ¶ˆæ¯å· å«ä¹‰ 125 æ•°æ®è¿æ¥æ‰“å¼€ï¼Œä¼ è¾“å¼€å§‹ 200 å‘½ä»¤ OKï¼Œè¡¨ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤æ‰§è¡ŒæˆåŠŸ 226 æ•°æ®ä¼ è¾“å®Œæ¯•ï¼Œè¡¨ç¤ºæ–‡ä»¶ä¼ è¾“å·²ç»æˆåŠŸå®Œæˆ 331 ç”¨æˆ·å OKï¼Œéœ€è¦è¾“å…¥å¯†ç  425 ä¸èƒ½æ‰“å¼€æ•°æ®è¿æ¥ï¼Œå¯èƒ½æ˜¯æœåŠ¡å™¨ç«¯å£è¢«å ç”¨æˆ–é˜²ç«å¢™é˜»æ­¢äº†è¿æ¥ 426 æ•°æ®è¿æ¥è¢«å…³é—­ï¼Œä¼ è¾“è¢«ä¸­æ–­ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–æœåŠ¡å™¨ä¸»åŠ¨æ–­å¼€è¿æ¥ 452 é”™è¯¯å†™æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯æœåŠ¡å™¨ç£ç›˜æ»¡ã€æƒé™ä¸è¶³æˆ–æ–‡ä»¶è¢«é”å®š 500 è¯­æ³•é”™è¯¯ï¼Œä¸å¯è¯†åˆ«çš„å‘½ä»¤ï¼Œå¯èƒ½æ˜¯å®¢æˆ·ç«¯å‘é€äº†æœåŠ¡å™¨ä¸æ”¯æŒçš„å‘½ä»¤ vsftpd çš„é…ç½®æ–‡ä»¶vsftpd çš„é…ç½®æ–‡ä»¶åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š /etc/vsftpd/vsftpd.confï¼švsftpd çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ã€‚åŒ…å«äº†å¤§éƒ¨åˆ†çš„é…ç½®é€‰é¡¹ï¼Œå¦‚åŒ¿åç”¨æˆ·è®¾ç½®ã€æƒé™æ§åˆ¶ã€ä¼ è¾“æ¨¡å¼ç­‰ã€‚ /etc/pam.d/vsftpd ï¼šè¿™æ˜¯ vsftpd çš„ PAM é…ç½®æ–‡ä»¶ï¼Œç”¨äºé…ç½®ç”¨æˆ·è®¤è¯æ–¹å¼ã€‚PAMï¼ˆPluggable Authentication Modulesï¼‰å…è®¸ vsftpd ä½¿ç”¨ä¸åŒçš„è®¤è¯æ¨¡å—ï¼Œå¦‚æœ¬åœ°ç”¨æˆ·è®¤è¯ã€LDAP è®¤è¯ç­‰ã€‚ /etc/vsftpd.ftpusers æˆ– /etc/vsftpd/ftpusersï¼šé»‘åå•æ–‡ä»¶ï¼Œåˆ—å‡ºçš„ç”¨æˆ·å°†æ— æ³•è®¿é—® FTP æœåŠ¡å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›ç”¨æˆ·åŒ…æ‹¬ root å’Œå…¶ä»–ç³»ç»Ÿç”¨æˆ·ï¼Œä»¥é˜²æ­¢æ•æ„Ÿè´¦å·è¢«ç”¨äº FTP ç™»å½•ã€‚ /etc/vsftpd.user_list æˆ– /etc/vsftpd/user_listï¼šç™½åå•æ–‡ä»¶ï¼Œåˆ—å‡ºçš„ç”¨æˆ·å¯ä»¥è®¿é—® FTP æœåŠ¡å™¨ã€‚è¯¥æ–‡ä»¶ç”¨äºæŒ‡å®šå…è®¸æˆ–ç¦æ­¢è®¿é—® FTP æœåŠ¡å™¨çš„ç”¨æˆ·åˆ—è¡¨ã€‚å½“ userlist_enable é€‰é¡¹å¯ç”¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ userlist_deny é€‰é¡¹æ§åˆ¶æ˜¯å…è®¸è¿˜æ˜¯ç¦æ­¢åˆ—å‡ºçš„ç”¨æˆ·è®¿é—®æœåŠ¡å™¨ã€‚ å®‰è£… VSFTPD é»˜è®¤ä½¿ç”¨ 21 ç«¯å£ä½œä¸ºæœåŠ¡ç«¯å£ï¼Œéœ€è¦ä¿è¯æœåŠ¡å™¨çš„è§„åˆ™å¯ç”¨çš„ 21 ç«¯å£ sudo apt install vsftpd å®‰è£…å®Œæˆåï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ vsftpd å¯åŠ¨çŠ¶æ€ï¼Œå·²ç»å¯åŠ¨å¹¶ç›‘å¬äº† 21 ç«¯å£ sudo netstat -nltp | grep 21sudo netstat -antup | grep ftp # æŸ¥çœ‹ç›‘å¬ç«¯å£ å¯åŠ¨æœåŠ¡sudo systemctl enable vsftpd.service # è®¾ç½®å¼€æœºå¯åŠ¨sudo systemctl start vsftpd.service # å¯åŠ¨ vsftpd æœåŠ¡sudo systemctl status vsftpd # æ£€æŸ¥ vsftpd æœåŠ¡çš„çŠ¶æ€sudo service vsftpd start # å¯åŠ¨ vsftpd æœåŠ¡sudo service vsftpd stop # åœæ­¢ vsftpd æœåŠ¡sudo service vsftpd restart # é‡å¯ vsftpd æœåŠ¡ é…ç½®æ–‡ä»¶è§£æä»¥ä¸‹æ˜¯ä¼˜åŒ–åçš„ vsftpd é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ äº†è¯¦ç»†çš„æ³¨é‡Šå’Œç¤ºä¾‹ï¼Œå¸®åŠ©æ‚¨æ›´å¥½åœ°ç†è§£æ¯ä¸ªå‚æ•°çš„ä½œç”¨ã€‚ # åŸºæœ¬è®¾ç½®listen=YES # å¯ç”¨IPv4ç›‘å¬listen_ipv6=YES # å¯ç”¨IPv6ç›‘å¬listen_port=21 # è®¾ç½®ç›‘å¬ç«¯å£ä¸º8021# å®‰å…¨è®¾ç½®local_umask=022 # è®¾ç½®ä¸Šä¼ æ–‡ä»¶çš„æƒé™æ©ç ï¼Œ022è¡¨ç¤ºå…¶ä»–ç”¨æˆ·æ— å†™æƒé™security_mask=077 # å®šä¹‰å®‰å…¨æ©ç ï¼Œé™åˆ¶ä¸Šä¼ æ–‡ä»¶çš„æƒé™# ç”¨æˆ·è®¿é—®æ§åˆ¶local_enable=YES # å…è®¸æœ¬åœ°ç”¨æˆ·ç™»å½•anonymous_enable=NO # ç¦ç”¨åŒ¿åè®¿é—®ï¼Œä¿æŠ¤æœåŠ¡å™¨å®‰å…¨chroot_local_user=YES # å°†ç”¨æˆ·é™åˆ¶åœ¨å…¶ä¸»ç›®å½•ä¸­ï¼Œå¢å¼ºå®‰å…¨æ€§chroot_list_enable=YES # å¯ç”¨ä¾‹å¤–ç”¨æˆ·åˆ—è¡¨chroot_list_file=/etc/vsftpd.chroot_list # æŒ‡å®šä¾‹å¤–ç”¨æˆ·åˆ—è¡¨æ–‡ä»¶# ç”¨æˆ·åˆ—è¡¨æ§åˆ¶userlist_enable=YES # å¯ç”¨ç”¨æˆ·åˆ—è¡¨åŠŸèƒ½userlist_deny=NO # å…è®¸åˆ—è¡¨ä¸­çš„ç”¨æˆ·ç™»å½•userlist_file=/etc/vsftpd.user_list # æŒ‡å®šå…è®¸è®¿é—®çš„ç”¨æˆ·åˆ—è¡¨æ–‡ä»¶# FTPæ ¹ç›®å½•local_root=/home/ubuntu # è®¾ç½®FTPç”¨æˆ·çš„æ ¹ç›®å½•# è¢«åŠ¨æ¨¡å¼è®¾ç½®#pasv_enable=YES # å¯ç”¨è¢«åŠ¨æ¨¡å¼#pasv_address=FTPæœåŠ¡å™¨å…¬ç½‘IP # è®¾ç½®è¢«åŠ¨æ¨¡å¼çš„å…¬ç½‘IP#pasv_min_port=6000 # è®¾ç½®è¢«åŠ¨æ¨¡å¼çš„æœ€å°ç«¯å£#pasv_max_port=6010 # è®¾ç½®è¢«åŠ¨æ¨¡å¼çš„æœ€å¤§ç«¯å£# ä¼ è¾“é™åˆ¶max_per_ip=3 # æ¯ä¸ªIPçš„æœ€å¤§è¿æ¥æ•°ä¸º3local_max_rate=5000000 # æœ¬åœ°ç”¨æˆ·çš„æœ€å¤§ä¼ è¾“é€Ÿç‡ä¸º5000KB/sanon_max_rate=3000000 # åŒ¿åç”¨æˆ·çš„æœ€å¤§ä¼ è¾“é€Ÿç‡ä¸º3000KB/s# æƒé™æ§åˆ¶write_enable=YES # å…è®¸æ–‡ä»¶ä¸Šä¼ anon_upload_enable=NO # ç¦æ­¢åŒ¿åç”¨æˆ·ä¸Šä¼ æ–‡ä»¶anon_mkdir_write_enable=NO # ç¦æ­¢åŒ¿åç”¨æˆ·åˆ›å»ºç›®å½•anon_other_write_enable=NO # ç¦æ­¢åŒ¿åç”¨æˆ·ä¿®æ”¹æˆ–åˆ é™¤æ–‡ä»¶chown_username=ftpuser # åŒ¿åä¸Šä¼ çš„æ–‡ä»¶å½’å±ç”¨æˆ·# ç¼–ç è®¾ç½®utf8_filesystem=YES # ä½¿ç”¨UTF-8ç¼–ç æ”¯æŒ# æ—¥å¿—è®¾ç½®xferlog_enable=YES # å¯ç”¨ä¼ è¾“æ—¥å¿—xferlog_std_format=YES # ä½¿ç”¨æ ‡å‡†æ ¼å¼è®°å½•ä¼ è¾“æ—¥å¿—vsftpd_log_file=/var/log/vsftpd.log # æŒ‡å®šæ—¥å¿—æ–‡ä»¶è·¯å¾„# å…¶ä»–è®¾ç½®tcp_wrappers=YES # å¯ç”¨TCPåŒ…è£…å™¨è¿›è¡Œè®¿é—®æ§åˆ¶seccomp_sandbox=NO # ç¦ç”¨seccompæ²™ç›’ï¼Œé¿å…æ½œåœ¨é—®é¢˜allow_writeable_chroot=YES # å…è®¸å¯å†™çš„chrootç›®å½• ç”¨æˆ·åˆ—è¡¨é…ç½®ç¼–è¾‘ç”¨æˆ·åˆ—è¡¨æ–‡ä»¶ï¼Œå…è®¸ç‰¹å®šç”¨æˆ·è®¿é—® FTP æœåŠ¡å™¨ï¼š sudo vim /etc/vsftpd.user_list æ·»åŠ å…è®¸çš„ç”¨æˆ·åï¼Œæ¯è¡Œä¸€ä¸ªï¼š ftpuser1ftpuser2 ä¿å­˜åï¼Œé‡å¯ vsftpd æœåŠ¡ï¼š sudo systemctl restart vsftpd åˆ›å»º FTP ç”¨æˆ· åˆ›å»º FTP ç”¨æˆ·ç»„ï¼š sudo groupadd ftpgroup åˆ›å»º FTP ç”¨æˆ·ï¼ŒæŒ‡å®šä¸»ç›®å½•ï¼š sudo useradd -g ftpgroup -d /home/ftpuser -s /sbin/nologin ftpuser è®¾ç½®ç”¨æˆ·å¯†ç ï¼š sudo passwd ftpuser åˆ›å»º FTP æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š sudo mkdir -p /data/ftpsudo chown ftpuser:ftpgroup /data/ftpsudo chmod 755 /data/ftp é™åˆ¶ç”¨æˆ·ä»…èƒ½é€šè¿‡ FTP è®¿é—®ï¼š sudo usermod -s /sbin/nologin ftpuser æœ¬åœ°ç”¨æˆ·é…ç½®ç¤ºä¾‹listen=YESlisten_ipv6=NO# ç¦æ­¢åŒ¿åç™»å½•anonymous_enable=NO# å…è®¸æœ¬åœ°ç”¨æˆ·ä½¿ç”¨ç³»ç»Ÿè´¦å·ç™»å½•local_enable=YES# å…è®¸ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶write_enable=YES# è®¾å®š umaskï¼Œä¿è¯ä¸Šä¼ æ–‡ä»¶æƒé™å®‰å…¨local_umask=022# æŒ‡å®šç”¨æˆ·æ ¹ç›®å½•ï¼ˆå¯é€‰ï¼‰chroot_local_user=YES# å…è®¸ç”¨æˆ·è¿›å…¥è‡ªå·±çš„ home ç›®å½•allow_writeable_chroot=YES# å…è®¸ ASCII ä¼ è¾“ï¼ˆå¯é€‰ï¼‰ascii_upload_enable=YESascii_download_enable=YES# å…è®¸è¢«åŠ¨æ¨¡å¼pasv_enable=YES# æŒ‡å®šè¢«åŠ¨æ¨¡å¼ç«¯å£èŒƒå›´ï¼ˆç¡®ä¿ç«¯å£èŒƒå›´è¾ƒå°ï¼Œæ–¹ä¾¿é˜²ç«å¢™é…ç½®ï¼‰pasv_min_port=9080pasv_max_port=9099","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç½‘ç»œ"]},{"title":"3566ä¸3568ä¸3588ä¹‹é—´çš„å·®å¼‚","path":"/2024/08/15/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-3566ä¸3568ä¸3588ä¹‹é—´çš„å·®å¼‚/","content":"æ¥å£å·®å¼‚ å¤–éƒ¨å­˜å‚¨æ¥å£: RK3568 æ”¯æŒ ECC å†…å­˜ RK3566 ä¸æ”¯æŒ ECC å†…å­˜ PCI-E æ¥å£: RK3568 æ”¯æŒ PCI-E 3.0 RK3566 ä»…æ”¯æŒ PCI-E 2.1 ä»¥å¤ªç½‘æ¥å£: RK3568 é…å¤‡åŒåƒå…†ç½‘å£ RK3566 åªæœ‰å•åƒå…†ç½‘å£ SATA æ¥å£: RK3568 æ”¯æŒ 3 ä¸ª SATA 3.0 æ¥å£ RK3566 ä»…æ”¯æŒ 1 ä¸ª SATA 3.0 æ¥å£ æ˜¾ç¤ºè¾“å‡º: RK3568 æ”¯æŒä¸‰é‡æ˜¾ç¤º RK3566 æ”¯æŒåŒæ˜¾ç¤º æŠ€æœ¯å‚æ•°å·®å¼‚è¡¨ï¼š Processor Rockchip RK3568 Rockchip RK3566 Rockchip RK3588 Market (main) Single-board computer Single-board computer High-performance single-board computer ISA ARMv8.2-A (64-bit) ARMv8.2-A (64-bit) ARMv8.2-A (64-bit) Microarchitecture Cortex-A55 Cortex-A55 Cortex-A76 + Cortex-A55 Family RK3500 RK3500 RK3500 Part number(s), S-Spec RK3568 RK3566 RK3588 Release date Q2 2020 Q2 2020 Q1 2022 Lithography 22 nm 22 nm 8 nm Cores 4 4 8 (4+4) Threads 4 4 8 Base frequency 2.0 GHz 1.8 GHz 2.4 GHz (A76), 1.8 GHz (A55) Turbo frequency - - - High performance cores 4x ARM Cortex-A55 @ 2.0 GHz 4x ARM Cortex-A55 @ 1.8 GHz 4x Cortex-A76 @ 2.4 GHz Cache memory 256 KB 256 KB 1 MB L3 Max memory capacity 8 GB 4 GB 32 GB Memory types LPDDR4-1600 DDR3, DDR3L, LPDDR3, DDR4, LPDDR4X LPDDR4X-3200, LPDDR5-2400 Max PCIe lanes 1 1 4 TDP 5 W 5 W 10-15 W GPU integrated graphics ARM Mali-G52 2EE MC2 ARM Mali-G52 MP2 ARM Mali-G610 MP4 GPU execution units 2 2 4 GPU shading units 32 32 - GPU base clock - 850 MHz 1000 MHz GPU boost clock 820 MHz 950 MHz - GPU FP32 floating point 54.4 GFLOPS 54.4 GFLOPS 614 GFLOPS Socket SoC SoC SoC Drystone MIPS 22,736 DMIPS 20,462 DMIPS - AI accelerator AI accelerator RKNN NPU - NPU AI computing operations per seconds 0.8 TOPS - 6 TOPS Crypto engine Cipher Engine, SHA-1, SHA-256224,SHA-512384, MD5, AES-128, AES-192,AES-256, DES, TDES, TRNG - - Max display resolution 4K@60fps - 8K@60fps Video decoding H.265H.264VP9 4K@60fps - 8K@60fps H.265VP9AVS2, 8K@30fps H.264 AVCMVC Video encoding H.265H.264 1080p@60fps - 8K@30fps H.265H.264 Max video capture MIPI-CSI - - Modem Gigabit Ethernet - 2.5 GbE Connectivity SATA 3.0, eMMC, HDMI 2.0,USB 3.0, USB 2.0 - PCIe 3.0, USB 3.1, HDMI 2.1 Wi-Fi WiFi 6 (802.11ax) - Wi-Fi 6 (802.11ax) Bluetooth Bluetooth 5.0 - Bluetooth 5.2 Audio SPDIF, PWM, SPI, I2S, I2C - - (Android 64-bit)Geekbench 4 single core 875 756 - (Android 64-bit)Geekbench 4 multi-core 2,375 1,997 - (Android)Geekbench 5 single core 161 108 ~800 (Android)Geekbench 5 multi-core 492 281 ~2800 (SGEMM)GFLOPS performance 21.2 GFLOPS 18.2 GFLOPS - (Multi-core watt performance)Performance watt ratio 475 pts W 399 pts W -","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"3568GPUè´Ÿè½½æŸ¥çœ‹åŠå‚æ•°è®¾ç½®","path":"/2024/08/14/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-3568GPUè´Ÿè½½æŸ¥çœ‹åŠå‚æ•°è®¾ç½®/","content":"1.Look up the load@frequency of GPU æŸ¥çœ‹å½“å‰è´Ÿè½½å’Œé¢‘ç‡ cat /sys/class/devfreq/*.gpu/load 2.Look up the supported mode or supported frquency for GPU æŸ¥çœ‹å½“å‰æ”¯æŒçš„æ¨¡å¼å’Œé¢‘ç‡ cat /sys/class/devfreq/*.gpu/available_governorscat /sys/class/devfreq/*.gpu/available_frequencies 3.Set performance(the most high frequency) for GPU è®¾ç½®æ€§èƒ½æ¨¡å¼ echo performance /sys/class/devfreq/*.gpu/governor 4.Set frequency for GPU è®¾ç½®é¢‘ç‡ #è®¾ç½®æ¨¡å¼ä¸ºç”¨æˆ·æ¨¡å¼echo userspace /sys/class/devfreq/*.gpu/governor#æ‰“å°å½“å‰æ”¯æŒçš„é¢‘ç‡cat /sys/class/devfreq/*.gpu/available_frequencies#å°†è¦è®¾ç½®çš„é¢‘ç‡å†™å…¥(ps: you should do step 2 to ensure the available_frequencies before you set) echo 800000000 /sys/class/devfreq/*.gpu/set_freq 5.Get a version è·å–ç‰ˆæœ¬ä¿¡æ¯ strings libMali.so | grep rk_so_ver 6.Set power always on å…³é—­èŠ‚èƒ½æ¨¡å¼ echo always_on /sys/devices/*.gpu/power_policy å¾ªç¯æ‰“å° GPU è´Ÿè½½è„šæœ¬ #!/bin/shwhile [ 1 ]docat /sys/class/devfreq/fde60000.gpu/loadsleep 1done","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"OK4418å¹³å°","path":"/2024/08/13/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-OK4418å¹³å°/","content":"è¿æ¥å¼€å‘æ¿è°ƒè¯•ä¸²å£é€šè¿‡è°ƒè¯•ä¸²å£è¿æ¥å¼€å‘æ¿ï¼Œè°ƒè¯•ä¸²å£ä¸º DB9ï¼Œä¸Šä½æœºç›´æ¥è¿æ¥ï¼Œæ³¢ç‰¹ç‡ä¸º 115200ï¼Œç™»å½•åä¸º root ç½‘å£é€šè¿‡ç½‘å£è¿æ¥ï¼Œé…ç½®ç”µè„‘çš„ IP ä¸º 192.168.1.122ï¼Œå¼€å‘æ¿çš„ IP ä¸º 192.168.1.123ï¼Œé€šè¿‡ ssh è¿æ¥ï¼Œç™»å½•åä¸º root ä¸‹è½½æ–‡ä»¶é€šè¿‡ FileZilla Client è½¯ä»¶ä¸‹è½½æ–‡ä»¶åˆ°å¼€å‘æ¿ä¸Šï¼Œæ–°å»ºè¿æ¥ç«™ç‚¹ï¼Œä¸»æœºåœ°å€ä¸º 192.168.1.123ï¼Œé€šè¿‡ FTP åè®®ï¼Œç«¯å£ä¸º 21ï¼Œä¸åŠ å¯†åªä½¿ç”¨æ™®é€š FTPï¼Œç”¨æˆ·åä¸º rootï¼Œå¯†ç ä¸º forlinxã€‚ è¿æ¥æˆåŠŸåï¼Œå°†æ–‡ä»¶æ‹·è´åˆ°opt ç›®å½•ä¸‹ï¼Œå¦‚æœç›®å½•ä¸‹æœ‰ç›¸åŒåå­—çš„æ–‡ä»¶ï¼Œæœ€å¥½å°†åŸæ–‡ä»¶åˆ é™¤åï¼Œåœ¨æ‹·è´æ–‡ä»¶ã€‚ é…ç½®è‡ªå¯åŠ¨#!/bin/shexport PATH=/bin:/sbin:/usr/bin:/usr/sbinexport T_ROOT=/usr/local/tslibexport LD_LIBRARY_PATH=/usr/local/tslib/lib:$LD_LIBRARY_PATHexport TSLIB_CONSOLEDEVICE=noneexport TSLIB_FBDEVICE=/dev/fb0export TSLIB_TSDEVICE=/dev/input/event1export TSLIB_PLUGINDIR=$T_ROOT/lib/tsexport TSLIB_CONFFILE=$T_ROOT/etc/ts.confexport POINTERCAL_FILE=/etc/pointercalexport TSLIB_CALIBFILE=/etc/pointercalexport QTDIR=/forlinx/qtexport QT_QPA_PLATFORM=eglfsexport LD_LIBRARY_PATH=$QTDIR/lib:$LD_LIBRARY_PATHexport QT_QPA_GENERIC_PLUGINS=tslibexport QT_QPA_PLATFORM_PLUGIN_PATH=$QTDIR/pluginsexport QT_QPA_EGLFS_FB=/dev/fb0export QT_QPA_EGLFS_TSLIB=1export QWS_SIZEexport KEYPAD_DEV=/dev/input/event0export QWS_KEYBOARD=LinuxInput:/dev/input/keyboardexport LD_LIBRARY_PATH=/forlinx/qt/lib/plugins/imageformats:$LD_LIBRARY_PATHexport LD_LIBRARY_PATH=/usr/local/opengl_lib_inc/libs:$LD_LIBRARY_PATHexport QT_PLUGIN_PATH=/forlinx/qt/lib/pluginsexport LD_PRELOAD=/lib/preloadable_libiconv.so#export QT_QPA_EGLFS_DISABLE_INPUT=1export QT_QPA_FONTDIR=$QTDIR/lib/fontsif [ -e /dev/input/event3 ];then export QT_QPA_EVDEV_KEYBOARD_PARAMETERS=/dev/input/event3fiif [ -e /usr/local/bluez5/var/run/dbus/pid ]then rm /usr/local/bluez5/var/run/dbus/pidfiexport DBUS_SESSION_BUS_ADDRESS=unix:path=/usr/local/bluez5/var/run/dbus/system_bus_socketTOUCH=`cat /etc/t2m` /dev/null 21if [ $TOUCH == M ];thenexport QWS_MOUSE_PROTO=Tslib:/dev/input/event1 mouseman:/dev/input/miceelseexport QWS_MOUSE_PROTO=Tslib:/dev/input/event1fi/opt/PCR -qws é…ç½®è„šæœ¬æ–‡ä»¶ï¼Œå¦‚ä¸Šæ‰€ç¤ºï¼Œå°†è¯¥è„šæœ¬æ–‡ä»¶æ‹·è´åˆ°opt ç›®å½•ä¸‹ï¼Œä¿®æ”¹etcinit.dS99app æ³¨é‡Šæ‰forlinxbinapp.sh $ACTTION ï¼Œæœ€åä¸€è¡Œå¢åŠ optStartPCR.sh ä¸­æ–‡æ–‡æœ¬æ”¯æŒé…ç½®è„šæœ¬æ–‡ä»¶ï¼Œå¦‚ä¸Šæ‰€ç¤ºï¼Œå°†è¯¥è„šæœ¬æ–‡ä»¶æ‹·è´åˆ°opt ç›®å½•ä¸‹ï¼Œä¿®æ”¹etcinit.dS99app æ³¨é‡Šæ‰forlinxbinapp.sh $ACTTION ï¼Œæœ€åä¸€è¡Œå¢åŠ optStartPCR.sh","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é‡","path":"/2024/08/09/1-å¹³å°ç³»ç»Ÿ-Linux-æ–‡ä»¶ç³»ç»Ÿ-æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é‡/","content":"æŠ¥é”™ï¼šCanâ€™t open so many files æˆ–è€… too many open files æ¶‰åŠå‚æ•° å‚æ•° è¯´æ˜ é»˜è®¤å€¼ æŸ¥è¯¢è¯­å¥ nofile å•ä¸ªè¿›ç¨‹çš„æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•° 1024 ulimit -n æˆ–è€… cat procpidlimits nr_open å•ä¸ªè¿›ç¨‹å¯åˆ†é…çš„æœ€å¤§æ–‡ä»¶æ•° 1024*10241048576 cat procsysfsnr_open file-max ç³»ç»Ÿå†…æ ¸ä¸€å…±å¯ä»¥æ‰“å¼€çš„æœ€å¤§å€¼ 199708 cat procsysfsfile-max nofile æ˜¯ linux æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„æ•°é‡çš„é™åˆ¶ï¼ˆä¹ŸåŒ…å«æ‰“å¼€çš„å¥—æ¥å­—æ•°é‡ï¼‰ file-max æ˜¯è®¾ç½®ç³»ç»Ÿæ‰€æœ‰è¿›ç¨‹ä¸€å…±å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æ•°é‡ ã€‚åŒæ—¶ä¸€äº›ç¨‹åºå¯ä»¥é€šè¿‡ setrlimit è°ƒç”¨ï¼Œè®¾ç½®æ¯ä¸ªè¿›ç¨‹çš„é™åˆ¶ã€‚ nofileä¸´æ—¶ä¿®æ”¹ulimit -SHn 1024000 åˆ†è½¯é™åˆ¶å’Œç¡¬é™åˆ¶ï¼ŒåŠ -H å°±æ˜¯ç¡¬é™åˆ¶ï¼ŒåŠ -S å°±æ˜¯è½¯é™åˆ¶ã€‚é»˜è®¤æ˜¾ç¤ºçš„æ˜¯è½¯é™åˆ¶ï¼Œå¦‚æœè¿è¡Œ ulimit å‘½ä»¤ä¿®æ”¹æ—¶æ²¡æœ‰åŠ ä¸Š-H æˆ–-Sï¼Œå°±æ˜¯ä¸¤ä¸ªå‚æ•°ä¸€èµ·æ”¹å˜ã€‚ ç¡¬é™åˆ¶å°±æ˜¯å®é™…çš„é™åˆ¶ï¼Œè€Œè½¯é™åˆ¶æ˜¯è­¦å‘Šé™åˆ¶ï¼Œå®ƒåªä¼šç»™å‡ºè­¦å‘Šã€‚ æ°¸ä¹…ä¿®æ”¹ä¸€vi /etc/security/limits.conf * è¡¨ç¤ºæ‰€ç”¨çš„ç”¨æˆ· äºŒä¿®æ”¹ /etc/profile å¢åŠ  ulimit -SHn 128000 etcprofile æ˜¯ Linux ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦é…ç½®æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºè®¾ç½®ç³»ç»Ÿçº§çš„ç¯å¢ƒå˜é‡å’Œå¯åŠ¨ç¨‹åºã€‚è¯¥æ–‡ä»¶åœ¨ç”¨æˆ·ç™»å½•æ—¶è¢«æ‰§è¡Œï¼Œé€‚ç”¨äºæ‰€æœ‰ç”¨æˆ·ã€‚ ç³»ç»Ÿæ€»é™åˆ¶ä¸´æ—¶ä¿®æ”¹echo 1200000 /proc/sys/fs/nr_openecho 200000 /proc/sys/fs/file-max æ°¸ä¹…ä¿®æ”¹ä¸€åœ¨æ–‡ä»¶procsysfsnr_open ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼šï¼ˆ1200000 ä¸ºä¿®æ”¹çš„å‚æ•°å€¼ï¼‰ fs.nr_open=1200000 åœ¨æ–‡ä»¶ procsysfsfile-max ä¸­æ’å…¥å¦‚ä¸‹ä»£ç ï¼š fs.file-max=200000 ä¿å­˜å¹¶æ‰§è¡Œ reboot é‡å¯æœåŠ¡å™¨ã€‚ äºŒåœ¨etcsysctl.conf ä¸­è®¾ç½® fs.nr_open 1200000 fs.file-max200000ï¼Œç„¶åæ‰§è¡Œ sysctl -pï¼Œä½¿é…ç½®ç”Ÿæ•ˆã€‚æ— éœ€é‡å¯ã€‚ æŸ¥çœ‹ç³»ç»Ÿä¸‹å„ä¸ªè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡lsof -n |awk print $2|sort|uniq -c |sort -nr #åŒ¹é…PIDä¸º696çš„è¿›ç¨‹lsof -fp | grep 696 | wc -l","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","æ–‡ä»¶ç³»ç»Ÿ"]},{"title":"Yoctoç¬”è®°","path":"/2024/08/08/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-Yoctoç¬”è®°/","content":"ä»€ä¹ˆæ˜¯ YoctoYocto Project æ˜¯ä¸€ä¸ªå¼€æºåä½œé¡¹ç›®ï¼Œä¸»è¦ç”¨äºä¸ºåµŒå…¥å¼ç³»ç»Ÿå¼€å‘è‡ªå®šä¹‰çš„ Linux æ“ä½œç³»ç»Ÿã€‚å®ƒæä¾›äº†ä¸€æ•´å¥—å·¥å…·å’Œæ¨¡æ¿ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥åœ¨å¤šç§ç¡¬ä»¶æ¶æ„ä¸Šæ„å»ºåŠŸèƒ½é½å…¨ã€è½»é‡çº§ä¸”å®šåˆ¶åŒ–çš„åµŒå…¥å¼ Linux å‘è¡Œç‰ˆã€‚ Yocto ä¸ä»…ä»…æ˜¯ä¸€ä¸ª Linux å‘è¡Œç‰ˆï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ªæ„å»ºç³»ç»Ÿï¼Œå¸®åŠ©ä»æºä»£ç ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ Linux ç³»ç»Ÿï¼ŒåŒ…æ‹¬å†…æ ¸ã€æ ¹æ–‡ä»¶ç³»ç»Ÿã€å·¥å…·é“¾å’Œåº”ç”¨ç¨‹åºã€‚Yocto é¡¹ç›®é€šè¿‡ BitBake æ„å»ºç³»ç»Ÿå’Œ OpenEmbedded æ ¸å¿ƒæ¥å®ç°è¿™ä¸€åˆ‡ã€‚ Yocto çš„åŸºæœ¬æ¦‚å¿µ BitBake: Yocto æ„å»ºç³»ç»Ÿçš„æ ¸å¿ƒå·¥å…·ï¼Œç±»ä¼¼äº GNU Makeï¼Œä½†åŠŸèƒ½æ›´å¼ºå¤§ã€‚å®ƒä½¿ç”¨ .bbã€.bbclass å’Œ .conf æ–‡ä»¶å®šä¹‰æ„å»ºä»»åŠ¡ã€å…ƒæ•°æ®å’Œé…ç½®ã€‚ Layer (å±‚): Yocto é¡¹ç›®ä¸­çš„å±‚æ˜¯ä¸€ç»„å…ƒæ•°æ®æ–‡ä»¶ï¼Œç”¨äºç»„ç»‡å’Œç®¡ç†æ„å»ºé…ç½®ã€‚å¸¸è§çš„å±‚åŒ…æ‹¬ meta å±‚ï¼ˆæ ¸å¿ƒï¼‰ã€meta-oeï¼ˆOpenEmbedded æ‰©å±•å±‚ï¼‰å’Œ meta-raspberrypiï¼ˆæ ‘è“æ´¾æ”¯æŒå±‚ï¼‰ã€‚ Recipe (é…æ–¹): é…æ–¹æ˜¯ Yocto ä¸­çš„åŸºæœ¬æ„å»ºå•å…ƒï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•è·å–æºä»£ç ã€åº”ç”¨è¡¥ä¸ã€ç¼–è¯‘å’Œå®‰è£…è½¯ä»¶åŒ…ã€‚é…æ–¹æ–‡ä»¶é€šå¸¸ä»¥ .bb ç»“å°¾ã€‚ Machine (æœºå™¨): Yocto ä¸ºä¸åŒç¡¬ä»¶æ¶æ„å’Œå¼€å‘æ¿å®šä¹‰äº† machine é…ç½®ï¼Œè¿™äº›é…ç½®å†³å®šäº†ç›®æ ‡ç¡¬ä»¶çš„å…·ä½“æ„å»ºé€‰é¡¹ã€‚ Distro (å‘è¡Œç‰ˆ): Yocto çš„å‘è¡Œç‰ˆé…ç½®å®šä¹‰äº†ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒéƒ¨åˆ†ï¼ŒåŒ…æ‹¬ä½¿ç”¨çš„åŒ…ç®¡ç†å™¨ã€C åº“ä»¥åŠå…¶ä»–ç³»ç»Ÿçº§é…ç½®ã€‚ Image (é•œåƒ): é•œåƒæ˜¯é€šè¿‡ Yocto æ„å»ºå‡ºçš„æœ€ç»ˆäº§å“ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯ä»¥ç›´æ¥åœ¨ç›®æ ‡ç¡¬ä»¶ä¸Šè¿è¡Œçš„æ–‡ä»¶ç³»ç»Ÿå’Œå†…æ ¸ã€‚ Yocto å¦‚ä½•ä½¿ç”¨1. å®‰è£… Yocto ç¯å¢ƒè¦ä½¿ç”¨ Yoctoï¼Œé¦–å…ˆéœ€è¦å®‰è£…æ„å»ºç¯å¢ƒï¼ŒåŒ…æ‹¬ä¸€äº›åŸºæœ¬çš„å¼€å‘å·¥å…·å’Œ Gitã€‚ sudo apt-get install gawk wget git-core diffstat unzip texinfo gcc-multilib build-essential chrpath socat libsdl1.2-dev xterm 2. è·å– Yocto æºä»£ç éœ€è¦ä» GitHub æˆ– Yocto å®˜æ–¹ä»“åº“ä¸­å…‹éš† Yocto é¡¹ç›®çš„æºä»£ç ã€‚ä»¥ä¸‹æ˜¯å…‹éš†ä¸€ä¸ªå¸¸ç”¨çš„ Yocto ç‰ˆæœ¬åˆ†æ”¯çš„ç¤ºä¾‹ï¼š git clone -b kirkstone git://git.yoctoproject.org/poky.gitcd poky 3. åˆå§‹åŒ–æ„å»ºç¯å¢ƒåœ¨ Yocto ä¸­ï¼Œoe-init-build-env è„šæœ¬ç”¨äºåˆå§‹åŒ–æ„å»ºç¯å¢ƒï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ„å»ºç›®å½•ã€‚ source oe-init-build-env è¿™ä¸ªå‘½ä»¤ä¼šåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ build ç›®å½•ï¼Œå¹¶å°†åˆ‡æ¢åˆ°è¯¥ç›®å½•ä¸­ã€‚æ‰€æœ‰çš„æ„å»ºè¾“å‡ºéƒ½å°†åœ¨è¿™ä¸ª build ç›®å½•ä¸­ç”Ÿæˆã€‚ 4. é…ç½®æ„å»ºé€‰é¡¹åœ¨ build ç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡ç¼–è¾‘ conf/local.conf æ–‡ä»¶æ¥é…ç½®æ„å»ºé€‰é¡¹ï¼Œä¾‹å¦‚ç›®æ ‡æœºå™¨ï¼ˆMACHINEï¼‰ã€å¹¶è¡Œæ„å»ºçº¿ç¨‹ï¼ˆBB_NUMBER_THREADSï¼‰å’Œ DL_DIRï¼ˆæºç ä¸‹è½½ç›®å½•ï¼‰ç­‰ã€‚ ç¤ºä¾‹é…ç½®ï¼š MACHINE ?= qemuarm å¦‚æœè¦ä¸º Raspberry Pi æ„å»ºç³»ç»Ÿï¼Œå¯ä»¥ä¿®æ”¹ä¸ºï¼š MACHINE ?= raspberrypi4 5. æ·»åŠ å±‚å¯ä»¥é€šè¿‡ bitbake-layers å·¥å…·æ¥ç®¡ç† Yocto çš„å±‚ã€‚ä¾‹å¦‚ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„å±‚ï¼š bitbake-layers add-layer ../meta-openembedded/meta-oe è¿™ä¸ªå‘½ä»¤å°† meta-oe å±‚æ·»åŠ åˆ°æ„å»ºç¯å¢ƒä¸­ã€‚ 6. æ„å»ºé•œåƒé…ç½®å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ bitbake å‘½ä»¤å¼€å§‹æ„å»ºç³»ç»Ÿé•œåƒã€‚å¸¸è§çš„æ„å»ºç›®æ ‡åŒ…æ‹¬ core-image-minimalã€core-image-sato ç­‰ã€‚ bitbake core-image-minimal æ„å»ºè¿‡ç¨‹å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œè¿™å–å†³äºçš„è®¡ç®—èµ„æºå’Œç½‘ç»œé€Ÿåº¦ã€‚ 7. éƒ¨ç½²é•œåƒæ„å»ºå®Œæˆåï¼Œç”Ÿæˆçš„é•œåƒæ–‡ä»¶ä¼šå­˜æ”¾åœ¨ build/tmp/deploy/images/ ç›®å½•ä¸‹ã€‚å¯ä»¥å°†è¿™äº›æ–‡ä»¶çƒ§å½•åˆ°ç›®æ ‡ç¡¬ä»¶ä¸­ï¼Œä¾‹å¦‚ SD å¡ï¼Œæˆ–ç›´æ¥åœ¨ QEMU ä¸­è¿›è¡Œæ¨¡æ‹Ÿæµ‹è¯•ã€‚ Yocto çš„å¸¸ç”¨å·¥å…· BitBake: ç”¨äºæ‰§è¡Œæ„å»ºä»»åŠ¡çš„æ ¸å¿ƒå·¥å…·ã€‚å°†ä¸»è¦ä½¿ç”¨å®ƒæ¥ç¼–è¯‘é…æ–¹å¹¶ç”Ÿæˆé•œåƒã€‚ devtool: ä¸€ä¸ªç”¨äºå¼€å‘è€…çš„å·¥å…·é›†ï¼Œç®€åŒ–äº† Yocto é¡¹ç›®çš„æ‰©å±•å’Œä¿®æ”¹ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ–°çš„é…æ–¹æˆ–ä¿®æ”¹ç°æœ‰é…æ–¹ã€‚ bitbake-layers: ç”¨äºç®¡ç†å’Œæ“ä½œ Yocto å±‚çš„å·¥å…·ã€‚å®ƒå¯ä»¥æ·»åŠ ã€åˆ é™¤æˆ–åˆ—å‡ºå±‚ã€‚ hoban: ç”¨äºæŸ¥çœ‹å’Œåˆ†æ Yocto é¡¹ç›®ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œé•œåƒå†…å®¹çš„å·¥å…·ã€‚ Toaster: Yocto æä¾›çš„ä¸€ä¸ªåŸºäº Web çš„å›¾å½¢ç•Œé¢å·¥å…·ï¼Œå¸®åŠ©ç”¨æˆ·ç®¡ç†æ„å»ºé¡¹ç›®å¹¶åˆ†æç»“æœã€‚ menuconfignconfig: ç”¨äºé…ç½® Linux å†…æ ¸çš„å·¥å…·ï¼Œå®ƒä»¬å…è®¸åœ¨å›¾å½¢ç•Œé¢ä¸­é€‰æ‹©å†…æ ¸é€‰é¡¹ã€‚ é€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨ Yocto ä¸­æ·»åŠ  Mesa çš„ OpenGL é©±åŠ¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®è·µã€‚è¿™ä¸ªè¿‡ç¨‹å°†æ¶µç›–å¦‚ä½•é…ç½® Yocto ç¯å¢ƒã€ä¿®æ”¹é…ç½®æ–‡ä»¶ã€æ·»åŠ æ‰€éœ€çš„è½¯ä»¶åŒ…ï¼ˆå¦‚ Mesa é©±åŠ¨ï¼‰ï¼Œå¹¶æ„å»ºåŒ…å« OpenGL æ”¯æŒçš„ Linux é•œåƒã€‚ä»¥ä¸€ä¸ªåŸºäº Raspberry Pi 4 çš„é¡¹ç›®ä¸ºä¾‹ã€‚ å®ä¾‹ç›®æ ‡ç›®æ ‡æ˜¯ä½¿ç”¨ Yocto æ„å»ºä¸€ä¸ªä¸º Raspberry Pi 4 å®šåˆ¶çš„ Linux é•œåƒï¼Œå¹¶åœ¨å†…æ ¸ä¸­å¢åŠ  Mesa çš„ OpenGL é©±åŠ¨ã€‚ 1. è®¾ç½® Yocto ç¯å¢ƒ1.1 å…‹éš† Yocto Poky ä»“åº“é¦–å…ˆï¼Œä» Yocto çš„å®˜æ–¹ Git ä»“åº“å…‹éš† Pokyï¼Œè¿™åŒ…å« Yocto çš„æ ¸å¿ƒæ„å»ºå·¥å…·å’ŒåŸºç¡€å±‚ã€‚ git clone -b kirkstone git://git.yoctoproject.org/poky.gitcd poky 1.2 è·å– Raspberry Pi å±‚æ¥ä¸‹æ¥ï¼Œå…‹éš† Raspberry Pi æ”¯æŒçš„å…ƒæ•°æ®å±‚ meta-raspberrypiã€‚ git clone -b kirkstone git://git.yoctoproject.org/meta-raspberrypi.git 1.3 åˆå§‹åŒ–æ„å»ºç¯å¢ƒä½¿ç”¨ Yocto æä¾›çš„è„šæœ¬åˆå§‹åŒ–æ„å»ºç¯å¢ƒï¼Œè¿™å°†åˆ›å»ºä¸€ä¸ª build ç›®å½•ã€‚ source oe-init-build-env 1.4 æ·»åŠ å±‚åˆ°æ„å»ºç¯å¢ƒåœ¨ build ç›®å½•ä¸­ï¼Œé€šè¿‡ bitbake-layers å‘½ä»¤æ·»åŠ  meta-raspberrypi å’Œ meta-openembeddedï¼ˆåŒ…å« Mesa çš„ç›¸å…³è½¯ä»¶åŒ…ï¼‰ã€‚ bitbake-layers add-layer ../meta-raspberrypibitbake-layers add-layer ../meta-openembedded/meta-oebitbake-layers add-layer ../meta-openembedded/meta-multimedia æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°çš„å±‚ï¼Œåˆ›å»ºæ–°å±‚åéœ€è¦åœ¨æ–°å±‚ä¸­åˆ›å»º Mesa é…æ–¹æ–‡ä»¶(mesa_%.bbappend) bitbake-layers create-layer meta-opengl PACKAGECONFIG_append = gallium-llvm gallium egl gles gbm driGALLIUMDRIVERS_append = ,swrastDRIDRIVERS_append = ,swrast 2. é…ç½®æ„å»ºé€‰é¡¹2.1 é…ç½® local.confç¼–è¾‘ conf/local.conf æ–‡ä»¶ï¼Œè®¾ç½®ç›®æ ‡æœºå™¨ä¸º Raspberry Pi 4ï¼Œå¹¶å¯ç”¨ OpenGL æ”¯æŒã€‚ MACHINE ?= raspberrypi4 ç¡®ä¿å¯ç”¨ GL å’Œ X11 æ”¯æŒï¼Œä»¥ä¾¿ Mesa çš„ OpenGL é©±åŠ¨èƒ½å¤Ÿæ­£ç¡®æ„å»ºï¼š DISTRO_FEATURES_append = opengl x11 å¦‚æœæ˜¯æ–°å±‚åˆ™éœ€è¦æ·»åŠ  BBLAYERS += $TOPDIR/../meta-opengl 2.2 æ·»åŠ  Mesa è½¯ä»¶åŒ…åœ¨ local.conf ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹è¡Œä»¥ç¡®ä¿ Mesa å’Œç›¸å…³é©±åŠ¨ç¨‹åºè¢«åŒ…å«åœ¨æ„å»ºä¸­ï¼š IMAGE_INSTALL_append = mesa mesa-gl mesa-demos mesa: ä¸» Mesa åŒ…ï¼Œæä¾› OpenGL å®ç°ã€‚ mesa-gl: æä¾› OpenGL åº“ã€‚ mesa-demos: åŒ…å«ä¸€äº› OpenGL çš„æ¼”ç¤ºç¨‹åºï¼Œæ–¹ä¾¿æµ‹è¯•ã€‚ 3. æ„å»ºé•œåƒä½¿ç”¨ bitbake å‘½ä»¤æ„å»ºåŒ…å« Mesa OpenGL é©±åŠ¨çš„ç³»ç»Ÿé•œåƒã€‚ bitbake core-image-sato è¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå› ä¸º Yocto ä¼šä»æºä»£ç ç¼–è¯‘æ‰€æœ‰éœ€è¦çš„ç»„ä»¶ï¼ŒåŒ…æ‹¬ Mesa é©±åŠ¨ç¨‹åºã€‚ 4. éƒ¨ç½²å’Œæµ‹è¯•4.1 éƒ¨ç½²é•œåƒæ„å»ºå®Œæˆåï¼Œç”Ÿæˆçš„é•œåƒæ–‡ä»¶ä¼šå­˜æ”¾åœ¨ build/tmp/deploy/images/raspberrypi4/ ç›®å½•ä¸‹ã€‚å¯ä»¥ä½¿ç”¨ dd å‘½ä»¤å°†é•œåƒçƒ§å½•åˆ° SD å¡ä¸Šã€‚ sudo dd if=core-image-sato-raspberrypi4.rpi-sdimg of=/dev/sdX bs=4Msync å°† SD å¡æ’å…¥ Raspberry Pi 4ï¼Œç„¶åå¯åŠ¨è®¾å¤‡ã€‚ 4.2 æµ‹è¯• OpenGLå¯åŠ¨ Raspberry Pi åï¼Œé€šè¿‡ SSH æˆ–ç›´æ¥åœ¨è®¾å¤‡ä¸Šæ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œ Mesa çš„ glxinfo å·¥å…·ä»¥éªŒè¯ OpenGL é©±åŠ¨æ˜¯å¦æ­£ç¡®å®‰è£…ã€‚ glxinfo | grep OpenGL åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°ä¸ Mesa å’Œ OpenGL ç›¸å…³çš„è¾“å‡ºä¿¡æ¯ï¼Œè¡¨æ˜ OpenGL é©±åŠ¨å·²æ­£ç¡®åŠ è½½ã€‚ æ­¤å¤–ï¼Œå¯ä»¥è¿è¡Œ glxgearsï¼ˆMesa çš„æ¼”ç¤ºç¨‹åºä¹‹ä¸€ï¼‰æ¥æµ‹è¯• OpenGL çš„åŸºæœ¬åŠŸèƒ½ã€‚ glxgears yocto SDK ç›®å½•ç»“æ„ â”œâ”€â”€ build // ç”¨æˆ·é…ç½®æ–‡ä»¶å’Œå·¥ç¨‹æ„å»ºè¾“å‡ºç›®å½•â”œâ”€â”€ confâ”œâ”€â”€ meta-browser // Webæµè§ˆå™¨é…æ–¹â”œâ”€â”€ meta-clang // ç”¨æ¥æ„æ¶ç¼–è¯‘å™¨çš„LLVMæ¡†æ¶ç³»ç»Ÿâ”œâ”€â”€ meta-openembedded // ç”¨æ¥äº¤å‰ç¼–è¯‘ï¼Œå®‰è£…å’Œæ‰“åŒ…çš„å…ƒæ•°æ®â”œâ”€â”€ meta-poky - poky/meta-poky // Pokyå‘è¡Œç‰ˆæœ¬çš„é…ç½®æ•°æ®â”œâ”€â”€ meta-python2 // Python2é…æ–¹â”œâ”€â”€ meta-qt5 // Qt5å®˜æ–¹æ¨å‡ºçš„Qt5é…æ–¹â”œâ”€â”€ meta-rockchip // Rockchipå±‚ï¼ŒåŒ…å«RockchipèŠ¯ç‰‡BSPç›¸å…³é…æ–¹â”œâ”€â”€ meta-rust // Rustä¸Cargoçš„OpenEmbedded/Yoctoå±‚â””â”€â”€ poky // ç”¨æ¥æ„å»ºLinuxçš„æ„å»ºç³»ç»Ÿ Yocto çš„å·¥ç¨‹å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œä»…ä»…åªç”±è¿™å‡ ä¸ªæ–‡ä»¶å¤¹æ„æˆã€‚yocto ç”±è®¸è®¸å¤šå¤šçš„é…æ–¹æ„æˆï¼Œå®ƒé€šè¿‡é…æ–¹è·å–è½¯ä»¶æºç ç¼–è¯‘ä¸‹è½½æ„å»ºå¹¶è§£å†³ä¾èµ–ï¼Œæ­£å› ä¸ºå¦‚æ­¤ï¼Œä¹Ÿé€ å°±äº† yocto ä¸å¦‚ buildroot å®¹æ˜“å…¥é—¨çš„ç°çŠ¶ï¼Œå·¥ç¨‹è™½å°ï¼Œä½†æ˜¯ç¼–è¯‘çš„è¿‡ç¨‹ä¸­éœ€è¦æ¶ˆè€—æ¯”è¾ƒå¤§çš„ç©ºé—´ã€‚ buid ç›®å½•ä¸‹å­˜æ”¾ç€ï¼Œå½“å‰ SDK å­˜åœ¨çš„æ‰€æœ‰æ„å»ºæ–¹æ¡ˆï¼Œå¯ä»¥çœ‹åˆ°åœ¨ rockchip å¹³å°ï¼Œè¯¥ SDK å½“å‰æ”¯æŒçš„æ„å»ºå¹³å°ï¼Œå…¶ä¸­ï¼Œæ‰€æœ‰çš„æ–¹æ¡ˆå‡ä»¥ local.conf æ–‡ä»¶æ‰€è®¾ç½®çš„ä¿¡æ¯ä¸ºå‡†ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªæ–¹æ¡ˆï¼Œå¯ä»¥åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹å¤šä¸ªæ–¹æ¡ˆæ–‡ä»¶å¤¹ï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹ä¸‹å‡è¿˜æœ‰è‡ªå·±çš„æ–¹æ¡ˆå¯¹åº”çš„ conflocal.conf ä¿¡æ¯æ–‡ä»¶ã€‚ åœ¨å½“å‰ SDK å¹³å°ä¸­ï¼Œæ²¡æœ‰è¿™æ ·åšï¼Œæ‰€ä»¥é€‰æ‹©æ–¹æ¡ˆéœ€è¦ä½¿ç”¨ ln -sf **** local.conf æ–‡ä»¶æ¥è¿›è¡Œæ–¹æ¡ˆçš„é€‰æ‹©ã€‚ é€‰æ‹©å¥½æ–¹æ¡ˆä¹‹åï¼Œç›®å‰é€‰æ‹©çš„æ–¹æ¡ˆæ˜¯è¿™æ ·çš„ï¼š lrwxrwxrwx 1 jie jie 23 Aug 24 20:46 local.conf - rk356xroc-rk3568-pc.mk é€‰æ‹©å¥½ä¹‹åï¼Œå¼€å§‹æ„å»º source oe-init-build-envbitbake core-image-minimal ä½¿ç”¨æ„å»ºå‚æ•°æ„å»ºå‡ºæ¥çš„ yocto ç³»ç»Ÿä»…ä»…åªæ˜¯ä¸€ä¸ªèƒ½è®©è®¾å¤‡å¯åŠ¨çš„å°é•œåƒï¼Œæ²¡æœ‰å¯åŠ¨ç•Œé¢ã€‚ä»–çš„é…ç½®æ–‡ä»¶æ”¾åœ¨ï¼š meta-openembedded/meta-xfce/recipes-core/images/core-image-minimal-xfce.bb å¯ä»¥æŸ¥çœ‹ï¼šmeta-rockchip/README.md å¯ä»¥çœ‹åˆ° rockchip å¯¹è‡ªå·±å‘½ä»¤çš„æ”¯æŒã€‚ ç®€å•åˆ—ä¸¾ä¸€ä¸‹æ”¯æŒçš„å…¶ä»–å‘½ä»¤ï¼š core-image-minimal : ä¸€ä¸ªèƒ½å¤Ÿè®©è®¾å¤‡å¯åŠ¨çš„å°é•œåƒï¼Œå®ƒæ— ç•Œé¢ core-image-sato : ä¸€ä¸ªæ”¯æŒ Sato çš„é•œåƒï¼Œå®ƒæ”¯æŒå¸¦æœ‰ Sato ä¸»é¢˜å’Œ Pimlico åº”ç”¨ç¨‹åºçš„ X11ï¼Œè¿˜åŒ…å«ç»ˆç«¯ã€ç¼–è¾‘å™¨å’Œæ–‡ä»¶ç®¡ç†å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäº GNOME Mobile çš„ç”¨æˆ·ç•Œé¢ç¯å¢ƒï¼Œä½¿ç”¨ matchbox ä½œä¸ºçª—å£ç®¡ç†å™¨ meta-toolchainï¼šä¸€ä¸ªå¯ç¼–è¯‘å‡º gcc äº¤å‰å·¥å…·é“¾å®‰è£…ç¨‹åºçš„é€‰é¡¹ï¼Œç”Ÿæˆçš„æ–‡ä»¶ä½äºç›®å½•pathtoyoctobuildtmpdeploysdkï¼Œä¸»è¦è¾“å‡ºæ–‡ä»¶ä¸º.sh å®‰è£…æ–‡ä»¶ meta-ide-supportï¼šä¸€ä¸ªç”¨äºç¡®ä¿ç›®å½•pathtoyoctobuild åŒ…å«æœ‰ IDE å·¥å…·é“¾åŒ…çš„é€‰é¡¹ï¼Œç”Ÿæˆçš„æ–‡ä»¶ä¸º environment-setup-xxxxxx-neon-poky-linux-gnueabiï¼Œä½äºç›®å½•pathtoyoctobuildtmpï¼Œç›´æ¥ç”¨ soucre å‘½ä»¤è¿è¡Œå³å¯ æ›´è¯¦ç»†çš„å¯ä»¥æŸ¥çœ‹ yocto çš„é…ç½®æ–‡æ¡£ï¼š https://www.yoctoproject.org/docs/1.1/poky-ref-manual/poky-ref-manual.html#ref-images yocto ä¸­ç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶ï¼š åœ¨ build ä¸­ï¼š â”œâ”€â”€ abi_versionâ”œâ”€â”€ buildstatsâ”œâ”€â”€ cacheâ”œâ”€â”€ deploy //ç”Ÿæˆçš„é•œåƒæ–‡ä»¶â”œâ”€â”€ hosttools //æ„å»ºå·¥å…·ï¼Œå½“ç„¶è¿˜æ²¡æœ‰ç”Ÿæˆâ”œâ”€â”€ log //è¿‡ç¨‹çš„logâ”œâ”€â”€ pkgdata â”œâ”€â”€ qa.logâ”œâ”€â”€ saved_tmpdirâ”œâ”€â”€ sstate-controlâ”œâ”€â”€ stampsâ”œâ”€â”€ sysroots //ç”Ÿæˆçš„äº§å“æ ¹æ–‡ä»¶ç³»ç»Ÿâ”œâ”€â”€ sysroots-componentsâ”œâ”€â”€ sysroots-uninativeâ”œâ”€â”€ uboot_img_prefix.tmpâ”œâ”€â”€ work //ç¼–è¯‘è¿‡ç¨‹ä¸­ç”Ÿæˆçš„æ–‡ä»¶ ç¬¬ä¸‰æ–¹è½¯ä»¶åŒ…å°±æ”¾åœ¨è¿™é‡Œâ””â”€â”€ work-shared //ç¼–è¯‘è¿‡ç¨‹ä¸­çš„æºæ–‡ä»¶ä¾èµ– kernel å°±æ”¾åœ¨è¿™é‡Œ åœ¨ build æ–‡ä»¶å¤¹ä¸­å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¿«æ·ç¼–è¯‘ç›¸å…³çš„å·¥å…·ï¼š ç¼–è¯‘ ubot bitbake virtual/bootloader ç¼–è¯‘ kernel bitbake virtual/kernel ç¼–è¯‘å·¥å…·æˆ–è€…è½¯ä»¶åŒ… bitbake xxxxxx // xxxxxä¸ºé…æ–¹ bb æ–‡ä»¶ä¹‹å‰çš„éƒ¨åˆ† å…·ä½“å¯ä»¥ä½¿ç”¨ bitbake s æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­éƒ½æ”¯æŒæ„å»ºå“ªäº›åŒ… å¦‚æœæ²¡æœ‰è‡ªå·±æƒ³è¦çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥åœ¨ yacto å®˜ç½‘ä¸Šä¸‹è½½è‡ªå·±éœ€è¦çš„é…æ–¹ï¼Œæ·»åŠ è¿› yacto ä¸­ï¼Œå†æ¬¡æŸ¥çœ‹æ˜¯å¦æ·»åŠ è¿›æ¥ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"åµŒå…¥å¼Qtçš„çª—å£ç³»ç»Ÿ","path":"/2024/08/07/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-åµŒå…¥å¼Qtçš„çª—å£ç³»ç»Ÿ/","content":"è‡ªä» Qt 5.0 å‘å¸ƒä»¥æ¥ï¼ŒQt ä¸å†åŒ…å«è‡ªå·±çš„çª—å£ç³»ç»Ÿï¼ˆQWSï¼‰å®ç°ã€‚å¯¹äºå•è¿›ç¨‹ç”¨ä¾‹ï¼ŒQt å¹³å°æŠ½è±¡æ˜¯ä¸€ä¸ªä¼˜ç§€çš„è§£å†³æ–¹æ¡ˆã€‚Wayland å¯ä»¥æ”¯æŒå¤šç§å›¾å½¢åŒ–æµç¨‹ã€‚ æœ‰å¤šä¸ªå¹³å°æ’ä»¶åœ¨åµŒå…¥å¼ Linux ç³»ç»Ÿä¸Šå¯ç”¨ï¼šEGLFSï¼ŒLinuxFBï¼ŒDirectFBï¼ŒWaylandã€‚è¿™äº›å¯ç”¨æ€§å–å†³äº Qt çš„é…ç½®ã€‚åœ¨è®¸å¤šå¼€å‘æ¿ä¸Šé€‰æ‹© eglfs ä½œä¸ºé»˜è®¤é€‰é¡¹ã€‚å¦‚æœé»˜è®¤å€¼ä¸åˆé€‚ï¼ŒQT_QPA_PLATFORM åˆ™å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡å‚æ•°æ¥è¯·æ±‚å¦ä¸€ä¸ªæ’ä»¶ã€‚æˆ–è€…ï¼Œå¯¹äºå¿«é€Ÿæµ‹è¯•ï¼Œ-platform å‘½ä»¤è¡Œå¯ä»¥ä½¿ç”¨ç›¸åŒçš„è¯­æ³•ã€‚ é…ç½®ç‰¹å®šè®¾å¤‡å¯¹äºç»™å®šçš„è®¾å¤‡æ„å»º Qt éœ€è¦ä¸€ä¸ªå·¥å…·é“¾å’Œä¸€ä¸ª sysrootã€‚å¦å¤–ï¼Œä¸€äº›è®¾å¤‡éœ€è¦é’ˆå¯¹ EGL å’Œ OpenGL ES 2.0 æ”¯æŒçš„ä¾›åº”å•†ç‰¹å®šçš„é€‚é…ä»£ç ã€‚è¿™ä¸éåŠ é€Ÿå¹³å°æ— å…³ï¼Œä¾‹å¦‚ä½¿ç”¨ LinuxFB æ’ä»¶çš„å¹³å°ï¼Œä»…ç”¨äºåŸºäºè½¯ä»¶çš„æ¸²æŸ“ã€‚ ç›®å½• qtbase mkspecs devices åŒ…å«è®¸å¤šè®¾å¤‡çš„é…ç½®å’Œå›¾å½¢é€‚é…ä»£ç ã€‚ä¾‹å¦‚ï¼Œlinux-rasp-pi2-g++mkspec åŒ…å«æ„å»ºè®¾ç½®ï¼Œå¦‚ Raspberry Pi 2 è®¾å¤‡çš„æœ€ä½³ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨æ ‡å¿—ã€‚mkspec è¿˜åŒ…å«æœ‰å…³ eglfs é’©å­çš„å®ç°ï¼ˆä¾›åº”å•†ç‰¹å®šçš„é€‚é…ä»£ç ï¼‰çš„ä¿¡æ¯ï¼Œæˆ–è€…æ˜¯å¯¹é€‚åˆçš„ eglfs è®¾å¤‡é›†æˆæ’ä»¶çš„å¼•ç”¨ã€‚é€šè¿‡é…ç½®å·¥å…·çš„-device å‚æ•°é€‰æ‹©è®¾å¤‡ã€‚åœ¨æ­¤å‚æ•°ä¹‹åçš„åç§°å¿…é¡»è‡³å°‘éƒ¨åˆ†åœ°åŒ¹é…è®¾å¤‡ä¸‹çš„ä¸€ä¸ªå­ç›®å½•ã€‚ ä»¥ä¸‹æ˜¯ Raspberry Pi 2 çš„ç¤ºä¾‹é…ç½®ã€‚å¯¹äºå¤§å¤šæ•°åµŒå…¥å¼ Linux æ¿ï¼Œconfigure å‘½ä»¤å¦‚ä¸‹ï¼š ./configure -release -opengl es2 -device linux-rasp-pi2-g++ -device-option CROSS_COMPILE = $TOOLCHAIN/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian/bin/arm-linux-gnueabihf- -sysroot $ROOTFS -prefix /usr/local/qt5 æœ€é‡è¦çš„å‚æ•°æ˜¯ -device å’Œ -sysrootã€‚é€šè¿‡æŒ‡å®š -sysrootï¼Œconfigure ç‰¹å¾æ£€æµ‹æµ‹è¯•ä½¿ç”¨çš„åŒ…å«æ–‡ä»¶å’Œåº“ä»¥åŠ Qt æœ¬èº«ï¼Œå–è‡ªæŒ‡å®šçš„ä½ç½®ï¼Œè€Œä¸æ˜¯ä¸»æœº PC çš„æ ‡å‡†ä½ç½®ã€‚è¿™æ„å‘³ç€åœ¨ä¸»æœºä¸Šå®‰è£…å¼€å‘åŒ…æ˜¯æ— å…³ç´§è¦çš„ã€‚ä¾‹å¦‚ï¼Œè¦è·å¾— libinput æ”¯æŒ libinputï¼Œåœ¨ä¸»æœºç¯å¢ƒä¸­å®‰è£…å¼€å‘å¤´å’Œåº“æ˜¯ä¸å¤Ÿçš„ã€‚ç›¸åï¼Œç›®æ ‡æ¶æ„ï¼ˆä¾‹å¦‚ ARMï¼‰çš„æ ‡å¤´å’Œåº“å¿…é¡»å­˜åœ¨äº sysrootã€‚ pkg-config åœ¨æ‰§è¡Œäº¤å‰ç¼–è¯‘æ—¶ä¹Ÿå¾—åˆ°æ”¯æŒã€‚configure è‡ªåŠ¨è®¾ç½® PKG_CONFIG_LIBDIR ä¸º pkg-config åŸºäº sysroot ä»£æ›¿ä¸»æœºçš„æŠ¥å‘Šç¼–è¯‘å™¨å’Œé“¾æ¥å™¨è®¾ç½®ã€‚è¿™é€šå¸¸åŠŸèƒ½å¾ˆå¥½ï¼Œæ²¡æœ‰ä»»ä½•è¿›ä¸€æ­¥çš„è°ƒæ•´ã€‚ä½†æ˜¯ï¼ŒPKG_CONFIG_PATH è¿è¡Œå‰ï¼Œä¸»æœºå¿…é¡»å…ˆè®¾ç½®ç¯å¢ƒå˜é‡ configureã€‚å¦åˆ™ï¼ŒQt æ„å»ºå¯èƒ½ä¼šå°è¯•ä»ä¸»æœºç³»ç»Ÿä½¿ç”¨ä¸é€‚å½“çš„å¤´æ–‡ä»¶å’Œåº“ã€‚ æŒ‡å®š -sysroot åœ¨ --sysroot è°ƒç”¨ç¼–è¯‘å™¨æ—¶è‡ªåŠ¨è®¾ç½®å‚æ•°çš„ç»“æœã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸å¯å–çš„ï¼Œå¯ä»¥é€šè¿‡ä¼ é€’ -no-gcc-sysroot æ¥ç¦ç”¨ configureã€‚ -prefixï¼Œ-extprefix å¹¶ -hostprefix æ§åˆ¶ Qt æ„å»ºçš„ç›®æ ‡ç›®æ ‡ç›®å½•ã€‚åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒQt çš„ ARM ç‰ˆæœ¬é¢„è®¡å°†æ”¾ç½®åœ¨ /usr/local/qt5 ç›®æ ‡è®¾å¤‡ä¸Šã€‚è¯·æ³¨æ„ï¼Œè¿è¡Œ make install ä¸ä¼šéƒ¨ç½²ä»»ä½•è®¾å¤‡ã€‚ç›¸åï¼Œè¯¥ install æ­¥éª¤å°†ç›®æ ‡æŒ‡å®šçš„ç›®å½• extprefix é»˜è®¤ä¸º sysroot+ prefixï¼Œå› æ­¤æ˜¯å¯é€‰çš„ã€‚ç„¶è€Œï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œâ€æ±¡æŸ“â€æ˜¯ä¸å¯å–çš„ï¼Œå› æ­¤æŒ‡å®š -extprefix å˜å¾—é‡è¦ã€‚æœ€åï¼Œ-hostprefix å…è®¸ä»ç›®æ ‡çš„äºŒè¿›åˆ¶æ–‡ä»¶åˆ†ç¦»ä¸»æœºå·¥å…·ï¼Œå¦‚ qmakeï¼Œrccï¼Œuicã€‚ç»™å®šæ—¶ï¼Œè¿™äº›å·¥å…·å°†å®‰è£…åœ¨æŒ‡å®šçš„ç›®å½•ä¸‹ï¼Œè€Œä¸æ˜¯ extprefixã€‚ åµŒå…¥å¼ Linux è®¾å¤‡çš„å¹³å°æ’ä»¶EGLFSEGL æ˜¯ OpenGL å’Œæœ¬æœºçª—å£ç³»ç»Ÿä¹‹é—´çš„æ¥å£ã€‚Qt å¯ä»¥åˆ©ç”¨ EGL è¿›è¡Œä¸Šä¸‹æ–‡å’Œè¡¨é¢ç®¡ç†ï¼Œä½†å…¶ API ä¸åŒ…å«ä¸å¹³å°ç‰¹å®šå†…å®¹ç›¸å…³çš„åŠŸèƒ½ã€‚è¿™æ„å‘³ç€åˆ›å»ºæœ¬æœºçª—å£çš„è¿‡ç¨‹ï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ä¸€å®šæ˜¯ç”¨æˆ·åœ¨å±å¹•ä¸Šçœ‹åˆ°çš„å®é™…çª—å£ï¼‰ä»ç„¶å¿…é¡»é€šè¿‡å¹³å°ç‰¹å®šçš„æ–¹å¼æ¥å®ç°ã€‚å› æ­¤ï¼Œå¼€å‘è¿‡ç¨‹ä¸­éœ€è¦ç¼–å†™é€‚ç”¨äºç‰¹å®šå¼€å‘æ¿æˆ– GPU çš„é€‚é…ä»£ç ã€‚è¿™æ ·çš„ä¿®æ”¹å¯ä»¥é€šè¿‡ eglfs é’©å­æ¥å®ç°ã€‚è¿™äº›é’©å­å¯ä»¥æ˜¯å•ä¸ªæºæ–‡ä»¶ï¼Œç¼–è¯‘åˆ°å¹³å°æ’ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºåŠ¨æ€åŠ è½½çš„ EGL è®¾å¤‡é›†æˆæ’ä»¶æä¾›ã€‚ EGLFS æ˜¯ä¸€ä¸ªæ—¨åœ¨è¿è¡Œåœ¨æ²¡æœ‰å®é™…çª—å£ç³»ç»Ÿï¼ˆå¦‚ X11 æˆ– Waylandï¼‰çš„ç¯å¢ƒä¸­çš„å¹³å°æ’ä»¶ï¼Œå®ƒæ”¯æŒåœ¨ EGL å’Œ OpenGL ES 2.0 ä¹‹ä¸Šè¿è¡Œ Qt5 åº”ç”¨ç¨‹åºã€‚é™¤äº†æ”¯æŒ Qt Quick 2 å’Œæœ¬æœº OpenGL åº”ç”¨ç¨‹åºå¤–ï¼ŒEGLFS ä¹Ÿå¯ä»¥æ¸²æŸ“è½¯ä»¶æ¸²æŸ“çš„çª—å£ï¼ˆä¾‹å¦‚ QWidgetï¼‰ã€‚åœ¨ä½¿ç”¨ QWidget çš„æƒ…å†µä¸‹ï¼Œè¿™æ„å‘³ç€å°éƒ¨ä»¶çš„å†…å®¹ä¼šè¢« CPU æ¸²æŸ“æˆå›¾åƒï¼Œç„¶åä¸Šä¼ ç»™çº¹ç†ï¼Œç”±æ’ä»¶è¿›è¡Œåˆæˆå¤„ç†ã€‚ EGLFS æ˜¯ç°ä»£åµŒå…¥å¼ Linux è®¾å¤‡çš„é‡è¦æ’ä»¶ï¼Œå°¤å…¶åœ¨åŒ…å« GPU çš„è®¾å¤‡ä¸Šè¡¨ç°ä¼˜è¶Šã€‚ ä½¿ç”¨ EGLFS æ—¶ï¼Œç³»ç»Ÿä¼šå¼ºåˆ¶ç¬¬ä¸€ä¸ªé¡¶çº§çª—å£ï¼ˆè¿™å¯ä»¥æ˜¯ QWidget æˆ– QQuickViewï¼‰ä»¥å…¨å±æ¨¡å¼è¿è¡Œã€‚è¿™ä¸ªçª—å£ä¹Ÿæ˜¯è¢«é€‰ä¸ºæ ¹éƒ¨ä»¶çª—å£çš„åœ°æ–¹ï¼Œæ‰€æœ‰å…¶ä»–çš„é¡¶çº§çª—å£å°éƒ¨ä»¶ï¼ˆä¾‹å¦‚å¯¹è¯æ¡†ã€å¼¹å‡ºèœå•æˆ–ç»„åˆæ¡†çš„ä¸‹æ‹‰åˆ—è¡¨ï¼‰éƒ½å°†è¢«åˆæˆåˆ°å…¶ä¸­ã€‚è¿™ç§è®¾è®¡æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºåœ¨ EGLFS çš„è¿è¡Œç¯å¢ƒä¸­ï¼Œæ€»æ˜¯ä¼šæœ‰ä¸€ä¸ªæœ¬æœºçª—å£å’Œä¸€ä¸ª EGL çª—å£è¡¨é¢ï¼Œè¿™äº›çª—å£ç”±é¦–ä¸ªåˆ›å»ºçš„çª—å£å°éƒ¨ä»¶æˆ–çª—å£ç”Ÿæˆã€‚å½“ä¸»çª—å£åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸä¸­å§‹ç»ˆå­˜åœ¨ï¼Œå¹¶ä¸”å…¶ä»–çª—å£å°éƒ¨ä»¶æ˜¯éé¡¶å±‚æˆ–åœ¨ä¸»çª—å£ä¹‹ååˆ›å»ºæ—¶ï¼Œè¿™ç§æ–¹æ³•éå¸¸æœ‰æ•ˆã€‚ ç„¶è€Œï¼Œå¯¹äºåŸºäº OpenGL çš„çª—å£ï¼ŒEGLFS è¿˜å­˜åœ¨å…¶ä»–çš„é™åˆ¶ã€‚ä» Qt 5.3 å¼€å§‹ï¼ŒEGLFS æ”¯æŒä¸€ä¸ªå…¨å±çš„ GL çª—å£ï¼ˆä¾‹å¦‚åŸºäº OpenGL çš„ QWindowã€QQuickView æˆ– QGLWidgetï¼‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€æ—¦è¯•å›¾æ‰“å¼€é¢å¤–çš„ OpenGL çª—å£ï¼Œæˆ–è€…å°†è¿™äº›çª—å£ä¸åŸºäº QWidget çš„å†…å®¹æ··åˆï¼Œç³»ç»Ÿå°†ä¸å†æ”¯æŒæ­¤ç±»æ“ä½œï¼Œå¹¶ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºç»ˆæ­¢ï¼ŒåŒæ—¶ä¼šè¿”å›é”™è¯¯æ¶ˆæ¯ã€‚è¿™ç§é™åˆ¶å¯èƒ½å¯¹å¼€å‘è€…æ„å»ºå¤æ‚ç•Œé¢æ—¶äº§ç”Ÿä¸€å®šå½±å“ï¼Œä¾‹å¦‚åœ¨éœ€è¦å¤šçª—å£æ˜¾ç¤ºçš„åº”ç”¨åœºæ™¯ä¸­ã€‚ å¦‚æœ‰å¿…è¦ï¼Œeglfs å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®ï¼š QT_QPA_EGLFS_INTEGRATION- é™¤äº†ç¼–è¯‘çš„é’©å­ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä»¥åŠ¨æ€åŠ è½½çš„æ’ä»¶çš„å½¢å¼æä¾›è®¾å¤‡æˆ–ä¾›åº”å•†ç‰¹å®šçš„é€‚é…ã€‚è¿™ä¸ªç¯å¢ƒå˜é‡å¼ºåˆ¶æ‰§è¡Œä¸€ä¸ªç‰¹å®šçš„æ’ä»¶ã€‚ä¾‹å¦‚ï¼Œå°†å…¶è®¾ç½®ä¸º eglfs_kms ä½¿ç”¨ KMS DRM åç«¯ã€‚è¿™åªæ˜¯åœ¨è®¾å¤‡ makepecs ä¸­æ²¡æœ‰æŒ‡å®šé™æ€æˆ–ç¼–å…¥é’©å­çš„é€‰é¡¹ã€‚åœ¨å®è·µä¸­ï¼Œä¼ ç»Ÿçš„ç¼–å…¥é’©å­å¾ˆå°‘è¢«ä½¿ç”¨ï¼Œå‡ ä¹æ‰€æœ‰åç«¯éƒ½è¢«è¿ç§»åˆ°æ’ä»¶ã€‚è®¾å¤‡åˆ¶é€ å•†ä»ç„¶åŒ…å«ç›¸å…³ EGLFS_DEVICE_INTEGRATION æ¡ç›®ï¼šè¯¥ç‰¹å®šè®¾å¤‡çš„é¦–é€‰åç«¯çš„åç§°ã€‚è¿™æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯éå¸¸æœ‰ç”¨ï¼Œä»¥é¿å…åœ¨ç›®æ ‡ç³»ç»Ÿä¸­å­˜åœ¨å¤šä¸ªæ’ä»¶çš„æƒ…å†µä¸‹è®¾ç½®æ­¤ç¯å¢ƒå˜é‡ã€‚DISPLAY åœ¨æ¡Œé¢ç¯å¢ƒä¸­ï¼Œæ ¹æ®ç¯å¢ƒå˜é‡çš„å­˜åœ¨ï¼ŒKMS æˆ– X11 åç«¯æ˜¯ä¼˜å…ˆçš„ã€‚è¯·æ³¨æ„ï¼Œåœ¨æŸäº›ç”µè·¯æ¿ä¸Šä½¿ç”¨ç‰¹æ®Šçš„å€¼ none è€Œä¸æ˜¯å®é™…çš„æ’ä»¶ã€‚è¿™è¡¨æ˜ä½¿ç”¨ EGL ä¸ framebuffer ä¸éœ€è¦ç‰¹æ®Šçš„é›†æˆï¼Œæ‰€ä»¥ä¸èƒ½åŠ è½½æ’ä»¶ã€‚ QT_QPA_EGLFS_PHYSICAL_WIDTH å’Œ QT_QPA_EGLFS_PHYSICAL_HEIGHT-ç‰©ç†å±å¹•å®½åº¦å’Œé«˜åº¦ä»¥æ¯«ç±³ä¸ºå•ä½ã€‚åœ¨ä¸èƒ½ä»å¸§ç¼“å†²è®¾å¤‡ dev fb0 æˆ–å…¶ä»–æ–¹å¼æŸ¥è¯¢å€¼çš„å¹³å°ä¸Šï¼Œä½¿ç”¨é»˜è®¤ DPI ä¸º 100ã€‚æ­¤å˜é‡å¯ç”¨äºè¦†ç›–ä»»ä½•æ­¤ç±»é»˜è®¤å€¼ã€‚è®¾ç½®æ­¤é€‰é¡¹å¾ˆé‡è¦ï¼Œå› ä¸ºåŸºäº QWidget æˆ– Qt Quick Controls çš„åº”ç”¨ç¨‹åºä¾èµ–äºè¿™äº›å€¼ã€‚ä½¿ç”¨ç¡¬ç¼–ç è®¾ç½®è¿è¡Œå¯èƒ½ä¼šå¯¼è‡´ç”¨æˆ·ç•Œé¢å…ƒç´ å¤§å°ä¸é€‚åˆåœ¨ä½¿ç”¨ä¸­æ˜¾ç¤ºã€‚ QT_QPA_EGLFS_ROTATION- æŒ‡å®šåœ¨åŸºäº QWidget çš„åº”ç”¨ç¨‹åºä¸­åº”ç”¨äºè½¯ä»¶æ¸²æŸ“å†…å®¹çš„æ—‹è½¬ã€‚æ”¯æŒçš„å€¼ä¸º 180,90 å’Œ-90ã€‚è¿™ä¸é€‚ç”¨äºåŸºäº OpenGL çš„çª—å£ï¼ŒåŒ…æ‹¬ Qt Quickã€‚Qt Quick åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ QML åœºæ™¯ä¸­åº”ç”¨è½¬æ¢ã€‚æ— è®ºåº”ç”¨ç¨‹åºç±»å‹å¦‚ä½•ï¼Œæ ‡å‡†çš„ eglfs é¼ æ ‡å…‰æ ‡æ€»æ˜¯è€ƒè™‘åˆ°è¯¥å€¼ï¼Œå…·æœ‰é€‚å½“å®šä½å’Œæ—‹è½¬çš„æŒ‡é’ˆå›¾åƒã€‚ç‰¹æ®Šå…‰æ ‡å®ç°ï¼ˆå¦‚ KMS DRM åç«¯çš„ç¡¬ä»¶å…‰æ ‡ï¼‰å¯èƒ½ä¸æ”¯æŒæ—‹è½¬ã€‚ QT_QPA_EGLFS_FORCEVSYNC- è®¾ç½®åï¼Œæ¯æ¬¡è°ƒç”¨ eglSwapBuffersï¼ˆï¼‰åï¼Œå¸§ç¼“å†²è®¾å¤‡ä¸Šçš„ eglfs è¯·æ±‚ FBIO_WAITFORVSYNCã€‚è¿™ä»…é€‚ç”¨äºä¾èµ–äº fbdevLinux çš„ä¼ ç»Ÿå­ç³»ç»Ÿçš„åç«¯ã€‚é€šå¸¸ï¼Œé»˜è®¤äº¤æ¢é—´éš”ä¸º 1ï¼ŒQt å‡å®šè°ƒç”¨ eglSwapBuffersï¼ˆï¼‰å¤„ç† vsync; å¦‚æœæ²¡æœ‰ï¼ˆä¾‹å¦‚ï¼Œç”±äºé©±åŠ¨ç¨‹åºé”™è¯¯ï¼‰ï¼Œè¯·å°è¯•è®¾ç½® QT_QPA_EGLFS_FORCEVSYNC ä¸ºéé›¶å€¼ã€‚ QT_QPA_EGLFS_FORCE888 - è®¾ç½®æ—¶ï¼Œåœ¨åˆ›å»ºæ–°çš„ä¸Šä¸‹æ–‡ï¼Œçª—å£æˆ–å±å¹•å¤–è¡¨é¢æ—¶ï¼Œå°†å¿½ç•¥çº¢è‰²ï¼Œç»¿è‰²å’Œè“è‰²é¢œè‰²é€šé“å¤§å°ã€‚ç›¸åï¼Œæ’ä»¶è¦æ±‚æ¯ä¸ªé€šé“ 8 ä½é…ç½®ã€‚è¿™å¯¹äºåœ¨é»˜è®¤æƒ…å†µä¸‹é€‰æ‹©å…·æœ‰å°äº 32 æˆ– 24 ä½åƒç´ ï¼ˆä¾‹å¦‚ 5-6-5 æˆ– 4-4-4ï¼‰çš„é…ç½®çš„è®¾å¤‡å¯èƒ½æ˜¯æœ‰ç”¨çš„ï¼Œä½†æ˜¯å·²çŸ¥ä¸æ˜¯ç†æƒ³çš„ï¼Œä¾‹å¦‚ï¼Œç”±äºç»‘å¸¦æ•ˆåº”ã€‚è€Œä¸æ˜¯æ›´æ”¹åº”ç”¨ç¨‹åºä»£ç ï¼Œæ­¤å˜é‡æä¾›äº†ä¸€ä¸ªæ›´å®¹æ˜“çš„å¿«æ·æ–¹å¼æ¥å¼ºåˆ¶ 24 æˆ– 32 bpp é…ç½®ã€‚ æ­¤å¤–ï¼Œä»¥ä¸‹è¾ƒä¸å¸¸ç”¨çš„å˜é‡ä¹Ÿå¯ç”¨ï¼š QT_QPA_EGLFS_FB - è¦†ç›–å¸§ç¼“å†²è®¾å¤‡ã€‚é»˜è®¤æ˜¯devfb0ã€‚åœ¨å¤§å¤šæ•°åµŒå…¥å¼å¹³å°ä¸Šï¼Œè¿™ä¸æ˜¯å¾ˆç›¸å…³ï¼Œå› ä¸ºå¸§ç¼“å†²åŒºä»…ç”¨äºæŸ¥è¯¢æ˜¾ç¤ºç»´åº¦ç­‰è®¾ç½®ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›è®¾å¤‡ä¸Šï¼Œè¯¥å‚æ•°æä¾›äº†æŒ‡å®šè¦åœ¨å¤šä¸ªæ˜¾ç¤ºè®¾ç½®ä¸­ä½¿ç”¨çš„æ˜¾ç¤ºçš„åŠŸèƒ½ï¼Œç±»ä¼¼äº LinuxFB ä¸­çš„ fb å‚æ•°ã€‚ QT_QPA_EGLFS_WIDTH å’Œ QT_QPA_EGLFS_HEIGHT- åŒ…å«å±å¹•å®½åº¦å’Œé«˜åº¦ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰ã€‚åœ¨ eglfs å°è¯•ä» framebuffer è®¾å¤‡ dev fb0 ä¸­ç¡®å®šå°ºå¯¸æ—¶ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ€»æ˜¯å’Œæ‰‹åŠ¨æŒ‡å®šå¤§å°å¯èƒ½å˜å¾—å¿…è¦ã€‚ QT_QPA_EGLFS_DEPTH - è¦†ç›–å±å¹•çš„é¢œè‰²æ·±åº¦ã€‚åœ¨ framebuffer è®¾å¤‡ dev fb0 ä¸å¯ç”¨æˆ–æŸ¥è¯¢ä¸æˆåŠŸçš„å¹³å°ä¸Šï¼Œä½¿ç”¨é»˜è®¤å€¼ 32ã€‚æ­¤å˜é‡å¯ç”¨äºè¦†ç›–ä»»ä½•æ­¤ç±»é»˜è®¤å€¼ã€‚è¯·æ³¨æ„ï¼Œè¿™ä»…å½±å“ QScreen æŠ¥å‘Šçš„é¢œè‰²æ·±åº¦å€¼ã€‚å®ƒä¸ EGL é…ç½®å’Œ OpenGL æ¸²æŸ“ä½¿ç”¨çš„é¢œè‰²æ·±åº¦æ— å…³ã€‚ QT_QPA_EGLFS_SWAPINTERVAL- é»˜è®¤æƒ…å†µä¸‹ 1 å°†è¦æ±‚äº¤æ¢é—´éš”ã€‚è¿™ä½¿å¾—èƒ½å¤Ÿä¸æ˜¾ç¤ºå™¨å‚ç›´åˆ·æ–°åŒæ­¥ã€‚è¯¥å€¼å¯ä»¥ç”¨æ­¤ç¯å¢ƒå˜é‡è¦†ç›–ã€‚ä¾‹å¦‚ï¼Œä¼ é€’ 0 å°†ç¦ç”¨äº¤æ¢é˜»å¡ï¼Œå¯¼è‡´å°½å¯èƒ½å¿«åœ°è¿è¡Œè€Œæ²¡æœ‰ä»»ä½•åŒæ­¥ã€‚ QT_QPA_EGLFS_DEBUG - è®¾ç½®æ—¶ï¼Œè°ƒè¯•è¾“å‡ºä¸Šä¼šæ‰“å°ä¸€äº›è°ƒè¯•ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥çš„ QSurfaceFormat å’Œæ‰€é€‰ EGL é…ç½®çš„å±æ€§åœ¨åˆ›å»ºæ–°ä¸Šä¸‹æ–‡æ—¶æ‰“å°ã€‚ä¸ Qt Quick çš„ QSG_INFO å˜é‡ä¸€èµ·ï¼Œå¯ä»¥ä¸ºä¸ EGL é…ç½®ç›¸å…³çš„æ•…éšœæ’é™¤æä¾›æœ‰ç”¨çš„ä¿¡æ¯ã€‚ é™¤æ­¤ä¹‹å¤– QT_QPA_EGLFS_DEBUGï¼Œeglfs è¿˜æ”¯æŒæ›´ç°ä»£çš„ Qt åˆ†ç±»æ—¥å¿—è®°å½•ç³»ç»Ÿã€‚ä»¥ä¸‹æ—¥å¿—è®°å½•ç±»åˆ«å¯ç”¨ï¼š qt.qpa.egldeviceintegration - ä¸ºåŠ¨æ€åŠ è½½çš„åç«¯å¯ç”¨æ—¥å¿—è®°å½•ã€‚éå¸¸æœ‰ç”¨çš„æ£€æŸ¥åç«¯æ˜¯å¦æ­£åœ¨ä½¿ç”¨ã€‚ qt.qpa.input - å¯ç”¨æ¥è‡ª evdev å’Œ libinput è¾“å…¥å¤„ç†ç¨‹åºçš„è°ƒè¯•è¾“å‡ºã€‚æ£€æŸ¥ç»™å®šè¾“å…¥è®¾å¤‡æ˜¯å¦è¢«è¯†åˆ«å’Œæ‰“å¼€éå¸¸æœ‰ç”¨ã€‚ qt.qpa.eglfs.kms - åœ¨ KMS DRM åç«¯å¯ç”¨è¯¦ç»†æ—¥å¿—è®°å½•ã€‚ è¿è¡Œå configureï¼Œç¡®ä¿æ£€æŸ¥å…¶è¾“å‡ºã€‚ç”±äºç›¸åº”çš„é…ç½®æµ‹è¯•å¤±è´¥ï¼Œæ²¡æœ‰å¯ç”¨å¿…è¦çš„ eglfs åç«¯ï¼Œlibudev æˆ– libinput æ˜¯ç›¸å½“å¸¸è§çš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼å¿«é€Ÿè¯†åˆ«ã€‚å½“æœ‰ä¸æƒ³è¦çš„â€ä¸â€çš„ç»“æœï¼Œè¿è¡Œ configure ä¸-v æ‰èƒ½çœ‹åˆ°ç¼–è¯‘å™¨å’Œé“¾æ¥è°ƒç”¨æ¯ä¸ªé…ç½®æµ‹è¯•æ‰“å¼€è¯¦ç»†è¾“å‡ºã€‚ æ³¨æ„ï¼šå…³äºç¼ºå°‘æ ‡é¢˜ï¼Œåº“æˆ–ä¼¼ä¹éšå«çš„é“¾æ¥å™¨æ•…éšœçš„é”™è¯¯é€šå¸¸æ˜¯ä¸å®Œæ•´æˆ–ç ´ç¢çš„ sysroot çš„æ ‡å¿—ï¼Œä¸ Qt æ— å…³ï¼Œä¹Ÿä¸èƒ½è¢« Qt è§£å†³ã€‚ ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨ Broadcom ä¸“æœ‰å›¾å½¢é©±åŠ¨ç¨‹åºå®šä½ Raspberry Pi æ—¶ï¼Œè¾“å‡ºåº”åŒ…å«ä»¥ä¸‹å†…å®¹ã€‚å¦‚æœä¸æ˜¯è¿™æ ·ï¼Œæ²¡æœ‰å¿…è¦è¿›ä¸€æ­¥è¿›è¡Œæ„å»ºï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰ Raspberry Pi ç‰¹å®šçš„åç«¯ï¼ŒåŠ é€Ÿå›¾å½¢å°†ä¸èµ·ä½œç”¨ï¼Œå³ä½¿ Qt çš„å…¶ä½™éƒ¨åˆ†æˆåŠŸç¼–è¯‘ã€‚ QPA åç«¯ï¼š EGLFS ................................yesEGLFS è¯¦ç»†ä¿¡æ¯ï¼šEGLFS i.Mx6 ........................ noEGLFS i.Mx6 Wayland ................ noEGLFS EGLDevice .................... noEGLFS GBM .......................... noEGLFS mali.........................EGLFS Rasberry Pi ..................yesXL ä¸Šçš„ EGL ......................... LinuxFBè¯¥æ’ä»¶é€šè¿‡ Linux çš„ fbdev å­ç³»ç»Ÿç›´æ¥å†™å…¥å¸§ç¼“å†²åŒºã€‚åªæ”¯æŒè½¯ä»¶æ¸²æŸ“å†…å®¹ã€‚è¯·æ³¨æ„ï¼Œåœ¨æŸäº›è®¾ç½®ä¸Šï¼Œæ˜¾ç¤ºæ€§èƒ½é¢„è®¡å°†å—åˆ°é™åˆ¶ã€‚ ä» Qt 5.9 å¼€å§‹ï¼Œç”±äº fbdev åœ¨ Linux å†…æ ¸ä¸­è¢«å¼ƒç”¨ï¼ŒDRM dumb ç¼“å†²åŒºæ”¯æŒä¹Ÿæ˜¯å¯ç”¨çš„ã€‚å¿…é¡»é€šè¿‡å°† QT_QPA_FB_DRM ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºéé›¶å€¼æ¥è¯·æ±‚ã€‚å½“è®¾ç½®æ—¶ï¼Œåªè¦ç³»ç»Ÿæ”¯æŒå“‘ç¼“å†²åŒºï¼Œä¼ ç»Ÿçš„å¸§ç¼“å†²è®¾å¤‡devfb0 å°±ä¸ä¼šè¢«è®¿é—®ã€‚ç›¸åï¼Œé€šè¿‡ DRM API è®¾ç½®æ¸²æŸ“ï¼Œç±»ä¼¼äº eglfs_kmseglfs çš„åç«¯ã€‚è¾“å‡ºå°†è¢«åŒç¼“å†²å’Œé¡µé¢ç¿»è½¬ï¼Œä¸ºè½¯ä»¶æ¸²æŸ“å†…å®¹æä¾›é€‚å½“çš„ vsyncã€‚ æ³¨æ„ï¼šå½“ä½¿ç”¨å“‘ç¼“å†²åŒºæ—¶ï¼Œä»¥ä¸‹æ‰€è¿°çš„ä»»ä½•é€‰é¡¹éƒ½ä¸é€‚ç”¨ï¼Œå› ä¸ºç‰©ç†å’Œé€»è¾‘å±å¹•å°ºå¯¸ç­‰å±æ€§éƒ½å°†è¢«è‡ªåŠ¨æŸ¥è¯¢ã€‚ è¯¥ linuxfb æ’ä»¶å…è®¸é€šè¿‡å°†å®ƒä»¬ä¼ é€’ç»™ QT_QPA_PLATFORM ç¯å¢ƒå˜é‡æˆ– -platform å‘½ä»¤è¡Œé€‰é¡¹æ¥æŒ‡å®šå…¶ä»–è®¾ç½®ã€‚ä¾‹å¦‚ï¼ŒQT_QPA_PLATFORM=linuxfb:fb=/dev/fb1 æŒ‡å®š /dev/fb1 å¿…é¡»ä½¿ç”¨å¸§ç¼“å†²è®¾å¤‡è€Œä¸æ˜¯é»˜è®¤å€¼ fb0ã€‚å¯ä»¥é€šè¿‡ç”¨å†’å·åˆ†éš”å¤šä¸ªè®¾ç½®æ¥æŒ‡å®šå¤šä¸ªè®¾ç½®ã€‚ fbdevfbN - æŒ‡å®šå¸§ç¼“å†²è®¾å¤‡ã€‚åœ¨å¤šä¸ªæ˜¾ç¤ºè®¾ç½®ä¸Šï¼Œè¿™é€šå¸¸å…è®¸åœ¨ä¸åŒæ˜¾ç¤ºå™¨ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºã€‚æš‚æ—¶æ²¡æœ‰åŠæ³•ä»ä¸€ä¸ª Qt åº”ç”¨ç¨‹åºä½¿ç”¨å¤šä¸ªå¸§ç¼“å†²åŒºã€‚ size=width xheight - æŒ‡å®šå±å¹•å¤§å°ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰ã€‚æ’ä»¶å°è¯•ä» framebuffer è®¾å¤‡æŸ¥è¯¢ç‰©ç†å’Œé€»è¾‘çš„æ˜¾ç¤ºç»´åº¦ã€‚ç„¶è€Œï¼Œè¿™å¯èƒ½å¹¶ä¸æ€»æ˜¯å¯¼è‡´æ­£ç¡®çš„ç»“æœï¼Œå› æ­¤å¯èƒ½éœ€è¦æ˜ç¡®æŒ‡å®šå€¼ã€‚ mmsize=width xheight - ç‰©ç†å®½åº¦å’Œé«˜åº¦ï¼ˆä»¥æ¯«ç±³ä¸ºå•ä½ï¼‰ã€‚ offset=width xheight - æŒ‡å®šå±å¹•å·¦ä¸Šè§’çš„åƒç´ åç§»é‡ã€‚é»˜è®¤ä½ç½®åœ¨(0, 0)ã€‚ nographicsmodeswitch - ä¸è¦å°†è™šæ‹Ÿç»ˆç«¯åˆ‡æ¢åˆ°å›¾å½¢æ¨¡å¼ï¼ˆKD_GRAPHICSï¼‰ã€‚é™¤äº†åˆ‡æ¢åˆ°å›¾å½¢æ¨¡å¼å¤–ï¼Œé—ªçƒçš„å…‰æ ‡å’Œå±å¹•æ¶ˆéšä¹Ÿé€šå¸¸è¢«ç¦ç”¨ã€‚è®¾ç½®æ­¤å‚æ•°æ—¶ï¼Œä¹Ÿä¼šè·³è¿‡è¿™äº›å‚æ•°ã€‚ tty=/dev/ttyN - è¦†ç›–è™šæ‹Ÿæ§åˆ¶å°ã€‚ä»…åœ¨ nographicsmodeswitch æœªè®¾ç½®æ—¶ä½¿ç”¨ã€‚ ä» Qt 5.9 èµ·ï¼Œåœ¨çª—å£å¤§å°è°ƒæ•´ç­–ç•¥ä¸­ï¼Œeglfs å’Œ linuxfb çš„è¡Œä¸ºå·²è¢«åŒæ­¥ï¼šç¬¬ä¸€ä¸ªé¡¶çº§çª—å£è¢«è¿«ä½¿ç”¨ä¸¤ä¸ªå¹³å°æ’ä»¶è¦†ç›–æ•´ä¸ªå±å¹•ã€‚å¦‚æœä¸æƒ³è¿™æ ·ï¼Œç¯å¢ƒå˜é‡è®¾ç½® QT_QPA_FB_FORCE_FULLSCREEN åˆ° 0 ä»¥æ¢å¤æ—©æœŸçš„ Qt ç‰ˆæœ¬çš„è¡Œä¸ºã€‚ è¾“å…¥å½“æ²¡æœ‰çª—å£ç³»ç»Ÿå­˜åœ¨æ—¶ï¼Œé¼ æ ‡ï¼Œé”®ç›˜ï¼Œä»¥åŠè§¦æ‘¸è¾“å…¥æ˜¯é€šè¿‡ç›´æ¥è¯»å– evdev æˆ–ä½¿ç”¨è¾…åŠ©åº“å¦‚ libinput æˆ– tslibã€‚è¯·æ³¨æ„ï¼Œè¿™è¦æ±‚ /dev/input/event* ç”¨æˆ·å¯ä»¥è¯»å–è®¾å¤‡èŠ‚ç‚¹ã€‚eglfs å¹¶ linuxfb å…·æœ‰ç¼–è¯‘çš„æ‰€æœ‰è¾“å…¥å¤„ç†ä»£ç ã€‚ ä½¿ç”¨ libinputlibinput æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†è¾“å…¥è®¾å¤‡çš„åº“ã€‚å®ƒæä¾›äº† Qt è‡ªå·±çš„ evdev è¾“å…¥æ”¯æŒçš„æ›¿ä»£æ–¹æ¡ˆã€‚ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨ libinputï¼Œè¯·ç¡®ä¿æ‰€å¼€å‘çš„æ–‡ä»¶ libudev å’Œ libinput é…ç½®å’Œæ„å»º Qt æ—¶å¯ç”¨ã€‚xkbcommon å¦‚æœéœ€è¦é”®ç›˜æ”¯æŒï¼Œä¹Ÿæ˜¯å¿…éœ€çš„ã€‚ç”±äºè¿™äº›æ’ä»¶é»˜è®¤ä½¿ç”¨ eglfsï¼Œå› æ­¤ linuxfb æ— éœ€è¿›ä¸€æ­¥çš„æ“ä½œ libinputã€‚å¦‚æœ libinput æ”¯æŒä¸å¯ç”¨æˆ–ç¯å¢ƒå˜é‡ QT_QPA_EGLFS_NO_LIBINPUT è®¾ç½®ï¼ŒQt è‡ªå·±çš„ evdev å¤„ç†ç¨‹åºè¿›æ¥ç©ã€‚ è¾“å…¥ eglfs å’Œ linuxfb è€Œä¸ç”¨ libinputåƒè®¾å¤‡èŠ‚ç‚¹åç§°å‚æ•°å¯ä»¥åœ¨ç¯å¢ƒå˜é‡è®¾ç½® QT_QPA_EVDEV_MOUSE_PARAMETERSï¼ŒQT_QPA_EVDEV_KEYBOARD_PARAMETERS å’Œ QT_QPA_EVDEV_TOUCHSCREEN_PARAMETERSã€‚ç”¨å†’å·åˆ†éš”æ¡ç›®ã€‚è¿™äº›å‚æ•°ä½œä¸ºä¼ é€’-plugin å‘½ä»¤è¡Œå‚æ•°ä¸­çš„è®¾ç½®çš„æ›¿ä»£æ–¹æ³•ï¼Œå¹¶ä¸”å¯¹äºæŸäº›åç«¯ï¼Œå®ƒä»¬æ˜¯è‡³å…³é‡è¦çš„ï¼šeglfs å’Œ linuxfb ä½¿ç”¨å†…ç½®çš„è¾“å…¥å¤„ç†ç¨‹åºï¼Œå› æ­¤-plugin åœ¨ä½¿ç”¨ä¸­æ²¡æœ‰å•ç‹¬çš„å‚æ•°ã€‚ æ­¤å¤–ï¼Œå†…ç½®çš„è¾“å…¥å¤„ç†ç¨‹åºå¯ä»¥é€šè¿‡è®¾ç½®è¢«ç¦ç”¨ QT_QPA_EGLFS_DISABLE_INPUT æˆ– QT_QPA_FB_DISABLE_INPUT åˆ° 1ã€‚ é¼ æ ‡é¼ æ ‡å…‰æ ‡æ¯å½“å‡ºç° QT_QPA_EGLFS_HIDECURSORï¼ˆå¯¹äº eglfsï¼‰æˆ– QT_QPA_FB_HIDECURSORï¼ˆå¯¹äº linuxfbï¼‰æœªè®¾ç½®ï¼ŒQt çš„åŸºäº libudev çš„è®¾å¤‡å‘ç°æŠ¥å‘Šè‡³å°‘æœ‰ä¸€ä¸ªé¼ æ ‡å¯ç”¨ã€‚å½“ libudev ä¸å­˜åœ¨æ”¯æŒæ—¶ï¼Œé¼ æ ‡å…‰æ ‡å§‹ç»ˆæ˜¾ç¤ºï¼Œé™¤éé€šè¿‡ç¯å¢ƒå˜é‡æ˜¾å¼ç¦ç”¨ã€‚ æ”¯æŒçƒ­æ’æ‹”ï¼Œä½†åªæœ‰å½“ Qt é…ç½®äº† libudev æ”¯æŒï¼ˆå³ï¼Œå¦‚æœ libudev å¼€å‘å¤´åœ¨é…ç½®æ—¶åœ¨ sysroot ä¸­å­˜åœ¨ï¼‰ã€‚è¿™å…è®¸åœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶è¿æ¥æˆ–æ–­å¼€è¾“å…¥è®¾å¤‡ã€‚evdev é¼ æ ‡å¤„ç†å™¨æ”¯æŒä»¥ä¸‹é¢å¤–çš„å‚æ•°ï¼š /dev/input/... - æŒ‡å®šè¾“å…¥è®¾å¤‡çš„åç§°ã€‚å½“æ²¡æœ‰ç»™å‡ºæ—¶ï¼ŒQt é€šè¿‡ libudev æˆ–é€šè¿‡å¯ç”¨èŠ‚ç‚¹æ¥æŸ¥æ‰¾åˆé€‚çš„è®¾å¤‡ã€‚ nocompress - é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸æœ€åä¸€ä¸ª Qt é¼ æ ‡äº‹ä»¶ç›¸æ¯”ï¼Œä¸ä¼šå¯¼è‡´æ›´æ”¹ä½ç½®çš„è¾“å…¥äº‹ä»¶è¢«å‹ç¼©; åœ¨æ›´æ”¹ä½ç½®æˆ–æŒ‰é’®çŠ¶æ€åï¼Œæ‰ä¼šå‘é€æ–°çš„ Qt é¼ æ ‡äº‹ä»¶ã€‚å¯ä»¥é€šè¿‡è®¾ç½® nocompress å‚æ•°æ¥ç¦ç”¨ã€‚ dejitter - æŒ‡å®šæŠ–åŠ¨é™åˆ¶ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ¶ˆéšåŠŸèƒ½ã€‚ grab - å½“ 1ï¼ŒQt å°†æŠ“ä½è®¾å¤‡ä¸“ç”¨ã€‚ abs - ä¸€äº›è§¦æ‘¸å±æŠ¥å‘Šç»å¯¹åæ ‡ï¼Œä¸èƒ½ä¸è§¦æ‘¸æ¿åŒºåˆ†å¼€æ¥ã€‚åœ¨è¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œé€šè¿‡ abs è¡¨ç¤ºè®¾å¤‡æ­£åœ¨ä½¿ç”¨ç»å¯¹äº‹ä»¶ã€‚ é”®ç›˜è¯¥äº† evdev é”®ç›˜å¤„ç†ç¨‹åºæ”¯æŒä»¥ä¸‹é¢å¤–çš„å‚æ•°ï¼š /dev/input/... - æŒ‡å®šè¾“å…¥è®¾å¤‡çš„åç§°ã€‚å½“æ²¡æœ‰ç»™å‡ºæ—¶ï¼ŒQt é€šè¿‡ libudev æˆ–é€šè¿‡å¯ç”¨èŠ‚ç‚¹æ¥æŸ¥æ‰¾åˆé€‚çš„è®¾å¤‡ã€‚ grab - å¯ç”¨æŠ“å–è¾“å…¥è®¾å¤‡ã€‚ keymap - æŒ‡å®šè‡ªå®šä¹‰é”®ç›˜æ˜ å°„æ–‡ä»¶çš„åç§°ã€‚ enable-compose - å¯ç”¨åˆæˆã€‚ repeat-delay - è®¾ç½®è‡ªå®šä¹‰é”®é‡å¤å»¶è¿Ÿã€‚ repeat-rate - è®¾ç½®è‡ªå®šä¹‰é”®é‡å¤ç‡ã€‚ åœ¨æ²¡æœ‰åœç”¨ç»ˆç«¯ä¼šè¯çš„åµŒå…¥å¼ Linux ç³»ç»Ÿä¸Šï¼Œç”±äºè¾“å…¥äº‹ä»¶ç”± Qt åº”ç”¨ç¨‹åºå’Œ tty å¤„ç†ï¼ŒæŒ‰é”®ä¸Šçš„è¡Œä¸ºå¯èƒ½ä¼šä»¤äººå›°æƒ‘ã€‚ä¸ºäº†å…‹æœè¿™ä¸€ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹é€‰é¡¹ï¼š EGLFS å’Œ LinuxFB å°è¯•é€šè¿‡è®¾ç½® tty çš„é”®ç›˜æ¨¡å¼æ¥ç¦ç”¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶çš„ç»ˆç«¯é”®ç›˜ K_OFFã€‚è¿™æ ·å¯ä»¥é˜²æ­¢é”®ç›˜è¿›å…¥ç»ˆç«¯ã€‚å¦‚æœç”±äºæŸäº›åŸå› éœ€è¦æ¢å¤æ ‡å‡†è¡Œä¸ºï¼Œè¯·å°†ç¯å¢ƒå˜é‡è®¾ç½® QT_QPA_ENABLE_TERMINAL_KEYBOARD ä¸º 1ã€‚è¯·æ³¨æ„ï¼Œä»…å½“åº”ç”¨ç¨‹åºä»è¿œç¨‹æ§åˆ¶å°ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ sshï¼‰å¯åŠ¨å¹¶ä¸”ç»ˆç«¯é”®ç›˜è¾“å…¥ä¿æŒå¯ç”¨æ—¶ï¼Œè¯¥åŠŸèƒ½æ‰èµ·ä½œç”¨ã€‚ å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨äº† evdev é”®ç›˜å¤„ç†ç¨‹åºçš„ grab é€šè¿‡ä¼ é€’å‚æ•°æŠ¢ 1 åœ¨ QT_QPA_EVDEV_KEYBOARD_PARAMETERSã€‚è¿™æ ·ä¼šå¯¼è‡´å°è¯•åœ¨è¾“å…¥è®¾å¤‡ä¸Šè¿›è¡ŒæŠ“å–ã€‚å¦‚æœ grab æˆåŠŸï¼Œåªè¦ Qt åº”ç”¨ç¨‹åºè¿è¡Œï¼Œç³»ç»Ÿä¸­æ²¡æœ‰å…¶ä»–ç»„ä»¶ä»ä¸­æ¥æ”¶äº‹ä»¶ã€‚è¿™ç§æ–¹æ³•æ›´é€‚åˆè¿œç¨‹å¯åŠ¨çš„åº”ç”¨ç¨‹åºï¼Œå› ä¸ºå®ƒä¸éœ€è¦è®¿é—® tty è®¾å¤‡ã€‚ æœ€åï¼Œå¯¹äºè®¸å¤šä¸“é—¨çš„åµŒå…¥å¼ Linux å›¾åƒï¼Œé¦–å…ˆå¯ç”¨æ ‡å‡†ç»ˆç«¯ä¼šè¯æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚è¯·å‚é˜…çš„æ„å»ºç¯å¢ƒçš„æ–‡æ¡£ï¼Œäº†è§£å¦‚ä½•ç¦ç”¨å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨ Yocto Project ç”Ÿæˆå›¾åƒæ—¶ï¼Œå–æ¶ˆè®¾ç½®å°† SYSVINIT_ENABLED_GETTYS å¯¼è‡´ getty ä»»ä½•è™šæ‹Ÿç»ˆç«¯æ— ä»»ä½•è¿›ç¨‹è¿è¡Œï¼Œä»è€Œå¯¼è‡´æ— è¾“å…¥ã€‚ å¦‚æœé»˜è®¤å†…ç½®é”®ç›˜æ˜ å°„ä¸å¤Ÿï¼Œå¯ä»¥é€šè¿‡ keymap å‚æ•°æˆ–ä½¿ç”¨ eglfs ç‰¹å®šçš„ loadKeymapï¼ˆï¼‰å‡½æ•°æŒ‡å®šä¸åŒçš„é”®ç›˜æ˜ å°„ã€‚åè€…å…è®¸åœ¨è¿è¡Œæ—¶åˆ‡æ¢é”®ç›˜æ˜ å°„ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œè¿™éœ€è¦ä½¿ç”¨ eglfs çš„å†…ç½®é”®ç›˜å¤„ç†ç¨‹åº; å½“é€šè¿‡-plugin å‘½ä»¤è¡Œå‚æ•°åŠ è½½é”®ç›˜å¤„ç†ç¨‹åºæ—¶ï¼Œä¸æ”¯æŒå®ƒã€‚ æ³¨æ„ï¼šç›®å‰ä¸æ”¯æŒç‰¹æ®Šçš„ç³»ç»Ÿç»„åˆé”®ï¼Œä¾‹å¦‚æ§åˆ¶å°åˆ‡æ¢ï¼ˆCtrl + Alt + Fxï¼‰æˆ– zapï¼ˆCtrl + Alt + Backspaceï¼‰ï¼Œå¹¶è¢«å¿½ç•¥ã€‚ è¦ç”Ÿæˆè‡ªå®šä¹‰é”®ç›˜æ˜ å°„ï¼Œå¯ä»¥ä½¿ç”¨ kmap2qmap å®ç”¨ç¨‹åºã€‚è¿™å¯ä»¥åœ¨ qttools æ¨¡å—ä¸­æ‰¾åˆ°ã€‚æºæ–‡ä»¶å¿…é¡»æ˜¯æ ‡å‡†çš„ Linux kmap æ ¼å¼ï¼Œè¿™æ˜¯å†…æ ¸çš„ loadkeys å‘½ä»¤æ‰€ç†è§£çš„ã€‚è¿™æ„å‘³ç€å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æºç”Ÿæˆ qmap æ–‡ä»¶ï¼š åœ¨ Linux æ§åˆ¶å°å·¥å…·ï¼ˆLCTï¼‰é¡¹ç›®ã€‚ Xorg X11 é”®ç›˜æ˜ å°„å¯ä»¥è½¬æ¢ kmap ä¸ºè¯¥ ckbcomp å®ç”¨ç¨‹åºçš„æ ¼å¼ã€‚ ç”±äº kmap æ–‡ä»¶æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥æ‰‹å·¥åˆ¶ä½œã€‚ kmap2qmap æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºï¼Œè‡³å°‘éœ€è¦ 2 ä¸ªæ–‡ä»¶ä½œä¸ºå‚æ•°ã€‚æœ€åä¸€ä¸ªæ˜¯ç”Ÿæˆçš„.qmap æ–‡ä»¶ï¼Œè€Œå…¶ä»–æ‰€æœ‰æ–‡ä»¶éƒ½è¢«è§£æä¸ºè¾“å…¥.kmap æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š kmap2qmap i386 /qwertz/de-latin1-nodeadkeys.kmap include/compose.latin1.inc de-latin1-nodeadkeys.qmap æ³¨æ„ï¼škmap2qmap ä¸æ”¯æŒ Linux å†…æ ¸æ”¯æŒçš„æ‰€æœ‰ï¼ˆä¼ªï¼‰ç¬¦å·ã€‚è½¬æ¢æ ‡å‡†é”®ç›˜å›¾æ—¶ï¼Œä¼šæ˜¾ç¤ºè®¸å¤šè­¦å‘Šï¼Œå…³äº Show_Registersï¼ŒHex_A ç­‰ç­‰; è¿™äº›æ¶ˆæ¯å¯ä»¥å®‰å…¨åœ°è¢«å¿½ç•¥ã€‚ è§¦æ‘¸å¯¹äºä¸€äº›ç”µé˜»å¼å•è§¦æ‘¸è§¦æ‘¸å±ï¼Œå¯èƒ½éœ€è¦é€€å›ä½¿ç”¨ tslib è€Œä¸æ˜¯ä¾èµ–äº Linux å¤šç‚¹è§¦æ§åè®®å’Œäº‹ä»¶è®¾å¤‡ã€‚å¯¹äºç°ä»£è§¦æ‘¸å±ï¼Œè¿™æ˜¯ä¸å¿…è¦çš„ã€‚tslib å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ QT_QPA_EGLFS_TSLIB æˆ– QT_QPA_FB_TSLIB1 æ¥å¯ç”¨æ”¯æŒã€‚è¦æ›´æ”¹è®¾å¤‡ï¼Œè¯· TSLIB_TSDEVICE åœ¨å‘½ä»¤è¡Œä¸­è®¾ç½®ç¯å¢ƒå˜é‡æˆ–ä¼ é€’è®¾å¤‡åç§°ã€‚è¯·æ³¨æ„ï¼Œtslib è¾“å…¥å¤„ç†ç¨‹åºç”Ÿæˆé¼ æ ‡äº‹ä»¶å¹¶æ”¯æŒå•è§¦æ‘¸ï¼Œè€Œä¸æ˜¯ evdevtouch ç”ŸæˆçœŸæ­£çš„å¤šç‚¹è§¦æ§ QTouchEvent äº‹ä»¶ã€‚ evdev è§¦æ‘¸å¤„ç†å™¨æ”¯æŒä»¥ä¸‹é¢å¤–çš„å‚æ•°ï¼š devinputâ€¦ - æŒ‡å®šè¾“å…¥è®¾å¤‡çš„åç§°ã€‚å½“æ²¡æœ‰ç»™å‡ºæ—¶ï¼ŒQt é€šè¿‡ libudev æˆ–é€šè¿‡å¯ç”¨èŠ‚ç‚¹æ¥æŸ¥æ‰¾åˆé€‚çš„è®¾å¤‡ã€‚ rotate- åœ¨æŸäº›è§¦æ‘¸å±ä¸Šï¼Œåæ ‡å¿…é¡»æ—‹è½¬ï¼Œè¿™å¯ä»¥é€šè¿‡è®¾ç½® rotate ä¸º 90,180 æˆ– 270 è¿›è¡Œã€‚ invertx å’Œ inverty- åè½¬è¾“å…¥äº‹ä»¶ä¸­çš„ X æˆ– Y åæ ‡ï¼Œé€šè¿‡ invertx æˆ– invertyã€‚ export QT_QPA_EVDEV_TOUCHSCREEN_PARAMETERS=/dev/input/event5:rotate=180 åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œä¼šå¯¼è‡´æ˜ç¡®æŒ‡å®šçš„è§¦æ‘¸è®¾å¤‡å¹¶ç¿»è½¬åæ ‡ - å½“å®é™…å±å¹•å’Œè§¦æ‘¸å±çš„æ–¹å‘ä¸åŒ¹é…æ—¶å¾ˆæœ‰ç”¨ã€‚ ç¬”å¼å¹³æ¿ç”µè„‘è¯¥ evdevtablet æ’ä»¶ä¸º Wacom å’Œç±»ä¼¼çš„åŸºäºç¬”çš„å¹³æ¿ç”µè„‘æä¾›äº†åŸºæœ¬çš„æ”¯æŒã€‚å®ƒä»…ç”Ÿæˆ QTabletEvent äº‹ä»¶ã€‚è¦å¯ç”¨å®ƒï¼Œè¯·ä¼ é€’ QT_QPA_GENERIC_PLUGINS=evdevtablet ç»™ç¯å¢ƒï¼Œæˆ–è€… -plugin evdevtablet åœ¨å‘½ä»¤è¡Œä¸­ä¼ é€’å‚æ•°ã€‚æ’ä»¶å¯ä»¥ä½¿ç”¨è®¾å¤‡èŠ‚ç‚¹å‚æ•°ï¼Œä¾‹å¦‚ QT_QPA_GENERIC_PLUGINS=evdevtablet:/dev/event1ï¼ŒQt çš„è‡ªåŠ¨è®¾å¤‡å‘ç°ï¼ˆåŸºäº libudev æˆ–æ¼”ç»ƒdevinputevent*ï¼‰ä¸èµ·ä½œç”¨æˆ–è¡Œä¸ºä¸æ­£å¸¸çš„æƒ…å†µã€‚ è°ƒè¯•è¾“å…¥è®¾å¤‡é€šè¿‡å¯ç”¨ qt.qpa.input æ—¥å¿—è§„åˆ™ï¼Œä¾‹å¦‚é€šè¿‡å°† QT_LOGGING_RULES ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºï¼Œå¯ä»¥å‘è°ƒè¯•è¾“å‡ºæ‰“å°ä¸€äº›ä¿¡æ¯ qt.qpa.inputtrueã€‚è¿™å¯¹äºæ£€æµ‹æ­£åœ¨ä½¿ç”¨å“ªä¸ªè®¾å¤‡æˆ–å¯¹è®¾å¤‡å‘ç°é—®é¢˜è¿›è¡Œæ•…éšœæ’é™¤éå¸¸æœ‰ç”¨ã€‚ ä½¿ç”¨è‡ªå®šä¹‰é¼ æ ‡å…‰æ ‡å›¾åƒeglfs è‡ªå¸¦çš„ 32x32 å°ºå¯¸çš„é¼ æ ‡å…‰æ ‡å›¾åƒã€‚å¦‚æœè¿™äº›è¿˜ä¸å¤Ÿï¼Œå¯ä»¥é€šè¿‡å°† QT_QPA_EGLFS_CURSOR ç¯å¢ƒå˜é‡è®¾ç½®ä¸º JSON æ–‡ä»¶çš„åç§°æ¥æä¾›è‡ªå®šä¹‰æ¸¸æ ‡åœ°å›¾é›†ã€‚è¯¥æ–‡ä»¶ä¹Ÿå¯ä»¥é€šè¿‡ Qt çš„èµ„æºç³»ç»ŸåµŒå…¥åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚ ä¾‹å¦‚ï¼Œæ¯è¡Œå…·æœ‰ 8 ä¸ªå…‰æ ‡å›¾åƒçš„åµŒå…¥å¼å…‰æ ‡å›¾é›†å¯ä»¥æŒ‡å®šå¦‚ä¸‹ï¼š imageï¼šï¼š/cursor-atlas.png\tcursorsPerRowï¼š8ï¼Œ\tçƒ­ç‚¹ï¼š[ [7ï¼Œ2] [12ï¼Œ3] [12ï¼Œ12] ...\t] è¯·æ³¨æ„ï¼Œå›¾åƒé¢„è®¡å°†ç´§ç´§åœ°åŒ…è£…åœ¨å›¾é›†ä¸­ï¼šå…‰æ ‡çš„å®½åº¦å’Œé«˜åº¦æ ¹æ®æ€»å›¾åƒå¤§å°å’Œ cursorsPerRow è®¾ç½®å†³å®šã€‚åœ°å›¾é›†å¿…é¡»ä¸ºæ‰€æœ‰æ”¯æŒçš„æ¸¸æ ‡æä¾›å›¾åƒã€‚ æ˜¾ç¤ºè¾“å‡ºå½“è¿æ¥å¤šä¸ªæ˜¾ç¤ºå™¨æ—¶ï¼Œä»ä¸€ä¸ªå•ä¸€ Qt åº”ç”¨ç¨‹åºä¸­å®šå‘ä¸€ä¸ªæˆ–å¤šä¸ªæ˜¾ç¤ºå™¨çš„æ”¯æŒçº§åˆ«åœ¨å¹³å°æ’ä»¶ä¹‹é—´å˜åŒ–ï¼Œå¹¶ä¸”é€šå¸¸å–å†³äºè®¾å¤‡åŠå…¶å›¾å½¢å †æ ˆã€‚ eglfs ä¸ eglfs_kms åç«¯å½“ KMS DRM åå°æ­£åœ¨ä½¿ç”¨æ—¶ï¼Œeglfs æŠ¥å‘Š QGuiApplication :: screensï¼ˆï¼‰ä¸­çš„æ‰€æœ‰å¯ç”¨å±å¹•ã€‚åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ä¸åŒçš„çª—å£é€šè¿‡ QWindow :: setScreenï¼ˆï¼‰æ¥å®šä½ä¸åŒçš„å±å¹•ã€‚ æ³¨æ„ï¼šæ¯ä¸ªå±å¹•çš„ä¸€ä¸ªå…¨å±çª—å£çš„é™åˆ¶ä»ç„¶é€‚ç”¨ã€‚ä½¿ QWindow å¯è§åæ›´æ”¹å±å¹•ä¹Ÿä¸å—æ”¯æŒã€‚å› æ­¤ï¼ŒåµŒå…¥å¼åº”ç”¨ç¨‹åºå¿…é¡»åœ¨è°ƒç”¨ QWindow :: showï¼ˆï¼‰ä¹‹å‰è¿›è¡Œæ‰€æœ‰å¿…è¦çš„ QWindow :: setScreenï¼ˆï¼‰è°ƒç”¨ã€‚ å½“å¼€å§‹åœ¨ç»™å®šçš„åµŒå…¥å¼è®¾å¤‡ä¸Šå¼€å‘æ—¶ï¼Œé€šå¸¸éœ€è¦éªŒè¯è®¾å¤‡å’Œé©±åŠ¨ç¨‹åºçš„è¡Œä¸ºï¼Œå¹¶ä¸”æ‰€è¿æ¥çš„æ˜¾ç¤ºå™¨åº”è¯¥æ˜¯æ­£å¸¸å·¥ä½œçš„ã€‚ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ hellowindow ç¤ºä¾‹ã€‚ç”¨-platform eglfs â€“multiscreen â€“timeout å‚æ•°å¯åŠ¨å®ƒåœ¨æ¯ä¸ªè¿æ¥çš„å±å¹•ä¸Šæ˜¾ç¤ºä¸€ä¸ªæ—‹è½¬çš„ Qt æ ‡å¿—å‡ ç§’é’Ÿã€‚ æ³¨æ„ï¼šä¸‹é¢æè¿°çš„å¤§å¤šæ•°é…ç½®é€‰é¡¹é€‚ç”¨äºæ‰€æœ‰åŸºäº KMS DRM çš„åç«¯ï¼Œæ— è®ºç¼“å†²ç®¡ç†æŠ€æœ¯ï¼ˆGBM æˆ– EGLStreamsï¼‰å¦‚ä½•ã€‚ KMS DRM åç«¯è¿˜æ”¯æŒé€šè¿‡ JSON æ–‡ä»¶è¿›è¡Œè‡ªå®šä¹‰é…ç½®ã€‚å°†ç¯å¢ƒå˜é‡è®¾ç½®ä¸º QT_QPA_EGLFS_KMS_CONFIG æ–‡ä»¶çš„åç§°ä»¥å¯ç”¨æ­¤åŠŸèƒ½ã€‚è¯¥æ–‡ä»¶ä¹Ÿå¯ä»¥é€šè¿‡ Qt èµ„æºç³»ç»ŸåµŒå…¥åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚ç¤ºä¾‹é…ç½®å¦‚ä¸‹ï¼š deviceï¼š/ dev / dri / card1ï¼Œ\thwcursorï¼šfalseï¼Œ\tpbuffersï¼šçœŸçš„ï¼Œ\tè¾“å‡ºï¼š[ nameï¼šVGA1ï¼Œ å…³é—­æ¨¡å¼ ï¼Œ nameï¼šHDMI1ï¼Œ modeï¼š1024x768 ] è¿™é‡Œä»¬é…ç½®æŒ‡å®šçš„è®¾å¤‡ å®ƒä¸ä¼šä½¿ç”¨ç¡¬ä»¶å…‰æ ‡ï¼ˆé€šè¿‡ OpenGL é€€å›æ¸²æŸ“é¼ æ ‡å…‰æ ‡;é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯ç”¨ç¡¬ä»¶å…‰æ ‡ï¼Œå› ä¸ºå®ƒä»¬æ›´æœ‰æ•ˆï¼‰ï¼Œ å®ƒå°†ä½¿ç”¨æ ‡å‡†çš„ EGL pbuffer è¡¨é¢è¿”å› QOffscreenSurfaceï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ç¦ç”¨çš„ï¼Œè€Œæ˜¯ä½¿ç”¨ gbm è¡¨é¢ï¼‰ï¼Œ VGA è¿æ¥å™¨ä¸Šçš„è¾“å‡ºè¢«ç¦ç”¨ï¼Œè€Œ HDMI å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ†è¾¨ç‡ä¸º 1024x768ã€‚ å¦å¤–ï¼Œè¿™æ ·çš„é…ç½®ä¹Ÿç¦ç”¨å¯»æ‰¾è®¾å¤‡ libudevï¼Œè€Œæ˜¯ä½¿ç”¨æŒ‡å®šçš„è®¾å¤‡ã€‚ ä½•æ—¶ mode æœªå®šä¹‰ï¼Œç³»ç»Ÿé€‰æ‹©æŠ¥å‘Šä¸ºé¦–é€‰çš„æ¨¡å¼ã€‚ä¸ºå¯æ¥å—çš„å€¼ mode æ˜¯ï¼šoffï¼Œcurrentï¼Œpreferredï¼Œå®½åº¦ x é«˜åº¦ï¼Œæˆ–æ¨¡å¼è¡Œå­—ç¬¦ä¸²ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒDRM å±‚æŠ¥å‘Šçš„æ‰€æœ‰å±å¹•éƒ½å°†è¢«è§†ä¸ºä¸€ä¸ªå¤§å‹è™šæ‹Ÿæ¡Œé¢ã€‚é¼ æ ‡å…‰æ ‡å®ç°å°†è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œå¹¶æŒ‰é¢„æœŸåœ¨å±å¹•ä¸Šç§»åŠ¨ã€‚å°½ç®¡ä¸æ¨èï¼Œè™šæ‹Ÿæ¡Œé¢æ¨¡å¼å¯ä»¥é€šè¿‡è®¾ç½®è¢«ç¦ç”¨ separateScreensï¼Œä»¥ false åœ¨é…ç½®ä¸Šï¼Œå¦‚æœéœ€è¦çš„è¯ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ¹æ®ç³»ç»ŸæŠ¥å‘Šçš„è¿æ¥å™¨é¡ºåºï¼Œè™šæ‹Ÿæ¡Œé¢ä»å·¦åˆ°å³å½¢æˆã€‚è¿™å¯ä»¥é€šè¿‡è®¾ç½® virtualIndex ä¸ºä» 0 å¼€å§‹çš„å€¼æ¥æ›´æ”¹ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹é…ç½®ä½¿ç”¨é¦–é€‰åˆ†è¾¨ç‡ï¼Œä½†ç¡®ä¿è™šæ‹Ÿæ¡Œé¢ä¸­çš„å·¦ä¾§æ˜¯å±å¹•è¿æ¥åˆ° HDMI ç«¯å£ï¼Œè€Œå³ä¾§æ˜¯å±å¹•è¿æ¥åˆ° DisplayPortï¼š deviceï¼šdrm-nvdcï¼Œ\tè¾“å‡ºï¼š[ nameï¼šHDMI1ï¼Œ virtualIndexï¼š0 ï¼Œ nameï¼šDP1ï¼Œ virtualIndexï¼š1 ] æ•°ç»„ä¸­çš„å…ƒç´ çš„é¡ºåºæ˜¯ä¸ç›¸å…³çš„ã€‚å…·æœ‰æœªæŒ‡å®šè™šæ‹Ÿç´¢å¼•çš„è¾“å‡ºå°†æ”¾åœ¨å…¶ä»–è™šæ‹Ÿç´¢å¼•ä¹‹åï¼Œå¹¶ä¿ç•™ DRM è¿æ¥å™¨åˆ—è¡¨ä¸­çš„åŸå§‹é¡ºåºã€‚ è¦åˆ›å»ºä¸€ä¸ªå‚ç›´çš„æ¡Œé¢ç©ºé—´ï¼ˆå³ï¼Œä»ä¸Šåˆ°ä¸‹è€Œä¸æ˜¯ä»å·¦åˆ°å³å †å ï¼‰ï¼Œæ·»åŠ ä¸€ä¸ª virtualDesktopLayout å±æ€§åé¢ device çš„å€¼ verticalã€‚ æ³¨æ„ï¼šå»ºè®®è™šæ‹Ÿæ¡Œé¢ä¸­çš„æ‰€æœ‰å±å¹•ä½¿ç”¨ç›¸åŒçš„åˆ†è¾¨ç‡ï¼Œå¦åˆ™åƒé¼ æ ‡å…‰æ ‡é‚£æ ·çš„å…ƒç´ å¯èƒ½ä¼šåœ¨è¾“å…¥ä»…å­˜åœ¨äºä¸€ä¸ªç»™å®šå±å¹•ä¸Šçš„åŒºåŸŸæ—¶ä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼è¿è¡Œã€‚ ä½•æ—¶ virtualIndex ä¸å¤Ÿï¼Œè¯¥å±æ€§ virtualPos å¯ç”¨äºæ˜ç¡®æŒ‡å®šé—®é¢˜å±å¹•çš„å·¦ä¸Šè§’ä½ç½®ã€‚ä»¥å‰é¢çš„ä¾‹å­ï¼Œå‡è®¾ HDMI1 çš„åˆ†è¾¨ç‡ä¸º 1080pï¼Œä¸‹é¢ç¬¬ä¸€ä¸ªåŸºäº HDMI çš„å±å¹•æ”¾åœ¨ç¬¬ä¸€ä¸ªï¼š ...\tè¾“å‡ºï¼š[ ... nameï¼šHDMI2ï¼Œ virtualPosï¼š0ï¼Œ1080 ] æ³¨æ„ï¼šåœ¨éœ€è¦é¼ æ ‡æ”¯æŒæ—¶é¿å…è¿™æ ·çš„é…ç½®ã€‚é¼ æ ‡å…‰æ ‡çš„è¡Œä¸ºå¯èƒ½æ˜¯æ„æƒ³ä¸åˆ°çš„éçº¿æ€§å¸ƒå±€ã€‚Touch åº”è¯¥æ²¡æœ‰é—®é¢˜ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé€šè¿‡ DRM è‡ªåŠ¨æŸ¥è¯¢ç‰©ç†å±å¹•å°ºå¯¸å¯èƒ½ä¼šå¤±è´¥ã€‚é€šå¸¸ QT_QPA_EGLFS_PHYSICAL_WIDTHï¼ŒQT_QPA_EGLFS_PHYSICAL_HEIGHT ç¯å¢ƒå˜é‡å°†ç”¨äºæä¾›ç¼ºå¤±å€¼ï¼Œä½†æ˜¯å½“å­˜åœ¨å¤šä¸ªå±å¹•æ—¶ï¼Œè¿™å¹¶ä¸é€‚ç”¨ã€‚è€Œæ˜¯ä½¿ç”¨åˆ—è¡¨ä¸­çš„ physicalWidth å’Œ physicalHeight å±æ€§ outputs æ¥æŒ‡å®šä»¥æ¯«ç±³ä¸ºå•ä½çš„å¤§å°ã€‚ æ³¨æ„ï¼šä¸åŒçš„ç‰©ç†å°ºå¯¸å’Œä¸åŒçš„é€»è¾‘ DPI ä¸é¼“åŠ±ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„é—®é¢˜ï¼Œå› ä¸ºä¸€äº›å›¾å½¢å †æ ˆç»„ä»¶ä¸çŸ¥é“å¤šä¸ªå±å¹•ï¼Œä»…ä¾é ç¬¬ä¸€ä¸ªå±å¹•çš„å€¼ã€‚ ä»æ¯ä¸ªæœ‰æºè¾“å‡º outputs é˜µåˆ—å¯¹åº”äºä¸€ä¸ª QScreen ä»æŠ¥å‘Šå®ä¾‹ QGuiApplication ::å±å¹•ï¼ˆï¼‰ã€‚QGuiApplication :: primaryScreenï¼ˆï¼‰æŠ¥å‘Šçš„ä¸»å±å¹•æ˜¯é»˜è®¤é¦–å…ˆæ³¨å†Œçš„å±å¹•ã€‚å½“ä¸ä½¿ç”¨æ—¶ virtualIndexï¼Œè¿™æ„å‘³ç€å†³å®šæ˜¯åŸºäº DRM è¿æ¥å™¨é¡ºåºã€‚è¦è¦†ç›–è¿™ä¸€ç‚¹ï¼Œå±æ€§è®¾ç½® primaryï¼Œä»¥ true å¯¹åœ¨æ‰€éœ€çš„æ¡ç›® outputs åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œä¸ºäº†ç¡®ä¿ä¸ VGA è¾“å‡ºç›¸å¯¹åº”çš„å±å¹•å°†æ˜¯ä¸»è¦çš„ï¼Œå³ä½¿ç³»ç»Ÿé¦–å…ˆæŠ¥å‘Š HDMIï¼Œåˆ™å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š deviceï¼š/ dev / dri / card0ï¼Œ\tè¾“å‡ºï¼š[ nameï¼šHDMI1ï¼Œ nameï¼šVGA1ï¼Œmodeï¼š1280x720ï¼Œprimaryï¼štrueï¼Œ nameï¼šLVDS1ï¼Œmodeï¼šoff\t] ä¸ºäº†è¿›è¡Œæ•…éšœæ’é™¤ï¼Œå¯èƒ½ä¼šå¯ç”¨ KMS DRM åç«¯çš„è°ƒè¯•æ—¥å¿—ã€‚ä¸ºæ­¤ï¼Œå¯ç”¨åˆ†ç±»æ—¥å¿—è®°å½•è§„åˆ™ qt.qpa.eglfs.kmsã€‚ æ³¨æ„ï¼šåœ¨åµŒå…¥å¼ç¯å¢ƒä¸­ï¼Œè™šæ‹Ÿæ¡Œé¢æ¯”å…¨çª—å£ç³»ç»Ÿæ›´ä¸ºæœ‰é™ã€‚åº”è¯¥é¿å… Windows é‡å å¤šä¸ªå±å¹•ï¼Œéå…¨å±çª—å£å’Œå±å¹•ä¹‹é—´çš„ç§»åŠ¨çª—å£ï¼Œå¹¶ä¸”å¯èƒ½æ— æ³•æ­£å¸¸è¿è¡Œã€‚ å¤šå±å¹•è®¾ç½®æœ€å¸¸ç”¨å’Œæœ€å—æ”¯æŒçš„ç”¨ä¾‹æ˜¯ä¸ºæ¯ä¸ªå±å¹•æ‰“å¼€ä¸€ä¸ªä¸“ç”¨çš„ QQuickWindow æˆ– QQuickViewã€‚ä½¿ç”¨ threadedQt Quick åœºæ™¯å›¾çš„é»˜è®¤æ¸²æŸ“å¾ªç¯ï¼Œè¿™äº›çª—å£ä¸­çš„æ¯ä¸ªéƒ½å°†è·å¾—è‡ªå·±çš„ä¸“ç”¨æ¸²æŸ“çº¿ç¨‹ã€‚è¿™æ˜¯å¾ˆå¥½çš„ï¼Œå› ä¸ºçº¿ç¨‹å¯ä»¥åŸºäº vsync ç‹¬ç«‹è°ƒèŠ‚ï¼Œå¹¶ä¸”ä¸ä¼šç›¸äº’å¹²æ‰°ã€‚é€šè¿‡ basic å¾ªç¯ï¼Œè¿™å¯èƒ½ä¼šäº§ç”Ÿé—®é¢˜ï¼ŒåŠ¨ç”»å¯èƒ½ä¼šå› æ­¤è€Œæ¶åŒ–ã€‚ ä¾‹å¦‚ï¼Œå‘ç°æ‰€æœ‰è¿æ¥çš„å±å¹•ï¼Œå¹¶ä¸ºæ¯ä¸ªå±å¹•åˆ›å»ºä¸€ä¸ª QQuickView å¯ä»¥è¿™æ ·å®Œæˆï¼š int main(int argc, char **argv) QGuiApplication app(argc, argv); QVectorQQuickView *views; for(QScreen * screen : app.screens()) QQuickView * view = new QQuickView; view-setScreen(screen); view-setResizeMode(QQuickView::SizeRootObjectToView); view-setSource(QUrl(qrc:/main.qml)); QObject::connect(view-engine(), QQmlEngine::quit, qGuiApp, QCoreApplication::quit); views.append(view); view-showFullScreen(); int result = app.exec(); qDeleteAll(views); eglfs ä¸ eglfs_kms_egldevice åç«¯é€šå¸¸åœ¨ Tegra è®¾å¤‡ä¸Šä½¿ç”¨çš„è¿™ç§åç«¯ä¸ä¸Šè¿° KMS DRM åç«¯ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒä¾èµ–äº EGLDevice å’Œ EGLStream æ‰©å±•è€Œä¸æ˜¯ GBMã€‚ æœ‰å…³æ­¤æ–¹æ³•çš„æŠ€æœ¯ç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹æ¼”ç¤ºæ–‡ç¨¿ã€‚ æˆªè‡³ Qt 5.7ï¼Œè¯¥åç«¯ä¸åŸºäº GBM çš„åç«¯å…±äº«äº†è®¸å¤šå†…éƒ¨å®ç°ã€‚è¿™æ„å‘³ç€æ”¯æŒå¤šä¸ªå±å¹•å’Œé«˜çº§é…ç½®é€šé“ QT_QPA_EGLFS_KMS_CONFIGã€‚ä¸€äº›è®¾ç½®ï¼Œå¦‚ hwcursor å’Œ pbuffers ä¸é€‚ç”¨ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œåç«¯å°†è‡ªåŠ¨ä¸ºæ¯ä¸ªè¾“å‡ºçš„é»˜è®¤å¹³é¢é€‰æ‹©æ­£ç¡®çš„ EGL å±‚ã€‚å¿…è¦æ—¶ï¼Œå¯ä»¥é€šè¿‡å°† QT_QPA_EGLFS_LAYER_INDEX ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºæ‰€éœ€å±‚çš„ç´¢å¼•æ¥è¦†ç›–ã€‚æ­¤æ–¹æ³•ç›®å‰ä¸æ”¯æŒå¤šä¸ªè¾“å‡ºï¼Œå› æ­¤å…¶ä½¿ç”¨åº”é™äºå…·æœ‰å•ä¸ªå±å¹•çš„ç³»ç»Ÿã€‚è¦æŸ¥çœ‹å“ªäº›å±‚å¯ç”¨ï¼Œå¹¶è°ƒè¯•æ½œåœ¨çš„å¯åŠ¨é—®é¢˜ï¼Œè¯·å¯ç”¨æ—¥å¿—è®°å½•ç±»åˆ« qt.qpa.eglfs.kmsã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå³ä½¿å±å¹•æŠ¥å‘Šå·²ç»è®¾ç½®äº†æ‰€éœ€åˆ†è¾¨ç‡ï¼Œä¹Ÿå¯èƒ½éœ€è¦æ‰§è¡Œåº”ç”¨ç¨‹åºå¯åŠ¨æ—¶è®¾ç½®çš„è§†é¢‘æ¨¡å¼ã€‚è¿™é€šå¸¸æ˜¯è¢«ä¼˜åŒ–çš„ï¼Œä½†å¦‚æœå±å¹•ä¿æŒå…³é—­çŠ¶æ€ï¼Œè¯·å°è¯•å°†ç¯å¢ƒå˜é‡è®¾ç½®ä¸º QT_QPA_EGLFS_ALWAYS_SET_MODE éé›¶å€¼å¹¶é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºã€‚ è¦é…ç½®åç«¯ä½¿ç”¨çš„ EGLStream å¯¹è±¡çš„è¡Œä¸ºï¼Œè¯·ä½¿ç”¨ QT_QPA_EGLFS_STREAM_FIFO_LENGTH ç¯å¢ƒå˜é‡ã€‚è¿™å‡å®š KHR_stream_fifo æ˜¯ç›®æ ‡ç³»ç»Ÿæ”¯æŒçš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæµä»¥é‚®ç®±æ¨¡å¼è¿è¡Œã€‚è¦åˆ‡æ¢åˆ° FIFO æ¨¡å¼ï¼Œè¯·è®¾ç½® 1 æˆ–æ›´å¤§çš„å€¼ã€‚è¯¥å€¼æŒ‡å®šæµå¯ä»¥å®¹çº³çš„æœ€å¤§å¸§æ•°ã€‚ åœ¨æŸäº›ç³»ç»Ÿä¸Šï¼Œå¯èƒ½éœ€è¦é€šè¿‡é¢„å®šä¹‰çš„è¿æ¥å™¨æ¥å®šä½ç‰¹å®šçš„è¦†ç›–å¹³é¢ã€‚å¼ºåˆ¶å±‚ç´¢å¼•é€šè¿‡ QT_QPA_EGLFS_LAYER_INDEX ä¸æ‰§è¡Œå¹³é¢é…ç½®ï¼Œå› æ­¤æœ¬èº«ä¸é€‚ç”¨ã€‚ç›¸åï¼Œåœ¨è¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œä½¿ç”¨ QT_QPA_EGLFS_KMS_CONNECTOR_INDEX å’Œ QT_QPA_EGLFS_KMS_PLANE_INDEX ç¯å¢ƒå˜é‡ã€‚å½“è¿™äº›è®¾ç½®è¢«è®¾ç½®æ—¶ï¼Œåªæœ‰æŒ‡å®šçš„è¿æ¥å™¨å’Œå¹³é¢å°†è¢«ä½¿ç”¨ï¼Œæ‰€æœ‰å…¶ä»–è¾“å‡ºå°†è¢«å¿½ç•¥ã€‚åç«¯å°†è´Ÿè´£é€‰æ‹©å¯¹åº”äºæ‰€éœ€å¹³é¢çš„ EGL å±‚å’Œé…ç½®å¹³é¢ã€‚ åœ¨ KMS DRM ä¸Šæœ‰å¤šä¸ªå±å¹•çš„ç³»ç»Ÿä¸­è§¦æ‘¸è¾“å…¥è§¦æ‘¸å±åœ¨å¤šæ˜¾ç¤ºç³»ç»Ÿä¸­éœ€è¦é¢å¤–çš„è€ƒè™‘å› ç´ ï¼Œå› ä¸ºè§¦æ‘¸äº‹ä»¶å¿…é¡»è·¯ç”±åˆ°æ­£ç¡®çš„è™šæ‹Ÿå±å¹•ï¼Œè¿™éœ€è¦è§¦æ‘¸å±å’Œæ˜¾ç¤ºå™¨è¾“å‡ºä¹‹é—´çš„æ­£ç¡®æ˜ å°„ã€‚ æ˜ å°„é€šè¿‡ QT_QPA_EGLFS_KMS_CONFIG å‰é¢éƒ¨åˆ†ä¸­æŒ‡å®šå’Œæè¿°çš„ JSON é…ç½®æ–‡ä»¶å®Œæˆã€‚å½“ touchDevice å±æ€§å­˜åœ¨äº outputs æ•°ç»„çš„å…ƒç´ ä¸­æ—¶ï¼Œè¯¥å€¼è¢«è§†ä¸ºè®¾å¤‡èŠ‚ç‚¹ï¼Œå¹¶ä¸”è§¦æ‘¸è®¾å¤‡ä¸æ‰€è®¨è®ºçš„æ˜¾ç¤ºè¾“å‡ºç›¸å…³è”ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾ä»¬çš„è§¦æ‘¸å±å…·æœ‰ dev input event5 çš„è®¾å¤‡èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ˜¯é›†æˆåˆ°é€šè¿‡ HDMI è¿æ¥çš„æ˜¾ç¤ºå™¨ä½œä¸ºè¾…åŠ©å±å¹•çš„è§¦æ‘¸å±ï¼Œä»¥ä¸‹é…ç½®ç¡®ä¿æ­£ç¡®çš„è§¦æ‘¸ï¼ˆå’Œåˆæˆé¼ æ ‡ï¼‰äº‹ä»¶è½¬æ¢ï¼š deviceï¼šdrm-nvdcï¼Œ\tè¾“å‡ºï¼š[ nameï¼šHDMI1ï¼Œ touchDeviceï¼š/ dev / input / event5ï¼Œ virtualIndexï¼š1 ï¼Œ nameï¼šDP1ï¼Œ virtualIndexï¼š0 ] æ³¨æ„ï¼šå¦‚æœ‰ç–‘é—®ï¼Œè¯· QT_LOGGING_RULES=qt.qpa.*=true åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºä¹‹å‰é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡æ¥å¯ç”¨å›¾å½¢å’Œè¾“å…¥å­ç³»ç»Ÿçš„æ—¥å¿—è®°å½•ã€‚è¿™å°†æœ‰åŠ©äºè¯†åˆ«æ­£ç¡®çš„è¾“å…¥è®¾å¤‡èŠ‚ç‚¹ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå‘ç°å¯èƒ½éš¾ä»¥è°ƒè¯•çš„è¾“å‡ºé…ç½®é—®é¢˜ã€‚ æ³¨æ„ï¼šä» Qt 5.8 èµ·ï¼Œä¸Šè¿°åªæ”¯æŒ evdevtouch è¾“å…¥åç«¯ã€‚å…¶ä»–å˜ä½“ï¼Œä¾‹å¦‚åŸºäº libinput çš„å˜ä½“ï¼Œå°†ç»§ç»­å°†äº‹ä»¶è·¯ç”±åˆ°ä¸»å±å¹•ã€‚è¦å¼ºåˆ¶åœ¨å…·æœ‰å¤šä¸ªè¾“å…¥åç«¯çš„ç³»ç»Ÿä¸Šä½¿ç”¨ evdevtouchï¼Œè¯·å°†ç¯å¢ƒå˜é‡è®¾ç½® QT_QPA_EGLFS_NO_LIBINPUT ä¸º 1ã€‚ eglfs ä¸å…¶ä»–åç«¯é€šå¸¸åŸºäºé€šè¿‡ä¾›åº”å•†çš„ EGL å®ç°ç›´æ¥é’ˆå¯¹å¸§ç¼“å†²åŒºæˆ–ç»„åˆ API çš„å…¶ä»–åç«¯ï¼Œé€šå¸¸å¯¹å¤šä¸ªæ˜¾ç¤ºå™¨æä¾›æœ‰é™æˆ–ä¸æ”¯æŒçš„æ”¯æŒã€‚åœ¨ä½¿ç”¨ Vivante GPU çš„åŸºäº i.MX6 çš„ç”µè·¯æ¿ä¸Šï¼Œä¸ linuxfb ç±»ä¼¼ï¼ŒQT_QPA_EGLFS_FB ç¯å¢ƒå˜é‡å¯ç”¨äºæŒ‡å®šè¦ç¼“å­˜çš„å¸§ç¼“å†²åŒºã€‚åœ¨ Raspberry Pi ä¸Šï¼ŒQT_QPA_EGLFS_DISPMANX_ID ç¯å¢ƒå˜é‡å¯ç”¨äºæŒ‡å®šè¦è¾“å‡ºçš„å±å¹•ã€‚è¯¥å€¼å¯¹åº”äºå…¶ä¸­ä¸€ä¸ª DISPMANX_ID_ å¸¸é‡ï¼Œè¯·å‚è€ƒ Dispmanx æ–‡æ¡£ã€‚è¯·æ³¨æ„ï¼Œä¸ KMS / DRM ä¸åŒï¼Œè¿™äº›æ–¹æ³•é€šå¸¸ä¸å…è®¸ä»åŒä¸€åº”ç”¨ç¨‹åºè¾“å‡ºåˆ°å¤šä¸ªå±å¹•ã€‚æˆ–è€…ï¼Œé©±åŠ¨ç¨‹åºç‰¹å®šçš„ç¯å¢ƒå˜é‡æˆ–å†…æ ¸å‚æ•°ä¹Ÿå¯ä»¥ç”¨äºæ§åˆ¶æ‰€ä½¿ç”¨çš„å¸§ç¼“å†²åŒºã€‚ è§†é¢‘å†…å­˜å…·æœ‰å›ºå®šæ•°é‡çš„ä¸“ç”¨è§†é¢‘å†…å­˜çš„ç³»ç»Ÿåœ¨è¿è¡ŒåŸºäº Qt Quick çš„ Qt åº”ç”¨ç¨‹åºæˆ–ç±»ä¼¼ QOpenGLWidget çš„ç±»ä¹‹å‰ï¼Œå¯èƒ½éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚å¯¹äºè¿™æ ·çš„åº”ç”¨ï¼Œé»˜è®¤è®¾ç½®å¯èƒ½ä¸è¶³ï¼Œç‰¹åˆ«æ˜¯å½“å®ƒä»¬ä»¥é«˜åˆ†è¾¨ç‡ï¼ˆä¾‹å¦‚ï¼Œå…¨é«˜æ¸…ï¼‰å±å¹•æ˜¾ç¤ºæ—¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»–ä»¬å¯èƒ½ä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼å¼€å§‹å¤±è´¥ã€‚å»ºè®®ç¡®ä¿è‡³å°‘æœ‰ 128 MB çš„ GPU å†…å­˜å¯ç”¨ã€‚å¯¹äºæ²¡æœ‰ä¸º GPU ä¿ç•™çš„å›ºå®šå†…å­˜é‡çš„ç³»ç»Ÿï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚ linuxfbä½¿ç”¨ fbplugin å‚æ•°æŒ‡å®šè¦ä½¿ç”¨çš„ framebuffer è®¾å¤‡ã€‚ Unix ä¿¡å·å¤„ç†ç¨‹åºé¢å‘æ§åˆ¶å°çš„å¹³å°æ’ä»¶ï¼Œå¦‚ eglfs å’Œ linuxfb é»˜è®¤å®‰è£…ä¿¡å·å¤„ç†ç¨‹åºæ¥æ•è· interruptï¼ˆSIGINTï¼‰ï¼Œsuspend å’Œ continueï¼ˆSIGTSTPï¼ŒSIGCONTï¼‰å’Œ terminateï¼ˆSIGTERMï¼‰ã€‚è¿™æ ·ï¼Œå½“åº”ç”¨ç¨‹åºç»ˆæ­¢æˆ–ç”±äº kill æˆ– Ctrl+C æˆ–æš‚åœæ—¶ï¼Œå¯ä»¥æ¢å¤é”®ç›˜ï¼Œç»ˆç«¯å…‰æ ‡å’Œå¯èƒ½çš„å…¶ä»–å›¾å½¢çŠ¶æ€ Ctrl+Zã€‚ï¼ˆå°½ç®¡é€šè¿‡é”®ç›˜ç»ˆæ­¢æˆ–æš‚åœåªèƒ½åœ¨ QT_QPA_ENABLE_TERMINAL_KEYBOARD è®¾ç½®æ—¶è¿›è¡Œï¼Œå¦‚ä¸Šé¢çš„â€è¾“å…¥â€éƒ¨åˆ†æ‰€è¿°ï¼‰ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ•è· SIGINT å¯èƒ½æ˜¯ä¸åˆéœ€è¦çš„ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šä¸è¿œç¨‹è°ƒè¯•å†²çªã€‚å› æ­¤ï¼ŒQT_QPA_NO_SIGNAL_HANDLER æä¾›ç¯å¢ƒå˜é‡ä»¥é€‰æ‹©é€€å‡ºæ‰€æœ‰å†…ç½®ä¿¡å·å¤„ç†ã€‚ å­—ä½“Qt é€šå¸¸ç”¨äº fontconfig æä¾›å¯¹ç³»ç»Ÿå­—ä½“çš„è®¿é—®ã€‚å¦‚æœ fontconfig ä¸å¯ç”¨ï¼ŒQt ä¼šå›é€€ä½¿ç”¨ QBasicFontDatabaseã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒQt åº”ç”¨ç¨‹åºå°†åœ¨ Qt çš„ libfonts ç›®å½•ä¸­æŸ¥æ‰¾å­—ä½“ã€‚Qt ä¼šè‡ªåŠ¨æ£€æµ‹é¢„æ¸²æŸ“çš„å­—ä½“å’Œ TrueType å­—ä½“ã€‚å¯ä»¥é€šè¿‡è®¾ç½® QT_QPA_FONTDIR ç¯å¢ƒå˜é‡æ¥è¦†ç›–æ­¤ç›®å½•ã€‚ æœ‰å…³æ”¯æŒçš„æ ¼å¼çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…åµŒå…¥å¼ Linux å­—ä½“çš„ Qtã€‚ æ³¨æ„ï¼š Qt ä¸å†åœ¨ libfonts ç›®å½•ä¸­è£…è½½ä»»ä½•å­—ä½“ã€‚è¿™æ„å‘³ç€ç”±å¹³å°ï¼ˆç³»ç»Ÿæ˜ åƒï¼‰æä¾›å¿…è¦çš„å­—ä½“ã€‚ åµŒå…¥å¼ Linux è®¾å¤‡ä¸Šçš„çª—å£ç³»ç»Ÿçš„å¹³å°æ’ä»¶XCBXCB æ˜¯ç”¨äºå¸¸è§„æ¡Œé¢ Linux å¹³å°ä¸­çš„ X11 æ’ä»¶ï¼Œå®ƒåœ¨è®¸å¤šåµŒå…¥å¼ç¯å¢ƒä¸­å¾—åˆ°åº”ç”¨ã€‚å®ƒæä¾›äº†å¿…è¦çš„ X11 ç»„ä»¶åŠå¼€å‘æ–‡ä»¶ï¼Œä½¿ç”¨æ–¹æ³•ä¸Šä¸åœ¨æ™®é€š PC æ¡Œé¢ä¸Šå®Œå…¨ä¸€è‡´ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ç†Ÿæ‚‰çš„å·¥å…·è¿›è¡Œå¼€å‘ã€‚ å…¼å®¹æ€§é—®é¢˜åœ¨æŸäº›åµŒå…¥å¼è®¾å¤‡ä¸Šï¼Œå¯èƒ½ä¼šé­é‡å…¼å®¹æ€§é—®é¢˜ã€‚å°¤å…¶æ˜¯åœ¨ EGL å®ç°ä¸ Xlib ä¸å…¼å®¹çš„æƒ…å†µä¸‹ï¼ŒEGL å’Œ OpenGL æ”¯æŒå¯èƒ½ä¼šç¼ºå¤±ã€‚å¯¹æ­¤ï¼ŒXCB æ’ä»¶å°±ä¼šåœ¨æ²¡æœ‰ EGL æ”¯æŒçš„æƒ…å†µä¸‹æ„å»ºã€‚è¿™æ„å‘³ç€å¼€å‘è€…éœ€è¦æ³¨æ„ï¼ŒåŸºäº Qt Quick 2 æˆ–å…¶ä»–ä¾èµ– OpenGL çš„åº”ç”¨ç¨‹åºåœ¨è¿™æ ·çš„ç¯å¢ƒä¸‹æ— æ³•è¿è¡Œã€‚ ç„¶è€Œï¼Œæœ‰ä¸€äº›åº”ç”¨ä»ç„¶èƒ½å¤Ÿåœ¨è¿™ç§é™åˆ¶ä¸‹æ­£å¸¸å·¥ä½œã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ QWidget çš„è½¯ä»¶æ¸²æŸ“åº”ç”¨ç¨‹åºå¯ä»¥åœ¨æ²¡æœ‰ OpenGL åŠ é€Ÿçš„æƒ…å†µä¸‹é¡ºåˆ©è¿è¡Œã€‚å› æ­¤ï¼Œå¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰å¯¹å›¾å½¢æ€§èƒ½è¦æ±‚æé«˜çš„æƒ…æ™¯ï¼ŒXCB ä»ç„¶å¯ä»¥æ˜¯ä¸€ä¸ªé€‚åˆçš„é€‰æ‹©ã€‚ æ€§èƒ½è€ƒè™‘é€šå¸¸æ¥è¯´ï¼ŒXCB åœ¨åµŒå…¥å¼è®¾å¤‡ç³»ä¸­å¹¶ä¸æ˜¯é¦–é€‰ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºä»…ä½¿ç”¨ XCB åœ¨æ€§èƒ½å’Œèµ„æºä½¿ç”¨æ–¹é¢å¯èƒ½éš¾ä»¥æ»¡è¶³éœ€æ±‚ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œé€‰æ‹©åƒ eglfs è¿™æ ·çš„æ›¿ä»£æ’ä»¶ï¼Œä¼šæœ‰æ•ˆæå‡æ€§èƒ½å¹¶å®ç°ç¡¬ä»¶åŠ é€Ÿã€‚è¿™ç§æ–¹æ³•èƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨è®¾å¤‡çš„å›¾å½¢å¤„ç†èƒ½åŠ›ï¼Œé€‚åˆéœ€è¦å¤„ç†å¤æ‚å›¾å½¢æˆ–é«˜å¸§ç‡çš„åº”ç”¨åœºæ™¯ã€‚ WaylandWayland æ˜¯ä¸€ä¸ªè½»é‡çº§çš„çª—å£ç³»ç»Ÿï¼Œå®ƒä¸ä»…æ˜¯ä¸€ä¸ªå¼€æºç³»ç»Ÿï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒä¸ºå®¢æˆ·ç«¯ä¸æ˜¾ç¤ºæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æä¾›äº†ä¸€ç§ç°ä»£åŒ–çš„åè®®ã€‚è¿™ä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿåœ¨é«˜æ•ˆä¸”çµæ´»çš„ç¯å¢ƒä¸­åˆ›å»ºåº”ç”¨ã€‚ Qt Wayland æ¨¡å—åˆ©ç”¨ Qt Wayland æ¨¡å—ï¼Œå¼€å‘è€…å¯ä»¥å®ç°ä¸ Wayland åˆæˆå™¨çš„è¿æ¥ã€‚è¿™ä¸º Qt åº”ç”¨ç¨‹åºæä¾›äº†ç›´æ¥ä¸ Wayland äº¤äº’çš„èƒ½åŠ›ã€‚å®é™…ä¸Šï¼Œè¿™ä¸€æ¨¡å—ç®€åŒ–äº†å¯¹ç°ä»£æ˜¾ç¤ºåè®®çš„æ”¯æŒï¼Œå› æ­¤åœ¨å¼€å‘ä¸­æ–°æ‰‹ä¹Ÿèƒ½æ¯”è¾ƒè½»æ¾åœ°å¤„ç†åº”ç”¨ç¨‹åºçš„æ˜¾ç¤ºé€»è¾‘ã€‚ è¾“å…¥è®¾å¤‡é—®é¢˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½¿ç”¨ Weston ä½œä¸ºå‚è€ƒåˆæˆå™¨æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°è§¦æ‘¸å±è¾“å…¥é—®é¢˜ã€‚è¿™ç§æƒ…å†µå¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒï¼Œæ¯”å¦‚è§¦æ‘¸äº‹ä»¶æ— æ³•è¢«æ­£ç¡®è¯†åˆ«æˆ–ååº”è¿Ÿç¼“ç­‰ã€‚å¼€å‘è€…åº”è¯¥å¯¹æ­¤è¿›è¡Œæµ‹è¯•ï¼Œå¹¶æ ¹æ®å…·ä½“çš„è§¦æ‘¸å±è®¾å¤‡è°ƒæ•´ç›¸å…³è®¾ç½®ä»¥ç¡®ä¿åº”ç”¨èƒ½å¤Ÿæ­£å¸¸å“åº”ç”¨æˆ·æ“ä½œã€‚ åœ¨æ€»ç»“ä¸­ï¼Œæ— è®ºæ˜¯é€‰æ‹© XCB è¿˜æ˜¯ Waylandï¼Œéƒ½éœ€è¦æ ¹æ®å…·ä½“çš„åµŒå…¥å¼è®¾å¤‡è§„æ ¼ä»¥åŠåº”ç”¨éœ€æ±‚æ¥åšå‡ºåˆ¤æ–­ã€‚ä¸åŒæ’ä»¶åœ¨æ€§èƒ½ã€å…¼å®¹æ€§å’Œå¼€å‘ä¾¿åˆ©æ€§ä¸Šçš„è¡¨ç°å­˜åœ¨å·®å¼‚ï¼Œé€‚åˆçš„é€‰æ‹©å°†å¤§å¤§æå‡é¡¹ç›®æˆåŠŸçš„å¯èƒ½æ€§ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"åµŒå…¥å¼ä»‹ç»","path":"/2024/08/06/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-åµŒå…¥å¼ä»‹ç»/","content":"åµŒå…¥å¼ linux å¼€å‘ä»‹ç»åµŒå…¥å¼ç³»ç»Ÿç®€ä»‹ ä¸€èˆ¬å®šä¹‰ ä»¥åº”ç”¨ä¸ºä¸­å¿ƒã€ä»¥è®¡ç®—æœºæŠ€æœ¯ä¸ºåŸºç¡€ã€è½¯ä»¶ç¡¬ä»¶å¯è£å‰ªã€é€‚åº”åº”ç”¨ç³»ç»Ÿï¼Œå¯¹åŠŸèƒ½ã€å¯é æ€§ã€æˆæœ¬ã€ä½“ç§¯ã€åŠŸè€—ä¸¥æ ¼è¦æ±‚çš„ä¸“ç”¨è®¡ç®—æœºç³»ç»Ÿ å¹¿ä¹‰ä¸Šè®² å‡¡æ˜¯å¸¦æœ‰å¾®å¤„ç†å™¨çš„ä¸“ç”¨è½¯ç¡¬ä»¶ç³»ç»Ÿéƒ½å¯ç§°ä¸ºåµŒå…¥å¼ç³»ç»Ÿã€‚ åµŒå…¥å¼ç³»ç»Ÿåˆåˆ†ä¸ºå¤šä¸ªæ¨¡å—éƒ¨åˆ† ARM é‡è§†ç†è®ºå®è·µ ç³»ç»Ÿç§»æ¤ é‡è§†æµç¨‹ é©±åŠ¨ é‡è§†æ¡†æ¶ åµŒå…¥å¼ç³»ç»Ÿçš„ç»„æˆ è½¯ä»¶ï¼ˆlinuxï¼ŒVXwork + åº”ç”¨ç¨‹åºï¼‰ ç¡¬ä»¶ï¼ˆC51ï¼Œstm32ï¼Œ armï¼Œmips powerpc + DRAM emmc uartï¼‰ win BIOS win ç³»ç»Ÿ æ–‡ä»¶ç³»ç»ŸåŠ è½½é©±åŠ¨ åº”ç”¨ç¨‹åº linux bootloaderï¼ˆå¼•å¯¼ç¨‹åºï¼‰ linux å†…æ ¸ æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ åº”ç”¨ç¨‹åº è¿è¡Œæ“ä½œç³»ç»Ÿçš„ä¼˜ç‚¹ï¼š æ–¹ä¾¿å¼€å‘ å°†ç¡¬ä»¶ä¸è½¯ä»¶éš”ç¦»ï¼ˆä¿æŠ¤ç¡¬ä»¶ï¼‰ åµŒå…¥å¼ linnux ç³»ç»Ÿç§»æ¤åšå“ªäº›å·¥ä½œäº§å“å‡çº§ï¼ˆäº§å“æ·»åŠ æŸäº›åŠŸèƒ½æ¨¡å—ï¼Œäº§å“è£å‰ªäº†æŸäº›åŠŸèƒ½æ¨¡å—ï¼ŒA8 â€“ã€‹ A9 åµŒå…¥å¼å¼€å‘ç¯å¢ƒçš„æ­å»ºé‡‡ç”¨çš„äº¤å‰å¼€å‘æ¨¡å¼ï¼Œå³ç¼–è¯‘å’Œè¿è¡Œä¸åœ¨åŒä¸€å°ä¸»æœºä¸Š GCC ç®€ä»‹Gcc çš„ç¼–è¯‘æµç¨‹ï¼š é¢„å¤„ç† gcc -E ç¼–è¯‘ gcc -S æ±‡ç¼– gcc -c é“¾æ¥ gcc gcc å·¥å…·é›† readelfï¼šåŠŸèƒ½ï¼šreadelf å¯ä»¥æ˜¾ç¤º elf æ ¼å¼å¯æ‰§è¡Œæ–‡ä»¶çš„ä¿¡æ¯ sizeï¼šåŠŸèƒ½ï¼šsize åˆ—å‡ºç›®æ ‡æ–‡ä»¶æ¯ä¸€æ®µçš„å¤§å°ä»¥åŠæ€»ä½“çš„å¤§å° nmï¼šåŠŸèƒ½ï¼šnm å¯ä»¥åˆ—å‡ºç›®æ ‡æ–‡ä»¶ä¸­çš„ç¬¦å·ã€‚ strip åŠŸèƒ½ï¼šstrip ç”¨æ¥ä¸¢å¼ƒç›®æ ‡æ–‡ä»¶ä¸­çš„å…¨éƒ¨æˆ–è€…ç‰¹å®šç¬¦å·ï¼Œå‡å°æ–‡ä»¶ä½“ç§¯ã€‚å¯¹äºåµŒå…¥å¼ç³»ç»Ÿï¼Œè¿™ä¸ªå‘½ä»¤å¿…ä¸å¯å°‘ã€‚ objcopyï¼šåŠŸèƒ½ï¼šobjcopy å¯ä»¥è¿›è¡Œç›®æ ‡æ–‡ä»¶æ ¼å¼è½¬æ¢ objcopy -O binary hello hello.bin objcopy -O binary u-boot u-boot.bin objdump: åŠŸèƒ½ï¼šåæ±‡ç¼– objdump -d hello objdump -d hello hello.dis addr2line åŠŸèƒ½ï¼šaddr2line èƒ½å¤ŸæŠŠç¨‹åºåœ°å€è½¬æ¢ä¸ºæ–‡ä»¶åå’Œè¡Œå·ï¼Œå‰ææ˜¯è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶åŒ…æ‹¬è°ƒè¯•ç¬¦å·ã€‚ å®‰è£…äº¤å‰ç¼–è¯‘å·¥å…·é“¾ è§£å‹ gcc-4.6â€¦ åˆ° tootchain é…ç½®ç¯å¢ƒå˜é‡ sudo vi /etc/bash.bashrc export PATH=$PATH:/home/linux/toolchain/gcc-4.6.4/bin/ é‡å¯ source etcbash.bashrc æµ‹è¯• arm-none-linux-gnueabi-gcc â€“v TFTP æœåŠ¡å™¨çš„å®‰è£…å’Œé…ç½®tftp æ˜¯ç”¨æ¥ä¸‹è½½è¿œç¨‹æ–‡ä»¶æœ€ç®€å•çš„ç½‘ç»œåè®® ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¼€å¯ tftp æœåŠ¡ sudo vi /etc/default/tftp-hapa ä¿®æ”¹æˆï¼š TFTP_USERNAME=tftp TFTP_DIRECTORY=/tftpboot //æŒ‡å®štftpæœåŠ¡å™¨çš„ç›®å½•ï¼Œå°†æ¥è¦ä¸‹è½½ä¸œè¥¿éƒ½æ˜¯ä»è¿™ä¸ªç›®å½•ä¸‹ä¸‹è½½ï¼Œéœ€è‡ªè¡Œåˆ›å»ºï¼Œç„¶åä¿®æ”¹æƒé™ä¸º777TFTP_ADDRESS=0.0.0.0:69 //69ï¼š tftp ä¸“æœ‰çš„ç«¯å£TFTP_OPTIONS=-c -s -l //man tftpdå¯æŸ¥çœ‹å„ä¸ªé€‰é¡¹çš„å«ä¹‰//-cï¼šè¡¨ç¤ºå¯ä»¥åœ¨æœåŠ¡å™¨ç›®å½•ä¸‹ï¼ˆ/tftpbootï¼‰ä¸‹åˆ›å»ºæ–°æ–‡ä»¶ï¼Œé»˜è®¤ä¸èƒ½åˆ›å»ºæ–°æ–‡ä»¶ï¼Œåªèƒ½ä¿®æ”¹æˆ–è¦†ç›–//-s: æ”¹å˜ tftp å¯åŠ¨çš„æ ¹ç›®å½•ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯åœ¨ä½¿ç”¨ tftp æ—¶ä¸éœ€è¦è¾“å…¥/tftpboot ç›®å½•//-lï¼šè¡¨ç¤ºä»¥ç›‘å¬æ¨¡å¼å¯åŠ¨ tftp æœåŠ¡å™¨ åˆ›å»ºæœåŠ¡å™¨çš„æ ¹ç›®å½•tftpboot sudo mkdir /tftpbootchmod 777 /tftpboot -R é‡å¯ tftp æœåŠ¡å™¨ sudo service tftpd-hpa restart ç™»å½•æœ¬æœºè¿›è¡Œæµ‹è¯• tftp localhost æˆ–è€… tftp 192.168.1.111 æˆ–è€… tftp 127.0.0.1tftp get xxx //ä»æœåŠ¡å™¨ï¼ˆ/tftpboot ç›®å½•ï¼‰ä¸‹è½½æ–‡ä»¶åä¸º XXX çš„æ–‡ä»¶tftp put xxx //xxx ä¸ºæƒ³è¦å¾€æœåŠ¡å™¨ï¼ˆ/tftpboot ç›®å½•ï¼‰å‘é€çš„æ–‡ä»¶tftp q //q è¡¨ç¤ºé€€å‡º nfs æœåŠ¡å™¨çš„å®‰è£…å’Œé…ç½®nfs ä¸»è¦ç”¨æ¥è¿›è¡Œç›®å½•çš„å…±äº«ï¼ˆæŠŠæœ¬åœ°çš„ä¸€ä¸ªç›®å½•é€šè¿‡ç½‘ç»œå¯¼å‡ºï¼Œå…¶ä»–è®¾å¤‡å¯ä»¥è¿œç¨‹è®¿é—®è¯¥ç›®å½•ï¼‰ï¼Œä»¬çš„æµ‹è¯•ç¨‹åºä¸ç”¨é€šè¿‡ä¸‹è½½åˆ°ç›®æ ‡æ¿ï¼Œç›®æ ‡æœºå¯ä»¥é€šè¿‡å…±äº«ç›®å½•è®¿é—®ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚ ä¿®æ”¹é…ç½®æ–‡ä»¶ sudo vi /etc/export åœ¨æœ€åä¸€è¡Œæ·»åŠ ï¼š /source/rootfs *(rw,sync,no_subtree_check,no_root_squash)///source/rootfs æ˜¯æŒ‡å®šçš„å…±äº«ç›®å½•ï¼Œéœ€è‡ªå·±åˆ›å»º//rwï¼šå…·æœ‰è¯»å†™æƒé™//syncï¼šæ–‡ä»¶åŒæ­¥//no_subtree_check: å¦‚æœå…±äº«å­ç›®å½•ï¼Œåˆ™ä¸æ£€æŸ¥çˆ¶ç›®å½•çš„æƒé™//no_root_squash: å¦‚æœå®¢æˆ·ç«¯ä¸º root ç”¨æˆ·ï¼Œåˆ™å®ƒå¯¹æ­¤ç›®å½•æœ‰ root æƒé™ é‡å¯ nfs æœåŠ¡ sudo service nfs-kernel-server restart åˆ›å»ºå…±äº«ç›®å½• mkdir /source/rootfs ubuntu çš„ç½‘ç»œé…ç½®é…ç½®è™šæ‹Ÿæœº IPï¼ˆæ¡¥æ¥ï¼‰ï¼Œè®¾ç½® IP åœ°å€ï¼Œsudo vi etcnetworkinterfaces auto eth0iface eth0 inet staticaddress 192.168.1.111netmask 255.255.255.0gateway 192.168.1.1 è®¾ç½® DNSï¼Œsudo vi /etc/resolv.conf åœ¨æœ€åä¸€è¡Œæ·»åŠ ï¼š nameserver 192.168.1.1 é‡å¯ç½‘ç»œæœåŠ¡ sudo /etc/init.d/networking restart å¼€å‘ç¯å¢ƒæµ‹è¯•SD å¯åŠ¨ç›˜åˆ¶ä½œå’Œ u-boot çš„çƒ§å†™åˆ¶ä½œ SD å¡ç›®çš„ï¼šé€šè¿‡ SD å¡çƒ§å†™ uboot åˆ°å¼€å‘æ¿ä¸Š çƒ§å†™ uboot åˆ° emmc ä¸Š è¿æ¥ä¸²å£å’Œæ¿å­ï¼Œè¿è¡Œä¸²å£é€šä¿¡ç¨‹åº(putty ç¬¬ä¸€å¤©å·¥å…·ä¸­) å…³é—­å¼€å‘æ¿ç”µæºï¼Œå°†æ‹¨ç å¼€å…³ SW1 è°ƒè‡³(1000)(SD å¯åŠ¨æ¨¡å¼)åæ‰“å¼€ç”µæº å°†åˆšæ‰åšå¥½çš„ SD å¯åŠ¨ç›˜æ’å…¥ SD å¡æ’æ§½ å€’è®¡æ—¶æŒ‰ä¸‹ä»»æ„é”®ï¼Œè¿›å…¥ uboot ç•Œé¢ çƒ§å†™ åœ¨ç»ˆç«¯ä¸Šæ‰§è¡Œ sdfuse flashall ç­‰å¾…ç»ˆç«¯æ— è¾“å‡ºæ˜¯è¡¨ç¤ºçƒ§å†™ç»“æŸ ä»ç½‘ç»œä¸‹è½½å†…æ ¸ã€è®¾å¤‡æ ‘ï¼Œå¹¶æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿå¦‚ä½•æŠŠæœåŠ¡å™¨ï¼ˆubuntu ä¸­çš„tftpboot ç›®å½•ï¼‰ä¸‹çš„å†…æ ¸å’Œè®¾å¤‡æ ‘ä¸‹è½½åˆ°å¼€å‘æ¿ï¼Ÿ å°†è¦ä¸‹è½½çš„ä¸œè¥¿æ”¾åˆ°æœåŠ¡å™¨ç›®å½•ä¸‹ã€‚ æ‹·è´ uImageã€exynos4412-fs4412.dtb åˆ° ubuntu çš„tftpboot ç›®å½•ä¸‹ã€‚ å°†ç¬¬ä¸€å¤©é•œåƒæ–‡ä»¶rootfs.tar.xz æ‹·è´åˆ° ubuntu çš„ source ä¸‹å¹¶è§£å‹ å¼€å‘æ¿å¯åŠ¨ï¼Œåœ¨ u-boot ç•Œé¢(å€’è®¡æ—¶æŒ‰ä¸‹ä»»æ„é”®)è¿›è¡Œä¸‹è½½ã€‚ Ubuntu IP: 192.168.9.120 å¼€å‘æ¿ IP: 192.168.9.233 #setenv serverip 192.168.9.120#setenv ipaddr 192.168.9.233#setenv bootcmd tftp 41000000 uImage\\;tftp 42000000 exynos4412-fs4412.dtb\\;bootm 41000000 - 42000000 console=ttySAC2,115200 init=/linuxrc ip=192.168.9.233#saveenv é‡å¯å¼€å‘æ¿ ä» EMMC åŠ è½½å†…æ ¸å’Œæ–‡ä»¶ç³»ç»Ÿçƒ§å†™é•œåƒåˆ° emmc ä¸­è®¾ç½®å¯åŠ¨å‚æ•°ï¼Œä» emmc åŠ è½½é•œåƒ","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"æ„å»ºå·¥å…·çš„ç®€è¦ä»‹ç»","path":"/2024/08/05/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-æ„å»ºå·¥å…·çš„ç®€è¦ä»‹ç»/","content":"åµŒå…¥å¼ Linux ç³»ç»Ÿæ„å»ºå·¥å…·åœ¨åµŒå…¥å¼ç³»ç»Ÿçš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé€‰æ‹©åˆé€‚çš„æ„å»ºå·¥å…·è‡³å…³é‡è¦ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„æ„å»ºå·¥å…·åŠå…¶ç‰¹ç‚¹ã€‚ MakeMake æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„æ„å»ºè‡ªåŠ¨åŒ–å·¥å…·ï¼Œç‰¹åˆ«é€‚ç”¨äºä½¿ç”¨ CC++ ç¼–å†™çš„ç¨‹åºã€‚å®ƒæ ¹æ® Makefile æ–‡ä»¶ä¸­çš„è§„åˆ™æ¥ç¡®å®šå“ªäº›æ–‡ä»¶éœ€è¦é‡æ–°ç¼–è¯‘ï¼Œå¹¶ç®¡ç†ç¼–è¯‘è¿‡ç¨‹ã€‚å¼€å‘è€…å¯ä»¥è‡ªå®šä¹‰æ„å»ºæµç¨‹ï¼Œæ¯”å¦‚æ·»åŠ ç‰¹å®šçš„ç¼–è¯‘æ ‡å¿—æˆ–å®šä¹‰æµ‹è¯•ç›®æ ‡ï¼Œè¿™ä½¿å¾— Make æˆä¸ºé«˜åº¦çµæ´»çš„é€‰æ‹©ã€‚ ç¤ºä¾‹ï¼š é€šè¿‡ç¼–å†™ä¸€ä¸ªç®€å•çš„ Makefileï¼Œå¼€å‘è€…å¯ä»¥æŒ‡å®šå¦‚ä½•å°†æºä»£ç ç¼–è¯‘ä¸ºæœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç¡®ä¿æ¯æ¬¡å˜æ›´æ—¶è‡ªåŠ¨è§¦å‘é‡æ–°æ„å»ºã€‚ CMakeCMake æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„æ„å»ºç³»ç»Ÿç”Ÿæˆå™¨ï¼Œå®ƒä½¿ç”¨ CMakeLists.txt æ–‡ä»¶æ¥æè¿°é¡¹ç›®çš„æ„å»ºè¿‡ç¨‹ã€‚CMake å¯ä»¥ç”Ÿæˆé€‚åˆå¤šç§ç¯å¢ƒçš„ Makefile æˆ–é¡¹ç›®æ–‡ä»¶ï¼Œæ¯”å¦‚ç”¨äº Visual Studio å’Œ Xcode çš„é¡¹ç›®æ–‡ä»¶ã€‚å®ƒçš„æœ€å¤§ä¼˜åŠ¿åœ¨äºæ”¯æŒå¤æ‚çš„é¡¹ç›®ç»“æ„ä»¥åŠè·¨å¹³å°æ„å»ºã€‚ ç¤ºä¾‹ï¼šä¸€ä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„é¡¹ç›®å¯ä»¥é€šè¿‡ CMake çš„æŒ‡ä»¤è½»æ¾ç®¡ç†ï¼Œåœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šç”Ÿæˆé€‚é…çš„æ„å»ºæ–‡ä»¶ï¼Œä»¥ç¡®ä¿ä¸€è‡´çš„æ„å»ºä½“éªŒã€‚ QMakeQMake æ˜¯ Qt æ¡†æ¶çš„æ„å»ºå·¥å…·ï¼Œä¸»è¦ç”¨äºå¼€å‘ Qt åº”ç”¨ç¨‹åºã€‚å®ƒæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥ç®¡ç†ç¨‹åºçš„æ„å»ºè¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç† GUI åº”ç”¨æ—¶ã€‚QMake ä½¿ç”¨ .pro æ–‡ä»¶æ¥å®šä¹‰é¡¹ç›®è®¾ç½®ï¼Œå¹¶èƒ½è‡ªåŠ¨å¤„ç†ä¾èµ–å…³ç³»ï¼Œä½¿å¾—å¼€å‘ Qt åº”ç”¨å˜å¾—é«˜æ•ˆã€‚ ç¤ºä¾‹ï¼š å½“é‡‡ç”¨ QMake åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®æ—¶ï¼Œå¼€å‘è€…åªéœ€åœ¨ .pro æ–‡ä»¶ä¸­å®šä¹‰æºæ–‡ä»¶å’Œå¤´æ–‡ä»¶ï¼ŒQMake ä¼šè‡ªåŠ¨ç”Ÿæˆé€‚åˆå¹³å°çš„ Makefileã€‚ MesonMeson æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æ„å»ºç³»ç»Ÿï¼Œæ—¨åœ¨æé«˜æ„å»ºé€Ÿåº¦å’Œå¯ç»´æŠ¤æ€§ã€‚å…¶è®¾è®¡ç†å¿µæ˜¯ä¸ºäº†å¸®åŠ©å¼€å‘è€…æ›´é«˜æ•ˆåœ°ç®¡ç†å¤§å‹é¡¹ç›®çš„æ„å»ºè¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯ Meson çš„ä¸€äº›æ ¸å¿ƒç‰¹ç‚¹ï¼š å¿«é€Ÿæ„å»ºï¼šMeson åˆ©ç”¨å¹¶è¡Œæ„å»ºå’Œå¢é‡æ„å»ºçš„ç­–ç•¥ï¼Œæ˜¾è‘—å‡å°‘äº†æ„å»ºæ—¶é—´ã€‚æ¯”å¦‚ï¼Œåœ¨å¤šä¸ª CPU æ ¸å¿ƒä¸ŠåŒæ—¶è¿›è¡Œæ„å»ºï¼Œå½“åœ¨æœºå™¨ä¸Šæœ‰ 8 ä¸ªå†…æ ¸çš„æ—¶å€™ï¼Œæ„å»ºæ—¶é—´å¯ä»¥ç¼©çŸ­åˆ°å•çº¿ç¨‹çš„äº”åˆ†ä¹‹ä¸€ã€‚æ­¤å¤–ï¼Œé€šè¿‡ä»…ç¼–è¯‘å˜æ›´çš„æ–‡ä»¶ï¼ŒMeson ä¼˜åŒ–äº†æ„å»ºè¿‡ç¨‹ï¼Œä½¿å¾—æ¯æ¬¡ä¿®æ”¹ä»£ç åé‡æ–°æ„å»ºçš„æ•ˆç‡æ›´é«˜ã€‚ æ˜“äºä½¿ç”¨ï¼šMeson çš„é…ç½®æ–‡ä»¶é‡‡ç”¨äººæ€§åŒ–çš„ç®€å•è¯­æ³•ï¼Œä¾¿äºå¼€å‘è€…ç†è§£ã€‚åœ¨ Meson ä¸­ï¼Œä»…éœ€è¦ç¼–å†™ä¸€ä¸ª meson.build æ–‡ä»¶ï¼Œå®šä¹‰é¡¹ç›®çš„æºæ–‡ä»¶ã€ä¾èµ–å…³ç³»å’Œæ„å»ºé€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªåº“åªéœ€å‡ è¡Œä»£ç ï¼Œåƒè¿™æ ·ï¼š project(example, c)library(example_lib, src/example.c) è¿™ç§ç®€æ´çš„è¯­æ³•ä½¿å¾—æ–°æ‰‹å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿä¸Šæ‰‹ï¼Œè€Œç»éªŒä¸°å¯Œçš„å¼€å‘è€…ä¹Ÿèƒ½æ›´é«˜æ•ˆåœ°è¿›è¡Œé¡¹ç›®ç®¡ç†ã€‚ è·¨å¹³å°æ”¯æŒï¼šMeson æ”¯æŒå¤šç§å¹³å°å’Œç¼–è¯‘å™¨ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Linuxã€Windows å’Œ macOSï¼Œä»¥åŠ GCCã€Clang å’Œ MSVC ç­‰ç¼–è¯‘å™¨ã€‚è¿™ç§å…¼å®¹æ€§ä½¿å¾—å¼€å‘è€…å¯ä»¥åœ¨ä¸åŒçš„å¼€å‘ç¯å¢ƒä¸­è½»æ¾åˆ‡æ¢ï¼Œè€Œä¸å¿…æ‹…å¿ƒæ„å»ºå·¥å…·çš„å·®å¼‚ã€‚æ— è®ºæ˜¯åœ¨æœ¬åœ°å¼€å‘ï¼Œè¿˜æ˜¯åœ¨äº‘ç«¯æ„å»ºï¼ŒMeson éƒ½èƒ½æä¾›ä¸€è‡´çš„ä½“éªŒã€‚ BuildrootBuildroot æ˜¯ä¸€ä¸ªç®€å•é«˜æ•ˆçš„å·¥å…·ï¼Œä¸“é—¨ç”¨äºç”ŸæˆåµŒå…¥å¼ Linux ç³»ç»Ÿã€‚å®ƒåˆ©ç”¨ Makefile å’Œ Kconfig é…ç½®ç³»ç»Ÿï¼Œæä¾›å¼ºå¤§çš„äº¤å‰ç¼–è¯‘åŠŸèƒ½ï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿå¿«é€Ÿæ„å»ºä¸€ä¸ªç²¾ç®€çš„ã€åŠŸèƒ½å®Œå¤‡çš„ Linux ç³»ç»Ÿã€‚ä»¥ä¸‹æ˜¯ Buildroot çš„ä¸»è¦ç‰¹ç‚¹ï¼Œå…·ä½“è¯´æ˜äº†å…¶ä¼˜åŠ¿å’Œé€‚ç”¨åœºæ™¯ï¼š ç®€å•æ˜“ç”¨ï¼šBuildroot æä¾›äº†ç±»ä¼¼äº Linux å†…æ ¸çš„é…ç½®ç•Œé¢ï¼Œå¦‚ menuconfigï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿç›´è§‚åœ°é€‰æ‹©æ‰€éœ€çš„åŠŸèƒ½å’Œè½¯ä»¶åŒ…ã€‚ç”¨æˆ·åªéœ€å‡ æ¬¡ç‚¹å‡»ï¼Œå°±å¯ä»¥å®Œæˆå¤æ‚çš„é…ç½®å·¥ä½œã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä»é…ç½®åˆ°å®ŒæˆåŸºæœ¬ç³»ç»Ÿçš„æ„å»ºåªéœ€ 15 åˆ° 30 åˆ†é’Ÿã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€æ¬¾éœ€è¦è¿è¡ŒåŸºæœ¬ç½‘ç»œæœåŠ¡çš„è®¾å¤‡ï¼Œç”¨æˆ·èƒ½å¤Ÿå¿«é€Ÿé€‰æ‹©é€‚åˆçš„ç½‘ç»œåè®®æ ˆå’Œç›¸å…³å·¥å…·ï¼Œæå¤§åœ°ç¼©çŸ­äº†å¼€å‘å‘¨æœŸã€‚ é«˜æ•ˆæ€§ï¼šBuildroot éå¸¸é€‚åˆèµ„æºæœ‰é™çš„åµŒå…¥å¼ç¯å¢ƒï¼Œå°¤å…¶æ˜¯åœ¨å¿«é€Ÿè¿­ä»£é¡¹ç›®ä¸­ååˆ†æœ‰æ•ˆã€‚å®ƒæ”¯æŒå¤§é‡çš„è½¯ä»¶åŒ…ï¼Œä»åŸºæœ¬çš„ C æ ‡å‡†åº“åˆ°å¤æ‚çš„ç½‘ç»œåº”ç”¨ç¨‹åºéƒ½èƒ½è½»æ¾é›†æˆã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä¸€å®¶å…¬å¸éœ€è¦åœ¨ IoT è®¾å¤‡ä¸Šè¿è¡Œä¸€ä¸ªè½»é‡çº§çš„æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼ŒBuildroot å¯ä»¥å¿«é€Ÿé€‰å–å¹¶é…ç½®åˆé€‚çš„è½¯ä»¶åŒ…ï¼Œä»è€Œå¿«é€ŸæŠ•å…¥ç”Ÿäº§ã€‚ æ„å»ºæ—¶é—´çŸ­ï¼šç›¸è¾ƒäºå…¶ä»–ç±»ä¼¼å·¥å…·å¦‚ Yoctoï¼ŒBuildroot é€šå¸¸å…·æœ‰æ›´å¿«çš„æ„å»ºæ—¶é—´ã€‚è¿™æ˜¯å› ä¸º Buildroot çš„æ„å»ºè¿‡ç¨‹æ›´ä¸ºç®€åŒ–ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„å¤æ‚æ€§ã€‚æ ¹æ®ç”¨æˆ·åé¦ˆï¼Œä¸€ä¸ªå®ä¾‹å¯èƒ½åœ¨ Yocto ä¸­éœ€è¦å‡ ä¸ªå°æ—¶çš„æ„å»ºæ—¶é—´ï¼Œè€Œåœ¨ Buildroot ä¸­ä»…éœ€ 30 åˆ†é’Ÿæˆ–æ›´çŸ­ã€‚ é€‚ç”¨åœºæ™¯ï¼šBuildroot ç‰¹åˆ«é€‚åˆå°å‹é¡¹ç›®å’Œéœ€è¦å¿«é€ŸåŸå‹å¼€å‘çš„æƒ…å†µã€‚æ¯”å¦‚ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿå°†ä¸€ä¸ªæ–°çš„ç¡¬ä»¶å¹³å°é€‚é…åˆ° Linux ç³»ç»Ÿä¸Šï¼Œä»¥ä¾¿è¿›è¡ŒåŠŸèƒ½æµ‹è¯•æˆ–ç”¨æˆ·åé¦ˆã€‚æœ‰äº›åˆåˆ›ä¼ä¸šä½¿ç”¨ Buildroot æ¥å¿«é€ŸéªŒè¯ä»–ä»¬çš„æƒ³æ³•ï¼Œä»è€Œåœ¨æ¨å‘å¸‚åœºä¹‹å‰åŠæ—¶è°ƒæ•´æ–¹å‘ã€‚ é€šè¿‡è¿™äº›ç‰¹ç‚¹ï¼ŒBuildroot ä¸ºåµŒå…¥å¼å¼€å‘è€…æä¾›äº†ä¸€ä¸ªçµæ´»ä¸”é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼Œä½¿ä»–ä»¬èƒ½æ›´ä¸“æ³¨äºè½¯ä»¶çš„åˆ›æ–°å’ŒåŠŸèƒ½çš„å®ç°ã€‚ YoctoYocto Project æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œä¸“ä¸ºåµŒå…¥å¼ Linux å¼€å‘è€…è®¾è®¡ï¼Œæ—¨åœ¨æä¾›åˆ›å»ºè‡ªå®šä¹‰ Linux ç³»ç»Ÿçš„å·¥å…·å’Œæ¨¡æ¿ã€‚ä»¥ä¸‹æ˜¯å…¶ä¸»è¦ç‰¹ç‚¹ï¼š é«˜åº¦å®šåˆ¶åŒ–ï¼šYocto æ”¯æŒå¤æ‚çš„ä¾èµ–å…³ç³»å’Œå±‚æ¬¡ç»“æ„ï¼Œä½¿å¾—å®ƒç‰¹åˆ«é€‚åˆäºé‚£äº›éœ€è¦æé«˜å®šåˆ¶åŒ–ç¨‹åº¦å’Œå¤æ‚åŠŸèƒ½çš„å¤§å‹é¡¹ç›®ã€‚ä¾‹å¦‚ï¼Œåœ¨è€ƒè™‘ç‰©è”ç½‘ï¼ˆIoTï¼‰è®¾å¤‡æ—¶ï¼Œå¦‚æœä¸€ä¸ªè®¾å¤‡éœ€è¦åŒæ—¶æ”¯æŒå¤šä¸ªä¼ æ„Ÿå™¨ã€ç‰¹å®šçš„ä¸­é—´ä»¶å’Œå®šåˆ¶çš„ç”¨æˆ·ç•Œé¢ï¼ŒYocto æä¾›çš„çµæ´»æ€§å…è®¸å¼€å‘å›¢é˜Ÿç²¾ç¡®é…ç½®ä»–ä»¬çš„ç³»ç»Ÿï¼Œä»¥æ»¡è¶³è¿™äº›ç‰¹å®šéœ€æ±‚ã€‚ å¼ºå¤§çš„æ„å»ºç³»ç»Ÿï¼šYocto ä½¿ç”¨ BitBake ä½œä¸ºå…¶æ„å»ºå¼•æ“ã€‚BitBake ä¸ä»…å¯ä»¥å¤„ç†ç®€å•çš„æ„å»ºä»»åŠ¡ï¼Œè¿˜èƒ½åº”å¯¹é«˜åº¦å¤æ‚çš„æ„å»ºæµç¨‹ã€‚è¿™ç§èƒ½åŠ›å¯¹äºå¼€å‘è€…è€Œè¨€æä¸ºé‡è¦ï¼Œå› ä¸ºåœ¨æ„å»ºåµŒå…¥å¼ç³»ç»Ÿæ—¶ï¼Œå¾€å¾€éœ€è¦ä»å¤´å¼€å§‹æ„å»ºä¸€ä¸ªç‹¬ç‰¹çš„ Linux å‘è¡Œç‰ˆï¼ŒBitBake é€šè¿‡ä¸°å¯Œçš„å¼€æºæ”¯æŒå’Œçµæ´»çš„ä»»åŠ¡è°ƒåº¦åŠŸèƒ½ï¼Œè®©è¿™ä¸€è¿‡ç¨‹å˜å¾—é«˜æ•ˆã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨å¤„ç†è½¯ä»¶åŒ…çš„ä¾èµ–å…³ç³»ï¼Œç¡®ä¿åœ¨æ„å»ºç³»ç»Ÿæ—¶ï¼Œæ‰€éœ€çš„æ¯ä¸€ä¸ªç»„ä»¶éƒ½èƒ½è¢«æ­£ç¡®é…ç½®ä¸é“¾æ¥ã€‚ çµæ´»æ€§ï¼šYocto å…è®¸å¼€å‘è€…æ ¹æ®ä¸åŒçš„ç¡¬ä»¶å’Œè½¯ä»¶éœ€æ±‚ï¼Œåˆ›å»ºé€‚åˆç‰¹å®šåº”ç”¨çš„ Linux ç‰ˆæœ¬ã€‚è¿™æ„å‘³ç€ï¼Œå¼€å‘è€…åœ¨é¢å¯¹å„ç§ä¸åŒçš„ç¡¬ä»¶å¹³å°ï¼ˆå¦‚ ARMã€x86 æˆ– MIPS æ¶æ„ï¼‰æ—¶ï¼Œå¯ä»¥è¿…é€Ÿåˆ›å»ºç›¸åº”çš„ Linux ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåŒ»ç–—è®¾å¤‡åˆ¶é€ å•†éœ€è¦åœ¨ä¸åŒçš„ç¡¬ä»¶å¹³å°ä¸Šè¿è¡Œç›¸åŒçš„è½¯ä»¶è§£å†³æ–¹æ¡ˆï¼ŒYocto èƒ½å¤Ÿå¸®åŠ©ä»–ä»¬æ„å»ºå…¼å®¹æ€§å¼ºçš„ç³»ç»Ÿï¼Œç¡®ä¿é¡¹ç›®çš„ç»Ÿä¸€æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ é€‚ç”¨åœºæ™¯ï¼šYocto ç‰¹åˆ«é€‚ç”¨äºéœ€è¦æ”¯æŒå¤šä¸ªç¡¬ä»¶å¹³å°å’Œå¤æ‚è½¯ä»¶æ ˆçš„é¡¹ç›®ã€‚æ¯”å¦‚ï¼Œåœ¨æ±½è½¦ç”µå­è¡Œä¸šï¼Œä¸€æ¬¾è½¦è½½å¨±ä¹ç³»ç»Ÿéœ€è¦åœ¨å¤šç§ä¸åŒçš„æ±½è½¦å“ç‰Œå’Œå‹å·ä¸Šå®‰è£…ï¼ŒåŒæ—¶åˆè¦æ”¯æŒå¤æ‚çš„å¤šåª’ä½“å¤„ç†å’Œå®æ—¶æ•°æ®ä¼ è¾“ç­‰åŠŸèƒ½ï¼ŒYocto æä¾›çš„æ¨¡å—åŒ–è®¾è®¡å’Œå±‚çº§ç®¡ç†èƒ½æœ‰æ•ˆç®€åŒ–è¿™ä¸€è¿‡ç¨‹ã€‚å¼€å‘è€…å¯ä»¥åˆ©ç”¨ Yocto çš„åŠŸèƒ½ï¼Œä¸ºæ¯ä¸€ä¸ªç‰¹å®šçš„ç¡¬ä»¶å¹³å°å®šåˆ¶å’Œä¼˜åŒ–è½¯ä»¶ï¼Œç¡®ä¿æœ€ä½³çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"é£å‡ŒOK3568çš„Dockeræ”¯æŒ","path":"/2024/08/02/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-é£å‡ŒOK3568çš„Dockeræ”¯æŒ/","content":"é£å‡Œ OK3568 çš„ Docker æ”¯æŒä¸ºäº†åœ¨é£å‡Œ OK3568 å¼€å‘æ¿ä¸Šæ”¯æŒ Dockeraday nerdferendum æ¢¯å½¢ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å†…æ ¸é…ç½®è¿›è¡Œä¿®æ”¹ï¼Œå¹¶å®‰è£… Dockerã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„æ“ä½œæŒ‡å—ï¼š ä¸€ã€å†…æ ¸é…ç½®é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨å†…æ ¸é…ç½®æ–‡ä»¶ä¸­å¯ç”¨ Docker éœ€è¦çš„åŠŸèƒ½ã€‚æ‰“å¼€ kernel/arch/arm64/configs/OK3568-C-linux_defconfig æ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š # add docker supportCONFIG_MEMCG=yCONFIG_VETH=yCONFIG_BRIDGE=yCONFIG_BRIDGE_NETFILTER=yCONFIG_NETFILTER_XT_MATCH_ADDRTYPE=yCONFIG_NETFILTER_XT_MATCH_CONNTRACK=yCONFIG_NETFILTER_XT_MATCH_IPVS=yCONFIG_NETFILTER_XT_MARK=yCONFIG_POSIX_MQUEUE=yCONFIG_CGROUP_BPF=yCONFIG_NETFILTER_ADVANCED=yCONFIG_NETFILTER_XTABLES=yCONFIG_IP_VS=yCONFIG_IP_PNP=yCONFIG_IP_PNP_DHCP=y è¿™äº›é…ç½®é¡¹çš„ä½œç”¨å¦‚ä¸‹ï¼š CONFIG_MEMCG: å¯ç”¨å†…å­˜æ§åˆ¶ç»„åŠŸèƒ½ï¼Œç”¨äºå¯¹å®¹å™¨çš„å†…å­˜ä½¿ç”¨æƒ…å†µè¿›è¡Œé™åˆ¶å’Œç›‘æ§ã€‚ CONFIG_VETH: å¯ç”¨è™šæ‹Ÿä»¥å¤ªç½‘åŠŸèƒ½ï¼Œå…è®¸å®¹å™¨ä¹‹é—´å’Œå®¿ä¸»æœºä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚ CONFIG_BRIDGE: å¯ç”¨ç½‘æ¡¥åŠŸèƒ½ï¼Œæ”¯æŒå°†ä¸åŒçš„ç½‘ç»œæ¥å£è¿æ¥åˆ°åŒä¸€ä¸ªæ¡¥æ¥è®¾å¤‡ï¼Œå®ç°å®¹å™¨ç½‘ç»œçš„é€šä¿¡ã€‚ CONFIG_BRIDGE_NETFILTER: å¯ç”¨ç½‘æ¡¥çš„ç½‘ç»œè¿‡æ»¤åŠŸèƒ½ï¼Œæ”¯æŒåœ¨æ¡¥æ¥ç½‘ç»œä¸­æ‰§è¡Œ iptables è§„åˆ™ã€‚ CONFIG_NETFILTER_XT_MATCH_ADDRTYPE: å¯ç”¨åœ°å€ç±»å‹åŒ¹é…æ¨¡å—ï¼Œç”¨äºæ ¹æ®æ•°æ®åŒ…çš„åœ°å€ç±»å‹è¿›è¡Œè¿‡æ»¤ã€‚ CONFIG_NETFILTER_XT_MATCH_CONNTRACK: å¯ç”¨è¿æ¥è·Ÿè¸ªåŒ¹é…æ¨¡å—ï¼Œæ”¯æŒåŸºäºè¿æ¥çŠ¶æ€çš„è¿‡æ»¤è§„åˆ™ã€‚ CONFIG_NETFILTER_XT_MATCH_IPVS: å¯ç”¨ IP è´Ÿè½½å‡è¡¡åŒ¹é…æ¨¡å—ï¼Œæ”¯æŒåœ¨å®¹å™¨é—´åˆ†å‘ç½‘ç»œæµé‡ã€‚ CONFIG_NETFILTER_XT_MARK: å¯ç”¨æ•°æ®åŒ…æ ‡è®°æ¨¡å—ï¼Œæ”¯æŒå¯¹æ•°æ®åŒ…è¿›è¡Œåˆ†ç±»ç®¡ç†ã€‚ CONFIG_POSIX_MQUEUE: å¯ç”¨ POSIX æ¶ˆæ¯é˜Ÿåˆ—åŠŸèƒ½ï¼Œæ”¯æŒå®¹å™¨é—´çš„è¿›ç¨‹é€šä¿¡ã€‚ CONFIG_CGROUP_BPF: å¯ç”¨æ§åˆ¶ç»„ BPF åŠŸèƒ½ï¼Œæ”¯æŒé€šè¿‡ BPF ç¨‹åºå¯¹èµ„æºè¿›è¡Œæ§åˆ¶å’Œç›‘æ§ã€‚ CONFIG_NETFILTER_ADVANCED: å¯ç”¨é«˜çº§ç½‘ç»œè¿‡æ»¤åŠŸèƒ½ï¼Œæ”¯æŒæ›´å¤æ‚çš„ç½‘ç»œè§„åˆ™å’Œè¿‡æ»¤é€»è¾‘ã€‚ CONFIG_NETFILTER_XTABLES: å¯ç”¨æ‰©å±• tables åŠŸèƒ½ï¼Œæ”¯æŒæ›´çµæ´»çš„ç½‘ç»œè¿‡æ»¤å’Œ NAT åŠŸèƒ½ã€‚ CONFIG_IP_VS: å¯ç”¨ IP è™šæ‹ŸæœåŠ¡å™¨åŠŸèƒ½ï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§ã€‚ CONFIG_IP_PNP: å¯ç”¨ IP æ’å…¥å¼ DHCP åŠŸèƒ½ï¼Œæ”¯æŒè‡ªåŠ¨ IP åœ°å€é…ç½®ã€‚ CONFIG_IP_PNP_DHCP: å¯ç”¨ DHCP å®¢æˆ·ç«¯åŠŸèƒ½ï¼Œæ”¯æŒåŠ¨æ€è·å– IP åœ°å€ã€‚ å®Œæˆä»¥ä¸Šä¿®æ”¹åï¼Œä¿å­˜å¹¶å…³é—­é…ç½®æ–‡ä»¶ï¼Œç„¶åé‡æ–°ç¼–è¯‘å†…æ ¸å¹¶çƒ§å†™åˆ°å¼€å‘æ¿ä¸­è¿›è¡Œæµ‹è¯•ã€‚ äºŒã€å®‰è£… Dockeråœ¨å†…æ ¸é…ç½®å®Œæˆå¹¶çƒ§å†™åï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¼€å‘æ¿ä¸Šå®‰è£… Dockerã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„æ­¥éª¤ï¼š æ›´æ–°è½¯ä»¶æºï¼š sudo apt-get update å®‰è£…å¿…è¦çš„ä¾èµ–åŒ…ï¼š sudo apt-get install apt-transport-https ca-certificates curl æ·»åŠ  Docker è½¯ä»¶æºï¼š curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add - è¿™ä¸€æ­¥å°†æ·»åŠ é˜¿é‡Œäº‘æä¾›çš„ Docker è½¯ä»¶æºçš„å…¬é’¥ï¼Œä»¥ç¡®ä¿è½¯ä»¶åŒ…çš„å®‰å…¨æ€§ã€‚ æ·»åŠ  Docker è½¯ä»¶ä»“åº“ï¼š sudo add-apt-repository deb [arch=arm64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable è¿™é‡Œä½¿ç”¨äº†é˜¿é‡Œäº‘çš„ Docker è½¯ä»¶ä»“åº“ï¼Œä»¥åŠ å¿«è½¯ä»¶åŒ…çš„ä¸‹è½½é€Ÿåº¦ã€‚$(lsb_release -cs) å¯ä»¥è‡ªåŠ¨è·å– Ubuntu çš„ç‰ˆæœ¬ä»£å·ï¼ˆä¾‹å¦‚ focalï¼‰ã€‚ æ›´æ–°è½¯ä»¶æºç´¢å¼•ï¼š sudo apt-get update æŸ¥çœ‹å¯ç”¨çš„ Docker è½¯ä»¶åŒ…ï¼š apt-cache madison docker-ce è¿™ä¸€æ­¥å¯ä»¥ç”¨æ¥æŸ¥çœ‹å¯ç”¨çš„ Docker è½¯ä»¶åŒ…çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚ å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ Dockerï¼š sudo apt-get -y install docker-ce=5:20.10.1~3-0~ubuntu-focal é€šè¿‡æŒ‡å®šç‰ˆæœ¬å·å®‰è£…ç‰¹å®šçš„ Docker ç‰ˆæœ¬ï¼Œè¿™é‡Œå®‰è£…çš„ç‰ˆæœ¬æ˜¯ 20.10.1ã€‚ éªŒè¯ Docker å®‰è£…ï¼š sudo docker image ls è¿™é‡Œä¼šåˆ—å‡ºå·²å®‰è£…çš„ Docker é•œåƒã€‚å¦‚æœæœ‰ hello-world é•œåƒåˆ—å‡ºï¼Œåˆ™è¯´æ˜ Docker å®‰è£…æˆåŠŸã€‚ æ³¨æ„äº‹é¡¹ åœ¨æ‰§è¡Œä»¥ä¸Šå‘½ä»¤æ—¶ï¼Œé¡¹æ³¨æ„ç½‘ç»œè¿æ¥çš„ç¨³å®šæ€§ã€‚è‹¥å‡ºç°ç½‘ç»œé—®é¢˜ï¼Œå¯å°è¯•æ›´æ¢é•œåƒæºæˆ–é‡æ–°æ›´æ–°è½¯ä»¶æºã€‚ å®‰è£… Docker æ—¶éœ€è¦ root æƒé™ã€‚å¦‚æœå‡ºç°æƒé™ä¸è¶³çš„é—®é¢˜ï¼Œå¯ä»¥åœ¨å‘½ä»¤å‰åŠ ä¸Š sudoã€‚ å¦‚æœåœ¨å®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°ä¾èµ–å…³ç³»é”™è¯¯ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¿®å¤ï¼š sudo apt-get install -f é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å¯ä»¥åœ¨é£å‡Œ OK3568 å¼€å‘æ¿ä¸ŠæˆåŠŸé…ç½® Docker æ”¯æŒï¼Œå¹¶è¿è¡Œå®¹å™¨åŒ–åº”ç”¨ç¨‹åºã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"å…³äºRTOSçš„Tickå€¼","path":"/2024/08/01/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-RealTime-å…³äºRTOSçš„Tickå€¼/","content":"ä»€ä¹ˆæ˜¯ç³»ç»Ÿæ»´ç­”ç³»ç»Ÿæ»´ç­”ï¼ˆSysTickï¼‰ï¼Œæœ‰äº›åœ°æ–¹ä¹Ÿå«æ—¶é’ŸèŠ‚æ‹ã€ç³»ç»Ÿå¿ƒè·³ç­‰ã€‚ æ“ä½œç³»ç»Ÿå¯ä»¥å¤šä»»åŠ¡é—´è¿›è¡Œåˆ‡æ¢ï¼Œå°±æ˜¯é ä¸€ä¸ªç³»ç»Ÿå®šæ—¶å™¨ä»¥å›ºå®šé¢‘ç‡ä¸­æ–­ï¼Œä¸ºæ“ä½œç³»ç»Ÿæä¾›è°ƒåº¦ï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰æ‰èƒ½å®ç°ä»»åŠ¡åˆ‡æ¢ã€‚ è€Œè¿™ä¸ªå®šæ—¶å™¨ï¼Œå°±æ˜¯æœ¬æ–‡è¯´çš„ç³»ç»Ÿæ»´ç­”ã€‚æ—©äº›å¹´çš„ 51ã€430 å•ç‰‡æœºï¼Œè·‘ RTOSï¼Œéƒ½æ˜¯å•ç‹¬åˆ©ç”¨ä¸€ä¸ª Timer å®šæ—¶å™¨æä¾›ç³»ç»Ÿæ»´ç­”ã€‚ä¸ºäº†è€ƒè™‘è·‘ RTOS è¿™ä¸ªé—®é¢˜ï¼ŒCortex-M å†…æ ¸è‡ªå¸¦ç³»ç»Ÿæ»´ç­”è¿™ä¸ªå®šæ—¶å™¨ã€‚ ä¼šå‘ç°å¸‚é¢ä¸Šå¾ˆå¤šå•ç‰‡æœºåŸºæœ¬éƒ½è‡ªå¸¦æœ‰ SysTick è¿™ä¸ªå®šæ—¶å™¨ï¼Œåƒ Cortex-M0ã€ M3ã€ M4 è¿™äº›å†…æ ¸çš„å•ç‰‡æœºéƒ½æœ‰çš„ï¼Œè€Œä¸”åªè¦ç®€å•è°ƒç”¨å®˜æ–¹å†™å¥½çš„ API å‡½æ•°å³å¯ä½¿ç”¨ã€‚ ç³»ç»Ÿé…ç½®æ–‡ä»¶é€šå¸¸ï¼Œç³»ç»Ÿæ»´ç­”ï¼ˆOS_TICKSï¼‰ä½äºç³»ç»Ÿé…ç½®æ–‡ä»¶ä¸­ï¼Œå¯¹ç³»ç»Ÿé…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ä¹Ÿæ˜¯é‡è¦çš„ä¸€æ­¥ã€‚æ¯”å¦‚ FreeRTOSConfig.h ucos ç³»ç»Ÿçš„ os_cfg.hï¼ˆä¸€äº›ç³»ç»Ÿé€šè¿‡å›¾å½¢åŒ–ç•Œé¢è¿›è¡Œé…ç½®ï¼Œå…¶å®ä¹Ÿæ˜¯å¯¹ç³»ç»Ÿé…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ï¼‰ã€‚ OS_TICKS ä¸€èˆ¬æ˜¯é…ç½®ä¸º 1000ï¼Œä»å®å®šä¹‰å’Œæ³¨é‡Šå¾ˆå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯æ¯ç§’ç³»ç»Ÿæ»´ç­”çš„æ¬¡æ•°ã€‚ç³»ç»Ÿæ»´ç­”é…ç½® 1000ï¼Œä»£è¡¨ç³»ç»Ÿ 1ms è¦è¿›è¡Œä¸€æ¬¡è½®è½¬è°ƒåº¦ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ›´é«˜ä¼˜å…ˆçº§ä»»åŠ¡è¦æ‰§è¡Œï¼ˆå¹¶åˆ‡æ¢ä»»åŠ¡ï¼‰ã€‚100M ä¸»é¢‘çš„å•ç‰‡æœºï¼Œæ‰§è¡Œä¸€æ¬¡è°ƒåº¦ï¼ˆå‡ åæ¡è¯­å¥ï¼‰ï¼Œæ—¶é—´åœ¨ us çº§åˆ«ã€‚1000 æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€‚åˆçš„ä¸­ç­‰å€¼ï¼Œå…¶ä»– 100ã€10000ï¼Œæˆ–è€… 2000 ä¹Ÿå¯ä»¥ï¼Œåªæ˜¯ä¸åˆ©äºç³»ç»Ÿä»¥åŠç¼–ç¨‹ã€‚ å¦‚æœæ»´ç­”å¤ªå¤§ï¼Œ10Kï¼Œç”šè‡³ 100Kï¼Œå¯¹ç³»ç»Ÿçš„è´Ÿæ‹…æ¯”è¾ƒå¤§ã€‚å› ä¸ºè‡ªèº«è°ƒåº¦ä¼šå ç”¨ CPU æ—¶é—´ã€‚ 1ms æ»´ç­”ä¸€æ¬¡ï¼Œæ–¹ä¾¿ç¼–ç¨‹ç³»ç»Ÿå»¶æ—¶ã€‚2kã€10k è¿™ç§å€¼ï¼Œåœ¨ç”¨åˆ°ç³»ç»Ÿå»¶æ—¶æ—¶ï¼Œä¸æ–¹ä¾¿è®¡ç®—ã€‚ vTaskDelay(1000); å¦‚æœæ»´ç­”å€¼ä¸º 1000ï¼Œåˆ™ä»£è¡¨å»¶æ—¶ 1 ç§’ï¼› å¦‚æœæ»´ç­”å€¼ä¸º 2000ï¼Œåˆ™ä»£è¡¨å»¶æ—¶ 0.5 ç§’ï¼Œå¾ˆæ˜æ˜¾è¿™ç§ä¸åˆ©äºç¼–ç¨‹ï¼› å®æ—¶æ“ä½œç³»ç»Ÿçš„ SysTickï¼Œåœ¨æ²¡æœ‰ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæœ€å¥½é»˜è®¤é…ç½® 1000ï¼› åœ¨ç³»ç»Ÿå…è®¸çš„æƒ…å†µä¸‹ï¼ŒSysTick æ•°å€¼è¶Šå¤§ï¼Œç³»ç»Ÿå®æ—¶æ€§è¶Šé«˜ï¼›åä¹‹å®æ—¶æ€§è¶Šå·®ï¼› ä¸»é¢‘ç›¸å¯¹åä½ï¼ˆæ¯”å¦‚ä½äº 10Mï¼‰çš„å¤„ç†å™¨ï¼ŒSysTick å€¼å¯ä»¥é€‚å½“é…ç½®ä½ä¸€ç‚¹ï¼›","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿","RealTime"]},{"title":"Sqlite3ç§»æ¤","path":"/2024/07/31/6-å¼€å‘å·¥å…·-æ•°æ®åº“-Sqlite3ç§»æ¤/","content":"Qt äº¤å‰ç¼–è¯‘åœ¨ä½¿ç”¨ Qt è¿›è¡Œæ•°æ®åº“æ“ä½œæ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹é”™è¯¯æç¤ºï¼š QSqlDatabase: QSQLITE driver not loaded è¿™ä¸ªé—®é¢˜é€šå¸¸æ˜¯ç”±äºäº¤å‰ç¼–è¯‘çš„ Qt ç‰ˆæœ¬å¯èƒ½è¢«è£å‰ªè¿‡ï¼Œç¼ºå°‘äº† SQLite é©±åŠ¨ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦äº¤å‰ç¼–è¯‘ qsqlite é©±åŠ¨ã€‚ æ­¥éª¤ ä¸‹è½½ Qt æºç è®¿é—® Qt å®˜æ–¹ä¸‹è½½é¡µé¢ï¼Œæ‰¾åˆ° qt-everywhere-opensource-src-5.3.2.tar.gzã€‚ç¡®ä¿ä¸‹è½½çš„ Qt ç‰ˆæœ¬ä¸æ‚¨ä½¿ç”¨çš„ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸€è‡´ï¼Œä»¥é¿å…å…¼å®¹æ€§é—®é¢˜ã€‚ è§£å‹æºç ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è§£å‹ä¸‹è½½çš„æºç åŒ…ï¼š tar -xvf qt-everywhere-opensource-src-5.3.2.tar.gz è¿›å…¥ç›®å½•è¿›å…¥ SQLite é©±åŠ¨çš„æºä»£ç ç›®å½•ï¼š cd qt-everywhere-opensource-src-5.3.2/qtbase/src/plugins/sqldrivers/sqlite æ‰§è¡Œç¼–è¯‘ä½¿ç”¨ qmake å’Œ make å‘½ä»¤ç¼–è¯‘ SQLite é©±åŠ¨ï¼š qmakemake æ‹·è´ç”Ÿæˆçš„åº“ç¼–è¯‘å®Œæˆåï¼Œç”Ÿæˆçš„åº“æ–‡ä»¶ä½äº qt-everywhere-opensource-src-5.3.2/qtbase/plugins/sqldrivers/libqsqlite.soã€‚å°† libqsqlite.so æ‹·è´åˆ°å¼€å‘æ¿çš„ /usr/lib/qt5/plugins/sqldrivers/ ç›®å½•ã€‚å¦‚æœè¯¥ç›®å½•ä¸å­˜åœ¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºï¼š mkdir -p /usr/lib/qt5/plugins/sqldrivers Sqlite ä½¿ç”¨æœ‰å…³ SQLite çš„è¯¦ç»†ä½¿ç”¨è¯´æ˜ï¼Œè¯·å‚è€ƒ Sqliteä½¿ç”¨ã€‚ C ä»£ç ç¼–å†™è¦ä½¿ç”¨ SQLiteï¼Œé¦–å…ˆéœ€è¦ä¸‹è½½å…¶æºä»£ç ï¼Œä¸‹è½½åœ°å€ä¸º SQLite å®˜æ–¹ç½‘ç«™ã€‚ SQLite æ¥å£çš„åŸºæœ¬å…ƒç´ åŒ…æ‹¬ä¸¤ä¸ªå¯¹è±¡å’Œå…«ä¸ªæ–¹æ³•ï¼š // æ•°æ®åº“è¿æ¥å¯¹è±¡ã€‚é€šè¿‡åˆ›å»º sqlite3_openï¼Œå¹¶é€šè¿‡ææ„ sqlite3_closeã€‚sqlite3// å‡†å¤‡å¥½çš„è¯­å¥å¯¹è±¡ã€‚é€šè¿‡åˆ›å»º sqlite3_prepareï¼Œå¹¶é€šè¿‡ææ„ sqlite3_finalizeã€‚sqlite3_stmt// æ‰“å¼€ä¸æ–°çš„æˆ–ç°æœ‰çš„ SQLite æ•°æ®åº“çš„è¿æ¥ã€‚sqlite3 çš„æ„é€ å‡½æ•°ã€‚sqlite3_open()// å°† SQL æ–‡æœ¬ç¼–è¯‘ä¸ºå­—èŠ‚ä»£ç ï¼Œå®ƒå°†å®ŒæˆæŸ¥è¯¢æˆ–æ›´æ–°æ•°æ®åº“çš„å·¥ä½œã€‚sqlite3_stmt çš„æ„é€ å‡½æ•°ã€‚sqlite3_prepare()// å°†åº”ç”¨ç¨‹åºæ•°æ®å­˜å‚¨åˆ°åŸå§‹ SQL çš„å‚æ•°ä¸­ã€‚sqlite3_bind()// å°† sqlite3_stmt å‰è¿›åˆ°ä¸‹ä¸€ä¸ªç»“æœè¡Œæˆ–å®Œæˆã€‚sqlite3_step()// å½“å‰ç»“æœè¡Œç”¨äºåœ¨ â†’ åˆ—å€¼ sqlite3_stmtã€‚sqlite3_column()// sqlite3_stmt çš„ææ„å‡½æ•°ã€‚sqlite3_finalize()// sqlite3 çš„ææ„å‡½æ•°ã€‚sqlite3_close()// ä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œå¯¹ä¸€ä¸ªæˆ–å¤šä¸ª SQL è¯­å¥å­—ç¬¦ä¸²æ‰§è¡Œ sqlite3_prepare()ï¼Œsqlite3_step()ï¼Œsqlite3_column() å’Œ sqlite3_finalize()ã€‚sqlite3_exec() äº¤å‰ç¼–è¯‘ SQLiteä»¥ä¸‹æ˜¯äº¤å‰ç¼–è¯‘ SQLite çš„æ­¥éª¤ï¼š cdmkdir sqlite3 # åœ¨ä¸»æœºï¼ˆå¦‚ Ubuntuï¼‰åˆ›å»ºå·¥ä½œç›®å½•cd sqlite3 # è¿›å…¥å·¥ä½œç›®å½•ä¸­tar zxvf sqlite-autoconf3080500.tar.gz # è§£å‹cd sqlite-autoconf3080500 # è¿›å…¥è§£å‹åçš„ç›®å½•mkdir ../install # åˆ›å»ºå®‰è£…ç›®å½•export PATH=$PATH:/usr/local/arm-2010q1/bin # å°†äº¤å‰ç¼–è¯‘å·¥å…·è·¯å¾„åŠ å…¥ç³»ç»Ÿç¯å¢ƒå˜é‡./configure --host=arm-none-linux-gnueabi --prefix=/home/gary/sqlite3/installmakemake install --hostï¼šæŒ‡å®šäº¤å‰ç¼–è¯‘å·¥å…·ï¼Œé€šå¸¸ä¸º arm-linuxã€arm-linux-gnueabihf ç­‰ï¼Œå…·ä½“å–å†³äºæ‚¨ä½¿ç”¨çš„å¼€å‘æ¿ã€‚ --prefixï¼šæŒ‡å®šå®‰è£…ç›®å½•ï¼Œç¼–è¯‘åçš„æ–‡ä»¶å°†å…¨éƒ¨æ”¾åœ¨è¯¥ç›®å½•ä¸­ï¼Œå¿…é¡»ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚ å®Œæˆç¼–è¯‘åï¼Œå°†ç”Ÿæˆçš„æ–‡ä»¶æ‹·è´åˆ°å¼€å‘æ¿ä¸Šå³å¯ã€‚ DemoC ä»£ç ç¤ºä¾‹ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ C ä»£ç ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ SQLiteï¼š #includestdio.h#includesqlite3.h// execä¼ å…¥ int callback(void* arg, int num, char** rowdata, char** title) static int flag = 0; int i = 0; if (flag == 0) printf(%d , num); for (; i num; i++) printf(%s , title[i]); printf( ); flag = 1; for (i = 0; i num; i++) printf(%s , rowdata[i]); printf( ); return SQLITE_OK;int main(int argc, char **argv) // 1. æ‰“å¼€æ•°æ®åº“ sqlite3 *ppdb; int empty = 1; char *err = 0; int ret = sqlite3_open(./test.db, ppdb); if (ret != SQLITE_OK) perror(open sqlite3 fail); return -1; // 2. æ‰§è¡Œ SQL è¯­å¥ char *sql = create table gec_94(id int primary key, msg varchar(128));; // åˆ›å»ºè¡¨ ret = sqlite3_exec(ppdb, sql, callback, empty, err); if (ret != SQLITE_OK) perror(exec sqlite3 create table fail); sqlite3_close(ppdb); return -1; ret = sqlite3_exec(ppdb, select * from gec_94;, callback, empty, err); if (ret != SQLITE_OK) perror(exec sqlite3 fail); sqlite3_close(ppdb); return -1; // 3. å…³é—­æ•°æ®åº“ sqlite3_close(ppdb); return 0; Makefile ç¤ºä¾‹ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ Makefile ç¤ºä¾‹ï¼Œç”¨äºç¼–è¯‘ä¸Šè¿° C ä»£ç ï¼š TARGET=mainCC=arm-linux-gccSRCS=sqlit3.c sqlite3.cOBJS=$(patsubst %.c, %, $(SRCS))LIB=-lpthread -ldlINCLUDE=ADD=-Wno-psabi ADD1=-enable-static main: $(SRCS)\t$(CC) $^ -o $@ $(LIB)clean:\trm -f $(OBJS) main è¿™ä¸ª Makefile å®šä¹‰äº†ç›®æ ‡æ–‡ä»¶ã€ç¼–è¯‘å™¨ã€æºæ–‡ä»¶ä»¥åŠç¼–è¯‘å’Œæ¸…ç†çš„è§„åˆ™ã€‚ä½¿ç”¨ make å‘½ä»¤å¯ä»¥ç¼–è¯‘ä»£ç ï¼Œä½¿ç”¨ make clean å¯ä»¥æ¸…ç†ç”Ÿæˆçš„æ–‡ä»¶ã€‚","categories":["6.å¼€å‘å·¥å…·","æ•°æ®åº“"]},{"title":"åµŒå…¥å¼ä¸­çš„gsnapæˆªå±","path":"/2024/07/30/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-åº”ç”¨è½¯ä»¶ç§»æ¤-åµŒå…¥å¼ä¸­çš„gsnapæˆªå±/","content":"Linux ç³»ç»Ÿçš„ FrameBuffer æœºåˆ¶ï¼Œä¼šæŠŠå±å¹•ä¸Šçš„æ¯ä¸ªç‚¹æ˜ å°„æˆä¸€æ®µçº¿æ€§å†…å­˜ç©ºé—´ï¼Œç¨‹åºå°±å¯ä»¥é€šè¿‡æ”¹å˜è¿™æ®µå†…å­˜çš„å€¼æ¥æ”¹å˜å±å¹•ä¸ŠæŸä¸€ç‚¹çš„é¢œè‰²ã€‚å±å¹•è‰²å½©çš„åŸå§‹æ•°æ®ä¿å­˜åœ¨devfb0 æ–‡ä»¶ã€‚ cat /dev/fb0 fb.raw #è¯»å–è¯¥æ–‡ä»¶è·å¾—æ•°æ®cat fb_data.raw /dev/fb0 #æ•°æ®å›æ˜¾åˆ° framebuffer è¿™ç§åŸå§‹æ•°æ®æ— æ³•é€šè¿‡ç®€å•çš„å·¥å…·ç›´æ¥æŸ¥çœ‹ï¼Œç‰¹åˆ«æ˜¯åœ¨ç²¾ç®€çš„åµŒå…¥å¼ Linux ç³»ç»Ÿä¸Šã€‚å› æ­¤ï¼Œé€šè¿‡å·¥å…· gsnapã€‚è¿™ä¸ªå·¥å…·å¯ä»¥å°† framebuffer ä¸­çš„æ•°æ®ç›´æ¥ä¿å­˜ä¸º png æˆ–è€… jpeg æ ¼å¼çš„å›¾ç‰‡ã€‚ æ‰“å¼€ gsnap çš„ Makefile æ–‡ä»¶ï¼Œè¯¥æºç ä¾èµ– libpngã€libjpegã€zlibã€libmath å››ç§åº“ã€‚ äº¤å‰ç¼–è¯‘ libjpegè¿›å…¥åˆ°æºç ç›®å½•ï¼Œæ‰§è¡Œ ./configure --host=arm-linux --prefix=./jpeg_install/ ç„¶åæ‰§è¡Œ makemake install åœ¨å®‰è£…ç›®å½• ./jpeg_install/ å¾—åˆ°äº¤å‰ç¼–è¯‘è¿‡çš„åº“ã€‚ äº¤å‰ç¼–è¯‘ zlibç”±äº zlib ä¸­çš„ configure å¹¶æœªæä¾›â€“host å‚æ•°ï¼Œå› æ­¤éœ€è¦ä¸ºå®ƒæ‰‹åŠ¨æŒ‡æ˜äº¤å‰ç¼–è¯‘å™¨ï¼š export CC=arm-fsl-linux-gnueabi-gcc./configure --prefix=./z_install/makemake install äº¤å‰ç¼–è¯‘ libpngzlib æ˜¯ libpng çš„ä¾èµ–ï¼Œå› æ­¤åœ¨äº¤å‰ç¼–è¯‘ libpng ä¹‹å‰ï¼Œå¿…é¡»é¦–å…ˆç¼–è¯‘ zliblibpng ä¸­æä¾›æœ‰ Linux å¹³å°ä¸‹çš„ Makefile ä¾‹ç¨‹ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹ä½¿ç”¨ã€‚è¿›å…¥åˆ° libpng çš„æºç ç›®å½•ï¼Œæ‰§è¡Œæ‹·è´ cp scripts/makefile.linux Makefileï¼Œæ‰“å¼€ Makefile ä¿®æ”¹ï¼Œä¿®æ”¹äº¤å‰ç¼–è¯‘å™¨åç§°å’Œä¾èµ–çš„ zlib çš„è·¯å¾„ã€‚æ‰§è¡Œ makeã€makeinstall å¾—åˆ°å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶ã€‚ äº¤å‰ç¼–è¯‘ gsnapå°†ä¸Šè¿°å¾—åˆ°çš„åº“æ–‡ä»¶å’Œå¤´æ–‡ä»¶åˆ†åˆ«é›†ä¸­æ‹·è´åˆ°è‡ªè¡Œå»ºç«‹çš„ lib å’Œ includes ç›®å½•ä¸‹ï¼Œå¹¶ä¿®æ”¹ gsnap çš„ Makefileã€‚æ‰§è¡Œ make åå°±èƒ½å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶ gsnapã€‚ å°†å¾—åˆ°çš„ gsnap å¯æ‰§è¡Œæ–‡ä»¶æ‹·è´åˆ°ç›®æ ‡æ¿çš„usrbin ç›®å½•ä¸‹ï¼Œæ‰§è¡Œæˆªå±å‘½ä»¤ï¼š gsnap fb.jpg /dev/fb0","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿","åº”ç”¨è½¯ä»¶ç§»æ¤"]},{"title":"OK3568çš„æ–‡ä»¶ç³»ç»Ÿè£å‰ª","path":"/2024/07/29/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-ç³»ç»Ÿç§»æ¤-OK3568çš„æ–‡ä»¶ç³»ç»Ÿè£å‰ª/","content":"0. æ¦‚è¿°ç°é˜¶æ®µåœ¨å·¥ä½œè¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ˜¯é£å‡ŒåµŒå…¥å¼çš„ OK3568 å¼€å‘æ¿ï¼Œéœ€è¦å¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œé’ˆå¯¹æ€§è£å‰ªï¼Œç¼©å‡æ–‡ä»¶ç³»ç»Ÿå¤§å°ï¼Œç°è£å‰ªå‰å®˜æ–¹æ–‡ä»¶ç³»ç»Ÿå¤§å°ä¸º 1.28GBï¼Œè£å‰ªåæ–‡ä»¶ç³»ç»Ÿå¤§å°ä¸º 0.7GB 1. è„šæœ¬åˆ†æåœ¨å®˜æ–¹æä¾›çš„å¼€å‘åŒ…ä¸­ï¼Œæ‰€æœ‰çš„ç¼–è¯‘è¿‡ç¨‹éƒ½æ˜¯ç”±æ ¹ç›®å½•ä¸‹çš„ build.sh æ§åˆ¶çš„ï¼Œè·Ÿè¸ªè¯¥è„šæœ¬å‘ç°ç¼–è¯‘æ–‡ä»¶ç³»ç»Ÿçš„æ­¥éª¤å¦‚ä¸‹ï¼š æ‰§è¡Œ build.sh rootfs é€šè¿‡ buildroot æ–¹å¼ç¼–è¯‘æ–‡ä»¶ç³»ç»Ÿ æ‰§è¡Œæ—¶ï¼Œè„šæœ¬è°ƒç”¨å…¶ä¸­çš„ build_rootfs æ–¹æ³• build_rootfs æ–¹æ³•é€šè¿‡å‘½ä»¤è¡Œè¾“å…¥å‚æ•°åˆ¤æ–­å½“æ—¶ç”¨çš„ yocto æˆ– debian æˆ– distro æˆ– buildroot çš„æ–¹å¼ç¼–è¯‘æ–‡ä»¶ç³»ç»Ÿï¼Œå½“å‰é€‰æ‹©çš„æ˜¯ buildroot è°ƒç”¨ build_buildroot æ–¹æ³•ï¼Œæ‰§è¡Œ device/rockchip/common ä¸­çš„ mk-buildroot.sh è„šæœ¬ åœ¨ mk-buildroot.sh è„šæœ¬ä¸­è°ƒç”¨ buildroot/build/envsetup.shï¼Œenvsetup.sh ç”¨äºåˆå§‹åŒ–ç¯å¢ƒå˜é‡å¹¶è®¾ç½® buildroot/configs/OK3568_defconfig ä¸º buildroot ç¼–è¯‘æ–‡ä»¶ç³»ç»Ÿçš„é»˜è®¤é…ç½®æ–‡ä»¶ è¯»å– buildroot/configs/OK3568_defconfig ä¸­çš„é…ç½®ï¼Œå¹¶è¦†ç›–æ­£åœ¨ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œæ­£åœ¨ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ä½äº buildroot/.configï¼Œé€šè¿‡ buildroot/.config é…ç½®æ–‡ä»¶ç³»ç»Ÿ ç¼–è¯‘é€‰é¡¹å¯¹æ–‡ä»¶ç³»ç»Ÿå¤§å°çš„å½±å“ï¼š ä¾‹.å–æ¶ˆ BR2_PACKAGE_TENSORFLOW é€‰é¡¹ä¸ä¸€å®šä¼šä½¿æ–‡ä»¶ç³»ç»Ÿé•œåƒå¤§å°å˜å°ï¼ŒåŸå› å¦‚ä¸‹ï¼š å–æ¶ˆè¯¥é€‰é¡¹åªä¼šå½±å“åˆ°æ„å»ºæ—¶æ˜¯å¦ç¼–è¯‘ TensorFlow è½¯ä»¶åŒ…ï¼Œå¯¹å·²ç»å®‰è£…çš„è½¯ä»¶åŒ…ä¸ä¼šäº§ç”Ÿå½±å“ï¼Œå› æ­¤å¯¹æ–‡ä»¶ç³»ç»Ÿé•œåƒå¤§å°çš„å½±å“æ˜¯æœ‰é™çš„ TensorFlow è½¯ä»¶åŒ…å¯èƒ½å¹¶ä¸å ç”¨å¾ˆå¤§çš„ç©ºé—´ï¼Œå› æ­¤å–æ¶ˆè¯¥é€‰é¡¹å¯¹æ–‡ä»¶ç³»ç»Ÿé•œåƒå¤§å°çš„å½±å“ä¹Ÿæ¯”è¾ƒæœ‰é™ å› æ­¤ï¼Œå–æ¶ˆæŸä¸€ç¼–è¯‘é€‰é¡¹å¹¶ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ–¹æ³•æ¥å‡å°æ–‡ä»¶ç³»ç»Ÿé•œåƒå¤§å°ï¼Œå¯ä»¥è€ƒè™‘é€šè¿‡ åˆ é™¤ä¸å¿…è¦çš„æ–‡ä»¶ è°ƒæ•´å‹ç¼©å‚æ•° 2.è£å‰ª2.1 é…ç½®æ–‡ä»¶#include audio.config #éŸ³é¢‘ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚é‡‡æ ·ç‡ã€å£°é“æ•°ã€ç¼–ç æ ¼å¼ç­‰ï¼ˆå·²åˆ ï¼‰#include audio_gst.config\t#ï¼ˆå·²åˆ ï¼‰#include base.config #ç³»ç»ŸåŸºæœ¬é…ç½®ï¼Œä¾‹å¦‚æ—¶é’Ÿé¢‘ç‡ã€å†…å­˜åˆ†é…ã€å¯åŠ¨é€‰é¡¹ç­‰#include base_extra.config#include benchmark.config #æ€§èƒ½æµ‹è¯•ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚æµ‹è¯•ç”¨ä¾‹ã€æµ‹è¯•å‚æ•°#include bt.config #è“ç‰™ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚è“ç‰™åè®®æ ˆé€‰é¡¹ã€è“ç‰™è®¾å¤‡ä¿¡æ¯ï¼ˆç¦åˆ ï¼‰#include camera.config #ç›¸æœºç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚åˆ†è¾¨ç‡ã€æ›å…‰æ—¶é—´ã€å¸§ç‡ï¼ˆå·²åˆ ï¼‰#include camera_gst.config\t#ï¼ˆå·²åˆ ï¼‰#include debug.config #è°ƒè¯•ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚æ—¥å¿—çº§åˆ«ã€è°ƒè¯•é€‰é¡¹ç­‰#include debug2.config#include display.config #æ˜¾ç¤ºç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚åˆ†è¾¨ç‡ã€å±å¹•æ—‹è½¬ã€è‰²å½©ç©ºé—´ç­‰#include gpu.config GPU #ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚ GPU é¢‘ç‡ã€GPUç¼“å­˜é€‰é¡¹ç­‰#include network.config #ç½‘ç»œç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚ IP åœ°å€ã€å­ç½‘æ©ç ã€ç½‘ç»œåè®®ç­‰ï¼›#include ntfs.config NTFS #æ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚æ–‡ä»¶ç³»ç»Ÿé€‰é¡¹ã€ç£ç›˜åˆ†åŒºä¿¡æ¯ç­‰ï¼›#include qt.config #QT åº“ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚ QT ç‰ˆæœ¬ã€QTç¼–è¯‘é€‰é¡¹ç­‰ï¼›#include video_mpp.config #è§†é¢‘ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚ç¼–ç æ ¼å¼ã€åˆ†è¾¨ç‡ã€å¸§ç‡ç­‰ï¼›ï¼ˆå·²åˆ ï¼‰#include video_gst.config ï¼ˆå·²åˆ ï¼‰#include video_gst_rtsp.config #RTSP åè®®ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚ RTSPæœåŠ¡å™¨åœ°å€ã€ç«¯å£å·ç­‰ï¼›ï¼ˆå·²åˆ ï¼‰#include rk356x_arm64.config #å¼€å‘æ¿çš„ç¡¬ä»¶é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚ CPU æ¶æ„ã€å†…å­˜å¤§å°ã€å¤–è®¾é€‰é¡¹ç­‰ï¼›#include test.config #æµ‹è¯•ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚æµ‹è¯•ç”¨ä¾‹ã€æµ‹è¯•å‚æ•°ç­‰ã€‚BR2_PACKAGE_RECOVERY=y\t##å¯ç”¨Recoveryè½¯ä»¶åŒ…ï¼Œç”¨äºåœ¨ç³»ç»ŸæŸåæˆ–æ— æ³•å¯åŠ¨æ—¶æ¢å¤ç³»ç»ŸBR2_PACKAGE_RECOVERY_BOOTCONTROL=y\t#å¯ç”¨RecoveryBootControlè½¯ä»¶åŒ…ï¼Œç”¨äºæ§åˆ¶ç³»ç»Ÿå¯åŠ¨æ—¶æ˜¯å¦è¿›å…¥Recoveryæ¨¡å¼BR2_PACKAGE_RECOVERY_RETRY=y\t#å¯ç”¨RecoveryRetryè½¯ä»¶åŒ…ï¼Œç”¨äºåœ¨Recoveryæ¨¡å¼ä¸‹é‡è¯•æ›´æ–°æ“ä½œBR2_PACKAGE_RECOVERY_USE_UPDATEENGINE=y\t#å¯ç”¨UpdateEngineè½¯ä»¶åŒ…ï¼Œç”¨äºåœ¨Recoveryæ¨¡å¼ä¸‹è¿›è¡Œç³»ç»Ÿæ›´æ–°BR2_PACKAGE_RECOVERY_UPDATEENGINEBIN=y\t#å¯ç”¨UpdateEngineBinaryè½¯ä»¶åŒ…ï¼Œç”¨äºåœ¨Recoveryæ¨¡å¼ä¸‹æ‰§è¡Œç³»ç»Ÿæ›´æ–°BR2_PACKAGE_RECOVERY_NO_UI=y\t#å¯ç”¨NoUIRecoveryè½¯ä»¶åŒ…ï¼Œç”¨äºåœ¨Recoveryæ¨¡å¼ä¸‹ç¦ç”¨UIç•Œé¢BR2_TARGET_ENABLE_ROOT_LOGIN=y\t#å¯ç”¨rootç”¨æˆ·ç™»å½•BR2_TARGET_GENERIC_ROOT_PASSWD=ubuntu\t#è®¾ç½®rootç”¨æˆ·çš„å¯†ç ä¸ºubuntuBR2_TARGET_GENERIC_GETTY_BAUDRATE_115200=y\t#è®¾ç½®ç»ˆç«¯æ³¢ç‰¹ç‡ä¸º115200BR2_TARGET_LOCALTIME=Asia/Shanghai\t#è®¾ç½®ç³»ç»Ÿæ—¶åŒºä¸ºäºšæ´²/ä¸Šæµ·BR2_ROOTFS_OVERLAY=board/rockchip/ok3568/fs-overlay/\t#è®¾ç½®æ ¹æ–‡ä»¶ç³»ç»Ÿçš„è¦†ç›–ç›®å½•BR2_PACKAGE_TENSORFLOW=y\t#å¯ç”¨TensorFlowè½¯ä»¶åŒ…ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_RKNPU2=y\t#å¯ç”¨RKNPU2è½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒRockchipèŠ¯ç‰‡çš„ç¥ç»ç½‘ç»œåŠ é€Ÿï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_RKAIQ_TOOL_SERVER=y\t#å¯ç”¨RKAIQToolServerè½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒRockchipèŠ¯ç‰‡çš„å›¾åƒå¤„ç†ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_FORLINX=y\t#å¯ç”¨Forlinxè½¯ä»¶åŒ…BR2_PACKAGE_MATRIX_BROWSER=y\t#å¯ç”¨MatrixBrowserè½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒçŸ©é˜µå¼é”®ç›˜ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_DWKEYBOARD=y\t#å¯ç”¨DWKeyboardè½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒå¤šè¯­è¨€è¾“å…¥æ³•ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_QUECTELCM=y\t#å¯ç”¨QuectelCMè½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒQuectelæ— çº¿æ¨¡å—ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_FORLINX_QT=y\t#å¯ç”¨ForlinxQtè½¯ä»¶åŒ…BR2_PACKAGE_FORLINX_CMD=y\t#å¯ç”¨ForlinxCMDè½¯ä»¶åŒ…BR2_PACKAGE_FFMPEG_AVRESAMPLE=y\t#å¯ç”¨FFmpegAvresampleè½¯ä»¶åŒ…ï¼Œç”¨äºéŸ³é¢‘é‡é‡‡æ ·ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_FFMPEG_SWSCALE=y\t#å¯ç”¨FFmpegSwscaleè½¯ä»¶åŒ…ï¼Œç”¨äºè§†é¢‘ç¼©æ”¾ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_HICOLOR_ICON_THEME=y\t#å¯ç”¨HicolorIconThemeè½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒé«˜åˆ†è¾¨ç‡å›¾æ ‡ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_QT5BASE_SQLITE_QT=y\t#å¯ç”¨Qt5BaseSQLiteQtè½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒSQLiteæ•°æ®åº“ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_QT5BASE_GIF=y\t#å¯ç”¨Qt5BaseGIFè½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒGIFå›¾åƒæ ¼å¼ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_QT5CHARTS=y\t#å¯ç”¨Qt5Chartsè½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒå›¾è¡¨å’Œç»Ÿè®¡æ•°æ®çš„å¯è§†åŒ–ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_QT5SERIALBUS=y\t#å¯ç”¨Qt5SerialBusè½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒä¸²è¡Œæ€»çº¿é€šä¿¡BR2_PACKAGE_QT5WEBKIT=y\t#å¯ç”¨Qt5WebKitè½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒWebæµè§ˆå™¨ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_QT5WEBENGINE=y\t#å¯ç”¨Qt5WebEngineè½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒWebæµè§ˆå™¨å¼•æ“ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_UBOOT_TOOLS=y\t#å¯ç”¨U-Bootå·¥å…·è½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒU-Bootå¼•å¯¼ç¨‹åºBR2_PACKAGE_PHP=y\t#å¯ç”¨PHPè½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒæœåŠ¡å™¨ç«¯è„šæœ¬è¯­è¨€ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_PHP_SAPI_CGI=y\t#å¯ç”¨PHPSAPICGIè½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒä½¿ç”¨CGIæ¥å£è¿è¡ŒPHPè„šæœ¬ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_PHP_SAPI_CLI=y\t#å¯ç”¨PHPSAPICLIè½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒä½¿ç”¨å‘½ä»¤è¡Œæ¥å£è¿è¡ŒPHPè„šæœ¬ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_PHP_EXT_FILEINFO=y\t#å¯ç”¨PHPFileinfoæ‰©å±•è½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒæ–‡ä»¶ç±»å‹æ£€æµ‹ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_PHP_EXT_OPCACHE=y\t#å¯ç”¨PHPOpcacheæ‰©å±•è½¯ä»¶åŒ…ï¼Œç”¨äºæé«˜PHPè„šæœ¬çš„æ‰§è¡Œæ•ˆç‡ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_PHP_EXT_READLINE=y\t#å¯ç”¨PHPReadlineæ‰©å±•è½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒå‘½ä»¤è¡Œç¼–è¾‘ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_PHP_EXT_ICONV=y\t#å¯ç”¨PHPIconvæ‰©å±•è½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒå­—ç¬¦é›†è½¬æ¢ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_PHP_EXT_MBSTRING=y\t#å¯ç”¨PHPMbstringæ‰©å±•è½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒå¤šå­—èŠ‚å­—ç¬¦é›†ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_PHP_EXT_JSON=y\t#å¯ç”¨PHPJSONæ‰©å±•è½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒdJSONæ•°æ®æ ¼å¼BR2_PACKAGE_PHP_EXT_TOKENIZER=y\t#å¯ç”¨PHPTokenizeræ‰©å±•è½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒPHPä»£ç è§£æï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_PHP_EXT_CURL=y\t#å¯ç”¨PHPcURLæ‰©å±•è½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒHTTPè¯·æ±‚ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_PHP_EXT_FTP=y\t#å¯ç”¨PHPFTPæ‰©å±•è½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒFTPåè®®ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_PHP_EXT_SOAP=y\t#å¯ç”¨PHPSOAPæ‰©å±•è½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒSOAPåè®®ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_PHP_EXT_XMLRPC=y\t#å¯ç”¨PHPXML-RPCæ‰©å±•è½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒXML-RPCåè®®ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_TINYALSA=y\t#å¯ç”¨TinyALSAè½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒéŸ³é¢‘åŠŸèƒ½ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_LZO=y\t#å¯ç”¨LZOå‹ç¼©è½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒæ•°æ®å‹ç¼©BR2_PACKAGE_LIBGTK3=y\t#å¯ç”¨GTK3åº“è½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒå›¾å½¢ç”¨æˆ·ç•Œé¢BR2_PACKAGE_OPENCV3=y\t#å¯ç”¨OpenCV3è½¯ä»¶åŒ…ï¼Œç”¨äºæ”¯æŒè®¡ç®—æœºè§†è§‰ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_OPENCV3_LIB_HIGHGUI=y\t#ç¼–è¯‘OpenCV3ä¸­çš„HighGUIåº“ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_OPENCV3_WITH_GTK3=y\t#å¯ç”¨GTK3æ”¯æŒï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_OPENCV3_LIB_PHOTO=y\t#Photoåº“ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_OPENCV3_LIB_SHAPE=y\t#Shapeåº“ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_OPENCV3_LIB_STITCHING=y\t#Stitchingåº“ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_OPENCV3_WITH_JASPER=y\t#å¯ç”¨Jasperæ”¯æŒï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_OPENCV3_WITH_JPEG=y\t#å¯ç”¨JPEGæ”¯æŒï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_OPENCV3_WITH_PNG=y\t#å¯ç”¨PNGæ”¯æŒï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_OPENCV3_WITH_PROTOBUF=y\t#å¯ç”¨ProtocolBuffersæ”¯æŒã€‚ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_OPENCV3_WITH_TIFF=y\t#å¯ç”¨TIFFæ”¯æŒï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_OPENCV3_WITH_V4L=y\t#å¯ç”¨Video4Linuxæ”¯æŒã€‚ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_IPROUTE2=y\t#é€‰ä¸­iproute2è½¯ä»¶åŒ…è¿›è¡Œç¼–è¯‘BR2_PACKAGE_IPTABLES=y\t#é€‰ä¸­iptablesè½¯ä»¶åŒ…è¿›è¡Œç¼–è¯‘BR2_PACKAGE_IPTABLES_BPF_NFSYNPROXY=y\t#ç¼–è¯‘iptablesæ—¶å¯ç”¨BPFå’Œnf_synproxyæ”¯æŒBR2_PACKAGE_IPTABLES_NFTABLES=y\t#ç¼–è¯‘iptablesæ—¶å¯ç”¨nftablesæ”¯æŒBR2_PACKAGE_LIGHTTPD=y\t#é€‰ä¸­lighttpdè½¯ä»¶åŒ…è¿›è¡Œç¼–è¯‘ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_LIGHTTPD_PCRE=y\t#ç¼–è¯‘lighttpdæ—¶å¯ç”¨PCREæ”¯æŒï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_OPENSSH=y\t#é€‰ä¸­OpenSSHè½¯ä»¶åŒ…è¿›è¡Œç¼–è¯‘BR2_PACKAGE_VSFTPD=y\t#é€‰ä¸­vsftpdè½¯ä»¶åŒ…è¿›è¡Œç¼–è¯‘BR2_PACKAGE_RKWIFIBT=n\t#ä¸é€‰ä¸­rkwifibtè½¯ä»¶åŒ…è¿›è¡Œç¼–è¯‘BR2_PACKAGE_USBMOUNT=n\t#ä¸é€‰ä¸­usbmountè½¯ä»¶åŒ…è¿›è¡Œç¼–è¯‘BR2_PACKAGE_OPENCV3_LIB_PYTHON=y\t#ç¼–è¯‘OpenCV3ä¸­çš„Pythonåº“ï¼ˆå·²åˆ ï¼‰BR2_PACKAGE_LIBGTK3_BROADWAY=y\t#ç¼–è¯‘libgtk3æ—¶å¯ç”¨Broadwayæ”¯æŒBR2_PACKAGE_LIBGTK3_WAYLAND=y\t#ç¼–è¯‘libgtk3æ—¶å¯ç”¨Waylandæ”¯æŒBR2_PACKAGE_OPENCV3_GUI_NONE=n\t#ç¼–è¯‘OpenCV3æ—¶å¯ç”¨GUIæ”¯æŒBR2_PACKAGE_QT5SERIALPORT=y\t#é€‰ä¸­Qt5ä¸­çš„SerialPortæ¨¡å—è¿›è¡Œç¼–è¯‘ 2.2 è½¯ä»¶åŒ…Buildroot çš„è½¯ä»¶åŒ…é…ç½®æ–‡ä»¶ä½äº ~/buildroot/package/rockchip/Config.inï¼ŒåŒ…å«äº†å¤šä¸ªè½¯ä»¶åŒ…çš„é…ç½®ï¼Œå¯ä»¥åœ¨åŸºäº Rockchip ç¡¬ä»¶çš„åµŒå…¥å¼ç³»ç»Ÿä¸Šè¿›è¡Œæ„å»ºå’Œå®‰è£…ã€‚è¿™äº›è½¯ä»¶åŒ…å¹¶ä¸æ˜¯å…¨éƒ¨å¿…é¡»çš„ï¼Œå…·ä½“éœ€è¦å“ªäº›è½¯ä»¶åŒ…å–å†³äºåµŒå…¥å¼ç³»ç»Ÿçš„å…·ä½“éœ€æ±‚å’Œé…ç½®ã€‚ ROS\tæœºå™¨äººæ“ä½œç³»ç»Ÿï¼Œæä¾›äº†ä¸€ç§æ„å»ºæœºå™¨äººåº”ç”¨çš„æ¡†æ¶ï¼ŒåŒ…æ‹¬ç¡¬ä»¶æŠ½è±¡ã€è®¾å¤‡é©±åŠ¨ã€åº“ã€å¯è§†åŒ–å·¥å…·ã€æ¶ˆæ¯ä¼ é€’å’Œè½¯ä»¶åŒ…ç®¡ç†ç­‰åŠŸèƒ½\tLocalPlayer\tä¸€ä¸ªæœ¬åœ°æ’­æ”¾å™¨ï¼Œå¯ä»¥æ’­æ”¾æœ¬åœ°éŸ³é¢‘å’Œè§†é¢‘æ–‡ä»¶\tAPLæ ¸å¿ƒåº“\tAlexa Presentation Languageï¼ˆAPLï¼‰çš„æ ¸å¿ƒåº“ï¼Œæä¾›äº†ä¸€ä¸ªç”¨äºæ„å»ºAlexaæ™ºèƒ½å±å¹•ä½“éªŒçš„æ¡†æ¶\tAVSè®¾å¤‡SDK\tAlexa Voice Serviceï¼ˆAVSï¼‰è®¾å¤‡SDKï¼Œæä¾›äº†ä¸€ä¸ªç”¨äºæ„å»ºAlexaæ™ºèƒ½è®¾å¤‡çš„æ¡†æ¶ï¼ŒåŒ…æ‹¬è¯­éŸ³è¯†åˆ«ã€è¯­éŸ³åˆæˆã€éŸ³é¢‘å¤„ç†ã€è®¾å¤‡æ§åˆ¶ç­‰åŠŸèƒ½\tAlexaæ™ºèƒ½å±å¹•SDK\tæ„å»ºAlexaæ™ºèƒ½å±å¹•åº”ç”¨çš„SDKï¼ŒåŒ…æ‹¬æ¨¡æ¿ã€ç»„ä»¶ã€æ ·å¼ã€äº‹ä»¶ç­‰åŠŸèƒ½\tACS\tAlexaå®¢æˆ·ç«¯æœåŠ¡ï¼Œæä¾›äº†ä¸€ä¸ªç”¨äºæ„å»ºAlexaå®¢æˆ·ç«¯åº”ç”¨çš„æ¡†æ¶ï¼ŒåŒ…æ‹¬è®¾å¤‡æˆæƒã€ç”¨æˆ·è®¤è¯ã€è®¾å¤‡çŠ¶æ€ç®¡ç†ç­‰åŠŸèƒ½\tAlexaå®¢æˆ·ç«¯SDK\tç”¨äºæ„å»ºAlexaå®¢æˆ·ç«¯åº”ç”¨çš„SDKï¼ŒåŒ…æ‹¬è¯­éŸ³è¯†åˆ«ã€è¯­éŸ³åˆæˆã€è®¾å¤‡æ§åˆ¶ç­‰åŠŸèƒ½\tMPP\tMedia Processing Platformï¼Œæä¾›äº†ä¸€ä¸ªç”¨äºåµŒå…¥å¼ç³»ç»Ÿä¸­éŸ³è§†é¢‘å¤„ç†çš„æ¡†æ¶ï¼ŒåŒ…æ‹¬ç¼–è§£ç ã€æ»¤é•œã€éŸ³é¢‘å¤„ç†ç­‰åŠŸèƒ½\tdåœ°å€æ£€æŸ¥å™¨\tæä¾›äº†ä¸€ç§æ£€æŸ¥ç¨‹åºä¸­åœ°å€é”™è¯¯çš„å·¥å…·ï¼Œå¸®åŠ©å¼€å‘äººå‘˜åœ¨ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­å‘ç°å’Œçº æ­£åœ°å€é”™è¯¯\tGStreamer1 Rockchip\tåŸºäºGStreamer1çš„Rockchipç¡¬ä»¶åŠ é€Ÿæ’ä»¶ï¼Œæä¾›äº†ç¡¬ä»¶åŠ é€Ÿçš„éŸ³è§†é¢‘ç¼–è§£ç å’Œæ¸²æŸ“åŠŸèƒ½\tdç›¸æœºå¼•æ“CIFISP\tç”¨äºRockchipèŠ¯ç‰‡çš„ISPå¼•æ“ï¼Œæä¾›äº†å›¾åƒå¤„ç†ã€ç™½å¹³è¡¡ã€è‡ªåŠ¨æ›å…‰ã€è‡ªåŠ¨å¯¹ç„¦ç­‰åŠŸèƒ½\tdWakeWordAgent\tå”¤é†’è¯å¼•æ“ï¼Œæä¾›äº†å”¤é†’è¯æ£€æµ‹å’Œå“åº”çš„åŠŸèƒ½\tdPCBA\tPCBç»„è£…å’Œæµ‹è¯•å·¥å…·ï¼Œç”¨äºæµ‹è¯•å’Œç»„è£…PCBæ¿\tdSoftAP\tè½¯ä»¶æ¥å…¥ç‚¹ï¼Œæä¾›äº†ä¸€ä¸ªåŸºäºè½¯ä»¶çš„Wi-Fiæ¥å…¥ç‚¹ï¼Œå¯ä»¥è®©å…¶ä»–è®¾å¤‡è¿æ¥åˆ°åµŒå…¥å¼ç³»ç»Ÿçš„Wi-Fiç½‘ç»œ\tdSoftAPæœåŠ¡å™¨\tæä¾›äº†ä¸€ä¸ªWebæœåŠ¡å™¨ï¼Œå¯ä»¥é€šè¿‡Webç•Œé¢é…ç½®å’Œç®¡ç†SoftAP\tdWifiautoSetup dGStreamer1 IEP\tåŸºäºGStreamer1çš„IEPæ’ä»¶ï¼Œæä¾›äº†ç¡¬ä»¶åŠ é€Ÿçš„è§†é¢‘ç¼–è§£ç å’Œæ¸²æŸ“åŠŸèƒ½\tdrkwifibt dRockchipå®ç”¨å·¥å…·\tæä¾›äº†ä¸€äº›ç”¨äºRockchipç¡¬ä»¶çš„å®ç”¨å·¥å…·ï¼ŒåŒ…æ‹¬å‡çº§å·¥å…·ã€è°ƒè¯•å·¥å…·ã€é©±åŠ¨ç¨‹åºç­‰\tmdevæŒ‚è½½\tæä¾›äº†ä¸€ç§è‡ªåŠ¨æŒ‚è½½Uç›˜ã€SDå¡ç­‰å¤–éƒ¨å­˜å‚¨è®¾å¤‡çš„å·¥å…·\tALSAæ•è·\tæä¾›äº†ä¸€ä¸ªç”¨äºALSAéŸ³é¢‘æ•è·çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä»éŸ³é¢‘è®¾å¤‡ä¸­æ•è·éŸ³é¢‘æ•°æ®\tdUVCåº”ç”¨ç¨‹åº\tæä¾›äº†ä¸€ä¸ªç”¨äºUVCæ‘„åƒå¤´çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥æ•è·è§†é¢‘æ•°æ®å¹¶è¿›è¡Œå¤„ç†\tdUACåº”ç”¨ç¨‹åº\tæä¾›äº†ä¸€ä¸ªç”¨äºUSBéŸ³é¢‘ç±»è®¾å¤‡çš„åº”ç”¨ç¨‹åº\tdlibmali\tArm Mali GPUçš„ç”¨æˆ·ç©ºé—´é©±åŠ¨ç¨‹åº\tlibhdmiset\tæä¾›äº†ä¸€ä¸ªç”¨äºHDMIè®¾ç½®çš„åº“\tddialserver\tæä¾›äº†ä¸€ä¸ªç”¨äºè¿œç¨‹ç®¡ç†è®¾å¤‡çš„æœåŠ¡å™¨\tlinux-rga\tRockchip Graphics Acceleratorï¼ˆRGAï¼‰çš„Linuxå†…æ ¸é©±åŠ¨ç¨‹åº\tlinux-serial-test\tæä¾›äº†ä¸€ä¸ªç”¨äºLinuxä¸²å£æµ‹è¯•çš„åº”ç”¨ç¨‹åº\tdiflytekSDK\tæä¾›äº†ä¸€ä¸ªç”¨äºè®¯é£è¯­éŸ³è¯†åˆ«çš„SDK\tdeq_drc_process\tæä¾›äº†ä¸€ä¸ªç”¨äºéŸ³é¢‘å‡è¡¡å’ŒåŠ¨æ€èŒƒå›´æ§åˆ¶çš„åº“\tdalsa_ladspa\tæä¾›äº†ä¸€ä¸ªç”¨äºALSAéŸ³é¢‘çš„LADSPAæ’ä»¶åº“\tdrockchip_test\tæä¾›äº†ä¸€äº›ç”¨äºRockchipç¡¬ä»¶æµ‹è¯•çš„å·¥å…·\tQStressTest\tæä¾›äº†ä¸€ä¸ªç”¨äºç³»ç»Ÿå‹åŠ›æµ‹è¯•çš„å·¥å…·\trockchip_modules\tæä¾›äº†ä¸€äº›ç”¨äºRockchipç¡¬ä»¶çš„å†…æ ¸æ¨¡å—\tbroadcom_bsa\tBroadcomè“ç‰™æ ˆçš„ç”¨æˆ·ç©ºé—´åº“\tcypress_bsa\tCypressè“ç‰™æ ˆçš„ç”¨æˆ·ç©ºé—´åº“\tpm-suspend-api\tæä¾›äº†ä¸€ä¸ªç”¨äºç³»ç»ŸæŒ‚èµ·å’Œæ¢å¤çš„API\trtw_simple_config\tæä¾›äº†ä¸€ä¸ªç”¨äºRealtek Wi-FièŠ¯ç‰‡çš„ç®€å•é…ç½®å·¥å…·\tdrecovery\tæä¾›äº†ä¸€ä¸ªç”¨äºæ¢å¤ç³»ç»Ÿçš„å·¥å…·\tmodeset\tæä¾›äº†ä¸€ä¸ªç”¨äºæ˜¾ç¤ºæ¨¡å¼è®¾ç½®çš„å·¥å…·\trkjpeg\tæä¾›äº†ä¸€ä¸ªç”¨äºRockchip JPEGç¼–è§£ç çš„åº“\tdjpegdemo\tæä¾›äº†ä¸€ä¸ªç”¨äºJPEGç¼–è§£ç çš„æ¼”ç¤ºç¨‹åº\tdueventd\tæä¾›äº†ä¸€ä¸ªç”¨äºå¤„ç†Linuxç³»ç»Ÿäº‹ä»¶çš„å®ˆæŠ¤è¿›ç¨‹\trkupdate\tæä¾›äº†ä¸€ä¸ªç”¨äºRockchipç³»ç»Ÿå‡çº§çš„å·¥å…·\trktoolkit\tæä¾›äº†ä¸€äº›ç”¨äºRockchipç¡¬ä»¶çš„å·¥å…·é›†\trkmedia\tæä¾›äº†ä¸€ä¸ªç”¨äºRockchipåª’ä½“å¤„ç†çš„æ¡†æ¶\tdrockit\tæä¾›äº†ä¸€ä¸ªç”¨äºéŸ³è§†é¢‘å¤„ç†çš„æ¡†æ¶\tdrkadk\tæä¾›äº†ä¸€ä¸ªç”¨äºRockchip AIå¼€å‘çš„å·¥å…·é›†\tdmusic\tæä¾›äº†ä¸€ä¸ªç”¨äºéŸ³ä¹æ’­æ”¾çš„åº”ç”¨ç¨‹åº\tdvideo\tæä¾›äº†ä¸€ä¸ªç”¨äºè§†é¢‘æ’­æ”¾çš„åº”ç”¨ç¨‹åº\tdcamera carmachine\tæä¾›äº†ä¸€ä¸ªç”¨äºè½¦è½½å¨±ä¹ç³»ç»Ÿçš„åº”ç”¨ç¨‹åº\tdgallery\tæä¾›äº†ä¸€ä¸ªç”¨äºå›¾åº“ç®¡ç†çš„åº”ç”¨ç¨‹åº\tdQLauncher\tè¿™æ˜¯ä¸€ä¸ªåŸºäº Rockchip å¹³å°çš„å¯åŠ¨å™¨ï¼Œç”¨äºå¯åŠ¨è®¾å¤‡ä¸Šçš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡\tQFacialGate\tè¿™æ˜¯ä¸€ä¸ªç”¨äºäººè„¸è¯†åˆ«çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥åœ¨ Rockchip å¹³å°ä¸Šå®ç°äººè„¸è¯†åˆ«åŠŸèƒ½\tdsettings\tè¿™æ˜¯ä¸€ä¸ªæä¾›è®¾ç½®å’Œé…ç½®é€‰é¡¹çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·é…ç½®è®¾å¤‡å¹¶è¿›è¡Œå„ç§è®¾ç½®\tQcamera dqfm\tè¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶ç®¡ç†å™¨è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·ç®¡ç†è®¾å¤‡ä¸Šçš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹\tqplayer dMultivideoplayer dMulticamera dQsetting dpowermanager\tè¿™æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†è®¾å¤‡ç”µæºçš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·ç®¡ç†è®¾å¤‡çš„ç”µæºçŠ¶æ€å’Œç”µæ± å¯¿å‘½\taudioservice\tè¿™æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†è®¾å¤‡éŸ³é¢‘çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·ç®¡ç†è®¾å¤‡çš„éŸ³é¢‘è¾“å…¥å’Œè¾“å‡º\tdsecurityAuth recoverySystem\tè¿™æ˜¯ä¸€ä¸ªç”¨äºè®¾å¤‡æ¢å¤å’Œä¿®å¤çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·åœ¨è®¾å¤‡å‡ºç°é—®é¢˜æ—¶è¿›è¡Œæ¢å¤å’Œä¿®å¤æ“ä½œ\tLed_control_app dNpu_powerctrl dNpu_powerctrl_combine dN4 Cae_vad Ipc_share_memory Rk_hw_vad minigui\tè¿™æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ GUIï¼ˆå›¾å½¢ç”¨æˆ·ç•Œé¢ï¼‰æ¡†æ¶ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ„å»ºç®€å•çš„ GUI åº”ç”¨ç¨‹åº\tMinigui_demo Kernel_modules tensorflow Rknpurknpu2rknpu-fwrknn_demo\tè¿™äº›è½¯ä»¶åŒ…éƒ½ä¸ç‘èŠ¯å¾®çš„ç¥ç»å¤„ç†å•å…ƒï¼ˆNPUï¼‰ç›¸å…³ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ„å»ºå’Œä¼˜åŒ–ç¥ç»ç½‘ç»œæ¨¡å‹\tdficial_gateRkfacialpose_bodyface_detect\tè¿™äº›è½¯ä»¶åŒ…éƒ½ä¸é¢éƒ¨è¯†åˆ«ç›¸å…³ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ„å»ºå’Œä¼˜åŒ–é¢éƒ¨è¯†åˆ«æ¨¡å‹\tdrockx\tè¿™æ˜¯ä¸€ä¸ª Rockchip å¹³å°ä¸Šçš„è®¡ç®—æœºè§†è§‰åº“ï¼Œæä¾›äº†å„ç§è®¡ç®—æœºè§†è§‰ç®—æ³•å’Œå·¥å…·\tdrockface\tè¿™æ˜¯ä¸€ä¸ªäººè„¸è¯†åˆ«åº“ï¼Œå¯ä»¥åœ¨ Rockchip å¹³å°ä¸Šå®ç°äººè„¸è¯†åˆ«åŠŸèƒ½\tdmtp\tè¿™æ˜¯ä¸€ä¸ªç”¨äºåœ¨è®¡ç®—æœºå’Œç§»åŠ¨è®¾å¤‡ä¹‹é—´ä¼ è¾“æ–‡ä»¶çš„åè®®ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·å¿«é€Ÿåœ°åœ¨è®¾å¤‡ä¹‹é—´ä¼ è¾“æ–‡ä»¶\tdalsa-config\tè¿™æ˜¯ä¸€ä¸ªç”¨äºé…ç½® ALSAï¼ˆAdvanced Linux Sound Architectureï¼‰çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·é…ç½®è®¾å¤‡çš„éŸ³é¢‘è¾“å…¥å’Œè¾“å‡º\tdlibcapsimage\tè¿™æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†å›¾åƒçš„åº“ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¤„ç†å’Œä¼˜åŒ–å›¾åƒ\tdrkscript\tè¿™æ˜¯ä¸€ä¸ªç”¨äºè¿è¡Œè„šæœ¬çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·åœ¨è®¾å¤‡ä¸Šè¿è¡Œå„ç§è„šæœ¬\tDeviceiodeviceio_release\tè¿™æ˜¯ç”¨äºè®¾å¤‡è¾“å…¥è¾“å‡ºçš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜ç¼–å†™å’Œä¼˜åŒ–è¾“å…¥è¾“å‡ºé©±åŠ¨ç¨‹åº\tDui\tè¿™æ˜¯ä¸€ä¸ªç”¨äºå¼€å‘ UIï¼ˆç”¨æˆ·ç•Œé¢ï¼‰åº”ç”¨ç¨‹åºçš„åº“ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ„å»ºå’Œä¼˜åŒ– UI åº”ç”¨ç¨‹åº\tble_wificonfig\tè¿™æ˜¯ä¸€ä¸ªç”¨äºé…ç½®è“ç‰™å’Œ Wi-Fi è¿æ¥çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·é…ç½®è®¾å¤‡çš„æ— çº¿è¿æ¥\tdlibavbã€libavb_ablibavb_user\tè¿™äº›è½¯ä»¶åŒ…éƒ½ä¸ AVBï¼ˆAndroid Verified Bootï¼‰ç›¸å…³ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·éªŒè¯è®¾å¤‡çš„å¯åŠ¨è¿‡ç¨‹å’Œç³»ç»Ÿå®Œæ•´æ€§\tdlibv4l-rkmpp\tè¿™æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†è§†é¢‘çš„åº“ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¤„ç†å’Œä¼˜åŒ–è§†é¢‘\tdBootcontrolLinuxAB\tè¿™äº›è½¯ä»¶åŒ…éƒ½ä¸å¯åŠ¨æ§åˆ¶ç›¸å…³ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·ç®¡ç†è®¾å¤‡çš„å¯åŠ¨è¿‡ç¨‹å’Œæ§åˆ¶\tsensor-daemon\tè¿™æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†è®¾å¤‡ä¼ æ„Ÿå™¨çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·ç®¡ç†è®¾å¤‡çš„ä¼ æ„Ÿå™¨å’Œæ•°æ®\trtc_demo\tè¿™æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†è®¾å¤‡ RTCï¼ˆReal-Time Clockï¼‰çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·ç®¡ç†è®¾å¤‡çš„æ—¶é—´å’Œæ—¥æœŸ\trk_webui\tè¿™æ˜¯ä¸€ä¸ªç”¨äºå¼€å‘ Web UI åº”ç”¨ç¨‹åºçš„åº“ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ„å»ºå’Œä¼˜åŒ– Web UI åº”ç”¨ç¨‹åº\tdcommon_algorithm\tè¿™æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†å¸¸è§ç®—æ³•çš„åº“ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¤„ç†å’Œä¼˜åŒ–ç®—æ³•\tipcweb-backendLibgdbuslibIPCProtocollibrkdb\tè¿™äº›è½¯ä»¶åŒ…éƒ½ä¸è¿›ç¨‹é—´é€šä¿¡ç›¸å…³ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å®ç°è¿›ç¨‹é—´é€šä¿¡å’Œæ•°æ®ä¼ è¾“\tDbserverNetserverstorage_managerMediaserveraiserver\tè¿™äº›è½¯ä»¶åŒ…éƒ½ä¸è®¾å¤‡ç®¡ç†å’ŒæœåŠ¡ç›¸å…³ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·ç®¡ç†è®¾å¤‡å’ŒæœåŠ¡\trk_oem\tè¿™æ˜¯ä¸€ä¸ªç”¨äº OEMå’Œå®šåˆ¶åŒ–çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©è®¾å¤‡åˆ¶é€ å•†å®šåˆ¶å’Œä¼˜åŒ–è®¾å¤‡\trootfs_ubi_use_custom_filesystem\tè¿™æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºå’Œç®¡ç† UBIï¼ˆUnsorted Block Imagesï¼‰æ–‡ä»¶ç³»ç»Ÿçš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·ç®¡ç†è®¾å¤‡çš„æ–‡ä»¶ç³»ç»Ÿ\trkbar\tè¿™æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†è®¾å¤‡åº•éƒ¨å¯¼èˆªæ çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·ç®¡ç†è®¾å¤‡åº•éƒ¨å¯¼èˆªæ \tminilogger\tè¿™æ˜¯ä¸€ä¸ªç”¨äºè®°å½•æ—¥å¿—çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·è®°å½•è®¾å¤‡çš„è¿è¡Œæ—¥å¿—\tipc-daemonCallFunIpcisp2-ipc\tè¿™äº›è½¯ä»¶åŒ…éƒ½ä¸è¿›ç¨‹é—´é€šä¿¡ç›¸å…³ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å®ç°è¿›ç¨‹é—´é€šä¿¡å’Œæ•°æ®ä¼ è¾“\tsmart_display_service\tè¿™æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†è®¾å¤‡æ™ºèƒ½æ˜¾ç¤ºçš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·ç®¡ç†è®¾å¤‡çš„æ˜¾ç¤ºå’Œæ˜¾ç¤ºè®¾ç½®\tonvif_server\tè¿™æ˜¯ä¸€ä¸ªç”¨äºå®ç° ONVIFï¼ˆOpen Network Video Interface Forumï¼‰åè®®çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·å®ç°ç½‘ç»œè§†é¢‘ç›‘æ§åŠŸèƒ½\tdeptz_demo\tè¿™æ˜¯ä¸€ä¸ªç”¨äºå®ç°ç”µå­å˜ç„¦å’Œç”µå­äº‘å°åŠŸèƒ½çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·å®ç°æ›´å¥½çš„è§†é¢‘ç›‘æ§åŠŸèƒ½\tdrksl å’Œ sl_lock\tè¿™äº›è½¯ä»¶åŒ…éƒ½ä¸è®¾å¤‡å®‰å…¨ç›¸å…³ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·ä¿æŠ¤è®¾å¤‡å®‰å…¨å’Œæ•°æ®éšç§\tmult_uvc_demo\tè¿™æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å¤šä¸ª UVCï¼ˆUSB Video Classï¼‰æ‘„åƒå¤´çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·ç®¡ç†å¤šä¸ªæ‘„åƒå¤´å¹¶è¿›è¡Œè§†é¢‘æ•æ‰å’Œå¤„ç†\tdpcba_adb_test\tè¿™æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•è®¾å¤‡ PCBAï¼ˆPrinted Circuit Board Assemblyï¼‰çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·æµ‹è¯•è®¾å¤‡ç¡¬ä»¶å’Œè¿æ¥æ€§\tcamera_factory_test_server\tè¿™æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•è®¾å¤‡æ‘„åƒå¤´çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·æµ‹è¯•è®¾å¤‡æ‘„åƒå¤´çš„æ€§èƒ½å’Œè´¨é‡\tdthunderboot\tè¿™æ˜¯ä¸€ä¸ªç”¨äºå¯åŠ¨æ§åˆ¶å’Œå›ºä»¶æ›´æ–°çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·ç®¡ç†è®¾å¤‡çš„å¯åŠ¨è¿‡ç¨‹å’Œå›ºä»¶æ›´æ–°\tstartup_app_ipc\tè¿™æ˜¯ä¸€ä¸ªç”¨äºè¿›ç¨‹é—´é€šä¿¡çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å®ç°è¿›ç¨‹é—´é€šä¿¡å’Œæ•°æ®ä¼ è¾“\trkaiq_tool_server\tè¿™æ˜¯ä¸€ä¸ªç”¨äºè°ƒè¯•å’Œä¼˜åŒ– ISPï¼ˆImage Signal Processorï¼‰çš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜è°ƒè¯•å’Œä¼˜åŒ–è®¾å¤‡çš„å›¾åƒå¤„ç†åŠŸèƒ½\tdrkiio\tè¿™æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†è®¾å¤‡è¾“å…¥è¾“å‡ºçš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·ç®¡ç†è®¾å¤‡çš„è¾“å…¥è¾“å‡º\tlvgl\tè¿™æ˜¯ä¸€ä¸ªç”¨äºå¼€å‘ GUI åº”ç”¨ç¨‹åºçš„åº“ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ„å»ºå’Œä¼˜åŒ– GUI åº”ç”¨ç¨‹åº\tcvr_app\tè¿™æ˜¯ä¸€ä¸ªç”¨äºRockchipèŠ¯ç‰‡çš„è§†é¢‘å½•åˆ¶åº”ç”¨ç¨‹åºï¼Œå¯ä»¥åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸Šè¿è¡Œã€‚å®ƒæ”¯æŒå¤šç§è§†é¢‘æ ¼å¼ï¼ŒåŒ…æ‹¬H.264å’ŒH.265ã€‚è¯¥åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œä»¥æ»¡è¶³ä¸åŒçš„å½•åˆ¶éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è®¾ç½®å½•åˆ¶åˆ†è¾¨ç‡ã€å¸§ç‡ã€ç ç‡ç­‰å‚æ•°\tdrkipc\tè¿™æ˜¯ä¸€ä¸ªç”¨äºRockchipèŠ¯ç‰‡çš„IPCï¼ˆInter-Process Communicationï¼‰åº“ï¼Œç”¨äºåœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­å®ç°è¿›ç¨‹é—´é€šä¿¡ã€‚å®ƒæä¾›äº†å¤šç§IPCæœºåˆ¶ï¼ŒåŒ…æ‹¬å…±äº«å†…å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·é‡ç­‰ã€‚è¯¥åº“å¯ä»¥ç”¨äºä¸åŒçš„åº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œä¾‹å¦‚éŸ³è§†é¢‘é‡‡é›†ã€ç¼–ç ã€è§£ç ç­‰\trkfsmk\tè¿™æ˜¯ä¸€ä¸ªç”¨äºRockchipèŠ¯ç‰‡çš„æ–‡ä»¶ç³»ç»Ÿåˆ¶ä½œå·¥å…·ï¼Œç”¨äºåˆ¶ä½œåµŒå…¥å¼ç³»ç»Ÿä¸­çš„æ–‡ä»¶ç³»ç»Ÿã€‚å®ƒæ”¯æŒå¤šç§æ–‡ä»¶ç³»ç»Ÿæ ¼å¼ï¼ŒåŒ…æ‹¬ext2ã€ext3ã€ext4ç­‰ã€‚è¯¥å·¥å…·å¯ä»¥æ ¹æ®é…ç½®æ–‡ä»¶ç”Ÿæˆæ–‡ä»¶ç³»ç»Ÿé•œåƒï¼Œä»¥ä¾¿åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ä½¿ç”¨","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿","ç³»ç»Ÿç§»æ¤"]},{"title":"å¤šæ ¸å¤„ç†å™¨çš„è´Ÿè½½å‡è¡¡","path":"/2024/07/25/1-å¹³å°ç³»ç»Ÿ-Linux-å†…æ ¸-å¤šæ ¸å¤„ç†å™¨çš„è´Ÿè½½å‡è¡¡/","content":"ç°é˜¶æ®µå¤šæ ¸å¤„ç†å™¨çš„åº”ç”¨èŒƒå›´è¶Šæ¥è¶Šå¹¿æ³›ï¼Œåœ¨é€šå¸¸æƒ…å†µä¸‹åº”ç”¨ç¨‹åºçš„è°ƒåº¦éƒ½æ˜¯äº¤ç”±æ“ä½œç³»ç»Ÿè¿›è¡Œç®¡ç†ï¼Œæ“ä½œç³»ç»Ÿå¯¹åº”ç”¨ç¨‹åºè¿›è¡Œè°ƒåº¦ï¼Œä½¿å…¶åœ¨ä¸åŒçš„æ ¸ä¸Šè½®ç•ªè¿è¡Œã€‚ å¤šæ ¸æ“ä½œç³»ç»Ÿçš„å…³æ³¨ç‚¹åœ¨äºè¿›ç¨‹çš„åˆ†é…å’Œè°ƒåº¦ã€‚è¿›ç¨‹çš„åˆ†é…å°†è¿›ç¨‹åˆ†é…åˆ°åˆç†çš„ç‰©ç†æ ¸ä¸Šï¼Œå› ä¸ºä¸åŒçš„æ ¸åœ¨å…±äº«æ€§å’Œå†å²è¿è¡Œæƒ…å†µéƒ½æ˜¯ä¸åŒçš„ã€‚æœ‰çš„ç‰©ç†æ ¸èƒ½å¤Ÿå…±äº«äºŒçº§ cacheï¼Œè€Œæœ‰çš„å´æ˜¯ç‹¬ç«‹çš„ã€‚å¦‚æœå°†æœ‰æ•°æ®å…±äº«çš„è¿›ç¨‹åˆ†é…ç»™æœ‰å…±äº«äºŒçº§ cache çš„æ ¸ä¸Šï¼Œå°†å¤§å¤§æå‡æ€§èƒ½ï¼›åä¹‹ï¼Œå°±æœ‰å¯èƒ½å½±å“æ€§èƒ½ã€‚ åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿçš„é»˜è®¤è°ƒåº¦æœºåˆ¶å¯ä»¥åº”ä»˜å¤§éƒ¨åˆ†çš„æƒ…å†µï¼Œä½†æ˜¯é’ˆå¯¹äºéœ€è¦é«˜è¿è¡Œæ•ˆç‡çš„è¿›ç¨‹æ¥è¯´ï¼Œå°±æœ‰å¿…è¦è€ƒè™‘å°†å…¶å›ºå®šåœ¨ä¸€ä¸ªæ ¸ä¸Šè¿è¡Œï¼Œé¿å…åœ¨ä¸åŒçš„æ ¸ä¸Šè°ƒåº¦é€ æˆçš„é¢å¤–å¼€é”€ã€‚ å¯¹äºç»‘å®šçš„è¿›ç¨‹æ¥è¯´ï¼Œè¯¥è¿›ç¨‹å°†ä¼šä¸€ç›´åœ¨æŒ‡å®šçš„æ ¸ä¸Šè¿è¡Œï¼Œä¸ä¼šåœ¨è¢«è°ƒåº¦åˆ°å…¶ä»–çš„æ ¸ä¸Šï¼Œä½†æ˜¯è¢«ç»‘å®šçš„æ ¸ä¸Šä»ç„¶æœ‰å¯èƒ½è¿è¡Œå…¶ä»–è¿›ç¨‹ã€‚ åœ¨å¤šæ ¸å¤„ç†å™¨çš„ Linux ç³»ç»Ÿä¸­,å¯ä»¥é€šè¿‡å‡ ç§æ–¹æ³•å®ç°åº”ç”¨ç¨‹åºçº¿ç¨‹åœ¨æŒ‡å®š CPU æ ¸ä¸Šè¿è¡Œ,ä»è€Œæé«˜æ€§èƒ½å¹¶å‡å°‘ä¸åŒæ ¸å¿ƒé—´åˆ‡æ¢çš„å¼€é”€. éœ€è¦æ³¨æ„çš„æ˜¯,æ‰‹åŠ¨ç»‘æ ¸åº”è°¨æ…ä½¿ç”¨,å› ä¸ºå®ƒå¯èƒ½ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“è´Ÿè½½å‡è¡¡. åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹,æ“ä½œç³»ç»Ÿçš„é»˜è®¤è°ƒåº¦ç­–ç•¥å·²ç»èƒ½å¤Ÿå¾ˆå¥½åœ°ç®¡ç†çº¿ç¨‹åˆ†é…. æŸ¥çœ‹ cpu æœ‰å‡ ä¸ªæ ¸cat /proc/cpuinfo ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ sysconf è·å– cpu æ ¸å¿ƒæ•°ï¼š #include unistd.hint sysconf(_SC_NPROCESSORS_CONF);/* è¿”å›ç³»ç»Ÿå¯ä»¥ä½¿ç”¨çš„æ ¸æ•°ï¼Œä½†æ˜¯å…¶å€¼ä¼šåŒ…æ‹¬ç³»ç»Ÿä¸­ç¦ç”¨çš„æ ¸çš„æ•°ç›®ï¼Œå›  æ­¤è¯¥å€¼å¹¶ä¸ä»£è¡¨å½“å‰ç³»ç»Ÿä¸­å¯ç”¨çš„æ ¸æ•° */int sysconf(_SC_NPROCESSORS_ONLN);/* è¿”å›å€¼çœŸæ­£çš„ä»£è¡¨äº†ç³»ç»Ÿå½“å‰å¯ç”¨çš„æ ¸æ•° *//* ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°ä¸ä¸Šè¿°ç±»ä¼¼ */#include sys/sysinfo.hint get_nprocs_conf (void);/* å¯ç”¨æ ¸æ•° */int get_nprocs (void);/* çœŸæ­£çš„åæ˜ äº†å½“å‰å¯ç”¨æ ¸æ•° */ taskset å‘½ä»¤taskset å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­å°†è¿›ç¨‹æˆ–çº¿ç¨‹ç»‘å®šåˆ°ç‰¹å®šçš„ CPU æ ¸å¿ƒ. æŸ¥çœ‹è¿›ç¨‹ç»‘å®šæƒ…å†µ taskset -p [pid] ç»‘å®šè¿›ç¨‹åˆ°æŒ‡å®š CPU æ ¸ï¼ˆcpuid çš„æ ‡å·æ˜¯ä» 0 å¼€å§‹çš„ï¼‰ taskset -cp [cpuid] [pid] ä¾‹å¦‚:ï¼ˆå°†è¿›ç¨‹ 9865 ç»‘å®šåˆ° 1,2,5-11 å·æ ¸ï¼‰ taskset -cp 1,2,5-11 9865 åœ¨å¯åŠ¨æ—¶ç»‘å®šå¯ä»¥åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨ taskset å‘½ä»¤ç›´æ¥ç»‘å®š: taskset -c 0,1 ./your_program sched_setaffinity ç³»ç»Ÿè°ƒç”¨åœ¨ç¨‹åºä»£ç ä¸­å¯ä»¥ä½¿ç”¨ sched_setaffinity å‡½æ•°æ¥è®¾ç½®çº¿ç¨‹çš„ CPU äº²å’Œæ€§: #define _GNU_SOURCE#include sched.h/* è®¾ç½®è¿›ç¨‹å·ä¸ºpidçš„è¿›ç¨‹è¿è¡Œåœ¨maskæ‰€è®¾å®šçš„CPUä¸Š * ç¬¬äºŒä¸ªå‚æ•°cpusetsizeæ˜¯maskæ‰€æŒ‡å®šçš„æ•°çš„é•¿åº¦ * é€šå¸¸è®¾å®šä¸ºsizeof(cpu_set_t) * å¦‚æœpidçš„å€¼ä¸º0,åˆ™è¡¨ç¤ºæŒ‡å®šçš„æ˜¯å½“å‰è¿›ç¨‹ */int sched_setaffinity(pid_t pid, size_t cpusetsize, cpu_set_t *mask);/* è·å¾—pidæ‰€æŒ‡ç¤ºçš„è¿›ç¨‹çš„CPUä½æ©ç ,å¹¶å°†è¯¥æ©ç è¿”å›åˆ°maskæ‰€æŒ‡å‘çš„ç»“æ„ä¸­ */int sched_getaffinity(pid_t pid, size_t cpusetsize, cpu_set_t *mask);cpu_set_t mask;CPU_ZERO(mask);CPU_SET(0, mask); // è®¾ç½®äº²å’Œæ€§ä¸º CPU 0sched_setaffinity(0, sizeof(mask), mask); æµ‹è¯•ä»£ç #includestdlib.h#includestdio.h#includesys/types.h#includesys/sysinfo.h#includeunistd.h#define __USE_GNU#includesched.h#includectype.h#includestring.h#includepthread.h#define THREAD_MAX_NUM 200 //1ä¸ªCPUå†…çš„æœ€å¤šè¿›ç¨‹æ•°int num=0; //cpuä¸­æ ¸æ•°void* threadFun(void* arg) //arg ä¼ é€’çº¿ç¨‹æ ‡å·ï¼ˆè‡ªå·±å®šä¹‰ï¼‰ cpu_set_t mask; //CPUæ ¸çš„é›†åˆ cpu_set_t get; //è·å–åœ¨é›†åˆä¸­çš„CPU int *a = (int *)arg; int i; printf(the thread is:%d ,*a); //æ˜¾ç¤ºæ˜¯ç¬¬å‡ ä¸ªçº¿ç¨‹ CPU_ZERO(mask); //ç½®ç©º CPU_SET(*a,mask); //è®¾ç½®äº²å’ŒåŠ›å€¼ if (sched_setaffinity(0, sizeof(mask), mask) == -1)//è®¾ç½®çº¿ç¨‹CPUäº²å’ŒåŠ› printf(warning: could not set CPU affinity, continuing... ); CPU_ZERO(get); if (sched_getaffinity(0, sizeof(get), get) == -1)//è·å–çº¿ç¨‹CPUäº²å’ŒåŠ› printf(warning: cound not get thread affinity, continuing... ); for (i = 0; i num; i++) if (CPU_ISSET(i, get))//åˆ¤æ–­çº¿ç¨‹ä¸å“ªä¸ªCPUæœ‰äº²å’ŒåŠ› printf(this thread %d is running processor : %d , i,i); return NULL;int main(int argc, char* argv[]) int tid[THREAD_MAX_NUM]; int i; pthread_t thread[THREAD_MAX_NUM]; num = sysconf(_SC_NPROCESSORS_CONF); //è·å–æ ¸æ•° if (num THREAD_MAX_NUM) printf(num of cores[%d] is bigger than THREAD_MAX_NUM[%d]! , num, THREAD_MAX_NUM); return -1; printf(system has %i processor(s). , num); for(i=0;inum;i++) tid[i] = i; //æ¯ä¸ªçº¿ç¨‹å¿…é¡»æœ‰ä¸ªtid[i] pthread_create(thread[i],NULL,threadFun,(void*)tid[i]); for(i=0; i num; i++) pthread_join(thread[i],NULL);//ç­‰å¾…æ‰€æœ‰çš„çº¿ç¨‹ç»“æŸï¼Œçº¿ç¨‹ä¸ºæ­»å¾ªç¯æ‰€ä»¥CTRL+Cç»“æŸ return 0; pthread_setaffinity_np å‡½æ•°å¯¹äº POSIX çº¿ç¨‹,å¯ä»¥ä½¿ç”¨ pthread_setaffinity_np å‡½æ•°æ¥è®¾ç½®çº¿ç¨‹äº²å’Œæ€§: #define _GNU_SOURCE#include pthread.hint pthread_setaffinity_np(pthread_t thread, size_t cpusetsize, const cpu_set_t *cpuset);int pthread_getaffinity_np(pthread_t thread, size_t cpusetsize, cpu_set_t *cpuset);cpu_set_t cpuset;CPU_ZERO(cpuset);CPU_SET(2, cpuset);pthread_setaffinity_np(pthread_self(), sizeof(cpu_set_t), cpuset); æµ‹è¯•ä»£ç #include pthread.h#include stdio.h#include stdlib.h#include unistd.h#include sched.h#include sys/types.h#include sys/syscall.hpid_t gettid(void) return syscall(SYS_gettid);/** * @brief print_running_cpu * pthread_setaffinity_npå‡½æ•°ç”¨äºè®¾ç½®çº¿ç¨‹çš„CPUäº²å’Œåº¦ã€‚ * CPU_SETå’ŒCPU_ZEROç”¨äºè®¾ç½®å’Œæ¸…é™¤CPUæ©ç ã€‚ * print_running_cpuå‡½æ•°é€šè¿‡ç³»ç»Ÿå‘½ä»¤æŸ¥è¯¢çº¿ç¨‹å½“å‰è¿è¡Œçš„CPUæ ¸ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚ */void print_running_cpu() char qry_cmd[1024] = 0 ; sprintf(qry_cmd, ps -o pid,spid,psr -T -p %d | grep %d | tail -n 1 | awk print $3, getpid(), gettid()); FILE *fp = popen(qry_cmd, r); if(fp == NULL) return; char cpu_id_str[200] = 0 ; fgets(cpu_id_str, 80, fp); fclose(fp); printf([%d] : current thread(%d@%d) is running on cpu(%d) , gettid(), gettid(), getpid(), atoi(cpu_id_str));void bind_thread_to_cpu(int cpu_id) cpu_set_t cpu_mask; CPU_ZERO(cpu_mask); CPU_SET(cpu_id, cpu_mask); pthread_setaffinity_np(pthread_self(), sizeof(cpu_mask), cpu_mask);void* thread_func(void* p_arg) int bind_cpu_id = *(int *)p_arg; printf([%d] : setting cpu affinity for thread(%d@%d) to cpu(%d) , gettid(), gettid(), getpid(), bind_cpu_id); bind_thread_to_cpu(bind_cpu_id); print_running_cpu(); while(1) // æ¨¡æ‹Ÿå·¥ä½œè´Ÿè½½ long loop = 4000000000; while(loop--) sleep(0); print_running_cpu(); return NULL;int main(int argc, char *argv[]) int cpu_id_1 = 1; int cpu_id_2 = 2; pthread_t thr_id_1, thr_id_2; // åˆ›å»ºå¹¶ç»‘å®šçº¿ç¨‹1åˆ°CPU 1 pthread_create(thr_id_1, NULL, thread_func, cpu_id_1); sleep(1); // ç¡®ä¿çº¿ç¨‹1å·²ç»ç»‘å®š // åˆ›å»ºå¹¶ç»‘å®šçº¿ç¨‹2åˆ°CPU 2 pthread_create(thr_id_2, NULL, thread_func, cpu_id_2); // ç­‰å¾…çº¿ç¨‹ç»“æŸ pthread_join(thr_id_1, NULL); pthread_join(thr_id_2, NULL);","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","å†…æ ¸"]},{"title":"ARMå’ŒX86","path":"/2024/07/24/1-å¹³å°ç³»ç»Ÿ-å¹³å°ç›¸å…³-ARMå’ŒX86/","content":"ARM æ˜¯åŸºäº RISC çš„äº§å“ï¼Œè€Œ PC çš„ä»£è¨€äººæ˜¯ x86ï¼ŒåŸºäº CISCã€‚ARMã€x86 ä¹‹äº‰ï¼Œå…¶å®å°±æ˜¯ RISC å’Œ CISC ä¹‹äº‰ã€‚ RISC å’Œ CISCè®¡ç®—æœºç§‘å­¦ä¸­ä¸¤ç§ä¸»è¦ç†å¿µä¹‹é—´çš„åˆ†æ­§ï¼šç®€åŒ–ç¨‹åºå‘˜çš„å·¥ä½œç®€åŒ–å¾®å¤„ç†å™¨çš„å·¥ä½œã€‚ è¦æƒ³ä½¿ç”¨è®¡ç®—æœºæ‰§è¡Œä»»ä½•é«˜æ•ˆçš„æ“ä½œï¼Œæ“ä½œç³»ç»ŸåŠå…¶æ‰§è¡Œçš„ç¨‹åºéœ€è¦ä¸ä¸­å¤®å¤„ç†å™¨ï¼ˆCPUï¼‰ä»¥åŠå…¶ä»–ç¡¬ä»¶ï¼ˆå¦‚å†…å­˜ã€å­˜å‚¨å™¨å’Œç½‘å¡ï¼‰è¿›è¡Œäº¤äº’ã€‚CPU å‘æŒ¥ç€åœ¨æ“ä½œç³»ç»Ÿï¼ˆå’Œä¸Šé¢è¿è¡Œçš„ç¨‹åºï¼‰ä¸è¿™äº›ç¡¬ä»¶ä¹‹é—´è¿›è¡Œè°ƒè§£çš„ä½œç”¨ã€‚ä¸ºäº†ç®€åŒ–ç¨‹åºå‘˜çš„å·¥ä½œï¼ŒCPU æœ‰ä¸€ç»„é¢„å®šä¹‰çš„æ“ä½œå’Œè®¡ç®—ï¼Œç§°ä¸ºæŒ‡ä»¤é›†æˆ– ISAï¼ˆæŒ‡ä»¤é›†æ¶æ„ï¼‰ã€‚æ“ä½œç³»ç»ŸåŠå…¶æ‰§è¡Œçš„ç¨‹åºï¼ˆå‡ç”±ç¨‹åºå‘˜ç¼–å†™ï¼‰ä¾èµ–è¿™äº›æŒ‡ä»¤æ¥æ‰§è¡Œä½å±‚åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š CPU ä¸ç¡¬ä»¶ï¼ˆå†…å­˜ã€å­˜å‚¨å™¨ã€ç½‘ç»œç­‰ï¼‰ä¹‹é—´çš„äº¤äº’ ç®—æœ¯å‡½æ•°ï¼ˆåŠ æ³•ã€å‡æ³•ç­‰ï¼‰ æ•°æ®æ“ä½œï¼ˆäºŒè¿›åˆ¶ç§»ä½ç­‰ï¼‰ã€‚ CISCæœ€åˆçš„ x86 CPU æ‹¥æœ‰ï¼ˆå¹¶ä¸”ç°åœ¨ä»ç„¶æ‹¥æœ‰ï¼‰éå¸¸ä¸°å¯Œçš„æŒ‡ä»¤é›†ã€‚ä¸€æ¡æŒ‡ä»¤å¯ä»¥å®Œæˆæ•´ä¸ªè®¡ç®—ï¼ˆå¦‚ä¹˜æ³•ï¼‰æˆ–å°†ä¸€å—æ•°æ®ç›´æ¥ä»å†…å­˜ä¸­çš„ä¸€ä¸ªä½ç½®ç§»åŠ¨åˆ°å¦ä¸€ä¸ªä½ç½®ã€‚è¿™å¬èµ·æ¥æ²¡ä»€ä¹ˆå¤§ä¸äº†ï¼Œä½†åœ¨å†…å­˜ä¸­çš„ä¸åŒä½ç½®ä¹‹é—´è¿›è¡Œä¹˜æ³•è®¡ç®—å’Œç§»åŠ¨æ•°æ®ç¡®å®éœ€è¦åœ¨ä½å±‚æ‰§è¡Œå¤§é‡æŒ‡ä»¤ã€‚å¯¹äº x86 è®¡ç®—æœºï¼Œè¿™ä¸€ç³»åˆ—å¤æ‚çš„æ“ä½œå¯ä»¥åœ¨ä¸€ä¸ªå‘¨æœŸå†…å®Œæˆã€‚å…·æœ‰è¿™ç§ç±»å‹æŒ‡ä»¤é›†çš„å¤„ç†å•å…ƒè¢«ç§°ä¸ºå¤æ‚æŒ‡ä»¤é›†è®¡ç®—æœºï¼ˆCISCï¼ŒComplex Instruction Set Computerï¼‰ã€‚ ç„¶è€Œï¼ŒCISC è®¡ç®—æœºä¸­çš„æŒ‡ä»¤å¦‚æ­¤å¼ºå¤§ï¼Œä¹Ÿæ„å‘³ç€å®ƒéœ€è¦æ›´å¤šçš„æ™¶ä½“ç®¡ï¼Œä»è€Œä¼šå ç”¨ç©ºé—´å¹¶æ¶ˆè€—èƒ½é‡ã€‚ RISCç²¾ç®€æŒ‡ä»¤é›†è®¡ç®—æœºï¼ŒReduced Instruction Set Computer åœ¨ç°å®ä¸­ï¼Œå¤§å¤šæ•°è®¡ç®—æœºä»…ä½¿ç”¨ CISC è®¡ç®—æœºæ‰€æä¾›çš„å¤§é‡æŒ‡ä»¤ä¸­çš„ä¸€å°éƒ¨åˆ†ã€‚æœ€ç»ˆï¼Œç²¾ç®€æŒ‡ä»¤é›†è®¡ç®—æœºï¼ˆRISCï¼‰å¤„ç†å™¨è®¾è®¡åº”è¿è€Œç”Ÿã€‚RISC å¤„ç†å™¨ä¹Ÿæœ‰ä¸€ä¸ªæŒ‡ä»¤é›†ï¼Œä½†å…¶ä¸­æ¯æ¡æŒ‡ä»¤ä»…ä»£è¡¨ä¸€ä¸ªèƒ½è€—è¾ƒä½çš„ç®€å•æ“ä½œã€‚è¿™å°±ä½¿æ±‡ç¼–è¯­è¨€ç¨‹åºå‘˜çš„å·¥ä½œå˜å¾—æ›´åŠ å¤æ‚ï¼Œä½†å´ç®€åŒ–äº†å¤„ç†å™¨çš„å·¥ä½œã€‚åˆ©ç”¨ RISC å¤„ç†å™¨å’Œå…ˆè¿›çš„ RISC è®¡ç®—æœºï¼Œå¯ä»¥é€šè¿‡è¿è¡Œå¤šæ¡æŒ‡ä»¤æˆ–é€šè¿‡å°†å¤æ‚å·¥ä½œæ¨ç»™ç¼–è¯‘å™¨ï¼ˆè€Œä¸æ˜¯ CPU å†…æ ¸ï¼‰æ¥æ‰§è¡Œå¤æ‚æ“ä½œã€‚ å…¶ä¸­ç¦»ä¸å¼€ä¸€äº›æƒè¡¡ä¸å–èˆã€‚x86 CPU å¾€å¾€å…·æœ‰éå¸¸å¿«çš„è®¡ç®—èƒ½åŠ›ï¼Œå¹¶ä¸”åœ¨ç¼–ç¨‹å’ŒæŒ‡ä»¤æ•°é‡æ–¹é¢ä¼šæ›´åŠ æ¸…æ™°æˆ–ç®€å•ï¼Œä½†å®ƒçš„ä»£ä»·ï¼Œå°±æ˜¯æ›´å¤§ã€æ›´æ˜‚è´µä¸”å…·æœ‰å¤§é‡æ™¶ä½“ç®¡çš„èŠ¯ç‰‡ã€‚ARM å¤„ç†å™¨å¯¹äºæŸäº›ç±»å‹çš„æ“ä½œè€Œè¨€å¯èƒ½éå¸¸å¿«ï¼Œä½†å•ä¸ªæŒ‡ä»¤çš„é‡å¤å¾ªç¯å¯èƒ½ä¼šå‡æ…¢å®ƒçš„é€Ÿåº¦ï¼Œè¿™æ˜¯å› ä¸ºæ“ä½œæ›´ä¸ºå¤æ‚ï¼Œå¹¶ä¸”å®šä¹‰å’Œæ‰§è¡Œæ“ä½œçš„æ›´å¤šå·¥ä½œè¢«æ¨ç»™äº†ç¼–ç¨‹ï¼ˆå’Œç¨‹åºå‘˜ï¼‰ï¼Œè€Œä¸æ˜¯æŒ‡ä»¤é›†ã€‚ æ­¤å¤–ï¼Œé‰´äºä»¥ä¸Šå·®å¼‚ï¼Œä»¬å¯èƒ½éš¾ä»¥è®¡ç®—å…¶ MIPSï¼ˆæ¯ç§’ç™¾ä¸‡æ¡æŒ‡ä»¤ï¼Œä¸€ç§å¯¹è®¡ç®—æœºåŸå§‹å¤„ç†èƒ½åŠ›çš„å¸¸ç”¨åº¦é‡ï¼‰ï¼Œå› ä¸ºä¸åŒç±»å‹çš„å¤„ç†å™¨åœ¨æ‰§è¡ŒåŒä¸€æ´»åŠ¨æ—¶éœ€è¦ç”¨åˆ°ä¸åŒçš„æŒ‡ä»¤é›†ã€‚ ARM ä¸ x86 çš„èƒ½è€—RISC æ¶æ„æºè‡ªä¸ºå°å‹è®¡ç®—æœºæˆ–å¾®å‹è®¡ç®—æœºï¼ˆæœ€ç»ˆæˆä¸º PCï¼‰åˆ¶é€ æ€§èƒ½æ›´å¥½ã€å¤–å½¢æ›´å°çš„èŠ¯ç‰‡çš„éœ€æ±‚ã€‚äºæ˜¯ï¼Œè¿™å°±å¼•å‡ºäº†ç¬¬äºŒä¸ªåŸºæœ¬è®¾è®¡é—®é¢˜ï¼šç©¶ç«Ÿæ˜¯ä¾§é‡äºèŠ¯ç‰‡æ€§èƒ½ï¼ˆå¤„ç†é€Ÿåº¦æˆ–æ—¶é’Ÿé€Ÿåº¦ï¼‰è¿˜æ˜¯èƒ½æºæ¶ˆè€—ï¼ˆåŠŸè€—ï¼‰ã€‚ ç”±äº ARM å¤„ç†å™¨é›†æˆåˆ°äº† SoC ä¸Šï¼Œå› æ­¤é•¿æœŸä»¥æ¥å›´ç»•çš„ç„¦ç‚¹å°±æ˜¯æ•´ä½“èµ„æºç®¡ç†ï¼ŒåŒ…æ‹¬ä½èƒ½è€—å’Œæ›´ä½çš„çƒ­é‡ç”Ÿæˆã€‚ä¾‹å¦‚ï¼ŒARM æ¶æ„ï¼ˆå¦‚ ARMv8ï¼‰å¾€å¾€æ²¡æœ‰ç®€å•çš„æ•£çƒ­ç³»ç»Ÿï¼ˆæ‰‹æœºä¸Šæ²¡æœ‰é£æ‰‡ï¼‰ã€‚è€Œå¦ä¸€æ–¹é¢ï¼Œx86 CPU å€¾å‘äºæ”¯æŒé«˜ç«¯å¤„ç†é€Ÿåº¦ï¼Œè€Œä¸æ˜¯ä»¥ä½åŠŸè€—ä¸ºç›®æ ‡ã€‚ è™½ç„¶ä¸¤ç§ CPU è®¾è®¡éƒ½å…·æœ‰é«˜æ€§èƒ½ï¼ˆARM å’Œ x86 é˜µè¥éƒ½æœ‰é€Ÿåº¦åœ¨ä¸–ç•Œä¸Šæ•°ä¸€æ•°äºŒçš„è¶…çº§è®¡ç®—æœºï¼‰ï¼Œä½† ARM è®¾è®¡å¾€å¾€ä¾§é‡äºæ›´å°å·§çš„å¤–å½¢ã€ç”µæ± ä½¿ç”¨æ—¶é—´ã€å°ºå¯¸ã€å…é™¤æ•£çƒ­è¦æ±‚å’Œæˆæœ¬ï¼ˆè¿™ä¹Ÿè®¸æ˜¯æœ€é‡è¦çš„ï¼‰ç­‰æ–¹é¢ã€‚è¿™å°±æ˜¯ ARM å¤„ç†å™¨ä¸»å¯¼æ™ºèƒ½æ‰‹æœºã€å¹³æ¿ç”µè„‘ç”šè‡³æ ‘è“æ´¾ç³»ç»Ÿç­‰å°å‹ç”µå­äº§å“å’Œç§»åŠ¨è®¾å¤‡çš„åŸå› ã€‚è€Œ x86 æ¶æ„åœ¨æœåŠ¡å™¨ã€PC ç”šè‡³ç¬”è®°æœ¬ç”µè„‘ä¸­æ›´ä¸ºå¸¸è§ï¼Œå› ä¸ºè¿™äº›é¢†åŸŸéœ€è¦å®æ—¶çš„é€Ÿåº¦å’Œçµæ´»æ€§ï¼Œå¹¶ä¸”å¯¹æ•£çƒ­å’Œå°ºå¯¸çš„é™åˆ¶è¾ƒå°‘ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","å¹³å°ç›¸å…³"]},{"title":"CISCå’ŒRISC","path":"/2024/07/23/1-å¹³å°ç³»ç»Ÿ-å¹³å°ç›¸å…³-CISCå’ŒRISC/","content":"CISC ä¸ RISC çš„åŒºåˆ«CISCï¼ˆå¤æ‚æŒ‡ä»¤é›†ï¼‰å¤æ‚æŒ‡ä»¤é›†ï¼ˆCISCï¼‰CPU è®¾è®¡äº†ä¸€ç³»åˆ—ä¸°å¯Œçš„æ±‡ç¼–æŒ‡ä»¤ï¼Œä»¥ä¾¿ç”¨è¾ƒå°‘çš„æŒ‡ä»¤å®Œæˆå¤æ‚çš„æ“ä½œã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒCISC å¯ä»¥é€šè¿‡ä¸€æ¡æŒ‡ä»¤åŒæ—¶æ‰§è¡Œä¹˜æ³•ã€åŠ æ³•åŠå…¶ä»–è¿ç®—ï¼Œè¿™æ ·åœ¨å¤„ç†æ•°æ®æ—¶ï¼ŒCPU åªéœ€ä¸€ä¸ªæœºå™¨å‘¨æœŸå°±èƒ½å®Œæˆè¿ç®—ã€‚è¿™æ ·ï¼Œè¿™ç§è®¾è®¡åœ¨æŸäº›åº”ç”¨ä¸Šå±•ç¤ºå‡ºå¼ºå¤§çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦æ‰§è¡Œå¤æ‚è®¡ç®—çš„ä»»åŠ¡æ—¶ã€‚ ç„¶è€Œï¼ŒCISC çš„ç¡¬ä»¶è®¾è®¡è¾ƒä¸ºå¤æ‚ï¼Œè¿™å¯¼è‡´å…¶å†…éƒ¨ç»“æ„éœ€è¦è¾ƒå¤šçš„ç»„ä»¶ï¼Œä»¥åŠç›¸åº”çš„å¤„ç†æ—¶é—´å’Œèƒ½è€—ã€‚å°½ç®¡å¦‚æ­¤ï¼Œç›®å‰ç»å¤§å¤šæ•°ä¸ªäººè®¡ç®—æœºï¼ˆPCï¼‰ä½¿ç”¨çš„å¤„ç†å™¨ä»æ˜¯ CISC ç»“æ„ï¼Œä¾‹å¦‚ Intel å’Œ AMD çš„ä¸»æµå¤„ç†å™¨ã€‚æ­¤å¤–ï¼Œè®¸å¤šåµŒå…¥å¼ç³»ç»Ÿï¼Œæ¯”å¦‚ 51 å•ç‰‡æœºï¼Œä¹Ÿé‡‡ç”¨ CISC æ¶æ„ï¼Œç¡®ä¿èƒ½å¤Ÿå¤„ç†å¤šç§å¤æ‚ä»»åŠ¡ã€‚ RISCï¼ˆç²¾ç®€æŒ‡ä»¤é›†ï¼‰ç›¸æ¯”ä¹‹ä¸‹ï¼Œç²¾ç®€æŒ‡ä»¤é›†ï¼ˆRISCï¼‰é‡‡ç”¨äº†æ›´ç®€åŒ–çš„è®¾è®¡ï¼Œå…¶æ±‡ç¼–æŒ‡ä»¤æ•°é‡å¤§å¹…å‡å°‘ï¼Œä»è€Œç®€åŒ–äº† CPU çš„è®¾è®¡ã€‚é€šè¿‡ RISCï¼Œå½“éœ€è¦å®Œæˆè¿ç®—ï¼ˆä¾‹å¦‚ï¼šè®¡ç®—ï¼ˆ1+1ï¼‰Ã—ï¼ˆ2-1ï¼‰ï¼‰æ—¶ï¼Œéœ€åˆ†å¤šä¸ªæ­¥éª¤è¿›è¡Œï¼šé¦–å…ˆè®¡ç®— 1+1 å¾—åˆ° 2ï¼Œå†è®¡ç®— 2-1 å¾—åˆ° 1ï¼Œæœ€åè¿›è¡Œ 2Ã—1 çš„ä¹˜æ³•ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦ç»å†å¤šä¸ªæœºå™¨å‘¨æœŸã€‚å› æ­¤ï¼Œæ•´ä½“è¿ç®—æ•ˆç‡ç›¸è¾ƒäº CISC æ˜¾å¾—æ›´ä½ã€‚ éšç€æŠ€æœ¯çš„è¿›æ­¥ï¼ŒCPU çš„ä¸»é¢‘åœ¨ææ–™æŠ€æœ¯çº¦æŸä¸‹éš¾ä»¥æé«˜ï¼Œå› æ­¤ RISC çš„å•æ ¸ CPU åœ¨æ•ˆç‡ä¸Šå¾€å¾€ä¸åŠ CISCã€‚ä¸ºäº†å¼¥è¡¥è¿™ä¸€ä¸è¶³ï¼Œç°ä»£æ‰‹æœºå’Œå…¶ä»–ç§»åŠ¨è®¾å¤‡é€šå¸¸é€šè¿‡å¢åŠ æ ¸å¿ƒæ•°é‡æ¥æå‡å¤„ç†æ•ˆç‡ï¼Œä»è€Œåœ¨å¤šä»»åŠ¡å¹¶è¡Œå¤„ç†ä¸Šè·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚ åœ°å€æ€»çº¿ã€æ•°æ®æ€»çº¿å’Œæ§åˆ¶æ€»çº¿çš„åŒºåˆ«åœ°å€æ€»çº¿ï¼ˆAddress Busï¼‰åœ¨æ•°æ®å¤„ç†è¿‡ç¨‹ä¸­ï¼Œåœ°å€æ€»çº¿è´Ÿè´£å‘é€å†…å­˜åœ°å€ï¼Œå¸®åŠ© CPU æ‰¾åˆ°å¾…å¤„ç†çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“ CPU ç¡®å®šè¦è¯»å–æŸä¸€åœ°å€çš„æ•°æ®æ—¶ï¼Œåœ°å€æ€»çº¿ä¼šå‘èµ·å¯»å€è¯·æ±‚ã€‚åœ°å€æ€»çº¿çš„å®½åº¦ç›´æ¥å†³å®šäº†å¯ä»¥å¯»å€çš„æ•°æ®é‡ã€‚å¦‚æœä¸€æ¡åœ°å€æ€»çº¿å®½åº¦ä¸º 32 ä½ï¼Œå®ƒèƒ½è®¿é—®æœ€å¤§ 4GB çš„åœ°å€ç©ºé—´ã€‚ç„¶è€Œï¼Œåœ°å€æ€»çº¿çš„è®¾è®¡ä¸ºå•å‘ï¼Œå³åªèƒ½ç”± CPU å‘èµ·å¯»å€è¯·æ±‚ï¼Œæ— æ³•è¢«å¤–éƒ¨è®¾å¤‡ä¸»åŠ¨ä½¿ç”¨ï¼Œå› æ­¤å…¶å·¥ä½œæ¨¡å¼ä¸ºé«˜ç”µå¹³ã€ä½ç”µå¹³å’Œé«˜é˜»æ€ã€‚ æ•°æ®æ€»çº¿ï¼ˆData Busï¼‰ä¸€æ—¦åœ°å€ç¡®å®šï¼Œæ•°æ®æ€»çº¿å°±æ‹¿åˆ°è§’è‰²ã€‚å®ƒè´Ÿè´£å°†è¯»å–æˆ–å†™å…¥æ“ä½œçš„æ•°æ®ä¼ è¾“åˆ° CPUã€‚ä¾‹å¦‚ï¼ŒCPU éœ€è¦å°†æŸåœ°å€çš„æ•°æ®è¯»å…¥å†…å­˜æˆ–å­˜å‚¨åˆ°å¤–éƒ¨è®¾å¤‡ä¸­ï¼Œè¿™æ—¶æ•°æ®æ€»çº¿é€šè¿‡è½¬å‘ä¿¡å·æ¥å®ç°æ•°æ®çš„è¯»å†™ã€‚æ•°æ®æ€»çº¿æ˜¯åŒå‘çš„ï¼Œå¯ä»¥åœ¨è¯»å–æ•°æ®æ—¶å‘é€ä¿¡å·ï¼Œä¹Ÿå¯ä»¥åœ¨å†™å…¥æ•°æ®æ—¶æ¥æ”¶ä¿¡å·ï¼Œä¼ è¾“çš„å®½åº¦å³ä¸ºå•æ¬¡å¯ä»¥ä¼ è¾“çš„æ•°æ®é‡ã€‚ æ§åˆ¶æ€»çº¿ï¼ˆControl Busï¼‰æ§åˆ¶æ€»çº¿æ‰¿æ‹…æŒ‡æŒ¥æ‰€æœ‰æ“ä½œçš„è´£ä»»ï¼Œåœ¨ CPU ä¸å¤–è®¾é—´ä¼ é€’æ§åˆ¶ä¿¡å·ï¼Œæ¯”å¦‚è¯»å†™è¯·æ±‚å’ŒçŠ¶æ€ä¿¡æ¯ã€‚ç”±äºå®ƒéœ€è¦å¯¹æ‰€æœ‰å¤–è®¾è¿›è¡Œæ§åˆ¶ï¼Œå› æ­¤å…¶é€šä¿¡ä¸ºåŒå‘ï¼Œå¹¶ç›¸å¯¹çµæ´»ã€‚æ§åˆ¶æ€»çº¿çš„å®½åº¦é€šå¸¸ä¸å›ºå®šï¼Œè€Œæ˜¯æ ¹æ®è¿æ¥è‡³ç³»ç»Ÿçš„å¤–è®¾æ•°é‡è€Œå¼‚ï¼Œä»è€Œç¡®ä¿æ‰€æœ‰è®¾å¤‡éƒ½èƒ½æ”¶åˆ°æŒ‡ä»¤å¹¶è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚ ç»Ÿä¸€ç¼–å€å’Œç‹¬ç«‹ç¼–å€çš„åŒºåˆ«åœ¨è®¨è®ºç»Ÿä¸€ç¼–å€ä¸ç‹¬ç«‹ç¼–å€ä¹‹å‰ï¼Œäº†è§£å¯»å€è¿‡ç¨‹æ˜¯å¿…è¦çš„ã€‚åœ¨ CPU è¿›è¡Œæ•°æ®å¤„ç†æ—¶ï¼Œæ§åˆ¶æ€»çº¿ä¼šé¦–å…ˆå‘é€æ§åˆ¶ä¿¡å·ï¼Œç„¶åå¯»å€å¤–è®¾ï¼ˆåŒ…æ‹¬ IO è®¾å¤‡å’Œå†…å­˜ï¼‰ã€‚å¯»å€æ–¹å¼ç”± CPU æ‰€å®šä¹‰çš„åœ°å€ç¼–å€æ–¹å¼å†³å®šï¼Œä¸»è¦åˆ†ä¸ºç»Ÿä¸€ç¼–å€å’Œç‹¬ç«‹ç¼–å€ä¸¤ç§ç±»å‹ã€‚ ç»Ÿä¸€ç¼–å€åœ¨ç»Ÿä¸€ç¼–å€ä¸­ï¼ŒCPU é€šè¿‡åœ°å€æ€»çº¿ç›´æ¥å¯»å€ IO è®¾å¤‡ã€‚ç”±äºåœ°å€æ€»çº¿å®½åº¦æ˜¯å›ºå®šçš„ï¼Œè¿™æ„å‘³ç€ç»Ÿä¸€ç¼–å€ä¼šå ç”¨ä¸€å®šçš„åœ°å€ç©ºé—´ï¼Œå¯¼è‡´å¯æ“ä½œå†…å­˜çš„åœ°å€èŒƒå›´ç¼©å°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ª 32 ä½åœ°å€æ€»çº¿å¯ä»¥å¯»å€ 4GB å†…å­˜ï¼Œä½†å›  IO è®¾å¤‡å ç”¨äº†éƒ¨åˆ†åœ°å€ï¼Œå®é™…å¯ç”¨çš„å†…å­˜å°±ä¼šä½äº 4GBï¼Œè¿™æ˜¾å¾—ä¸å¤Ÿé«˜æ•ˆã€‚ ç‹¬ç«‹ç¼–å€ä¸ä¹‹ç›¸æ¯”ï¼Œç‹¬ç«‹ç¼–å€å…è®¸ CPU ä½¿ç”¨ä¸“é—¨çš„æ“ä½œæŒ‡ä»¤æ¥å¤„ç† IO è®¾å¤‡ï¼Œè¿™æ„å‘³ç€åœ°å€æ€»çº¿çš„æ“ä½œä»…ç”¨äºå†…å­˜åœ°å€ã€‚è¿™æ ·çš„è®¾è®¡ç¡®ä¿äº†å†…å­˜åœ°å€çš„æœ€å¤§åŒ–åˆ©ç”¨ï¼Œå› æ­¤ï¼Œç‹¬ç«‹ç¼–å€çš„å†…å­˜å¤§å°ä¸åœ°å€æ€»çº¿çš„å®½åº¦ç›¸ç­‰ï¼Œå¯ä»¥æ›´é«˜æ•ˆåœ°ä½¿ç”¨ç³»ç»Ÿèµ„æºã€‚ å“ˆä½›ç»“æ„å’Œå†¯è¯ºä¾æ›¼ç»“æ„çš„åŒºåˆ«åœ¨ç¨‹åºç¼–å†™ä¸æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œç¨‹åºå¯ä»¥è¢«åˆ†ä¸ºä¸¤ç§ä¸åŒçš„éƒ¨åˆ†ï¼šä¸å†éœ€è¦ä¿®æ”¹çš„é€»è¾‘ä»£ç å’Œéšç€ç¨‹åºè¿è¡Œè€Œä¸æ–­å˜åŒ–çš„å˜é‡å€¼ã€‚å“ˆä½›ç»“æ„ä¸å†¯è¯ºä¾æ›¼ç»“æ„çš„ä¸åŒå°±åœ¨äºè¿™ä¸¤éƒ¨åˆ†ä»£ç çš„å­˜å‚¨æ–¹å¼ã€‚ å“ˆä½›ç»“æ„å“ˆä½›ç»“æ„å°†é€»è¾‘ä»£ç å’Œå˜é‡å€¼åˆ†å¼€å­˜æ”¾ï¼Œè¿™ç§æ–¹å¼ç¡®ä¿ä¸¤ç§æ•°æ®ä¸ä¼šç›¸äº’å¹²æ‰°ã€‚ä¾‹å¦‚ï¼Œ51 å•ç‰‡æœºçš„é€»è¾‘ä»£ç å­˜æ”¾åœ¨åªè¯»å­˜å‚¨å™¨ï¼ˆROMï¼‰ä¸­ï¼Œè€Œå˜é‡åˆ™å­˜å‚¨åœ¨éšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆRAMï¼‰ä¸­ã€‚ARM æ¶æ„è™½ç„¶é€»è¾‘ä»£ç å’Œå˜é‡éƒ½å­˜æ”¾åœ¨ RAM ä¸­ï¼Œä½†å†…éƒ¨å†…å­˜ä»åˆ’åˆ†ä¸ºé€»è¾‘ä»£ç å’Œå˜é‡çš„åŒºåŸŸï¼Œä»è€Œé¿å…äº†è¯»å†™å†²çªã€‚é€šè¿‡å°†ä¸¤è€…åˆ†å¼€ï¼Œå“ˆä½›ç»“æ„èƒ½å¤Ÿæœ‰æ•ˆåœ°é™ä½ç¨‹åºå‡ºç° BUG æ—¶ç”±äºç›¸äº’å¹²æ‰°è€Œå¼•å‘çš„é—®é¢˜ã€‚ å†¯è¯ºä¾æ›¼ç»“æ„å†¯è¯ºä¾æ›¼ç»“æ„åˆ™é‡‡ç”¨ç»Ÿä¸€å­˜å‚¨çš„æ–¹å¼ï¼Œå°†é€»è¾‘ä»£ç å’Œå˜é‡å­˜å‚¨åœ¨åŒä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œé€šå¸¸æŒ‰æ‰§è¡Œé¡ºåºæ’åˆ—ã€‚å½“ç¨‹åºè¿è¡Œæ—¶ï¼Œé€»è¾‘ä»£ç å’Œå˜é‡æ•°æ®æ··åˆå­˜å‚¨ï¼Œè¿™ä¼šå¯¼è‡´ä¸€ä¸ªæ½œåœ¨é—®é¢˜ï¼šå¦‚æœé€»è¾‘ä»£ç çš„è¯»å†™ä¸è¢«é™åˆ¶ï¼Œå½“ç¨‹åºå‡ºç° BUG æ—¶ï¼Œé€»è¾‘ä»£ç ä¹Ÿå¯èƒ½é­åˆ°ä¿®æ”¹ï¼Œå¯èƒ½å¼•å‘ç³»ç»Ÿå´©æºƒæˆ–æ­»æœºã€‚ç„¶è€Œï¼Œå†¯è¯ºä¾æ›¼ç»“æ„çš„ä¸€ä¸ªå¥½å¤„æ˜¯èƒ½é«˜æ•ˆåˆ©ç”¨å†…å­˜ç©ºé—´ï¼Œä½¿å¾— CPU èƒ½å¤Ÿåœ¨ç¨‹åºæ‰§è¡Œæ—¶æ›´ä¸ºæ–¹ä¾¿ï¼Œä¸éœ€è¦åœ¨å¤šä¸ªå­˜å‚¨åŒºåŸŸé—´åˆ‡æ¢ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","å¹³å°ç›¸å…³"]},{"title":"Portainer","path":"/2024/07/19/1-å¹³å°ç³»ç»Ÿ-Docker-Portainer/","content":"Portainer can be used to manage Docker containers through a web interface. CE ç¤¾åŒºç‰ˆæœ¬éƒ¨ç½² é¦–å…ˆï¼Œåˆ›å»º Portainer Server ç”¨äºå­˜å‚¨å…¶æ•°æ®åº“çš„å·ï¼š docker volume create portainer_data version: 3services: portainer: image: portainer/portainer-ce:latest container_name: portainer ports: - 9094:9000 volumes: - portainer_data:/data - /var/run/docker.sock:/var/run/docker.sock restart: unless-stoppedvolumes: portainer_data: ç°åœ¨å®‰è£…å·²å®Œæˆï¼Œè®¿é—®ä»¥ä¸‹ç½‘å€ç™»å½• Portainer Server å®ä¾‹ï¼š https://localhost:9094","categories":["1.å¹³å°ç³»ç»Ÿ","Docker"]},{"title":"å†…æ ¸æ¨¡å—","path":"/2024/07/18/1-å¹³å°ç³»ç»Ÿ-Linux-å†…æ ¸-å†…æ ¸æ¨¡å—/","content":"å†…æ ¸æ¨¡å—æ˜¯ä¸€æ®µå¯ä»¥åŠ¨æ€åŠ è½½åˆ°å†…æ ¸ä¸­çš„ä»£ç ï¼Œè¿™ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ‰©å±•å†…æ ¸çš„åŠŸèƒ½è€Œæ— éœ€é‡å¯ç³»ç»Ÿæˆ–é‡ç¼–è¯‘æ•´ä¸ªå†…æ ¸ã€‚ å†…æ ¸æ¨¡å—çš„ç¼–è¯‘ç¼–å†™å†…æ ¸æ¨¡å—ä»£ç ä¸€ä¸ªç®€å•çš„å†…æ ¸æ¨¡å—é€šå¸¸åŒ…æ‹¬åˆå§‹åŒ–å’Œæ¸…ç†å‡½æ•°ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„â€Hello, Worldâ€å†…æ ¸æ¨¡å—ç¤ºä¾‹ï¼š #include linux/init.h#include linux/module.h#include linux/kernel.hMODULE_LICENSE(GPL);MODULE_AUTHOR(Your Name);MODULE_DESCRIPTION(A Simple Hello World Module);static int __init hello_init(void) printk(KERN_INFO Hello, World! ); return 0; // è¿”å›0è¡¨ç¤ºæˆåŠŸstatic void __exit hello_exit(void) printk(KERN_INFO Goodbye, World! );module_init(hello_init);module_exit(hello_exit); åˆ›å»º Makefileè¦ç¼–è¯‘å†…æ ¸æ¨¡å—ï¼Œéœ€è¦ä¸€ä¸ª Makefileã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ Makefile ç¤ºä¾‹ï¼š obj-m += hello.oall: make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modulesclean: make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean obj-mï¼šå®šä¹‰éœ€è¦ç¼–è¯‘çš„æ¨¡å—å¯¹è±¡æ–‡ä»¶ã€‚ -C libmodules$(shell uname -r)buildï¼šæŒ‡å®šå†…æ ¸æºä»£ç æ ‘çš„è·¯å¾„ã€‚ M$(PWD)ï¼šæŒ‡å®šå½“å‰ç›®å½•ã€‚ ç¼–è¯‘æ¨¡å—åœ¨æ¨¡å—æºä»£ç æ‰€åœ¨ç›®å½•ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š make è¿™ä¸ªå‘½ä»¤ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª .ko æ–‡ä»¶ï¼Œè¿™æ˜¯ç¼–è¯‘åçš„å†…æ ¸æ¨¡å—ã€‚ å†…æ ¸æ¨¡å—çš„å®‰è£…åŠ è½½æ¨¡å—ç¼–è¯‘å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ insmod å‘½ä»¤å°†æ¨¡å—åŠ è½½åˆ°å†…æ ¸ä¸­ï¼š sudo insmod hello.ko insmodï¼šåŠ è½½æŒ‡å®šçš„å†…æ ¸æ¨¡å—ã€‚ hello.koï¼šç¼–è¯‘ç”Ÿæˆçš„å†…æ ¸æ¨¡å—æ–‡ä»¶ã€‚ éªŒè¯æ¨¡å—æ˜¯å¦åŠ è½½å¯ä»¥é€šè¿‡ lsmod å‘½ä»¤æ£€æŸ¥æ¨¡å—æ˜¯å¦å·²æˆåŠŸåŠ è½½ï¼š lsmod | grep hello ä¹Ÿå¯ä»¥é€šè¿‡ dmesg æŸ¥çœ‹å†…æ ¸æ—¥å¿—ï¼Œæ£€æŸ¥æ¨¡å—çš„è¾“å‡ºï¼š dmesg | tail å¸è½½æ¨¡å—å¦‚æœéœ€è¦å¸è½½æ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨ rmmod å‘½ä»¤ï¼š sudo rmmod hello å†…æ ¸æ¨¡å—çš„è°ƒè¯•ä½¿ç”¨ printk è°ƒè¯•åœ¨å¼€å‘å†…æ ¸æ¨¡å—æ—¶ï¼Œæœ€å¸¸ç”¨çš„è°ƒè¯•æ–¹æ³•æ˜¯ä½¿ç”¨ printk å‡½æ•°è¾“å‡ºè°ƒè¯•ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯ä¼šè¢«è®°å½•åœ¨å†…æ ¸æ—¥å¿—ä¸­ï¼Œå¯ä»¥é€šè¿‡ dmesg æŸ¥çœ‹ã€‚ printk(KERN_INFO This is a debug message with value: %d , value); KERN_INFO æ˜¯ä¸€ä¸ªæ—¥å¿—çº§åˆ«ï¼Œè¡¨ç¤ºä¿¡æ¯æ€§æ¶ˆæ¯ã€‚è¿˜æœ‰å…¶ä»–æ—¥å¿—çº§åˆ«ï¼Œå¦‚ KERN_DEBUGã€KERN_ERR ç­‰ã€‚ ä½¿ç”¨ dmesg å‘½ä»¤å¯ä»¥æŸ¥çœ‹å†…æ ¸è¾“å‡ºçš„è°ƒè¯•ä¿¡æ¯ã€‚ ä½¿ç”¨è°ƒè¯•å™¨ä½¿ç”¨è°ƒè¯•å™¨ï¼ˆå¦‚ gdbï¼‰è°ƒè¯•å†…æ ¸æ¨¡å—æ˜¯å¯èƒ½çš„ï¼Œä½†éœ€è¦ä¸€äº›é¢å¤–çš„è®¾ç½®ã€‚å…¸å‹çš„æ­¥éª¤åŒ…æ‹¬ï¼š å¯åŠ¨ä¸€ä¸ªè™šæ‹Ÿæœºæˆ–ä½¿ç”¨å†…æ ¸è°ƒè¯•å™¨ï¼ˆKGDBï¼‰æ¥è¿œç¨‹è°ƒè¯•è¿è¡Œä¸­çš„å†…æ ¸ã€‚ åœ¨å†…æ ¸é…ç½®ä¸­å¯ç”¨ CONFIG_DEBUG_INFO ä»¥ç”Ÿæˆè°ƒè¯•ç¬¦å·ã€‚ ä½¿ç”¨ gdb è¿æ¥åˆ°å†…æ ¸ï¼ŒåŠ è½½ç¬¦å·æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œè°ƒè¯•ã€‚ ä½¿ç”¨å†…æ ¸æ—¥å¿—å’Œè·Ÿè¸ªå·¥å…·é™¤äº† printkï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·è¿›è¡Œè°ƒè¯•ï¼š ftraceï¼šLinux å†…æ ¸çš„å†…å»ºè·Ÿè¸ªå·¥å…·ï¼Œç”¨äºè·Ÿè¸ªå‡½æ•°è°ƒç”¨å’Œæ€§èƒ½åˆ†æã€‚ perfï¼šå¼ºå¤§çš„æ€§èƒ½ç›‘è§†å’Œåˆ†æå·¥å…·ï¼Œé€‚ç”¨äºåˆ†æå†…æ ¸æ¨¡å—çš„æ€§èƒ½é—®é¢˜ã€‚ KprobeseBPFï¼šç”¨äºåŠ¨æ€æ’å…¥è°ƒè¯•æ¢é’ˆï¼Œä»¥ç›‘è§†å†…æ ¸è¡Œä¸ºã€‚ å¸¸è§é—®é¢˜æ’æŸ¥ç¼–è¯‘é”™è¯¯ç¡®ä¿å†…æ ¸å¤´æ–‡ä»¶ä¸è¿è¡Œçš„å†…æ ¸ç‰ˆæœ¬åŒ¹é…ã€‚ æ£€æŸ¥ Makefile ä¸­çš„è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œå°¤å…¶æ˜¯å†…æ ¸æºä»£ç ç›®å½•ã€‚ æ¨¡å—åŠ è½½å¤±è´¥æ£€æŸ¥ dmesg è¾“å‡ºæ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯ã€‚ ç¡®ä¿æ¨¡å—ä½¿ç”¨çš„ç¬¦å·åœ¨å†…æ ¸ä¸­å¯ç”¨ã€‚ æ£€æŸ¥æ¨¡å—çš„è®¸å¯è¯æ˜¯å¦ä¸å†…æ ¸å…¼å®¹ï¼ˆå¦‚ GPLï¼‰ã€‚ è°ƒè¯•ä¿¡æ¯ä¸è¶³ä½¿ç”¨æ›´é«˜çš„ printk æ—¥å¿—çº§åˆ«ï¼ˆå¦‚ KERN_DEBUGï¼‰æ¥æ•è·æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ ä½¿ç”¨ dmesg -n è°ƒæ•´ printk çš„æ—¥å¿—çº§åˆ«è¿‡æ»¤å™¨ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","å†…æ ¸"]},{"title":"ç½‘ç»œè®¾å¤‡é©±åŠ¨çš„ä¸­æ–­å¤„ç†","path":"/2024/07/17/1-å¹³å°ç³»ç»Ÿ-Linux-é©±åŠ¨-ç½‘ç»œè®¾å¤‡é©±åŠ¨çš„ä¸­æ–­å¤„ç†/","content":"devm_request_irqdevm_request_irq ç”¨äºæ³¨å†Œä¸­æ–­å¤„ç†ç¨‹åºçš„è®¾å¤‡ç®¡ç†å‡½æ•°ï¼Œä¸»è¦ç‰¹ç‚¹æ˜¯å®ƒè‡ªåŠ¨ç®¡ç†èµ„æºï¼Œå‡å°‘äº†å¼€å‘äººå‘˜çš„è´Ÿæ‹…ã€‚ä½¿ç”¨æ­¤å‡½æ•°æ—¶ï¼Œä¸€æ—¦è®¾å¤‡é©±åŠ¨ç¨‹åºè¢«å¸è½½ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é‡Šæ”¾ç›¸å…³çš„ä¸­æ–­èµ„æºã€‚è¿™ç§æœºåˆ¶å¯ä»¥æœ‰æ•ˆåœ°é˜²æ­¢èµ„æºæ³„æ¼å’Œå…¶ä»–æ½œåœ¨é—®é¢˜ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚ å‡½æ•°åŸå‹ï¼š int devm_request_irq(struct device *dev, unsigned int irq, irq_handler_t handler, unsigned long irqflags, const char *devname, void *dev_id); å‚æ•°è¯´æ˜ï¼š devï¼šæŒ‡å‘è®¾å¤‡ç»“æ„ä½“çš„æŒ‡é’ˆã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç½‘ç»œè®¾å¤‡é©±åŠ¨ä¸­ï¼Œå¯ä»¥ä¼ é€’ net_dev-dev æ¥æŒ‡å‘ç½‘ç»œè®¾å¤‡ç»“æ„ä½“ã€‚ irqï¼šè¦ç”³è¯·çš„ä¸­æ–­å·ï¼Œé€šå¸¸ç”±ç¡¬ä»¶æ–‡æ¡£æä¾›ï¼Œç¡®ä¿æŒ‡å®šçš„ä¸­æ–­å·æœªè¢«å…¶ä»–è®¾å¤‡ä½¿ç”¨ã€‚ handlerï¼šä¸­æ–­å¤„ç†ç¨‹åºçš„å‡½æ•°æŒ‡é’ˆï¼Œåœ¨ä¸­æ–­å‘ç”Ÿæ—¶ç³»ç»Ÿè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å¯ä»¥åƒä»¥ä¸‹ç¤ºä¾‹ä¸€æ ·ï¼Œæ‰§è¡Œç‰¹å®šçš„ç¡¬ä»¶å¤„ç†ä»»åŠ¡ï¼š static irqreturn_t my_irq_handler(int irq, void *dev_id) // æ‰§è¡Œä¸­æ–­å¤„ç† return IRQ_HANDLED; irqflagsï¼šä¸­æ–­æ ‡å¿—ï¼Œå¯ä»¥è®¾ç½®ä¸º IRQF_SHAREDï¼Œè¡¨ç¤ºå…è®¸å…¶ä»–è®¾å¤‡å…±äº«æ­¤ä¸­æ–­ã€‚ devnameï¼šè®¾å¤‡åç§°ï¼Œç”¨äºæ˜¾ç¤ºå’Œè°ƒè¯•ï¼Œä¾¿äºè¿½è¸ªå’Œæ’æŸ¥é—®é¢˜ã€‚ dev_idï¼šè®¾å¤‡æ ‡è¯†ï¼Œé€šå¸¸ä¼ å…¥è®¾å¤‡ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå¸®åŠ©åŒºåˆ†å¤šä¸ªè®¾å¤‡å…±äº«åŒä¸€ä¸­æ–­çš„åœºæ™¯ã€‚ request_threaded_irqrequest_threaded_irq å¯ä»¥æ³¨å†Œä¸€ä¸ªä¸­æ–­å¤„ç†ç¨‹åºï¼Œå¹¶èƒ½å¤Ÿä½¿ç”¨çº¿ç¨‹å¤„ç†è€—æ—¶çš„ä»»åŠ¡ã€‚è¿™ç§çº¿ç¨‹åŒ–ä¸­æ–­å¤„ç†ç¨‹åºåœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¹‹å¤–è¿è¡Œï¼Œä½¿å¾—å¯ä»¥æ‰§è¡Œæ›´å¤æ‚çš„æ“ä½œè€Œä¸è‡³äºé˜»å¡ç«‹å³å¤„ç†ã€‚é€‚ç”¨äºå¤„ç†éœ€ç­‰å¾…é•¿æ—¶é—´çš„æ“ä½œï¼Œä¾‹å¦‚æ•°æ®ä¼ è¾“ã€‚ å‡½æ•°åŸå‹ï¼š int request_threaded_irq(unsigned int irq, irq_handler_t handler, irq_handler_t thread_fn, unsigned long irqflags, const char *devname, void *dev_id); å‚æ•°è¯´æ˜ï¼š irqï¼šè¦ç”³è¯·çš„ä¸­æ–­å·ï¼Œç¡®ä¿è¿™ä¸ªä¸­æ–­å·æ²¡æœ‰è¢«å…¶ä»–è®¾å¤‡æ³¨å†Œã€‚ handlerï¼šé¡¶åŠéƒ¨ä¸­æ–­å¤„ç†ç¨‹åºçš„å‡½æ•°æŒ‡é’ˆï¼Œå¯ä»¥ä¸º NULLã€‚è¯¥å‡½æ•°é€šå¸¸ç”¨äºå¿«é€Ÿå¤„ç†ä¸­æ–­ï¼Œå¯ä»¥è¿›è¡Œä¸€äº›è½»é‡çº§çš„æ“ä½œã€‚å¦‚æœæ“ä½œè¾ƒä¸ºå¤æ‚ï¼Œå¯ä»¥é€‰æ‹©åªä½¿ç”¨çº¿ç¨‹åŒ–å¤„ç†ã€‚ thread_fnï¼šçº¿ç¨‹åŒ–ä¸­æ–­å¤„ç†ç¨‹åºçš„å‡½æ•°æŒ‡é’ˆï¼Œç³»ç»Ÿåœ¨ä¸­æ–­å‘ç”Ÿæ—¶ä¼šè°ƒç”¨æ­¤å‡½æ•°ï¼Œè¯¥å‚æ•°ä¸èƒ½ä¸º NULLã€‚ç¤ºä¾‹ä»£ç å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š static int my_thread_fn(unsigned long data) // æ‰§è¡Œè€—æ—¶çš„å¤„ç† return 0; irqflagsï¼šä¸­æ–­æ ‡å¿—ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è®¾ç½®ï¼Œä¾‹å¦‚ IRQF_SHAREDï¼Œè¡¨ç¤ºå¯ä»¥å…±äº«ä¸­æ–­ã€‚ devnameï¼šè®¾å¤‡åç§°ï¼Œç”¨äºæ˜¾ç¤ºå’Œè°ƒè¯•ï¼Œå¸®åŠ©è¯†åˆ«ä¸­æ–­æ¥æºã€‚ dev_idï¼šè®¾å¤‡æ ‡è¯†ï¼Œé€šå¸¸ä¼ å…¥è®¾å¤‡ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œç”¨äºåœ¨å…±äº«ä¸­æ–­çš„æƒ…å†µä¸‹è¿›è¡ŒåŒºåˆ†ã€‚ é€šè¿‡åˆç†ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œé©±åŠ¨ç¨‹åºå¼€å‘äººå‘˜å¯ä»¥éå¸¸é«˜æ•ˆåœ°ç®¡ç†å’Œå“åº”ç¡¬ä»¶ä¸­æ–­ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½å¹¶ç®€åŒ–å¼€å‘è¿‡ç¨‹ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","é©±åŠ¨"]},{"title":"å…³äºUç›˜è¢«å ç”¨æ— æ³•å¼¹å‡º","path":"/2024/07/16/1-å¹³å°ç³»ç»Ÿ-Windows-Uç›˜è¢«å ç”¨æ— æ³•å¼¹å‡º/","content":"æŒ‰ä¸‹ Win+R é”®ï¼Œè¿™ä¼šæ‰“å¼€ä¸€ä¸ªåä¸º è¿è¡Œ çš„å¯¹è¯æ¡†ï¼Œå…¶ä¸­å…è®¸å¿«é€Ÿå¯åŠ¨ç¨‹åºæˆ–æ‰“å¼€ç³»ç»Ÿå·¥å…·ã€‚ åœ¨ è¿è¡Œ å¯¹è¯æ¡†ä¸­ï¼Œè¾“å…¥ eventvwr.mscï¼Œç„¶åæŒ‰ å›è½¦ é”®ã€‚è¿™ä¸€æ“ä½œä¼šæ‰“å¼€ äº‹ä»¶æŸ¥çœ‹å™¨ï¼Œä¸€ä¸ª Windows å†…ç½®å·¥å…·ï¼Œç”¨äºè®°å½•ç³»ç»Ÿã€åº”ç”¨å’Œå®‰å…¨äº‹ä»¶çš„æ—¥å¿—ã€‚ æ‰“å¼€äº‹ä»¶æŸ¥çœ‹å™¨åï¼Œå·¦ä¾§çš„å¯¼èˆªçª—æ ¼ä¸­ä¼šæ˜¾ç¤º **äº‹ä»¶æŸ¥çœ‹å™¨(æœ¬åœ°)**ï¼Œç‚¹å‡»å®ƒä»¥å±•å¼€åŒ…å«ä¸åŒæ—¥å¿—ç±»åˆ«çš„èœå•ã€‚ åœ¨å±•å¼€çš„èœå•ä¸­ï¼Œæ‰¾åˆ°å¹¶ç‚¹å‡» Windows æ—¥å¿—ï¼Œç„¶åé€‰æ‹© ç³»ç»Ÿã€‚è¿™éƒ¨åˆ†è®°å½•ä¸ Windows æ“ä½œç³»ç»Ÿæœ¬èº«æœ‰å…³çš„äº‹ä»¶ï¼Œä¾‹å¦‚ç¡¬ä»¶æ•…éšœã€é©±åŠ¨ç¨‹åºé—®é¢˜æˆ–ç³»ç»ŸæœåŠ¡æ•…éšœã€‚ æµè§ˆç³»ç»Ÿæ—¥å¿—ï¼Œå¯»æ‰¾æœ€è¿‘çš„ è­¦å‘Š äº‹ä»¶ï¼Œç‰¹åˆ«æ˜¯æºäº Kernel-PnP çš„è­¦å‘Šã€‚è¿™ç±»è­¦å‘Šé€šå¸¸æ˜¯ä¸è®¾å¤‡é©±åŠ¨ç¨‹åºæˆ–æ’æ‹”ç¡¬ä»¶ç›¸å…³çš„äº‹ä»¶ã€‚å®ƒä»¬å¯èƒ½ä¸ USB è®¾å¤‡ã€æ‰“å°æœºæˆ–å…¶ä»–å¤–éƒ¨ç¡¬ä»¶ç›¸å…³ã€‚ æ‰¾åˆ°è¯¥è­¦å‘Šåï¼ŒåŒå‡»å®ƒï¼Œç³»ç»Ÿå°†å¼¹å‡ºä¸€ä¸ªæ–°çª—å£ï¼Œæ˜¾ç¤ºè­¦å‘Šçš„è¯¦ç»†ä¿¡æ¯ã€‚åœ¨æ­¤çª—å£ä¸­ï¼ŒæŸ¥æ‰¾ è¿›ç¨‹ ID ä¸º **** çš„åº”ç”¨ç¨‹åºå·²åœæ­¢åˆ é™¤æˆ–å¼¹å‡ºè®¾å¤‡ çš„ä¿¡æ¯ï¼Œè¿™é‡Œç”¨â€****â€è¡¨ç¤ºå…·ä½“çš„è¿›ç¨‹ IDã€‚ è®°ä¸‹è¿™ä¸ªè¿›ç¨‹ IDï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©è¿›ä¸€æ­¥è°ƒæŸ¥ç›¸å…³åº”ç”¨ç¨‹åºæˆ–è®¾å¤‡ï¼Œå¹¶å¯¹å¯èƒ½å­˜åœ¨çš„é—®é¢˜è¿›è¡Œæ›´æ·±å…¥çš„åˆ†ææˆ–ä¿®å¤ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå‘ç°æŸä¸ªè®¾å¤‡åœ¨ä¸æ–­å‡ºç°è­¦å‘Šï¼Œå¯èƒ½éœ€è¦æ›´æ–°æˆ–é‡æ–°å®‰è£…å…¶é©±åŠ¨ç¨‹åºã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Windows"]},{"title":"åŠ å¯†æ–¹å¼ä»‹ç»","path":"/2024/07/12/1-å¹³å°ç³»ç»Ÿ-Linux-åŠ å¯†-åŠ å¯†æ–¹å¼ä»‹ç»/","content":"åŠ å¯†æŠ€æœ¯é€šå¸¸åˆ†ä¸ºä¸¤å¤§ç±»â€å¯¹ç§°å¼â€å’Œâ€éå¯¹ç§°å¼â€","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","åŠ å¯†"]},{"title":"ç¨‹åºåŠ è½½","path":"/2024/07/11/1-å¹³å°ç³»ç»Ÿ-Linux-ç¨‹åº-ç¨‹åºåŠ è½½/","content":"Linux ä¸­åˆ†ä¸ºç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Œæ‰§è¡Œ ELF æ–‡ä»¶åœ¨ç”¨æˆ·æ€çš„è¡¨ç°å°±æ˜¯æ‰§è¡Œ execve ç³»ç»Ÿè°ƒç”¨ï¼Œéšåé™·å…¥å†…æ ¸è¿›è¡Œå¤„ç†ã€‚ å†…æ ¸ç©ºé—´å†…æ ¸ç©ºé—´å¯¹ execve çš„å¤„ç†å…¶å®å¯ä»¥å•ç‹¬ç”¨ä¸€ç¯‡æ–‡ç« å»ä»‹ç»ï¼Œå…¶ä¸­æ¶‰åŠåˆ°è¿›ç¨‹çš„åˆ›å»ºã€æ–‡ä»¶èµ„æºçš„å¤„ç†ä»¥åŠè¿›ç¨‹æƒé™çš„è®¾ç½®ç­‰ç­‰ã€‚è¿™é‡Œä¸»è¦å…³æ³¨å…¶ä¸­ ELF å¤„ç†ç›¸å…³çš„éƒ¨åˆ†å³å¯ï¼Œå®é™…ä¸Šå†…æ ¸å¯ä»¥è¯†åˆ«å¤šç§ç±»å‹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒELF çš„å¤„ç†ä»£ç ä¸»è¦åœ¨ fsbinfmt_elf.c ä¸­çš„ load_elf_binary å‡½æ•°ä¸­ã€‚ å¯¹äº ELF è€Œè¨€ï¼ŒLinux å†…æ ¸æ‰€å…³å¿ƒçš„åªæœ‰ Program Header éƒ¨åˆ†ï¼Œç”šè‡³å¤§éƒ¨åˆ†æƒ…å†µä¸‹åªå…³å¿ƒä¸‰ç§ç±»å‹çš„ Headerï¼Œå³ PT_LOADã€PT_INTERP å’Œ PT_GNU_STACKã€‚ä»¥ 3.18 å†…æ ¸ä¸ºä¾‹ï¼Œload_elf_binary ä¸»è¦æœ‰ä¸‹é¢æ“ä½œ: å¯¹ ELF æ–‡ä»¶åšä¸€äº›åŸºæœ¬æ£€æŸ¥ï¼Œä¿è¯ e_phentsize sizeof(struct elf_phdr)å¹¶ä¸” e_phnum çš„ä¸ªæ•°åœ¨ä¸€å®šèŒƒå›´å†…ï¼› å¾ªç¯æŸ¥çœ‹æ¯ä¸€é¡¹ program headerï¼Œå¦‚æœæœ‰ PT_INTERP åˆ™ä½¿ç”¨ open_exec åŠ è½½è¿›æ¥ï¼Œå¹¶æ›¿æ¢åŸç¨‹åºçš„ bprm-buf; æ ¹æ® PT_GNU_STACK æ®µä¸­çš„ flag è®¾ç½®æ ˆæ˜¯å¦å¯æ‰§è¡Œï¼› ä½¿ç”¨ flush_old_exec æ¥æ›´æ–°å½“å‰å¯æ‰§è¡Œæ–‡ä»¶çš„æ‰€æœ‰å¼•ç”¨ï¼› ä½¿ç”¨ setup_new_exec è®¾ç½®æ–°çš„å¯æ‰§è¡Œæ–‡ä»¶åœ¨å†…æ ¸ä¸­çš„çŠ¶æ€ï¼› setup_arg_pages åœ¨æ ˆä¸Šè®¾ç½®ç¨‹åºè°ƒç”¨å‚æ•°çš„å†…å­˜é¡µï¼› å¾ªç¯æ¯ä¸€é¡¹ PT_LOAD ç±»å‹çš„æ®µï¼Œelf_map æ˜ å°„åˆ°å¯¹åº”å†…å­˜é¡µä¸­ï¼Œåˆå§‹åŒ– BSSï¼› å¦‚æœå­˜åœ¨ interpreterï¼Œå°†å…¥å£(elf_entry)è®¾ç½®ä¸º interpreter çš„å‡½æ•°å…¥å£ï¼Œå¦åˆ™è®¾ç½®ä¸ºåŸ ELF çš„å…¥å£åœ°å€ï¼› install_exec_creds(bprm)è®¾ç½®è¿›ç¨‹æƒé™ç­‰ä¿¡æ¯ï¼› create_elf_tables æ·»åŠ éœ€è¦çš„ä¿¡æ¯åˆ°ç¨‹åºçš„æ ˆä¸­ï¼Œæ¯”å¦‚ ELF auxiliary vectorï¼› è®¾ç½® current-mm å¯¹åº”çš„å­—æ®µï¼› ä»å†…æ ¸çš„å¤„ç†æµç¨‹ä¸Šæ¥çœ‹ï¼Œå¦‚æœæ˜¯é™æ€é“¾æ¥çš„ç¨‹åºï¼Œå®é™…ä¸Šå†…æ ¸è¿”å›ç”¨æˆ·ç©ºé—´æ‰§è¡Œçš„å°±æ˜¯è¯¥ç¨‹åºçš„å…¥å£åœ°å€ä»£ç ï¼›å¦‚æœæ˜¯åŠ¨æ€é“¾æ¥çš„ç¨‹åºï¼Œå†…æ ¸è¿”å›ç”¨æˆ·ç©ºé—´æ‰§è¡Œçš„åˆ™æ˜¯ interpreter çš„ä»£ç ï¼Œå¹¶ç”±å…¶åŠ è½½å®é™…çš„ ELF ç¨‹åºå»æ‰§è¡Œã€‚ ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿå¦‚æœæŠŠåŠ¨æ€é“¾æ¥ç›¸å…³çš„ä»£ç ä¹Ÿæ”¾åˆ°å†…æ ¸ä¸­ï¼Œå°±ä¼šå¯¼è‡´å†…æ ¸æ‰§è¡ŒåŠŸèƒ½è¿‡å¤šï¼Œå†…æ ¸çš„ç†å¿µä¸€ç›´æ˜¯èƒ½ä¸åœ¨å†…æ ¸ä¸­æ‰§è¡Œçš„å°±ä¸åœ¨å†…æ ¸ä¸­å¤„ç†ï¼Œä»¥é¿å…å‡ºç°é—®é¢˜æ—¶éš¾ä»¥æ›´æ–°è€Œä¸”å½±å“ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚äº‹å®ä¸Šå†…æ ¸ä¸­å¯¹ ELF æ–‡ä»¶ç»“æ„çš„æ”¯æŒæ˜¯ç›¸å½“æœ‰é™çš„ï¼Œåªèƒ½è¯»å–å¹¶ç†è§£éƒ¨åˆ†çš„å­—æ®µã€‚ ç”¨æˆ·ç©ºé—´å†…æ ¸è¿”å›ç”¨æˆ·ç©ºé—´åï¼Œå¯¹äºé™æ€é“¾æ¥çš„ç¨‹åºæ˜¯ç›´æ¥æ‰§è¡Œï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚è€Œå¯¹äºåŠ¨æ€é“¾æ¥çš„ç¨‹åºï¼Œå®é™…æ˜¯æ‰§è¡Œ interpreter çš„ä»£ç ã€‚ELF çš„ interpreter ä½œä¸ºä¸€ä¸ªæ®µï¼Œè‡ªç„¶æ˜¯ç¼–è¯‘é“¾æ¥çš„æ—¶å€™åŠ è¿›å»çš„ï¼Œå› æ­¤å’Œç¼–è¯‘ä½¿ç”¨çš„å·¥å…·é“¾æœ‰å…³ã€‚å¯¹äº Linux ç³»ç»Ÿè€Œè¨€ï¼Œä½¿ç”¨çš„ä¸€èˆ¬æ˜¯ GCC å·¥å…·é“¾ï¼Œè€Œ interpreter çš„å®ç°ï¼Œä»£ç å°±åœ¨ glibc çš„ elfrtld.c ä¸­ã€‚ interpreter åˆç§°ä¸º dynamic linkerï¼Œä»¥ glibc2.27 ä¸ºä¾‹ï¼Œå®ƒçš„å¤§è‡´åŠŸèƒ½å¦‚ä¸‹: å°†å®é™…è¦æ‰§è¡Œçš„ ELF ç¨‹åºä¸­çš„å†…å­˜æ®µåŠ è½½åˆ°å½“å‰è¿›ç¨‹ç©ºé—´ä¸­ï¼› å°†åŠ¨æ€åº“çš„å†…å­˜æ®µåŠ è½½åˆ°å½“å‰è¿›ç¨‹ç©ºé—´ä¸­ï¼› å¯¹ ELF ç¨‹åºå’ŒåŠ¨æ€åº“è¿›è¡Œé‡å®šå‘æ“ä½œ(relocation)ï¼› è°ƒç”¨åŠ¨æ€åº“çš„åˆå§‹åŒ–å‡½æ•°(å¦‚ .preinit_array, .init, .init_array)ï¼› å°†æ§åˆ¶æµä¼ é€’ç»™ç›®æ ‡ ELF ç¨‹åºï¼Œè®©å…¶çœ‹èµ·æ¥è‡ªå·±æ˜¯ç›´æ¥å¯åŠ¨çš„ï¼› å…¶ä¸­å‚ä¸åŠ¨æ€åŠ è½½å’Œé‡å®šå‘æ‰€éœ€è¦çš„é‡è¦éƒ¨åˆ†å°±æ˜¯ Program Header Table ä¸­ PT_DYNAMIC ç±»å‹çš„ Segmentã€‚å‰é¢æåˆ°åœ¨ Section Header ä¸­ä¹Ÿæœ‰ä¸€éƒ¨åˆ†å‚ä¸åŠ¨æ€é“¾æ¥çš„ sectionï¼Œå³.dynamicã€‚åœ¨è‡ªå·±è§£æåŠ¨æ€é“¾æ¥æ–‡ä»¶çš„æ—¶å€™å‘ç°ï¼Œå®é™…ä¸Š .dynamic section ä¸­çš„æ•°æ®ï¼Œå’Œ PT_DYNAMIC ä¸­çš„æ•°æ®æŒ‡å‘çš„æ˜¯æ–‡ä»¶ä¸­çš„åŒä¸€ä¸ªåœ°æ–¹ï¼Œå³è¿™ä¸¤ä¸ª entry çš„ s_offset å’Œ p_offset æ˜¯ç›¸åŒã€‚æ¯ä¸ªå…ƒç´ çš„ç±»å‹å¦‚ä¸‹: typedef struct Elf32_Sword\td_tag; /* Dynamic entry type */ union Elf32_Word d_val; /* Integer value */ Elf32_Addr d_ptr; /* Address value */ d_un; Elf32_Dyn; d_tag è¡¨ç¤ºå®é™…ç±»å‹ï¼Œå¹¶ä¸” d_un å’Œ d_tag ç›¸å…³ã€‚åŒæ ·çš„ï¼Œæ ‡å‡†ä¸­å®šä¹‰äº†å‡ åä¸ª d_tag ç±»å‹ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„å‡ ä¸ªå¦‚ä¸‹: DT_NULL: è¡¨ç¤º _DYNAMIC çš„ç»“å°¾ DT_NEEDED: d_val ä¿å­˜äº†ä¸€ä¸ªåˆ°å­—ç¬¦ä¸²è¡¨å¤´çš„åç§»ï¼ŒæŒ‡å®šçš„å­—ç¬¦ä¸²è¡¨ç¤ºè¯¥ ELF æ‰€ä¾èµ–çš„åŠ¨æ€åº“åç§° DT_STRTAB: d_ptr æŒ‡å®šäº†åœ°å€ä¿å­˜äº†ç¬¦å·ã€åŠ¨æ€åº“åç§°ä»¥åŠå…¶ä»–ç”¨åˆ°çš„å­—ç¬¦ä¸² DT_STRSZ: å­—ç¬¦ä¸²è¡¨çš„å¤§å° DT_SYMTAB: æŒ‡å®šåœ°å€ä¿å­˜äº†ç¬¦å·è¡¨ DT_INITDT_FINI: æŒ‡å®šåˆå§‹åŒ–å‡½æ•°å’Œç»“æŸå‡½æ•°çš„åœ°å€ DT_RPATH: æŒ‡å®šåŠ¨æ€åº“æœç´¢ç›®å½• DT_SONAME: Shared Object Nameï¼ŒæŒ‡å®šå½“å‰åŠ¨æ€åº“çš„åå­—(logical name) å…¶ä¸­æœ‰éƒ¨åˆ†çš„ç±»å‹å¯ä»¥å’Œ Section ä¸­çš„ SHT_xxx ç±»å‹è¿›è¡Œç±»æ¯”ï¼Œå®Œæ•´çš„åˆ—è¡¨å¯ä»¥å‚è€ƒ ELF æ ‡å‡†ä¸­çš„ Book III: Operating System Specific ä¸€èŠ‚ã€‚ åœ¨ interpreter æ ¹æ® DT_NEEDED åŠ è½½å®Œæ‰€æœ‰éœ€è¦çš„åŠ¨æ€åº“åï¼Œå°±å®ç°äº†å®Œæ•´è¿›ç¨‹è™šæ‹Ÿå†…å­˜æ˜ åƒçš„å¸ƒå±€ã€‚åœ¨å¯»æ‰¾æŸä¸ªåŠ¨æ€ç¬¦å·æ—¶ï¼Œinterpreter ä¼šä½¿ç”¨å¹¿åº¦ä¼˜å…ˆçš„æ–¹å¼å»è¿›è¡Œæœç´¢ï¼Œå³å…ˆåœ¨å½“å‰ ELF ç¬¦å·è¡¨ä¸­æ‰¾ï¼Œç„¶åå†ä»å½“å‰ ELF çš„ DT_NEEDED åŠ¨æ€åº“ä¸­æ‰¾ï¼Œå†ç„¶åä»åŠ¨æ€åº“ä¸­çš„ DT_NEEDED é‡ŒæŸ¥æ‰¾ã€‚ å› ä¸ºåŠ¨æ€åº“æœ¬èº«æ˜¯ä½ç½®æ— å…³çš„(PIE)ï¼Œæ”¯æŒè¢«åŠ è½½åˆ°å†…å­˜ä¸­çš„éšæœºä½ç½®ï¼Œå› æ­¤ä¸ºäº†ç¨‹åºä¸­ç”¨åˆ°çš„ç¬¦å·å¯ä»¥è¢«æ­£ç¡®å¼•ç”¨ï¼Œéœ€è¦å¯¹å…¶è¿›è¡Œé‡å®šå‘æ“ä½œï¼ŒæŒ‡å‘å¯¹åº”ç¬¦å·çš„çœŸå®åœ°å€ã€‚ Interpreter Hackå‡è®¾ç°åœ¨é¢å¯¹ä¸¤ç§åœºæ™¯: ç›®æ ‡ç¯å¢ƒçš„å¯å†™ç£ç›˜ç›´æ¥ mount ä¸º noexecï¼Œæ— æ³•æ‰§è¡Œä»£ç  ç›®æ ‡ç¯å¢ƒå†…æ ¸ç›‘æ§ä»»ä½•éç³»ç»Ÿè·¯å¾„çš„ç¨‹åºçš„æ‰§è¡Œéƒ½ä¼šç›´æ¥å‘Šè­¦ è¿ç”¨ä¸Šé¢å­¦åˆ°çš„ ELF çŸ¥è¯†ï¼Œåˆ©ç”¨ interpreter è¿›è¡Œæ‰§è¡Œã€‚ç¤ºä¾‹å¦‚ä¸‹: $ cat hello.c#include stdio.hint main() return puts(hello!);$ gcc hello.c -o hello$ ./hellohello!$ chmod -x hello$ ./hellobash: ./hello: Permission denied$ /lib64/ld-linux-x86-64.so.2 ./hellohello!$ strace /lib64/ld-linux-x86-64.so.2 ./hello 21 | grep execexecve(/lib64/ld-linux-x86-64.so.2, [/lib64/ld-linux-x86-64.so.2, ./hello], 0x7fff1206f208 /* 9 vars */) = 0 /lib64/ld-linux-x86-64.so.2 æœ¬èº«åº”è¯¥æ˜¯å†…æ ¸è°ƒç”¨æ‰§è¡Œçš„ï¼Œä½†è¿™é‡Œå¯ä»¥ç›´æ¥è¿›è¡Œè°ƒç”¨ã€‚è¿™æ ·ä¸€æ–¹é¢å¯ä»¥åœ¨æ²¡æœ‰æ‰§è¡Œæƒé™çš„æƒ…å†µä¸‹æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…å†…æ ¸å¯¹ execve çš„å¼‚å¸¸ç›‘æ§ã€‚ åˆ©ç”¨(æ»¥ç”¨)interpreter è¿˜å¯ä»¥åšå…¶ä»–æœ‰è¶£çš„äº‹æƒ…ï¼Œæ¯”å¦‚é€šè¿‡ä¿®æ”¹æŒ‡å®š ELF æ–‡ä»¶çš„ interpreter ä¸ºè‡ªå·±çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯è®©å†…æ ¸åœ¨å¤„ç†ç›®æ ‡ ELF æ—¶å°†æ§åˆ¶å™¨äº¤ç»™çš„ interpreterï¼Œè¿™å¯ä»¥é€šè¿‡ç›´æ¥ä¿®æ”¹å­—ç¬¦ä¸²è¡¨æˆ–è€…ä½¿ç”¨ä¸€äº›å·¥å…·å¦‚ patchelf æ¥è½»æ¾å®ç°ã€‚ å¯¹äºæ¶æ„è½¯ä»¶åˆ†æçš„åœºæ™¯ï¼Œå¾ˆå¤šå®‰å…¨ç ”ç©¶äººå‘˜çœ‹åˆ° ELF å°±å–œæ¬¢ç”¨ ldd å»çœ‹çœ‹æœ‰ä»€ä¹ˆä¾èµ–åº“ï¼Œä¸€èˆ¬ ldd è„šæœ¬å®é™…ä¸Šæ˜¯è°ƒç”¨ç³»ç»Ÿé»˜è®¤çš„ ld.so å¹¶é€šè¿‡ç¯å¢ƒå˜é‡æ¥æ‰“å°ä¿¡æ¯ï¼Œä¸è¿‡å¯¹äºæŸäº› glibc å®ç°(å¦‚ glibc2.27 ä¹‹å‰çš„ ld.so)ï¼Œä¼šè°ƒç”¨ ELF æŒ‡å®šçš„ interpreter è¿è¡Œï¼Œä»è€Œå­˜åœ¨éé¢„æœŸå‘½ä»¤æ‰§è¡Œçš„é£é™©ã€‚ åŠ å›ºè„±å£³ä¸é€†å‘åˆ†ææ¯”è¾ƒç›¸å…³çš„å°±æ˜¯ç¬¦å·è¡¨ï¼Œä¸€ä¸ªæœ‰ç¬¦å·çš„ç¨‹åºåœ¨é€†å‘æ—¶åŸºæœ¬ä¸Šå’Œè¯»æºç å·®ä¸å¤šã€‚å› æ­¤å¯¹äºæƒ³ä¿æŠ¤åº”ç”¨ç¨‹åºçš„å¼€å‘è€…è€Œè¨€ï¼Œæœ€ç®€å•çš„é˜²æŠ¤æ–¹æ³•å°±æ˜¯å»é™¤ç¬¦å·è¡¨ï¼Œä¸€ä¸ªç®€å•çš„ strip å‘½ä»¤å°±å¯å®ç°ã€‚strip åˆ é™¤çš„ä¸»è¦æ˜¯ Section ä¸­çš„ä¿¡æ¯ï¼Œå› ä¸ºè¿™ä¸å½±å“ç¨‹åºçš„æ‰§è¡Œã€‚å»é™¤å‰åè¿›è¡Œ diff å¯¹æ¯”å¯çœ‹åˆ°åˆ é™¤çš„ section ä¸»è¦æœ‰ä¸‹é¢è¿™äº›: $ diff 0 11c1 There are 35 section headers, starting at offset 0x1fdc:--- There are 28 section headers, starting at offset 0x1144:32,39c32 [27] .debug_aranges PROGBITS 00000000 00104d 000020 00 0 0 1 [28] .debug_info PROGBITS 00000000 00106d 000350 00 0 0 1 [29] .debug_abbrev PROGBITS 00000000 0013bd 000100 00 0 0 1 [30] .debug_line PROGBITS 00000000 0014bd 0000cd 00 0 0 1 [31] .debug_str PROGBITS 00000000 00158a 000293 01 MS 0 0 1 [32] .symtab SYMTAB 00000000 001820 000480 10 33 49 4 [33] .strtab STRTAB 00000000 001ca0 0001f4 00 0 0 1 [34] .shstrtab STRTAB 00000000 001e94 000145 00 0 0 1--- [27] .shstrtab STRTAB 00000000 00104d 0000f5 00 0 0 1 å…¶ä¸­ .symtab æ˜¯ç¬¦å·è¡¨ï¼Œ.strtab æ˜¯ç¬¦å·è¡¨ä¸­ç”¨åˆ°çš„å­—ç¬¦ä¸²ã€‚ ä»…ä»…å»æ‰ç¬¦å·æ„Ÿè§‰è¿˜ä¸å¤Ÿï¼Œç†Ÿæ‚‰æ±‡ç¼–çš„äººæ”¾åˆ°åç¼–è¯‘å·¥å…·ä¸­è¿˜æ˜¯å¯ä»¥æ…¢æ…¢è¿˜åŸç¨‹åºé€»è¾‘ã€‚é€šè¿‡å‰é¢çš„åˆ†æçŸ¥é“ï¼ŒELF æ‰§è¡Œéœ€è¦çš„åªæ˜¯ Program Header ä¸­çš„å‡ ä¸ªæ®µï¼ŒSection Header å®é™…ä¸Šæ˜¯ä¸éœ€è¦çš„ï¼Œåªä¸è¿‡åœ¨è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥è¿‡ç¨‹ä¼šå¼•ç”¨åˆ°éƒ¨åˆ†å…³è”çš„åŒºåŸŸã€‚å¤§éƒ¨åˆ†åç¼–è¯‘å·¥å…·ï¼Œå¦‚ IDAã€Ghidra ç­‰ï¼Œå¤„ç† ELF æ˜¯éœ€è¦æŸäº› section ä¿¡æ¯æ¥æ„å»ºç¨‹åºè§†å›¾çš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æ„é€ ä¸€ä¸ªæŸå Section Table æˆ–è€… ELF Header ä»¤è¿™äº›åç¼–è¯‘å·¥å…·å‡ºé”™ï¼Œä»è€Œå¹²æ‰°é€†å‘äººå‘˜ã€‚ å½“ç„¶ï¼Œè¿™ä¸ªæ–¹æ³•å¹¶ä¸æ€»æ˜¯å¥æ•ˆï¼Œé€†å‘äººå‘˜å¯ä»¥é€šè¿‡åŠ¨æ€è°ƒè¯•æŠŠç¨‹åº dump å‡ºæ¥å¹¶å¯¹è¿è¡Œè§†å›¾è¿›è¡Œè¿˜åŸã€‚ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯ Android ä¸­çš„ JNI åŠ¨æ€åº“ï¼Œæœ‰çš„å®‰å…¨äººå‘˜å¯¹è¿™äº› so æ–‡ä»¶è¿›è¡Œäº†åŠ å¯†å¤„ç†ï¼Œå¹¶ä¸”åœ¨.init.initarray è¿™äº›åŠ¨æ€åº“åˆå§‹åŒ–å‡½æ•°ä¸­è¿›è¡ŒåŠ¨æ€è§£å¯†ã€‚ç ´è§£è¿™ç§åŠ å›ºæ–¹æ³•çš„ç­–ç•¥å°±æ˜¯å°†å…¶ä»å†…å­˜ä¸­å¤åˆ¶å‡ºæ¥å¹¶è¿›è¡Œé‡å»ºï¼Œé‡å»ºçš„è¿‡ç¨‹å¯æ ¹æ® segment å¯¹ section è¿›è¡Œè¿˜åŸï¼Œå› ä¸º segment å’Œ section ä¹‹é—´å…±äº«äº†è®¸å¤šå†…å­˜ç©ºé—´ï¼Œä¾‹å¦‚: $ readelf -l main1... Section to Segment mapping: Segment Sections... 00 01 .interp 02 .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt .init .plt .plt.got .text .fini .rodata .eh_frame_hdr .eh_frame 03 .init_array .fini_array .dynamic .got .got.plt .data .bss 04 .dynamic 05 .note.ABI-tag .note.gnu.build-id 06 .eh_frame_hdr 07 08 .init_array .fini_array .dynamic .got åœ¨ Section to Segment mapping ä¸­å¯ä»¥çœ‹åˆ°è¿™äº›æ®µçš„å†…å®¹æ˜¯è·Ÿå¯¹åº” section çš„å†…å®¹é‡å çš„ï¼Œä¸€ä¸ª segment å¯ä»¥åŒ…å«å¤šä¸ª sectionï¼Œä½†æ˜¯ä¾ç„¶å¯ä»¥æ ¹æ®å†…å­˜çš„è¯»å†™å±æ€§ã€å†…å­˜ç‰¹å¾ä»¥åŠå¯¹åº”æ®µçš„ä¸€èˆ¬é¡ºåºè¿›è¡ŒåŒºåˆ†ã€‚ å¦‚æœç¨‹åºä¸­æœ‰æ¯”è¾ƒè¯¦ç»†çš„æ—¥å¿—å‡½æ•°ï¼Œè¿˜å¯ä»¥é€šè¿‡åç¼–è¯‘å·¥å…·çš„è„šæœ¬æ‹“å±•å»ä¿®æ”¹.symtab.strtab æ®µæ¥æ‰¹é‡è¿˜åŸ ELF æ–‡ä»¶çš„ç¬¦å·ï¼Œä»è€Œé«˜æ•ˆåœ°è¾…åŠ©åŠ¨æ€è°ƒè¯•ã€‚ Binary Fuzzingè€ƒè™‘è¿™ä¹ˆä¸€ç§åœºæ™¯ï¼Œåœ¨åˆ†ææŸä¸ª IoT è®¾å¤‡æ—¶å‘ç°äº†ä¸€ä¸ªå®šåˆ¶çš„ ELF ç½‘ç»œç¨‹åºï¼Œç±»ä¼¼äº httpdï¼Œå…¶ä¸­æœ‰ä¸ªé™æ€å‡½æ•°è´Ÿè´£å¤„ç†è¾“å…¥æ•°æ®ã€‚ç°åœ¨æƒ³è¦å•ç‹¬å¯¹è¿™ä¸ªå‡½æ•°è¿›è¡Œ fuzz åº”è¯¥æ€ä¹ˆåšï¼Ÿç›´æ¥ä»ç½‘ç»œè¯·æ±‚ä¸­è¿›è¡Œå˜å¼‚æ˜¯ä¸€ç§æ–¹æ³•ï¼Œä½†æ˜¯ç½‘ç»œè¯·æ±‚çš„æ•ˆç‡å¤ªä½ï¼Œè€Œä¸”è§¦è¾¾è¯¥å‡½æ•°çš„ç¨‹åºé€»è¾‘ä¹Ÿå¯èƒ½å¤ªé•¿ã€‚ æ—¢ç„¶å·²ç»äº†è§£äº† ELFï¼Œé‚£å°±å¯ä»¥æœ‰æ›´å¥½çš„åŠæ³•å°†è¯¥å‡½æ•°æŠ½å–å‡ºæ¥è¿›è¡Œç‹¬ç«‹è°ƒç”¨ã€‚åœ¨ä»‹ç» ELF ç±»å‹çš„æ—¶å€™å…¶å®æœ‰æåˆ°ï¼Œå¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥æœ‰ä¸¤ç§ç±»å‹ï¼Œå³å¯æ‰§è¡Œç±»å‹(ET_EXEC)å’Œå…±äº«å¯¹è±¡(ET_DYN)ï¼Œä¸€ä¸ªåŠ¨æ€é“¾æ¥çš„å¯æ‰§è¡Œç¨‹åºé»˜è®¤æ˜¯å…±äº«å¯¹è±¡ç±»å‹çš„: $ gcc hello.c -o hello$ readelf -h hello | grep Type Type: DYN (Shared object file) è€ŒåŠ¨æ€åº“(.so)æœ¬èº«ä¹Ÿæ˜¯å…±äº«å¯¹è±¡ç±»å‹ï¼Œä»–ä»¬ä¹‹é—´çš„æœ¬è´¨åŒºåˆ«åœ¨äºå‰è€…é“¾æ¥äº† libc å¹¶ä¸”å®šä¹‰äº† main å‡½æ•°ã€‚å¯¹äºåŠ¨æ€åº“ï¼Œå¯ä»¥é€šè¿‡ dlopendlsym è·å–å¯¹åº”çš„ç¬¦å·è¿›è¡Œè°ƒç”¨ï¼Œå› æ­¤å¯¹äºä¸Šé¢çš„åœºæ™¯ï¼Œä¸€ä¸ªè§£å†³æ–¹å¼å°±æ˜¯ä¿®æ”¹ç›®æ ‡ ELF æ–‡ä»¶ï¼Œå¹¶ä¸”å°†å¯¹åº”çš„é™æ€å‡½æ•°å¯¼å‡ºæ·»åŠ åˆ° dynamic section ä¸­ï¼Œå¹¶ä¿®å¤å¯¹åº”çš„ ELF å¤´ã€‚ è¿™ä¸ªæ€æƒ³å…¶å®å¾ˆæ—©å°±å·²ç»æœ‰äººå®ç°äº†ï¼Œæ¯”å¦‚ lief çš„ bin2libã€‚é€šè¿‡è¯¥æ–¹æ³•ï¼Œå°±èƒ½å°†ç›®æ ‡ç¨‹åºä»»æ„çš„å‡½æ•°æŠ½å–å‡ºæ¥æ‰§è¡Œï¼Œæ¯”å¦‚ hugsy å°±ç”¨è¿™ä¸ªæ–¹å¼å¤ç°äº† Exim ä¸­çš„æº¢å‡ºæ¼æ´(CVE-2018-6789)ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç¨‹åº"]},{"title":"è¿›ç¨‹è„±ç¦»ç»ˆç«¯åå°è¿è¡Œ","path":"/2024/07/10/1-å¹³å°ç³»ç»Ÿ-Linux-ç³»ç»Ÿå‚æ•°-è¿›ç¨‹è„±ç¦»ç»ˆç«¯åå°è¿è¡Œ/","content":"è¿è¡Œä¸€ä¸ªè¿æ¥åˆ°æ§åˆ¶ç»ˆç«¯çš„è¿›ç¨‹ï¼Œä½œä¸ºç”¨æˆ·å°†ä¼šåœ¨çš„ç»ˆç«¯ä¸Šçœ‹åˆ°è¿™ä¸ªè¿›ç¨‹æ•°æ®çš„è®¸å¤šè¡Œçš„è¾“å‡ºï¼Œä¹ŸåŒ…å«é”™è¯¯ä¿¡æ¯ã€‚åŒæ ·ï¼Œå½“å…³é—­ä¸€ä¸ªæ§åˆ¶ç»ˆç«¯ï¼Œçš„è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½å°†ä¼šç»ˆæ­¢ã€‚ä¸ºäº†è§£å†³ä¸Šé¢ä¸¤ä¸ªé—®é¢˜ï¼Œéœ€è¦ä»ä¸€ä¸ªæ§åˆ¶ç»ˆç«¯å®Œå…¨è„±ç¦»ä¸€ä¸ªè¿›ç¨‹ã€‚ å¦‚ä½•åœ¨åå°è¿è¡Œä¸€ä¸ªè¿›ç¨‹å¦‚æœä¸€ä¸ªè¿›ç¨‹å·²ç»è¿è¡Œï¼ŒæŒ‰ä¸‹ Ctrl+Z å°±å¯ä»¥æš‚åœå®ƒï¼Œç„¶åè¾“å…¥å‘½ä»¤ bg å°±å¯ä»¥ç»§ç»­ä»¥ä¸€ä¸ªä»»åŠ¡åœ¨åå°è¿è¡Œäº†ã€‚ä½†æ˜¯ï¼Œæ ‡å‡†è¾“å…¥ï¼ˆSTDINï¼‰ã€æ ‡å‡†è¾“å‡ºï¼ˆSTDOUTï¼‰å’Œæ ‡å‡†é”™è¯¯ï¼ˆSTDERRï¼‰ä¾æ—§æºæ‚åˆ°æ§åˆ¶å°ä¸­ã€‚å¯ä»¥é€šè¿‡è¾“å…¥ jobs æŸ¥çœ‹æ‰€æœ‰çš„åå°ä»»åŠ¡ã€‚ $ tar -czf home.tar.gz .$ bg$ jobs ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ç¬¦å· åœ¨åå°è¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼š $ tar-czf home.tar.gz . $ jobs è™½ç„¶æ˜¯ä½œä¸ºä¸€ä¸ªåå°ä»»åŠ¡å¼€å§‹çš„ï¼Œä½†æ˜¯é”™è¯¯ä¿¡æ¯ä¾æ—§å‘é€åˆ°ç»ˆç«¯ï¼Œè¿™è¡¨ç¤ºï¼Œè¿›ç¨‹ä¾æ—§å’Œæ§åˆ¶ç»ˆç«¯å…³è”åœ¨ä¸€èµ·ã€‚ disownä»¬å°†ä½¿ç”¨ disown å‘½ä»¤ï¼Œå®ƒåœ¨ä¸€ä¸ªè¿›ç¨‹å·²ç»è¿è¡Œå¹¶ä¸”è¢«æ”¾åœ¨åå°ä¹‹åä½¿ç”¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä» shell çš„æ´»åŠ¨ä»»åŠ¡åˆ—è¡¨ä¸­ç§»èµ°ä¸€ä¸ª shell ä»»åŠ¡ï¼Œå› æ­¤ï¼Œå¯¹äºè¯¥ä»»åŠ¡ï¼Œå°†å†ä¹Ÿä¸èƒ½ä½¿ç”¨ fg ã€ bg å‘½ä»¤äº†ã€‚è€Œä¸”ï¼Œå½“å…³é—­æ§åˆ¶æ§åˆ¶ç»ˆç«¯ï¼Œè¿™ä¸ªä»»åŠ¡å°†ä¸ä¼šæŒ‚èµ·ï¼ˆæš‚åœï¼‰æˆ–è€…å‘ä»»ä½•ä¸€ä¸ªå­ä»»åŠ¡å‘é€ SIGHUP ä¿¡å·ã€‚ $ sudo rsync Templates/* /var/www/html/files/ $ jobs$ disown -h %1$ jobs nohupä¹Ÿå¯ä»¥ä½¿ç”¨ nohup å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤ä¹Ÿå¯ä»¥åœ¨ç”¨æˆ·é€€å‡º shell ä¹‹åä¿è¯è¿›ç¨‹åœ¨åå°ç»§ç»­è¿è¡Œã€‚ $ nohup tar -czf iso.tar.gz Templates/* $ jobs devnullå¯¹äºå›¾å½¢ç”¨æˆ·ç•Œé¢ (GUI) çš„ç¨‹åºä¾‹å¦‚ firefox æ¥è¯´ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¡Œæ ¼å¼ä¼šæ›´æœ‰æ•ˆï¼š $ firefox /dev/null åœ¨ Linux ä¸Šï¼Œdevnull æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶è®¾å¤‡ï¼Œå®ƒä¼šå¿½ç•¥æ‰€æœ‰çš„å†™åœ¨å®ƒä¸Šé¢çš„æ•°æ®ï¼Œä¸Šè¿°å‘½ä»¤ï¼Œè¾“å…¥æ¥æºå’Œè¾“å‡ºå‘é€ç›®æ ‡éƒ½æ˜¯ devnullã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç³»ç»Ÿå‚æ•°"]},{"title":"é‡è£…ç³»ç»Ÿæ— æ³•è¯†åˆ«ç¡¬ç›˜","path":"/2024/07/08/1-å¹³å°ç³»ç»Ÿ-Windows-é‡è£…ç³»ç»Ÿæ— æ³•è¯†åˆ«ç¡¬ç›˜/","content":"Win11 é‡æ–°å®‰è£…ç³»ç»Ÿæ—¶ï¼Œç”±äºç¼ºå°‘ RST é©±åŠ¨ï¼Œå¯¼è‡´è¿›å…¥ PE åæ— æ³•è¯†åˆ«åˆ°ç¡¬ç›˜ï¼Œéœ€è¦å®‰è£…è¯¥é©±åŠ¨ï¼Œæœç´¢ intel_rst_technology å¹¶ä¸‹è½½ï¼Œ https://global-download.acer.com/GDFiles/Driver/IRST/IRST_Intel_19.2.0.1003_W11x64_A.zip?acerid=637907037961464459Step1=Step2=Step3=SF314-71OS=ALLLC=enBC=ACERSC=PA_6 ä¹‹ååœ¨é‡è£…ç³»ç»Ÿæ—¶é€‰æ‹© load driver åŠ è½½è¯¥é©±åŠ¨å³å¯è¯†åˆ«ç¡¬ç›˜","categories":["1.å¹³å°ç³»ç»Ÿ","Windows"]},{"title":"RK3568ç³»ç»Ÿç§»æ¤åˆ†æ","path":"/2024/07/05/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-RK3568ç³»ç»Ÿç§»æ¤åˆ†æ/","content":"å†™å…¥ç¡¬ä»¶æ—¶é—´ hwclock-uwåœ¨ç°ä»£åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œå¤„ç†æ—¶é—´å’Œæ—¥æœŸçš„æ­£ç¡®æ€§è‡³å…³é‡è¦ã€‚è¿™ä¸€åŠŸèƒ½é€šå¸¸é€šè¿‡ç¡¬ä»¶æ—¶é’Ÿæ¥å®ç°ï¼Œå°¤å…¶æ˜¯åœ¨å¦‚ hwclock-uw è¿™æ ·çš„å°å‹å·¥å…·ä¸­ã€‚hwclock-uw çš„ä¸»è¦åŠŸèƒ½æ˜¯è¯»å–æˆ–è®¾ç½®ç¡¬ä»¶æ—¶é’Ÿçš„æ—¶é—´ï¼Œä»è€Œç¡®ä¿ç³»ç»Ÿæ—¶é—´çš„å‡†ç¡®æ— è¯¯ã€‚ 3568 çš„å†…æ ¸é…ç½®æ–‡ä»¶è·¯å¾„è¯¥ç³»ç»Ÿä½¿ç”¨å¤šç§é…ç½®æ–‡ä»¶æ¥ç®¡ç†æ„å»ºä¸è®¾å¤‡çš„è®¾ç½®ã€‚ä¸»è¦çš„é…ç½®æ–‡ä»¶è·¯å¾„å¦‚ä¸‹ï¼š ç¼–è¯‘é…ç½®æ–‡ä»¶ï¼šdevice/rockchip/common/build.shæ¿çº§é…ç½®æ–‡ä»¶ï¼šdevice/rockchip/ok3568/BoardConfig-ok3568.mkbuildroot é…ç½®æ–‡ä»¶ï¼šbuildroot/configs/OK3568_defconfiguboot é…ç½®æ–‡ä»¶ï¼šu-boot/configs/OK3568-C_defconfig ç¼–è¯‘é…ç½®æ–‡ä»¶é…ç½®æ–‡ä»¶ device/rockchip/common/build.sh æ˜¯æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹çš„æ ¸å¿ƒï¼Œå®šä¹‰äº†ç¼–è¯‘æ‰€éœ€çš„ç¯å¢ƒå˜é‡å’Œé€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸ªè„šæœ¬å¯èƒ½åŒ…å«å¯¹ç¼–è¯‘å·¥å…·é“¾çš„è®¾ç½®ã€åº“æ–‡ä»¶è·¯å¾„çš„å®šä¹‰ä»¥åŠå…¶ä»–å¿…è¦çš„å‚æ•°ï¼Œä½¿å¾—ç¼–è¯‘è¿‡ç¨‹é¡ºåˆ©è¿›è¡Œã€‚æ­¤å¤–ï¼ŒBoardConfig-ok3568.mk æ–‡ä»¶ä¸­ä¼šæ¶‰åŠåˆ°ç‰¹å®šäºæ¿å­çš„é…ç½®ï¼ŒåŒ…æ‹¬è®¾å¤‡ IDã€å†…å­˜é…ç½®å’Œå¤–è®¾çš„å¯ç”¨çŠ¶æ€ã€‚ æ–‡ä»¶ç³»ç»Ÿæ˜ å°„ä½ç½®åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œäº†è§£æ–‡ä»¶ç³»ç»Ÿçš„ç»“æ„è‡³å…³é‡è¦ã€‚ä»¥ä¸‹å›¾ç‰‡å±•ç¤ºäº†å…·ä½“çš„æ–‡ä»¶ç³»ç»Ÿæ˜ å°„ä½ç½®ï¼Œä¾¿äºå¼€å‘è€…å¿«é€Ÿå®šä½æ‰€éœ€æ–‡ä»¶ï¼š åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œåˆç†åˆ©ç”¨è¿™äº›é…ç½®æ–‡ä»¶å’Œæ–‡ä»¶ç³»ç»Ÿæ˜ å°„å¯ä»¥å¤§å¤§æé«˜å·¥ä½œçš„æ•ˆç‡ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿæ­£å¸¸è¿è¡Œå’Œè¿›è¡Œå„ç§æ“ä½œã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"éšæ‰‹è®°","path":"/2024/07/04/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-éšæ‰‹è®°/","content":"MIPI æ¥å£çš„å«ä¹‰ MIPI ä¸­çš„ DSI å’Œ CSI æ˜¾ç¤º DSI = display æ‘„åƒå¤´ CSI = camera è®¾å¤‡æ ‘ä¸­çš„æ ‡è¯†ç¬¦ è®¾å¤‡æ ‘ä¸­çš„ å¼•ç”¨èŠ‚ç‚¹ @ æŒ‡å®šè®¾å¤‡åœ°å€ ä¸²å£è®¾å¤‡æ ‘é…ç½® ä¸²å£çš„ç¡¬æµæ§å’Œè½¯æµæ§ linux æŸ¥çœ‹ç‰ˆæœ¬ lsb_release -a gpu ä¿¡æ¯åŠä½¿ç”¨ç‡æŸ¥çœ‹ clinfo æŸ¥çœ‹ gpu ä¿¡æ¯ æŸ¥çœ‹ gpu ä½¿ç”¨ç‡ cat sysdevicesffa30000.gpudvfs ä¿®æ”¹ IPvi /etc/network/interfaces.d/eno0 ä¿®æ”¹ç½‘å…³vi /etc/resolv.conf","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿"]},{"title":"å®æ—¶OSå’Œåˆ†æ—¶OS","path":"/2024/07/03/5-åµŒå…¥å¼å¼€å‘-å¼€å‘æ¿-RealTime-å®æ—¶OSå’Œåˆ†æ—¶OS/","content":"å®æ—¶æ“ä½œç³»ç»Ÿï¼ˆRTOSï¼‰RTOSï¼Œè‹±æ–‡å…¨ç§° Real Time Operating Systemï¼Œå³å®æ—¶æ“ä½œç³»ç»Ÿã€‚ å®æ—¶æ“ä½œç³»ç»Ÿå®šä¹‰å®æ—¶æ“ä½œç³»ç»Ÿï¼ˆRTOSï¼‰æ˜¯æŒ‡å½“å¤–ç•Œäº‹ä»¶æˆ–æ•°æ®äº§ç”Ÿæ—¶ï¼Œèƒ½å¤Ÿæ¥å—å¹¶ä»¥è¶³å¤Ÿå¿«çš„é€Ÿåº¦äºˆä»¥å¤„ç†ï¼Œå…¶å¤„ç†çš„ç»“æœåˆèƒ½åœ¨è§„å®šçš„æ—¶é—´ä¹‹å†…æ¥æ§åˆ¶ç”Ÿäº§è¿‡ç¨‹æˆ–å¯¹å¤„ç†ç³»ç»Ÿä½œå‡ºå¿«é€Ÿå“åº”ï¼Œå¹¶æ§åˆ¶æ‰€æœ‰å®æ—¶ä»»åŠ¡åè°ƒä¸€è‡´è¿è¡Œçš„æ“ä½œç³»ç»Ÿã€‚ å› è€Œï¼Œæä¾›åŠæ—¶å“åº”å’Œé«˜å¯é æ€§æ˜¯å…¶ä¸»è¦ç‰¹ç‚¹ã€‚ å®æ—¶æ“ä½œç³»ç»Ÿæœ‰ç¡¬å®æ—¶å’Œè½¯å®æ—¶ä¹‹åˆ†ï¼Œç¡¬å®æ—¶è¦æ±‚åœ¨è§„å®šçš„æ—¶é—´å†…å¿…é¡»å®Œæˆæ“ä½œï¼Œè¿™æ˜¯åœ¨æ“ä½œç³»ç»Ÿè®¾è®¡æ—¶ä¿è¯çš„ã€‚ è½¯å®æ—¶åˆ™åªè¦æŒ‰ç…§ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œå°½å¯èƒ½å¿«åœ°å®Œæˆæ“ä½œå³å¯ã€‚ä»¬é€šå¸¸ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿåœ¨ç»è¿‡ä¸€å®šæ”¹å˜ä¹‹åå°±å¯ä»¥å˜æˆå®æ—¶æ“ä½œç³»ç»Ÿã€‚ å®æ—¶æ“ä½œç³»ç»Ÿæ˜¯ä¿è¯åœ¨ä¸€å®šæ—¶é—´é™åˆ¶å†…å®Œæˆç‰¹å®šåŠŸèƒ½çš„æ“ä½œç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä¸ºç¡®ä¿ç”Ÿäº§çº¿ä¸Šçš„æœºå™¨äººèƒ½è·å–æŸä¸ªç‰©ä½“è€Œè®¾è®¡ä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚åœ¨â€ç¡¬â€å®æ—¶æ“ä½œç³»ç»Ÿä¸­ï¼Œå¦‚æœä¸èƒ½åœ¨å…è®¸æ—¶é—´å†…å®Œæˆä½¿ç‰©ä½“å¯è¾¾çš„è®¡ç®—ï¼Œæ“ä½œç³»ç»Ÿå°†å› é”™è¯¯ç»“æŸã€‚ åœ¨â€è½¯â€å®æ—¶æ“ä½œç³»ç»Ÿä¸­ï¼Œç”Ÿäº§çº¿ä»ç„¶èƒ½ç»§ç»­å·¥ä½œï¼Œä½†äº§å“çš„è¾“å‡ºä¼šå› äº§å“ä¸èƒ½åœ¨å…è®¸æ—¶é—´å†…åˆ°è¾¾è€Œå‡æ…¢ï¼Œè¿™ä½¿æœºå™¨äººæœ‰çŸ­æš‚çš„ä¸ç”Ÿäº§ç°è±¡ã€‚ä¸€äº›å®æ—¶æ“ä½œç³»ç»Ÿæ˜¯ä¸ºç‰¹å®šçš„åº”ç”¨è®¾è®¡çš„ï¼Œå¦ä¸€äº›æ˜¯é€šç”¨çš„ã€‚ ä¸€äº›é€šç”¨ç›®çš„çš„æ“ä½œç³»ç»Ÿç§°è‡ªå·±ä¸ºå®æ—¶æ“ä½œç³»ç»Ÿã€‚ä½†æŸç§ç¨‹åº¦ä¸Šï¼Œå¤§éƒ¨åˆ†é€šç”¨ç›®çš„çš„æ“ä½œç³»ç»Ÿï¼Œå¦‚å¾®è½¯çš„ Windows NT æˆ– IBM çš„ OS390 æœ‰å®æ—¶ç³»ç»Ÿçš„ç‰¹å¾ã€‚è¿™å°±æ˜¯è¯´ï¼Œå³ä½¿ä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸æ˜¯ä¸¥æ ¼çš„å®æ—¶ç³»ç»Ÿï¼Œå®ƒä»¬ä¹Ÿèƒ½è§£å†³ä¸€éƒ¨åˆ†å®æ—¶åº”ç”¨é—®é¢˜ã€‚ å®æ—¶æ“ä½œç³»ç»Ÿçš„ç‰¹å¾ å¤šä»»åŠ¡ æœ‰çº¿ç¨‹ä¼˜å…ˆçº§ å¤šç§ä¸­æ–­çº§åˆ« å°çš„åµŒå…¥å¼æ“ä½œç³»ç»Ÿç»å¸¸éœ€è¦å®æ—¶æ“ä½œç³»ç»Ÿï¼Œå†…æ ¸è¦æ»¡è¶³å®æ—¶æ“ä½œç³»ç»Ÿçš„è¦æ±‚ã€‚ å®æ—¶æ“ä½œç³»ç»Ÿçš„ç›¸å…³æ¦‚å¿µåŸºæœ¬æ¦‚å¿µ ä»£ç ä¸´ç•Œæ®µï¼šæŒ‡å¤„ç†æ—¶ä¸å¯åˆ†å‰²çš„ä»£ç ã€‚ä¸€æ—¦è¿™éƒ¨åˆ†ä»£ç å¼€å§‹æ‰§è¡Œåˆ™ä¸å…è®¸ä¸­æ–­æ‰“å…¥ï¼› èµ„æºï¼šä»»ä½•ä¸ºä»»åŠ¡æ‰€å ç”¨çš„å®ä½“ï¼› å…±äº«èµ„æºï¼šå¯ä»¥è¢«ä¸€ä¸ªä»¥ä¸Šä»»åŠ¡ä½¿ç”¨çš„èµ„æºï¼› ä»»åŠ¡ï¼šä¹Ÿç§°ä½œä¸€ä¸ªçº¿ç¨‹ï¼Œæ˜¯ä¸€ä¸ªç®€å•çš„ç¨‹åºã€‚æ¯ä¸ªä»»åŠ¡è¢«èµ‹äºˆä¸€å®šçš„ä¼˜å…ˆçº§ï¼Œæœ‰å®ƒè‡ªå·±çš„ä¸€å¥— CPU å¯„å­˜å™¨å’Œè‡ªå·±çš„æ ˆç©ºé—´ã€‚å…¸å‹åœ°ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æ˜¯ä¸€ä¸ªæ— é™çš„å¾ªç¯ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½å¤„åœ¨ä»¥ä¸‹äº”ä¸ªçŠ¶æ€ä¸‹ï¼šä¼‘çœ æ€ï¼Œå°±ç»ªæ€ï¼Œè¿è¡Œæ€ï¼ŒæŒ‚èµ·æ€ï¼Œè¢«ä¸­æ–­æ€ï¼› ä»»åŠ¡åˆ‡æ¢ï¼šå°†æ­£åœ¨è¿è¡Œä»»åŠ¡çš„å½“å‰çŠ¶æ€ï¼ˆCPU å¯„å­˜å™¨ä¸­çš„å…¨éƒ¨å†…å®¹ï¼‰ä¿å­˜åœ¨ä»»åŠ¡è‡ªå·±çš„æ ˆåŒºï¼Œç„¶åæŠŠä¸‹ä¸€ä¸ªå°†è¦è¿è¡Œçš„ä»»åŠ¡çš„å½“å‰çŠ¶æ€ä»è¯¥ä»»åŠ¡çš„æ ˆä¸­é‡æ–°è£…å…¥ CPU çš„å¯„å­˜å™¨ï¼Œå¹¶å¼€å§‹ä¸‹ä¸€ä¸ªä»»åŠ¡çš„è¿è¡Œï¼› å†…æ ¸ï¼šè´Ÿè´£ç®¡ç†å„ä¸ªä»»åŠ¡ï¼Œä¸ºæ¯ä¸ªä»»åŠ¡åˆ†é… CPU æ—¶é—´ï¼Œå¹¶è´Ÿè´£ä»»åŠ¡ä¹‹é—´é€šè®¯ã€‚åˆ†ä¸ºä¸å¯å‰¥å¤ºå‹å†…æ ¸äºå¯å‰¥å¤ºå‹å†…æ ¸ï¼› è°ƒåº¦ï¼šå†…æ ¸çš„ä¸»è¦èŒè´£ä¹‹ä¸€ï¼Œå†³å®šè½®åˆ°å“ªä¸ªä»»åŠ¡è¿è¡Œã€‚ä¸€èˆ¬åŸºäºä¼˜å…ˆçº§è°ƒåº¦æ³•ï¼› å…³äºä¼˜å…ˆçº§çš„é—®é¢˜ä»»åŠ¡ä¼˜å…ˆçº§ï¼šåˆ†ä¸ºä¼˜å…ˆçº§ä¸å¯æ”¹å˜çš„é™æ€ä¼˜å…ˆçº§å’Œä¼˜å…ˆçº§å¯æ”¹å˜çš„åŠ¨æ€ä¼˜å…ˆçº§ï¼› ä¼˜å…ˆçº§åè½¬ï¼šä¼˜å…ˆçº§åè½¬é—®é¢˜æ˜¯å®æ—¶ç³»ç»Ÿä¸­å‡ºç°æœ€å¤šçš„é—®é¢˜ã€‚å…±äº«èµ„æºçš„åˆ†é…å¯å¯¼è‡´ä¼˜å…ˆçº§ä½çš„ä»»åŠ¡å…ˆè¿è¡Œï¼Œä¼˜å…ˆçº§é«˜çš„ä»»åŠ¡åè¿è¡Œã€‚è§£å†³çš„åŠæ³•æ˜¯ä½¿ç”¨â€ä¼˜å…ˆçº§ç»§æ‰¿â€ç®—æ³•æ¥ä¸´æ—¶æ”¹å˜ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œä»¥éåˆ¶ä¼˜å…ˆçº§åè½¬ã€‚ äº’æ–¥è™½ç„¶å…±äº«æ•°æ®åŒºç®€åŒ–äº†ä»»åŠ¡ä¹‹é—´çš„ä¿¡æ¯äº¤æ¢ï¼Œä½†æ˜¯å¿…é¡»ä¿è¯æ¯ä¸ªä»»åŠ¡åœ¨å¤„ç†å…±äº«å…±äº«æ•°æ®æ—¶çš„æ’ä»–æ€§ã€‚ä½¿ä¹‹æ»¡è¶³äº’æ–¥æ¡ä»¶çš„ä¸€èˆ¬æ–¹æ³•æœ‰ï¼šå…³ä¸­æ–­ï¼Œä½¿ç”¨æµ‹è¯•å¹¶ç½®ä½æŒ‡ä»¤ï¼ˆTASï¼‰ï¼Œç¦æ­¢åšä»»åŠ¡åˆ‡æ¢ï¼Œåˆ©ç”¨ä¿¡å·é‡ã€‚ å› ä¸ºé‡‡ç”¨å®æ—¶æ“ä½œç³»ç»Ÿçš„æ„ä¹‰å°±åœ¨äºèƒ½å¤ŸåŠæ—¶å¤„ç†å„ç§çªå‘çš„äº‹ä»¶ï¼Œå³å¤„ç†å„ç§ä¸­æ–­ï¼Œå› è€Œè¡¡é‡åµŒå…¥å¼å®æ—¶æ“ä½œç³»ç»Ÿçš„æœ€ä¸»è¦ã€æœ€å…·æœ‰ä»£è¡¨æ€§çš„æ€§èƒ½æŒ‡æ ‡å‚æ•°æ— ç–‘åº”è¯¥æ˜¯ä¸­æ–­å“åº”æ—¶é—´äº†ã€‚ä¸­æ–­å“åº”æ—¶é—´é€šå¸¸è¢«å®šä¹‰ä¸ºï¼š ä¸­æ–­å“åº”æ—¶é—´ä¸­æ–­å»¶è¿Ÿæ—¶é—´+ä¿å­˜ CPU çŠ¶æ€çš„æ—¶é—´+è¯¥å†…æ ¸çš„ ISR è¿›å…¥å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚ ä¸­æ–­å»¶è¿Ÿæ—¶é—´MAX(å…³ä¸­æ–­çš„æœ€é•¿æ—¶é—´ï¼Œæœ€é•¿æŒ‡ä»¤æ—¶é—´) + å¼€å§‹æ‰§è¡Œ ISR çš„ç¬¬ä¸€æ¡æŒ‡ä»¤çš„æ—¶é—´ã€‚ åˆ†æ—¶æ“ä½œç³»ç»Ÿï¼ˆTSOSï¼‰TSOSï¼Œè‹±æ–‡å…¨ç§° Time-sharing Operating Systemï¼Œå³åˆ†æ—¶æ“ä½œç³»ç»Ÿã€‚ ä½¿ä¸€å°è®¡ç®—æœºåŒæ—¶ä¸ºå‡ ä¸ªã€å‡ åä¸ªç”šè‡³å‡ ç™¾ä¸ªç”¨æˆ·æœåŠ¡çš„ä¸€ç§æ“ä½œç³»ç»Ÿå«åˆ†æ—¶æ“ä½œç³»ç»Ÿã€‚æŠŠè®¡ç®—æœºä¸è®¸å¤šç»ˆç«¯ç”¨æˆ·è¿æ¥èµ·æ¥ï¼Œåˆ†æ—¶æ“ä½œç³»ç»Ÿå°†ç³»ç»Ÿå¤„ç†æœºæ—¶é—´ä¸å†…å­˜ç©ºé—´æŒ‰ä¸€å®šçš„æ—¶é—´é—´éš”ï¼Œè½®æµåœ°åˆ‡æ¢ç»™å„ç»ˆç«¯ç”¨æˆ·çš„ç¨‹åºä½¿ç”¨ã€‚ ç”±äºæ—¶é—´é—´éš”å¾ˆçŸ­ï¼Œæ¯ä¸ªç”¨æˆ·çš„æ„Ÿè§‰å°±åƒä»–ç‹¬å è®¡ç®—æœºä¸€æ ·ã€‚åˆ†æ—¶æ“ä½œç³»ç»Ÿçš„ç‰¹ç‚¹æ˜¯å¯æœ‰æ•ˆå¢åŠ èµ„æºçš„ä½¿ç”¨ç‡ã€‚ä¾‹å¦‚ UNIX ç³»ç»Ÿå°±é‡‡ç”¨å‰¥å¤ºå¼åŠ¨æ€ä¼˜å…ˆçš„ CPU è°ƒåº¦ï¼Œæœ‰åŠ›åœ°æ”¯æŒåˆ†æ—¶æ“ä½œã€‚ äº§ç”Ÿåˆ†æ—¶ç³»ç»Ÿæ˜¯ä¸ºäº†æ»¡è¶³ç”¨æˆ·éœ€æ±‚æ‰€å½¢æˆçš„ä¸€ç§æ–°å‹ OS ã€‚å®ƒä¸å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿä¹‹é—´ï¼Œæœ‰ç€æˆªç„¶ä¸åŒçš„æ€§èƒ½å·®åˆ«ã€‚ç”¨æˆ·çš„éœ€æ±‚å…·ä½“è¡¨ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢: äººâ€”æœºäº¤äº’ å…±äº«ä¸»æœº ä¾¿äºç”¨æˆ·ä¸Šæœº åˆ†æ—¶ç³»ç»Ÿçš„åŸºæœ¬æ€æƒ³æ—¶é—´ç‰‡ï¼šæ˜¯æŠŠè®¡ç®—æœºçš„ç³»ç»Ÿèµ„æºï¼ˆå°¤å…¶æ˜¯ CPU æ—¶é—´ï¼‰è¿›è¡Œæ—¶é—´ä¸Šçš„åˆ†å‰²ï¼Œæ¯ä¸ªæ—¶é—´æ®µç§°ä¸ºä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œæ¯ä¸ªç”¨æˆ·ä¾æ¬¡è½®æµä½¿ç”¨æ—¶é—´ç‰‡ã€‚ åˆ†æ—¶æŠ€æœ¯ï¼šæŠŠå¤„ç†æœºçš„è¿è¡Œæ—¶é—´åˆ†ä¸ºå¾ˆçŸ­çš„æ—¶é—´ç‰‡ï¼ŒæŒ‰æ—¶é—´ç‰‡è½®æµæŠŠå¤„ç†æœºåˆ†ç»™å„è”æœºä½œä¸šä½¿ç”¨ã€‚ åˆ†æ—¶æ“ä½œç³»ç»Ÿï¼šæ˜¯ä¸€ç§è”æœºçš„å¤šç”¨æˆ·äº¤äº’å¼çš„æ“ä½œç³»ç»Ÿã€‚ä¸€èˆ¬é‡‡ç”¨æ—¶é—´ç‰‡è½®è½¬çš„æ–¹å¼ä½¿ä¸€å°è®¡ç®—æœºä¸ºå¤šä¸ªç»ˆç«¯æœåŠ¡ã€‚å¯¹æ¯ä¸ªç”¨æˆ·èƒ½ä¿è¯è¶³å¤Ÿå¿«çš„å“åº”æ—¶é—´ï¼Œå¹¶æä¾›äº¤äº’ä¼šè¯èƒ½åŠ›ã€‚ è®¾è®¡ç›®æ ‡ï¼šå¯¹ç”¨æˆ·çš„è¯·æ±‚åŠæ—¶å“åº”ï¼Œå¹¶åœ¨å¯èƒ½æ¡ä»¶ä¸‹å°½é‡æé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ã€‚ é€‚åˆåŠå…¬è‡ªåŠ¨åŒ–ã€æ•™å­¦åŠäº‹åŠ¡å¤„ç†ç­‰è¦æ±‚äººæœºä¼šè¯çš„åœºåˆã€‚ å·¥ä½œæ–¹å¼ä¸€å°ä¸»æœºè¿æ¥äº†è‹¥å¹²ä¸ªç»ˆç«¯ï¼›æ¯ä¸ªç»ˆç«¯æœ‰ä¸€ä¸ªç”¨æˆ·åœ¨ä½¿ç”¨ï¼›äº¤äº’å¼åœ°å‘ç³»ç»Ÿæå‡ºå‘½ä»¤è¯·æ±‚ï¼›ç³»ç»Ÿæ¥å—æ¯ä¸ªç”¨æˆ·çš„å‘½ä»¤ï¼›é‡‡ç”¨æ—¶é—´ç‰‡è½®è½¬æ–¹å¼å¤„ç†æœåŠ¡è¯·æ±‚ï¼›å¹¶é€šè¿‡äº¤äº’æ–¹å¼åœ¨ç»ˆç«¯ä¸Šå‘ç”¨æˆ·æ˜¾ç¤ºç»“æœï¼›ç”¨æˆ·æ ¹æ®ä¸Šæ­¥ç»“æœå‘å‡ºä¸‹é“å‘½ä»¤ åˆ†æ—¶ç³»ç»Ÿå®ç°ä¸­çš„å…³é”®é—®é¢˜ï¼šåŠæ—¶æ¥æ”¶ã€‚åŠæ—¶å¤„ç†ã€‚ ç‰¹å¾ äº¤äº’æ€§ï¼šç”¨æˆ·ä¸ç³»ç»Ÿè¿›è¡Œäººæœºå¯¹è¯ã€‚ å¤šè·¯æ€§ï¼šå¤šç”¨æˆ·åŒæ—¶åœ¨å„è‡ªç»ˆç«¯ä¸Šä½¿ç”¨åŒä¸€ CPUã€‚ ç‹¬ç«‹æ€§ï¼šç”¨æˆ·å¯å½¼æ­¤ç‹¬ç«‹æ“ä½œï¼Œäº’ä¸å¹²æ‰°ï¼Œäº’ä¸æ··æ·†ã€‚ åŠæ—¶æ€§ï¼šç”¨æˆ·åœ¨çŸ­æ—¶é—´å†…å¯å¾—åˆ°ç³»ç»Ÿçš„åŠæ—¶å›ç­”ã€‚ å½±å“å“åº”æ—¶é—´çš„å› ç´ ï¼šç»ˆç«¯æ•°ç›®å¤šå°‘ã€æ—¶é—´ç‰‡çš„å¤§å°ã€ä¿¡æ¯äº¤æ¢é‡ã€ä¿¡æ¯äº¤æ¢é€Ÿåº¦ã€‚ åŒºåˆ«RTOS å’Œ TSOS å„æœ‰å„çš„ç‰¹ç‚¹ï¼ŒRTOS ä¸€èˆ¬ç”¨äºç›¸å¯¹ä½é€Ÿçš„ MCUï¼Œæ¯”å¦‚è¿åŠ¨æ§åˆ¶ç±»ã€æŒ‰é”®è¾“å…¥ç­‰åŠ¨ä½œè¦æ±‚å®æ—¶å¤„ç†çš„ç³»ç»Ÿï¼Œä¸€èˆ¬è¦æ±‚ ms çº§ï¼Œç”šè‡³ us çº§å“åº”ã€‚ åˆ†æ—¶ï¼šç°åœ¨æµè¡Œçš„ PCï¼ŒæœåŠ¡å™¨éƒ½æ˜¯é‡‡ç”¨è¿™ç§è¿è¡Œæ¨¡å¼ï¼Œå³æŠŠ CPU çš„è¿è¡Œåˆ†æˆè‹¥å¹²æ—¶é—´ç‰‡åˆ†åˆ«å¤„ç†ä¸åŒçš„è¿ç®—è¯·æ±‚ã€‚ å®æ—¶ï¼šä¸€èˆ¬ç”¨äºå•ç‰‡æœºä¸Šï¼Œæ¯”å¦‚ç”µæ¢¯çš„ä¸Šä¸‹æ§åˆ¶ä¸­ï¼Œå¯¹äºæŒ‰é”®ç­‰åŠ¨ä½œè¦æ±‚è¿›è¡Œå®æ—¶å¤„ç†ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","å¼€å‘æ¿","RealTime"]},{"title":"æ–‡ä»¶ç³»ç»Ÿ","path":"/2024/07/02/1-å¹³å°ç³»ç»Ÿ-å¹³å°ç›¸å…³-æ–‡ä»¶ç³»ç»Ÿ/","content":"æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨é™åˆ¶FAT32 æ–‡ä»¶ç³»ç»Ÿå¯¹å•ä¸ªæ–‡ä»¶çš„å¤§å°æœ‰é™åˆ¶ã€‚å…·ä½“æ¥è¯´ï¼ŒFAT32 æ–‡ä»¶ç³»ç»Ÿæ”¯æŒçš„æœ€å¤§æ–‡ä»¶å¤§å°æ˜¯ 4 GB (gigabytes)ã€‚è¿™æ˜¯å› ä¸º FAT32 ä½¿ç”¨ 32 ä½å­—æ®µæ¥è®°å½•æ–‡ä»¶å¤§å°ï¼Œè€Œ 32 ä½çš„æœ€å¤§å€¼æ˜¯ 4,294,967,295 å­—èŠ‚ï¼Œçº¦ç­‰äº 4 GBã€‚ å¦‚æœéœ€è¦å­˜å‚¨è¶…è¿‡ 4 GB çš„å•ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–æ–‡ä»¶ç³»ç»Ÿï¼Œä¾‹å¦‚ï¼š exFATï¼šæ”¯æŒéå¸¸å¤§çš„æ–‡ä»¶ï¼Œé€‚ç”¨äºå¤§å®¹é‡å­˜å‚¨è®¾å¤‡ï¼Œä¾‹å¦‚ USB é—ªå­˜é©±åŠ¨å™¨å’Œ SD å¡ã€‚ NTFSï¼šWindows ç³»ç»Ÿå¸¸ç”¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ”¯æŒéå¸¸å¤§çš„æ–‡ä»¶å’Œåˆ†åŒºï¼Œé€‚åˆç¡¬ç›˜å’Œå›ºæ€ç¡¬ç›˜ã€‚ ext4ï¼šLinux ç³»ç»Ÿå¸¸ç”¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ”¯æŒéå¸¸å¤§çš„æ–‡ä»¶å’Œåˆ†åŒºï¼Œé€‚åˆç¡¬ç›˜å’Œå›ºæ€ç¡¬ç›˜ã€‚ æ–‡ä»¶ç³»ç»Ÿé€‰æ‹©å»ºè®® USB é—ªå­˜é©±åŠ¨å™¨SD å¡ï¼šå¦‚æœéœ€è¦å…¼å®¹æ€§ä¸”æ–‡ä»¶å¤§äº 4 GBï¼Œå»ºè®®ä½¿ç”¨ exFATã€‚ Windows ç³»ç»Ÿç¡¬ç›˜ï¼šNTFS æ˜¯é»˜è®¤ä¸”æœ€é€‚åˆçš„é€‰æ‹©ã€‚ Linux ç³»ç»Ÿç¡¬ç›˜ï¼šext4 æ˜¯é»˜è®¤ä¸”æœ€é€‚åˆçš„é€‰æ‹©ã€‚ è½¬æ¢æ–‡ä»¶ç³»ç»Ÿçš„æ­¥éª¤å¦‚æœéœ€è¦å°† FAT32 æ–‡ä»¶ç³»ç»Ÿè½¬æ¢ä¸º exFAT æˆ– NTFSï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°ï¼š å°† FAT32 è½¬æ¢ä¸º exFATï¼ˆåœ¨ Windows ä¸­ï¼‰ å¤‡ä»½æ•°æ®ï¼šè½¬æ¢æ–‡ä»¶ç³»ç»Ÿä¼šæ ¼å¼åŒ–é©±åŠ¨å™¨ï¼Œå› æ­¤è¯·å…ˆå¤‡ä»½æ‰€æœ‰æ•°æ®ã€‚ æ ¼å¼åŒ–ä¸º exFATï¼š æ‰“å¼€â€æ–‡ä»¶èµ„æºç®¡ç†å™¨â€ã€‚ å³é”®ç‚¹å‡»éœ€è¦è½¬æ¢çš„é©±åŠ¨å™¨ã€‚ é€‰æ‹©â€æ ¼å¼åŒ–â€ã€‚ åœ¨æ–‡ä»¶ç³»ç»Ÿé€‰é¡¹ä¸­é€‰æ‹©â€exFATâ€ã€‚ ç‚¹å‡»â€å¼€å§‹â€ã€‚ å°† FAT32 è½¬æ¢ä¸º NTFSï¼ˆåœ¨ Windows ä¸­ï¼‰ å¤‡ä»½æ•°æ®ï¼šè™½ç„¶æœ‰éç ´åæ€§è½¬æ¢æ–¹æ³•ï¼Œä½†ä»å»ºè®®å¤‡ä»½æ•°æ®ä»¥é˜²ä¸‡ä¸€ã€‚ éç ´åæ€§è½¬æ¢ï¼ˆä¸ä¼šä¸¢å¤±æ•°æ®ï¼‰ï¼šconvert X: fs:ntfsã€‚å…¶ä¸­ X: æ˜¯è¦è½¬æ¢çš„é©±åŠ¨å™¨å·ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","å¹³å°ç›¸å…³"]},{"title":"è®¡ç®—æœºæ¦‚å¿µ","path":"/2024/07/01/1-å¹³å°ç³»ç»Ÿ-å¹³å°ç›¸å…³-è®¡ç®—æœºæ¦‚å¿µ/","content":"å†¯Â·è¯ºä¾æ›¼ç»“æ„è®¡ç®—æœºçš„åŸç†æ‰€æœ‰çš„è®¡ç®—æœºè¯­è¨€ï¼Œä¸ç®¡æ˜¯ Java, Python, Go, C, C++, PHPâ€¦â€¦ ï¼Œ æœ€ç»ˆéƒ½è¦å˜æˆåŸºæœ¬çš„äºŒè¿›åˆ¶æŒ‡ä»¤ï¼Œåœ¨å†¯Â·è¯ºä¾æ›¼ç»“æ„è®¡ç®—æœºä¸ŠæŒ‰è§„çŸ©æ‰§è¡Œã€‚ äº†è§£ CPU å’Œå†…å­˜æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼š CPU ä»å†…å­˜å–å‡ºæŒ‡ä»¤ï¼Œè¿›è¡Œè¯‘ç å’Œæ‰§è¡Œï¼Œæ‰§è¡Œæ—¶ä»å†…å­˜ä¸­å–å‡ºæ•°æ®æ”¾åˆ°å¯„å­˜å™¨ä¸­ï¼Œ è¿›è¡Œè®¡ç®—ï¼Œ ç„¶åæŠŠç»“æœå†™å›åˆ°å†…å­˜ã€‚å¦‚æœæ˜¯è·³è½¬æŒ‡ä»¤ï¼Œ CPU åˆ™å–å‡ºè·³è½¬ç›®çš„åœ°çš„æŒ‡ä»¤ç»§ç»­æ‰§è¡Œã€‚åŸºæœ¬çš„æŒ‡ä»¤ç»„æˆäº†é¡ºåºã€å¾ªç¯ã€åˆ†æ”¯ç­‰åŸºæœ¬çš„ç¨‹åºç»“æ„ï¼Œå½¢æˆäº†æ›´ä¸ºå¼ºå¤§çš„ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€ã€‚ CPU å’Œå†…å­˜ã€ç¡¬ç›˜ç­‰è®¾å¤‡çš„é€Ÿåº¦ä¸åŒ¹é…ï¼Œæ˜¯å†¯Â·è¯ºä¾æ›¼ç»“æ„è®¡ç®—æœºçš„ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç§‘å­¦å®¶ä»¬ç»å°½è„‘æ±ï¼Œæƒ³å°½äº†åŠæ³•ï¼Œ åˆå¼•å‡ºäº†ä¸€å †æ¦‚å¿µï¼š ç¼“å­˜ï¼ŒDMAï¼Œ åŒæ­¥ï¼Œå¼‚æ­¥ï¼Œé˜»å¡â€¦. è¿›ç¨‹å’Œçº¿ç¨‹æ‰€æœ‰çš„ç¨‹åºè¦ä¹ˆä¼šæˆä¸ºä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹å»æ‰§è¡Œï¼Œè¦ä¹ˆæ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ ã€‚å‡ ä¹æ‰€æœ‰çš„ç¼–ç¨‹è¯­è¨€éƒ½ä¼šæ¶‰åŠåˆ°å¯¹å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹ç¼–ç¨‹çš„æ”¯æŒï¼Œ ç‰¹åˆ«æ˜¯å¤šçº¿ç¨‹çš„å¹¶å‘ç¼–ç¨‹ã€‚ è¿›ç¨‹æ˜¯å¯¹ä¸€ä¸ªè¿è¡Œä¸­çš„ç¨‹åºçš„æŠ½è±¡ï¼Œæ²¡æœ‰è¿™ä¸ªæ¦‚å¿µã€‚å¯¹äº CPU æ¥è®²ï¼Œ åªæ˜¯ä»æŸä¸ªåœ°æ–¹å–æŒ‡ä»¤ï¼Œè¯‘ç æ‰§è¡Œï¼Œå®ƒä¸ä¼šæ„è¯†åˆ°æ‰§è¡Œçš„ç¨‹åºå·²ç»å‘ç”Ÿäº†åˆ‡æ¢ï¼Œå¦å¤–ä¸€ä¸ªç¨‹åºï¼ˆå‡†ç¡®åœ°è®²å«è¿›ç¨‹ï¼‰å·²ç»æˆåŠŸåœ°æŠ¢ç­å¤ºæƒã€‚ æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªè¢«æ“ä½œç³»ç»Ÿç»´æŠ¤çš„è¿›ç¨‹æ§åˆ¶å—ï¼Œ é‡Œè¾¹ä¿å­˜äº†è¿™ä¸ªè¿›ç¨‹åœ¨è¿è¡Œæ—¶çš„é‡è¦ä¿¡æ¯ï¼Œæ˜¯è¿›ç¨‹èƒ½æ¥å›åˆ‡æ¢çš„é‡è¦ä¿è¯ã€‚è€Œçº¿ç¨‹åˆ™å¯„å±…äºè¿›ç¨‹ä¹‹å†… ï¼Œ å…±äº«è¿›ç¨‹æä¾›ç¦åˆ©ï¼ˆä»£ç å’Œæ•°æ®ï¼‰çš„åŒæ—¶ï¼Œ è¿˜æ‹¥æœ‰è‡ªå·±çš„ä¸€äº©ä¸‰åˆ†åœ°ã€‚ çº¿ç¨‹çš„å‡ºç°ï¼Œæå‡äº†ç³»ç»Ÿçš„æ€§èƒ½ã€ååé‡å’Œå“åº”æ€§ã€‚ ä½†æ˜¯å¤šè¿›ç¨‹å¤šçº¿ç¨‹ç¼–ç¨‹ä¹Ÿå¸¦æ¥äº†ä¸€ç³»åˆ—é—®é¢˜ï¼š åŒæ­¥ï¼Œé€šä¿¡ï¼Œé”ï¼Œ æ­»é”ã€‚ã€‚ã€‚ è™šæ‹Ÿå†…å­˜è™šæ‹Ÿå†…å­˜çš„é‡è¦ä½œç”¨å°±æ˜¯ç»™å„è¿›ç¨‹æä¾›ä¸€ä¸ªç”±è™šæ‹Ÿåœ°å€ç»„æˆçš„ç‹¬ç«‹åŒºåŸŸï¼Œæ¯ä¸ªè¿›ç¨‹åœ¨è‡ªå·±çš„ç‹¬ç«‹åŒºåŸŸé‡Œæ‰§è¡Œï¼Œäº’ä¸å½±å“ã€‚æŒ‡ä»¤å¿…é¡»åœ¨ç‰©ç†å†…å­˜ä¸­æ‰èƒ½è¢«æ‰§è¡Œï¼Œ æ“ä½œç³»ç»ŸæŠŠæ¯ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°å®é™…åœ°å€ä¸Šå»ï¼Œå…¶ä¸­å®ç°åˆ†æ®µï¼Œåˆ†é¡µï¼Œé¡µè¡¨ï¼ŒåŠ¨ç”¨ CPU çš„ TLB æ¥åŠ é€Ÿã€‚ ç¨‹åºå¹¶ä¸æ˜¯ä¸€ä¸‹å­å…¨éƒ¨è£…è½½åˆ°å†…å­˜çš„ï¼Œ è€Œæ˜¯ç”¨åˆ°çš„æ—¶å€™æ‰è¿›è¡Œè£…è½½ã€‚ ç½‘ç»œçš„æ ¸å¿ƒæ¦‚å¿µæ ¸å¿ƒæ¦‚å¿µæ˜¯ï¼š åˆ†ç»„äº¤æ¢ï¼Œ TCPIP å‚è€ƒæ¨¡å‹ï¼Œ socket , http(s)ã€‚ ç½‘ç»œæ•°æ®æ˜¯è¢«åˆ‡åˆ†æˆé€‚åˆç½‘ç»œä¼ è¾“çš„å°å—ï¼Œç»™æ¯ä¸ªå°å—ç¼–ä¸Šå·ï¼Œ æ¯ä¸ªå°å—éƒ½ç‹¬ç«‹åœ°èµ°ç›¸åŒç”šè‡³ä¸åŒçš„ç½‘ç»œè·¯å¾„ï¼Œ åˆ°è¾¾è¿™é‡Œï¼Œé‡æ–°æ’åºï¼Œç»„åˆï¼Œç„¶åæ‰å±•ç¤ºç»™ï¼Œ è¿™å°±æ˜¯åˆ†ç»„äº¤æ¢ã€‚ä½¿ç”¨åˆ†ç»„äº¤æ¢å¯ä»¥å……åˆ†çš„åˆ©ç”¨ç½‘ç»œå¸¦å®½ï¼š åœ¨ä¸ä½¿ç”¨çš„é—´éš™ï¼Œåˆ«äººä¹Ÿå¯ä»¥åˆ©ç”¨ã€‚ ä½†æ˜¯ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„é—®é¢˜å°±æ˜¯åˆ†ç»„æ•°æ®ä¸¢å¤±äº†æ€ä¹ˆåŠï¼Ÿ å¦‚ä½•æ£€æµ‹ï¼Œ æ€ä¹ˆé‡å‘ï¼Œå¦‚ä½•ç¼“å­˜å·²ç»æ”¶åˆ°åˆ†ç»„æ•°æ®ç­‰ä¸€ç³»åˆ—çƒ¦äººçš„é—®é¢˜æ¥è¸µè€Œæ¥ã€‚ è¿™å°±æ˜¯ TCP è¦å¹²çš„äº‹æƒ…ã€‚å¦‚æœèƒ½ä½“ä¼šåˆ° TCP æ˜¯åœ¨ç«¯ç³»ç»Ÿå®ç°çš„ï¼Œä¸­é—´èŠ‚ç‚¹ä¸€æ— æ‰€çŸ¥ï¼Œæƒ³å°± Get åˆ°äº†åˆ†ç»„äº¤æ¢å’Œåˆ†å±‚çš„çœŸè°›ã€‚ TCPIP å‚è€ƒæ¨¡å‹å®šä¹‰äº† 5 å±‚ï¼š åº”ç”¨å±‚ï¼Œä¼ è¾“å±‚ï¼Œç½‘ç»œå±‚ï¼Œé“¾è·¯å±‚ï¼Œç‰©ç†å±‚ã€‚ä¸€å®šå¾—ç†è§£æ‰€è°“çš„åˆ†å±‚åªä¸è¿‡æ˜¯æŠŠçš„æ•°æ®å±‚å±‚åŒ…è£…è€Œå·²ï¼Œåœ¨ä¼ è¾“çš„è¿‡ç¨‹å±‚ä¸­æ¯åˆ°ä¸€ä¸ªèŠ‚ç‚¹éƒ½ä¼šæ‹†å¼€æŸä¸€å±‚çš„åŒ…è£…ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æ•°æ®ï¼Œ ç„¶åå†æ¬¡åŒ…è£…ï¼Œè½¬å‘å‡ºå»ï¼Œç›´åˆ°ç»ˆç‚¹ã€‚ Hash å’Œ RSAå¦‚æœè¯´ Https æ˜¯ç½‘ç»œå®‰å…¨é€šä¿¡çš„ä¸€å¤§åŸºçŸ³ï¼Œ é‚£ Hash å’Œ RSA åˆ™æ˜¯åŸºçŸ³çš„åŸºçŸ³ã€‚ RSA æœ‰ä¸€å¯¹é’¥åŒ™ï¼Œ ä¸€ä¸ªæ˜¯ç§æœ‰çš„ã€ä¿å¯†çš„ï¼Œ å¦å¤–ä¸€ä¸ªæ˜¯å…¬æœ‰çš„ã€‚RSA çš„æ¦‚å¿µå¾ˆç®€å•ï¼Œ ä½†æ˜¯ä¸ºäº†å®ç°çœŸæ­£çš„å®‰å…¨æ¶ˆæ¯ä¼ è¾“ï¼Œä½œä¸ºç¬¬ä¸€æ­¥å¿…é¡»å¾—æœ‰æ•°æ®ç­¾ååšä¿è¯ï¼Œéœ€è¦ç†è§£å¦‚ä½•å¯¹æ¶ˆæ¯ç”¨ Hash å½¢æˆæ‘˜è¦ï¼Œç„¶åç”¨ç§é’¥ç­¾åï¼Œåˆæ˜¯å¦‚ä½•éªŒè¯è¿™ä¸ªç­¾åçš„ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","å¹³å°ç›¸å…³"]},{"title":"0ä¸ªéƒ¨ç½²æœåŠ¡å™¨çš„åŠŸèƒ½","path":"/2024/06/28/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-0ä¸ªéƒ¨ç½²æœåŠ¡å™¨çš„åŠŸèƒ½/","content":"å®Œæˆå¯¹ Alist çš„å¯åŠ¨ä¸å…³é—­ å®Œæˆå¯¹ photoprism çš„å¯åŠ¨ä¸å…³é—­ å®Œæˆ frp çš„ç©¿é€ å®Œæˆ devtunnel çš„ç©¿é€ å®Œæˆæ›´æ–° devtunnel å¹¶è·å–æœ€æ–°çš„ IP åœ°å€å¯¼å…¥ photo.html å®Œæˆä»“åº“çš„æ›´æ–° ã€âˆšã€‘80 ç«¯å£ï¼šTVBOX è®¢é˜… 9050ï¼šæœ¬åœ°Hexo åšå®¢éƒ¨ç½²ç«¯å£ åšå®¢Hexoéƒ¨ç½² ã€âˆšã€‘9080ï¼šFRP æ˜ å°„å¯¹æ¥ç«¯å£ å†…ç½‘ç©¿é€æ–¹æ¡ˆ ã€âˆšã€‘9081ï¼šFRP çš„ DashBoardå†…ç½‘ç©¿é€æ–¹æ¡ˆ ã€âˆšã€‘9082: Docker ç®¡ç†é¢æ¿ Portainer ã€âˆšã€‘9083 Qexo ç®¡ç†é¡µé¢ Qexoæœ¬åœ°éƒ¨ç½² ã€âˆšã€‘9084ï¼šAlist æ˜ å°„ç«¯å£ Alistç½‘ç›˜æ­å»º ã€âˆšã€‘9085ï¼šPDF å¤„ç†å·¥å…·æ­å»ºåˆ°äº‘æœåŠ¡å™¨ ã€âˆšã€‘9086ï¼šDaily Hot æ¯æ—¥çƒ­ç‚¹9071API ã€âˆšã€‘9090ï¼šSSH ç«¯å£ ã€âˆšã€‘9091ï¼š3D æ‰“å°æœºçš„ Mainsail ç«¯å£ 3Dæ‰“å°æœºç¯å¢ƒé…ç½® 9092ï¼šOK3568portainer 9093ï¼š PhotoprismPhotoprismç…§ç‰‡å¤‡ä»½æ–¹æ¡ˆ 9094ï¼šPhotoprism_ çš„ 9082ï¼šNAS æ˜ å°„ç«¯å£ NASç›¸å…³é…ç½® 9090ï¼š1Panel æœåŠ¡å™¨è¿ç»´ç®¡ç†é¢æ¿ 9091: GitServer markdown è½¯ä»¶å’Œ wordpress è”åŠ¨ wordpress éƒ¨ç½²åœ¨äº‘æœåŠ¡å™¨ï¼Œåˆ©ç”¨ docker éƒ¨ç½² äº‘æœåŠ¡å™¨éƒ¨ç½² git äº‘æœåŠ¡å™¨éƒ¨ç½²æ•°æ®ä»“åº“ äº‘æœåŠ¡å™¨éƒ¨ç½² 3D æ‰“å°æœºæœåŠ¡ äº‘æœåŠ¡å™¨éƒ¨ç½²å¾®ä¿¡å…¬ä¼—å·å¯¹æ¥ï¼Œchatgpt å¯¹è¯ äº‘æœåŠ¡å™¨éƒ¨ç½²å¾®ä¿¡èŠå¤©ï¼Œå¯¹è¯è½¬å‘ å†™ä¸€ä¸ª python è„šæœ¬æ¥çˆ¬å–","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨"]},{"title":"DailyHotéƒ¨ç½²","path":"/2024/06/27/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-å·¥å…·-DailyHotéƒ¨ç½²/","content":"å‰ç«¯é¡¹ç›®åœ°å€ https://github.com/imsyy/DailyHot API é¡¹ç›®åœ°å€ https://github.com/imsyy/DailyHotApi API éƒ¨ç½²clone é¡¹ç›®åè¿›å…¥é¡¹ç›®ç›®å½•æ‰§è¡Œ docker-compose.yml æ–‡ä»¶ docker compose up -d#å¦‚æœå¡åœ¨npm install -g pnpmåˆ™é€šè¿‡docker run å‘½ä»¤è¡Œå¯åŠ¨docker run -p 6688:6688 -d imsyy/dailyhot-api:latest é¡¹ç›®å¯åŠ¨ï¼Œè®¿é—® http://localhost:6688 å‰ç«¯éƒ¨ç½²clone é¡¹ç›®åè¿›å…¥ç›®å½•æ‰§è¡Œ npm install ä¿®æ”¹.env æ–‡ä»¶ä¸­çš„ API åœ°å€ä¸ºè‡ªå·±éƒ¨ç½²çš„ API åœ°å€ ä¿®æ”¹ vite.config.js ä¸­çš„ port ä¸ºè‡ªå·±æƒ³ä½¿ç”¨çš„ç«¯å£ è¿è¡Œ npm run dev -- --host æ‰“åŒ… npm run build æ‰“åŒ…ä¹‹åç”Ÿæˆçš„é¡µé¢åœ¨å½“å‰ç›®å½•ä¸‹çš„ dist æ–‡ä»¶å¤¹ä¸­ï¼Œæ‹·è´åˆ°varwww ç›®å½•ä¸‹ï¼Œåœ¨ nginx ä¸­å¢åŠ é…ç½® server listen 9086 default_server; listen [::]:9086 default_server; root /var/www/dist; server_name _; location / index index.html; ä¹‹åé‡å¯ nginx æœåŠ¡ sudo systemctl restart nginx.service è®¿é—® IP:9086 å³å¯è®¿é—®","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨","å·¥å…·"]},{"title":"Photoprismç…§ç‰‡å¤‡ä»½æ–¹æ¡ˆ","path":"/2024/06/26/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-å·¥å…·-Photoprismç…§ç‰‡å¤‡ä»½æ–¹æ¡ˆ/","content":"PhotoPrism é…ç½®å®˜æ–¹è„šæœ¬é€‰æ‹©ä¸‹è½½å®˜æ–¹è„šæœ¬ #Linux wget https://dl.photoprism.app/docker/docker-compose.yml#Windowscurl.exe -o docker-compose.yml https://dl.photoprism.app/docker/windows/docker-compose.yml è‡ªå®šä¹‰è¿›è¡Œè‡ªå®šä¹‰é€‰é¡¹ï¼Œé»˜è®¤éœ€è¦ä¾èµ–æ•°æ®åº“ å¯ä»¥é€‰æ‹©ä¸ä¾èµ–æ•°æ®åº“é•œåƒ è‡ªå®šä¹‰è®¿é—®ç«¯å£ è‡ªå®šä¹‰ç›¸å†Œæ–‡ä»¶æ˜ å°„åœ°å€ï¼Œå…¶ä¸­photoprismimport ä¸ºéœ€è¦å¯¼å…¥çš„ç…§ç‰‡åœ°å€ï¼Œphotoprismoriginals ä¸ºå·²ç»å¯¼å…¥çš„ç…§ç‰‡åœ°å€ services: photoprism: image: photoprism/photoprism:latest restart: unless-stopped stop_grace_period: 10s security_opt: - seccomp:unconfined - apparmor:unconfined ports: - 5246:2342 environment: PHOTOPRISM_ADMIN_USER: username # admin login username PHOTOPRISM_ADMIN_PASSWORD: password # initial admin password (8-72 characters) PHOTOPRISM_AUTH_MODE: password # authentication mode (public, password) PHOTOPRISM_SITE_URL: http://localhost:2342/ # server URL in the format http(s)://domain.name(:port)/(path) PHOTOPRISM_DISABLE_TLS: false # disables HTTPS/TLS even if the site URL starts with https:// and a certificate is available PHOTOPRISM_DEFAULT_TLS: true # defaults to a self-signed HTTPS/TLS certificate if no other certificate is available PHOTOPRISM_ORIGINALS_LIMIT: 5000 # file size limit for originals in MB (increase for high-res video) PHOTOPRISM_HTTP_COMPRESSION: gzip # improves transfer speed and bandwidth utilization (none or gzip) PHOTOPRISM_DEBUG: false # run in debug mode, shows additional log messages PHOTOPRISM_READONLY: false # do not modify originals folder; disables import, upload, and delete PHOTOPRISM_EXPERIMENTAL: false # enables experimental features PHOTOPRISM_DISABLE_CHOWN: false # disables updating storage permissions via chmod and chown on startup PHOTOPRISM_DISABLE_WEBDAV: false # disables built-in WebDAV server PHOTOPRISM_DISABLE_SETTINGS: false # disables settings UI and API PHOTOPRISM_DISABLE_TENSORFLOW: false # disables all features depending on TensorFlow PHOTOPRISM_DISABLE_FACES: false # disables face detection and recognition (requires TensorFlow) PHOTOPRISM_DISABLE_CLASSIFICATION: false # disables image classification (requires TensorFlow) PHOTOPRISM_DISABLE_VECTORS: false # disables vector graphics support PHOTOPRISM_DISABLE_RAW: false # disables indexing and conversion of RAW images PHOTOPRISM_RAW_PRESETS: false # enables applying user presets when converting RAW images (reduces performance) PHOTOPRISM_SIDECAR_YAML: true # creates YAML sidecar files to back up picture metadata PHOTOPRISM_BACKUP_ALBUMS: true # creates YAML files to back up album metadata PHOTOPRISM_BACKUP_DATABASE: true # creates regular backups based on the configured schedule PHOTOPRISM_BACKUP_SCHEDULE: daily # backup SCHEDULE in cron format (e.g. 0 12 * * * for daily at noon) or at a random time (daily, weekly) PHOTOPRISM_INDEX_SCHEDULE: # indexing SCHEDULE in cron format (e.g. @every 3h for every 3 hours; to disable) PHOTOPRISM_AUTO_INDEX: 300 # delay before automatically indexing files in SECONDS when uploading via WebDAV (-1 to disable) PHOTOPRISM_AUTO_IMPORT: -1 # delay before automatically importing files in SECONDS when uploading via WebDAV (-1 to disable) PHOTOPRISM_DETECT_NSFW: false # automatically flags photos as private that MAY be offensive (requires TensorFlow) PHOTOPRISM_UPLOAD_NSFW: true # allows uploads that MAY be offensive (no effect without TensorFlow) PHOTOPRISM_SITE_CAPTION: AI-Powered Photos App PHOTOPRISM_SITE_DESCRIPTION: # meta site description PHOTOPRISM_SITE_AUTHOR: # meta site author ## Video Transcoding (https://docs.photoprism.app/getting-started/advanced/transcoding/): # PHOTOPRISM_FFMPEG_ENCODER: software # H.264/AVC encoder (software, intel, nvidia, apple, raspberry, or vaapi) # PHOTOPRISM_FFMPEG_SIZE: 1920 # video size limit in pixels (720-7680) (default: 3840) # PHOTOPRISM_FFMPEG_BITRATE: 32 # video bitrate limit in Mbit/s (default: 50) working_dir: /photoprism # do not change or remove ## Storage Folders: use / not \\ as separator, ~ is a shortcut for C:/user/username, . for the current directory volumes: # C:/user/username/folder:/photoprism/folder # example # - ~/Pictures:/photoprism/originals # original media files (photos and videos) # - D:/example/family:/photoprism/originals/family # *additional* media folders can be mounted like this # - E:/:/photoprism/import # *optional* base folder from which files can be imported to originals - E:/01.ç…§ç‰‡/:/photoprism/import - ./original/:/photoprism/originals - ./videos:/photoprism/originals/videos - ./storage:/photoprism/storage # *writable* storage folder for cache, database, and sidecar files (never remove)## Create named volumes, advanced users may remove this if they mount a regular host folder## for the database or use SQLite instead (never remove otherwise)volumes: database: driver: local PhotoPrismPhotoPrism æ˜¯ä¸€æ¬¾å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©é«˜æ•ˆç®¡ç†ä¸ªäººç›¸å†Œå’Œè§†é¢‘èµ„æ–™ã€‚æ— è®ºæ˜¯æ‘„å½±çˆ±å¥½è€…è¿˜æ˜¯å®¶åº­ç”¨æˆ·ï¼Œè¿™æ¬¾è½¯ä»¶éƒ½èƒ½è®©çš„ç…§ç‰‡ä¸è§†é¢‘æ•´ç†å¾—äº•äº•æœ‰æ¡ï¼Œä¾¿äºæŸ¥æ‰¾å’Œåˆ†äº«ã€‚ æœåŠ¡å™¨èµ„æºè¦è¿è¡Œè‡ªå·±çš„ PhotoPrismï¼Œéœ€è¦ä¸ºå…¶å‡†å¤‡æœåŠ¡å™¨èµ„æºã€‚å¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ç§é€‰æ‹©ï¼š äº‘æœåŠ¡èµ„æºï¼šæ¯”å¦‚é˜¿é‡Œäº‘ã€äºšé©¬é€Š AWS ç­‰æä¾›çš„è™šæ‹ŸæœåŠ¡å™¨ï¼Œé€‚åˆéœ€è¦éšæ—¶è®¿é—®çš„ç”¨æˆ·ã€‚ å®¶åº­ç§æœ‰æœåŠ¡å™¨ï¼šå¦‚æœå¸Œæœ›åœ¨å®¶ä¸­æ­å»ºä¸€ä¸ªä¸“å±çš„åª’ä½“ç®¡ç†ç³»ç»Ÿï¼Œä½¿ç”¨ Raspberry Pi æˆ– NAS è®¾å¤‡éƒ½æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚ è‡ªå·±çš„ç”µè„‘æˆ–ç¬”è®°æœ¬ï¼šå¯ä»¥åˆ©ç”¨ç°æœ‰çš„è®¾å¤‡è¿›è¡Œéƒ¨ç½²ï¼Œå°¤å…¶æ˜¯åœ¨ä¸ªäººä½¿ç”¨çš„åœºæ™¯ä¸‹éå¸¸æ–¹ä¾¿ã€‚ å®‰è£… PhotoPrismå‡†å¤‡ä¸€ä¸ªæœåŠ¡èµ„æºä¹‹åï¼Œå°±å¯ä»¥å¼€å§‹å®‰è£… PhotoPrismã€‚æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œå¯ä»¥é€‰æ‹©äº‘æœåŠ¡ã€å®¶åº­æœåŠ¡å™¨ï¼Œæˆ–è€…ç›´æ¥åœ¨çš„ç”µè„‘ä¸Šè¿›è¡Œå®‰è£…ã€‚ é€‚ç”¨çš„æ“ä½œç³»ç»Ÿéå¸¸å¹¿æ³›ï¼ŒåŒ…æ‹¬ï¼š Windows macOS Linux æœ€ä½èµ„æºéœ€æ±‚è¦ç¡®ä¿ PhotoPrism é¡ºåˆ©è¿è¡Œï¼Œæœ€ä½é…ç½®è¦æ±‚ä¸ºï¼š CPUï¼š2 æ ¸å¿ƒ å†…å­˜ï¼š3 GB å‡†å¤‡ Docker ç¯å¢ƒPhotoPrism æ˜¯åŸºäº Go è¯­è¨€å¼€å‘çš„å·¥å…·ã€‚è™½ç„¶å¯ä»¥æŒ‰ç…§ä¼ ç»Ÿæ–¹å¼åœ¨æœ¬åœ°å®‰è£… Go æ¥è¿è¡Œï¼Œä½†å¼ºçƒˆå»ºè®®ä½¿ç”¨ Docker æ¥è¿›è¡Œéƒ¨ç½²ã€‚Docker å…·å¤‡ä»¥ä¸‹ä¼˜åŠ¿ï¼š ç®€å•ï¼šéƒ¨ç½²è¿‡ç¨‹ç›´è§‚ï¼Œæ— éœ€æ·±å…¥çš„ç³»ç»Ÿé…ç½®ã€‚ æ–¹ä¾¿ï¼šå¯ä»¥å¿«é€Ÿæ›´æ–°å’Œå›æ»šåˆ°ä¸åŒçš„ç‰ˆæœ¬ã€‚ æ˜“äºè¿ç§»ï¼šä½¿ç”¨ Docker å¯ä»¥è½»æ¾å°†æœåŠ¡è¿ç§»åˆ°å¦ä¸€å°æœåŠ¡å™¨ä¸Šã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œå°†é‡ç‚¹ä»‹ç»åŸºäº Docker çš„å®‰è£…æ–¹å¼ã€‚å¦‚æœå¸Œæœ›ä½¿ç”¨åŸç”Ÿ Goï¼Œå¯ä»¥è®¿é—® PhotoPrism çš„å®˜æ–¹ç½‘ç«™è·å–æ›´å¤šä¿¡æ¯ã€‚ Docker ç¯å¢ƒçš„é€‰æ‹©è™½ç„¶åœ¨ Linux ä¸Šå®‰è£… Docker å¯èƒ½æ¯”è¾ƒå®¹æ˜“ï¼Œä½†å¯¹äº Windows å’Œ macOSï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹é€‰é¡¹ï¼š macOSï¼šä½¿ç”¨ OrbStackï¼ˆå•†ä¸šè½¯ä»¶ï¼Œä¸ªäººç”¨æˆ·å…è´¹ï¼‰æˆ– Limaï¼ˆå¼€æºè½¯ä»¶ï¼‰æ¥è¿›è¡Œç¯å¢ƒè®¾ç½®ã€‚ Windowsï¼šå»ºè®®ä½¿ç”¨ WSLï¼ˆWindows Subsystem for Linuxï¼‰æ¥æ­å»º Linux ç¯å¢ƒï¼Œè¿™æ ·å¯ä»¥é¿å…ç›´æ¥ä½¿ç”¨ Docker Desktop å¸¦æ¥çš„ä¸è‰¯ä½“éªŒã€‚ æ³¨æ„ï¼šDocker Desktop åœ¨ Windows ä¸‹çš„æ€§èƒ½ä¸ç†æƒ³ï¼Œå¹¶ä¸”é•œåƒçš„ä½“ç§¯æ¯”è¾ƒåºå¤§ï¼Œå°½é‡é€‰æ‹©å…¶ä»–æ–¹æ¡ˆã€‚ æ­¤å¤–ï¼Œè¯·ç¡®ä¿å®‰è£…å¥½ Docker Compose å·¥å…·ï¼Œå°†åœ¨ä¸‹é¢çš„æ­¥éª¤ä¸­ä½¿ç”¨ Docker Compose æ¥ç®€åŒ–éƒ¨ç½²ã€‚Docker Compose çš„é…ç½®æ–‡ä»¶ä»¥ YAML æ ¼å¼ç¼–å†™ï¼Œä¾¿äºæŸ¥çœ‹ä¸ä¿®æ”¹é…ç½®ä¿¡æ¯ã€‚Dockerå‘½ä»¤ ç¡®å®šçš„æ•°æ®åº“PhotoPrism æ”¯æŒå‡ ç§ä¸åŒçš„æ•°æ®åº“ï¼Œä¸»è¦åŒ…æ‹¬ SQLite 3 å’Œ MariaDB 10.5.12 ä»¥ä¸Šç‰ˆæœ¬ã€‚éœ€è¦æ ¹æ®çš„ä½¿ç”¨éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ•°æ®åº“ï¼š SQLiteï¼šé€‚åˆåˆå­¦è€…æˆ–å°å‹é¡¹ç›®ï¼Œæ˜¯ä¸€ç§è½»é‡çº§çš„åµŒå…¥å¼æ•°æ®åº“ï¼Œéå¸¸æ˜“äºä¸Šæ‰‹å’Œä½¿ç”¨ã€‚ MariaDBï¼šæ›´é€‚åˆéœ€è¦è¾ƒé«˜æ€§èƒ½å’Œç¨³å®šæ€§çš„åœºæ™¯ï¼Œå¦‚æœè®¡åˆ’é•¿æœŸä½¿ç”¨ PhotoPrismï¼Œå»ºè®®é€‰æ‹© MariaDBã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQL çš„æ–°ç‰ˆæœ¬ç”±äºç¼ºå°‘æŸäº›ç‰¹æ€§è€Œä¸å†è¢« PhotoPrism æ‰€æ”¯æŒã€‚ Docker Compose é…ç½®åˆ›å»ºä¸€ä¸ªç©ºç›®å½•é¦–å…ˆï¼Œåœ¨é€‰æ‹©çš„ä½ç½®åˆ›å»ºä¸€ä¸ªç©ºç›®å½•ï¼Œä¾‹å¦‚å‘½åä¸º photoã€‚è¿™ä¸ªç›®å½•å°†ç”¨äºå­˜å‚¨æ‰€æœ‰çš„é…ç½®æ–‡ä»¶å’Œæ•°æ®ã€‚å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·æˆ–å›¾å½¢åŒ–ç•Œé¢æ¥å®Œæˆè¿™ä¸ªæ­¥éª¤ã€‚ åœ¨è¿™ä¸ªæ–°åˆ›å»ºçš„ç›®å½•ä¸‹ï¼Œéœ€è¦å†åˆ›å»ºä¸‰ä¸ªå­ç›®å½•ï¼Œåˆ†åˆ«ä¸ºï¼š importï¼šç”¨äºå­˜æ”¾éœ€è¦å¯¼å…¥çš„å›¾åƒã€‚ originalsï¼šç”¨äºä¿å­˜åŸå§‹å›¾åƒæ–‡ä»¶ã€‚ storageï¼šç”¨äºå­˜å‚¨ PhotoPrism å¤„ç†åçš„æ–‡ä»¶ã€‚ æœ€ç»ˆçš„ç›®å½•ç»“æ„å°†å¦‚ä¸‹æ‰€ç¤ºï¼š photoâ”œâ”€â”€ docker-compose.ymlâ”œâ”€â”€ importâ”œâ”€â”€ originalsâ””â”€â”€ storage è¿™ä¸‰ä¸ªå­ç›®å½•çš„å…·ä½“ç”¨å¤„å°†åœ¨åé¢çš„å†…å®¹ä¸­è¯¦ç»†è§£é‡Šã€‚ ç¼–è¾‘ docker-compose.ymlæœ€åä¸€æ­¥æ˜¯ç¼–è¾‘ docker-compose.yml æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œéœ€è¦å®šä¹‰ PhotoPrism æ‰€éœ€çš„æœåŠ¡åŠå…¶é…ç½®ï¼Œç¡®ä¿åœ¨éƒ¨ç½²æ—¶ä¸€åˆ‡é¡ºåˆ©è¿›è¡Œã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäº PhotoPrism çš„ docker-compose ç¤ºä¾‹æ–‡ä»¶ï¼š version: 3.5services: photoprism: image: photoprism/photoprism:latest container_name: photoprism stop_grace_period: 10s restart: always security_opt: - seccomp:unconfined - apparmor:unconfined ports: - 2342:2342 environment: PHOTOPRISM_ADMIN_USER: admin # ç”¨æˆ·å PHOTOPRISM_ADMIN_PASSWORD: admin1234 # ç”¨æˆ·å¯†ç (ä¸å°‘äº8ä½) PHOTOPRISM_AUTH_MODE: password # æˆæƒæ¨¡å¼, public æˆ– password # æ•°æ®åº“é…ç½®, è¿™é‡Œé…ç½®äº†sql PHOTOPRISM_DATABASE_DRIVER: sqlite # ä½¿ç”¨å†…ç½®çš„SQLiteæ•°æ®åº“ # æ­£å¼ä½¿ç”¨,å»ºè®®ä½¿ç”¨mariadbæ•°æ®åº“ #PHOTOPRISM_DATABASE_DRIVER: mysql # ä½¿ç”¨MariaDB 10.5 ä»¥ä¸Šçš„æ•°æ®åº“ #PHOTOPRISM_DATABASE_SERVER: 192.168.50.16:3306 # MariaDBæ•°æ®åº“åœ°å€ (hostname:port) #PHOTOPRISM_DATABASE_NAME: photoprism # MariaDBæ•°æ®åº“åç§° #PHOTOPRISM_DATABASE_USER: photoprism # MariaDBç”¨æˆ·å #PHOTOPRISM_DATABASE_PASSWORD: photoprism # MariaDBå¯†ç  # ç½‘ç«™æ ‡é¢˜ PHOTOPRISM_SITE_CAPTION: çš„ç›¸å†Œ working_dir: /photoprism # ä¸è¦æ”¹åŠ¨è¿™ä¸€é¡¹ volumes: - ./originals:/photoprism/originals # åŸå§‹ç…§ç‰‡ç›®å½• - ./import/Z:/photoprism/import # å¾…å¯¼å…¥ç…§ç‰‡ç›®å½• - ./storage:/photoprism/storage # photoprismç¨‹åºäº§ç”Ÿçš„å„ç§ç¼“å­˜,æ–‡ä»¶,ç´¢å¼•ç­‰ç›®å½• å¦‚æœæ›¾ç»ä½¿ç”¨è¿‡ docker-composeï¼Œé‚£ä¹ˆä¸Šè¿°å†…å®¹åº”è¯¥èƒ½å¾ˆå¿«ç†è§£ã€‚ ç¯å¢ƒå˜é‡è®¾ç½®ä¸»è¦æœ‰å‡ ä¸ªå…³é”®çš„ç¯å¢ƒå˜é‡éœ€è¦è®¾ç½®ï¼š PHOTOPRISM_ADMIN_USERã€PHOTOPRISM_ADMIN_PASSWORDã€PHOTOPRISM_AUTH_MODEï¼šè¿™ä¸‰é¡¹ç”¨äºè®¾ç½®åŸºæœ¬çš„ç™»å½•æ–¹å¼ä»¥åŠåˆå§‹ç”¨æˆ·åå’Œå¯†ç ã€‚å¯ä»¥åœ¨é¦–æ¬¡ç™»å½•åï¼Œé€šè¿‡ç³»ç»Ÿç•Œé¢ä¿®æ”¹å¯†ç ä»¥å¢å¼ºå®‰å…¨æ€§ã€‚ PHOTOPRISM_DATABASE_DRIVERï¼šç”¨äºæŒ‡å®šæ•°æ®åº“ç±»å‹ï¼Œå¯ä»¥é€‰æ‹© sqlite æˆ– mysqlã€‚åœ¨å½“å‰çš„é…ç½®ä¸­ï¼Œä½¿ç”¨çš„æ˜¯ sqliteã€‚å¦‚æœé€‰æ‹©ä½¿ç”¨ mysqlï¼Œè¯·ç¡®ä¿å–æ¶ˆä¸ MariaDB ç›¸å…³çš„å‚æ•°å¼€å¤´çš„ # æ³¨é‡Šç¬¦å·ï¼Œå¹¶å°† PHOTOPRISM_DATABASE_DRIVER çš„å€¼æ”¹ä¸º mysqlã€‚è¯·æ³¨æ„ï¼ŒPhotoprism ä¸å†æ”¯æŒ mysqlã€‚ PHOTOPRISM_SITE_CAPTIONï¼šè¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰é€‰é¡¹ï¼Œç”¨äºè®¾å®šç½‘ç«™çš„æ ‡é¢˜ã€‚è¿™å¯ä»¥è®©æ›´åŠ ä¸ªæ€§åŒ–åœ°å±•ç¤ºçš„æ‘„å½±ä½œå“ã€‚ ç›®å½•ç»“æ„Photoprism éœ€è¦ä½¿ç”¨ä»¥ä¸‹ä¸‰ä¸ªç›®å½•æ¥ç®¡ç†ç…§ç‰‡ï¼š originalsï¼šè¿™æ˜¯åŸå§‹ç…§ç‰‡çš„ç›®å½•ï¼Œå¯ä»¥å°†å·²æœ‰çš„ç…§ç‰‡æ”¾å…¥æ­¤ç›®å½•ã€‚æ‰€æœ‰ä¸Šä¼ åˆ° Photoprism çš„ç…§ç‰‡æœ€ç»ˆéƒ½ä¼šå­˜æ”¾åœ¨è¿™é‡Œã€‚ importï¼šæ–°ç…§ç‰‡çš„å¯¼å…¥ç›®å½•ï¼Œä»»ä½•æ”¾åœ¨æ­¤ç›®å½•ä¸­çš„ç…§ç‰‡éƒ½ä¼šç­‰å¾…è¢« Photoprism å¤„ç†ã€‚è¿™ä¸€è¿‡ç¨‹åŒ…æ‹¬ç…§ç‰‡åˆ†æå’Œç´¢å¼•ï¼ŒPhotoprism ä¼šå°†å¤„ç†åçš„ç…§ç‰‡å­˜å…¥ originals ç›®å½•ã€‚ storageï¼šè¿™ä¸ªç›®å½•ç”¨äºä¿å­˜ Photoprism ç”Ÿæˆçš„å„ç§æ–‡ä»¶ï¼Œæ¯”å¦‚ç´¢å¼•ã€ç…§ç‰‡ç¼©ç•¥å›¾å’Œç¼“å­˜ã€‚è¿™äº›æ–‡ä»¶æœ‰åŠ©äºæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚ å¯åŠ¨æœåŠ¡è¦å¯åŠ¨æœåŠ¡ï¼Œè¯·è¿›å…¥ Photoprism çš„ç›®å½•ï¼Œå¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š docker-compose up -d åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œç”±äºéœ€è¦ä¸‹è½½é•œåƒï¼Œè¿™å¯èƒ½ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ã€‚ä¸€æ—¦å®Œæˆå¯åŠ¨ä¸”æ²¡æœ‰é—®é¢˜ï¼Œå°±å¯ä»¥è®¿é—® Photoprism äº†ã€‚ è®¿é—® http://127.0.0.1:2342ï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå°†çœ‹åˆ°ç™»å½•é¡µé¢ã€‚ ç™»å½•é¡µé¢ä½¿ç”¨åœ¨é…ç½®ä¸­è®¾ç½®çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•ã€‚åˆæ¬¡ç™»å½•åï¼Œå¯èƒ½ä¼šå‘ç°ç³»ç»Ÿå†…æ²¡æœ‰ä»»ä½•ç…§ç‰‡ï¼Œè¿™æ˜¯å› ä¸ºè¿˜æ²¡æœ‰å¯¼å…¥ä»»ä½•ç…§ç‰‡ã€‚ ç¬¬ä¸€æ¬¡å¯¼å…¥åŠç´¢å¼•ä½¿ç”¨ Docker å®‰è£… Photoprism å®é™…ä¸Šéå¸¸ç®€å•ï¼Œè¿™ä¹Ÿæ˜¯æ¨èåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨ Docker çš„åŸå› ä¹‹ä¸€ï¼Œå› ä¸ºè¿™æ ·æ— éœ€æ‹…å¿ƒå„ç±»ç¯å¢ƒå’Œä¾èµ–é—®é¢˜ã€‚ æ­¤æ—¶ï¼Œé¢ä¸´çš„éœ€æ±‚ä¸»è¦æœ‰ä¸¤ä¸ªï¼š å°†å·²æœ‰çš„å†å²ç…§ç‰‡å¯¼å…¥ Photoprismã€‚ å°†æ¥å¦‚ä½•åŒæ­¥æ–°çš„ç…§ç‰‡ã€‚ å¯¼å…¥æ—§ç…§ç‰‡ä¸ºäº†å¯¼å…¥å·²æœ‰çš„ç…§ç‰‡å¹¶å®Œæˆç´¢å¼•ï¼Œéœ€è¦äº†è§£ä»¥ä¸‹çš„æ¦‚å¿µã€‚ç´¢å¼•æ˜¯æŒ‡ Photoprism é€šè¿‡æå–ç…§ç‰‡çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚ç…§ç‰‡çš„æ‹æ‘„åœ°ç‚¹ã€å¤§å°å’Œæ‹æ‘„æ—¶é—´ï¼Œæ¥ç»„ç»‡å’Œç®¡ç†ç…§ç‰‡ã€‚åŒæ—¶ï¼ŒPhotoprism ä¼šä¸ºæ¯å¼ ç…§ç‰‡ç”Ÿæˆå„ç§å°ºå¯¸çš„ç¼©ç•¥å›¾ï¼Œè¿™äº›ç¼©ç•¥å›¾åœ¨ç”¨æˆ·ç•Œé¢ä¸­æ˜¾ç¤ºï¼Œè€ŒéåŸå§‹ç…§ç‰‡ã€‚ æ”¾å…¥ç›®å½•é€‰æ‹©ï¼šå¯ä»¥å°†æ—§æœ‰çš„ç…§ç‰‡æ”¾ç½®åœ¨ import ç›®å½•æˆ– originals ç›®å½•ä¸­ï¼Œä½†äºŒè€…çš„å¤„ç†æ–¹å¼ä¸åŒã€‚ originals ç›®å½•originals æ˜¯ç”¨äºå­˜æ”¾ç…§ç‰‡åŸæ–‡ä»¶çš„åœ°æ–¹ã€‚æ‰€æœ‰ Photoprism ç®¡ç†çš„ç…§ç‰‡åŸæ–‡ä»¶éƒ½å°†å­˜æ”¾åœ¨æ­¤ç›®å½•ä¸‹ã€‚å¯ä»¥é€‰æ‹©å°†æ—§ç›¸ç‰‡ç›´æ¥æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸­ï¼Œä½†ç”±äº Photoprism ä¸ä¼šè‡ªåŠ¨å¯¹è¿™äº›ç›¸ç‰‡å»ºç«‹ç´¢å¼•ï¼Œéœ€è¦åœ¨ç”¨æˆ·ç•Œé¢ä¸Šå¯åŠ¨å…¨é‡ç´¢å¼•æ“ä½œã€‚ å…¨é‡ç´¢å¼•è¿›å…¥æ•°æ®åº“ï¼Œç‚¹å‡»ç´¢å¼•é¡µï¼Œç„¶åå¯ä»¥æ‰§è¡Œä¸€æ¬¡å®Œå…¨é‡æ–°æ‰«æï¼Œä»¥ä¾¿ Photoprism èƒ½å¤Ÿå¯¹ç°æœ‰çš„ç…§ç‰‡è¿›è¡Œç´¢å¼•ã€‚ import ç›®å½•ä¹Ÿå¯ä»¥é€‰æ‹©å°†ç°æœ‰ç…§ç‰‡æ”¾å…¥ import ç›®å½•ã€‚éšååœ¨æ•°æ®åº“çš„å¯¼å…¥é¡µé¢ä¸­ï¼Œé€‰æ‹©è¯¥ç›®å½•ï¼Œå¯¼å…¥çš„ç…§ç‰‡ã€‚ åŒºåˆ«ä¸å»ºè®®å¯èƒ½ä¼šäº§ç”Ÿç–‘é—®ï¼Œæ—¢ç„¶å¯ä»¥éšæ„æ”¾ç½®åœ¨è¿™ä¸¤ä¸ªç›®å½•ä¸­ï¼Œä¸ºä»€ä¹ˆè¦è¿›è¡Œé€‰æ‹©ï¼Ÿå…¶å®äºŒè€…ä¹‹é—´å­˜åœ¨é‡è¦çš„åŒºåˆ«ï¼š å…±åŒç‚¹ï¼šæ— è®ºæ˜¯ import è¿˜æ˜¯ originals ç›®å½•ï¼ŒPhotoprism éƒ½ä¼šå¯¹ç…§ç‰‡è¿›è¡Œç´¢å¼•ï¼Œæå–å…ƒæ•°æ®å¹¶ç”Ÿæˆç¼©ç•¥å›¾ã€‚ ä¸åŒç‚¹ï¼š æ”¾åœ¨ import ç›®å½•çš„ç…§ç‰‡ä¼šæŒ‰ç…§æ‹æ‘„æ—¥æœŸé‡æ–°å‘½åï¼Œå¹¶éšåå­˜å…¥ originals ç›®å½•ã€‚ import ç›®å½•ç±»ä¼¼äºä¸€ä¸ªä¸´æ—¶å¤„ç†åŒºï¼Œè€Œ originals åˆ™æ˜¯å­˜æ”¾åŸå§‹ç…§ç‰‡çš„ä¸»è¦ç›®å½•ã€‚ å»ºè®®å› æ­¤ï¼Œå†³å®šå°†å·²æœ‰ç…§ç‰‡æ”¾å…¥ import è¿˜æ˜¯ originals çš„å…³é”®åœ¨äºæ˜¯å¦å¸Œæœ› Photoprism é‡æ–°å‘½åçš„ç…§ç‰‡ã€‚å¦‚æœçš„ç…§ç‰‡å·²ç»ä»¥æœ‰åºçš„æ–¹å¼å­˜æ”¾ï¼Œå»ºè®®å°†å…¶æ”¾å…¥ originalsã€‚ç›¸åï¼Œå¦‚æœå¸Œæœ›ç¨‹åºæŒ‰ç…§æ—¥æœŸé‡æ–°æ•´ç†çš„ç…§ç‰‡ï¼Œæ”¾å…¥ import ç›®å½•ä¼šæ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç´¢å¼•æ˜¯ä¸€é¡¹è€—æ—¶çš„æ“ä½œã€‚ä»¥ä¸ºä¾‹ï¼Œå½“æ—¶æœ‰çº¦ 7000 å¼ ç…§ç‰‡ï¼Œç´¢å¼•è¿‡ç¨‹èŠ±è´¹äº†å‡ ä¸ªå°æ—¶ã€‚ é‡æ–°æ•´ç†åçš„æ•ˆæœç»è¿‡ Photoprism çš„å¤„ç†ï¼Œæ‰€æœ‰ç…§ç‰‡è¢«æŒ‰ç…§å¹´ä»½å’Œæœˆä»½åˆ†ç±»æ•´ç†ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 2000â””â”€â”€ 01 â”œâ”€â”€ 20000101_090020_04FF387A.jpg â”œâ”€â”€ 20000101_090026_E7546984.jpg â”œâ”€â”€ 20000101_090027_4B306DB8.jpg â”œâ”€â”€ 20000101_090050_63B2D167.jpg â”œâ”€â”€ 20000101_090100_D17AE19A.jpg â”œâ”€â”€ 20000101_090111_D8648B18.jpg â”œâ”€â”€ 20000101_090131_FDA5E957.jpg â”œâ”€â”€ 20000101_090146_245BDD02.jpg â”œâ”€â”€ 20000101_090200_07FE3819.jpg â”œâ”€â”€ 20000101_090224_F0190680.jpg â”œâ”€â”€ 20000101_090341_3F2E89A5.jpg â””â”€â”€ 20000101_090712_7D9EAF39.jpg å¦‚ä¸Šï¼Œè¿™ä»£è¡¨ 2000 å¹´ 01 æœˆä»½çš„ç…§ç‰‡ï¼Œæ¯å¼ ç…§ç‰‡éƒ½ä»¥æ‹æ‘„æ—¥æœŸå’Œä¸€ä¸ªéšæœºä»£ç å‘½åã€‚è¿™ç§æ•´ç†ä½¿å¾—åœ¨è¿ç§»ç…§ç‰‡æ—¶ï¼ŒåŸæœ¬æ‚ä¹±æ— ç« çš„ç…§ç‰‡å˜å¾—äº•ç„¶æœ‰åºï¼ŒæŒ‰æ—¥æœŸå­˜å‚¨çš„ç»“æ„è®©ç®¡ç†å˜å¾—è½»æ¾ã€‚ å¦‚ä½•åœ¨å„ç§è®¾å¤‡ä¸Šæµè§ˆè¿™ä¸ªæœåŠ¡?Photoprism å¯¹æµè§ˆå™¨çš„æ”¯æŒéå¸¸å¥½ï¼Œç”¨æˆ·å¯ä»¥è½»æ¾åœ°åœ¨ä¸åŒçš„è®¾å¤‡ä¸Šé€šè¿‡æµè§ˆå™¨è®¿é—®è¯¥æœåŠ¡ï¼Œæ— è®ºä½¿ç”¨çš„æ˜¯ä¸ªäººç”µè„‘ã€å¹³æ¿è¿˜æ˜¯æ™ºèƒ½æ‰‹æœºã€‚å…¶å“åº”å¼è®¾è®¡ä¿è¯äº†åœ¨ä¸åŒå°ºå¯¸çš„å±å¹•ä¸Šéƒ½èƒ½æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ iPhone æˆ– Android æ‰‹æœºä¸Šè®¿é—® Photoprismï¼Œç•Œé¢ä¼šè‡ªåŠ¨è°ƒæ•´ï¼Œä»¥é€‚åº”å±å¹•å°ºå¯¸ã€‚ Nginx é…ç½® Nginxé…ç½®å¦‚æœé€‰æ‹©åœ¨å®¶é‡Œçš„æœåŠ¡å™¨ä¸Šéƒ¨ç½² Photoprismï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹æ­¥éª¤æ¥è¿›è¡Œé…ç½®ï¼Œä»è€Œå°†æœåŠ¡æ˜ å°„åˆ°å¤–ç½‘è¿›è¡Œè®¿é—®: Nginx é…ç½®: ä¸º Photoprism é…ç½® Nginxï¼Œä»¥ç¡®ä¿æµé‡èƒ½æ­£ç¡®è½¬å‘ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ Nginx çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹: server listen 80; server_name your_domain.com; # çš„åŸŸåæˆ–IPåœ°å€ location / proxy_pass http://localhost:2342; # Photoprism é»˜è®¤ç«¯å£ proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; å¦‚ä½•æ˜ å°„å¤–ç½‘è®¿é—®?å†…ç½‘ç©¿é€æ–¹æ¡ˆé€šè¿‡ç»“åˆ Tailscale å’Œä¾¿å®œçš„é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œå¯ä»¥è½»æ¾åœ°æ˜ å°„å¤–ç½‘è®¿é—®çš„å®¶åº­æœåŠ¡å™¨ã€‚è¿™ç§ç»„åˆæä¾›å®‰å…¨çš„è¿œç¨‹è¿æ¥ï¼Œä¸”é…ç½®è¿‡ç¨‹ç›¸å¯¹ç®€æ´ã€‚é¦–å…ˆï¼Œåœ¨å®¶ä¸­çš„æœåŠ¡å™¨ä¸Šå®‰è£… Tailscaleï¼Œæ¥ç€ï¼Œåœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šæ³¨å†Œå¹¶è®¾ç½® Tailscale è´¦æˆ·ã€‚é€šè¿‡ Tailscale ç”Ÿæˆçš„ç§æœ‰ç½‘ç»œï¼Œå°±èƒ½ä»ä»»ä½•å¤–éƒ¨è®¾å¤‡å®‰å…¨è®¿é—®çš„å®¶åº­æœåŠ¡å™¨ã€‚ å¦‚ä½•åŒæ­¥è®¾å¤‡ä¸Šçš„ç›¸ç‰‡?ä½¿ç”¨ Filestash å’Œ WebDAV å¯ä»¥æœ‰æ•ˆåœ°æ‰¹é‡ä¸Šä¼ çš„ç›¸ç‰‡ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š Filestash: Filestash æ˜¯ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„æ–‡ä»¶ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å°†çš„ç›¸ç‰‡è½»æ¾ä¸Šä¼ åˆ°å„ç±»äº‘å­˜å‚¨æœåŠ¡ã€‚å®ƒæ”¯æŒå¤šç§äº‘æœåŠ¡ï¼Œæ¯”å¦‚ Google Driveã€Dropboxã€å’Œ OneDrive ç­‰ã€‚åªéœ€ç™»å½•åˆ° Filestashï¼Œç„¶åé€‰æ‹©æ‰€éœ€ä¸Šä¼ çš„ç…§ç‰‡ã€‚ç•Œé¢ç›´è§‚ï¼Œæ“ä½œç®€å•ï¼Œå…è®¸ä¸€æ¬¡æ€§é€‰æ‹©å¤šå¼ ç›¸ç‰‡ï¼Œé¿å…äº†å•ç‹¬ä¸Šä¼ çš„éº»çƒ¦ï¼Œå®ç°é«˜æ•ˆç®¡ç†ã€‚ Rsync: è‹¥è¦å®šæœŸåŒæ­¥å’Œå¤‡ä»½åŸå§‹ç›¸ç‰‡æ•°æ®åˆ°ç§»åŠ¨ç¡¬ç›˜ï¼Œå¯ä»¥å€ŸåŠ© rsync å‘½ä»¤ã€‚è¿™ä¸ªå‘½ä»¤å…·æœ‰å¼ºå¤§çš„æ–‡ä»¶åŒæ­¥åŠŸèƒ½ï¼Œç‰¹åˆ«é€‚åˆè¿›è¡Œå¢é‡å¤‡ä»½ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ª cron ä»»åŠ¡ï¼Œè®©è¿™ä¸€å‘½ä»¤æ¯æ—¥å‡Œæ™¨è‡ªåŠ¨è¿è¡Œã€‚ç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹ï¼š rsync -av --delete /path/to/your/photos /path/to/your/external/harddrive ä¸Šè¿°å‘½ä»¤ä¸­çš„ -a è¡¨ç¤ºä»¥å½’æ¡£æ¨¡å¼åŒæ­¥ï¼Œå³ä¿ç•™æ–‡ä»¶çš„æƒé™ã€æ—¶é—´æˆ³ç­‰ä¿¡æ¯ã€‚-v åˆ™æ˜¯è¾“å‡ºè¯¦ç»†çš„æ“ä½œè¿‡ç¨‹ï¼Œè€Œ --delete é€‰é¡¹åˆ™ç¡®ä¿ç›®æ ‡ç›®å½•ä¸æºç›®å½•å®Œå…¨ä¸€è‡´ï¼Œåˆ é™¤å·²ä¸å†å­˜åœ¨çš„æ–‡ä»¶ã€‚è¿™ç§æ–¹æ³•ç¡®ä¿å§‹ç»ˆæ‹¥æœ‰æœ€æ–°çš„ç›¸ç‰‡å¤‡ä»½ï¼Œæ— è®ºæ˜¯åœ¨å¤–å‡ºæ—…è¡Œè¿˜æ˜¯åœ¨å®¶ä¸­çš„æ—¥å¸¸è®°å½•ã€‚ ä½¿ç”¨ Alistè¦åˆ©ç”¨ Alist æ¥å®ç°åŒæ­¥ï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š æŒ‚è½½ WebDAV: é¦–å…ˆï¼Œä½¿ç”¨ mount å‘½ä»¤å°† WebDAV æ˜ å°„åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚è¿™æ ·å°±å¯ä»¥åƒè®¿é—®æœ¬åœ°æ–‡ä»¶ä¸€æ ·è®¿é—® WebDAV ä¸Šçš„æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š mount -t davfs https://your_webdav_url /mnt/webdav è¿™é‡Œçš„ https://your_webdav_url æ˜¯çš„ WebDAV æœåŠ¡çš„å®é™…åœ°å€ï¼Œè€Œ /mnt/webdav æ˜¯å¸Œæœ›æŒ‚è½½çš„æœ¬åœ°ç›®å½•ã€‚è¿™ä½¿å¾—æ‰€æœ‰åœ¨ WebDAV ä¸Šçš„æ–‡ä»¶å¯ä»¥ç›´æ¥é€šè¿‡æœ¬åœ°è·¯å¾„è¿›è¡Œè®¿é—®ï¼Œæé«˜äº†ä¾¿åˆ©æ€§ã€‚ ä¿®æ”¹ Docker-Compose é…ç½®æ–‡ä»¶: æ¥ä¸‹æ¥ï¼Œæ‰“å¼€çš„ Docker-Compose é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹æ•°æ®çš„å¯¼å…¥å’Œå­˜å‚¨è·¯å¾„ï¼Œç¡®ä¿å®ƒæŒ‡å‘æ–°æŒ‚è½½çš„ WebDAV ä½ç½®ã€‚ä¿®æ”¹ç¤ºä¾‹å¦‚ä¸‹ï¼š volumes: - /mnt/webdav:/data # å°† WebDAV ç›®å½•æŒ‚è½½åˆ° Alist çš„æ•°æ®ç›®å½• è¿™ä¸ªæ­¥éª¤ç¡®ä¿ Alist å¯ä»¥ç›´æ¥è®¿é—®å­˜å‚¨åœ¨ WebDAV ä¸Šçš„ç›¸ç‰‡ï¼Œå¹¶åœ¨åº”ç”¨ä¸­åŒæ­¥æ˜¾ç¤ºã€‚ å¯åŠ¨ç›¸å†Œ: æœ€åï¼Œé€šè¿‡ Docker å¯åŠ¨ Alist æœåŠ¡ã€‚æ‰§è¡Œå®Œæˆåï¼Œå¯ä»¥è®¿é—®é…ç½®å¥½çš„ WebDAV ç›®å½•ï¼Œè½»æ¾æŸ¥çœ‹å¹¶ç®¡ç†åŒæ­¥çš„ç…§ç‰‡å’Œæ–‡ä»¶ã€‚åœ¨è¿™ä¸ªç¯å¢ƒä¸­ï¼Œæ— è®ºæ˜¯ä¸ªäººç›¸å†Œè¿˜æ˜¯å¤šäººå…±äº«çš„ç…§ç‰‡ï¼Œéƒ½ä¼šå˜å¾—ä¸€ç›®äº†ç„¶ï¼Œæ–¹ä¾¿éšæ—¶è®¿é—®ã€‚ é€šè¿‡è¿™äº›æ­¥éª¤ï¼Œæ— è®ºæ˜¯åœ¨èˆ’é€‚çš„å®¶ä¸­ï¼Œè¿˜æ˜¯è¶ç€å¤–å‡ºæ—…è¡Œï¼Œéƒ½èƒ½è½»æ¾ç®¡ç†ã€è®¿é—®å¹¶å¤‡ä»½çš„ç…§ç‰‡æ•°æ®ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œæ— è®ºä½•æ—¶ä½•åœ°ï¼Œéƒ½èƒ½ä¿ç•™ç¾å¥½ç¬é—´ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨","å·¥å…·"]},{"title":"äº‘æœåŠ¡ç®¡ç†è½¯ä»¶-1panel","path":"/2024/06/25/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-å·¥å…·-äº‘æœåŠ¡ç®¡ç†è½¯ä»¶-1panel/","content":"äº‘æœåŠ¡ç®¡ç†è½¯ä»¶ï¼šå¼€æºçš„ 1panel åˆ›å»º 1panel æ–‡ä»¶å¤¹ï¼Œè¿›å…¥åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š #å…ˆå®‰è£…dockersudo apt install docker.iocurl -sSL https://resource.fit2cloud.com/1panel/package/quick_start.sh -o quick_start.sh sudo bash quick_start.sh è¾“å…¥å®‰å…¨å…¥å£ï¼Œä¹‹åç™»é™†æ—¶éœ€è¦å®‰è£… IP åœ°å€ + ç«¯å£å· + å®‰å…¨å…¥å£çš„å½¢å¼è¿›å…¥ç®¡ç†é¡µé¢ 124.224.246:9090/liuluhua è¾“å…¥ç™»å½•ç”¨æˆ·åå’Œå¯†ç  liuluhua-passwd ä¹‹åå·²å®Œæˆ 1panel éƒ¨ç½²ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œè½¯ä»¶çš„ç®¡ç†","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨","å·¥å…·"]},{"title":"å†…è”å‡½æ•°","path":"/2024/06/24/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-å‡½æ•°-å†…è”å‡½æ•°/","content":"å†…è”å‡½æ•°åœ¨ C è¯­è¨€ä¸­ï¼Œå¦‚æœä¸€äº›å‡½æ•°è¢«é¢‘ç¹è°ƒç”¨ï¼Œä¸æ–­åœ°æœ‰å‡½æ•°å…¥æ ˆï¼Œå³å‡½æ•°æ ˆï¼Œä¼šé€ æˆæ ˆç©ºé—´æˆ–æ ˆå†…å­˜çš„å¤§é‡æ¶ˆè€—ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç‰¹åˆ«çš„å¼•å…¥äº† inline ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºä¸ºå†…è”å‡½æ•°ã€‚ æ ˆç©ºé—´å°±æ˜¯æŒ‡æ”¾ç½®ç¨‹å¼çš„å±€éƒ¨æ•°æ®ä¹Ÿå°±æ˜¯å‡½æ•°å†…æ•°æ®çš„å†…å­˜ç©ºé—´ï¼Œåœ¨ç³»ç»Ÿä¸‹ï¼Œæ ˆç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå‡å¦‚é¢‘ç¹å¤§é‡çš„ä½¿ç”¨å°±ä¼šé€ æˆå› æ ˆç©ºé—´ä¸è¶³æ‰€é€ æˆçš„ç¨‹å¼å‡ºé”™çš„é—®é¢˜ï¼Œå‡½æ•°çš„æ­»å¾ªç¯é€’å½’è°ƒç”¨çš„æœ€ç»ˆç»“æœå°±æ˜¯å¯¼è‡´æ ˆå†…å­˜ç©ºé—´æ¯ç«­ã€‚ ä¸‹é¢ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š //å‡½æ•°å®šä¹‰ä¸º inline å³:å†…è”å‡½æ•°inline char* dbtest(int a)\treturn (i % 2 0) ? å¥‡ : å¶;int main()\tint i = 0;\tfor (i=1; i 100; i++) printf(i:%d å¥‡å¶æ€§:%s /n, i, dbtest(i)); ä¸Šé¢çš„ä¾‹å­å°±æ˜¯æ ‡å‡†çš„å†…è”å‡½æ•°çš„ç”¨æ³•ï¼Œä½¿ç”¨ inline ä¿®é¥°å¸¦æ¥çš„å¥½å¤„ä»¬è¡¨é¢çœ‹ä¸å‡ºæ¥ï¼Œå…¶å®åœ¨å†…éƒ¨çš„å·¥ä½œå°±æ˜¯åœ¨æ¯ä¸ª for å¾ªç¯çš„å†…éƒ¨ä»»ä½•è°ƒç”¨ dbtest(i) çš„åœ°æ–¹éƒ½æ¢æˆäº† (i%20)?å¥‡:å¶ è¿™æ ·å°±é¿å…äº†é¢‘ç¹è°ƒç”¨å‡½æ•°å¯¹æ ˆå†…å­˜é‡å¤å¼€è¾Ÿæ‰€å¸¦æ¥çš„æ¶ˆè€—ã€‚ å…¶å®è¿™ç§æœ‰ç‚¹ç±»ä¼¼å’±ä»¬å‰é¢å­¦ä¹ çš„åŠ¨æ€åº“å’Œé™æ€åº“çš„é—®é¢˜ï¼Œä½¿ dbtest å‡½æ•°ä¸­çš„ä»£ç ç›´æ¥è¢«æ”¾åˆ° main å‡½æ•°ä¸­ï¼Œæ‰§è¡Œ for å¾ªç¯æ—¶ï¼Œä¼šä¸æ–­è°ƒç”¨è¿™æ®µä»£ç ï¼Œè€Œä¸æ˜¯ä¸æ–­åœ°å¼€è¾Ÿä¸€ä¸ªå‡½æ•°æ ˆã€‚ å†…è”å‡½æ•°çš„ç¼–ç¨‹é£æ ¼å®šä¹‰å…³é”®å­— inline å¿…é¡»ä¸å‡½æ•°å®šä¹‰ä½“æ”¾åœ¨ä¸€èµ·æ‰èƒ½ä½¿å‡½æ•°æˆä¸ºå†…è”ï¼Œä»…å°† inline æ”¾åœ¨å‡½æ•°å£°æ˜å‰é¢ä¸èµ·ä»»ä½•ä½œç”¨ã€‚ å¦‚ä¸‹é£æ ¼çš„å‡½æ•° Foo ä¸èƒ½æˆä¸ºå†…è”å‡½æ•°ï¼š inline void Foo(int x, int y); // inline ä»…ä¸å‡½æ•°å£°æ˜æ”¾åœ¨ä¸€èµ·void Foo(int x, int y) è€Œå¦‚ä¸‹é£æ ¼çš„å‡½æ•° Foo åˆ™æˆä¸ºå†…è”å‡½æ•°ï¼š void Foo(int x, int y);inline void Foo(int x, int y)// inline ä¸å‡½æ•°å®šä¹‰ä½“æ”¾åœ¨ä¸€èµ· inline æ˜¯ä¸€ç§â€ç”¨äºå®ç°çš„å…³é”®å­—â€ï¼Œè€Œä¸æ˜¯ä¸€ç§â€ç”¨äºå£°æ˜çš„å…³é”®å­—â€ã€‚ä¸€èˆ¬åœ°ï¼Œåœ¨å¤§å¤šæ•°æ•™ç§‘ä¹¦ä¸­å†…è”å‡½æ•°çš„å£°æ˜ã€å®šä¹‰ä½“å‰é¢éƒ½åŠ äº† inline å…³é”®å­—ã€‚ é™åˆ¶inline åªé€‚åˆå‡½æ•°ä½“å†…ä»£ç ç®€å•çš„å‡½æ•°ä½¿ç”¨ï¼Œä¸èƒ½åŒ…å«å¤æ‚çš„ç»“æ„æ§åˆ¶è¯­å¥ä¾‹å¦‚ whileã€switchï¼Œå¹¶ä¸”å†…è”å‡½æ•°æœ¬èº«ä¸èƒ½æ˜¯ç›´æ¥é€’å½’å‡½æ•°(è‡ªå·±å†…éƒ¨è¿˜è°ƒç”¨è‡ªå·±çš„å‡½æ•°)ã€‚ æ…ç”¨å†…è”å†…è”èƒ½æé«˜å‡½æ•°çš„æ‰§è¡Œæ•ˆç‡ï¼Œä½†æ˜¯æ˜¯ä»¥ä»£ç è†¨èƒ€ï¼ˆå¤åˆ¶ï¼‰ä¸ºä»£ä»·ï¼Œä»…ä»…çœå»äº†å‡½æ•°è°ƒç”¨çš„å¼€é”€ï¼Œä»è€Œæé«˜å‡½æ•°çš„æ‰§è¡Œæ•ˆç‡ã€‚å¦‚æœæ‰§è¡Œå‡½æ•°ä½“å†…ä»£ç çš„æ—¶é—´ï¼Œç›¸æ¯”äºå‡½æ•°è°ƒç”¨çš„å¼€é”€è¾ƒå¤§ï¼Œé‚£ä¹ˆæ•ˆç‡çš„æ”¶è·ä¼šå¾ˆå°‘ã€‚å¦ä¸€æ–¹é¢ï¼Œæ¯ä¸€å¤„å†…è”å‡½æ•°çš„è°ƒç”¨éƒ½è¦å¤åˆ¶ä»£ç ï¼Œå°†ä½¿ç¨‹åºçš„æ€»ä»£ç é‡å¢å¤§ï¼Œæ¶ˆè€—æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚ä»¥ä¸‹æƒ…å†µä¸å®œä½¿ç”¨å†…è”ï¼š å¦‚æœå‡½æ•°ä½“å†…çš„ä»£ç æ¯”è¾ƒé•¿ï¼Œä½¿ç”¨å†…è”å°†å¯¼è‡´å†…å­˜æ¶ˆè€—ä»£ä»·è¾ƒé«˜ã€‚ å¦‚æœå‡½æ•°ä½“å†…å‡ºç°å¾ªç¯ï¼Œé‚£ä¹ˆæ‰§è¡Œå‡½æ•°ä½“å†…ä»£ç çš„æ—¶é—´è¦æ¯”å‡½æ•°è°ƒç”¨çš„å¼€é”€å¤§ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","å‡½æ•°"]},{"title":"å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°","path":"/2024/06/21/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-å­—ç¬¦ä¸²ç›¸å…³å‡½æ•°/","content":"putsputs å‡½æ•°æ˜¯ gets å‡½æ•°çš„è¾“å‡ºç‰ˆæœ¬ï¼Œä¸»è¦ç”¨äºå°†æŒ‡å®šçš„å­—ç¬¦ä¸²å†™å…¥æ ‡å‡†è¾“å‡ºã€‚æ­¤å‡½æ•°ä¸ä»…å°†å­—ç¬¦ä¸²æ‰“å°åˆ°å±å¹•ä¸Šï¼Œè¿˜åœ¨å­—ç¬¦ä¸²æœ«å°¾è‡ªåŠ¨æ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚è¿™ä½¿å¾—æ¯æ¬¡è°ƒç”¨ puts åï¼Œè¾“å‡ºéƒ½ä¼šå¼€å§‹äºæ–°çš„ä¸€è¡Œï¼Œå¢åŠ äº†è¾“å‡ºçš„å¯è¯»æ€§ã€‚ä¾‹å¦‚ï¼Œè°ƒç”¨ puts(Hello, World!); å°†åœ¨æ§åˆ¶å°ä¸Šæ˜¾ç¤ºï¼š Hello, World! getchar/*ä¸¢å¼ƒè¯¥è¡Œä¸­åŒ…å«æœ€åä¸€ä¸ªæ•°å­—çš„é‚£éƒ¨åˆ†å†…å®¹*/while((ch = getchar()) != EOF ch != ) å½“ scanf å‡½æ•°å¤„ç†è¾“å…¥å€¼æ—¶ï¼Œå®ƒåªä¼šè¯»å–å®é™…éœ€è¦çš„å­—ç¬¦ï¼Œç•™ä¸‹è¯¥è¡Œæœ€åéƒ¨åˆ†æœªè¯»å–çš„å­—ç¬¦ã€‚è¿™äº›å­—ç¬¦å¯èƒ½æ˜¯å•ç‹¬çš„æ¢è¡Œç¬¦ï¼Œæˆ–è€…æ˜¯å…¶ä»–æ„å¤–è¾“å…¥å†…å®¹ã€‚æ— è®ºå¦‚ä½•ï¼Œwhile å¾ªç¯å°†è¯»å–è¿™äº›å‰©ä½™å­—ç¬¦å¹¶å°†å…¶ä¸¢å¼ƒï¼Œä»è€Œé˜²æ­¢å®ƒä»¬è¢«è¯¯è§£ä¸ºæœ‰æ•ˆæ•°æ®ã€‚ä»¬å¯ä»¥åˆ†æä»¥ä¸‹è¡¨è¾¾å¼ï¼š (ch = getchar()) != EOF ch != åœ¨è¿™ä¸ªè¡¨è¾¾å¼ä¸­ï¼Œgetchar å‡½æ•°ä»æ ‡å‡†è¾“å…¥è¯»å–ä¸€ä¸ªå­—ç¬¦å¹¶è¿”å›å®ƒçš„å€¼ã€‚å¦‚æœè¾“å…¥æµåˆ°è¾¾æ–‡ä»¶çš„ç»“æŸï¼ˆEOFï¼‰ï¼Œè¯¥å‡½æ•°å°±ä¼šè¿”å›ä¸€ä¸ªæ ‡å¿—å¸¸é‡ï¼ˆEOFï¼‰ï¼Œä»¥æŒ‡ç¤ºç»“æŸã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿”å›çš„å€¼è¢«èµ‹ç»™å˜é‡ chï¼Œæ¥ç€é€šè¿‡é€»è¾‘è¿ç®—ç¬¦è¿›è¡Œæ¯”è¾ƒã€‚ä½¿ç”¨æ‹¬å·ç¡®ä¿èµ‹å€¼æ“ä½œåœ¨æ¯”è¾ƒå‰æ‰§è¡Œï¼Œé¿å…é€»è¾‘ä¸Šçš„é”™è¯¯ã€‚å¦‚æœ ch çš„å€¼æ˜¯ EOFï¼Œæ•´ä¸ªè¡¨è¾¾å¼çš„ç»“æœå˜ä¸ºå‡ï¼Œå¾ªç¯éšä¹‹ç»ˆæ­¢ã€‚åä¹‹ï¼Œå¦‚æœ ch æ˜¯æ¢è¡Œç¬¦ï¼Œå¾ªç¯ä¹Ÿä¼šåœæ­¢ã€‚åªæœ‰åœ¨è¾“å…¥ä»ç„¶å¯ç”¨ä¸”æœªé‡åˆ°æ¢è¡Œç¬¦æ—¶ï¼Œå¾ªç¯æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚è¿™æ ·ï¼Œè¿™ä¸ªå¾ªç¯å¯ä»¥æœ‰æ•ˆå»é™¤å½“å‰è¾“å…¥è¡Œçš„æœ€åéƒ¨åˆ†ã€‚ ä¸å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„å†™æ³•ç›¸æ¯”ï¼Œä¸‹é¢è¿™ç§å†™æ³•æ›´ä¸ºç®€æ´å’Œæ˜“è¯»ï¼š ch = getchar();while(ch != EOF ch != ) ch = getchar(); è¿™ä¸ªç»“æ„é¦–å…ˆè¯»å–ä¸€ä¸ªå­—ç¬¦ï¼Œè‹¥æœªåˆ°è¾¾è¾“å…¥çš„æœ«å°¾ä¸”è¯¥å­—ç¬¦ä¸æ˜¯æ¢è¡Œç¬¦ï¼Œåˆ™ä¼šç»§ç»­è¯»å–ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œç›´åˆ°æ»¡è¶³é€€å‡ºæ¡ä»¶ã€‚ getsgets å‡½æ•°è´Ÿè´£ä»æ ‡å‡†è¾“å…¥è¯»å–ä¸€è¡Œæ–‡æœ¬ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ä¼ é€’ç»™å®ƒçš„å­—ç¬¦æ•°ç»„ä¸­ã€‚æ•´è¡Œè¾“å…¥ç”±ä¸€ä¸²å­—ç¬¦ç»„æˆï¼Œæœ€åä»¥æ¢è¡Œç¬¦ç»“æŸã€‚æ­¤å‡½æ•°åœ¨å­˜å‚¨å®Œæˆåä¼šä¸¢å¼ƒæ¢è¡Œç¬¦ï¼Œå¹¶åœ¨å­—ç¬¦æ•°ç»„çš„æœ«å°¾åŠ ä¸Šä¸€ä¸ªç©ºå­—ç¬¦ï¼ˆNUL å­—èŠ‚ï¼‰ï¼Œç”¨äºè¡¨æ˜å­—ç¬¦ä¸²çš„ç»“æŸã€‚ä¾‹å¦‚ï¼Œé€šè¿‡è°ƒç”¨ gets(myString);ï¼Œä¼šæŠŠç”¨æˆ·è¾“å…¥çš„ä¸€è¡Œæ–‡æœ¬è¯»å…¥ myStringï¼Œå¹¶åœ¨æœ«å°¾æ·»åŠ  \\0ã€‚å¦‚æœè¾“å…¥è¡Œæ— æ•ˆï¼ˆä¾‹å¦‚ç”¨æˆ·ç›´æ¥æŒ‰ä¸‹å›è½¦ï¼‰ï¼Œgets å°†è¿”å› NULLï¼ŒæŒ‡ç¤ºå·²åˆ°è¾¾è¾“å…¥çš„æœ«å°¾ï¼ˆEOFï¼‰ã€‚ strchrstrchr æ˜¯ä¸€ä¸ªç”¨äºåœ¨å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾å­—ç¬¦çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æœç´¢çš„å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯éœ€è¦æŸ¥æ‰¾çš„å•ä¸ªå­—ç¬¦ã€‚è¿™ä¸ªå‡½æ•°ä¼šåœ¨å­—ç¬¦ä¸²ä¸­å¯»æ‰¾è¯¥å­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚å¦‚æœæ‰¾åˆ°å­—ç¬¦ï¼Œåˆ™è¿”å›æŒ‡å‘å…¶ä½ç½®çš„æŒ‡é’ˆï¼›å¦‚æœæœªæ‰¾åˆ°ï¼Œåˆ™è¿”å› NULLã€‚ä¾‹å¦‚ï¼Œè°ƒç”¨ strchr(Hello, World!, W); ä¼šè¿”å›æŒ‡å‘å­—ç¬¦ â€˜Wâ€™ çš„æŒ‡é’ˆã€‚ strstr å‡½æ•°ä¸ strchr ç±»ä¼¼ï¼Œä½†å…¶ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²è€Œéå•ä¸ªå­—ç¬¦ã€‚strstr ä¼šæœç´¢è¿™äº›å­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²åœ¨ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œè¿™å¯¹äºæŸ¥æ‰¾å­ä¸²æ¥è¯´éå¸¸æœ‰ç”¨ã€‚ strcpystrcpy å’Œ strncpy å‡½æ•°ç”¨äºå°†å­—ç¬¦ä¸²ä»ä¸€ä¸ªä½ç½®å¤åˆ¶åˆ°å¦ä¸€ä¸ªä½ç½®ã€‚è¿™ä¸¤ä¸ªå‡½æ•°éƒ½ä¼šè¿”å›ä¸€ä¸ªæŒ‡å‘ç›®æ ‡å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼Œå…¶ä¸­ strcpy å°†ä¼šå¤åˆ¶æ•´ä¸ªæºå­—ç¬¦ä¸²ï¼ŒåŒ…æ‹¬ç»ˆæ­¢çš„ NUL å­—èŠ‚ï¼›è€Œ strncpy å…è®¸ç”¨æˆ·æŒ‡å®šè¦å¤åˆ¶çš„æœ€å¤§å­—ç¬¦æ•°ï¼Œä»¥æ›´å¥½åœ°æ§åˆ¶å†…å­˜ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œè°ƒç”¨ strcpy(destination, source); å°†ä¼šå°† source å­—ç¬¦ä¸²å¤åˆ¶åˆ° destination ä¸­ï¼Œç¡®ä¿ destination æ˜¯è¶³å¤Ÿå¤§çš„ä»¥å®¹çº³è¿™æ®µæ–‡æœ¬ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€"]},{"title":"æµ‹é‡å‡½æ•°è¿è¡Œæ—¶é—´","path":"/2024/06/20/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-å‡½æ•°-æµ‹é‡å‡½æ•°è¿è¡Œæ—¶é—´/","content":"#include stdio.h#include stdlib.h#include time.hint main() // å®šä¹‰ä¸€ä¸ªå¤§å‹æ•´å‹å˜é‡ï¼Œä½œä¸ºå¾ªç¯çš„è®¡æ•°å™¨ long i = 10000000L; // ç”¨äºè®°å½•å¼€å§‹å’Œç»“æŸæ—¶é—´çš„å˜é‡ clock_t start, finish; // ç”¨äºå­˜å‚¨æ€»è€—æ—¶çš„å˜é‡ double Total_time; // è¾“å‡ºå³å°†è¿›è¡Œçš„æ“ä½œæç¤ºä¿¡æ¯ printf(Time to do %ld empty loops is , i); // è®°å½•å½“å‰æ—¶é—´ï¼Œä½œä¸ºè®¡æ—¶çš„èµ·å§‹ç‚¹ start = clock(); // æ‰§è¡Œ i æ¬¡ç©ºå¾ªç¯ï¼Œç›®çš„æ˜¯ç”¨æ¥æ¶ˆè€—æ—¶é—´ while (i--) ; // è®°å½•ç»“æŸæ—¶é—´ finish = clock(); // è®¡ç®—æ€»æ—¶é—´ï¼ŒCLOCKS_PER_SEC æ˜¯æ¯ç§’çš„æ—¶é’Ÿæ»´ç­”æ•° Total_time = (double)(finish - start) / CLOCKS_PER_SEC; // è¾“å‡ºæ‰€è€—è´¹çš„æ—¶é—´ï¼Œç²¾ç¡®åˆ°ç§’ printf(%f seconds , Total_time); return 0; è¯¥ç¨‹åºçš„ä¸»è¦ç›®çš„æ˜¯æµ‹é‡æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œæ‰€éœ€çš„æ—¶é—´ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå®ƒæµ‹é‡äº†æ‰§è¡Œ 10,000,000 æ¬¡ç©ºå¾ªç¯æ‰€éœ€çš„æ—¶é—´ã€‚ åœ¨ C è¯­è¨€ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ clock() å‡½æ•°æ¥è·å–ç¨‹åºåœ¨ä»»æ„æ—¶åˆ»çš„ CPU ä½¿ç”¨æ—¶é—´ã€‚å¼€å§‹çš„æ—¶å€™è®°å½•æ—¶é—´ï¼Œåšå®Œæ‰€æœ‰çš„å¾ªç¯åï¼Œå†æ¬¡è®°å½•æ—¶é—´ï¼Œä»è€Œè®¡ç®—å‡ºæ‰€èŠ±è´¹çš„æ€»æ—¶é•¿ã€‚ ç¤ºä¾‹ç»†èŠ‚ å®šä¹‰çš„å˜é‡ï¼šlong i æ˜¯ä¸€ä¸ªé•¿æ•´å‹å˜é‡ï¼Œåˆå§‹åŒ–ä¸º 10,000,000ã€‚è¿™ä¸ªå˜é‡æ§åˆ¶å¾ªç¯çš„æ¬¡æ•°ï¼Œå®ƒçš„æ•°é‡æ˜æ˜¾è¶³å¤Ÿå¤§ï¼Œä»¥ä¾¿äº§ç”Ÿå¯æµ‹é‡çš„æ—¶é—´å·®ã€‚ æ—¶é—´æµ‹é‡é€»è¾‘ï¼šclock() å‡½æ•°è¿”å›è‡ªç¨‹åºå¯åŠ¨ä»¥æ¥çš„ CPU æ—¶é’Ÿæ•°ï¼Œå¯ä»¥ç”¨æ¥è®¡ç®—ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ã€‚ å¾ªç¯æ“ä½œï¼šwhile (i--) ; è¿™é‡Œçš„ç©ºå¾ªç¯å¹¶æ²¡æœ‰å®é™…å…‘ç°ä»»ä½•æ“ä½œï¼Œå”¯ä¸€çš„ç›®çš„å°±æ˜¯æ¶ˆè€—æ—¶é—´ä»¥è¿›è¡Œæµ‹é‡ã€‚ ç»“æœè¾“å‡ºï¼šç¨‹åºç»“æŸæ—¶ï¼Œä½¿ç”¨ printf è¾“å‡ºæ‰€éœ€æ—¶é—´ï¼Œè¡¨æ˜ç»è¿‡ 10,000,000 æ¬¡ç©ºå¾ªç¯åï¼ŒCPU å®é™…æ¶ˆè€—çš„æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰è¢«æ‰“å°å‡ºæ¥ã€‚ è¾“å‡ºç¤ºä¾‹å¦‚æœè¿è¡Œè¿™ä¸ªç¨‹åºï¼Œè¾“å‡ºå¯èƒ½ç±»ä¼¼äºï¼š Time to do 10000000 empty loops is 0.123456 seconds è¿™é‡Œçš„ 0.123456 ç§’æ˜¯ç¤ºä¾‹æ€§çš„å€¼ï¼Œå®é™…æ—¶é—´å¯èƒ½ä¼šæ ¹æ®è®¡ç®—æœºçš„æ€§èƒ½å’Œå½“å‰è´Ÿè½½æœ‰æ‰€ä¸åŒã€‚æ­¤è¾“å‡ºå‘è¯´æ˜äº† CPU æ‰§è¡Œè¿™äº›ç©ºå¾ªç¯æ‰€éœ€çš„æ—¶é—´ï¼Œè®©èƒ½ç›´è§‚åœ°ç†è§£è¯¥ç‰¹å®šä»£ç å—çš„æ€§èƒ½è¡¨ç°ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","å‡½æ•°"]},{"title":"ç»“æ„ä½“å ç”¨å­—èŠ‚å¤§å°è®¡ç®—","path":"/2024/06/19/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-ç»“æ„ä½“å ç”¨å­—èŠ‚å¤§å°è®¡ç®—/","content":"ç»“æ„ä½“çš„å­—èŠ‚å¯¹é½åœ¨ç¼–ç¨‹ä¸­ï¼Œç»“æ„ä½“çš„å­—èŠ‚æ•°å ç”¨é€šå¸¸ä¾èµ–äºå…¶å†…éƒ¨æœ€å¤§æ•°æ®ç±»å‹çš„å­—èŠ‚é•¿åº¦ã€‚ä¸ºäº†ç¡®ä¿æ•°æ®åœ¨å†…å­˜ä¸­çš„æ­£ç¡®å¯¹é½ï¼Œæœ‰æ—¶ä¼šéœ€è¦è¿›è¡Œå­—èŠ‚è¡¥é½ã€‚äº†è§£è¿™ä¸€ç‚¹ï¼Œå¯å¸®åŠ©æ›´æœ‰æ•ˆåœ°ä½¿ç”¨ç»“æ„ä½“ã€‚ å­—èŠ‚å¯¹é½è§„åˆ™ æœ€å¤§æ•°æ®ç±»å‹ï¼šç»“æ„ä½“çš„æ€»å­—èŠ‚æ•°éœ€æ˜¯å…¶æœ€å¤§æˆå‘˜æ•°æ®ç±»å‹æ‰€å å­—èŠ‚æ•°çš„å€æ•°ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæŸä¸ªç»“æ„ä½“åŒ…å«ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œå¿…é¡»æ ¹æ®å ç”¨å­—èŠ‚æ•°æœ€å¤šçš„ç±»å‹æ¥è°ƒæ•´æ•´ä¸ªç»“æ„ä½“çš„å­—èŠ‚æ•°ã€‚ ç¤ºä¾‹ï¼š å¦‚æœç»“æ„ä½“ä¸­æœ€å¤§çš„å˜é‡æ˜¯ shortï¼ˆå ç”¨ 2 ä¸ªå­—èŠ‚ï¼‰ï¼Œé‚£ä¹ˆæ•´ä¸ªç»“æ„ä½“çš„å¤§å°å¿…é¡»æ˜¯ 2 çš„å€æ•°ã€‚å¦‚æœæ€»å ç”¨å­—èŠ‚æ•°æ˜¯ 7ï¼Œé‚£ä¹ˆå°†å¢åŠ  1 ä¸ªå­—èŠ‚ï¼Œä½¿å…¶å˜ä¸º 8ã€‚ å¦‚æœæœ€å¤§çš„æ˜¯ intï¼ˆå ç”¨ 4 ä¸ªå­—èŠ‚ï¼‰ï¼Œåˆ™ç»“æ„ä½“çš„å¤§å°éœ€æ˜¯ 4 çš„å€æ•°ï¼Œä¾‹å¦‚ 8 æˆ– 12ã€‚ ç¤ºä¾‹ç»“æ„ä½“struct example1 char a; // 1 byte short b; // 2 bytes char c; // 1 byte char d; // 1 byte; // æ€»å ç”¨å­—èŠ‚æ•°ä¸º6ï¼Œæ»¡è¶³æœ€å¤§æ•°æ®ç±»å‹shortçš„2çš„å€æ•°è¦æ±‚struct example2 char a; // 1 byte short b; // 2 bytes char d; // 1 byte; // æ€»å ç”¨å­—èŠ‚æ•°ä¸º6ï¼Œä¾ç„¶æ»¡è¶³2çš„å€æ•°è¦æ±‚struct example3 char a; // 1 byte char c; // 1 byte char d[5]; // 5 bytes; // æ€»å ç”¨å­—èŠ‚æ•°ä¸º7ï¼Œä¸æ»¡è¶³2çš„å€æ•°ï¼Œå› æ­¤éœ€è¦è¡¥é½è‡³8struct example4 char a; // 1 byte short b; // 2 bytes char c[5]; // 5 bytes; // æ€»å ç”¨å­—èŠ‚æ•°ä¸º10ï¼Œæ»¡è¶³2çš„å€æ•°è¦æ±‚ï¼ˆæœ€å¤§çš„æ˜¯shortï¼‰struct example5 char a; // 1 byte char c[5]; // 5 bytes short b; // 2 bytes; // æ€»å ç”¨å­—èŠ‚æ•°ä¸º8ï¼Œæ»¡è¶³2çš„å€æ•°è¦æ±‚ å­—èŠ‚éå¯¹é½è®¾ç½®é€šè¿‡è®¾ç½®ç»“æ„ä½“ä¸ºå­—èŠ‚éå¯¹é½çš„æ–¹å¼ï¼Œå¼€å‘è€…å¯ä»¥å‡å°‘å†…å­˜å ç”¨ï¼Œä½†è¿™ç§æ–¹æ³•ä¼šå¼•å…¥æ½œåœ¨çš„æ€§èƒ½é—®é¢˜ã€‚å› ä¸ºæŸäº›å¤„ç†å™¨å¯¹å†…å­˜çš„è®¿é—®è¦æ±‚ä¸¥æ ¼ï¼Œå¯èƒ½å¯¼è‡´å´©æºƒæˆ–ä¸¥é‡é™ä½è®¿é—®é€Ÿåº¦ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”æ ¹æ®å…·ä½“éœ€è¦æƒè¡¡å­—èŠ‚å¯¹é½ä¸å†…å­˜ä½¿ç”¨çš„ä¼˜åŠ£ã€‚ ç»“æ„ä½“æˆå‘˜ä½è®¾ç½®å¼€å‘è€…å¯ä»¥é€šè¿‡ç‰¹å®šçš„ç¼–è¯‘å™¨æŒ‡ä»¤æˆ–å±•ç°å½¢å¼æ¥è®¾ç½®ç»“æ„ä½“æˆå‘˜æ‰€å ä½ã€‚ ä¹Ÿå¯ä½¿ä½¿ç”¨ #pragma pack å¯ä»¥å¼ºåˆ¶ç¼–è¯‘å™¨ä»¥ç‰¹å®šçš„å­—èŠ‚å¯¹é½æ–¹å¼æ¥å­˜å‚¨ç»“æ„ä½“ï¼Œå…è®¸å¼€å‘è€…æ§åˆ¶æ¯ä¸ªæˆå‘˜çš„å¼€å§‹å¯¹é½ä½ç½®ã€‚ å„ç§æ•°æ®ç±»å‹çš„ç»„åˆç»“æ„ä½“èƒ½å¤ŸåŒ…å«ä¸åŒç±»å‹çš„æ•°æ®ï¼Œåªè¦å®ƒä»¬çš„å­—èŠ‚é•¿åº¦è¢«ç³»ç»Ÿæ˜ç¡®è§„å®šã€‚ä¾‹å¦‚ï¼Œç»“æ„ä½“å¯ä»¥åŒ…å« intã€floatã€double ç­‰å¤šç§ç±»å‹ï¼Œè¿›è¡Œå¤æ‚æ•°æ®çš„ç»„åˆå’Œå­˜å‚¨ã€‚ç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç»“æ„ä½“ä¸èƒ½ç›´æ¥åŒ…å«è‡ªèº«ï¼Œä½†å¯ä»¥åŒ…å«æŒ‡å‘è‡ªèº«çš„æŒ‡é’ˆï¼Œè¿™ä½¿å¾—åœ¨æ„å»ºæ•°æ®ç»“æ„å¦‚é“¾è¡¨æ—¶éå¸¸æœ‰æ•ˆã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€"]},{"title":"è¿ç®—ç¬¦ä¼˜å…ˆçº§","path":"/2024/06/18/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-è¿ç®—ç¬¦ä¼˜å…ˆçº§/","content":"ä¼˜å…ˆçº§C è¯­è¨€ä¸­ï¼Œè¿ç®—ç¬¦çš„è¿ç®—ä¼˜å…ˆçº§å…±åˆ†ä¸º 15 çº§ã€‚1 çº§æœ€é«˜ï¼Œ15 çº§æœ€ä½ã€‚ åœ¨è¡¨è¾¾å¼ä¸­ï¼Œä¼˜å…ˆçº§è¾ƒé«˜çš„å…ˆäºä¼˜å…ˆçº§è¾ƒä½çš„è¿›è¡Œè¿ç®—ã€‚è€Œåœ¨ä¸€ä¸ªè¿ç®—é‡ä¸¤ä¾§çš„è¿ç®—ç¬¦ ä¼˜å…ˆçº§ç›¸åŒæ—¶ï¼Œåˆ™æŒ‰è¿ç®—ç¬¦çš„ç»“åˆæ€§æ‰€è§„å®šçš„ç»“åˆæ–¹å‘å¤„ç†ã€‚ ç»“åˆæ€§C è¯­è¨€ä¸­å„è¿ç®—ç¬¦çš„ç»“åˆæ€§åˆ†ä¸ºä¸¤ç§ï¼Œå³å·¦ç»“åˆæ€§(è‡ªå·¦è‡³å³)å’Œå³ç»“åˆæ€§(è‡ªå³è‡³å·¦)ã€‚ä¾‹å¦‚ç®—æœ¯è¿ç®—ç¬¦çš„ç»“åˆæ€§æ˜¯è‡ªå·¦è‡³å³ï¼Œå³å…ˆå·¦åå³ã€‚å¦‚æœ‰è¡¨è¾¾å¼ x-y+z åˆ™ y åº”å…ˆä¸â€-â€œå·ç»“åˆï¼Œæ‰§è¡Œ x-y è¿ç®—ï¼Œç„¶åå†æ‰§è¡Œ+z çš„è¿ç®—ã€‚è¿™ç§è‡ªå·¦è‡³å³çš„ç»“åˆ æ–¹å‘å°±ç§°ä¸ºâ€å·¦ç»“åˆæ€§â€ã€‚è€Œè‡ªå³è‡³å·¦çš„ç»“åˆæ–¹å‘ç§°ä¸ºâ€å³ç»“åˆæ€§â€ã€‚æœ€å…¸å‹çš„å³ç»“åˆ æ€§è¿ç®—ç¬¦æ˜¯èµ‹å€¼è¿ç®—ç¬¦ã€‚å¦‚ xyz,ç”±äºâ€â€çš„å³ç»“åˆæ€§ï¼Œåº”å…ˆæ‰§è¡Œ yz å†æ‰§è¡Œ x(yz)è¿ç®—ã€‚C è¯­è¨€è¿ç®—ç¬¦ä¸­æœ‰ä¸å°‘ä¸ºå³ç»“åˆæ€§ï¼Œåº”æ³¨æ„åŒºåˆ«ï¼Œä»¥é¿å…ç†è§£é”™è¯¯ã€‚ ä¼˜å…ˆçº§ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡é€’å‡ï¼Œæœ€ä¸Šé¢å…·æœ‰æœ€é«˜çš„ä¼˜å…ˆçº§ï¼Œé€—å·æ“ä½œç¬¦å…·æœ‰æœ€ä½çš„ä¼˜å…ˆçº§ã€‚ æ‰€æœ‰çš„ä¼˜å…ˆçº§ä¸­ï¼Œåªæœ‰ä¸‰ä¸ªä¼˜å…ˆçº§æ˜¯ä»å³è‡³å·¦ç»“åˆçš„ï¼Œå®ƒä»¬æ˜¯å•ç›®è¿ç®—ç¬¦ã€æ¡ä»¶è¿ç®—ç¬¦ã€èµ‹å€¼è¿ç®—ç¬¦ã€‚å…¶å®ƒçš„éƒ½æ˜¯ä»å·¦è‡³å³ç»“åˆã€‚ å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„å…¶å®å¹¶ä¸ç®—æ˜¯çœŸæ­£çš„è¿ç®—ç¬¦ï¼Œå®ƒä»¬ç®—æ˜¯ä¸€ç±»ç‰¹æ®Šçš„æ“ä½œã€‚()æ˜¯ä¸å‡½æ•°ç›¸å…³ï¼Œ[]ä¸æ•°ç»„ç›¸å…³ï¼Œè€Œ-åŠ.æ˜¯å–ç»“æ„æˆå‘˜ã€‚ å…¶æ¬¡æ˜¯å•ç›®è¿ç®—ç¬¦ï¼Œæ‰€æœ‰çš„å•ç›®è¿ç®—ç¬¦å…·æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ï¼Œå› æ­¤åœ¨è®¤ä¸ºçš„ çœŸæ­£çš„è¿ç®—ç¬¦ä¸­å®ƒä»¬å…·æœ‰æœ€é«˜çš„ä¼˜å…ˆçº§ï¼Œåˆç”±äºå®ƒä»¬éƒ½æ˜¯ä»å³è‡³å·¦ç»“åˆçš„ï¼Œå› æ­¤p++ä¸(p++)ç­‰æ•ˆæ˜¯æ¯«æ— ç–‘é—®çš„ã€‚ å¦å¤–åœ¨ C è¯­è¨€é‡Œï¼Œæ²¡æœ‰å‰ç½®åç½®ä¹‹åˆ†ï¼Œå› ä¸º++ â€“ æ˜¯å³ç»“åˆæ‰€ä»¥å³ä¾§ä¼˜å…ˆè¿ç®—ï¼Œè¡¨ç°ä¸º â€œæ“ä½œæ•°åç½®ä¼˜å…ˆçº§æ¯”è¾ƒé«˜â€ çš„å‡è±¡ï¼Œå‰ç½®å’Œåç½®çš„åŒºåˆ†æ˜¯å› ä¸ºè¿ç®—ç¬¦é‡è½½è€ŒååŠ å…¥ C++çš„ æ¥ä¸‹æ¥æ˜¯ç®—æœ¯è¿ç®—ç¬¦ï¼Œ*ã€/ã€% çš„ä¼˜å…ˆçº§å½“ç„¶æ¯” +ã€- é«˜äº†ã€‚ç§»ä½è¿ç®—ç¬¦ç´§éšå…¶åã€‚ å…¶æ¬¡çš„å…³ç³»è¿ç®—ç¬¦ä¸­ï¼Œ = = è¦æ¯” == != é«˜ä¸€ä¸ªçº§åˆ«ï¼Œä¸å¤§å¥½ç†è§£ã€‚ æ‰€æœ‰çš„é€»è¾‘æ“ä½œç¬¦éƒ½å…·æœ‰ä¸åŒçš„ä¼˜å…ˆçº§(å•ç›®è¿ç®—ç¬¦é™¤å¤–ï¼Œ!å’Œ~) é€»è¾‘ä½æ“ä½œç¬¦çš„â€ä¸â€æ¯”â€æˆ–â€é«˜ï¼Œè€Œâ€å¼‚æˆ–â€åˆ™åœ¨å®ƒä»¬ä¹‹é—´ã€‚ è·Ÿåœ¨å…¶åçš„ æ¯” || é«˜ã€‚ æ¥ä¸‹æ¥çš„æ˜¯æ¡ä»¶è¿ç®—ç¬¦ï¼Œèµ‹å€¼è¿ç®—ç¬¦åŠé€—å·è¿ç®—ç¬¦ã€‚ åœ¨ C è¯­è¨€ä¸­ï¼Œåªæœ‰ 4 ä¸ªè¿ç®—ç¬¦è§„å®šäº†è¿ç®—æ–¹å‘ï¼Œå®ƒä»¬æ˜¯ ã€| |ã€æ¡ä»¶è¿ç®—ç¬¦åŠèµ‹å€¼è¿ç®—ç¬¦ã€‚ ã€| | éƒ½æ˜¯å…ˆè®¡ç®—å·¦è¾¹è¡¨è¾¾å¼çš„å€¼ï¼Œå½“å·¦è¾¹è¡¨è¾¾å¼çš„å€¼èƒ½ç¡®å®šæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼æ—¶ï¼Œå°±ä¸å†è®¡ç®—å³è¾¹è¡¨è¾¾å¼çš„å€¼ã€‚å¦‚ a = 0 b; è¿ç®—ç¬¦çš„å·¦è¾¹ä½ 0ï¼Œåˆ™å³è¾¹è¡¨è¾¾å¼ b å°±ä¸å†åˆ¤æ–­ã€‚ åœ¨æ¡ä»¶è¿ç®—ç¬¦ä¸­ã€‚å¦‚ a?b:c;å…ˆåˆ¤æ–­ a çš„å€¼ï¼Œå†æ ¹æ® a çš„å€¼å¯¹ b æˆ– c ä¹‹ä¸­çš„ä¸€ä¸ªè¿›è¡Œæ±‚å€¼ã€‚ èµ‹å€¼è¡¨è¾¾å¼åˆ™è§„å®šå…ˆå¯¹å³è¾¹çš„è¡¨è¾¾å¼æ±‚å€¼ï¼Œå› æ­¤ä½¿ a = b = c = 6;æˆä¸ºå¯èƒ½ã€‚ å£è¯€æ³¨é‡Š- åœ†æ–¹æ‹¬å·ã€ç®­å¤´ä¸€å¥å·ï¼Œ è‡ªå¢è‡ªå‡éåè´Ÿã€é’ˆå¼ºåœ°å€é•¿åº¦ï¼Œ- ä¹˜é™¤ï¼ŒåŠ å‡ï¼Œå†ç§»ä½ï¼Œå°ç­‰å¤§ç­‰ã€ç­‰ç­‰ä¸ç­‰ï¼Œ- å…«ä½ä¸ï¼Œä¸ƒä½å¼‚ï¼Œå…­ä½æˆ–ï¼Œäº”ä¸ï¼Œå››æˆ–ï¼Œä¸‰ç–‘ï¼ŒäºŒèµ‹ï¼Œä¸€çœŸé€—ã€‚- åœ†æ–¹æ‹¬å·ã€ç®­å¤´ä¸€å¥å·æŒ‡çš„æ˜¯ç¬¬ 15 çº§çš„è¿ç®—ç¬¦ã€‚å…¶ä¸­åœ†æ–¹æ‹¬å·å¾ˆæ˜æ˜¾()ã€[]ï¼Œç®­å¤´ æŒ‡çš„æ˜¯æŒ‡å‘ç»“æ„ä½“æˆå‘˜è¿ç®—ç¬¦-ï¼Œå¥å· æŒ‡çš„æ˜¯ç»“æ„ä½“æˆå‘˜è¿ç®—ç¬¦. ;- è‡ªå¢è‡ªå‡éåè´Ÿã€é’ˆå¼ºåœ°å€é•¿åº¦æŒ‡çš„æ˜¯ç¬¬ 14 çº§çš„è¿ç®—ç¬¦ã€‚å…¶ä¸­ é æŒ‡çš„æ˜¯é€»è¾‘è¿ç®—ç¬¦!ï¼Œå æŒ‡çš„æ˜¯æŒ‰ä½å–åè¿ç®—ç¬¦~ï¼Œè´Ÿ æŒ‡çš„æ˜¯è´Ÿå·è¿ç®—ç¬¦-ï¼Œé’ˆ æŒ‡çš„æ˜¯æŒ‡é’ˆè¿ç®—ç¬¦*ï¼Œå¼º æŒ‡çš„æ˜¯å¼ºåˆ¶ç±»å‹è½¬æ¢è¿ç®—ç¬¦ï¼Œåœ°å€ æŒ‡çš„æ˜¯åœ°å€è¿ç®—ç¬¦ï¼Œé•¿åº¦ æŒ‡çš„æ˜¯é•¿åº¦è¿ç®—ç¬¦sizeof ;- ä¹˜é™¤ï¼ŒåŠ å‡ï¼Œå†ç§»ä½ç§»ä½æŒ‡çš„æ˜¯å·¦ç§»è¿ç®—ç¬¦å’Œå³ç§»è¿ç®—ç¬¦ï¼Œå…¶ä¸­é™¤æ³•è¿˜åŒ…æ‹¬äº† å–ä½™è¿ç®—ç¬¦%;- å°ç­‰å¤§ç­‰ã€ç­‰ç­‰ä¸ç­‰ æŒ‡çš„æ˜¯ç¬¬ 10 çº§åˆ°ç¬¬ 9 çº§çš„è¿ç®—ç¬¦:ã€=ã€å’Œ=ï¼Œç­‰ç­‰æŒ‡çš„æ˜¯ç­‰äºè¿ç®—ç¬¦==ï¼Œä¸ç­‰æŒ‡çš„æ˜¯ä¸ç­‰äºè¿ç®—ç¬¦!=- å…«ä½ä¸ï¼Œä¸ƒä½å¼‚ï¼Œå…­ä½æˆ–å…¶ä¸­ å…«ä½ä¸ æŒ‡çš„æ˜¯ç¬¬ 8 çº§çš„ æŒ‰ä½ä¸ è¿ç®—ç¬¦ï¼Œä¸ƒä½å¼‚ æŒ‡çš„æ˜¯ç¬¬ 7 çº§çš„æŒ‰ä½å¼‚æˆ–è¿ç®—ç¬¦^ï¼Œå…­ä½æˆ– æŒ‡çš„æ˜¯ç¬¬ 6 çº§çš„æŒ‰ä½æˆ–è¿ç®—ç¬¦|;- äº”ä¸ï¼Œå››æˆ–æŒ‡çš„æ˜¯ç¬¬ 5 çº§ã€ç¬¬ 4 çº§çš„é€»è¾‘ä¸è¿ç®—ç¬¦å’Œé€»è¾‘æˆ–è¿ç®—ç¬¦||;- ä¸‰ç–‘ï¼ŒäºŒèµ‹ï¼Œä¸€çœŸé€—æŒ‡çš„æ˜¯ç¬¬ 3 çº§åˆ°ç¬¬ 1 çº§çš„è¿ç®—ç¬¦ã€‚å…¶ä¸­ï¼Œä¸‰ç–‘æŒ‡çš„æ˜¯æ¡ä»¶è¿ç®—ç¬¦?: (ä¸‰æœ‰åŒé‡å«ä¹‰:å³æŒ‡ä¼˜å…ˆçº§åˆ«æ˜¯ä¸‰ï¼Œå®ƒçš„è¿ç®—ç¬¦ç±»å‹ä¹Ÿæ˜¯ä¸‰ç›®ï¼Œç–‘ä¹Ÿå–?ä¹‹æ„)ï¼ŒäºŒèµ‹ æŒ‡çš„æ˜¯èµ‹å€¼è¿ç®—ç¬¦=ã€+=ã€-=ã€*=ã€/=ã€%=ã€=ã€=ã€=ã€^=å’Œ|= ï¼Œä¸€çœŸé€— æŒ‡çš„æ˜¯ç¬¬ 1 çº§çš„ï¼Œè¿ç®—ç¬¦ï¼ŒçœŸå­—åªæ˜¯ä¸ºäº†è¯­å¥éœ€è¦ç½¢äº†ã€‚ åº”ç”¨ä¸¾ä¾‹ èµ‹å€¼è¿ç®—ç¬¦: a=5; a=b=0; ç¬¬ä¸€ä¸ªèµ‹å€¼è¯­å¥å°†æ•´æ•° 5 èµ‹ç»™å˜é‡ aã€‚ç¬¬äºŒä¸ªèµ‹å€¼è¯­å¥åŒæ—¶æŠŠ 0 èµ‹ç»™ä¸¤ä¸ªå˜é‡ b å’Œ aã€‚è¿™æ˜¯å› ä¸ºèµ‹å€¼è¿ç®—ä»å³å‘å·¦è¿›è¡Œï¼Œé¦–å…ˆæ‰§è¡Œ b=0ï¼Œç„¶åå°† b çš„å€¼ï¼ˆ0ï¼‰èµ‹ç»™ aã€‚å› æ­¤ï¼Œæœ€ç»ˆ a å’Œ b çš„å€¼éƒ½æ˜¯ 0ã€‚ å¤åˆèµ‹å€¼è¿ç®—ç¬¦: a=1; a+=3; ä¸Šè¿°å¤åˆèµ‹å€¼å¯ä»¥ç†è§£ä¸ºï¼šé¦–å…ˆå°† 1 èµ‹ç»™ aï¼Œç„¶åæ‰§è¡Œ a+=3ï¼Œå®ƒç›¸å½“äº a=a+3ã€‚æ‰€ä»¥ï¼Œ3 åŠ åˆ°åŸæœ¬çš„ 1 ä¸Šï¼Œæœ€ç»ˆç»“æœä¸º 4ã€‚å› æ­¤ï¼Œa çš„æœ€ç»ˆå€¼æ˜¯ 4ã€‚ ç®—æœ¯è¿ç®—ç¬¦: Area=Height*Width; num=num1+num2/num3-num4; ç¬¬ä¸€ä¸ªèµ‹å€¼è¯­å¥å°† Height å’Œ Width çš„ä¹˜ç§¯èµ‹ç»™å˜é‡ Areaã€‚è¿™ç”¨äºè®¡ç®—çŸ©å½¢çš„é¢ç§¯ï¼Œä¾‹å¦‚å½“ Height10ï¼ŒWidth5 æ—¶ï¼ŒArea50ã€‚ç¬¬äºŒä¸ªèµ‹å€¼è¯­å¥ä¸­ï¼Œé¦–å…ˆè®¡ç®— num2 ä¸ num3 çš„é™¤æ³•ï¼Œä¹‹åå°†ç»“æœä¸ num1 ç›¸åŠ ï¼Œæœ€åå‡å» num4ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ num1=10ï¼Œnum2=20ï¼Œnum3=5ï¼Œnum4=3ï¼Œé‚£ä¹ˆè®¡ç®—é¡ºåºä¾æ¬¡æ˜¯ 20/5=4ï¼Œç„¶å 10+4-3=11ï¼Œæ‰€ä»¥ num çš„å€¼ä¸º 11ã€‚ é€»è¾‘è¿ç®—ç¬¦: a=1, b=1; a||b-1; è¿™é‡Œ a=1 è¡¨ç¤ºé€»è¾‘çœŸï¼Œå› æ­¤æ•´ä¸ªè¡¨è¾¾å¼ a || b-1 çš„ç»“æœä¹Ÿæ˜¯é€»è¾‘çœŸã€‚åœ¨é€»è¾‘è¿ç®—ä¸­ï¼Œå¦‚æœä¸€ä¸ªè¿ç®—ç¬¦çš„æŸä¸ªæ“ä½œæ•°ä¸ºçœŸï¼Œåé¢çš„éƒ¨åˆ†å°±ä¸å†è®¡ç®—ã€‚ä¾‹å¦‚ï¼Œæ— è®º b-1 çš„ç»“æœå¦‚ä½•ï¼Œæ€»ä½“è¡¨è¾¾å¼éƒ½ä¸ºçœŸã€‚ å…³ç³»è¿ç®—ç¬¦: if(a0)... è¿™ä¸ªè¯­å¥æ£€æŸ¥ a æ˜¯å¦å¤§äº 0ã€‚å¦‚æœæ¡ä»¶ä¸ºçœŸï¼ˆå³ a çš„å€¼ç¡®å®å¤§äº 0ï¼‰ï¼Œé‚£ä¹ˆå°†æ‰§è¡Œ if å—å†…çš„å†…å®¹ï¼›å¦‚æœæ¡ä»¶ä¸ºå‡ï¼Œåˆ™ç¨‹åºå°†è·³è¿‡è¿™ä¸ªå—ã€‚è¿™é€šå¸¸ç”¨äºæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚ æ¡ä»¶è¿ç®—ç¬¦: a=(b0)?b:-b; è¿ç®—ä¸­ï¼Œå¦‚æœ b å¤§äº 0ï¼Œåˆ™å°† b çš„å€¼èµ‹ç»™ aï¼›å¦‚æœ b ä¸å¤§äº 0ï¼Œåˆ™å°† -bï¼ˆå³ b çš„ç›¸åæ•°ï¼‰èµ‹ç»™ aã€‚è¿™ä¸ªè¿ç®—ç¬¦çš„ä½œç”¨ç±»ä¼¼äºè·å– b çš„ç»å¯¹å€¼ï¼Œå…·ä½“è§£é‡Šä¸ºå½“ b ä¸º -3 æ—¶ï¼Œa ä¼šå¾—åˆ° 3ã€‚ é€—å·è¿ç®—ç¬¦: b=2, c=7, d=5; a=(++b, c--, d+3); è¿™é‡Œæœ‰ä¸‰ä¸ªè¡¨è¾¾å¼ç”¨é€—å·åˆ†éš”ã€‚é€—å·è¿ç®—ç¬¦ä»å·¦åˆ°å³ä¾æ¬¡è®¡ç®—æ¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä½†æ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ç­‰äºæœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ++b å’Œ c-- çš„ç»“æœè™½ç„¶è¢«è®¡ç®—ï¼Œä½†å¹¶æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œæœ€å d+3 çš„è®¡ç®—ç»“æœæ˜¯ 8ï¼Œå› æ­¤ a=8ã€‚ ä½é€»è¾‘è¿ç®—ç¬¦ ä½é€»è¾‘è¿ç®—ç¬¦åŒ…æ‹¬ï¼š ï¼ˆä½ä¸ï¼‰ |ï¼ˆä½æˆ–ï¼‰ ^ï¼ˆä½å¼‚æˆ–ï¼‰ ~ï¼ˆä½å–åï¼‰ ä»¥æ“ä½œæ•° 12 ä¸ºä¾‹ï¼Œæ•°å­— 12 åœ¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸º 1100ã€‚ä½è¿ç®—ç¬¦å°†æ•°å­—çœ‹ä½œäºŒè¿›åˆ¶ä½è¿›è¡Œæ“ä½œã€‚æ¯”å¦‚ï¼š è¡¨è¾¾å¼ 1015 è¡¨ç¤º 1010 1111ï¼Œè¿”å›å€¼ä¸º 10ï¼Œå› ä¸ºäºŒè¿›åˆ¶çš„ 1010 å’Œ 1111 åœ¨æ¯ä¸€ä½ä¸Šéƒ½è¿›è¡Œäº†ä¸è¿ç®—ï¼Œç»“æœæ˜¯ 1010ã€‚ è¡¨è¾¾å¼ 10|15 è¡¨ç¤º 1010 | 1111ï¼Œè¿”å›å€¼ä¸º 15ï¼Œä»»ä½•ä½ä¸­æœ‰å€¼ä¸º 1 çš„éƒ½ä¸ºçœŸï¼Œå› æ­¤ç»“æœä¸º 1111ã€‚ è¡¨è¾¾å¼ 10^15 è¡¨ç¤º 1010 ^ 1111ï¼Œè¿”å›å€¼ä¸º 5ï¼Œåªæœ‰åœ¨å¯¹åº”ä½ä¸åŒæ—¶è¯¥ä½æ‰ä¸ºçœŸï¼Œç»“æœä¸º 0101ã€‚ è¡¨è¾¾å¼ ~10 è¡¨ç¤º ~1010ï¼Œè¿”å›å€¼ä¸º -11ï¼Œå› ä¸ºå…¶æŒ‰ä½å–åï¼Œç»“æœä¸º 0101ï¼Œåœ¨ä½¿ç”¨è¡¥ç è¡¨ç¤ºæ—¶ä¸º -11ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€"]},{"title":"Cè¯­è¨€åŸºç¡€","path":"/2024/06/17/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-Cè¯­è¨€åŸºç¡€/","content":"åŸºæœ¬æ•°æ®ç±»å‹char: 1 Bytes : 8 bitsshort:2 Bytes : 16 bitsint: 4 Bytes : 32 bitslong: 4 Bytes : 32 bitsfloat: 4 Bytes : 32 bitsdouble: 8 Bytes : 64 bitslong long: 8 Bytes : 64 bitslong double: 16 Bytes : 96 bits æ•°æ®ç±»å‹å­˜å‚¨æ•°æ®åœ¨å†…å­˜ä¸­ä»¥è¡¥ç å½¢å¼å­˜å‚¨ï¼ˆæº¢å‡ºæ—¶æˆªå–è¡¥ç çš„ä¸€æ®µï¼ˆç„¶åæ±‚åŸç åœ¨è¾“å‡ºï¼‰ï¼‰ char c;c = 1222;printf(%d %c ,c ,c); å…³é”®å­—autoæ•°æ®å­˜æ”¾åœ¨æ ˆä¸Š register ä¸èƒ½ç”¨è¿ç®—ç¬¦è· å– regi ste r å˜é‡çš„åœ°å€ register å˜é‡çš„å¿…é¡»æ˜¯ CPU å¯„å­˜å™¨å¯ä»¥æ¥å—çš„å€¼ register å…³é”®å­—æŒ‡æ˜å°†å˜é‡å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­ register åªæ˜¯è¯·æ±‚å¯„å­˜ å™¨å˜é‡ï¼Œ ä½†ä¸ä¸€å®šæˆåŠŸï¼Œå¦‚æœæ²¡æœ‰ç”³è¯·åˆ°ç©ºé—´ï¼Œé‚£ä¹ˆè¯¥å˜é‡ä¸ auto å˜é‡æ²¡æœ‰åŒºåˆ« staticï¼ˆå°†å€¼æ”¾åœ¨äº†æ•°æ®æ®µï¼Œæ‰€ä»¥å®ƒçš„å€¼åœ¨å…¨å±€éƒ½å…·æœ‰ç»§æ‰¿æ€§ï¼ˆä½†ä¸å…·æœ‰è®¿é—®æ€§ï¼Œåªåœ¨è¯¥å‡½æ•°å†…éƒ¨å¯ä»¥è®¿é—®ï¼‰ï¼‰ ï¼ˆé™åˆ¶ä½œç”¨åŸŸï¼‰ stati c å…³é”®å­—æŒ‡æ˜å˜é‡çš„â€é™æ€â€å±æ€§ static å…³é”®åŒæ—¶å…·æœ‰â€ä½œç”¨åŸŸé™å®šç¬¦â€çš„æ„ä¹‰ static ä¿®é¥°çš„å±€éƒ¨å˜é‡å­˜å‚¨åœ¨ç¨‹åºé™æ€åŒº static çš„å¦ä¸€ä¸ªæ„ä¹‰æ˜¯æ–‡ä»¶ä½œç”¨åŸŸæ ‡è¯†ç¬¦ static ä¿®é¥°çš„å…¨å±€å˜é‡ä½œç”¨åŸŸåªæ˜¯å£°æ˜çš„æ–‡ä»¶ä¸­ static ä¿®é¥°çš„å‡½æ•°ä½œç”¨åŸŸåªæ˜¯å£°æ˜çš„æ–‡ä»¶ä¸­ ä¸º ä½• static åœ¨ fu n å‡½æ•°ä¸­ å®šä¹‰ä¸ºå…¨å±€å˜é‡ä¸è¡Œï¼Ÿ å±€éƒ¨å˜é‡ç”Ÿå‘½å‘¨æœŸä¸ºå‡½æ•°è¿è¡ŒæœŸé—´ï¼Œ åŠ ä¸Š stat ic ç±»å‹åï¼Œç”Ÿå‘½å‘¨æœŸä¸ºç¨‹åºè¿è¡ŒæœŸé—´ï¼Œä½†åªå¯åœ¨å‡½æ•°ä¸­è¿›è¡Œè®¿é—® ä¿®æ”¹å˜é‡çš„å‚¨å­˜ç±»å‹ï¼ˆå°†æ•°æ®ä»æ ˆä¸Šæ”¾åˆ°äº†æ•°æ®æ®µï¼‰å¹¶ä¸è¡¨ç¤ºä¿®æ”¹å˜é‡çš„ä½œç”¨åŸŸ!å®ƒä»ç„¶åªèƒ½åœ¨è¯¥ä»£ç å—å†…éƒ¨æŒ‰åå­—è®¿é—®ã€‚ externå¤–éƒ¨å‚ç…§å¼•ç”¨ï¼ˆå…¶ä»–æ–‡ä»¶ä¸­ï¼ˆç¼–è¯‘æ—¶åº”è¯¥ä¸€èµ·ï¼‰æ‰€æœ‰å‡½æ•°ä½“å¤–éƒ¨è¯´æ˜çš„å˜é‡ï¼‰ ï¼ˆç±»ä¼¼äºå£°æ˜ï¼Ÿï¼‰ ï¼ˆexter n å»¶é•¿äº†å…¨å±€å˜é‡çš„ä½œç”¨åŸŸï¼ˆåˆ°å…¶ä»–æ–‡ä»¶ä¸­ ç”¨ exter n å¼•ç”¨ï¼‰ï¼Œä¸å…·æœ‰æ”¹å˜å€¼å’Œç±»å‹çš„åŠŸèƒ½) ï¼ˆä¸åˆ†é…å†…å­˜ï¼Œä¸èƒ½åˆå§‹åŒ–ï¼‰ï¼‰ ï¼ˆä¸å¯ä»¥æ”¹å˜ç±»å‹ï¼‰ exter n å…³é”®å­—çš„ä½¿ç”¨ï¼š ï¼ˆå…· æœ‰ externa l é“¾æ¥å±æ€§ï¼Œå‚¨å­˜äºé™æ€å†…å­˜ä¸­ï¼‰ å¦‚æœä¸€ä¸ªå˜é‡å£°æ˜äºå‡½æ•°ä»£ç å—å†…éƒ¨ï¼Œåœ¨å®ƒå‰é¢æ·» åŠ  exter n å…³é”®å­—å°†ä½¿å®ƒæ‰€å¼•ç”¨çš„æ˜¯å…¨å±€å˜é‡ï¼Œè€Œéå±€éƒ¨å˜é‡ï¼› å£°æ˜äºå‡½æ•°æœ€å¤–å±‚ä½œç”¨åŸŸçš„å±€éƒ¨å˜é‡æ— æ³•ä¸å½¢å‚åŒåï¼Œå› ä¸ºä»–ä»¬çš„ä½œç”¨åŸŸç›¸åŒ å±€éƒ¨å˜é‡ç”Ÿæ•ˆçš„èŒƒå›´å†…ï¼Œä¼šè‡ªåŠ¨å±è”½å…¨å±€å˜é‡ exter n ä½¿å…¨å±€å˜ é‡ i åœ¨ fu n ä¸­å¯ä»¥è¢«è®¿é—®ï¼Œå¦‚æœæ²¡ æœ‰ extern åœ¨å‡½æ•°ä¸­ï¼Œ i å°†å˜ä¸ºå±€éƒ¨å˜é‡ã€‚ exter n åªæ˜¯å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œè¯¥å˜é‡éœ€åœ¨åˆ«å¤„å·²è¢«å®šä¹‰ constæŒ‡å®šå˜é‡ä¸å¯è¢«å½“å‰çº¿ç¨‹æ”¹å˜ï¼ˆä½†æœ‰å¯èƒ½è¢«ç³»ç»Ÿæˆ–å…¶ä»–çº¿ç¨‹æ”¹å˜ï¼‰ã€‚ å…³é”®å­—â€staticâ€ï¼Œè¯‘æˆä¸­æ–‡å°±æ˜¯â€é™æ€çš„â€ï¼Œæ‰€ä»¥å†…éƒ¨å‡½æ•°åˆç§°é™æ€å‡½æ•°ã€‚ä½†æ­¤å¤„â€staticâ€çš„å«ä¹‰ä¸æ˜¯æŒ‡å­˜å‚¨æ–¹å¼ï¼Œè€Œæ˜¯æŒ‡å¯¹å‡½æ•°çš„ä½œç”¨åŸŸä»…å±€é™äºæœ¬æ–‡ä»¶ã€‚ ä½¿ç”¨å†…éƒ¨å‡½æ•°çš„å¥½å¤„æ˜¯ï¼šä¸åŒçš„äººç¼–å†™ä¸åŒçš„å‡½æ•°æ—¶ï¼Œä¸ç”¨æ‹…å¿ƒè‡ªå·±å®šä¹‰çš„å‡½æ•°ï¼Œæ˜¯å¦ä¼šä¸å…¶å®ƒæ–‡ä»¶ä¸­çš„å‡½æ•°åŒåï¼Œå› ä¸ºåŒåä¹Ÿæ²¡æœ‰å…³ç³»ã€‚ å±€éƒ¨ static å˜é‡ a.é™æ€å±€éƒ¨å˜é‡åœ¨å‡½æ•°å†…å®šä¹‰,ç”Ÿå­˜æœŸä¸ºæ•´ä¸ªæºç¨‹åºï¼Œä½†ä½œç”¨åŸŸä¸è‡ªåŠ¨å˜é‡ç›¸åŒï¼Œåªèƒ½åœ¨å®šä¹‰è¯¥å˜é‡çš„å‡½æ•°å†…ä½¿ç”¨ã€‚é€€å‡ºè¯¥å‡½æ•°åï¼Œ å°½ç®¡è¯¥å˜é‡è¿˜ç»§ç»­å­˜åœ¨ï¼Œä½†ä¸èƒ½ä½¿ç”¨å®ƒã€‚ b.å¯¹åŸºæœ¬ç±»å‹çš„é™æ€å±€éƒ¨å˜é‡è‹¥åœ¨è¯´æ˜æ—¶æœªèµ‹ä»¥åˆå€¼ï¼Œåˆ™ç³»ç»Ÿè‡ªåŠ¨èµ‹äºˆ 0 å€¼ã€‚è€Œå¯¹è‡ªåŠ¨å˜é‡ä¸èµ‹åˆå€¼ï¼Œåˆ™å…¶å€¼æ˜¯ä¸å®šçš„ã€‚ å…¨å±€ static å˜é‡ å…¨å±€å˜é‡æœ¬èº«å°±æ˜¯é™æ€å­˜å‚¨æ–¹å¼ï¼Œ é™æ€å…¨å±€å˜é‡å½“ç„¶ä¹Ÿæ˜¯é™æ€å­˜å‚¨æ–¹å¼ã€‚ä½†æ˜¯ä»–ä»¬çš„ä½œç”¨åŸŸï¼Œéé™æ€å…¨å±€ å˜é‡çš„ä½œç”¨åŸŸæ˜¯æ•´ä¸ªæºç¨‹åºï¼ˆå¤šä¸ªæºæ–‡ä»¶å¯ä»¥å…±åŒä½¿ç”¨ï¼‰ã€‚é™æ€å…¨å±€å˜é‡åˆ™é™åˆ¶äº†å…¶ä½œç”¨åŸŸï¼Œ å³åªåœ¨å®šä¹‰è¯¥å˜é‡çš„æºæ–‡ä»¶å†…æœ‰æ•ˆï¼Œ åœ¨åŒä¸€æºç¨‹åºçš„å…¶å®ƒæºæ–‡ä»¶ä¸­ä¸èƒ½ä½¿ç”¨å®ƒã€‚ static å‡½æ•°ï¼ˆä¹Ÿå«å†…éƒ¨å‡½æ•°ï¼‰ åªèƒ½è¢«æœ¬æ–‡ä»¶ä¸­çš„å‡½æ•°è°ƒç”¨ï¼Œè€Œä¸èƒ½è¢«åŒä¸€ç¨‹åºå…¶å®ƒæ–‡ä»¶ä¸­çš„å‡½æ•°è°ƒç”¨ã€‚åŒºåˆ«äºä¸€èˆ¬çš„éé™æ€å‡½æ•°ï¼ˆå¤–éƒ¨å‡½æ•°ï¼‰ static åœ¨ c é‡Œé¢å¯ä»¥ç”¨æ¥ä¿®é¥°å˜é‡ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ä¿®é¥°å‡½æ•°ã€‚ å…ˆçœ‹ç”¨æ¥ä¿®é¥°å˜é‡çš„æ—¶å€™ã€‚å˜é‡åœ¨ c é‡Œé¢å¯åˆ†ä¸ºå­˜åœ¨å…¨å±€æ•°æ®åŒºã€æ ˆå’Œå †é‡Œã€‚å…¶å®ä»¬å¹³æ—¶æ‰€è¯´çš„å †æ ˆæ˜¯æ ˆè€Œä¸åŒ…å«å¯¹ï¼Œä¸è¦å¼„æ··ã€‚ åˆ¤æ–­ ip åœ°å€åˆæ³• åˆ¤æ–­å¤§å°ç«¯ å †æ ˆåŒºåˆ«ï¼Œstatic const voliate å…³é”®å­—å­˜å‚¨æ¨¡å‹å…¨å±€é™æ€å˜é‡å…¨å±€å˜é‡(å¤–éƒ¨å˜é‡)çš„è¯´æ˜ä¹‹å‰å†å† ä»¥ static å°±æ„æˆäº†é™æ€çš„å…¨å±€å˜é‡ã€‚å…¨å±€å˜é‡æœ¬èº«å°±æ˜¯é™æ€å­˜å‚¨æ–¹å¼ï¼Œ é™æ€å…¨å±€å˜é‡å½“ç„¶ä¹Ÿæ˜¯é™æ€å­˜å‚¨æ–¹å¼ã€‚è¿™ä¸¤è€…åœ¨å­˜å‚¨æ–¹å¼ä¸Šå¹¶æ— ä¸åŒã€‚è¿™ä¸¤è€…çš„åŒºåˆ«è™½åœ¨äºéé™æ€å…¨å±€å˜é‡çš„ä½œç”¨åŸŸæ˜¯æ•´ä¸ªæºç¨‹åºï¼Œ å½“ä¸€ä¸ªæºç¨‹åºç”±å¤šä¸ªæºæ–‡ä»¶ç»„æˆæ—¶ï¼Œéé™æ€çš„å…¨å±€å˜é‡åœ¨å„ä¸ªæºæ–‡ä»¶ä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚ è€Œé™æ€å…¨å±€å˜é‡åˆ™é™åˆ¶äº†å…¶ä½œç”¨åŸŸï¼Œ å³åªåœ¨å®šä¹‰è¯¥å˜é‡çš„æºæ–‡ä»¶å†…æœ‰æ•ˆï¼Œ åœ¨åŒä¸€æºç¨‹åºçš„å…¶å®ƒæºæ–‡ä»¶ä¸­ä¸èƒ½ä½¿ç”¨å®ƒã€‚ç”±äºé™æ€å…¨å±€å˜é‡çš„ä½œç”¨åŸŸå±€é™äºä¸€ä¸ªæºæ–‡ä»¶å†…ï¼Œåªèƒ½ä¸ºè¯¥æºæ–‡ä»¶å†…çš„å‡½æ•°å…¬ç”¨ï¼Œ å› æ­¤å¯ä»¥é¿å…åœ¨å…¶å®ƒæºæ–‡ä»¶ä¸­å¼•èµ·é”™è¯¯ã€‚ static å…¨å±€å˜é‡ä¸æ™®é€šçš„å…¨å±€å˜é‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼šstatic å…¨å±€å˜é‡åªåˆä½¿åŒ–ä¸€æ¬¡ï¼Œé˜²æ­¢åœ¨å…¶ä»–æ–‡ä»¶å•å…ƒä¸­è¢«å¼•ç”¨; static å±€éƒ¨å˜é‡å’Œæ™®é€šå±€éƒ¨å˜é‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼šstatic å±€éƒ¨å˜é‡åªè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¸‹ä¸€æ¬¡ä¾æ®ä¸Šä¸€æ¬¡ç»“æœå€¼ï¼› static å‡½æ•°ä¸æ™®é€šå‡½æ•°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼šstatic å‡½æ•°åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä»½ï¼Œæ™®é€šå‡½æ•°åœ¨æ¯ä¸ªè¢«è°ƒç”¨ä¸­ç»´æŒä¸€ä»½æ‹·è´ã€‚ C ç¨‹åºä¸€ç›´ç”±ä¸‹åˆ—éƒ¨åˆ†ç»„æˆï¼š æ­£æ–‡æ®µâ€”â€”CPU æ‰§è¡Œçš„æœºå™¨æŒ‡ä»¤éƒ¨åˆ†ï¼›ä¸€ä¸ªç¨‹åºåªæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼›åªè¯»ï¼Œé˜²æ­¢ç¨‹åºç”±äºæ„å¤–äº‹æ•…è€Œä¿®æ”¹è‡ªèº«æŒ‡ä»¤ï¼› åˆå§‹åŒ–æ•°æ®æ®µï¼ˆæ•°æ®æ®µï¼‰â€”â€”åœ¨ç¨‹åºä¸­æ‰€æœ‰èµ‹äº†åˆå€¼çš„å…¨å±€å˜é‡ï¼Œå­˜æ”¾åœ¨è¿™é‡Œã€‚ éåˆå§‹åŒ–æ•°æ®æ®µï¼ˆbss æ®µï¼‰â€”â€”åœ¨ç¨‹åºä¸­æ²¡æœ‰åˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼›å†…æ ¸å°†æ­¤æ®µåˆå§‹åŒ–ä¸º 0ã€‚ æ ˆâ€”â€”å¢é•¿æ–¹å‘ï¼šè‡ªé¡¶å‘ä¸‹å¢é•¿ï¼›è‡ªåŠ¨å˜é‡ä»¥åŠæ¯æ¬¡å‡½æ•°è°ƒç”¨æ—¶æ‰€éœ€è¦ä¿å­˜çš„ä¿¡æ¯ï¼ˆè¿”å›åœ°å€ï¼›ç¯å¢ƒä¿¡æ¯ï¼‰ã€‚ å †â€”â€”åŠ¨æ€å­˜å‚¨åˆ†ã€‚ åœ¨å…¨å±€å˜é‡ä¹‹å‰åŠ ä¸Šå…³é”®å­— staticï¼Œå…¨å±€å˜é‡å°±è¢«å®šä¹‰æˆä¸ºä¸€ä¸ªå…¨å±€é™æ€å˜é‡ã€‚ å†…å­˜ä¸­çš„ä½ç½®ï¼šé™æ€å­˜å‚¨åŒºï¼ˆé™æ€å­˜å‚¨åŒºåœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´éƒ½å­˜åœ¨ï¼‰ åˆå§‹åŒ–ï¼šæœªç»åˆå§‹åŒ–çš„å…¨å±€é™æ€å˜é‡ä¼šè¢«ç¨‹åºè‡ªåŠ¨åˆå§‹åŒ–ä¸º 0ï¼ˆè‡ªåŠ¨å¯¹è±¡çš„å€¼æ˜¯ä»»æ„çš„ï¼Œé™¤éä»–è¢«æ˜¾ç¤ºåˆå§‹åŒ–ï¼‰ ä½œç”¨åŸŸï¼šå…¨å±€é™æ€å˜é‡åœ¨å£°æ˜ä»–çš„æ–‡ä»¶ä¹‹å¤–æ˜¯ä¸å¯è§çš„ã€‚å‡†ç¡®åœ°è®²ä»å®šä¹‰ä¹‹å¤„å¼€å§‹åˆ°æ–‡ä»¶ç»“å°¾ã€‚ å®šä¹‰å…¨å±€é™æ€å˜é‡çš„å¥½å¤„ï¼š ä¸ä¼šè¢«å…¶ä»–æ–‡ä»¶æ‰€è®¿é—®ï¼Œä¿®æ”¹ å…¶ä»–æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨ç›¸åŒåå­—çš„å˜é‡ï¼Œä¸ä¼šå‘ç”Ÿå†²çªã€‚ å±€éƒ¨é™æ€å˜é‡åœ¨å±€éƒ¨å˜é‡ä¹‹å‰åŠ ä¸Šå…³é”®å­— staticï¼Œå±€éƒ¨å˜é‡å°±è¢«å®šä¹‰æˆä¸ºä¸€ä¸ªå±€éƒ¨é™æ€å˜é‡ã€‚ å†…å­˜ä¸­çš„ä½ç½®ï¼šé™æ€å­˜å‚¨åŒº åˆå§‹åŒ–ï¼šæœªç»åˆå§‹åŒ–çš„å…¨å±€é™æ€å˜é‡ä¼šè¢«ç¨‹åºè‡ªåŠ¨åˆå§‹åŒ–ä¸º 0ï¼ˆè‡ªåŠ¨å¯¹è±¡çš„å€¼æ˜¯ä»»æ„çš„ï¼Œé™¤éä»–è¢«æ˜¾ç¤ºåˆå§‹åŒ–ï¼‰ ä½œç”¨åŸŸï¼šä½œç”¨åŸŸä»ä¸ºå±€éƒ¨ä½œç”¨åŸŸï¼Œå½“å®šä¹‰å®ƒçš„å‡½æ•°æˆ–è€…è¯­å¥å—ç»“æŸçš„æ—¶å€™ï¼Œä½œç”¨åŸŸéšä¹‹ç»“æŸã€‚ æ³¨ï¼šå½“ static ç”¨æ¥ä¿®é¥°å±€éƒ¨å˜é‡çš„æ—¶å€™ï¼Œå®ƒå°±æ”¹å˜äº†å±€éƒ¨å˜é‡çš„å­˜å‚¨ä½ç½®ï¼Œä»åŸæ¥çš„æ ˆä¸­å­˜æ”¾æ”¹ä¸ºé™æ€å­˜å‚¨åŒºã€‚ä½†æ˜¯å±€éƒ¨é™æ€å˜é‡åœ¨ç¦»å¼€ä½œç”¨åŸŸä¹‹åï¼Œå¹¶æ²¡æœ‰è¢«é”€æ¯ï¼Œè€Œæ˜¯ä»ç„¶é©»ç•™åœ¨å†…å­˜å½“ä¸­ï¼Œç›´åˆ°ç¨‹åºç»“æŸï¼Œåªä¸è¿‡ä»¬ä¸èƒ½å†å¯¹ä»–è¿›è¡Œè®¿é—®ã€‚ å½“ static ç”¨æ¥ä¿®é¥°å…¨å±€å˜é‡çš„æ—¶å€™ï¼Œå®ƒå°±æ”¹å˜äº†å…¨å±€å˜é‡çš„ä½œç”¨åŸŸï¼ˆåœ¨å£°æ˜ä»–çš„æ–‡ä»¶ä¹‹å¤–æ˜¯ä¸å¯è§çš„ï¼‰ï¼Œä½†æ˜¯æ²¡æœ‰æ”¹å˜å®ƒçš„å­˜æ”¾ä½ç½®ï¼Œè¿˜æ˜¯åœ¨é™æ€å­˜å‚¨åŒºä¸­ã€‚ é™æ€å‡½æ•°åœ¨å‡½æ•°çš„è¿”å›ç±»å‹å‰åŠ ä¸Šå…³é”®å­— staticï¼Œå‡½æ•°å°±è¢«å®šä¹‰æˆä¸ºé™æ€å‡½æ•°ã€‚å‡½æ•°çš„å®šä¹‰å’Œå£°æ˜é»˜è®¤æƒ…å†µä¸‹æ˜¯ extern çš„ï¼Œä½†é™æ€å‡½æ•°åªæ˜¯åœ¨å£°æ˜ä»–çš„æ–‡ä»¶å½“ä¸­å¯è§ï¼Œä¸èƒ½è¢«å…¶ä»–æ–‡ä»¶æ‰€ç”¨ã€‚ å®šä¹‰é™æ€å‡½æ•°çš„å¥½å¤„ï¼š å…¶ä»–æ–‡ä»¶ä¸­å¯ä»¥å®šä¹‰ç›¸åŒåå­—çš„å‡½æ•°ï¼Œä¸ä¼šå‘ç”Ÿå†²çª é™æ€å‡½æ•°ä¸èƒ½è¢«å…¶ä»–æ–‡ä»¶æ‰€ç”¨ã€‚ å­˜å‚¨è¯´æ˜ç¬¦ autoï¼Œregisterï¼Œexternï¼Œstaticï¼Œå¯¹åº”ä¸¤ç§å­˜å‚¨æœŸï¼šè‡ªåŠ¨å­˜å‚¨æœŸå’Œé™æ€å­˜å‚¨æœŸã€‚ auto å’Œ register å¯¹åº”è‡ªåŠ¨å­˜å‚¨æœŸã€‚å…·æœ‰è‡ªåŠ¨å­˜å‚¨æœŸçš„å˜é‡åœ¨è¿›å…¥å£°æ˜è¯¥å˜é‡çš„ç¨‹åºå—æ—¶è¢«å»ºç«‹ï¼Œå®ƒåœ¨è¯¥ç¨‹åºå—æ´»åŠ¨æ—¶å­˜åœ¨ï¼Œé€€å‡ºè¯¥ç¨‹åºå—æ—¶æ’¤é”€ã€‚ å…³é”®å­— extern å’Œ static ç”¨æ¥è¯´æ˜å…·æœ‰é™æ€å­˜å‚¨æœŸçš„å˜é‡å’Œå‡½æ•°ã€‚ç”¨ static å£°æ˜çš„å±€éƒ¨å˜é‡å…·æœ‰é™æ€å­˜å‚¨æŒç»­æœŸï¼ˆstatic storage durationï¼‰ï¼Œæˆ–é™æ€èŒƒå›´ï¼ˆstatic extentï¼‰ã€‚è™½ç„¶ä»–çš„å€¼åœ¨å‡½æ•°è°ƒç”¨ä¹‹é—´ä¿æŒæœ‰æ•ˆï¼Œä½†æ˜¯å…¶åå­—çš„å¯è§†æ€§ä»é™åˆ¶åœ¨å…¶å±€éƒ¨åŸŸå†…ã€‚é™æ€å±€éƒ¨å¯¹è±¡åœ¨ç¨‹åºæ‰§è¡Œåˆ°è¯¥å¯¹è±¡çš„å£°æ˜å¤„æ—¶è¢«é¦–æ¬¡åˆå§‹åŒ–ã€‚ ç”±äº static å˜é‡çš„ä»¥ä¸Šç‰¹æ€§ï¼Œå¯å®ç°ä¸€äº›ç‰¹å®šåŠŸèƒ½ã€‚ ç»Ÿè®¡æ¬¡æ•°åŠŸèƒ½ å£°æ˜å‡½æ•°çš„ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œå¹¶è®¾ä¸º static ç±»å‹ï¼Œä½œä¸ºä¸€ä¸ªè®¡æ•°å™¨ï¼Œè¿™æ ·å‡½æ•°æ¯æ¬¡è¢«è°ƒç”¨çš„æ—¶å€™å°±å¯ä»¥è¿›è¡Œè®¡æ•°ã€‚è¿™æ˜¯ç»Ÿè®¡å‡½æ•°è¢«è°ƒç”¨æ¬¡æ•°çš„æœ€å¥½çš„åŠæ³•ï¼Œå› ä¸ºè¿™ä¸ªå˜é‡æ˜¯å’Œå‡½æ•°æ¯æ¯ç›¸å…³çš„ï¼Œè€Œå‡½æ•°å¯èƒ½åœ¨å¤šä¸ªä¸åŒçš„åœ°æ–¹è¢«è°ƒç”¨ï¼Œæ‰€ä»¥ä»è°ƒç”¨è€…çš„è§’åº¦æ¥ç»Ÿè®¡æ¯”è¾ƒå›°éš¾ã€‚ C è¯­è¨€ä¸­ä½¿ç”¨é™æ€å‡½æ•°çš„å¥½å¤„ï¼š é™æ€å‡½æ•°ä¼šè¢«è‡ªåŠ¨åˆ†é…åœ¨ä¸€ä¸ªä¸€ç›´ä½¿ç”¨çš„å­˜å‚¨åŒºï¼Œç›´åˆ°é€€å‡ºåº”ç”¨ç¨‹åºå®ä¾‹ï¼Œé¿å…äº†è°ƒç”¨å‡½æ•°æ—¶å‹æ ˆå‡ºæ ˆï¼Œé€Ÿåº¦å¿«å¾ˆå¤šã€‚ å­˜å‚¨ç±» æ—¶æœŸ ä½œç”¨åŸŸ é“¾æ¥ å£°æ˜æ–¹å¼ è‡ªåŠ¨ è‡ªåŠ¨ ä»£ç å— ç©º ä»£ç å—å†… å¯„å­˜å™¨ è‡ªåŠ¨ ä»£ç å— ç©º ä»£ç å—å†…ï¼Œä½¿ç”¨å…³é”®å­— register å…·æœ‰å¤–éƒ¨é“¾æ¥çš„é™æ€ é™æ€ æ–‡ä»¶ å¤–éƒ¨ æ‰€æœ‰å‡½æ•°ä¹‹å¤– å…·æœ‰å†… éƒ¨é“¾æ¥çš„é™æ€ é™æ€ æ–‡ä»¶ å†…éƒ¨ æ‰€æœ‰å‡½æ•°ä¹‹å¤– ï¼Œä½¿ç”¨å…³é”®å­— static ç©ºé“¾æ¥çš„é™æ€ é™æ€ ä»£ç å— ç©º ä»£ç å—å†…ï¼Œä½¿ç”¨å…³é”®å­— static å˜é‡ç±»å‹ å£°æ˜çš„ä½ç½® æ˜¯å¦å­˜äºå †æ ˆ ä½œç”¨åŸŸ å¦‚æœå£°æ˜ ä¸º static å…¨å±€ æ‰€æœ‰ä»£ç å—ä¹‹å¤– å¦ ä»å£°æ˜å¤„åˆ°æ–‡ä»¶å°¾ ä¸å…è®¸ä»å…¶ä»–æºæ–‡ä»¶è®¿é—® å±€éƒ¨ ä»£ç å—èµ·å§‹å¤„ æ˜¯ æ•´ä¸ªä»£ç å— å˜é‡ä¸å­˜å‚¨äºå †æ ˆä¸­ï¼Œå®ƒçš„å€¼åœ¨ç¨‹åºæ•´ä¸ªæ‰§è¡ŒæœŸä¸€ç›´ä¿æŒ å½¢å¼å‚æ•° å‡½æ•°å¤´éƒ¨ æ˜¯ æ•´ä¸ªå‡½æ•° ä¸å…è®¸ ä½çš„å¯¹é½å­—èŠ‚å¯¹é½ï¼šåœ¨ 32 ä½æ“ä½œç³»ç»Ÿä¸­ï¼Œå¤§å¤šæ•°è®¡ç®—æœºä½“ç³»ç»“æ„è¦æ±‚æ•°æ®æŒ‰ç…§ç‰¹å®šçš„å­—èŠ‚è¾¹ç•Œå¯¹é½ã€‚å¸¸è§çš„å¯¹é½è¾¹ç•Œæ˜¯ 4 å­—èŠ‚ï¼ˆ32 ä½ï¼‰æˆ– 8 å­—èŠ‚ï¼ˆ64 ä½ï¼‰ã€‚è¿™æ˜¯ä¸ºäº†ä¼˜åŒ–å†…å­˜è®¿é—®å’Œæ•°æ®ä¼ è¾“çš„æ•ˆç‡ã€‚å¦‚æœæ•°æ®æ²¡æœ‰æŒ‰ç…§æ­£ç¡®çš„å­—èŠ‚å¯¹é½æ–¹å¼å­˜å‚¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„å¼€é”€å’Œæ€§èƒ½ä¸‹é™ã€‚ ç»“æ„ä½“æˆå‘˜å¯¹é½ï¼šåœ¨ç»“æ„ä½“ä¸­ï¼Œç»“æ„ä½“æˆå‘˜çš„å¯¹é½æ–¹å¼å¯èƒ½ä¼šå½±å“æ•´ä¸ªç»“æ„ä½“çš„å¯¹é½æ–¹å¼ã€‚ç¼–è¯‘å™¨é€šå¸¸ä¼šè‡ªåŠ¨å¯¹ç»“æ„ä½“æˆå‘˜è¿›è¡Œå¯¹é½ï¼Œä»¥æ»¡è¶³æ‰€ä½¿ç”¨çš„ç¼–è¯‘å™¨å’Œå¹³å°çš„è¦æ±‚ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°ç¼–è¯‘å™¨ä¼šä½¿ç”¨æœ€å¤§å¯¹é½æ–¹å¼ï¼Œå³æŒ‰ç…§ç»“æ„ä½“ä¸­æœ€å¤§æˆå‘˜çš„å­—èŠ‚å¤§å°è¿›è¡Œå¯¹é½ã€‚ æŒ‡ä»¤å¯¹é½ï¼šåœ¨ä»£ç ä¸­ï¼ŒæŒ‡ä»¤çš„å¯¹é½æ–¹å¼ä¹Ÿæ˜¯é‡è¦çš„ã€‚å¤§å¤šæ•°å¤„ç†å™¨è¦æ±‚æŒ‡ä»¤æŒ‰ç…§ç‰¹å®šçš„å­—èŠ‚è¾¹ç•Œå¯¹é½ã€‚æŒ‡ä»¤å¯¹é½å¯ä»¥æé«˜æŒ‡ä»¤çš„æ‰§è¡Œé€Ÿåº¦å’Œæ•´ä½“æ€§èƒ½ã€‚ å¯¹äºå­—èŠ‚å¯¹é½ï¼Œç¼–è¯‘å™¨é€šå¸¸ä¼šè‡ªåŠ¨å¤„ç†ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡ç¼–è¯‘å™¨çš„æŒ‡ä»¤æˆ–å±æ€§è¿›è¡Œæ‰‹åŠ¨æ§åˆ¶ã€‚åœ¨ C è¯­è¨€ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ç‰¹å®šçš„ç¼–è¯‘æŒ‡ä»¤æ¥æ§åˆ¶ç»“æ„ä½“æˆå‘˜çš„å¯¹é½æ–¹å¼ï¼Œä¾‹å¦‚ä½¿ç”¨ #pragma pack æŒ‡ä»¤ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ #pragma pack æŒ‡ä»¤æ¥è®¾ç½®ç»“æ„ä½“æˆå‘˜çš„å¯¹é½æ–¹å¼ï¼š #include stdio.h#pragma pack(push, 1) // ä»¥1å­—èŠ‚å¯¹é½æ–¹å¼å‹æ ˆstruct Example char a; int b; short c;;#pragma pack(pop) // å¼¹å‡ºå¯¹é½æ–¹å¼int main() struct Example ex; printf(Size of struct: %zu , sizeof(ex)); // è¾“å‡ºç»“æ„ä½“çš„å¤§å° return 0; åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œé€šè¿‡ä½¿ç”¨ #pragma pack(push, 1) æŒ‡ä»¤å°†å¯¹é½æ–¹å¼è®¾ç½®ä¸º 1 å­—èŠ‚ï¼Œç„¶åå®šä¹‰äº†ä¸€ä¸ªåä¸º Example çš„ç»“æ„ä½“ï¼ŒåŒ…å«äº† charã€int å’Œ short ç±»å‹çš„æˆå‘˜å˜é‡ã€‚æœ€åä½¿ç”¨ #pragma pack(pop) æŒ‡ä»¤å°†å¯¹é½æ–¹å¼è¿˜åŸä¸ºé»˜è®¤å€¼ã€‚ åœ¨è¿è¡Œç¤ºä¾‹ç¨‹åºåï¼Œå¯ä»¥è§‚å¯Ÿåˆ°ç»“æ„ä½“ Example çš„å¤§å°å¯èƒ½ä¼šå—åˆ°å¯¹é½æ–¹å¼çš„å½±å“ã€‚å¦‚æœä¸è¿›è¡Œä»»ä½•å¯¹é½æ“ä½œï¼Œé»˜è®¤æƒ…å†µä¸‹ç¼–è¯‘å™¨å¯èƒ½ä¼šæ ¹æ®å¹³å°å’Œç¼–è¯‘å™¨çš„è¦æ±‚è¿›è¡Œå¯¹é½ï¼Œå¤§å°ä¼šå¤§äº 1 å­—èŠ‚ã€‚ æ€»ç»“æ¥è¯´ï¼Œåœ¨ 32 ä½çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œä½çš„ä½¿ç”¨å’Œå¯¹é½æ“ä½œæ˜¯ä¸ºäº†ä¼˜åŒ–å†…å­˜è®¿é—®å’Œæ•°æ®ä¼ è¾“çš„æ•ˆç‡ã€‚å­—èŠ‚å¯¹é½ã€ç»“æ„ä½“æˆå‘˜å¯¹é½å’ŒæŒ‡ä»¤å¯¹é½æ˜¯å¸¸è§çš„å¯¹é½æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡ç¼–è¯‘å™¨çš„æŒ‡ä»¤æˆ–å±æ€§è¿›è¡Œæ‰‹åŠ¨æ§åˆ¶ï¼Œä»¥æ»¡è¶³ç‰¹å®šçš„éœ€æ±‚å’Œå¹³å°è¦æ±‚ã€‚ å‡½æ•°æŒ‡é’ˆåˆ©ç”¨å‡½æ•°æŒ‡é’ˆï¼Œé€šè¿‡åŒºåˆ†ä¸åŒè®¾å¤‡çš„è®¾å¤‡å·ï¼Œé€šè¿‡å‡½æ•°æŒ‡é’ˆçš„æ–¹å¼å»è°ƒç”¨ä¸åŒçš„æ¥å£ï¼Œä»è€Œå®Œæˆä¸€å¥—ç¨‹åºå¯ä»¥æ”¯æŒå¤šç§ä¸åŒçš„è®¾å¤‡ï¼Œå®Œæˆå„è®¾å¤‡çš„é€šä¿¡åè®®çš„åŒ¹é…å·¥ä½œï¼Œ å®å®šä¹‰æ“ä½œç¬¦æ“ä½œç¬¦#é€šå¸¸ç§°ä¸ºå­—ç¬¦ä¸²åŒ–çš„æ“ä½œç¬¦ #include stdio.h#define mkstr(s) #sint main(void)printf(mkstr(I like C))return 0; æ›¿æ¢ç»“æœ int main(void)printf(I like C);return 0; æ“ä½œç¬¦##å¯ä»¥æŠŠä¸¤ä¸ªç‹¬ç«‹çš„å­—ç¬¦ä¸²è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸² #includestdio.h#define SORT(X) sortFunction##Xvoid main(void)\tchar *array;\tint elements , element size;\tSORT(3)(array , elements , element_size); æ›¿æ¢ç»“æœ void main(void)\tchar *array;\tint elements, element size;\tsortFunction3(array, elements,element size); è°ƒè¯•å®å®šä¹‰FILE å’Œ LINE æ˜¯ CC++ ç¼–è¯‘å™¨é¢„å®šä¹‰çš„å®ï¼Œç”¨äºè·å–å½“å‰æºä»£ç æ–‡ä»¶åå’Œè¡Œå·çš„ä¿¡æ¯ã€‚ __FILE__ï¼šå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼Œè¡¨ç¤ºå½“å‰æºä»£ç æ‰€åœ¨çš„æ–‡ä»¶åã€‚ç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šå°† FILE æ›¿æ¢ä¸ºå½“å‰æºä»£ç æ–‡ä»¶çš„è·¯å¾„å’Œåç§°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœçš„æºä»£ç æ–‡ä»¶åæ˜¯ â€œexample.câ€ï¼Œé‚£ä¹ˆ FILE çš„å€¼å°†æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ â€œexample.câ€ã€‚ __LINE__ï¼šå®ƒæ˜¯ä¸€ä¸ªæ•´æ•°å¸¸é‡ï¼Œè¡¨ç¤ºå½“å‰æºä»£ç çš„è¡Œå·ã€‚ç¼–è¯‘å™¨ä¼šå°† LINE æ›¿æ¢ä¸ºå½“å‰æºä»£ç è¡Œå·çš„æ•°å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨æºä»£ç çš„ç¬¬ 10 è¡Œä½¿ç”¨äº† __LINE__ï¼Œé‚£ä¹ˆå®ƒçš„å€¼å°†æ˜¯æ•´æ•°å¸¸é‡ 10ã€‚ è¿™äº›å®é€šå¸¸åœ¨è°ƒè¯•å’Œé”™è¯¯å¤„ç†è¿‡ç¨‹ä¸­ä½¿ç”¨ï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©ç¨‹åºå‘˜å®šä½é”™è¯¯æˆ–è®°å½•ç‰¹å®šä»£ç ä½ç½®çš„ä¿¡æ¯ã€‚é€šè¿‡åœ¨ä»£ç ä¸­ä½¿ç”¨ FILE å’Œ LINE å®ï¼Œå¯ä»¥åœ¨ç¨‹åºä¸­åŠ¨æ€åœ°è·å–å’Œæ‰“å°å‡ºé”™ä½ç½®ï¼Œæˆ–è€…ç”¨äºè°ƒè¯•è¾“å‡ºã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ FILE å’Œ LINE å®ï¼š #include stdio.hvoid printLocation() printf(Error occurred in file: %s , __FILE__); printf(Error occurred at line: %d , __LINE__);int main() int x = 42; if (x 50) printLocation(); return 0; åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªå‡½æ•° printLocation()ï¼Œå®ƒä½¿ç”¨äº† FILE å’Œ LINE å®æ¥æ‰“å°é”™è¯¯å‘ç”Ÿçš„æ–‡ä»¶åå’Œè¡Œå·ä¿¡æ¯ã€‚åœ¨ main() å‡½æ•°ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„æ¡ä»¶åˆ¤æ–­æ¥æ¨¡æ‹Ÿé”™è¯¯æƒ…å†µï¼Œå½“ x å¤§äº 50 æ—¶ï¼Œè°ƒç”¨ printLocation() å‡½æ•°ã€‚ è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œå¦‚æœæ¡ä»¶æ»¡è¶³ï¼Œå°†è¾“å‡ºç±»ä¼¼ä»¥ä¸‹å†…å®¹çš„é”™è¯¯ä¿¡æ¯ï¼š Error occurred in file: example.cError occurred at line: 14 é€šè¿‡ä½¿ç”¨ FILE å’Œ LINE å®ï¼Œä»¬å¯ä»¥æ–¹ä¾¿åœ°äº†è§£é”™è¯¯å‘ç”Ÿçš„å…·ä½“ä½ç½®ï¼Œæœ‰åŠ©äºè°ƒè¯•å’Œæ’æŸ¥é—®é¢˜ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€"]},{"title":"é¢„å¤„ç†å’Œå®","path":"/2024/06/14/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-é¢„å¤„ç†å’Œå®/","content":"æŒ‰ç…§ ANSI æ ‡å‡†çš„å®šä¹‰ï¼Œé¢„å¤„ç†ç¨‹åºè´Ÿè´£å¤„ç†ä¸€ç³»åˆ—æŒ‡ä»¤ã€‚è¿™äº›æŒ‡ä»¤éƒ½ä»¥ç¬¦å· # å¼€å§‹ä¸”å¿…é¡»ç‹¬å ä¸€è¡Œã€‚åœ¨ C ç¨‹åºä¸­ï¼Œé¢„å¤„ç†é˜¶æ®µæ˜¯ä¸€ä¸ªé‡è¦çš„æ­¥éª¤ï¼Œå®ƒåœ¨ç¼–è¯‘ä¹‹å‰å¯¹ä»£ç è¿›è¡Œåˆ†æå’Œä¿®æ”¹ï¼Œä½¿å¾—æºä»£ç å¯ä»¥æ›´çµæ´»å’Œé«˜æ•ˆåœ°ç¼–è¯‘ã€‚ #defineå®æ›¿æ¢#define æŒ‡ä»¤ç”¨äºå®šä¹‰ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼ˆç§°ä¸ºå®åå­—ï¼‰å’Œä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå­—ç¬¦é›†ï¼‰ã€‚å½“æºç¨‹åºä¸­å‡ºç°è¯¥æ ‡è¯†ç¬¦æ—¶ï¼Œå®ƒä¼šè¢«å¯¹åº”çš„å­—ç¬¦ä¸²æ›¿æ¢ã€‚å®ä»£æ¢çš„å®šä¹‰å½¢å¼å¦‚ä¸‹ï¼š #define macro-name char-sequence æ³¨æ„ï¼Œ#define è¯­å¥ä¸éœ€è¦ä»¥åˆ†å·ç»“å°¾ã€‚å®åå­—å’Œå­—ç¬¦ä¸²ä¹‹é—´å¯ä»¥æœ‰å¤šä¸ªç©ºç™½ç¬¦ï¼Œä½†å­—ç¬¦ä¸²çš„ç»“æŸåªèƒ½ä»¥æ–°è¡Œç»ˆæ­¢ã€‚ä¾‹å¦‚ï¼Œä»¬å¯ä»¥ä½¿ç”¨ä¸¤ä¸ª #define æŒ‡ä»¤æ¥å®šä¹‰ï¼š #define LEFT 1#define RIGHT 0 æ¯å½“åœ¨æºç¨‹åºä¸­é‡åˆ° LEFT æˆ– RIGHT æ—¶ï¼Œç¼–è¯‘ç¨‹åºéƒ½ä¼šå°†å…¶æ›¿æ¢ä¸º 1 æˆ– 0ã€‚å®šä¹‰å®ä¹‹åï¼Œä»¬è¿˜å¯ä»¥åœ¨å…¶ä»–å®å®šä¹‰ä¸­å¼•ç”¨å®ƒï¼Œå¦‚ï¼š #define ONE 1#define TWO ONE + ONE å®ä»£æ¢çš„å®é™…ä½œç”¨åœ¨äºç”¨æŒ‡å®šçš„å­—ç¬¦ä¸²æ›¿æ¢æ ‡è¯†ç¬¦ï¼Œè¿™ä½¿å¾—ä»£ç æ›´æ˜“äºç®¡ç†å’Œç»´æŠ¤ã€‚å¦‚æœæƒ³è¦å®šä¹‰ä¸€æ¡æ ‡å‡†é”™è¯¯ä¿¡æ¯ï¼Œå¯ä»¥å¦‚ä¸‹æ“ä½œï¼š #define ERROR_MSG An error has occurred. å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²é•¿äºä¸€è¡Œï¼Œå¯ä»¥åœ¨å…¶è¡Œå°¾ä½¿ç”¨åæ–œçº¿ \\ æ¥ç»§ç»­åˆ°æ–°ä¸€è¡Œã€‚ä¾‹å¦‚ï¼š #define LONG_STRING This is a very very long \\string that continues here. å®ä½“ç§ä¸èƒ½é€’å½’åŒ…å«è‡ªèº«çš„å®åï¼Œé¢„å¤„ç†çš„æ—¶å€™ä¼šæŠŠå®åçœ‹åšå­—ç¬¦ä¸² å¸¦å‚å®ä»¬ä¹Ÿå¯ä»¥åœ¨å®ä¸­å®šä¹‰å‡½æ•°ã€‚ä¾‹å¦‚ï¼š #define SWAP(a, b) int temp = a; a = b; b = temp; åœ¨è°ƒç”¨ SWAP(a, b) æ—¶ï¼Œå®ƒä¼šè¢«æ›¿æ¢ä¸ºå®é™…çš„ä»£ç å—ï¼š int temp = a; a = b; b = temp; å®å®šä¹‰å‡½æ•° vs å¤–éƒ¨è°ƒç”¨å‡½æ•°å®å®šä¹‰å’Œå¤–éƒ¨è°ƒç”¨å‡½æ•°æ˜¯ä»¥æ—¶é—´å’Œç©ºé—´è¿›è¡Œæƒè¡¡çš„ç­–ç•¥ï¼šå®å®šä¹‰ç”¨æ›´å¿«çš„æ–¹å¼æ¥æ›¿ä»£ä»£ç ï¼Œè€Œå‡½æ•°åˆ™é€šè¿‡ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥å’Œæ›´å¥½çš„å†…å­˜ç®¡ç†æ¥ä¿è¯ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å¼€å‘è€…åœ¨é€‰æ‹©æ—¶ï¼Œéœ€æ ¹æ®å®é™…éœ€æ±‚ï¼Œçµæ´»é€‰ç”¨åˆé€‚çš„å·¥å…·ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä¸€ä¸ªæ€§èƒ½æ•æ„Ÿçš„è®¡ç®—ä»»åŠ¡ï¼Œä½¿ç”¨å®å¯èƒ½æ˜¯æ›´åˆé€‚çš„é€‰æ‹©ï¼›è€Œåœ¨éœ€è¦å¤æ‚é€»è¾‘çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œå¤–éƒ¨å‡½æ•°åˆ™ä¼šæ˜¾å¾—æ›´å¯é ã€‚ å®å®šä¹‰å‡½æ•°å®å®é™…ä¸Šæ˜¯å¯ä»¥ç†è§£ä¸ºä¸€æ®µåœ¨ç¼–è¯‘æ—¶ä¼šè¢«æ›¿æ¢çš„ä»£ç ç‰‡æ®µã€‚å®é€šè¿‡é¢„å¤„ç†å™¨æ¥å®ç°ï¼Œå…¶ä¼ é€’çš„å†…å®¹ä»…ä»…æ˜¯å­—ç¬¦ä¸²ã€‚ä¸æ­¤å…³è”çš„æ˜¯ï¼Œå®ä¸ä¼šè¿›è¡Œä»»ä½•è¯­æ³•æ£€æŸ¥æˆ–æ•°æ®ç±»å‹æ ¡éªŒã€‚ä¾‹å¦‚ï¼Œåœ¨ C è¯­è¨€ä¸­å®šä¹‰ä¸€ä¸ªç®€å•çš„å®ï¼š #define SQUARE(x) ((x) * (x)) å½“åœ¨ä»£ç ä¸­ä½¿ç”¨ SQUARE(5) æ—¶ï¼Œé¢„å¤„ç†å™¨ä¼šå°†å…¶æ›¿æ¢ä¸º ((5) * (5))ï¼Œç›´æ¥åœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œæ–‡æœ¬æ›¿æ¢ã€‚è¿™æ„å‘³ç€ï¼Œç¨‹åºè¿è¡Œæ—¶ä¸ä¼šæœ‰é¢å¤–çš„è°ƒç”¨å¼€é”€ï¼Œå®çš„æ‰§è¡Œé€Ÿåº¦æ˜¯éå¸¸å¿«çš„ã€‚ ä¼˜ç‚¹: ä½¿ç”¨å®æ—¶ï¼Œç¨‹åºçš„æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚ç”±äºç¼–è¯‘æ—¶ç›´æ¥æ’å…¥ä»£ç ï¼Œè¿™æ¶ˆé™¤äº†å‡½æ•°è°ƒç”¨æ‰€éœ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ ˆçš„æ“ä½œï¼Œä¾‹å¦‚å‹æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚ ç¼ºç‚¹: ç”±äºå®ä¸å…·å¤‡ç±»å‹æ£€æŸ¥ï¼Œå½“ä¼ é€’çš„å‚æ•°ç±»å‹ä¸ç¬¦åˆé¢„æœŸæ—¶ï¼Œå¯èƒ½å¯¼è‡´æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨ SQUARE(3.5)ï¼Œåˆ™ä¼šäº§ç”Ÿ ((3.5) * (3.5))ï¼Œè¿™å¯èƒ½ä¸æ˜¯å¼€å‘è€…çš„æœ¬æ„ã€‚åŒæ—¶ï¼Œå®ä¹Ÿä¸åœ¨è¿è¡Œæ—¶å ç”¨å†…å­˜çš„é‡Šæ”¾è¿‡ç¨‹ï¼Œå¯èƒ½å¯¼è‡´æ›´é«˜çš„å†…å­˜æ¶ˆè€—ã€‚ å¤–éƒ¨è°ƒç”¨å‡½æ•°ä¸å®ä¸åŒï¼Œå¤–éƒ¨è°ƒç”¨å‡½æ•°ï¼ˆé€šå¸¸è¢«ç§°ä¸ºå‡½æ•°ï¼‰åˆ™åœ¨è¿è¡Œæ—¶æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨ä¼ é€’å‚æ•°æ—¶ä¼šæ‰§è¡Œä¸¥æ ¼çš„ç±»å‹åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œåœ¨ C è¯­è¨€ä¸­å®šä¹‰ä¸€ä¸ªæ±‚å¹³æ–¹çš„å‡½æ•°å¦‚ä¸‹ï¼š int square(int x) return x * x; è¿™é‡Œï¼Œå‡½æ•° square åœ¨è¿è¡Œæ—¶æ ¹æ®ä¼ å…¥çš„å‚æ•°æ¥è®¡ç®—å€¼ã€‚å¦‚æœä¼ å…¥äº†ä¸åŒ¹é…çš„ç±»å‹ï¼Œä¾‹å¦‚æµ®ç‚¹æ•°ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œä»è€Œå¸®åŠ©å¼€å‘è€…åŠæ—¶å‘ç°é—®é¢˜ã€‚ ä¼˜ç‚¹: å‡½æ•°æä¾›äº†ç±»å‹å®‰å…¨çš„å‚æ•°ä¼ é€’æœºåˆ¶ï¼Œé¿å…äº†è®¸å¤šæ½œåœ¨çš„é”™è¯¯ã€‚æ­¤å¤–ï¼Œå‡½æ•°åœ¨è°ƒç”¨å®Œæˆåå¯ä»¥çµæ´»åœ°é‡Šæ”¾èµ„æºï¼Œæœ‰åŠ©äºä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚ ç¼ºç‚¹: å‡½æ•°è°ƒç”¨æ¶‰åŠåˆ°ä¸€å®šçš„å¼€é”€ï¼Œç‰¹åˆ«æ˜¯åœ¨é¢‘ç¹è°ƒç”¨çš„åœºæ™¯ä¸­ï¼Œå› ä¸ºå®ƒéœ€è¦åœ¨å‡½æ•°è°ƒç”¨æ ˆä¸Šå®‰æ’å†…å­˜ï¼Œå¢åŠ äº†æ‰§è¡Œæ—¶é—´ã€‚ #error#error æŒ‡ä»¤ç”¨äºå¼ºåˆ¶ç¼–è¯‘å™¨åœæ­¢ç¼–è¯‘ï¼Œä¸»è¦åº”ç”¨äºè°ƒè¯•é˜¶æ®µã€‚å®ƒçš„ä¸€èˆ¬å½¢å¼æ˜¯ï¼š #error error-message ä¾‹å¦‚ï¼Œä»¬å¯ä»¥å®šä¹‰æ ‡å‡†é”™è¯¯ä¿¡æ¯å¦‚ï¼š #define ERROR_MSG Standard error on input #error ERROR_MSG æ³¨æ„ï¼Œå®å­—ç¬¦ä¸² error-message ä¸éœ€è¦ç”¨åŒå¼•å·åŒ…å›´ã€‚å½“ç¼–è¯‘å™¨é‡åˆ° #error æŒ‡ä»¤æ—¶ï¼Œä¼šæ˜¾ç¤ºæŒ‡å®šçš„é”™è¯¯ä¿¡æ¯å’Œå…¶ä»–å¯èƒ½çš„ç¼–è¯‘ä¿¡æ¯ã€‚ #includeåœ¨ç¨‹åºä¸­ï¼Œ#include æŒ‡ä»¤å‘Šè¯‰ç¼–è¯‘å™¨è¯»å–å¹¶ç¼–è¯‘å¦ä¸€ä¸ªæºæ–‡ä»¶ã€‚è¢«åŒ…å«çš„æ–‡ä»¶åå¯ä»¥ç”¨åŒå¼•å· æˆ–å°–æ‹¬å· åŒ…å›´ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨æ ‡å‡†è¾“å…¥è¾“å‡ºåº“åŒ…å«å¤´æ–‡ä»¶ï¼š #include stdio.h è¢«åŒ…å«çš„æ–‡ä»¶ä¸­å¯ä»¥å†æ¬¡åŒ…å«å…¶ä»– #include æŒ‡ä»¤ï¼Œè¿™ç§è¡Œä¸ºç§°ä¸ºåµŒå¥—åŒ…å«ã€‚ç¼–è¯‘å™¨å¯¹äºåµŒå¥—åŒ…å«çš„æœ€å¤§æ·±åº¦ä¾èµ–äºå…·ä½“çš„å®ç°ã€‚ æ–‡ä»¶åçš„åŒ…å›´æ–¹å¼å†³å®šäº†æœç´¢æ–‡ä»¶çš„ä½ç½®ï¼š ä½¿ç”¨å°–æ‹¬å· æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæŒ‰é¢„å®šä¹‰ç›®å½•æœç´¢ï¼Œä¸€èˆ¬ç”¨äºæ ‡å‡†åº“æ–‡ä»¶ã€‚ ä½¿ç”¨åŒå¼•å· æ—¶ï¼Œç¼–è¯‘å™¨é¦–å…ˆåœ¨å½“å‰ç›®å½•æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å†è½¬å‘æŒ‰å°–æ‹¬å·æ–¹å¼æœç´¢ã€‚ è‡ªå®šä¹‰åŒ…å«è·¯å¾„åœ¨ç¼–è¯‘æ—¶ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ é€‰é¡¹ä¾‹å¦‚ï¼š gcc -I /home/fs/include æ¥æŒ‡å®šæœç´¢ç›®å½•ï¼Œå¦‚æœ stdio.h æœªåœ¨å½“å‰ç›®å½•ä¸­æ‰¾åˆ°ï¼Œç¼–è¯‘å™¨ä¼šè¿›ä¸€æ­¥æŸ¥æ‰¾ /home/fs/includeï¼Œæœ€åå†æŸ¥æ‰¾ç³»ç»Ÿé»˜è®¤ç›®å½•ã€‚ é€šå¸¸ï¼Œç¨‹åºå‘˜åœ¨åŒ…å«æ ‡å‡†åº“æ–‡ä»¶æ—¶ä½¿ç”¨å°–æ‹¬å·ï¼Œè€Œå¯¹äºç¨‹åºç›¸å…³çš„æ–‡ä»¶åˆ™ä½¿ç”¨åŒå¼•å·ã€‚ æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤æ¡ä»¶ç¼–è¯‘å…è®¸ç¨‹åºå‘˜é€‰æ‹©æ€§åœ°ç¼–è¯‘æºä»£ç çš„ä¸åŒéƒ¨åˆ†ï¼Œè¿™ä¸€è¿‡ç¨‹ç§°ä¸ºæ¡ä»¶ç¼–è¯‘ã€‚ #if #else #elif #endifæ¡ä»¶ç¼–è¯‘æŒ‡ä»¤ä¸­æœ€å¸¸ç”¨çš„æ˜¯ #ifã€#elseã€#elif å’Œ #endifã€‚è¿™äº›æŒ‡ä»¤å…è®¸æ ¹æ®å¸¸æ•°è¡¨è¾¾å¼çš„ç»“æœæœ‰æ¡ä»¶åœ°ç¼–è¯‘ä»£ç ã€‚ #if çš„ä¸€èˆ¬å½¢å¼å¦‚ä¸‹ï¼š #include stdio.h#if constant-expression Statement sequence#endif å¦‚æœ #if åé¢çš„å¸¸æ•°è¡¨è¾¾å¼ä¸ºçœŸï¼Œåˆ™æ‰§è¡Œ #if å’Œ #endif ä¹‹é—´çš„ä»£ç ï¼›å¦åˆ™ï¼Œç¼–è¯‘å™¨å°†å¿½ç•¥è¿™æ®µä»£ç ã€‚ #else æŒ‡ä»¤ä¸ C è¯­è¨€ä¸­çš„ else ç›¸ä¼¼ï¼Œå½“ #if å¤±è´¥æ—¶ï¼Œå¯ä»¥ä½œä¸ºå¤‡é€‰æŒ‡ä»¤ã€‚ä¾‹å¦‚ï¼š #if MAX 99 printf(Compiled for array greater than 99. );#else printf(Compiled for small array. );#endif è¿™é‡Œ #else æ—¢æ ‡è®°äº† #if å—çš„ç»“æŸï¼ŒåŒæ—¶æ ‡è®°äº† #else å—çš„å¼€å§‹ã€‚ ä¸ºå®ç°å¤šé‡æ¡ä»¶é€‰æ‹©ï¼Œå¯ä»¥ä½¿ç”¨ #elifï¼š #if expression Statement sequence#elif expression1 Statement sequence#elif expression2 Statement sequence#else Statement sequence#endif #ifdef #ifndefæ¡ä»¶ç¼–è¯‘çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ #ifdef å’Œ #ifndefï¼Œç”¨æ¥åˆ¤æ–­å®æ˜¯å¦å·²å®šä¹‰æˆ–æœªå®šä¹‰ã€‚ #define MAX 100int main(void) #ifdef MAX printf(MAX is defined. ); #else printf(MAX is not defined. ); #endif return 0; #ifndef MY_HEADER_H#define MY_HEADER_H // Header content#endif åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœ MY_HEADER_H æœªè¢«å®šä¹‰ï¼Œåˆ™åŒ…å«å¤´æ–‡ä»¶çš„å†…å®¹ã€‚ #undef#undef æŒ‡ä»¤ç”¨äºåˆ é™¤ä¹‹å‰å®šä¹‰çš„å®åå­—ï¼Œå³ ä¸å®šä¹‰ å®çš„åŠŸèƒ½ã€‚å½¢å¼ä¸ºï¼š #undef macro-name #definedå¦ä¸€ç§æ£€æŸ¥å®æ˜¯å¦å·²å®šä¹‰çš„æ–¹æ³•æ˜¯ç»“åˆ #if æŒ‡ä»¤ä¸ defined æ“ä½œç¬¦ã€‚å½¢å¼å¦‚ä¸‹ï¼š #if defined(MY) // Code if MY is defined#endif å¯ä»¥é€šè¿‡æ„Ÿå¹å· ! æ¥åè½¬æ¡ä»¶ï¼š #if !defined(DEBUG) printf(Final Version! );#endif #line #pragma#line#line æŒ‡ä»¤ç”¨äºæ”¹å˜ __LINE__ å’Œ __FILE__ çš„å€¼ï¼Œåˆ†åˆ«è¡¨ç¤ºå½“å‰ä»£ç è¡Œå·å’Œæ–‡ä»¶åã€‚å½¢å¼ä¸ºï¼š #line number filename #pragma#pragma æ˜¯ä¸€ç§ç”¨äºåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å‘ç¼–è¯‘å™¨æä¾›ç‰¹æ®ŠæŒ‡ä»¤æˆ–ç¼–è¯‘é€‰é¡¹çš„é¢„å¤„ç†æŒ‡ä»¤ã€‚ä¸åŒçš„ç¼–è¯‘å™¨å¯ä»¥å®šä¹‰è‡ªå·±çš„ #pragma æŒ‡ä»¤é›†ï¼Œå› æ­¤å…¶è¡Œä¸ºåœ¨ä¸åŒç¼–è¯‘å™¨ä¸­å¯èƒ½æœ‰æ‰€ä¸åŒã€‚ä½¿ç”¨ #pragma æŒ‡ä»¤æ—¶è¦ç¡®ä¿å…¶å…¼å®¹æ€§ï¼Œå°¤å…¶åœ¨è·¨ç¼–è¯‘å™¨å’Œè·¨å¹³å°å¼€å‘ä¸­ã€‚å¸¸è§çš„ #pragma ä¸»è¦ç”¨äºä¿®æ”¹ç¼–è¯‘å™¨çš„è¡Œä¸ºæˆ–è¿›è¡Œä»£ç çš„ä¼˜åŒ–æ§åˆ¶ã€‚#pragma é€šå¸¸ç´§æ¥å…¶åçš„å†…å®¹å®šä¹‰äº†å…·ä½“çš„ç¼–è¯‘æŒ‡ä»¤æˆ–é€‰é¡¹ã€‚ #pragma æŒ‡ä»¤ ç¼–è¯‘å™¨ä¼šå¿½ç•¥å®ƒä¸æ”¯æŒçš„ #pragma é€‰é¡¹ï¼Œä»è€Œæé«˜ C æºç¨‹åºçš„å¯ç§»æ¤æ€§ã€‚ å¸¸è§ç”¨æ³• ç¦ç”¨æˆ–å¯ç”¨è­¦å‘Šï¼šå¯ä»¥ä¸´æ—¶ç¦ç”¨æˆ–å¯ç”¨ç‰¹å®šçš„ç¼–è¯‘è­¦å‘Šã€‚ è®¾ç½®ä»£ç æ®µï¼šä¸€äº›ç¼–è¯‘å™¨æ”¯æŒä½¿ç”¨ #pragma æ¥å°†ä»£ç æ”¾å…¥æŒ‡å®šçš„å†…å­˜æ®µã€‚ ä¼˜åŒ–è®¾ç½®ï¼šå¯ä»¥æŒ‡å®šæŸä¸ªä»£ç å—çš„ä¼˜åŒ–çº§åˆ«æˆ–å…¶ä»–ä¼˜åŒ–ç›¸å…³é€‰é¡¹ã€‚ æŒ‡ä»¤å¯¹é½ï¼šæ§åˆ¶ç»“æ„å¯¹é½æˆ–æ•°æ®å¯¹é½ã€‚ #pragma warning#pragma warning(push) // ä¿å­˜å½“å‰è­¦å‘ŠçŠ¶æ€#pragma warning(disable : 4996) // ç¦ç”¨è­¦å‘Š 4996ï¼ˆåœ¨ MSVC ä¸­ï¼Œå¸¸ç”¨äºç¦ç”¨å®‰å…¨å‡½æ•°ç›¸å…³çš„è­¦å‘Šï¼‰#include stdio.hint main() char str[10]; gets(str); // ä½¿ç”¨å¯èƒ½ä¸å®‰å…¨çš„å‡½æ•°ï¼Œç¼–è¯‘å™¨é€šå¸¸ä¼šå‘å‡ºè­¦å‘Š printf(%s , str); return 0;#pragma warning(pop) // æ¢å¤ä¹‹å‰çš„è­¦å‘ŠçŠ¶æ€ åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ#pragma warning(disable : 4996) ç”¨äºç¦ç”¨è­¦å‘Šç¼–å·ä¸º 4996 çš„è­¦å‘Šï¼Œé€šå¸¸ä¸ä¸å®‰å…¨çš„å‡½æ•°ä½¿ç”¨ç›¸å…³ã€‚ #pragma packç”¨é€”ï¼šè°ƒæ•´ç»“æ„ä½“ã€è”åˆä½“æˆ–ç±»çš„æˆå‘˜å¯¹é½æ–¹å¼ã€‚å®ƒç”¨äºå‡å°‘ç»“æ„ä½“çš„å¡«å……ï¼Œä¼˜åŒ–å†…å­˜å ç”¨ã€‚ #pragma pack(push, 1) // è®¾ç½®å¯¹é½æ–¹å¼ä¸º 1 å­—èŠ‚struct MyStruct char a; int b;;#pragma pack(pop) // æ¢å¤é»˜è®¤å¯¹é½æ–¹å¼ #pragma pack(push, 1) å°†ç»“æ„ä½“çš„æˆå‘˜å¯¹é½è®¾ç½®ä¸º 1 å­—èŠ‚ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç»“æ„ä½“å ç”¨çš„å†…å­˜ï¼Œä½†åœ¨æŸäº›å¹³å°ä¸Šå¯èƒ½å½±å“æ€§èƒ½ã€‚ #pragma onceç”¨é€”ï¼šé˜²æ­¢å¤´æ–‡ä»¶è¢«å¤šæ¬¡åŒ…å«ã€‚ç›¸æ¯”ä¼ ç»Ÿçš„å¤´æ–‡ä»¶ä¿æŠ¤å®ï¼ˆå¦‚ #ifndefã€#defineï¼‰ï¼Œä½¿ç”¨ #pragma once å¯ä»¥ç®€åŒ–å¤´æ–‡ä»¶ä¿æŠ¤ã€‚ #pragma once// å¤´æ–‡ä»¶å†…å®¹ #pragma once æ˜¯ä¸€ç§ç”¨äºé˜²æ­¢å¤´æ–‡ä»¶è¢«é‡å¤åŒ…å«çš„æŒ‡ä»¤ï¼Œç­‰æ•ˆäºä¼ ç»Ÿçš„å¤´æ–‡ä»¶ä¿æŠ¤å®ï¼š #ifndef HEADER_FILE_NAME#define HEADER_FILE_NAME// å¤´æ–‡ä»¶å†…å®¹#endif ä½¿ç”¨ #pragma once å¯ä»¥ç®€åŒ–ç¼–å†™å¤´æ–‡ä»¶ä¿æŠ¤ä»£ç ï¼Œé¿å…é‡å¤åŒ…å«é—®é¢˜ã€‚ #pragma GCC poisonç”¨é€”ï¼šç¦æ­¢ä½¿ç”¨ç‰¹å®šçš„æ ‡è¯†ç¬¦ã€‚å¦‚æœåœ¨ä»£ç ä¸­ä½¿ç”¨äº†è¿™äº›æ ‡è¯†ç¬¦ï¼Œç¼–è¯‘å™¨å°†å‘å‡ºé”™è¯¯ã€‚ #pragma GCC poison printf scanf// ä½¿ç”¨ printf æˆ– scanf ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ #pragma GCC optimizeç”¨é€”ï¼šæ§åˆ¶ç‰¹å®šä»£ç æ®µçš„ä¼˜åŒ–é€‰é¡¹ï¼Œå¯ä»¥ç”¨äºå¯ç”¨æˆ–ç¦ç”¨ä¼˜åŒ–ã€‚ #pragma GCC optimize (O3) // åœ¨æ­¤ä»£ç æ®µå¯ç”¨æœ€é«˜ä¼˜åŒ–çº§åˆ«void optimizedFunction() // é«˜åº¦ä¼˜åŒ–çš„ä»£ç  #pragma GCC targetç”¨é€”ï¼šä¸ºæŒ‡å®šçš„å‡½æ•°è®¾ç½®ç‰¹å®šçš„ç›®æ ‡æ¶æ„ã€‚è¿™åœ¨ç¼–è¯‘å™¨æ”¯æŒå¤šç§ CPU æŒ‡ä»¤é›†æ—¶éå¸¸æœ‰ç”¨ã€‚ #pragma GCC target (sse4.2)void sseOptimizedFunction() // ä»…åœ¨æ”¯æŒ SSE4.2 çš„å¹³å°ä¸Šè¿›è¡Œä¼˜åŒ– #pragma messageç”¨é€”ï¼šåœ¨ç¼–è¯‘æ—¶å‘ç”¨æˆ·æ˜¾ç¤ºè‡ªå®šä¹‰æ¶ˆæ¯ã€‚ #pragma message This is a custom compile-time message å½“ç¼–è¯‘å™¨å¤„ç†åˆ°è¿™æ¡æŒ‡ä»¤æ—¶ï¼Œä¼šè¾“å‡ºæ¶ˆæ¯åˆ°ç¼–è¯‘å™¨çš„è¾“å‡ºä¸­ï¼Œæ–¹ä¾¿å¼€å‘è€…æé†’æˆ–è°ƒè¯•ã€‚ #pragma weakç”¨é€”ï¼šå®šä¹‰å¼±ç¬¦å·ï¼Œå³ä½¿ç¬¦å·æœªè¢«å®šä¹‰ï¼Œé“¾æ¥å™¨ä¸ä¼šæŠ¥é”™ã€‚é€šå¸¸ç”¨äºåº“å‡½æ•°çš„æ›¿ä»£å®ç°ã€‚ #pragma weak myFunctionvoid myFunction() // å¦‚æœå¦ä¸€ä¸ª myFunction å®ç°å­˜åœ¨ï¼Œåˆ™ä¸ä¼šä½¿ç”¨æ­¤å®ç° é¢„å¤„ç†æ“ä½œç¬¦ # å’Œ ##æœ‰ä¸¤ä¸ªé¢„å¤„ç†æ“ä½œç¬¦å¯ç”¨äº #define ä¸­ï¼š #ï¼šå­—ç¬¦ä¸²åŒ–æ“ä½œç¬¦ï¼Œå°†å®å‚æ•°è½¬æ¢ä¸ºç”¨åŒå¼•å·åŒ…å›´çš„å­—ç¬¦ä¸²ã€‚ ##ï¼šæ‹¼æ¥æ“ä½œç¬¦ï¼Œå°†ä¸¤ä¸ªæ ‡è®°ç»“åˆå½¢æˆæ–°æ ‡è®°ã€‚ #define mkstr(s) #sprintf(mkstr(I like C)); // è½¬æ¢ä¸º I like C #define concat(a, b) a##bprintf(%d, concat(x, y)); // å‡è®¾ x å˜é‡å’Œ y å˜é‡å­˜åœ¨ï¼Œå°†è¾“å‡º xy çš„å€¼ ##ç²˜è¿## æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª èƒ¶æ°´è¿ç®—ã€‚åœ¨ C è¯­è¨€ä¸­ï¼Œ## è¿ç®—ç¬¦ç”¨äºå°†å‚æ•°å®ä¸­çš„å½¢å‚ä¸å…¶å®ƒæ²¡æœ‰å¤©ç„¶åˆ†å‰²çš„å†…å®¹ç²˜è¿åœ¨ä¸€èµ·ã€‚æ¯”å¦‚ï¼Œä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå®ï¼Œè®©å®ƒè‡ªåŠ¨åœ°å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼š #define def_u32_array(__name, __size) uint32_t array_##__name[__size]; åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œä»¬å¯èƒ½ä¼šè¿™æ ·è°ƒç”¨è¿™ä¸ªå®ï¼š def_u32_array(sample_buffer, 64) ç»è¿‡å®å±•å¼€åï¼Œæœ€ç»ˆæ•ˆæœæ˜¯ï¼š uint32_t array_sample_buffer[64]; è¿™é‡Œå¯ä»¥è§‚å¯Ÿåˆ°ï¼Œarray_ ä¸å½¢å‚ __name æ˜¯æ²¡æœ‰å¤©ç„¶åˆ†éš”ç¬¦çš„ï¼Œå› æ­¤è¦å°† array_ ä¸ name æ‰€ä»£è¡¨çš„å†…å®¹ç²˜è¿åœ¨ä¸€èµ·ï¼Œ## è¿ç®—ç¬¦æ˜¯å¿…ä¸å¯å°‘çš„ã€‚åä¹‹ï¼Œname ä¸ [ ä¹‹é—´æœ‰å¤©ç„¶åˆ†éš”ï¼Œç¼–è¯‘å™¨èƒ½å¤Ÿè¯†åˆ«è¿™ä¸¤ä¸ªéƒ¨åˆ†ã€‚å› æ­¤ä¸ç”¨é¢å¤–ä½¿ç”¨ ## è¿ç®—ç¬¦ã€‚ è¿æ¥å¯å˜å‚æ•°å®## è¿ç®—ç¬¦è¿˜æœ‰ä¸€ä¸ªä¸å¤ªä¸ºäººæ‰€çŸ¥çš„ç”¨æ³•ã€‚ä»¬éœ€è¦æåŠå¦å¤–ä¸€ç§å‚æ•°å®æ‰©å±• â€” å¯å˜å‚æ•°å®ã€‚ä¸¾ä¸ªä¾‹å­ï¼š #define safe_atom_code(...) \\ uint32_t int_flag = __disable_irq(); __VA_ARGS__ __set_PRIMASK(int_flag); \\ è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªå® safe_atom_code()ï¼Œåœ¨æ‹¬å·ä¸­ï¼Œæ— è®ºå¡«å†™ä»»ä½•å†…å®¹ï¼Œè¿™äº›å†…å®¹éƒ½ä¼šè¢«æ”¾ç½®åˆ° __VA_ARGS__ æ‰€åœ¨çš„ä½ç½®ã€‚å¯ä»¥ç†è§£ä¸ºæ‹¬å·é‡Œçš„ ... å®é™…ä¸Šå¯¹åº”ç€ __VA_ARGS__ã€‚ä¾‹å¦‚ï¼Œä»¬å¯ä»¥å†™å¦‚ä¸‹ä»£ç ï¼š /** \\fn void wr_dat (uint16_t dat) * \\brief Write data to the LCD controller * \\param[in] dat Data to write */static __inline void wr_dat(uint_fast16_t dat) safe_atom_code( LCD_CS(0); GLCD_PORT-DAT = (dat 8); /* Write D8..D15 */ GLCD_PORT-DAT = (dat 0xFF); /* Write D0..D7 */ LCD_CS(1); ) è¿™ä¸ªä»£ç å—ç¡®ä¿åœ¨å‘å¯„å­˜å™¨ GLCD_PORT-DAT å†™å…¥æ•°æ®çš„è¿‡ç¨‹ä¸ä¼šè¢«å…¶å®ƒä¸­æ–­æ‰“æ–­ã€‚æ­¤æ—¶èªæ˜çš„å¯èƒ½ä¼šæå‡ºç–‘é—®ï¼šè¿™æ®µå®ä¸ä¸‹é¢çš„å†™æ³•æœ‰ä½•åŒºåˆ«ï¼Ÿ #define safe_atom_code(__CODE) \\ uint32_t int_flag = __disable_irq(); __CODE __set_PRIMASK(int_flag); \\ å‚æ•°å®ä¸é¢„ç¼–è¯‘å™¨çš„åšå¼ˆå‚æ•°å®é€šè¿‡ ,ï¼ˆé€—å·ï¼‰ä½œä¸ºåˆ†éš”ç¬¦æ¥è®¡ç®—å®é™…ä¼ å…¥çš„å‚æ•°ä¸ªæ•°ã€‚åœ¨ä½¿ç”¨å‚æ•°å®çš„æ—¶å€™ï¼Œé¢„ç¼–è¯‘å™¨å®é™…ä¸Šå¹¶ä¸ç†è§£ C è¯­è¨€è¯­æ³• â€”â€” åœ¨å®ƒçœ¼ä¸­ï¼Œé™¤äº†å®ƒè®¤è¯†çš„å°‘æ•°ç¬¦å·å¤–ï¼Œå…¶ä»–çš„éƒ½æ˜¯æ— æ„ä¹‰çš„å­—ç¬¦ä¸²ã€‚åœ¨å¤„ç†æ‹¬å·å†…çš„å†…å®¹æ—¶ï¼Œé¢„ç¼–è¯‘å™¨åªè®¤è¯† , å’Œ ...ã€‚å› æ­¤ï¼Œå½“å†…å®¹ä¸­çš„ , å¢åŠ æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè®¤ä¸ºå‚æ•°çš„ä¸ªæ•°ä¹Ÿå¢å¤šã€‚å½“ä½¿ç”¨å‚æ•°å®æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ä¸ªæ•°ï¼ˆéœ€é€šè¿‡ , åˆ†éš”ï¼‰å¿…é¡»ä¸å®šä¹‰å‚æ•°å®æ—¶çš„å½¢å‚æ•°é‡ä¸€è‡´ã€‚å¦‚æœä¸ä¸€è‡´ï¼Œé¢„ç¼–è¯‘å™¨é€šå¸¸ä¸ä¼šç›´æ¥æŠ¥é”™ï¼Œè€Œæ˜¯ä¼šæ— è§†æ‰€ä¼ é€’çš„å†…å®¹ï¼Œå°†å…¶ä¼ é€’åˆ°ç¼–è¯‘é˜¶æ®µã€‚å¦‚æœå‡ºç°æœªå®šä¹‰å‡½æ•°çš„é”™è¯¯ï¼Œå¯èƒ½æ˜¯å› ä¸ºå®æœ¬èº«è¢«è¯¯è®¤ä¸ºæ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°ã€‚å¯å˜å‚æ•°å®è§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚å¯å˜å‚æ•°å®ä¸­ï¼Œ... åªèƒ½ä½äºå½¢å‚åˆ—è¡¨çš„æœ€åï¼Œå½“ç”¨æˆ·æä¾›çš„å‚æ•°ä¸ªæ•°è¶…è¿‡å®šä¹‰çš„æ•°é‡æ—¶ï¼Œé¢å¤–çš„å‚æ•°å°±ä¼šé€šè¿‡ __VA_ARGS__ è¿›è¡Œå¤„ç†ã€‚å½“ç”¨æˆ·æä¾›çš„å‚æ•°ä¸ªæ•°æ­£å¥½ç­‰äºå½¢å‚ä¸ªæ•°æ—¶ï¼Œ__VA_ARGS__ ç­‰æ•ˆäºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚ log_info çš„ä½¿ç”¨å›åˆ°ä¸Šè¿°çš„ safe_atom_code å®ï¼Œä»¬å†çœ‹çœ‹ï¼š #define log_info(__STRING, ...) printf(__STRING, __VA_ARGS__) ä½¿ç”¨æ—¶ï¼Œä»¬å¯ä»¥è¿™æ ·è°ƒç”¨ï¼š log_info(------------------------------------\\r );log_info( Cycle Count : %d, total_cycle_cnt); è¿™æ®µä»£ç ä¼šå±•å¼€ä¸ºï¼š printf(------------------------------------\\r ,);printf( Cycle Count : %d, total_cycle_cnt); çœ‹ä¼¼æ²¡æœ‰é—®é¢˜ï¼Œä½†æ³¨æ„åˆ°ä¸€ä¸ªç»†èŠ‚ï¼šæ­¤æ—¶ç¬¬ä¸€ä¸ª printf() å‡½æ•°çš„å‚æ•°åˆ—è¡¨ç»“å°¾å¤šäº†ä¸€ä¸ª ,ã€‚å°½ç®¡æŸäº›ç¼–è¯‘å™¨ï¼ˆå¦‚ GCCï¼‰å¯èƒ½å¯¹æ­¤ä¸äºˆå¤ªå¤šå…³æ³¨ï¼Œä½†å¯¹äºè¿½æ±‚ä»£ç æ•´æ´çš„å¼€å‘è€…æ¥è¯´ï¼Œè¿™ç§å¤šä½™çš„é€—å·å°±æ˜¾å¾—å¾ˆä¸èˆ’æœã€‚ ANSI-C99 æ ‡å‡†ä¸ºäº†è§£å†³è¿™ç§æƒ…å†µï¼Œå¼•å…¥äº†ä¸€ä¸ªæœ‰ç”¨çš„è¯­æ³•ï¼šåœ¨ ,##__VA_ARGS__ çš„ç»„åˆä½¿ç”¨æ—¶ï¼Œå¦‚æœ __VA_ARGS__ ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå‰é¢çš„ , å°†ä¼šè¢«åˆ é™¤ã€‚è¿™æ ·ï¼Œä»¬å¯ä»¥å°†å®æ”¹å†™ä¸ºï¼š #define log_info(__STRING, ...) printf(__STRING,##__VA_ARGS__) æœ€ç»ˆå±•å¼€ä¸ºï¼š printf(------------------------------------\\r );printf( Cycle Count : %d, total_cycle_cnt); è¿™æ ·æœ€åçš„é€—å·å°±ä¸ä¼šå‡ºç°äº†ï¼Œè®©ä»£ç æ›´åŠ å¹²å‡€æ•´æ´ã€‚ é€—å·è¡¨è¾¾å¼çš„çµæ´»æ€§ç»“åˆå‰é¢å…³äº ,##__VA_ARGS__ çš„ç”¨æ³•ï¼Œä»¬å¯ä»¥æ„è¯†åˆ°ï¼Œè¿™é‡Œçš„é€—å·ä¸ä»…å¯ä»¥ä½œä¸ºå‚æ•°åˆ—è¡¨çš„åˆ†éš”ç¬¦ï¼Œè¿˜æ˜¯é€—å·è¡¨è¾¾å¼çš„è¿ç®—ç¬¦ã€‚å› æ­¤ï¼Œä»¬å¯ä»¥å†™å‡ºç±»ä¼¼è¿™æ ·çš„å®ï¼š #define EXAMPLE(...) ( é»˜è®¤å€¼ ,##__VA_ARGS__) è¿™ç§å†™æ³•å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š æ— å‚æ•°è°ƒç”¨ï¼šå½“ä½¿ç”¨æ—¶ä¸å¡«å†™ä»»ä½•å†…å®¹ï¼Œæœ€ç»ˆä¼šå±•å¼€ä¸ºä»…æœ‰é»˜è®¤å€¼çš„æƒ…å†µï¼š EXAMPLE(); // å±•å¼€ä¸ºï¼š( é»˜è®¤å€¼ ) æä¾›æœ‰æ•ˆå€¼ï¼šå¦‚æœæä¾›äº†æœ‰æ•ˆå€¼ï¼Œåˆ™å±•å¼€æˆé€—å·è¡¨è¾¾å¼ï¼š EXAMPLE(ä»¬æä¾›çš„å€¼); // å±•å¼€ä¸ºï¼š( é»˜è®¤å€¼, ä»¬æä¾›çš„å€¼ ) ç”±äºé€—å·è¡¨è¾¾å¼çš„ç‰¹æ€§ï¼Œé»˜è®¤å€¼ä¼šè¢«ä¸¢å¼ƒï¼Œè¿™è™½ç„¶åœ¨æŸäº›ç¼–è¯‘å™¨ä¸­å¯èƒ½æŠ¥å‡ºæ— æ•ˆçš„è­¦å‘Šï¼Œä½†åœ¨ç”¨æ³•ä¸Šæ˜¯å®Œå…¨åˆç†çš„ã€‚ è¿™ä¸€æŠ€å·§åœ¨ API å°è£…ä¸Šéå¸¸æœ‰æ•ˆï¼Œå¯ä»¥ä¸ºå‡½æ•°ç®€åŒ–ä½¿ç”¨æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·è°ƒç”¨åˆå§‹åŒ–å‡½æ•°å¹¶é€šè¿‡ç»“æ„ä½“é…ç½®æŸäº›å‚æ•°æ—¶ï¼Œå¦‚æœç”¨æˆ·ä¼ å…¥çš„é…ç½®ä¸º NULLï¼Œç³»ç»Ÿåˆ™å¯ä»¥ç”¨é»˜è®¤çš„é…ç½®ï¼š #define XXXX_INIT(...) xxxx_init((NULL,##__VA_ARGS__)) åœ¨æ¶ˆæ¯å¤„ç†æ–¹é¢ï¼Œå¼€å‘è€…å¯ä»¥è®¾è®¡ç±»ä¼¼æœºåˆ¶ï¼Œå…è®¸ç¨‹åºæ ¹æ®ç”¨æˆ·ä¼ å…¥çš„å‚æ•°è‡ªåŠ¨å¤„ç†å¿…è¦çš„é…ç½®ï¼š #define def_msg_map(__name, ...) \\ const msg_t __name[] = __VA_ARGS__; #define add_msg(__msg, __handler, ...) \\ \\ .msg = (__msg), \\ .handler = (__handler), \\ .msk = (0xFFFF, ##__VA_ARGS__), \\ è¿™æ ·ï¼Œå½“ç”¨æˆ·çœç•¥å‚æ•°æ—¶ï¼Œç³»ç»Ÿå°±ä¼šæä¾›é»˜è®¤å€¼ï¼Œä¾‹å¦‚ï¼š def_msg_map(iap_message_map, add_msg(SIGN_UP, iap_sign_up_handler), add_msg(WRITE_MEM, iap_write_mem, 0xFF00), add_msg(READ_MEM, iap_read_mem, 0xFF00)); è¿™æ¡ä»£ç å±•ç¤ºäº†å¦‚ä½•è®©ç³»ç»Ÿåœ¨å¤„ç†æ¶ˆæ¯æ—¶é‡‡ç”¨é»˜è®¤å€¼ï¼ŒåŒæ—¶ä¹Ÿå…è®¸ç”¨æˆ·è‡ªå®šä¹‰ç‰¹å®šæ¡ä»¶ï¼Œä»è€Œå®ç°çµæ´»çš„æ¶ˆæ¯ç®¡ç†ã€‚è¿™è®©ç¨‹åºåœ¨è¿è¡Œæ—¶è¡¨ç°å¾—æ›´åŠ æ™ºèƒ½å’Œå‹å¥½ã€‚ é¢„å®šä¹‰å®C è¯­è¨€è§„èŒƒäº†äº”ä¸ªå›ºæœ‰çš„é¢„å®šä¹‰å®ï¼š __LINE__ï¼šå½“å‰ç¼–è¯‘çš„ä»£ç è¡Œå·ã€‚ __FILE__ï¼šå½“å‰ç¼–è¯‘çš„æºæ–‡ä»¶åã€‚ __DATE__ï¼šæºæ–‡ä»¶ç¼–è¯‘æ—¶çš„æ—¥æœŸï¼Œæ ¼å¼ä¸º month/day/yearã€‚ __TIME__ï¼šæºä»£ç ç¼–è¯‘æ—¶çš„æ—¶é—´ï¼Œæ ¼å¼ä¸º hour:minute:secondã€‚ __STDC__ï¼šå¦‚æœå†…å®¹æ˜¯åè¿›åˆ¶å¸¸æ•° 1ï¼Œè¡¨ç¤ºç¼–è¯‘ç¨‹åºç¬¦åˆæ ‡å‡† Cã€‚ typedef çš„åº”ç”¨åœ¨é¢„å¤„ç†å’Œä»£ç ç¼–å†™ä¸­ï¼Œä»¬ç»å¸¸ä½¿ç”¨ #defineã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œtypedef ä¸ #define ç”¨æ³•ç›¸ä¼¼ï¼Œä½†å®ƒä»¬æœ‰æ˜ç¡®çš„åŒºåˆ«ï¼š typedef æ˜¯ C è¯­è¨€çš„å…³é”®å­—ã€‚ #define æ˜¯é¢„å¤„ç†å‘½ä»¤ã€‚ typedef å¸¸ç”¨äºä¸ºç°æœ‰æ•°æ®ç±»å‹å®šä¹‰æ–°åå­—ï¼Œåœ¨æ•°æ®ç»“æ„ä¸­å°¤ä¸ºé¢‘ç¹ã€‚ä¾‹å¦‚ï¼š typedef struct _node_ int data; struct _node_ *next; listnode, *linklist; åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œlistnode è¢«å®šä¹‰ä¸ºç»“æ„ä½“ç±»å‹ï¼Œè€Œ linklist åˆ™æ˜¯æŒ‡å‘è¯¥ç»“æ„ä½“çš„æŒ‡é’ˆç±»å‹ã€‚é€šè¿‡ä½¿ç”¨ typedefï¼Œç¨‹åºå‘˜å¯ä»¥è®©ä»£ç æ›´åŠ æ¸…æ™°å’Œæ˜“äºç»´æŠ¤ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€"]},{"title":"ä½è¿ç®—","path":"/2024/06/13/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-ä½è¿ç®—-ä½è¿ç®—/","content":"åŸç ä¸è¡¥ç åœ¨è®¡ç®—æœºä¸­ï¼Œæ•°å­—ä»¥ä¸åŒçš„æ–¹å¼è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œ1000 0011 æ˜¯åŸç ï¼Œ1111 1111 æ˜¯è¡¥ç ã€‚è¡¥ç çš„å¥½å¤„æ˜¯èƒ½ç®€åŒ–è®¡ç®—æœºå¯¹è´Ÿæ•°çš„å¤„ç†ã€‚ åŸç ï¼š 1000 0011è¡¥ç ï¼š 1111 1111 å¯¹äº sizefof(2.2)ï¼Œè¿”å›çš„æ•°æ®æ˜¯ 8 å­—èŠ‚ï¼Œè€Œ 1000 0011 å’Œ 1111 1111 åˆ†åˆ«æ˜¯åŸç ä¸è¡¥ç çš„è¡¨ç¤ºæ–¹å¼ã€‚ 1000 0000 0000 0000 0000 0000 0000 00111111 1111 1111 1111 1111 1111 1111cpp 1101 è¿™é‡Œçš„æ•°å€¼å’Œå…¶å¯¹åº”çš„äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºä¹Ÿéå¸¸é‡è¦ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿›è¡Œç®—æœ¯è¿ç®—æ—¶ã€‚ ç±»å‹è½¬æ¢åœ¨ç¼–ç¨‹ä¸­ï¼Œç±»å‹è½¬æ¢æ˜¯å°†ä¸€ç§æ•°æ®ç±»å‹çš„å€¼è½¬æ¢ä¸ºå¦ä¸€ç§æ•°æ®ç±»å‹ã€‚å…·ä½“ä¾‹å¦‚ï¼Œä½¿ç”¨ sizeof(2.2) å¯èƒ½è¿”å› 8ï¼Œè¡¨ç¤ºæ‰€éœ€çš„å­—èŠ‚æ•°ã€‚ å¼ºåˆ¶ç±»å‹è½¬æ¢å¼ºåˆ¶ç±»å‹è½¬æ¢å¯ä»¥è®©ä»¬æ˜ç¡®åœ°æŒ‡å®šå€¼çš„ç±»å‹ã€‚ ä½¿ç”¨ printf å‡½æ•°è¾“å‡ºå€¼æ—¶ï¼Œå¯èƒ½çœ‹åˆ°ä¸åŒçš„ç»“æœã€‚ä¾‹å¦‚ï¼š printf(%f, 23 / 2); // è¾“å‡ºæ•´æ•°ï¼Œç»“æœä¸º 11.000000printf(%f, (float)23 / 2); // è¾“å‡ºæµ®ç‚¹æ•°ï¼Œç»“æœä¸º 11.500000printf(%f, (float)(23 / 2)); // è¾“å‡ºæµ®ç‚¹æ•°ï¼Œç»“æœä¸º 11.000000 è¿™ä¸‰ä¸ªä¾‹å­å±•ç¤ºäº†ä¸åŒçš„å¼ºåˆ¶ç±»å‹è½¬æ¢æ•ˆæœã€‚ ç®—æœ¯è¡¨è¾¾å¼ç®—æœ¯è¡¨è¾¾å¼æ¶‰åŠä½¿ç”¨ç®—æœ¯è¿ç®—ç¬¦ï¼ˆå¦‚ +, -, *, /, %ï¼‰æ¥è®¡ç®—å€¼ã€‚åœ¨å¤„ç†é™¤æ³•æ—¶ï¼Œç¡®ä¿åˆ†æ¯ä¸ä¸ºé›¶ï¼Œå–ä½™è¿ç®—è¦æ±‚æ“ä½œæ•°ä¸ºæ•´æ•°ã€‚ è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ä¸ºï¼š 1. ()2. * / %3. + - è€Œè®¡ç®—çš„ç»“åˆæ€§é€šå¸¸ä¸ºä»å·¦åˆ°å³ï¼š k = i+++j; // ç­‰ä»·äº (i++) + j è‡ªå¢ä¸è‡ªå‡è¿ç®—ç¬¦è‡ªå¢å’Œè‡ªå‡è¿ç®—ç¬¦å¯ä»¥è¢«ç”¨äºä¸åŒç±»å‹ï¼š å¯¹äºå°†å˜é‡å¢ åŠ  1ï¼Œä½¿ç”¨è‡ªå¢è¿ç®—ç¬¦æ˜¯æœ€ä½³é€‰æ‹©ï¼Œå› ä¸ºå®ƒçš„æ•ˆç‡é«˜ã€‚ å¦‚æœå¢é‡ä¸æ˜¯ 1ï¼Œè€ƒè™‘ä½¿ç”¨å¤åˆèµ‹å€¼è¿ç®—ï¼ši += 10; ç­‰åŒäº i = i + 10; int i = 1;j = i+++i++; // j = 2, i = 2 èµ‹å€¼è¿ç®—ç¬¦èµ‹å€¼è¿ç®—ç¬¦æœ‰å‡ ä¸ªè§„åˆ™è¦éµå¾ªï¼š ç­‰å·å·¦ä¾§åªèƒ½æ˜¯å˜é‡ï¼Œä¸èƒ½æ˜¯è¡¨è¾¾å¼ã€å¸¸é‡æˆ–æ•°ç»„åï¼ˆå½¢å‚æ•°ç»„åé™¤å¤–ï¼‰ã€‚ å³ä¾§æ³¨æ„æ•°æ®ç±»å‹ã€‚ èµ‹å€¼è¡¨è¾¾å¼çš„å€¼ï¼Œå³è¢«èµ‹å€¼å˜é‡çš„å€¼ã€‚ x = (y = 2, z = 3); // å…ˆèµ‹å€¼yä¸º2ï¼Œå†èµ‹å€¼zä¸º3ï¼Œxçš„å€¼ä¸º3 å¤åˆèµ‹å€¼è¿ç®—ç¬¦å¤åˆèµ‹å€¼è¿ç®—ç¬¦ç»“åˆäº†èµ‹å€¼ä¸è¿ç®—ç¬¦ã€‚ä¾‹å¦‚ï¼š x += 2; // ç­‰ä»·äº x = x + 2;a *= b + c; // ç­‰ä»·äº a = a * (b+c); æ¡ä»¶è¿ç®—ç¬¦æ¡ä»¶è¿ç®—ç¬¦ç”¨äºç®€åŒ–æ¡ä»¶åˆ¤æ–­ï¼Œå¦‚ ? : è¯­å¥ã€‚ä¾‹å¦‚ï¼š y = (x 10) ? x / 10 : (x 0 ? x : -x); é€—å·è¿ç®—ç¬¦é€—å·è¿ç®—ç¬¦ç”¨äºä¾æ¬¡æ‰§è¡Œå¤šä¸ªè¡¨è¾¾å¼ï¼Œè¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„ç»“æœã€‚ä¾‹å¦‚ï¼š y = (2, 3, 4); // y çš„å€¼ä¸º 4 ä½è¿ç®—ç¬¦ä½è¿ç®—ç¬¦é’ˆå¯¹äºŒè¿›åˆ¶ä½è¿›è¡Œæ“ä½œï¼ŒåŒ…æ‹¬æŒ‰ä½ä¸ ()ã€æŒ‰ä½æˆ– (|)ã€æŒ‰ä½å–å (~)ã€æŒ‰ä½å¼‚æˆ– (^)ã€å·¦ç§» ()ã€å³ç§» ()ã€‚ 123 111; // å¾—åˆ° 107ï¼Œå› ä¸º111æ˜¯0110 1111ï¼Œ0å’Œ0å¾—åˆ°0ï¼Œ1å’Œ1å¾—åˆ°1ï¼Œå…¶ä»–çš†ä¸º0ã€‚ å¯¹äºä¸€ä¸ªå­˜å‚¨å•å…ƒæ¸…é›¶ï¼Œä»¬å¯ä»¥ä½¿ç”¨ä¸è¿ç®—ï¼šnum (~(1U n)); åŒæ ·å¯ä»¥ç”¨ä¸è¿ç®—æå–æŸäº›ä½ç½®çš„å€¼ã€‚ ä½è¿ç®—çš„æ“ä½œ æ¸…é›¶æŸæŒ‡å®šä½ å½“ä»¬å¤„ç†æ•°å€¼ 123ï¼ˆå…¶äºŒè¿›åˆ¶è¡¨ç¤ºä¸º 01111011ï¼‰æ—¶ï¼Œä¾‹å¦‚æƒ³è¦å°†ç¬¬ 4 ä½æ¸…é›¶ã€‚ä»¬ä½¿ç”¨ 123 (~(1U 4)) çš„æ–¹æ³•ã€‚è¿™é‡Œçš„ 1U 4 æ“ä½œæ˜¯å°†æ•°å­— 1 å·¦ç§» 4 ä½ï¼Œç»“æœæ˜¯ 00010000ï¼ˆå³åå…­è¿›åˆ¶çš„ 0x10ï¼‰ï¼Œå–ååå¾—åˆ° 11101111ã€‚å°†è¿™ä¸ªå€¼ä¸ 123 è¿›è¡Œä¸è¿ç®—åï¼Œç»“æœä¸º 01101011ï¼Œå…¶ä¸­ç¬¬ 4 ä½è¢«æˆåŠŸæ¸…é›¶ã€‚ å–å‡ºæŸæŒ‡å®šä½ å‡è®¾ä»¬æœ‰ä¸€ä¸ªæ•´æ•° int a = 123ï¼ˆå…¶äºŒè¿›åˆ¶è¡¨ç¤ºä¸º 01111011ï¼‰ï¼Œæƒ³è¦è·å–è¿™ä¸ªæ•°çš„ä½ 4 ä½å€¼ï¼Œä»¬å¯ä»¥ä½¿ç”¨ a 0x0Fã€‚ ä¿ç•™æŸæŒ‡å®šä½ ä¸ºäº†ä¿ç•™æ•°å€¼ 123 çš„ç‰¹å®šä¸€ä½ï¼Œæ¯”å¦‚ç¬¬ n ä½ï¼Œå¯ä»¥é€šè¿‡ 123 (1U n) çš„æ–¹å¼æ“ä½œã€‚å°† 1 å·¦ç§» n ä½çš„ç»“æœä¼šå½¢æˆä¸€ä¸ªä»…åœ¨ç¬¬ n ä½ä¸Šçš„æ•°å­—ä¸º 1 çš„ä½æ©ç ï¼Œæ¯”å¦‚ n 2ï¼Œæ©ç å°±æ˜¯ 00000100ã€‚ä¸ 123 è¿›è¡Œä¸è¿ç®—æ—¶ï¼Œå…¶ä»–ä½ä¸å—å½±å“ï¼Œè€Œåªæœ‰ç¬¬ n ä½ä¼šä¿ç•™ä¸‹æ¥ï¼Œä¾¿äºåç»­æ“ä½œã€‚å¦‚æœæƒ³æ£€æŸ¥ç¬¬ 2 ä½çš„æƒ…å†µï¼Œå¦‚ 123 (1U 2)ï¼Œä¼šå¾—åˆ° 00000000ï¼Œè¡¨ç¤ºè¯¥ä½ä¸º 0ã€‚ è®¾ç½®è‹¥å¹²ä¸ªä½ å¯¹äºæ•°å€¼ 123ï¼ˆäºŒè¿›åˆ¶è¡¨ç¤ºä¸º 01111011ï¼‰ï¼Œå¦‚æœä»¬æƒ³å°†ç¬¬ 4 åˆ° 7 ä½è®¾ç½®ä¸ºäºŒè¿›åˆ¶å€¼ 1001ï¼Œå¯é‡‡ç”¨çš„æ“ä½œæ˜¯ num (-(0xf 4)) | (0x9 4)ã€‚é¦–å…ˆï¼Œ0xfï¼ˆäºŒè¿›åˆ¶ä¸º 1111ï¼‰å·¦ç§» 4 ä½å¾—åˆ° 11110000ï¼Œç„¶åå–å…¶è´Ÿå€¼è·å¾— 00001111 è¿›è¡Œä¸è¿ç®—ä¼šå°†åŸæ•°çš„ç¬¬ 4 åˆ° 7 ä½æ¸…é›¶ã€‚å¾€åï¼Œ0x9ï¼ˆå³ 00001001ï¼‰å·¦ç§» 4 ä½å˜æˆ 10010000ï¼Œå¹¶ä¸ä¹‹å‰çš„ç»“æœè¿›è¡Œæˆ–è¿ç®—ï¼Œæœ€ç»ˆå°†åŸæ•°çš„ç¬¬ 4 åˆ° 7 ä½è¿ç§»ä¸º 1001ã€‚ä¾‹å¦‚ï¼ŒåŸæ•°æ˜¯ 01111011ï¼Œç»è¿‡è¿™äº›ä½æ“ä½œåï¼Œæœ€ç»ˆå€¼å°†æˆä¸º 00001011ï¼ˆå³åè¿›åˆ¶çš„ 11ï¼‰ã€‚ æ“ä½œç¬¦ å’Œ ||å°½ç®¡ æ“ä½œç¬¦çš„ä¼˜å…ˆçº§è¾ƒä½ï¼Œä½†å®ƒä»ç„¶ä¼šå¯¹ä¸¤ä¸ªå…³ç³»è¡¨è¾¾å¼æ–½åŠ æ§åˆ¶ã€‚ æ“ä½œç¬¦çš„å·¦æ“ä½œæ•°æ€»æ˜¯é¦–å…ˆè¿›è¡Œæ±‚å€¼ å¦‚æœå®ƒçš„å€¼ä¸ºçœŸï¼Œç„¶åç´§æ¥ç€å¯¹å³æ“ä½œæ•°è¿›è¡Œæ±‚å€¼ã€‚ å¦‚æœå·¦æ“ä½œæ•°çš„å€¼ä¸ºå‡ï¼Œé‚£ä¹ˆå³æ“ä½œæ•°ä¾¿ä¸å†è¿›è¡Œæ±‚å€¼ï¼Œå› ä¸ºæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼è‚¯å®šæ˜¯å‡çš„ï¼Œå³æ“ä½œæ•°çš„å€¼å·²æ— å…³ç´§è¦ã€‚ æ“ä½œç¬¦ || å…·æœ‰ç›¸åŒçš„ç‰¹ç‚¹ï¼Œå®ƒé¦–å…ˆå¯¹å·¦æ“ä½œæ•°è¿›è¡Œæ±‚å€¼ï¼Œå¦‚æœå®ƒçš„å€¼æ˜¯çœŸçš„ï¼Œå³æ“ä½œæ•°ä¾¿ä¸å†æ±‚å€¼ï¼Œå› ä¸ºæ•´ä¸ªè¡¨è¾¾å¼çš„å€¼æ­¤æ—¶å·²ç»ç¡®å®šã€‚è¿™ä¸ªè¡Œä¸ºå¸¸å¸¸è¢«ç§°ä¸ºçŸ­è·¯æ±‚å€¼ï¼ˆshort-circuited evaluationï¼‰ã€‚ è¡¨è¾¾å¼çš„é¡ºåºå¿…é¡»ç¡®ä¿æ­£ç¡®ã€‚è¿™ç‚¹éå¸¸æœ‰ç”¨ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­åœ¨æ ‡å‡† Pascal ä¸­æ˜¯éæ³•çš„ï¼š if ( x = 0 x MAX array[x] == 0) ... åœ¨ C ä¸­ï¼Œè¿™æ®µä»£ç é¦–å…ˆæ£€æŸ¥ x çš„å€¼æ˜¯å¦åœ¨æ•°ç»„ä¸‹æ ‡çš„åˆæ³•èŒƒå›´ä¹‹å†…ã€‚å¦‚æœä¸æ˜¯ï¼Œä»£ç ä¸­çš„ä¸‹æ ‡å¼•ç”¨è¡¨è¾¾å¼ä¾¿è¢«å¿½ç•¥ã€‚ç”±äº Pascal å°†å®Œæ•´åœ°å¯¹æ‰€æœ‰çš„å­è¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ï¼Œæ‰€ä»¥å¦‚æœä¸‹æ ‡å€¼é”™è¯¯ï¼Œå°½ç®¡ç¨‹åºå·²ç»è´¹å°½å¿ƒæ€å¯¹ä¸‹æ ‡å€¼è¿›è¡ŒèŒƒå›´æ£€æŸ¥ï¼Œä½†ç¨‹åºä»ä¼šç”±äºæ— æ•ˆçš„ä¸‹æ ‡å¼•ç”¨è€Œå¯¼è‡´å¤±è´¥ã€‚ è­¦å‘Šï¼šä½æ“ä½œç¬¦å¸¸ä¸é€»è¾‘æ“ä½œç¬¦æ··æ·†ï¼Œä½†å®ƒä»¬ä¸å¯äº’æ¢çš„ã€‚å®ƒä»¬ä¹‹é—´çš„ç¬¬ 1 ä¸ªåŒºåˆ«æ˜¯ || å’Œ æ“ä½œç¬¦å…·æœ‰çŸ­è·¯æ€§ã€‚ å¦‚æœè¡¨è¾¾å¼çš„å€¼å–å†³äºå·¦æ“ä½œæ•°å¯å†³å®šï¼Œå®ƒå°±ä¸å†å¯¹å³æ“ä½œæ•°è¿›è¡Œæ±‚å€¼ã€‚ä¸ä¹‹ç›¸åï¼Œ| å’Œ æ“ä½œç¬¦ä¸¤è¾¹çš„æ“ä½œæ•°éƒ½éœ€è¦è¿›è¡Œæ±‚å€¼ã€‚ å…¶æ¬¡ï¼Œé€»è¾‘æ“ä½œç¬¦ç”¨äºæµ‹è¯•é›¶å€¼å’Œéé›¶å€¼ï¼Œè€Œä½æ“ä½œç¬¦ç”¨äºæ¯”è¾ƒå®ƒä»¬çš„çš„æ“ä½œæ•°ä¸­çš„å¯¹åº”çš„ä½ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­ï¼š if( a b c d )...if( a b c d )... å› ä¸ºå…³ç³»æ“ä½œç¬¦äº§ç”Ÿçš„è¡¨è¾¾å¼æ˜¯ 0ï¼Œæˆ–æ˜¯ 1ï¼Œæ‰€ä»¥è¿™ä¸¤æ¡è¯­å¥çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœ a æ˜¯ 1 è€Œ b æ˜¯ 2ï¼Œä¸‹ä¸€å¯¹è¯­å¥å°±ä¸ä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœã€‚ if( a b )...if( a b )... å› ä¸º a å’Œ b éƒ½æ˜¯éé›¶å€¼ï¼Œæ‰€ä»¥ç¬¬ 1 æ¡è¯­å¥çš„å€¼ä¸ºçœŸï¼Œä½†ç¬¬ 2 æ¡è¯­å¥çš„å€¼å´æ˜¯å‡ï¼Œå› ä¸º a å’Œ b çš„ä½æ¨¡å¼ä¸­ï¼Œæ²¡æœ‰ä¸€ä¸ªä½åœ¨ä¸¤è€…ä¸­çš„å€¼éƒ½æ˜¯ 1ã€‚ è®¾ç½®ç»“æ„ä½“å†…ä½åŸŸtypedef int * INT32;#define INT64 int *struct node_t char a; char b:2; char d:3; char e:4; char c; __attribute__((packed));int main(int argc, const char *argv[]) printf(%d , sizeof(struct node_t)); struct node_t val; val.b = 5; printf(%d , val.b); ç»“æ„ä½“ node_t åŒ…å«äº”ä¸ªæˆå‘˜ï¼šaã€bã€dã€e å’Œ cã€‚ b:2ã€d:3 å’Œ e:4 æ˜¯ä½åŸŸï¼Œåˆ†åˆ«å ç”¨ 2 ä½ã€3 ä½å’Œ 4 ä½ã€‚ __attribute__((packed)) å‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦å¯¹è¯¥ç»“æ„ä½“è¿›è¡Œå†…å­˜å¯¹é½ä¼˜åŒ–å–æ¶ˆå¯¹é½å¡«å……ï¼Œä½¿å…¶æŒ‰å®šä¹‰çš„å­—èŠ‚é¡ºåºç´§å‡‘å­˜å‚¨ã€‚æ‰€ä»¥ç»“æ„ä½“çš„å¤§å°ä¼šæ˜¯å„ä¸ªæˆå‘˜å­—èŠ‚æ•°å’Œä½åŸŸä½æ•°çš„æ€»å’Œã€‚ char a å’Œ char c å„å  1 å­—èŠ‚ã€‚ char b:2ã€char d:3 å’Œ char e:4 å…±å  9 ä½ï¼Œå³ 2 å­—èŠ‚ï¼ˆå› ä¸ºä½åŸŸä¸è¶³ä¸€ä¸ªå­—èŠ‚ï¼Œä½†ä¼šè¡¥é½åˆ°ä¸€ä¸ªå­—èŠ‚çš„æœ€å°å•ä½ï¼‰ã€‚æ€»å¤§å°ä¸º 1 + 2 + 1 4 å­—èŠ‚ã€‚ æ‰€ä»¥ï¼Œsizeof(struct node_t) çš„è¾“å‡ºæ˜¯ 4ã€‚val.b 5 çš„å€¼ä¼šè¢«æˆªæ–­åˆ° 2 ä½ï¼Œæ‰€ä»¥ printf(â€œ%d â€, val.b); çš„è¾“å‡ºä¼šæ˜¯ 1ï¼ˆå› ä¸º 5 çš„äºŒè¿›åˆ¶ä¸º 101ï¼Œæˆªæ–­åˆ° 2 ä½ä¸º 01ã€‚ ä½æ“ä½œçš„å¥‡å¶æ ¡éªŒ","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","ä½è¿ç®—"]},{"title":"å¤§å°ç«¯ï¼Œå­—èŠ‚åºï¼Œä½åºï¼Œå­—èŠ‚å¯¹é½ï¼Œä½åŸŸå¯¹é½","path":"/2024/06/12/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-ä½è¿ç®—-å¤§å°ç«¯ï¼Œå­—èŠ‚åºï¼Œä½åºï¼Œå­—èŠ‚å¯¹é½ï¼Œä½åŸŸå¯¹é½/","content":"æµ‹è¯•ç”¨æºä»£ç ï¼š#includestdio.h#includestring.h#if 1struct Test unsigned short a:2; unsigned short b:3; unsigned short c:5; unsigned short d:8;;#elsestruct Test unsigned char a:2; unsigned char b:3; unsigned char c:5; unsigned char d:8;;#endifint main(void) struct Test t; memset(t, 0x00,sizeof(t)); t.a = 1; t.b = 1; t.c = 1; t.d = 1; printf(%08X , *(unsigned int *)t); return 0; åˆ†æä¸ç»“æœï¼š æ€»ç»“ï¼š csdn ä¸Šå¾ˆå¤šæ–‡ç« ç§°â€ä½åŸŸä¸å¯ä»¥è·¨è¶Šå­—èŠ‚â€ï¼Œé”™ã€‚æ­£ç¡®è¯´æ˜¯ä½åŸŸä¸å¯ä»¥è·¨è¶Šå˜é‡ç±»å‹ã€‚å¦‚å›¾ä¸­ä¸­é—´çš„ä¾‹å­ï¼ˆæµ‹è¯•ç”¨æºä»£ç é‡Œç”¨#if #elseåˆ†åˆ«æµ‹è¯•äº†unsigned short å’Œ unsigned char ä¸¤ç§æƒ…å†µï¼‰ã€‚ å­—èŠ‚å¯¹é½ä¸ä½åŸŸå¯¹é½çš„è§„åˆ™ç½‘ä¸Šæœ‰å¾ˆå¤šæ–‡ç« ï¼Œå›¾ä¸­ç»™å‡ºäº†ä¸¤ç§ä¾‹å­ï¼Œå…¶å®åŸåˆ™éƒ½æ˜¯ä¸€æ ·çš„ï¼šä»¥å¯¹é½è¦æ±‚ä¸ºè¾¹ç•Œï¼ˆé€šå¸¸æ˜¯ 4 å­—èŠ‚ä¸ºè¾¹ç•Œï¼‰ï¼Œèƒ½æŒ¤å°±æŒ¤ã€‚ä¸èƒ½æŒ¤å°±å†å¼€ä¸€ä¸ªã€‚ é¢è¯•æ—¶é‡åˆ°è¿™ç±»é¢˜çš„è§£é¢˜æ€è·¯å¦‚ä¸Šå›¾ï¼š1ï¼Œå…ˆä»ä½åœ°å€åˆ°é«˜åœ°å€ç”»å‡ºä¸€å¼ å›¾ï¼›2ï¼Œå†æŠŠç»“æ„ä½“æˆå‘˜æŒ‰ç…§å­—èŠ‚å¯¹é½å’Œä½åŸŸå¯¹é½è¦æ±‚å¡«å…¥ï¼›3ï¼Œå†æŠŠæˆå‘˜å˜é‡çš„äºŒè¿›åˆ¶å€¼å¡«å…¥ï¼Œå°ç«¯ä¸ä¹¦å†™é¡ºåºç›¸åï¼ˆä»å³å¾€å·¦å†™å€¼ï¼‰ï¼Œå¤§ç«¯ç¬¦åˆä¹¦å†™å’Œé˜…è¯»ä¹ æƒ¯ï¼ˆä»å·¦å¾€å³ï¼‰4ï¼Œæ ¹æ®äºŒè¿›åˆ¶çš„å€¼è®¡ç®—å‡ºæœ€ç»ˆçš„è¾“å‡ºã€‚ï¼ˆæ³¨æ„å°ç«¯ä½åœ°å€å­˜çš„æ˜¯æ•°å­—çš„ä½ä½ï¼‰ MSB,LSB,ç»“åˆå¤§å°ç«¯çš„é—®é¢˜ï¼šç½‘ä¸Šå¤§å¤šæ•°æ–‡ç« çš„ä¾‹å­ï¼š å¤§ç«¯æ¨¡å¼ï¼šä¸€ä¸ªå¤šå­—èŠ‚æ•°æ®çš„é«˜å­—èŠ‚åœ¨å‰ï¼Œä½å­—èŠ‚åœ¨åï¼Œä»¥æ•°æ® 0x1234ABCD çœ‹ä¾‹å­ï¼šä½åœ°å€ â€”â€”â€”â€”â€”â€”â€” é«˜åœ°å€Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±| 12 | 34 | AB | CD |Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±å°ç«¯æ¨¡å¼ï¼šä¸€ä¸ªå¤šå­—èŠ‚æ•°æ®çš„ä½å­—èŠ‚åœ¨å‰ï¼Œé«˜å­—èŠ‚åœ¨åï¼Œä»ä»¥ 0x1234ABCD çœ‹ï¼šä½åœ°å€ â€”â€”â€”â€”â€”â€”â€” é«˜åœ°å€Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±| CD | AB | 34 | 12 |Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â±Â± è¿™é‡Œæœ‰ä¸€ä¸ªé‡å¤§çš„å­˜åœ¨å¯èƒ½è¯¯å¯¼çš„åœ°æ–¹ï¼Œå°±æ˜¯ä¸Šé¢åªåšäº†å­—èŠ‚åºçš„è°ƒæ•´ï¼Œæ²¡æœ‰åšä½åºï¼ˆæ¯”ç‰¹åºï¼‰çš„è°ƒæ•´ã€‚ä¸¥æ ¼çš„è¯´è¿™åªæ˜¯å°ç«¯ CPU é‡Œç½‘ç»œåºä¸ä¸»æœºåºçš„è½¬æ¢ï¼Œè€Œä¸æ˜¯å¤§å°ç«¯çš„è½¬æ¢ã€‚ å¦‚æœçœŸè¦åšå¤§å°ç«¯çš„è½¬æ¢å‘¢ï¼Ÿéƒ½çŸ¥é“ä¸Šé¢çš„ä¾‹å­ä¸­å°ç«¯æ¨¡å¼åå…­è¿›åˆ¶çš„ CD å­˜åœ¨ä½åœ°å€ã€‚é‚£å°ç«¯æ¨¡å¼åå…­è¿›åˆ¶çš„ CD çš„äºŒè¿›åˆ¶åˆ°åº•æ˜¯æ€ä¹ˆå­˜çš„å‘¢ï¼Ÿ çœ‹äº†ä¸Šé¢çš„å›¾ä¾‹å¯ä»¥æ¨æµ‹å‡ºâ€CDâ€çš„äºŒè¿›åˆ¶å½¢å¼åœ¨å°ç«¯æ¨¡å¼ä¸‹ï¼Œä»ç„¶æ˜¯åä¹¦å†™é¡ºåºçš„ï¼ˆå³ä»å³å¾€å·¦çœ‹æ‰èƒ½å¾—åˆ° CDï¼‰è¿™é‡Œç»™å‡ºä¸€ä¸ªæ›´ç›´è§‚çš„å¤§å°ç«¯å¯¹æ¯”å›¾ï¼š ä»¥ä¸Šå›¾å†å¯¼å‡º MSB ä¸ LSBï¼š MSB ä¸ LSB æ˜¯æ•°å­—çš„é«˜ä½ä½çš„æ¦‚å¿µï¼Œæ˜¯æ•°å­—å°±æœ‰æœ€é«˜ä½å’Œæœ€ä½ä½ã€‚ MSB first ä¸ LSB first æ˜¯ä¼ è¾“æˆ–æ‹·è´æ—¶çš„æ¦‚å¿µï¼Œå¸¸è§äºä¸åŒåè®®ä¹‹é—´çš„è½¬æ¢ï¼ˆæ¯”å¦‚ 32 ä½ä¼ è¾“è½¬æ¢åˆ°åˆ° 8 ä½ä¼ è¾“ï¼‰ï¼Œä»¥ä¸Šå›¾ä¸¾ä¾‹ï¼šå¦‚æœæ˜¯ LSB first ï¼Œè¿™æ˜¯åœ¨å‘Šè¯‰ä¼ è¾“æˆ–æ‹·è´æ—¶ï¼Œæ•°æ®çš„ä½ä½æ”¾åœ¨å‰é¢ï¼Œå³ä» 2 çš„ 0 æ¬¡æ–¹å¼€å§‹ä¼ è¾“æˆ–æ‹·è´ã€‚ ä¸ºä»€ä¹ˆ htonl()ã€ntohl()åªåšäº†å­—èŠ‚è½¬æ¢ï¼Ÿå› ä¸ºåœ¨ä»¥å¤ªç½‘ä¸­ï¼Œå­—èŠ‚åºæ˜¯æŒ‰ç…§å¤§ç«¯åºæ¥å‘é€ï¼Œä½†æ˜¯ä½åºï¼ˆæ¯”ç‰¹åºï¼‰å´æ˜¯æŒ‰ç…§å°ç«¯åºçš„æ–¹å¼æ¥å‘é€ï¼ˆLSB firstï¼‰ç»“åˆä¸Šå›¾ï¼Œç½‘ç»œå‘é€é¡ºåºä¸ºï¼š 224 225 226 227 228 229 230 231 216 217 218 219 220 221 222 223 208 209 210 211 212 213 214 215 200 201 202 203 204 205 206 207 è¿™é‡Œè§£é‡Šäº†ä¸ºä»€ä¹ˆå°ç«¯ CPU çš„ç½‘ç»œåºä¸ä¸»æœºåºçš„è½¬æ¢æ˜¯ 0x12345678,å˜æˆ 0x78563412.ï¼ˆå³æ¯”ç‰¹åºåœ¨ä¸€ä¸ªå­—èŠ‚å†…æ˜¯æ²¡æœ‰å˜åŒ–çš„ï¼‰ ä¸ºä»€ä¹ˆåªåšå­—èŠ‚åºçš„è½¬æ¢å°±å¯ä»¥äº†ï¼Œå¤§å°ç«¯ä¹‹é—´ä¼ é€ä¸ç”¨åšä½åºï¼ˆæ¯”ç‰¹åºï¼‰çš„è½¬æ¢å—ï¼Ÿæ˜¯çš„ï¼Œå¤§å°ç«¯ä¹‹é—´ä¼ é€ä¸ç”¨åšä½åºï¼ˆæ¯”ç‰¹åºï¼‰çš„è½¬æ¢ã€‚é‡å¤ä¸Šé¢çš„è¯ï¼ŒLSB firstï¼Œ MSB first æ˜¯åè®®çº¦å®šï¼Œçº¦å®šå¥½äº†ï¼Œä¹‹åè‡ªç„¶å†æŒ‰çº¦å®šè¿˜åŸå³å¯ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œå¿«é€’ä¸€å¥—å®¶å…·ï¼Œå…ˆè¦æ‹†åˆ†ï¼Œå†æ‰“åŒ…ï¼Œå†å‘é€ï¼Œåˆ°äº†ä¹‹åå†ç»„è£…è¿˜åŸã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åè®®åšçš„äº‹æƒ…ã€‚å¯¹ç”¨æˆ·ï¼ˆè¯»å†™ç¨‹åºï¼‰æ¥è¯´ï¼Œçœ‹åˆ°çš„ä¸€ç›´æ˜¯ä¸€å¥—å®Œæ•´çš„å®¶å…·ï¼ˆæ•°æ®ï¼‰ã€‚ é‚£ä¸ºä»€ä¹ˆè¯´å¤§ç«¯ä¸ç”¨åšè½¬æ¢å‘¢ï¼Ÿå¤§ç«¯ CPU ä¸ç”¨åšå­—èŠ‚è½¬æ¢ï¼Œå‘é€æ—¶çš„ä½åºï¼ˆæ¯”ç‰¹åºï¼‰çš„è½¬æ¢æ˜¯åè®®çš„äº‹æƒ…ï¼Œå½“ç„¶å‘é€çš„ä½åºä¸å†…å­˜é‡Œçš„ä½åºæ˜¯ä¸ä¸€æ ·çš„ã€‚æ€ä¹ˆå‘é€ï¼Œæ˜¯åè®®çš„äº‹æƒ…ã€‚ å°ç«¯æœºå†…å­˜ä¸­ï¼ˆä½åœ°å€åˆ°é«˜åœ°å€ï¼‰ å­—èŠ‚è½¬æ¢å ä»¥å¤ªç½‘ä¸­ å¤§ç«¯æœºå†…å­˜ä¸­ï¼ˆä½åœ°å€åˆ°é«˜åœ°å€ï¼‰ 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 208 209 210 211 212 213 214 215 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 200 201 202 203 204 205 206 207 215 214 213 212 211 210 209 208 207 206 205 204 203 202 201 200 è„š-ä¸‹åŠèº«-ä¸ŠåŠèº«-å¤´ ä¸ŠåŠèº«-å¤´ï¼Œè„š-ä¸‹åŠèº« ä¸ŠåŠèº«-å¤´ï¼Œè„š-ä¸‹åŠèº« å¤´-ä¸ŠåŠèº«-ä¸‹åŠèº«-è„š å°ç«¯ CPU è¦åšå­—èŠ‚è½¬æ¢ï¼Œç„¶åè®©ä»¥å¤ªç½‘åè®®å»ä¼ è¾“ï¼Œä¼ è¾“å®Œæˆï¼Œæœ€ç»ˆçš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼ˆå¤§å°ç«¯åªæ˜¯æ–¹å‘åäº†è€Œå·²ï¼‰ã€‚ å¯è§ä»å¤§ç«¯æœºåˆ°ç½‘ç»œä¹Ÿæ˜¯æœ‰â€è½¬æ¢â€çš„ã€‚åªæ˜¯ç¼–å†™ä¸Šå±‚çš„ç¨‹åºæ—¶ä¸ç”¨è€ƒè™‘ã€‚é©±åŠ¨æˆ–ç¡¬ä»¶è¦è€ƒè™‘ã€‚ ä¸ºä»€ä¹ˆå°ç«¯æœºä¸åšæˆé©±åŠ¨ç¡¬ä»¶è‡ªåŠ¨å­—èŠ‚è½¬æ¢ï¼Ÿå­—èŠ‚è½¬æ¢æœ‰é•¿åº¦é—®é¢˜ï¼Œæ¯”å¦‚ä¸¤ä¸ªå­—èŠ‚ä¸€è½¬ï¼Ÿè¿˜æ˜¯å››ä¸ªå­—èŠ‚ä¸€è½¬ï¼Ÿè¿˜æ˜¯å…«ä¸ªå­—èŠ‚ä¸€è½¬ï¼Ÿè€Œä½è½¬æ¢åªæœ‰ä¸€ç§ï¼Œå°±æ˜¯ 8 ä¸ªä½ä¸€è½¬ã€‚æ‰€ä»¥å°ç«¯ CPU è¦è°ƒç”¨å­—èŠ‚ è½¬æ¢å‡½æ•°ã€‚ å¸¦ä½åŸŸçš„ ç»“æ„ä½“ åº”è¯¥å¦‚ä½•ç¼–å†™æ‰èƒ½åœ¨ç½‘ç»œä¸Šæ­£ç¡®ä¼ è¾“ï¼Ÿå…ˆçœ‹å‡ ä¸ªä¾‹å­ï¼š //linux-3.4/include/linux/netfilter/nf_conntrack_proto_gre.hstruct gre_hdr #if defined(__LITTLE_ENDIAN_BITFIELD) __u16 rec:3, srr:1, seq:1, key:1, routing:1, csum:1, version:3, reserved:4, ack:1;#elif defined(__BIG_ENDIAN_BITFIELD) __u16 csum:1, routing:1, key:1, seq:1, srr:1, rec:3, ack:1, reserved:4, version:3;#else#error Adjust your asm/byteorder.h defines#endif __be16 protocol;;//linux-3.4/include/linux/icmpv6.hstruct icmpv6_nd_advt #if defined(__LITTLE_ENDIAN_BITFIELD) __u32 reserved:5, override:1, solicited:1, router:1, reserved2:24;#elif defined(__BIG_ENDIAN_BITFIELD) __u32 router:1, solicited:1, override:1, reserved:29;#else#error Please fix asm/byteorder.h#endif u_nd_advt;struct icmpv6_nd_ra __u8 hop_limit;#if defined(__LITTLE_ENDIAN_BITFIELD) __u8 reserved:3, router_pref:2, home_agent:1, other:1, managed:1;#elif defined(__BIG_ENDIAN_BITFIELD) __u8 managed:1, other:1, home_agent:1, router_pref:2, reserved:3;#else#error Please fix asm/byteorder.h#endif __be16 rt_lifetime; u_nd_ra; ç”±ä¸Šé¢ä¸‰ä¸ªå†…æ ¸æºä»£ç é‡Œçš„ç»“æ„ä½“å¯ä»¥çœ‹å‡ºè§„å¾‹ï¼š1. ä»¥ä¸€ä¸ªå­—èŠ‚ä¸ºå•ä½ï¼Œå­—èŠ‚å†…çš„ä½åŸŸä½ç½®åè½¬ã€‚2. å¤§ç«¯ç»“æ„ä½“é‡Œä½åŸŸå­—æ®µé¡ºåºä¸ç½‘ç»œåºç›¸åŒï¼Œå°ç«¯ç›¸åã€‚ ä½åŸŸè·¨è¶Šå­—èŠ‚åº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿæœ‰æ²¡æœ‰è·¨å­—èŠ‚çš„ä¾‹å­ï¼Ÿæœ‰ 802.1Q åè®®é‡Œçš„ vlan å­—æ®µå°±è·¨äº†å­—èŠ‚ã€‚ Type PRI CFI Vlan ID 16bits 3bits 1bits 12bits //linux-3.4/include/linux/if_vlan.h/** * struct vlan_ethhdr - vlan ethernet header (ethhdr + vlan_hdr) * @h_dest: destination ethernet address * @h_source: source ethernet address * @h_vlan_proto: ethernet protocol (always 0x8100) * @h_vlan_TCI: priority and VLAN ID * @h_vlan_encapsulated_proto: packet type ID or len */struct vlan_ethhdr unsigned char h_dest[ETH_ALEN]; unsigned char h_source[ETH_ALEN]; __be16 h_vlan_proto; __be16 h_vlan_TCI; __be16 h_vlan_encapsulated_proto;; ä½¿ç”¨ä½ç§»æˆ–ä½è¿ç®—å¤„ç†ï¼Œå  2 ä¸ªå­—èŠ‚çš„ h_vlan_TCI åœ¨ç½‘ç»œåºè½¬ä¸»æœºåºåï¼Œå»æ‰é«˜ä½çš„ 4 ä½å°±æ˜¯ vlan ID. å‚è€ƒèµ„æ–™ï¼šhttps://www.linuxjournal.com/article/6788","tags":["clippings"],"categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","ä½è¿ç®—"]},{"title":"æ ¡éªŒ","path":"/2024/06/11/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-ä½è¿ç®—-æ ¡éªŒ/","content":"çºµå‘å†—ä½™æ ¡éªŒ (LRC)çºµå‘å†—ä½™æ ¡éªŒï¼ˆLRCï¼‰æ˜¯ç”¨äºæ•°æ®å®Œæ•´æ€§æ£€æŸ¥çš„é‡è¦æœºåˆ¶ï¼Œå…¶æ ¡éªŒåŒºå ç”¨ 1 ä¸ªå­—èŠ‚ï¼ŒåŒ…å« 8 ä½äºŒè¿›åˆ¶æ•°æ®ã€‚å…·ä½“çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š LRC å€¼è®¡ç®—ï¼šå‘é€è®¾å¤‡è´Ÿè´£è®¡ç®— LRC å€¼ã€‚è¿™ä¸ªå€¼æ˜¯é€šè¿‡å°†ä¿¡æ¯ä¸­çš„æ¯ä¸¤ä¸ªç›¸é‚» 8 ä½å­—èŠ‚ç›¸åŠ è€Œå¾—å‡ºçš„ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåŠ æ³•è¿ç®—äº§ç”Ÿè¿›ä½ï¼Œè¿™äº›è¿›ä½ä¼šè¢«ä¸¢å¼ƒã€‚è®¡ç®—å®Œæˆåï¼ŒLRC å€¼å°†è¢«é™„åŠ åˆ°ä¿¡æ¯ä¸­ã€‚ æ¥æ”¶ç«¯çš„æ ¡éªŒï¼šæ¥æ”¶è®¾å¤‡åœ¨æ¥æ”¶åˆ°ä¿¡æ¯åï¼Œä¼šé‡æ–°è®¡ç®— LRC å€¼ã€‚è¿™æ˜¯é€šè¿‡ç›¸åŒçš„æ–¹å¼å®Œæˆçš„ï¼Œå³å°†æ¥æ”¶åˆ°çš„ä¿¡æ¯ä¸­çš„æ¯ä¸¤ä¸ª 8 ä½å­—èŠ‚ç›¸åŠ ï¼Œå¹¶ä¸¢å¼ƒè¿›ä½ã€‚æ¥æ”¶ç«¯æ¯”è¾ƒè‡ªå·±è®¡ç®—å‡ºçš„ LRC å€¼ä¸ä¿¡æ¯ä¸­åŒ…å«çš„ LRC å€¼ã€‚å¦‚æœä¸¤è€…ä¸ç›¸ç¬¦ï¼Œè¡¨ç¤ºåœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­å‡ºç°äº†é”™è¯¯ã€‚ LRC å€¼çš„å…·ä½“è®¡ç®—æ­¥éª¤ï¼š ç›¸åŠ ï¼šæŠŠä¿¡æ¯ä¸­çš„æ‰€æœ‰å­—èŠ‚ï¼ˆåŒ…æ‹¬èµ·å§‹ç¬¦å·â€œï¼šâ€å’Œç»“æŸç¬¦ CRLFï¼‰ç›¸åŠ ï¼Œå¹¶å°†ç»“æœé€å…¥ 8 ä½çš„ LRC æ•°æ®åŒºï¼Œä¸¢å¼ƒè¿›ä½ã€‚ ç”Ÿæˆè¡¥ç ï¼šä½¿ç”¨ FFHï¼ˆ255 çš„åå…­è¿›åˆ¶è¡¨ç¤ºï¼‰å‡å»æœ€ç»ˆçš„å’Œä»¥ç”Ÿæˆè¡¥ç ã€‚ åŠ ä¸€æ“ä½œï¼šå†åŠ â€œ1â€æ¥å¾—åˆ°æœ€ç»ˆçš„äºŒè¿›åˆ¶è¡¥ç ã€‚ ä¿¡æ¯å‘é€ï¼šåœ¨å‘é€ä¿¡æ¯æ—¶ï¼Œé¦–å…ˆå‘é€é«˜ä½å­—ç¬¦ï¼Œç„¶åå‘é€ä½ä½å­—ç¬¦ã€‚ä¾‹ï¼šå¦‚æœ LRC å€¼ä¸º 61Hï¼ˆ0110 0001ï¼‰ï¼Œåˆ™å…¶ä¼ è¾“é¡ºåºæ˜¯å…ˆä¼ è¾“â€˜6â€™ï¼ˆé«˜ä½ï¼‰ï¼Œå†ä¼ è¾“â€˜1â€™ï¼ˆä½ä½ï¼‰ã€‚ C è¯­è¨€ç¤ºä¾‹ä»£ç static unsigned char LRC(unsigned char *auchMsg, unsigned short usDataLen) unsigned char uchLRC = 0; /* åˆå§‹åŒ–LRCå­—ç¬¦ */ while (usDataLen--) /* éå†æ•°æ®ç¼“å†²å™¨ */ uchLRC += *auchMsg++; /* åŠ ç¼“å†²å™¨å­—èŠ‚ï¼Œä¸”æ— è¿›ä½ */ return ((unsigned char)(â€“((char)uchLRC))); /* è¿”å›äºŒè¿›åˆ¶è¡¥ç  */ å¾ªç¯å†—ä½™æ ¡éªŒ (CRC)å¾ªç¯å†—ä½™æ ¡éªŒï¼ˆCRCï¼‰æ˜¯ä¸€ç§å¼ºå¤§çš„é”™è¯¯æ£€æµ‹æ–¹æ³•ï¼Œå…¶æ ¡éªŒåŒºå ç”¨ 2 ä¸ªå­—èŠ‚ï¼Œå«æœ‰ä¸€ä¸ª 16 ä½çš„äºŒè¿›åˆ¶æ•°æ®ã€‚å…¶å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š å¯„å­˜å™¨åˆå§‹åŒ–ï¼šåœ¨å¼€å§‹è®¡ç®— CRC æ—¶ï¼Œé¦–å…ˆå°† 16 ä½çš„å¯„å­˜å™¨å…¨éƒ¨ç½®ä¸ºâ€œ1â€ã€‚ç„¶åæ¥æ”¶ç›¸é‚»çš„ä¸¤ä¸ª 8 ä½å­—èŠ‚çš„æ•°æ®ã€‚æ³¨æ„ï¼Œä»…æ•°æ®éƒ¨åˆ†ç”¨äºè®¡ç®— CRCï¼Œèµ·å§‹ä½ã€åœæ­¢ä½å’Œå¥‡å¶æ ¡éªŒä½è¢«æ’é™¤åœ¨å¤–ã€‚ è®¡ç®—è¿‡ç¨‹ï¼š æ¯ 8 ä½æ•°æ®ä¸å¯„å­˜å™¨ä¸­çš„å€¼è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œç»“æœå³ç§»ä¸€ä½ï¼Œå¹¶ç”¨â€œ0â€å¡«å……æœ€é«˜æœ‰æ•ˆä½(MSB)ã€‚ æ£€æŸ¥æœ€ä½æœ‰æ•ˆä½(LSB)ã€‚å¦‚æœ LSB ä¸ºâ€œ1â€ï¼Œåˆ™ä¸é¢„ç½®çš„å›ºå®šå€¼å¼‚æˆ–ï¼›å¦‚æœ LSB ä¸ºâ€œ0â€ï¼Œåˆ™ä¸è¿›è¡Œå¼‚æˆ–æ“ä½œã€‚ é‡å¤ä¸Šè¿°æ­¥éª¤ç›´åˆ°å³ç§» 8 æ¬¡ã€‚ å¤„ç†å®Œæ‰€æœ‰å­—èŠ‚åï¼Œå¯„å­˜å™¨ä¸­çš„å€¼å³ä¸º CRC å€¼ã€‚ å…·ä½“è®¡ç®—æ­¥éª¤ï¼š å°† 16 ä½ CRC å¯„å­˜å™¨åˆå§‹åŒ–ä¸º FFFFHã€‚ å¤„ç†æ¯ä¸ª 8 ä½æ•°æ®ï¼šç¬¬ä¸€ä¸ª 8 ä½æ•°æ®ä¸ CRC å¯„å­˜å™¨çš„ä½å­—èŠ‚è¿›è¡Œå¼‚æˆ–ï¼Œç»“æœæ”¾å…¥ CRC å¯„å­˜å™¨ã€‚ CRC å¯„å­˜å™¨å³ç§»ä¸€ä½ï¼ŒMSB å¡«é›¶ï¼Œæ£€æŸ¥ LSBã€‚ å¦‚æœ LSB ä¸º 0ï¼Œç»§ç»­å³ç§»ä¸€ä½ï¼›å¦‚æœ LSB ä¸º 1ï¼Œåˆ™ä¸é¢„è®¾å€¼å¼‚æˆ–ã€‚ è¿™ä¸€ç›´ç»­è¿›è¡Œï¼Œç›´åˆ°å…¨éƒ¨ 8 ä½æ•°æ®è¢«å¤„ç†å®Œæ¯•ã€‚ ä¿¡æ¯å‘é€ï¼šåœ¨å‘é€ä¿¡æ¯æ—¶ï¼Œå…ˆå‘é€ä½ 8 ä½ï¼Œç„¶åå‘é€é«˜ 8 ä½ã€‚ä¾‹ï¼šå‡è®¾ CRC å€¼ä¸º 1241ï¼ˆ0001 0010 0100 0001ï¼‰ï¼Œå‘é€é¡ºåºä¸ºå…ˆå‘é€ä½ä½ï¼ˆ0100 0001ï¼‰ï¼Œåå‘é€é«˜ä½ï¼ˆ0001 0010ï¼‰ã€‚ C è¯­è¨€ç¤ºä¾‹ä»£ç unsigned short CRC16(unsigned char *puchMsg, unsigned short usDataLen) unsigned char uchCRCHi = 0xFF; /* åˆå§‹åŒ–é«˜å­—èŠ‚ */ unsigned char uchCRCLo = 0xFF; /* åˆå§‹åŒ–ä½å­—èŠ‚ */ unsigned uIndex; /* CRCè¡¨ç´¢å¼• */ while (usDataLen--) /* é€šè¿‡æ•°æ®ç¼“å†²å™¨ */ uIndex = uchCRCHi ^ *puchMsg++; /* è®¡ç®—CRC */ uchCRCHi = uchCRCLo ^ auchCRCHi[uIndex]; uchCRCLo = auchCRCLo[uIndex]; return (uchCRCHi 8 | uchCRCLo); /* è¿”å›CRCå€¼ï¼Œä½å­—èŠ‚åœ¨å‰ */ é€šè¿‡ä¸Šè¿°è¿‡ç¨‹ï¼ŒLRC å’Œ CRC å‡ä¸ºç¡®ä¿æ•°æ®å®Œæ•´æ€§çš„é‡è¦æ‰‹æ®µã€‚æ¯ä¸€ç§æ–¹æ³•éƒ½æœ‰å…¶ç‹¬ç‰¹çš„è®¡ç®—æ­¥éª¤å’Œåº”ç”¨åœºæ™¯ï¼Œèƒ½å¤Ÿåœ¨æ•°æ®ä¼ è¾“ä¸­æœ‰æ•ˆæ£€æµ‹å’Œåˆ¤æ–­é”™è¯¯çš„å‘ç”Ÿã€‚ é«˜ä½å­—èŠ‚è¡¨/* Table of CRC values for highâ€“order byte */static unsigned char auchCRCHi[] = 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81,0x40, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0,0x80, 0x41, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40, 0x00, 0xC1, 0x81, 0x40, 0x01,0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41,0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40, 0x00, 0xC1, 0x81,0x40, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0,0x80, 0x41, 0x00, 0xC1, 0x81, 0x40, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01,0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40,0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81,0x40, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0,0x80, 0x41, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40, 0x00, 0xC1, 0x81, 0x40, 0x01,0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41,0x00, 0xC1, 0x81, 0x40, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81,0x40, 0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0,0x80, 0x41, 0x00, 0xC1, 0x81, 0x40, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01,0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81, 0x40, 0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41,0x00, 0xC1, 0x81, 0x40, 0x01, 0xC0, 0x80, 0x41, 0x01, 0xC0, 0x80, 0x41, 0x00, 0xC1, 0x81,0x40 ; ä½ä½å­—èŠ‚è¡¨/* Table of CRC values for lowâ€“order byte */static char auchCRCLo[] = 0x00, 0xC0, 0xC1, 0x01, 0xC3, 0x03, 0x02, 0xC2, 0xC6, 0x06, 0x07, 0xC7, 0x05, 0xC5, 0xC4,0x04, 0xCC, 0x0C, 0x0D, 0xCD, 0x0F, 0xCF, 0xCE, 0x0E, 0x0A, 0xCA, 0xCB, 0x0B, 0xC9, 0x09,0x08, 0xC8, 0xD8, 0x18, 0x19, 0xD9, 0x1B, 0xDB, 0xDA, 0x1A, 0x1E, 0xDE, 0xDF, 0x1F, 0xDD,0x1D, 0x1C, 0xDC, 0x14, 0xD4, 0xD5, 0x15, 0xD7, 0x17, 0x16, 0xD6, 0xD2, 0x12, 0x13, 0xD3,0x11, 0xD1, 0xD0, 0x10, 0xF0, 0x30, 0x31, 0xF1, 0x33, 0xF3, 0xF2, 0x32, 0x36, 0xF6, 0xF7,0x37, 0xF5, 0x35, 0x34, 0xF4, 0x3C, 0xFC, 0xFD, 0x3D, 0xFF, 0x3F, 0x3E, 0xFE, 0xFA, 0x3A,0x3B, 0xFB, 0x39, 0xF9, 0xF8, 0x38, 0x28, 0xE8, 0xE9, 0x29, 0xEB, 0x2B, 0x2A, 0xEA, 0xEE,0x2E, 0x2F, 0xEF, 0x2D, 0xED, 0xEC, 0x2C, 0xE4, 0x24, 0x25, 0xE5, 0x27, 0xE7, 0xE6, 0x26,0x22, 0xE2, 0xE3, 0x23, 0xE1, 0x21, 0x20, 0xE0, 0xA0, 0x60, 0x61, 0xA1, 0x63, 0xA3, 0xA2,0x62, 0x66, 0xA6, 0xA7, 0x67, 0xA5, 0x65, 0x64, 0xA4, 0x6C, 0xAC, 0xAD, 0x6D, 0xAF, 0x6F,0x6E, 0xAE, 0xAA, 0x6A, 0x6B, 0xAB, 0x69, 0xA9, 0xA8, 0x68, 0x78, 0xB8, 0xB9, 0x79, 0xBB,0x7B, 0x7A, 0xBA, 0xBE, 0x7E, 0x7F, 0xBF, 0x7D, 0xBD, 0xBC, 0x7C, 0xB4, 0x74, 0x75, 0xB5,0x77, 0xB7, 0xB6, 0x76, 0x72, 0xB2, 0xB3, 0x73, 0xB1, 0x71, 0x70, 0xB0, 0x50, 0x90, 0x91,0x51, 0x93, 0x53, 0x52, 0x92, 0x96, 0x56, 0x57, 0x97, 0x55, 0x95, 0x94, 0x54, 0x9C, 0x5C,0x5D, 0x9D, 0x5F, 0x9F, 0x9E, 0x5E, 0x5A, 0x9A, 0x9B, 0x5B, 0x99, 0x59, 0x58, 0x98, 0x88,0x48, 0x49, 0x89, 0x4B, 0x8B, 0x8A, 0x4A, 0x4E, 0x8E, 0x8F, 0x4F, 0x8D, 0x4D, 0x4C, 0x8C,0x44, 0x84, 0x85, 0x45, 0x87, 0x47, 0x46, 0x86, 0x82, 0x42, 0x43, 0x83, 0x41, 0x81, 0x80,0x40 ;","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","ä½è¿ç®—"]},{"title":"äº’æ–¥é”","path":"/2024/06/10/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-å¤šçº¿ç¨‹-äº’æ–¥é”/","content":"åœ¨ç¼–ç¨‹ä¸­ï¼Œå¯¹è±¡äº’æ–¥é”çš„å¼•å…¥æ˜¯ä¸ºäº†ç¡®ä¿å¯¹å…±äº«æ•°æ®çš„æ“ä½œå…·æœ‰å®Œæ•´æ€§ã€‚æ¯ä¸ªå¯¹è±¡éƒ½ä¼šæœ‰å…³è”çš„æ ‡è®°ï¼Œç§°ä¸ºâ€äº’æ–¥é”â€ï¼Œä»¥ä¿è¯åœ¨ä»»ä½•ç‰¹å®šæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®è¯¥å¯¹è±¡ã€‚è¿™ä¸€è®¾è®¡å°¤å…¶é‡è¦ï¼Œå› ä¸ºå¤šä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶å°è¯•ä¿®æ”¹åŒä¸€æ•°æ®ï¼Œè‹¥æ²¡æœ‰é€‚å½“çš„æ§åˆ¶ï¼Œæ•°æ®çš„å®Œæ•´æ€§å°†å—åˆ°å¨èƒã€‚é€šè¿‡äº’æ–¥é”ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢æ•°æ®ç«äº‰å’Œä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚ 1. åˆ›å»ºå’Œé”€æ¯äº’æ–¥é”åœ¨ POSIX çº¿ç¨‹ï¼ˆä¹Ÿç§° Pthreadsï¼‰ä¸­ï¼Œæä¾›äº†ä¸€å¥—ä¸“é—¨ç”¨äºçº¿ç¨‹åŒæ­¥çš„äº’æ–¥é”å‡½æ•°ã€‚è¿™äº›å‡½æ•°æ”¯æŒä¸¤ç§åˆ›å»ºäº’æ–¥é”çš„æ–¹æ³•ï¼šé™æ€å’ŒåŠ¨æ€ã€‚ é™æ€åˆ›å»ºä½¿ç”¨ PTHREAD_MUTEX_INITIALIZER å®å¯ä»¥é™æ€åˆå§‹åŒ–äº’æ–¥é”ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER; åœ¨ LinuxThreads çš„å®ç°ä¸­ï¼Œpthread_mutex_t æ˜¯ä¸€ä¸ªç»“æ„ï¼Œè€Œ PTHREAD_MUTEX_INITIALIZER åˆ™è¢«å®šä¹‰ä¸ºä¸€ä¸ªç»“æ„å¸¸é‡ã€‚è¿™ç§æ–¹å¼ç®€å•æ˜äº†ï¼Œä¾¿äºåœ¨ç¨‹åºä¸­å¿«é€Ÿåˆ›å»ºäº’æ–¥é”ã€‚ åŠ¨æ€åˆ›å»ºå¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ pthread_mutex_init() å‡½æ•°è¿›è¡ŒåŠ¨æ€åˆå§‹åŒ–ã€‚å®ƒçš„ API å®šä¹‰å¦‚ä¸‹ï¼š int pthread_mutex_init(pthread_mutex_t *mutex, const pthread_mutexattr_t *mutexattr); å…¶ä¸­ï¼Œmutexattr å‚æ•°ç”¨äºæŒ‡å®šäº’æ–¥é”çš„å±æ€§ã€‚å¦‚æœè¯¥å‚æ•°ä¸º NULLï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤å±æ€§ã€‚è¿™ä¸ºç¨‹åºè®¾è®¡è€…æä¾›äº†çµæ´»æ€§ï¼Œå…è®¸æ ¹æ®éœ€è¦è‡ªè¡Œé…ç½®äº’æ–¥é”çš„è¡Œä¸ºã€‚ åœ¨ä½¿ç”¨åï¼Œéœ€è¦é”€æ¯äº’æ–¥é”ï¼Œä½¿ç”¨ pthread_mutex_destroy()ï¼Œå…¶ API å®šä¹‰å¦‚ä¸‹ï¼š int pthread_mutex_destroy(pthread_mutex_t *mutex); é”€æ¯äº’æ–¥é”çš„è¿‡ç¨‹é‡Šæ”¾äº†å…¶å ç”¨çš„èµ„æºï¼Œç„¶è€Œï¼Œåœ¨ Linux ä¸­ï¼Œäº’æ–¥é”æœ¬èº«å¹¶ä¸å ç”¨ä»»ä½•å®é™…èµ„æºï¼Œå› æ­¤ pthread_mutex_destroy() ä¸»è¦ç”¨äºæ£€æŸ¥é”çš„çŠ¶æ€ï¼Œå¦‚æœé”å¤„äºå·²é”å®šçŠ¶æ€ï¼Œå‡½æ•°è¿”å› EBUSY é”™è¯¯ã€‚ 2. äº’æ–¥é”å±æ€§äº’æ–¥é”çš„å±æ€§è®¾å®šåœ¨åˆ›å»ºé”æ—¶è¿›è¡Œã€‚åœ¨ LinuxThreads çš„å®ç°ä¸­ï¼Œä¸»è¦æœ‰ä¸€ç§é”ç±»å‹å±æ€§ã€‚ä¸åŒçš„é”ç±»å‹ï¼Œåœ¨å·²ç»è¢«é”å®šçš„äº’æ–¥é”ä¸ŠåŠ é”æ—¶ä¼šä½“ç°å‡ºä¸åŒçš„è¡Œä¸ºã€‚ å½“å‰ï¼ˆä»¥ glibc 2.2.3 å’Œ linuxthreads 0.9 ä¸ºä¾‹ï¼‰ï¼Œå¯ä¾›é€‰æ‹©çš„é”ç±»å‹æœ‰ï¼š PTHREAD_MUTEX_TIMED_NPï¼šè¿™æ˜¯é»˜è®¤çš„é”ç±»å‹ï¼Œè¡¨ç°ä¸ºæ™®é€šé”ã€‚å½“ä¸€ä¸ªçº¿ç¨‹æˆåŠŸåŠ é”åï¼Œå…¶ä»–è¯·æ±‚è¯¥é”çš„çº¿ç¨‹ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œè§£é”åçº¿ç¨‹å°†æŒ‰ä¼˜å…ˆçº§è·å–é”ã€‚è¿™ç§é”ç­–ç•¥èƒ½å¤Ÿä¿è¯èµ„æºåˆ†é…çš„å…¬å¹³æ€§ï¼Œæœ‰åŠ©äºé¿å…é¥¥é¥¿ç°è±¡ã€‚ PTHREAD_MUTEX_RECURSIVE_NPï¼šè¯¥ç±»å‹å…è®¸åŒä¸€çº¿ç¨‹å¯¹åŒä¸€é”å¤šæ¬¡åŠ é”ï¼Œéœ€è¦é€šè¿‡å¤šæ¬¡è§£é”æ¥é‡Šæ”¾ã€‚å¦‚æœå…¶ä»–çº¿ç¨‹è¯·æ±‚é”æ—¶ï¼Œè¯¥é”ä»è¢«åŠ é”ï¼Œåˆ™å®ƒä»¬å¿…é¡»ç«äº‰é”ã€‚ PTHREAD_MUTEX_ERRORCHECK_NPï¼šè¿™ç§ç±»å‹ç”¨äºé”™è¯¯æ£€æŸ¥ã€‚å¦‚æœåŒä¸€çº¿ç¨‹å°è¯•è¯·æ±‚åŒä¸€é”ï¼Œå°†è¿”å› EDEADLK é”™è¯¯ï¼Œç¡®ä¿åœ¨ä¸å…è®¸å¤šæ¬¡åŠ é”çš„åœºæ™¯ä¸­ä¸ä¼šå‡ºç°æœ€åŸºæœ¬çš„æ­»é”ã€‚ PTHREAD_MUTEX_ADAPTIVE_NPï¼šè¿™ç§é”ç±»å‹è¡Œä¸ºç®€å•ï¼Œå…è®¸çº¿ç¨‹åœ¨è§£é”åé‡æ–°ç«äº‰ã€‚ 3. é”æ“ä½œé”çš„åŸºæœ¬æ“ä½œåŒ…æ‹¬åŠ é”ã€è§£é”å’Œå°è¯•åŠ é”ï¼Œå…·ä½“å‡½æ•°å¦‚ä¸‹ï¼š int pthread_mutex_lock(pthread_mutex_t *mutex);int pthread_mutex_unlock(pthread_mutex_t *mutex);int pthread_mutex_trylock(pthread_mutex_t *mutex); å¯¹äºå„ç±»é”ï¼Œä¸èƒ½è¢«ä¸¤ä¸ªä¸åŒçº¿ç¨‹åŒæ—¶è·å¾—ã€‚å¯¹äºæ™®é€šé”å’Œé€‚åº”é”ï¼Œè§£é”å¯ä»¥ç”±åŒè¿›ç¨‹å†…çš„ä»»ä½•çº¿ç¨‹æ‰§è¡Œã€‚ç›¸å¯¹è€Œè¨€ï¼Œæ£€é”™é”åˆ™å¿…é¡»ç”±åŠ é”çš„çº¿ç¨‹è¿›è¡Œè§£é”ï¼Œå¦‚æœç”±ä¸åŒçš„çº¿ç¨‹å°è¯•è§£é”ï¼Œåˆ™è¿”å› EPERM é”™è¯¯ã€‚åµŒå¥—é”çš„è§£é”è§„å®šè™½ç„¶æ˜¯ç”±åŠ é”è€…æ‰§è¡Œï¼Œä½†è§‚å¯Ÿåˆ°å®éªŒè¿‡ç¨‹ä¸­å¹¶æœªå¼ºåˆ¶æ‰§è¡Œè¿™ä¸€é™åˆ¶ã€‚åœ¨åŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹è‹¥åŠ é”è€Œæ²¡æœ‰è§£é”ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è·å–è¯¥é”ã€‚ pthread_mutex_trylock() ä¸ pthread_mutex_lock() çš„è¡Œä¸ºç›¸ä¼¼ï¼Œä½†å½“é”å·²è¢«å ç”¨æ—¶ï¼Œå°†è¿”å› EBUSYï¼Œè€Œä¸æ˜¯æŒ‚èµ·ç­‰å¾…ã€‚è¿™æä¾›äº†ä¸€ç§éé˜»å¡çš„æ–¹å¼æ¥å°è¯•è·å–é”ã€‚ 4. å…¶ä»–æ³¨æ„äº‹é¡¹POSIX çº¿ç¨‹é”æœºåˆ¶åœ¨ Linux çš„å®ç°ä¸­å¹¶ä¸æ˜¯å–æ¶ˆç‚¹ï¼Œæ„å‘³ç€å»¶è¿Ÿå–æ¶ˆç±»å‹çš„çº¿ç¨‹ä¸ä¼šå› å–æ¶ˆä¿¡å·è€Œé€€å‡ºåŠ é”çŠ¶æ€ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœçº¿ç¨‹åœ¨åŠ é”åä½†æœªè§£é”å‰è¢«å–æ¶ˆï¼Œè¯¥é”å°†ä¿æŒé”å®šçŠ¶æ€ã€‚å› æ­¤ï¼Œå¦‚æœåœ¨å…³é”®åŒºæ®µå†…æœ‰å–æ¶ˆç‚¹ï¼Œæ­¤æ—¶å¯å¯¼è‡´æ½œåœ¨æ­»é”åœºæ™¯ï¼Œå› æ­¤å»ºè®®åœ¨é€€å‡ºå›è°ƒå‡½æ•°ä¸­æ‰§è¡Œè§£é”æ“ä½œã€‚ åŒæ—¶ï¼Œäº’æ–¥é”çš„ä½¿ç”¨å¹¶ä¸å…·å¤‡å¼‚æ­¥ä¿¡å·å®‰å…¨ï¼Œæ•…ä¸åº”åœ¨ä¿¡å·å¤„ç†è¿‡ç¨‹ä¸­è®¿é—®äº’æ–¥é”ï¼Œä»¥å…å¼•å‘æ­»é”é—®é¢˜ã€‚äº’æ–¥é”é€šè¿‡ç¡®ä¿åŒä¸€æ—¶é—´å†…ä»…æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸´ç•Œæ®µä»£ç ï¼Œä»è€Œæœ‰åºæ‰§è¡Œå¤šä¸ªçº¿ç¨‹çš„æ“ä½œï¼Œæœ‰æ•ˆä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ã€‚ æœ‰å…³æ›´æ”¹é»˜è®¤äº’æ–¥é”å±æ€§ï¼Œå¯é€šè¿‡å£°æ˜å’Œåˆå§‹åŒ–å±æ€§å¯¹è±¡æ¥å®ç°ã€‚é€šå¸¸ï¼Œè¿™åœ¨ç¨‹åºçš„å¼€å¤´è¿›è¡Œï¼Œä»¥ä¾¿å¿«é€ŸæŸ¥æ‰¾å’Œä¿®æ”¹ã€‚ä»¥ä¸‹æ˜¯ç®¡ç†äº’æ–¥é”å±æ€§çš„ç›¸å…³å‡½æ•°ï¼š è¡¨ 4â€“1 äº’æ–¥é”å±æ€§ç›¸å…³å‡½æ•° æ“ä½œ å‡½æ•° åˆå§‹åŒ–äº’æ–¥é”å±æ€§å¯¹è±¡ pthread_mutexattr_init é”€æ¯äº’æ–¥é”å±æ€§å¯¹è±¡ pthread_mutexattr_destroy è®¾ç½®äº’æ–¥é”èŒƒå›´ pthread_mutexattr_setpshared è·å–äº’æ–¥é”èŒƒå›´ pthread_mutexattr_getpshared è®¾ç½®äº’æ–¥é”çš„ç±»å‹å±æ€§ pthread_mutexattr_settype è·å–äº’æ–¥é”çš„ç±»å‹å±æ€§ pthread_mutexattr_gettype è®¾ç½®äº’æ–¥é”å±æ€§çš„åè®® pthread_mutexattr_setprotocol è·å–äº’æ–¥é”å±æ€§çš„åè®® pthread_mutexattr_getprotocol è®¾ç½®äº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™ pthread_mutexattr_setprioceiling è·å–äº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™ pthread_mutexattr_getprioceiling è®¾ç½®äº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™ pthread_mutex_setprioceiling è·å–äº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™ pthread_mutex_getprioceiling è®¾ç½®äº’æ–¥é”çš„å¼ºå¥å±æ€§ pthread_mutexattr_setrobust_np è·å–äº’æ–¥é”çš„å¼ºå¥å±æ€§ pthread_mutexattr_getrobust_np è¡¨ 4â€“2 äº’æ–¥é”èŒƒå›´æ¯”è¾ƒ Solaris POSIX å®šä¹‰ USYNC_PROCESS PTHREAD_PROCESS_SHARED ç”¨äºåŒæ­¥è¯¥è¿›ç¨‹ä¸å…¶ä»–è¿›ç¨‹ä¸­çš„çº¿ç¨‹ USYNC_PROCESS_ROBUST æ—  ç”¨äºåœ¨è¿›ç¨‹é—´å¯é åœ°åŒæ­¥çº¿ç¨‹ USYNC_THREAD PTHREAD_PROCESS_PRIVATE ç”¨äºä»…åŒæ­¥è¯¥è¿›ç¨‹ä¸­çš„çº¿ç¨‹ åˆå§‹åŒ–äº’æ–¥é”å±æ€§å¯¹è±¡ä½¿ç”¨ pthread_mutexattr_init(3C) å‡½æ•°å¯ä»¥å°†äº’æ–¥é”å¯¹è±¡çš„å±æ€§åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ã€‚è¿™ä¸€æ­¥éª¤è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒç¡®ä¿çº¿ç¨‹ç³»ç»Ÿä¸ºæ¯ä¸ªå±æ€§å¯¹è±¡åˆ†é…å¿…è¦çš„å­˜å‚¨ç©ºé—´ï¼Œä»è€Œä½¿å¾—äº’æ–¥é”çš„ä½¿ç”¨æ›´ä¸ºé«˜æ•ˆå’Œå®‰å…¨ã€‚ pthread_mutexattr_init è¯­æ³•#include pthread.hpthread_mutexattr_t mattr;int ret;ret = pthread_mutexattr_init(mattr); åœ¨è°ƒç”¨ pthread_mutexattr_init() å‡½æ•°æ—¶ï¼Œå¯ä»¥æ³¨æ„åˆ°ï¼Œpshared å±æ€§çš„é»˜è®¤å€¼æ˜¯ PTHREAD_PROCESS_PRIVATEã€‚è¿™ä¸€å±æ€§æ„å‘³ç€åˆ›å»ºçš„äº’æ–¥é”æ˜¯åªåœ¨åŒä¸€è¿›ç¨‹å†…æœ‰æ•ˆçš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºçš„å¤šä¸ªçº¿ç¨‹éœ€è¦åè°ƒèµ„æºï¼Œå®ƒä»¬å¯ä»¥é€šè¿‡è¿™ç§ç±»å‹çš„äº’æ–¥é”è¿›è¡Œç›¸äº’æ’æ–¥ï¼Œç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®å…±äº«èµ„æºã€‚ mattr æ˜¯ä¸€ä¸ªç±»å‹ä¸º opaque çš„ç»“æ„ï¼Œå†…éƒ¨åŒ…å«ç”±ç³»ç»Ÿåˆ†é…çš„å±æ€§å¯¹è±¡ã€‚æ­¤å±æ€§å¯¹è±¡çš„å¯èƒ½å€¼æœ‰ï¼š PTHREAD_PROCESS_PRIVATEï¼šäº’æ–¥é”é€‚ç”¨äºåŒä¸€è¿›ç¨‹å†…ã€‚ PTHREAD_PROCESS_SHAREDï¼šäº’æ–¥é”å¯ä»¥è¢«å¤šä¸ªè¿›ç¨‹å…±äº«ï¼Œé€‚ç”¨äºéœ€è¦è·¨è¿›ç¨‹é€šä¿¡çš„å¤æ‚åœºæ™¯ã€‚ è¯·æ³¨æ„ï¼ŒPTHREAD_PROCESS_PRIVATE æ˜¯é»˜è®¤å€¼ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ç®€å•çš„å¤šçº¿ç¨‹åº”ç”¨ã€‚ é”€æ¯äº’æ–¥é”å±æ€§å¯¹è±¡å¯¹äºäº’æ–¥é”å±æ€§å¯¹è±¡ï¼Œå¿…é¡»é¦–å…ˆé€šè¿‡è°ƒç”¨ pthread_mutexattr_destroy(3C) å‡½æ•°å°†å…¶é”€æ¯ï¼Œæ‰èƒ½é‡æ–°åˆå§‹åŒ–è¯¥å¯¹è±¡ã€‚è¿™æ„å‘³ç€åœ¨å®Œæˆä½¿ç”¨åï¼ŒåŠ¡å¿…è¦è®°å¾—æ¸…ç†èµ„æºï¼Œä»¥é¿å…æ½œåœ¨çš„å†…å­˜æ³„æ¼ã€‚è°ƒç”¨ pthread_mutexattr_init() æ—¶ï¼Œä¼šä¸ºè¯¥å¯¹è±¡åˆ†é…ä¸€ä¸ª opaque ç±»å‹çš„å†…å­˜ã€‚è‹¥æœªåŠæ—¶é”€æ¯æ—§å¯¹è±¡ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜èµ„æºçš„æµªè´¹ï¼Œä»è€Œå¯èƒ½å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚ pthread_mutexattr_init è¿”å›å€¼è°ƒç”¨ pthread_mutexattr_init() å‡½æ•°æˆåŠŸåï¼Œè¿”å›å€¼ä¸ºé›¶ã€‚è‹¥å‡½æ•°æœªèƒ½æˆåŠŸæ‰§è¡Œï¼Œåˆ™è¿”å›ä¸€ä¸ªéé›¶å€¼ï¼Œè¡¨ç¤ºå‘ç”Ÿäº†é”™è¯¯ã€‚ä»¥ä¸‹æ˜¯å¯èƒ½å¯¼è‡´å‡½æ•°è°ƒç”¨å¤±è´¥çš„ä¸€äº›æƒ…å†µï¼š ENOMEMï¼š æè¿°ï¼šè¡¨ç¤ºå†…å­˜ä¸è¶³ï¼Œæ— æ³•åˆå§‹åŒ–äº’æ–¥é”å±æ€§å¯¹è±¡ã€‚å¦‚æœç³»ç»Ÿæœªèƒ½åˆ†é…è¶³å¤Ÿçš„å†…å­˜ç©ºé—´æ¥åˆ›å»ºæ–°çš„å±æ€§å¯¹è±¡ï¼Œè°ƒç”¨å°†å¤±è´¥ï¼Œè¿™æ—¶éœ€è¦æ£€æŸ¥ç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ ç¡®ä¿å¤„ç†è¿”å›å€¼å’Œé”™è¯¯æƒ…å†µæ˜¯ä¸€ä¸ªè‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œå®ƒå¯ä»¥å¸®åŠ©è¿½è¸ªå’Œè§£å†³æ½œåœ¨çš„é—®é¢˜ã€‚ é”€æ¯äº’æ–¥é”å±æ€§å¯¹è±¡pthread_mutexattr_destroy(3C) å‡½æ•°ç”¨äºé‡Šæ”¾ä¸ pthread_mutexattr_init() åˆ›å»ºçš„äº’æ–¥é”å±æ€§å¯¹è±¡ç›¸å…³çš„å­˜å‚¨ç©ºé—´ã€‚è¿™æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ä¸€ä¸ªé‡è¦çš„èµ„æºç®¡ç†æ­¥éª¤ï¼Œç¡®ä¿ç¨‹åºæœ‰æ•ˆåœ°é‡Šæ”¾ä¸å†éœ€è¦çš„èµ„æºï¼Œä»¥é˜²æ­¢å†…å­˜æ³„éœ²å’Œå…¶ä»–æ½œåœ¨çš„é—®é¢˜ã€‚ pthread_mutexattr_destroy è¯­æ³•int pthread_mutexattr_destroy(pthread_mutexattr_t *mattr); ç¤ºä¾‹ä»£ç ï¼š #include pthread.hpthread_mutexattr_t mattr; // å®šä¹‰äº’æ–¥é”å±æ€§å¯¹è±¡int ret;// åˆå§‹åŒ–å±æ€§å¯¹è±¡pthread_mutexattr_init(mattr);// ä¸€äº›æ“ä½œ...// é”€æ¯å±æ€§å¯¹è±¡ret = pthread_mutexattr_destroy(mattr); åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ª pthread_mutexattr_t ç±»å‹çš„å˜é‡ mattrï¼Œç„¶åé€šè¿‡ pthread_mutexattr_init è¿›è¡Œåˆå§‹åŒ–ã€‚åœ¨å®Œæˆå¿…è¦çš„å¤šçº¿ç¨‹æ“ä½œåï¼Œè°ƒç”¨ pthread_mutexattr_destroy æ¥é”€æ¯å±æ€§å¯¹è±¡ã€‚ pthread_mutexattr_destroy è¿”å›å€¼pthread_mutexattr_destroy() åœ¨æˆåŠŸå®Œæˆåè¿”å›é›¶ï¼Œè¿™è¡¨ç¤ºèµ„æºå·²æˆåŠŸé‡Šæ”¾ã€‚ç„¶è€Œï¼Œå¦‚æœè¿”å›å€¼ä¸æ˜¯é›¶ï¼Œåˆ™è¡¨ç¤ºå‡ºç°äº†é”™è¯¯ï¼Œè¿™æ—¶éœ€è¦è¿›è¡Œé€‚å½“çš„é”™è¯¯å¤„ç†ã€‚å¯èƒ½å¯¼è‡´å‡½æ•°å¤±è´¥çš„æƒ…å†µåŒ…æ‹¬ï¼š EINVALæè¿°: mattr æŒ‡å‘çš„å€¼æ— æ•ˆã€‚åœ¨è°ƒç”¨ pthread_mutexattr_destroy æ—¶ï¼Œå¦‚æœä¼ å…¥çš„å±æ€§å¯¹è±¡æœªè¢«æ­£ç¡®åˆå§‹åŒ–ï¼Œæˆ–è€…å·²ç»è¢«é”€æ¯ï¼Œéƒ½ä¼šå¯¼è‡´è¯¥é”™è¯¯å‡ºç°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°è¯•é”€æ¯ä¸€ä¸ªå°šæœªåˆå§‹åŒ–çš„å±æ€§å¯¹è±¡ï¼Œç¨‹åºå°†è¿”å› EINVALã€‚ è®¾ç½®äº’æ–¥é”çš„èŒƒå›´pthread_mutexattr_setpshared(3C) ç”¨äºå®šä¹‰äº’æ–¥é”å˜é‡çš„ä½œç”¨åŸŸï¼Œè¿™ä¸€å±æ€§å¯¹äºå¤šçº¿ç¨‹ç¼–ç¨‹è‡³å…³é‡è¦ã€‚åœ¨è®¾è®¡å¤šçº¿ç¨‹åº”ç”¨æ—¶ï¼Œåˆç†è®¾ç½®äº’æ–¥é”çš„èŒƒå›´å¯ä»¥ç¡®ä¿çº¿ç¨‹ä¹‹é—´çš„æœ‰æ•ˆåŒæ­¥ï¼Œä»è€Œé¿å…æ•°æ®ç«æ€å’Œä¸ä¸€è‡´ç°è±¡ã€‚ pthread_mutexattr_setpshared è¯­æ³•int pthread_mutexattr_setpshared(pthread_mutexattr_t *mattr, int pshared); åœ¨ä½¿ç”¨è¿™ä¸€å‡½æ•°ä¹‹å‰ï¼Œéœ€è¦åŒ…å« pthread.h å¤´æ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åˆå§‹åŒ–äº’æ–¥é”å±æ€§å¹¶è®¾ç½®å®ƒçš„å…±äº«å±æ€§ï¼š #include pthread.hpthread_mutexattr_t mattr;int ret;// åˆå§‹åŒ–äº’æ–¥é”å±æ€§ret = pthread_mutexattr_init(mattr);// è®¾ç½®äº’æ–¥é”ä¸ºè¿›ç¨‹ä¸“ç”¨ret = pthread_mutexattr_setpshared(mattr, PTHREAD_PROCESS_PRIVATE); åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œäº’æ–¥é”å˜é‡å¯ä»¥è¢«ä¸¤ç§ç±»å‹çš„ä½œç”¨åŸŸä½¿ç”¨ï¼š è¿›ç¨‹ä¸“ç”¨ï¼ˆPTHREAD_PROCESS_PRIVATEï¼‰ï¼šå¦‚æœè®¾ç½®ä¸ºè¿™ä¸ªå€¼ï¼Œäº’æ–¥é”ä»…é™äºç”±åŒä¸€è¿›ç¨‹å†…åˆ›å»ºçš„çº¿ç¨‹è®¿é—®ã€‚ä»¥æ­¤å€¼åˆ›å»ºçš„é”æ— æ³•ç”±å…¶ä»–è¿›ç¨‹ä¸­çš„çº¿ç¨‹ä½¿ç”¨ã€‚ ç³»ç»ŸèŒƒå›´å†…ï¼ˆPTHREAD_PROCESS_SHAREDï¼‰ï¼šè‹¥å°† pshared å±æ€§è®¾ç½®ä¸º PTHREAD_PROCESS_SHAREDï¼Œåˆ™äº’æ–¥é”å¯ä»¥åœ¨å¤šä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹ä¹‹é—´å…±äº«ã€‚è¿™é€šå¸¸æ¶‰åŠåœ¨å…±äº«å†…å­˜åŒºåŸŸä¸­åˆ›å»ºäº’æ–¥é”ï¼Œè¿™ä¸€è¡Œä¸ºä¸æ—©æœŸ Solaris çº¿ç¨‹å®ç°ä¸­ mutex_init() å‡½æ•°ä¸­çš„ USYNC_PROCESS æ ‡å¿—æ˜¯ç­‰æ•ˆçš„ã€‚ ä¾‹å¦‚ï¼Œå½“å¤šä¸ªè¿›ç¨‹éœ€è¦å¯¹åŒä¸€èµ„æºè¿›è¡Œè®¿é—®å’Œä¿®æ”¹æ—¶ï¼Œä½¿ç”¨ PTHREAD_PROCESS_SHARED ç±»å‹çš„äº’æ–¥é”èƒ½å¤Ÿé¿å…æ½œåœ¨çš„å¹¶å‘é—®é¢˜ï¼Œè¿™å¯¹äºæ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥å°¤ä¸ºé‡è¦ã€‚ pthread_mutexattr_setpshared è¿”å›å€¼pthread_mutexattr_setpshared() å‡½æ•°åœ¨æˆåŠŸæ‰§è¡Œæ—¶ä¼šè¿”å›é›¶ï¼Œè¡¨æ˜å±æ€§è®¾ç½®æˆåŠŸã€‚å…¶ä»–è¿”å›å€¼åˆ™è¡¨ç¤ºå‘ç”Ÿäº†é”™è¯¯ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½å‡ºç°çš„é”™è¯¯åŠå…¶åŸå› ï¼š EINVALï¼šè¿™ä¸ªé”™è¯¯ä»£ç è¡¨ç¤ºç”± mattr æŒ‡å®šçš„å€¼æ— æ•ˆï¼Œé€šå¸¸å‘ç”Ÿåœ¨ mattr æœªæ­£ç¡®åˆå§‹åŒ–æˆ–å‚æ•°å€¼ä¸è¢«æ”¯æŒçš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå°è¯•ä¼ å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„å…±äº«å±æ€§ç±»å‹æ—¶ï¼Œç³»ç»Ÿä¼šè¿”å› EINVALã€‚ è·å–äº’æ–¥é”çš„èŒƒå›´pthread_mutexattr_getpshared(3C) ç”¨äºè·å–ç”± pthread_mutexattr_setpshared() å®šä¹‰çš„äº’æ–¥é”å˜é‡çš„å…±äº«èŒƒå›´ã€‚è¿™ç§äº’æ–¥é”çš„ä½¿ç”¨èŒƒå›´å†³å®šäº†å®ƒä»¬æ˜¯åº”ç”¨äºå•ä¸ªè¿›ç¨‹ï¼Œè¿˜æ˜¯å¯ä»¥åœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«ã€‚ pthread_mutexattr_getpshared è¯­æ³•int pthread_mutexattr_getpshared(pthread_mutexattr_t *mattr, int *pshared); ä½¿ç”¨æ­¤å‡½æ•°æ—¶ï¼Œé¦–å…ˆéœ€è¦åŒ…å« pthread.h å¤´æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•è·å–äº’æ–¥é”å±æ€§çš„å…±äº«æ¨¡å¼ï¼š #include pthread.hpthread_mutexattr_t mattr;int pshared, ret;// å‡è®¾å·²åœ¨å…¶ä»–åœ°æ–¹è®¾ç½®äº† mattr çš„å±æ€§ret = pthread_mutexattr_getpshared(mattr, pshared); ä¸Šè¿°ä»£ç ä¸­ï¼Œmattr æ˜¯äº’æ–¥é”çš„å±æ€§å¯¹è±¡ï¼Œpshared å°†ç”¨äºå­˜å‚¨è·å–åˆ°çš„å½“å‰å…±äº«æ¨¡å¼ã€‚pthread_mutexattr_getpshared å‡½æ•°å¯ä»¥å°†äº’æ–¥é”çš„å…±äº«æ¨¡å¼å€¼å­˜å‚¨åœ¨ pshared ä¸­ï¼Œå¯èƒ½çš„å€¼ä¸º PTHREAD_PROCESS_SHARED æˆ– PTHREAD_PROCESS_PRIVATEã€‚ PTHREAD_PROCESS_SHAREDï¼šè¡¨ç¤ºå¯åœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«è¯¥äº’æ–¥é”ã€‚è¿™ç§æ¨¡å¼é€‚åˆäºéœ€è¦åœ¨å¤šä¸ªè¿›ç¨‹é—´è¿›è¡ŒåŒæ­¥çš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼Œå½“å¤šä¸ªç‹¬ç«‹çš„ç¨‹åºå…±äº«åŒä¸€å—å†…å­˜åŒºåŸŸæ—¶ã€‚ PTHREAD_PROCESS_PRIVATEï¼šè¡¨ç¤ºè¯¥äº’æ–¥é”ä»…åœ¨åˆ›å»ºå®ƒçš„è¿›ç¨‹å†…æœ‰æ•ˆã€‚è¿™ç§æ¨¡å¼é€šå¸¸ç”¨äºå•çº¿ç¨‹åº”ç”¨ç¨‹åºæˆ–å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºå†…çš„çº¿ç¨‹åŒæ­¥ã€‚ pthread_mutexattr_getpshared è¿”å›å€¼å½“ pthread_mutexattr_getpshared() å‡½æ•°æˆåŠŸæ‰§è¡Œåï¼Œä¼šè¿”å›é›¶ã€‚ä»»ä½•éé›¶çš„è¿”å›å€¼åˆ™è¡¨ç¤ºå‡ºç°é”™è¯¯ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå¯èƒ½çš„é”™è¯¯æƒ…å†µåŠå…¶è¯´æ˜ï¼š EINVALï¼š è¯¥é”™è¯¯ç æ„å‘³ç€ç”± mattr æŒ‡å®šçš„å€¼æ— æ•ˆã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨ mattr æ²¡æœ‰è¢«æ­£ç¡®åˆå§‹åŒ–æˆ–ä¸ç¬¦åˆé¢„æœŸçš„æƒ…å†µä¸‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ mattr æ²¡æœ‰è®¾ç½®ä¸ºæœ‰æ•ˆçš„äº’æ–¥é”å±æ€§å¯¹è±¡ï¼Œè°ƒç”¨è¯¥å‡½æ•°æ—¶å°±ä¼šè¿”å›æ­¤é”™è¯¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”ç¡®ä¿åœ¨è°ƒç”¨è·å–å…±äº«æ¨¡å¼ä¹‹å‰ï¼Œé¦–å…ˆç”¨ç›¸åº”å‡½æ•°åˆå§‹åŒ–äº’æ–¥é”å±æ€§ã€‚ è®¾ç½®äº’æ–¥é”ç±»å‹çš„å±æ€§pthread_mutexattr_settype(3C)è¯¥å‡½æ•°ç”¨äºè®¾ç½®äº’æ–¥é”çš„ type å±æ€§ï¼Œä»¥ä¾¿ä¸ºç‰¹å®šå¤šçº¿ç¨‹åº”ç”¨ç¨‹åºé…ç½®äº’æ–¥é”çš„è¡Œä¸ºã€‚é€‰æ‹©åˆé€‚çš„äº’æ–¥é”ç±»å‹èƒ½å¤Ÿå¸®åŠ©ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œä»è€Œæœ‰æ•ˆåœ°é¿å…æ½œåœ¨çš„ç«äº‰æ¡ä»¶å’Œèµ„æºç®¡ç†é—®é¢˜ã€‚ pthread_mutexattr_settype è¯­æ³•#include pthread.hint pthread_mutexattr_settype(pthread_mutexattr_t *attr, int type); é»˜è®¤å€¼: æ²¡æœ‰æ˜¾å¼è®¾ç½®çš„æƒ…å†µä¸‹ï¼Œç±»å‹å±æ€§çš„ç¼ºçœå€¼ä¸º PTHREAD_MUTEX_DEFAULTã€‚ type å‚æ•°è¯¦è§£type å‚æ•°æŒ‡å®šäº’æ–¥é”çš„å…·ä½“ç±»å‹ã€‚ä»¥ä¸‹æ˜¯æœ‰æ•ˆçš„äº’æ–¥é”ç±»å‹åŠå…¶è¯¦ç»†æè¿°ï¼š PTHREAD_MUTEX_NORMAL æè¿°: è¿™ç§ç±»å‹çš„äº’æ–¥é”ä¸ä¼šæ£€æµ‹æ­»é”æƒ…å†µã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹è¯•å›¾åœ¨æœªè§£é™¤äº’æ–¥é”çš„æƒ…å†µä¸‹å†æ¬¡é”å®šè¯¥äº’æ–¥é”ï¼Œç¨‹åºå¯èƒ½ä¼šé™·å…¥æ­»é”ã€‚æ­¤ç±»äº’æ–¥é”è§£é™¤æ—¶ï¼Œè‹¥å½“å‰é”å®šæ˜¯ç”±å…¶ä»–çº¿ç¨‹å®Œæˆçš„ï¼Œåˆ™ä¼šå¯¼è‡´ä¸ç¡®å®šè¡Œä¸ºã€‚åŒæ—¶ï¼Œè‹¥çº¿ç¨‹å°è¯•è§£é™¤ä¸€ä¸ªæœªè¢«é”å®šçš„äº’æ–¥é”ï¼Œä¹Ÿä¼šå‡ºç°ä¸ç¡®å®šè¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå¦‚æœçº¿ç¨‹ A é”å®šäº†ä¸€ä¸ªäº’æ–¥é”ï¼Œè€Œçº¿ç¨‹ B å°è¯•åœ¨æ²¡æœ‰å…ˆè§£é™¤é”çš„æƒ…å†µä¸‹å†æ¬¡é”å®šè¯¥äº’æ–¥é”ï¼Œçº¿ç¨‹ B å°†ä¼šè¢«é˜»å¡ï¼Œä»è€Œé€ æˆç¨‹åºæ— æ³•ç»§ç»­æ‰§è¡Œã€‚ PTHREAD_MUTEX_ERRORCHECK æè¿°: æ­¤ç±»å‹æä¾›äº†æ›´å®‰å…¨çš„é”™è¯¯æ£€æŸ¥ã€‚å°è¯•é‡æ–°é”å®šå·²ç»ç”±è‡ªèº«çº¿ç¨‹é”å®šçš„äº’æ–¥é”æ—¶ï¼Œå‡½æ•°å°†è¿”å›é”™è¯¯ã€‚è‹¥çº¿ç¨‹å°è¯•è§£é™¤ç”±å…¶ä»–çº¿ç¨‹é”å®šçš„äº’æ–¥é”ï¼Œæˆ–è§£é™¤æœªé”å®šçŠ¶æ€çš„äº’æ–¥é”ï¼ŒåŒæ ·ä¼šè¿”å›é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœçº¿ç¨‹ C é”å®šäº†äº’æ–¥é”è€Œçº¿ç¨‹ D è¯•å›¾å¯¹åŒä¸€é”è¿›è¡Œè§£é™¤ï¼Œå°†å¼•å‘é”™è¯¯ï¼Œé¿å…æ½œåœ¨çš„é€»è¾‘æ¼æ´å’Œæ­»é”ã€‚ PTHREAD_MUTEX_RECURSIVE æè¿°: è¿™ç§ç±»å‹å…è®¸çº¿ç¨‹åœ¨å°šæœªè§£é™¤é”çš„æƒ…å†µä¸‹å†æ¬¡æˆåŠŸé”å®šè¯¥äº’æ–¥é”ã€‚ä¸ PTHREAD_MUTEX_NORMAL ç±»å‹ä¸åŒï¼Œå°è¯•é‡æ–°é”å®šä¸ä¼šé€ æˆæ­»é”ã€‚ä¸ºé‡Šæ”¾è¯¥é”ï¼Œå¿…é¡»è¿›è¡ŒåŒç­‰æ¬¡æ•°çš„è§£é™¤é”å®šï¼Œéšåå…¶ä»–çº¿ç¨‹æ‰èƒ½è·å–è¯¥äº’æ–¥é”ã€‚è‹¥çº¿ç¨‹è¯•å›¾è§£é™¤çš„äº’æ–¥é”ç”±å…¶ä»–çº¿ç¨‹é”å®šï¼Œæˆ–æœªè¢«é”å®šï¼ŒåŒæ ·ä¼šè¿”å›é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œå‡è®¾çº¿ç¨‹ E é”å®šäº†ä¸€ä¸ªäº’æ–¥é”ï¼Œç„¶åå†æ¬¡å°è¯•é”å®šï¼Œè¿™æ—¶å°†ä¿æŒå¯¹è¯¥é”çš„æ§åˆ¶ï¼Œä½†å¿…é¡»åœ¨è§£é™¤é”å®š N æ¬¡åï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½è®¿é—®è¯¥äº’æ–¥é”ã€‚ PTHREAD_MUTEX_DEFAULT æè¿°: è¿™ç§ç±»å‹åœ¨å°è¯•é€’å½’é”å®šæ—¶ä¼šå‡ºç°ä¸ç¡®å®šè¡Œä¸ºã€‚å¦‚æœçº¿ç¨‹æƒ³è¦å¯¹ä¸€ä¸ªä¸æ˜¯è‡ªå·±é”å®šçš„äº’æ–¥é”è§£é™¤é”å®šï¼Œåˆ™å°†å¯¼è‡´ä¸ç¨³å®šçŠ¶æ€ã€‚è‹¥æ­¤äº’æ–¥é”è¿˜æœªè¢«é”å®šï¼ŒåŒæ ·ä¼šå¯¼è‡´ä¸ç¡®å®šè¡Œä¸ºã€‚è¿™ç§ç±»å‹å…è®¸å®æ–½å°†å…¶æ˜ å°„åˆ°å…¶ä»–äº’æ–¥é”ç±»å‹çš„å®ç°ã€‚ä¾‹å¦‚ï¼Œåœ¨ Solaris çº¿ç¨‹ç¯å¢ƒä¸­ï¼ŒPTHREAD_MUTEX_DEFAULT å°†è¢«æ˜ å°„ä¸º PTHREAD_MUTEX_NORMALï¼Œæä¾›é»˜è®¤è¡Œä¸ºã€‚ pthread_mutexattr_settype è¿”å›å€¼ å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›é›¶ï¼›å¦‚æœå‡ºç°é”™è¯¯åˆ™è¿”å›é”™è¯¯å·ï¼Œä»¥ä¸‹æ˜¯å¯èƒ½çš„é”™è¯¯ï¼š EINVAL: æè¿°: æ­¤é”™è¯¯è¡¨æ˜ä¼ å…¥çš„ type å€¼æ— æ•ˆï¼Œå¯èƒ½æ˜¯å› ä¸ºæ‰€ä¼ é€’çš„ç±»å‹ä¸åœ¨å®šä¹‰çš„ç±»å‹åˆ—è¡¨ä¸­ã€‚ EINVAL: æè¿°: æ­¤é”™è¯¯è¡¨ç¤º attr æŒ‡å®šçš„å€¼ä¸ç¬¦åˆé¢„æœŸï¼Œå¯èƒ½æ˜¯æœªæ­£ç¡®åˆå§‹åŒ–äº’æ–¥é”å±æ€§å¯¹è±¡ã€‚ç¡®ä¿åœ¨è°ƒç”¨å‰æ­£ç¡®åˆ›å»ºå¹¶åˆå§‹åŒ– pthread_mutexattr_t ç±»å‹çš„å˜é‡ã€‚ è·å–äº’æ–¥é”çš„ç±»å‹å±æ€§pthread_mutexattr_gettype(3C) å‡½æ•°ç”¨äºè·å–ç”± pthread_mutexattr_settype() è®¾ç½®çš„äº’æ–¥é”çš„ç±»å‹å±æ€§ã€‚è¿™å¯¹äºå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„åŒæ­¥æœºåˆ¶è‡³å…³é‡è¦ã€‚ pthread_mutexattr_gettype è¯­æ³•#include pthread.hint pthread_mutexattr_gettype(pthread_mutexattr_t *attr, int *type); å‚æ•°è¯´æ˜ attrï¼šæŒ‡å‘äº’æ–¥é”å±æ€§å¯¹è±¡çš„æŒ‡é’ˆã€‚è¿™ä¸ªå¯¹è±¡æ˜¯åœ¨è°ƒç”¨ pthread_mutexattr_init() ååˆ›å»ºçš„ï¼ŒåŒ…å«äº†äº’æ–¥é”çš„å„ç§å±æ€§è®¾ç½®ã€‚ typeï¼šæŒ‡å‘æ•´æ•°çš„æŒ‡é’ˆï¼Œç”¨äºæ¥æ”¶äº’æ–¥é”çš„ç±»å‹ã€‚ å¯ç”¨çš„äº’æ–¥é”ç±»å‹ä»¥ä¸‹æ˜¯ type å‚æ•°å¯ä»¥è®¾ç½®çš„æœ‰æ•ˆäº’æ–¥é”ç±»å‹ï¼š PTHREAD_MUTEX_NORMALè¿™ç§ç±»å‹çš„äº’æ–¥é”ä¸æ£€æŸ¥å…¶å½’å±ï¼Œä¸”è‹¥åŒä¸€çº¿ç¨‹ä¸¤æ¬¡å°è¯•è·å–åŒä¸€äº’æ–¥é”ï¼Œè¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚é€‚ç”¨äºä¸éœ€è¦ä¸¥æ ¼é”™è¯¯æ£€æŸ¥çš„åœºæ™¯ã€‚ PTHREAD_MUTEX_ERRORCHECKè¿™ç§ç±»å‹çš„äº’æ–¥é”æä¾›é”™è¯¯æ£€æŸ¥ã€‚å¦‚æœåŒä¸€çº¿ç¨‹è¯•å›¾å†æ¬¡è·å–å·²ç»è¢«é”å®šçš„äº’æ–¥é”ï¼Œå‡½æ•°ä¼šè¿”å›é”™è¯¯ã€‚è¿™ç§ç±»å‹åœ¨éœ€è¦é¿å…æ­»é”çš„å¤šçº¿ç¨‹ç¯å¢ƒä¸­éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤æ‚çš„ç³»ç»Ÿä¸­ï¼Œå¯ä»¥å‡å°‘æ½œåœ¨çš„ç¼–ç¨‹é”™è¯¯ã€‚ PTHREAD_MUTEX_RECURSIVEæ­¤ç±»å‹å…è®¸åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å–åŒä¸€äº’æ–¥é”ï¼Œæ¯æ¬¡è·å–éƒ½å¿…é¡»å¯¹åº”ä¸€ä¸ªé‡Šæ”¾ã€‚å†…æ ¸ä¼šè·Ÿè¸ªé”çš„è·å–æ¬¡æ•°ï¼Œç¡®ä¿çº¿ç¨‹å¯ä»¥å®‰å…¨åœ°é‡å¤é”å®šã€‚è¿™ç§ç±»å‹é€‚ç”¨äºå½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦åœ¨è°ƒç”¨æ·±å±‚å‡½æ•°æ—¶è¿ç»­è·å–åŒä¸€é”çš„æƒ…å†µã€‚ PTHREAD_MUTEX_DEFAULTä½¿ç”¨æ­¤ç±»å‹å°†ä¼šå¾—åˆ°ä¸ PTHREAD_MUTEX_NORMAL ç›¸åŒçš„è¡Œä¸ºã€‚å®ƒè¢«è§†ä¸ºä¸€ä¸ªå¹³å°ç‰¹å®šçš„é»˜è®¤é€‰é¡¹ã€‚ æœ‰å…³æ¯ç§ç±»å‹çš„è¯¦ç»†è¯´æ˜ï¼Œè¯·å‚é˜… pthread_mutexattr_settype å‡½æ•°çš„è¯­æ³•å’Œç›¸åº”æ–‡æ¡£ã€‚ pthread_mutexattr_gettype è¿”å›å€¼ å¦‚æœè°ƒç”¨æˆåŠŸï¼Œpthread_mutexattr_gettype() å‡½æ•°è¿”å›å€¼ä¸º 0ï¼Œè¡¨ç¤ºæˆåŠŸå®Œæˆä»»åŠ¡ã€‚ å¦‚æœè¿”å›å€¼ä¸ºå…¶ä»–ä»»æ„æ•°ï¼Œä»è€Œå¯¼è‡´å‡½æ•°çš„æ‰§è¡Œå¤±è´¥ï¼Œåˆ™è¡¨ç¤ºå‡ºç°äº†é”™è¯¯ã€‚è¿™å¯¹äºè°ƒè¯•å’Œé”™è¯¯å¤„ç†è‡³å…³é‡è¦ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡æ£€æŸ¥è¿”å›å€¼æ¥ç¡®å®šå±æ€§çš„è·å–æ˜¯å¦æˆåŠŸï¼Œå¹¶æ®æ­¤é‡‡å–é€‚å½“çš„å¤„ç†æªæ–½ã€‚ è®¾ç½®äº’æ–¥é”å±æ€§çš„åè®®pthread_mutexattr_setprotocol(3C) å‡½æ•°ç”¨äºè®¾ç½®äº’æ–¥é”å±æ€§å¯¹è±¡çš„åè®®å±æ€§ï¼Œä»¥ä¾¿æ§åˆ¶é”çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼ŒæŸäº›å¤æ‚çš„å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦é˜²æ­¢ä¼˜å…ˆçº§å€’ç½®è¿™ä¸€ç°è±¡ï¼Œä½¿ç”¨åˆé€‚çš„åè®®å¯ä»¥å¸®åŠ©å®ç°è¿™ä¸€ç›®æ ‡ã€‚ pthread_mutexattr_setprotocol è¯­æ³•#include pthread.hint pthread_mutexattr_setprotocol(pthread_mutexattr_t *attr, int protocol); attrï¼šæŒ‡å‘äº’æ–¥é”å±æ€§å¯¹è±¡çš„æŒ‡é’ˆï¼Œè¯¥å¯¹è±¡é€šå¸¸åœ¨ä¹‹å‰è°ƒç”¨ pthread_mutexattr_init() æ—¶åˆ›å»ºã€‚ protocolï¼šæŒ‡å®šè¦åº”ç”¨äºäº’æ–¥é”å±æ€§å¯¹è±¡çš„åè®®ï¼Œå¯ä»¥æ˜¯ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼š åè®®ç±»å‹PTHREAD_PRIO_NONEå½“è®¾ç½®ä¸º PTHREAD_PRIO_NONE æ—¶ï¼Œçº¿ç¨‹çš„ä¼˜å…ˆçº§å’Œè°ƒåº¦å°†ä¸å—äº’æ–¥é”çš„æ‹¥æœ‰æƒå½±å“ã€‚è¿™æ„å‘³ç€æ— è®ºå“ªä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œå…¶è°ƒåº¦å’Œä¼˜å…ˆçº§éƒ½ä¸å—å¹²æ‰°ã€‚è¿™åœ¨ä¸€äº›åŸºæœ¬çš„åœºæ™¯ä¸­æ˜¯æœ‰æ•ˆçš„ï¼Œä½†å¯èƒ½å¯¼è‡´æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹åœ¨ç­‰å¾…ä½ä¼˜å…ˆçº§çº¿ç¨‹é‡Šæ”¾é”æ—¶è¢«é˜»å¡ï¼Œé€ æˆæ•ˆç‡é™ä½ã€‚ PTHREAD_PRIO_INHERITä½¿ç”¨ PTHREAD_PRIO_INHERIT åè®®æ—¶ï¼Œçº¿ç¨‹çš„ä¼˜å…ˆçº§ä¼šå—åˆ°å½±å“ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªçº¿ç¨‹ thrd1 æŒæœ‰ä¸€ä¸ªäº’æ–¥é”ï¼Œè€Œå¦ä¸€ä¸ªé«˜ä¼˜å…ˆçº§çº¿ç¨‹ï¼ˆå¦‚ thrd2ï¼‰è¯•å›¾è·å–è¿™ä¸ªé”ã€‚å½“ thrd2 è¢«é˜»å¡æ—¶ï¼Œthrd1 çš„è°ƒåº¦ä¼šè¢«æå‡åˆ° thrd2 çš„ä¼˜å…ˆçº§ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢ä¼˜å…ˆçº§å€’ç½®çš„å‘ç”Ÿã€‚ ä¾‹å¦‚ï¼Œå‡è®¾çº¿ç¨‹ thrd1 æ˜¯ä¼˜å…ˆçº§ä¸º 10 çš„ä½ä¼˜å…ˆçº§çº¿ç¨‹ï¼Œè€Œ thrd2 æ˜¯ä¼˜å…ˆçº§ä¸º 20 çš„é«˜ä¼˜å…ˆçº§çº¿ç¨‹ï¼Œthrd2 æƒ³è¦è·å– thrd1 çš„é”ã€‚è‹¥é‡‡ç”¨ PTHREAD_PRIO_INHERITï¼Œthrd1 å°†è¢«æå‡åˆ°ä¼˜å…ˆçº§ 20ï¼Œä¼˜å…ˆçº§çš„æå‡å…è®¸ thrd1 æ›´å¿«åœ°é‡Šæ”¾é”ï¼Œä»è€Œé¿å…é«˜ä¼˜å…ˆçº§çº¿ç¨‹é•¿æ—¶é—´ç­‰å¾…ã€‚ å½“æŸä¸ªäº’æ–¥é”çš„å±ä¸»å¤±è´¥ï¼ˆå³å‡ºç°å´©æºƒç­‰æƒ…å†µï¼‰ï¼Œè¢«æ ‡è®°ä¸º _POSIX_THREAD_PRIO_INHERIT çš„äº’æ–¥é”å°†æ‰§è¡Œç‰¹æ®Šå¤„ç†ï¼Œç¡®ä¿èµ„æºåœ¨å±ä¸»æ˜è¿·åçš„çŠ¶æ€å¾—åˆ°æ¢å¤ã€‚ PTHREAD_PRIO_PROTECTè®¾ç½®ä¸º PTHREAD_PRIO_PROTECT æ—¶ï¼Œçº¿ç¨‹åœ¨æ‹¥æœ‰çš„äº’æ–¥é”æœŸé—´ï¼Œå³ä½¿å…¶ä»–çº¿ç¨‹çš„ä¼˜å…ˆçº§æé«˜ï¼Œä¹Ÿä¸ä¼šå½±å“å½“å‰çº¿ç¨‹çš„è°ƒåº¦ã€‚è¿™ç§è®¾è®¡å…è®¸çº¿ç¨‹åœ¨æŒæœ‰é‡è¦èµ„æºæ—¶ä¿æŒå…¶ä¼˜å…ˆçº§ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç›‘æ§çº¿ç¨‹å¯èƒ½éœ€è¦åœ¨æ—¶åˆ»ä¿æŒè¾ƒé«˜çš„å“åº”æ€§ï¼Œå³ä½¿å…¶ä»–ä»»åŠ¡çš„ä¼˜å…ˆçº§å¢åŠ ï¼Œå®ƒä¹Ÿä¸ä¼šè¢«è°ƒåº¦åˆ°æ‰§è¡Œé˜Ÿåˆ—çš„æœ«ç«¯ã€‚ pthread_mutexattr_setprotocol è¿”å›å€¼å¦‚æœå‡½æ•°æˆåŠŸæ‰§è¡Œï¼Œå°†è¿”å› 0ï¼Œè¡¨ç¤ºå±æ€§å·²ç»æˆåŠŸè®¾ç½®ã€‚å¦‚æœè¿”å›å€¼ä¸æ˜¯é›¶ï¼Œåˆ™è¡¨æ˜å‡ºç°é”™è¯¯ã€‚å¯èƒ½çš„é”™è¯¯ä»£ç åŒ…æ‹¬ï¼š ENOSYSï¼šå½“å‰å®ç°ä¸æ”¯æŒè¯¥å‡½æ•°ï¼ŒåŸå› å¯èƒ½æ˜¯é€‰é¡¹ _POSIX_THREAD_PRIO_INHERIT å’Œ _POSIX_THREAD_PRIO_PROTECT æœªå®šä¹‰ã€‚ ENOTSUPï¼šæŒ‡å®šçš„ protocol å€¼åœ¨å½“å‰å®ç°ä¸­ä¸å—æ”¯æŒã€‚ EINVALï¼šæ— æ•ˆçš„ attr æˆ– protocol æŒ‡å®šå€¼ã€‚ EPERMï¼šè°ƒç”¨è¯¥å‡½æ•°çš„çº¿ç¨‹æ²¡æœ‰ç›¸åº”çš„æƒé™ã€‚ è·å–äº’æ–¥é”å±æ€§çš„åè®®pthread_mutexattr_getprotocol(3C) æ˜¯ä¸€ä¸ªé‡è¦çš„å‡½æ•°ï¼Œç”¨äºè·å–äº’æ–¥é”å±æ€§å¯¹è±¡çš„åè®®ã€‚è¿™å¯¹äºå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„èµ„æºç«äº‰å¤„ç†è‡³å…³é‡è¦ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨å’Œä¼˜å…ˆçº§ç®¡ç†ã€‚ pthread_mutexattr_getprotocol è¯­æ³•#include pthread.hint pthread_mutexattr_getprotocol(const pthread_mutexattr_t *attr, int *protocol); å‚æ•°è¯´æ˜ï¼š attrï¼šè¿™æ˜¯ä¸€ä¸ªæŒ‡å‘ä¹‹å‰é€šè¿‡ pthread_mutexattr_init() åˆ›å»ºçš„äº’æ–¥é”å±æ€§å¯¹è±¡çš„æŒ‡é’ˆã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«äº†å„ç§äº’æ–¥é”çš„é…ç½®é€‰é¡¹ï¼Œå…è®¸ç¨‹åºå‘˜è‡ªå®šä¹‰ç›¸åº”çš„è¡Œä¸ºã€‚ protocolï¼šè¿™æ˜¯ä¸€ä¸ªæŒ‡å‘å­˜å‚¨åè®®å±æ€§çš„æ•´æ•°æŒ‡é’ˆï¼Œè°ƒç”¨æˆåŠŸåï¼Œç›¸å…³çš„åè®®å€¼ä¼šè¢«å†™å…¥æ­¤å†…å­˜ä½ç½®ã€‚ åè®®å±æ€§ï¼š PTHREAD_PRIO_NONEï¼šè¡¨ç¤ºäº’æ–¥é”æ²¡æœ‰ä¼˜å…ˆçº§ç»§æ‰¿ç­–ç•¥ã€‚ PTHREAD_PRIO_INHERITï¼šæ­¤å€¼è¡¨æ˜äº’æ–¥é”æ”¯æŒä¼˜å…ˆçº§ç»§æ‰¿ï¼Œä½ä¼˜å…ˆçº§çš„çº¿ç¨‹åœ¨æŒæœ‰äº’æ–¥é”æ—¶ï¼Œå…¶ä¼˜å…ˆçº§å°†æå‡ä¸ºæŒæœ‰é”çš„é«˜ä¼˜å…ˆçº§çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚ PTHREAD_PRIO_PROTECTï¼šæ­¤å€¼è¡¨ç¤ºäº’æ–¥é”ä¿æŠ¤é«˜ä¼˜å…ˆçº§çº¿ç¨‹ï¼Œé˜²æ­¢ä½ä¼˜å…ˆçº§çº¿ç¨‹çš„å¹²æ‰°ã€‚ pthread_mutexattr_getprotocol è¿”å›å€¼ æˆåŠŸï¼šå¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œpthread_mutexattr_getprotocol() å°†è¿”å› 0ï¼Œè¿™è¡¨ç¤ºè¯¥å‡½æ•°è°ƒç”¨æ­£å¸¸å®Œæˆï¼Œäº’æ–¥é”çš„åè®®å±æ€§å·²è·å¾—ã€‚ é”™è¯¯æƒ…å†µï¼š ENOSYSï¼šè¯´æ˜ _POSIX_THREAD_PRIO_INHERIT å’Œ _POSIX_THREAD_PRIO_PROTECT é€‰é¡¹éƒ½æœªå®šä¹‰ã€‚è¿™é€šå¸¸å‡ºç°åœ¨æŸäº›å¹³å°æˆ–å®ç°ä¸æ”¯æŒè¿™äº›åŠŸèƒ½çš„æƒ…å†µä¸‹ã€‚ä¾‹å¦‚ï¼Œåœ¨æŸäº›ç®€å•æˆ–æ—§çš„åµŒå…¥å¼æ“ä½œç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹ä¼˜å…ˆçº§ç®¡ç†å¯èƒ½æœªå®ç°ã€‚ EINVALï¼šå½“æä¾›çš„ attr å‚æ•°æ— æ•ˆæ—¶è¿”å›ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¯¥æŒ‡é’ˆæœªæ­£ç¡®åˆå§‹åŒ–ï¼Œæˆ–æŒ‡å‘çš„å†…å­˜åŒºåŸŸè¢«ç ´åï¼Œè¿™å°†å¯¼è‡´å‡½æ•°æ— æ³•æ­£ç¡®è·å–åè®®å±æ€§ã€‚ EPERMï¼šå½“è°ƒç”¨æ–¹æ²¡æœ‰è¶³å¤Ÿçš„æƒé™æ‰§è¡Œè¯¥æ“ä½œæ—¶è¿”å›æ­¤å€¼ã€‚è¿™å¯èƒ½å‘ç”Ÿåœ¨å°è¯•ä»ä¸æ‹¥æœ‰é”çš„ä¸Šä¸‹æ–‡ä¸­è·å–å±æ€§æ—¶ï¼Œç¡®ä¿æƒé™æ£€æŸ¥çš„ä¸€è‡´æ€§ã€‚ è®¾ç½®äº’æ–¥é”å±æ€§çš„ä¼˜å…ˆçº§ä¸Šé™pthread_mutexattr_setprioceiling(3C) æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè®¾ç½®äº’æ–¥é”å±æ€§å¯¹è±¡çš„ä¼˜å…ˆçº§ä¸Šé™ã€‚è¿™å¯¹äºç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„èµ„æºè®¿é—®å®‰å…¨è‡³å…³é‡è¦ã€‚ pthread_mutexattr_setprioceiling è¯­æ³•#include pthread.hint pthread_mutexattr_setprioceiling(pthread_mutexattr_t *attr, int prioceiling, int *oldceiling); attr: æŒ‡å‘åœ¨è°ƒç”¨ pthread_mutexattr_init() æ—¶åˆ›å»ºçš„äº’æ–¥é”å±æ€§å¯¹è±¡çš„æŒ‡é’ˆã€‚è¿™ä¸ªå±æ€§å¯¹è±¡åŒ…å«äº†äº’æ–¥é”çš„å„ç§å€™é€‰è®¾ç½®ï¼Œå…è®¸å¼€å‘è€…æ ¹æ®éœ€è¦è¿›è¡Œå®šåˆ¶ã€‚ prioceiling: æŒ‡å®šå·²åˆå§‹åŒ–äº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™ã€‚ä¼˜å…ˆçº§ä¸Šé™å®šä¹‰äº†åœ¨æ‰§è¡Œäº’æ–¥é”ä¿æŠ¤çš„ä¸´ç•Œæ®µæ—¶ï¼Œçº¿ç¨‹å¿…é¡»è¾¾åˆ°çš„æœ€ä½ä¼˜å…ˆçº§ã€‚è¿™ä¸€è®¾ç½®æ˜¯ç¡®ä¿åœ¨é«˜ä¼˜å…ˆçº§çº¿ç¨‹éœ€è¦è®¿é—®èµ„æºçš„æƒ…å†µä¸‹ï¼Œä¸ä¼šè¢«ä½ä¼˜å…ˆçº§çº¿ç¨‹é˜»å¡çš„æœ‰æ•ˆæ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œè‹¥æœ‰å¤šä¸ªçº¿ç¨‹ç«äº‰åŒä¸€é”ï¼Œè®¾ç½®åˆé€‚çš„ä¼˜å…ˆçº§ä¸Šé™å¯ä»¥é˜²æ­¢çº¿ç¨‹ä¼˜å…ˆçº§é™ä½ï¼Œä»è€Œé¿å…ä¼˜å…ˆçº§åè½¬é—®é¢˜ã€‚ oldceiling: ä¸€ä¸ªæŒ‡å‘æ•´æ•°çš„æŒ‡é’ˆï¼Œç”¨äºå­˜æ”¾ä¹‹å‰è®¾ç½®çš„ä¼˜å…ˆçº§ä¸Šé™å€¼ã€‚è¿™åœ¨éœ€è¦æ¢å¤åŸæ¥çš„è®¾ç½®æ—¶éå¸¸æœ‰ç”¨ã€‚ pthread_mutexattr_setprioceiling è¿”å›å€¼å¦‚æœ pthread_mutexattr_setprioceiling() æˆåŠŸæ‰§è¡Œï¼Œåˆ™è¿”å› 0ï¼›ä»»ä½•å…¶ä»–å€¼åˆ™è¡¨ç¤ºé‡åˆ°é”™è¯¯ã€‚å¤„ç†è¿™äº›é”™è¯¯ä¿¡æ¯å¯¹äºè°ƒè¯•éå¸¸é‡è¦ï¼Œç†è§£é”™è¯¯çš„æ ¹æºèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…è°ƒæ•´ä»£ç ã€‚ å¯èƒ½çš„é”™è¯¯ä¿¡æ¯ ENOSYSæè¿°: è¯¥é€‰é¡¹ _POSIX_THREAD_PRIO_PROTECT æœªå®šä¹‰ï¼Œæ„å‘³ç€è¯¥å®ç°ä¸æ”¯æŒæ­¤å‡½æ•°ã€‚é€šå¸¸å‘ç”Ÿåœ¨æŸäº›ç³»ç»Ÿç¯å¢ƒä¸­ï¼Œå®ƒä»¬æœªéµå¾ªæ‰€æœ‰çš„ POSIX çº¿ç¨‹ç‰¹æ€§ã€‚ EINVALæè¿°: æä¾›çš„ attr æˆ– prioceiling å€¼æ— æ•ˆã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºæŒ‡å‘çš„äº’æ–¥é”å±æ€§å¯¹è±¡ä¸å­˜åœ¨æˆ–æœªåˆå§‹åŒ–ï¼Œæˆ–æ˜¯ä¼˜å…ˆçº§ä¸Šé™è¶…å‡ºäº†å…è®¸çš„èŒƒå›´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¾å®šäº†ä¸€ä¸ªå°äºæœ€ä½æ‰€éœ€ä¼˜å…ˆçº§çš„å€¼ï¼Œç³»ç»Ÿä¼šæ‹’ç»è¿™ä¸€è®¾ç½®ã€‚ EPERMæè¿°: è°ƒç”¨æ–¹æ— æƒæ‰§è¡Œè¯¥æ“ä½œã€‚è¿™ç§æƒ…å†µå¯èƒ½å‘ç”Ÿåœ¨å°è¯•è®¾ç½®ä¸€ä¸ªé”çš„å±æ€§ï¼Œä½†å½“å‰çº¿ç¨‹å¹¶ä¸å…·æœ‰æ›´æ”¹è¯¥é”å±æ€§çš„æƒé™æ—¶ï¼Œå¸¸è§äºçº¿ç¨‹ä¸å…·å¤‡è¶³å¤Ÿçš„è®¿é—®æƒé™ã€‚ è·å–äº’æ–¥é”å±æ€§çš„ä¼˜å…ˆçº§ä¸Šé™pthread_mutexattr_getprioceiling(3C) æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè·å–äº’æ–¥é”å±æ€§å¯¹è±¡ä¸­çš„ä¼˜å…ˆçº§ä¸Šé™å±æ€§ã€‚è¿™ä¸ªå±æ€§å¯¹äºå¤šçº¿ç¨‹ç¼–ç¨‹è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒå¸®åŠ©é¿å…ä¼˜å…ˆçº§å€’ç½®ç°è±¡ï¼Œç¡®ä¿å…³é”®èµ„æºåœ¨é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹ä¹‹é—´èƒ½å¤Ÿæœ‰æ•ˆç®¡ç†ã€‚ pthread_mutexattr_getprioceiling è¯­æ³•#include pthread.hint pthread_mutexattr_getprioceiling(const pthread_mutexattr_t *attr, int *prioceiling); attrï¼šæŒ‡å‘ä»¥å‰é€šè¿‡è°ƒç”¨ pthread_mutexattr_init() åˆå§‹åŒ–çš„å±æ€§å¯¹è±¡çš„æŒ‡é’ˆã€‚ prioceilingï¼šè¿™æ˜¯ä¸€ä¸ªè¾“å‡ºå‚æ•°ï¼Œç”¨äºè¿”å›å·²è®¾ç½®çš„äº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™ã€‚ æ³¨ä¸ºäº†ä½¿ attr äº’æ–¥é”å±æ€§å¯¹è±¡åŒ…æ‹¬ä¼˜å…ˆçº§ä¸Šé™å±æ€§ï¼Œå¿…é¡»å®šä¹‰ _POSIX_THREAD_PRIO_PROTECT ç¬¦å·ã€‚å¦‚æœè¯¥ç¬¦å·æœªå®šä¹‰ï¼Œåˆ™è¯¥ç‰¹æ€§å°†ä¸å¯ç”¨ã€‚ è°ƒç”¨ pthread_mutexattr_getprioceiling() åï¼Œprioceiling å°†ä¿å­˜äº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™ã€‚è¿™ä¸ªä¼˜å…ˆçº§ä¸Šé™ç¡®å®šäº†åœ¨æ‰§è¡Œäº’æ–¥é”ä¿æŠ¤çš„ä¸´ç•Œæ®µæ—¶çš„æœ€ä½å…è®¸ä¼˜å…ˆçº§ã€‚å› æ­¤ï¼Œè¦æœ‰æ•ˆåœ°ç®¡ç†çº¿ç¨‹ä¹‹é—´çš„èµ„æºç«äº‰ï¼Œç¡®ä¿è®¾ç½®çš„ prioceiling è‡³å°‘è¦é«˜äºå°†æ½œåœ¨é”å®šè¯¥äº’æ–¥é”çš„æ‰€æœ‰çº¿ç¨‹çš„æœ€é«˜ä¼˜å…ˆçº§ï¼Œé€šå¸¸è¿™äº›ä¼˜å…ˆçº§åœ¨ SCHED_FIFO çš„å®šä¹‰èŒƒå›´å†…ã€‚ pthread_mutexattr_getprioceiling è¿”å›å€¼ å¦‚æœå‡½æ•°è°ƒç”¨æˆåŠŸï¼Œpthread_mutexattr_getprioceiling() å°†è¿”å› 0ã€‚ å¦‚æœè¿”å›å…¶ä»–å€¼ï¼Œåˆ™è¡¨ç¤ºå‡ºç°é”™è¯¯ï¼Œè°ƒç”¨æ–¹éœ€è¦è°ƒæŸ¥é—®é¢˜çš„åŸå› ã€‚ å¯èƒ½è¿”å›å€¼çš„å…·ä½“æè¿° ENOSYS æè¿°ï¼š å¦‚æœ _POSIX_THREAD_PRIO_PROTECT é€‰é¡¹æœªå®šä¹‰ï¼Œè¯¥å®ç°ä¸æ”¯æŒæ­¤å‡½æ•°ï¼Œå¯¼è‡´è°ƒç”¨å¤±è´¥ã€‚ EINVAL æè¿°ï¼š å¦‚æœä¼ å…¥çš„ attr å‚æ•°æŒ‡å‘çš„å€¼æ— æ•ˆï¼Œå‡½æ•°å°†è¿”å›æ­¤é”™è¯¯ã€‚ EPERM æè¿°ï¼š å¦‚æœè°ƒç”¨æ–¹æ²¡æœ‰æ‰§è¡Œè¯¥æ“ä½œçš„æƒé™ï¼Œå‡½æ•°å°†è¿”å›æ­¤é”™è¯¯ã€‚ è®¾ç½®äº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™pthread_mutexattr_setprioceiling(3C)æ­¤å‡½æ•°ç”¨äºè®¾ç½®äº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™ï¼Œä»¥ç¡®ä¿å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯·æ±‚è¯¥é”æ—¶ï¼Œä¼˜å…ˆçº§è¾ƒé«˜çš„çº¿ç¨‹èƒ½å¤Ÿä¼˜å…ˆè·å¾—é”ã€‚è¿™å¯¹äºå®æ—¶ç³»ç»Ÿå°¤ä¸ºé‡è¦ï¼Œé¿å…é«˜ä¼˜å…ˆçº§çº¿ç¨‹è¢«ä½ä¼˜å…ˆçº§çº¿ç¨‹é˜»å¡ã€‚ pthread_mutex_setprioceiling è¯­æ³•#include pthread.hint pthread_mutex_setprioceiling(pthread_mutex_t *mutex, int prioceiling, int *old_ceiling); è¯¥å‡½æ•°çš„ä¸»è¦ç›®çš„æ˜¯æ›´æ”¹æŒ‡å®šäº’æ–¥é” mutex çš„ä¼˜å…ˆçº§ä¸Šé™ï¼Œä¿®æ”¹ä¸º prioceiling æ‰€æŒ‡å®šçš„å€¼ã€‚ å‡½æ•°è¯¦ç»†è¯´æ˜ é”å®šäº’æ–¥é”ï¼šåœ¨è°ƒç”¨ pthread_mutex_setprioceiling æ—¶ï¼Œå¦‚æœäº’æ–¥é”æœªè¢«é”å®šï¼Œå‡½æ•°å°†å°è¯•é”å®šå®ƒã€‚å¦‚æœäº’æ–¥é”å·²ç»è¢«å…¶ä»–çº¿ç¨‹é”ä½ï¼Œè¯¥è°ƒç”¨å°†ä¼šé˜»å¡ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾å¹¶æˆåŠŸé”å®šã€‚ ä¼˜å…ˆçº§ä¿æŠ¤åè®®ï¼šåœ¨é”å®šè¿‡ç¨‹ä¸­ï¼Œä¸éœ€è¦éµå¾ªä»»ä½•ä¼˜å…ˆçº§ä¿æŠ¤åè®®ï¼Œè¿™æ„å‘³ç€å³ä½¿é«˜ä¼˜å…ˆçº§çº¿ç¨‹åœ¨ç­‰å¾…é”ï¼Œä½ä¼˜å…ˆçº§çº¿ç¨‹ä»ç„¶å¯ä»¥æŒæœ‰è¯¥é”å¹¶ç»§ç»­æ‰§è¡Œã€‚ è¿”å›æ—§çš„ä¼˜å…ˆçº§ä¸Šé™ï¼šå¦‚æœ pthread_mutex_setprioceiling æˆåŠŸæ‰§è¡Œï¼Œå®ƒä¼šå°†æ—§çš„ä¼˜å…ˆçº§ä¸Šé™å€¼å†™å…¥ old_ceiling å‚æ•°ä¸­ï¼Œæ–¹ä¾¿åç»­çš„ç®¡ç†å’Œè°ƒè¯•ã€‚ ä¿æŒä¸å˜çš„ä¼˜å…ˆçº§ä¸Šé™ï¼šå¦‚æœè¯¥å‡½æ•°æ‰§è¡Œå¤±è´¥ï¼Œäº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™å€¼å°†ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¿æŒåŸæœ‰çŠ¶æ€ä»¥ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§å’Œé¢„æœŸçš„è¡Œä¸ºã€‚ pthread_mutex_setprioceiling è¿”å›å€¼ è¿”å›å€¼ä¸º 0ï¼šè¡¨ç¤ºä¼˜å…ˆçº§ä¸Šé™æˆåŠŸæ›´æ”¹ã€‚ å…¶ä»–è¿”å›å€¼ï¼šè¡¨ç¤ºé‡åˆ°é”™è¯¯ã€‚è°ƒç”¨è€…éœ€è¦æ ¹æ®è¿”å›å€¼é‡‡å–é€‚å½“çš„æªæ–½ã€‚ å¯èƒ½çš„é”™è¯¯åŠå…¶æè¿° ENOSYSæè¿°ï¼šé€‰é¡¹ _POSIX_THREAD_PRIO_PROTECT æœªå®šä¹‰ï¼Œä¸”è¯¥å®ç°ä¸æ”¯æŒæ­¤å‡½æ•°ã€‚è¿™æ„å‘³ç€å½“å‰ç³»ç»Ÿä¸æ”¯æŒè®¾å®šäº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™ç‰¹æ€§ã€‚ EINVAL (ä¼˜å…ˆçº§æ— æ•ˆ) æè¿°ï¼šè¯·æ±‚çš„ prioceiling è¶…å‡ºäº†å…è®¸çš„ä¼˜å…ˆçº§èŒƒå›´ï¼Œè°ƒç”¨è€…éœ€è¦ç¡®è®¤é‡‡ç”¨çš„ä¼˜å…ˆçº§åœ¨ç³»ç»Ÿå…è®¸çš„èŒƒå›´å†…ã€‚ æè¿°ï¼šæŒ‡å®šçš„ mutex å˜é‡å¹¶æœªå¼•ç”¨å½“å‰å­˜åœ¨çš„äº’æ–¥é”ã€‚è¿™å¯èƒ½å› ä¸ºè¯¥äº’æ–¥é”å°šæœªåˆå§‹åŒ–æˆ–å·²ç»è¢«é”€æ¯ã€‚ ENOSYS (åŠŸèƒ½æœªå®ç°)æè¿°ï¼šåœ¨è¯¥ç³»ç»Ÿå®ç°ä¸­ï¼Œäº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™åè®®ä¸å¯ç”¨ã€‚è¿™é™åˆ¶äº†çº¿ç¨‹çš„ä¼˜å…ˆçº§æ§åˆ¶èƒ½åŠ›ã€‚ EPERM (æƒé™ä¸è¶³)æè¿°ï¼šè°ƒç”¨æ–¹æ²¡æœ‰è¶³å¤Ÿçš„æƒé™è¿›è¡Œè¯¥æ“ä½œï¼Œå¯èƒ½æ˜¯ç”±äºäº’æ–¥é”ç”±å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œè€Œè¯¥çº¿ç¨‹æ²¡æœ‰è¶³å¤Ÿçš„æƒé™ä¿®æ”¹ä¼˜å…ˆçº§è®¾ç½®ã€‚ è·å–äº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™pthread_mutexattr_getprioceiling(3C) å‡½æ•°ç”¨äºè·å–äº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™ã€‚è¿™å¯¹äºç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼ŒæŸä¸ªçº¿ç¨‹åœ¨ Higher Priority Mutex è¢«é”ä½æ—¶ä¸ä¼šå‡ºç°ä¼˜å…ˆçº§åè½¬ï¼ˆPriority Inversionï¼‰é—®é¢˜è‡³å…³é‡è¦ã€‚ pthread_mutex_getprioceiling è¯­æ³•#include pthread.hint pthread_mutex_getprioceiling(const pthread_mutex_t *mutex, int *prioceiling); è¯¥å‡½æ•°çš„ä½œç”¨æ˜¯è¿”å›æŒ‡å®šäº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™ï¼Œé€šè¿‡æŒ‡é’ˆå‚æ•° prioceiling ä¼ é€’ã€‚äº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™æ˜¯ç”¨äºè°ƒèŠ‚çº¿ç¨‹è°ƒåº¦çš„ä¸€ä¸ªå…³é”®å‚æ•°ï¼Œæœ‰åŠ©äºæå‡ç³»ç»Ÿçš„å“åº”é€Ÿåº¦å’Œç¨³å®šæ€§ã€‚ pthread_mutex_getprioceiling è¿”å›å€¼å¦‚æœå‡½æ•°æˆåŠŸå®Œæˆï¼Œè¿”å›å€¼ä¸º 0ï¼Œè¿™è¡¨æ˜å‡½æ•°æ‰§è¡Œæ²¡æœ‰é”™è¯¯ã€‚å¦‚æœè¿”å›å€¼æ˜¯å…¶ä»–ä»»ä½•æ•°å€¼ï¼Œè¡¨ç¤ºå‡ºç°äº†é”™è¯¯ã€‚ å¸¸è§é”™è¯¯åŠå…¶å«ä¹‰ ENOSYS æè¿°: _POSIX_THREAD_PRIO_PROTECT é€‰é¡¹æœªå®šä¹‰ï¼Œè¿™æ„å‘³ç€å½“å‰å®ç°ä¸æ”¯æŒè¯¥å‡½æ•°ã€‚è¿™ç§æƒ…å†µé€šå¸¸å‡ºç°åœ¨ä¸€äº›è¾ƒä¸ºåŸºç¡€çš„æˆ–è€æ—§çš„æ“ä½œç³»ç»Ÿå’Œåº“ä¸­ã€‚ EINVAL æè¿°: mutex æŒ‡å®šçš„å€¼å¹¶æœªå¼•ç”¨å½“å‰å­˜åœ¨çš„äº’æ–¥é”ã€‚è¿™é€šå¸¸æ˜¯ç”±äºä¼ é€’çš„æŒ‡é’ˆæ— æ•ˆæˆ–å·²è¢«é”€æ¯ï¼Œå¯¼è‡´æ— æ³•æ£€ç´¢åˆ°æ­£ç¡®çš„äº’æ–¥é”çŠ¶æ€ã€‚ç¡®ä¿åœ¨è°ƒç”¨å‰ mutex æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶ä¸”åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­æœªè¢«æ„å¤–é‡Šæ”¾ã€‚ ENOSYS æè¿°: å½“å‰å®ç°ä¸æ”¯æŒäº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™åè®®ã€‚åœ¨æŸäº›ç‰¹å®šçš„å®ç°ä¸­ï¼Œè¯¥åŠŸèƒ½å¯èƒ½æœªè¢«å®ç°ï¼Œè¿™éœ€è¦æŸ¥é˜…ç›¸å…³æ–‡æ¡£ä»¥ç¡®è®¤æ‰€ä½¿ç”¨çš„ç³»ç»Ÿæˆ–åº“çš„åŠŸèƒ½æ”¯æŒçŠ¶å†µã€‚ EPERM æè¿°: è°ƒç”¨æ–¹æ²¡æœ‰æ‰§è¡Œè¯¥æ“ä½œçš„æƒé™ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰è¶³å¤Ÿçš„æƒé™å»è·å–äº’æ–¥é”çš„ä¼˜å…ˆçº§ä¸Šé™ï¼Œåˆ™ä¼šå‡ºç°æ­¤é”™è¯¯ã€‚å…·ä½“çš„æƒé™è¦æ±‚å¯èƒ½å–å†³äºç³»ç»Ÿçš„å®‰å…¨ç­–ç•¥ã€‚ç¡®ä¿æ‰€è°ƒç”¨çš„çº¿ç¨‹æ‹¥æœ‰è¶³å¤Ÿçš„æƒé™æ¥æ‰§è¡Œç›¸å…³æ“ä½œæ˜¯éå¸¸é‡è¦çš„ã€‚ è®¾ç½®äº’æ–¥é”çš„å¼ºå¥å±æ€§pthread_mutexattr_setrobust_np(3C) ç”¨äºè®¾ç½®äº’æ–¥é”å±æ€§å¯¹è±¡çš„å¼ºå¥å±æ€§ï¼Œä»¥å¢å¼ºå¤šçº¿ç¨‹ç¨‹åºåœ¨å¤„ç†èµ„æºæ—¶çš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚ pthread_mutexattr_setrobust_np è¯­æ³•#include pthread.hint pthread_mutexattr_setrobust_np(pthread_mutexattr_t *attr, int *robustness); æ³¨ï¼šä»…å½“ç¬¦å· _POSIX_THREAD_PRIO_INHERIT è¢«å®šä¹‰æ—¶ï¼Œpthread_mutexattr_setrobust_np() æ‰é€‚ç”¨ã€‚ attrï¼šä¸€ä¸ªæŒ‡å‘é€šè¿‡è°ƒç”¨ pthread_mutexattr_init() åˆ›å»ºçš„äº’æ–¥é”å±æ€§å¯¹è±¡çš„æŒ‡é’ˆã€‚ robustnessï¼šå®šä¹‰åœ¨äº’æ–¥é”å±ä¸»å¤±è´¥æ—¶çš„è¡Œä¸ºã€‚pthread.h ä¸­å®šä¹‰äº†ä¸¤ç§å¯èƒ½çš„ robustness å€¼ï¼š PTHREAD_MUTEX_ROBUST_NP PTHREAD_MUTEX_STALLED_NP é»˜è®¤å€¼ä¸º PTHREAD_MUTEX_STALLED_NPã€‚ PTHREAD_MUTEX_ROBUST_NPå¦‚æœäº’æ–¥é”çš„å±ä¸»ç”±äºæ•…éšœè€Œå¤±æ•ˆï¼Œåˆ™åœ¨åç»­è°ƒç”¨ pthread_mutex_lock() æ—¶ï¼Œæ‰€æœ‰è°ƒç”¨å°†ä»¥ä¸ç¡®å®šçš„æ–¹å¼è¢«é˜»å¡ã€‚è¿™æ„å‘³ç€å…¶ä»–çº¿ç¨‹åœ¨å°è¯•è·å–è¯¥äº’æ–¥é”æ—¶å¯èƒ½ä¼šé™·å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°è·å¾—é”æˆ–è¶…æ—¶ã€‚æ­¤è¡Œä¸ºç¡®ä¿äº†å³ä½¿å±ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œä¸­å‡ºç°é—®é¢˜ï¼Œç³»ç»Ÿä¾ç„¶èƒ½å¤ŸæŒæ§èµ„æºçš„å®‰å…¨æ€§ã€‚ PTHREAD_MUTEX_STALLED_NPåœ¨äº’æ–¥é”çš„å±ä¸»å¤±æ•ˆçš„æƒ…å†µä¸‹ï¼Œäº’æ–¥é”å°†è¢«è§£é”ï¼Œæ–°çš„å±ä¸»å°†è·å–è¯¥äº’æ–¥é”ï¼Œå¹¶è¿”å›é”™è¯¯ EOWNERDEADã€‚è¿™æ„å‘³ç€æ–°çš„å±ä¸»åœ¨è·å–é”æ—¶ä¼šè§‚å¯Ÿåˆ°å‰ä¸€ä¸ªå±ä¸»çš„å¤±æ•ˆï¼Œç¨‹åºéœ€è¦å¯¹æ­¤è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š if (pthread_mutex_lock(mutex) == EOWNERDEAD) // å¤„ç†å±ä¸»å¤±æ•ˆçš„æƒ…å†µ æ³¨ï¼šåº”ç”¨ç¨‹åºå¿…é¡»æ£€æŸ¥ pthread_mutex_lock() çš„è¿”å›å€¼ï¼Œç‰¹åˆ«æ˜¯æŸ¥æ‰¾è¿”å›é”™è¯¯ EOWNERDEAD çš„æƒ…å†µã€‚æ–°çš„å±ä¸»åº”ç¡®ä¿åœ¨è®¿é—®äº’æ–¥é”ä¿æŠ¤çš„æ•°æ®æ—¶ä¿æŒçŠ¶æ€ä¸€è‡´æ€§ã€‚ç”±äºä¸Šä¸€ä¸ªå±ä¸»çš„å¤±æ•ˆï¼Œäº’æ–¥é”ä¿æŠ¤çš„çŠ¶æ€å¯èƒ½ä¼šå˜å¾—ä¸ä¸€è‡´ã€‚ å¦‚æœæ–°çš„å±ä¸»èƒ½å¤Ÿä½¿çŠ¶æ€ä¿æŒä¸€è‡´ï¼Œåº”è¯¥ä½¿ç”¨ pthread_mutex_consistent_np() æ¥ç¡®è®¤äº’æ–¥é”çš„çŠ¶æ€ä¸€è‡´ï¼Œç„¶åæ­£å¸¸è§£é”ã€‚ä¾‹å¦‚ï¼š pthread_mutex_consistent_np(mutex);pthread_mutex_unlock(mutex); å¦‚æœæ–°çš„å±ä¸»æ— æ³•ç¡®ä¿ä¸€è‡´æ€§ï¼Œåˆ™ä¸åº”è°ƒç”¨ pthread_mutex_consistent_np()ï¼Œåªéœ€è§£é™¤é”å®šè¯¥äº’æ–¥é”ã€‚æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹éƒ½ä¼šè¢«å”¤é†’ï¼Œä¹‹åçš„æ‰€æœ‰ pthread_mutex_lock() è°ƒç”¨éƒ½å°†è¿”å›é”™è¯¯ ENOTRECOVERABLEã€‚ä¸ºæ¢å¤äº’æ–¥é”çš„æ­£å¸¸å·¥ä½œçŠ¶æ€ï¼Œå¯é€šè¿‡è°ƒç”¨ pthread_mutex_destroy() æ¥ç ´åäº’æ–¥é”ï¼Œç„¶åå†é€šè¿‡è°ƒç”¨ pthread_mutex_init() é‡æ–°åˆå§‹åŒ–è¯¥äº’æ–¥é”ã€‚ å¦‚æœå·²ç»è·å–è¯¥é”çš„çº¿ç¨‹ç”±äºæ•…éšœè¿”å› EOWNERDEADï¼Œè¿™å°†å¯¼è‡´ä¸‹ä¸€ä¸ªå±ä¸»åœ¨å°è¯•è·å–è¯¥é”æ—¶åŒæ ·è¿”å› EOWNERDEADï¼Œè¿›ä¸€æ­¥ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒçš„å¥å£®æ€§ã€‚ pthread_mutexattr_setrobust_np è¿”å›å€¼å¦‚æœå‡½æ•°æˆåŠŸæ‰§è¡Œï¼Œpthread_mutexattr_setrobust_np() å°†è¿”å› 0ã€‚ Ğ»ÑĞ±Ñ‹Ğµå…¶ä»–è¿”å›å€¼éƒ½è¡¨æ˜å‡ºç°äº†é”™è¯¯ã€‚ ä»¥ä¸‹æ˜¯å¯èƒ½å¯¼è‡´å‡½æ•°å¤±è´¥çš„é”™è¯¯åŠå…¶æè¿°ï¼š ENOSYSï¼šè¡¨ç¤ºé€‰é¡¹ _POSIX_THREAD_PRIO_INHERIT æœªå®šä¹‰ï¼Œæˆ–è€…è¯¥å®ç°ä¸æ”¯æŒ pthread_mutexattr_setrobust_np()ã€‚ ENOTSUPï¼šè¡¨ç¤º robustness æŒ‡å®šçš„å€¼ä¸å—æ”¯æŒã€‚ EINVALï¼šè¡¨ç¤º attr æˆ– robustness æŒ‡å®šçš„å€¼æ— æ•ˆã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","å¤šçº¿ç¨‹"]},{"title":"æ–‡ä»¶IO","path":"/2024/06/07/1-å¹³å°ç³»ç»Ÿ-Linux-IO-æ–‡ä»¶IO/","content":"æ–‡ä»¶ IOæ–‡ä»¶æè¿°ç¬¦ è¿›ç¨‹çš„æ¦‚å¿µæ–‡ä»¶è¾“å…¥è¾“å‡ºçš„è¿‡ç¨‹æ¶‰åŠä»ç¡¬ç›˜åˆ°å†…å­˜å†åˆ° CPU çš„åŠ¨æ€æ•°æ®æµè½¬ã€‚æ¯å½“ä¸€ä¸ªè¿›ç¨‹éœ€è¦è®¿é—®æ–‡ä»¶æ—¶ï¼Œæ“ä½œç³»ç»Ÿè´Ÿè´£åè°ƒè¿™ä¸ªè¿‡ç¨‹ã€‚ å”¯ä¸€æ€§åœ¨æ¯ä¸ªè¿›ç¨‹å†…éƒ¨ï¼Œæ¯ä¸ªæ‰“å¼€çš„æ–‡ä»¶éƒ½å¯¹åº”äºå†…æ ¸ç®¡ç†çš„ä¸€å—ç‰¹å®šåŒºåŸŸã€‚è¿™ä¸ªåŒºåŸŸç¡®ä¿åœ¨åŒä¸€æ—¶åˆ»ï¼Œä¸€ä¸ªè¿›ç¨‹å†…çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯å”¯ä¸€çš„ï¼Œä¸ä¼šä¸å…¶ä»–è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿå†²çªã€‚ æ•´å‹å€¼å†…æ ¸ä¼šä¸ºç”¨æˆ·åˆ†é…ä¸€ä¸ªæ•´å‹å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯ç”¨æ¥å‘Šè¯‰å†…æ ¸å°†è¦æ“ä½œçš„å…·ä½“æ–‡ä»¶ã€‚è¿™ç§è®¾è®¡ä½¿å¾—æ–‡ä»¶æ“ä½œèƒ½å¤Ÿç®€åŒ–ä¸ºé€šè¿‡æè¿°ç¬¦æ¥æ ‡è¯†æ–‡ä»¶ã€‚ é»˜è®¤å€¼å½“è¿›ç¨‹ç¬¬ä¸€æ¬¡è¯·æ±‚æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œç³»ç»Ÿä¼šä½¿ç”¨å½“å‰å¯ç”¨çš„æœ€å°å€¼è¿›è¡Œåˆ†é…ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™äº›é»˜è®¤å€¼ä» 0 å¼€å§‹ï¼Œé€šå¸¸åŒ…æ‹¬æ ‡å‡†è¾“å…¥ï¼ˆ0ï¼‰ã€æ ‡å‡†è¾“å‡ºï¼ˆ1ï¼‰å’Œæ ‡å‡†é”™è¯¯ï¼ˆ2ï¼‰ç­‰ã€‚ ç¼ºçœæ–‡ä»¶æè¿°ç¬¦ ç¡¬ä»¶è®¾å¤‡æ˜ å°„æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦å®é™…ä¸Šæ˜ å°„åˆ°ä¸€ä¸ªç¡¬ä»¶è®¾å¤‡ï¼Œå¦‚ç»ˆç«¯ã€ç½‘ç»œè¿æ¥æˆ–è€…å­˜å‚¨è®¾å¤‡ã€‚è¿™æ„å‘³ç€åº•å±‚æ“ä½œèƒ½å¤Ÿç›´æ¥ä¸ç¡¬ä»¶é€šä¿¡ã€‚ ç³»ç»Ÿé»˜è®¤æ‰“å¼€çš„æ–‡ä»¶æ“ä½œç³»ç»Ÿåœ¨å¯åŠ¨æ—¶ä¼šæ‰“å¼€ä¸€äº›æ–‡ä»¶æè¿°ç¬¦ä»¥ä¾›ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œæ§åˆ¶å°è¾“å…¥å’Œè¾“å‡ºã€‚è¿™æ ·ç¨‹åºåœ¨è¿è¡Œæ—¶èƒ½å¤ŸåŠæ—¶æ¥æ”¶å’Œæ˜¾ç¤ºæ•°æ®ã€‚ æ–‡ä»¶ IO APIç¼–ç¨‹æ¥å£æä¾›äº†ä¸€ç³»åˆ—ç”¨äºæ–‡ä»¶æ“ä½œçš„å‡½æ•°ï¼š æ‰“å¼€æ–‡ä»¶ fp = open(pathname, flag);fp = open(pathname, flag, mode); å…¶ä¸­ï¼Œpathname æ˜¯æ–‡ä»¶çš„è·¯å¾„ï¼Œflag æ˜¯æ‰“å¼€æ–‡ä»¶çš„é€‰é¡¹ï¼ˆå¦‚åªè¯»ã€å¯å†™ç­‰ï¼‰ï¼Œè€Œ mode ç”¨äºæŒ‡å®šæ–°æ–‡ä»¶çš„æƒé™ï¼ˆåœ¨åˆ›å»ºæ–‡ä»¶æ—¶ï¼‰ã€‚ è¯»å–ä¸å†™å…¥ ssize_t read(int fd, void *buf, size_t count);ssize_t write(int fd, const void *buf, size_t count); read å‡½æ•°ä»æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ fd ä¸­è¯»å–æœ€å¤š count å­—èŠ‚çš„æ•°æ®åˆ° buf ä¸­ã€‚ write å‡½æ•°åˆ™å°† buf ä¸­çš„ count å­—èŠ‚æ•°æ®å†™å…¥åˆ°æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ fdã€‚ å…³é—­æ–‡ä»¶ close(fd); å…³é—­æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ fdï¼Œé‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚ æ–‡ä»¶åç§» lseek(); è¯¥å‡½æ•°ç”¨äºåœ¨æ–‡ä»¶ä¸­æ›´æ”¹è¯»å†™ä½ç½®ï¼Œå®ç°å¯¹â€œç©ºæ´æ–‡ä»¶â€çš„æ”¯æŒï¼Œä½¿å¾—å¯ä»¥é«˜æ•ˆåœ°è·³è¿‡æœªä½¿ç”¨çš„åŒºåŸŸã€‚ æ–‡ä»¶å’Œç›®å½•æ–‡ä»¶å±æ€§ è·å–æ–‡ä»¶ä¿¡æ¯ä½¿ç”¨ä»¥ä¸‹å‡ ç§æ–¹æ³•å¯ä»¥è·å–æ–‡ä»¶çš„å±æ€§ï¼š stat(pathname, struct stat p);fstat(int fd, ....);lstat(.., ....); è¿™äº›å‡½æ•°èƒ½è¿”å›æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¤§å°ã€æƒé™ã€ä¿®æ”¹æ—¶é—´ç­‰ã€‚ ç”¨æˆ·å’Œç»„ä¿¡æ¯é€šè¿‡ä»¥ä¸‹å‡½æ•°è·å–ç”¨æˆ·å’Œç»„çš„ä¿¡æ¯ï¼š getpwuid(); // æ ¹æ® uid è·å–ç”¨æˆ·ä¿¡æ¯getgrgid(); // æ ¹æ® gid è·å–ç»„ä¿¡æ¯ è¿™äº›å‡½æ•°èƒ½æ ¹æ®ç”¨æˆ· ID å’Œç»„ ID è¿”å›ç›¸åº”çš„ç»“æ„ä½“ä¿¡æ¯ï¼ŒåŒ…å«ç”¨æˆ·åå’Œç»„åç­‰ã€‚ æ—¶é—´å¤„ç†ä½¿ç”¨ localtime() å‡½æ•°å¯ä»¥å°†æ—¶é—´æˆ³è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´æ ¼å¼ï¼Œä¾¿äºäººç±»å¯è¯»æ€§ã€‚ ç»“æ„ä½“å®šä¹‰åœ¨å¤„ç†æ–‡ä»¶å’Œç›®å½•æ—¶ï¼Œé€šå¸¸éœ€è¦ç”¨åˆ°å‡ ä¸ªé‡è¦çš„ç»“æ„ä½“: æ–‡ä»¶ä¿¡æ¯ç»“æ„ä½“struct stat ... ; ç”¨äºä¿å­˜æ–‡ä»¶çš„å…ƒæ•°æ®ã€‚ ç”¨æˆ·ä¿¡æ¯ç»“æ„ä½“struct passwd ; ç”¨äºä¿å­˜ç”¨æˆ·çš„ä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡ pw = getpwuid(sb.st_uid); è·å–ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚ ç»„ä¿¡æ¯ç»“æ„ä½“struct group ; ç”¨äºä¿å­˜ç»„çš„ä¿¡æ¯ï¼Œæä¾›ç»„åå’Œç»„æˆå‘˜ä¿¡æ¯ã€‚ æ—¶é—´ç»“æ„ä½“struct tm ; ç”¨äºæ—¥æœŸå’Œæ—¶é—´çš„è¡¨ç¤ºä¸å¤„ç†ã€‚ æ–‡ä»¶å¤¹æ“ä½œ æ‰“å¼€ç›®å½• DIR *opendir(); è¯»å–ç›®å½•é¡¹ struct dirent * readdir(); å…³é—­ç›®å½• closedir(); ç›®å½•é¡¹ç»“æ„ä½“struct dirent ; åŒ…å«ç›®å½•é¡¹çš„å„ç±»ä¿¡æ¯ï¼Œå¦‚æ–‡ä»¶åç­‰ã€‚ #include stdio.h#include sys/stat.h#include dirent.hint main(int argc, char **argv) int ret; DIR *dp; struct dirent *dir; ret = mkdir(./mydir,0777); //open fopen umask æˆåŠŸè¿”å›å€¼ä¸ºé0 if(ret 0) printf(Create mydir fail ); return -1; printf(Create mydir success ); dp = opendir(./mydir); //è¿”å›å€¼ä¸ºç›®å½•æµæŒ‡é’ˆ if(dp == NULL) printf(open mydir fail ); return -2; printf(open mydir success ); dir = readdir(dp); //readdirçš„è¿”å›å€¼ä¸ºstruct dirent *ç±»å‹çš„æŒ‡é’ˆ if( dir != NULL ) printf(inode = %ld,name = %s ,dir-d_ino,dir-d_name); closedir(dp); return 0; æ‹“å±• çŸ­å‚æ•°è·å– getopt(); // ç”¨äºè·å–çŸ­å‚æ•°ï¼Œä¾‹å¦‚æ‰§è¡Œå‘½ä»¤ ls -la æ–‡ä»¶æƒé™å’Œå­˜åœ¨æ€§æ£€æŸ¥ access(); // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä»¥åŠç”¨æˆ·å¯¹æ–‡ä»¶çš„æƒé™ æ”¹å˜å½“å‰å·¥ä½œç›®å½• chdir(); // æ”¹å˜è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½• è¿™äº›å‡½æ•°å’Œç»“æ„ä½“ä¸ºæ–‡ä»¶å’Œç›®å½•çš„ç®¡ç†æä¾›äº†åŸºæœ¬çš„å·¥å…·ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿé«˜æ•ˆåœ°è¿›è¡Œæ–‡ä»¶æ“ä½œã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","IO"]},{"title":"åˆ‡æ¢å¼€é”€","path":"/2024/06/06/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-å¤šçº¿ç¨‹-åˆ‡æ¢å¼€é”€/","content":"è¿›ç¨‹å±è”½äº† CPU è°ƒåº¦ã€å†…å­˜ç®¡ç†ç­‰åº•å±‚ç¡¬ä»¶ç»†èŠ‚ï¼Œä»è€Œå®šä¹‰äº†ä¸€ä¸ªç®€å•æ˜“æ‡‚çš„æ¦‚å¿µï¼Œè®©åº”ç”¨ç¨‹åºèƒ½å¤Ÿæ›´ä¸“å¿ƒåœ°å®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¤šä¸ªè¿›ç¨‹åœ¨æœ‰é™çš„ CPU èµ„æºä¸Šå¯ä»¥â€åŒæ—¶â€æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œæ¯”å¦‚åŒæ—¶å“åº”æˆåƒä¸Šä¸‡çš„ç”¨æˆ·è¯·æ±‚ã€‚ç„¶è€Œï¼Œè¿™ç§ä¾¿åˆ©æ€§ä¹Ÿä¼´éšç€é¢å¤–çš„å¼€é”€ã€‚ä»¥ä¸‹å›¾ç¤ºä¾‹ä¸ºä¾‹ï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹å¾—ä»¥è¿è¡Œçš„æ—¶é—´é‡Œï¼ŒCPU è™½ç„¶å¿™äºäº‹åŠ¡ï¼Œå´å¯èƒ½å¹¶æœªå®Œæˆä»»ä½•å®é™…çš„ç”¨æˆ·å·¥ä½œï¼Œè¿™æ­£æ˜¯è¿›ç¨‹æœºåˆ¶å¸¦æ¥çš„é¢å¤–å¼€é”€ã€‚ å½“è¿›ç¨‹ A åˆ‡æ¢åˆ°è¿›ç¨‹ B æ—¶ï¼Œç³»ç»Ÿä¼šå…ˆä¿å­˜è¿›ç¨‹ A çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»¥ç¡®ä¿å…¶æœªæ¥æ¢å¤æ—¶èƒ½å¤Ÿç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚æ¥ç€ï¼Œç³»ç»Ÿä¼šå°†è¿›ç¨‹ B çš„ä¸Šä¸‹æ–‡æ¢å¤åˆ° CPU å¯„å­˜å™¨ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€åœ¨è¿›ç¨‹æ•°é‡è¾ƒå°‘ä¸”åˆ‡æ¢é¢‘ç‡ä¸é«˜çš„åœºæ™¯ä¸‹é—®é¢˜ä¸å¤§ï¼Œä½†åœ¨ç°ä»£ Linux æ“ä½œç³»ç»Ÿä¸­ï¼Œéšç€é«˜å¹¶å‘ç½‘ç»œç¨‹åºåç«¯æœåŠ¡å™¨çš„æ™®åŠï¼Œè¿™ä¸€å¼€é”€å˜å¾—ä¸å®¹å¿½è§†ã€‚åœ¨å•å°æœºå™¨ä¸Šæ”¯æŒæˆåƒä¸Šä¸‡ä¸ªç”¨æˆ·è¯·æ±‚æ—¶ï¼Œè¿›ç¨‹åœ¨æ‰§è¡Œç½‘ç»œ IO æ“ä½œï¼ˆå¦‚è®¿é—® Redis æˆ– MySQLï¼‰æ—¶æˆ–å½“æ—¶é—´ç‰‡è€—å°½æ—¶ï¼Œéƒ½ä¼šè§¦å‘ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ ä¸ºäº†ç›´è§‚äº†è§£ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢éœ€è¦å¤šé•¿æ—¶é—´ï¼Œè®©ä»¬è¿›è¡Œä¸€ä¸ªå®éªŒã€‚å®éªŒæ–¹æ³•æ˜¯åˆ›å»ºä¸¤ä¸ªè¿›ç¨‹ï¼Œäº’ä¸ºä»¤ç‰Œçš„å‘é€è€…å’Œæ¥æ”¶è€…ã€‚å…¶ä¸­ä¸€ä¸ªè¿›ç¨‹åœ¨æ¥æ”¶ä»¤ç‰Œæ—¶ä¼šå¼•å‘é˜»å¡ï¼Œè€Œå¦ä¸€ä¸ªè¿›ç¨‹åœ¨å‘é€ä»¤ç‰Œåç­‰å¾…å…¶è¢«æ¥æ”¶æ—¶ä¹Ÿå¤„äºé˜»å¡çŠ¶æ€ã€‚ä»¬å¯ä»¥ç»Ÿè®¡ç»è¿‡ä¸€å®šæ¬¡æ•°å¾€è¿”ä¼ é€åçš„å¹³å‡å•æ¬¡åˆ‡æ¢æ—¶é—´å¼€é”€ã€‚å®éªŒä»£ç è§ test04ï¼š # gcc main.c -o main# ./main åœ¨å®éªŒè¿è¡Œåï¼Œä»¬å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š Before Context Switch Time: 1565352257 s, 774767 usAfter Context Switch Time: 1565352257 s, 842852 us ç»è¿‡å¤šæ¬¡è¿è¡Œï¼Œä»¬å‘ç°å¹³å‡æ¯æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢è€—æ—¶çº¦ä¸º 3.5 å¾®ç§’ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸€æ•°å€¼ä¼šå› å…·ä½“æœºå™¨é…ç½®å’Œè´Ÿè½½è€Œæœ‰æ‰€å·®å¼‚ï¼Œå› æ­¤å»ºè®®åœ¨å®é™…æœºå™¨ä¸Šè¿›è¡Œæµ‹è¯•ã€‚ä¹‹å‰æµ‹è¯•ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œæœ€ä½å€¼æ˜¯ 200 çº³ç§’ï¼Œå› æ­¤å¯ä»¥æ˜æ˜¾çœ‹å‡ºä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€æ¯”ç³»ç»Ÿè°ƒç”¨æ›´ä¸ºæ˜¾è‘—ã€‚ç³»ç»Ÿè°ƒç”¨ä»…éœ€åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´åˆ‡æ¢ï¼Œè€Œä¸Šä¸‹æ–‡åˆ‡æ¢åˆ™éœ€è¦è¿›è¡Œè¿›ç¨‹é—´çš„åˆ‡æ¢ï¼Œå·¥ä½œé‡æ˜¾ç„¶æ›´å¤§ã€‚ ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€æ¥æºä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼ŒCPU çš„å¼€é”€å¯åˆ†ä¸ºç›´æ¥å¼€é”€å’Œé—´æ¥å¼€é”€ã€‚ ç›´æ¥å¼€é”€ï¼šåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼ŒCPU å¿…é¡»å®Œæˆçš„æ“ä½œï¼ŒåŒ…æ‹¬ï¼š åˆ‡æ¢é¡µè¡¨å…¨å±€ç›®å½• åˆ‡æ¢å†…æ ¸æ€å †æ ˆ åˆ‡æ¢ç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼ˆåœ¨æ¢å¤è¿›ç¨‹å‰ï¼Œå¿…é¡»å°†æ•°æ®åŠ è½½åˆ°å¯„å­˜å™¨ä¸­ï¼‰ **ip (instruction pointer)**ï¼šæŒ‡å‘å½“å‰æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤ **bp (base pointer)**ï¼šæ ˆå¸§çš„æ ˆåº•åœ°å€ **sp (stack pointer)**ï¼šæ ˆå¸§çš„æ ˆé¡¶åœ°å€ cr3ï¼šé¡µç›®å½•åŸºå€å¯„å­˜å™¨ï¼Œä¿å­˜é¡µç›®å½•è¡¨çš„ç‰©ç†åœ°å€ åˆ·æ–° TLBï¼ˆTranslation Lookaside Bufferï¼‰ æ‰§è¡Œç³»ç»Ÿè°ƒåº¦å™¨ä»£ç  é—´æ¥å¼€é”€ï¼šå³ä¾¿åˆ‡æ¢åˆ°äº†æ–°è¿›ç¨‹ï¼Œç”±äºç¼“å­˜çƒ­åº¦ä¸‹é™ï¼Œè¿è¡Œé€Ÿåº¦å¾€å¾€ä¼šå‡ç¼“ã€‚è¿™ç§å½±å“ç‰¹åˆ«æ˜æ˜¾å½“è¿›ç¨‹è·¨ CPU åˆ‡æ¢æ—¶ï¼Œå› ä¸ºåŸå…ˆåœ¨ç¼“å­˜ï¼ˆå¦‚ L1ã€L2ã€L3ï¼‰ä¸­çƒ­åº¦é«˜çš„ä»£ç å’Œæ•°æ®ï¼Œéšç€è¿›ç¨‹çš„åˆ‡æ¢ä¼šå¤±æ•ˆï¼Œä»è€Œå¢åŠ äº†å†…å­˜ IO çš„å¼€é”€ã€‚ä»¬çš„å®éªŒå¯¹è¿™ç§é—´æ¥å¼€é”€çš„æµ‹é‡å¹¶ä¸ç†æƒ³ï¼Œå®é™…ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€å¯èƒ½ä¼šå¤§äº 3.5 å¾®ç§’ã€‚ å¯¹äºæƒ³æ·±å…¥äº†è§£æ›´å¤šçš„åŒå­¦ï¼Œå¯ä»¥å‚è€ƒã€Šæ·±å…¥ç†è§£ Linux å†…æ ¸ã€‹ä¸­çš„ç›¸å…³ç« èŠ‚ã€‚ å°è¯•ä½¿ç”¨ä¸“ä¸šæµ‹è¯•å·¥å…· - lmbenchlmbench æ˜¯ä¸€æ¬¾å¼€æºçš„åŸºå‡†æµ‹è¯•å·¥å…·ï¼Œæ—¨åœ¨è¯„ä¼°ç³»ç»Ÿæ€§èƒ½ï¼ŒåŒ…æ‹¬æ–‡æ¡£è¯»å†™ã€å†…å­˜æ“ä½œã€è¿›ç¨‹åˆ›å»ºä¸é”€æ¯å¼€é”€ï¼Œä»¥åŠç½‘ç»œæ€§èƒ½ç­‰ã€‚å…¶æ“ä½œæ–¹æ³•ç®€å•ï¼Œä½†æœ‰æ—¶å€™è¿è¡Œé€Ÿåº¦è¾ƒæ…¢ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œå°è¯•ã€‚è¿™ä¸ªå·¥å…·çš„ä¼˜åŠ¿åœ¨äºè¿›è¡Œå¤šç»„å®éªŒï¼Œåˆ†åˆ«å¯¹ 2 ä¸ªã€8 ä¸ªã€16 ä¸ªè¿›ç¨‹è¿›è¡Œæµ‹è¯•ï¼Œä½¿ç”¨ä¸åŒå¤§å°çš„æ•°æ®ï¼Œèƒ½è¾ƒå¥½åœ°æ¨¡æ‹Ÿç¼“å­˜æœªå‘½ä¸­çš„æƒ…å†µã€‚ ä½¿ç”¨ lmbench æµ‹è¯•åå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š Host OS 2p/0K 2p/16K 2p/64K 8p/16K 8p/64K 16p/16K 16p/64Kctxsw ctxsw ctxsw ctxsw ctxsw ctxsw ctxsw -----------------------------------------------------------------------bjzw_46_7 Linux 2.6.32- 2.7800 2.7800 2.7000 4.3800 4.0400 4.75000 5.48000 ä» rsyslog çš„æ•°æ®æ¥çœ‹ï¼Œè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è€—æ—¶åœ¨ 2.7 å¾®ç§’åˆ° 5.48 å¾®ç§’ä¹‹é—´ã€‚ çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è€—æ—¶æ¥ä¸‹æ¥ä»¬æµ‹è¯• Linux ä¸‹çš„çº¿ç¨‹ï¼Œä»¥ç¡®å®šå…¶åˆ‡æ¢æ˜¯å¦æ¯”è¿›ç¨‹æ›´è¿…é€Ÿã€‚å®é™…ä¸Šåœ¨ Linux ä¸­å¹¶ä¸å­˜åœ¨çœŸæ­£çš„çº¿ç¨‹ï¼Œå…¶å®æ˜¯ä¸ºå¼€å‘è€…å®ç°çš„è½»é‡çº§è¿›ç¨‹ï¼Œè¿™ç§è¿›ç¨‹ä¸æ™®é€šè¿›ç¨‹ç›¸æ¯”ï¼Œè™½æœ‰ç‹¬ç«‹çš„ task_struct è¿›ç¨‹æè¿°ç¬¦å’Œ pidï¼Œå´å¯ä»¥å…±äº«å†…å­˜åœ°å€ç©ºé—´ã€ä»£ç æ®µã€å…¨å±€å˜é‡ä»¥åŠæ‰“å¼€çš„æ–‡ä»¶é›†åˆã€‚å› æ­¤ï¼ŒåŒä¸€è¿›ç¨‹ä¸‹çš„çº¿ç¨‹è°ƒç”¨ getpid() æ—¶æ˜¾ç¤ºçš„ pid æ˜¯ç›¸åŒçš„ï¼Œå…¶å® task_struct ä¸­è¿˜æœ‰ä¸€ä¸ª tgid å­—æ®µï¼Œæ„å‘³ç€å¤šçº¿ç¨‹ç¨‹åºçš„çº¿ç¨‹å®é™…ä¸Šæ˜¯å…±äº«æŸä¸ªç‰¹å®šè¿›ç¨‹çš„æ ‡è¯†ç¬¦ã€‚ ä»¬å†æ¬¡è¿›è¡Œå®éªŒï¼Œä»£ç è§ test06ã€‚å®éªŒåŸç†ä¸è¿›ç¨‹æµ‹è¯•ç±»ä¼¼ï¼Œåˆ›å»º 20 ä¸ªçº¿ç¨‹ï¼Œä½¿ç”¨ç®¡é“äº’ä¼ ä¿¡å·ã€‚æ¥æ”¶åˆ°ä¿¡å·åï¼Œçº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œå¹¶ä¼ é€’ä¿¡å·ç»™ä¸‹ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œè‡ªå·±åˆ™è¿›å…¥ç¡çœ çŠ¶æ€ã€‚å®éªŒä¸­ç»Ÿè®¡äº†ç®¡é“ä¼ é€’ä¿¡å·çš„é¢å¤–å¼€é”€ã€‚ # gcc -lpthread main.c -o main å®éªŒç»“æœæ˜¾ç¤ºä¸ºï¼š 0.508250 4.363495 ç»è¿‡å¤šæ¬¡å®éªŒåï¼Œçº¿ç¨‹åˆ‡æ¢çš„å¹³å‡è€—æ—¶å¤§çº¦ä¸º 3.8 å¾®ç§’ã€‚ä»ä¸Šä¸‹æ–‡åˆ‡æ¢çš„è€—æ—¶ä¸Šæ¥çœ‹ï¼ŒLinux ä¸‹çš„çº¿ç¨‹ï¼ˆå³è½»é‡çº§è¿›ç¨‹ï¼‰ä¸è¿›ç¨‹çš„åˆ‡æ¢å·®å¼‚ä¸å¤§ã€‚ Linux ç±»ç›¸å…³å‘½ä»¤æ—¢ç„¶ä»¬æ¸…æ¥šäº†ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„ CPU æ—¶é—´æ¶ˆè€—ï¼Œä½•ä¸åˆ©ç”¨ä¸€äº›å·¥å…·è§‚å¯Ÿ Linux ç³»ç»Ÿä¸­çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µå‘¢ï¼Ÿå¦‚æœä¸Šä¸‹æ–‡åˆ‡æ¢å¯¹æ•´ä½“æ€§èƒ½é€ æˆå½±å“ï¼Œä»¬ä¹Ÿè®¸å¯ä»¥è¯†åˆ«é—®é¢˜çš„è¿›ç¨‹å¹¶ä½œç›¸åº”ä¼˜åŒ–ã€‚ åˆ©ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š # vmstat 1 å¯ä»¥è¾“å‡ºç³»ç»Ÿå½“å‰çš„è¿›ç¨‹çŠ¶æ€ã€å†…å­˜ä½¿ç”¨æƒ…å†µç­‰ä¿¡æ¯ã€‚ procs -----------memory---------- --swap-- -----io---- --system-- -----cpu----- r b swpd free buff cache si so bi bo in cs us sy id wa st ... å¦å¤–ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤è·å–æ¯ç§’çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¿¡æ¯ï¼š # sar -w 1 æ­¤å‘½ä»¤å°†å±•ç¤ºä¸€æ®µæ—¶é—´å†…çš„è¿›ç¨‹åˆ›å»ºæ¬¡æ•°åŠä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ã€‚ä¾‹å¦‚ï¼š proc/s cswch/s 11:19:20 AM proc/s cswch/s... åœ¨å®éªŒç¯å¢ƒä¸­ï¼Œè¿™å°é…ç½®ä¸º 8 æ ¸ 8G çš„ KVM è™šæ‹Ÿæœºï¼Œä¸Šé¢è¿è¡Œçš„æ˜¯ nginx + fpmï¼ˆæ•°é‡ä¸º 1000ï¼‰ï¼Œæ¯ç§’å¹³å‡å¤„ç†çš„ç”¨æˆ·è¯·æ±‚çº¦ 100 å·¦å³ã€‚å…¶ä¸­ cswch åˆ—æŒ‡ç¤ºäº†åœ¨ 1 ç§’å†…ç³»ç»Ÿå‘ç”Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ï¼Œè¾¾åˆ°å¤§çº¦ 4 ä¸‡æ¬¡ã€‚è¿™æ„å‘³ç€æ¯ä¸ª CPU åœ¨ 1 ç§’å†…äº§ç”Ÿçº¦ 5 åƒæ¬¡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ¯ç§’æ¶ˆè€—è¿‘ 20 æ¯«ç§’ç”¨äºä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ ä¸ºäº†æ›´æ·±å…¥äº†è§£é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æºå¤´ï¼Œä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š # pidstat -w è¯¥å‘½ä»¤ä¼šæ˜¾ç¤ºå„ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š PID cswch/s nvcswch/s Command32316 4.00 0.00 php-fpm32508 160.00 34.00 php-fpm32726 131.00 8.00 php-fpm... ç”±äº fpm è¿è¡Œå¤„äºé˜»å¡æ¨¡å¼ï¼Œæ¯å½“è¯·æ±‚ Redisã€Memcached æˆ– MySQL æ—¶ä¼šè§¦å‘è‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè€Œéè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ä»…åœ¨æ—¶é—´ç‰‡è€—å°½æ—¶å‘ç”Ÿï¼Œå› æ­¤å¤§å¤šæ•°åˆ‡æ¢éƒ½æ˜¯è‡ªæ„¿çš„ã€‚ å¦‚æœéœ€è¦æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„æ€»ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µï¼Œå¯ä»¥è¿›å…¥ /proc ç›®å½•ä¸‹æŸ¥çœ‹ï¼š grep ctxt /proc/PID/status é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä»¬èƒ½å¤Ÿç›´æ¥çœ‹åˆ° voluntary_ctxt_switches å’Œ nonvoluntary_ctxt_switches çš„æ€»æ•°ã€‚è¿™äº›æ•°æ®æ— é¡»è®°ä½ä¸Šä¸‹æ–‡åˆ‡æ¢æ‰€åšçš„å…·ä½“æ“ä½œï¼Œåªéœ€çŸ¥é“ä¸€ä¸ªç»“è®ºï¼šå®éªŒç»“æœæ˜¾ç¤ºä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€åœ¨ 2.7 å¾®ç§’åˆ° 5.48 å¾®ç§’ä¹‹é—´ï¼Œè€Œä¹Ÿå¯ä»¥å€ŸåŠ©æä¾›çš„ä»£ç å’Œå·¥å…·è¿›è¡Œæµ‹è¯•ï¼Œlmbench çš„æµ‹è¯•ç»“æœæ›´ä¸ºå‡†ç¡®ï¼Œå› ä¸ºå®ƒè€ƒè™‘åˆ°äº†åç»­ç¼“å­˜æœªå‘½ä¸­çš„å½±å“ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","å¤šçº¿ç¨‹"]},{"title":"å¤šçº¿ç¨‹","path":"/2024/06/05/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-å¤šçº¿ç¨‹-å¤šçº¿ç¨‹/","content":"ä¼ ç»Ÿå¤šä»»åŠ¡æ“ä½œç³»ç»Ÿä¸­ä¸€ä¸ªå¯ä»¥ç‹¬ç«‹è°ƒåº¦çš„ä»»åŠ¡ï¼ˆæˆ–ç§°ä¹‹ä¸ºé¡ºåºæ‰§è¡Œæµï¼‰æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚æ¯ä¸ªç¨‹åºåŠ è½½åˆ°å†…å­˜ååªå¯ä»¥å”¯ä¸€åœ°å¯¹åº”åˆ›å»ºä¸€ä¸ªé¡ºåºæ‰§è¡Œæµï¼Œå³ä¼ ç»Ÿæ„ä¹‰çš„è¿›ç¨‹ã€‚ æ¯ä¸ªè¿›ç¨‹çš„å…¨éƒ¨ç³»ç»Ÿèµ„æºæ˜¯ç§æœ‰çš„ï¼Œå¦‚è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œæ–‡ä»¶æè¿°ç¬¦å’Œä¿¡å·å¤„ç†ç­‰ç­‰ã€‚ä½¿ç”¨å¤šè¿›ç¨‹å®ç°å¤šä»»åŠ¡åº”ç”¨æ—¶å­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š ä»»åŠ¡åˆ‡æ¢ï¼Œå³è¿›ç¨‹é—´ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œç³»ç»Ÿå¼€é”€æ¯”è¾ƒå¤§ã€‚ï¼ˆè™šæ‹Ÿåœ°å€ç©ºé—´ä»¥åŠ task_struct éƒ½éœ€è¦åˆ‡æ¢ï¼‰ å¤šä»»åŠ¡ä¹‹é—´çš„åä½œæ¯”è¾ƒéº»çƒ¦ï¼Œæ¶‰åŠè¿›ç¨‹é—´é€šè®¯ã€‚ï¼ˆå› ä¸ºä¸åŒçš„è¿›ç¨‹å·¥ä½œåœ¨ä¸åŒçš„åœ°å€ç©ºé—´ï¼‰ æ‰€ä»¥ï¼Œä¸ºäº†æé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼Œè®¸å¤šæ“ä½œç³»ç»Ÿè§„èŒƒé‡Œå¼•å…¥äº†è½»é‡çº§è¿›ç¨‹çš„æ¦‚å¿µï¼Œä¹Ÿè¢«ç§°ä¸ºçº¿ç¨‹ã€‚ é€šå¸¸çº¿ç¨‹æŒ‡çš„æ˜¯å…±äº«ç›¸åŒåœ°å€ç©ºé—´çš„å¤šä¸ªä»»åŠ¡ã€‚çº¿ç¨‹æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­åˆ›å»ºçš„çº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼›ä½†ä¸€ä¸ªçº¿ç¨‹ä»ç”¨ task_struct æ¥æè¿°ï¼Œçº¿ç¨‹å’Œè¿›ç¨‹éƒ½å‚ä¸ç»Ÿä¸€çš„è°ƒåº¦ã€‚æ‰€ä»¥ï¼Œå¤šçº¿ç¨‹çš„å¥½å¤„ä¾¿ä½“ç°å‡ºæ¥ï¼š å¤§å¤§æé«˜äº†ä»»åŠ¡åˆ‡æ¢çš„æ•ˆç‡ï¼›å› ä¸ºå„çº¿ç¨‹å…±äº«è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œä»»åŠ¡åˆ‡æ¢æ—¶åªè¦åˆ‡æ¢ task_struct å³å¯ï¼› çº¿ç¨‹é—´é€šä¿¡æ¯”è¾ƒæ–¹ä¾¿ï¼›å› ä¸ºåœ¨åŒä¸€å—åœ°å€ç©ºé—´ï¼Œæ•°æ®å…±äº«ï¼› å½“ç„¶ï¼Œå…±äº«åœ°å€ç©ºé—´ä¹Ÿä¼šæˆä¸ºçº¿ç¨‹çš„ç¼ºç‚¹ï¼Œå› ä¸ºå…±äº«åœ°å€ç©ºé—´ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹å‡ºç°é”™è¯¯ï¼ˆæ¯”å¦‚æ®µé”™è¯¯ï¼‰ï¼Œæ•´ä¸ªçº¿ç¨‹ç»„éƒ½ä¼šå´©æ‰ï¼ Linux ä¹‹æ‰€ä»¥ç§°å‘¼å…¶çº¿ç¨‹ä¸º LWP( Light Weight Process )ï¼Œå› ä¸ºä»å†…æ ¸å®ç°çš„è§’åº¦æ¥è¯´ï¼Œå®ƒå¹¶æ²¡æœ‰ä¸ºçº¿ç¨‹å•ç‹¬åˆ›å»ºä¸€ä¸ªç»“æ„ï¼Œè€Œæ˜¯ç»§æ‰¿äº†å¾ˆå¤šè¿›ç¨‹çš„è®¾è®¡ï¼š ç»§æ‰¿äº†è¿›ç¨‹çš„ç»“æ„ä½“å®šä¹‰ task_struct ï¼› æ²¡æœ‰ä¸“é—¨å®šä¹‰çº¿ç¨‹ IDï¼Œå¤ç”¨äº† PIDï¼› æ›´æ²¡æœ‰ä¸ºçº¿ç¨‹å®šä¹‰ç‰¹åˆ«çš„è°ƒåº¦ç®—æ³•ï¼Œè€Œæ˜¯æ²¿ç”¨äº†åŸæ¥å¯¹ task_struct çš„è°ƒåº¦ç®—æ³•ã€‚ çº¿ç¨‹å·²ç»æ›¿ä»£åŸæ¥çš„è¿›ç¨‹ç§°ä¸ºè°ƒåº¦çš„å®é™…æœ€å°å•ä½ã€‚ åŸæ¥çš„è¿›ç¨‹æ¦‚å¿µå¯ä»¥çœ‹æˆæ˜¯å¤šä¸ªçº¿ç¨‹çš„å®¹å™¨ï¼Œç§°ä¹‹ä¸ºçº¿ç¨‹ç»„ï¼›å³ä¸€ä¸ªè¿›ç¨‹å°±æ˜¯æ‰€æœ‰ç›¸å…³çš„çº¿ç¨‹æ„æˆçš„ä¸€ä¸ªçº¿ç¨‹ç»„ã€‚ä¼ ç»Ÿçš„è¿›ç¨‹ç­‰ä»·äºå•çº¿ç¨‹è¿›ç¨‹ã€‚ æ¯ä¸ªçº¿ç¨‹ç»„éƒ½æœ‰è‡ªå·±çš„æ ‡è¯†ç¬¦ tgid (æ•°æ®ç±»å‹ä¸º pid_t )ï¼Œå…¶å€¼ç­‰äºè¯¥è¿›ç¨‹(çº¿ç¨‹ç»„)ä¸­çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹(group_leader)çš„ PIDã€‚ çº¿ç¨‹æ ¹æ®å…¶è°ƒåº¦è€…çš„ä¸åŒå¯ä»¥è¢«åˆ†ä¸ºä¸¤å¤§ç±»ï¼šç”¨æˆ·çº§çº¿ç¨‹ï¼ˆUser-Level Threads, ULTï¼‰å’Œæ ¸å¿ƒçº§çº¿ç¨‹ï¼ˆKernel-Level Threads, KLTï¼‰ã€‚è¿™ä¸¤ç§çº¿ç¨‹åœ¨ç¨‹åºå¹¶å‘æ‰§è¡Œæ—¶ï¼Œå„è‡ªè§£å†³çš„é—®é¢˜å’Œå®ç°çš„æœºåˆ¶å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚ ç”¨æˆ·çº§çº¿ç¨‹ä¸»è¦å…³æ³¨ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆContext Switchingï¼‰çš„é—®é¢˜ã€‚ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æŒ‡ CPU åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´åˆ‡æ¢æ‰§è¡ŒçŠ¶æ€çš„è¿‡ç¨‹ã€‚ç”¨æˆ·çº§çº¿ç¨‹çš„è°ƒåº¦ç®—æ³•å’Œè°ƒåº¦è¿‡ç¨‹å®Œå…¨ç”±ç”¨æˆ·åœ¨åº”ç”¨å±‚å†³å®šï¼Œè¿™æ„å‘³ç€åœ¨è¿è¡Œæ—¶ä¸éœ€è¦å†…æ ¸çš„ç›´æ¥æ”¯æŒã€‚è¿™ç§è®¾è®¡çš„ä¼˜ç‚¹åœ¨äºæé«˜äº†çº¿ç¨‹çš„åˆ›å»ºå’Œåˆ‡æ¢é€Ÿåº¦ï¼Œå› ä¸ºç”¨æˆ·ç©ºé—´çš„æ“ä½œé€šå¸¸æ¯”å†…æ ¸ç©ºé—´çš„æ“ä½œè¦å¿«ã€‚ å¸¸ç”¨çš„å°±æ˜¯è¿™ç±»ç”¨æˆ·çº§çº¿ç¨‹ï¼Œå…¶ä¸­ POSIX æ ‡å‡†æä¾›äº†ä¸€å¥—å®Œæ•´çš„ç”¨æˆ·çº§çº¿ç¨‹æ¥å£ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›åŸºæœ¬çš„çº¿ç¨‹æ“ä½œç›¸å…³å‡½æ•°ï¼š åŸºæœ¬çº¿ç¨‹æ“ä½œç›¸å…³å‡½æ•° çº¿ç¨‹çš„åˆ›å»ºä¸ç»“æŸ çº¿ç¨‹çš„äº’æ–¥ä¸åŒæ­¥ ä½¿ç”¨ä¿¡å·é‡æ§åˆ¶çº¿ç¨‹ çº¿ç¨‹çš„åŸºæœ¬å±æ€§é…ç½® äº’æ–¥ä¸åŒæ­¥æœºåˆ¶åŸºæœ¬å‡½æ•° å‡½æ•° è¯´æ˜ pthread_create() åˆ›å»ºæ–°çš„çº¿ç¨‹å¹¶å¼€å§‹æ‰§è¡Œç›¸å…³çº¿ç¨‹çš„å‡½æ•°ï¼Œè¿è¡Œç»“æŸåçº¿ç¨‹é€€å‡ºã€‚ pthread_exit() ç”¨äºç»“æŸå½“å‰çº¿ç¨‹çš„å‡½æ•°ï¼ŒåŒºåˆ«äº exit()ï¼ˆç»“æŸæ•´ä¸ªè¿›ç¨‹ï¼‰ã€‚ pthread_join() é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰å¾…æŒ‡å®šçº¿ç¨‹ç»“æŸã€‚å¦‚æœç›®æ ‡çº¿ç¨‹å·²ç»“æŸï¼Œåˆ™ç«‹å³è¿”å›ï¼Œè¿”å›å€¼ 0 ä»£è¡¨æˆåŠŸã€‚ pthread_cancel() å‘æŒ‡å®šçº¿ç¨‹å‘é€ç»ˆæ­¢ä¿¡å·ï¼ŒæˆåŠŸè¿”å› 0ï¼Œä½†å¹¶ä¸ä¿è¯çº¿ç¨‹ç«‹å³åœæ­¢ã€‚ pthread_testcancel() åœ¨æ²¡æœ‰å–æ¶ˆç‚¹çš„ä»£ç æ®µä¸­åˆ›å»ºä¸€ä¸ªå–æ¶ˆç‚¹ï¼Œä»¥å…è®¸å“åº”å–æ¶ˆè¯·æ±‚ã€‚ pthread_setcancelstate() è®¾ç½®å½“å‰çº¿ç¨‹å¯¹å–æ¶ˆä¿¡å·çš„ååº”ï¼Œä»¥æ§åˆ¶çº¿ç¨‹ä½•æ—¶å“åº”å–æ¶ˆè¯·æ±‚ã€‚ pthread_setcanceltype() è®¾ç½®å–æ¶ˆçŠ¶æ€ï¼Œå†³å®šçº¿ç¨‹æ˜¯å¦ç«‹å³å–æ¶ˆæˆ–ç­‰åˆ°ä¸‹ä¸€ä¸ªå–æ¶ˆç‚¹å†å–æ¶ˆã€‚ pthread_setcancel() ä¿®æ”¹å½“å‰çº¿ç¨‹çš„å–æ¶ˆçŠ¶æ€ã€‚ äº’æ–¥é”åŸºæœ¬å‡½æ•° å‡½æ•° è¯´æ˜ pthread_mutex_init() åˆå§‹åŒ–äº’æ–¥é”ä»¥ä¿æŠ¤å…±äº«èµ„æºã€‚ pthread_mutex_lock() å°è¯•é”å®šäº’æ–¥é”ï¼Œå¦‚æœäº’æ–¥é”å·²è¢«å…¶ä»–çº¿ç¨‹é”å®šï¼Œåˆ™ä¼šé˜»å¡ç­‰å¾…ã€‚ pthread_mutex_trylock() è¯•å›¾éé˜»å¡åœ°é”å®šäº’æ–¥é”ï¼Œå¦‚æœé”å®šå¤±è´¥åˆ™ç«‹å³è¿”å›é”™è¯¯ã€‚ pthread_mutex_unlock() é‡Šæ”¾äº’æ–¥é”ï¼Œä»¥å…è®¸å…¶ä»–çº¿ç¨‹è®¿é—®è¢«ä¿æŠ¤çš„å…±äº«èµ„æºã€‚ pthread_mutex_destroy() é”€æ¯äº’æ–¥é”ï¼Œé‡Šæ”¾ä¸è¯¥äº’æ–¥é”ç›¸å…³çš„èµ„æºã€‚ ä¿¡å·é‡æ§åˆ¶çº¿ç¨‹çš„åŸºæœ¬å‡½æ•°ï¼ˆé»˜è®¤æ— åä¿¡å·é‡ï¼‰ å‡½æ•° è¯´æ˜ sem_init() åˆå§‹åŒ–ä¸€ä¸ªå®šä½åœ¨æŒ‡å®šåœ°å€çš„åŒ¿åä¿¡å·é‡ã€‚ sem_wait() ä½¿ä¿¡å·é‡å‡ 1ã€‚å¦‚æœä¿¡å·é‡å½“å‰å€¼ä¸º 0ï¼Œåˆ™è¿›å…¥é˜»å¡çŠ¶æ€ã€‚ sem_trywait() å°è¯•éé˜»å¡åœ°å‡å°‘ä¿¡å·é‡å€¼ï¼Œå¦‚æœä¿¡å·é‡å½“å‰å€¼ä¸º 0 åˆ™è¿”å›é”™è¯¯ã€‚ sem_post() å¢åŠ ä¿¡å·é‡çš„å€¼ï¼Œç¡®ä¿åŸå­æ“ä½œã€‚ sem_getvalue() å°†å½“å‰ä¿¡å·é‡çš„å€¼å­˜å‚¨åˆ°æŒ‡å®šçš„æ•´æ•°å˜é‡ä¸­ã€‚ sem_destroy() é”€æ¯æŒ‡å®šçš„åŒ¿åä¿¡å·é‡ï¼Œé‡Šæ”¾ç›¸å…³èµ„æºã€‚ çº¿ç¨‹å±æ€§é…ç½®ç›¸å…³å‡½æ•° å‡½æ•° è¯´æ˜ pthread_attr_init() åˆå§‹åŒ–çº¿ç¨‹å±æ€§å¯¹è±¡ï¼Œå‡†å¤‡è®¾ç½®çº¿ç¨‹çš„å±æ€§ã€‚ pthread_attr_destroy() æ¸…é™¤å·²è®¾ç½®çš„çº¿ç¨‹å±æ€§ï¼Œé‡Šæ”¾èµ„æºã€‚ pthread_attr_setscope() è®¾ç½®çº¿ç¨‹çš„å¯è§æ€§å±æ€§ï¼Œå¯ä»¥æ˜¯ç³»ç»ŸèŒƒå›´æˆ–è€…è¿›ç¨‹èŒƒå›´ã€‚ pthread_attr_setschedparam() è®¾ç½®çº¿ç¨‹çš„è°ƒåº¦å‚æ•°ï¼Œå¦‚çº¿ç¨‹ä¼˜å…ˆçº§ã€‚ pthread_attr_getschedparam() è·å–å½“å‰çº¿ç¨‹çš„è°ƒåº¦å‚æ•°ã€‚ çº¿ç¨‹åˆ›å»ºint pthread_create(pthread_t *thread,const pthread_attr_t *attr,void *(* routine)(void *), void *arg)# å‡½æ•°å‚æ•°# thread ï¼šåˆ›å»ºçš„çº¿ç¨‹ID# attr ï¼šæŒ‡å®šçº¿ç¨‹çš„å±æ€§ï¼ŒNULLè¡¨ç¤ºä½¿ç”¨ç¼ºçœå±æ€§# routine ï¼šçº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°# arg ï¼šä¼ é€’ç»™çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°çš„å‚æ•° åˆ›å»ºæˆåŠŸè¿”å› 0ï¼Œå¦åˆ™è¿”å›-1 routine æ˜¯å›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰ï¼Œå‡½æ•°ç±»å‹ç”±å†…æ ¸æ¥å†³å®šï¼Œè¿™é‡Œå°†åœ°å€ä¼ ç»™å†…æ ¸ï¼› å‡½æ•°å¹¶ä¸æ˜¯çº¿ç¨‹åˆ›å»ºäº†å°±ä¼šæ‰§è¡Œï¼Œè€Œæ˜¯åªæœ‰å½“å…¶è¢«è°ƒåº¦åˆ° cpu ä¸Šæ—¶æ‰ä¼šè¢«æ‰§è¡Œ arg æ˜¯çº¿ç¨‹æ‰§è¡Œå‡½æ•°çš„å‚æ•°ï¼Œï¼Œä½¿ç”¨æ—¶éœ€è¦å…ˆè¿›è¡Œç±»å‹è½¬æ¢ï¼Œæ‰èƒ½ä½¿ç”¨ï¼› å¦‚æœ arg å‚æ•°ä¸æ­¢ä¸€ä¸ªï¼Œå¯ä»¥å°†å…¶æ”¾å…¥åˆ°ç»“æ„ä½“ä¸­ï¼Œä¼ å…¥ç»“æ„ä½“æŒ‡é’ˆï¼› åœ¨è°ƒç”¨ pthread_create() å‡½æ•°åï¼Œå½“å‰çº¿ç¨‹å°†ç»§ç»­æ‰§è¡Œå®ƒçš„ä»»åŠ¡ï¼Œè€Œæ–°åˆ›å»ºçš„çº¿ç¨‹åˆ™ä¼šå¼€å§‹æ‰§è¡ŒæŒ‡å®šçš„çº¿ç¨‹å‡½æ•°ã€‚æ­¤æ—¶ï¼Œä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„æ‰§è¡Œå¹¶ä¸æ˜¯çº¿æ€§é¡ºåºçš„ï¼Œè€Œæ˜¯ç”± Linux çš„å¼‚æ­¥è°ƒåº¦æœºåˆ¶æ¥å†³å®šå“ªä¸ªçº¿ç¨‹åœ¨ä½•æ—¶è¿è¡Œã€‚ çº¿ç¨‹çš„æ‰§è¡Œé¡ºåº åŸçº¿ç¨‹çš„ç»§ç»­æ‰§è¡Œ: åŸçº¿ç¨‹åœ¨è°ƒç”¨ pthread_create() åï¼Œä¸ä¼šåœæ­¢æˆ–ç­‰å¾…æ–°çº¿ç¨‹çš„å»ºç«‹ï¼Œè€Œæ˜¯ç«‹å³æ¢å¤æ‰§è¡Œã€‚è¿™æ„å‘³ç€ï¼Œåœ¨æŸäº›åœºæ™¯ä¸­ï¼ŒåŸçº¿ç¨‹å¯èƒ½ä¼šåœ¨æ–°çº¿ç¨‹ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œéƒ¨åˆ†é€»è¾‘ã€‚ ä¾‹å¦‚ï¼ŒåŸçº¿ç¨‹å¯èƒ½ä¼šç«‹å³è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œæ¯”å¦‚åŠ è½½æ–‡ä»¶ã€è®¾ç½®å…±äº«æ•°æ®ç»“æ„ç­‰ï¼Œè¿™äº›æ“ä½œå¯èƒ½æ˜¯æ–°çº¿ç¨‹æ‰€ä¾èµ–çš„ã€‚ æ–°çº¿ç¨‹çš„å¯åŠ¨: æ–°çº¿ç¨‹åˆ™æ ¹æ®æ“ä½œç³»ç»Ÿçš„è°ƒåº¦ç­–ç•¥ï¼Œå¯èƒ½å¾ˆå¿«æˆ–è€…ç›¸å¯¹è¾ƒæ™šæ‰å¼€å§‹æ‰§è¡Œå…¶çº¿ç¨‹å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç³»ç»Ÿæœ‰è®¸å¤šä»»åŠ¡åœ¨è¿è¡Œï¼Œæ–°çš„çº¿ç¨‹å¯èƒ½åœ¨å…¶åˆ›å»ºåè¿˜éœ€æ’é˜Ÿç­‰å¾…åˆ†é… CPU æ—¶é—´ã€‚ Linux çš„è°ƒåº¦æœºåˆ¶Linux æ“ä½œç³»ç»Ÿä½¿ç”¨æŠ¢å å¼è°ƒåº¦ï¼Œæ„å‘³ç€å³ä½¿ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œï¼Œæ“ä½œç³»ç»Ÿä¹Ÿå¯èƒ½ä¼šä¸­æ–­å®ƒçš„æ‰§è¡Œï¼Œå°† CPU æ—¶é—´ç‰‡åˆ†é…ç»™å…¶ä»–çº¿ç¨‹ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œç¨‹åºæ— æ³•ä¾èµ–äºçº¿ç¨‹æ‰§è¡Œçš„é¡ºåºï¼Œè¿™ç»™å¹¶å‘ç¼–ç¨‹å¸¦æ¥äº†å¤æ‚æ€§ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªåŸçº¿ç¨‹åœ¨åˆ›å»ºåç«‹å³è¿›è¡Œè®¡ç®—ï¼Œè€Œæ–°çº¿ç¨‹è´Ÿè´£å¤„ç†ç”¨æˆ·è¾“å…¥ï¼ŒäºŒè€…çš„æ‰§è¡Œå®Œå…¨ä¾èµ–äºç³»ç»Ÿè°ƒåº¦ã€‚ è¿™ç§ä¸ç¡®å®šæ€§æ„å‘³ç€ï¼Œå¯èƒ½ä¼šå‡ºç°ç«äº‰æ¡ä»¶æˆ–æ­»é”ç­‰é—®é¢˜ã€‚ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œé€šå¸¸ä¼šä½¿ç”¨äº’æ–¥é”ã€ä¿¡å·é‡ç­‰åŒæ­¥æœºåˆ¶æ¥åè°ƒçº¿ç¨‹ä¹‹é—´çš„æ‰§è¡Œé¡ºåºå’Œæ•°æ®å…±äº«ã€‚ å› æ­¤ï¼Œåœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œç¡®ä¿çº¿ç¨‹é—´çš„æ­£ç¡®åä½œå’Œèµ„æºçŠ¶æ€çš„ç®¡ç†è‡³å…³é‡è¦ã€‚ çº¿ç¨‹å±æ€§const pthread_attr_t *attr; åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œçº¿ç¨‹å±æ€§ï¼ˆpthread_attr_tï¼‰ç”¨äºå®šä¹‰åˆ›å»ºçº¿ç¨‹æ—¶çš„å¤šç§å‚æ•°ã€‚è¿™äº›å±æ€§å¯ä»¥å½±å“çº¿ç¨‹çš„è°ƒåº¦ä¼˜å…ˆçº§ã€æ ˆå¤§å°ã€æ˜¯å¦åˆ†ç¦»ç­‰ç‰¹æ€§ã€‚é€šè¿‡ä½¿ç”¨çº¿ç¨‹å±æ€§ï¼Œå¯ä»¥åœ¨åˆ›å»ºçº¿ç¨‹ä¹‹å‰ï¼Œç²¾ç¡®åœ°æ§åˆ¶çº¿ç¨‹çš„è¡Œä¸ºï¼Œæ»¡è¶³ç‰¹å®šçš„åº”ç”¨éœ€æ±‚ã€‚ ä¸»è¦å±æ€§ æ ˆå¤§å°ï¼ˆStack Sizeï¼‰çº¿ç¨‹çš„æ ˆä¸ºçº¿ç¨‹æ‰§è¡Œæ‰€éœ€çš„å±€éƒ¨å˜é‡å’Œå‡½æ•°è°ƒç”¨å‡†å¤‡äº†å­˜å‚¨ç©ºé—´ã€‚å¦‚æœæ ˆå¤ªå°ï¼Œå¯èƒ½å¯¼è‡´æ ˆæº¢å‡ºï¼Œç¨‹åºå´©æºƒã€‚å¯ä»¥ä½¿ç”¨ pthread_attr_setstacksize å‡½æ•°æ¥æŒ‡å®šä¸€ä¸ªåˆé€‚çš„æ ˆå¤§å°ï¼Œä¾‹å¦‚ï¼š pthread_attr_setstacksize(attr, 1024 * 1024); // è®¾ç½®æ ˆå¤§å°ä¸º1MB è°ƒåº¦ç­–ç•¥å’Œä¼˜å…ˆçº§ï¼ˆScheduling Policy and Priorityï¼‰è°ƒåº¦ç­–ç•¥ç¡®å®šäº†çº¿ç¨‹çš„è¿è¡Œé¡ºåºï¼Œä¾‹å¦‚ FIFOã€è½®è¯¢ç­‰ã€‚é€šè¿‡ pthread_attr_setschedpolicy å’Œ pthread_attr_setschedparam å¯ä»¥è®¾ç½®è¿™äº›å‚æ•°ï¼Œä»¥ä¾¿åœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹ä¼˜åŒ–æ€§èƒ½ã€‚ä¾‹å¦‚ï¼š struct sched_param sched_param;sched_param.sched_priority = 20; // è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§ä¸º20pthread_attr_setschedparam(attr, sched_param); çº¿ç¨‹åˆ†ç¦»çŠ¶æ€ï¼ˆDetach Stateï¼‰çº¿ç¨‹å¯ä»¥è¢«è®¾ç½®ä¸ºåˆ†ç¦»çŠ¶æ€ï¼Œè¿™æ„å‘³ç€å®ƒè¿è¡Œåå°±ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹è”åˆï¼ˆjoinï¼‰ï¼Œèµ„æºä¼šåœ¨ç»“æŸåè‡ªåŠ¨å›æ”¶ã€‚å¯ä»¥é€šè¿‡ pthread_attr_setdetachstate æ¥å¯ç”¨åˆ†ç¦»çŠ¶æ€ã€‚ä¸¾ä¸ªä¾‹å­ï¼š pthread_attr_setdetachstate(attr, PTHREAD_CREATE_DETACHED); // è®¾ç½®ä¸ºåˆ†ç¦»çŠ¶æ€ ä¿¡å·å±è”½ï¼ˆSignal Maskï¼‰çº¿ç¨‹å±æ€§è¿˜å…è®¸è®¾ç½®çº¿ç¨‹çš„ä¿¡å·å±è”½å­—ï¼Œä»è€Œæ§åˆ¶çº¿ç¨‹åœ¨æ‰§è¡ŒæœŸé—´æ¥æ”¶å“ªäº›ä¿¡å·ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢åœ¨å¤„ç†æŸäº›å…³é”®ä»»åŠ¡æ—¶è¢«ä¸­æ–­ã€‚ç›¸å…³å‡½æ•°ä¸º pthread_sigmaskã€‚ ä½¿ç”¨ç¤ºä¾‹åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œå¯ä»¥å°†å±æ€§ç»“æ„ä½“ä¼ å…¥çº¿ç¨‹åˆ›å»ºå‡½æ•°ï¼Œè¿™æ ·ç¡®ä¿æ–°çº¿ç¨‹ç»§æ‰¿äº†é¢„è®¾çš„å±æ€§ã€‚ä¾‹å¦‚ï¼š pthread_t thread;pthread_attr_t attr;pthread_attr_init(attr); // åˆå§‹åŒ–å±æ€§å¯¹è±¡pthread_attr_setstacksize(attr, 1024 * 1024); // è®¾ç½®æ ˆå¤§å°ä¸º1MBpthread_create(thread, attr, thread_func, NULL); // åˆ›å»ºçº¿ç¨‹ï¼ŒæŒ‡å®šå±æ€§pthread_attr_destroy(attr); // çº¿ç¨‹åˆ›å»ºåï¼Œé”€æ¯å±æ€§å¯¹è±¡ çº¿ç¨‹ç®¡ç†åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œçº¿ç¨‹ç®¡ç†æ˜¯ç¡®ä¿å„ä¸ªçº¿ç¨‹æœ‰æ•ˆåä½œçš„å…³é”®éƒ¨åˆ†ã€‚ä¸è¿›ç¨‹ç®¡ç†ä¸­çš„ exit() å’Œ wait() å‡½æ•°ç›¸ä¼¼ï¼Œpthread_join å’Œ pthread_exit ä¹Ÿåœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´èµ·åˆ°åè°ƒä½œç”¨ã€‚ pthread_joinpthread_join å‡½æ•°ç”¨äºåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„ç»“æŸã€‚å®ƒçš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š pthread_join(thread, [çº¿ç¨‹è¿”å›çš„å‚æ•°]); è¿™é‡Œçš„ thread å‚æ•°æ˜¯ä¸€ä¸ªçº¿ç¨‹çš„æ ‡è¯†ç¬¦ï¼Œé€šå¸¸åœ¨åˆ›å»ºçº¿ç¨‹æ—¶ä½¿ç”¨ pthread_create å‡½æ•°è·å¾—ã€‚è°ƒç”¨ pthread_join çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æŒ‡å®šçš„çº¿ç¨‹ç»“æŸè¿è¡Œä¸ºæ­¢ã€‚è¿™å¯ä»¥ç¡®ä¿åœ¨è¿›è¡Œçº¿ç¨‹é—´çš„æ•°æ®å…±äº«æ—¶ï¼Œåªæœ‰åœ¨ç›¸å…³çº¿ç¨‹å®Œæˆå…¶ä»»åŠ¡æ—¶ï¼Œä¸»çº¿ç¨‹æˆ–å…¶ä»–çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªçº¿ç¨‹è´Ÿè´£è®¡ç®—æ•°æ®ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹éœ€è¦è·å–è¿™ä¸ªè®¡ç®—ç»“æœã€‚å¦‚æœæ²¡æœ‰é€‚å½“çš„åŒæ­¥ï¼Œè·å–çš„ç»“æœå¯èƒ½æ˜¯æ— æ•ˆçš„ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…·ä½“ç¤ºä¾‹ï¼š #include pthread.h#include stdio.hvoid* calculate(void* arg) int result = 42; // æ¨¡æ‹Ÿçš„è®¡ç®—ç»“æœ pthread_exit((void*)result); // ç»“æŸçº¿ç¨‹å¹¶è¿”å›ç»“æœint main() pthread_t thread; int rc; int result; // åˆ›å»ºçº¿ç¨‹ rc = pthread_create(thread, NULL, calculate, NULL); if (rc) printf(Error creating thread ); return -1; // ç­‰å¾…çº¿ç¨‹ç»“æŸå¹¶è·å–è¿”å›å€¼ pthread_join(thread, (void**)result); printf(The result is %d , result); // è¾“å‡ºè®¡ç®—ç»“æœ return 0; pthread_exitpthread_exit å‡½æ•°ç”¨äºç»ˆæ­¢å½“å‰çº¿ç¨‹çš„æ‰§è¡Œï¼Œå¹¶å…è®¸çº¿ç¨‹è¿”å›ä¸€ä¸ªå€¼ï¼Œä¾›å…¶ä»–çº¿ç¨‹è®¿é—®å’Œä½¿ç”¨ã€‚è¯¥å‡½æ•°çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š pthread_exit([çº¿ç¨‹è¿”å›çš„å‚æ•°]); è°ƒç”¨ pthread_exit æ—¶ï¼Œçº¿ç¨‹ä¸ä¼šç«‹å³ç»ˆæ­¢ã€‚å…·ä½“æ¥è¯´ï¼Œè°ƒç”¨æ­¤å‡½æ•°çš„çº¿ç¨‹ä¼šç»“æŸå…¶æ´»åŠ¨è¿‡ç¨‹ï¼Œå¹¶å°†æ§åˆ¶æƒè¿”å›ç»™è°ƒåº¦å™¨ã€‚è¿™ä¸€è®¾è®¡ä½¿å¾—ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å®‰å…¨åœ°å°†æ‰§è¡Œç»“æœä¼ é€’ç»™å…¶ä»–çº¿ç¨‹ï¼Œä»è€Œä¿ƒè¿›çº¿ç¨‹ä¹‹é—´çš„æ•°æ®å…±äº«å’Œåä½œã€‚ ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼š void* calculate(void* arg) int result = 42; // å‡è®¾è®¡ç®—ç»“æœä¸º42 pthread_exit((void*)result);int main() pthread_t tid; pthread_create(tid, NULL, calculate, NULL); void* retval; pthread_join(tid, retval); printf(è®¡ç®—ç»“æœ: %d , (int)retval); return 0; åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œcalculate å‡½æ•°é€šè¿‡ pthread_exit è¿”å›è®¡ç®—çš„ç»“æœ 42ã€‚ä¸»çº¿ç¨‹ä½¿ç”¨ pthread_join å‡½æ•°ç­‰å¾… calculate çº¿ç¨‹ç»“æŸï¼Œå¹¶è·å–å…¶è¿”å›å€¼ã€‚è¿™æ ·ï¼Œä¸»çº¿ç¨‹å°±å¯ä»¥å¤„ç†è®¡ç®—ç»“æœï¼Œç¡®ä¿æ•´ä¸ªç¨‹åºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æœ‰åºè¿›è¡Œã€‚ åˆç†åœ°åº”ç”¨ pthread_join å’Œ pthread_exit å¯ä»¥æœ‰æ•ˆé¿å…æ•°æ®ç«äº‰æƒ…å†µï¼Œä¾‹å¦‚å½“å¤šä¸ªçº¿ç¨‹å°è¯•è®¿é—®å’Œä¿®æ”¹å…±äº«æ•°æ®æ—¶ï¼Œå¯èƒ½é€ æˆä¸å¯é¢„æœŸçš„ç»“æœã€‚å¦å¤–ï¼Œåˆç†çš„çº¿ç¨‹ç®¡ç†èƒ½å¤Ÿå‡å°‘èµ„æºæµªè´¹ï¼Œæå‡ç¨‹åºçš„æ€§èƒ½ã€‚åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ä¿æŒè‰¯å¥½çš„åè°ƒå¯ä»¥æé«˜ç³»ç»Ÿçš„æ•´ä½“æ•ˆç‡ï¼Œå®ç°èµ„æºçš„æœ€ä½³ä½¿ç”¨ã€‚ pthread_cancelpthread_cancel æ˜¯ POSIX çº¿ç¨‹ï¼ˆPthreadsï¼‰åº“ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œä¸»è¦ç”¨äºè¯·æ±‚å–æ¶ˆä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€‚å®ƒçš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š int pthread_cancel(pthread_t thread); å‚æ•° threadï¼šè¿™æ˜¯è¦å–æ¶ˆçš„ç›®æ ‡çº¿ç¨‹çš„æ ‡è¯†ç¬¦ï¼Œé€šå¸¸æ˜¯é€šè¿‡ pthread_create åˆ›å»ºçº¿ç¨‹æ—¶è¿”å›çš„ pthread_t å€¼ã€‚ è¿”å›å€¼ è¿”å› 0 è¡¨ç¤ºæˆåŠŸã€‚ è¿”å›é”™è¯¯ä»£ç ï¼Œè¡¨ç¤ºå–æ¶ˆå¤±è´¥ï¼Œå¸¸è§é”™è¯¯åŒ…æ‹¬ï¼š ESRCHï¼šæŒ‡å®šçš„çº¿ç¨‹ä¸å­˜åœ¨ã€‚ EINVALï¼šçº¿ç¨‹æ ‡è¯†ç¬¦æ— æ•ˆã€‚ å·¥ä½œåŸç†å½“è°ƒç”¨ pthread_cancel å–æ¶ˆæŸä¸ªçº¿ç¨‹æ—¶ï¼Œè¿™å¹¶ä¸ä¼šç«‹å³ç»ˆæ­¢çº¿ç¨‹çš„æ‰§è¡Œã€‚ç›¸åï¼Œå®ƒå‘ç›®æ ‡çº¿ç¨‹å‘é€ä¸€ä¸ªå–æ¶ˆè¯·æ±‚ã€‚ç›®æ ‡çº¿ç¨‹ä¼šæ£€æŸ¥å…¶å–æ¶ˆçŠ¶æ€ï¼Œä»¥å†³å®šæ˜¯å¦å“åº”è¿™ä¸€è¯·æ±‚ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹çš„å–æ¶ˆçŠ¶æ€æ˜¯å¯ç”¨çš„ï¼Œä½†å¯ä»¥é€šè¿‡ pthread_setcancelstate å‡½æ•°ä¿®æ”¹ã€‚ çº¿ç¨‹çš„å–æ¶ˆç±»å‹çº¿ç¨‹çš„å“åº”æ–¹å¼å–å†³äºçº¿ç¨‹çš„å–æ¶ˆç±»å‹ã€‚ä¸»è¦æœ‰ä¸¤ç§ç±»å‹ï¼š å¼‚æ­¥å–æ¶ˆï¼ˆASYNCHRONOUSï¼‰ï¼šä¸€æ—¦è¯·æ±‚è¢«å‘é€ï¼Œçº¿ç¨‹ä¼šåœ¨ä¸‹ä¸€ä¸ªå–æ¶ˆç‚¹ç«‹å³è¢«ç»ˆæ­¢ã€‚é€šè¿‡ pthread_setcanceltype è®¾ç½®ä¸º PTHREAD_CANCEL_ASYNCHRONOUSã€‚ çº¿ç¨‹å–æ¶ˆç‚¹ï¼ˆDEFERREDï¼‰ï¼šçº¿ç¨‹ä¼šåœ¨è®¾å®šçš„å–æ¶ˆç‚¹ä¸Šæ£€æŸ¥æ˜¯å¦éœ€è¦è¢«å–æ¶ˆã€‚è¿™äº›å–æ¶ˆç‚¹å¯ä»¥æ˜¯ç³»ç»Ÿè°ƒç”¨ã€pthread_testcancelã€pthread_join ç­‰ã€‚è¿™æ˜¯é»˜è®¤è®¾ç½®ï¼Œå‡å°‘äº†çº¿ç¨‹è¢«éé¢„æœŸå–æ¶ˆçš„é£é™©ã€‚ å–æ¶ˆç‚¹ç¤ºä¾‹ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è®¾å®šå–æ¶ˆç‚¹ï¼š #include stdio.h#include stdlib.h#include pthread.h#include unistd.hvoid *thread_function(void *arg) while (1) printf(Thread is running... ); // è®¾ç½®ä¸€ä¸ªå–æ¶ˆç‚¹ pthread_testcancel(); // æ£€æŸ¥å–æ¶ˆè¯·æ±‚ sleep(1); // æ¨¡æ‹Ÿçº¿ç¨‹å·¥ä½œ int main() pthread_t thread; pthread_create(thread, NULL, thread_function, NULL); sleep(3); // è®©çº¿ç¨‹è¿è¡Œä¸€æ®µæ—¶é—´ pthread_cancel(thread); // è¯·æ±‚å–æ¶ˆçº¿ç¨‹ pthread_join(thread, NULL); // ç­‰å¾…çº¿ç¨‹ç»“æŸ printf(Thread has been cancelled. ); return 0; åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªå¾ªç¯ï¼Œä¸æ–­æ‰“å°ä¿¡æ¯ã€‚åœ¨å¾ªç¯çš„æ¯ä¸€è½®ä¸­ï¼Œpthread_testcancel ä¼šæ£€æŸ¥æ˜¯å¦æ”¶åˆ°äº†å–æ¶ˆè¯·æ±‚ã€‚å¦‚æœæ”¶åˆ°äº†è¯·æ±‚ï¼Œçº¿ç¨‹å°†å®‰å…¨åœ°ç»ˆæ­¢æ‰§è¡Œã€‚ ä½¿ç”¨æ³¨æ„äº‹é¡¹ ä¸åº”å½“åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…è°ƒç”¨ pthread_cancel æ¥å–æ¶ˆè‡ªå·±ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸ç¡®å®šçš„è¡Œä¸ºã€‚ åœ¨è®¾è®¡ç¨‹åºæ—¶ï¼Œåº”è¯¥è€ƒè™‘è‰¯å¥½çš„çº¿ç¨‹èµ„æºç®¡ç†ï¼Œç¡®ä¿é¿å…æ³„éœ²å’Œç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚ å°½é‡ä½¿ç”¨èµ„æºæ¸…ç†æœºåˆ¶ï¼Œä¾‹å¦‚ pthread_cleanup_push å’Œ pthread_cleanup_popï¼Œåœ¨å–æ¶ˆè¯·æ±‚å‘ç”Ÿæ—¶æ¸…ç†èµ„æºã€‚ çº¿ç¨‹å‡½æ•°å‚æ•°çš„ä¼ é€’åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œçº¿ç¨‹èƒ½å¤Ÿå¹¶è¡Œæ‰§è¡Œä»»åŠ¡ï¼Œæå‡ç¨‹åºçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚ç„¶è€Œï¼Œä¸ºäº†è®©æ¯ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ¥æ”¶åˆ°ç›¸åº”çš„å‚æ•°ï¼Œåˆç†åœ°ä¼ é€’çº¿ç¨‹å‡½æ•°å‚æ•°è‡³å…³é‡è¦ã€‚ å‚æ•°ä¼ é€’çš„å‡ ç§æ–¹å¼ç›´æ¥ä¼ é€’æŸäº›ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶æ”¯æŒåœ¨åˆ›å»ºçº¿ç¨‹æ—¶ç›´æ¥ä¼ é€’å‚æ•°ã€‚ä¾‹å¦‚ï¼Œåœ¨ Python çš„ threading æ¨¡å—ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ args å‚æ•°æ¥ä¼ é€’ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«çº¿ç¨‹å‡½æ•°æ‰€éœ€çš„æ‰€æœ‰å‚æ•°ã€‚ import threadingdef worker(num): print(fWorker: num)# åˆ›å»ºçº¿ç¨‹ï¼Œå¹¶ä¼ é€’å‚æ•°thread = threading.Thread(target=worker, args=(1,))thread.start() åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ•°å­— 1 è¢«ä¼ é€’ç»™çº¿ç¨‹å‡½æ•° workerï¼Œçº¿ç¨‹åœ¨æ‰§è¡Œæ—¶ä¼šè¾“å‡º Worker: 1ã€‚ ä½¿ç”¨ç±»æˆ–ç»“æ„ä½“åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¼ é€’å¤šä¸ªå‚æ•°å¯èƒ½ä¼šæ¯”è¾ƒç¹çã€‚è¿™æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªç±»ã€ç»“æ„ä½“æˆ–å­—å…¸æ¥å°è£…å‚æ•°ç»„ã€‚ä¾‹å¦‚ï¼Œåœ¨ C++ ä¸­ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼š #include iostream#include threadstruct ThreadData int value; std::string message;;void threadFunction(ThreadData data) std::cout data.message data.value std::endl;int main() ThreadData data = 42, Value is:; std::thread t(threadFunction, data); t.join(); åœ¨è¯¥ç¤ºä¾‹ä¸­ï¼Œç»“æ„ä½“ ThreadData å°†ä¸¤ä¸ªå‚æ•°å°è£…åœ¨ä¸€èµ·ï¼Œä¼ é€’ç»™çº¿ç¨‹å‡½æ•°ä¾¿äºç®¡ç†å’Œä½¿ç”¨ã€‚ å…±äº«å…¨å±€å˜é‡å…¨å±€å˜é‡ä¹Ÿæ˜¯å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«çš„å‚æ•°ä¼ é€’æ–¹å¼ã€‚è™½ç„¶ä½¿ç”¨å…¨å±€å˜é‡æ¯”è¾ƒç®€å•ï¼Œå´å¯èƒ½å¼•å‘æ•°æ®ç«äº‰å’Œä¸€è‡´æ€§é—®é¢˜ï¼Œå› æ­¤é€šå¸¸éœ€è¦ä½¿ç”¨é”ï¼ˆä¾‹å¦‚äº’æ–¥é‡ï¼‰æ¥ä¿æŠ¤æ•°æ®ï¼š import threading# å…¨å±€å˜é‡count = 0lock = threading.Lock()def increment(): global count for _ in range(100000): with lock: count += 1# åˆ›å»ºå¤šä¸ªçº¿ç¨‹threads = [threading.Thread(target=increment) for _ in range(10)]for thread in threads: thread.start()for thread in threads: thread.join()print(fTotal count: count) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨é”ç¡®ä¿åœ¨è‡ªå¢æ“ä½œä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ›´æ”¹ count å˜é‡ï¼Œé¿å…æ•°æ®ç«äº‰çš„é£é™©ã€‚ å‚æ•°ä¼ é€’çš„æ³¨æ„äº‹é¡¹ ä¸Šä¸‹æ–‡å…³è”ï¼šç¡®ä¿ä¼ é€’ç»™çº¿ç¨‹çš„å‚æ•°åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…æ˜¯æœ‰æ•ˆçš„ï¼›ç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨å±€éƒ¨å˜é‡æ—¶ï¼Œé¿å…åœ¨å‡½æ•°è¿”å›åçº¿ç¨‹ä»ç„¶è®¿é—®è¿™äº›å˜é‡ã€‚ æ€§èƒ½è€ƒè™‘ï¼šè¿‡å¤šçš„å‚æ•°ä¼ é€’ï¼Œç‰¹åˆ«æ˜¯å¤§å‹æ•°æ®ç»“æ„ï¼Œä¼šå¢åŠ å¼€é”€ã€‚å°½é‡åªä¼ é€’å¿…è¦çš„ä¿¡æ¯ã€‚ é€šè¿‡ä¸Šè¿°å‡ ç§æ–¹å¼ï¼Œçº¿ç¨‹å‡½æ•°çš„å‚æ•°å¯ä»¥æ–¹ä¾¿è€Œå®‰å…¨åœ°ä¼ é€’ï¼Œç¡®ä¿å¤šçº¿ç¨‹ç¨‹åºçš„ç¨³å®šè¿è¡Œä¸æ€§èƒ½ä¼˜åŒ–ã€‚é€‰æ‹©åˆé€‚çš„æ–¹å¼ä¸ä»…èƒ½å¤Ÿç®€åŒ–ä»£ç ï¼Œè¿˜èƒ½é™ä½æ½œåœ¨çš„é”™è¯¯é£é™©ã€‚ åŒæ­¥å’Œäº’æ–¥ä¸´ç•Œèµ„æºï¼šæŸäº›èµ„æºæ¥è¯´ï¼Œå…¶åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€æ®µæœºå™¨æŒ‡ä»¤åºåˆ—æ‰€å ç”¨ã€‚è¿™äº›ä¸€æ¬¡åªèƒ½è¢«ä¸€æ®µæŒ‡ä»¤åºåˆ—æ‰€å ç”¨çš„èµ„æºå°±æ˜¯æ‰€è°“çš„ä¸´ç•Œèµ„æºã€‚ ä¸´ç•ŒåŒºï¼šå¯¹äºä¸´ç•Œèµ„æºçš„è®¿é—®ï¼Œå¿…é¡»æ˜¯äº’æ–¥è¿›è¡Œã€‚ä¹Ÿå°±æ˜¯å½“ä¸´ç•Œèµ„æºè¢«ä¸€ä¸ªæŒ‡ä»¤åºåˆ—å ç”¨æ—¶ï¼Œå¦ä¸€ä¸ªéœ€è¦è®¿é—®ç›¸åŒä¸´ç•Œèµ„æºçš„æŒ‡ä»¤åºåˆ—å°±ä¸èƒ½è¢«æ‰§è¡Œã€‚æŒ‡ä»¤åºåˆ—ä¸èƒ½æ‰§è¡Œçš„å®é™…æ„æ€å°±æ˜¯å…¶æ‰€åœ¨çš„è¿›ç¨‹çº¿ç¨‹ä¼šè¢«é˜»å¡ã€‚æ‰€ä»¥å®šä¹‰ç¨‹åºå†…è®¿é—®ä¸´ç•Œèµ„æºçš„ä»£ç åºåˆ—è¢«ç§°ä¸ºä¸´ç•ŒåŒºã€‚ äº’æ–¥ï¼šæ˜¯æŒ‡åŒäº‹åªå…è®¸ä¸€ä¸ªè®¿é—®è€…å¯¹ä¸´ç•Œèµ„æºè¿›è¡Œè®¿é—®ï¼Œå…·æœ‰å”¯ä¸€æ€§å’Œæ’å®ƒæ€§ã€‚ä½†äº’æ–¥æ— æ³•é™åˆ¶è®¿é—®è¿™ä¸ªå¯¹èµ„æºçš„è®¿é—®é¡ºåºï¼Œå³è®¿é—®æ—¶æ— åºçš„ã€‚ åŒæ­¥ï¼šæ˜¯æŒ‡åœ¨äº’æ–¥çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡å…¶ä»–æœºåˆ¶å®ç°è®¿é—®è€…å¯¹èµ„æºçš„æœ‰åºè®¿é—®ã€‚ çº¿ç¨‹é—´äº’æ–¥å¼•å…¥äº’æ–¥(mutual exlusion)é”çš„ç›®çš„æ˜¯ç”¨æ¥ä¿è¯å…±äº«æ•°æ®çš„å®Œæ•´æ€§ã€‚ äº’æ–¥é”ä¸»è¦ç”¨æ¥ä¿æŠ¤ä¸´ç•Œèµ„æºã€‚æ¯ä¸ªä¸´ç•Œèµ„æºéƒ½æœ‰ä¸€ä¸ªäº’æ–¥é”æ¥ä¿æŠ¤ï¼Œä»»ä½•æ—¶åˆ»æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®è¯¥èµ„æºï¼›çº¿ç¨‹å¿…é¡»å…ˆè·å¾—äº’æ–¥é”æ‰èƒ½è®¿é—®ä¸´ç•Œèµ„æºï¼Œè®¿é—®å®Œèµ„æºåé‡Šæ”¾è¯¥é”ã€‚å¦‚æœæ— æ³•è·å¾—é”ï¼Œçº¿ç¨‹ä¼šé˜»å¡ç›´åˆ°è·å¾—é”ä¸ºæ­¢ï¼› é€šå¸¸ï¼Œåœ¨ä¸´ç•ŒåŒºå‰ä¸Šé”ï¼Œä¸´ç•ŒåŒºåè§£é”ï¼› //åˆå§‹åŒ–äº’æ–¥é”int pthread_mutex_init (pthread_mutex_t *mutex, pthread_mutexattr_t *attr )//ç”³è¯·äº’æ–¥é”int pthread_mutex_lock(pthread_mutex_t *mutex)//é‡Šæ”¾äº’æ–¥é”int pthread_mutex_unlock(pthread_mutex_t *mutex) åŒæ­¥åŒæ­¥(synchronization) æŒ‡çš„æ˜¯å¤šä¸ªä»»åŠ¡ï¼ˆçº¿ç¨‹ï¼‰æŒ‰ç…§çº¦å®šçš„é¡ºåºç›¸äº’é…åˆå®Œæˆä¸€ä»¶äº‹æƒ…ï¼›çº¿ç¨‹é—´åŒæ­¥â€”â€”P V æ“ä½œ ä¿¡å·é‡ä¿¡å·é‡æ˜¯ä¸€ç§é‡è¦çš„åŒæ­¥æœºåˆ¶ï¼Œç”¨äºç®¡ç†æŸä¸€ç±»èµ„æºçš„è®¿é—®ã€‚ä¿¡å·é‡çš„å€¼ä»£è¡¨ç³»ç»Ÿä¸­è¯¥èµ„æºçš„å½“å‰å¯ç”¨æ•°é‡ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæ‰“å°ä»»åŠ¡çš„ç³»ç»Ÿä¸­ï¼Œä¿¡å·é‡å¯ä»¥ç”¨æ¥è¡¨ç¤ºå¯ç”¨æ‰“å°æœºçš„æ•°é‡ã€‚è‹¥å€¼ä¸º 3ï¼Œæ„å‘³ç€ç³»ç»Ÿä¸­æœ‰ä¸‰å°æ‰“å°æœºå¯ä»¥è¢«ä»»åŠ¡ä½¿ç”¨ã€‚ ä¿¡å·é‡æ˜¯ä¸€ä¸ªå—ä¿æŠ¤çš„å˜é‡ï¼Œå…¶è®¿é—®ä»…é™äºä»¥ä¸‹ä¸‰ç§æ“ä½œï¼š åˆå§‹åŒ–ä¿¡å·é‡int sem_init (sem_t *sem,int pshared,unsigned int value) å‡½æ•°å‚æ•° semï¼šè¦åˆå§‹åŒ–çš„ä¿¡å·é‡ã€‚ psharedï¼šæŒ‡ç¤ºä¿¡å·é‡çš„å…±äº«èŒƒå›´ã€‚å½“å€¼ä¸º 0 æ—¶è¡¨ç¤ºä¿¡å·é‡ä¾›çº¿ç¨‹é—´ä½¿ç”¨ï¼›å½“å€¼éé›¶æ—¶ï¼Œè¡¨ç¤ºä¿¡å·é‡ä¾›è¿›ç¨‹é—´ä½¿ç”¨ã€‚ valueï¼šä¿¡å·é‡çš„åˆå§‹å€¼ï¼Œè¡¨ç¤ºå¯ç”¨èµ„æºçš„æ•°é‡ã€‚ å‡½æ•°è¿”å›å€¼ æˆåŠŸæ—¶è¿”å› 0ã€‚ å‡ºé”™æ—¶è¿”å› -1ã€‚ ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œåˆå§‹è®¾ç½®ä¸€ä¸ªä¿¡å·é‡ sem è¡¨ç¤ºæœ‰ 2 å°èµ„æºå¯ç”¨ï¼š sem_init(sem, 0, 2); P æ“ä½œï¼ˆç”³è¯·èµ„æºï¼‰P æ“ä½œç”¨äºç”³è¯·èµ„æºï¼Œé€šå¸¸è¢«ç§°ä¸º sem_waitã€‚ int sem_wait (sem_t *sem) å‡½æ•°å‚æ•° semï¼šè¦ç­‰å¾…çš„ä¿¡å·é‡ã€‚ å‡½æ•°è¿”å›å€¼ æˆåŠŸæ—¶è¿”å› 0ã€‚ å‡ºé”™æ—¶è¿”å› -1ã€‚ æ“ä½œé€»è¾‘å¦‚æœä¿¡å·é‡çš„å€¼å¤§äº 0ï¼Œä»»åŠ¡å¯ä»¥ç»§ç»­è¿è¡Œï¼ŒåŒæ—¶ä¿¡å·é‡çš„å€¼å‡ä¸€ã€‚å¦‚æœä¿¡å·é‡çš„å€¼ä¸º 0ï¼Œè¡¨ç¤ºæ²¡æœ‰èµ„æºå¯ç”¨ï¼Œç›¸å…³ä»»åŠ¡å°†è¢«é˜»å¡ï¼Œç­‰å¾…èµ„æºçš„é‡Šæ”¾ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒæŸä¸ªçº¿ç¨‹å°è¯•æ‰“å°æ–‡æ¡£ï¼Œåœ¨ä¿¡å·é‡çš„å€¼å¤§äº 0 çš„æƒ…å†µä¸‹ï¼Œä»»åŠ¡å°†ç»§ç»­æ‰§è¡Œå¹¶è°ƒç”¨æ‰“å°æœºï¼Œå½“èµ„æºè¢«ä½¿ç”¨åï¼Œä¿¡å·é‡å‡ä¸€ã€‚ if (sem_wait(sem) == 0) // ç»§ç»­æ‰§è¡Œæ‰“å°ä»»åŠ¡ V æ“ä½œï¼ˆé‡Šæ”¾èµ„æºï¼‰V æ“ä½œç”¨äºé‡Šæ”¾èµ„æºï¼Œå¸¸è¢«ç§°ä¸º sem_postã€‚ int sem_post(sem_t *sem) å‡½æ•°å‚æ•° semï¼šè¦é‡Šæ”¾çš„ä¿¡å·é‡ã€‚ å‡½æ•°è¿”å›å€¼ æˆåŠŸæ—¶è¿”å› 0ã€‚ å‡ºé”™æ—¶è¿”å› -1ã€‚ æ“ä½œé€»è¾‘å¦‚æœæ²¡æœ‰ä»»åŠ¡åœ¨ç­‰å¾…è¯¥èµ„æºï¼Œä¿¡å·é‡çš„å€¼å°†å¢åŠ ä¸€ï¼Œè¡¨ç¤ºèµ„æºå¯ç”¨çš„æ•°é‡å¢åŠ ã€‚å¦‚æœæœ‰ä»»åŠ¡åœ¨ç­‰å¾…ï¼Œç³»ç»Ÿä¼šå”¤é†’ç¬¬ä¸€ä¸ªç­‰å¾…çš„ä»»åŠ¡ï¼Œè®©å…¶ç»§ç»­è¿è¡Œã€‚ä¾‹å¦‚ï¼Œåœ¨å®Œæˆæ‰“å°ä»»åŠ¡åï¼Œç›¸å…³çº¿ç¨‹ä¼šè°ƒç”¨ sem_post é‡Šæ”¾èµ„æºï¼Œä¿¡å·é‡çš„å€¼å°†åŠ ä¸€ï¼Œå¹¶ä¸”å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹åœ¨ç­‰å¾…èµ„æºï¼Œè¯¥çº¿ç¨‹ä¼šè¢«å”¤é†’ç»§ç»­æ‰§è¡Œã€‚ sem_post(sem); // é‡Šæ”¾èµ„æºï¼Œç”¨äºç­‰å¾…çš„ä»»åŠ¡å¯ç»§ç»­æ‰§è¡Œ é€šè¿‡è¿™ä¸‰ç§æ“ä½œï¼Œä¿¡å·é‡æœ‰æ•ˆåœ°å¸®åŠ©åè°ƒå¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ•ˆç‡ã€‚ æ¡ä»¶å˜é‡ç®€ä»‹æ¡ä»¶å˜é‡æ˜¯ä¸€ç§ç”¨äºçº¿ç¨‹é—´åŒæ­¥çš„æœºåˆ¶ï¼Œä¸»è¦ä¾èµ–äºä¸¤ä¸ªåŸºæœ¬åŠ¨ä½œï¼šä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…â€æ¡ä»¶å˜é‡çš„æ¡ä»¶æˆç«‹â€è€Œé˜»å¡ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹åˆ™é€šè¿‡å‘å‡ºä¿¡å·æ¥é€šçŸ¥æ¡ä»¶å·²æˆç«‹ã€‚è¿™ç§æœºåˆ¶æœ‰æ•ˆåœ°é˜²æ­¢äº†çº¿ç¨‹é—´çš„ç«äº‰ï¼ˆRace Conditionï¼‰ï¼Œç¡®ä¿äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å®‰å…¨æ€§ä¸æ•ˆç‡ã€‚ æ¡ä»¶å˜é‡çš„ç›¸å…³åè¯ ä¸­æ–‡å: å¤šçº¿ç¨‹çš„æ¡ä»¶å˜é‡ å¤–æ–‡å: pthread_cond_wait ä¸»è¦åŠ¨ä½œ åŠ¨ä½œä¸€: ç­‰å¾…æ¡ä»¶å˜é‡ åŠ¨ä½œäºŒ: å‘å‡ºæ¡ä»¶æˆç«‹ä¿¡å· ç›®çš„ä¸ºäº†é˜²æ­¢çº¿ç¨‹ä¹‹é—´çš„ç«äº‰ï¼Œç¡®ä¿çº¿ç¨‹æ­£ç¡®åœ°å¤„ç†å…±äº«èµ„æºã€‚ åˆ›å»ºä¸æ³¨é”€æ¡ä»¶å˜é‡åˆ›å»ºæ¡ä»¶å˜é‡æœ‰ä¸¤ç§æ–¹å¼ï¼šé™æ€å’ŒåŠ¨æ€ã€‚é™æ€æ–¹å¼é€šè¿‡ PTHREAD_COND_INITIALIZER åˆå§‹åŒ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š pthread_cond_t cond = PTHREAD_COND_INITIALIZER; åŠ¨æ€æ–¹å¼åˆ™æ˜¯é€šè¿‡è°ƒç”¨ pthread_cond_init() å‡½æ•°ï¼ŒAPI å®šä¹‰å¦‚ä¸‹ï¼š int pthread_cond_init(pthread_cond_t *cond, pthread_condattr_t *cond_attr); å°½ç®¡ POSIX æ ‡å‡†ä¸­ä¸ºæ¡ä»¶å˜é‡å®šä¹‰äº†å±æ€§ï¼ˆcond_attrï¼‰ï¼Œä½†åœ¨æŸäº›å®ç°ä¸­ï¼Œæ¯”å¦‚ LinuxThreadsï¼Œå¹¶æ²¡æœ‰å®é™…æ”¯æŒï¼Œå› æ­¤åœ¨è¿™é‡Œå¸¸å¸¸å°† cond_attr è®¾ç½®ä¸º NULLï¼Œå¹¶è¢«ç›¸åº”åœ°å¿½ç•¥ã€‚ è¦æ³¨é”€æ¡ä»¶å˜é‡ï¼Œå¯ä»¥è°ƒç”¨ pthread_cond_destroy()ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰åœ¨æ²¡æœ‰å…¶ä»–çº¿ç¨‹ç­‰å¾…è¯¥æ¡ä»¶å˜é‡çš„æƒ…å†µä¸‹æ‰èƒ½æˆåŠŸæ³¨é”€ï¼Œè‹¥æœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…ï¼Œåˆ™ä¼šè¿”å›é”™è¯¯ä»£ç  EBUSYã€‚å› ä¸ºåœ¨ Linux å®ç°çš„æ¡ä»¶å˜é‡ä¸­å¹¶æ²¡æœ‰åˆ†é…ç‰¹å®šçš„èµ„æºï¼Œæ³¨é”€æ“ä½œåªéœ€ç¡®ä¿æ²¡æœ‰ç­‰å¾…çš„çº¿ç¨‹ã€‚API å®šä¹‰å¦‚ä¸‹ï¼š int pthread_cond_destroy(pthread_cond_t *cond); ç­‰å¾…ä¸æ¿€å‘æ¡ä»¶åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œæœ‰ä¸¤ç§æ–¹å¼æ¥ç­‰å¾…æ¡ä»¶ï¼š æ¡ä»¶ç­‰å¾…: ä½¿ç”¨ pthread_cond_wait() è®¡æ—¶ç­‰å¾…: ä½¿ç”¨ pthread_cond_timedwait() å…¶ä¸­ï¼Œè®¡æ—¶ç­‰å¾…æ–¹å¼å¦‚æœåœ¨ç»™å®šæ—¶é—´æ®µå†…æ¡ä»¶æœªæ»¡è¶³ï¼Œåˆ™è¿”å› ETIMEDOUTï¼Œå¹¶ç»“æŸç­‰å¾…ã€‚è®¡æ—¶çš„ç»å¯¹æ—¶é—´æ ¼å¼ä¸ time() å‡½æ•°ç›¸åŒï¼Œæ—¶é—´ 0 è¡¨ç¤ºä» 1970 å¹´ 1 æœˆ 1 æ—¥ 00 æ—¶ 00 åˆ† 0 ç§’å¼€å§‹ã€‚ å¿…é¡»ä¸ä¸€ä¸ªäº’æ–¥é”ï¼ˆmutexï¼‰é…åˆä½¿ç”¨ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯·æ±‚ pthread_cond_wait()ï¼ˆæˆ– pthread_cond_timedwait()ï¼‰ï¼Œé€ æˆç«äº‰æ¡ä»¶ã€‚åœ¨è°ƒç”¨ pthread_cond_wait() å‰ï¼Œmutex å¿…é¡»ç”±å½“å‰çº¿ç¨‹åŠ é”ï¼ˆpthread_mutex_lock()ï¼‰ï¼Œå¹¶åœ¨æ¡ä»¶æ»¡è¶³ä¸”ç¦»å¼€ pthread_cond_wait() å‰é‡æ–°åŠ é”ã€‚ç¡®ä¿åœ¨é˜»å¡æ—¶ï¼Œçº¿ç¨‹å¤„äºè§£é”çŠ¶æ€ï¼Œä»¥é¿å…æ­»é”æƒ…å½¢çš„å‘ç”Ÿã€‚ æ¿€å‘æ¡ä»¶ä¿¡å·æœ‰ä¸¤ç§å½¢å¼ï¼š pthread_cond_signal(): æ¿€æ´»ä¸€ä¸ªç­‰å¾…è¯¥æ¡ä»¶çš„çº¿ç¨‹ï¼Œä¼˜å…ˆæ¿€æ´»åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­æŒ‰å…ˆåé¡ºåºæ’åœ¨å‰çš„çº¿ç¨‹ã€‚ pthread_cond_broadcast(): æ¿€æ´»æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼Œè¿™åœ¨éœ€è¦åŒæ—¶é€šçŸ¥å¤šä¸ªæ¶ˆè´¹è€…æ—¶éå¸¸æœ‰ç”¨ã€‚ ä»£ç å®ä¾‹ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„å¤šçº¿ç¨‹åº”ç”¨ç¤ºä¾‹ï¼Œé‡‡ç”¨äº†æ¡ä»¶å˜é‡å’Œäº’æ–¥é”ã€‚è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Œå…¶ä¸­æ¶ˆè´¹è€…å¯ä»¥æ˜¯å¤šä¸ªçº¿ç¨‹ã€‚ #include stdio.h#include stdlib.h#include pthread.h#include unistd.hstatic pthread_mutex_t mtx = PTHREAD_MUTEX_INITIALIZER;static pthread_cond_t cond = PTHREAD_COND_INITIALIZER;struct node int n_number; struct node *n_next; *head = NULL;/* æ¸…ç†å¤„ç†å‡½æ•° */static void cleanup_handler(void* arg) printf(Clean up handler of the second thread. ); free(arg); (void)pthread_mutex_unlock(mtx);/* çº¿ç¨‹å‡½æ•° */static void* thread_func(void* arg) struct node *p = NULL; pthread_cleanup_push(cleanup_handler, p); pthread_mutex_lock(mtx); // Protects the waiting period of wait while (1) while (head == NULL) pthread_cond_wait(cond, mtx); // ä¸€æ—¦è¢«å”¤é†’ï¼Œè·å–èŠ‚ç‚¹ p = head; head = head-n_next; printf(Got %d from front of queue , p-n_number); free(p); pthread_mutex_unlock(mtx); // é‡Šæ”¾äº’æ–¥é” pthread_cleanup_pop(0); return 0;int main(void) pthread_t tid; int i; struct node *p; pthread_create(tid, NULL, thread_func, NULL); for (i = 0; i 10; i++) p = (struct node *)malloc(sizeof(struct node)); p-n_number = i; pthread_mutex_lock(mtx); // å¯¹ä¸´ç•Œèµ„æºåŠ é” p-n_next = head; head = p; pthread_cond_signal(cond); pthread_mutex_unlock(mtx); // è§£é” sleep(1); printf(Thread 1 wants to end the cancel thread 2. ); pthread_cancel(tid); // å–æ¶ˆçº¿ç¨‹ pthread_join(tid, NULL); printf(All done -- exiting ); return 0; è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•é€šè¿‡äº’æ–¥é”ä¿æŠ¤å…±äº«èµ„æº headï¼Œå¹¶ä½¿ç”¨æ¡ä»¶å˜é‡ cond åœ¨æœ‰æ–°æ•°æ®æ—¶å”¤é†’æ¶ˆè´¹è€…çº¿ç¨‹ã€‚ å¯¹äºçº¿ç¨‹çš„å–æ¶ˆï¼Œä½¿ç”¨äº† pthread_cancel()ï¼Œå®ç°äº†å¤–éƒ¨çº¿ç¨‹çš„å®‰å…¨é€€å‡ºã€‚ æ¸…ç†å¤„ç†å‡½æ•°ç¡®ä¿åœ¨èµ„æºé‡Šæ”¾æ—¶æ­£ç¡®è§£é”ï¼Œä»¥é˜²æ­¢ç¨‹åºåœ¨æ„å¤–æƒ…å†µä¸‹é™·å…¥æ­»é”çŠ¶æ€ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","å¤šçº¿ç¨‹"]},{"title":"å®ˆæŠ¤è¿›ç¨‹","path":"/2024/06/04/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-å¤šçº¿ç¨‹-å®ˆæŠ¤è¿›ç¨‹/","content":"å¯ä»¥å°†ä¸‹è¿°æ¦‚å¿µç±»æ¯”ä¸ºä¸€æ¬¡é€šè¿‡ QQ èŠå¤©çš„å…¨è¿‡ç¨‹ï¼š æ§åˆ¶ç»ˆç«¯ å¥½æ¯” QQ è½¯ä»¶çš„æ‰“å¼€ï¼Œæ¯æ¬¡å¼€å¯éƒ½ä»£è¡¨å¼€å§‹ä¸€æ¬¡æ–°çš„ä¼šè¯ã€‚ è¿›ç¨‹ åˆ™æ˜¯èŠå¤©æ—¶å‘é€çš„æ¯ä¸€æ¡ä¿¡æ¯ï¼Œæ¯æ¡ä¿¡æ¯éƒ½å¯èƒ½æ˜¯ä¸ªäººè§‚ç‚¹æˆ–å›å¤ã€‚ ä½œä¸š ä½“ç°ä¸ºèŠå¤©å†…å®¹ä¸­çš„æŸä¸€ä¸»é¢˜æˆ–äº‹ä»¶ï¼Œå¯ä»¥æ˜¯è®¨è®ºæŸæ¬¾æ¸¸æˆã€åˆ†äº«ä¸€åˆ™æ–°é—»ç­‰ï¼Œå…¶ä¸­æ¯ä¸ªè¨€è°ˆäº¤äº’å°±åƒæ˜¯è¿›ç¨‹çš„æ“ä½œã€‚ ä¼šè¯ æ˜¯ä»å¼€å¯èŠå¤©åˆ°ç»“æŸèŠå¤©çš„å®Œæ•´è¿‡ç¨‹ï¼Œå³ä½¿å…¶ä¸­è¯é¢˜ä¸æ–­å˜åŒ–ã€‚ è¿›ç¨‹ç»„è¿›ç¨‹ç»„æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹çš„é›†åˆï¼Œæ–¹ä¾¿å¯¹å¤šä¸ªè¿›ç¨‹è¿›è¡Œç»Ÿä¸€æ§åˆ¶ã€‚åœ¨æœ‰å¤§é‡è¿›ç¨‹è¿è¡Œçš„æƒ…å†µä¸‹ï¼Œå‘è¿›ç¨‹ç»„å‘é€ä¿¡å·æ¯”é€ä¸€å‘æ¯ä¸ªè¿›ç¨‹å‘é€ä¿¡å·æ›´åŠ é«˜æ•ˆå’Œç®€ä¾¿ã€‚æ¯ä¸ªè¿›ç¨‹ç»„éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ IDï¼Œè¿™ä¸ª ID ç”±ç»„é•¿è¿›ç¨‹çš„è¿›ç¨‹ ID å†³å®šã€‚ç»„é•¿è¿›ç¨‹åˆ›å»ºè¿›ç¨‹ç»„ï¼Œä½†å®ƒå¹¶ä¸èƒ½å†³å®šè¿›ç¨‹ç»„çš„å­˜æ´»æ—¶é•¿ã€‚åªè¦è¿›ç¨‹ç»„å†…è¿˜æœ‰ä¸€ä¸ªè¿›ç¨‹å­˜åœ¨ï¼Œæ•´ä¸ªè¿›ç¨‹ç»„ä¾ç„¶æœ‰æ•ˆã€‚è¿™æ„å‘³ç€å³ä½¿ç»„é•¿è¿›ç¨‹å·²ç»ˆæ­¢ï¼Œåªè¦è‡³å°‘è¿˜æœ‰ä¸€ä¸ªæˆå‘˜è¿›ç¨‹åœ¨è¿è¡Œï¼Œæ•´ä¸ªç»„ä»ç„¶å­˜æ´»ã€‚ ä¼šè¯ä¼šè¯ï¼ˆsessionï¼‰æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ç»„çš„é›†åˆã€‚ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸä»ç”¨æˆ·ç™»é™†ç»ˆç«¯å¼€å§‹ï¼Œåˆ°ç”¨æˆ·é€€å‡ºç™»é™†æ—¶ç»“æŸã€‚å¯ä»¥æŠŠä¼šè¯ç†è§£ä¸ºç”¨æˆ·ä¸æ“ä½œç³»ç»Ÿä¹‹é—´ä¸€æ¬¡å®Œæ•´çš„äº’åŠ¨ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·é€šè¿‡ç»ˆç«¯ç™»å½•åˆ°ç³»ç»Ÿåï¼Œå¯åŠ¨çš„ä¸€ç³»åˆ—æ“ä½œå’Œè¿›ç¨‹å°†ä¼šè¢«åŒ…å«åœ¨åŒä¸€ä¸ªä¼šè¯ä¸­ï¼Œè¿™ç§äº’åŠ¨è¿‡ç¨‹åŒ…æ‹¬ä¸“æ³¨äºä»»åŠ¡çš„æ—¶é—´æ®µåŠè¿‡ç¨‹ä¸­çš„å„ç§è¾“å…¥å’Œåé¦ˆã€‚ åœ¨æ¯ä¸ªä¼šè¯ä¸­ï¼Œé€šå¸¸ä¼šåŒ…å«ä¸€ä¸ªæ§åˆ¶è¿›ç¨‹ã€ä¸€ä¸ªå‰å°è¿›ç¨‹ç»„åŠè‹¥å¹²åå°è¿›ç¨‹ç»„ã€‚æ§åˆ¶è¿›ç¨‹è´Ÿè´£ä¸ç»ˆç«¯å»ºç«‹è¿æ¥ï¼Œè€Œä¼šè¯åªèƒ½æœ‰ä¸€ä¸ªæ§åˆ¶ç»ˆç«¯ã€‚è¿™ä¸ªæ§åˆ¶ç»ˆç«¯é€šå¸¸æ˜¯ç”¨æˆ·ç™»å½•æ—¶æ‰€ç”¨çš„ç»ˆç«¯è®¾å¤‡æˆ–ä¼ªç»ˆç«¯ã€‚ä¼šè¯çš„å‰å°è¿›ç¨‹ç»„ä¸­æ‰€æœ‰è¿›ç¨‹éƒ½å°†æ¥æ”¶åˆ°æ¥è‡ªæ§åˆ¶ç»ˆç«¯çš„è¾“å…¥åŠä¿¡å·ã€‚ æ§åˆ¶ç»ˆç«¯æ¯å½“ä½¿ç”¨ç»ˆç«¯å·¥å…·ï¼ˆå¦‚ SSHã€Bash ç­‰ï¼‰æ‰“å¼€æœ¬åœ°æˆ–è¿œç¨‹ shell æ—¶ï¼Œä¾¿å¼€å¯äº†ä¸€ä¸ªæ§åˆ¶ç»ˆç«¯ã€‚é€šè¿‡ ps å‘½ä»¤ï¼Œå¯ä»¥æŸ¥æ‰¾ä¸è¯¥ç»ˆç«¯å¯¹åº”çš„è¿›ç¨‹ï¼Œå‘½ä»¤æ˜¾ç¤ºçš„ command ä¸º ttyn ï¼Œè¿™å¯¹åº”äº Linux dev ç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¿è¡Œ ps -t pts/0ï¼Œä¼šåˆ—å‡ºä¸è¯¥ç»ˆç«¯ç›¸å…³çš„æ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ï¼Œä¾¿äºç”¨æˆ·ç›‘æ§å’Œç®¡ç†ã€‚ ä½œä¸šä½œä¸šçš„æ¦‚å¿µä¸è¿›ç¨‹ç»„ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”±å¤šä¸ªè¿›ç¨‹ç»„æˆçš„ã€‚ä½œä¸šå¯ä»¥è¢«åˆ†ä¸ºå‰å°ä½œä¸šå’Œåå°ä½œä¸šã€‚æ¯ä¸ªä¼šè¯é€šå¸¸ä¼šæœ‰ä¸€ä¸ªå‰å°ä½œä¸šå’Œå¤šä¸ªåå°ä½œä¸šã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½œä¸šå†…æŸä¸ªè¿›ç¨‹çš„å­è¿›ç¨‹å¹¶ä¸è‡ªåŠ¨å½’å±è¯¥ä½œä¸šã€‚ å¦‚åŒç”¨æˆ·åœ¨å¤„ç†å¤šä¸ªä»»åŠ¡æ—¶ï¼Œä½œä¸šå¯ä»¥ç†è§£ä¸ºæ­£åœ¨è¿›è¡Œçš„ä¸€é¡¹å…·ä½“å·¥ä½œï¼Œè€Œæ¯ä¸ªè¿›ç¨‹å°±åƒæ˜¯è¿™ä¸€è¿‡ç¨‹ä¸­ä¸åŒçš„æ­¥éª¤ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·åœ¨åŒä¸€ä¼šè¯ä¸­å¯èƒ½åŒæ—¶å¯ç”¨äº†å¤šä¸ªä¸‹è½½ä»»åŠ¡å’Œæ–‡ä»¶ç¼–è¾‘ä»»åŠ¡ï¼Œæ¯ä¸ªéƒ½å¯¹åº”äºä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œè€Œå®ƒä»¬å…±åŒç»„æˆäº†è¯¥ä½œä¸šçš„å®Œæ•´æ€§ã€‚ åå°æ‰§è¡Œåœ¨ç»ˆç«¯çª—å£æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œè¿›ç¨‹é€šå¸¸ä¼šå ç”¨ç»ˆç«¯ï¼Œç›´åˆ°å…¶ç»“æŸã€‚åœ¨æ­¤æœŸé—´ï¼Œæ— æ³•ç»§ç»­å¯¹ç»ˆç«¯è¿›è¡Œè¾“å…¥æ“ä½œã€‚åŒæ—¶ï¼Œå¦‚æœç»ˆç«¯çª—å£è¢«å…³é—­æˆ–ç½‘ç»œè¿æ¥ä¸­æ–­ï¼Œå·²å¯åŠ¨çš„è¿›ç¨‹ä¹Ÿä¼šè¢«ä¸­æ–­ã€‚åŸå› åœ¨äºï¼Œç”¨æˆ·æ³¨é”€æˆ–ç½‘ç»œæ–­å¼€æ—¶ï¼ŒSIGHUP ä¿¡å·å°†è¢«å‘é€ç»™ä¼šè¯ä¸­çš„æ‰€æœ‰å­è¿›ç¨‹ã€‚å¦‚æœç¨‹åºæ²¡æœ‰æ•æ‰æ­¤ä¿¡å·ï¼Œè¿›ç¨‹ä¾¿ä¼šç»ˆæ­¢ã€‚ å®ç°åå°æ‰§è¡Œä¸»è¦æœ‰ä¸¤ä¸ªå…³é”®ç›®æ ‡ï¼š ä½¿è¿›ç¨‹åœ¨åå°æ‰§è¡Œï¼Œä¸å¹²æ‰°å‰å°ç»ˆç«¯ã€‚ ä½¿è¿›ç¨‹ä¸å†å—ç»ˆç«¯å…³é—­å½±å“ï¼Œä¾‹å¦‚ä¸åº”è¯¥åœ¨ç»ˆç«¯å…³é—­åå› æ¥æ”¶åˆ° SIGHUP ä¿¡å·è€Œé€€å‡ºã€‚ åœ¨å®é™…æ“ä½œä¸­ï¼Œæœ€å¸¸è§çš„æ–¹å¼æ˜¯ä½¿ç”¨ ç¬¦å·ï¼Œå°†å…¶é™„åŠ åœ¨å‘½ä»¤åé¢ï¼Œå¦‚ command ï¼Œæ­¤å‘½ä»¤å¯è®©è¿›ç¨‹åœ¨åå°æ‰§è¡Œï¼Œè€Œä¸ä¼šå ç”¨å‰å°ç•Œé¢ã€‚ç„¶è€Œï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œ ç¬¦å·åªå®ç°äº†è®©è¿›ç¨‹è®©å‡ºå‰å°ç»ˆç«¯çš„åŠŸèƒ½ï¼Œå¹¶æœªæ”¹å˜è¿›ç¨‹å—åˆ° SIGHUP ä¿¡å·çš„å½±å“ã€‚ nohupnohup æ˜¯å¦ä¸€ä¸ªå¸¸ç”¨å‘½ä»¤ï¼Œå…¶ä½œç”¨æ˜¯ä½¿è¿›ç¨‹ä¸å— SIGHUP ä¿¡å·çš„å½±å“ã€‚ä½¿ç”¨å¦‚ nohup php test.php åï¼Œè™½è¿›ç¨‹åœ¨å‰å°ç»ˆç«¯ä»å­˜åœ¨ï¼Œä½†å³ä½¿ç»ˆç«¯å…³é—­æˆ–è¿æ¥æ–­å¼€ï¼Œç¨‹åºä¾ç„¶ä¼šç»§ç»­è¿è¡Œã€‚åœ¨æ‰§è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œç”¨æˆ·ä¼šå‘ç°å½“å‰ç›®å½•ä¸‹äº§ç”Ÿäº†ä¸€ä¸ªåä¸º nohup.out çš„æ–‡ä»¶ï¼Œè¿™æ˜¯å› ä¸º nohup ä¼šå°†è¿›ç¨‹çš„è¾“å‡ºä¿å­˜åˆ°è¯¥æ–‡ä»¶ä¸­ã€‚ å¦‚æœè¿›ç¨‹å¯¹è¾“å‡ºæ²¡æœ‰éœ€æ±‚ä¸”ä¸æƒ³äº§ç”Ÿæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡é‡å®šå‘æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¾“å‡ºæ¥é¿å…åˆ›å»º nohup.outã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†è¾“å‡ºé‡å®šå‘åˆ° /dev/null ï¼Œ å¤§å®¶é€šå¸¸ä¼šç»“åˆä½¿ç”¨ nohup å’Œ ä»¥ç¡®ä¿åå°è¿›ç¨‹èƒ½ç‹¬ç«‹äºç»ˆç«¯å­˜åœ¨ï¼Œå¦‚ï¼šnohup command /dev/null 21 ã€‚ setsidsetsid æ˜¯å¦ä¸€ä¸ªç”¨äºèƒŒæ™¯æ‰§è¡Œçš„å‘½ä»¤ï¼Œå…¶ä½œç”¨æ˜¯å¯åŠ¨ä¸€ä¸ªæ–°çš„ä¼šè¯å¹¶è¿è¡ŒæŒ‡å®šçš„è¿›ç¨‹ã€‚ä½¿ç”¨æ ¼å¼ä¸º setsid commandã€‚å› ä¸ºç»ˆç«¯å…³é—­åè¿›ç¨‹é€€å‡ºæ˜¯ç”±äºä¼šè¯çš„é¦–è¿›ç¨‹å‘é€äº† SIGHUP ä¿¡å·ï¼Œè€Œ setsid å¯ä»¥ç›´æ¥æ‰“å¼€ä¸€ä¸ªæ–°çš„ä¼šè¯æ‰§è¡Œå‘½ä»¤ï¼Œä½¿åŸä¼šè¯çš„ç»ˆç«¯çŠ¶æ€ä¸å†å½±å“è¯¥è¿›ç¨‹ã€‚ ä½¿ç”¨ pstree å¯ä»¥æŸ¥çœ‹é€šè¿‡ setsid å’Œ nohup ... å¯åŠ¨çš„è¿›ç¨‹æ—¶çš„è¿›ç¨‹æ ‘çŠ¶æ€ã€‚ä¾‹å¦‚ï¼š pstree -a | grep -C 6 test|-sshd| `-sshd| `-sshd| `-bash| `-sudo -s| `-bash| |-grep -C 6 test| |-php test.php| `-pstree -a åœ¨è¿œç¨‹é€šè¿‡ SSH ç™»å½•æ—¶ï¼Œå¯ä»¥è§‚å¯Ÿåˆ° test.php è¿›ç¨‹æŒ‚åœ¨ sshd è¿›ç¨‹ä¸‹ã€‚è‹¥ sshd ç»ˆæ­¢ï¼Œtest.php ä¹Ÿå°†éšä¹‹é€€å‡ºã€‚ä¸è¿‡ï¼Œå½“ä½¿ç”¨ setsid åï¼Œæ‰§è¡Œ pstree -a | grep -C 6 test ä¼šæ˜¾ç¤ºï¼š |-nscd|-php test.php|-php-fpm--|-sshd| `-sshd æ­¤æ—¶ï¼Œ test.php è¿›ç¨‹å·²ä¸ sshd è¿›ç¨‹åŒçº§ï¼Œæˆä¸º init è¿›ç¨‹çš„å­è¿›ç¨‹ã€‚è™½ç„¶ setsid æœªä¸ºè¿›ç¨‹åˆ†é…è¾“å‡ºç»ˆç«¯ï¼Œè¿›ç¨‹ä»ä¼šè¾“å‡ºåˆ°å½“å‰ç»ˆç«¯ã€‚ setsid çš„å‘å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨ç»ˆç«¯ä¸­ç›´æ¥ä½¿ç”¨ setsid command å¯åŠ¨è¿›ç¨‹æ—¶ï¼Œç»ˆç«¯çš„å‰å°å¹¶ä¸ä¼šè¢«å½±å“ï¼Œå‘½ä»¤ command å°†åœ¨åå°é»˜é»˜è¿è¡Œã€‚ä½†åœ¨ shell è„šæœ¬ä¸­ï¼Œæ‰§è¡Œ setsid çš„è¿›ç¨‹ä¼šé˜»å¡ï¼Œç›´åˆ° command æ‰§è¡Œç»“æŸã€‚è¿™æ˜¯ç”±äº setsid ä½œä¸ºè¿›ç¨‹ç»„é•¿ï¼Œåœ¨ fork() å­è¿›ç¨‹æ—¶ï¼Œä¸ä¼š wait() å­è¿›ç¨‹ï¼Œä¼šç«‹å³é€€å‡ºã€‚ç›¸å¯¹åœ°ï¼Œåœ¨ shell è„šæœ¬å†…ï¼Œsetsid ä¸æ˜¯è¿›ç¨‹ç»„é•¿ï¼Œbash ä¼š fork() ä¸€ä¸ªå­è¿›ç¨‹å¹¶ wait() å®ƒï¼Œä»è€Œå¯¼è‡´è¿™ä¸€è¡Œä¸ºå·®å¼‚ã€‚ è§£å†³ä¸Šè¿°é—®é¢˜çš„åŠæ³•æœ‰ï¼š ä½¿ç”¨ setsid php test.php ï¼Œå¼ºè¡Œå°†å…¶æ”¾åˆ°åå°æ‰§è¡Œã€‚ åˆ©ç”¨ . æˆ– source å‘½ä»¤ç”±ç»ˆç«¯æ‰§è¡Œ setsidã€‚ é™¤äº†ä¸Šè¿°å‘½ä»¤ï¼Œè¿˜æœ‰è¯¸å¦‚ screen å’Œ tmux ç­‰ä¼šè¯å·¥å…·ï¼Œå®ƒä»¬å„è‡ªå…·æœ‰å¤æ‚çš„ä½¿ç”¨è§„èŒƒã€‚åœ¨æŒæ¡äº†æœ¬æ–‡ä¸­çš„å…³é”®å‘½ä»¤åï¼Œä¾¿å¯è‡ªå¦‚è¿ç”¨ Linux è¿›ç¨‹æ§åˆ¶ã€‚ä¸è¿‡ï¼Œå¯¹äºæ·±å…¥æ–°çŸ¥è¯†çš„æ±‚çŸ¥è€…ï¼Œå­¦ä¹ æ›´é«˜çº§çš„å·¥å…·ä¹Ÿéå¸¸æœ‰ç›Šã€‚ ä½œä¸šå‘½ä»¤åœ¨åå°æ‰§è¡Œçš„å‘½ä»¤æ—¶ï¼Œå¯èƒ½ä¼šé¢ä¸´ä¸€äº›å°é—®é¢˜ï¼Œæ¶‰åŠåˆ°ä½œä¸šç®¡ç†ã€‚ç»ˆç«¯ä¸­è¿è¡Œçš„æ¯ä¸ªå‘½ä»¤éƒ½å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªä½œä¸šï¼Œéƒ¨åˆ†ä½œä¸šå ç”¨å‰å°ç»ˆç«¯ï¼Œéƒ¨åˆ†åœ¨åå°æ‚„ç„¶è¿è¡Œã€‚å…¶å¸®åŠ©è°ƒåº¦ä½œä¸šçš„åŸºæœ¬å‘½ä»¤åŒ…æ‹¬ï¼š jobsjobs æ˜¯ç”¨äºæŸ¥çœ‹å½“å‰ä¼šè¯ä¸­æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ä½œä¸šçš„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œæ‰§è¡Œ jobs å‘½ä»¤åï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š jobs[1]- Running php test.php [2]+ Stopped php test.php æ–¹æ‹¬å·å†…çš„æ•°å­—æ˜¯ä½œä¸š IDï¼Œç”¨äºåç»­æ“ä½œçš„æ ‡è¯†ã€‚æ¥ä¸‹æ¥æ˜¯ä½œä¸šçš„çŠ¶æ€å’Œæ‰§è¡Œçš„å‘½ä»¤åç§°ã€‚ ctrl+zctrl+z å¹¶ä¸æ˜¯ä¸“é—¨çš„ä½œä¸šå‘½ä»¤ï¼Œå®ƒå‘å½“å‰è¿è¡Œçš„è¿›ç¨‹å‘é€ä¸€ä¸ª SIGSTOP ä¿¡å·ï¼Œä¿ƒä½¿è¿›ç¨‹è¿›å…¥æš‚åœçŠ¶æ€ï¼ˆstoppedï¼‰ã€‚åœ¨è¿™ä¸€çŠ¶æ€ä¸‹ï¼Œè¿›ç¨‹çš„çŠ¶æ€ä¼šè¢«æ“ä½œç³»ç»Ÿä¿å­˜ï¼Œè€Œæ­¤è¿›ç¨‹å°†è¢«ç½®å…¥ä½œä¸šé˜Ÿåˆ—ä¸­ã€‚å¯ä»¥åˆ©ç”¨ ctrl+z æš‚åœå ç”¨ç»ˆç«¯çš„è¿›ç¨‹ï¼Œè€Œä¸å®Œå…¨åœæ­¢è¯¥è¿›ç¨‹ï¼Œä»è€Œè·å¾—ç»§ç»­è¾“å…¥å…¶ä»–å‘½ä»¤çš„ç©ºé—´ã€‚ bgè‹¥è¢«æ”¾åœ¨åå°çš„è¿›ç¨‹æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œå¹¶ä¸”æ²¡æœ‰ä½¿ç”¨ nohupï¼Œæ­¤æ—¶ç»ˆç«¯ä¸€æ—¦æ–­å¼€ï¼Œè¿›ç¨‹å°†å¯¼è‡´é‡æ–°è¿è¡Œã€‚å› æ­¤ï¼Œå¦‚æœå¸Œæœ›åœ¨ä¸ä¸­æ–­è¿›ç¨‹çš„æƒ…å†µä¸‹è®©å…¶è®©å‡ºå‰å°ç»ˆç«¯ï¼Œå¯ä»¥ä½¿ç”¨ bg å‘½ä»¤ï¼ˆä»£è¡¨ â€œbackgroundâ€ çš„ç¼©å†™ï¼‰ã€‚bg %id çš„ä½œç”¨æ˜¯å°†å·²æš‚åœä½œä¸šæ”¾å…¥åå°ï¼Œç»§ç»­æ‰§è¡Œã€‚ ç»“åˆä½¿ç”¨ ctrl+z ä¸ bgï¼Œå¯ä»¥å°†æ­£åœ¨å ç”¨ç»ˆç«¯çš„è¿›ç¨‹æš‚åœå¹¶è½¬ä¸ºåå°æ‰§è¡Œï¼Œä»è€Œé¿å…ä¸€äº›æ½œåœ¨é—®é¢˜ã€‚ fgfg å‘½ä»¤åˆ™ä¸ bg ç›¸å¯¹ï¼Œå¯ä»¥å°†ä½œä¸šä»åå°è°ƒå›å‰å°æ‰§è¡Œã€‚å®ƒéå¸¸é€‚åˆäºéœ€è¦å†æ¬¡äº¤äº’çš„å‘½ä»¤æˆ–ä½œä¸šï¼Œä¾¿äºç”¨æˆ·ç»§ç»­æ“ä½œã€‚ disowndisown ç”¨äºå°†ä½œä¸šç§»å‡ºä½œä¸šåˆ—è¡¨ï¼Œå³ä½¿åœ¨ä¼šè¯ç»“æŸåï¼Œä¹Ÿä¸å†å‘è¯¥ä½œä¸šå‘é€ SIGHUP ä¿¡å·ã€‚è¿™ä¸€ç‰¹æ€§å°¤å…¶æœ‰åŠ©äºè§£å†³è¿›ç¨‹åœ¨ç»ˆç«¯å…³é—­åä»éœ€ç»§ç»­å­˜åœ¨çš„é—®é¢˜ã€‚ å®ˆæŠ¤è¿›ç¨‹å‰é¢ä»‹ç»çš„æ˜¯ä¸€äº›ä¸´æ—¶æ€§è¿›ç¨‹çš„æ§åˆ¶æ‰‹æ®µï¼Œè€Œå°†è¿›ç¨‹è½¬å˜ä¸ºå®ˆæŠ¤è¿›ç¨‹æ˜¯é•¿æœŸåå°è¿è¡Œè¿›ç¨‹çš„æœ€ä½³é€‰æ‹©ã€‚ å®ˆæŠ¤è¿›ç¨‹å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰æ˜¯ä¸€ç§ç”Ÿå­˜æœŸè¾ƒé•¿çš„è¿›ç¨‹ï¼Œé€šå¸¸åœ¨æ“ä½œç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨ï¼Œå¹¶åœ¨ç³»ç»Ÿå…³é—­æ—¶è´Ÿè´£åœæ­¢ã€‚è¿™ç±»è¿›ç¨‹æ²¡æœ‰æ§åˆ¶ç»ˆç«¯ï¼Œä¹Ÿä¸ä¼šå‘ç»ˆç«¯è¾“å‡ºã€‚è¯¸å¦‚æœåŠ¡å™¨ã€åå°è¿›ç¨‹ç®¡ç†ï¼ˆå¦‚ PHP-FPMï¼‰ç­‰ï¼Œéƒ½æ˜¯ä»¥å®ˆæŠ¤è¿›ç¨‹çš„å½¢å¼å­˜åœ¨ã€‚ åˆ›å»ºè¿‡ç¨‹åˆ›å»ºå®ˆæŠ¤è¿›ç¨‹çš„åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š å¿…é€‰æ­¥éª¤ï¼š Fork å­è¿›ç¨‹ï¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹å¹¶é€€å‡ºçˆ¶è¿›ç¨‹ï¼Œä»¥ä½¿å­è¿›ç¨‹æˆä¸ºå­¤å„¿è¿›ç¨‹ï¼Œæ¥ä¸‹æ¥ç”± init è¿›ç¨‹æ”¶å…»ã€‚ **ä½¿ç”¨ setsid**ï¼šæ‰“å¼€æ–°ä¼šè¯ï¼Œç¡®ä¿è¿›ç¨‹è„±ç¦»ç»ˆç«¯æ§åˆ¶ï¼Œæˆä¸ºä¼šè¯ç»„é•¿ã€‚ è®¾ç½®ä¿¡å·å¤„ç†ï¼šç‰¹åˆ«æ˜¯å¯¹å­è¿›ç¨‹é€€å‡ºçš„å¤„ç†ã€‚ å¯é€‰æ­¥éª¤ï¼š **ä½¿ç”¨ chdir**ï¼šæ”¹å˜è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼Œé€šå¸¸è®¾ä¸ºæ ¹ç›®å½•ï¼Œé¿å…å ç”¨å¯å¸è½½çš„æ–‡ä»¶ç³»ç»Ÿã€‚ ç”¨ umask é‡è®¾æ–‡ä»¶æƒé™æ©ç ï¼šé¿å…ç»§æ‰¿çˆ¶è¿›ç¨‹çš„æ–‡ä»¶æƒé™è®¾ç½®ã€‚ å…³é—­çˆ¶è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼šç¡®ä¿èµ„æºæœ‰æ•ˆé‡Šæ”¾ã€‚ ä»£ç ç¤ºä¾‹ä»¥ä¸‹æ˜¯ç”¨ PHP åˆ›å»ºå®ˆæŠ¤è¿›ç¨‹çš„ç®€æ˜“ä¼ªä»£ç ç¤ºä¾‹ï¼š $pid = pcntl_fork();if ($pid 0) exit; // çˆ¶è¿›ç¨‹ç›´æ¥é€€å‡º elseif ($pid 0) throw_error(); // è¿›ç¨‹åˆ›å»ºå¤±è´¥posix_setsid(); // setsidæˆä¸ºä¼šè¯é¢†å¯¼è¿›ç¨‹chdir($dir); // åˆ‡æ¢å·¥ä½œç›®å½•umask(0); // é‡ç½®æ–‡ä»¶æƒé™maskclose_fd(); // å…³é—­çˆ¶è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦pcntl_signal($signal, $func); // æ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°while (true) do_job(); // å¤„ç†è¿›ç¨‹ä»»åŠ¡ pcntl_signal_dispatch(); // åˆ†å‘ä¿¡å·å¤„ç† ä»¥ä¸Šä¼ªä»£ç å±•ç¤ºäº†åˆ›å»ºå®ˆæŠ¤è¿›ç¨‹æ‰€éœ€çš„åŸºæœ¬æ­¥éª¤ï¼Œç¡®ä¿è¿›ç¨‹å¯ä»¥åœ¨æ²¡æœ‰ç”¨æˆ·å¹²é¢„çš„æƒ…å†µä¸‹ä¸€ç›´è¿è¡Œã€‚å®ˆæŠ¤è¿›ç¨‹çš„ç®¡ç†å’Œåˆ›å»ºæ˜¯é«˜æ•ˆå¤„ç† Linux ç³»ç»Ÿä¸­é•¿æœŸåå°ä½œä¸šçš„æ ¸å¿ƒï¼Œäº†è§£å…¶åŸç†åŠå®ç°èƒ½å¤Ÿæ˜¾è‘—æå‡å·¥ä½œæ•ˆç‡å’Œç³»ç»Ÿç¨³å®šæ€§ã€‚ åˆ›å»ºå®ˆæŠ¤è¿›ç¨‹åˆ›å»ºå®ˆæŠ¤è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªå¸¸è§ä»»åŠ¡ï¼Œå°¤å…¶åœ¨éœ€è¦åå°æŒç»­è¿è¡Œçš„æœåŠ¡æ—¶ã€‚ä¾‹å¦‚ï¼Œç½‘ç»œæœåŠ¡å™¨å’Œå®šæ—¶ä»»åŠ¡ç®¡ç†ç³»ç»Ÿéƒ½ä¾èµ–äºå®ˆæŠ¤è¿›ç¨‹æ¥ç¡®ä¿å…¶æ­£å¸¸è¿è¡Œã€‚ä¸‹é¢æ˜¯åˆ›å»ºå®ˆæŠ¤è¿›ç¨‹çš„å…·ä½“æ­¥éª¤ï¼š åˆ›å»ºå­è¿›ç¨‹ä½¿ç”¨ fork() å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ã€‚åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥é€‰æ‹©è°ƒç”¨ exit() å‡½æ•°ï¼Œè¿™æ ·å¯ä»¥ç«‹å³é‡Šæ”¾ç»ˆç«¯èµ„æºå¹¶é€€å‡ºã€‚æ­¤æ“ä½œç¡®ä¿çˆ¶è¿›ç¨‹ç»“æŸåï¼Œå­è¿›ç¨‹èƒ½å¤Ÿç»§ç»­ç‹¬ç«‹è¿è¡Œã€‚ä¾‹å¦‚ï¼š pid_t pid = fork();if (pid 0) // çˆ¶è¿›ç¨‹å¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡æˆ–ç›´æ¥é€€å‡º exit(0); å°†å­è¿›ç¨‹è®¾ä¸ºæ–°çš„ä¼šè¯è°ƒç”¨ setsid() å‡½æ•°å°†å­è¿›ç¨‹è®¾ä¸ºæ–°çš„ä¼šè¯ç»„çš„é¦–è¿›ç¨‹ã€‚è¿™ä½¿å¾—å­è¿›ç¨‹è„±ç¦»å½“å‰çš„ç»ˆç«¯ä¼šè¯ï¼Œç¡®ä¿åœ¨ç”¨æˆ·æ³¨é”€æˆ–å…³é—­ç»ˆç«¯æ—¶ä¸ä¼šå—åˆ°å½±å“ã€‚è¿™ä¸€æ­¥å¯¹äºç¡®ä¿å®ˆæŠ¤è¿›ç¨‹çš„é•¿æœŸç¨³å®šè¿è¡Œè‡³å…³é‡è¦ã€‚ æ›´æ”¹å·¥ä½œç›®å½•ä½¿ç”¨ chdir() å‡½æ•°å°†å·¥ä½œç›®å½•æ›´æ”¹ä¸ºæ ¹ç›®å½• /ã€‚è¿™å¯ä»¥é¿å…å®ˆæŠ¤è¿›ç¨‹å ç”¨å¯èƒ½è¢«åˆ é™¤çš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œå› ä¸ºæ ¹ç›®å½•æ˜¯å§‹ç»ˆå­˜åœ¨çš„ã€‚ä¾‹å¦‚ï¼š chdir(/); æ›´æ”¹æ–‡ä»¶çš„æƒé™æ©ç é€šè¿‡ umask() å‡½æ•°æ›´æ”¹æ–‡ä»¶æƒé™æ©ç ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿å®ˆæŠ¤è¿›ç¨‹åˆ›å»ºçš„æ–‡ä»¶å…·æœ‰é€‚å½“çš„æƒé™ã€‚ä¾‹å¦‚ï¼š umask(027); // é™åˆ¶æ–‡ä»¶æƒé™ï¼Œä»…å…è®¸åŒç»„ç”¨æˆ·è®¿é—® å…³é—­æ–‡ä»¶æè¿°ç¬¦ä½¿ç”¨ close() å‡½æ•°å…³é—­ä¸å†éœ€è¦çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå°¤å…¶æ˜¯æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯æµã€‚å› å®ˆæŠ¤è¿›ç¨‹ä¸éœ€è¦ä¸ç»ˆç«¯äº¤äº’ï¼Œè¿™ä¸€æ­¥éª¤èƒ½å¤Ÿé˜²æ­¢ä¸å¿…è¦çš„è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç å…³é—­æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯æè¿°ç¬¦ï¼š close(0); // å…³é—­æ ‡å‡†è¾“å…¥close(1); // å…³é—­æ ‡å‡†è¾“å‡ºclose(2); // å…³é—­æ ‡å‡†é”™è¯¯è¾“å‡º ä½¿ç”¨ getdtablesize() å‡½æ•°å¯ä»¥è°ƒç”¨ getdtablesize() å‡½æ•°æ¥è·å–å½“å‰è¿›ç¨‹çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°é‡ã€‚è¿™å¯¹äºåœ¨éœ€è¦çš„æƒ…å†µä¸‹åˆç†ç®¡ç†æ–‡ä»¶æè¿°ç¬¦éå¸¸é‡è¦ã€‚ä¾‹å¦‚ï¼Œå®šä¹‰å¹¶å…³é—­æ‰€æœ‰å¯ä»¥å…³é—­çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ daemon å‡½æ•°åœ¨ POSIX ä¸­ï¼Œdaemon å‡½æ•°æä¾›äº†ä¸€ç§æ›´ç®€ä¾¿çš„æ–¹æ³•æ¥åˆ›å»ºå®ˆæŠ¤è¿›ç¨‹ã€‚å…¶å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š #include unistd.hint daemon(int nochdir, int noclose); å‚æ•°è¯´æ˜ nochdir: å‚æ•°è®¾ä¸º 0 æ—¶ï¼Œå®ˆæŠ¤è¿›ç¨‹ä¼šå°†å½“å‰å·¥ä½œç›®å½•æ›´æ”¹ä¸ºæ ¹ç›®å½• /ã€‚ noclose: å‚æ•°è®¾ä¸º 0 æ—¶ï¼Œå®ˆæŠ¤è¿›ç¨‹ä¼šå°†æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯é‡å®šå‘åˆ° /dev/nullï¼Œå³æ¶ˆé™¤ä¸ç»ˆç«¯çš„è¿æ¥ï¼Œæ­¤æ—¶ä»»ä½•æ¥è‡ªæ ‡å‡†æµçš„è¾“å…¥éƒ½å°†ä¸¢å¼ƒã€‚è¿™æ ·åšå¯ä»¥é¿å…è¿›ç¨‹å› ç»ˆç«¯è¾“å…¥è€Œäº§ç”Ÿçš„å¹²æ‰°ã€‚ é€šè¿‡è¿™äº›æ­¥éª¤ï¼Œå¯ä»¥æœ‰æ•ˆåœ°åˆ›å»ºå¹¶ç®¡ç†ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œç¡®ä¿å…¶èƒ½å¤Ÿåœ¨åå°å¯é åœ°è¿è¡Œï¼ŒåŒæ—¶é¿å…ä¸ç”¨æˆ·çš„äº¤äº’å¹²æ‰°è¿›ç¨‹çš„æ­£å¸¸åŠŸèƒ½ã€‚ forkè¯·é—®ä¸‹é¢çš„ç¨‹åºä¸€å…±è¾“å‡ºå¤šå°‘ä¸ªâ€-â€œï¼Ÿ #include stdio.h#include sys/types.h#include unistd.h int main(void) int i; for(i=0; i2; i++) fork(); printf(-); wait(NULL); wait(NULL); return 0; è¦åˆ†æè¿™ä¸ªç¨‹åºè¾“å‡ºå¤šå°‘ä¸ªâ€-â€œï¼Œé¦–å…ˆè¦äº†è§£ fork() å‡½æ•°çš„å·¥ä½œæ–¹å¼ã€‚fork() ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚æ¯å½“è°ƒç”¨ fork() æ—¶ï¼Œå½“å‰è¿›ç¨‹å°†è‡ªèº«å¤åˆ¶ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹æ‰§è¡Œç›¸åŒçš„ä»£ç ï¼Œä»è°ƒç”¨ fork() çš„é‚£ä¸€è¡Œå¼€å§‹ã€‚ä»¥ä¸‹æ˜¯å¯¹ç¨‹åºæµç¨‹çš„è¯¦ç»†åˆ†æï¼š åˆå§‹åŒ–ï¼šç¨‹åºä» main å‡½æ•°å¼€å§‹ï¼Œå½“ i=0 æ—¶ï¼Œå¼€å§‹æ‰§è¡Œ for å¾ªç¯ã€‚ ç¬¬ä¸€æ¬¡å¾ªç¯ï¼ˆi0ï¼‰ï¼š è°ƒç”¨ fork()ï¼Œåˆ›å»ºç¬¬ä¸€ä¸ªå­è¿›ç¨‹ã€‚ ç°åœ¨æœ‰ä¸¤ä¸ªè¿›ç¨‹ï¼ˆçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ï¼‰ï¼Œåˆ†åˆ«ç»§ç»­æ‰§è¡Œ printf(-)ã€‚ æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šè¾“å‡ºä¸€ä¸ª -ï¼Œå› æ­¤è¿™æ—¶è¾“å‡ºæ€»æ•°ä¸º 2 ä¸ª -ã€‚ ç¬¬äºŒæ¬¡å¾ªç¯ï¼ˆi1ï¼‰ï¼š ä¸¤ä¸ªè¿›ç¨‹ï¼ˆä¸Šä¸€æ­¥ä¸­åˆ›å»ºçš„ä¸¤ä¸ªè¿›ç¨‹ï¼‰å„è‡ªå†æ¬¡è°ƒç”¨ fork()ï¼Œæ¯ä¸ªè¿›ç¨‹å†åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ã€‚ çˆ¶è¿›ç¨‹ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ã€‚æ­¤æ—¶ï¼Œæ€»å…±æœ‰å››ä¸ªè¿›ç¨‹ï¼š ç¬¬ä¸€ä¸ªçˆ¶è¿›ç¨‹ ç¬¬ä¸€ä¸ªçˆ¶è¿›ç¨‹åˆ›å»ºçš„å­è¿›ç¨‹ ç¬¬äºŒä¸ªçˆ¶è¿›ç¨‹ï¼ˆç¬¬ä¸€ä¸ªå­è¿›ç¨‹ï¼‰ ç¬¬äºŒä¸ªå­è¿›ç¨‹ï¼ˆå­è¿›ç¨‹çš„å­è¿›ç¨‹ï¼‰ æ¯ä¸ªè¿›ç¨‹åœ¨è¿™æ¬¡å¾ªç¯ä¸­éƒ½è¾“å‡ºä¸€ä¸ª -ï¼Œå› æ­¤è¾“å‡ºå¢åŠ äº† 4 ä¸ª -ã€‚ å°†è¿™ä¸¤ä¸ªæ­¥éª¤çš„ç»“æœç›¸åŠ ï¼š ç¬¬ä¸€æ¬¡å¾ªç¯è¾“å‡ºï¼š2 ä¸ª - ç¬¬äºŒæ¬¡å¾ªç¯è¾“å‡ºï¼š4 ä¸ª - æœ€ç»ˆï¼Œç¨‹åºçš„æ€»è¾“å‡ºä¸º 2 + 4 6 ä¸ª -ã€‚ç¨‹åºçš„æ¯æ¬¡ fork() è°ƒç”¨éƒ½ä¼šä½¿å¾—è¿è¡Œä¸­çš„è¿›ç¨‹æ•°ç¿»å€ï¼Œæœ€ç»ˆå¯¼è‡´è¾“å‡ºç´¯ç§¯è‡³ 6 ä¸ª -ã€‚ç„¶è€Œï¼Œå®é™…æƒ…å†µå´å­˜åœ¨ä¸€äº›ç ´åå¸¸è§„çš„å› ç´ ï¼Œä½¿å¾—ç¨‹åºæ€»å…±è¾“å‡ºäº† 8 ä¸ªâ€-â€œã€‚ ç†è§£ fork() çš„ç‰¹æ€§è¦æƒ³æ¸…æ¥šä¸ºä»€ä¹ˆä¼šè¾“å‡º 8 ä¸ªâ€-â€œï¼Œé¦–å…ˆéœ€è¦ç†è§£ fork() ç³»ç»Ÿè°ƒç”¨çš„ç‰¹æ€§ã€‚æ¯æ¬¡è°ƒç”¨ fork()ï¼Œæ“ä½œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹æ˜¯è°ƒç”¨å®ƒçš„çˆ¶è¿›ç¨‹çš„å‰¯æœ¬ã€‚åœ¨è¿™æ®µä»£ç ä¸­ï¼Œè¯¥å‰¯æœ¬ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„æ‰€æœ‰çŠ¶æ€ï¼ŒåŒ…æ‹¬å®ƒçš„è¾“å‡ºç¼“å­˜ã€‚ å…·ä½“æ¥è¯´ï¼Œprintf(-); è¿™ä¸€è¯­å¥æ˜¯å°†â€-â€œæ”¾å…¥ç¼“å­˜ï¼Œè€Œä¸æ˜¯ç«‹å³è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚è¿™ä¸€ç¼“å­˜æœºåˆ¶ä½¿å¾—å½“ fork() è¢«è°ƒç”¨æ—¶ï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¸­éƒ½ä¼šå­˜åœ¨ç›¸åŒçš„è¾“å‡ºç¼“å­˜ã€‚è¿™é‡Œçš„å…³é”®åœ¨äºï¼Œè¾“å‡ºçš„æ“ä½œå°šæœªå®é™…å‘ç”Ÿï¼Œå› æ­¤äºŒè€…ä¸­éƒ½å­˜åœ¨äº†ç›¸åŒçš„å†…å®¹ã€‚ ä¾‹å¦‚ï¼Œç¬¬ä¸€æ¬¡å¾ªç¯è°ƒç”¨ fork()ï¼Œäº§ç”Ÿä¸¤ä¸ªè¿›ç¨‹ï¼ˆçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ï¼‰ï¼Œæ¥ç€å®ƒä»¬å„è‡ªæ‰§è¡Œ printf(-);ï¼Œæ­¤æ—¶ç¼“å­˜ä¸­å·²ç»å„æœ‰ä¸€ä¸ªâ€å¡«å……â€ã€‚å½“ç¬¬äºŒæ¬¡å¾ªç¯å†æ¬¡è°ƒç”¨ fork() æ—¶ï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹åˆå„è‡ªç”Ÿæˆäº†æ–°è¿›ç¨‹ã€‚æœ€ç»ˆï¼Œè¿™æ ·é€’å½’çš„æ“ä½œä¼šä½¿å¾—ç¼“å­˜ä¸­çš„ä¿¡æ¯å¤åˆ¶ç»™æ¯ä¸€ä¸ªå­è¿›ç¨‹ã€‚ å¦‚æœé‡‡ç”¨äº† wait(NULL); æ¥ç¡®ä¿çˆ¶è¿›ç¨‹åœ¨å­è¿›ç¨‹æ‰§è¡Œç»“æŸåå†ç»§ç»­ï¼Œåˆ™æ¯ä¸ªè¿›ç¨‹ä¼šåœ¨å„è‡ªçš„ç¼“å†²åŒºå†…å†æ¬¡è¾“å‡ºé‚£äº›å·²ç»ç¼“å­˜çš„â€-â€œã€‚ç”±äºç¼“å­˜è¢«å¤åˆ¶ï¼Œé‚£ä¹ˆåœ¨è¾“å‡ºç»“æŸåï¼Œæ€»å…±äº§ç”Ÿäº† 8 ä¸ªâ€-â€œã€‚ è¾“å‡ºæœºåˆ¶ä¸ç¼“å†²åŒºè¿›ä¸€æ­¥äº†è§£ Unix ä¸‹è®¾å¤‡çš„åˆ†ç±»å¯ä»¥æä¾›æ›´å¤šèƒŒæ™¯ä¿¡æ¯ã€‚Unix ç³»ç»Ÿä¸­ï¼Œè®¾å¤‡é€šå¸¸åˆ†ä¸ºä¸¤ç±»ï¼šå—è®¾å¤‡å’Œå­—ç¬¦è®¾å¤‡ã€‚å—è®¾å¤‡ï¼Œä¾‹å¦‚ç£ç›˜å’Œå†…å­˜ï¼Œå…è®¸ä»¥å—çš„å½¢å¼è¿›è¡Œæ•°æ®å­˜å–ï¼Œé€šå¸¸å¸¦æœ‰ç¼“å­˜ã€‚è€Œå­—ç¬¦è®¾å¤‡ï¼ˆå¦‚é”®ç›˜å’Œä¸²å£ï¼‰åˆ™ä¸€æ¬¡å¤„ç†ä¸€ä¸ªå­—ç¬¦ï¼Œä¸å…·å¤‡ç¼“å­˜çš„ç‰¹æ€§ã€‚ åœ¨ä¸Šé¢çš„æ¡ˆä¾‹ä¸­ï¼Œåœ¨è¾“å‡ºå­—ç¬¦æ—¶ï¼Œå¯ä»¥é¿å…å‡ºç°å¤šä½™çš„â€-â€œçš„åŠæ³•å°±æ˜¯ä¿®æ”¹ printf(-); è¿™ä¸€è¯­å¥ä¸ºï¼š printf(- ); æˆ–è€… printf(-); fflush(stdout); è¿™æ ·åšæ˜¯å› ä¸ºï¼Œå½“ç¨‹åºé‡åˆ°æ¢è¡Œç¬¦ æˆ–é€šè¿‡ fflush(stdout) æ˜ç¡®è¯·æ±‚åˆ·æ–°æ—¶ï¼Œç¼“å­˜çš„å†…å®¹ä¼šè¢«å¼ºåˆ¶è¾“å‡ºï¼Œä»è€Œé¿å…äº†å¤šä½™çš„ç¼“å­˜å¤åˆ¶ï¼Œæœ€ç»ˆåªä¼šè¾“å‡º 6 ä¸ªâ€-â€œã€‚ è¿›ä¸€æ­¥è®¤è¯† fork()fork() æ˜¯ Unix ç³»ç»Ÿä¸­åˆ›å»ºæ–°è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒæœ‰ä¸€ä¸ªæ˜¾è‘—çš„ç‰¹ç‚¹ï¼šä¸€æ¬¡è°ƒç”¨ä¼šäº§ç”Ÿä¸¤ä¸ªè¿›ç¨‹ï¼ˆçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ï¼‰ï¼Œå¹¶ä¸”æ¯ä¸ªè¿›ç¨‹éƒ½å°†ç»§ç»­æ‰§è¡Œä¹‹åçš„ä»£ç ã€‚è¿”å›å€¼ä¸º 0 æ—¶ï¼Œè¡¨ç¤ºå½“å‰è¿›ç¨‹ä¸ºå­è¿›ç¨‹ï¼›è‹¥è¿”å›å€¼å¤§äº 0ï¼Œè¯´æ˜å½“å‰è¿›ç¨‹ä¸ºçˆ¶è¿›ç¨‹ï¼Œæ­¤æ—¶è¿”å›å€¼ä¸ºå­è¿›ç¨‹çš„è¿›ç¨‹ IDã€‚ åœ¨è¿›è¡Œ fork() çš„æ—¶å€™ï¼Œçˆ¶è¿›ç¨‹çš„æ•´ä¸ªè¿è¡Œæ—¶ç¯å¢ƒä¼šè¢«å¤åˆ¶è‡³å­è¿›ç¨‹ä¸­ï¼ŒåŒ…æ‹¬å˜é‡ã€ç¼“å†²åŒºç­‰ã€‚å› æ­¤ï¼Œæ‰€æœ‰åœ¨ fork() ä¹‹å‰çš„çŠ¶æ€éƒ½ä¼šè¢«å»¶ç»­åˆ°å­è¿›ç¨‹ä¸­ã€‚ ç¤ºä¾‹ä»£ç ä¸ºäº†åŠ æ·±ç†è§£ï¼Œå¯ä»¥çœ‹ä»¥ä¸‹çš„ä»£ç ç¤ºä¾‹ï¼š #include stdio.h#include sys/types.h#include unistd.h#include wait.hint main(void) int i; for(i=0; i2; i++) fork(); printf(ppid=%d, pid=%d, i=%d , getppid(), getpid(), i); sleep(10); // è®©è¿›ç¨‹åœç•™åç§’ï¼Œä»¥ä¾¿ä½¿ç”¨ pstree æŸ¥çœ‹è¿›ç¨‹æ ‘ return 0; è¿è¡Œåï¼Œè¾“å‡ºçš„è¿›ç¨‹æ ‘å½¢çŠ¶å¦‚ä¸‹ï¼š ppid=8858, pid=8518, i=0 ppid=8858, pid=8518, i=1 ppid=8518, pid=8519, i=0 ppid=8518, pid=8519, i=1 ppid=8518, pid=8520, i=1 ppid=8519, pid=8521, i=1 ä½¿ç”¨ pstree -p | grep fork å¯ä»¥å¾—åˆ°å¦‚ä¸‹è¿›ç¨‹æ ‘ï¼Œæ˜¾ç¤ºå‡ºçˆ¶è¿›ç¨‹å’Œæ‰€æœ‰å­è¿›ç¨‹çš„å…³ç³»ï¼š |-bash(8858) |-fork(8518) |-fork(8519) `-fork(8520) é€šè¿‡è¿™æ ·çš„å¯è§†åŒ–ï¼Œä¸Šå›¾ä¸­çš„é¢œè‰²å¯ä»¥å¸®åŠ©ç†è§£è¿›ç¨‹é—´çš„å…³ç³»ã€‚æ¯ä¸ªç›¸åŒé¢œè‰²çš„è¿›ç¨‹æ˜¯ç›¸äº’å…³è”çš„ï¼Œæ˜¾è€Œæ˜“è§çš„ï¼Œæ­£æ˜¯åœ¨è¿™å¤šä¸ªè¿›ç¨‹ä¸­ï¼Œè¾“å‡ºç¼“å†²åŒºçš„å†…å®¹è¢«å¤åˆ¶ï¼Œè¿™å¯¼è‡´äº†â€-â€œçš„é‡å¤è¾“å‡ºã€‚è¿™ç§ç»†å¾®è€Œå¤æ‚çš„æœºåˆ¶æ˜¯ç†è§£è¿›ç¨‹ä¸è¾“å‡ºä¹‹é—´å…³ç³»çš„å…³é”®ã€‚ vforkåœ¨ä½¿ç”¨ vfork åˆ›å»ºçš„å­è¿›ç¨‹ä¸­ï¼Œè°ƒç”¨ return ä¼šå¯¼è‡´æ•´ä¸ªç¨‹åºå´©æºƒï¼Œè€Œä½¿ç”¨ exit() åˆ™ä¸ä¼šã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œè¿è¡Œåç¨‹åºä¼šæŒ‚æ‰ï¼Œä½†è‹¥å°†å­è¿›ç¨‹ä¸­çš„ return æ”¹ä¸º exit(0) åˆ™ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚ #include stdio.h#include stdlib.h#include unistd.hint main(void) int var; var = 88; pid_t pid; if ((pid = vfork()) 0) printf(vfork error); exit(-1); else if (pid == 0) /* å­è¿›ç¨‹ */ var++; return 0; // è¿™é‡Œä½¿ç”¨ return ä¼šå¯¼è‡´ç¨‹åºå´©æºƒ printf(pid=%d, glob=%d, var=%d , getpid(), glob, var); return 0; åŸºç¡€çŸ¥è¯†fork ä¸ vfork çš„åŒºåˆ«fork å’Œ vfork ä¸»è¦åŒºåˆ«åœ¨äºå†…å­˜å¤„ç†æ–¹å¼ã€‚fork åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶å¤åˆ¶çˆ¶è¿›ç¨‹çš„å†…å­˜æ•°æ®ï¼Œè€Œ vfork åˆ™æ˜¯åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼ŒåŒæ–¹å…±äº«çˆ¶è¿›ç¨‹çš„å†…å­˜æ•°æ®ã€‚ æ ¹æ®æ‰‹å†Œé¡µè¯´æ˜ï¼Œvfork çš„å·¥ä½œæœºåˆ¶å¦‚ä¸‹ï¼š ç¡®ä¿å­è¿›ç¨‹ä¼šä¼˜å…ˆæ‰§è¡Œã€‚ å½“å­è¿›ç¨‹è°ƒç”¨ exit() æˆ– exec() æ—¶ï¼Œçˆ¶è¿›ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚ ä¸ºä½•å¼•å…¥ vforkï¼Ÿæ—©æœŸçš„ fork éœ€è¦å¤åˆ¶å®Œæ•´çš„è°ƒç”¨è€…æ•°æ®ç©ºé—´ï¼Œèµ„æºæ¶ˆè€—å¤§ï¼Œè®¸å¤šæƒ…å†µä¸‹éšåå°±ä¼šè°ƒç”¨ exec()ã€‚å› æ­¤ï¼ŒBSD ç³»ç»Ÿæ¨å‡º vfork()ï¼Œä»¥æ›´é«˜æ•ˆçš„æ–¹å¼å…±äº«çˆ¶è¿›ç¨‹çš„å†…å­˜ã€‚ å†å²æè¿°åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œfork(2) ä½¿ç”¨å†™æ—¶å¤åˆ¶ï¼ˆcopy-on-writeï¼‰æŠ€æœ¯å®ç°ï¼Œå› æ­¤å¼€é”€ä¸»è¦æ¥è‡ªäºçˆ¶è¿›ç¨‹é¡µè¡¨çš„å¤åˆ¶ä»¥åŠå­è¿›ç¨‹çš„ä»»åŠ¡ç»“æ„çš„å”¯ä¸€åˆ›å»ºã€‚ç„¶è€Œï¼Œåœ¨æ—©æœŸç‰ˆæœ¬çš„ç³»ç»Ÿä¸­ï¼Œfork éœ€è¦å¯¹è°ƒç”¨è€…çš„æ•°æ®ç©ºé—´è¿›è¡Œå®Œæ•´å¤åˆ¶ï¼Œé€šå¸¸æ˜¯æ²¡å¿…è¦çš„ã€‚è¿™åœ¨å†…å­˜å¼€é”€ä¸Šé€ æˆäº†ä¸å¿…è¦çš„è´Ÿæ‹…ã€‚ return ä¸ exit çš„å·®å¼‚ä½¿ç”¨ return ä¼šå¯¼è‡´å­è¿›ç¨‹çš„ main() å‡½æ•°è¿”å›ï¼Œè¿›è€Œæ”¹å˜ç¨‹åºçš„å‡½æ•°æ ˆã€‚éšç€å­è¿›ç¨‹çš„ main() å‡½æ•°è¿”å›ï¼Œç›¸å…³çš„å±€éƒ¨å˜é‡è¢«é‡Šæ”¾ï¼Œæ ˆçš„çŠ¶æ€ä¹Ÿéšä¹‹å˜åŒ–ï¼Œè€Œçˆ¶è¿›ç¨‹æ­£åœ¨ç­‰å¾…å­è¿›ç¨‹çš„ç»“æŸã€‚å¦‚æœæ­¤æ—¶çˆ¶è¿›ç¨‹å°è¯•è®¿é—®çŠ¶æ€å·²æ”¹å˜çš„æ ˆï¼Œç¨‹åºå°±ä¼šå‘ç”Ÿé”™è¯¯ã€‚ å­è¿›ç¨‹çš„ main() å‡½æ•°è¿”å›ï¼Œå¯¼è‡´å‡½æ•°æ ˆç»“æ„å˜åŒ–ã€‚ main() å‡½æ•°è¿”å›ä¼šæœ€ç»ˆå¯¼è‡´è°ƒç”¨ exit() æˆ–ç±»ä¼¼çš„å‡½æ•°ã€‚ çˆ¶è¿›ç¨‹åœ¨å­è¿›ç¨‹è°ƒç”¨ exit() åæ¢å¤æ‰§è¡Œï¼Œä½†æ­¤æ—¶æ ˆå·²å› å­è¿›ç¨‹çš„è¿”å›è€ŒæŸåï¼Œå¯¼è‡´ç¨‹åºä¸å†å¯ç”¨ã€‚ å› æ­¤ï¼Œä½¿ç”¨ exit() æ˜¯æ­£ç¡®çš„æ–¹å¼ï¼Œå®ƒä¸ä¼šä¿®æ”¹çˆ¶è¿›ç¨‹çš„æ ˆå±‚æ¬¡ï¼Œä½¿çˆ¶è¿›ç¨‹å¾—ä»¥ç»§ç»­æ­£å¸¸æ‰§è¡Œã€‚è€Œå¦‚æœä½¿ç”¨ exit() å‡½æ•°ï¼Œä»æœ‰æ½œåœ¨é—®é¢˜ï¼Œå› ä¸ºå®ƒä¼šåˆ·æ–°å¹¶å…³é—­æ‰€æœ‰æ ‡å‡†è¾“å…¥è¾“å‡ºæµï¼Œå¯èƒ½å¯¼è‡´çˆ¶è¿›ç¨‹çš„æ•°æ®å—æŸã€‚ ä½¿ç”¨ _exit() ç³»ç»Ÿè°ƒç”¨æ›´æ¨èçš„é€‰æ‹©æ˜¯ä½¿ç”¨ _exit() å‡½æ•°ã€‚ä¸ exit() ä¸åŒï¼Œ_exit() ç›´æ¥ç»“æŸè¿›ç¨‹ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“çˆ¶è¿›ç¨‹çš„ IO çŠ¶æ€ã€‚å› æ­¤ï¼Œç”¨äº vfork() çš„å­è¿›ç¨‹ä¸­ï¼Œè°ƒç”¨ _exit() æ˜¯ä¸€ä¸ªæ›´å®‰å…¨çš„åšæ³•ã€‚ fork çš„ä¼˜åŒ–ä¸ºäº†æé«˜æ•ˆç‡ï¼Œfork çš„å®ç°é‡‡ç”¨äº†å†™æ—¶å¤åˆ¶ï¼ˆcopy-on-writeï¼‰æŠ€æœ¯ã€‚è¿™æ„å‘³ç€åœ¨è°ƒç”¨ fork æ—¶ï¼Œå¹¶ä¸ä¼šç«‹å³å¤åˆ¶å†…å­˜ï¼Œè€Œåªæœ‰åœ¨éœ€è¦ä¿®æ”¹æ—¶æ‰ä¼šä»çˆ¶è¿›ç¨‹ä¸­å¤åˆ¶æ•°æ®åˆ°å­è¿›ç¨‹ä¸­ã€‚è¿™ç§æŠ€æœ¯æ˜¾è‘—é™ä½äº†æ•ˆèƒ½å¼€é”€ï¼Œä½¿å¾— fork é€‚åˆåœ¨ exec è¢«è°ƒç”¨ä¹‹å‰çš„ä½¿ç”¨ã€‚ è™½ç„¶ Linux çš„æ‰‹å†Œé¡µä¸é¼“åŠ±ä½¿ç”¨ vfork()ï¼Œå› ä¸ºå®ƒå­˜åœ¨å„ç§æ½œåœ¨çš„é£é™©ï¼Œå»ºè®®å¼€å‘è€…ä¼˜å…ˆé€‰æ‹© fork()ï¼Œç‰¹åˆ«æ˜¯åœ¨ç°ä»£æ“ä½œç³»ç»Ÿçš„ä¼˜åŒ–ä¸‹ã€‚ æ€»ç»“è™½ç„¶åœ¨æŸäº›æƒ…å†µä¸‹ vfork çš„ä½¿ç”¨å¯èƒ½å¸¦æ¥æ€§èƒ½æ”¶ç›Šï¼Œä½†å…¶å¼•å…¥çš„å¤æ‚æ€§å’Œæ½œåœ¨é—®é¢˜ä½¿å¾—å®ƒä¸å¦‚ç°ä»£çš„ fork è°ƒç”¨æ¥å¾—å®‰å…¨å¯é ã€‚å°¤å…¶æ˜¯åœ¨å¤šçº¿ç¨‹æˆ–å¤æ‚æ•°æ®å¤„ç†çš„åœºæ™¯ä¸‹ï¼Œfork æä¾›äº†æ›´é«˜çš„çµæ´»æ€§å’Œç¨³å®šæ€§ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","å¤šçº¿ç¨‹"]},{"title":"è¿›ç¨‹å’Œçº¿ç¨‹","path":"/2024/06/03/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-å¤šçº¿ç¨‹-è¿›ç¨‹å’Œçº¿ç¨‹/","content":"è¿›ç¨‹æ¦‚å¿µè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿç®¡ç†èµ„æºå’Œè°ƒåº¦æ‰§è¡Œçš„åŸºæœ¬å•ä½ï¼Œå…¶æœ¬è´¨åœ¨äºèµ„æºçš„åˆ†é…ã€‚ç®€å•æ¥è¯´ï¼Œå½“ç”¨æˆ·å¯åŠ¨ä¸€ä¸ªç¨‹åºæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸ºè¯¥è¿›ç¨‹åˆ†é…æ‰€éœ€çš„èµ„æºï¼ŒåŒ…æ‹¬æ–‡ä»¶æè¿°ç¬¦ã€å†…å­˜ç©ºé—´ã€ç£ç›˜ç©ºé—´ã€è¾“å…¥è¾“å‡ºè®¾å¤‡ç­‰ã€‚è¿™ä¸€è¿‡ç¨‹ç¡®ä¿è¿›ç¨‹èƒ½å¤Ÿæœ‰æ•ˆåœ°æ‰§è¡Œå…¶ä»»åŠ¡ã€‚åˆ›å»ºä¹‹åï¼Œè¿›ç¨‹è¿›å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œç­‰å¾…æ“ä½œç³»ç»Ÿçš„è°ƒåº¦ã€‚ åœ¨å…·ä½“å®ç°ä¸­ï¼Œè¿›ç¨‹å¤šä¸ªå…³é”®å…ƒç´ ç´§å¯†ç›¸è¿ï¼Œå½¢æˆæ‰§è¡Œçš„åŸºç¡€ã€‚ä¾‹å¦‚ï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œç³»ç»Ÿå°±ä¼šä¸ºæ­¤åˆ†é…ä¸€ä¸ªè¿›ç¨‹ï¼Œç”¨æˆ·å¯ä»¥åœ¨æ­¤è¿›ç¨‹å†…è¿›è¡Œå„ç§æ“ä½œï¼Œå¦‚è¾“å…¥æ–‡æœ¬ã€æ‰“å¼€æ–‡ä»¶ç­‰ã€‚ åœ¨é‡‡ç”¨å¾®å†…æ ¸ç»“æ„çš„æ“ä½œç³»ç»Ÿï¼ˆå¦‚ MacOS å’Œ Windows NTï¼‰ä¸­ï¼Œè¿›ç¨‹çš„è§’è‰²å‘ç”Ÿäº†è½¬å˜ã€‚åœ¨è¿™äº›ç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹æ‹…å½“èµ„æºåˆ†é…çš„è§’è‰²ï¼Œè€Œçº¿ç¨‹åˆ™è´Ÿè´£å®é™…çš„è°ƒåº¦æ‰§è¡Œã€‚è¿™æ„å‘³ç€ï¼Œåœ¨å¾®å†…æ ¸è®¾è®¡ä¸­ï¼Œæ‰§è¡Œå¹¶å‘ä»»åŠ¡çš„åŸºæœ¬å•ä½æ˜¯çº¿ç¨‹ã€‚ çº¿ç¨‹æ¦‚å¿µçº¿ç¨‹æ˜¯è¿›ç¨‹å†…æ‰§è¡Œçš„æœ€å°å•å…ƒï¼Œç±»ä¼¼äºåœ¨æµç¨‹ç®¡ç†ä¸­ç»†åˆ†çš„æ­¥éª¤ã€‚å¦‚æœæŠŠè¿›ç¨‹è§†ä¸ºå®Œæˆç‰¹å®šä»»åŠ¡çš„â€å®¹å™¨â€ï¼Œé‚£ä¹ˆçº¿ç¨‹åˆ™æ˜¯è¿™äº›ä»»åŠ¡ä¸­å…·ä½“æ‰§è¡Œçš„å­ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·å¯ç”¨æ•°æ®åº“åº”ç”¨ä»¥ç”Ÿæˆå·¥èµ„å•æ—¶ï¼Œè¯¥åº”ç”¨ä¼šè¢«è§†ä¸ºä¸€ä¸ªè¿›ç¨‹ã€‚åœ¨ç”Ÿæˆå·¥èµ„å•çš„è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·å¯èƒ½ä¼šåŒæ—¶è¯·æ±‚æ•°æ®åº“ä¸­çš„å…¶ä»–ä¿¡æ¯ï¼Œè¿™äº›è¯·æ±‚è¢«è¡¨ç¤ºä¸ºè¯¥è¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹ã€‚ çº¿ç¨‹èƒ½å¤Ÿç‹¬ç«‹äºå…¶å®ƒçº¿ç¨‹åœ¨å¤„ç†å™¨ä¸Šè°ƒåº¦æ‰§è¡Œï¼Œä»è€Œåœ¨å¤šå¤„ç†å™¨ç¯å¢ƒä¸‹ï¼Œä½¿å¾—å¤šä¸ªçº¿ç¨‹å¯ä»¥å¹¶è¡Œè¿è¡Œã€‚ä¾‹å¦‚ï¼ŒæŸä¸ªæ•°æ®åº“ç¨‹åºå¯ä»¥åœ¨ä¸€ä¸ªå¤„ç†å™¨ä¸Šç”Ÿæˆå·¥èµ„æŠ¥å‘Šï¼ŒåŒæ—¶ï¼Œåœ¨å¦ä¸€ä¸ªå¤„ç†å™¨ä¸Šæ¥å—æ–°çš„ç”¨æˆ·æŸ¥è¯¢è¯·æ±‚ã€‚è¿™ç§çµæ´»æ€§å’Œå¹¶å‘ç‰¹æ€§ï¼Œå°±æ˜¯æ“ä½œç³»ç»Ÿå¼•å…¥çº¿ç¨‹çš„ä¸»è¦åŸå› ã€‚ å¼•å…¥çº¿ç¨‹çš„å¥½å¤„ æ˜“äºè°ƒåº¦ï¼šçº¿ç¨‹çš„è°ƒåº¦å’Œç®¡ç†æ¯”è¿›ç¨‹æ›´åŠ çµæ´»ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥æ›´é«˜æ•ˆåœ°å¤„ç†çº¿ç¨‹çš„åˆ›å»ºã€æ’¤é”€å’Œåˆ‡æ¢ã€‚ æé«˜å¹¶å‘æ€§ï¼šé€šè¿‡å¤šçº¿ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥å¹¶å‘æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œä»è€Œæå‡åº”ç”¨ç¨‹åºçš„å“åº”é€Ÿåº¦å’Œå¤„ç†æ•ˆç‡ã€‚ å¼€é”€å°‘ï¼šåˆ›å»ºçº¿ç¨‹æ‰€éœ€çš„èµ„æºå’Œæ—¶é—´è¿œä½äºåˆ›å»ºè¿›ç¨‹ï¼Œå› è€Œçº¿ç¨‹çš„ä½¿ç”¨æå¤§å‡è½»äº†ç³»ç»Ÿè´Ÿæ‹…ã€‚ å……åˆ†åˆ©ç”¨å¤šå¤„ç†å™¨ï¼šä¸€ä¸ªè¿›ç¨‹å¦‚æœæ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œç³»ç»Ÿå¯ä»¥å°†è¿™äº›çº¿ç¨‹åˆ†é…åˆ°ä¸åŒå¤„ç†å™¨ä¸Šå¹¶è¡Œå¤„ç†ï¼Œä»è€Œå®ç°æ›´é«˜çš„è®¡ç®—æ•ˆç‡ã€‚ è¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³» ä¸€å¯¹å¤šå…³ç³»ï¼šä¸€ä¸ªçº¿ç¨‹ä»…èƒ½å±äºä¸€ä¸ªè¿›ç¨‹ï¼Œä½†ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œä¸”å¿…å®šè‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œã€‚ èµ„æºå…±äº«ï¼šæ‰€æœ‰å±äºåŒä¸€è¿›ç¨‹çš„çº¿ç¨‹éƒ½å¯ä»¥å…±äº«è¯¥è¿›ç¨‹çš„èµ„æºï¼Œå¦‚å†…å­˜å’Œæ–‡ä»¶å¥æŸ„ã€‚ è°ƒåº¦å•ä½ï¼šCPU è°ƒåº¦çš„åŸºæœ¬å•å…ƒæ˜¯çº¿ç¨‹ï¼Œè€Œéè¿›ç¨‹ï¼Œè¿™ä½¿å¾—çº¿ç¨‹èƒ½æ›´çµæ´»åœ°åˆ©ç”¨å¤„ç†å™¨èµ„æºã€‚ åŒæ­¥ä¸åä½œï¼šåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¹‹é—´éœ€è¦åä½œä¸åŒæ­¥ã€‚ä¸åŒè¿›ç¨‹ä¸­çš„çº¿ç¨‹éœ€é€šè¿‡æ¶ˆæ¯ä¼ é€’çš„æ–¹å¼æ¥å®ç°åè°ƒã€‚ ç¨‹åºä¸è¿›ç¨‹çš„åŒºåˆ«ç¨‹åºæœ¬èº«ä¸è¿›ç¨‹ä¹‹é—´æœ‰æ‰€ä¸åŒã€‚ç¨‹åºæ˜¯ä¸€ä¸ªé™æ€çš„æŒ‡ä»¤é›†åˆï¼Œè€Œè¿›ç¨‹åˆ™æ˜¯åœ¨å†…å­˜ä¸­æ‰§è¡Œç¨‹åºæ‰€äº§ç”Ÿçš„åŠ¨æ€æ´»åŠ¨ã€‚å€ŸåŠ©äºå¤šé“ç¨‹åºè®¾è®¡ï¼Œä¸€ä¸ªæ“ä½œç³»ç»Ÿèƒ½å¤Ÿåœ¨å•ä¸ª CPU ä¸ŠåŒæ—¶æœ‰æ•ˆåœ°ç®¡ç†å¤šä¸ªè¿›ç¨‹ï¼Œè¿™æå¤§åœ°æé«˜äº†è®¡ç®—èµ„æºçš„åˆ©ç”¨ç‡ï¼Œä½¿ç”¨æˆ·æ„Ÿè§‰ä¼¼ä¹è‡ªå·±ç‹¬å èµ„æºã€‚ è¿›ç¨‹ä¸çº¿ç¨‹ä¸ºä½•å¹¶å­˜ï¼Ÿå°½ç®¡è¿›ç¨‹å…·æœ‰å¤šé“ç¨‹åºè®¾è®¡çš„ä¼˜ç‚¹ï¼Œä½¿å¾—èµ„æºå¾—ä»¥æ›´ä¸ºé«˜æ•ˆåœ°ä½¿ç”¨ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹ä¸¤ç‚¹ï¼š å¤„ç†å•ä¸€äº‹ä»¶ï¼šè¿›ç¨‹åœ¨åŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€é¡¹ä»»åŠ¡ã€‚è¿™æ„å‘³ç€å½“ä¸€ä¸ªè¿›ç¨‹é˜»å¡ï¼ˆä¾‹å¦‚ç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼‰ï¼Œæ•´ä¸ªè¿›ç¨‹å°†åœæ»ä¸å‰ï¼Œå³ä¾¿å…¶å†…æœ‰å…¶ä»–å·¥ä½œä¸å—å½±å“ã€‚ é˜»å¡æ•ˆåº”ï¼šå¦‚æœæ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹å› ä¸ºç­‰å¾…æŸä¸ªè¾“å…¥è€Œé˜»å¡ï¼Œé‚£ä¹ˆæ‰€æœ‰ä¸ä¹‹ç›¸å…³çš„æ“ä½œä¹Ÿä¼šéšä¹‹æ— æ³•æ‰§è¡Œã€‚æ¯”å¦‚åœ¨è¯¾å ‚ä¸Šï¼Œè€å¸ˆåœ¨é»‘æ¿ä¸Šè®²è§£ï¼Œå­¦ç”Ÿå› ç­‰å¾…è€å¸ˆå®Œæˆï¼Œä¸Šè¿°å¤šä¸ªä»»åŠ¡ï¼ˆå¬è®²ã€è®°ç¬”è®°ã€æ€è€ƒï¼‰éƒ½æ— æ³•å¾—ä»¥å¹¶è¡Œè¿›è¡Œã€‚ é€šè¿‡å¼•å…¥çº¿ç¨‹ï¼Œè¿™äº›é—®é¢˜å¾—ä»¥è§£å†³ã€‚ä¸åŒçš„çº¿ç¨‹å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œæå‡äº†å¹¶è¡Œå¤„ç†çš„èƒ½åŠ›ï¼Œä»è€Œæ˜¾è‘—æé«˜å·¥ä½œæ•ˆç‡ã€‚ çº¿ç¨‹çš„ä¼˜ç‚¹çº¿ç¨‹çš„åŠ å…¥ä½¿å¾—è¿›ç¨‹çš„å®ç°å½¢å¼æ›´åŠ çµæ´»ã€‚å®ƒå…è®¸åœ¨æ›´ä½çš„çº§åˆ«å®ç°å¹¶å‘ï¼Œä½¿å¾—å„è¿‡ç¨‹é—´çš„æ‰§è¡Œæ­¥ä¼ä¸å†å•ä¸€ã€‚å…·ä½“æ¥è¯´ï¼Œçº¿ç¨‹èƒ½å¤Ÿä¸å¤šä¸ªæ ¸çš„å¤„ç†å™¨ååŒå·¥ä½œï¼Œä»¥è¿›ä¸€æ­¥æå‡åº”ç”¨çš„æ€§èƒ½è¡¨ç°ã€‚ä¾‹å¦‚ï¼Œç°ä»£æ–‡å­—å¤„ç†è½¯ä»¶å¦‚ Wordï¼Œé€šå¸¸ä¼šå¼€å¯å¤šä¸ªçº¿ç¨‹æ¥åŒæ—¶è¿›è¡Œä¸åŒçš„æ“ä½œï¼Œä¸€ä¸ªå¤„ç†ç”¨æˆ·è¾“å…¥ï¼Œä¸€ä¸ªè´Ÿè´£ç•Œé¢æ˜¾ç¤ºï¼Œå¦ä¸€ä¸ªè¿›è¡Œæ–‡ä»¶å­˜ç›˜ã€‚è¿™ç§è®¾è®¡æ— ç–‘æå‡äº†ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒï¼Œè®©äººæ„Ÿè§‰æ“ä½œæµç•…ã€ååº”è¿…é€Ÿã€‚ è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«æ€»ç»“è¿›ç¨‹ä¸çº¿ç¨‹çš„æ ¸å¿ƒåŒºåˆ«åœ¨äºå®ƒä»¬å¤„ç†èµ„æºçš„æ–¹å¼ã€‚è¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œå› æ­¤åœ¨å…¶å´©æºƒæ—¶ï¼Œä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹ã€‚è€Œçº¿ç¨‹åˆ™æ˜¯åœ¨åŒä¸€è¿›ç¨‹å†…æ‰§è¡Œçš„å¤šæ¡è·¯å¾„ï¼Œè™½å„è‡ªæ‹¥æœ‰å †æ ˆå’Œå±€éƒ¨å˜é‡ï¼Œä½†éƒ½å…±äº«è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚è¿™æ„å‘³ç€è‹¥ä¸€ä¸ªçº¿ç¨‹å¤±è´¥ï¼Œæ•´ä¸ªè¿›ç¨‹ä¹Ÿä¼šéšä¹‹å´©æºƒã€‚ è™½ç„¶å¤šè¿›ç¨‹çš„æ–¹æ¡ˆæ›´ä¸ºç¨³å¥ï¼Œä½†åœ¨èµ„æºåˆ‡æ¢æ—¶ä¼šäº§ç”Ÿè¾ƒå¤§çš„å¼€é”€ã€‚è€Œåœ¨éœ€è¦å…±äº«å˜é‡çš„å¹¶å‘æ“ä½œä¸­ï¼Œä½¿ç”¨çº¿ç¨‹æ›´èƒ½å‘æŒ¥ä¼˜åŠ¿ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿›ç¨‹ä¸çº¿ç¨‹çš„å¹¶å­˜æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚ è¿›ç¨‹çš„å®šä¹‰è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚æ¯å½“æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œæ“ä½œç³»ç»Ÿä¾¿ä¼šç›¸åº”åœ°åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ“ä½œç³»ç»Ÿå°†è´Ÿè´£ç®¡ç†ç›¸å…³èµ„æºçš„åˆ†é…ä¸é‡Šæ”¾ï¼Œå› æ­¤å¯ä»¥æŠŠè¿›ç¨‹çœ‹æˆæ˜¯ç¨‹åºæ‰§è¡Œçš„ä¸€ä¸ªåŠ¨æ€è¿‡ç¨‹ã€‚æ¯”å¦‚ï¼Œæ‰“å¼€ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œç³»ç»Ÿåœ¨åå°åˆ›å»ºäº†ä¸€ä¸ªè¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹è´Ÿè´£å¤„ç†æ‰€æœ‰ä¸æ–‡æœ¬ç¼–è¾‘ç›¸å…³çš„æ“ä½œï¼Œå¦‚è¾“å…¥ã€ä¿å­˜å’Œæ ¼å¼åŒ–ã€‚ è¿›ç¨‹ä¸ç¨‹åºçš„åŒºåˆ«ç¨‹åºæ˜¯é™æ€çš„ï¼Œå®ƒç”±å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ç»“æ„åŒ–æŒ‡ä»¤ç»„æˆï¼Œåƒä¸€æœ¬è¿˜æœªç¿»å¼€çš„ä¹¦ï¼Œæ²¡æœ‰å…·ä½“çš„æ‰§è¡ŒçŠ¶æ€ã€‚ç›¸å¯¹åº”åœ°ï¼Œè¿›ç¨‹åˆ™æ˜¯ä¸€ä¸ªåŠ¨æ€æ¦‚å¿µï¼Œæ¶‰åŠåˆ°ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ï¼ŒåŒ…æ‹¬åˆ›å»ºã€è°ƒåº¦ä»¥åŠæœ€ç»ˆæ¶ˆäº¡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå°†ä¸€ä¸ªç½‘é¡µåŠ è½½åˆ°æµè§ˆå™¨ä¸­æ—¶ï¼Œæµè§ˆå™¨ä¼šä¸ºè¯¥ç½‘é¡µåˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œè¯¥ç½‘é¡µçš„ä»£ç å°±æ˜¯ç¨‹åºã€‚ç¨‹åºåœ¨ç¡¬ç›˜ä¸Šä¿æŒä¸å˜ï¼Œè€Œè¿›ç¨‹çš„çŠ¶æ€åˆ™éšç€æ‰§è¡Œè€Œå˜åŒ–ã€‚ Linux è¿›ç¨‹çš„å››å¤§è¦ç´  æ‰§è¡Œçš„ç¨‹åºï¼šè¿™æ˜¯ä¾›è¿›ç¨‹æ‰§è¡Œçš„å…·ä½“ä»£ç ï¼Œå¤šä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶æ‰§è¡ŒåŒä¸€ä¸ªç¨‹åºï¼Œæ¯”å¦‚å¤šä¸ªå®ä¾‹çš„ç½‘ç»œæµè§ˆå™¨å¯ä»¥åŒæ—¶åœ¨è¿è¡ŒåŒä¸€æ¬¾æµè§ˆå™¨è½¯ä»¶ã€‚ ç‹¬ç«‹çš„å†…æ ¸å †æ ˆï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰å®ƒè‡ªå·±çš„å†…æ ¸å †æ ˆï¼Œç”¨äºç®¡ç†ç³»ç»Ÿè°ƒç”¨æ—¶çš„èµ„æºï¼Œè¿™æ„å‘³ç€ä¸åŒè¿›ç¨‹ä¹‹é—´ä¸å…±äº«å †æ ˆï¼Œé¿å…äº†æ•°æ®å†²çªã€‚ è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCBï¼‰ï¼šåœ¨ Linux ä¸­ï¼Œè¿›ç¨‹æ§åˆ¶å—è¢«ç§°ä¸º task_structã€‚å®ƒæ˜¯ç³»ç»Ÿç®¡ç†è¿›ç¨‹çš„åŸºç¡€æ•°æ®ç»“æ„ï¼Œè®°å½•äº†è¿›ç¨‹çš„æ‰€æœ‰å¿…è¦ä¿¡æ¯ï¼Œå¦‚è¿›ç¨‹çŠ¶æ€ã€ç¨‹åºè®¡æ•°å™¨ã€å†…å­˜é™åˆ¶ç­‰ã€‚è¿™ä½¿å¾—æ“ä½œç³»ç»Ÿèƒ½å¤Ÿé«˜æ•ˆåœ°è°ƒåº¦å’Œç®¡ç†è¿›ç¨‹ã€‚ ç‹¬ç«‹çš„å­˜å‚¨ç©ºé—´ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„ç”¨æˆ·ç©ºé—´ï¼Œä»¥é¿å…å†…å­˜å†²çªå’Œå®‰å…¨é—®é¢˜ã€‚é™¤äº†å†…æ ¸ç©ºé—´ï¼Œè¿›ç¨‹æ‰€å ç”¨çš„ç”¨æˆ·ç©ºé—´ä¿è¯äº†ç¨‹åºå¯ä»¥åœ¨ç‹¬ç«‹çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œä¸ä¼šå¹²æ‰°å…¶ä»–è¿›ç¨‹ã€‚ å¯¹åº”äºè¿›ç¨‹ï¼Œçº¿ç¨‹åªæœ‰å‰ä¸‰ä¸ªå…ƒç´ ï¼Œæ²¡æœ‰ç‹¬ç«‹çš„å­˜å‚¨ç©ºé—´ã€‚å¦ä¸€æ–¹é¢ï¼Œ å†…æ ¸çº¿ç¨‹ï¼šæ²¡æœ‰ç”¨æˆ·ç©ºé—´ï¼Œå®Œå…¨ç”±å†…æ ¸ç®¡ç†ï¼Œé€‚ç”¨äºå†…æ ¸ä¸­çš„å¤šä»»åŠ¡å¤„ç†ã€‚ ç”¨æˆ·çº¿ç¨‹ï¼šåˆ™æ˜¯å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ç”¨æˆ·ç©ºé—´ï¼Œé€‚åˆè½»é‡çº§çš„ä»»åŠ¡ã€‚ Linux è¿›ç¨‹åˆ†ç±» äº¤äº’å¼è¿›ç¨‹ï¼šè¿™äº›è¿›ç¨‹é€šå¸¸ç”± Shell å¯åŠ¨ï¼Œé¢‘ç¹ä¸ç”¨æˆ·äº¤äº’ï¼Œå› æ­¤éœ€è¦è¿…é€Ÿå“åº”ç”¨æˆ·æ“ä½œã€‚å»¶è¿Ÿæ—¶é—´é€šå¸¸è¦æ±‚åœ¨ 50 åˆ° 150 æ¯«ç§’å†…ã€‚ä¾‹å¦‚ï¼Œç»ˆç«¯å‘½ä»¤è¡Œã€æ–‡æœ¬ç¼–è¾‘å™¨åŠå›¾å½¢ç•Œé¢åº”ç”¨ç¨‹åºéƒ½æ˜¯å…¸å‹çš„äº¤äº’å¼è¿›ç¨‹ã€‚ æ‰¹å¤„ç†è¿›ç¨‹ï¼šé€šå¸¸åœ¨åå°è¿è¡Œï¼Œä¸éœ€è¦ç”¨æˆ·ç›´æ¥äº¤äº’ï¼Œå› æ­¤å¯¹ååº”é€Ÿåº¦çš„è¦æ±‚ä¸é‚£ä¹ˆä¸¥æ ¼ã€‚è¿™ç±»è¿›ç¨‹å¸¸å¸¸ä¼šè¢«è°ƒåº¦æœŸé™åˆ¶ã€‚ä¾‹å¦‚ï¼Œç¼–è¯‘ç¨‹åºã€æ•°æ®åº“æœç´¢å¼•æ“ä»¥åŠç§‘å­¦è®¡ç®—åº”ç”¨ç¨‹åºéƒ½æ˜¯ç»å…¸çš„æ‰¹å¤„ç†è¿›ç¨‹æ¡ˆä¾‹ã€‚ å®æ—¶è¿›ç¨‹ï¼šæ­¤ç±»è¿›ç¨‹å¯¹è°ƒåº¦æœ‰æå…¶ä¸¥æ ¼çš„è¦æ±‚ï¼Œä¸èƒ½è¢«ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹é˜»å¡ï¼Œéœ€è¦åœ¨çŸ­æ—¶é—´å†…åšå‡ºååº”ã€‚éŸ³è§†é¢‘å¤„ç†ã€æœºå™¨äººæ§åˆ¶ç­‰åº”ç”¨éƒ½å±äºå®æ—¶è¿›ç¨‹ã€‚å®æ—¶è¿›ç¨‹çš„è°ƒåº¦å®Œå…¨ä¾èµ–äº Linux çš„è°ƒåº¦ç®—æ³•ã€‚ æ‰¹å¤„ç†è¿›ç¨‹å¯èƒ½æ¶‰åŠ IO æˆ– CPUï¼Œè€Œå®æ—¶è¿›ç¨‹åˆ™æ›´åŠ ä¾§é‡äºæ—¶é—´çš„æ•æ„Ÿåº¦ã€‚ Linux è¿›ç¨‹ä¼˜å…ˆçº§ é™æ€ä¼˜å…ˆçº§ï¼ˆpriorityï¼‰ï¼šé™æ€ä¼˜å…ˆçº§ä¸éšæ—¶é—´å˜åŠ¨ï¼Œå†…æ ¸ä¸ä¼šä¸»åŠ¨ä¿®æ”¹ã€‚å®ƒæ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨ nice è¿›è¡Œä¿®æ”¹ï¼ŒæŒ‡æ˜è¯¥è¿›ç¨‹åœ¨ä¸å…¶ä»–è¿›ç¨‹ç«äº‰ CPU æ—¶æ‰€å…è®¸çš„æœ€å¤§æ—¶é—´ç‰‡ï¼Œä¸€èˆ¬é»˜è®¤ä¸º 20ã€‚æ¯ä¸€ä¸ªæ™®é€šè¿›ç¨‹çš„é™æ€ä¼˜å…ˆçº§èŒƒå›´ä» 100ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰åˆ° 139ï¼ˆä½ä¼˜å…ˆçº§ï¼‰ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹æ—¶ï¼Œé€šå¸¸ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œä½†ç”¨æˆ·å¯ä»¥é€šè¿‡ nice() æˆ–è€… setpriority() ç³»ç»Ÿè°ƒç”¨æ”¹å˜è¿™ä¸ªä¼˜å…ˆçº§ã€‚ åŠ¨æ€ä¼˜å…ˆçº§ï¼ˆcounterï¼‰ï¼šåŠ¨æ€ä¼˜å…ˆçº§æ˜¯ç”±ç³»ç»Ÿä¸ºæ¯ä¸ªè¿›ç¨‹è¿è¡Œè€Œåˆ†é…çš„æ—¶é—´ç‰‡ã€‚åªè¦è¿›ç¨‹å ç”¨ CPUï¼ŒåŠ¨æ€ä¼˜å…ˆçº§å°±ä¼šä¸æ–­å‡å°ï¼Œç›´åˆ°è¾¾åˆ° 0 æ—¶ï¼Œè¿›ç¨‹å°†é‡æ–°è°ƒåº¦ã€‚åˆå§‹åŠ¨æ€ä¼˜å…ˆçº§ä¸º 20ã€‚è°ƒåº¦å™¨åœ¨è¿›è¡Œè°ƒåº¦æ—¶ä¸»è¦ä¾æ®åŠ¨æ€ä¼˜å…ˆçº§ï¼Œå…¶å€¼åœ¨ 100 åˆ° 139 ä¹‹é—´ã€‚åŠ¨æ€ä¼˜å…ˆçº§çš„è®¡ç®—å…¬å¼ä¸ºï¼š Dynamic priority = max(100, min(static priority - bonus + 5, 139)) å…¶ä¸­ï¼ŒBonus çš„å€¼åœ¨ 0-10 ä¹‹é—´ï¼Œå¯ä»¥å› ä¸ºè¿›ç¨‹çš„å¹³å‡ç¡çœ æ—¶é—´è€Œæ³¢åŠ¨ï¼Œå½±å“åŠ¨æ€ä¼˜å…ˆçº§çš„æå‡æˆ–é™ä½ã€‚ å®æ—¶ä¼˜å…ˆçº§ï¼ˆrt_priorityï¼‰ï¼šå®æ—¶ä¼˜å…ˆçº§å€¼ä¸º 1000ï¼Œä»…åœ¨å®æ—¶è¿›ç¨‹ä¸­ç”Ÿæ•ˆã€‚Linux å°†å®æ—¶ä¼˜å…ˆçº§ä¸ counter å€¼ç›¸åŠ ï¼Œä»¥ç”Ÿæˆå®æ—¶è¿›ç¨‹çš„ä¼˜å…ˆæƒå€¼ã€‚ç»å¯¹é«˜çš„æƒå€¼ä¿è¯äº†å®æ—¶è¿›ç¨‹çš„ä¼˜å…ˆè°ƒåº¦ï¼Œå³ä¾¿åœ¨å…¶ä»–è¿›ç¨‹åŒæ—¶è¿è¡Œçš„æƒ…å†µä¸‹ã€‚ åŸºç¡€æ—¶é—´é‡å­ï¼ˆBase time quantumï¼‰ï¼šç”±é™æ€ä¼˜å…ˆçº§å†³å®šã€‚å½“ä¸€ä¸ªè¿›ç¨‹è€—å°½å½“å‰çš„åŸºç¡€æ—¶é—´é‡å­ï¼Œå†…æ ¸å°†é‡æ–°åˆ†é…ä¸€ä¸ªæ–°çš„åŸºç¡€æ—¶é—´é‡å­ã€‚é™æ€ä¼˜å…ˆçº§ä¸åŸºç¡€æ—¶é—´é‡å­çš„å…³ç³»å¦‚ä¸‹ï¼š å½“é™æ€ä¼˜å…ˆçº§å°äº 120 æ—¶ï¼š Base time quantum (æ¯«ç§’) = (140 - static priority) * 20 å½“é™æ€ä¼˜å…ˆçº§å¤§äºæˆ–ç­‰äº 120 æ—¶ï¼š Base time quantum (æ¯«ç§’) = (140 - static priority) * 5 Linux è¿›ç¨‹åˆ›å»ºè¿‡ç¨‹åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹æ˜¯ä¸€ä¸ªåŒ…å«ä»£ç ã€æ•°æ®åŠåˆ†é…ç»™å®ƒçš„å„ç§èµ„æºçš„å®ä½“ã€‚åˆ›å»ºè¿›ç¨‹çš„ä¸»è¦æ–¹å¼æ˜¯ä½¿ç”¨ fork() å‡½æ•°ã€‚è¿™ä¸ªç³»ç»Ÿè°ƒç”¨èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªå‡ ä¹å®Œå…¨ç›¸åŒçš„æ–°è¿›ç¨‹ï¼Œç§°ä¸ºå­è¿›ç¨‹ã€‚ä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹å¯ä»¥æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œä½†ç”±äºåˆå§‹å‚æ•°æˆ–å˜é‡çš„ä¸åŒï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚è°ƒç”¨ fork() åï¼Œç³»ç»Ÿå°†ä¸ºæ–°çš„è¿›ç¨‹åˆ†é…èµ„æºï¼ŒåŒ…æ‹¬å­˜å‚¨ä»£ç å’Œæ•°æ®çš„å†…å­˜ç©ºé—´ã€‚éšåï¼ŒåŸæœ‰è¿›ç¨‹çš„æ‰€æœ‰å€¼éƒ½ä¼šè¢«å¤åˆ¶åˆ°æ–°è¿›ç¨‹ä¸­ï¼Œåªæœ‰æå°‘æ•°çš„å€¼åœ¨å¤åˆ¶æ—¶ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸€è¿‡ç¨‹ç±»ä¼¼äºå…‹éš†ã€‚ å¤åˆ¶è¿›ç¨‹æ§åˆ¶å—ï¼ˆProcess Control Blockï¼ŒPCBï¼‰ï¼Œåœ¨ Linux ä¸­å¯¹åº”çš„ç»“æ„ä½“æ˜¯ task_structã€‚ ä¸ºæ–°è¿›ç¨‹åˆ†é…ä¸€ä¸ªæ–°çš„å†…æ ¸å †æ ˆã€‚è°ƒç”¨å¦‚ä¸‹å‡½æ•°ï¼š ti = alloc_thread_info_node(tsk, node);tsk-stack = ti;setup_thread_stack(tsk, orig); æ³¨æ„ï¼Œè¿™é‡Œåªæ˜¯å¤åˆ¶ thread_info ç»“æ„ï¼Œè€Œå¹¶ä¸æ˜¯ç›´æ¥å¤åˆ¶å†…æ ¸å †æ ˆæœ¬èº«ã€‚ ä¿®æ”¹å¤åˆ¶çš„è¿›ç¨‹æ•°æ®ï¼Œæ¯”å¦‚è¿›ç¨‹æ ‡è¯†ç¬¦ï¼ˆPIDï¼‰å’Œè¿›ç¨‹é“¾è¡¨ç­‰ï¼Œè¿™äº›å¤„ç†åœ¨ copy_process å‡½æ•°å†…éƒ¨å®Œæˆã€‚ ä¾‹å¦‚ï¼Œ*childregs = *current_pt_regs(); å¤åˆ¶å½“å‰çš„å†…æ ¸å †æ ˆå†…å®¹ã€‚ childregs-ax = 0; è¡¨ç¤ºå­è¿›ç¨‹çš„ fork() è°ƒç”¨è¿”å› 0ã€‚ p-thread.sp = (unsigned long) childregs; è®¾ç½®è°ƒåº¦åˆ°å­è¿›ç¨‹æ—¶çš„å†…æ ¸å †æ ˆé¡¶ã€‚ p-thread.ip = (unsigned long) ret_from_fork; è®¾ç½®è°ƒåº¦åˆ°å­è¿›ç¨‹æ—¶çš„ç¬¬ä¸€æ¡æŒ‡ä»¤åœ°å€ã€‚ å…·ä½“çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæ¯”å¦‚ sys_forkã€sys_vfork å’Œ sys_cloneï¼Œæœ€ç»ˆéƒ½æ˜¯åœ¨ do_fork å‡½æ•°ä¸­æ‰§è¡Œã€‚è¿™ä¸ªå‡½æ•°ä¸­åŒ…å«ï¼š copy_process dup_task_structï¼šå¤åˆ¶ PCBã€‚ alloc_thread_info_nodeï¼šåˆ†é…äº†ä¸€ä¸ªå†…å­˜é¡µé¢ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸ºå†…æ ¸å †æ ˆç©ºé—´æä¾›ã€‚ setup_thread_stackï¼šå°† thread_info ç›¸å…³æ•°æ®å¤åˆ¶è¿‡æ¥ã€‚ æ–°è¿›ç¨‹çš„æ‰§è¡Œèµ·å§‹åœ°å€æ˜¯ ret_from_forkã€‚*childregs = *current_pt_regs(); ç”¨äºå¤åˆ¶å½“å‰å†…æ ¸å †æ ˆçš„çŠ¶æ€ï¼ˆå³ pt_regsï¼‰ï¼Œè¿™æ˜¯ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ä¸­æ ˆä¸­çš„éƒ¨åˆ†ã€‚ç”±äº childregs-ax = 0; çš„è®¾ç½®ï¼Œå­è¿›ç¨‹åœ¨ fork() è¿”å›æ—¶è·å¾—ä¸€ä¸ªè¿”å›å€¼ 0ã€‚æ¥ä¸‹æ¥ï¼Œç³»ç»Ÿå°†è¿›ç¨‹è°ƒåº¦åˆ° ret_from_forkï¼Œè¿™æ„å‘³ç€æ–°è¿›ç¨‹æ˜¯ä»è¯¥åœ°å€å¼€å§‹æ‰§è¡Œã€‚ Linux ç³»ç»Ÿä¸­è¿›ç¨‹çš„è¡¨ç¤ºåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½ç”±ä¸€ä¸ªç§°ä¸º task_struct çš„ç»“æ„ä½“è¿›è¡Œæè¿°ã€‚è¿™ä¸€ç»“æ„ä½“è®°å½•äº†è¿›ç¨‹çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬å¤šä¸ªæ ¸å¿ƒå­—æ®µã€‚ä»¥ä¸‹æ˜¯ä¸€äº›é‡è¦çš„å­—æ®µï¼š struct task_struct volatile long state; // è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ unsigned int flags; // è¿›ç¨‹çš„çŠ¶æ€æ ‡å¿— unsigned int rt_priority; // è¿›ç¨‹çš„è¿è¡Œä¼˜å…ˆçº§ struct mm_struct *mm; // è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ pid_t pid; // è¿›ç¨‹å·ï¼Œå”¯ä¸€æ ‡è¯† pid_t tgid; // è¿›ç¨‹ç»„å· struct task_struct *real_parent; // è¯¥è¿›ç¨‹çš„çœŸå®çˆ¶è¿›ç¨‹ struct task_struct *parent; // å½“å‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ struct list_head children; // å­è¿›ç¨‹çš„é“¾è¡¨ struct list_head sibling; // å…„å¼Ÿè¿›ç¨‹çš„é“¾è¡¨ struct task_struct *group_leader; // ä¸»çº¿ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ struct list_head thread_group; // è¯¥è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹çš„é“¾è¡¨ cputime_t utime, stime; // ç”¨æˆ·æ€å’Œå†…æ ¸æ€æ‰§è¡Œæ—¶é—´ char comm[TASK_COMM_LEN]; // è¿›ç¨‹åç§° struct files_struct *files; // æ‰“å¼€çš„æ–‡ä»¶ä¿¡æ¯ struct signal_struct *signal; // ä¿¡å·å¤„ç†ä¿¡æ¯ struct sigband_struct *sighand; // ä¿¡å·å¤„ç†å¥æŸ„; å…¶ä¸­ï¼Œç»“æ„ä½“å­—æ®µçš„å«ä¹‰å¦‚ä¸‹ï¼š **è¿›ç¨‹å· (pid)**ï¼šç›¸å½“äºæ¯ä¸ªè¿›ç¨‹çš„èº«ä»½è¯ï¼Œå®ƒæ˜¯è¿›ç¨‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæ¯ä¸ªè¿›ç¨‹çš„ PID éƒ½æ˜¯ç‹¬ç‰¹çš„ã€‚ è¿›ç¨‹çŠ¶æ€ï¼šæ ‡è¯†è¿›ç¨‹å½“å‰å¤„äºè¿è¡Œã€ç­‰å¾…ã€åœæ­¢æˆ–æ­»äº¡ï¼š A. è¿è¡Œæ€ï¼šæ­£åœ¨è¿è¡Œæˆ–å‡†å¤‡è¿è¡Œçš„çŠ¶æ€ã€‚ B. ç­‰å¾…æ€ï¼šè¿›ç¨‹åœ¨ç­‰å¾…æŸä¸ªäº‹ä»¶æˆ–èµ„æºã€‚ C. åœæ­¢æ€ï¼šè¿›ç¨‹å·²è¢«ç»ˆæ­¢ã€‚ D. æ­»äº¡æ€ï¼šå·²ç»ˆæ­¢ä½†ä»å ç”¨ task_structã€‚ ä¼˜å…ˆçº§ä¸æ—¶é—´ç‰‡ï¼šä¸åŒä¼˜å…ˆçº§çš„è¿›ç¨‹è¢«è°ƒåº¦æ‰§è¡Œçš„é¡ºåºä¼šæœ‰æ‰€ä¸åŒï¼Œä¸€èˆ¬è¾ƒé«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ä¼šä¼˜å…ˆè¿è¡Œã€‚æ—¶é—´ç‰‡åˆ™æŒ‡å®šäº†è¿›ç¨‹åœ¨å¤„ç†å™¨ä¸Šè¢«æ‰§è¡Œçš„æ—¶é—´ã€‚ è™šæ‹Ÿå†…å­˜ï¼šè®¸å¤šè¿›ç¨‹ä¼šæœ‰ä¸€äº›è™šæ‹Ÿå†…å­˜ï¼Œè€Œå†…æ ¸çº¿ç¨‹å’Œå®ˆæŠ¤è¿›ç¨‹é€šå¸¸æ²¡æœ‰ã€‚Linux å†…æ ¸å¿…é¡»è·Ÿè¸ªè¿™äº›è™šæ‹Ÿå†…å­˜å¦‚ä½•æ˜ å°„åˆ°ç‰©ç†å†…å­˜ã€‚ å¤„ç†å™¨ä¸Šä¸‹æ–‡ï¼šä¸€ä¸ªè¿›ç¨‹å¯ä»¥çœ‹ä½œæ˜¯ç³»ç»ŸçŠ¶æ€çš„é›†åˆã€‚åœ¨è¿›ç¨‹æ‰§è¡Œæ—¶ï¼Œéœ€è¦ä½¿ç”¨å¤„ç†å™¨çš„å¯„å­˜å™¨å’Œå †æ ˆç­‰ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å½“è¿›ç¨‹æš‚åœæ—¶ï¼Œæ‰€æœ‰ CPU ç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯éƒ½ä¼šè¢«ä¿å­˜åœ¨è¯¥è¿›ç¨‹çš„ task_struct ä¸­ã€‚é‡æ–°è°ƒåº¦è¿›ç¨‹æ—¶ï¼Œè¿™äº›ä¸Šä¸‹æ–‡ä¿¡æ¯ä¾¿ä¼šä»è¯¥ç»“æ„ä¸­æ¢å¤ã€‚ Linux è¿›ç¨‹ä¸­çš„æ–‡ä»¶åœ¨ Linux æ“ä½œç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸¤ä¸ªç»“æ„ä½“ç”¨æ¥æè¿°ä¸æ–‡ä»¶ç›¸å…³çš„ä¿¡æ¯ã€‚ ç¬¬ä¸€ä¸ªæ˜¯ fs_structï¼Œå®ƒåŒ…å«äº†è¿›ç¨‹å½“å‰çš„å·¥ä½œç›®å½•ã€æ ¹ç›®å½•ä»¥åŠ umaskã€‚umask å®šä¹‰äº†æ–°æ–‡ä»¶åˆ›å»ºæ—¶çš„é»˜è®¤æƒé™ã€‚é€šè¿‡ç³»ç»Ÿè°ƒç”¨å¯ä»¥ä¿®æ”¹ umaskã€‚ ç¬¬äºŒä¸ªæ˜¯ files_structï¼Œå®ƒè®°å½•äº†è¿›ç¨‹å½“å‰æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶çš„ä¿¡æ¯ã€‚f_mode å­—æ®µç”¨äºæè¿°æ–‡ä»¶çš„æ‰“å¼€æ¨¡å¼ï¼ˆåªè¯»ã€è¯»å†™æˆ–åªå†™ï¼‰ã€‚æ­¤å¤–ï¼Œf_pos è¡¨ç¤ºä¸‹ä¸€ä¸ªè¯»æˆ–å†™æ“ä½œåœ¨æ–‡ä»¶ä¸­çš„ä½ç½®ã€‚f_inode æè¿°äº†æ–‡ä»¶çš„ VFS ï¼ˆè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼‰ç´¢å¼•èŠ‚ç‚¹ï¼Œè€Œ f_ops åˆ™æ˜¯ä¸€ä¸ªæŒ‡å‘æ“ä½œä¾‹ç¨‹çš„æŒ‡é’ˆï¼Œæ¯ä¸ªæ“ä½œä¾‹ç¨‹å¯¹åº”æ–‡ä»¶çš„ç‰¹å®šæ“ä½œã€‚ æ¯å½“ä¸€ä¸ªæ–‡ä»¶è¢«æ‰“å¼€æ—¶ï¼Œfiles_struct ä¸­çš„ç©ºé—²æ–‡ä»¶æŒ‡é’ˆä¹‹ä¸€ä¾¿ä¼šè¢«ç”¨äºæŒ‡å‘æ–°çš„æ–‡ä»¶ç»“æ„ã€‚Linux è¿›ç¨‹åœ¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ‰“å¼€ä¸‰ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œåˆ†åˆ«æ˜¯æ ‡å‡†è¾“å…¥ (stdin)ã€æ ‡å‡†è¾“å‡º (stdout) å’Œæ ‡å‡†é”™è¯¯ (stderr)ï¼Œè¿™äº›æè¿°ç¬¦é€šå¸¸æ˜¯ä»åˆ›å»ºè¯¥è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ç»§æ‰¿è€Œæ¥çš„ã€‚æ‰€æœ‰å¯¹æ–‡ä»¶çš„è®¿é—®éƒ½æ˜¯é€šè¿‡ä¼ é€’æˆ–è¿”å›æ–‡ä»¶æè¿°ç¬¦æ¥å®Œæˆçš„ï¼Œè¿™äº›æè¿°ç¬¦ç´¢å¼•äº†è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦å‘é‡ï¼Œå› æ­¤æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦åˆ†åˆ«ä¸º 0ã€1 å’Œ 2ã€‚ è¿›ç¨‹ä¸­çš„è™šæ‹Ÿå†…å­˜åœ¨ Linux æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿è¡ŒäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ã€‚å¦‚æœå°†æ•´ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„ä»£ç å’Œæ•°æ®å…¨éƒ¨åŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸­ï¼Œä¼šé€ æˆä¸å¿…è¦çš„èµ„æºæµªè´¹ï¼Œå› ä¸ºå®ƒä»¬ä¸å¯èƒ½åŒæ—¶ä½¿ç”¨ã€‚éšç€ç³»ç»Ÿä¸­è¿›ç¨‹æ•°é‡çš„å¢åŠ ï¼Œè¿™ç§æµªè´¹ä¼šè¢«æ”¾å¤§ï¼Œä»è€Œå¯¼è‡´ç³»ç»Ÿæ•ˆç‡ä¸‹é™ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒLinux ä½¿ç”¨äº†ä¸€ç§ç§°ä¸º è¯·æ±‚è°ƒé¡µï¼ˆdemand-pagingï¼‰ çš„æŠ€æœ¯ã€‚å…·ä½“è€Œè¨€ï¼Œç³»ç»Ÿåªåœ¨è¿›ç¨‹éœ€è¦ä½¿ç”¨å…¶è™šæ‹Ÿå†…å­˜æ—¶ï¼Œæ‰ä¼šå®é™…å°†ç›¸å…³æ•°æ®åŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸­ã€‚å› æ­¤ç³»ç»Ÿå¹¶ä¸ä¼šç›´æ¥å°†ä»£ç å’Œæ•°æ®åŠ è½½ï¼Œè€Œæ˜¯ä¿®æ”¹è¿›ç¨‹çš„é¡µè¡¨ï¼Œæ ‡è¯†è™šæ‹Ÿå†…å­˜é¡µçš„å­˜åœ¨ï¼Œä½†å…¶å®é™…çš„ç‰©ç†æ•°æ®å°šæœªåŠ è½½åˆ°å†…å­˜ã€‚ å½“è¿›ç¨‹è®¿é—®æŸä¸ªä»£ç æˆ–æ•°æ®æ—¶ï¼Œå¦‚æœæ‰€éœ€å†…å­˜ä¸åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œç¡¬ä»¶ä¼šè§¦å‘ä¸€ä¸ª é¡µæ•…éšœï¼Œæ§åˆ¶æƒä¼šè½¬äº¤ç»™ Linux å†…æ ¸æ¥è§£å†³ã€‚Linux å¿…é¡»çŸ¥é“è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„æ¯ä¸ªè™šæ‹Ÿå†…å­˜åŒºåŸŸçš„æ¥æºï¼Œä»¥åŠå¦‚ä½•åŠ è½½è¿™äº›åŒºåŸŸçš„æ•°æ®ä»¥è§£å†³æ•…éšœã€‚ è¿›ç¨‹åˆ†é…è™šæ‹Ÿå†…å­˜æ—¶ï¼ŒLinux å¹¶ä¸ä¼šç«‹å³ä¸ºä¹‹ä¿ç•™ç‰©ç†å†…å­˜ï¼Œå®ƒåªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ vm_area_struct æ•°æ®ç»“æ„ï¼Œä»¥æè¿°è¯¥è™šæ‹Ÿå†…å­˜åŒºåŸŸï¼Œå¹¶å°†å…¶é“¾æ¥åˆ°è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜åˆ—è¡¨ã€‚å½“è¿›ç¨‹å°è¯•å†™å…¥æ–°åˆ†é…çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸæ—¶ï¼Œç³»ç»Ÿä¼šå¼ å¼€é¡µæ•…éšœã€‚ç”±äºå½“å‰é¡µè¡¨ä¸­ç¼ºä¹å¯¹åº”çš„æ¡ç›®ï¼Œå¤„ç†å™¨ä¼šå¯¼è‡´é¡µæ•…éšœå¼‚å¸¸ï¼Œç”± Linux å†…æ ¸æ¥å¤„ç†æ­¤äº‹ä»¶ã€‚ Linux å°†æ£€æŸ¥è¢«å¼•ç”¨çš„è™šæ‹Ÿåœ°å€æ˜¯å¦å¤„äºå½“å‰è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜åœ°å€ç©ºé—´å†…ã€‚å¦‚æœæ˜¯æœ‰æ•ˆçš„ï¼ŒLinux ä¼šåˆ›å»ºé€‚å½“çš„é¡µé¢è¡¨é¡¹ï¼ˆPTEï¼‰ï¼Œå¹¶ä¸ºå½“å‰è¿›ç¨‹åˆ†é…ä¸€é¡µç‰©ç†å†…å­˜ã€‚æ­¤æ—¶ï¼Œæ•°æ®å¯èƒ½éœ€è¦é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæˆ–äº¤æ¢ç¡¬ç›˜è¯»å…¥ç‰©ç†å†…å­˜ã€‚è¿›ç¨‹éšåå°†ä»äº§ç”Ÿé¡µæ•…éšœçš„æŒ‡ä»¤å¤„ç»§ç»­æ‰§è¡Œï¼Œç”±äºç‰©ç†åœ°å€å·²å­˜åœ¨ï¼Œå¯é¡ºåˆ©ç»§ç»­å…¶è¿è¡Œæµç¨‹ã€‚å¦‚æœè™šæ‹Ÿåœ°å€ä¸æ˜¯æœ‰æ•ˆçš„ï¼Œç³»ç»Ÿåˆ™ä¼šæŠ›å‡ºå¸¸è§çš„â€æ®µé”™è¯¯â€å¼‚å¸¸ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","å¤šçº¿ç¨‹"]},{"title":"NASç›¸å…³é…ç½®","path":"/2024/05/31/1-å¹³å°ç³»ç»Ÿ-NAS-NASç›¸å…³é…ç½®/","content":"æ§åˆ¶é¢æ¿-ç½‘ç»œ-è®¾ç½®ï¼Œè®¾ç½® DNS ä¸º 223.5.5.5 æˆ–è€… 114.114.114.114 æˆ–è€… 119.29.29.29 é…ç½®æ—¶é—´æœåŠ¡å™¨æ§åˆ¶é¢æ¿-é«˜çº§æ¨¡å¼-åŒºåŸŸé€‰é¡¹ï¼Œä¸ NTP æœåŠ¡å™¨åŒæ­¥ï¼šæ‰“å­—å¡«å…¥ ntp1.aliyun.com æˆ–è€… time.apple.com é…ç½® SSH æœåŠ¡ æ‰“å¼€æ§åˆ¶é¢æ¿ é€‰æ‹©ç»ˆç«¯æœºå’Œ SNMPï¼Œå¯åŠ¨ SSH åŠŸèƒ½ï¼Œè®¾ç½®ç«¯å£å· æ‰“å¼€ mobaxterm è¿æ¥ NAS çš„ IP åŠ ä¸Šè®¾ç½®çš„ SSH ç«¯å£å· è¿›å…¥ç»ˆç«¯åè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•ï¼Œä¹‹åè¾“å…¥ sudo -i è¿›å…¥ root ç”¨æˆ·ä½†æ˜¯é»˜è®¤ 22 ç«¯å£è¦æ”¹æ‰ï¼Œæœ€å¥½åœ¨ 9000 ä»¥ä¸Š é…ç½® FRP è‡ªå¯åŠ¨ç¼–è¾‘ rc.local æ·»åŠ è‡ªå¯åŠ¨è„šæœ¬ #!/bin/shcd /home/ubuntu/frpServer/frp_0.52.3_linux_amd64#æŒ‰ç…§é…ç½®æ–‡ä»¶å¯åŠ¨æœåŠ¡å™¨ç«¯./frps -c ./frps.toml åœ¨ NAS ä¸­æ·»åŠ è„šæœ¬åˆ°ä»»åŠ¡è®¡åˆ’ è¿›å…¥æ§åˆ¶é¢æ¿ï¼Œé€‰æ‹©ä»»åŠ¡è®¡åˆ’ï¼Œé€‰æ‹©æ–°å¢ - è§¦å‘çš„ä»»åŠ¡ - ç”¨æˆ·å®šä¹‰çš„è„šæœ¬ ç¼–è¾‘ä»»åŠ¡åç§°ï¼Œé€‰æ‹©è´¦å·ä¸º rootï¼Œäº‹ä»¶ä¸ºå¼€æœºï¼Œå‹¾é€‰å·²å¯åŠ¨ ç¼–è¾‘ä»»åŠ¡è®¾ç½®ï¼Œç¼–è¾‘è¿è¡Œå‘½ä»¤ä¸­çš„å†…å®¹ä¸º bash /root/start.sh ç¡®å®šä¿å­˜ååœ¨è¯¥ä»»åŠ¡ä¸Šå³å‡»ï¼Œé€‰æ‹©è¿è¡Œ çŒ«ç›˜é…ç½® FRPï¼ŒåŒæ­¥è‡³äº‘æœåŠ¡å™¨ é…ç½® SYNCï¼ŒåŒæ­¥è‡³å¤¸å…‹ç§»åŠ¨ç™¾åº¦ frp æ–¹æ¡ˆä¾èµ–æœåŠ¡å™¨å¸¦å®½ï¼Œæ¯”è¾ƒå¡","categories":["1.å¹³å°ç³»ç»Ÿ","NAS"]},{"title":"Alistç½‘ç›˜æ­å»º","path":"/2024/05/30/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-å·¥å…·-Alistç½‘ç›˜æ­å»º/","content":"Alist å¤‡ä»½æ–‡ä»¶åœ°å€ Alist æ­å»ºæ–¹æ¡ˆ æ–¹æ¡ˆä¸€ï¼šäº‘æœåŠ¡å™¨ç›´æ¥æ­å»ºåŠå­˜å‚¨ æ–¹æ¡ˆäºŒï¼šäº‘æœåŠ¡æ­å»ºé¡µé¢ï¼ŒNAS éœ€è¦æ­å»º webdavï¼ŒåŒæ—¶éœ€è¦æä¾› NAS ç©¿é€æ–¹æ¡ˆ æ–¹æ¡ˆä¸‰ï¼šäº‘æœåŠ¡å™¨æä¾›ç©¿é€æ–¹æ¡ˆ frpCloudflaredï¼ŒNAS æ­å»ºé¡µé¢å’Œå­˜å‚¨ æœ¬åœ°æ­å»ºä»“åº“åœ°å€ https://github.com/alist-org/alist Relaes åœ°å€ https://github.com/alist-org/alist/releases ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ alist ä½¿ç”¨ï¼Œç›´æ¥è§£å‹åæŒ‰ç…§ä¸‹è¿°æ–¹å¼è¿è¡Œå³å¯ # è§£å‹ä¸‹è½½çš„æ–‡ä»¶ï¼Œå¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼šunzip alist-xxxx.zip# è¿è¡Œç¨‹åº.\\alist.exe server ä¹‹åè®¿é—®æœ¬åœ° http://127.0.0.1:5244/ å³å¯æ‰“å¼€ Alist é¡µé¢ã€‚ Docker æ­å»ºversion: 3.3services: alist: #ç¦»çº¿ä¸‹è½½é€‰æ‹©xhofe/alist-aria2:latest image: xhofe/alist:latest container_name: alist volumes: - ./alist_data:/opt/alist/data ports: - 9083:5244 environment: - PUID=0 - PGID=0 - UMASK=022 restart: unless-stopped Alist å¯åŠ¨è„šæœ¬ VBSDim ws_alistDim ws_frpSet ws_alist = Wscript.CreateObject(Wscript.Shell)ws_alist.run alist.exe server,vbhideSet ws_frp = Wscript.CreateObject(Wscript.Shell)ws_frp.run .\\frpc.exe -c .\\frpc.toml,vbhideWscript.quit é…ç½®æœ¬åœ°# è·å¾—ç®¡ç†å‘˜ä¿¡æ¯ ä»¥ä¸‹ä¸¤ä¸ªä¸åŒç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬ä¹Ÿæœ‰éšæœºç”Ÿæˆå’Œæ‰‹åŠ¨è®¾ç½®# ä½äºv3.25.0ç‰ˆæœ¬.\\alist.exe admin# é«˜äºv3.25.0ç‰ˆæœ¬# éšæœºç”Ÿæˆä¸€ä¸ªå¯†ç .\\alist.exe admin random# æ‰‹åŠ¨è®¾ç½®ä¸€ä¸ªå¯†ç  `NEW_PASSWORD`æ˜¯æŒ‡éœ€è¦è®¾ç½®çš„å¯†ç .\\alist.exe admin set NEW_PASSWORD dockerAlist é…ç½®å­˜å‚¨ç›´æ¥æŒ‰ç…§ Alist å®˜æ–¹æ–‡æ¡£é…ç½®å³å¯ï¼Œé…ç½®å®Œæˆåï¼ŒNAS åˆ©ç”¨ CloudSync å¥—ä»¶ï¼Œæ·»åŠ  WebDav ç«™ç‚¹åå³å¯è®¿é—®ã€‚ # éšæœºç”Ÿæˆä¸€ä¸ªå¯†ç docker exec -it alist ./alist admin random# æ‰‹åŠ¨è®¾ç½®ä¸€ä¸ªå¯†ç ,`NEW_PASSWORD`æ˜¯æŒ‡éœ€è¦è®¾ç½®çš„å¯†ç docker exec -it alist ./alist admin set NEW_PASSWORD WebDav é…ç½®å¦‚æœæ²¡æœ‰å•ç‹¬ç•™è·¯å¾„é€‰é¡¹é‚£æ­£å¸¸å°±æ˜¯åœ¨ ç«™ç‚¹åé¢æ·»åŠ  /dav é€‰é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š å…¶ä»– æ­å»º NASï¼Œ192.168.2.100:5000 æ­å»º Alistï¼Œ192.168.2.100:5244 Alist æ·»åŠ å¤¸å…‹ç½‘ç›˜ç§»åŠ¨äº‘ç›˜ç™¾åº¦ç½‘ç›˜ NAS ä¸­å®‰è£… CloudSyncï¼Œé“¾æ¥åˆ° Alist çš„ WebDavï¼ŒåŒå‘åŒæ­¥æ–¹æ¡ˆ é€šè¿‡ FRP é€ä¼  NAS çš„ç«¯å£å’Œ WebDav çš„ç«¯å£åˆ°å¤–ç½‘ å¦‚ä½•è®© Alist ç½‘ç›˜å†…ä¸åŒçš„æ–‡ä»¶å¤¹åŒæ­¥","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨","å·¥å…·"]},{"title":"è¿›ç¨‹é—´é€šè®¯","path":"/2024/05/29/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-å¤šçº¿ç¨‹-è¿›ç¨‹é—´é€šè®¯/","content":"è¿›ç¨‹é—´é€šä¿¡çš„ç›®çš„åœ¨æ·±å…¥æ¢è®¨è¿›ç¨‹é—´é€šä¿¡ä¹‹å‰ï¼Œé¦–å…ˆç†è§£ä¸ºä»€ä¹ˆç¨‹åºä¹‹é—´éœ€è¦äº¤æ¢æ•°æ®è‡³å…³é‡è¦ã€‚ä¼ ç»Ÿä¸Šï¼Œç¨‹åºä¹‹é—´çš„äº¤æµå¸¸å¸¸ä¾èµ–äºæ–‡ä»¶æ“ä½œã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè¿›ç¨‹å¯èƒ½ä¼šå°†æ•°æ®å†™å…¥æ–‡æœ¬æ–‡ä»¶ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹éšåä»è¯¥æ–‡ä»¶ä¸­è¯»å–ã€‚è¿™ç§æ–¹æ³•è™½ç„¶ç›´è§‚ï¼Œä½†å­˜åœ¨æ˜¾è‘—çš„ç¼ºé™·ã€‚å½“ä¸€ä¸ªè¿›ç¨‹é¢‘ç¹åœ°è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œç¡¬ç›˜çš„è¯»å†™é€Ÿåº¦æˆä¸ºç“¶é¢ˆï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚å› æ­¤ï¼Œéœ€è¦å­¦ä¹ æ›´åŠ é«˜æ•ˆçš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚ ä¸ºä»€ä¹ˆéœ€è¦è¿›ç¨‹é€šä¿¡è¿›ç¨‹ä¹‹é—´é€šå¸¸éœ€è¦åˆä½œä»¥å®Œæˆå…±åŒçš„ä»»åŠ¡ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¿›ç¨‹éœ€è¦ä¼ é€’æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹å¸Œæœ›ç»“æŸå¦ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œå®ƒå¿…é¡»é€šçŸ¥ç›®æ ‡è¿›ç¨‹è¿›è¡Œé‡Šæ”¾ã€‚åœ¨è¿™æ ·çš„åœºæ™¯ä¸‹ï¼Œè¿›ç¨‹é€šä¿¡å˜å¾—ä¸å¯æˆ–ç¼ºã€‚ ä¾‹å¦‚ï¼Œåœ¨è°ƒè¯•ç¯å¢ƒä¸­ï¼Œè°ƒè¯•è¿›ç¨‹å¯èƒ½éœ€è¦ç­‰å¾…ç‰¹å®šçš„è°ƒè¯•äº‹ä»¶ï¼Œå¹¶æ ¹æ®è¿™äº›äº‹ä»¶æ¥æ§åˆ¶è¢«è°ƒè¯•è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ã€‚è°ƒè¯•è¿›ç¨‹è¿˜å¯èƒ½éœ€è¦è¯»å–å’Œä¿®æ”¹è¢«è°ƒè¯•è¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼Œè¿™ä¸€åˆ‡éƒ½ç¦»ä¸å¼€é«˜æ•ˆçš„è¿›ç¨‹é€šä¿¡æœºåˆ¶ã€‚ è¿›ç¨‹é€šä¿¡çš„ç‰¹ç‚¹æœ€åˆï¼Œå¯èƒ½ä¼šè¯¯è®¤ä¸ºé€šè¿‡æ–‡ä»¶æˆ–æ•°æ®åº“è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡æ˜¯é«˜æ•ˆçš„ã€‚å®é™…ä¸Šï¼Œè¿™äº›æ–¹æ³•éœ€è¦é¢‘ç¹è®¿é—®ç£ç›˜ï¼Œæ•ˆç‡è¾ƒä½ã€‚è€Œè¿›ç¨‹é—´é€šä¿¡æ—¨åœ¨æä¾›å¿«é€Ÿå’Œå®æ—¶çš„æ•°æ®äº¤æ¢ã€‚ é‡è¦çš„æ˜¯ï¼Œè¦æ³¨æ„è¿›ç¨‹ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„ç”¨æˆ·ç©ºé—´ï¼Œä¸èƒ½éšæ„è®¿é—®å…¶ä»–è¿›ç¨‹çš„æ•°æ®ã€‚ä½†æ˜¯ï¼Œé€šè¿‡æ“ä½œç³»ç»Ÿä½œä¸ºä¸­ä»‹ï¼Œè¿›ç¨‹å¯ä»¥å®‰å…¨è€Œé«˜æ•ˆåœ°è¿›è¡Œä¿¡æ¯äº¤æµï¼Œé¿å…äº†å¯¹ç¼“æ…¢ä»‹è´¨çš„ä¾èµ–ã€‚ åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰ä¸»è¦å¯ä»¥é€šè¿‡ä»¥ä¸‹å…­ç§æ–¹å¼å®ç°ï¼š æ•°æ®ä¼ è¾“ å‘é€äº‹ä»¶ èµ„æºå…±äº« è¿›ç¨‹æ§åˆ¶ é€šä¿¡ç§ç±»ä¸ç‰¹ç‚¹æµ…æ1. ç®¡é“ï¼ˆPipeï¼‰ç®¡é“æ˜¯ UnixLinux ç³»ç»Ÿä¸­å¸¸è§çš„é€šä¿¡æ–¹å¼ï¼Œåˆ†ä¸ºæœ‰åç®¡é“å’Œæ— åç®¡é“ã€‚ç®¡é“åœ¨æ“ä½œä¸Šå®ç°å•å‘é€šä¿¡ï¼Œé€šå¸¸é‡‡ç”¨åŠåŒå·¥æ–¹å¼ã€‚è¿™æ„å‘³ç€æ•°æ®åªèƒ½æ²¿ä¸€ä¸ªæ–¹å‘æµåŠ¨ï¼Œé€‚åˆçˆ¶å­è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚æœ‰åç®¡é“å…è®¸æ— äº²å±å…³ç³»çš„è¿›ç¨‹è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œä½¿å…¶çµæ´»æ€§å¤§å¤§å¢å¼ºã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥é€šè¿‡æœ‰åç®¡é“å‘ä»»æ„å…¶ä»–è¿›ç¨‹ä¼ é€æ•°æ®ï¼Œè€Œä¸éœ€è¦ç›´æ¥çš„äº²å±å…³ç³»ã€‚ 2. ä¿¡å·ï¼ˆSignalï¼‰ä¿¡å·æœºåˆ¶ç›¸å¯¹å¤æ‚ï¼Œä¸»è¦ç”¨äºå‘æ¥æ”¶è¿›ç¨‹é€šçŸ¥ç‰¹å®šäº‹ä»¶çš„å‘ç”Ÿã€‚ä¾‹å¦‚ï¼Œå½“æŸä¸ªè¿›ç¨‹éœ€è¦å¤„ç†æŸä¸ªå¼‚å¸¸æƒ…å†µæ—¶ï¼Œå®ƒå¯ä»¥å‘é€ä¿¡å·å¼•èµ·ç›¸å…³è¿›ç¨‹çš„æ³¨æ„ã€‚ä¿¡å·æ˜¯ä¸€ç§ä½å±‚æ¬¡çš„ã€å¼‚æ­¥çš„é€šä¿¡æ–¹å¼ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°å”¤é†’è¿›ç¨‹å¹¶ä¿ƒä½¿å…¶å“åº”ç‰¹å®šäº‹ä»¶ã€‚ 3. æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§å­˜æ”¾åœ¨å†…æ ¸ä¸­çš„å¼‚æ­¥é€šä¿¡æœºåˆ¶ã€‚è¿™ç§æ–¹å¼å…è®¸è¿›ç¨‹å°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œå…¶ä»–è¿›ç¨‹éšåå¯ä»¥ä»é˜Ÿåˆ—ä¸­è¯»å–è¿™äº›æ¶ˆæ¯ã€‚æ¶ˆæ¯é˜Ÿåˆ—çš„ä¼˜ç‚¹åœ¨äºå®ƒèƒ½æœ‰æ•ˆåœ°ç®¡ç†å’Œä¼ é€’ä¸€ç³»åˆ—æ•°æ®ï¼Œé™ä½äº†ä¸¤è¾¹è¿›ç¨‹ä¹‹é—´ç›´æ¥é€šä¿¡çš„å¤æ‚æ€§ã€‚ // msgLucy.c#include sys/ipc.h#include sys/msg.h#include sys/stat.h#include sys/types.h#include stdio.h#include fcntl.h#include signal.h#include stdlib.h#include string.h#define PROJID 0XFF#define LUCY 1#define PETER 2#define SEED gint mqid;// ç»ˆæ­¢å¤„ç†å‡½æ•°ï¼Œç”¨äºæ¸…é™¤æ¶ˆæ¯é˜Ÿåˆ—void terminate_handler(int signo) msgctl(mqid, IPC_RMID, NULL); // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ— exit(0);int main() key_t mqkey; struct msgbuf long mtype; // æ¶ˆæ¯ç±»å‹ char mtext[256]; // æ¶ˆæ¯å†…å®¹ int *m; // æŒ‡å‘æ•´å‹æ•°æ®çš„æŒ‡é’ˆ msg; int ret; // ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„æ¶ˆæ¯é˜Ÿåˆ—é”® mqkey = ftok(., SEED); // å‚æ•°ï¼šè·¯å¾„å’Œé¡¹ç›®æ ‡è¯†ç¬¦ if (mqkey == -1) perror(ftok error:); // å¦‚æœç”Ÿæˆæ¶ˆæ¯é˜Ÿåˆ—é”®å¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚ exit(-1); // åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™æ‰“å¼€ mqid = msgget(mqkey, IPC_CREAT | 0666); // è®¾ç½®è®¿é—®æƒé™ if (mqid == -1) perror(msgget error:); // å¦‚æœè·å–æ¶ˆæ¯é˜Ÿåˆ—å¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚ exit(-1); // è®¾ç½®ä¿¡å·å¤„ç†å‡½æ•°ï¼Œå¤„ç†ç»ˆæ­¢ä¿¡å· signal(SIGINT, terminate_handler); signal(SIGTERM, terminate_handler); while (1) printf(Lucy: ); // æç¤ºè¾“å…¥ fgets(msg.mtext, 256, stdin); // ä»æ ‡å‡†è¾“å…¥è¯»å–æ¶ˆæ¯ // æ£€æŸ¥æ˜¯å¦è¾“å…¥äº†quitä»¥é€€å‡ºç¨‹åº if (strncmp(quit, msg.mtext, 4) == 0) msgctl(mqid, IPC_RMID, NULL); // æ¸…ç†æ¶ˆæ¯é˜Ÿåˆ— exit(0); msg.mtext[strlen(msg.mtext) - 1] = \\0; // å»æ‰æ¢è¡Œç¬¦ msg.mtype = LUCY; // è®¾ç½®æ¶ˆæ¯ç±»å‹ // å‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä½¿ç”¨é˜»å¡æ–¹å¼ msgsnd(mqid, msg, strlen(msg.mtext) + 1, 0); // æ¥æ”¶æ¥è‡ªå½¼å¾—çš„æ¶ˆæ¯ msgrcv(mqid, msg, sizeof(struct msgbuf), PETER, 0); printf(Peter: %s , msg.mtext); // è¾“å‡ºå½¼å¾—çš„æ¶ˆæ¯ printf(the point m: %p , msg.m); // è¾“å‡ºæŒ‡é’ˆåœ°å€ // msgPeter.c#include sys/ipc.h#include sys/msg.h#include sys/stat.h#include sys/types.h#include stdio.h#include fcntl.h#include signal.h#include stdlib.h#include string.h#define PROJID 0XFF#define LUCY 1#define PETER 2#define SEED gvoid terminate_handler(int );int mqid;// ç»ˆæ­¢å¤„ç†å‡½æ•°ï¼Œå®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„æ¸…ç†void terminate_handler(int signo) msgctl(mqid, IPC_RMID, NULL); // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ— exit(0);int main() key_t mqkey; int n; struct msgbuf long mtype; // æ¶ˆæ¯ç±»å‹ char mtext[256]; // æ¶ˆæ¯å†…å®¹ int *m; // æŒ‡å‘æ•´å‹æ•°æ®çš„æŒ‡é’ˆ msg; int ret; // ç”Ÿæˆå”¯ä¸€çš„æ¶ˆæ¯é˜Ÿåˆ—é”® mqkey = ftok(., SEED); if (mqkey == -1) perror(ftok error:); // é”™è¯¯å¤„ç† exit(-1); // è·å–æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º if ((mqid = msgget(mqkey, 0)) == -1) printf(come here!!!!!!!!!!!!!! ); // åœ¨æ­¤å¤„è¡¨ç¤ºæœªåˆ›å»ºä»»ä½•æ¶ˆæ¯é˜Ÿåˆ— mqid = msgget(mqkey, IPC_CREAT | 0666); // åˆ›å»ºæ–°çš„æ¶ˆæ¯é˜Ÿåˆ— if (mqid == -1) perror(msgget error:); // å¦‚æœè·å–æ¶ˆæ¯é˜Ÿåˆ—å¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚ exit(-1); n = 4; // æ•´æ•°å€¼ msg.m = n; // è®¾ç½®æŒ‡é’ˆ // è¾“å‡ºæŒ‡é’ˆåœ°å€å’ŒæŒ‡å‘å€¼ printf(the point m: %p , msg.m); printf(msg.ms value is %d , *(msg.m)); // è®¾ç½®ä¿¡å·å¤„ç†å‡½æ•°ï¼Œå¤„ç†ç»ˆæ­¢ä¿¡å· signal(SIGINT, terminate_handler); signal(SIGTERM, terminate_handler); while (1) // æ¥æ”¶æ¥è‡ªéœ²è¥¿çš„æ¶ˆæ¯ msgrcv(mqid, msg, sizeof(struct msgbuf), LUCY, 0); printf(LUCY: %s , msg.mtext); // è¾“å‡ºéœ²è¥¿çš„æ¶ˆæ¯ printf(Peter: ); // æç¤ºè¾“å…¥ fgets(msg.mtext, 256, stdin); // ä»æ ‡å‡†è¾“å…¥è¯»å–æ¶ˆæ¯ // æ£€æŸ¥æ˜¯å¦è¾“å…¥äº†quitä»¥é€€å‡ºç¨‹åº if (strncmp(quit, msg.mtext, 4) == 0) msgctl(mqid, IPC_RMID, NULL); // æ¸…ç†æ¶ˆæ¯é˜Ÿåˆ— exit(0); msg.mtext[strlen(msg.mtext) - 1] = \\0; // å»æ‰æ¢è¡Œç¬¦ msg.mtype = PETER; // è®¾ç½®æ¶ˆæ¯ç±»å‹ // å‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ— msgsnd(mqid, msg, sizeof(struct msgbuf), 0); 4. å…±äº«å†…å­˜ï¼ˆShared Memoryï¼‰å…±äº«å†…å­˜æ˜¯è¿›ç¨‹é—´é€šä¿¡ä¸­é€Ÿåº¦æœ€å¿«çš„ä¸€ç§æ–¹å¼ã€‚é€šè¿‡ç›´æ¥æ“ä½œå†…å­˜ï¼Œè¿›ç¨‹å¯ä»¥è½»æ¾åœ°è¯»å†™å…±äº«æ•°æ®ï¼Œè€Œä¸éœ€è¦é¢å¤–çš„æ ¼å¼åŒ–æ“ä½œã€‚è¿™ç§æ–¹å¼å¸¸ä¸ä¿¡å·é‡ç»“åˆä½¿ç”¨ï¼Œä»¥ç¡®ä¿è¿›ç¨‹åœ¨è®¿é—®å…±äº«èµ„æºæ—¶çš„åŒæ­¥ã€‚ 5. ä¿¡å·é‡ï¼ˆSemaphoreï¼‰ä¿¡å·é‡æ˜¯ç”¨äºå®ç°è¿›ç¨‹é—´äº’æ–¥å’ŒåŒæ­¥çš„é‡è¦å·¥å…·ã€‚å®ƒä»¬å¹¶ä¸ç›´æ¥å­˜å‚¨é€šä¿¡æ•°æ®ï¼Œè€Œæ˜¯æ§åˆ¶å¤šä¸ªè¿›ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œæ¯”å¦‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„çº¿ç¨‹ä¿¡å·é‡ã€‚ä¿¡å·é‡çš„åŸºæœ¬å½¢å¼åŒ…æ‹¬äºŒå…ƒä¿¡å·é‡å’Œè®¡æ•°ä¿¡å·é‡ï¼Œèƒ½å¤Ÿçµæ´»å¤„ç†ä¸åŒçš„å¹¶å‘éœ€æ±‚ã€‚ 6. å¥—æ¥å­—ï¼ˆSocketï¼‰å¥—æ¥å­—æ˜¯ä¸€ç§ç½‘ç»œåè®®çš„æ¥å£ï¼Œå…è®¸ä¸åœ¨åŒä¸€æœºå™¨ä¸Šçš„è¿›ç¨‹è¿›è¡Œé€šä¿¡ã€‚å®ƒä½œä¸ºä¸€ç§é€šç”¨çš„ IPC æ–¹å¼ï¼Œåœ¨å„ç§æ“ä½œç³»ç»Ÿä¸­å‡æœ‰å®ç°ï¼Œå› æ­¤è¢«å¹¿æ³›ä½¿ç”¨ã€‚è¿™ç§æ–¹å¼çš„çµæ´»æ€§åœ¨äºå®ƒèƒ½å®ç°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œä½¿å¾—åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è¿›ç¨‹èƒ½å¤Ÿé¡ºç•…åœ°äº¤æ¢æ•°æ®ã€‚ é€šè¿‡ç†è§£è¿™äº›é€šä¿¡æœºåˆ¶çš„ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯ï¼Œå°±èƒ½åœ¨ Linux ç¯å¢ƒä¸‹æœ‰æ•ˆåœ°å®ç°è¿›ç¨‹é—´çš„æ•°æ®ä¼ è¾“ä¸æ§åˆ¶ï¼Œæ— è®ºæ˜¯ç®€å•çš„ä»»åŠ¡åè°ƒè¿˜æ˜¯å¤æ‚çš„ç³»ç»Ÿè°ƒè¯•ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","å¤šçº¿ç¨‹"]},{"title":"æŒ‡é’ˆ","path":"/2024/05/28/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-æŒ‡é’ˆ-æŒ‡é’ˆ/","content":"ä»€ä¹ˆæ˜¯æŒ‡é’ˆåœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼ŒæŒ‡é’ˆæ˜¯ä¸€ç§å˜é‡ç±»å‹ï¼Œç”¨äºå­˜å‚¨å†…å­˜åœ°å€ã€‚ç®€å•æ¥è¯´ï¼ŒæŒ‡é’ˆæŒ‡å‘å†…å­˜ä¸­çš„æŸä¸ªä½ç½®ã€‚ æ¯ä¸ªå†…å­˜å•å…ƒéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åœ°å€ï¼ŒæŒ‡é’ˆå¯ä»¥å­˜å‚¨è¿™ä¸ªåœ°å€ï¼Œå¹¶é€šè¿‡å¼•ç”¨è¯¥åœ°å€æ¥è®¿é—®å†…å­˜ä¸­å­˜å‚¨çš„æ•°æ®ã€‚é€šè¿‡ä½¿ç”¨æŒ‡é’ˆï¼Œä»¬å¯ä»¥ç›´æ¥è®¿é—®å’Œæ“ä½œå†…å­˜ä¸­çš„æ•°æ®ï¼Œè€Œä¸éœ€è¦å°†æ•°æ®æœ¬èº«ç›´æ¥å­˜å‚¨åœ¨å˜é‡ä¸­ã€‚ åŠ¡å¿…å¼„æ¸…æ¥šå­˜å‚¨å•å…ƒçš„åœ°å€å’Œå­˜å‚¨å•å…ƒçš„å†…å®¹è¿™ä¸¤ä¸ªæ¦‚å¿µçš„åŒºåˆ« æŒ‡é’ˆå¯ä»¥æŒ‡å‘ä»»ä½•æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚æ•´æ•°ã€å­—ç¬¦ã€æ•°ç»„ã€ç»“æ„ä½“ç­‰ã€‚é€šè¿‡æ“ä½œæŒ‡é’ˆï¼Œä»¬å¯ä»¥åœ¨ç¨‹åºä¸­åŠ¨æ€åœ°åˆ†é…å’Œé‡Šæ”¾å†…å­˜ï¼Œä»¥åŠåœ¨å‡½æ•°ä¹‹é—´ä¼ é€’å¤æ‚çš„æ•°æ®ç»“æ„ã€‚ ä½¿ç”¨æŒ‡é’ˆæ—¶ï¼Œä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›æ“ä½œç¬¦æ¥è¿›è¡Œä¸åŒçš„æ“ä½œï¼ŒåŒ…æ‹¬ï¼š å–å€æ“ä½œç¬¦ï¼ˆï¼‰ï¼šç”¨äºè·å–å˜é‡çš„åœ°å€ã€‚ è§£å¼•ç”¨æ“ä½œç¬¦ï¼ˆ*ï¼‰ï¼šç”¨äºè®¿é—®æŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€å¤„å­˜å‚¨çš„å€¼ã€‚ æŒ‡é’ˆåœ¨ç¼–ç¨‹ä¸­éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦å¤„ç†åŠ¨æ€å†…å­˜åˆ†é…ã€ä¼ é€’å¤§é‡æ•°æ®æˆ–éœ€è¦ç›´æ¥æ“ä½œå†…å­˜çš„æƒ…å†µä¸‹ã€‚ç„¶è€Œï¼Œä½¿ç”¨æŒ‡é’ˆä¹Ÿéœ€è¦è°¨æ…ï¼Œå› ä¸ºé”™è¯¯çš„ä½¿ç”¨æŒ‡é’ˆå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€é‡æŒ‡é’ˆè®¿é—®ç­‰é—®é¢˜ã€‚ ä»€ä¹ˆæ˜¯æŒ‡é’ˆå˜é‡æŒ‡é’ˆå˜é‡æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å˜é‡ï¼Œå®ƒå­˜å‚¨äº†ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œå¯ä»¥ç”¨äºæŒ‡å‘å…¶ä»–å˜é‡æˆ–æ•°æ®çš„ä½ç½®ã€‚æ¢å¥è¯è¯´ï¼ŒæŒ‡é’ˆå˜é‡ä¿å­˜äº†ä¸€ä¸ªæŒ‡å‘å†…å­˜ä¸­æŸä¸ªä½ç½®çš„å€¼ã€‚ æŒ‡é’ˆå˜é‡çš„å£°æ˜éœ€è¦æŒ‡å®šæ‰€æŒ‡å‘çš„æ•°æ®ç±»å‹ã€‚è¿™æ˜¯å› ä¸ºæŒ‡é’ˆå˜é‡éœ€è¦çŸ¥é“è¦è§£å¼•ç”¨æ—¶åº”è¯¥å¦‚ä½•è§£é‡Šæ‰€æŒ‡å‘çš„å†…å­˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæŒ‡é’ˆå˜é‡æŒ‡å‘æ•´æ•°ç±»å‹çš„æ•°æ®ï¼Œåˆ™è§£å¼•ç”¨è¯¥æŒ‡é’ˆå°†ç»™å‡ºè¯¥ä½ç½®ä¸Šçš„æ•´æ•°å€¼ã€‚ é€šè¿‡æŒ‡é’ˆå˜é‡ï¼Œä»¬å¯ä»¥é€šè¿‡é—´æ¥å¼•ç”¨æ¥è®¿é—®å’Œä¿®æ”¹æ‰€æŒ‡å‘çš„å˜é‡çš„å€¼ã€‚é€šè¿‡è§£å¼•ç”¨æ“ä½œç¬¦ï¼ˆ*ï¼‰ï¼Œä»¬å¯ä»¥è®¿é—®æŒ‡é’ˆå˜é‡æŒ‡å‘çš„å†…å­˜åœ°å€ä¸­å­˜å‚¨çš„å®é™…æ•°æ®ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†æŒ‡é’ˆå˜é‡çš„å£°æ˜ã€åˆå§‹åŒ–å’Œä½¿ç”¨çš„è¿‡ç¨‹ï¼š int main() int num = 10; // å®šä¹‰ä¸€ä¸ªæ•´æ•°å˜é‡ int* ptr; // å®šä¹‰ä¸€ä¸ªæŒ‡å‘æ•´æ•°çš„æŒ‡é’ˆå˜é‡ ptr = num; // å°†æŒ‡é’ˆæŒ‡å‘å˜é‡numçš„åœ°å€ printf(numçš„å€¼ï¼š%d , num); // è¾“å‡º num çš„å€¼ printf(ptræ‰€æŒ‡å‘çš„å€¼ï¼š%d , *ptr); // è¾“å‡º ptr æ‰€æŒ‡å‘çš„å€¼ï¼Œå³ num çš„å€¼ *ptr = 20; // é€šè¿‡æŒ‡é’ˆä¿®æ”¹ num çš„å€¼ printf(ä¿®æ”¹åçš„numçš„å€¼ï¼š%d , num); // è¾“å‡ºä¿®æ”¹åçš„ num çš„å€¼ return 0; åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒæŒ‡é’ˆå˜é‡ ptr è¢«å£°æ˜ä¸ºæŒ‡å‘æ•´æ•°ç±»å‹çš„æŒ‡é’ˆã€‚é€šè¿‡ä½¿ç”¨æ“ä½œç¬¦ï¼Œå°† ptr æŒ‡å‘äº† num å˜é‡çš„åœ°å€ã€‚ç„¶åï¼Œé€šè¿‡è§£å¼•ç”¨ ptrï¼Œå¯ä»¥è®¿é—®å’Œä¿®æ”¹ num çš„å€¼ã€‚ æŒ‡é’ˆå˜é‡åœ¨è®¸å¤šç¼–ç¨‹è¯­è¨€ä¸­éƒ½å­˜åœ¨ï¼Œå¹¶ä¸”åœ¨å†…å­˜ç®¡ç†ã€åŠ¨æ€æ•°æ®ç»“æ„å’Œå‡½æ•°å‚æ•°ä¼ é€’ç­‰æ–¹é¢å‘æŒ¥ç€é‡è¦çš„ä½œç”¨ã€‚ä½†æ˜¯ï¼Œæ­£ç¡®ä½¿ç”¨æŒ‡é’ˆæ˜¯éœ€è¦å°å¿ƒè°¨æ…çš„ï¼Œä»¥é¿å…å‡ºç°å†…å­˜é”™è¯¯å’Œæ½œåœ¨çš„å®‰å…¨é—®é¢˜ã€‚ æŒ‡é’ˆå˜é‡ä½œä¸ºå‡½æ•°å‚æ•°å½“å°†æŒ‡é’ˆå˜é‡ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’æ—¶ï¼Œæœ‰å‡ ä¸ªæ–¹é¢éœ€è¦æ³¨æ„ï¼Œä»¥ç¡®ä¿æ­£ç¡®ä½¿ç”¨æŒ‡é’ˆå¹¶é¿å…æ½œåœ¨çš„é”™è¯¯ï¼š ä¼ é€’æŒ‡é’ˆçš„å‰¯æœ¬ï¼šåœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼ŒæŒ‡é’ˆå˜é‡ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°æ—¶ï¼Œå®é™…ä¸Šæ˜¯ä¼ é€’æŒ‡é’ˆçš„å‰¯æœ¬ï¼Œè€Œä¸æ˜¯åŸå§‹æŒ‡é’ˆæœ¬èº«ã€‚è¿™æ„å‘³ç€åœ¨å‡½æ•°å†…éƒ¨å¯¹æŒ‡é’ˆçš„ä¿®æ”¹ä¸ä¼šå½±å“å‡½æ•°å¤–éƒ¨çš„æŒ‡é’ˆã€‚ æŒ‡é’ˆæœ‰æ•ˆæ€§æ£€æŸ¥ï¼šåœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨æŒ‡é’ˆä¹‹å‰ï¼Œåº”è¯¥è¿›è¡Œæœ‰æ•ˆæ€§æ£€æŸ¥ï¼Œç¡®ä¿æŒ‡é’ˆä¸ä¸º NULLã€‚ç©ºæŒ‡é’ˆå¯èƒ½ä¼šå¯¼è‡´è®¿é—®æ— æ•ˆçš„å†…å­˜åœ°å€ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒæˆ–äº§ç”Ÿä¸å¯é¢„æµ‹çš„ç»“æœã€‚ æŒ‡é’ˆçš„ä¼ é€’æ–¹å¼ï¼šæŒ‡é’ˆå¯ä»¥é€šè¿‡å€¼ä¼ é€’æˆ–å¼•ç”¨ä¼ é€’æ¥ä¼ é€’ç»™å‡½æ•°ã€‚å¦‚æœè¦åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹æŒ‡é’ˆæœ¬èº«çš„å€¼ï¼ˆä¾‹å¦‚ä½¿å…¶æŒ‡å‘ä¸åŒçš„å†…å­˜åœ°å€ï¼‰ï¼Œåˆ™éœ€è¦ä½¿ç”¨æŒ‡é’ˆçš„å¼•ç”¨ä¼ é€’ï¼Œå³å°†æŒ‡é’ˆçš„åœ°å€ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚ é¿å…é‡æŒ‡é’ˆï¼šç¡®ä¿åœ¨å‡½æ•°å†…éƒ¨æ­£ç¡®åˆå§‹åŒ–æŒ‡é’ˆæˆ–åˆ†é…å†…å­˜ï¼Œé¿å…ä½¿ç”¨æœªåˆå§‹åŒ–çš„æŒ‡é’ˆã€‚åŒæ—¶ï¼Œæ³¨æ„åœ¨å‡½æ•°ç»“æŸå‰é‡Šæ”¾åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œä»¥é¿å…å‡ºç°é‡æŒ‡é’ˆï¼ˆæŒ‡å‘æ— æ•ˆå†…å­˜ï¼‰ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨å‡½æ•°ä¸­ä½¿ç”¨æŒ‡é’ˆå˜é‡ä½œä¸ºå‚æ•°ï¼š #include stdio.hvoid modifyPointer(int* ptr) if (ptr != NULL) // æ£€æŸ¥æŒ‡é’ˆçš„æœ‰æ•ˆæ€§ *ptr = 42; // ä¿®æ”¹æŒ‡é’ˆæ‰€æŒ‡å‘çš„å€¼ ptr = NULL; // ä¿®æ”¹æŒ‡é’ˆæœ¬èº«çš„å€¼ï¼ˆä¸ä¼šå½±å“å‡½æ•°å¤–éƒ¨çš„æŒ‡é’ˆï¼‰ int main() int num = 0; int* ptr = num; printf(åˆå§‹å€¼ï¼š%d , *ptr); // è¾“å‡ºåˆå§‹å€¼ modifyPointer(ptr); // å°†æŒ‡é’ˆä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•° printf(ä¿®æ”¹åçš„å€¼ï¼š%d , *ptr); // è¾“å‡ºä¿®æ”¹åçš„å€¼ return 0; åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ª modifyPointer å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªæ•´å‹æŒ‡é’ˆä½œä¸ºå‚æ•°ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œé¦–å…ˆè¿›è¡ŒæŒ‡é’ˆçš„æœ‰æ•ˆæ€§æ£€æŸ¥ï¼Œç„¶åä¿®æ”¹æŒ‡é’ˆæ‰€æŒ‡å‘çš„å€¼ä¸º 42ã€‚ç„¶åï¼Œå°†æŒ‡é’ˆæœ¬èº«çš„å€¼è®¾ç½®ä¸º NULLï¼Œä½†è¯·æ³¨æ„è¿™ä¸ä¼šå½±å“å‡½æ•°å¤–éƒ¨çš„æŒ‡é’ˆã€‚ åœ¨ main å‡½æ•°ä¸­ï¼Œå£°æ˜äº†ä¸€ä¸ªæ•´å‹å˜é‡ numï¼Œå¹¶å°†å…¶åœ°å€èµ‹å€¼ç»™æŒ‡é’ˆ ptrã€‚ç„¶åï¼Œé€šè¿‡è°ƒç”¨ modifyPointer å‡½æ•°ï¼Œå¹¶å°†æŒ‡é’ˆ ptr ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œå®ç°äº†åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹æŒ‡é’ˆæ‰€æŒ‡å‘çš„å€¼ã€‚ åœ¨æœ€åçš„è¾“å‡ºä¸­ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°æŒ‡é’ˆæ‰€æŒ‡å‘çš„å€¼åœ¨å‡½æ•°è°ƒç”¨åå‘ç”Ÿäº†ä¿®æ”¹ã€‚ æ€»ç»“æ¥è¯´ï¼Œå½“æŒ‡é’ˆå˜é‡ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’æ—¶ï¼Œéœ€è¦æ³¨æ„æŒ‡é’ˆçš„æœ‰æ•ˆæ€§ã€ä¼ é€’æ–¹å¼å’Œå¯èƒ½å¯¹æŒ‡é’ˆæœ¬èº«çš„ä¿®æ”¹ã€‚éµå¾ªè¿™äº›æ³¨æ„äº‹é¡¹å¯ä»¥æ›´å®‰å…¨åœ°ä½¿ç”¨æŒ‡é’ˆï¼Œå¹¶ç¡®ä¿å‡½æ•°å¯¹æŒ‡é’ˆçš„æ“ä½œæ­£ç¡®æœ‰æ•ˆã€‚ å‡½æ•°çš„è°ƒç”¨å¯ä»¥ï¼ˆè€Œä¸”åªå¯ä»¥ï¼‰å¾—åˆ°ä¸€ä¸ªè¿”å›å€¼ï¼ˆå³å‡½æ•°å€¼ï¼‰ï¼Œè€Œä½¿ç”¨æŒ‡é’ˆå˜é‡ä½œå‚æ•°ï¼Œå¯ä»¥å¾—åˆ°å¤šä¸ªå˜åŒ–äº†çš„å€¼ã€‚ é€šè¿‡æŒ‡é’ˆå¼•ç”¨æ•°ç»„é€šè¿‡æŒ‡é’ˆå¼•ç”¨æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨æŒ‡é’ˆæ¥æ“ä½œæ•°ç»„å…ƒç´ ã€‚åœ¨ C è¯­è¨€ä¸­ï¼Œæ•°ç»„åæœ¬èº«å°±æ˜¯æŒ‡å‘æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆã€‚é€šè¿‡å°†æ•°ç»„åèµ‹å€¼ç»™æŒ‡é’ˆå˜é‡ï¼Œå¯ä»¥é€šè¿‡æŒ‡é’ˆæ¥è®¿é—®å’Œä¿®æ”¹æ•°ç»„å…ƒç´ ã€‚ #include stdio.hint main() int arr[5] = 1, 2, 3, 4, 5; // å®šä¹‰ä¸€ä¸ªæ•´æ•°æ•°ç»„ int* ptr; ptr = arr; // å°†æ•°ç»„åèµ‹å€¼ç»™æŒ‡é’ˆå˜é‡ /* ptr2 = arr[0]; //æ˜¯å¦å¯ä»¥ï¼Ÿ*/ printf(æ•°ç»„å…ƒç´ é€šè¿‡æŒ‡é’ˆè®¿é—®ï¼š ); for (int i = 0; i 5; i++) printf(arr[%d] = %d , i, *(ptr + i)); // é€šè¿‡æŒ‡é’ˆè®¿é—®æ•°ç»„å…ƒç´  return 0; åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œarr æ˜¯ä¸€ä¸ªæ•´æ•°æ•°ç»„ã€‚é€šè¿‡å°† arr èµ‹å€¼ç»™æŒ‡é’ˆå˜é‡ ptrï¼Œptr å°±æŒ‡å‘äº†æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ç„¶åï¼Œä½¿ç”¨æŒ‡é’ˆ ptr é€šè¿‡åç§»æ¥è®¿é—®æ•°ç»„ä¸­çš„å…¶ä»–å…ƒç´ ï¼Œä½¿ç”¨è§£å¼•ç”¨æ“ä½œç¬¦ï¼ˆ*ï¼‰æ¥è·å–å…ƒç´ çš„å€¼ã€‚ åœ¨å¾ªç¯ä¸­ï¼Œé€šè¿‡é€’å¢æŒ‡é’ˆ ptr çš„å€¼æ¥è®¿é—®æ•°ç»„çš„ä¸åŒä½ç½®ã€‚é€šè¿‡*(ptr + i)ï¼Œå¯ä»¥è·å¾—æŒ‡é’ˆ ptr**åç§» i ä¸ªå…ƒç´ ä½ç½®å¤„(åç§»å¤§å°å–å†³äºæ•°ç»„ç±»å‹)**çš„å€¼ï¼Œå³æ•°ç»„ arr ä¸­ç´¢å¼•ä¸º i çš„å…ƒç´ ã€‚ é€šè¿‡æŒ‡é’ˆå¼•ç”¨æ•°ç»„ï¼Œå¯ä»¥å®ç°å¯¹æ•°ç»„çš„çµæ´»è®¿é—®å’Œæ“ä½œã€‚æŒ‡é’ˆç®—æœ¯è¿ç®—å¯ä»¥ç”¨äºéå†æ•°ç»„ã€è¿›è¡Œå…ƒç´ çš„è¯»å–å’Œä¿®æ”¹ï¼Œç”šè‡³å¯ä»¥é€šè¿‡æŒ‡é’ˆåŠ¨æ€åˆ†é…æ•°ç»„çš„å†…å­˜ç©ºé—´ã€‚ç„¶è€Œï¼Œéœ€è¦å°å¿ƒç¡®ä¿æŒ‡é’ˆä¸è¶Šç•Œï¼Œå¹¶éµå¾ªæŒ‡é’ˆçš„å®‰å…¨ä½¿ç”¨è§„åˆ™ï¼Œä»¥é¿å…æ½œåœ¨çš„é”™è¯¯å’Œå†…å­˜è®¿é—®é—®é¢˜ã€‚ *p++è·å–*p çš„å€¼è¦å¿«äº*p+i çš„å€¼çš„è·å– ç”¨æ•°ç»„åä½œå‡½æ•°å‚æ•°ç”¨æ•°ç»„åä½œå‡½æ•°å‚æ•°æ—¶ï¼Œå› ä¸ºå®å‚æ•°ç»„åä»£è¡¨è¯¥æ•°ç»„é¦–å…ƒç´ çš„åœ°å€ï¼Œå½¢å‚åº”è¯¥æ˜¯ä¸€ä¸ªæŒ‡é’ˆå˜é‡ ç”¨æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆä½œå‡½æ•°å‚æ•°ä¸€ç»´æ•°ç»„åå¯ä»¥ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œå¤šç»´æ•°ç»„åä¹Ÿå¯ä½œå‡½æ•°å‚æ•°ã€‚ç”¨æŒ‡é’ˆå˜é‡ä½œå½¢å‚ï¼Œä»¥æ¥å—å®å‚æ•°ç»„åä¼ é€’æ¥çš„åœ°å€ã€‚å¯ä»¥æœ‰ä¸¤ç§æ–¹æ³•ï¼šâ‘ ç”¨æŒ‡å‘å˜é‡çš„æŒ‡é’ˆå˜é‡â‘¡ç”¨æŒ‡å‘ä¸€ç»´æ•°ç»„çš„æŒ‡é’ˆå˜é‡ é€šè¿‡æŒ‡é’ˆå¼•ç”¨å¤šç»´æ•°ç»„æŒ‡é’ˆå˜é‡å¯ä»¥æŒ‡å‘ä¸€ç»´æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œä¹Ÿå¯ä»¥æŒ‡å‘å¤šç»´æ•°ç»„ä¸­çš„å…ƒç´ ã€‚ä½†åœ¨æ¦‚å¿µä¸Šå’Œä½¿ç”¨æ–¹æ³•ä¸Šï¼Œå¤šç»´æ•°ç»„çš„æŒ‡é’ˆæ¯”ä¸€ç»´æ•°ç»„çš„æŒ‡é’ˆè¦å¤æ‚ä¸€äº›ã€‚a[i]+j ä»£è¡¨è°çš„åœ°å€ï¼Ÿä»£è¡¨ a[i][j]çš„åœ°å€*(a[i]+j)ä»£è¡¨ä»€ä¹ˆï¼Ÿä»£è¡¨å…ƒç´  a[i][j]*(*(a+i)+j)ä»£è¡¨ä»€ä¹ˆï¼Ÿä¸*(a[i]+j)ç­‰ä»· é€šè¿‡æŒ‡é’ˆå¼•ç”¨å­—ç¬¦ä¸² å­—ç¬¦ä¸²æ˜¯å­˜æ”¾åœ¨å­—ç¬¦æ•°ç»„ä¸­çš„ã€‚å¼•ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ã€‚(1) ç”¨å­—ç¬¦æ•°ç»„å­˜æ”¾ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥é€šè¿‡æ•°ç»„åå’Œæ ¼å¼å£°æ˜â€%sâ€è¾“å‡ºè¯¥å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ•°ç»„åå’Œä¸‹æ ‡å¼•ç”¨å­—ç¬¦ä¸²ä¸­ä¸€ä¸ªå­—ç¬¦ã€‚(2) ç”¨å­—ç¬¦æŒ‡é’ˆå˜é‡æŒ‡å‘ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼Œé€šè¿‡å­—ç¬¦æŒ‡é’ˆå˜é‡å¼•ç”¨å­—ç¬¦ä¸²å¸¸é‡ã€‚ åœ¨ C è¯­è¨€ä¸­ï¼Œå­—ç¬¦ä¸²å®é™…ä¸Šæ˜¯ä»¥ null å­—ç¬¦ï¼ˆâ€™\\0â€™ï¼‰ç»“å°¾çš„å­—ç¬¦æ•°ç»„ã€‚é€šè¿‡æŒ‡é’ˆå¼•ç”¨å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨æŒ‡é’ˆæ¥æ“ä½œå­—ç¬¦ä¸²çš„å­—ç¬¦å…ƒç´ ã€‚ #include stdio.hint main() char str[] = Hello, World!; // å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ char* ptr = str; // å°†æ•°ç»„åèµ‹å€¼ç»™æŒ‡é’ˆå˜é‡ printf(å­—ç¬¦ä¸²é€šè¿‡æŒ‡é’ˆè®¿é—®ï¼š ); while (*ptr != \\0) printf(%c, *ptr); // é€šè¿‡æŒ‡é’ˆè®¿é—®å­—ç¬¦ä¸²å­—ç¬¦ ptr++; // æŒ‡é’ˆåç§» printf( ); return 0; åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œstr æ˜¯ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œå³å­—ç¬¦ä¸²ã€‚é€šè¿‡å°† str èµ‹å€¼ç»™æŒ‡é’ˆå˜é‡ ptrï¼Œptr å°±æŒ‡å‘äº†å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚ ä½¿ç”¨æŒ‡é’ˆ ptrï¼Œé€šè¿‡è§£å¼•ç”¨æ“ä½œç¬¦ï¼ˆ*ï¼‰æ¥è®¿é—®å­—ç¬¦ä¸²çš„å­—ç¬¦ã€‚åœ¨å¾ªç¯ä¸­ï¼Œæ£€æŸ¥å½“å‰æŒ‡é’ˆæŒ‡å‘çš„å­—ç¬¦æ˜¯å¦ä¸º null å­—ç¬¦ï¼ˆå­—ç¬¦ä¸²ç»“å°¾çš„æ ‡å¿—ï¼‰ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™æ‰“å°è¯¥å­—ç¬¦å¹¶å°†æŒ‡é’ˆåç§»ä¸€ä½ã€‚è¿™æ ·ï¼Œé€šè¿‡å¾ªç¯è¿­ä»£ï¼Œå¯ä»¥é€ä¸ªå­—ç¬¦åœ°è®¿é—®å’Œå¤„ç†å­—ç¬¦ä¸²ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºå­—ç¬¦ä¸²ä»¥ null å­—ç¬¦ç»“å°¾ï¼Œå› æ­¤åœ¨ä½¿ç”¨æŒ‡é’ˆå¼•ç”¨å­—ç¬¦ä¸²æ—¶ï¼Œéœ€è¦é€šè¿‡åˆ¤æ–­ null å­—ç¬¦æ¥ç¡®å®šå­—ç¬¦ä¸²çš„ç»“æŸä½ç½®ã€‚ é€šè¿‡æŒ‡é’ˆå¼•ç”¨å­—ç¬¦ä¸²ï¼Œå¯ä»¥è¿›è¡Œå„ç§å­—ç¬¦ä¸²æ“ä½œï¼Œä¾‹å¦‚æŸ¥æ‰¾ã€æ‹·è´ã€è¿æ¥ç­‰ã€‚æŒ‡é’ˆç®—æœ¯è¿ç®—ä¹Ÿå¯ä»¥ç”¨äºåœ¨å­—ç¬¦ä¸²ä¸­ç§»åŠ¨å’Œå®šä½ã€‚ç„¶è€Œï¼ŒåŒæ ·éœ€è¦å°å¿ƒç¡®ä¿æŒ‡é’ˆä¸è¶Šç•Œï¼Œå¹¶éµå¾ªæŒ‡é’ˆçš„å®‰å…¨ä½¿ç”¨è§„åˆ™ï¼Œä»¥é¿å…æ½œåœ¨çš„é”™è¯¯å’Œå†…å­˜è®¿é—®é—®é¢˜ã€‚ ä½¿ç”¨å­—ç¬¦æŒ‡é’ˆå˜é‡å’Œå­—ç¬¦æ•°ç»„çš„æ¯”è¾ƒ å­—ç¬¦æ•°ç»„ç”±è‹¥å¹²ä¸ªå…ƒç´ ç»„æˆï¼Œæ¯ä¸ªå…ƒç´ ä¸­æ”¾ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œå­—ç¬¦æŒ‡é’ˆå˜é‡ä¸­å­˜æ”¾çš„æ˜¯åœ°å€ï¼ˆå­—ç¬¦ä¸²ç¬¬ 1 ä¸ªå­—ç¬¦çš„åœ°å€ï¼‰ï¼Œå†³ä¸æ˜¯å°†å­—ç¬¦ä¸²æ”¾åˆ°å­—ç¬¦æŒ‡é’ˆå˜é‡ä¸­ å¯ä»¥å¯¹å­—ç¬¦æŒ‡é’ˆå˜é‡èµ‹å€¼ï¼Œä½†ä¸èƒ½å¯¹æ•°ç»„åèµ‹å€¼ã€‚ ç¼–è¯‘æ—¶ä¸ºå­—ç¬¦æ•°ç»„åˆ†é…è‹¥å¹²å­˜å‚¨å•å…ƒï¼Œä»¥å­˜æ”¾å„å…ƒç´ çš„å€¼ï¼Œè€Œå¯¹å­—ç¬¦æŒ‡é’ˆå˜é‡ï¼Œåªåˆ†é…ä¸€ä¸ªå­˜å‚¨å•å…ƒ æŒ‡é’ˆå˜é‡çš„å€¼æ˜¯å¯ä»¥æ”¹å˜çš„ï¼Œè€Œæ•°ç»„åä»£è¡¨ä¸€ä¸ªå›ºå®šçš„å€¼(æ•°ç»„é¦–å…ƒç´ çš„åœ°å€)ï¼Œä¸èƒ½æ”¹å˜ã€‚ å­—ç¬¦æ•°ç»„ä¸­å„å…ƒç´ çš„å€¼æ˜¯å¯ä»¥æ”¹å˜çš„ï¼Œä½†å­—ç¬¦æŒ‡é’ˆå˜é‡æŒ‡å‘çš„å­—ç¬¦ä¸²å¸¸é‡ä¸­çš„å†…å®¹æ˜¯ä¸å¯ä»¥è¢«å–ä»£çš„ã€‚ ç”¨æŒ‡é’ˆå˜é‡æŒ‡å‘ä¸€ä¸ªæ ¼å¼å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç”¨å®ƒä»£æ›¿ printf å‡½æ•°ä¸­çš„æ ¼å¼å­—ç¬¦ä¸² char *format;format=a=%d,b=%f ; printf(format,a,b);//ç›¸å½“äºprintf(a=%d,b=%f ,a,b); æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ å¦‚æœåœ¨ç¨‹åºä¸­å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨ç¼–è¯‘æ—¶ï¼Œç¼–è¯‘ç³»ç»Ÿä¸ºå‡½æ•°ä»£ç åˆ†é…ä¸€æ®µå­˜å‚¨ç©ºé—´ï¼Œè¿™æ®µå­˜å‚¨ç©ºé—´çš„èµ·å§‹åœ°å€ï¼Œç§°ä¸ºè¿™ä¸ªå‡½æ•°çš„æŒ‡é’ˆã€‚ åœ¨ C è¯­è¨€ä¸­ï¼Œå¯ä»¥å®šä¹‰å’Œä½¿ç”¨æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆæ¥å¼•ç”¨å’Œè°ƒç”¨å‡½æ•°ã€‚æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆå¯ä»¥å­˜å‚¨å‡½æ•°çš„åœ°å€ï¼Œå¹¶å…è®¸é€šè¿‡æŒ‡é’ˆæ¥è°ƒç”¨è¯¥å‡½æ•°ã€‚ #include stdio.h// ç¤ºä¾‹å‡½æ•°ï¼Œæ¥å—ä¸¤ä¸ªæ•´æ•°å‚æ•°å¹¶è¿”å›å®ƒä»¬çš„å’Œint add(int a, int b) return a + b;int main() int (*ptr)(int, int); // å®šä¹‰ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ ptr = add; // å°†å‡½æ•°åèµ‹å€¼ç»™æŒ‡é’ˆå˜é‡ int result = ptr(3, 4); // é€šè¿‡æŒ‡é’ˆè°ƒç”¨å‡½æ•° printf(å‡½æ•°è°ƒç”¨çš„ç»“æœï¼š%d , result); return 0; åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œadd æ˜¯ä¸€ä¸ªç¤ºä¾‹å‡½æ•°ï¼Œæ¥å—ä¸¤ä¸ªæ•´æ•°å‚æ•°å¹¶è¿”å›å®ƒä»¬çš„å’Œã€‚é¦–å…ˆï¼Œéœ€è¦ä½¿ç”¨æŒ‡é’ˆè¯­æ³•å®šä¹‰ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆå˜é‡ ptrï¼Œé€šè¿‡æŒ‡å®šå‡½æ•°çš„è¿”å›ç±»å‹å’Œå‚æ•°ç±»å‹ã€‚ ç„¶åï¼Œé€šè¿‡å°†å‡½æ•°åèµ‹å€¼ç»™æŒ‡é’ˆå˜é‡ï¼Œå°†å‡½æ•°çš„åœ°å€å­˜å‚¨åœ¨æŒ‡é’ˆä¸­ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œptr add;å°†å‡½æ•° add çš„åœ°å€èµ‹å€¼ç»™æŒ‡é’ˆå˜é‡ ptrã€‚ æœ€åï¼Œå¯ä»¥é€šè¿‡æŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼Œä½¿ç”¨æŒ‡é’ˆåé¢è·Ÿä¸Šå‚æ•°åˆ—è¡¨æ¥ä¼ é€’å‚æ•°ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œptr(3, 4)è°ƒç”¨é€šè¿‡æŒ‡é’ˆå¼•ç”¨çš„å‡½æ•°ï¼Œå¹¶ä¼ é€’å‚æ•° 3 å’Œ 4ã€‚ é€šè¿‡æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œå¯ä»¥å®ç°ä¸€äº›é«˜çº§çš„ç¼–ç¨‹æŠ€å·§ï¼Œå¦‚å›è°ƒå‡½æ•°ã€åŠ¨æ€å‡½æ•°è°ƒç”¨ç­‰ã€‚é€šè¿‡æŒ‡é’ˆå¯ä»¥åœ¨è¿è¡Œæ—¶æ ¹æ®éœ€è¦é€‰æ‹©è¦è°ƒç”¨çš„å‡½æ•°ã€‚ç„¶è€Œï¼Œéœ€è¦ç¡®ä¿æŒ‡é’ˆçš„ç±»å‹ä¸æ‰€å¼•ç”¨çš„å‡½æ•°ç±»å‹ç›¸åŒ¹é…ï¼Œä»¥é¿å…ç±»å‹é”™è¯¯å’Œæœªå®šä¹‰è¡Œä¸ºã€‚ æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆä½œä¸ºå‡½æ•°å‚æ•° æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆå˜é‡çš„ä¸€ä¸ªé‡è¦ç”¨é€”æ˜¯æŠŠå‡½æ•°çš„åœ°å€ä½œä¸ºå‚æ•°ä¼ é€’åˆ°å…¶ä»–å‡½æ•° æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆå¯ä»¥ä½œä¸ºå‡½æ•°å‚æ•°ï¼ŒæŠŠå‡½æ•°çš„å…¥å£åœ°å€ä¼ é€’ç»™å½¢å‚ï¼Œè¿™æ ·å°±èƒ½åœ¨è¢«è°ƒç”¨çš„å‡½æ•°ä¸­ä½¿ç”¨å®å‚å‡½æ•° è¿”å›æŒ‡é’ˆå€¼çš„å‡½æ•° ä¸€ä¸ªå‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªæ•´å‹å€¼ã€å­—ç¬¦å€¼ã€å®å‹å€¼ç­‰ï¼Œä¹Ÿå¯ä»¥è¿”å›æŒ‡é’ˆå‹çš„æ•°æ®ï¼Œå³åœ°å€ã€‚å…¶æ¦‚å¿µä¸ä»¥å‰ç±»ä¼¼ï¼Œåªæ˜¯è¿”å›çš„å€¼çš„ç±»å‹æ˜¯æŒ‡é’ˆç±»å‹è€Œå·² åœ¨ C è¯­è¨€ä¸­ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªè¿”å›æŒ‡é’ˆå€¼çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡é’ˆç±»å‹çš„å€¼ï¼ŒæŒ‡å‘æŸä¸ªæ•°æ®æˆ–æ•°æ®ç»“æ„ã€‚é€šè¿‡è¿”å›æŒ‡é’ˆå€¼ï¼Œå¯ä»¥åœ¨å‡½æ•°å†…éƒ¨åŠ¨æ€åˆ†é…å†…å­˜ï¼Œå¹¶è¿”å›æŒ‡å‘è¯¥å†…å­˜çš„æŒ‡é’ˆã€‚ #include stdio.h#include stdlib.h// è¿”å›åŠ¨æ€åˆ†é…å†…å­˜çš„æ•´æ•°æ•°ç»„çš„æŒ‡é’ˆint* createIntArray(int size) int* arr = (int*)malloc(size * sizeof(int)); // ä½¿ç”¨mallocåŠ¨æ€åˆ†é…å†…å­˜ // å‡è®¾åˆ†é…å†…å­˜æˆåŠŸï¼Œå°†æ•°ç»„å…ƒç´ åˆå§‹åŒ–ä¸º0 for (int i = 0; i size; i++) arr[i] = 0; return arr; // è¿”å›æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆint main() int* ptr = createIntArray(5); // è°ƒç”¨è¿”å›æŒ‡é’ˆå€¼çš„å‡½æ•°ï¼Œæ¥æ”¶è¿”å›çš„æŒ‡é’ˆ printf(åŠ¨æ€åˆ†é…çš„æ•°ç»„ï¼š); for (int i = 0; i 5; i++) printf(%d , ptr[i]); // é€šè¿‡æŒ‡é’ˆè®¿é—®å’Œæ‰“å°æ•°ç»„å…ƒç´  printf( ); free(ptr); // é‡Šæ”¾åŠ¨æ€åˆ†é…çš„å†…å­˜ return 0; åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒcreateIntArray æ˜¯ä¸€ä¸ªè¿”å›æŒ‡é’ˆå€¼çš„å‡½æ•°ã€‚å‡½æ•°æ¥å—ä¸€ä¸ªæ•´æ•°å‚æ•° sizeï¼Œè¡¨ç¤ºè¦åˆ†é…çš„æ•°ç»„å¤§å°ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œä½¿ç”¨ malloc åŠ¨æ€åˆ†é…äº† size ä¸ªæ•´æ•°å¤§å°çš„å†…å­˜ç©ºé—´ï¼Œå¹¶å°†æŒ‡å‘è¯¥å†…å­˜çš„æŒ‡é’ˆ arr è¿”å›ã€‚ åœ¨ main å‡½æ•°ä¸­ï¼Œé€šè¿‡è°ƒç”¨ createIntArray å‡½æ•°ï¼Œå¹¶å°†è¿”å›çš„æŒ‡é’ˆèµ‹å€¼ç»™æŒ‡é’ˆå˜é‡ ptrã€‚ç„¶åï¼Œä½¿ç”¨æŒ‡é’ˆ ptr å¯ä»¥è®¿é—®å’Œæ“ä½œåŠ¨æ€åˆ†é…çš„æ•°ç»„ã€‚ åœ¨ç¤ºä¾‹ä¸­ï¼Œéå†æŒ‡é’ˆ ptrï¼Œå¹¶æ‰“å°æ•°ç»„å…ƒç´ çš„å€¼ã€‚ æœ€åï¼Œä½¿ç”¨ free å‡½æ•°é‡Šæ”¾åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œä»¥é¿å…å†…å­˜æ³„æ¼ã€‚ é€šè¿‡å®šä¹‰è¿”å›æŒ‡é’ˆå€¼çš„å‡½æ•°ï¼Œå¯ä»¥å®ç°åŠ¨æ€åˆ†é…å†…å­˜ï¼Œå¹¶å°†è¯¥å†…å­˜çš„åœ°å€è¿”å›ç»™è°ƒç”¨è€…ã€‚è¿™åœ¨éœ€è¦åœ¨å‡½æ•°å¤–éƒ¨è®¿é—®å’Œæ“ä½œåŠ¨æ€åˆ†é…çš„æ•°æ®æ—¶éå¸¸æœ‰ç”¨ã€‚ç„¶è€Œï¼Œéœ€è¦å°å¿ƒç¡®ä¿åœ¨ä½¿ç”¨è¿”å›çš„æŒ‡é’ˆä¹‹å‰ï¼Œè¿›è¡Œåˆé€‚çš„å†…å­˜ç®¡ç†å’Œé”™è¯¯å¤„ç†ã€‚ æŒ‡é’ˆæ•°ç»„å’Œå¤šé‡æŒ‡é’ˆæŒ‡é’ˆæ•°ç»„å’Œå¤šé‡æŒ‡é’ˆæ˜¯åœ¨ C è¯­è¨€ä¸­ç”¨äºå¤„ç†æŒ‡é’ˆçš„æ¦‚å¿µã€‚å®ƒä»¬æä¾›äº†å¯¹å¤šä¸ªæŒ‡é’ˆçš„ç®¡ç†å’Œæ“ä½œï¼Œä½¿å¾—å¯ä»¥æ›´çµæ´»åœ°å¤„ç†å’Œè®¿é—®å†…å­˜ä¸­çš„æ•°æ®ã€‚ æŒ‡é’ˆæ•°ç»„ï¼šæŒ‡é’ˆæ•°ç»„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶å…ƒç´ éƒ½æ˜¯æŒ‡é’ˆç±»å‹ã€‚æ¯ä¸ªå…ƒç´ å¯ä»¥æŒ‡å‘ä¸åŒç±»å‹çš„æ•°æ®æˆ–æ•°æ®ç»“æ„ã€‚é€šè¿‡æŒ‡é’ˆæ•°ç»„ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†å¤šä¸ªæŒ‡é’ˆï¼Œæ¯ä¸ªæŒ‡é’ˆå¯ä»¥æŒ‡å‘ä¸åŒçš„å¯¹è±¡ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„æ¥å­˜å‚¨å¤šä¸ªå­—ç¬¦ä¸²çš„åœ°å€ï¼š char* strArray[3]; // å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ æŒ‡å‘ä¸€ä¸ªå­—ç¬¦ä¸² æŒ‡é’ˆæ•°ç»„å¯ä»¥ç”¨äºå®ç°è¯¸å¦‚å­—ç¬¦ä¸²æ•°ç»„ã€æŒ‡å‘ä¸åŒç±»å‹å¯¹è±¡çš„æ•°ç»„ã€å‡½æ•°æŒ‡é’ˆæ•°ç»„ç­‰ã€‚ å¤šé‡æŒ‡é’ˆï¼šå¤šé‡æŒ‡é’ˆæ˜¯æŒ‡æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆã€‚é€šè¿‡å¤šé‡æŒ‡é’ˆï¼Œå¯ä»¥å®ç°å¯¹æŒ‡é’ˆçš„é—´æ¥å¼•ç”¨å’Œæ“ä½œã€‚å¤šé‡æŒ‡é’ˆåœ¨æŸäº›æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦ä¿®æ”¹æŒ‡é’ˆæœ¬èº«çš„å€¼æ—¶ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªå¤šé‡æŒ‡é’ˆæ¥å¼•ç”¨ä¸€ä¸ªæ•´å‹æŒ‡é’ˆçš„åœ°å€ï¼š int** ptrPtr; // å®šä¹‰ä¸€ä¸ªå¤šé‡æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªæ•´å‹æŒ‡é’ˆ å¤šé‡æŒ‡é’ˆå¸¸ç”¨äºåŠ¨æ€å†…å­˜åˆ†é…ã€å¤šçº§æŒ‡é’ˆç»“æ„çš„æ•°æ®ç»“æ„ã€å‡½æ•°ä¼ é€’æŒ‡é’ˆçš„æŒ‡é’ˆç­‰æƒ…å†µã€‚ æŒ‡é’ˆæ•°ç»„å’Œå¤šé‡æŒ‡é’ˆçš„ä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š çµæ´»å­˜å‚¨å’Œç®¡ç†å¤šä¸ªæŒ‡é’ˆï¼šæŒ‡é’ˆæ•°ç»„å…è®¸å­˜å‚¨å’Œç®¡ç†å¤šä¸ªæŒ‡é’ˆï¼Œæ¯ä¸ªæŒ‡é’ˆå¯ä»¥æŒ‡å‘ä¸åŒçš„æ•°æ®æˆ–å¯¹è±¡ã€‚è¿™å¯¹äºéœ€è¦å¤„ç†å¤šä¸ªç›¸å…³æŒ‡é’ˆçš„æƒ…å†µéå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²æ•°ç»„ã€å‡½æ•°æŒ‡é’ˆæ•°ç»„ç­‰ã€‚ åŠ¨æ€å†…å­˜åˆ†é…å’Œé‡Šæ”¾ï¼šå¤šé‡æŒ‡é’ˆåœ¨åŠ¨æ€å†…å­˜åˆ†é…å’Œé‡Šæ”¾ä¸­éå¸¸æœ‰ç”¨ã€‚é€šè¿‡å¤šé‡æŒ‡é’ˆï¼Œå¯ä»¥é€šè¿‡å¼•ç”¨æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆæ¥ä¿®æ”¹æŒ‡é’ˆçš„å€¼ï¼Œä»è€Œå®ç°å¯¹åŠ¨æ€åˆ†é…å†…å­˜çš„ç®¡ç†å’Œé‡Šæ”¾ã€‚ ä¼ é€’æŒ‡é’ˆçš„æŒ‡é’ˆï¼šå¤šé‡æŒ‡é’ˆå¯ä»¥ç”¨äºå‡½æ•°å‚æ•°ï¼Œå…è®¸åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹æŒ‡é’ˆçš„å€¼ï¼Œå¹¶ä½¿å¾—ä¿®æ”¹åœ¨å‡½æ•°å¤–éƒ¨ä¹Ÿå¯è§ã€‚è¿™å¯¹äºéœ€è¦åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹æŒ‡é’ˆæœ¬èº«çš„å€¼çš„æƒ…å†µéå¸¸æœ‰ç”¨ã€‚ æ€»è€Œè¨€ä¹‹ï¼ŒæŒ‡é’ˆæ•°ç»„å’Œå¤šé‡æŒ‡é’ˆæä¾›äº†å¯¹æŒ‡é’ˆçš„çµæ´»ç®¡ç†å’Œæ“ä½œçš„èƒ½åŠ›ã€‚å®ƒä»¬åœ¨ C è¯­è¨€ä¸­å¸¸ç”¨äºå¤„ç†å¤æ‚çš„æ•°æ®ç»“æ„ã€åŠ¨æ€å†…å­˜åˆ†é…ã€å‡½æ•°æŒ‡é’ˆç­‰æƒ…å†µä¸‹ï¼Œæä¾›äº†æ›´é«˜çº§çš„æŒ‡é’ˆä½¿ç”¨æ–¹å¼ï¼Œä½¿å¾—ç¨‹åºå¯ä»¥æ›´åŠ çµæ´»åœ°æ“ä½œå’Œå¤„ç†å†…å­˜ä¸­çš„æ•°æ®ã€‚ åŠ¨æ€å†…å­˜åˆ†é…ä¸æŒ‡å‘å®ƒçš„æŒ‡é’ˆå˜é‡ éé™æ€çš„å±€éƒ¨å˜é‡æ˜¯åˆ†é…åœ¨å†…å­˜ä¸­çš„åŠ¨æ€å­˜å‚¨åŒºçš„ï¼Œè¿™ä¸ªå­˜å‚¨åŒºæ˜¯ä¸€ä¸ªç§°ä¸ºæ ˆçš„åŒºåŸŸC è¯­è¨€è¿˜å…è®¸å»ºç«‹å†…å­˜åŠ¨æ€åˆ†é…åŒºåŸŸï¼Œä»¥å­˜æ”¾ä¸€äº›ä¸´æ—¶ç”¨çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®éœ€è¦æ—¶éšæ—¶å¼€è¾Ÿï¼Œä¸éœ€è¦æ—¶éšæ—¶é‡Šæ”¾ã€‚è¿™äº›æ•°æ®æ˜¯ä¸´æ—¶å­˜æ”¾åœ¨ä¸€ä¸ªç‰¹åˆ«çš„è‡ªç”±å­˜å‚¨åŒºï¼Œç§°ä¸ºå †åŒº åŠ¨æ€å†…å­˜åˆ†é…æ˜¯æŒ‡åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œæ ¹æ®éœ€è¦åœ¨å †ï¼ˆHeapï¼‰ä¸­åŠ¨æ€åœ°åˆ†é…å†…å­˜ç©ºé—´ã€‚ä¸é™æ€å†…å­˜åˆ†é…ç›¸å¯¹ï¼Œé™æ€å†…å­˜åˆ†é…æ˜¯åœ¨ç¼–è¯‘æ—¶ä¸ºå˜é‡æˆ–æ•°æ®ç»“æ„åˆ†é…å›ºå®šå¤§å°çš„å†…å­˜ç©ºé—´ã€‚ åœ¨ C è¯­è¨€ä¸­ï¼ŒåŠ¨æ€å†…å­˜åˆ†é…ä½¿ç”¨äº†å…³é”®çš„å‡½æ•°ï¼šmallocï¼Œcallocï¼Œfreeï¼Œreallocã€‚malloc å‡½æ•°ç”¨äºåŠ¨æ€åˆ†é…å†…å­˜ç©ºé—´ï¼Œè€Œ free å‡½æ•°ç”¨äºé‡Šæ”¾ä¹‹å‰åˆ†é…çš„å†…å­˜ç©ºé—´ã€‚ å½“ä½¿ç”¨ malloc å‡½æ•°æ—¶ï¼Œéœ€è¦æŒ‡å®šè¦åˆ†é…çš„å†…å­˜ç©ºé—´çš„å¤§å°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘è¯¥å†…å­˜ç©ºé—´çš„æŒ‡é’ˆã€‚è¿™æ ·å°±å¯ä»¥é€šè¿‡æŒ‡é’ˆæ¥å¼•ç”¨å’Œæ“ä½œè¿™å—åŠ¨æ€åˆ†é…çš„å†…å­˜ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºäº†åŠ¨æ€å†…å­˜åˆ†é…å’ŒæŒ‡å‘å®ƒçš„æŒ‡é’ˆå˜é‡çš„ä½¿ç”¨ï¼š #include stdio.h#include stdlib.hint main() int* ptr; // å£°æ˜ä¸€ä¸ªæŒ‡é’ˆå˜é‡ ptr = (int*)malloc(sizeof(int)); // åŠ¨æ€åˆ†é…ä¸€ä¸ªæ•´æ•°å¤§å°çš„å†…å­˜ç©ºé—´ if (ptr == NULL) printf(å†…å­˜åˆ†é…å¤±è´¥ ); return 1; *ptr = 42; // ä½¿ç”¨æŒ‡é’ˆè®¿é—®å’Œä¿®æ”¹åŠ¨æ€åˆ†é…çš„å†…å­˜ printf(åŠ¨æ€åˆ†é…çš„å†…å­˜ä¸­çš„å€¼ï¼š%d , *ptr); free(ptr); // é‡Šæ”¾åŠ¨æ€åˆ†é…çš„å†…å­˜ return 0; åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œé¦–å…ˆå£°æ˜ä¸€ä¸ªæŒ‡é’ˆå˜é‡ ptrã€‚ç„¶åï¼Œä½¿ç”¨ malloc å‡½æ•°åŠ¨æ€åˆ†é…ä¸€ä¸ªæ•´æ•°å¤§å°çš„å†…å­˜ç©ºé—´ï¼Œå¹¶å°†è¿”å›çš„æŒ‡é’ˆèµ‹å€¼ç»™ ptrã€‚é€šè¿‡å°† sizeof(int)ä½œä¸ºå‚æ•°ä¼ é€’ç»™ mallocï¼Œå¯ä»¥ç¡®ä¿åˆ†é…çš„å†…å­˜ç©ºé—´è¶³å¤Ÿå­˜å‚¨ä¸€ä¸ªæ•´æ•°ã€‚ æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä½¿ç”¨æŒ‡é’ˆ ptr æ¥è®¿é—®å’Œä¿®æ”¹åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œä¾‹å¦‚å°†æ•´æ•°å€¼ 42 å­˜å‚¨åˆ°åˆ†é…çš„å†…å­˜ä¸­ã€‚ æœ€åï¼Œåœ¨ä¸å†éœ€è¦åŠ¨æ€åˆ†é…çš„å†…å­˜æ—¶ï¼Œä½¿ç”¨ free å‡½æ•°é‡Šæ”¾è¯¥å†…å­˜ç©ºé—´ã€‚è¿™æ˜¯éå¸¸é‡è¦çš„ï¼Œä»¥é˜²æ­¢å†…å­˜æ³„æ¼å’Œèµ„æºæµªè´¹ã€‚ åŠ¨æ€å†…å­˜åˆ†é…ä¸æŒ‡å‘å®ƒçš„æŒ‡é’ˆå˜é‡çš„ä½¿ç”¨å…è®¸åœ¨ç¨‹åºè¿è¡Œæ—¶æ ¹æ®éœ€è¦åˆ†é…å’Œé‡Šæ”¾å†…å­˜ç©ºé—´ã€‚è¿™å¯¹äºéœ€è¦åœ¨è¿è¡Œæ—¶åŠ¨æ€ç®¡ç†æ•°æ®çš„å¤§å°å’Œç”Ÿå‘½å‘¨æœŸçš„æƒ…å†µéå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚åŠ¨æ€åˆ›å»ºæ•°ç»„ã€æ„å»ºåŠ¨æ€æ•°æ®ç»“æ„ç­‰ã€‚ç„¶è€Œï¼Œéœ€è¦è°¨æ…ä½¿ç”¨åŠ¨æ€å†…å­˜åˆ†é…ï¼Œç¡®ä¿é€‚å½“åœ°ç®¡ç†å’Œé‡Šæ”¾åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œä»¥é¿å…å†…å­˜æ³„æ¼å’Œæ½œåœ¨çš„é”™è¯¯ã€‚ æœ‰å…³æŒ‡é’ˆçš„å°ç»“æŒ‡é’ˆçš„åŸºæœ¬æ¦‚å¿µï¼šæŒ‡é’ˆæ˜¯ä¸€ä¸ªå˜é‡ï¼Œå…¶å€¼æ˜¯å†…å­˜åœ°å€ã€‚æŒ‡é’ˆå¯ä»¥æŒ‡å‘ä¸åŒç±»å‹çš„æ•°æ®æˆ–æ•°æ®ç»“æ„ã€‚é€šè¿‡æŒ‡é’ˆå¯ä»¥è®¿é—®å’Œæ“ä½œæ‰€æŒ‡å‘çš„æ•°æ®ã€‚æŒ‡é’ˆçš„å£°æ˜å’Œåˆå§‹åŒ–ï¼šæŒ‡é’ˆçš„å£°æ˜ä½¿ç”¨æŒ‡é’ˆç¬¦å· ï¼Œä¾‹å¦‚ int ptr;è¡¨ç¤º ptr æ˜¯ä¸€ä¸ªæŒ‡å‘æ•´æ•°çš„æŒ‡é’ˆã€‚å¯ä»¥é€šè¿‡å°†å˜é‡çš„åœ°å€èµ‹å€¼ç»™æŒ‡é’ˆæ¥åˆå§‹åŒ–æŒ‡é’ˆï¼Œä¾‹å¦‚ ptr å°†æŒ‡å‘ num å˜é‡çš„åœ°å€èµ‹å€¼ç»™ ptrã€‚æŒ‡é’ˆçš„è¿ç®—ï¼šå¯ä»¥ä½¿ç”¨è¿ç®—ç¬¦è§£å¼•ç”¨æŒ‡é’ˆï¼Œè·å–æŒ‡é’ˆæ‰€æŒ‡å‘çš„å€¼ï¼Œä¾‹å¦‚ptr è¡¨ç¤ºæŒ‡é’ˆ ptr æ‰€æŒ‡å‘çš„å€¼ã€‚å¯ä»¥ä½¿ç”¨è¿ç®—ç¬¦è·å–å˜é‡çš„åœ°å€ï¼Œä¾‹å¦‚num è¡¨ç¤ºå˜é‡ num çš„åœ°å€ã€‚å¯ä»¥ä½¿ç”¨æŒ‡é’ˆè¿›è¡Œç®—æœ¯è¿ç®—ï¼Œä¾‹å¦‚æŒ‡é’ˆçš„åŠ æ³•ã€å‡æ³•ç­‰ã€‚æŒ‡é’ˆä¸æ•°ç»„ï¼šæ•°ç»„åå¯ä»¥çœ‹ä½œæ˜¯æŒ‡å‘æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆã€‚å¯ä»¥ä½¿ç”¨æŒ‡é’ˆå¯¹æ•°ç»„è¿›è¡Œéå†ã€ä¿®æ”¹å’Œä¼ é€’ç­‰æ“ä½œã€‚é€šè¿‡æŒ‡é’ˆå¯ä»¥å®ç°åŠ¨æ€åˆ†é…æ•°ç»„å’ŒåŠ¨æ€ç®¡ç†æ•°ç»„å¤§å°ã€‚æŒ‡é’ˆä¸å­—ç¬¦ä¸²ï¼šå­—ç¬¦ä¸²åœ¨ C è¯­è¨€ä¸­æ˜¯ä»¥å­—ç¬¦æ•°ç»„çš„å½¢å¼å­˜å‚¨çš„ã€‚å¯ä»¥ä½¿ç”¨æŒ‡é’ˆå¼•ç”¨å’Œæ“ä½œå­—ç¬¦ä¸²ã€‚ä½¿ç”¨æŒ‡é’ˆå¯ä»¥å®ç°å­—ç¬¦ä¸²çš„éå†ã€æ‹·è´ã€è¿æ¥ç­‰æ“ä½œã€‚æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼šå¯ä»¥å®šä¹‰æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œå­˜å‚¨å‡½æ•°çš„åœ°å€ã€‚é€šè¿‡æŒ‡é’ˆå¯ä»¥è°ƒç”¨å‡½æ•°ï¼Œå®ç°å‡½æ•°çš„åŠ¨æ€è°ƒç”¨å’Œå›è°ƒæœºåˆ¶ã€‚åŠ¨æ€å†…å­˜åˆ†é…ä¸æŒ‡é’ˆï¼šä½¿ç”¨ malloc å‡½æ•°å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åˆ†é…å†…å­˜ç©ºé—´ã€‚é€šè¿‡æŒ‡é’ˆå¼•ç”¨å’Œæ“ä½œåŠ¨æ€åˆ†é…çš„å†…å­˜ã€‚ä½¿ç”¨ free å‡½æ•°é‡Šæ”¾åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚ æŒ‡é’ˆæ˜¯ C è¯­è¨€ä¸­å¼ºå¤§è€Œçµæ´»çš„æ¦‚å¿µï¼Œå®ƒå…è®¸ç›´æ¥è®¿é—®å†…å­˜å’Œæ•°æ®ï¼Œå¹¶æä¾›äº†åŠ¨æ€åˆ†é…å†…å­˜ã€å¤„ç†å¤æ‚æ•°æ®ç»“æ„ã€å®ç°é«˜çº§ç¼–ç¨‹æŠ€å·§ç­‰èƒ½åŠ›ã€‚æŒ‡é’ˆçš„æ­£ç¡®ä½¿ç”¨éœ€è¦æ³¨æ„å†…å­˜ç®¡ç†ã€ç©ºæŒ‡é’ˆæ£€æŸ¥ç­‰ç»†èŠ‚ï¼Œä»¥ç¡®ä¿ç¨‹åºçš„æ­£ç¡®æ€§å’Œå¥å£®æ€§ã€‚ç†è§£å’ŒæŒæ¡æŒ‡é’ˆçš„ç›¸å…³çŸ¥è¯†ç‚¹å’Œç”¨æ³•ï¼Œæœ‰åŠ©äºæ›´å¥½åœ°ç†è§£å’Œç¼–å†™ C è¯­è¨€ç¨‹åºã€‚ æ€»ç»“ é¦–å…ˆè¦å‡†ç¡®åœ°å¼„æ¸…æ¥šæŒ‡é’ˆçš„å«ä¹‰ã€‚æŒ‡é’ˆå°±æ˜¯åœ°å€ï¼Œå‡¡æ˜¯å‡ºç°â€æŒ‡é’ˆâ€çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥ç”¨â€åœ°å€â€ä»£æ›¿ï¼Œä¾‹å¦‚ï¼Œå˜é‡çš„æŒ‡é’ˆå°±æ˜¯å˜é‡çš„åœ°å€ï¼ŒæŒ‡é’ˆå˜é‡å°±æ˜¯åœ°å€å˜é‡ è¦åŒºåˆ«æŒ‡é’ˆå’ŒæŒ‡é’ˆå˜é‡ã€‚æŒ‡é’ˆå°±æ˜¯åœ°å€æœ¬èº«ï¼Œè€ŒæŒ‡é’ˆå˜é‡æ˜¯ç”¨æ¥å­˜æ”¾åœ°å€çš„å˜é‡ã€‚ ä»€ä¹ˆå«â€æŒ‡å‘â€ï¼Ÿåœ°å€å°±æ„å‘³ç€æŒ‡å‘ï¼Œå› ä¸ºé€šè¿‡åœ°å€èƒ½æ‰¾åˆ°å…·æœ‰è¯¥åœ°å€çš„å¯¹è±¡ã€‚å¯¹äºæŒ‡é’ˆå˜é‡æ¥è¯´ï¼ŒæŠŠè°çš„åœ°å€å­˜æ”¾åœ¨æŒ‡é’ˆå˜é‡ä¸­ï¼Œå°±è¯´æ­¤æŒ‡é’ˆå˜é‡æŒ‡å‘è°ã€‚ æ³¨æ„ï¼šåªæœ‰ä¸æŒ‡é’ˆå˜é‡çš„åŸºç±»å‹ç›¸åŒçš„æ•°æ®çš„åœ°å€æ‰èƒ½å­˜æ”¾åœ¨ç›¸åº”çš„æŒ‡é’ˆå˜é‡ä¸­ã€‚ void * æŒ‡é’ˆæ˜¯ä¸€ç§ç‰¹æ®Šçš„æŒ‡é’ˆï¼Œä¸æŒ‡å‘ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œå¦‚æœéœ€è¦ç”¨æ­¤åœ°å€æŒ‡å‘æŸç±»å‹çš„æ•°æ®ï¼Œåº”å…ˆå¯¹åœ°å€è¿›è¡Œç±»å‹è½¬æ¢ã€‚å¯ä»¥åœ¨ç¨‹åºä¸­è¿›è¡Œæ˜¾å¼çš„ç±»å‹è½¬æ¢ï¼Œä¹Ÿå¯ä»¥ç”±ç¼–è¯‘ç³»ç»Ÿè‡ªåŠ¨è¿›è¡Œéšå¼è½¬æ¢ã€‚æ— è®ºç”¨å“ªç§è½¬æ¢ï¼Œè¯»è€…å¿…é¡»äº†è§£è¦è¿›è¡Œç±»å‹è½¬æ¢ è¦æ·±å…¥æŒæ¡åœ¨å¯¹æ•°ç»„çš„æ“ä½œä¸­æ€æ ·æ­£ç¡®åœ°ä½¿ç”¨æŒ‡é’ˆï¼Œææ¸…æ¥šæŒ‡é’ˆçš„æŒ‡å‘ã€‚ä¸€ç»´æ•°ç»„åä»£è¡¨æ•°ç»„é¦–å…ƒç´ çš„åœ°å€ æœ‰å…³æŒ‡é’ˆå˜é‡çš„å®šä¹‰å½¢å¼çš„å½’çº³æ¯”è¾ƒ æŒ‡é’ˆè¿ç®—(1) æŒ‡é’ˆå˜é‡åŠ ï¼ˆå‡ï¼‰ä¸€ä¸ªæ•´æ•°ä¾‹å¦‚ï¼šp++,pâ€“,p+i,p-i,p+i,ï½-i ç­‰å‡æ˜¯æŒ‡é’ˆå˜é‡åŠ ï¼ˆå‡ï¼‰ä¸€ä¸ªæ•´æ•°ã€‚å°†è¯¥æŒ‡é’ˆå˜é‡çš„åŸå€¼(æ˜¯ä¸€ä¸ªåœ°å€)å’Œå®ƒæŒ‡å‘çš„å˜é‡æ‰€å ç”¨çš„å­˜å‚¨å•å…ƒçš„å­—èŠ‚æ•°ç›¸åŠ ï¼ˆå‡ï¼‰ã€‚(2) æŒ‡é’ˆå˜é‡èµ‹å€¼å°†ä¸€ä¸ªå˜é‡åœ°å€èµ‹ç»™ä¸€ä¸ªæŒ‡é’ˆå˜é‡, ä¸åº”æŠŠä¸€ä¸ªæ•´æ•°èµ‹ç»™æŒ‡é’ˆå˜é‡(3) ä¸¤ä¸ªæŒ‡é’ˆå˜é‡å¯ä»¥ç›¸å‡å¦‚æœä¸¤ä¸ªæŒ‡é’ˆå˜é‡éƒ½æŒ‡å‘åŒä¸€ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ ï¼Œåˆ™ä¸¤ä¸ªæŒ‡é’ˆå˜é‡å€¼ä¹‹å·®æ˜¯ä¸¤ä¸ªæŒ‡é’ˆä¹‹é—´çš„å…ƒç´ ä¸ªæ•°(4) ä¸¤ä¸ªæŒ‡é’ˆå˜é‡æ¯”è¾ƒè‹¥ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªæ•°ç»„çš„å…ƒç´ ï¼Œåˆ™å¯ä»¥è¿›è¡Œæ¯”è¾ƒæŒ‡å‘å‰é¢çš„å…ƒç´ çš„æŒ‡é’ˆå˜é‡â€å°äºâ€æŒ‡å‘åé¢å…ƒç´ çš„æŒ‡é’ˆå˜é‡å¦‚æœ p1 å’Œ p2 ä¸æŒ‡å‘åŒä¸€æ•°ç»„åˆ™æ¯”è¾ƒæ— æ„ä¹‰(5) æŒ‡é’ˆå˜é‡å¯ä»¥æœ‰ç©ºå€¼è¯¥æŒ‡é’ˆå˜é‡ä¸æŒ‡å‘ä»»ä½•å˜é‡ï¼Œå¯ä»¥è¿™æ ·è¡¨ç¤ºï¼špNULL;","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","æŒ‡é’ˆ"]},{"title":"æŒ‡é’ˆåŸºç¡€","path":"/2024/05/27/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-æŒ‡é’ˆ-æŒ‡é’ˆåŸºç¡€/","content":"æŒ‡é’ˆåŸºç¡€æ¦‚å¿µ: åœ°å€:å˜é‡åœ¨å†…å­˜ä¸­çš„ç¼–å·ã€‚ åœ°å€å˜é‡: å­˜æ”¾åœ°å€çš„å˜é‡ã€‚ åœ°å€ pointer (æŒ‡é’ˆ) int a = 5; a = 4;int *p = a, b; æŒ‡é’ˆå®šä¹‰: å­˜å‚¨ç±»å‹ æ•°æ®ç±»å‹ *æŒ‡é’ˆå˜é‡åï¼›int *pa;char *pc; èµ‹å€¼å¹¶åˆå§‹åŒ–: int a = 5;int *p = a; //åˆå§‹åŒ–,å®šä¹‰åŒæ—¶å¹¶èµ‹å€¼ èµ‹å€¼: int a = 5;int *p;p = a; //èµ‹å€¼*p = 6; å¼•ç”¨: * ä¸ äº’ä¸ºé€†è¿ç®—,è‡ªå³å‘å·¦ã€‚ int a = 0x666;int *p = a; //å‡å¦‚açš„åœ°å€ä¸º0x20008000, pçš„åœ°å€ä¸º0x30008000printf(%#x , a); //0x666printf(%#x , p); //0x20008000printf(%#x , *p); //0x666printf(%#x , a); //0x20008000printf(%#x , p); //0x30008000printf(%#x , *(p)); //0x20008000p == a == (*p)a == *p == *(a) æŒ‡é’ˆè¿ç®—å…³æ³¨*p++ä¸*++p çš„åŒºåˆ«ã€‚ é‡æŒ‡é’ˆvoid æŒ‡é’ˆvoid å‹æŒ‡é’ˆå¯ä»¥èµ‹å€¼ç»™å…¶ä»–ä»»æ„ç±»å‹ï¼Œä½†å…¶ä»–ç±»å‹ä¸å¯ä»¥èµ‹å€¼ç»™ void ç±»å‹æŒ‡é’ˆ. èµ‹å€¼ç»™å…¶ä»–ç±»å‹æ—¶ï¼Œå»ºè®®åŠ ä¸Šå¼ºåˆ¶ç±»å‹è½¬æ¢. int *p = (int *)malloc(N); const æŒ‡é’ˆint a = 99;int const a = 99;const int a = 99; const ä½¿ a å¸¸é‡åŒ–ã€‚ int a = 99; int b = 999;int *p = a; *p=*p+1; //é€šè¿‡pä¿®æ”¹açš„å€¼p = b; //pæŒ‡å‘å…¶ä»–å˜é‡int *const pp = a; //ppæ˜¯å¸¸é‡//pp = b; //ppæ˜¯å¸¸é‡ä¸å¯ä»¥æ”¹å˜pçš„å€¼ï¼Œå³ä¸å¯ä»¥æ”¹å˜pçš„æŒ‡å‘ã€‚*pp = *pp+1; //ä¸å¯æ”¹å˜æŒ‡å‘,ä½†å¯ä»¥æ”¹å˜æŒ‡å‘çš„å€¼.int const *qq = a; //(*qq)æ˜¯å¸¸é‡const int *qq = a; //åŒä¸Šï¼Œä¸¤ç§æ•ˆæœç›¸åŒã€‚//*qq=*qq+1; //*qqæ˜¯å¸¸é‡,ä¸å¯ä»¥é€šè¿‡*qqå»æ”¹å˜açš„å€¼ã€‚qq=b; //qqå¯ä»¥æŒ‡å‘å…¶ä»–çš„å˜é‡ã€‚a=a+1;//*qqå¸¸é‡åŒ–ï¼Œè¡¨ç¤ºä¸èƒ½é€šè¿‡*qqå»æ”¹å˜açš„å€¼ï¼Œä½†aå¯ä»¥æ”¹å˜ã€‚int const * const ppp = a; //pppå’Œ*pppéƒ½è¢«å¸¸é‡åŒ–ã€‚const int *const ppp = a; ç»ƒä¹ 1.æŒ‡é’ˆçš„åŠ å‡æ³•ï¼š char a = 100;char *p = a; è‹¥ï¼ša çš„åœ°å€ä¸º 0x20008000,åˆ™ p+1=0x______;*p + 1 =0x_____;(int )p + 1 = 0x______;(int *)p + 1 = 0x______;(char *)p + 1 = 0x______;(char)p + 1 = 0x______; 2.ä»¥ä¸‹ç¨‹åºçš„è¿è¡Œç»“æœæ˜¯ ______ã€‚ #include stdio.hmain()\tint m=1, n=2, *p=m, *q=n, *r;\tr=p; p=q; q=r;\tprintf(%d,%d,%d,%d ,m,n,*p,*q); 3ã€è‹¥æœ‰è¯­å¥ int *point,a=4; å’Œ point=a; ä¸‹é¢å‡ä»£è¡¨åœ°å€çš„ä¸€ç»„é€‰é¡¹æ˜¯ _______. a)a, point, *ab)*a, a, *pointc)*point, *point, ad)a, *point , point","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","æŒ‡é’ˆ"]},{"title":"åšå®¢éƒ¨ç½²å‰æç¬”è®°","path":"/2024/05/24/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-åšå®¢-åšå®¢éƒ¨ç½²å‰æç¬”è®°/","content":"éƒ¨ç½²å¹³å° Vercel GitHub Pages Cloudflare Pages è‡ªå»ºæœåŠ¡å™¨éƒ¨ç½² Netlifyï¼šNetlify é¢å¤–æä¾›æ¯ä¸ªç«™ç‚¹æ¯æœˆ 1000 ä¸ªå·²è¯†åˆ«çš„æ´»è·ƒç”¨æˆ·å’Œç«™ç‚¹åˆ†æã€‚ Railwayï¼šæ”¯æŒé¡¹ç›®å†… Dockerfile å’Œ docker é•œåƒï¼Œä½†ä¸æ”¯æŒ docker-compose Cloudflare çš„å®šä½ä¸ºä¸€å®¶å…¨çƒæ€§çš„äº’è”ç½‘åŸºç¡€è®¾æ–½æä¾›å•†ï¼Œæä¾›äº†ä¸€ç³»åˆ—çš„ç½‘ç»œå®‰å…¨å’Œæ€§èƒ½ä¼˜åŒ–æœåŠ¡ï¼ŒåŒ…æ‹¬å†…å®¹åˆ†å‘ç½‘ç»œ(CDN)ã€DDoS é˜²æŠ¤ã€SSLTLS åŠ å¯†ã€DNS ç®¡ç†ç­‰ã€‚Cloudflare Workersï¼ˆserverless è®¡ç®—å¹³å°ï¼‰å’Œ Cloudflare Pages å¯ä»¥ç”¨æ¥éƒ¨ç½² nextjs åº”ç”¨ã€‚ Railway æä¾›å…è´¹å®¹å™¨æœåŠ¡ã€‚æ”¯æŒä¸»æµè¯­è¨€ pythonã€nodejs ç­‰ç›´æ¥è¿è¡Œï¼Œæ”¯æŒ Dockerfile åœ¨çº¿æ„å»º docker é•œåƒã€‚æ”¯æŒä½¿ç”¨ CLI éƒ¨ç½²ã€‚æ­¤å¤–ï¼Œè¿˜æä¾›å¤§é‡æ¨¡æ¿ç›´æ¥æ„å»ºã€‚ä¾‹å¦‚ code serverï¼ˆvscode ç½‘é¡µç‰ˆï¼‰ç­‰ã€‚æŒ‰é‡ä»˜è´¹ï¼Œæ¯ä¸ªæœˆ 5 ç¾å…ƒå…è´¹é¢åº¦ï¼Œè·‘ä¸ªå°ç¨‹åºå¤Ÿç”¨ã€‚æ”¯æŒé€šè¿‡ Github repo è¿›è¡Œéƒ¨ç½² Vercel æ˜¯ä¸€ä¸ªäº‘æœåŠ¡å¹³å°ï¼Œæ”¯æŒé™æ€ç½‘ç«™å’ŒåŠ¨æ€ç½‘ç«™çš„åº”ç”¨éƒ¨ç½²ã€é¢„è§ˆå’Œä¸Šçº¿ã€‚å¦‚æœç”¨è¿‡ GitHub Pages ï¼Œé‚£ä¹ˆå¿ƒé‡Œå¯èƒ½ä¸ä¼šå¤ªé™Œç”Ÿï¼Œä¹Ÿèƒ½é€šè¿‡ vercel é›†æˆ GitHub åï¼Œåœ¨ GitHub é¡¹ç›®è¿›è¡Œä»£ç æ¨é€ï¼ŒPR åˆå¹¶è‡ªåŠ¨éƒ¨ç½²çš„ç›®çš„ï¼Œä¸”ä¸éœ€è¦è€ƒè™‘æœåŠ¡å™¨å’ŒåŸŸåé—®é¢˜ã€‚ å…¶ä»–éƒ¨ç½²æ¶‰åŠåˆ°çš„å„é¡¹å…³é”®é…ç½®æ–‡ä»¶æœ‰ä»¥ä¸‹ï¼Œå„æ–‡ä»¶è·¯å¾„åŸºäº HexoGithubObsidian çš„ä»“åº“æ ¹ç›®å½• æ–‡ä»¶æ‰€å± æ–‡ä»¶å æ–‡ä»¶è·¯å¾„ æ–‡ä»¶ç”¨é€” GitHub Actions blogPublish.yml .github/workflows ç”¨äºä»“åº“åŒæ­¥åˆ° github ä¹‹åï¼Œè‡ªåŠ¨å°†æºç ç”Ÿæˆé™æ€é¡µé¢ï¼ŒåŒæ­¥åˆ°å‘å¸ƒä»“åº“è¿›è¡Œå‘å¸ƒ GitHub .gitignore ./ ç”¨äºå¿½ç•¥ Hexo å’Œ Obsidian ä¸­ä¸éœ€è¦åŒæ­¥åˆ° Git çš„æ–‡ä»¶(æœ‰äº›æ–‡ä»¶ä½“ç§¯è¿‡å¤§ï¼Œå ç”¨ä»“åº“ä½“ç§¯) Hexo _config.yml ./ Hexo ç«™ç‚¹é…ç½®æ–‡ä»¶ Hexo package.json ./ npm å®‰è£…åŒ…åŠå‘½ä»¤æ–‡ä»¶ï¼Œéƒ¨ç½²ç«™ç‚¹æ—¶æ‰€éœ€çš„å’Œ hexo ç›¸å…³çš„ä¾èµ–åŒ…éƒ½åœ¨æ­¤æ–‡ä»¶ä¸­ Hexo-Stellar _config.yml themes/stellar/_config.yml Hexo ä¸»é¢˜é…ç½®æ–‡ä»¶ Hexo-Stellar widgets.yml themes/stellar/_data/widgets.yml Stellar ä¸»é¢˜ä¸­çš„æ§ä»¶é…ç½®æ–‡ä»¶ æ›´æ¢ä¸»é¢˜ ä¿®æ”¹ .github/workflows/blogPublish.yml è¯¥æ–‡ä»¶ä¸­æŒ‡å®šäº†ä¸»é¢˜ä»“åº“å’Œä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ä¸»é¢˜ä»“åº“ ä¿®æ”¹ _config.theme.yml è¯¥æ–‡ä»¶ä¸­é»˜è®¤ä¸º stellar çš„ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œéœ€è¦ä¿®æ”¹ä¸ºæŒ‡å®šçš„ä¸»é¢˜é…ç½®æ–‡ä»¶ ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶ _config.yml éœ€è¦åœ¨ç«™ç‚¹é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹æŒ‡å®šçš„ä¸»é¢˜ Qexoæœ¬åœ°éƒ¨ç½² åšå®¢æœ¬åœ°éƒ¨ç½²æ–¹æ¡ˆæ‹‰å–ä»“åº“å¹¶æœ¬åœ°éƒ¨ç½²è„šæœ¬ rm -rf ./BlogDeploygit clone git@github.com:liuluhua/BlogDeploy.gitcd ./BlogDeploymkdir themescd themesgit clone git@github.com:xaoxuu/hexo-theme-stellar.gitgit clone git@github.com:next-theme/hexo-theme-next.gitcd ..cp ./_config.theme.stellar.widgets.yml ./themes/hexo-theme-stellar/_data/widgets.ymlcp ./_config.theme.stellar.yml ./themes/hexo-theme-stellar/_config.ymlnpm installhexo cleanhexo ghexo s -p 9050 äº‘æœåŠ¡å™¨ç”¨ pm2 éƒ¨ç½² å…ˆç¡®ä¿å®‰è£…äº† nodejs å’Œ npmï¼Œå¹¶ä½¿ç”¨ pnpm ä½œä¸º nextjs é¡¹ç›®çš„ä¾èµ–ç®¡ç†å·¥å…· npm install -g pnpm å®‰è£… pm2 åšè¿›ç¨‹ç®¡ç† npm install -g pm2 åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å®‰è£…ä¾èµ–ï¼Œæ„å»ºè¾“å‡ºäº§ç‰© pnpm installpnpm build ä½¿ç”¨ pm2 å¯åŠ¨æœåŠ¡ pm2 start pnpm --name sorafm -- start --port 8015 ä½¿ç”¨ nginx åšåå‘ä»£ç†ï¼Œå…ˆç¡®ä¿å®‰è£…å’Œå¯åŠ¨äº† nginxï¼š sudo apt install nginxsudo systemctl start nginx ä¸º nextjs é¡¹ç›®åˆ›å»º nginx é…ç½®ï¼š sudo vi /etc/nginx/conf/sorafm.confserver listen 80; location / proxy_pass http://127.0.0.1:8015/; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; error_log /var/log/nginx/sorafm.error; nginx é‡è½½æ–°çš„ç½‘ç«™é…ç½®ï¼š sudo nginx -s reload DNS è§£æåŸŸååˆ°æœåŠ¡å™¨çš„å…¬ç½‘ ip åœ¨ DNS æ§åˆ¶å°æ·»åŠ ä¸€æ¡ A è®°å½•ï¼ŒæŒ‡å‘æœåŠ¡å™¨çš„å…¬ç½‘ ipï¼Œç­‰è§£æç”Ÿæ•ˆåï¼Œå°±å¯ä»¥è®¿é—® nextjs é¡¹ç›®äº†ã€‚ é…ç½® https è®¿é—®ï¼Œå¯ä»¥åœ¨ Ubuntu å®‰è£… certbot ç”ŸæˆåŸŸåè¯ä¹¦ï¼š sudo apt updatesudo apt install certbot python3-certbot-nginx ä¸ºæ–°åŸŸåç”Ÿæˆæ–°çš„è¯ä¹¦ï¼Œå¹¶ä½¿ç”¨ https è®¿é—® sudo certbot --nginx -d sorafm.trys.ai é…ç½®å®Œæˆåï¼Œå°±å¯ä»¥å®‰å…¨è®¿é—® nextjs é¡¹ç›®äº†ã€‚ äº‘æœåŠ¡å™¨ç”¨ Docker éƒ¨ç½²åŒæ ·æ˜¯ä½¿ç”¨ Ubuntu äº‘æœåŠ¡å™¨ï¼Œä½¿ç”¨ pm2 éƒ¨ç½² nextjs æ›´ç®€å•ç›´æ¥ï¼Œè½»é‡çº§éƒ¨ç½²ï¼ŒæœåŠ¡èµ„æºå ç”¨å°‘ã€‚ä½¿ç”¨ docker éƒ¨ç½²ï¼Œç³»ç»Ÿéš”ç¦»æ€§æ›´å¥½ï¼Œæ›´æ–¹ä¾¿ç§»æ¤ï¼Œé€‚ç”¨äºå¾®æœåŠ¡æ¶æ„ã€‚è¦ä½¿ç”¨ docker éƒ¨ç½² nextjs åº”ç”¨ï¼Œå…ˆç¡®ä¿åœ¨æœåŠ¡å™¨å®‰è£…å¥½äº† dockerï¼Œå†æ¥æ”¹é€  nextjs é¡¹ç›® ä¿®æ”¹é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ next.config.mjsï¼Œä½¿ç”¨ standalone æ¨¡å¼è¾“å‡ºç¼–è¯‘äº§ç‰© /** @type import(next).NextConfig */const nextConfig = output: standalone,;export default nextConfig; åœ¨ deploy æ–‡ä»¶å¤¹ä¸‹æ–°å»º Dockerfile æ–‡ä»¶ï¼Œå†™å…¥ docker é•œåƒæ„å»ºå†…å®¹ FROM node:18-alpine AS base# Install dependencies only when neededFROM base AS depsRUN apk add --no-cache libc6-compat yarn global add pnpmWORKDIR /app# Install dependencies based on the preferred package managerCOPY package.json pnpm-lock.yaml* ./RUN pnpm i --frozen-lockfile# Rebuild the source code only when neededFROM deps AS builderWORKDIR /app# Install dependencies based on the preferred package managerCOPY . .RUN pnpm build# Production image, copy all the files and run nextFROM base AS runnerWORKDIR /appRUN addgroup --system --gid 1001 nodejs \\ adduser --system --uid 1001 nextjs \\ mkdir .next \\ chown nextjs:nodejs .nextCOPY --from=builder /app/public ./publicCOPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/staticUSER nextjsEXPOSE 8080ENV NODE_ENV productionENV PORT 8080ENV HOSTNAME 0.0.0.0# server.js is created by next build from the standalone outputCMD [node, server.js] åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»º .dockerignore æ–‡ä»¶ï¼Œå†™å…¥æ„å»ºé•œåƒæ—¶è¦å¿½ç•¥çš„å†…å®¹ .next.vercel.vscodedatadebugnode_modules å¼€å§‹æ„å»º docker é•œåƒ sudo docker build -f deploy/Dockerfile -t sorafm:latest . ä½¿ç”¨ docker è¿è¡ŒæœåŠ¡ sudo docker run -itd -p 127.0.0.1:8014:8080 --restart=always sorafm:latest æœåŠ¡è¿è¡ŒæˆåŠŸåï¼Œå†é€šè¿‡ nginx é…ç½®å…¬ç½‘è®¿é—®ï¼ŒDNS è§£æå…¬ç½‘åŸŸåï¼Œcertbot é…ç½® https è¯ä¹¦ï¼Œè¿™ä¸‰ä¸ªæ­¥éª¤è·Ÿä¸Šé¢ä½¿ç”¨ pm2 éƒ¨ç½² nextjs çš„æ–¹æ¡ˆä¸€è‡´ã€‚ Cloudflare éƒ¨ç½²ä¸Šè¿°ä¸¤ç§æ–¹æ¡ˆï¼šä½¿ç”¨ pm2 å’Œä½¿ç”¨ docker éƒ¨ç½² nextjs åº”ç”¨ï¼Œéœ€è¦å…ˆæœ‰ä¸€å°æœåŠ¡å™¨ã€‚å¦‚æœä¸æƒ³ä¹°æœåŠ¡å™¨ï¼Œè€Œæ˜¯é€šè¿‡æ‰˜ç®¡çš„æ–¹å¼éƒ¨ç½² nextjs é¡¹ç›®ï¼Œå¯ä»¥é€‰æ‹© Cloudflare Pagesï¼Œå‡ ä¹å…è´¹çš„äº‘éƒ¨ç½²æ–¹æ¡ˆã€‚æŒ‰ç…§ Cloudflare çš„å®˜æ–¹æ–‡æ¡£ï¼Œä½¿ç”¨ Cloudflare Pages éƒ¨ç½² nextjs é¡¹ç›®ï¼Œä¸»è¦çš„æ­¥éª¤ï¼š å®‰è£…éƒ¨ç½²ä¾èµ– pnpm add -D @cloudflare/next-on-pages åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ wrangler.toml name = sorafmcompatibility_date = 2024-07-29compatibility_flags = [nodejs_compat]pages_build_output_dir = .vercel/output/static æ›´æ–° next.config.mjs æ–‡ä»¶ import setupDevPlatform from @cloudflare/next-on-pages/next-dev;/** @type import(next).NextConfig */const nextConfig = ;if (process.env.NODE_ENV === development) await setupDevPlatform();export default nextConfig; ä¿®æ”¹æœåŠ¡ç«¯è·¯ç”±è¿è¡Œæ—¶ï¼Œå¯¹æ‰€æœ‰çš„ api è·¯ç”±æ–‡ä»¶ route.ts å’Œæ‰€æœ‰çš„é¡µé¢è·¯ç”±æ–‡ä»¶ page.tsx éƒ½æ·»åŠ ä¸€è¡Œä»£ç ï¼ŒæŒ‡å®šä½¿ç”¨ edge è¿è¡Œæ—¶ï¼š export const runtime = edge; ä¿®æ”¹ package.json æ–‡ä»¶ï¼Œæ·»åŠ ç¼–è¯‘æŒ‡ä»¤ pages:build: npx @cloudflare/next-on-pages,preview: pnpmb pages:build wrangler pages dev,deploy: pnpm pages:build wrangler pages deploy åœ¨é¡¹ç›®æ ¹ç›®å½•é€šè¿‡å‘½ä»¤è¡Œéƒ¨ç½²é¡¹ç›®åˆ° Cloudflare Pages npm run deploy åœ¨ç¬¬ä¸€æ¬¡è¿è¡Œ deploy å‘½ä»¤æ—¶ï¼Œéœ€è¦å¡«å†™é¡¹ç›®åç§°ï¼Œè·³è½¬ Cloudflare è¿›è¡ŒæˆæƒéªŒè¯ç­‰ã€‚å‘å¸ƒå®Œæˆåï¼Œå°±å¯ä»¥åœ¨ Cloudflare-Workers and Pages ç®¡ç†åå°çœ‹åˆ°é¡¹ç›®äº†ã€‚è·Ÿ Vercel ä¸€æ ·ï¼ŒCloudflare ä¹Ÿä¸ºå‘å¸ƒçš„é¡¹ç›®ç”Ÿæˆä¸€ä¸ªå­åŸŸåï¼šxxx.pages.devï¼Œéƒ¨ç½²æˆåŠŸå¯ç›´æ¥å…¬ç½‘è®¿é—®ï¼Œæ–¹ä¾¿é¡¹ç›®å¿«é€Ÿä¸Šçº¿éªŒè¯ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨","åšå®¢"]},{"title":"æŒ‡é’ˆå®šä¹‰","path":"/2024/05/23/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-æŒ‡é’ˆ-æŒ‡é’ˆå®šä¹‰/","content":"void funArray(int *);void funArray(int []);void funArray2(int(*)[]);void funArray2(int [][]);void pointArray(int **);void pointArray(int *[]);void funPoint(int (*)(int, char **));int (*p[3])[3];int (*p)[3];void arrayPointArray(int (*[])[3]); typedef void (*fun)(int );typedef void (*)(int) fun;//æ­¤å®šä¹‰æœ‰è¯¯ï¼Ÿfun function (fun);void (*function(void (*) (int)))(int);","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","æŒ‡é’ˆ"]},{"title":"Dockerä¸‹å°†å·²éƒ¨ç½²çš„wordpresså¤‡ä»½åŠè¿ç§»","path":"/2024/05/22/1-å¹³å°ç³»ç»Ÿ-Docker-Dockerä¸‹å°†å·²éƒ¨ç½²çš„wordpresså¤‡ä»½åŠè¿ç§»/","content":"é•œåƒ# Docker é•œåƒå¤‡ä»½ åœ¨å·²ç»éƒ¨ç½²å¥½ wordpress çš„æœºå™¨ä¸Šï¼Œä½¿ç”¨ docker save å‘½ä»¤å°† Docker é•œåƒä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ä¸­ã€‚ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†åä¸º wordpress å’Œ mysql çš„ Docker é•œåƒåˆ†åˆ«ä¿å­˜åˆ°åä¸º wordpress_image.tar å’Œ mysql_image.tar çš„æœ¬åœ°æ–‡ä»¶ä¸­ï¼š docker save wordpress wordpress_image.tar #ä¿å­˜wordpressdocker save mysql mysql_image.tar #ä¿å­˜mysql # Docker é•œåƒè¯»å– å°† wordpress_image.tar å’Œ mysql_image.tar æ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡æœºå™¨ä¸Šã€‚åœ¨ç›®æ ‡æœºå™¨ä¸Šï¼Œä½¿ç”¨ docker load å‘½ä»¤å°†æœ¬åœ°æ–‡ä»¶ä¸­çš„ Docker é•œåƒåŠ è½½åˆ° Docker ä¸­ã€‚ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†åä¸º wordpress_image.tar å’Œ mysql_image.tar çš„æœ¬åœ°æ–‡ä»¶ä¸­çš„ Docker é•œåƒåŠ è½½åˆ° Docker ä¸­ï¼š docker load wordpress_image.tardocker load mysql_image.tar æ–‡ä»¶ç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿå¤‡ä»½è¦å°† Docker ä¸­çš„æ•´ä¸ª WordPress åº”ç”¨ç¨‹åºæ‰“åŒ…å¹¶éƒ¨ç½²åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼Œå¯ä»¥ä½¿ç”¨ Docker çš„å¯¼å…¥å’Œå¯¼å‡ºåŠŸèƒ½ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š åœ¨è¿è¡Œ WordPress åº”ç”¨ç¨‹åºçš„ Docker å®¹å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†å®¹å™¨ä¸­çš„ WordPress åº”ç”¨ç¨‹åºå¯¼å‡ºä¸º tar æ–‡ä»¶ï¼š docker export container_id wordpress.tar è¿™å°†åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º wordpress.tar çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å« Docker å®¹å™¨ä¸­çš„æ•´ä¸ª WordPress åº”ç”¨ç¨‹åºã€‚ æ–‡ä»¶ç³»ç»Ÿè¯»å–å°† wordpress.tar æ–‡ä»¶ä¼ è¾“åˆ°è¦éƒ¨ç½² WordPress åº”ç”¨ç¨‹åºçš„ç›®æ ‡æœåŠ¡å™¨ä¸Šã€‚åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°† wordpress.tar æ–‡ä»¶å¯¼å…¥åˆ° Docker ä¸­ï¼š cat wordpress.tar | docker import - image_name:tag å…¶ä¸­ï¼Œimage_name æ˜¯ä¸ºå¯¼å…¥çš„ Docker é•œåƒæŒ‡å®šçš„åç§°ï¼Œtag æ˜¯ä¸ºè¯¥é•œåƒæŒ‡å®šçš„æ ‡ç­¾ã€‚è¿è¡Œå¯¼å…¥çš„ Docker é•œåƒï¼Œå¯åŠ¨ WordPress åº”ç”¨ç¨‹åºçš„å®¹å™¨ï¼š docker run -p host_port:container_port -d image_name:tag å…¶ä¸­ï¼Œhost_port æ˜¯è¦å°†å®¹å™¨çš„ç«¯å£æ˜ å°„åˆ°ä¸»æœºä¸Šçš„ç«¯å£å·ï¼Œcontainer_port æ˜¯å®¹å™¨å†…è¿è¡Œ WordPress åº”ç”¨ç¨‹åºçš„ç«¯å£å·ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥å°† Docker ä¸­çš„æ•´ä¸ª WordPress åº”ç”¨ç¨‹åºæ‰“åŒ…å¹¶éƒ¨ç½²åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚ å¯åŠ¨ Docker æŒ‰ç…§ä¹‹å‰çš„ docker-compose çš„æ–¹æ³•å¯åŠ¨ dokcer ä½¿ç”¨ docker ps -a --no-trunc éœ€è¦ä¿®æ”¹å¹¶æ·»åŠ  command wordpress æ˜¯ docker-entrypoint.sh apache2-foreground mysql æ˜¯ docker-entrypoint.sh mysqld ä½¿ç”¨ docker run å‘½ä»¤åœ¨ç›®æ ‡æœºå™¨ä¸Šå¯åŠ¨è¯¥ Docker é•œåƒã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ç›®æ ‡æœºå™¨ä¸Šå¯åŠ¨åä¸º wordpress çš„ Docker é•œåƒï¼š #å¯åŠ¨mysqldocker run -d \\--name mysql \\-v mysql_data:/var/lib/mysql \\-e MYSQL_ROOT_PASSWORD=liuluhua \\-e MYSQL_DATABASE=wordpress \\-e MYSQL_USER=liuluhua \\-e MYSQL_PASSWORD=liuluhua \\mysql:latest docker-entrypoint.sh mysqld #å¯åŠ¨wordpressdocker run -d \\--name wordpress \\--link mysql \\-p 80:80 \\-e WORDPRESS_DB_HOST=mysql:3306 \\-e WORDPRESS_DB_USER=liuluhua \\-e WORDPRESS_DB_PASSWORD=liuluhua \\-e WORDPRESS_DB_NAME=wordpress \\-v ./wp-content:/var/www/html/wp-content \\-v ./uploads.ini:/usr/local/etc/php/conf.d/uploads.ini \\wordpress:latest docker-entrypoint.sh apache2-foreground å¯åŠ¨å‚æ•°ï¼š **-d**ï¼šè¡¨ç¤ºä»¥â€åå°æ¨¡å¼â€è¿è¡Œå®¹å™¨ï¼Œå³ä½¿å®¹å™¨çš„ä¸»è¿›ç¨‹é€€å‡ºä¹Ÿä¸ä¼šåœæ­¢å®¹å™¨ã€‚ **--name**ï¼šè¡¨ç¤ºä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°å¯¹å®¹å™¨è¿›è¡Œç®¡ç†ã€‚ **-v**ï¼šè¡¨ç¤ºå°†ä¸»æœºçš„ç›®å½•æˆ–æ–‡ä»¶ä¸å®¹å™¨å†…çš„ç›®å½•æˆ–æ–‡ä»¶è¿›è¡ŒæŒ‚è½½ï¼Œå³æ•°æ®å·ã€‚ä¾‹ï¼Œ-v mysql_data:/var/lib/mysql è¡¨ç¤ºå°†ä¸»æœºçš„ mysql_data ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„ /var/lib/mysql ç›®å½•ï¼Œè¿™æ ·å®¹å™¨å†…çš„ MySQL æ•°æ®å°±å¯ä»¥æŒä¹…åŒ–å­˜å‚¨åœ¨ä¸»æœºä¸Šã€‚ **-e**ï¼šè¡¨ç¤ºè®¾ç½®å®¹å™¨å†…çš„ç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚ï¼Œ-e MYSQL_ROOT_PASSWORD=liuluhua è¡¨ç¤ºè®¾ç½®å®¹å™¨å†…çš„ MYSQL_ROOT_PASSWORD ç¯å¢ƒå˜é‡ä¸º liuluhuaã€‚ **--link**ï¼šè¡¨ç¤ºå°†ä¸€ä¸ªå®¹å™¨é“¾æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨ï¼Œä½¿å¾—å®¹å™¨ä¹‹é—´å¯ä»¥è¿›è¡Œé€šä¿¡ã€‚ä¾‹å¦‚ï¼Œ--link mysql è¡¨ç¤ºå°†å®¹å™¨é“¾æ¥åˆ°åä¸º mysql çš„å®¹å™¨ã€‚ **-p**ï¼šè¡¨ç¤ºå°†å®¹å™¨çš„ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ç«¯å£ã€‚ä¾‹å¦‚ï¼Œ-p 80:80 è¡¨ç¤ºå°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 80 ç«¯å£ï¼Œä½¿å¾—å¯ä»¥é€šè¿‡ä¸»æœºçš„ IP åœ°å€è®¿é—®å®¹å™¨å†…çš„æœåŠ¡ã€‚ **wordpress:latest å’Œ mysql:latest**ï¼šè¡¨ç¤ºä½¿ç”¨ wordpress å’Œ mysql é•œåƒçš„æœ€æ–°ç‰ˆæœ¬æ¥åˆ›å»ºå®¹å™¨ã€‚ **./wp-content:/var/www/html/wp-content å’Œ ./uploads.ini:/usr/local/etc/php/conf.d/uploads.ini**ï¼šè¡¨ç¤ºå°†ä¸»æœºä¸Šçš„ wp-content ç›®å½•å’Œ uploads.ini æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨å†…çš„ /var/www/html/wp-content ç›®å½•å’Œ /usr/local/etc/php/conf.d/uploads.ini æ–‡ä»¶ï¼Œä½¿å¾—å®¹å™¨å†…çš„ WordPress ç½‘ç«™å¯ä»¥è®¿é—®è¿™äº›æ–‡ä»¶ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Docker"]},{"title":"Dockerå‘½ä»¤","path":"/2024/05/20/1-å¹³å°ç³»ç»Ÿ-Docker-Dockerå‘½ä»¤/","content":"Docker æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨å¼•æ“ï¼Œå¯ä»¥è½»æ¾çš„ä¸ºä»»ä½•åº”ç”¨åˆ›å»ºä¸€ä¸ªè½»é‡çº§çš„ã€å¯ç§»æ¤çš„ã€è‡ªç»™è‡ªè¶³çš„å®¹å™¨ã€‚å¼€å‘è€…å’Œç³»ç»Ÿç®¡ç†å‘˜åœ¨ç¬”è®°æœ¬ä¸Šç¼–è¯‘æµ‹è¯•é€šè¿‡çš„å®¹å™¨å¯ä»¥æ‰¹é‡åœ°åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²ï¼ŒåŒ…æ‹¬ VMsï¼ˆè™šæ‹Ÿæœºï¼‰ã€bare metalã€OpenStack é›†ç¾¤ã€äº‘ç«¯ã€æ•°æ®ä¸­å¿ƒå’Œå…¶ä»–çš„åŸºç¡€åº”ç”¨å¹³å°ã€‚å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ã€‚ æ¶æ„Docker çš„æ¶æ„åŒ…æ‹¬ä»¥ä¸‹ç»„ä»¶ï¼š Docker å®ˆæŠ¤è¿›ç¨‹ï¼šè¿è¡Œåœ¨ä¸»æœºä¸Šçš„åå°è¿›ç¨‹ï¼Œè´Ÿè´£ç®¡ç† Docker å¯¹è±¡ï¼Œå¦‚é•œåƒã€å®¹å™¨ã€ç½‘ç»œå’Œæ•°æ®å·ã€‚ Docker å®¢æˆ·ç«¯ï¼šé€šè¿‡ Docker API ä¸ Docker å®ˆæŠ¤è¿›ç¨‹é€šä¿¡ã€‚ Docker é•œåƒï¼šåŒ…å«åº”ç”¨ç¨‹åºå’Œå…¶ä¾èµ–é¡¹çš„åªè¯»æ–‡ä»¶ç³»ç»Ÿã€‚ Docker å®¹å™¨ï¼šDocker é•œåƒçš„å¯è¿è¡Œå®ä¾‹ã€‚ Docker ä»“åº“ï¼šç”¨äºå­˜å‚¨ Docker é•œåƒçš„åœ°æ–¹ã€‚ ä¸»è¦éœ€è¦æ³¨æ„çš„æ˜¯é•œåƒIMAGEå’Œå®¹å™¨CONTAINER å¯ä»¥å°†é•œåƒè§†ä¸ºè™šæ‹Ÿæœºçš„ä¸€ä¸ªå¿«ç…§ï¼Œé•œåƒæ˜¯å®¹å™¨çš„åŸºç¡€ï¼Œå®šä¹‰äº†å®¹å™¨çš„åŸºæœ¬é…ç½®å’Œå†…å®¹ å®¹å™¨ï¼Œå³ä¸ºé•œåƒçš„å®ä¾‹åŒ–å†…å®¹ï¼Œå½“å¯åŠ¨ä¸€ä¸ªå®¹å™¨æ—¶ï¼ŒDocker ä¼šä»é•œåƒåˆ›å»ºä¸€ä¸ªåªè¯»çš„æ–‡ä»¶ç³»ç»Ÿå±‚ï¼Œå¹¶åœ¨å…¶ä¸Šæ·»åŠ ä¸€ä¸ªå¯å†™å±‚ï¼Œå®¹å™¨ä¸­çš„æ‰€æœ‰æ›´æ”¹å’Œæ•°æ®éƒ½å­˜å‚¨åœ¨è¿™ä¸ªå¯å†™å±‚ä¸Šã€‚ åŸºæœ¬å‘½ä»¤Docker æä¾›äº†ä¸€ç³»åˆ—å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç† Docker å®¹å™¨å’Œé•œåƒï¼Œä»¥åŠæ‰§è¡Œä¸å®¹å™¨ç›¸å…³çš„æ“ä½œ é•œåƒ docker imagesï¼šåˆ—å‡ºæœ¬åœ°æ‰€æœ‰çš„é•œåƒã€‚ -a åˆ—å‡ºæ‰€æœ‰çš„é•œåƒï¼ˆå«ä¸­é—´æ˜ åƒå±‚ï¼Œé»˜è®¤ï¼Œè¿‡æ»¤æ‰ä¸­é—´æ˜ åƒå±‚ï¼‰ --digests æ˜¾ç¤ºé•œåƒçš„æ‘˜è¦ä¿¡æ¯ï¼› -f æ˜¾ç¤ºæ»¡è¶³æ¡ä»¶çš„é•œåƒï¼› --format æŒ‡å®šè¿”å›å€¼çš„æ¨¡æ¿æ–‡ä»¶ï¼› --no-trunc æ˜¾ç¤ºå®Œæ•´çš„é•œåƒä¿¡æ¯ï¼› -q åªæ˜¾ç¤ºé•œåƒ IDã€‚ docker rmi imageï¼šåˆ é™¤ä¸€ä¸ªé•œåƒã€‚ docker pull imageï¼šä»ä»“åº“ä¸­æ‹‰å–ä¸€ä¸ªé•œåƒã€‚ docker push imageï¼šå°†ä¸€ä¸ªé•œåƒæ¨é€åˆ°ä»“åº“ä¸­ã€‚ docker run imageï¼šæ ¹æ®æŒ‡å®šçš„é•œåƒåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨ã€‚ docker build -t image_name path_to_dockerfileï¼šæ ¹æ® Dockerfile æ„å»ºæ–°çš„è‡ªå®šä¹‰é•œåƒã€‚ -f æŒ‡å®šè¦ä½¿ç”¨çš„ Dockerfile è·¯å¾„ --label=[] è®¾ç½®é•œåƒä½¿ç”¨çš„å…ƒæ•°æ®ï¼› -m è®¾ç½®å†…å­˜æœ€å¤§å€¼ --memory-swap è®¾ç½® Swap çš„æœ€å¤§å€¼ä¸ºå†…å­˜+swapï¼Œâ€-1â€è¡¨ç¤ºä¸é™ swap --no-cache åˆ›å»ºé•œåƒçš„è¿‡ç¨‹ä¸ä½¿ç”¨ç¼“å­˜ --pull å°è¯•å»æ›´æ–°é•œåƒçš„æ–°ç‰ˆæœ¬ -q å®‰é™æ¨¡å¼ï¼ŒæˆåŠŸååªè¾“å‡ºé•œåƒ ID --rm è®¾ç½®é•œåƒæˆåŠŸååˆ é™¤ä¸­é—´å®¹å™¨ --ulimit Ulimit é…ç½® docker tag æ ‡è®°æœ¬åœ°é•œåƒ docker history æŸ¥çœ‹æŒ‡å®šé•œåƒçš„åˆ›å»ºå†å² -H ä»¥å¯è¯»çš„æ ¼å¼æ‰“å°é•œåƒå¤§å°å’Œæ—¥æœŸï¼Œé»˜è®¤ä¸º trueï¼› --no-trunc æ˜¾ç¤ºå®Œæ•´çš„æäº¤è®°å½•ï¼› -q ä»…åˆ—å‡ºæäº¤è®°å½• IDã€‚ å®¹å™¨ docker psï¼šåˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ã€‚ -a åˆ—å‡ºæ‰€æœ‰ï¼ŒåŒ…æ‹¬è¿è¡Œä¸­çš„å’Œå·²ç»åœæ­¢çš„ -f æ ¹æ®æ¡ä»¶è¿‡æ»¤æ˜¾ç¤ºå†…å®¹ -l åˆ—å‡ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨ -n åˆ—å‡ºæœ€è¿‘åˆ›å»ºçš„ N ä¸ªå®¹å™¨ï¼ŒN ä¸ºæ•°å­— -q åªæ˜¾ç¤ºå®¹å™¨ ID -s æ˜¾ç¤ºæ€»æ–‡ä»¶å¤§å° docker create --name myserver nginx:latest:åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ä½†ä¸å¯åŠ¨å®ƒ docker start container_id/container_nameï¼šå¯åŠ¨å·²åœæ­¢çš„å®¹å™¨ã€‚ docker stop container_id/container_nameï¼šåœæ­¢è¿è¡Œä¸­çš„å®¹å™¨ã€‚ docker restart container_id/container_nameï¼šé‡å¯å®¹å™¨ã€‚ docker kill -s kill myweb å‚æ•° -s å‘å®¹å™¨å‘é€ä¿¡å· docker rm container_id/container_nameï¼šåˆ é™¤æŒ‡å®šå®¹å™¨ã€‚ -f å¼ºåˆ¶åˆ é™¤ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ -l åˆ é™¤æŒ‡å®šçš„é“¾æ¥ -v åˆ é™¤ä¸å®¹å™¨å…³è”å’Œå· docker logs container_id/container_nameï¼šæŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—è¾“å‡ºã€‚ -f è·Ÿè¸ªæ—¥å¿—è¾“å‡º -t æ˜¾ç¤ºæ—¶é—´æˆ³ --tail åªæ˜¾ç¤ºæœ€æ–° n æ¡å®¹å™¨æ—¥å¿— --since æ˜¾ç¤ºæŸä¸ªå¼€å§‹æ—¶é—´çš„æ‰€æœ‰æ—¥å¿— docker exec -it container_id/container_name commandï¼šåœ¨æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œç‰¹å®šå‘½ä»¤ã€‚ -d åœ¨åå°è¿è¡Œ -i ä¿æŒ STDIN æ‰“å¼€ -t åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ docker exec -it container /bin/bash è¿›å…¥ container å®¹å™¨ä¸­çš„å‘½ä»¤è¡Œ docker inspect container_id/container_nameï¼šæŸ¥çœ‹å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ IP åœ°å€ã€ç«¯å£æ˜ å°„ç­‰ã€‚ -f æŒ‡å®šè¿”å›å€¼æ ¼å¼æˆ–æ¨¡æ¿æ–‡ä»¶ -s æ˜¾ç¤ºæ€»æ–‡ä»¶å¤§å° --type ä¸ºæŒ‡å®šç±»å‹è¿”å› JSON docker port container_id/container_name æ˜¾ç¤ºæŒ‡å®šå®¹å™¨çš„ç«¯å£æ˜ å°„ è¿è¡Œdocker runåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨å¸¸ç”¨å‚æ•°å¦‚ä¸‹ï¼š-d #åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨ID-i #ä»¥äº¤äº’å¼æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œå¸¸ä¸-tå‚æ•°åŒæ—¶ä½¿ç”¨-t #ç»™å®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ï¼Œå¸¸ä¸-iå‚æ•°åŒæ—¶ä½¿ç”¨--name #ç»™å®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°-m #æŒ‡å®šå®¹å™¨ä½¿ç”¨å†…å­˜çš„æœ€å¤§å€¼--net #æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„ç½‘ç»œç±»å‹--link #é“¾æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨ å…¶ä»– docker network lsï¼šåˆ—å‡ºæ‰€æœ‰ Docker ç½‘ç»œã€‚ docker volume lsï¼šåˆ—å‡ºæ‰€æœ‰ Docker å·ã€‚ docker cp /data/index.html bd96d72ed9c7:/web/ å°†ç‰©ç†ä¸»æœºä¸­çš„ /data/index.html æ‹·è´åˆ°å®¹å™¨ bd96d72ed9c7:/web/ ç›®å½•ä¸‹ docker login ç™»é™†åˆ° Docker é•œåƒä»“åº“ï¼ŒæœªæŒ‡å®šé•œåƒä»“åº“åœ°å€ï¼Œé»˜è®¤ä¸ºå®˜æ–¹ä»“åº“ -u ç™»é™†çš„ç”¨æˆ·å -p ç™»é™†çš„å¯†ç  docker logout ç™»å‡º Docker é•œåƒä»“åº“ï¼ŒæœªæŒ‡å®šé•œåƒä»“åº“åœ°å€ï¼Œé»˜è®¤ä¸ºå®˜æ–¹ä»“åº“ docker info æ˜¾ç¤º Docker ç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬é•œåƒå’Œå®¹å™¨æ•° docker version æ˜¾ç¤º Docker ç‰ˆæœ¬ä¿¡æ¯ DockerfileDockerfile æ˜¯ä¸€ç§æ–‡æœ¬æ–‡ä»¶ï¼Œè´Ÿè´£å®šä¹‰å¦‚ä½•æ„å»º Docker é•œåƒã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†ä¸€ç³»åˆ—å…·ä½“çš„æŒ‡ä»¤å’Œå‚æ•°ï¼Œç”¨äºæŒ‡å¯¼ Docker å¼•æ“åœ¨åŸºç¡€é•œåƒä¸Šæ·»åŠ åº”ç”¨ç¨‹åºä»£ç ã€è¿è¡Œæ—¶ç¯å¢ƒã€ä¾èµ–é¡¹å’Œé…ç½®æ–‡ä»¶ç­‰ï¼Œæœ€ç»ˆç”Ÿæˆä¸€ä¸ªæ–°çš„ Docker é•œåƒã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…¸å‹çš„ Dockerfile æŒ‡ä»¤åŠå…¶è¯¦ç»†è¯´æ˜ï¼š **FROM**ï¼šæ­¤æŒ‡ä»¤æ ‡æ˜åŸºç¡€é•œåƒã€‚æ¯ä¸ª Docker é•œåƒéƒ½æ˜¯åŸºäºæŸä¸ªåŸºç¡€é•œåƒæ„å»ºçš„ï¼Œè¿™ä¸ªæŒ‡ä»¤ç”¨äºç¡®å®šæ„å»ºçš„èµ·ç‚¹ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ FROM ubuntu:latest è¡¨ç¤ºé•œåƒå°†åŸºäºæœ€æ–°ç‰ˆæœ¬çš„ Ubuntu æ“ä½œç³»ç»Ÿã€‚ **MAINTAINER**ï¼šè¿™ä¸ªæŒ‡ä»¤ç”¨äºè®¾ç½®é•œåƒçš„ä½œè€…ä¿¡æ¯ï¼Œé€šå¸¸åŒ…æ‹¬ä½œè€…çš„å§“åå’Œç”µå­é‚®ä»¶ã€‚ä¾‹å¦‚ï¼ŒMAINTAINER Senthilkumar Palani info@ostechnix.com è¯´æ˜äº†é•œåƒçš„ç»´æŠ¤è€…åŠè”ç³»æ–¹å¼ã€‚ **RUN**ï¼šç”¨äºåœ¨é•œåƒæ„å»ºè¿‡ç¨‹ä¸­æ‰§è¡Œç‰¹å®šå‘½ä»¤ã€‚å¯ä»¥ç”¨äºå®‰è£…è½¯ä»¶åŒ…ã€æ›´æ–°æ“ä½œç³»ç»Ÿã€é…ç½®ç¯å¢ƒç­‰ã€‚ä¾‹å¦‚ï¼ŒRUN apt-get install -y software-properties-common python å®‰è£…äº† Python åŠç›¸å…³è½¯ä»¶ã€‚ **CMD**ï¼šæ­¤æŒ‡ä»¤è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚å¦‚æœåœ¨è¿è¡Œé•œåƒæ—¶æœªæŒ‡æ˜å…¶ä»–å‘½ä»¤ï¼Œåˆ™ä¼šæ‰§è¡Œæ­¤é»˜è®¤å‘½ä»¤ã€‚ç¤ºä¾‹ï¼šCMD [/usr/bin/node, /var/www/app.js] è®¾ç½® Node.js æ‰§è¡Œçš„åˆå§‹è„šæœ¬ã€‚ **ENTRYPOINT**ï¼šè®¾å®šå®¹å™¨å¯åŠ¨æ—¶çš„å›ºå®šå‘½ä»¤ã€‚è™½ç„¶å®ƒä¸ CMD ç±»ä¼¼ï¼Œä½† ENTRYPOINT æ›´åŠ ä¸¥æ ¼ï¼Œå…è®¸ä¼ é€’å‚æ•°ä»¥ä¾›æŒ‡å®šå‘½ä»¤ä½¿ç”¨ã€‚ä½¿ç”¨ä¾‹ï¼šENTRYPOINT [/usr/bin/node] å¯ä¸ CMD çš„å…¶ä»–å‚æ•°ç»„åˆä½¿ç”¨ã€‚ **COPY**ï¼šå°†æœ¬åœ°æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒä¸­ã€‚ä¾‹å¦‚ï¼ŒCOPY index.html /usr/share/nginx/html/ è¿™æ¡æŒ‡ä»¤å°†æœ¬åœ°çš„ index.html æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒå†…çš„æŒ‡å®šè·¯å¾„ã€‚ **ADD**ï¼šä¸ COPY ç±»ä¼¼ï¼Œä½†æ”¯æŒå¤åˆ¶ç½‘ç»œèµ„æºå’Œè‡ªåŠ¨è§£å‹ç¼©å‹ç¼©æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼ŒADD package.tar.gz /usr/src/app/ ä¼šå°†å‹ç¼©åŒ…è§£å‹åˆ°æŒ‡å®šç›®å½•ã€‚ **WORKDIR**ï¼šè®¾å®šå®¹å™¨çš„å·¥ä½œç›®å½•ï¼Œåç»­çš„æŒ‡ä»¤å°†åœ¨æ­¤ç›®å½•ä¸‹æ‰§è¡Œã€‚ä¾‹å¦‚ï¼ŒWORKDIR /var/www ä¼šå°†å·¥ä½œç›®å½•åˆ‡æ¢åˆ° varwwwã€‚ **EXPOSE**ï¼šå£°æ˜å®¹å™¨è¿è¡Œæ—¶ç›‘å¬çš„ç«¯å£å·ï¼Œä½†ä¸ä¼šè‡ªåŠ¨å°†ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºã€‚ä¾‹å¦‚ï¼ŒEXPOSE 8080 æŒ‡å®šå®¹å™¨ä¼šç›‘å¬ 8080 ç«¯å£ã€‚ **ENV**ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥åœ¨å®¹å™¨å†…éƒ¨è¢«è®¿é—®ã€‚ç¤ºä¾‹ï¼šENV APP_ENV production è®¾ç½®äº†åä¸º APP_ENV çš„ç¯å¢ƒå˜é‡ï¼Œå€¼ä¸º productionã€‚ **ARG**ï¼šå£°æ˜æ„å»ºæ—¶å‚æ•°ï¼Œæ„å»ºè¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡ --build-arg å‚æ•°ä¼ é€’ã€‚ä¾‹å¦‚ï¼ŒARG VERSION=1.0 å¯ä»¥åœ¨æ„å»ºæ—¶æŒ‡å®šè½¯ä»¶ç‰ˆæœ¬ã€‚ **VOLUME**ï¼šåˆ›å»ºå¯ä»å®¿ä¸»æœºæˆ–å…¶ä»–å®¹å™¨æŒ‚è½½çš„æŒ‚è½½ç‚¹ã€‚æ¯”å¦‚ï¼ŒVOLUME /data ä¼šåˆ›å»ºä¸€ä¸ªåä¸º data çš„æŒ‚è½½ç‚¹ï¼Œæ–¹ä¾¿æ•°æ®å…±äº«ã€‚ **USER**ï¼šè®¾ç½®è¿è¡Œé•œåƒçš„ç”¨æˆ·ï¼Œæ¯”å¦‚ USER node å°†åˆ‡æ¢åˆ° node ç”¨æˆ·èº«ä»½è¿è¡Œå®¹å™¨ä¸­çš„å‘½ä»¤ã€‚ **ONBUILD**ï¼šå®šä¹‰åœ¨å­é•œåƒæ„å»ºæ—¶è§¦å‘æ‰§è¡Œçš„ç‰¹å®šæ“ä½œã€‚é€šè¿‡ ONBUILD RUN apt-get update è®¾å®šåç»­æ„å»ºæ—¶è‡ªåŠ¨æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ Dockerfile ç¤ºä¾‹ï¼š FROM ubuntu:latestMAINTAINER Senthilkumar Palani info@ostechnix.comRUN apt-get install -y software-properties-common pythonRUN add-apt-repository ppa:chris-lea/node.jsRUN echo deb http://us.archive.ubuntu.com/ubuntu/ jammy universe /etc/apt/sources.listRUN apt-get updateRUN apt-get install -y nodejsRUN mkdir /var/wwwADD app.js /var/www/app.jsCMD [/usr/bin/node, /var/www/app.js] è¦ä½¿ç”¨ Dockerfile åˆ›å»º Docker é•œåƒï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š # docker build -t alpine . æ³¨æ„å‘½ä»¤æœ«å°¾çš„ç‚¹ï¼ˆ.ï¼‰ï¼ŒæŒ‡ä»£å½“å‰ä¸Šä¸‹æ–‡ã€‚ è‹¥ Dockerfile å­˜æ”¾äºå…¶ä»–ç›®å½•ï¼Œå¯ä»¥ç”¨ -f æ ‡å¿—æŒ‡å®šè·¯å¾„ï¼Œä¾‹å¦‚ï¼š # docker build -f /path/to/a/Dockerfile . åˆ›å»ºé•œåƒåï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿è¡Œå®ƒï¼š # docker run -it alpine è¯¥å‘½ä»¤å°†å¯åŠ¨ Alpine å®¹å™¨å¹¶è¿æ¥åˆ°å…¶ä¸­ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿè¿›è¡Œè¿›ä¸€æ­¥çš„æ“ä½œã€‚ å¯¼å…¥å’Œå¯¼å‡º docker build é€šè¿‡æ„å»º Dockerfile åˆ›å»ºé•œåƒã€‚ docker commit å°†è¿è¡Œä¸­çš„å®¹å™¨ä¿å­˜ä¸ºæ–°é•œåƒã€‚ docker export å¯¼å‡ºå®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸º tar æ–‡ä»¶ã€‚ docker save å°†é•œåƒä¿å­˜ä¸º tar æ–‡ä»¶ï¼Œé€‚ç”¨äºé•œåƒçš„å¤‡ä»½å’Œè¿ç§»ã€‚ docker build ç›®çš„ï¼šç”¨äºä» Dockerfile åˆ›å»ºé•œåƒã€‚ è¿‡ç¨‹ï¼šå¼€å‘è€…é€šè¿‡ç¼–å†™ Dockerfileï¼Œå®šä¹‰åº”ç”¨ç¨‹åºçš„ç¯å¢ƒã€ä¾èµ–å’Œé…ç½®ã€‚æ‰§è¡Œ docker build å‘½ä»¤æ—¶ï¼ŒDocker ä¼šé€æ­¥è¯»å– Dockerfile ä¸­çš„æŒ‡ä»¤ï¼Œæ„å»ºå‡ºç›¸åº”çš„é•œåƒã€‚ ç¤ºä¾‹ï¼šå¦‚æœæœ‰ä¸€ä¸ªåä¸º Dockerfile çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«å®‰è£…æŸä¸ª Node.js åº”ç”¨çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š docker build -t my-node-app . è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º my-node-app çš„æ–°é•œåƒã€‚ docker commit ç›®çš„ï¼šç”¨äºå°†å½“å‰è¿è¡Œçš„å®¹å™¨çš„çŠ¶æ€ä¿å­˜æˆæ–°çš„é•œåƒã€‚ è¿‡ç¨‹ï¼šå½“å¯¹ä¸€ä¸ªå·²ç»å¯åŠ¨çš„å®¹å™¨è¿›è¡Œä¿®æ”¹ï¼Œå¦‚å®‰è£…æ–°è½¯ä»¶æˆ–è€…ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œå¯ä»¥ä½¿ç”¨ docker commit å‘½ä»¤ï¼Œå°†è¿™äº›æ›´æ”¹ä¿å­˜ä¸ºæ–°çš„é•œåƒã€‚ ç¤ºä¾‹ï¼šå‡è®¾æœ‰ä¸€ä¸ªåä¸º my-running-app çš„æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŠŠå®ƒçš„å½“å‰çŠ¶æ€ä¿å­˜ä¸ºæ–°çš„é•œåƒï¼š docker commit my-running-app my-new-imagedocker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]## å‚æ•°è¯´æ˜-a : æäº¤çš„é•œåƒä½œè€…ï¼›-c : ä½¿ç”¨ Dockerfile æŒ‡ä»¤æ¥åˆ›å»ºé•œåƒï¼›-m : æäº¤æ—¶çš„è¯´æ˜æ–‡å­—ï¼›-p : åœ¨ commit æ—¶ï¼Œå°†å®¹å™¨æš‚åœ æ­¤å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåä¸º my-new-image çš„æ–°é•œåƒã€‚ docker save ç›®çš„ï¼šç”¨äºå°†æœ¬åœ° Docker é•œåƒä¿å­˜ä¸ºä¸€ä¸ª tar æ–‡ä»¶ã€‚ è¿‡ç¨‹ï¼šä¸ docker export ä¸åŒï¼Œdocker save ä¼šå°†é•œåƒçš„ä¿¡æ¯å’Œæ‰€æœ‰å±‚ä¸€èµ·æ‰“åŒ…ï¼Œè¿™æ ·å¯æ–¹ä¾¿åœ°åœ¨å¦ä¸€ä¸ª Docker å®ä¾‹ä¸­å¯¼å…¥ã€‚ ç¤ºä¾‹ï¼šè‹¥è¦ä¿å­˜åä¸º my-image çš„é•œåƒï¼Œå¯ä»¥ä½¿ç”¨ï¼š docker save -o my-image.tar my-image è¿™æ¡å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ªåŒ…å«é•œåƒ my-image çš„ tar æ–‡ä»¶ï¼Œå‘½åä¸º my-image.tarã€‚ docker export ç›®çš„ï¼šç”¨äºå°†å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿæ‰“åŒ…æˆ tar æ–‡ä»¶ã€‚ è¿‡ç¨‹ï¼šdocker export åªä¿ç•™å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¸åŒ…æ‹¬å…ƒæ•°æ®å’Œå†å²è®°å½•ã€‚è¿™ä¸ªå‘½ä»¤é€‚åˆäºå¤‡ä»½å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæˆ–è€…å°†å®¹å™¨å†…å®¹è¿ç§»åˆ°å¦ä¸€ä¸ªç¯å¢ƒã€‚ä½¿ç”¨ docker export å‘½ä»¤å¯¼å‡ºçš„æ–‡ä»¶æ— æ³•ç”¨ä½œ Docker é•œåƒçš„æºæ–‡ä»¶ï¼Œåªèƒ½ç”¨äºå°†å®¹å™¨è¿ç§»åˆ°å¦ä¸€ä¸ª Docker ä¸»æœºæˆ–å°†å®¹å™¨ä¸­çš„æ–‡ä»¶ç³»ç»Ÿå¯¼å‡ºåˆ°æœ¬åœ°ã€‚ ç¤ºä¾‹ï¼šå¦‚æœéœ€è¦å°†å®¹å™¨ my-container çš„æ–‡ä»¶ç³»ç»Ÿå¯¼å‡ºï¼Œå¯ä»¥æ‰§è¡Œï¼š docker export my-container my-container.tar è¿™æ ·ï¼Œä¼šç”Ÿæˆä¸€ä¸ªåä¸º my-container.tar çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«å®¹å™¨çš„æ‰€æœ‰æ–‡ä»¶ã€‚ docker loadä½¿ç”¨ docker load å‘½ä»¤æ¥å¯¼å…¥é•œåƒã€‚ docker load --input uu.tar(ä¹Ÿå¯ä»¥ä½¿ç”¨docker load -i uu.taræˆ–è€… docker load uu.tar)docker load uu.tar","categories":["1.å¹³å°ç³»ç»Ÿ","Docker"]},{"title":"Qtè½¯ä»¶æˆªå±æ–¹æ¡ˆè¯¦è§£ï¼šä»åŸç”ŸAPIåˆ°Waylandé€‚é…","path":"/2024/05/20/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qtè½¯ä»¶æˆªå±æ–¹æ¡ˆ/","content":"QScreen å’Œ Window System çš„äº¤äº’æ˜¯æ¡Œé¢åº”ç”¨å¼€å‘ä¸­å¸¸è¢«ä½ä¼°çš„å¤æ‚é¢†åŸŸã€‚æœ¬æ–‡å°†å‰¥ç¦» GUI åº“çš„è¡¨å±‚å°è£…ï¼Œæ·±å…¥æ¢è®¨ Qt æ¡†æ¶ä¸‹å®ç°å±å¹•æˆªå›¾çš„æ ¸å¿ƒæœºåˆ¶ã€è·¨å¹³å°å·®å¼‚ï¼ˆç‰¹åˆ«æ˜¯ Wayland é™·é˜±ï¼‰ä»¥åŠå¦‚ä½•é›†æˆå¼€æºç¤¾åŒºçš„æˆç†Ÿæ–¹æ¡ˆã€‚ ä¸€ã€æ ¸å¿ƒæœºåˆ¶ä¸åŸç†åœ¨ç°ä»£æ“ä½œç³»ç»Ÿä¸­ï¼Œâ€æˆªå±â€å¹¶éç®€å•çš„åƒç´ æ‹·è´ã€‚å®ƒæ¶‰åŠåº”ç”¨ç¨‹åºä¸çª—å£ç®¡ç†å™¨ (Window Manager) å’Œ åˆæˆå™¨ (Compositor) ä¹‹é—´çš„æƒé™åå•†ã€‚ 1.1 æ¶æ„å·®å¼‚ (X11Windows vs WaylandmacOS) X11 Windows (GDIDWM): ä¼ ç»Ÿçš„æ˜¾ç¤ºæœåŠ¡å…è®¸åº”ç”¨ç¨‹åºè®¿é—®æ•´ä¸ªå¸§ç¼“å†²åŒº (FrameBuffer)ã€‚QScreen::grabWindow æœ¬è´¨ä¸Šæ˜¯è°ƒç”¨åº•å±‚çš„ XLib XGetImage æˆ– Windows GDI BitBltã€‚ Wayland macOS (Sandbox): ç°ä»£åˆæˆå™¨å‡ºäºå®‰å…¨è®¾è®¡ï¼Œé»˜è®¤ç¦æ­¢åº”ç”¨ç¨‹åºè¯»å–å…¶ä»–çª—å£çš„åƒç´ å†…å®¹ã€‚QScreen::grabWindow åœ¨è¿™äº›å¹³å°ä¸Šå¾€å¾€ä¼šè¿”å›é»‘è‰²æˆ–é€æ˜å›¾åƒï¼Œé™¤éé€šè¿‡ç‰¹å®šçš„ IPC æœºåˆ¶ï¼ˆå¦‚ DBus Portalsï¼‰è¯·æ±‚æƒé™ã€‚ graph TD A[åº”ç”¨ç¨‹åº Request Grab] --|API Call| Bæ˜¾ç¤ºæœåŠ¡å™¨åè®® subgraph Legacy / Permissive B --|X11 / GDI| C[FrameBuffer Access] C -- D[ç›´æ¥è¯»å–åƒç´ ] end subgraph Modern / Sandboxed B --|Wayland / macOS| E[Compositor Check] E --|æƒé™æ‹’ç»| F[è¿”å›é»‘å±/ç©ºæ•°æ®] E --|IPC Request| G[System Permission Dialog] G --|ç”¨æˆ·å…è®¸| H[ç”±åˆæˆå™¨ä¼ é€’å›¾åƒå¥æŸ„] end äºŒã€åŸºç¡€æ–¹æ¡ˆï¼šQtåŸç”ŸAPIQt 5.0 åºŸå¼ƒäº† QPixmap::grabWindowï¼Œå…¨é¢è½¬å‘ QScreen æ¥å£ã€‚ä»¥ä¸‹æ˜¯ç”Ÿäº§ç¯å¢ƒå¯ç”¨çš„æ ‡å‡†å°è£…ï¼Œå¤„ç†äº†å¤šå±å¹•å’Œ High DPI ç¼©æ”¾é—®é¢˜ã€‚ 2.1 æ ‡å‡†ä»£ç å®ç°#include QGuiApplication#include QScreen#include QPixmap#include QDateTimeQPixmap captureScreen(QScreen *screen = nullptr) if (!screen) screen = QGuiApplication::primaryScreen(); if (!screen) return QPixmap(); // grabWindow(0) è‡ªåŠ¨å¤„ç† High DPI ç¼©æ”¾ return screen-grabWindow(0);void saveScreenshot() QPixmap pixmap = captureScreen(); if (!pixmap.isNull()) QString filename = QDateTime::currentDateTime().toString(yyyyMMdd_HHmmss) + .png; pixmap.save(filename); 2.2 High DPI é€‚é…ç»†èŠ‚ [!IMPORTANT]High DPI æ³¨æ„äº‹é¡¹: grabWindow è¿”å›çš„ QPixmap å·²ç»åŒ…å«äº†ç¼©æ”¾åçš„ç‰©ç†åƒç´ ã€‚å¦‚æœä½ çš„å±å¹•ç¼©æ”¾æ¯”ä¾‹æ˜¯ 200% (2.0)ï¼Œä¸”é€»è¾‘åˆ†è¾¨ç‡æ˜¯ 1920x1080ï¼Œåˆ™æˆªå›¾çš„å®é™…åˆ†è¾¨ç‡å°†æ˜¯ 3840x2160ã€‚åœ¨ç»˜åˆ¶æˆ–ä¿å­˜æ—¶æ— éœ€æ‰‹åŠ¨ä¹˜ä»¥ devicePixelRatioã€‚ ä¸‰ã€è¿›é˜¶æ–¹æ¡ˆï¼šè·¨å¹³å°é€‚é…å½“æ ‡å‡† API å¤±æ•ˆæ—¶ï¼ˆä¸»è¦æ˜¯ Linux Waylandï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ç”±åº”ç”¨å±‚ä¸‹æ²‰åˆ°åè®®å±‚ã€‚ 3.1 é€‚é… Linux Wayland (DBus Portal)åœ¨ Wayland ä¸‹ï¼Œå¼ºè¡Œè°ƒç”¨ grabWindow åªä¼šå¾—åˆ°é»‘å±ã€‚å¿…é¡»é€šè¿‡ XDG Desktop Portal è¯·æ±‚æˆªå›¾ã€‚è¿™æ˜¯ Flameshot å’Œ Spectacle åœ¨ Wayland ä¸‹çš„æ ¸å¿ƒå®ç°æ–¹å¼ã€‚ ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•ç›´æ¥é€šè¿‡ DBus è°ƒç”¨ Portal æ¥å£ï¼Œä¸ä¾èµ–é‡é‡çº§å¤–éƒ¨åº“ï¼š void requestWaylandScreenshot() QDBusInterface interface(org.freedesktop.portal.Desktop, /org/freedesktop/portal/desktop, org.freedesktop.portal.Screenshot, QDBusConnection::sessionBus()); QVariantMap options; options.insert(handle_token, token_ + QString::number(QDateTime::currentMSecsSinceEpoch())); options.insert(interactive, true); // è°ƒç”¨ Screenshot(parent_window, options) interface.call(Screenshot, , options); 3.2 çª—å£å¥æŸ„æˆªå– (Windowsç‰¹å®š)å¦‚æœä½ åªéœ€è¦æˆªå–ç‰¹å®šçª—å£ï¼ˆéå…¨å±ï¼‰ï¼Œåœ¨ Windows å¹³å°ä¸Šå¯ä»¥é€šè¿‡ WId å®ç°ã€‚è¿™åœ¨åˆ¶ä½œ â€œçª—å£é•œåƒâ€ æˆ– â€œåå°å½•åˆ¶â€ åŠŸèƒ½æ—¶éå¸¸æœ‰ç”¨ã€‚ QPixmap captureSpecificWindow(WId winId) // grabWindow åœ¨ Windows ä¸Šä¼ å…¥ç‰¹å®š WId å¯æˆªå–éå…¨å±å†…å®¹ return QGuiApplication::primaryScreen()-grabWindow(winId); å››ã€å¸¸è§é—®é¢˜ä¸å±€é™æ€§4.1 æ ¸å¿ƒç—›ç‚¹ (Pain Points) å…‰æ ‡æ•è·: QScreen::grabWindow é€šå¸¸ä¸åŒ…å«é¼ æ ‡å…‰æ ‡ã€‚å¦‚æœéœ€è¦å½•åˆ¶å¸¦å…‰æ ‡çš„æ•™ç¨‹ï¼Œéœ€è¦æ‰‹åŠ¨ QCursor::pos() è·å–ä½ç½®å¹¶åœ¨ Pixmap ä¸Š QPainter::drawPixmap å åŠ å…‰æ ‡å›¾æ ‡ã€‚ OpenGL Widget: å¦‚æœç›®æ ‡çª—å£ä¸»è¦æ˜¯ OpenGL Vulkan æ¸²æŸ“çš„ï¼ˆå¦‚ 3D æ¸¸æˆè§†å£ï¼‰ï¼ŒgrabWindow å¯èƒ½ä¼šæŠ“åˆ°æœªåˆ·æ–°çš„ç¼“å†²åŒºã€‚æ­¤æ—¶åº”ä¼˜å…ˆä½¿ç”¨ QOpenGLWidget::grabFramebuffer()ã€‚ macOS æƒé™: macOS 10.15+ å¯¹å±å¹•æˆªå›¾æœ‰ä¸¥æ ¼çš„æƒé™ç®¡æ§ã€‚åº”ç”¨é¦–æ¬¡è°ƒç”¨ grabWindow() æ—¶ä¼šè§¦å‘ç³»ç»Ÿæƒé™è¯·æ±‚å¯¹è¯æ¡†ï¼Œç”¨æˆ·éœ€åœ¨ â€œç³»ç»Ÿè®¾ç½® - éšç§ä¸å®‰å…¨ - å±å¹•å½•åˆ¶â€ ä¸­ä¸ºåº”ç”¨æˆæƒã€‚macOS æ²¡æœ‰æä¾›ä¸“é—¨çš„ Info.plist é”®æ¥è‡ªå®šä¹‰å±å¹•å½•åˆ¶æƒé™æç¤ºï¼Œæƒé™ç”±ç³»ç»Ÿç»Ÿä¸€ç®¡ç†ã€‚è‹¥æœªæˆæƒï¼Œæˆªå±ç»“æœå°†åªæ˜¾ç¤ºæ¡Œé¢èƒŒæ™¯æˆ–ç©ºç™½å›¾åƒã€‚ äº”ã€æ–¹æ¡ˆå¯¹æ¯”ä¸æ€»ç»“5.1 æŠ€æœ¯é€‰å‹å¯¹æ¯”åœ¨é€‰æ‹©æŠ€æœ¯æ–¹æ¡ˆæ—¶ï¼Œå¿…é¡»æ ¹æ®ç›®æ ‡å¹³å°åšå–èˆã€‚ æ–¹æ¡ˆ é€‚ç”¨æ¶æ„ ä¼˜ç‚¹ ç¼ºç‚¹ æ ¸å¿ƒ API Qt Native X11, Windows, macOS (éƒ¨åˆ†) ä»£ç é‡æå°‘ï¼Œæ— é¢å¤–ä¾èµ–ï¼ŒQt åŸç”Ÿå¯¹è±¡ç®¡ç† Wayland ä¸‹ä¸å¯ç”¨ï¼›macOS éœ€è¦å½•å±æƒé™é…ç½® QScreen::grabWindow Direct X11 X11 Only æ€§èƒ½æé«˜ï¼Œå¯ç©¿é€éƒ¨åˆ†è¦†ç›–å±‚ å·²è¿‡æ—¶ï¼Œæ— æ³•ç§»æ¤ï¼Œå¤æ‚çš„å†…å­˜ç®¡ç† XGetImage XShm DBus Portal Linux Wayland Flatpak Wayland å”¯ä¸€æ ‡å‡†è§£ï¼Œå®‰å…¨æ²™ç®±å…¼å®¹ å¼‚æ­¥äº¤äº’ï¼Œä¾èµ–å¤–éƒ¨ PortalæœåŠ¡ï¼Œç”¨æˆ·ä½“éªŒå‰²è£‚ï¼ˆéœ€å¼¹çª—ç¡®è®¤ï¼‰ org.freedesktop.portal Open Source Libs Cross Platform å°è£…äº†ä¸Šè¿°å·®å¼‚ï¼ˆå¦‚ KWin äº¤äº’ï¼‰ å¼•å…¥å·¨å¤§ä¾èµ– (KDE libs) æˆ–éœ€è‡ªè¡ŒæŠ½å–æ ¸å¿ƒä»£ç  Flameshot æºç  Spectacle 5.2 æ€»ç»“å»ºè®®å¯¹äºé€šç”¨è·¨å¹³å°åº”ç”¨ï¼Œæ¨èé‡‡ç”¨ åˆ†å±‚ç­–ç•¥ï¼š ä¼˜å…ˆå°è¯• QScreen::grabWindow(0)ã€‚ æ£€æµ‹å¤±è´¥ï¼ˆè¿”å› nullï¼‰æˆ–æ£€æµ‹åˆ° Wayland ç¯å¢ƒ (XDG_SESSION_TYPE=wayland) æ—¶ï¼Œé™çº§ä¸º DBus Portal æ–¹å¼ã€‚ å¯¹äºéœ€è¦æå…¶å¤æ‚æ ‡æ³¨åŠŸèƒ½çš„åœºæ™¯ï¼Œå‚è€ƒ Flameshot çš„æºç ï¼Œå°†å…¶ CaptureTool å’Œ SelectionWidget é€»è¾‘ç§»æ¤åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼Œè€Œä¸æ˜¯é‡å¤é€ è½®å­ã€‚ å‚è€ƒæ¥æº Qt Documentation: QScreen XDG Desktop Portal: Screenshot Interface Flameshot GitHub Repository","tags":["Qt","C++","å±å¹•æˆªå›¾","Wayland"],"categories":["Qtå¼€å‘"]},{"title":"Qtèµ„æºæ–‡ä»¶åŠ å¯†ä¸ç®¡ç†ï¼šä»åŸºç¡€åŸç†åˆ°é«˜é˜¶é˜²æŠ¤","path":"/2024/05/20/3-å¼€å‘æ¡†æ¶-Qt-Standby-Qtèµ„æºæ–‡ä»¶åŠ å¯†æ–¹æ¡ˆè¯¦è§£/","content":"Qt èµ„æºæ–‡ä»¶ä½“ç³»ï¼šä»å…¥é—¨ç®¡ç†åˆ°æ ¸å¿ƒé˜²æŠ¤åœ¨ Qt å¼€å‘ä¸­ï¼Œèµ„æºæ–‡ä»¶ï¼ˆResource Systemï¼‰æ˜¯ç®¡ç†å›¾åƒã€QMLã€é…ç½®ç­‰æ ¸å¿ƒèµ„äº§çš„æ ‡å‡†ç»„ä»¶ã€‚ç„¶è€Œï¼Œå…³äºå…¶å®‰å…¨æ€§çš„è¯¯è§£å¹¿æ³›å­˜åœ¨ã€‚æœ¬æ–‡å°†ä»å·¥ç¨‹åŒ–åŸºç¡€å‡ºå‘ï¼Œè¿›è€Œæ·±å…¥é«˜é˜¶å®‰å…¨é˜²æŠ¤ï¼Œæä¾›ä¸€å¥—å®Œæ•´çš„ä»ç®¡ç†åˆ°åŠ å¯†çš„è§£å†³æ–¹æ¡ˆã€‚ ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€ç¯‡â€”â€”Qt èµ„æºç³»ç»Ÿçš„å·¥ç¨‹åŒ–å®è·µqrcï¼ˆQt Resource Collectionï¼‰æ˜¯ Qt ç”¨äºå°†æ–‡ä»¶æ‰“åŒ…ä¸ºäºŒè¿›åˆ¶æ•°æ®çš„æ ¸å¿ƒæœºåˆ¶ã€‚å®ƒçš„è®¾è®¡åˆè¡·å¹¶éä¸ºäº†å®‰å…¨ï¼Œè€Œæ˜¯ä¸ºäº†éƒ¨ç½²ä¾¿åˆ©æ€§ä¸è·¨å¹³å°ä¸€è‡´æ€§ã€‚ 1.1 ä¸ºä»€ä¹ˆå¿…é¡»ä½¿ç”¨ qrcï¼Ÿåœ¨ç°ä»£ C++Qt å·¥ç¨‹ä¸­ï¼Œä½¿ç”¨ qrc ä¸»è¦è§£å†³äº†ä¸‰å¤§ç—›ç‚¹ï¼š **è·¯å¾„åœ°ç‹± (Path Hell)**ï¼šå½»åº•æ¶ˆé™¤ç›¸å¯¹è·¯å¾„ä¾èµ–ï¼Œæ— è®ºæ˜¯ Windows çš„ \\ è¿˜æ˜¯ Linux çš„ /ï¼Œç»Ÿä¸€ä½¿ç”¨ :/ åè®®è®¿é—®ï¼Œä¿è¯ä»£ç çš„â€œä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œâ€ã€‚ å¥æŸ„ä¸éƒ¨ç½²é™åˆ¶ï¼šWindows ç³»ç»Ÿå¯¹æ‰“å¼€æ–‡ä»¶å¥æŸ„æ•°æœ‰é™åˆ¶ï¼Œä¸”æ•£ä¹±çš„æˆç™¾ä¸Šåƒä¸ªå°ç´ ææ–‡ä»¶ææ˜“åœ¨å®‰è£…è¿‡ç¨‹ä¸­ä¸¢å¤±ã€‚QRC å°†å…¶æ‰“åŒ…ä¸ºå•ä¸€äºŒè¿›åˆ¶ï¼Œéƒ¨ç½²æå…¶ç¨³å¥ã€‚ å†…å­˜ä¼˜åŒ–ï¼šQt çš„èµ„æºç³»ç»Ÿåº•å±‚å¯¹å¤§æ–‡ä»¶ä½¿ç”¨äº†å†…å­˜æ˜ å°„ï¼ˆmmapï¼‰æŠ€æœ¯ï¼Œåœ¨åŠ è½½é€Ÿåº¦å’Œå†…å­˜å ç”¨ä¸Šå¾€å¾€ä¼˜äºç®€å•çš„æ–‡ä»¶æµè¯»å–ã€‚ 1.2 å·¥ç¨‹åŒ–ç¼–è¯‘ï¼šrcc å·¥å…·è¯¦è§£rcc æ˜¯ Qt æä¾›çš„èµ„æºç¼–è¯‘å™¨ï¼Œå®ƒæ”¯æŒä¸¤ç§æ ¸å¿ƒè¾“å‡ºæ¨¡å¼ï¼š **å†…åµŒæ¨¡å¼ (Embedded)**ï¼šå°†èµ„æºç¼–è¯‘ä¸º C++ æºç æ•°ç»„ï¼ˆunsigned char[]ï¼‰ï¼Œç›´æ¥ç¼–è¯‘è¿› .exe ä¸­ã€‚é€‚åˆæ ¸å¿ƒ UIã€å›¾æ ‡ç­‰å¿…éœ€èµ„æºã€‚rcc -name assets assets.qrc -o qrc_assets.cpp **å¤–æŒ‚æ¨¡å¼ (External Binary)**ï¼šå°†èµ„æºç¼–è¯‘ä¸º .rcc äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿è¡Œæ—¶åŠ¨æ€åŠ è½½ã€‚é€‚åˆä¸»é¢˜åŒ… (Themes)ã€DLC å†…å®¹ã€å¤šè¯­è¨€åŒ…ã€‚rcc -binary assets.qrc -o assets.rcc 1.3 èµ„æºåŠ è½½ä¸è®¿é—®æŠ€å·§ **åŠ¨æ€åŠ è½½ (Hot Loading)**ï¼šåˆ©ç”¨ QResource::registerResource å¯å®ç°è¿è¡Œæ—¶åŠ è½½å¤–éƒ¨èµ„æºåŒ…ï¼Œè¿™æ˜¯å®ç°â€œæ¢è‚¤â€åŠŸèƒ½çš„åŸºçŸ³ã€‚ #include QResourceint main(int argc, char *argv[]) QApplication app(argc, argv); // åŠ¨æ€æ³¨å†Œå¤–éƒ¨èµ„æºåŒ…ï¼Œè¿”å› true è¡¨ç¤ºæˆåŠŸ if (!QResource::registerResource(skins/dark_theme.rcc)) qWarning() Failed to load theme resource; return app.exec(); ç»Ÿä¸€è®¿é—®åè®®ï¼šæ— è®ºèµ„æºåœ¨å†…éƒ¨è¿˜æ˜¯å¤–éƒ¨ï¼Œå‡é€šè¿‡ :/ å‰ç¼€è®¿é—®ã€‚ // C++QPixmap pixmap(:/images/logo.png);// QMLImage source: qrc:/images/logo.png ç¬¬äºŒéƒ¨åˆ†ï¼šå®‰å…¨åˆ†æâ€”â€”æ‹¨å¼€ RCC çš„å®‰å…¨è¿·é›¾åœ¨å•†ä¸šè½¯ä»¶äº¤ä»˜ä¸­ï¼Œä¿æŠ¤ QML æºç ã€é«˜æ¸…è´´å›¾ã€ç‹¬å®¶ç®—æ³•æ¨¡å‹ç­‰ IP èµ„äº§è‡³å…³é‡è¦ã€‚ 2.1 æ ¸å¿ƒè¯¯åŒºï¼šrcc æ˜¯åŠ å¯†å·¥å…·å—ï¼Ÿ [!CAUTION]ç­”æ¡ˆï¼šç»å¯¹ä¸æ˜¯ã€‚ ä¸è¦è¢«äºŒè¿›åˆ¶çš„åç¼€åè¿·æƒ‘ã€‚ rcc æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåºåˆ—åŒ– (Serialization) å·¥å…·ï¼Œè€ŒéåŠ å¯†å·¥å…·ã€‚ **é€æ˜æ€§ (Transparency)**ï¼šä»»ä½•ä½¿ç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨ï¼ˆå¦‚ 010 Editorï¼‰çš„äººï¼Œéƒ½å¯ä»¥ç›´æ¥æ‰“å¼€ .rcc æ–‡ä»¶çœ‹åˆ°æ¸…æ™°å¯è§çš„ QML æºä»£ç  ASCII æ–‡æœ¬ã€‚ **å¯é€†æ€§ (Reversibility)**ï¼šç¤¾åŒºå­˜åœ¨å¤§é‡å¼€æºå·¥å…·ï¼ˆå¦‚ rcc-extractorï¼‰ï¼Œèƒ½å¤Ÿä¸€é”®æ‰«æ .exe æˆ– .rccï¼Œå°†å…¶ä¸­çš„ç›®å½•æ ‘å®Œæ•´è¿˜åŸï¼Œè¿æ–‡ä»¶åéƒ½ä¸ä¼šä¸¢å¤±ã€‚ 2.2 ä¸ºä»€ä¹ˆ Qt åŸç”Ÿä¸æ”¯æŒåŠ å¯†ï¼ŸQt çš„ QResource æœºåˆ¶ä¸ºäº†ä¿è¯åŠ è½½é€Ÿåº¦ï¼Œè¦æ±‚ä¼ å…¥çš„æ•°æ®å¿…é¡»ç¬¦åˆæ ‡å‡†çš„ RCC ç»“æ„å¸ƒå±€ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬æ— æ³•ç®€å•åœ°å°†ä¸€ä¸ª AES åŠ å¯†åçš„æ–‡ä»¶ç›´æ¥ä¼ ç»™ QResource è®©å…¶è¯†åˆ«ã€‚ ç¬¬ä¸‰éƒ¨åˆ†ï¼šè¿›é˜¶å®æˆ˜â€”â€”æ„å»ºçœŸÂ·åŠ å¯†èµ„æºç®¡çº¿è¦å®ç°çœŸæ­£çš„èµ„æºä¿æŠ¤ï¼Œæˆ‘ä»¬å¿…é¡»æ¥ç®¡ Qt çš„èµ„æºåŠ è½½ï¼ˆLoadingï¼‰ ç¯èŠ‚ã€‚ 3.1 æ¶æ„è®¾è®¡æ ¸å¿ƒç­–ç•¥ä¸ºï¼š**â€åŠ å¯†å­˜å‚¨ - å†…å­˜è§£å¯† - å†…å­˜åŠ è½½â€**ã€‚å³èµ„æºåœ¨ç£ç›˜ä¸Šæ˜¯é«˜å¼ºåº¦åŠ å¯†çš„ï¼Œåªæœ‰åœ¨ App è¿è¡Œæ—¶çš„å†…å­˜ä¸­æ‰æ˜¯æ˜æ–‡ã€‚ sequenceDiagram participant Disk as ç£ç›˜ (Encrypted) participant Loader as è‡ªå®šä¹‰åŠ è½½å™¨ participant Mem as å†…å­˜ (Decrypted) participant Engine as QML/Qtå¼•æ“ Note over Disk, Loader: æ„å»ºé˜¶æ®µï¼šAESåŠ å¯†ç”Ÿæˆ .dat Engine-Loader: è¯·æ±‚èµ„æº (e-qrc://main.qml) Loader-Disk: è¯»å–åŠ å¯†äºŒè¿›åˆ¶æµ Disk--Loader: è¿”å›å¯†æ–‡æ•°æ® Loader-Loader: AES-256 è§£å¯† Loader--Mem: å†™å…¥è§£å¯†åçš„ ByteData Mem--Engine: è¿”å› QNetworkReply (å†…å­˜æµ) Note over Mem, Engine: å¼•æ“æ— ç¼åŠ è½½ï¼Œæ— ä¸´æ—¶æ–‡ä»¶ 3.2 æ­¥éª¤ä¸€ï¼šåŠ å¯†èµ„æºç”Ÿæˆ (Build Time)ç¼–å†™ Python è„šæœ¬ï¼Œåœ¨æ„å»ºé€šè¿‡ AES-256 ç®—æ³•å°†åŸå§‹èµ„æºæ‰“åŒ…åŠ å¯†ã€‚ # build_encrypt.pyfrom Crypto.Cipher import AESfrom Crypto.Util.Padding import pad# ç”Ÿäº§ç¯å¢ƒåº”å½“ä»ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†ç³»ç»Ÿè·å–KEY = bYourSuperSecretKey123456789012 # 32 bytesIV = b1234567890123456def encrypt_file(filepath): with open(filepath, rb) as f: data = f.read() # ä½¿ç”¨ CBC æ¨¡å¼ï¼Œå¡«å……æ•°æ®ä»¥ç¬¦åˆå—å¤§å° cipher = AES.new(KEY, AES.MODE_CBC, IV) encrypted_data = cipher.encrypt(pad(data, AES.block_size)) return encrypted_data 3.3 æ­¥éª¤äºŒï¼šC++ æ‹¦æˆªå™¨å®ç° (Run Time)å¯¹äº QML åº”ç”¨ï¼Œæœ€ä½³æ–¹æ¡ˆæ˜¯æ‹¦æˆª QNetworkAccessManagerã€‚é€šè¿‡å®ç° QQmlNetworkAccessManagerFactoryï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰åè®®ï¼ˆå¦‚ e-qrc://ï¼‰ã€‚ 1. è‡ªå®šä¹‰ NetworkReplyæ¨¡æ‹Ÿä¸€ä¸ªç½‘ç»œå“åº”ï¼Œä½†æ•°æ®æ¥æºå¹¶é Socketï¼Œè€Œæ˜¯æˆ‘ä»¬è§£å¯†åçš„å†…å­˜å—ã€‚ // EncryptedNetworkReply.hclass EncryptedNetworkReply : public QNetworkReply Q_OBJECTpublic: EncryptedNetworkReply(const QUrl url, const QByteArray decryptedData, QObject *parent = nullptr) : QNetworkReply(parent), m_data(decryptedData) setOperation(QNetworkAccessManager::GetOperation); setRequest(QNetworkRequest(url)); setUrl(url); open(QIODevice::ReadOnly); // [å…³é”®] è®¾ç½® ContentLengthï¼Œå¦åˆ™ QML å¼•æ“å¯èƒ½å› æ— æ³•é¢„çŸ¥å¤§å°è€ŒåŠ è½½å¤±è´¥ setHeader(QNetworkRequest::ContentLengthHeader, m_data.size()); // å¼‚æ­¥è§¦å‘ä¿¡å·ï¼Œæ¨¡æ‹Ÿç½‘ç»œå°±ç»ª QTimer::singleShot(0, this, EncryptedNetworkReply::finished); QTimer::singleShot(0, this, EncryptedNetworkReply::readyRead); // é‡å†™è¯»å–æ¥å£ï¼Œä»å†…å­˜ buffer è¯»å– qint64 readData(char *data, qint64 maxSize) override qint64 amount = qMin(maxSize, (qint64)m_data.size() - m_pos); memcpy(data, m_data.constData() + m_pos, amount); m_pos += amount; return amount; qint64 bytesAvailable() const override return m_data.size() - m_pos; void abort() override // ç©ºå®ç° bool isSequential() const override return true; private: QByteArray m_data; qint64 m_pos = 0;; 2. è‡ªå®šä¹‰ Manager å·¥å‚åœ¨å·¥å‚ä¸­æ‹¦æˆªç‰¹å®š Scheme çš„è¯·æ±‚ã€‚ // SecurityNetworkManager.cppQNetworkReply* SecurityNetworkManager::createRequest( Operation op, const QNetworkRequest req, QIODevice *outgoingData) if (req.url().scheme() == e-qrc) QString path = req.url().path(); // æ ¸å¿ƒæ­¥éª¤ï¼šä»åŠ å¯†å¤§åŒ…ä¸­è¯»å–å¹¶è§£å¯† // AssetManager æ˜¯ä½ çš„å•ä¾‹ç®¡ç†ç±»ï¼Œè´Ÿè´£è§£å¯†é€»è¾‘ QByteArray decrypted = AssetManager::instance()-loadAndDecrypt(path); return new EncryptedNetworkReply(req.url(), decrypted, this); // éåŠ å¯†è¯·æ±‚ï¼ˆå¦‚ httpï¼‰äº¤ç»™é»˜è®¤å¤„ç† return QNetworkAccessManager::createRequest(op, req, outgoingData); 3. å¼•æ“æ¥å…¥// main.cppQQmlApplicationEngine engine;// æ³¨å…¥è‡ªå®šä¹‰å·¥å‚engine.setNetworkAccessManagerFactory(new SecurityNetworkFactory());// ä½¿ç”¨è‡ªå®šä¹‰åè®®å¯åŠ¨ä¸»ç¨‹åºengine.load(QUrl(e-qrc://main.qml)); 3.4 æ›¿ä»£æ–¹æ¡ˆï¼šLoader æ¨¡å¼ (è½»é‡çº§)è‹¥ä¸æƒ³é‡å†™ç½‘ç»œå±‚ï¼Œå¯åˆ©ç”¨ QQmlComponent::setData ç›´æ¥åŠ è½½ã€‚æ­¤æ–¹æ¡ˆé€‚åˆç®€å•çš„å•å…¥å£åº”ç”¨ã€‚ // è¯»å–è§£å¯†åçš„ä¸»æ–‡ä»¶æ•°æ®QByteArray scriptData = DecryptUtils::readFile(:/encrypted/main.qml.enc);QQmlComponent component(engine);// [å…³é”®] è®¾ç½® BaseUrl ä¸ºè™šæ‹Ÿè·¯å¾„ï¼Œç¡®ä¿ qml å†…éƒ¨çš„ relative import èƒ½æ­£ç¡®è§£æcomponent.setData(scriptData, QUrl(qrc:/virtual/main.qml)); component.create(); ç¬¬å››éƒ¨åˆ†ï¼šæ–¹æ¡ˆå¯¹æ¯”ä¸æ€»ç»“ ç‰¹æ€§ æ ‡å‡† rcc Qt Quick Compiler (å•†ä¸šç‰ˆ) è‡ªå®šä¹‰ AES åŠ å¯†ç®¡çº¿ åŸç† äºŒè¿›åˆ¶åºåˆ—åŒ– QML è½¬æ­¤ C++ å­—èŠ‚ç  è‡ªå®šä¹‰ç®—æ³•åŠ å¯†å­˜å‚¨ é˜²åç¼–è¯‘èƒ½åŠ› é›¶ (çº¯æ˜æ–‡) ä¸­ (é€»è¾‘æ··æ·†ï¼Œä½†å­—ç¬¦ä¸²å¯è§) é«˜ (éœ€é€†å‘è§£å¯†ç®—æ³•) æ€§èƒ½æŸè€— æ—  æ­£å‘æå‡ (å¯åŠ¨æ›´å¿«) è½»å¾® (å–å†³äºè§£å¯†ç®—æ³•æ•ˆç‡) é€‚ç”¨åœºæ™¯ æ™®é€šå›¾æ ‡ã€UI ç´ æ æ€§èƒ½æ•æ„Ÿåœºæ™¯ æ ¸å¿ƒ IPã€å•†ä¸š License ä¿æŠ¤ å®‰å…¨å»ºè®®è¯·è®°ä½ï¼Œå®¢æˆ·ç«¯å®‰å…¨æ°¸è¿œæ˜¯ç›¸å¯¹çš„ã€‚å³ä½¿ä½¿ç”¨äº†ä¸Šè¿°æ–¹æ¡ˆï¼Œä»éœ€æ³¨æ„ï¼š å†…å­˜æš´éœ²é£é™©ï¼šæ— è®ºç£ç›˜åŠ å¯†å¤šå¼ºï¼Œæ•°æ®æœ€ç»ˆå¿…é¡»åœ¨å†…å­˜ä¸­è§£å¯†ã€‚é«˜é˜¶é€†å‘å·¥ç¨‹å¸ˆå¯ä»¥ç›´æ¥ Dump è¿›ç¨‹å†…å­˜ã€‚å»ºè®®é…åˆåŠ å£³å·¥å…·ï¼ˆå¦‚ VMProtectï¼‰æˆ–åè°ƒè¯•æŠ€æœ¯ä½¿ç”¨ã€‚ å¯†é’¥ä¿æŠ¤ï¼šåƒä¸‡ä¸è¦å°† AES Key ä»¥ç¡¬ç¼–ç å­—ç¬¦ä¸²å½¢å¼å­˜åœ¨ä»£ç ä¸­ã€‚å»ºè®®ä½¿ç”¨ç¼–è¯‘æœŸæ··æ·†ã€è¿è¡Œæ—¶åŠ¨æ€è®¡ç®—ç”Ÿæˆ Keyï¼Œå¢åŠ é€†å‘æˆæœ¬ã€‚ é€šè¿‡ æ„å»ºæ—¶åŠ å¯† + è¿è¡Œæ—¶æ‹¦æˆªè§£å¯† çš„ç®¡çº¿ç»„åˆï¼Œæˆ‘ä»¬èƒ½åœ¨ Qt æ¡†æ¶ä¸‹å»ºç«‹èµ·ä¸€å¥—çœŸæ­£å…·å¤‡å•†ä¸šé˜²æŠ¤ä»·å€¼çš„èµ„æºç®¡ç†ä½“ç³»ã€‚ å‚è€ƒæ¥æº Qt Documentation: The Qt Resource System OpenSSL Wiki: EVP Symmetric Encryption and Decryption Qt Forum: Protecting QML source code","tags":["Qt","C++","Security","Encryption","Resource System"]},{"title":"DRM+EGL æ‰§è¡Œé”™è¯¯åˆ†æ","path":"/2024/05/17/1-å¹³å°ç³»ç»Ÿ-Linux-Graphics-DRM-EGL-æ‰§è¡Œé”™è¯¯åˆ†æ/","content":"mesa è¿è¡Œ DRM+EGL æ‰§è¡Œé”™è¯¯åˆ†æï¼š src\\egl\\main\\egldefines.h ä¸­å®šä¹‰äº† EGL_VENDOR #define _EGL_VENDOR_STRING Mesa Project è¾“å‡ºç»“æœä¸º Mesa Projectï¼Œç¡®è®¤è¾“å‡ºæ— è¯¯ https://askubuntu.com/questions/1027168/why-is-opengl-vendor-mesa-project ä»¥ä¸Šé—®é¢˜é¡¹ä¸­ï¼Œè¯¥é€‰é¡¹æ˜¾å¡ä¸º Nvidia glxinfoÂ tells you what the X11 server youâ€™re running under is using for GL. It doesnâ€™t tell you what an arbitrary program not using X11 might use. æ•…åˆ†æå¦‚ä¸‹ï¼š æœªæ­£ç¡®å¯ç”¨æ˜¾å¡ï¼ŒEGL é‡‡ç”¨çš„æ˜¯ Mesa è½¯ä»¶æ¸²æŸ“ï¼Œæ•…æ— æ³•æä¾›æ­£ç¡®çš„ config è¯æ˜ï¼š æ˜¯å¦æœ‰ GLX æˆ– Wayland ç­‰æ–¹æ¡ˆè§£å†³è¯¥é—®é¢˜","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","Graphics"]},{"title":"DRM+GBM+EGLæ˜¾ç¤º","path":"/2024/05/15/1-å¹³å°ç³»ç»Ÿ-Linux-Graphics-DRM-GBM-EGLæ˜¾ç¤º/","content":"DRM (Direct Rendering Manager)ã€GBM (Generic Buffer Manager) å’Œ EGL (Embedded-System Graphics Library) ç»„åˆåœ¨ä¸€èµ·ï¼Œæ˜¯åœ¨ Linux å¹³å°ä¸Šè¿›è¡Œå›¾å½¢æ¸²æŸ“å’Œç¡¬ä»¶åŠ é€Ÿçš„å¸¸è§æ–¹å¼ã€‚è¿™äº›ç»„ä»¶ä¸€èµ·æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„å›¾å½¢æ¸²æŸ“æ ˆï¼Œå…è®¸åº”ç”¨ç¨‹åºç›´æ¥ä¸å›¾å½¢ç¡¬ä»¶è¿›è¡Œäº¤äº’ã€‚ DRMï¼ˆDirect Rendering Managerï¼‰ï¼šDRM æ˜¯ Linux å†…æ ¸ä¸­çš„ä¸€ä¸ªå­ç³»ç»Ÿï¼Œç”¨äºç®¡ç†å›¾å½¢ç¡¬ä»¶çš„é©±åŠ¨ç¨‹åºã€‚å®ƒæä¾›äº†ä¸€ç§é€šç”¨çš„æ¥å£ï¼Œå…è®¸ç”¨æˆ·ç©ºé—´ç¨‹åºç›´æ¥ä¸ç¡¬ä»¶äº¤äº’ï¼Œé€šè¿‡è®¾å¤‡æ–‡ä»¶ /dev/dri/cardX è®¿é—®ã€‚DRM æä¾›äº†è¯¸å¦‚æ¨¡å¼è®¾ç½®ã€æ˜¾ç¤ºæ§åˆ¶ã€æ¸²æŸ“åŠ é€Ÿç­‰åŠŸèƒ½ã€‚ GBMï¼ˆGeneric Buffer Managerï¼‰ï¼šGBM æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å›¾å½¢ç¼“å†²åŒºçš„åº“ï¼Œé€šå¸¸ä¸ DRM é…åˆä½¿ç”¨ã€‚å®ƒæä¾›äº†ä¸€ç§æ ‡å‡†çš„æ¥å£ï¼Œç”¨äºåˆ†é…ã€ç®¡ç†å’Œæ“ä½œå›¾å½¢å†…å­˜ã€‚GBM è¿˜æä¾›äº†ä¸ EGL å’Œ OpenGL ES å…¼å®¹çš„æ¥å£ï¼Œä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿè¿›è¡Œæ¸²æŸ“ã€‚ EGLï¼ˆEmbedded-System Graphics Libraryï¼‰ï¼šEGL æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å›¾å½¢èµ„æºçš„åº“ï¼Œæä¾›äº†ä¸€ä¸ªé€šç”¨çš„æ¥å£ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç† OpenGL å’Œ OpenGL ES ä¸Šä¸‹æ–‡ã€è¡¨é¢å’Œå…¶ä»–ç›¸å…³å¯¹è±¡ã€‚EGL é€šå¸¸ä¸ GBM å’Œ DRM ä¸€èµ·ä½¿ç”¨ï¼Œé€šè¿‡ GBM æä¾›çš„æ¥å£æ¥åˆ›å»ºå›¾å½¢è¡¨é¢ï¼Œå¹¶å°†å…¶ä¸ OpenGL æˆ– OpenGL ES ä¸Šä¸‹æ–‡å…³è”èµ·æ¥ï¼Œå®ç°ç¡¬ä»¶åŠ é€Ÿçš„å›¾å½¢æ¸²æŸ“ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","Graphics"]},{"title":"LinuxGraphics ç¬”è®°","path":"/2024/05/14/1-å¹³å°ç³»ç»Ÿ-Linux-Graphics-LinuxGraphics-ç¬”è®°/","content":"modetest å‘½ä»¤ åˆ©ç”¨ xrandr åœ¨å‘½ä»¤è¡ŒæŒ‡å®šè¾“å‡º xrandr --output HDMI-1 --mode 1920x1080 | ./a.out Mesa æ˜¯ä¸€ä¸ªå¼€æºçš„å®ç°äº† OpenGL è§„èŒƒçš„å›¾å½¢åº“ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª OpenGL å…¼å®¹çš„æ¸²æŸ“å™¨å’Œå·¥å…·åº“ã€‚åœ¨ Mesa ç”Ÿæˆçš„å¤´æ–‡ä»¶ä¸­å¯èƒ½ä¸åŒ…å« GLUï¼Œå› ä¸º GLUï¼ˆOpenGL Utility Libraryï¼‰é€šå¸¸è¢«è§†ä¸º OpenGL çš„ä¸€ä¸ªç‹¬ç«‹ç»„ä»¶ï¼Œè€Œä¸æ˜¯ OpenGL çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ GLU æä¾›äº†ä¸€äº› OpenGL çš„è¾…åŠ©åŠŸèƒ½ï¼Œæ¯”å¦‚è¿›è¡Œå¤æ‚å‡ ä½•è¿ç®—å’Œå¯¹è±¡æ„é€ ç­‰ã€‚è™½ç„¶ GLU åœ¨è®¸å¤š OpenGL å®ç°ä¸­éƒ½æœ‰æ”¯æŒï¼Œä½†å®ƒå¹¶ä¸æ˜¯ OpenGL è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒOpenGL å®ç°å¯èƒ½ä¸åŒ…æ‹¬ GLU æˆ–å°†å…¶ä½œä¸ºä¸€ä¸ªå¯é€‰ç»„ä»¶ã€‚ Mesa æ˜¯ä¸€ä¸ªå¼€æºçš„å›¾å½¢åº“ï¼Œæä¾›äº† OpenGL å…¼å®¹çš„æ¸²æŸ“å™¨å’Œå·¥å…·åº“ã€‚åœ¨ Mesa ç”Ÿæˆçš„å¤´æ–‡ä»¶ä¸­å¯èƒ½ä¸åŒ…å« GLUï¼Œå› ä¸º GLU ä¸æ˜¯ OpenGL è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚å¦‚æœéœ€è¦åœ¨ä½¿ç”¨ Mesa çš„é¡¹ç›®ä¸­ä½¿ç”¨ GLUï¼Œå¯ä»¥é€šè¿‡å…¶ä»–é€”å¾„è·å– GLU çš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶ï¼Œç„¶åå°†å…¶åŒ…å«åˆ°é¡¹ç›®ä¸­å¹¶é“¾æ¥ä»¥ä½¿ç”¨ GLU æä¾›çš„åŠŸèƒ½ã€‚ å¦‚æœéœ€è¦åœ¨ä½¿ç”¨ Mesa çš„é¡¹ç›®ä¸­ä½¿ç”¨ GLUï¼Œå¯ä»¥é€šè¿‡å…¶ä»–é€”å¾„è·å– GLU çš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶ï¼Œä¾‹å¦‚ä»ç³»ç»Ÿçš„ OpenGL å®‰è£…ä¸­è·å–ï¼Œæˆ–è€…ä»å…¶ä»–åœ°æ–¹ä¸‹è½½ GLU çš„å®ç°ã€‚ç„¶åå°† GLU çš„å¤´æ–‡ä»¶åŒ…å«åˆ°çš„é¡¹ç›®ä¸­ï¼Œå¹¶é“¾æ¥ GLU åº“ä»¥ä½¿ç”¨ GLU æä¾›çš„åŠŸèƒ½ã€‚ Mesa æ˜¯ä¸€ä¸ªå¼€æºçš„å›¾å½¢åº“ï¼Œæä¾›äº† OpenGL å…¼å®¹çš„æ¸²æŸ“å™¨å’Œå·¥å…·åº“ã€‚åœ¨ Mesa ç”Ÿæˆçš„å¤´æ–‡ä»¶ä¸­å¯èƒ½ä¸åŒ…å« GLUï¼Œå› ä¸º GLU ä¸æ˜¯ OpenGL è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚å¦‚æœéœ€è¦åœ¨ä½¿ç”¨ Mesa çš„é¡¹ç›®ä¸­ä½¿ç”¨ GLUï¼Œå¯ä»¥é€šè¿‡å…¶ä»–é€”å¾„è·å– GLU çš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶ï¼Œç„¶åå°†å…¶åŒ…å«åˆ°é¡¹ç›®ä¸­å¹¶é“¾æ¥ä»¥ä½¿ç”¨ GLU æä¾›çš„åŠŸèƒ½ã€‚ DRMåˆ©ç”¨ DRM+GBM+EGL æŒ‡å®šæ˜¾å¡è¿è¡Œä»£ç åˆ†æ Mesa GBMï¼ˆGeneric Buffer Managementï¼‰æ˜¯ä¸€ä¸ªå¼€æºå›¾å½¢ç¼“å†²åŒºç®¡ç†åº“ï¼Œç”¨äºç®¡ç†å›¾å½¢å†…å­˜ç¼“å†²åŒºã€‚å®ƒæ˜¯ Mesa 3D å›¾å½¢åº“çš„ä¸€éƒ¨åˆ†ã€‚GBM ä¸»è¦ç”¨äº Linux å¹³å°ï¼Œä¸º Direct Rendering Manager (DRM) å†…æ ¸å­ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªç”¨æˆ·ç©ºé—´ APIã€‚å®ƒæä¾›äº†ä¸€ç§ç»Ÿä¸€çš„æ¥å£ï¼Œç”¨äºåœ¨ Linux ç³»ç»Ÿä¸­ç®¡ç†å›¾å½¢ç¼“å†²åŒºå’Œè®¾å¤‡ä¹‹é—´çš„äº¤äº’ã€‚ åœ¨ DRMï¼ˆDirect Rendering Managerï¼‰ä¸­ï¼ŒCRTCï¼ˆCathode Ray Tube Controllerï¼‰æ˜¯ä¸€ä¸ªæ˜¾ç¤ºç®¡æ§åˆ¶å™¨ï¼Œè´Ÿè´£æ§åˆ¶æ˜¾ç¤ºç®¡çš„æ‰«æã€åŒæ­¥å’Œåˆ·æ–°æ“ä½œã€‚å®ƒä¸ Encoderï¼ˆç¼–ç å™¨ï¼‰å’Œ Connectorï¼ˆè¿æ¥å™¨ï¼‰ä¹‹é—´å­˜åœ¨ç€ä¸€å®šçš„è”ç³»ã€‚ CRTCï¼ˆCathode Ray Tube Controllerï¼‰ï¼šCRTC æ§åˆ¶ç€å®é™…æ˜¾ç¤ºè®¾å¤‡çš„æ‰«æå’Œåˆ·æ–°æ“ä½œã€‚æ¯ä¸ª CRTC éƒ½ä¸ä¸€ä¸ªæ˜¾ç¤ºç®¡ï¼ˆå¦‚æ¶²æ™¶æ˜¾ç¤ºå™¨æˆ–æŠ•å½±ä»ªï¼‰ç›¸å…³è”ï¼Œè´Ÿè´£ç”Ÿæˆè¯¥æ˜¾ç¤ºè®¾å¤‡çš„å›¾åƒä¿¡å·ã€‚ä¸€ä¸ªæ˜¾å¡å¯èƒ½æœ‰å¤šä¸ª CRTCï¼Œæ¯ä¸ª CRTC æ§åˆ¶ä¸€ä¸ªæ˜¾ç¤ºè¾“å‡ºã€‚ Encoderï¼ˆç¼–ç å™¨ï¼‰ï¼šEncoder æ˜¯ CRTC è¾“å‡ºä¿¡å·çš„ç¼–ç å™¨ï¼Œå°†å›¾åƒæ•°æ®è½¬æ¢ä¸ºç‰¹å®šæ ¼å¼çš„ä¿¡å·ä»¥ä¾¿å‘é€åˆ°æ˜¾ç¤ºè®¾å¤‡ã€‚Encoder é€šå¸¸ä¸ç‰¹å®šç±»å‹çš„è¿æ¥å™¨ï¼ˆå¦‚ HDMIã€DVIã€VGA ç­‰ï¼‰ç›¸å…³è”ï¼Œä»¥ä¾¿å°†å›¾åƒæ•°æ®è½¬æ¢ä¸ºå¯¹åº”çš„è§†é¢‘ä¿¡å·æ ¼å¼ã€‚ä¸€ä¸ª CRTC å¯èƒ½ä¸å¤šä¸ª Encoder ç›¸å…³è”ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥åŒæ—¶æ”¯æŒå¤šç§è¿æ¥å™¨ç±»å‹ã€‚ Connectorï¼ˆè¿æ¥å™¨ï¼‰ï¼šConnector è¡¨ç¤ºä¸æ˜¾å¡ç›¸è¿çš„ç‰©ç†æ˜¾ç¤ºç«¯å£ï¼Œå¦‚ HDMI æ¥å£ã€DVI æ¥å£ç­‰ã€‚æ¯ä¸ª Connector å¯¹åº”ä¸€ä¸ªå®é™…çš„æ˜¾ç¤ºè¾“å‡ºæ¥å£ï¼Œæ¯”å¦‚è¿æ¥æ˜¾ç¤ºå™¨æˆ–æŠ•å½±ä»ªçš„ç«¯å£ã€‚æ¯ä¸ª Connector éƒ½ä¸ä¸€ä¸ª Encoder ç›¸å…³è”ï¼Œè¯¥ Encoder è´Ÿè´£å°†å›¾åƒæ•°æ®ç¼–ç æˆè¿æ¥å™¨æ‰€éœ€çš„ä¿¡å·æ ¼å¼ã€‚ åœ¨ DRM ä¸­ï¼Œé€šå¸¸çš„å·¥ä½œæµç¨‹æ˜¯ï¼š ç”¨æˆ·ç©ºé—´ï¼ˆå¦‚å›¾å½¢é©±åŠ¨ç¨‹åºï¼‰é€šè¿‡ DRM æ¥å£é€‰æ‹©ä¸€ä¸ª Connectorï¼Œç„¶ååˆ›å»ºä¸€ä¸ª CRTC å¹¶å°†å…¶ä¸æ‰€é€‰ Connector å…³è”èµ·æ¥ã€‚ ç„¶åï¼Œç”¨æˆ·ç©ºé—´ä¼šåˆ›å»ºä¸€ä¸ª Encoderï¼Œå¹¶å°†å…¶ä¸æ‰€é€‰çš„ Connector å…³è”èµ·æ¥ï¼Œä»¥ä¾¿å°†å›¾åƒæ•°æ®ç¼–ç æˆæ­£ç¡®çš„è§†é¢‘ä¿¡å·æ ¼å¼ã€‚ æœ€åï¼Œç”¨æˆ·ç©ºé—´ä¼šå°†å¸§ç¼“å†²åŒºï¼ˆFramebufferï¼‰çš„å†…å®¹æäº¤ç»™ CRTC è¿›è¡Œæ˜¾ç¤ºã€‚CRTC æ¥æ”¶åˆ°å¸§ç¼“å†²åŒºçš„å†…å®¹åï¼Œä¼šå°†å…¶å‘é€ç»™ç›¸å…³è”çš„ Encoderï¼Œæœ€ç»ˆæ˜¾ç¤ºåˆ°è¿æ¥å™¨æ‰€ä»£è¡¨çš„æ˜¾ç¤ºè®¾å¤‡ä¸Šã€‚ æ€»ä¹‹ï¼ŒCRTC è´Ÿè´£æ§åˆ¶å®é™…çš„æ˜¾ç¤ºè®¾å¤‡ï¼ŒEncoder è´Ÿè´£å°†å›¾åƒæ•°æ®è½¬æ¢ä¸ºè§†é¢‘ä¿¡å·æ ¼å¼ï¼Œè€Œ Connector åˆ™è¡¨ç¤ºå®é™…çš„ç‰©ç†æ˜¾ç¤ºç«¯å£ï¼Œå®ƒä»¬ä¹‹é—´ç›¸äº’å…³è”ï¼Œå…±åŒå®Œæˆå›¾åƒæ˜¾ç¤ºçš„ä»»åŠ¡ã€‚ EGL æ˜¯ Khronos æ¸²æŸ“ APIï¼ˆå¦‚ OpenGLã€OpenGL ES æˆ– OpenVGï¼‰ä¸åº•å±‚æœ¬åœ°å¹³å° (çª—å£) ç³»ç»Ÿä¹‹é—´çš„æ¥å£ã€‚ EGL ä¸»è¦åŠŸèƒ½ï¼šå¤„ç†å›¾å½¢ä¸Šä¸‹æ–‡ç®¡ç†ã€Buffer ç®¡ç†å’Œæ¸²æŸ“åŒæ­¥ Display (EGLDisplay): å¯¹å®é™…æ˜¾ç¤ºè®¾å¤‡çª—å£ç³»ç»Ÿçš„æŠ½è±¡ï¼› Surface (EGLSurface): å­˜å‚¨å›¾åƒçš„å†…å­˜åŒºåŸŸï¼› Context (EGLContext): å­˜å‚¨æ¸²æŸ“ API çš„çŠ¶æ€ä¿¡æ¯ï¼›ä¸€å¥—æ ‡å‡†çš„ EGL ç»˜åˆ¶æµç¨‹ç®€ä»‹: è·å– EGL Display å¯¹è±¡ï¼šeglGetDisplay åˆå§‹åŒ–ä¸ EGLDisplay ä¹‹é—´çš„è¿æ¥ï¼šeglInitialize è·å– EGLConfig å¯¹è±¡ï¼šeglChooseConfig eglGetconfigs åˆ›å»º EGLContext å®ä¾‹ï¼šeglCreateContext åˆ›å»º EGLSurface å®ä¾‹ï¼šeglCreatewindowSurface eglCratePbufferSurface è¿æ¥ EGLContext å’Œ EGLSurface ä¸Šä¸‹æ–‡: eglMakeCurrent ä½¿ç”¨ OpenGL ES API ç»˜åˆ¶å›¾å½¢ï¼šgl_* åˆ‡æ¢ front buffer å’Œ back buffer æ˜¾ç¤ºï¼šeglSwapBuffer æ–­å¼€å¹¶é‡Šæ”¾ä¸ EGLSurface å…³è”çš„ EGLContext å¯¹è±¡ï¼šeglRelease åˆ é™¤ EGLSurface å¯¹è±¡ åˆ é™¤ EGLContext å¯¹è±¡ ç»ˆæ­¢ä¸ EGLDisplay ä¹‹é—´çš„è¿æ¥ EGL Display çš„è·å–EGLDisplay eglGetDisplay(NativeDisplayType native_display)EGLDisplay eglGetPlatformDisplay( EGLenum platform, void * native_display, const EGLAttrib * attrib_list);EGLDisplay eglGetPlatformDisplayEXT( EGLenum platform, void *native_display, const EGLint *attrib_list); eglGetDisplay ä¼šæ ¹æ®ç°åœ¨çš„ç¯å¢ƒæ¥å†³å®šé»˜è®¤çš„åŸç”Ÿçª—å£ç³»ç»Ÿï¼Œå…¶ä»–ä¸¤ä¸ªéœ€è¦æ‰‹åŠ¨æŒ‡å®šå¹³å°ï¼› compositor è¿è¡Œç›¸å½“äºæ˜¯è£¸æœºè¿è¡Œæ²¡æœ‰çª—å£ç¯å¢ƒï¼Œé¦–å…ˆå¿…é¡»é€šè¿‡ GBM æˆ–è€… EGL_PLATFORM_DEVICE_EXT æ‰©å±•è¿™ä¸¤ç§æ–¹å¼æ¥è·å– EGLDisplay; GBM æ¦‚å¿µ: åŸºäº GEMTTM çš„é©±åŠ¨å¯¹å¤–æ˜¯æ²¡æœ‰æä¾›ç»Ÿä¸€çš„å†…å­˜ç®¡ç†æ¥å£çš„ï¼Œè‡³å°‘ Buffer Object åˆ›å»ºé”€æ¯ç­‰æ“ä½œæ˜¯éœ€è¦è‡ªè¡Œæä¾›è®¾å¤‡ç›¸å…³çš„å³å£è¿›è¡Œå®ç°çš„ã€‚ ç”¨æˆ·æ€æ²¡æœ‰ç»Ÿä¸€çš„æ¥å£å¯¹ç¼“å†²åŒºè¿›è¡Œç®¡ç†ï¼Œè¿™å¯¼è‡´æŸäº›ç‰¹å®šç”¨æˆ·æ€ç¨‹åºçš„å¼€å‘çš„å›°éš¾ï¼Œå¦‚ wayland compositorã€‚ ç®€å•çš„è¯´ GBM å°±æ˜¯ä¸ºäº†å®ç° DRM(gbm_device) ä½œä¸º EGL çš„æœ¬åœ°å¹³å°ï¼Œåˆ›å»ºçš„å¥æŸ„å¯ä»¥ç”¨æ¥åˆå§‹åŒ– EGL å’Œåˆ›å»ºæ¸²æŸ“ç›®æ ‡ç¼“å†²åŒº // get gdm_device// path = /dev/dri/renderD128 / dev/dri/card0egl_gbm.render_fd = open(path, O_RDWR|O_CLOEXEC);assert(-1 != egl_gbm.render_fd);egl_gbm.gbm_device = gbm_create_device(egl_gbm.render_fd);assert(NULL != egl_gbm.gbm_device);// get display1. egl_gbm.display = eglGetDisplay((EGLNativeDisplayType)egl_gbm.gbm_device);2. egl_gbm.display = eglGetPlatformDisplay(EGL_PLATFORM_GBM_KHR, egl_gbm.gbm_device, NULL);3. egl_gbm.display = eglGetPlatformDisplayEXT(EGL_PLATFORM_GBM_MESA, egl_gbm.gbm_device, NULL);// wlrootsé‡Œé¢ä»ä¸¥è°¨æ€§æ¥è¯´ï¼Œé€šè¿‡GBMè·å–EGL Displayçš„æ—¶å€™ï¼ŒeglGetPlatformDisplayEXTåé¢çš„å‚æ•°åº”è¯¥æ˜¯EGL_PLATFORM_GBM_MESAè€Œä¸æ˜¯EGL_PLATFORM_GBM_KHRï¼› Waylandï¼šWayland æ˜¯ä¸€ç§å›¾å½¢æ˜¾ç¤ºæœåŠ¡å™¨åè®®ï¼Œè€Œ DRM æ˜¯ Linux å†…æ ¸ä¸­çš„ Direct Rendering Manager å­ç³»ç»Ÿï¼Œç”¨äºç®¡ç†å›¾å½¢ç¡¬ä»¶é©±åŠ¨ç¨‹åºã€‚åœ¨ Wayland ä¸­ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºé€šè¿‡ Wayland åè®®ä¸æ˜¾ç¤ºæœåŠ¡å™¨é€šä¿¡ï¼Œè€Œ Wayland æœåŠ¡å™¨é€šè¿‡ DRM æ¥å£ä¸åº•å±‚çš„å›¾å½¢ç¡¬ä»¶äº¤äº’ã€‚ ** GBM**ï¼šç›´æ¥çš„å…³ç³»æ˜¯ DRM å’Œ GBMï¼Œå…¶ä¸­ DRMï¼ˆDirect Rendering Managerï¼‰æ˜¯ Linux å†…æ ¸ä¸­çš„å­ç³»ç»Ÿï¼Œç”¨äºç®¡ç†å›¾å½¢ç¡¬ä»¶çš„é©±åŠ¨ç¨‹åºï¼Œè€Œ GBMï¼ˆGeneric Buffer Managerï¼‰æ˜¯ä¸€ä¸ªç”¨æˆ·æ€åº“ï¼Œæä¾›äº†ä¸€ä¸ªæ ‡å‡†æ¥å£ï¼Œç”¨äºåˆ†é…ã€ç®¡ç†å’Œæ“ä½œå›¾å½¢å†…å­˜ï¼Œé€šå¸¸ä¸ DRM é…åˆä½¿ç”¨ã€‚GBM é€šå¸¸ä¸ DRMï¼ˆDirect Rendering Managerï¼‰é…åˆä½¿ç”¨ï¼Œç”¨äºä¸åº•å±‚çš„å›¾å½¢ç¡¬ä»¶è¿›è¡Œäº¤äº’ã€‚åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ GBM æ¥å£æ¥åˆ†é…å’Œç®¡ç†å›¾å½¢ç¼“å†²åŒºï¼Œä»¥ä¾¿è¿›è¡Œç¡¬ä»¶åŠ é€Ÿçš„å›¾å½¢æ¸²æŸ“ã€‚GBM ä¸ Wayland æ— ç›´æ¥å…³è”ï¼Œä½†åœ¨ä¸€äº›ç‰¹å®šçš„åœºæ™¯ä¸‹ï¼Œå®ƒä»¬å¯èƒ½ä¼šä¸€èµ·ä½¿ç”¨ã€‚ GBM æ§åˆ¶ EGLï¼šGBM é€šå¸¸ä¸ EGL ç»“åˆä½¿ç”¨ï¼Œä»¥åœ¨ç¡¬ä»¶åŠ é€Ÿçš„å›¾å½¢æ¸²æŸ“ä¸­åˆ›å»ºå’Œç®¡ç†å›¾å½¢è¡¨é¢ï¼ˆbuffersï¼‰ã€‚EGLï¼ˆEmbedded-System Graphics Libraryï¼‰æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å›¾å½¢èµ„æºçš„åº“ï¼Œæä¾›äº†ä¸€ä¸ªé€šç”¨çš„æ¥å£ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç† OpenGL å’Œ OpenGL ES ä¸Šä¸‹æ–‡ã€è¡¨é¢å’Œå…¶ä»–ç›¸å…³å¯¹è±¡ã€‚ EGL æ“ä½œ OpenGL API è¿›è¡Œæ“ä½œï¼šEGL ç”¨äºç®¡ç† OpenGL æˆ– OpenGL ES çš„ä¸Šä¸‹æ–‡å’Œè¡¨é¢ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ OpenGL API è¿›è¡Œå›¾å½¢æ“ä½œã€‚EGL æä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„æ¥å£ï¼Œç”¨äºåœ¨ä¸åŒçš„å›¾å½¢ç³»ç»Ÿä¸­åˆ›å»ºå’Œç®¡ç† OpenGL ä¸Šä¸‹æ–‡å’Œè¡¨é¢ï¼Œä»¥ä¾¿å®ç°è·¨å¹³å°çš„å›¾å½¢æ¸²æŸ“ã€‚ ç¡®å®šæ˜¾å¡linux å†…æ ¸æ£€æµ‹åˆ°æœºå™¨ä¸Šçš„æ˜¾å¡æ—¶ï¼Œä¼šåŠ è½½æ­£ç¡®çš„è®¾å¤‡é©±åŠ¨ç¨‹åºï¼ˆä½äºå†…æ ¸æ ‘ä¸­çš„ ./drivers/gpu/drm/xyï¼‰ï¼Œå¹¶æä¾›ä¸¤ä¸ªå­—ç¬¦è®¾å¤‡æ¥æ§åˆ¶æ˜¾å¡ã€‚ Udev ï¼ˆæˆ–ä½¿ç”¨çš„ä»»ä½•çƒ­æ’æ‹”åº”ç”¨ç¨‹åºï¼‰å°†æŠŠå®ƒä»¬åˆ›å»ºä¸º /dev/dri/card0 /dev/dri/controlID64 åªéœ€è¦ç¬¬ä¸€ä¸ªã€‚ å¯ä»¥åƒåœ¨è¿™é‡Œåšçš„é‚£æ ·ï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­ç¡¬ç¼–ç è¿™ä¸ªè·¯å¾„ï¼Œä½†å»ºè®®ä½¿ç”¨çœŸæ­£æ”¯æŒçƒ­æ’æ‹”å’Œå¤šåº§çš„ libudevã€‚ä¸è¿‡ï¼Œè¿™è¶…å‡ºäº†æœ¬æ–‡çš„è®¨è®ºèŒƒå›´ã€‚ å¦‚æœæœ‰å¤šå—æ˜¾å¡ï¼Œå¯èƒ½è¿˜ä¼šæœ‰ /dev/dri/card1ã€/dev/dri/card2ã€â€¦â€¦ modeset_open(out,node)ï¼š è¾…åŠ©å‡½æ•°ç”¨äºæ‰“å¼€ä½œä¸º @node ç»™å®šçš„ DRM è®¾å¤‡ã€‚ æˆåŠŸæ—¶ï¼Œæ–°çš„ fd å°†å­˜å‚¨åœ¨ @out ä¸­ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™è¿”å›è´Ÿé”™è¯¯ä»£ç ã€‚ æ‰“å¼€æ–‡ä»¶åï¼Œè¿˜è¦æ£€æŸ¥ DRM_CAP_DUMB_BUFFER åŠŸèƒ½ã€‚ å¦‚æœé©±åŠ¨ç¨‹åºæ”¯æŒè¯¥åŠŸèƒ½ï¼Œå°±å¯ä»¥åˆ›å»ºç®€å•çš„å†…å­˜æ˜ å°„ç¼“å†²åŒºï¼Œè€Œæ— éœ€ä»»ä½•ä¾èµ–äºé©±åŠ¨ç¨‹åºçš„ä»£ç ã€‚ ç”±äºå¸Œæœ›é¿å…ä½¿ç”¨ä»»ä½• radeonã€nvidiaã€intel ç­‰é©±åŠ¨ç¨‹åºçš„ç‰¹å®šä»£ç ï¼Œå› æ­¤åœ¨æ­¤ä¾èµ–äº DUMB_BUFFERã€‚ ç¡®è®¤æ˜¾ç¤ºè®¾å¤‡éœ€è¦æ‰¾åˆ°å¯ç”¨çš„æ˜¾ç¤ºè®¾å¤‡ã€‚ libdrm æä¾›äº† drmModeRes ç»“æ„ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰éœ€è¦çš„ä¿¡æ¯ã€‚ é€šè¿‡ drmModeGetResources(fd) è·å–ï¼Œ é€šè¿‡ drmModeFreeResources(res) é‡Šæ”¾ã€‚ æ˜¾å¡ä¸Šçš„ç‰©ç†è¿æ¥å™¨ç§°ä¸º â€œconnectorâ€ã€‚å¯ä»¥å°†æ˜¾ç¤ºå™¨æ’å…¥å…¶ä¸­å¹¶æ§åˆ¶æ˜¾ç¤ºå†…å®¹ã€‚ è‚¯å®šä¼šå¯¹å½“å‰ä½¿ç”¨çš„ connector æ„Ÿå…´è¶£ï¼Œå› æ­¤ï¼Œéœ€éå†è¿æ¥å™¨åˆ—è¡¨ï¼Œå¹¶å°è¯•åœ¨æ¯ä¸ªå¯ç”¨çš„æ˜¾ç¤ºå™¨ä¸Šæ˜¾ç¤ºæµ‹è¯•å›¾ç‰‡ã€‚ ç„¶è€Œï¼Œè¿™å¹¶ä¸åƒå¬èµ·æ¥é‚£ä¹ˆå®¹æ˜“ã€‚é¦–å…ˆï¼Œéœ€è¦æ£€æŸ¥è¿æ¥å™¨æ˜¯å¦è¢«å®é™…ä½¿ç”¨ï¼ˆæ˜¾ç¤ºå™¨å·²æ’å…¥å¹¶æ‰“å¼€ï¼‰ã€‚ ç„¶åï¼Œéœ€è¦æ‰¾åˆ°ä¸€ä¸ªèƒ½æ§åˆ¶è¯¥è¿æ¥å™¨çš„ CRTCï¼ŒCRTC ç¨åä»‹ç»ã€‚ ç„¶åï¼Œåˆ›å»ºä¸€ä¸ªå¸§ç¼“å†²å™¨å¯¹è±¡ framebuffer objectã€‚ å‡†å¤‡å®Œæˆåå°±å¯ä»¥å¯¹å¸§ç¼“å†²åŒºè¿›è¡Œ mmap()ï¼Œå¹¶åœ¨å…¶ä¸­ç»˜åˆ¶æµ‹è¯•å›¾ç‰‡ã€‚ ç„¶åï¼Œå°±å¯ä»¥å‘Šè¯‰ DRM è®¾å¤‡åœ¨ç»™å®šçš„ CRTC ä¸Šç”¨é€‰å®šçš„è¿æ¥å™¨æ˜¾ç¤ºå¸§ç¼“å†²ã€‚ ç”±äºè¦åœ¨å¸§ç¼“å­˜ä¸Šç»˜åˆ¶åŠ¨æ€å›¾åƒï¼Œå› æ­¤å¿…é¡»è®°ä½æ‰€æœ‰è¿™äº›è®¾ç½®ã€‚ å› æ­¤ï¼Œè¦ä¸ºæˆåŠŸåˆå§‹åŒ–çš„æ¯å¯¹è¿æ¥å™¨ +crtc+ å¸§ç¼“å†²å™¨åˆ›å»ºä¸€ä¸ª â€œstruct modeset_dev â€œ å¯¹è±¡ï¼Œå¹¶å°†å…¶æ¨å…¥å…¨å±€è®¾å¤‡åˆ—è¡¨ã€‚ å› æ­¤ï¼Œä¸‹ä¸€æ­¥éœ€è¦å®é™…å‡†å¤‡å¥½æ‰¾åˆ°çš„æ‰€æœ‰è¿æ¥å™¨ã€‚ è¿™æ®µæ–‡å­—ä¸»è¦è®²è¿°äº†åœ¨ Linux ç³»ç»Ÿä¸­ç¡®å®šæ˜¾å¡å’Œæ˜¾ç¤ºè®¾å¤‡çš„è¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯å…³é”®ç‚¹çš„æ¦‚æ‹¬ï¼š å†…æ ¸æ£€æµ‹ä¸é©±åŠ¨åŠ è½½ï¼šLinux å†…æ ¸ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶åŠ è½½é€‚åˆçš„æ˜¾å¡é©±åŠ¨ç¨‹åºã€‚ åˆ›å»ºå­—ç¬¦è®¾å¤‡ï¼šæ˜¾å¡é©±åŠ¨ç¨‹åºä¼šåˆ›å»ºä¸¤ä¸ªå­—ç¬¦è®¾å¤‡ï¼Œç”¨äºæ§åˆ¶æ˜¾å¡ã€‚ ç¡®è®¤æ˜¾ç¤ºè®¾å¤‡å’Œ CRTCï¼šé€šè¿‡éå†è¿æ¥å™¨åˆ—è¡¨ï¼Œå¹¶å°è¯•åœ¨æ¯ä¸ªå¯ç”¨æ˜¾ç¤ºå™¨ä¸Šæ˜¾ç¤ºæµ‹è¯•å›¾ç‰‡ï¼Œæ¥ç¡®å®šåˆé€‚çš„æ˜¾ç¤ºè®¾å¤‡ï¼ˆCRTCï¼‰ã€‚ é¿å…å®Œæ•´æ¨¡å¼é›†çš„è®¾ç½®ï¼šåœ¨ä½¿ç”¨ CRTC ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿å…¶ä»–è®¾å¤‡æ²¡æœ‰å ç”¨è¯¥ CRTCã€‚ åˆ›å»ºå¹¶ç»´æŠ¤è®¾å¤‡åˆ—è¡¨ï¼šä¸ºæˆåŠŸåˆå§‹åŒ–çš„æ¯ä¸€å¯¹è¿æ¥å™¨ +CRTC+ å¸§ç¼“å†²å™¨åˆ›å»ºä¸€ä¸ª struct modeset_dev å¯¹è±¡ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°å…¨å±€è®¾å¤‡åˆ—è¡¨ä¸­ã€‚modeset_prepare(fd)ï¼šè¯¥è¾…åŠ©å‡½æ•°å°† DRM fd ä½œä¸ºå‚æ•°ï¼Œç„¶åç®€å•åœ°ä»è®¾å¤‡ä¸­è·å–èµ„æºä¿¡æ¯ã€‚ å¦‚æœåˆå§‹åŒ–æˆåŠŸï¼Œåªéœ€å°†æ­¤å¯¹è±¡ä½œä¸ºæ–°è®¾å¤‡æ·»åŠ åˆ°å…¨å±€æ¨¡å¼é›†è®¾å¤‡åˆ—è¡¨ä¸­ã€‚ èµ„æºç»“æ„åŒ…å«æ‰€æœ‰è¿æ¥å™¨ ID çš„åˆ—è¡¨ã€‚ ä½¿ç”¨è¾…åŠ©å‡½æ•° drmModeGetConnector() è·å–æ¯ä¸ªè¿æ¥å™¨çš„æ›´å¤šä¿¡æ¯ã€‚ å¦‚æœè¿æ¥å™¨å½“å‰æœªä½¿ç”¨ï¼Œä¹Ÿæœªæ’å…¥ç›‘è§†å™¨ï¼Œçš„è¾…åŠ©å‡½æ•° modeset_setup_dev() å°†è¿”å› -ENOENTã€‚ å› æ­¤ï¼Œå¯ä»¥å¿½ç•¥è¯¥è¿æ¥å™¨ã€‚ modeset_find_crtc(fd, res, conn, dev)ï¼š è¿™ä¸ªå°åŠ©æ‰‹è¯•å›¾ä¸ºç»™å®šçš„è¿æ¥å™¨æ‰¾åˆ°åˆé€‚çš„ CRTCã€‚ å®é™…ä¸Šï¼Œå¿…é¡»å†å¼•å…¥ä¸€ä¸ª DRM å¯¹è±¡ï¼Œä»¥ä¾¿æ›´æ¸…æ¥šåœ°è¯´æ˜è¿™ä¸€ç‚¹ï¼šç¼–ç å™¨ï¼ˆEncodersï¼‰ã€‚ ç¼–ç å™¨å¯ä»¥å¸®åŠ© CRTC å°†å¸§ç¼“å†²å™¨ä¸­çš„æ•°æ®è½¬æ¢æˆæ­£ç¡®çš„æ ¼å¼ï¼Œä»¥ä¾¿ç”¨äºæ‰€é€‰çš„è¿æ¥å™¨ã€‚ ä¸éœ€è¦äº†è§£æ›´å¤šçš„è½¬æ¢ä¿¡æ¯å°±èƒ½ä½¿ç”¨å®ƒã€‚ ä¸è¿‡ï¼Œå¿…é¡»çŸ¥é“ï¼Œæ¯ä¸ªè¿æ¥å™¨å¯ä»¥ä½¿ç”¨çš„ç¼–ç å™¨éƒ½æ˜¯æœ‰é™çš„ã€‚ è€Œæ¯ä¸ªç¼–ç å™¨åªèƒ½ä¸æœ‰é™çš„ CRTC é…åˆä½¿ç”¨ã€‚ å› æ­¤ï¼Œè¦åšçš„å°±æ˜¯å°è¯•æ¯ä¸€ä¸ªå¯ç”¨çš„ç¼–ç å™¨ï¼Œå¹¶å¯»æ‰¾è¯¥ç¼–ç å™¨å¯ä»¥é…åˆä½¿ç”¨çš„ CRTCã€‚ å¦‚æœæ‰¾åˆ°äº†ç¬¬ä¸€ä¸ªå·¥ä½œç»„åˆï¼Œå°±ä¼šå¾ˆé«˜å…´ï¼Œå¹¶å°†å…¶å†™å…¥ @dev ç»“æ„ã€‚ ä½†åœ¨éå†æ‰€æœ‰å¯ç”¨ç¼–ç å™¨ä¹‹å‰ï¼Œé¦–å…ˆè¦åœ¨ä¸€ä¸ªè¿æ¥å™¨ä¸Šå°è¯•å½“å‰æ¿€æ´»çš„ç¼–ç å™¨ +CRTCï¼Œä»¥é¿å…å‡ºç°å®Œæ•´çš„æ¨¡å¼é›†ã€‚ ä¸è¿‡ï¼Œåœ¨ä½¿ç”¨ CRTC ä¹‹å‰ï¼Œå¿…é¡»ç¡®ä¿ä¹‹å‰è®¾ç½®çš„å…¶ä»–è®¾å¤‡éƒ½æ²¡æœ‰ä½¿ç”¨è¯¥ CRTCã€‚ è¯·è®°ä½ï¼Œæ¯ä¸ª CRTC åªèƒ½é©±åŠ¨ä¸€ä¸ªè¿æ¥å™¨ï¼å› æ­¤ï¼Œåªéœ€éå†ä¹‹å‰è®¾ç½®çš„è®¾å¤‡çš„ â€œmodeset_listâ€ï¼Œå¹¶æ£€æŸ¥è¯¥ CRTC ä¹‹å‰æ˜¯å¦æœªè¢«ä½¿ç”¨ã€‚ å¦åˆ™ï¼Œå°†ç»§ç»­ä½¿ç”¨ä¸‹ä¸€ä¸ª CRTCç¼–ç å™¨ç»„åˆã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","Graphics"]},{"title":"OpenGLæ˜¾ç¤º","path":"/2024/05/10/1-å¹³å°ç³»ç»Ÿ-Linux-Graphics-OpenGLæ˜¾ç¤º/","content":"GLUGLUï¼ˆOpenGL Utility Libraryï¼‰æ˜¯ OpenGL çš„ä¸€ä¸ªè¾…åŠ©åº“ï¼Œæä¾›äº†ä¸€äº›æ›´é«˜çº§çš„å‡ ä½•è®¡ç®—å’Œå¯¹è±¡æ„é€ å‡½æ•°ï¼Œå¦‚æ›²é¢å’Œä½“çš„ç”Ÿæˆã€å¹³ç§»ã€æ—‹è½¬ç­‰ï¼Œè¿™äº›å‡½æ•°åœ¨å¤„ç†å¤æ‚çš„å‡ ä½•æ“ä½œæ—¶éå¸¸æœ‰ç”¨ã€‚ GLFWGLFW æ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æºåº“ï¼Œä¸»è¦ç”¨äºåˆ›å»ºå’Œç®¡ç†å›¾å½¢åº”ç”¨ç¨‹åºä¸­çš„çª—å£ã€OpenGL æˆ– Vulkan ä¸Šä¸‹æ–‡ï¼Œä»¥åŠå¤„ç†ç”¨æˆ·è¾“å…¥ã€å®šæ—¶å™¨ç­‰åŠŸèƒ½ã€‚é€‚ç”¨äºå„ç§å›¾å½¢åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œæä¾›äº†çª—å£ç®¡ç†ã€ä¸Šä¸‹æ–‡ç®¡ç†ã€è¾“å…¥å¤„ç†ç­‰åŠŸèƒ½ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿä¸“æ³¨äºå›¾å½¢æ¸²æŸ“å’Œåº”ç”¨é€»è¾‘çš„å®ç°ã€‚ ä¸»è¦åŠŸèƒ½ï¼š çª—å£ç®¡ç†ï¼š GLFW å…è®¸å¼€å‘è€…åˆ›å»ºçª—å£å¹¶å¯¹å…¶è¿›è¡Œç®¡ç†ï¼ŒåŒ…æ‹¬è°ƒæ•´å¤§å°ã€æœ€å°åŒ–ã€æœ€å¤§åŒ–ã€å…³é—­ç­‰æ“ä½œã€‚ ä¸Šä¸‹æ–‡ç®¡ç†ï¼š å®ƒæä¾›äº†åˆ›å»º OpenGL æˆ– Vulkan ä¸Šä¸‹æ–‡çš„åŠŸèƒ½ï¼Œä½¿å¾—å›¾å½¢æ¸²æŸ“ç¨‹åºå¯ä»¥åœ¨çª—å£ä¸­ç»˜åˆ¶å›¾å½¢ã€‚ è¾“å…¥å¤„ç†ï¼š GLFW æ”¯æŒå¤„ç†ç”¨æˆ·è¾“å…¥ï¼ŒåŒ…æ‹¬é”®ç›˜è¾“å…¥ã€é¼ æ ‡ç§»åŠ¨å’Œç‚¹å‡»ã€æ¸¸æˆæ‰‹æŸ„ç­‰ã€‚ äº‹ä»¶å¤„ç†ï¼š å®ƒå…è®¸å¼€å‘è€…ç›‘å¬å’Œå“åº”å„ç§äº‹ä»¶ï¼Œå¦‚çª—å£å¤§å°æ”¹å˜ã€é”®ç›˜æŒ‰é”®ã€é¼ æ ‡ç§»åŠ¨ç­‰ã€‚ ç›‘è§†å™¨ç®¡ç†ï¼š GLFW æ”¯æŒå¤šä¸ªæ˜¾ç¤ºå™¨çš„ç®¡ç†ï¼Œå¯ä»¥è·å–æ˜¾ç¤ºå™¨çš„åˆ†è¾¨ç‡ã€åˆ·æ–°ç‡ç­‰ä¿¡æ¯ã€‚ ä½¿ç”¨æ­¥éª¤ï¼š åˆå§‹åŒ–ï¼š åœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œè°ƒç”¨ GLFW çš„åˆå§‹åŒ–å‡½æ•°æ¥åˆå§‹åŒ–åº“ã€‚ åˆ›å»ºçª—å£ï¼š ä½¿ç”¨ GLFW çš„çª—å£åˆ›å»ºå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªçª—å£å¹¶æŒ‡å®šå…¶å±æ€§ï¼Œå¦‚å¤§å°ã€æ ‡é¢˜ç­‰ã€‚ åˆ›å»ºä¸Šä¸‹æ–‡ï¼š ä½¿ç”¨ GLFW çš„ä¸Šä¸‹æ–‡åˆ›å»ºå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ª OpenGL æˆ– Vulkan ä¸Šä¸‹æ–‡ã€‚ ä¸»å¾ªç¯ï¼š åœ¨ä¸»å¾ªç¯ä¸­è½®è¯¢äº‹ä»¶ï¼Œå¹¶æ ¹æ®äº‹ä»¶ç±»å‹åšå‡ºç›¸åº”çš„å¤„ç†ã€‚ æ¸²æŸ“ï¼š åœ¨æ¸²æŸ“é˜¶æ®µï¼Œä½¿ç”¨ OpenGL æˆ– Vulkan ç­‰å›¾å½¢ API ç»˜åˆ¶åœºæ™¯ã€‚ æ¸…ç†ï¼š åœ¨ç¨‹åºç»“æŸæ—¶ï¼Œè°ƒç”¨ GLFW çš„æ¸…ç†å‡½æ•°æ¥é‡Šæ”¾èµ„æºå¹¶å…³é—­åº“ã€‚ åˆ©ç”¨ glfw ç›‘è§†å™¨ Demo #include GLFW/glfw3.h int main() // åˆå§‹åŒ– GLFW if (!glfwInit()) return -1; // è·å–ç›‘è§†å™¨ï¼ˆæ˜¾ç¤ºå™¨ï¼‰åˆ—è¡¨ int count; GLFWmonitor** monitors = glfwGetMonitors(count); // æŒ‡å®šè¦ä½¿ç”¨çš„æ˜¾ç¤ºè®¾å¤‡ç´¢å¼• int monitor_index = 0; // è®¾ç½®ä¸ºæƒ³è¦çš„æ˜¾ç¤ºè®¾å¤‡ç´¢å¼• // è·å–æŒ‡å®šç´¢å¼•çš„æ˜¾ç¤ºè®¾å¤‡ GLFWmonitor* monitor = (monitor_index count) ? monitors[monitor_index] : NULL; // è·å–æ˜¾ç¤ºè®¾å¤‡çš„è§†é¢‘æ¨¡å¼ const GLFWvidmode* mode = glfwGetVideoMode(monitor); // åˆ›å»ºçª—å£å¹¶æŒ‡å®šæ˜¾ç¤ºè®¾å¤‡ GLFWwindow* window = glfwCreateWindow(mode-width, mode-height, OpenGL Window, monitor, NULL); if (!window) glfwTerminate(); return -1; // è¿›å…¥ä¸»å¾ªç¯ while (!glfwWindowShouldClose(window)) // æ¸²æŸ“ä»£ç  glClear(GL_COLOR_BUFFER_BIT); // ... glfwSwapBuffers(window); glfwPollEvents(); // æ¸…ç†èµ„æº glfwDestroyWindow(window); glfwTerminate(); return 0; GLUTï¼ˆOpenGL Utility Toolkitï¼‰ GLUT æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å·¥å…·åŒ…ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç† OpenGL çª—å£ã€å¤„ç†ç”¨æˆ·è¾“å…¥ç­‰ã€‚å®ƒæä¾›äº†ä¸€ç»„ç®€å•çš„ APIï¼Œä½¿å¾—ç¼–å†™åŸºæœ¬çš„ OpenGL ç¨‹åºå˜å¾—æ›´åŠ å®¹æ˜“ã€‚ - GLUT æ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿï¼ŒåŒ…æ‹¬ Windowsã€Linux å’Œ macOSã€‚ - ä½¿ç”¨ GLUTï¼Œå¯ä»¥å¾ˆå¿«åœ°ç¼–å†™å‡ºä¸€ä¸ªå¯ä»¥åœ¨ä¸åŒå¹³å°ä¸Šè¿è¡Œçš„ç®€å• OpenGL ç¨‹åºï¼Œè€Œä¸å¿…æ‹…å¿ƒå¹³å°ç‰¹å®šçš„ç»†èŠ‚ã€‚ - ä½†æ˜¯ï¼ŒGLUT å¯¹äºåˆ›å»ºå¤æ‚çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰å¯èƒ½ä¸å¤Ÿçµæ´»ï¼Œå› ä¸ºå®ƒçš„åŠŸèƒ½ç›¸å¯¹æœ‰é™ã€‚ GLUT æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å·¥å…·åŒ…ï¼Œç”¨äºç®€åŒ– OpenGL åº”ç”¨ç¨‹åºçš„å¼€å‘ã€‚å®ƒæä¾›äº†ä¸€ç»„å‡½æ•°ï¼Œç”¨äºåˆ›å»ºçª—å£ã€å¤„ç†è¾“å…¥äº‹ä»¶ã€è¿›è¡ŒåŸºæœ¬çš„å›¾å½¢ç»˜åˆ¶ç­‰ï¼Œä½¿å¼€å‘è€…å¯ä»¥æ›´è½»æ¾åœ°ç¼–å†™ OpenGL åº”ç”¨ç¨‹åºï¼Œè€Œæ— éœ€å¤„ç†åº•å±‚çš„çª—å£ç³»ç»Ÿçš„ç»†èŠ‚ã€‚ GLUT æä¾›äº†ä¸€ä¸ªç›¸å¯¹ç®€å•çš„æ¥å£ï¼Œé€‚ç”¨äºå¿«é€ŸåŸå‹è®¾è®¡å’Œç®€å•çš„å›¾å½¢åº”ç”¨ç¨‹åºã€‚å®ƒé€šå¸¸ç”¨äºå­¦ä¹  OpenGLã€ç¼–å†™å°å‹æ¸¸æˆã€æ¼”ç¤ºç¨‹åºç­‰ã€‚ GLXï¼ˆOpenGL Extension to the X Window Systemï¼‰ GLX æ˜¯ OpenGL åœ¨ X Window System ä¸Šçš„æ‰©å±•ï¼Œå®ƒå…è®¸ OpenGL åº”ç”¨ç¨‹åºä¸ X æœåŠ¡å™¨é€šä¿¡ï¼Œå¹¶åœ¨ X çª—å£ç³»ç»Ÿä¸­åˆ›å»º OpenGL ä¸Šä¸‹æ–‡ã€‚GLX æä¾›äº†ä¸€ç»„å‡½æ•°ï¼Œç”¨äºåœ¨ X çª—å£ç³»ç»Ÿä¸­åˆ›å»º OpenGL æ¸²æŸ“ä¸Šä¸‹æ–‡ã€ç®¡ç† OpenGL çª—å£å’Œå›¾å½¢æ¸²æŸ“ç­‰ã€‚ GLX å…è®¸ OpenGL åº”ç”¨ç¨‹åºç›´æ¥ä¸ X æœåŠ¡å™¨é€šä¿¡ï¼Œè€Œä¸éœ€è¦å€ŸåŠ©å…¶ä»–åº“æˆ–å·¥å…·ã€‚å®ƒæä¾›äº†å¯¹ OpenGL çš„å®Œæ•´æ”¯æŒï¼Œå¯ä»¥å®ç°é«˜æ€§èƒ½çš„å›¾å½¢æ¸²æŸ“å’Œäº¤äº’ã€‚ GLX åˆ™æ˜¯ OpenGL åœ¨ X çª—å£ç³»ç»Ÿä¸Šçš„æ‰©å±•ï¼Œæä¾›äº†ä¸ X æœåŠ¡å™¨é€šä¿¡å’Œåœ¨ X çª—å£ç³»ç»Ÿä¸­åˆ›å»º OpenGL æ¸²æŸ“ä¸Šä¸‹æ–‡çš„åŠŸèƒ½ã€‚ EGLï¼ˆEmbedded Graphics Libraryï¼‰EGL æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å›¾å½¢æ¸²æŸ“ä¸Šä¸‹æ–‡çš„æ¥å£ï¼Œé€šå¸¸ç”¨äºåµŒå…¥å¼ç³»ç»Ÿå’Œç§»åŠ¨è®¾å¤‡ä¸Šã€‚ - EGL æ˜¯ OpenGL ES å’Œ OpenVG çš„æ ‡å‡†çš„æœ¬åœ°æ˜¾ç¤ºç³»ç»Ÿæ¥å£ï¼Œå®ƒæä¾›äº†ä¸åº•å±‚çª—å£ç³»ç»Ÿäº¤äº’çš„èƒ½åŠ›ã€‚ - åœ¨ Linux ä¸Šï¼ŒEGL é€šå¸¸ä¸ GBMï¼ˆGeneric Buffer Managerï¼‰æˆ–å…¶ä»–å›¾å½¢ç³»ç»Ÿé…åˆä½¿ç”¨ï¼Œå¦‚ Waylandã€‚ - ä½¿ç”¨ EGLï¼Œå¯ä»¥åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸Šæ›´å¥½åœ°æ§åˆ¶ OpenGL ä¸Šä¸‹æ–‡çš„åˆ›å»ºå’Œç®¡ç†ï¼Œä»¥åŠä¸çª—å£ç³»ç»Ÿçš„äº¤äº’ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","Graphics"]},{"title":"Ubuntuæ›´æ¢å›½å†…æº","path":"/2024/05/09/1-å¹³å°ç³»ç»Ÿ-Linux-Ubuntu-Ubuntuæ›´æ¢å›½å†…æº/","content":"Ubuntu æ›´æ¢å›½å†…æºUbuntu æœ¬èº«çš„æºä½¿ç”¨çš„æ˜¯å›½å†…çš„æºï¼Œä¸‹è½½é€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚åœ¨ Ubuntu 24.04 ä¹‹å‰ï¼ŒUbuntu çš„è½¯ä»¶æºé…ç½®æ–‡ä»¶ä½¿ç”¨ä¼ ç»Ÿçš„ One-Line-Styleï¼Œè·¯å¾„ä¸º etcaptsources.listï¼›ä» Ubuntu 24.04 å¼€å§‹ï¼ŒUbuntu çš„è½¯ä»¶æºé…ç½®æ–‡ä»¶å˜æ›´ä¸º DEB822 æ ¼å¼ï¼Œè·¯å¾„ä¸º etcaptsources.list.dubuntu.sourcesã€‚ æ¸…åæºåœ°å€ https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu-ports/ bionic ä»£è¡¨ ubuntu18 Ubntu24 ä¹‹å‰ç‰ˆæœ¬å¤‡ä»½etcaptsources.list æ–‡ä»¶mv /etc/apt/sources.list /etc/apt/sourses.list.backup æ–°å»ºetcaptsources.list æ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹#163æºdeb http://mirrors.163.com/ubuntu/ bionic main restricted universe multiversedeb http://mirrors.163.com/ubuntu/ bionic-security main restricted universe multiversedeb http://mirrors.163.com/ubuntu/ bionic-updates main restricted universe multiversedeb http://mirrors.163.com/ubuntu/ bionic-proposed main restricted universe multiversedeb http://mirrors.163.com/ubuntu/ bionic-backports main restricted universe multiversedeb-src http://mirrors.163.com/ubuntu/ bionic main restricted universe multiversedeb-src http://mirrors.163.com/ubuntu/ bionic-security main restricted universe multiversedeb-src http://mirrors.163.com/ubuntu/ bionic-updates main restricted universe multiversedeb-src http://mirrors.163.com/ubuntu/ bionic-proposed main restricted universe multiversedeb-src http://mirrors.163.com/ubuntu/ bionic-backports main restricted universe multiverse æ›´æ”¹å®Œæˆä¹‹åæ‰§è¡Œä¸€ä¸‹ apt update å‘½ä»¤ å…¶ä»–çš„ä¸€äº› apt å‘½ä»¤sudo apt-get update æ›´æ–°æºsudo apt-get install package å®‰è£…åŒ…sudo apt-get remove package åˆ é™¤åŒ…sudo apt-cache search package æœç´¢è½¯ä»¶åŒ…sudo apt-cache show package è·å–åŒ…çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚è¯´æ˜ã€å¤§å°ã€ç‰ˆæœ¬ç­‰sudo apt-get install package --reinstall é‡æ–°å®‰è£…åŒ…sudo apt-get -f install ä¿®å¤å®‰è£…sudo apt-get remove package --purge åˆ é™¤åŒ…ï¼ŒåŒ…æ‹¬é…ç½®æ–‡ä»¶ç­‰sudo apt-get build-dep package å®‰è£…ç›¸å…³çš„ç¼–è¯‘ç¯å¢ƒsudo apt-get upgrade æ›´æ–°å·²å®‰è£…çš„åŒ…sudo apt-get dist-upgrade å‡çº§ç³»ç»Ÿsudo apt-cache depends package äº†è§£ä½¿ç”¨è¯¥åŒ…ä¾èµ–é‚£äº›åŒ…sudo apt-cache rdepends package æŸ¥çœ‹è¯¥åŒ…è¢«å“ªäº›åŒ…ä¾èµ–sudo apt-get source package ä¸‹è½½è¯¥åŒ…çš„æºä»£ç sudo apt-get clean sudo apt-get autoclean æ¸…ç†æ— ç”¨çš„åŒ…sudo apt-get check æ£€æŸ¥æ˜¯å¦æœ‰æŸåçš„ä¾èµ– å…¶ä»–å‡ ä¸ªå›½å†…çš„æºï¼š#ä¸­ç§‘å¤§æºdeb https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiversedeb https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiversedeb https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiversedeb https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiversedeb https://mirrors.ustc.edu.cn/ubuntu/ bionic-proposed main restricted universe multiversedeb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiversedeb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiversedeb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiversedeb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiversedeb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse#é˜¿é‡Œäº‘æºdeb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiversedeb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiversedeb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiversedeb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiversedeb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse#æ¸…åæºdeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiversedeb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiversedeb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiversedeb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiversedeb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiversedeb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse Ubuntu24Ubuntu 24.04 ä½¿ç”¨ä¸­ç§‘å¤§æºçš„é…ç½®æ–¹æ³•å¦‚ä¸‹ï¼š å¤‡ä»½æºé…ç½®æ–‡ä»¶åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š sudo cp /etc/apt/sources.list.d/ubuntu.sources /etc/apt/sources.list.d/ubuntu.sources.bak ç¼–è¾‘æºé…ç½®æ–‡ä»¶è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ‰“å¼€æºé…ç½®æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼š sudo vim /etc/apt/sources.list.d/ubuntu.sources æ·»åŠ ä¸­ç§‘å¤§æºé…ç½®å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ–‡ä»¶ä¸­ï¼š Types: debURIs: https://mirrors.ustc.edu.cn/ubuntuSuites: noble noble-updates noble-backportsComponents: main restricted universe multiverseSigned-By: /usr/share/keyrings/ubuntu-archive-keyring.gpgTypes: debURIs: https://mirrors.ustc.edu.cn/ubuntuSuites: noble-securityComponents: main restricted universe multiverseSigned-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg æ›´æ–°è½¯ä»¶æºåˆ—è¡¨åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ›´æ–°è½¯ä»¶æºåˆ—è¡¨ï¼š sudo apt-get update å¦‚æœéœ€è¦å‡çº§ç³»ç»Ÿè½¯ä»¶åŒ…ï¼Œå¯ä»¥ç»§ç»­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š sudo apt-get upgrade","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","Ubuntu"]},{"title":"åŠ å¯†æ–¹æ¡ˆ","path":"/2024/05/08/1-å¹³å°ç³»ç»Ÿ-Linux-åŠ å¯†-åŠ å¯†æ–¹æ¡ˆ/","content":"3568 åº”ç”¨ç¨‹åºåŠä¸»æ¿å¯æ‰§è¡Œæ–‡ä»¶åŠ å¯†æ–¹æ¡ˆåœ¨é’ˆå¯¹å¯æ‰§è¡Œæ–‡ä»¶çš„åŠ å£³åŠ å¯†å’Œè§£å¯†ä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨ä»¥ä¸‹æ­¥éª¤ï¼š åŠ å£³åŠ å¯†ï¼š é€‰æ‹©å£³ç¨‹åºï¼š é€‰æ‹©ä¸€ä¸ªç”¨äºåŠ å£³çš„ç¨‹åºï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå°å‹çš„ç¨‹åºï¼Œå®ƒå¯ä»¥å°†åŸå§‹çš„ ELF æ–‡ä»¶åµŒå…¥åˆ°è‡ªèº«ä¸­ï¼Œå¹¶æ·»åŠ è§£å¯†é€»è¾‘ã€‚ åµŒå…¥å¹¶åŠ å¯†åŸå§‹ ELF æ–‡ä»¶ï¼š å°†åŸå§‹çš„ ELF å¯æ‰§è¡Œæ–‡ä»¶åµŒå…¥åˆ°å£³ç¨‹åºä¸­ï¼Œå¹¶å¯¹åµŒå…¥çš„åŸå§‹ ELF æ–‡ä»¶è¿›è¡ŒåŠ å¯†å¤„ç†ï¼Œä½¿ç”¨åŠ å¯†ç®—æ³•å¯¹æ–‡ä»¶å†…å®¹è¿›è¡ŒåŠ å¯†ï¼Œç¡®ä¿åªæœ‰æ­£ç¡®çš„è§£å¯†å¯†é’¥å¯ä»¥è§£å¯†æ–‡ä»¶ã€‚ ç”ŸæˆåŠ å¯†åçš„æ–‡ä»¶ï¼š å°†åŠ å¯†åçš„ ELF æ–‡ä»¶ä¿å­˜ä¸ºä¸€ä¸ªæ–°çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ç»è¿‡åŠ å¯†å¤„ç†çš„ã€‚ è§£å¯†ï¼š æ‰§è¡ŒåŠ å¯†åçš„æ–‡ä»¶ï¼š æ‰§è¡ŒåŠ å¯†åçš„ ELF æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯å£³ç¨‹åºï¼Œå®ƒåŒ…å«äº†è§£å¯†é€»è¾‘ã€‚ è§£å¯†é€»è¾‘ï¼š å£³ç¨‹åºåœ¨è¿è¡Œæ—¶ä¼šå¯¹è‡ªèº«è¿›è¡Œè§£å¯†ï¼Œå¹¶å°†åµŒå…¥çš„åŸå§‹ ELF æ–‡ä»¶è§£å¯†å‡ºæ¥ã€‚ è¿˜åŸåŸå§‹ ELF æ–‡ä»¶ï¼š è§£å¯†åçš„åŸå§‹ ELF æ–‡ä»¶ä¼šè¢«è¿˜åŸåˆ°å†…å­˜ä¸­ï¼Œç„¶åå£³ç¨‹åºä¼šå°†æ§åˆ¶æƒè½¬ç§»åˆ°åŸå§‹ ELF æ–‡ä»¶ï¼Œä½¿å¾—åŸå§‹ç¨‹åºå¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚ æœ¬æ–‡æ¡£å®ç°çš„åŠ å¯†æ–¹å¼ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸¤ä¸ªæ¨¡å—ï¼š å†…æ ¸ç©ºé—´ä¸‹ï¼ŒåŸºäºå†…æ ¸å¯†é’¥ä¿ç•™æœåŠ¡çš„ ELF æ–‡ä»¶è§£å¯†å¹¶äº¤ä»˜å†…æ ¸æ­£å¸¸è¿è¡Œæ¨¡å— ç”¨æˆ·ç©ºé—´ä¸‹ï¼ŒåŸºäºéå¯¹ç§°åŠ å¯†ç®—æ³•çš„ ELF æ–‡ä»¶å†…å®¹åŠ å¯†ï¼Œä¸»è¦é’ˆå¯¹ ELF Header æ¨¡å—ã€å¯é€‰åŠ å¯† program header å’Œ section headerã€‘ 1. åº”ç”¨ç¨‹åºåŠ å£³1.1 ELF æ–‡ä»¶æ ¼å¼ä»‹ç»åº”ç”¨ç¨‹åºåŠ å£³æ¨¡å—å¯¹åº”ç”¨ç¨‹åºè¿›è¡ŒåŠ å¯†æ“ä½œï¼Œä¸»è¦é’ˆå¯¹ä»¥ä¸‹æ¨¡å—è¿›è¡ŒåŠ å¯†æ“ä½œ ELF header Program header table ã€å¯é€‰ã€‘ Section header table ã€å¯é€‰ã€‘ å…¶ä¸­ ELF header æŒ‡æ˜äº† ELF æ–‡ä»¶çš„æ•´ä½“ä¿¡æ¯ï¼Œå¦‚ ELF æ–‡ä»¶çš„ magic valueã€ç±»å‹ã€ç‰ˆæœ¬ã€ç›®æ ‡æœºå™¨ç­‰ã€‚ #define EI_NIDENT (16) typedef struct unsigned char\te_ident[EI_NIDENT];\t/* Magic number and other info */ Elf_Half e_type; /* Object file type */ Elf_Half e_machine; /* Architecture */ Elf_Word e_version; /* Object file version æ–‡ä»¶ç‰ˆæœ¬,ç›®å‰å¸¸è§çš„ELFæ–‡ä»¶ç‰ˆæœ¬å‡ä¸ºEV_CURRENT(1)*/ Elf_Addr e_entry; /* Entry point virtual address å…¥å£è™šæ‹Ÿåœ°å€ã€‚*/ Elf_Off e_phoff; /* Program header table file offset æ®µè¡¨æ–‡ä»¶åç§»ã€‚*/ Elf_Off e_shoff; /* Section header table file offset èŠ‚è¡¨æ–‡ä»¶åç§»ã€‚*/ Elf_Word e_flags; /* Processor-specific flags å¤„ç†å™¨ç‰¹å®šçš„æ ‡å¿—ï¼Œä¸€èˆ¬ä¸º0ã€‚*/ Elf_Half e_ehsize; /* ELF header size in bytes Elf_Headerçš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰*/ Elf_Half e_phentsize;\t/* Program header table entry size æ®µå¤´çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€‚*/ Elf_Half e_phnum; /* Program header table entry count æ®µçš„æ•°é‡ã€‚*/ Elf_Half e_shentsize;\t/* Section header table entry size èŠ‚å¤´çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€‚*/ Elf_Half e_shnum; /* Section header table entry count å­—çš„æ•°é‡ã€‚*/ Elf_Half e_shstrndx; /* Section header string table index èŠ‚å­—ç¬¦ä¸²è¡¨çš„èŠ‚ç´¢å¼•*/ Elf_Ehdr; [e_ident] åŒ…å«äº†Maigc Numberå’Œå…¶å®ƒä¿¡æ¯ï¼Œå…±16å­—èŠ‚ã€‚ 0~3ï¼šå‰4å­—èŠ‚ä¸ºMagic Numberï¼Œå›ºå®šä¸ºELFMAGã€‚ 4ï¼ˆEI_CLASSï¼‰ï¼šELFCLASS32ä»£è¡¨æ˜¯32ä½ELFï¼ŒELFCLASS64 ä»£è¡¨64ä½ELFã€‚ 5ï¼ˆEI_DATAï¼‰ï¼šELFDATA2LSBä»£è¡¨å°ç«¯ï¼ŒELFDATA2MSBä»£è¡¨å¤§ç«¯ã€‚ 6ï¼ˆEI_VERSIONï¼‰ï¼šå›ºå®šä¸ºEV_CURRENTï¼ˆ1ï¼‰ã€‚ 7ï¼ˆEI_OSABIï¼‰ï¼šæ“ä½œç³»ç»ŸABIæ ‡è¯†ï¼ˆå®é™…æœªä½¿ç”¨ï¼‰ã€‚ 8ï¼ˆEI_ABIVERSIONï¼‰ï¼šABIç‰ˆæœ¬ï¼ˆå®é™… æœªä½¿ç”¨ï¼‰ã€‚ 9~15ï¼šå¯¹é½å¡«å……ï¼Œæ— å®é™…æ„ä¹‰ã€‚ [e_type] ELFçš„æ–‡ä»¶ç±»å‹ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š ET_REL å¯é‡å®šä½æ–‡ ä»¶ï¼ˆå¦‚ç›®æ ‡æ–‡ä»¶ï¼‰ ET_EXEC å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¯ç›´æ¥æ‰§è¡Œçš„æ–‡ä»¶ï¼‰ DT_DYN å…±äº«ç›®æ ‡æ–‡ä»¶ï¼ˆå¦‚SOåº“ï¼‰ DT_CORE Coreæ–‡ä»¶ï¼ˆåæ ¸æ–‡ä»¶ï¼‰ æ³¨ï¼šGCCä½¿ç”¨ç¼–è¯‘é€‰é¡¹ -pie ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶å®é™… ä¹Ÿæ˜¯DT_DYNç±»å‹ã€‚ [e_machine] å¤„ç†å™¨æ¶æ„ç±»å‹ï¼Œå¸¸è§çš„å®šä¹‰å¦‚ä¸‹ï¼š EM_386 Intel 386æ¶æ„ï¼ˆå®é™…ä¸Šå°±æ˜¯32ä½çš„x86æ¶æ„ï¼‰ EM_X86_64\tAmd x86-64æ¶æ„ EM_ARM ARMæ¶æ„ï¼ˆåŒ…æ‹¬thumb,thumb2ï¼‰ EM_AARCH64\tARM64æ¶æ„ å¦å¤–ï¼ŒELF header è¿˜æŒ‡æ˜äº† program header table ä¸ section header table ä¸¤ä¸ªè¡¨åœ¨æ–‡ä»¶ä¸­çš„åç§»ä½ç½®ã€æ¡ç›®ä¸ªæ•°ã€æ¡ç›®å¤§å°ã€‚ è¿™ä¸¤ä¸ªè¡¨çš„ä½ç½®å’Œé•¿åº¦éšç€ sectionsegment çš„ä¸ªæ•°è€Œå˜åŒ–ï¼Œè€Œ ELF header æ€»æ˜¯ä½äºæ–‡ä»¶æœ€å¼€å¤´ï¼Œä¸”é•¿åº¦å›ºå®šã€‚ å¦‚æœæƒ³è¦è®¿é—® program header table å’Œ section header table ä¸­çš„ä¿¡æ¯ï¼Œå¿…é¡»é€šè¿‡ ELF header æ¥æ‰¾åˆ°å®ƒä»¬åœ¨æ–‡ä»¶ä¸­çš„ç¡®åˆ‡ä½ç½®ã€‚ Program header table ä¸»è¦æè¿°äº†å°†å“ªä¸€ä¸ªæˆ–å“ªå‡ ä¸ª section ç»„ç»‡ä¸ºä¸€ä¸ª segmentï¼Œä»¥åŠå„ä¸ª segment çš„æè¿°ä¿¡æ¯ã€‚ ELF ç¨‹åºå¤´æ˜¯å¯¹äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ®µçš„æè¿°ï¼Œæ˜¯ç¨‹åºè£…è½½å¿…éœ€çš„ä¸€éƒ¨åˆ†ã€‚æ®µï¼ˆsegmentï¼‰æ˜¯åœ¨å†…æ ¸è£…è½½æ—¶è¢«è§£æçš„ï¼Œæè¿°äº†ç£ç›˜ä¸Šå¯æ‰§è¡Œæ–‡ä»¶çš„å†…å­˜å¸ƒå±€ä»¥åŠå¦‚ä½•æ˜ å°„åˆ°å†…å­˜ä¸­ã€‚å¯ä»¥é€šè¿‡å¼•ç”¨åŸå§‹ ELF å¤´ä¸­åä¸º e_phoffï¼ˆç¨‹åºå¤´è¡¨åç§»é‡ï¼‰çš„åç§»é‡æ¥å¾—åˆ°ç¨‹åºå¤´è¡¨ï¼Œ Section header table æè¿°äº† ELF æ–‡ä»¶ä¸­æ‰€æœ‰çš„ sectionï¼Œä»¥åŠæ¯ä¸ª section çš„ç±»å‹ã€é•¿åº¦ç­‰æè¿°ä¿¡æ¯ã€‚ èŠ‚ï¼Œä¸æ˜¯æ®µã€‚æ®µæ˜¯ç¨‹åºæ‰§è¡Œçš„å¿…è¦ç»„æˆéƒ¨åˆ†ï¼Œåœ¨æ¯ä¸ªæ®µä¸­ï¼Œä¼šæœ‰ä»£ç æˆ–è€…æ•°æ®è¢«åˆ’åˆ†ä¸ºä¸åŒçš„èŠ‚ã€‚èŠ‚å¤´è¡¨æ˜¯å¯¹è¿™äº›èŠ‚çš„ä½ç½®å’Œå¤§å°çš„æè¿°ï¼Œä¸»è¦ç”¨äºé“¾æ¥å’Œè°ƒè¯•ã€‚èŠ‚å¤´å¯¹äºç¨‹åºçš„æ‰§è¡Œæ¥è¯´ä¸æ˜¯å¿…éœ€çš„ï¼Œæ²¡æœ‰èŠ‚å¤´è¡¨ï¼Œç¨‹åºä»å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œå› ä¸ºèŠ‚å¤´è¡¨æ²¡æœ‰å¯¹ç¨‹åºçš„å†…å­˜å¸ƒå±€è¿›è¡Œæè¿°ï¼Œå¯¹ç¨‹åºå†…å­˜å¸ƒå±€çš„æè¿°æ˜¯ç¨‹åºå¤´è¡¨çš„ä»»åŠ¡ã€‚èŠ‚å¤´æ˜¯å¯¹ç¨‹åºå¤´çš„è¡¥å……ã€‚readelf â€“l å‘½ä»¤å¯ä»¥æ˜¾ç¤ºä¸€ä¸ªæ®µå¯¹åº”æœ‰å“ªäº›èŠ‚ï¼Œå¯ä»¥å¾ˆç›´è§‚åœ°çœ‹åˆ°èŠ‚å’Œæ®µä¹‹é—´çš„å…³ç³»ã€‚ Section header table ä¸­å¹¶ä¸å­˜å‚¨æ¯ä¸ª section çš„åç§°ã€‚æ‰€æœ‰ section çš„åç§°å…¨éƒ¨å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º section header string table çš„ section ä¸­ï¼Œåç§°ä¹‹é—´ç”¨ \\0 åˆ†éš”ã€‚åœ¨ ELF header ä¸­ï¼Œè®°å½•äº†è¯¥ section åœ¨ section header table ä¸­çš„ç´¢å¼•ã€‚ 1.2 åŠŸèƒ½æ¨¡å—é’ˆå¯¹ä»¥ä¸Šç†è§£ï¼ŒåŠ å£³ç¨‹åºçš„åŠŸèƒ½æœ‰ä»¥ä¸‹ï¼š é’ˆå¯¹ ELF æ–‡ä»¶ï¼Œé€šè¿‡å­—æ®µå¼‚æˆ–ã€RSA åŠ å¯†(å¯é€‰)ã€‘çš„æ–¹å¼è¿›è¡Œè¦†å†™ ELF headerã€ProgramSection header table(å¯é€‰)ã€‘ ELF å¼€å¤´ä¿®æ”¹ä¸º HMAVICã€åŠ å¯†æ–¹å¼å­—æ®µã€‘ã€åŠ å¯†å†…å®¹å­—æ®µã€‘ELF ã€å¯é€‰ã€‘å•ç‹¬è¿›è¡Œæœ«å°¾è¿½åŠ ç­¾åï¼Œç¡®è®¤ä¸º HMAVIC ç¨‹åº 1.3 ä»£ç å®ç°#define SIGN_OFFSET 9#define SIGN_CONTENT HMAVIC#define SIGN_LENGTH 6 è°ƒè¯• xxd -l 100 a.runreadelf -h a.run 2. å†…æ ¸å¯†é’¥ä¿ç•™æœåŠ¡2.1 å¯†é’¥é…ç½®æ–‡ä»¶é…ç½®æ–‡ä»¶å†…å®¹ #è¡¨ç¤ºè¿™ä¸ªé…ç½®æ–‡ä»¶åŒ…å«ä¸€ç³»åˆ—çš„è¯·æ±‚ä¿¡æ¯ï¼Œç”¨äºç”Ÿæˆè¯ä¹¦è¯·æ±‚[ req ]# æŒ‡å®šç”Ÿæˆçš„ RSA å¯†é’¥é•¿åº¦ä¸º 2048 ä½default_bits = 2048# æŒ‡å®šç”¨äºè¯·æ±‚çš„åˆ†è¾¨å (DN)ï¼Œåœ¨ [ req_distinguished_name ] éƒ¨åˆ†ä¸­å®šä¹‰distinguished_name = req_distinguished_name# ç¦ç”¨äº¤äº’å¼æç¤ºï¼Œç”Ÿæˆè¯ä¹¦æ—¶ä¸ä¼šè¦æ±‚ç”¨æˆ·è¾“å…¥prompt = no# æŒ‡å®šå­—ç¬¦ç¼–ç ä¸º UTF-8string_mask = utf8only# æŒ‡å®šç”¨äº X.509 æ‰©å±•çš„é…ç½®ï¼Œå®šä¹‰åœ¨ [ myexts ] éƒ¨åˆ†x509_extensions = myexts# å®šä¹‰äº†è¯·æ±‚çš„åˆ†è¾¨åä¿¡æ¯ï¼ŒåŒ…æ‹¬ç»„ç»‡ (O)ã€é€šç”¨å (CN) å’Œç”µå­é‚®ä»¶åœ°å€ (emailAddress)[ req_distinguished_name ]# æŒ‡å®šç»„ç»‡åä¸ºhmavicO = hmavic# æŒ‡å®šé€šç”¨åä¸º verification for hmavicCN = verification for hmavic# æŒ‡å®šç”µå­é‚®ä»¶åœ°å€emailAddress = liuluhua7@gmail.com# å®šä¹‰äº† X.509 æ‰©å±•ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŸºæœ¬çº¦æŸ (basicConstraints)ã€å¯†é’¥ç”¨é€” (keyUsage)ã€ä¸»é¢˜å¯†é’¥æ ‡è¯†ç¬¦ (subjectKeyIdentifier) å’Œé¢å‘è€…å¯†é’¥æ ‡è¯†ç¬¦ (authorityKeyIdentifier)[ myexts ]# æŒ‡å®šè¯ä¹¦ä¸æ˜¯ CA è¯ä¹¦ï¼Œå³ä¸å…·æœ‰é¢å‘å…¶ä»–è¯ä¹¦çš„æƒé™basicConstraints=critical,CA:FALSE# æŒ‡å®šå¯†é’¥ç”¨é€”ä¸ºæ•°å­—ç­¾åkeyUsage=digitalSignature# æŒ‡å®šä½¿ç”¨ SHA-1 å“ˆå¸Œç®—æ³•ç”Ÿæˆä¸»é¢˜å¯†é’¥æ ‡è¯†ç¬¦subjectKeyIdentifier=hash# æŒ‡å®šä½¿ç”¨å¯†é’¥æ ‡è¯†ç¬¦ç”Ÿæˆé¢å‘è€…å¯†é’¥æ ‡è¯†ç¬¦authorityKeyIdentifier=keyid ç”Ÿæˆå¯†é’¥å¹¶å¯¼å…¥è¯ä¹¦ openssl req -new -nodes -utf8 -sha256 -days 36500 -batch -x509 -config x509.hm.genkey -outform PEM -out kernel_key.pem -keyout kernel_key.pem ä½¿ç”¨ OpenSSL å·¥å…·ç”Ÿæˆä¸€ä¸ªé…ç½®ä¿¡æ¯ç”± x509.hm.genkey æŒ‡å®šçš„è‡ªç­¾åçš„ X.509 æ ¼å¼è¯ä¹¦ã€‚ ä»¥ä¸‹æ˜¯å‘½ä»¤ä¸­æ¯ä¸ªé€‰é¡¹çš„è§£é‡Šï¼š openssl reqï¼šä½¿ç”¨ OpenSSL å·¥å…·ä¸­çš„ req å­å‘½ä»¤ï¼Œç”¨äºå¤„ç†è¯ä¹¦è¯·æ±‚å’Œç”Ÿæˆè¯ä¹¦ã€‚-newï¼šæŒ‡å®šåˆ›å»ºä¸€ä¸ªæ–°çš„è¯ä¹¦è¯·æ±‚ã€‚-nodesï¼šä¸åŠ å¯†ç”Ÿæˆçš„ç§é’¥ï¼Œå³ä¸è®¾ç½®ç§é’¥å¯†ç ã€‚-utf8ï¼šæŒ‡å®šä½¿ç”¨ UTF-8 ç¼–ç ã€‚-sha256ï¼šæŒ‡å®šä½¿ç”¨ SHA-256 å“ˆå¸Œç®—æ³•ç”Ÿæˆè¯ä¹¦ç­¾åã€‚-days 36500ï¼šæŒ‡å®šè¯ä¹¦çš„æœ‰æ•ˆæœŸä¸º 36500 å¤©-batchï¼šåœ¨ç”Ÿæˆè¯ä¹¦è¯·æ±‚æ—¶ä¸ä¼šæç¤ºç”¨æˆ·è¾“å…¥ä»»ä½•ä¿¡æ¯ï¼Œè€Œæ˜¯ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„é»˜è®¤å€¼ã€‚-x509ï¼šæŒ‡å®šç”Ÿæˆè‡ªç­¾åçš„ X.509 æ ¼å¼è¯ä¹¦ï¼Œè€Œä¸æ˜¯ç”Ÿæˆè¯ä¹¦è¯·æ±‚ã€‚-config x509.genkeyï¼šæŒ‡å®šä½¿ç”¨é…ç½®æ–‡ä»¶ x509.genkey ä¸­çš„é…ç½®ä¿¡æ¯æ¥ç”Ÿæˆè¯ä¹¦ã€‚-outform PEMï¼šæŒ‡å®šè¾“å‡ºçš„è¯ä¹¦æ ¼å¼ä¸º PEM æ ¼å¼ã€‚-out kernel_key.pemï¼šæŒ‡å®šè¾“å‡ºçš„è¯ä¹¦æ–‡ä»¶åä¸º kernel_key.pemã€‚-keyout kernel_key.pemï¼šæŒ‡å®šè¾“å‡ºçš„ç§é’¥æ–‡ä»¶åä¸º kernel_key.pemï¼Œå› ä¸ºåœ¨æœ¬ä¾‹ä¸­ç§é’¥å’Œè¯ä¹¦æ˜¯ä¸€å¯¹çš„ã€‚ 2.2 ç¼–è¯‘å†…æ ¸ä¿®æ”¹ kernel/arch/arm64/configs/OK3568-C-linux_defconfig åœ¨æ–‡ä»¶æœ€åå¢åŠ ä»¥ä¸‹å†…å®¹ï¼š ## Certificates for signature checking#CONFIG_SYSTEM_TRUSTED_KEYRING=yCONFIG_SYSTEM_TRUSTED_KEYS=certs/kernel_key.pem è¿›å…¥é¡¶å±‚ç›®å½•æ‰§è¡Œ ./build.sh kernel åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œåº”è¯¥å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š ...EXTRACT_CERTS PATH_TO_CERT/kernel_key.pemAS certs/system_certificates.oAR certs/built-in.o... å¾…å†…æ ¸ç¼–è¯‘å®Œæˆï¼Œçƒ§å½•å†…æ ¸è‡³å¼€å‘æ¿ï¼ŒæŸ¥çœ‹ proc æ–‡ä»¶ç³»ç»Ÿä¸­çš„ /proc/keysã€‚å¦‚æœèƒ½å¤Ÿçœ‹åˆ°è‡ªè¡Œç”Ÿæˆçš„å¯†é’¥ï¼Œé‚£ä¹ˆè¯´æ˜è¯¥å¯†é’¥å·²ç»è¢«æ”¾ç½®äºå†…æ ¸çš„ç³»ç»Ÿå¯†é’¥ç¯ä¸­ã€‚ 3. å†…æ ¸æ¨¡å—è„±å£³å¹¶è¿è¡Œ3.1 åŠŸèƒ½æ¨¡å—é’ˆå¯¹åŠ å£³è¿›è¡Œç¼–å†™è„±å£³æ¨¡å—åŠŸèƒ½å¦‚ä¸‹ï¼š å†…æ ¸æ¨¡å—å®‰è£…æ—¶è¿›è¡Œ RSA æ ¸éªŒï¼Œæ ¸éªŒé€šè¿‡åˆ™å®‰è£…æ¨¡å—ï¼Œå¦åˆ™å¸è½½æ¨¡å— æ³¨å…¥åˆ°å†…æ ¸ ELF è¿è¡Œä¹‹å‰ï¼Œå¯¹ HMAVIC å¼€å¤´çš„ ELF è¿›è¡Œæ‹¦æˆª æ ¹æ®åŠ å¯†æ–¹å¼å’Œå†…å®¹è¿›è¡Œè§£å¯†å¤„ç†ï¼Œè§£å¯†å®Œæˆåè¦†å†™å†…å®¹äº¤ç”± Linux å†…æ ¸å¤„ç† ã€å¯é€‰ã€‘é’ˆå¯¹æœªç­¾åç¨‹åºï¼Œæ‹’ç»æ‰§è¡Œ 3.2 å°†è§£å¯†æ¨¡å—åµŒå…¥å†…æ ¸ä¸­ä¸º ELF çš„ç­¾åä¸éªŒè¯ç”Ÿæˆäº†ä¸€å¯¹ RSA å…¬ç§é’¥ï¼Œå°†å…¬ç§é’¥ä»¥ç¬¦åˆ X.509 æ ‡å‡†çš„æ–¹å¼å¯¼å…¥åˆ°ä¸€ä¸ª PEM ç¼–ç çš„æ–‡ä»¶ä¸­ã€‚é€šè¿‡ä¸Šè¿°æœºåˆ¶ï¼Œå¯ä»¥å°†æ–‡ä»¶ä¸­çš„å…¬é’¥è¯ä¹¦ç¼–è¯‘åˆ°å†…æ ¸çš„ç³»ç»Ÿå¯†é’¥ç¯ä¸Šã€‚è¿™æ ·ï¼Œåœ¨ ELF ç­¾åéªŒè¯æ¨¡å— ä¸­ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ç³»ç»Ÿå¯†é’¥ç¯ä¸­çš„å…¬é’¥è¯ä¹¦ï¼Œå¯¹ ELF æ–‡ä»¶ä¸­çš„ç­¾åä¿¡æ¯è¿›è¡ŒéªŒè¯ã€‚ é¦–å…ˆï¼Œå¯¹ Linux å†…æ ¸ä¸­å·²æœ‰çš„ å†…æ ¸æ¨¡å—ç­¾å éªŒè¯æœºåˆ¶çš„ä»£ç è¿›è¡Œäº†åˆ†æã€‚åœ¨å†…æ ¸æºä»£ç ç›®å½• certs/system_keyring.c ä¸­ï¼Œå®šä¹‰äº†å†…æ ¸å†…ç½®çš„å—ä¿¡å¯†é’¥ï¼š certssystem_keyring.c å¤åˆ¶ static struct key *builtin_trusted_keys; ä½†ç”±äºè¿™ä¸ªå˜é‡æ²¡æœ‰è¢«å£°æ˜ä¸º externï¼Œå› æ­¤æ— æ³•åœ¨å…¶å®ƒå†…æ ¸ä»£ç ä¸­ç›´æ¥å¼•ç”¨è¿™ä¸ªå˜é‡ã€‚ä½†æ˜¯åœ¨è¿™ä¸ªæºæ–‡ä»¶ä¸­ï¼Œå¼€æ”¾äº† verify_pkcs7_signature() å‡½æ•°ï¼Œä½¿å¾—å…¶å®ƒå†…æ ¸ä»£ç èƒ½å¤Ÿé€šè¿‡è¿™ä¸ªå‡½æ•°ï¼Œé—´æ¥ä½¿ç”¨å†…ç½®å¯†é’¥ç¯çš„ç­¾åéªŒè¯åŠŸèƒ½ï¼š certssystem_keyring.c å¤åˆ¶ /** * verify_pkcs7_signature - Verify a PKCS#7-based signature on system data. * @data: The data to be verified (NULL if expecting internal data). * @len: Size of @data. * @raw_pkcs7: The PKCS#7 message that is the signature. * @pkcs7_len: The size of @raw_pkcs7. * @trusted_keys: Trusted keys to use (NULL for builtin trusted keys only, * (void *)1UL for all trusted keys). * @usage: The use to which the key is being put. * @view_content: Callback to gain access to content. * @ctx: Context for callback. */int verify_pkcs7_signature(const void *data, size_t len, const void *raw_pkcs7, size_t pkcs7_len, struct key *trusted_keys, enum key_being_used_for usage, int (*view_content)(void *ctx, const void *data, size_t len, size_t asn1hdrlen), void *ctx)... åœ¨å†…æ ¸ä»£ç ä¸­ï¼Œé€šè¿‡ #include linux/verification.h ä½¿ç”¨è¯¥å‡½æ•°æ—¶ï¼Œè¾“å…¥ ç­¾åæ•°æ® ä¸ è¢«ç­¾åæ•°æ® çš„ ç¼“å†²åŒºå†…å­˜åœ°å€ å’Œ ç¼“å†²åŒºé•¿åº¦ï¼Œå°±èƒ½å¤Ÿä½¿ç”¨å†…ç½®å¯†é’¥å®Œæˆç­¾åè®¤è¯ã€‚å› æ­¤ï¼ŒELF ç­¾åéªŒè¯æ¨¡å— åªè¦èƒ½å¤Ÿä» ELF æ–‡ä»¶ä¸­æ­£ç¡®æå– PKCS #7 æ ¼å¼çš„ç­¾åæ•°æ®ï¼Œä»¥åŠç­¾åä¿æŠ¤çš„ç›®æ ‡æ•°æ®ï¼Œå°±å¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°éªŒè¯æ•°å­—ç­¾åæ˜¯å¦æ­£ç¡®ã€‚ æ¨¡å—ä»£ç  ```ç¼–è¯‘ Makefile```makefileifneq ($(KERNELRELEASE),)obj-m := binfmt_elf_signature_verification.oelse# KDIR := ../#KDIR := /lib/modules/$(shell uname -r)/buildKDIR := /home/forlinx/Desktop/OK3568-linux-source/kernelall: $(MAKE) -C $(KDIR) M=$(PWD) modulesclean: $(RM) *.ko $(RM) *.o $(RM) *.mod* $(RM) *.symvers $(RM) *.order $(RM) .*.mk $(RM) .*.cmd $(RM) -r .tmp_versionsendif æ‰§è¡Œ make ARCH=arm64 CROSS_COMPILE=/home/forlinx/Desktop/OK3568-linux-source/buildroot/output/OK3568/host/bin/aarch64-buildroot-linux-gnu- å‚è€ƒLinux ELF æ–‡ä»¶æ•°æ®å®Œæ•´æ€§ä¿æŠ¤ç³»ç»Ÿ é™„å½• A OpenSSL è¿›è¡Œå¯†é’¥ç”ŸæˆéªŒè¯A1 ç§é’¥openssl genpkey -algorithm RSA -out private_key.pem -aes256 å°†ç”Ÿæˆä¸€ä¸ª AES256 åŠ å¯†çš„ RSA ç§é’¥ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°åä¸º private_key.pem çš„æ–‡ä»¶ä¸­ã€‚ ç”Ÿæˆæ—¶éœ€è¦å¯†ç ï¼Œå¯†ç ä¸º HmAvic@123 A2 å…¬é’¥openssl rsa -in private_key.pem -pubout -out public_key.pem å°†ä»ç§é’¥æ–‡ä»¶ private_key.pem ä¸­æå–å…¬é’¥ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°åä¸º public_key.pem çš„æ–‡ä»¶ä¸­ã€‚ A3 ç­¾åopenssl dgst -sha256 -sign private_key.pem -out signature.bin your_elf_file ä½¿ç”¨ SHA-256 ç®—æ³•å¯¹ your_elf_file è¿›è¡Œç­¾åï¼Œå¹¶å°†ç­¾åç»“æœä¿å­˜åˆ° signature.bin æ–‡ä»¶ä¸­ã€‚ A4 ç­¾åè®¤è¯openssl dgst -sha256 -verify public_key.pem -signature signature.bin your_elf_file ä½¿ç”¨å…¬é’¥ public_key.pem éªŒè¯ signature.bin æ–‡ä»¶ä¸­çš„ç­¾åæ˜¯å¦ä¸ your_elf_file åŒ¹é…ã€‚ A5 ç­¾åå’Œè®¤è¯ä»£ç å®ç°ä»¥ä¸‹æ˜¯å®ç°æ–‡ä»¶ç­¾åå’ŒéªŒè¯çš„ C++ ç¤ºä¾‹ä»£ç ï¼Œä½¿ç”¨ OpenSSL åº“è¿›è¡Œ RSA ç­¾åå’Œ SHA256 å“ˆå¸Œè¿ç®—ã€‚ä»£ç åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼šsign_file ç”¨äºç”Ÿæˆæ–‡ä»¶ç­¾åï¼Œverify_signature ç”¨äºéªŒè¯ç­¾åã€‚ #include stdio.h#include stdlib.h#include openssl/rsa.h#include openssl/pem.h#include openssl/sha.h#define BUF_SIZE 1024// å‡½æ•°å£°æ˜int sign_file(const char* file_path, const char* private_key_path, const char* signature_path);int verify_signature(const char* file_path, const char* signature_path, const char* public_key_path);int main() const char* file_path = your_elf_file; const char* private_key_path = private_key.pem; const char* public_key_path = public_key.pem; const char* signature_path = signature.bin; // ç­¾åæ–‡ä»¶ if (sign_file(file_path, private_key_path, signature_path) != 0) fprintf(stderr, Failed to sign file. ); return 1; printf(File signed successfully. ); // éªŒè¯ç­¾å if (verify_signature(file_path, signature_path, public_key_path) != 0) fprintf(stderr, Signature verification failed. ); return 1; printf(Signature verified successfully. ); return 0;int sign_file(const char* file_path, const char* private_key_path, const char* signature_path) // æ‰“å¼€æ–‡ä»¶è¿›è¡Œè¯»å– FILE* file = fopen(file_path, rb); if (!file) fprintf(stderr, Failed to open file. ); return 1; // è¯»å–æ–‡ä»¶å†…å®¹å¹¶è®¡ç®— SHA256 å“ˆå¸Œ unsigned char buffer[BUF_SIZE]; size_t bytes_read; SHA256_CTX sha256; SHA256_Init(sha256); while ((bytes_read = fread(buffer, 1, BUF_SIZE, file)) != 0) SHA256_Update(sha256, buffer, bytes_read); unsigned char hash[SHA256_DIGEST_LENGTH]; SHA256_Final(hash, sha256); fclose(file); // åŠ è½½ç§é’¥ FILE* private_key_file = fopen(private_key_path, rb); if (!private_key_file) fprintf(stderr, Failed to open private key file. ); return 1; RSA* rsa = PEM_read_RSAPrivateKey(private_key_file, NULL, NULL, NULL); fclose(private_key_file); if (!rsa) fprintf(stderr, Failed to load private key. ); return 1; // å¯¹å“ˆå¸Œè¿›è¡Œ RSA ç­¾å unsigned char signature[BUF_SIZE]; unsigned int signature_length; if (!RSA_sign(NID_sha256, hash, SHA256_DIGEST_LENGTH, signature, signature_length, rsa)) fprintf(stderr, Failed to sign hash. ); RSA_free(rsa); return 1; // å°†ç­¾åå†™å…¥æ–‡ä»¶ FILE* signature_file = fopen(signature_path, wb); if (!signature_file) fprintf(stderr, Failed to create signature file. ); RSA_free(rsa); return 1; fwrite(signature, 1, signature_length, signature_file); fclose(signature_file); RSA_free(rsa); return 0;int verify_signature(const char* file_path, const char* signature_path, const char* public_key_path) // æ‰“å¼€æ–‡ä»¶è¿›è¡Œè¯»å– FILE* file = fopen(file_path, rb); if (!file) fprintf(stderr, Failed to open file. ); return 1; // è¯»å–æ–‡ä»¶å†…å®¹å¹¶è®¡ç®— SHA256 å“ˆå¸Œ unsigned char buffer[BUF_SIZE]; size_t bytes_read; SHA256_CTX sha256; SHA256_Init(sha256); while ((bytes_read = fread(buffer, 1, BUF_SIZE, file)) != 0) SHA256_Update(sha256, buffer, bytes_read); unsigned char hash[SHA256_DIGEST_LENGTH]; SHA256_Final(hash, sha256); fclose(file); // åŠ è½½å…¬é’¥ FILE* public_key_file = fopen(public_key_path, rb); if (!public_key_file) fprintf(stderr, Failed to open public key file. ); return 1; RSA* rsa = PEM_read_RSA_PUBKEY(public_key_file, NULL, NULL, NULL); fclose(public_key_file); if (!rsa) fprintf(stderr, Failed to load public key. ); return 1; // è¯»å–ç­¾åæ–‡ä»¶ FILE* signature_file = fopen(signature_path, rb); if (!signature_file) fprintf(stderr, Failed to open signature file. ); RSA_free(rsa); return 1; unsigned char signature[BUF_SIZE]; size_t signature_length = fread(signature, 1, BUF_SIZE, signature_file); fclose(signature_file); // éªŒè¯ç­¾å if (RSA_verify(NID_sha256, hash, SHA256_DIGEST_LENGTH, signature, signature_length, rsa) != 1) fprintf(stderr, Signature verification failed. ); RSA_free(rsa); return 1; RSA_free(rsa); return 0; ä»£ç è¯´æ˜1. åŒ…å«å¿…è¦çš„ OpenSSL å¤´æ–‡ä»¶#include openssl/rsa.h#include openssl/pem.h#include openssl/sha.h 2. å®šä¹‰å¸¸é‡#define BUF_SIZE 1024 3. å‡½æ•°å£°æ˜int sign_file(const char* file_path, const char* private_key_path, const char* signature_path);int verify_signature(const char* file_path, const char* signature_path, const char* public_key_path); 4. ä¸»å‡½æ•°int main() // æ–‡ä»¶è·¯å¾„é…ç½® const char* file_path = your_elf_file; const char* private_key_path = private_key.pem; const char* public_key_path = public_key.pem; const char* signature_path = signature.bin; // æ‰§è¡Œç­¾åå’ŒéªŒè¯ if (sign_file(file_path, private_key_path, signature_path) != 0) fprintf(stderr, Failed to sign file. ); return 1; printf(File signed successfully. ); if (verify_signature(file_path, signature_path, public_key_path) != 0) fprintf(stderr, Signature verification failed. ); return 1; printf(Signature verified successfully. ); return 0; 5. sign_file å‡½æ•°int sign_file(const char* file_path, const char* private_key_path, const char* signature_path) // æ‰“å¼€æ–‡ä»¶è¿›è¡Œè¯»å– FILE* file = fopen(file_path, rb); if (!file) fprintf(stderr, Failed to open file. ); return 1; // è¯»å–æ–‡ä»¶å†…å®¹å¹¶è®¡ç®— SHA256 å“ˆå¸Œ unsigned char buffer[BUF_SIZE]; size_t bytes_read; SHA256_CTX sha256; SHA256_Init(sha256); while ((bytes_read = fread(buffer, 1, BUF_SIZE, file)) != 0) SHA256_Update(sha256, buffer, bytes_read); unsigned char hash[SHA256_DIGEST_LENGTH]; SHA256_Final(hash, sha256); fclose(file); // åŠ è½½ç§é’¥ FILE* private_key_file = fopen(private_key_path, rb); if (!private_key_file) fprintf(stderr, Failed to open private key file. ); return 1; RSA* rsa = PEM_read_RSAPrivateKey(private_key_file, NULL, NULL, NULL); fclose(private_key_file); if (!rsa) fprintf(stderr, Failed to load private key. ); return 1; // å¯¹å“ˆå¸Œè¿›è¡Œ RSA ç­¾å unsigned char signature[BUF_SIZE]; unsigned int signature_length; if (!RSA_sign(NID_sha256, hash, SHA256_DIGEST_LENGTH, signature, signature_length, rsa)) fprintf(stderr, Failed to sign hash. ); RSA_free(rsa); return 1; // å°†ç­¾åå†™å…¥æ–‡ä»¶ FILE* signature_file = fopen(signature_path, wb); if (!signature_file) fprintf(stderr, Failed to create signature file. ); RSA_free(rsa); return 1; fwrite(signature, 1, signature_length, signature_file); fclose(signature_file); RSA_free(rsa); return 0; 6. verify_signature å‡½æ•°int verify_signature(const char* file_path, const char* signature_path, const char* public_key_path) // æ‰“å¼€æ–‡ä»¶è¿›è¡Œè¯»å– FILE* file = fopen(file_path, rb); if (!file) fprintf(stderr, Failed to open file. ); return 1; // è¯»å–æ–‡ä»¶å†…å®¹å¹¶è®¡ç®— SHA256 å“ˆå¸Œ unsigned char buffer[BUF_SIZE]; size_t bytes_read; SHA256_CTX sha256; SHA256_Init(sha256); while ((bytes_read = fread(buffer, 1, BUF_SIZE, file)) != 0) SHA256_Update(sha256, buffer, bytes_read); unsigned char hash[SHA256_DIGEST_LENGTH]; SHA256_Final(hash, sha256); fclose(file); // åŠ è½½å…¬é’¥ FILE* public_key_file = fopen(public_key_path, rb); if (!public_key_file) fprintf(stderr, Failed to open public key file. ); return 1; RSA* rsa = PEM_read_RSA_PUBKEY(public_key_file, NULL, NULL, NULL); fclose(public_key_file); if (!rsa) fprintf(stderr, Failed to load public key. ); return 1; // è¯»å–ç­¾åæ–‡ä»¶ FILE* signature_file = fopen(signature_path, rb); if (!signature_file) fprintf(stderr, Failed to open signature file. ); RSA_free(rsa); return 1; unsigned char signature[BUF_SIZE]; size_t signature_length = fread(signature, 1, BUF_SIZE, signature_file); fclose(signature_file); // éªŒè¯ç­¾å if (RSA_verify(NID_sha256, hash, SHA256_DIGEST_LENGTH, signature, signature_length, rsa) != 1) fprintf(stderr, Signature verification failed. ); RSA_free(rsa); return 1; RSA_free(rsa); return 0; ä½¿ç”¨æ­¥éª¤ ç”Ÿæˆå¯†é’¥å¯¹ï¼šä½¿ç”¨ OpenSSL ç”Ÿæˆ RSA å¯†é’¥å¯¹ï¼š openssl genrsa -out private_key.pem 2048openssl rsa -pubout -in private_key.pem -out public_key.pem ç¼–è¯‘ä»£ç ï¼šç¡®ä¿å®‰è£…äº† OpenSSL åº“åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘ä»£ç ï¼š gcc -o sign_verify sign_verify.c -lcrypto è¿è¡Œç¨‹åºï¼šå°† your_elf_file æ›¿æ¢ä¸ºè¦ç­¾åçš„æ–‡ä»¶è·¯å¾„ï¼Œè¿è¡Œç¨‹åºï¼š ./sign_verify éªŒè¯ç»“æœï¼šç¨‹åºä¼šç”Ÿæˆ signature.bin æ–‡ä»¶å¹¶éªŒè¯å…¶ç­¾åã€‚å¦‚æœéªŒè¯æˆåŠŸï¼Œä¼šè¾“å‡ºï¼š File signed successfully.Signature verified successfully. æ³¨æ„äº‹é¡¹ é”™è¯¯å¤„ç†ï¼šä»£ç ä¸­åŒ…å«äº†å®Œæ•´çš„é”™è¯¯å¤„ç†ï¼Œç¡®ä¿æ¯ä¸€æ­¥æ“ä½œéƒ½èƒ½æ­£ç¡®å¤„ç†å¯èƒ½çš„å¤±è´¥æƒ…å†µã€‚ å®‰å…¨æ€§ï¼šä½¿ç”¨ SHA256 å“ˆå¸Œç®—æ³•å’Œ RSA ç®—æ³•æä¾›äº†è¾ƒé«˜çš„å®‰å…¨æ€§ã€‚ å…¼å®¹æ€§ï¼šç¡®ä¿ OpenSSL åº“ç‰ˆæœ¬ä¸ä»£ç å…¼å®¹ï¼Œæ¨èä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ OpenSSLã€‚ é™„å½• B å¦‚ä½•å®ç°å¯¹ç¨‹åºçš„åŠ è§£å¯†å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯† æ–¹å¼ä¸€ï¼šä¸åŒè®¾å¤‡å†…æ ¸çƒ§å½•ä¸åŒçš„ç§é’¥è¿›è¡Œè§£å¯† æ–¹å¼äºŒï¼šä¸åŒè®¾å¤‡å†…æ ¸çƒ§å½•ç›¸åŒçš„ç§é’¥è¿›è¡Œè§£å¯† B1 ç”Ÿæˆ RSA å¯†é’¥å¯¹é¦–å…ˆï¼Œéœ€è¦ç”Ÿæˆ RSA å¯†é’¥å¯¹ï¼ŒåŒ…æ‹¬ç§é’¥å’Œå…¬é’¥ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹å‘½ä»¤æ¥ç”Ÿæˆ RSA å¯†é’¥å¯¹ï¼š openssl genpkey -algorithm RSA -out private_key.pem -aes256openssl rsa -pubout -in private_key.pem -out public_key.pem è¿™ä¸ªå‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ª RSA ç§é’¥æ–‡ä»¶ private_key.pemï¼Œå¹¶åœ¨ç”Ÿæˆçš„åŒæ—¶ä½¿ç”¨ AES256 ç®—æ³•å¯¹ç§é’¥è¿›è¡ŒåŠ å¯†ä¿æŠ¤ã€‚ç„¶åä»ç§é’¥ä¸­æå–å…¬é’¥ï¼Œå¹¶ä¿å­˜åˆ° public_key.pem æ–‡ä»¶ä¸­ã€‚ B2 ä½¿ç”¨ RSA åŠ å¯†æ–‡ä»¶è¦ä½¿ç”¨ RSA å…¬é’¥åŠ å¯†æ–‡ä»¶ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š openssl rsautl -encrypt -pubin -inkey public_key.pem -in plaintext.txt -out encrypted.txt è¿™ä¸ªå‘½ä»¤ä¼šä½¿ç”¨å…¬é’¥æ–‡ä»¶ public_key.pem å¯¹æ˜æ–‡æ–‡ä»¶ plaintext.txt è¿›è¡ŒåŠ å¯†ï¼Œå¹¶å°†åŠ å¯†åçš„ç»“æœè¾“å‡ºåˆ° encrypted.txt æ–‡ä»¶ä¸­ã€‚ B3 ä½¿ç”¨ RSA è§£å¯†æ–‡ä»¶è¦ä½¿ç”¨ RSA ç§é’¥è§£å¯†æ–‡ä»¶ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š openssl rsautl -decrypt -inkey private_key.pem -in encrypted.txt -out decrypted.txt è¿™ä¸ªå‘½ä»¤ä¼šä½¿ç”¨ç§é’¥æ–‡ä»¶ private_key.pem å¯¹åŠ å¯†æ–‡ä»¶ encrypted.txt è¿›è¡Œè§£å¯†ï¼Œå¹¶å°†è§£å¯†åçš„ç»“æœè¾“å‡ºåˆ° decrypted.txt æ–‡ä»¶ä¸­ã€‚ å¦‚ä½•å‘å†…æ ¸ä¸­æ·»åŠ å¯†é’¥ å¦‚ä½•åœ¨ç¨‹åºä¸­è¯»å–å¯†é’¥","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","åŠ å¯†"]},{"title":"ELFæ–‡ä»¶åˆ†æ","path":"/2024/05/07/1-å¹³å°ç³»ç»Ÿ-Linux-ç¨‹åº-ELFæ–‡ä»¶åˆ†æ/","content":"ELF å…¨ç§° â€œExecutable and Linkable Formatâ€ï¼Œå³å¯æ‰§è¡Œå¯é“¾æ¥æ–‡ä»¶æ ¼å¼ï¼Œç›®å‰å¸¸è§çš„ Linuxã€ Android å¯æ‰§è¡Œæ–‡ä»¶ã€å…±äº«åº“ï¼ˆ.soï¼‰ã€ç›®æ ‡æ–‡ä»¶ï¼ˆ .oï¼‰ä»¥åŠ Core æ–‡ä»¶ï¼ˆåæ ¸ï¼‰å‡ä¸ºæ­¤æ ¼å¼ã€‚ æ–‡ä»¶å¸ƒå±€å¸¸è§çš„ ELF æ–‡ä»¶å¤§è‡´ç»“æ„å¦‚ä¸‹ï¼š å¸¸è§çš„ ELF æ ¼å¼å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå·¦è¾¹ä¸ºé“¾æ¥è§†å›¾ï¼Œå³è¾¹ä¸ºæ‰§è¡Œè§†å›¾ã€‚ä»å¤§å±€ä¸Šçœ‹ï¼ŒELF æ–‡ä»¶ä¸»è¦åˆ†ä¸º 3 ä¸ªéƒ¨åˆ†: ELF Header Section Header Table Program Header Table å…¶ä¸­ï¼ŒELF Header æ˜¯æ–‡ä»¶å¤´ï¼ŒåŒ…å«äº†å›ºå®šé•¿åº¦çš„æ–‡ä»¶ä¿¡æ¯ï¼›Section Header Table åˆ™åŒ…å«äº†é“¾æ¥æ—¶æ‰€éœ€è¦ç”¨åˆ°çš„ä¿¡æ¯ï¼›Program Header Table ä¸­åŒ…å«äº†è¿è¡Œæ—¶åŠ è½½ç¨‹åºæ‰€éœ€è¦çš„ä¿¡æ¯ã€‚ é“¾æ¥è§†å›¾é™æ€é“¾æ¥å™¨ï¼ˆå³ç¼–è¯‘åå‚ä¸ç”Ÿæˆæœ€ç»ˆ ELF è¿‡ç¨‹çš„é“¾æ¥å™¨ï¼Œå¦‚ ld ï¼‰ä¼šä»¥é“¾æ¥è§†å›¾è§£æ ELFã€‚ç¼–è¯‘æ—¶ç”Ÿæˆçš„ .oï¼ˆç›®æ ‡æ–‡ä»¶ï¼‰ä»¥åŠé“¾æ¥åçš„ .so ï¼ˆå…±äº«åº“ï¼‰å‡å¯é€šè¿‡é“¾æ¥è§†å›¾è§£æï¼Œé“¾æ¥è§†å›¾å¯ä»¥æ²¡æœ‰æ®µè¡¨ï¼ˆå¦‚ç›®æ ‡æ–‡ä»¶ä¸ä¼šæœ‰æ®µè¡¨ï¼‰ã€‚ æ‰§è¡Œè§†å›¾åŠ¨æ€é“¾æ¥å™¨ï¼ˆå³åŠ è½½å™¨ï¼Œå¦‚ x86 æ¶æ„ linux ä¸‹çš„ libld-linux.so.2 æˆ–è€…å®‰å“ç³»ç»Ÿä¸‹çš„ systemlinker å‡ä¸ºåŠ¨æ€é“¾æ¥å™¨ï¼‰ä¼šä»¥æ‰§è¡Œè§†å›¾è§£æ ELF å¹¶åŠ¨æ€é“¾æ¥ï¼Œæ‰§è¡Œè§†å›¾å¯ä»¥æ²¡æœ‰èŠ‚è¡¨ã€‚ æ–‡ä»¶å¤´ ELF HeaderELF çš„ç»“æ„å£°æ˜ä½äºç³»ç»Ÿå¤´æ–‡ä»¶ elf.h ä¸­ï¼ŒELF æ ¼å¼åˆ†ä¸º 32 ä½ä¸ 64 ä½ä¸¤ç§ï¼Œé™¤äº†é‡å®šä½ç±»å‹ç¨æœ‰åŒºåˆ«ï¼Œå…¶å®ƒå¤§è‡´ç›¸åŒï¼Œä¸ºäº†ç®€åŒ–æè¿°ï¼Œåç»­è¯´æ˜å°†çœç•¥ 3264 å­—æ ·ã€‚ ELF Header çš„å£°æ˜å¦‚ä¸‹ : #define EI_NIDENT (16)typedef struct unsigned char\te_ident[EI_NIDENT];\t/* Magic number and other info */ Elf_Half e_type; /* Object file type */ Elf_Half e_machine; /* Architecture */ Elf_Word e_version; /* Object file version */ Elf_Addr e_entry; /* Entry point virtual address */ Elf_Off e_phoff; /* Program header table file offset */ Elf_Off e_shoff; /* Section header table file offset */ Elf_Word e_flags; /* Processor-specific flags */ Elf_Half e_ehsize; /* ELF header size in bytes */ Elf_Half e_phentsize; /* Program header table entry size */ Elf_Half e_phnum; /* Program header table entry count */ Elf_Half e_shentsize; /* Section header table entry size */ Elf_Half e_shnum; /* Section header table entry count */ Elf_Half e_shstrndx; /* Section header string table index */ Elf_Ehdr; æ³¨é‡Šéƒ½å¾ˆæ¸…æ¥šäº†ï¼ŒæŒ‘ä¸€äº›æ¯”è¾ƒé‡è¦çš„æ¥è¯´ã€‚å…¶ä¸­ e_type è¡¨ç¤º ELF æ–‡ä»¶çš„ç±»å‹ï¼Œæœ‰ä»¥ä¸‹å‡ ç§: ET_NONE: æœªçŸ¥ç±»å‹ ET_REL: å¯é‡å®šå‘ç±»å‹(relocatable)ï¼Œé€šå¸¸æ˜¯ä»¬ç¼–è¯‘çš„ *.o æ–‡ä»¶ ET_EXEC: å¯æ‰§è¡Œç±»å‹(executable)ï¼Œé™æ€ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶ ET_DYN: å…±äº«å¯¹è±¡(shared object)ï¼ŒåŠ¨æ€ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶æˆ–è€…åŠ¨æ€åº“ *.so ET_CORE: coredump æ–‡ä»¶ e_entry æ˜¯ç¨‹åºçš„å…¥å£è™šæ‹Ÿåœ°å€ï¼Œæ³¨æ„ä¸æ˜¯ main å‡½æ•°çš„åœ°å€ï¼Œè€Œæ˜¯.text æ®µçš„é¦–åœ°å€ _startã€‚å½“ç„¶è¿™ä¹Ÿè¦æ±‚ç¨‹åºæœ¬èº«é PIE(-no-pie)ç¼–è¯‘çš„ä¸” ASLR å…³é—­çš„æƒ…å†µä¸‹ï¼Œå¯¹äºé ET_EXEC ç±»å‹é€šå¸¸å¹¶ä¸æ˜¯å®é™…çš„è™šæ‹Ÿåœ°å€å€¼ã€‚ å…¶ä»–çš„å­—æ®µå¤§å¤šæ•°æ˜¯æŒ‡å®š Section Header(e_sh)å’Œ Program Header(e_ph)çš„ä¿¡æ¯ã€‚SectionProgram Header Table æœ¬èº«å¯ä»¥çœ‹åšæ˜¯æ•°ç»„ç»“æ„ï¼ŒELF å¤´ä¸­çš„ä¿¡æ¯æŒ‡å®šå¯¹åº” Table æ•°ç»„çš„ä½ç½®ã€é•¿åº¦ã€å…ƒç´ å¤§å°ä¿¡æ¯ã€‚æœ€åä¸€ä¸ª e_shstrndx è¡¨ç¤ºçš„æ˜¯ section table ä¸­çš„ç¬¬ e_shstrndx é¡¹å…ƒç´ ï¼Œä¿å­˜äº†æ‰€æœ‰ section table åç§°çš„å­—ç¬¦ä¸²ä¿¡æ¯ã€‚ e_identåŒ…å«äº†Maigc Numberå’Œå…¶å®ƒä¿¡æ¯ï¼Œå…±16å­—èŠ‚ã€‚0~3ï¼šå‰4å­—èŠ‚ä¸ºMagic Numberï¼Œå›ºå®šä¸ºELFMAGã€‚4ï¼ˆEI_CLASSï¼‰ï¼šELFCLASS32ä»£è¡¨æ˜¯32ä½ELFï¼ŒELFCLASS64 ä»£è¡¨64ä½ELFã€‚5ï¼ˆEI_DATAï¼‰ï¼šELFDATA2LSBä»£è¡¨å°ç«¯ï¼ŒELFDATA2MSBä»£è¡¨å¤§ç«¯ã€‚6ï¼ˆEI_VERSIONï¼‰ï¼šå›ºå®šä¸ºEV_CURRENTï¼ˆ1ï¼‰ã€‚7ï¼ˆEI_OSABIï¼‰ï¼šæ“ä½œç³»ç»ŸABIæ ‡è¯†ï¼ˆå®é™…æœªä½¿ç”¨ï¼‰ã€‚8ï¼ˆEI_ABIVERSIONï¼‰ï¼šABIç‰ˆæœ¬ï¼ˆå®é™… æœªä½¿ç”¨ï¼‰ã€‚9~15ï¼šå¯¹é½å¡«å……ï¼Œæ— å®é™…æ„ä¹‰ã€‚ e_typeELFçš„æ–‡ä»¶ç±»å‹ï¼Œå®šä¹‰å¦‚ä¸‹ï¼šET_REL å¯é‡å®šä½æ–‡ ä»¶ï¼ˆå¦‚ç›®æ ‡æ–‡ä»¶ï¼‰ET_EXEC å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¯ç›´æ¥æ‰§è¡Œçš„æ–‡ä»¶ï¼‰DT_DYN å…±äº«ç›®æ ‡æ–‡ä»¶ï¼ˆå¦‚SOåº“ï¼‰DT_CORE Coreæ–‡ä»¶ï¼ˆåæ ¸æ–‡ä»¶ï¼‰æ³¨ï¼šGCCä½¿ç”¨ç¼–è¯‘é€‰é¡¹ -pie ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶å®é™… ä¹Ÿæ˜¯DT_DYNç±»å‹ã€‚ e_machineå¤„ç†å™¨æ¶æ„ç±»å‹ï¼Œå¸¸è§çš„å®šä¹‰å¦‚ä¸‹ï¼šEM_386 Intel 386æ¶æ„ï¼ˆå®é™…ä¸Šå°±æ˜¯32ä½çš„x86æ¶æ„ï¼‰EM_X86_64\tAmd x86-64æ¶æ„EM_ARM ARMæ¶æ„ï¼ˆåŒ…æ‹¬thumb,thumb2ï¼‰EM_AARCH64\tARM64æ¶æ„ e_verison: æ–‡ä»¶ç‰ˆæœ¬ï¼Œç›®å‰å¸¸è§çš„ ELF æ–‡ä»¶ç‰ˆæœ¬å‡ä¸º EV_CURRENTï¼ˆ1ï¼‰ã€‚ e_entry: å…¥å£è™šæ‹Ÿåœ°å€ã€‚ e_phoff: æ®µè¡¨æ–‡ä»¶åç§»ã€‚ e_shoff: èŠ‚è¡¨æ–‡ä»¶åç§»ã€‚ e_flags: å¤„ç†å™¨ç‰¹å®šçš„æ ‡å¿—ï¼Œä¸€èˆ¬ä¸º 0ã€‚ e_ehsize: Elf_Header çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰ e_phentsize: æ®µå¤´ï¼ˆProgram Headerï¼‰çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€‚ e_phnum: æ®µçš„æ•°é‡ã€‚ e_shentsize: èŠ‚å¤´ï¼ˆSection Headerï¼‰çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€‚ e_shnum: å­—çš„æ•°é‡ã€‚ e_shstrndx: èŠ‚å­—ç¬¦ä¸²è¡¨çš„èŠ‚ç´¢å¼•ã€‚ Section Headersection header table æ˜¯ä¸€ä¸ªæ•°ç»„ç»“æ„ï¼Œè¿™ä¸ªæ•°ç»„çš„ä½ç½®åœ¨ e_shoff å¤„ï¼Œå…±æœ‰ e_shnum ä¸ªå…ƒç´ (å³ section)ï¼Œæ¯ä¸ªå…ƒç´ çš„å¤§å°ä¸º e_shentsize å­—èŠ‚ã€‚æ¯ä¸ªå…ƒç´ çš„ç»“æ„å¦‚ä¸‹: typedef struct Elf32_Word\tsh_name; /* Section name (string tbl index) */ Elf32_Word\tsh_type; /* Section type */ Elf32_Word\tsh_flags; /* Section flags */ Elf32_Addr\tsh_addr; /* Section virtual addr at execution */ Elf32_Off\tsh_offset; /* Section file offset */ Elf32_Word\tsh_size; /* Section size in bytes */ Elf32_Word\tsh_link; /* Link to another section */ Elf32_Word\tsh_info; /* Additional section information */ Elf32_Word\tsh_addralign; /* Section alignment */ Elf32_Word\tsh_entsize; /* Entry size if section holds table */ Elf32_Shdr; å…¶ä¸­ sh_name æ˜¯è¯¥ section çš„åç§°ï¼Œç”¨ä¸€ä¸ª word è¡¨ç¤ºå…¶åœ¨å­—ç¬¦è¡¨ä¸­çš„åç§»ï¼Œå­—ç¬¦ä¸²è¡¨(.shstrtab)å°±æ˜¯ä¸Šé¢è¯´åˆ°çš„ç¬¬ e_shstrndx ä¸ªå…ƒç´ ã€‚ELF æ–‡ä»¶ä¸­ç»å¸¸ä½¿ç”¨è¿™ç§åç§»è¡¨ç¤ºæ–¹å¼ï¼Œå¯ä»¥æ–¹ä¾¿ç»„ç»‡ä¸åŒåŒºæ®µä¹‹é—´çš„å¼•ç”¨ã€‚ sh_type è¡¨ç¤ºæœ¬ section çš„ç±»å‹ï¼ŒSPEC ä¸­å®šä¹‰äº†å‡ åä¸ªç±»å‹ï¼Œåˆ—ä¸¾å…¶ä¸­ä¸€äº›å¦‚ä¸‹: SHT_NULL: è¡¨ç¤ºè¯¥ section æ— æ•ˆï¼Œé€šå¸¸ç¬¬ 0 ä¸ª section ä¸ºè¯¥ç±»å‹ SHT_PROGBITS: è¡¨ç¤ºè¯¥ section åŒ…å«ç”±ç¨‹åºå†³å®šçš„å†…å®¹ï¼Œå¦‚.textã€.dataã€.pltã€.go SHT_SYMTABSHT_DYNSYM: è¡¨ç¤ºè¯¥ section ä¸­åŒ…å«ç¬¦å·è¡¨ï¼Œå¦‚.symtabã€.dynsym SHT_DYNAMIC: è¡¨ç¤ºè¯¥ section ä¸­åŒ…å«åŠ¨æ€é“¾æ¥é˜¶æ®µæ‰€éœ€è¦çš„ä¿¡æ¯ SHT_STRTAB: è¡¨ç¤ºè¯¥ section ä¸­åŒ…å«å­—ç¬¦ä¸²ä¿¡æ¯ï¼Œå¦‚.strtabã€.shstrtab SHT_RELSHT_RELA: åŒ…å«é‡å®šå‘é¡¹ä¿¡æ¯ è™½ç„¶æ¯ä¸ª section header çš„å¤§å°ä¸€æ ·(e_shentsize å­—èŠ‚)ï¼Œä½†ä¸åŒç±»å‹çš„ section æœ‰ä¸åŒçš„å†…å®¹ï¼Œå†…å®¹éƒ¨åˆ†ç”±è¿™å‡ ä¸ªå­—æ®µè¡¨ç¤º: sh_offset: å†…å®¹èµ·å§‹åœ°å€ç›¸å¯¹äºæ–‡ä»¶å¼€å¤´çš„åç§» sh_size: å†…å®¹çš„å¤§å° sh_entsize: æœ‰çš„å†…å®¹æ˜¯ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªå­—æ®µå°±è¡¨ç¤ºæ•°ç»„çš„å…ƒç´ å¤§å° ä¸è¿è¡Œæ—¶ä¿¡æ¯ç›¸å…³çš„å­—æ®µä¸º: sh_addr: å¦‚æœè¯¥ section éœ€è¦åœ¨è¿è¡Œæ—¶åŠ è½½åˆ°è™šæ‹Ÿå†…å­˜ä¸­ï¼Œè¯¥å­—æ®µå°±æ˜¯å¯¹åº” section å†…å®¹(ç¬¬ä¸€ä¸ªå­—èŠ‚)çš„è™šæ‹Ÿåœ°å€ sh_addralign: å†…å®¹åœ°å€çš„å¯¹é½ï¼Œå¦‚æœæœ‰çš„è¯éœ€è¦æ»¡è¶³ sh_addr % sh_addralign 0 sh_flags: è¡¨ç¤ºæ‰€æ˜ å°„å†…å®¹çš„æƒé™ï¼Œå¯æ ¹æ® SHF_WRITEALLOCEXECINSTR è¿›è¡Œç»„åˆ å¦å¤–ä¸¤ä¸ªå­—æ®µ sh_link å’Œ sh_info çš„å«ä¹‰æ ¹æ® section ç±»å‹çš„ä¸åŒè€Œä¸åŒï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤º: è‡³äºä¸åŒç±»å‹çš„ sectionï¼Œæœ‰çš„æ˜¯ä¿å­˜ç¬¦å·è¡¨ï¼Œæœ‰çš„æ˜¯ä¿å­˜å­—ç¬¦ä¸²ï¼Œè¿™ä¹Ÿæ˜¯ ELF è¡¨ç°å‡ºæ‹“å±•æ€§å’Œå¤æ‚æ€§çš„åœ°æ–¹ï¼Œå› æ­¤éœ€è¦åœ¨é‡åˆ°å…·ä½“é—®é¢˜çš„æ—¶å€™æŸ¥çœ‹æ–‡æ¡£å»è¿›è¡Œå…·ä½“åˆ†æã€‚ Program Headerprogram header table ç”¨æ¥ä¿å­˜ç¨‹åºåŠ è½½åˆ°å†…å­˜ä¸­æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œä½¿ç”¨æ®µ(segment)æ¥è¡¨ç¤ºã€‚ä¸ section header table ç±»ä¼¼ï¼ŒåŒæ ·æ˜¯æ•°ç»„ç»“æ„ã€‚æ•°ç»„çš„ä½ç½®åœ¨åç§» e_phoff å¤„ï¼Œæ¯ä¸ªå…ƒç´ (segment header)çš„å¤§å°ä¸º e_phentsizeï¼Œå…±æœ‰ e_phnum ä¸ªå…ƒç´ ã€‚å•ä¸ª segment header çš„ç»“æ„å¦‚ä¸‹: typedef struct Elf32_Word\tp_type; /* Segment type */ Elf32_Off\tp_offset; /* Segment file offset */ Elf32_Addr\tp_vaddr; /* Segment virtual address */ Elf32_Addr\tp_paddr; /* Segment physical address */ Elf32_Word\tp_filesz; /* Segment size in file */ Elf32_Word\tp_memsz; /* Segment size in memory */ Elf32_Word\tp_flags; /* Segment flags */ Elf32_Word\tp_align; /* Segment alignment */ Elf32_Phdr; æ—¢ç„¶ program header çš„ä½œç”¨æ˜¯æä¾›ç”¨äºåˆå§‹åŒ–ç¨‹åºè¿›ç¨‹çš„æ®µä¿¡æ¯ï¼Œé‚£ä¹ˆä¸‹é¢è¿™äº›å­—æ®µå°±æ˜¯å¾ˆç›´è§‚çš„: p_offset: è¯¥ segment çš„æ•°æ®åœ¨æ–‡ä»¶ä¸­çš„åç§»åœ°å€(ç›¸å¯¹æ–‡ä»¶å¤´) p_vaddr: segment æ•°æ®åº”è¯¥åŠ è½½åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ p_paddr: segment æ•°æ®åº”è¯¥åŠ è½½åˆ°è¿›ç¨‹çš„ç‰©ç†åœ°å€(å¦‚æœå¯¹åº”ç³»ç»Ÿä½¿ç”¨çš„æ˜¯ç‰©ç†åœ°å€) p_filesz: è¯¥ segment æ•°æ®åœ¨æ–‡ä»¶ä¸­çš„å¤§å° p_memsz: è¯¥ segment æ•°æ®åœ¨è¿›ç¨‹å†…å­˜ä¸­çš„å¤§å°ã€‚æ³¨æ„éœ€è¦æ»¡è¶³ p_memszp_fileszï¼Œå¤šå‡ºçš„éƒ¨åˆ†åˆå§‹åŒ–ä¸º 0ï¼Œé€šå¸¸ä½œä¸º.bss æ®µå†…å®¹ p_flags: è¿›ç¨‹ä¸­è¯¥ segment çš„æƒé™(RWX) p_align: è¯¥ segment æ•°æ®çš„å¯¹é½ï¼Œ2 çš„æ•´æ•°æ¬¡å¹‚ã€‚å³è¦æ±‚ p_offset % p_align p_vaddrã€‚ å‰©ä¸‹çš„ p_type å­—æ®µï¼Œè¡¨ç¤ºè¯¥ program segment çš„ç±»å‹ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§: PT_NULL: è¡¨ç¤ºè¯¥æ®µæœªä½¿ç”¨ PT_LOAD: Loadable Segmentï¼Œå°†æ–‡ä»¶ä¸­çš„ segment å†…å®¹æ˜ å°„åˆ°è¿›ç¨‹å†…å­˜ä¸­å¯¹åº”çš„åœ°å€ä¸Šã€‚å€¼å¾—ä¸€æçš„æ˜¯ SPEC ä¸­è¯´åœ¨ program header ä¸­çš„å¤šä¸ª PT_LOAD åœ°å€æ˜¯æŒ‰ç…§è™šæ‹Ÿåœ°å€é€’å¢æ’åºçš„ã€‚ PT_DYNAMIC: åŠ¨æ€é“¾æ¥ä¸­ç”¨åˆ°çš„æ®µï¼Œé€šå¸¸æ˜¯ RW æ˜ å°„ï¼Œå› ä¸ºéœ€è¦ç”± interpreter(ld.so)ä¿®å¤å¯¹åº”çš„çš„å…¥å£ PT_INTERP: åŒ…å« interpreter çš„è·¯å¾„ï¼Œè§ä¸‹æ–‡ PT_HDR: è¡¨ç¤º program header table æœ¬èº«ã€‚å¦‚æœæœ‰è¿™ä¸ª segment çš„è¯ï¼Œå¿…é¡»è¦åœ¨æ‰€æœ‰å¯åŠ è½½çš„ segment ä¹‹å‰ï¼Œå¹¶ä¸”åœ¨æ–‡ä»¶ä¸­ä¸èƒ½å‡ºç°è¶…è¿‡ä¸€æ¬¡ã€‚ åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸­è¿˜å¯èƒ½æœ‰ä¸€äº›æ‹“å±•çš„ç±»å‹ï¼Œæ¯”å¦‚ PT_GNU_STACKã€PT_GNU_RELRO ç­‰ï¼Œä¸ä¸€è€Œè¶³ã€‚ å‚è€ƒé“¾æ¥ Linux Foundation Referenced Specifications Executable and Linkable Format (ELF) Tool Interface Standard (TIS) Executable and Linking Format (ELF) Specification Version 1.2 elf(5) - format of Executable and Linking Format (ELF) files How programs get run: ELF binaries æ·±å…¥äº†è§£GOT,PLTå’ŒåŠ¨æ€é“¾æ¥","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç¨‹åº"]},{"title":"å†…å­˜åˆ†å¸ƒ","path":"/2024/05/06/1-å¹³å°ç³»ç»Ÿ-Linux-ç¨‹åº-å†…å­˜åˆ†å¸ƒ/","content":"å†…å­˜åˆ†å¸ƒåœ¨ 32 ä½æ“ä½œç³»ç»Ÿä¸­ï¼Œåœ°å€ç©ºé—´çš„æœ€å¤§ç†è®ºé™åˆ¶æ˜¯ 4GBï¼Œå³ (2^{32}) çš„ç»“æœã€‚ç„¶è€Œï¼Œè¿™ä¸ªåœ°å€ç©ºé—´å¹¶ä¸èƒ½å®Œå…¨åˆ†é…ç»™ç”¨æˆ·åº”ç”¨ç¨‹åºï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿæœ¬èº«ä¹Ÿéœ€è¦å ç”¨éƒ¨åˆ†å†…å­˜ã€‚å…·ä½“è€Œè¨€ï¼Œåœ¨ 32 ä½çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œå¯æ‰§è¡Œæ–‡ä»¶çš„å†…å­˜åˆ†å¸ƒå¦‚ä¸‹ï¼š ç”¨æˆ·ç©ºé—´ (app + C åº“): 3GB å†…æ ¸ç©ºé—´ (é©±åŠ¨): 1GB å†…æ ¸ç©ºé—´å†…æ ¸ç©ºé—´å ç”¨äº†é«˜ä½çš„ 1GB åœ°å€ç©ºé—´ï¼ŒèŒƒå›´æ˜¯ä» 0xC0000000 åˆ° 0xFFFFFFFFã€‚è¿™éƒ¨åˆ†å†…å­˜ç”±æ“ä½œç³»ç»Ÿç”¨æ¥ç®¡ç†ç³»ç»Ÿèµ„æºå’Œä¸ç¡¬ä»¶è®¾å¤‡çš„äº¤äº’ã€‚ç”¨æˆ·æ€ç¨‹åºæ— æ³•ç›´æ¥è®¿é—®è¿™äº›åœ°å€ï¼Œå› ä¸ºè¿™äº›å†…å­˜åŒºåŸŸè¢«æ“ä½œç³»ç»Ÿä¿ç•™ï¼Œä»¥é˜²æ­¢ä¸å—æ§åˆ¶çš„é”™è¯¯è®¿é—®å¯èƒ½å¼•å‘çš„å®‰å…¨é—®é¢˜æˆ–ç³»ç»Ÿå´©æºƒã€‚ ä¾‹å¦‚ï¼Œå†…æ ¸ç©ºé—´ä¸­çš„å†…å­˜å¯èƒ½è¢«ç”¨æ¥å­˜æ”¾è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCBï¼‰ã€ä¸­æ–­æè¿°ç¬¦è¡¨ï¼ˆIDTï¼‰ä»¥åŠè®¾å¤‡é©±åŠ¨ç¨‹åºç­‰ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªæ‰“å°æœºè¢«è¿æ¥åˆ°ç³»ç»Ÿæ—¶ï¼Œç›¸åº”çš„é©±åŠ¨ç¨‹åºä¼šå ç”¨å†…æ ¸ç©ºé—´ï¼Œä»¥å…è®¸æ“ä½œç³»ç»Ÿæ§åˆ¶æ‰“å°æœºæ‰“å°å‘½ä»¤ã€‚ ç”¨æˆ·ç©ºé—´å‰©ä¸‹çš„ 3GB åœ°å€ç©ºé—´ï¼Œä» 0x00000000 åˆ° 0xBFFFFFFFï¼Œè¢«åˆ†é…ç»™ç”¨æˆ·æ€åº”ç”¨ç¨‹åºã€‚ç”¨æˆ·æ€åº”ç”¨ç¨‹åºçš„ç»„æˆéƒ¨åˆ†ï¼ŒåŒ…æ‹¬ä»£ç æ®µã€æ•°æ®æ®µã€å †ä¸æ ˆï¼Œä»¥åŠåŠ¨æ€é“¾æ¥åº“ï¼ˆDLLï¼‰ï¼Œå‡ä½äºè¿™ä¸€éƒ¨åˆ†åœ°å€ç©ºé—´ã€‚ åœ¨è¿™ 3GB çš„ç”¨æˆ·ç©ºé—´ä¸­ï¼Œå†…å­˜åˆ†å¸ƒé€šå¸¸å¦‚ä¸‹æ‰€ç¤ºï¼š ä½åœ°å€+-----------------+| .text æ®µ | ä»£ç æ®µ: åŒ…å«åº”ç”¨ç¨‹åºçš„å¯æ‰§è¡Œä»£ç ã€‚é€šå¸¸ä»ä½åœ°å€å¼€å§‹åˆ†é…ï¼Œä¾¿äºæ“ä½œã€‚+-----------------+| .data æ®µ | æ•°æ®æ®µ: å­˜æ”¾å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œç¡®ä¿åœ¨ç¨‹åºè¿è¡Œæ—¶å¯ç”¨ã€‚+-----------------+| .bss æ®µ | åŒ…å«æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œæ‰§è¡Œå‰è‡ªåŠ¨æ¸…é›¶ã€‚+-----------------+| å † (heap) | å †: ç”¨æˆ·è‡ªå®šä¹‰ç©ºé—´ï¼Œç”¨äºåŠ¨æ€å†…å­˜åˆ†é…ï¼ˆå¦‚ mallocã€newï¼‰ï¼Œåœ¨ä½¿ç”¨åéœ€æ‰‹åŠ¨é‡Šæ”¾ã€‚||(å‘é«˜åœ°å€æ–¹å‘å¢é•¿)| å †ä¸€èˆ¬ä»æ•°æ®æ®µä¹‹åçš„åœ°å€å¼€å§‹ï¼Œå‘é«˜åœ°å€æ–¹å‘å¢é•¿ã€‚+-----------------+| || ç©ºé—²åŒºåŸŸ | åœ¨æ­¤åŒºåŸŸä¸­ï¼Œå…±äº«åº“ï¼ˆDLLsï¼‰è¢«æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œé€šå¸¸ä½äºå †å’Œæ ˆä¹‹é—´çš„æŸä¸ªä½ç½®ã€‚| |+-----------------+| æ ˆ (stack) | æ ˆ: å­˜å‚¨å±€éƒ¨å˜é‡å’Œå‡½æ•°è°ƒç”¨ç›¸å…³ä¿¡æ¯ï¼Œå±€éƒ¨å˜é‡åœ¨å‡½æ•°è¿”å›æ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚| | æ ˆä¸€èˆ¬ä»é«˜åœ°å€å¼€å§‹ï¼Œå‘ä½åœ°å€æ–¹å‘å¢é•¿ã€‚| (å‘ä½åœ°å€æ–¹å‘å¢é•¿)|+-----------------+é«˜åœ°å€ ä¸€ä¸ªå…¸å‹çš„ Linux C ç¨‹åºå†…å­˜ç©ºé—´é€šå¸¸åˆ†ä¸ºå‡ ä¸ªå…³é”®éƒ¨åˆ†ï¼š ä»£ç æ®µï¼ˆ.textï¼‰ï¼šæ­¤éƒ¨åˆ†å­˜æ”¾çš„æ˜¯ CPU è¦æ‰§è¡Œçš„æŒ‡ä»¤ã€‚ç”±äºä»£ç æ®µæ˜¯å¯å…±äº«çš„ï¼Œå› æ­¤ç›¸åŒçš„ä»£ç åœ¨å†…å­˜ä¸­åªä¼šæœ‰ä¸€ä»½æ‹·è´ã€‚æ­¤å¤–ï¼Œè¯¥æ®µé€šå¸¸æ˜¯åªè¯»çš„ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢ç¨‹åºå› æ„å¤–è€Œä¿®æ”¹è‡ªå·±çš„æŒ‡ä»¤ã€‚ åˆå§‹åŒ–æ•°æ®æ®µï¼ˆ.dataï¼‰ï¼šè¿™ä¸ªæ®µåŒ…å«ç¨‹åºä¸­éœ€è¦æ˜ç¡®èµ‹åˆå§‹å€¼çš„å˜é‡ã€‚æ¯”å¦‚ï¼Œå¦‚æœæœ‰å£°æ˜ä¸º int val = 100; çš„å…¨å±€å˜é‡ï¼Œé‚£ä¹ˆå®ƒçš„åœ°å€å°†æŒ‡å‘è¿™é‡Œã€‚ æœªåˆå§‹åŒ–æ•°æ®æ®µï¼ˆ.bssï¼‰ï¼šæ­¤åŒºåŸŸä¸­çš„æ•°æ®åœ¨ç¨‹åºæ‰§è¡Œå‰è¢«åˆå§‹åŒ–ä¸º 0 æˆ– nullã€‚ä¾‹å¦‚ï¼Œå…¨å±€å˜é‡ int sum; å°±ä¼šè¢«æ”¾ç½®åœ¨è¿™é‡Œã€‚ å †ï¼ˆHeapï¼‰ï¼šæ­¤æ®µç”¨äºåŠ¨æ€å†…å­˜åˆ†é…ã€‚é€šè¿‡è°ƒç”¨å¦‚ malloc æˆ– new å‡½æ•°ï¼Œç¨‹åºèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶è¯·æ±‚å†…å­˜ã€‚ æ ˆï¼ˆStackï¼‰ï¼šè¿™ä¸ªåŒºåŸŸç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡å’Œå‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶å˜é‡ã€‚å½“å‡½æ•°å®Œæˆæ‰§è¡Œæ—¶ï¼Œæ ˆç©ºé—´ä¼šè‡ªåŠ¨è¢«é‡Šæ”¾ã€‚ #include stdio.h#include stdlib.h#include string.h/*Cè¯­è¨€ä¸­æ•°æ®çš„å†…å­˜åˆ†é…*/int a = 0; // å…¨å±€å˜é‡ï¼Œä½äº.dataæ®µchar *p1;int main() int b; // å±€éƒ¨å˜é‡bï¼Œä½äºæ ˆä¸­ char s[] = abc; // æ•°ç»„så­˜æ”¾åœ¨æ ˆä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡abcåœ¨å¸¸é‡åŒº char *p2; // æŒ‡é’ˆp2åœ¨æ ˆä¸­ char *p3 = 123456; // å­—ç¬¦ä¸²å¸¸é‡123456åœ¨å¸¸é‡åŒºï¼Œp3æŒ‡å‘æ ˆä¸­ static int c = 0; // é™æ€å±€éƒ¨å˜é‡cï¼Œä½äº.dataæ®µ p1 = (char *)malloc(10); // ä»å †ä¸­åˆ†é…10ä¸ªå­—èŠ‚çš„ç©ºé—´ p2 = (char *)malloc(20); // ä»å †ä¸­åˆ†é…20ä¸ªå­—èŠ‚çš„ç©ºé—´ // ä»å¸¸é‡åŒºçš„Hello Worldå¤åˆ¶å­—ç¬¦ä¸²åˆ°å †ä¸­åˆ†é…çš„å†…å­˜ strcpy(p1, Hello World); free(p1); // ç¡®ä¿é‡Šæ”¾å †å†…å­˜ï¼Œé¿å…å†…å­˜æ³„æ¼ free(p2); // åŒæ ·é‡Šæ”¾p2æ‰€æŒ‡å‘çš„å †å†…å­˜ return 0; åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæ•´ä¸ªç¨‹åºå±•ç¤ºäº†å†…å­˜åˆ†é…çš„ä¸åŒåŒºåŸŸã€‚å±€éƒ¨å˜é‡å¦‚ b å’Œæ•°ç»„ s å­˜å‚¨äºæ ˆä¸­ï¼Œè€Œå…¨å±€å˜é‡å’ŒåŠ¨æ€åˆ†é…çš„å†…å­˜åˆ™å­˜æ”¾äºæ•°æ®æ®µå’Œå †ä¸­ã€‚è¿™æ ·çš„å†…å­˜ç®¡ç†ç­–ç•¥ä½¿å¾—ç¨‹åºåœ¨è¿è¡Œæ—¶èƒ½æœ‰æ•ˆåˆ©ç”¨å†…å­˜èµ„æºï¼ŒåŒæ—¶ä¿æŒé«˜æ•ˆç‡å’Œç¨³å®šæ€§ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç¨‹åº"]},{"title":"Linuxå‘½ä»¤","path":"/2024/05/03/1-å¹³å°ç³»ç»Ÿ-Linux-ç³»ç»Ÿå‚æ•°-Linuxå‘½ä»¤/","content":"è®¡ç®—æœºç¡¬ä»¶ï¼šè¿ç®—å™¨ï¼Œæ§åˆ¶å™¨ï¼Œå­˜å‚¨å™¨ï¼Œè¾“å…¥è¾“å‡ºè®¾å¤‡ç­‰å…±åŒç»„æˆçš„ ç³»ç»Ÿå†…æ ¸ï¼šè®©å„ç§ç¡¬ä»¶è®¾å¤‡å„å¸å…¶èŒä¸”åˆèƒ½ååŒè¿è¡Œ åµŒå…¥å¼å¼€å‘ä¸­å¸¸å¸¸éœ€è¦ç¡®è®¤å¼€å‘æ¿çš„ç³»ç»Ÿç‰ˆæœ¬ï¼ŒCPUï¼Œå„ç§å¤–éƒ¨è®¾å¤‡ï¼Œå†…å¯¸å ç”¨æƒ…å†µç­‰æ•°æ®ã€‚ ç»ˆç«¯ä¸€ä¸ªåŸºäºæ–‡æœ¬çš„äº¤äº’ç•Œé¢ å¿«æ·é”® æ‰“å¼€å‘½ä»¤è¡Œç»ˆç«¯ Ctrl+Alt+t æ”¾å¤§ç»ˆç«¯ Ctrl Shirft + ç¼©å°ç»ˆç«¯ Ctrl - ç»ˆç«¯æç¤ºç¬¦å«ä¹‰lemonade@ubuntu:~$ å¯¹åº”ç”¨æˆ·å (lemonade)@ä¸»æœºå (ubuntu): å·¥ä½œç›®å½• (~) æç¤ºç¬¦ ($) ~ï¼šå®¶ç›®å½• $: æ™®é€šç”¨æˆ·#: è¶…çº§ç”¨æˆ· (root) å‘½ä»¤â€” åœ¨ç»ˆç«¯ä¸­ç”¨äºå‘Šè¯‰è®¡ç®—æœºå»æ‰§è¡Œä¸€ä¸ªåŠ¨ä½œ å‚æ•°â€” é€‰é¡¹â€” é€‰é¡¹é€šå¸¸ç”¨ä¸€ä¸ªè¿æ¥å·ï¼ˆ-ï¼‰æˆ–ä¸¤ä¸ªè¿æ¥å·ï¼ˆ--ï¼‰æ¥åˆ’åˆ† å¸¸ç”¨ ls: åˆ—å‡ºå½“å‰ç›®å½•å†…å®¹ cd ~: è¿›å…¥å½“å‰ç”¨æˆ·çš„å®¶ç›®å½• ./ å½“å‰ç›®å½• (å¯çœç•¥) ../ ä¸Šä¸€å±‚ç›®å½• ../../ ä¸Šä¸€å±‚çš„ä¸Šä¸€å±‚ æ–‡ä»¶æ“ä½œæŒ‡ä»¤ mkdir åˆ›å»ºæ–‡ä»¶å¤¹ mkdir mydir touch åˆ›å»ºç©ºæ–‡ä»¶ touch myfile rmdir åˆ é™¤ä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ rm åˆ é™¤ä¸€ä¸ªæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹,é»˜è®¤åˆ é™¤æ–‡ä»¶ rm -r åˆ é™¤æ–‡ä»¶å¤¹ æ‰“å°å®šå‘æŒ‡ä»¤ echo æ‰“å°ä¸€ä¸²å­—ç¬¦ echo hello world è¾“å‡ºé‡å®šå‘æŒ‡å®šè¾“å‡ºçš„ç›®æ ‡æ–‡ä»¶ å‘æŒ‡å®šæ–‡ä»¶ä¸­è¿½åŠ å†…å®¹ cat è¯»æ–‡ä»¶å†…å®¹å¹¶æ‰“å° cat readme rootsudo sudo passwd é€šè¿‡æ™®é€šç”¨æˆ·ä¿®æ”¹è¶…çº§ç”¨æˆ· (root) çš„å¯†ç . su root åˆ‡æ¢ç”¨æˆ·ä¸º root ç”¨æˆ· (è¶…çº§ç”¨æˆ·) su lemonade åˆ‡æ¢ä¸º lemonade ç”¨æˆ·. sudo ç”¨æ™®é€šç”¨æˆ·æƒé™æ‰§è¡Œ root çš„åŠŸèƒ½ æ™®é€šç”¨æˆ·æƒé™æ‰§è¡Œ root çš„åŠŸèƒ½éœ€æ³¨æ„ç”¨æˆ·ç¯å¢ƒä¸‹çš„ç¯å¢ƒå˜é‡å’Œ root ç”¨æˆ·ç¯å¢ƒçš„ä¸‹ç¯å¢ƒå˜é‡æ˜¯å¦ä¸€è‡´ ç§»åŠ¨æ‹·è´æŒ‡ä»¤ mv ç§»åŠ¨å‘½ä»¤ mv source dest``mv source dir cp æ‹·è´å‘½ä»¤ man ç”¨æˆ·å¸®åŠ©æ‰‹å†Œ man ls ls [options]... [file]... options é€‰é¡¹æˆ–å‚æ•° file ç›®æ ‡æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ [] å¯é€‰æ ‡å¿— ... å¤šå‚æœºåˆ¶ æ”¹å˜æƒå€¼çš„å‘½ä»¤ chmod 777 readme.sh æ‰€æœ‰ç”¨æˆ·å¯è¯»å¯å†™å¯æ‰§è¡Œ æ–‡ä»¶ç±»å‹: - ï¼šæ™®é€šæ–‡ä»¶d : æ–‡ä»¶å¤¹ç›®å½•l : é“¾æ¥ (å¿«æ·æ–¹å¼)s : ç½‘ç»œå¥—æ¥å­—p: ç®¡é“b : å—è®¾å¤‡, ç£ç›˜ c : å­—ç¬¦è®¾å¤‡, é”®ç›˜ å…³æœº halt å…³æœº reboot é‡å¯ sudo shutdown -h now åŠ ä¸Šå…³æœºæ—¶é—´ sudo shutdown -h +1 See You la la åŠ ä¸Šå…³æœºå¤‡æ³¨ shell å‘½ä»¤å‚æ•°å¯ä»¥ç”¨é•¿æ ¼å¼ï¼ˆå®Œæ•´çš„é€‰é¡¹åç§°ï¼‰man --helpï¼Œä¹Ÿå¯ä»¥ç”¨çŸ­æ ¼å¼ï¼ˆå•ä¸ªå­—æ¯çš„ç¼©å†™ï¼‰man -hï¼Œåˆ†åˆ«ç”¨ -- ä¸ - ä½œä¸ºå‰ç¼€ã€‚ ç³»ç»Ÿå·¥ä½œå‘½ä»¤echo å‘½ä»¤ç”¨äºåœ¨ç»ˆç«¯è¾“å‡ºå­—ç¬¦ä¸²æˆ–å˜é‡æå–åçš„å€¼ï¼Œæ ¼å¼ä¸ºâ€echo [å­—ç¬¦ä¸² | $å˜é‡]â€ã€‚ date å‘½ä»¤ç”¨äºæ˜¾ç¤ºåŠè®¾ç½®ç³»ç»Ÿçš„æ—¶é—´æˆ–æ—¥æœŸï¼Œæ ¼å¼ä¸ºâ€date [é€‰é¡¹] [+æŒ‡å®šçš„æ ¼å¼]â€ã€‚ poweroff wget å‘½ä»¤ç”¨äºåœ¨ç»ˆç«¯ä¸­ä¸‹è½½ç½‘ç»œæ–‡ä»¶ï¼Œæ ¼å¼ä¸ºâ€wget [å‚æ•°] ä¸‹è½½åœ°å€â€ã€‚ ps å‘½ä»¤ç”¨äºæŸ¥çœ‹ç³»ç»Ÿä¸­çš„è¿›ç¨‹çŠ¶æ€ï¼Œæ ¼å¼ä¸ºâ€ps [å‚æ•°]â€ã€‚ -b åå°ä¸‹è½½æ¨¡å¼ -P ä¸‹è½½åˆ°æŒ‡å®šç›®å½• -t æœ€å¤§å°è¯•æ¬¡æ•° -c æ–­ç‚¹ç»­ä¼  -p ä¸‹è½½é¡µé¢å†…æ‰€æœ‰èµ„æºï¼ŒåŒ…æ‹¬å›¾ç‰‡ã€è§†é¢‘ç­‰ -r é€’å½’ä¸‹è½½ -a æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ï¼ˆåŒ…æ‹¬å…¶ä»–ç”¨æˆ·çš„è¿›ç¨‹ï¼‰ -u ç”¨æˆ·ä»¥åŠå…¶ä»–è¯¦ç»†ä¿¡æ¯ -x æ˜¾ç¤ºæ²¡æœ‰æ§åˆ¶ç»ˆç«¯çš„è¿›ç¨‹ |USER|PID |%CPU| %MEM|VSZ |RSS |TTY| STAT| START| TIME |COMMAND||è¿›ç¨‹çš„æ‰€æœ‰è€…|è¿›ç¨‹ ID å·|è¿ç®—å™¨å ç”¨ç‡|å†…å­˜å ç”¨ç‡|è™šæ‹Ÿå†…å­˜ä½¿ç”¨é‡(å•ä½æ˜¯ KB)|å ç”¨çš„å›ºå®šå†…å­˜é‡(å•ä½æ˜¯ KB)|æ‰€åœ¨ç»ˆç«¯|è¿›ç¨‹çŠ¶æ€|è¢«å¯åŠ¨çš„æ—¶é—´|å®é™…ä½¿ç”¨ CPU çš„æ—¶é—´|å‘½ä»¤åç§°ä¸å‚æ•°| top å‘½ä»¤ç”¨äºåŠ¨æ€åœ°ç›‘è§†è¿›ç¨‹æ´»åŠ¨ä¸ç³»ç»Ÿè´Ÿè½½ç­‰ä¿¡æ¯ï¼Œå…¶æ ¼å¼ä¸º topã€‚ ç¬¬ 1 è¡Œï¼šç³»ç»Ÿæ—¶é—´ã€è¿è¡Œæ—¶é—´ã€ç™»å½•ç»ˆç«¯æ•°ã€ç³»ç»Ÿè´Ÿè½½ï¼ˆä¸‰ä¸ªæ•°å€¼åˆ†åˆ«ä¸º 1 åˆ†é’Ÿã€5 åˆ†é’Ÿã€15 åˆ†é’Ÿå†…çš„å¹³å‡å€¼ï¼Œæ•°å€¼è¶Šå°æ„å‘³ç€è´Ÿè½½è¶Šä½ï¼‰ã€‚ ç¬¬ 2 è¡Œï¼šè¿›ç¨‹æ€»æ•°ã€è¿è¡Œä¸­çš„è¿›ç¨‹æ•°ã€ç¡çœ ä¸­çš„è¿›ç¨‹æ•°ã€åœæ­¢çš„è¿›ç¨‹æ•°ã€åƒµæ­»çš„è¿›ç¨‹æ•°ã€‚ ç¬¬ 3 è¡Œï¼šç”¨æˆ·å ç”¨èµ„æºç™¾åˆ†æ¯”ã€ç³»ç»Ÿå†…æ ¸å ç”¨èµ„æºç™¾åˆ†æ¯”ã€æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹èµ„æºç™¾åˆ†æ¯”ã€ç©ºé—²çš„èµ„æºç™¾åˆ†æ¯”ç­‰ã€‚å…¶ä¸­æ•°æ®å‡ä¸º CPU æ•°æ®å¹¶ä»¥ç™¾åˆ†æ¯”æ ¼å¼æ˜¾ç¤ºï¼Œä¾‹å¦‚â€97.1 idâ€æ„å‘³ç€æœ‰ 97.1%çš„ CPU å¤„ç†å™¨èµ„æºå¤„äºç©ºé—²ã€‚ ç¬¬ 4 è¡Œï¼šç‰©ç†å†…å­˜æ€»é‡ã€å†…å­˜ä½¿ç”¨é‡ã€å†…å­˜ç©ºé—²é‡ã€ä½œä¸ºå†…æ ¸ç¼“å­˜çš„å†…å­˜é‡ã€‚ ç¬¬ 5 è¡Œï¼šè™šæ‹Ÿå†…å­˜æ€»é‡ã€è™šæ‹Ÿå†…å­˜ä½¿ç”¨é‡ã€è™šæ‹Ÿå†…å­˜ç©ºé—²é‡ã€å·²è¢«æå‰åŠ è½½çš„å†…å­˜é‡ã€‚ pidof å‘½ä»¤ç”¨äºæŸ¥è¯¢æŸä¸ªæŒ‡å®šæœåŠ¡è¿›ç¨‹çš„ PID å€¼ï¼Œæ ¼å¼ä¸ºâ€pidof [å‚æ•°] [æœåŠ¡åç§°]â€ã€‚ kill å‘½ä»¤ç”¨äºç»ˆæ­¢æŸä¸ªæŒ‡å®š PID çš„æœåŠ¡è¿›ç¨‹ï¼Œæ ¼å¼ä¸ºâ€kill [å‚æ•°] [è¿›ç¨‹ PID]â€ã€‚ killall å‘½ä»¤ç”¨äºç»ˆæ­¢æŸä¸ªæŒ‡å®šåç§°çš„æœåŠ¡æ‰€å¯¹åº”çš„å…¨éƒ¨è¿›ç¨‹ï¼Œæ ¼å¼ä¸ºï¼šâ€killall [å‚æ•°] [æœåŠ¡åç§°]â€ã€‚ ç³»ç»ŸçŠ¶æ€æ£€æµ‹å‘½ä»¤ifconfig å‘½ä»¤ç”¨äºè·å–ç½‘å¡é…ç½®ä¸ç½‘ç»œçŠ¶æ€ç­‰ä¿¡æ¯ï¼Œæ ¼å¼ä¸ºâ€ifconfig [ç½‘ç»œè®¾å¤‡] [å‚æ•°]â€ã€‚ uname å‘½ä»¤ç”¨äºæŸ¥çœ‹ç³»ç»Ÿå†…æ ¸ä¸ç³»ç»Ÿç‰ˆæœ¬ç­‰ä¿¡æ¯ï¼Œæ ¼å¼ä¸ºâ€uname [-a]â€ã€‚ uptime ç”¨äºæŸ¥çœ‹ç³»ç»Ÿçš„è´Ÿè½½ä¿¡æ¯ï¼Œæ ¼å¼ä¸º uptimeã€‚ free ç”¨äºæ˜¾ç¤ºå½“å‰ç³»ç»Ÿä¸­å†…å­˜çš„ä½¿ç”¨é‡ä¿¡æ¯ï¼Œæ ¼å¼ä¸ºâ€free [-h]â€ã€‚ who ç”¨äºæŸ¥çœ‹å½“å‰ç™»å…¥ä¸»æœºçš„ç”¨æˆ·ç»ˆç«¯ä¿¡æ¯ï¼Œæ ¼å¼ä¸ºâ€who [å‚æ•°]â€ã€‚ last å‘½ä»¤ç”¨äºæŸ¥çœ‹æ‰€æœ‰ç³»ç»Ÿçš„ç™»å½•è®°å½•ï¼Œæ ¼å¼ä¸ºâ€last [å‚æ•°]â€ã€‚ history å‘½ä»¤ç”¨äºæ˜¾ç¤ºå†å²æ‰§è¡Œè¿‡çš„å‘½ä»¤ï¼Œæ ¼å¼ä¸ºâ€history [-c]â€ã€‚ï¼ˆç”¨â€!æ•°å­—â€çš„å‘½ä»¤æ ¼å¼é‡å¤æ‰§è¡ŒæŸä¸€æ¬¡çš„å‘½ä»¤è®°å½•ï¼‰ sosreport å‘½ä»¤ç”¨äºæ”¶é›†ç³»ç»Ÿé…ç½®åŠæ¶æ„ä¿¡æ¯å¹¶è¾“å‡ºè¯Šæ–­æ–‡æ¡£ï¼Œæ ¼å¼ä¸º sosreportã€‚ å·¥ä½œç›®å½•åˆ‡æ¢å‘½ä»¤pwd å‘½ä»¤ç”¨äºæ˜¾ç¤ºç”¨æˆ·å½“å‰æ‰€å¤„çš„å·¥ä½œç›®å½•ï¼Œæ ¼å¼ä¸ºâ€pwd [é€‰é¡¹]â€ã€‚ cd å‘½ä»¤ç”¨äºåˆ‡æ¢å·¥ä½œè·¯å¾„ï¼Œæ ¼å¼ä¸ºâ€cd [ç›®å½•åç§°]â€ã€‚ ls å‘½ä»¤ç”¨äºæ˜¾ç¤ºç›®å½•ä¸­çš„æ–‡ä»¶ä¿¡æ¯ï¼Œæ ¼å¼ä¸ºâ€ls [é€‰é¡¹] [æ–‡ä»¶] â€œã€‚ æ–‡æœ¬æ–‡ä»¶ç¼–è¾‘å‘½ä»¤cat å‘½ä»¤ç”¨äºæŸ¥çœ‹çº¯æ–‡æœ¬æ–‡ä»¶ï¼ˆå†…å®¹è¾ƒå°‘çš„ï¼‰ï¼Œæ ¼å¼ä¸ºâ€cat [é€‰é¡¹] [æ–‡ä»¶]â€ã€‚ï¼ˆ-n æ˜¾ç¤ºè¡Œå·ï¼‰ more å‘½ä»¤ç”¨äºæŸ¥çœ‹çº¯æ–‡æœ¬æ–‡ä»¶ï¼ˆå†…å®¹è¾ƒå¤šçš„ï¼‰ï¼Œæ ¼å¼ä¸ºâ€more [é€‰é¡¹]æ–‡ä»¶â€ã€‚ head å‘½ä»¤ç”¨äºæŸ¥çœ‹çº¯æ–‡æœ¬æ–‡æ¡£çš„å‰ N è¡Œï¼Œæ ¼å¼ä¸ºâ€head [é€‰é¡¹] [æ–‡ä»¶]â€ã€‚ tail å‘½ä»¤ç”¨äºæŸ¥çœ‹çº¯æ–‡æœ¬æ–‡æ¡£çš„å N è¡Œæˆ–æŒç»­åˆ·æ–°å†…å®¹ï¼Œæ ¼å¼ä¸ºâ€tail [é€‰é¡¹] [æ–‡ä»¶]â€ã€‚ tr å‘½ä»¤ç”¨äºæ›¿æ¢æ–‡æœ¬æ–‡ä»¶ä¸­çš„å­—ç¬¦ï¼Œæ ¼å¼ä¸ºâ€tr [åŸå§‹å­—ç¬¦] [ç›®æ ‡å­—ç¬¦]â€ã€‚ï¼ˆcat a.txt | tr [a-z] [A-Z]ï¼‰ wc å‘½ä»¤ç”¨äºç»Ÿè®¡æŒ‡å®šæ–‡æœ¬çš„è¡Œæ•°ã€å­—æ•°ã€å­—èŠ‚æ•°ï¼Œæ ¼å¼ä¸ºâ€wc [å‚æ•°] æ–‡æœ¬â€ã€‚(-l è¡Œæ•°-w å•è¯æ•°-c å­—èŠ‚æ•°) stat å‘½ä»¤ç”¨äºæŸ¥çœ‹æ–‡ä»¶çš„å…·ä½“å­˜å‚¨ä¿¡æ¯å’Œæ—¶é—´ç­‰ä¿¡æ¯ï¼Œæ ¼å¼ä¸ºâ€stat æ–‡ä»¶åç§°â€ã€‚ cut å‘½ä»¤ç”¨äºæŒ‰â€åˆ—â€æå–æ–‡æœ¬å­—ç¬¦ï¼Œæ ¼å¼ä¸ºâ€cut [å‚æ•°] æ–‡æœ¬â€ã€‚ diff å‘½ä»¤ç”¨äºæ¯”è¾ƒå¤šä¸ªæ–‡æœ¬æ–‡ä»¶çš„å·®å¼‚ï¼Œæ ¼å¼ä¸ºâ€diff [å‚æ•°] æ–‡ä»¶â€ã€‚ï¼ˆâ€“brief ç¡®è®¤ä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦ä¸åŒï¼Œ-c æ¯”è¾ƒå·®å¼‚ä¹‹å¤„ï¼‰ æ–‡ä»¶ç›®å½•ç®¡ç†å‘½ä»¤touch å‘½ä»¤ç”¨äºåˆ›å»ºç©ºç™½æ–‡ä»¶æˆ–è®¾ç½®æ–‡ä»¶çš„æ—¶é—´ï¼Œæ ¼å¼ä¸ºâ€touch [é€‰é¡¹] [æ–‡ä»¶]â€ã€‚ -a ä»…ä¿®æ”¹â€è¯»å–æ—¶é—´â€ï¼ˆatimeï¼‰-m ä»…ä¿®æ”¹â€ä¿®æ”¹æ—¶é—´â€ï¼ˆmtimeï¼‰-d åŒæ—¶ä¿®æ”¹ atime ä¸ mtime mkdir å‘½ä»¤ç”¨äºåˆ›å»ºç©ºç™½çš„ç›®å½•ï¼Œæ ¼å¼ä¸ºâ€mkdir [é€‰é¡¹] ç›®å½•â€ã€‚ cp å‘½ä»¤ç”¨äºå¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ï¼Œæ ¼å¼ä¸ºâ€cp [é€‰é¡¹] æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶â€ã€‚ mv å‘½ä»¤ç”¨äºå‰ªåˆ‡æ–‡ä»¶æˆ–å°†æ–‡ä»¶é‡å‘½åï¼Œæ ¼å¼ä¸ºâ€mv [é€‰é¡¹] æºæ–‡ä»¶ [ç›®æ ‡è·¯å¾„|ç›®æ ‡æ–‡ä»¶å]â€ã€‚ rm å‘½ä»¤ç”¨äºåˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ï¼Œæ ¼å¼ä¸ºâ€rm [é€‰é¡¹] æ–‡ä»¶â€ã€‚ dd å‘½ä»¤ç”¨äºæŒ‰ç…§æŒ‡å®šå¤§å°å’Œä¸ªæ•°çš„æ•°æ®å—æ¥å¤åˆ¶æ–‡ä»¶æˆ–è½¬æ¢æ–‡ä»¶ï¼Œæ ¼å¼ä¸ºâ€dd [å‚æ•°]â€ã€‚ ï¼ˆdd if=/dev/zero of=560_file count=1 bs=560Mï¼‰ï¼ˆdd if=/dev/cdrom of=RHEL-server-7.0-x86_64-LinuxProbe.Com.isoï¼‰ if è¾“å…¥çš„æ–‡ä»¶åç§° of è¾“å‡ºçš„æ–‡ä»¶åç§° bs è®¾ç½®æ¯ä¸ªâ€å—â€çš„å¤§å° count è®¾ç½®è¦å¤åˆ¶â€å—â€çš„ä¸ªæ•° file å‘½ä»¤ç”¨äºæŸ¥çœ‹æ–‡ä»¶çš„ç±»å‹ï¼Œæ ¼å¼ä¸ºâ€file æ–‡ä»¶åâ€ã€‚ æ‰“åŒ…å‹ç¼©ä¸æœç´¢å‘½ä»¤tar å‘½ä»¤ç”¨äºå¯¹æ–‡ä»¶è¿›è¡Œæ‰“åŒ…å‹ç¼©æˆ–è§£å‹ï¼Œæ ¼å¼ä¸ºâ€tar [é€‰é¡¹] [æ–‡ä»¶]â€ -c åˆ›å»ºå‹ç¼©æ–‡ä»¶ -x è§£å¼€å‹ç¼©æ–‡ä»¶ -t æŸ¥çœ‹å‹ç¼©åŒ…å†…æœ‰å“ªäº›æ–‡ä»¶ -z ç”¨ Gzip å‹ç¼©æˆ–è§£å‹ -j ç”¨ bzip2 å‹ç¼©æˆ–è§£å‹ -v æ˜¾ç¤ºå‹ç¼©æˆ–è§£å‹çš„è¿‡ç¨‹ -f ç›®æ ‡æ–‡ä»¶å -p ä¿ç•™åŸå§‹çš„æƒé™ä¸å±æ€§ -P ä½¿ç”¨ç»å¯¹è·¯å¾„æ¥å‹ç¼© -C æŒ‡å®šè§£å‹åˆ°çš„ç›®å½• grep å‘½ä»¤ç”¨äºåœ¨æ–‡æœ¬ä¸­æ‰§è¡Œå…³é”®è¯æœç´¢ï¼Œå¹¶æ˜¾ç¤ºåŒ¹é…çš„ç»“æœï¼Œæ ¼å¼ä¸ºâ€grep [é€‰é¡¹] [æ–‡ä»¶]â€ã€‚ -b å°†å¯æ‰§è¡Œæ–‡ä»¶(binary)å½“ä½œæ–‡æœ¬æ–‡ä»¶ï¼ˆtextï¼‰æ¥æœç´¢ -c ä»…æ˜¾ç¤ºæ‰¾åˆ°çš„è¡Œæ•° -i å¿½ç•¥å¤§å°å†™ -n æ˜¾ç¤ºè¡Œå· -v åå‘é€‰æ‹©â€”â€”ä»…åˆ—å‡ºæ²¡æœ‰â€å…³é”®è¯â€çš„è¡Œã€‚ find å‘½ä»¤ç”¨äºæŒ‰ç…§æŒ‡å®šæ¡ä»¶æ¥æŸ¥æ‰¾æ–‡ä»¶ï¼Œæ ¼å¼ä¸ºâ€find [æŸ¥æ‰¾è·¯å¾„] å¯»æ‰¾æ¡ä»¶ æ“ä½œâ€ã€‚ -name åŒ¹é…åç§° -perm åŒ¹é…æƒé™ï¼ˆmode ä¸ºå®Œå…¨åŒ¹é…ï¼Œ-mode ä¸ºåŒ…å«å³å¯ï¼‰ -user åŒ¹é…æ‰€æœ‰è€… -group åŒ¹é…æ‰€æœ‰ç»„ -mtime -n +n åŒ¹é…ä¿®æ”¹å†…å®¹çš„æ—¶é—´ï¼ˆ-n æŒ‡ n å¤©ä»¥å†…ï¼Œ+n æŒ‡ n å¤©ä»¥å‰ï¼‰ -atime -n +n åŒ¹é…è®¿é—®æ–‡ä»¶çš„æ—¶é—´ï¼ˆ-n æŒ‡ n å¤©ä»¥å†…ï¼Œ+n æŒ‡ n å¤©ä»¥å‰ï¼‰ -ctime -n +n åŒ¹é…ä¿®æ”¹æ–‡ä»¶æƒé™çš„æ—¶é—´ï¼ˆ-n æŒ‡ n å¤©ä»¥å†…ï¼Œ+n æŒ‡ n å¤©ä»¥å‰ï¼‰ -nouser åŒ¹é…æ— æ‰€æœ‰è€…çš„æ–‡ä»¶ -nogroup åŒ¹é…æ— æ‰€æœ‰ç»„çš„æ–‡ä»¶ -newer f1 !f2 åŒ¹é…æ¯”æ–‡ä»¶ f1 æ–°ä½†æ¯” f2 æ—§çš„æ–‡ä»¶ -type bdcplf åŒ¹é…æ–‡ä»¶ç±»å‹ï¼ˆåé¢çš„å­—å¹•å­—æ¯ä¾æ¬¡è¡¨ç¤ºå—è®¾å¤‡ã€ç›®å½•ã€å­—ç¬¦è®¾å¤‡ã€ç®¡é“ã€é“¾æ¥æ–‡ä»¶ã€æ–‡æœ¬æ–‡ä»¶ï¼‰ -size åŒ¹é…æ–‡ä»¶çš„å¤§å°ï¼ˆ+50KB ä¸ºæŸ¥æ‰¾è¶…è¿‡ 50KB çš„æ–‡ä»¶ï¼Œè€Œ-50KB ä¸ºæŸ¥æ‰¾å°äº 50KB çš„æ–‡ä»¶ï¼‰ -prune å¿½ç•¥æŸä¸ªç›®å½• -exec â€¦â€¦ {}; åé¢å¯è·Ÿç”¨äºè¿›ä¸€æ­¥å¤„ç†æœç´¢ç»“æœçš„å‘½ä»¤ è¿›ç¨‹çŠ¶æ€ï¼š Rï¼ˆè¿è¡Œï¼‰ï¼šè¿›ç¨‹æ­£åœ¨è¿è¡Œæˆ–åœ¨è¿è¡Œé˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚ Sï¼ˆä¸­æ–­ï¼‰ï¼šè¿›ç¨‹å¤„äºä¼‘çœ ä¸­ï¼Œå½“æŸä¸ªæ¡ä»¶å½¢æˆåæˆ–è€…æ¥æ”¶åˆ°ä¿¡å·æ—¶ï¼Œåˆ™è„±ç¦»è¯¥ çŠ¶æ€ã€‚ Dï¼ˆä¸å¯ä¸­æ–­ï¼‰ï¼šè¿›ç¨‹ä¸å“åº”ç³»ç»Ÿå¼‚æ­¥ä¿¡å·ï¼Œå³ä¾¿ç”¨ kill å‘½ä»¤ä¹Ÿä¸èƒ½å°†å…¶ä¸­æ–­ã€‚ Zï¼ˆåƒµæ­»ï¼‰ï¼šè¿›ç¨‹å·²ç»ç»ˆæ­¢ï¼Œä½†è¿›ç¨‹æè¿°ç¬¦ä¾ç„¶å­˜åœ¨, ç›´åˆ°çˆ¶è¿›ç¨‹è°ƒç”¨ wait4()ç³»ç»Ÿå‡½æ•°åå°†è¿›ç¨‹é‡Šæ”¾ã€‚ Tï¼ˆåœæ­¢ï¼‰ï¼šè¿›ç¨‹æ”¶åˆ°åœæ­¢ä¿¡å·ååœæ­¢è¿è¡Œã€‚ ç®¡ç†å‘˜å£ä»¤ä¸¢å¤±è§£å†³åŠæ³• å¼€æœºä» LILO æˆ– GRUB ä¸­é€‰æ‹©è¿›å…¥å•ç”¨æˆ·æ¨¡å¼ï¼ˆè¿è¡Œçº§åˆ« 1ï¼‰ ä½¿ç”¨ passwd å‘½ä»¤ä¿®æ”¹ root å£ä»¤ é‡æ–°åˆ‡æ¢ä¸ºè¿è¡Œçº§åˆ« 3 æˆ– 5 sudo â€“s # åˆ‡æ¢åˆ° root ç”¨æˆ·ï¼Œä½†æ˜¯ä¸åˆ‡æ¢ç”¨æˆ·ç¯å¢ƒ æ“ä½œç³»ç»Ÿuname -a #æŸ¥çœ‹å†…æ ¸ head -n 1 /etc/issue #æŸ¥çœ‹æ“ä½œç³»ç»Ÿç‰ˆæœ¬ cat /proc/cpuinfo #æŸ¥çœ‹CPUä¿¡æ¯ hostname #æŸ¥çœ‹è®¡ç®—æœºå lspci -tv #åˆ—å‡ºæ‰€æœ‰PCIè®¾å¤‡ lsusb -tv #åˆ—å‡ºæ‰€æœ‰USBè®¾å¤‡ lsmod #åˆ—å‡ºåŠ è½½çš„å†…æ ¸æ¨¡å— env #æŸ¥çœ‹ç¯å¢ƒå˜é‡ èµ„æºfree -m #æŸ¥çœ‹å†…å­˜ä½¿ç”¨é‡å’Œäº¤æ¢åŒºä½¿ç”¨é‡ df -h #æŸ¥çœ‹å„åˆ†åŒºä½¿ç”¨æƒ…å†µ du -sh ç›®å½•å #æŸ¥çœ‹æŒ‡å®šç›®å½•çš„å¤§å° grep MemTotal /proc/meminfo #æŸ¥çœ‹å†…å­˜æ€»é‡ grep MemFree /proc/meminfo #æŸ¥çœ‹ç©ºé—²å†…å­˜é‡ uptime #æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œæ—¶é—´ã€ç”¨æˆ·æ•°ã€è´Ÿè½½ cat /proc/loadavg #æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½ ç£ç›˜å’Œåˆ†åŒºmount | column -t #æŸ¥çœ‹æŒ‚æ¥çš„åˆ†åŒºçŠ¶æ€ fdisk -l #æŸ¥çœ‹æ‰€æœ‰åˆ†åŒº swapon -s #æŸ¥çœ‹æ‰€æœ‰äº¤æ¢åˆ†åŒº hdparm -i /dev/hda #æŸ¥çœ‹ç£ç›˜å‚æ•°(ä»…é€‚ç”¨äºIDEè®¾å¤‡) dmesg | grep IDE #æŸ¥çœ‹å¯åŠ¨æ—¶IDEè®¾å¤‡æ£€æµ‹çŠ¶å†µ ç½‘ç»œifconfig #æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£çš„å±æ€§ iptables -L #æŸ¥çœ‹é˜²ç«å¢™è®¾ç½® route -n #æŸ¥çœ‹è·¯ç”±è¡¨ netstat -nltp #æŸ¥çœ‹æ‰€æœ‰ç›‘å¬ç«¯å£ netstat -antp #æŸ¥çœ‹æ‰€æœ‰å·²ç»å»ºç«‹çš„è¿æ¥ netstat -s #æŸ¥çœ‹ç½‘ç»œç»Ÿè®¡ä¿¡æ¯ tcpdump è¿›ç¨‹ps -aux # æ˜¾ç¤ºç¬é—´è¡Œç¨‹ (process) çš„åŠ¨æ€ ps -ef #æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹ top #å®æ—¶æ˜¾ç¤ºè¿›ç¨‹çŠ¶æ€ nice -n 1 ls # å°† ls çš„ä¼˜å…ˆåºåŠ  1 å¹¶æ‰§è¡Œ renice +1 987 -u daemon root -p 32 # å°†è¡Œç¨‹ id ä¸º 987 åŠ 32 çš„è¡Œç¨‹ä¸è¡Œç¨‹æ‹¥æœ‰è€…ä¸º daemon åŠ root çš„ä¼˜å…ˆåºå·ç åŠ  1 kill # é€å‡ºä¸€ä¸ªç‰¹å®šçš„ä¿¡å· (signal) ç»™è¡Œç¨‹ id ä¸º pid çš„è¡Œç¨‹æ ¹æ®è¯¥ä¿¡å·è€Œåšç‰¹å®šçš„åŠ¨ä½œ, è‹¥æ²¡æœ‰æŒ‡å®š, é¢„è®¾æ˜¯é€å‡ºç»ˆæ­¢ (TERM) çš„ä¿¡å· killall proc bg fg fg n pstree # å°†æ‰€æœ‰è¡Œç¨‹ (process) ä»¥æ ‘çŠ¶å›¾æ˜¾ç¤º skill # é€ä¸ªè®¯å·ç»™æ­£åœ¨æ‰§è¡Œçš„ç¨‹åº,é¢„è®¾çš„è®¯æ¯ä¸º TERM (ä¸­æ–­) ç”¨æˆ·w #æŸ¥çœ‹æ´»åŠ¨ç”¨æˆ· id ç”¨æˆ·å #æŸ¥çœ‹æŒ‡å®šç”¨æˆ·ä¿¡æ¯ last #æŸ¥çœ‹ç”¨æˆ·ç™»å½•æ—¥å¿— cut -d: -f1 /etc/passwd #æŸ¥çœ‹ç³»ç»Ÿæ‰€æœ‰ç”¨æˆ· cut -d: -f1 /etc/group #æŸ¥çœ‹ç³»ç»Ÿæ‰€æœ‰ç»„ crontab -l #æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„è®¡åˆ’ä»»åŠ¡ crontab 0 6-12/3 * 12 * /usr/bin/backup # åœ¨ 12 æœˆå†…, æ¯å¤©çš„æ—©ä¸Š 6 ç‚¹åˆ° 12 ç‚¹ä¸­,æ¯éš” 20 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ /usr/bin/backup at 5pm + 3 days /bin/ls # ä¸‰å¤©åçš„ä¸‹åˆ 5 ç‚¹æ‰§è¡Œ /bin/ls: login passwd æœåŠ¡chkconfig --list #åˆ—å‡ºæ‰€æœ‰ç³»ç»ŸæœåŠ¡ chkconfig --list | grep on #åˆ—å‡ºæ‰€æœ‰å¯åŠ¨çš„ç³»ç»ŸæœåŠ¡ ç¨‹åºrpm -qa #æŸ¥çœ‹æ‰€æœ‰å®‰è£…çš„è½¯ä»¶åŒ… æ–‡ä»¶å‘½ä»¤ls -alrtFR filename cut pwd mkdir/rmdir dir rm -rf dir cp -r dest source # å°†ç›®å½•ä¸‹ä¹‹æ¡£æ¡ˆäº¦çš†ä¾åºæ‹·è´è‡³ç›®çš„åœ° mv file1 file2 ln -s yy zz # å°†æ¡£æ¡ˆ yy äº§ç”Ÿä¸€ä¸ª symbolic link:zz ,ä¸åŠ sä¸ºç¡¬é“¾æ¥ touch filename #å°†æ¡£æ¡ˆçš„æ—¶å€™è®°å½•æ”¹ä¸ºç°åœ¨çš„æ—¶é—´ã€‚è‹¥æ¡£æ¡ˆä¸å­˜åœ¨,ç³»ç»Ÿä¼šå»ºç«‹æ–°çš„æ¡£æ¡ˆã€‚ cat file more -s testfile # é€é¡µæ˜¾ç¤º testfile ä¹‹æ¡£æ¡ˆå†…å®¹,å¦‚æœ‰è¿ç»­ä¸¤è¡Œä»¥ä¸Šç©ºç™½è¡Œåˆ™ä»¥ä¸€è¡Œç©ºç™½è¡Œæ˜¾ç¤ºã€‚ more +20 testfile # ä»ç¬¬ 20 è¡Œå¼€å§‹æ˜¾ç¤º testfile ä¹‹æ¡£æ¡ˆå†…å®¹ã€‚ less filename # æµè§ˆæ–‡å­—æ¡£æ¡ˆçš„å†…å®¹ head file tail file tail -f file cat # æŠŠæ¡£æ¡ˆä¸²è¿æ¥åä¼ åˆ°åŸºæœ¬è¾“å‡ºï¼ˆè¤å¹•æˆ–åŠ  fileName åˆ°å¦ä¸€ä¸ªæ¡£æ¡ˆï¼‰ diff -u a.patch oldfile newfile # å¯ä»¥å®Œæˆæ¯”è¾ƒåŠŸèƒ½ï¼Œç”Ÿæˆè¡¥ä¸æ–‡ä»¶ patch -i a.patch filname # å‘½ä»¤ç”¨äºæ‰“è¡¥ä¸ï¼Œè¡¥ä¸æ–‡ä»¶æ˜¯ä½¿ç”¨diffäº§ç”Ÿçš„ split -b 1m filename filename.dump. # å°†filenameåˆ†å‰²ä¸º1Må¤§å°ï¼Œåˆ†å‰²åçš„æ–‡ä»¶åä¸ºfilename.dump.aaï¼Œfilename.dump.ab... tr #æŒ‡ä»¤ä»æ ‡å‡†è¾“å…¥è®¾å¤‡è¯»å–æ•°æ®ï¼Œç»è¿‡å­—ç¬¦ä¸²è½¬è¯‘åï¼Œå°†ç»“æœè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ã€‚ SSHssh user@host ssh -p port user@host ssh-copy-id user@host å‹ç¼©tar cf file.tar files tar xf file.tar tar czf file.tar.gz files tar xzf file.tar.gz tar cjf file.tar.bz2 tar xjf file.tar.bz2 gzip file gzip -d file.gz compress -f source.dat # å°† source.dat å‹ç¼©æˆ source.dat.Zï¼Œè§£å‹-d tar cjf - logs/ | split -b 1m - logs.tar.bz2 # å°†ç›®å½•logsæ‰“åŒ…å‹ç¼©å¹¶åˆ†å‰²æˆå¤šä¸ª1Mçš„æ–‡ä»¶ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ cat logs.tar.bz2.a* | tar xj # åˆ†åŒ…è§£å‹ æ–‡ä»¶æƒé™chmod a+x filename # å¯¹æ–‡ä»¶å¢åŠ æƒé™ chown -R dirname # å¯¹ç›®å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ¡£æ¡ˆä¸å­ç›®å½•è¿›è¡Œç›¸åŒçš„æ‹¥æœ‰è€…å˜æ›´ æœç´¢grep pattern files grep -r pattern dir command | grep pattern find path -name filename* # åœ¨ path è·¯å¾„ä¸‹æŸ¥æ‰¾æ‰€æœ‰ä»¥ filename å¼€å¤´çš„æ–‡ä»¶ locate chdrv # å¯»æ‰¾æ‰€æœ‰å« chdrv çš„æ¡£æ¡ˆ expr #å­—ä¸²é•¿åº¦/ä»ä½ç½®å¤„æŠ“å–å­—ä¸²/å‡ºç°æ¬¡æ•° ç½‘ç»œping host whois domain dig domian dig -x host wget file wget -c file scp test.c root@192.168.7.1:/home/root\t# SCP æ‹·è´æ•°æ® ç³»ç»Ÿä¿¡æ¯date # æ˜¾ç¤ºæˆ–è®¾å®šç³»ç»Ÿçš„æ—¥æœŸä¸æ—¶é—´ cal # æ˜¾ç¤ºæœ¬æœˆçš„æœˆå† uptime # æ˜¾ç¤ºå¼€æœºæ—¶é—´ç­‰ä¿¡æ¯ who # æ˜¾ç¤ºç³»ç»Ÿä¸­æœ‰é‚£äº›ä½¿ç”¨è€…æ­£åœ¨ä¸Šé¢ whoami finger user cat /proc/cpuinfo cat /proc/meminfo man command free file [filename]\t# å¯æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶æ˜¯ ARM æ¶æ„è¿˜æ˜¯ X86 æ¶æ„ uname -a\t# æ˜¾ç¤ºç”µè„‘ä»¥åŠæ“ä½œç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯ df\t# æŸ¥çœ‹ç£ç›˜ mount\t# æŒ‚è½½ umount\t# å¸è½½ sync\t# å¸è½½ä¹‹å‰åŒæ­¥æ•°æ® cat /sys/kernel/debug/usb/devices\t# æŸ¥çœ‹ USB ç±»å‹ timeä½¿ç”¨æ–¹å¼ï¼š time [options] COMMAND [arguments] ä½¿ç”¨è¯´æ˜ï¼š time æŒ‡ä»¤çš„ç”¨é€”,åœ¨äºç­‰ç­‰ã€‚éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯,éƒ¨åˆ†èµ„è®¯åœ¨ Linux ä¸Šæ˜¾ç¤ºä¸å‡ºæ¥ã€‚è¿™æ˜¯å› ä¸ºåœ¨ Linux ä¸Šéƒ¨åˆ†èµ„æºçš„åˆ†é…å‡½å¼ä¸ time æŒ‡ä»¤æ‰€é¢„è®¾çš„æ–¹å¼å¹¶ä¸ç›¸åŒ,ä»¥è‡´äº time æŒ‡ä»¤æ— æ³•å–å¾—è¿™äº›èµ„æ–™ã€‚ -o or â€“outputFILE è®¾å®šç»“æœè¾“å‡ºæ¡£ã€‚è¿™ä¸ªé€‰é¡¹ä¼šå°† time çš„è¾“å‡ºå†™å…¥ æ‰€æŒ‡å®šçš„æ¡£æ¡ˆä¸­ã€‚å¦‚æœæ¡£æ¡ˆå·²ç»å­˜åœ¨,ç³»ç»Ÿå°†è¦†å†™å…¶å†…å®¹ã€‚ -a or â€“append é…åˆ -o ä½¿ç”¨,ä¼šå°†ç»“æœå†™åˆ°æ¡£æ¡ˆçš„æœ«ç«¯,è€Œä¸ä¼šè¦†ç›–æ‰åŸæ¥çš„å†…å®¹ã€‚ -f FORMAT or â€“formatFORMAT ä»¥ FORMAT å­—ä¸²è®¾å®šæ˜¾ç¤ºæ–¹å¼ã€‚å½“è¿™ä¸ªé€‰é¡¹æ²¡æœ‰è¢«è®¾å®šçš„æ—¶å€™,ä¼šç”¨ç³»ç»Ÿé¢„è®¾çš„æ ¼å¼ã€‚ä¸è¿‡å¯ä»¥ç”¨ç¯å¢ƒå˜æ•° time æ¥è®¾å®šè¿™ä¸ªæ ¼å¼,å¦‚æ­¤ä¸€æ¥å°±ä¸å¿…æ¯æ¬¡ç™»å…¥ç³»ç»Ÿéƒ½è¦è®¾å®šä¸€æ¬¡ã€‚ ä¸€èˆ¬è®¾å®šä¸Š,å¯ä»¥ç”¨ \\t è¡¨ç¤ºè·³æ ,æˆ–è€…æ˜¯ç”¨ è¡¨ç¤ºæ¢è¡Œã€‚ æ¯ä¸€é¡¹èµ„æ–™è¦ç”¨ % åšä¸ºå‰å¯¼ã€‚å¦‚æœè¦åœ¨å­—ä¸²ä¸­ä½¿ç”¨ç™¾åˆ†æ¯”ç¬¦å·,å°±ç”¨.ï¼ˆå­¦è¿‡ C è¯­è¨€çš„äººå¤§æ¦‚ä¼šè§‰å¾—å¾ˆç†Ÿæ‚‰ï¼‰ time æŒ‡ä»¤å¯ä»¥æ˜¾ç¤ºçš„èµ„æºæœ‰å››å¤§é¡¹,åˆ†åˆ«æ˜¯ï¼š Time resources Memory resources IO resources Command info è¯¦ç»†çš„å†…å®¹å¦‚ä¸‹ï¼š Time Resources E æ‰§è¡ŒæŒ‡ä»¤æ‰€èŠ±è´¹çš„æ—¶é—´,æ ¼å¼æ˜¯ï¼š[hour]:minute:secondã€‚è¯·æ³¨æ„è¿™ä¸ªæ•°å­—å¹¶ä¸ä»£è¡¨å®é™…çš„ CPU æ—¶é—´ã€‚ e æ‰§è¡ŒæŒ‡ä»¤æ‰€èŠ±è´¹çš„æ—¶é—´,å•ä½æ˜¯ç§’ã€‚è¯·æ³¨æ„è¿™ä¸ªæ•°å­—å¹¶ä¸ä»£è¡¨å®é™…çš„ CPU æ—¶é—´ã€‚ S æŒ‡ä»¤æ‰§è¡Œæ—¶åœ¨æ ¸å¿ƒæ¨¡å¼ï¼ˆkernel modeï¼‰æ‰€èŠ±è´¹çš„æ—¶é—´,å•ä½æ˜¯ç§’ã€‚ U æŒ‡ä»¤æ‰§è¡Œæ—¶åœ¨ä½¿ç”¨è€…æ¨¡å¼ï¼ˆuser modeï¼‰æ‰€èŠ±è´¹çš„æ—¶é—´,å•ä½æ˜¯ç§’ã€‚ P æ‰§è¡ŒæŒ‡ä»¤æ—¶ CPU çš„å ç”¨æ¯”ä¾‹ã€‚å…¶å®è¿™ä¸ªæ•°å­—å°±æ˜¯æ ¸å¿ƒæ¨¡å¼åŠ ä¸Šä½¿ç”¨è€…æ¨¡å¼çš„ CPU æ—¶é—´é™¤ä»¥æ€»æ—¶é—´ã€‚ Memory Resources M æ‰§è¡Œæ—¶æ‰€å ç”¨çš„å®ä½“è®°å¿†ä½“çš„æœ€å¤§å€¼ã€‚å•ä½æ˜¯ KB t æ‰§è¡Œæ—¶æ‰€å ç”¨çš„å®ä½“è®°å¿†ä½“çš„å¹³å‡å€¼,å•ä½æ˜¯ KB K æ‰§è¡Œç¨‹åºæ‰€å ç”¨çš„è®°å¿†ä½“æ€»é‡ï¼ˆstack+data+textï¼‰çš„å¹³å‡å¤§å°,å•ä½æ˜¯ KB D æ‰§è¡Œç¨‹åºçš„è‡ªæœ‰èµ„æ–™åŒºï¼ˆunshared data areaï¼‰çš„å¹³å‡å¤§å°,å•ä½æ˜¯ KB p æ‰§è¡Œç¨‹åºçš„è‡ªæœ‰å †å ï¼ˆunshared stackï¼‰çš„å¹³å‡å¤§å°,å•ä½æ˜¯ KB X æ‰§è¡Œç¨‹åºé—´å…±äº«å†…å®¹ï¼ˆshared textï¼‰çš„å¹³å‡å€¼,å•ä½æ˜¯ KB Z ç³»ç»Ÿè®°å¿†ä½“é¡µçš„å¤§å°,å•ä½æ˜¯ byteã€‚å¯¹åŒä¸€ä¸ªç³»ç»Ÿæ¥è¯´è¿™æ˜¯ä¸ªå¸¸æ•° IO Resources F æ­¤ç¨‹åºçš„ä¸»è¦è®°å¿†ä½“é¡µé”™è¯¯å‘ç”Ÿæ¬¡æ•°ã€‚æ‰€è°“çš„ä¸»è¦è®°å¿†ä½“é¡µé”™è¯¯æ˜¯æŒ‡æŸä¸€è®°å¿†ä½“é¡µå·²ç»ç½®æ¢åˆ°ç½®æ¢æ¡£ï¼ˆswap file)ä¸­,è€Œä¸”å·²ç»åˆ†é…ç»™å…¶ä»–ç¨‹åºã€‚æ­¤æ—¶è¯¥é¡µçš„å†…å®¹å¿…é¡»ä»ç½®æ¢æ¡£é‡Œå†è¯»å‡ºæ¥ã€‚ R æ­¤ç¨‹åºçš„æ¬¡è¦è®°å¿†ä½“é¡µé”™è¯¯å‘ç”Ÿæ¬¡æ•°ã€‚æ‰€è°“çš„æ¬¡è¦è®°å¿†ä½“é¡µé”™è¯¯æ˜¯æŒ‡æŸä¸€è®°å¿†ä½“é¡µè™½ç„¶å·²ç»ç½®æ¢åˆ°ç½®æ¢æ¡£ä¸­,ä½†å°šæœªåˆ†é…ç»™å…¶ä»–ç¨‹åºã€‚æ­¤æ—¶è¯¥é¡µçš„å†…å®¹å¹¶æœªè¢«ç ´å,ä¸å¿…ä»ç½®æ¢æ¡£é‡Œè¯»å‡ºæ¥ W æ­¤ç¨‹åºè¢«äº¤æ¢åˆ°ç½®æ¢æ¡£çš„æ¬¡æ•° c æ­¤ç¨‹åºè¢«å¼ºè¿«ä¸­æ–­ï¼ˆåƒæ˜¯åˆ†é…åˆ°çš„ CPU æ—¶é—´è€—å°½ï¼‰çš„æ¬¡æ•° w æ­¤ç¨‹åºè‡ªæ„¿ä¸­æ–­ï¼ˆåƒæ˜¯åœ¨ç­‰å¾…æŸä¸€ä¸ª I/O æ‰§è¡Œå®Œæ¯•,åƒæ˜¯ç£ç¢Ÿè¯»å–ç­‰ç­‰ï¼‰çš„æ¬¡æ•° I æ­¤ç¨‹åºæ‰€è¾“å…¥çš„æ¡£æ¡ˆæ•° O æ­¤ç¨‹åºæ‰€è¾“å‡ºçš„æ¡£æ¡ˆæ•° r æ­¤ç¨‹åºæ‰€æ”¶åˆ°çš„ Socket Message s æ­¤ç¨‹åºæ‰€é€å‡ºçš„ Socket Message k æ­¤ç¨‹åºæ‰€æ”¶åˆ°çš„ä¿¡å· ( Signal )æ•°é‡ Command Info C æ‰§è¡Œæ—¶çš„å‚æ•°ä»¥åŠæŒ‡ä»¤åç§° x æŒ‡ä»¤çš„ç»“æŸä»£ç  ( Exit Status ) -p or â€“portability è¿™ä¸ªé€‰é¡¹ä¼šè‡ªåŠ¨æŠŠæ˜¾ç¤ºæ ¼å¼è®¾å®šæˆä¸ºï¼š real %e user %U sys %S è¿™ä¹ˆåšçš„ç›®çš„æ˜¯ä¸ºäº†ä¸ POSIX è§„æ ¼ç›¸å®¹ã€‚ -v or â€“verbose è¿™ä¸ªé€‰é¡¹ä¼šæŠŠæ‰€æœ‰ç¨‹å¼ä¸­ç”¨åˆ°çš„èµ„æºé€šé€šåˆ—å‡ºæ¥,ä¸ä½†å¦‚ä¸€èˆ¬è‹±æ–‡è¯­å¥,è¿˜æœ‰è¯´æ˜ã€‚å¯¹ä¸æƒ³èŠ±æ—¶é—´å»ç†Ÿä¹ æ ¼å¼è®¾å®šæˆ–æ˜¯åˆšåˆšå¼€å§‹æ¥è§¦è¿™ä¸ªæŒ‡ä»¤çš„äººç›¸å½“æœ‰ç”¨ã€‚ èŒƒä¾‹ï¼š åˆ©ç”¨ä¸‹é¢çš„æŒ‡ä»¤ time -v ps -aux ä»¬å¯ä»¥è·å¾—æ‰§è¡Œ ps -aux çš„ç»“æœå’Œæ‰€èŠ±è´¹çš„ç³»ç»Ÿèµ„æºã€‚å¦‚ä¸‹é¢æ‰€åˆ—çš„èµ„æ–™ï¼š USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.0 0.4 1096 472 ? S Apr19 0:04 init root 2 0.0 0.0 0 0 ? SW Apr19 0:00 [kflushd] root 3 0.0 0.0 0 0 ? SW Apr19 0:00 [kpiod] ...... root 24269 0.0 1.0 2692 996 pts/3 R 12:16 0:00 ps -aux Command being timed: ps -aux User time (seconds): 0.05 System time (seconds): 0.06 Percent of CPU this job got: 68% Elapsed (wall clock) time (h:mm:ss or m:ss): 0:00.16 Average shared text size (kbytes): 0 Average unshared data size (kbytes): 0 Average stack size (kbytes): 0 Average total size (kbytes): 0 Maximum resident set size (kbytes): 0 Average resident set size (kbytes): 0 Major (requiring I/O) page faults: 238 Minor (reclaiming a frame) page faults: 46 Voluntary context switches: 0 Involuntary context switches: 0 Swaps: 0 File system inputs: 0 File system outputs: 0 Socket messages sent: 0 Socket messages received: 0 Signals delivered: 0 Page size (bytes): 4096 Exit status: 0 mailä½¿ç”¨æ–¹å¼ï¼š mail [-iInv] [-s subject] [-c cc-addr] [-b bcc-addr] user1 [user 2 ...] ä½¿ç”¨è¯´æ˜ï¼š mail ä¸ä»…åªæ˜¯ä¸€ä¸ªæŒ‡ä»¤, mail è¿˜æ˜¯ä¸€ä¸ªç”µå­é‚®ä»¶ç¨‹å¼,ä¸è¿‡åˆ©ç”¨ mail æ¥è¯»ä¿¡çš„äººåº”è¯¥å¾ˆå°‘å§ï¼å¯¹äºç³»ç»Ÿç®¡ç†è€…æ¥è¯´ mail å°±å¾ˆæœ‰ç”¨,å› ä¸ºç®¡ç†è€…å¯ä»¥ç”¨ mail å†™æˆ script ,å®šæœŸå¯„ä¸€äº›å¤‡å¿˜å½•æé†’ç³»ç»Ÿçš„ä½¿ç”¨è€…ã€‚ i å¿½ç•¥ tty çš„ä¸­æ–­è®¯å·ã€‚ (interrupt) I å¼ºè¿«è®¾æˆäº’åŠ¨æ¨¡å¼ã€‚ (Interactive) v åˆ—å°å‡ºè®¯æ¯,ä¾‹å¦‚é€ä¿¡çš„åœ°ç‚¹,çŠ¶æ€ç­‰ç­‰ã€‚ (verbose) n ä¸è¯»å…¥ mail.rc è®¾å®šæ¡£ã€‚ s é‚®ä»¶æ ‡é¢˜ã€‚ c cc é‚®ä»¶åœ°å€ã€‚ b bcc é‚®ä»¶åœ°å€ã€‚ èŒƒä¾‹ï¼š å°†ä¿¡ä»¶é€ç»™ä¸€ä¸ªæˆ–ä»¥ä¸Šçš„ç”µå­é‚®ä»¶åœ°å€,ç”±äºæ²¡æœ‰åŠ å…¥å…¶ä»–çš„é€‰é¡¹,ä½¿ç”¨è€…å¿…é¡»è¾“å…¥æ ‡é¢˜ä¸ä¿¡ä»¶çš„å†…å®¹ç­‰ã€‚è€Œ user2 æ²¡æœ‰ä¸»æœºä½ç½®,å°±ä¼šé€ç»™é‚®ä»¶ä¼ºæœå™¨çš„ user2 ä½¿ç”¨è€…ã€‚ mail user1@email.address mail user1@email.address user2 å°† mail.txt çš„å†…å®¹å¯„ç»™ user2 åŒæ—¶ cc ç»™ user1 ã€‚å¦‚æœå°†è¿™ä¸€è¡ŒæŒ‡ä»¤è®¾æˆ cronjob å°±å¯ä»¥å®šæ—¶å°†å¤‡å¿˜å½•å¯„ç»™ç³»ç»Ÿä½¿ç”¨è€…ã€‚ mail -s æ ‡é¢˜ -c user1 user2 mail.txt 1\tæ˜¾ç¤ºç›®å½•ä¿¡æ¯ #\tls\tls -a\tåˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä»¥.å¤´çš„éšå«æ–‡ä»¶ #\tls\tls -læˆ–ll\tåˆ—å‡ºå½“å‰ç›®å½•ä¸‹æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ #\tls\tls -a\tæ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…å«éšè—ã€‚ #\tls\tls -al\tæ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚\t2\tæŸ¥çœ‹è·¯å¾„ #\tpwd\tpwd\tæŸ¥çœ‹å½“å‰æ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯ç»\t3\tç›®å½•åˆ‡æ¢ #\tcd\tcd ..\tå›å½“å‰ç›®å½•çš„ä¸Šä¸€çº§ç›®å½• #\tcd\tcd -\tå›ä¸Šä¸€æ¬¡æ‰€åœ¨çš„ç›®å½• #\tcd\tcd -p aa/bb/cc\tç›´æ¥åˆ›å»ºå¤šçº§å­ç›®å½• #\tcd\tcd ~ æˆ– cd\tå›å½“å‰ç”¨æˆ·çš„å®¿ä¸»ç›®å½• #\tcd\tcd ~ç”¨æˆ·å\tå›æŒ‡å®šç”¨æˆ·çš„å®¿ä¸»ç›®å½•\t4\tåˆ›å»ºç›®å½• #\tmkdir\tmkdir ç›®å½•å\tåˆ›å»ºä¸€ä¸ªç›®å½• #\tmkdir\tmkdir â€“p\té€’å½’å¼å»åˆ›å»ºä¸€äº›åµŒå¥—ç›®å½• #\trmdir\tRmdir ç©ºç›®å½•å\tåˆ é™¤ä¸€ä¸ªç©ºç›®å½•\t5\tåˆ›å»ºæ–‡ä»¶ #\ttouch\ttouch 1.txt\tåˆ›å»ºæ–‡ä»¶1.txt\t6\tåˆ é™¤æ“ä½œ #\trm\trm æ–‡ä»¶å æ–‡ä»¶å\tåˆ é™¤ä¸€ä¸ªæ–‡ä»¶æˆ–å¤šä¸ªæ–‡ä»¶ #\trm\trm -rf éç©ºç›®å½•å\té€’å½’åˆ é™¤ä¸€ä¸ªéç©ºç›®å½•ä¸‹çš„ä¸€åˆ‡ï¼ŒåŠ -fä¸æç¤º\t7\tæŸ¥çœ‹æ–‡ä»¶ #\tcat\tcat æ–‡ä»¶å\tä¸€å±æŸ¥çœ‹æ–‡ä»¶å†…å®¹ #\tcat\tcat è·¯å¾„/æ–‡ä»¶å |grep å­—ç¬¦ä¸²\tåœ¨æ–‡ä»¶ä¸­åŒ¹é…å­—ç¬¦ä¸² #\tmore\tmore æ–‡ä»¶å\tåˆ†é¡µæŸ¥çœ‹æ–‡ä»¶å†…å®¹ #\tless\tless æ–‡ä»¶å\tå¯æ§åˆ†é¡µæŸ¥çœ‹æ–‡ä»¶å†…å®¹ #\tgrep\tgrepå­—ç¬¦ æ–‡ä»¶å\tæ ¹æ®å­—ç¬¦åŒ¹é…æ¥æŸ¥çœ‹æ–‡ä»¶éƒ¨åˆ†å†…å®¹ #\tfind\tfind è·¯å¾„ -name å­—ç¬¦ä¸²\tæŸ¥æ‰¾è·¯å¾„æ‰€åœ¨èŒƒå›´å†…æ»¡è¶³å­—ç¬¦ä¸²åŒ¹é…çš„æ–‡ä»¶å’Œç›®å½• #\tfile\tfile æ–‡ä»¶å\tæŸ¥çœ‹æ–‡ä»¶ç±»å‹ #\thead\thead -æ•°å­— æ–‡ä»¶å\tå¯ä»¥æŸ¥çœ‹å‰nè¡Œï¼Œä¸åŠ å‚æ•°ï¼Œé»˜è®¤ä¸º10. #\ttaill taill -æ•°å­— æ–‡ä»¶å\tå¯ä»¥æŸ¥çœ‹ånè¡Œï¼Œä¸åŠ å‚æ•°ï¼Œé»˜è®¤ä¸º10.\t8\tæŸ¥çœ‹å¸®åŠ© #\thelp cp\tæŸ¥çœ‹å†…éƒ¨å‘½ä»¤cp #\tls --help |less æŸ¥çœ‹å¤–éƒ¨å‘½ä»¤ï¼Œåˆ†å±æ˜¾ç¤º #\tman cd\tæŸ¥çœ‹cdå¸®åŠ©\tä¸åˆ†å†…éƒ¨ä¸å¤–éƒ¨å‘½ä»¤ #\tinfo ls æŸ¥çœ‹ ls ä¿¡æ¯ 9\tå¤åˆ¶æ–‡ä»¶ #\tcp\tcp /è·¯ç»/æ–‡ä»¶ ./\tç§»åŠ¨ç»å¯¹è·¯ç»ä¸‹çš„æ–‡ä»¶åˆ°å½“å‰ç›®å½•ä¸‹ #\tcp /dev/cdrom linux4.iso åœ¨å­—ç¬¦ç•Œé¢ä¸Šåˆ¶ä½œISOé•œåƒæ–‡ä»¶\t10\tç§»åŠ¨æ–‡ä»¶ #\tmv\tmv è·¯ç»/æ–‡ä»¶ /ç»/æ–‡ä»¶\tç§»åŠ¨ç›¸å¯¹è·¯ç»ä¸‹çš„æ–‡ä»¶åˆ°ç»å¯¹è·¯ç»ä¸‹ #\tmv\tmv æ–‡ä»¶å æ–°åç§°\tåœ¨å½“å‰ç›®å½•ä¸‹æ”¹å #\tmv\tmv a.txt b.txt\tæ›´æ”¹æ–‡ä»¶å #\tmv\tmv æ–‡ä»¶å è·¯å¾„\tç§»åŠ¨æ–‡ä»¶ #\tmv\tmv è·¯å¾„/æ–‡ä»¶å è·¯å¾„/æ–‡ä»¶å\tç§»åŠ¨å¹¶æ›´æ”¹æ–‡ä»¶å\t11\tç³»ç»Ÿç®¡ç† #\tdate\tdate æœˆæ—¥æ—¶åˆ†å¹´\tæ›´æ”¹è®¡ç®—æœºç³»ç»Ÿæ—¶é—´\t12\tæ–‡æœ¬ç¼–è¾‘ #\tgedit\tgedit æ–‡ä»¶å\tåœ¨å›¾å½¢ç•Œé¢ä¸‹å¯åŠ¨ç¼–è¾‘å™¨\t13\tviæ¨¡å¼é—´çš„åˆ‡æ¢ #\tvi\tvi tabåˆ‡æ¢å‘½ä»¤ä¸ç¼–è¾‘æ¨¡å¼\tæ‰“å¼€viç¼–è¾‘å™¨ :qé€€å‡ºç¼–è¾‘ç¯å¢ƒ #\tvi\ta ä»å‘½ä»¤è¿›å…¥è¾“å…¥æ¨¡å¼\tæŒ‰ESCä»è¾“å…¥æ¨¡å¼è¿›å…¥å‘½ä»¤æ¨¡å¼ã€‚\t14\tæ–‡æœ¬ç¼–è¾‘\tåœ¨å‘½ä»¤æ¨¡å¼ä¸‹ è¯»å–æ–‡ä»¶ :e æ–°æ–‡ä»¶å\tä¸€ä¸ªæ–‡ä»¶å®Œæˆåï¼Œæ‰“å¼€æ–°çš„æ–‡ä»¶ã€‚ :e! æ–°æ–‡ä»¶å\tå¼ºåˆ¶å…³é—­å½“å‰æ–‡ä»¶ï¼ˆä¸ä¿å­˜ï¼‰å¹¶æ‰“å¼€æ–°æ–‡ä»¶ :f æ–‡ä»¶å\tè¯»å–æŒ‡å®šæ–‡ä»¶ï¼Œå¹¶ç²˜è´´åˆ°å…‰æ ‡æ‰€åœ¨è¡Œä¸‹ :w ä¿å­˜å·²ç»å‘½åçš„æ–‡ä»¶ :w æ–‡ä»¶å\tä¿å­˜æœªå‘½åçš„æ–‡ä»¶ :w æ–‡ä»¶å\tå¦å­˜ä¸ºæ–‡ä»¶å :q é€€å‡º:qç¼–è¾‘å™¨ :wq\tä¿å­˜å¹¶é€€å‡º :q!\tä¸ä¿å­˜é€€å‡º h å…‰æ ‡å·¦ç§» l\tå…‰æ ‡å³ç§» k\tå…‰æ ‡ä¸Šç§» j\tå…‰æ ‡ä¸‹ç§»\t15\tæ–‡æœ¬ç¼–è¾‘\tåœ¨å‘½ä»¤æ¨¡å¼ä¸‹ å¿«é€Ÿåˆ‡æ¢ å¿«æ·é”®ctrl+F\tå‰ç¿»æ•´é¡µ å¿«æ·é”®ctrl+B\tåç¿»æ•´é¡µ å¿«æ·é”®ctrl+U\tå‰ç¿»åŠé¡µ å¿«æ·é”®ctrl+D\tåç¿»åŠé¡µ :set nu\tåœ¨ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºè¡Œå· :200\tç›´æ¥è¿›å…¥åˆ°ç¬¬200è¡Œ :$\tè¿›å…¥æœ€åä¸€è¡Œ\t16\tæ–‡æœ¬ç¼–è¾‘\tåœ¨å‘½ä»¤æ¨¡å¼ä¸‹ è¿›å…¥è¾“å…¥æ¨¡å¼ i\tåœ¨å½“å‰å…‰æ ‡å¤„è¿›å…¥æ’å…¥çŠ¶æ€ a åœ¨å½“å‰å…‰æ ‡åè¿›å…¥æ’å…¥çŠ¶æ€ A\tå°†å…‰æ ‡ç§»åŠ¨åˆ°å½“å‰è¡Œçš„è¡Œæœ«ï¼Œå¹¶è¿›å…¥æ’å…¥çŠ¶æ€ o\tåœ¨å½“å‰è¡Œçš„ä¸‹é¢æ’å…¥æ–°è¡Œï¼Œå¹¶è¿›å…¥æ’å…¥çŠ¶æ€ O\tåœ¨å½“å‰è¡Œçš„ä¸Šé¢æ’å…¥æ–°è¡Œï¼Œå¹¶è¿›å…¥æ’å…¥çŠ¶æ€\t17\tæ–‡æœ¬ç¼–è¾‘\tåœ¨å‘½ä»¤æ¨¡å¼ä¸‹ åˆ é™¤æ“ä½œ cw\tåˆ é™¤å½“å‰å…‰æ ‡æ‰€åœ¨å•è¯å°¾éƒ¨çš„å­—ç¬¦ï¼Œå¹¶è¿›å…¥æ’å…¥çŠ¶æ€ c$\tåˆ é™¤å½“å‰å…‰æ ‡åˆ°è¡Œå°¾çš„å­—ç¬¦ï¼Œå¹¶è¿›å…¥æ’å…¥çŠ¶æ€ c^\tåˆ é™¤å…‰æ ‡ä¹‹å‰åˆ°è¡Œé¦–çš„å­—ç¬¦ï¼Œå¹¶è¿›å…¥æ’å…¥çŠ¶æ€ 3x\tåˆ é™¤å½“å‰å…‰æ ‡å¤„å‘å³çš„3ä¸ªå­—ç¬¦ 3dd\tåˆ é™¤å½“å‰è¡Œå¼€å§‹å‘ä¸‹åˆ é™¤3è¡Œ 3dw\tåˆ é™¤å½“å‰å…‰æ ‡å‘å³çš„3ä¸ªå•è¯ 3de\tåˆ é™¤å½“å‰å…‰æ ‡å‘å³çš„3ä¸ªå•è¯ï¼Œä¿ç•™å³é¢çš„ç©ºæ ¼ d$\tåˆ é™¤å½“å‰å­—ç¬¦åˆ°è¡Œå°¾çš„æ‰€æœ‰å­—ç¬¦ d^\tåˆ é™¤å½“å‰å­—ç¬¦åˆ°è¡Œé¦–çš„æ‰€æœ‰å­—ç¬¦ J\tåˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œå°¾çš„æ¢è¡Œç¬¦ æ’¤é”€æ“ä½œ u\tå–æ¶ˆæœ€è¿‘çš„ä¸€æ¬¡æ“ä½œï¼Œå¹¶æ¢å¤æ“ä½œç»“æœ U\tå–æ¶ˆå½“å‰è¡Œè¿›è¡Œçš„æ‰€æœ‰æ“ä½œ å¿«æ·é”® Ctrl+R\tæ’¤é”€å‘½ä»¤uçš„å–æ¶ˆæ“ä½œ\t18\tæ–‡æœ¬ç¼–è¾‘\tå‘½ä»¤æ¨¡å¼ å¤åˆ¶æ“ä½œ 4yy\tå¤åˆ¶å½“å‰è¡ŒåŠåç»­å…±4è¡Œçš„æ–‡æœ¬å†…å®¹åˆ°viç¼“å†²åŒº 7yw\tå¤åˆ¶å½“å‰å…‰æ ‡å¼€å§‹çš„7ä¸ªå•è¯åˆ°viç¼“å†²åŒº y$\tå¤åˆ¶å½“å‰å…‰æ ‡åˆ°è¡Œå°¾çš„å†…å®¹åˆ°viç¼“å†²åŒº y^\tå¤åˆ¶å½“å‰å…‰æ ‡åˆ°è¡Œé¦–çš„å†…å®¹åˆ°viç¼“å†²åŒº :28,48y\tå¤åˆ¶ç¬¬28è¡Œåˆ°48è¡Œçš„å†…å®¹åˆ°viç¼“å†²åŒº ç²˜è´´æ“ä½œ p\tç²˜è´´ç¼“å†²åŒºå†…å®¹åˆ°å½“å‰å…‰æ ‡å¤„ï¼Œä¸è¦†ç›–æ–‡ä»¶å·²æœ‰å†…å®¹\t19\tæ–‡æœ¬ç¼–è¾‘ æŸ¥æ‰¾æ“ä½œ /å­—ç¬¦ä¸²\tä»å½“å‰å…‰æ ‡å¤„å¼€å§‹å‘ä¸‹æŸ¥æ‰¾æŒ‡å®šå­—ç¬¦ä¸² nä¸‹ Nä¸Š ?å­—ç¬¦ä¸²\tä»å½“å‰å…‰æ ‡å¤„å¼€å§‹å‘ä¸ŠæŸ¥æ‰¾æŒ‡å®šå­—ç¬¦ä¸² nä¸‹ Nä¸Š\t20\tæ–‡æœ¬ç¼–è¾‘\tå‘½ä»¤æ¨¡å¼ æ›¿æ¢æ“ä½œ :s/old/new\tåœ¨å½“å‰æŸ¥æ‰¾oldæ›¿æ¢æˆnew.åªæ›¿æ¢å½“å‰è¡Œä¸­ç¬¬ä¸€ä¸ª :s/old/new/g\tæ›¿æ¢è¡Œä¸­æ‰€æœ‰oldå­—ç¬¦ä¸²ä¸ºnew :3,9s/old/new/g\tæ›¿æ¢3-9è¡Œå†…æ‰€æœ‰oldå­—ç¬¦ä¸²ä¸ºnew :%s/old/new/g\tæ›¿æ¢å…¨æ–‡ä¸­æ‰€æœ‰oldå­—ç¬¦ä¸²ä¸ºnew æœ«å°¾åŠ ä¸Šå‚æ•°cå¯å¼ºåˆ¶æ¯ä¸ªæ›¿æ¢éƒ½éœ€è¦è¿›è¡Œç¡®è®¤ã€‚ /new/c /gc (yã€nã€aã€q)\t21\tæ–‡æœ¬ç¼–è¾‘ #åŒæ—¶å¯åŠ¨å¤šä¸ªæ–‡ä»¶\tvi a.txt b.txt c.txt\tåŒæ—¶å¯åŠ¨a.txt b.txt c.txt vi -o a.txt b.txt c.txt\tæ°´å¹³æ˜¾ç¤ºå„ä¸ªæ–‡ä»¶ vi -O a.txt b.txt c.txt\tå‚ç›´æ˜¾ç¤ºå„ä¸ªæ–‡ä»¶\t22\tæ–‡æœ¬ç¼–è¾‘\tå‘½ä»¤æ¨¡å¼ æ–‡ä»¶ä¹‹é—´åˆ‡æ¢æ“ä½œ :args\tæŸ¥çœ‹viç¼–è¾‘å™¨ä¸­å¤šæ–‡ä»¶çš„çŠ¶æ€ï¼ˆæ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯ï¼‰ :next\tå¤šæ–‡ä»¶ä¸­å‘ååˆ‡æ¢ :prev\tå¤šæ–‡ä»¶ä¸­å‰ååˆ‡æ¢ :first\tåˆ‡æ¢åˆ°å¤šæ–‡ä»¶çš„é¦–æ–‡ä»¶ :last\tåˆ‡æ¢åˆ°å¤šæ–‡ä»¶çš„å°¾æ–‡ä»¶ å¿«æ·é”®ctrl+^\tåˆ‡æ¢åˆ°åˆ‡æ¢ä¹‹å‰çš„æ–‡ä»¶\t23\tæŒ‚è½½å…‰ç›˜ #\tmount /dev/cdrom /media/cdrom æŒ‚è½½å…‰ç›˜åˆ°/media/cdrom #\tumount /media/cdrom å¸è½½å…‰ç›˜ï¼ŒåŒumount -t iso9660 /media/cdrom\t24\tæŒ‚è½½Uç›˜ #\tmount -t vfat /dev/sdb1 /media/cdrom æŒ‚è½½Uç›˜ #\tumount /media/cdrom å¸è½½Uç›˜\t25\tåˆ›å»ºç”¨æˆ·åŠç®¡ç† #\tuseradd\tUseradd ç”¨æˆ·å\tåˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·\t26 #\tchfn chfn ç”¨æˆ·å\tè¾“å…¥ç”¨æˆ·ä¿¡æ¯\t27\tåˆ›å»ºç”¨æˆ·åŠç®¡ç† #\tuseradd\tuseradd -u 666 ç”¨æˆ·å\tåˆ›å»ºä¸€ä¸ªIDå·ä¸º666çš„æ–°ç”¨æˆ· #\tuseradd\tuseradd -e 12/22/2009 ç”¨æˆ·å\tåˆ›å»ºä¸€ä¸ª2009/11/22æ—¥è¿‡æœŸçš„ç”¨æˆ· #\tuseradd\tuseradd -p å¯†ç  ç”¨æˆ·å\tåˆ›å»ºç”¨æˆ·ï¼Œå¹¶ä¸€åŒåˆ›å»ºå¯†ç  #\tuseradd\tuseradd -g ç»„å ç”¨æˆ·å\tåˆ›å»ºç”¨æˆ·å¹¶åŠ å…¥ç»„ï¼ˆåŸç»„ä¸å­˜åœ¨ï¼Œæ”¹åŠ å…¥æ–°ç»„ï¼‰ #\tuseradd\tuseradd -G ç»„å ç”¨æˆ·å\tåˆ›å»ºç”¨æˆ·å¹¶åŠ å…¥ç»„ï¼ˆåŸç»„å­˜åœ¨ï¼Œå¹¶åŠ å…¥æ–°ç»„ï¼‰\t28\tç”¨æˆ·ç›¸å…³ä¿®æ”¹ #\tusermod\tusermod -l æ–°å æ—§å\tç»™ç”¨æˆ·æ”¹å #\tusermod\tusermod -e 11/23/2009\tæ›´æ”¹ç”¨æˆ·è¿‡æœŸæ—¶é—´ä¸º2009/11/23 #\tusermod\tusermod -L ç”¨æˆ·å\tç¦ç”¨ç”¨æˆ· #\tusermod\tusermod -U ç”¨æˆ·å\tè§£é”ç”¨æˆ· #\tuserdel\tuserdel ç”¨æˆ·å\tåˆ é™¤ç”¨æˆ·ï¼Œä½†ä¸åˆ é™¤ç”¨æˆ·è‡ªå®¶ç›®å½•ã€‚ #\tuserdel\tuserdel -r ç”¨æˆ·å\tåˆ é™¤ç”¨æˆ·ï¼Œå¹¶åˆ é™¤ç”¨æˆ·è‡ªå®¶ç›®å½•ã€‚ #\tgroupadd\tGroupadd ç»„å\tåˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ #\tpasswd\tpasswd\tä¸ºrootç”¨æˆ·åˆ›å»ºå¯†ç ï¼ˆä¿®æ”¹ï¼‰ #\tpasswd\tPasswd ç”¨æˆ·å\tä¸ºç”¨æˆ·åˆ›å»ºå¯†ç  #\tpasswd\tPasswd -d ç”¨æˆ·å\tåˆ é™¤ç”¨æˆ·å¯†ç ä¹Ÿèƒ½ç™»é™† #\tpasswd\tPasswd -l ç”¨æˆ·å\té”å®šè´¦å·å¯†ç  #\tpasswd\tPasswd -u ç”¨æˆ·å\tè§£é”è´¦å·å¯†ç  #\tpasswd\tPasswd -S ç”¨æˆ·å\tæŸ¥è¯¢è´¦å·å¯†ç \t29\tç»„ç›¸å…³ä¿®æ”¹ #\tGroups\tgroups ç”¨æˆ·å\tæŸ¥çœ‹ç”¨æˆ·æ‰€å±ç»„ #\tGroupadd\tgroupadd ç”¨æˆ·å\tåˆ›å»ºæ–°ç”¨æˆ· #\tGroupdel\tgroupdelç»„å å…ˆåº”åˆ å®ƒçš„ç”¨æˆ·\tåˆ é™¤ç»„ #\tGroupmod groupmod â€“næ–°ç”¨æˆ·å è€ç”¨æˆ·å\tä¸ºç»„æ”¹å #\tGroupmod groupmod â€“g 501 ç»„å\tæ”¹å˜ç»„GID #\tgpsswd\tgpasswd -d ç”¨æˆ·å ç»„å\tæŠŠç”¨æˆ·ä»ç»„ä¸­åˆ é™¤ #\tgpsswd\tgpasswd -a ç”¨æˆ·å ç»„å\tå¢åŠ ç”¨æˆ·åˆ°ç»„\t30\tç”¨æˆ·ç®¡ç† #\tId id ç”¨æˆ·å\tæŸ¥ç”¨æˆ·ä¿¡æ¯\t31\tç”¨æˆ·ç®¡ç† #\tll\tll æ–‡ä»¶å\tæŸ¥çœ‹æ–‡ä»¶æƒé™\t32\tæ–‡ä»¶æƒé™åŠæ‰€å±çš„ä¿®æ”¹ #\tchmod\tchmod u+r\tå¢åŠ ç”¨æˆ·è¯»æƒé™ #\tchmod\tchmod a+w\tå¢åŠ æ‰€æœ‰äººå†™æƒé™ #\tchmod\tchmod g+x\tå¢åŠ ç»„æ‰§è¡Œæƒé™ #\tchmod\tchmod 755 æ–‡ä»¶å\tæ›´æ”¹æ–‡ä»¶æƒé™ä¸ºrwx-xr-x (r=4 w=2 x=1)å€¼ç›¸åŠ  #\tchown\tchown ç”¨æˆ·å æ–‡ä»¶å\tæ›´æ”¹æ–‡ä»¶æ‰€å±ç”¨æˆ· #\tchown\tchown :ç»„å æ–‡ä»¶å\tæ›´æ”¹æ–‡ä»¶æ‰€å±ç»„ #\tchown\tchown ç”¨æˆ·å:ç»„å æ–‡ä»¶å\tåŒæ—¶æ›´æ”¹ç”¨æˆ·åå’Œç»„å #\tchown\tchown -R ç”¨æˆ·å:ç»„å ç›®å½•å\tæ›´æ”¹ç›®å½•åŠå…¶ä¸­æ‰€æœ‰æ–‡ä»¶æ‰€å±ç»„åŠç”¨æˆ·\t33\tç”¨æˆ·ä¹‹é—´åˆ‡æ¢ ç”¨æˆ·åˆ‡æ¢ å¿«æ·é”®Alt+F2\tåˆ‡æ¢åˆ°ç”¨æˆ·F2 ï¼ˆF1 - F6ï¼‰ #\tsu\tsu - ç”¨æˆ·å\tç”¨äºç»ˆç«¯ä¸Šç”¨æˆ·çš„åˆ‡æ¢\t34 #\tcat\tcat /etc/shells\tæ˜¾ç¤ºç³»ç»Ÿæ”¯æŒçš„shell\t35\tshell #\techo\techo $SHELL\tæŸ¥çœ‹å½“å‰ç³»ç»Ÿæ‰€ä½¿ç”¨çš„shell #\techo\techo $å˜é‡\tåº”ç”¨å˜é‡ 36\tå®šä¹‰å‘½ä»¤åˆ«å #\talias\talias\tæŸ¥çœ‹å®šä¹‰å¥½çš„å‘½ä»¤åˆ«å #\talias\talias la=ls -a\tä¸´æ—¶å®šä¹‰å‘½ä»¤åˆ«å\t37\tå˜é‡çš„è®¾ç½® #\tchsh\tchsh ç”¨æˆ·å å†è¾“å…¥/bin/csh\tæ›´æ”¹é»˜è®¤sehll,ä¸”æ°¸ä¹…ä¸å˜ã€‚ #\tset\tset |less\tæŸ¥çœ‹ç³»ç»Ÿå˜é‡ #\tPS1\tPS1=hello;\tæ›´æ”¹[root@loadhost ~]ä¸ºhello; #\tå˜é‡å=å€¼\tMOVIE=life is beautiful\tè‡ªè®¾å˜é‡ #\tunset\tunset å˜é‡å\tåˆ é™¤å˜é‡ #\t/bin/bash\tè¿›å…¥å­shell\texit é€€å‡ºå­shell #\texport export å˜é‡å\tåˆ é™¤å˜é‡ #\treadonly\treadonly\tæŸ¥çœ‹ç³»ç»Ÿä¸­åªè¯»å˜é‡ #\treadonly\treadonly å˜é‡å\tè®¾ç½®å˜é‡ä¸ºåªè¯»å˜é‡\t38 #\tsh\tsh æ–‡ä»¶å\tæ‰§è¡Œæ— æ‰§è¡Œæƒé™çš„è„šæœ¬\t39\tå†å²å‘½ä»¤ #\thistory\thistory |less\tæ˜¾ç¤ºå‘½ä»¤å†å²è®°å½• #\tï¼ ï¼39\tç›´æ¥ä½¿ç”¨ç¬¬39æ¬¡å‘½ä»¤ #\tï¼ ï¼c\tå¼•ç”¨æœ€åä¸€æ¬¡ä»¥cå¼€å¤´çš„å‘½ä»¤ã€‚\t40\té‡å®šå‘ # ls æ–‡ä»¶å\tæŠŠlså¾—ç»“æœé‡å®šå‘åˆ°æŒ‡å®šæ–‡ä»¶ # cat a.txt b.txt\tå°†a.txtä¸­çš„æ–‡ä»¶å¤åˆ¶åˆ°b.txt(è¦†ç›–ï¼‰ # cat c.txt b.txt\tå°†c.txtä¸­çš„æ–‡ä»¶è¿½åŠ åˆ°b.txtä¸­ # echo å­—ç¬¦ä¸² a.txt\tå°†å­—ç¬¦ä¸²è¿½åŠ åˆ°a.txtæ–‡ä»¶ä¸­ #\t2\tå‘½ä»¤ 2 æ–‡ä»¶å\tå°†é”™è¯¯é‡å®šå‘æ–‡ä»¶ä¸­\t41\tRPMåŒ…ç®¡ç† #\trpm\trpm -qa\tæ˜¾ç¤ºç³»ç»Ÿæ‰€è£…æ‰€æœ‰çš„rmpè½¯ä»¶åŒ… #\trpm\trpm -ivh\tæŒ‰ç…§æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ #\trpm\trpm -ql rmpåŒ…å\tæŸ¥è¯¢ç³»ç»Ÿä¸­æŒ‡å®šè½¯ä»¶åŒ…æ‰€åŒ…æ‹¬çš„æ–‡ä»¶åˆ—è¡¨ #\trpm\trpm -qpl rmpåŒ…å\tæŸ¥è¯¢æœªè£…åŒ…ä½ç½® #\trpm\trpm -qi rmpåŒ…å\tæ˜¾ç¤ºè½¯ä»¶åŒ…çš„è¯¦ç»†ä¿¡æ¯ #\trpm\trpm -qpi rmpåŒ…å\tä¿¡æ¯åˆ—è¡¨ #\trpm\trpm -Uvh rmpåŒ…å\tå‡çº§åŒ…ï¼Œå¯å®‰è£… #\trpm\trpm -e rmpåŒ…å\tå¸è½½ #\trpm\trpm -e --nodeps rmpåŒ…å\tå¼ºåˆ¶å¸è½½ #\trpm\trpm -qf /bin/ls\tæŸ¥è¯¢/bin/lsæ–‡ä»¶æ‰€åœ¨åŒ…\t42\tè®¾ç½®ip #\tnetconfig\tnetconfig è®¾ç½®IPåœ°å€ #\tservice network restart é‡å¯ç½‘ç»œæœåŠ¡\t43\ttaråŒ…ç®¡ç† #\tgzip\tgzip æ–‡ä»¶å\tå‹ç¼©æ–‡ä»¶ï¼ŒåŸæ–‡ä»¶æ¶ˆå¤± #\ttar\ttar cvf åŒ…å åŸæ–‡ä»¶åã€åŸåŒ…å\tæŠŠæ–‡ä»¶å’Œç›®å½•å‹ç¼©æˆtaråŒ… #\ttar\ttar tf åŒ…å\tæŸ¥çœ‹taråŒ…ä¸­çš„æ–‡ä»¶ #\ttar\ttar xvf åŒ…å\té‡Šæ”¾taråŒ…é‡Œçš„æ–‡ä»¶ å‚æ•°-vä¸ºæ˜¾ç¤ºè¯¦ç»†å‚æ•° #\ttar\ttar xvf åŒ…å -C è·¯å¾„\té‡Šæ”¾åˆ°æŒ‡å®šç›®å½• #\ttar\ttar jxvf åŒ…å\té‡Šæ”¾bz2æ ¼å¼å‹ç¼©åŒ… #\ttar\ttar zcvf åŒ…å æ–‡ä»¶åã€åŸåŒ…å\tåˆ›å»ºå‹ç¼©taråŒ… #\ttar\ttar ztf åŒ…å\tæŸ¥çœ‹å‹ç¼©taråŒ… #\ttar\ttar zxvf åŒ…å -C è·¯å¾„\té‡Šæ”¾taråŒ…åˆ°æŒ‡å®šè·¯å¾„\t44\tç¼–è¯‘å®‰è£… #\tå®‰è£…\t./configure å®‰è£…åœ¨ç¨‹åºç›®å½•ä¸‹ # ./configure --prefix=/è·¯å¾„\tå®‰è£…åœ¨æŒ‡å®šç›®å½• # make\tç¼–è¯‘æºä»£ç  # make install\tå°†å·²ç¼–è¯‘çš„åº”ç”¨ç¨‹åºå®‰è£…åˆ°ç›®æ ‡è·¯å¾„ #\tå¸è½½\t./unin stall\tå¸è½½\t45\tå­—ç¬¦ä¸‹è½½ #\twget\twget ä¸‹è½½åœ°å€\tå­—ç¬¦ç•Œé¢ä¸‹çš„ä¸‹è½½\t46\tå®‰è£…ç¨‹åºçš„å¯åŠ¨ #\tproz proz ä¸‹è½½è·¯å¾„\tå®‰è£…åœ¨é»˜è®¤è·¯å¾„ä¸‹çš„prozçš„å¯åŠ¨ ä¸‹è½½ #\tè·¯å¾„/proz\tè·¯å¾„/proz ä¸‹è½½è·¯å¾„\tå®‰è£…åœ¨æŒ‡å®šè·¯å¾„ä¸‹çš„prozçš„å¯åŠ¨ ä¸‹è½½\t47\tgccå‡çº§ #\tyum gcc\tyum gcc\tè‡ªåŠ¨å‡çº§gcc\t48\tæ‰“è¡¥ä¸ #\tcat\tcat è·¯å¾„ |patch -p1\tç»™ç¨‹åºæ‰“è¡¥ä¸\t49\tå…³æœº\t#\tshutdown\tshutdown -h\tå…³æœº å¿«æ·é”®ctrl+alt+del å…³æœº #\tinit\tinit 0\tå…³æœº\t50\tinitçš„ä¸ƒç§æ¨¡å¼ #\tinit\tinit 1\tå•ç”¨æˆ·æ¨¡å¼ #\tinit\tinit 2\tæ— NFS,å­—ç¬¦å¤šç”¨æˆ· #\tinit\tinit 3\tå¤šç”¨æˆ· #\tinit\tinit 4\té¢„ç•™ #\tinit\tinit 5\tå›¾å½¢ç”¨æˆ·\t51\té‡å¯ #\tinit\tinit 6\té‡å¯ #\tshutdown\tshutdown -r\té‡å¯ #\treboot\treboot\té‡å¯\t52\tçº§åˆ«æŸ¥è¯¢ä¿®æ”¹ #\trunlevel runlevel\tæŸ¥è¯¢å½“å‰çº§åˆ« #\tvi /etc/inittab ä¿®æ”¹é»˜è®¤å¯åŠ¨çº§åˆ«\t53\tå¯åŠ¨çº§åˆ« ç¬¬åå…«è¡Œï¼Œidï¼š4 æŠŠé»˜è®¤å¯åŠ¨çº§åˆ«æ”¹ä¸º3 ç¬¬32è¡Œï¼Œåœ¨ca::å‰åŠ ä¸Š# 32 #ca:: æŠŠå¿«æ·é”®ctrl+alt+delå…³æœº ç¦ç”¨ #\tchkconfig\tchkconfig --list\tæŸ¥çœ‹å®‰è£…åŒ…åœ¨å„çº§çš„å¯åŠ¨çŠ¶æ€ #\tchkconfig\tchkconfig --level 24 httpd on\tå¯åŠ¨httpdåœ¨ 24çº§åˆ«ã€‚ #\tchkconfig --list rsyns å¯åŠ¨éç‹¬ç«‹çš„åŒ…ï¼Œä¸å†™å¯åŠ¨çº§åˆ«\t54\tç³»ç»Ÿè¿›ç¨‹ #\tpstree\tpatree |less\tæ˜¾ç¤ºè¿›ç¨‹æ ‘ #\tps\tps aux\tæ˜¾ç¤ºè¿›ç¨‹ #\tkill\tkill è¿›ç¨‹å·\tå…³é—­è¿›ç¨‹ #\tkill kill -q è¿›ç¨‹å·\tå¼ºåˆ¶ç»“æŸ #\ttop\ttop\tåŠ¨æ€æŸ¥çœ‹è¿›ç¨‹ å¿«æ·é”®ctrl+z\tå‘½ä»¤ååŠ  æ”¾å…¥åå°è¿è¡Œ #\tjobs jobs\tæŸ¥çœ‹åå°è¿è¡Œé¡¹ #\tfg\tfg 2\tæŠŠåå°è¿è¡Œçš„ç¨‹åºè°ƒå…¥å‰å°\t55\tä»»åŠ¡è®¡åˆ’çš„ç¼–è¾‘ #\tat\tat 18:33\tä¸º18ï¼š33åˆ†åˆ¶ä½œä»»åŠ¡è®¡åˆ’ #\tat at mkdir ç›®å½•å\tç›´æ¥è¾“å…¥å‘½ä»¤ å¿«æ·é”®ctrl+d ç»“æŸå½“å‰è¿›ç¨‹ #\tatq\tatq\tè®¡åˆ’ä»»åŠ¡é˜Ÿåˆ— #\tatrm\tat -d\téƒ½ä¸ºå–æ¶ˆè®¡åˆ’ä»»åŠ¡ #\tat -t 12011230 ä¸º12æœˆ1æœˆ12ï¼š30ä»»åŠ¡è®¡åˆ’ #\trpm rpm -qa |grep vixie -cron\tæŸ¥çœ‹è®¡åˆ’ä»»åŠ¡å·¥å…·åŒ…æ˜¯å¦å®‰è£… #\tcrontab æ‰“å¼€ç¼–è¾‘ä»»åŠ¡è®¡åˆ’ç¼–è¾‘å™¨ï¼Œæ ¼å¼ï¼šåˆ†é’Ÿ å°æ—¶ å¤© æœˆ æ˜ŸæœŸ ååŠ å‘½ä»¤ #\tcrontab crontab -e\tä¿®æ”¹ä»»åŠ¡è®¡åˆ’ #\tmail\tmail\tæ¥å—ç³»ç»Ÿé‚®ä»¶ #\tservice crond start å¯åŠ¨crond #\tcrontab\tcrontab -r\tåˆ é™¤å…¨éƒ¨è®¡åˆ’ä»»åŠ¡\t56\tç£ç›˜åˆ†åŒº #\tfdisk\tfdisk /dev/sdb\tæ‰“å¼€ç£ç›˜åˆ†åŒºå·¥å…· n æ–°å»ºåˆ†åŒº wä¿å­˜æ¨å‡º dåˆ é™¤åˆ†åŒº qä¸ä¿å­˜æ¨å‡º 57\tç£ç›˜æ ¼å¼åŒ– mkfs.ext3\tmkfs.ext3 /dev/sdb1\tæ ¼å¼åŒ–æˆext3æ ¼å¼ mkswap\tmkswap /dev/sdb2\tæ ¼å¼åŒ–æˆswapæ ¼å¼ mkfs.vfat mkfs.vfat /dev/sdb3\tæ ¼å¼åŒ–æˆfatæ ¼å¼ parted\tparted /dev/sdb\tæŸ¥çœ‹åˆ†åŒºsdbçš„ç±»å‹\t58\tç£ç›˜æŒ‚è½½ #\tvi vi /etc/fstab æŒ‚è½½ç£ç›˜\t59\tç£ç›˜é…é¢ #\tquotacheck\tquotacheck -cug /media/sdb1\tå¯åŠ¨ç£ç›˜é…é¢ #\tquotaon\tquotaon /media/sdb #\teduota\teduota -u ç”¨æˆ·å\tç»™ç”¨æˆ·åšç£ç›˜é…é¢ #\tquota\tquota -u ç”¨æˆ·å\tæŸ¥çœ‹ç”¨æˆ·ç£ç›˜ä½¿ç”¨æƒ…å†µ #\tedquota\teduota -t æ›´æ”¹è½¯é™åˆ¶æ—¶é—´ #\tedquota\teduota -g ç»„å\tæ›´æ”¹ç»„ç”¨æˆ·ç£ç›˜é…é¢ #\tedquota\teduota -p å·²é™ªç”¨æˆ·å ç”¨æˆ·ån\tä¸ºå¤šä¸ªç”¨æˆ·åˆ›å»ºç£ç›˜é…é¢\t60\tIPä¿¡æ¯ç¼–è¾‘ #\troute\trout æŸ¥çœ‹é»˜è®¤ç½‘å…³ #\tcat /etc/sysconfig/network-scripta/ æŸ¥çœ‹ipä¿¡æ¯æ–‡ä»¶ ç”¨viå¯ä¿®æ”¹ #\tifconfig eth0 192.168.1.1 netmask 255.255.255.0 è®¾ç½®ä¸´æ—¶IP\t#\tnetconfig\tnetconfig è®¾ç½®IPåœ°å€ éœ€é‡å¯ç½‘å¡æœåŠ¡ #\trouteadd\trouteadd default gw ç½‘å…³\tè®¾ç½®ä¸´æ—¶ç½‘å…³ #\troutedel\troutedel default gw ç½‘å…³\tåˆ é™¤ä¸´æ—¶ç½‘å…³ #\ttraceroute traceroute IPåœ°å€\tè·¯ç”±è¿½è¸ª #\tifdown ifdown ç½‘ç»œæ¥å£åç§°\tç¦ç”¨ç½‘å¡ #\tifup\tifup ç½‘ç»œæ¥å£åç§°\tå¯ç”¨ç½‘å¡\t61\tä¸»æœºåæ›´æ”¹ #\thostname\thostname è®¡ç®—æœºå\tæ›´æ”¹è®¡ç®—æœºåï¼Œé‡å¯æ— æ•ˆ #\tvi /etc/sysconfig/network æ›´æ”¹è®¡ç®—æœºå ä¸»æœºåè®¾ç½®åé‡å¯æ‰èƒ½ç”Ÿæ•ˆï¼Œä¸€èˆ¬å’Œhostnameä¸€èµ·ä½¿ç”¨ã€‚ 62\tåŸŸåè§£æ #\tnslookup ç½‘å€æˆ–åŸŸå\tåŸŸåè§£æ\t63\tå®‰è£…NFSæœåŠ¡å™¨ #\tvi\tvi /etc/hosts\t//æ·»åŠ IPåœ°å€ä¸ä¸»æœºå(æœ¬åœ°ä¸»æœºåç§°è§£ææ–‡ä»¶ï¼‰ #\tvi\tvi /etc/resolv.conf\tresolv.confä¸­çš„searchç”¨äºè®¾ç½®ä¸»æœºçš„é»˜è®¤æŸ¥æ‰¾åŸŸå #\trmp rmp -q nfs-utils portmap\tæŸ¥è¯¢NFSæœåŠ¡å™¨æ˜¯å¦å®‰è£… #\trmp -ivh nfs-utils-1.0.6-46.i386.rmp portmp-4.0-63.i386.rmp å®‰è£…NFS 64\tshowmountçš„æŸ¥è¯¢åŠŸèƒ½ #\tshowmount showmount NFSæœåŠ¡å™¨ä¸»æœºåœ°å€\tæ˜¾ç¤ºå½“å‰ä¸»æœºä¸­NFSæœåŠ¡å™¨è¿æ¥ä¿¡æ¯ #\tshowmount showmount -e IPåœ°å€\tæ˜¾ç¤ºæŒ‡å®šä¸»æœºä¸­NFSæœåŠ¡å™¨è¿æ¥ä¿¡æ¯,å¹¶åˆ—è¡¨ #\tshowmount showmount -d NFSæœåŠ¡å™¨åœ°å€\tæ˜¾ç¤ºæŒ‡å®šä¸»æœºä¸­NFSæœåŠ¡å™¨å·²è¢«æŒ‚è½½çš„ç›®å½• #\tshowmount showmount -a NFSæœåŠ¡å™¨åœ°å€\tæ˜¾ç¤ºæŒ‚è½½çš„å…±äº«åˆ—è¡¨å’ŒNFSå®¢æˆ·æœºåœ°å€\t65\tNFSçš„å…±äº«è¾“å…¥ä¸è¾“å‡º #\texportfs export -rv\tä½¿ä¿®æ”¹åçš„export -rvæ–‡ä»¶ç”Ÿæ•ˆ #\texportfs export -auv\tä¸´æ—¶åœæ­¢NFSæœåŠ¡å™¨çš„æ‰€æœ‰å…±äº«ç›®å½•è¾“å‡º #\texportfs export -av\tè¾“å‡ºï¼ˆå¯ç”¨ï¼‰æ‰€æœ‰è¢«-auvå‘½ä»¤åœæ­¢çš„NFSå…±äº«ç›®å½• #\tsystem-config-nfs åœ¨å›¾åƒç•Œé¢ä¸‹å¯åŠ¨NFSæœåŠ¡å™¨é…ç½®å·¥å…·å‘½ä»¤\t66\té…ç½®NFS æœåŠ¡å™¨ å¿…é¡»å®‰è£…çš„ è½¯ä»¶åŒ…\trpm -qa |grep nfs-utils\tå‡åœ¨ç¬¬äºŒå¼ å…‰ç›˜ä¸­ rpm -qa |grep portmap é…ç½®exports æ–‡ä»¶\tvi /etc/exports\tä¸‹é¢ä¸¤è¡Œä¸ºæ ¼å¼ /opt/text *(sync,ro) 192.168.1.12(sync,rw) å…±äº«æºæ–‡ä»¶è·¯å¾„ æ‰€æœ‰ä¸»æœºï¼ˆåŒæ­¥å†™ç£ç›˜ï¼Œåªè¯»ï¼‰ å®¢æˆ·IPåœ°å€ï¼ˆåŒæ­¥å†™ç£ç›˜ï¼Œè¯»å†™ï¼‰ pingé€šNFSæœåŠ¡å™¨ä¸å®¢æˆ·æœº ä»¥ä¸Šå‡åœ¨NFSæœåŠ¡å™¨ä¸Šå®Œæˆ ä¸‹é¢åœ¨å®¢æˆ·æœºä¸Šå®Œæˆ 67\té…ç½®NFS å®¢æˆ·ç«¯ showmount -e /192.168.1.1 æŸ¥çœ‹NFSæœåŠ¡å™¨å…±äº«ç›®å½• æŒ‚è½½å…±äº«ç›®å½•\tmount 192.168.1.1:/opt/test /mnt é…ç½®è‡ªåŠ¨æŒ‚è½½\tvi /etc/fstab ä»¥ä¸‹ä¸¤è¡Œä¸ºæ ¼å¼ 192.168.1.1:/opt/text /mnt nfs defaults 0 0 æœåŠ¡å™¨ipåœ°å€ï¼šå…±äº«æºæ–‡ä»¶è·¯å¾„ æŒ‚è½½ç‚¹è·¯å¾„ ç£ç›˜æ ¼å¼ é»˜è®¤æŒ‚è½½ å­˜æ¡£ windowsç³»ç»Ÿçš„ NFS æŒ‚è½½\twindowsä¸­éœ€å®‰è£…liteall.exeè½¯ä»¶ cat /etc/passwd |grep nfsnobody æŸ¥è¯¢UID GID ä½¿ç”¨UID GID æŒ‚è½½\té‡å¯å¯è§£å†³å…¼å®¹æ€§é—®é¢˜\t68\tè¡¥å…… #\twall\twall hello everyone\tåœ¨æ‰€æœ‰ç™»é™†ç”¨æˆ·æ¡Œé¢æ˜¾ç¤º #\twall\twall a.txt\tå°†a.txtä¸­çš„å†…å®¹æ˜¾ç¤ºåˆ°æ‰€æœ‰ç™»é™†ç”¨æˆ·çš„æ¡Œé¢ #\twc\twc\tç»Ÿè®¡ä»é”®ç›˜è¾“å…¥çš„ è¡Œæ•° å•è¯æ•° å­—ç¬¦æ•° #\twc\twc /etc/passwd\tç»Ÿè®¡ç”¨æˆ·æ•°ï¼ˆè¡Œï¼‰ #\tls\tls a.txt b.txt\tå°†å‘½ä»¤æ‰§è¡Œçš„è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç³»ç»Ÿå‚æ•°"]},{"title":"æ—¶é—´ç¼–ç¨‹","path":"/2024/05/02/1-å¹³å°ç³»ç»Ÿ-Linux-ç³»ç»Ÿå‚æ•°-æ—¶é—´ç¼–ç¨‹/","content":"æ—¶é—´ç±»å‹Coordinated Unicersal Timeï¼ˆUTCï¼‰ï¼šä¸–ç•Œæ ‡å‡†æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶æ‰€ç†ŸçŸ¥çš„æ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´ï¼ˆGreenwich Mean Time å— GMTï¼‰ Calendar Timeï¼šæ—¥å†æ—¶é—´ï¼Œæ˜¯ç”¨â€ä»ä¸€ä¸ªæ ‡å‡†æ—¶é—´ç‚¹ï¼ˆå¦‚ï¼š1970 å¹´ 1 æœˆ 1 æ—¥ 0 ç‚¹ï¼‰åˆ°æ­¤æ—¶ç»è¿‡çš„ç§’æ•°â€æ¥è¡¨ç¤ºæ—¶é—´ æ—¶é—´è·å–è·å–æ—¥å†æ—¶é—´ï¼Œå³ä» 1970 å¹´ 1 æœˆ 1 æ—¥ 0 ç‚¹åˆ°ç°åœ¨æ‰€ç»å†çš„ç§’æ•° #include time.htime_t time(time_t*tloc); å°†æ—¥å†æ—¶é—´è½¬åŒ–ä¸ºæ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´ï¼Œå¹¶ä¿å­˜è‡³ TM ç»“æ„ struct tm *gmtime(const time_t*timep); å°†æ—¥å†æ—¶é—´è½¬åŒ–ä¸ºæœ¬åœ°æ—¶é—´ï¼Œå¹¶ä¿å­˜è‡³ TM ç»“æ„ struct tm *localtime(const time_t*timep); struct tm int tm_sec; /* Seconds(0-60) */int tm_min; /* Minutes(0-59) */int tm_hour; /* Hours(0-23) */int tm_mday; /* Day of the month (1-31) */int tm_mon; /* Month (0-11) */int tm_year; /* Year - 1900 */int tm_wday; /* Day of the week (0-6, Sunday = 0) */int tm_yday; /* Dayin the year (0-365, 1 Jan = 0) */int tm_isdst; /* Daylightsaving time */; å°† tm æ ¼å¼çš„æ—¶é—´è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œå¦‚ï¼šSat Jul 30 08ï¼š43ï¼š03ï¼š2005 char*asctime(conststruct tm *tm); å°†æ—¥å†æ—¶é—´è½¬åŒ–ä¸ºæœ¬åœ°æ—¶é—´çš„å­—ç¬¦ä¸²å½¢å¼ char*ctime(const time_t*timep); è·å–ä»ä»Šæ—¥å‡Œæ™¨åˆ°ç°åœ¨çš„æ—¶é—´å·®ï¼Œå¸¸ç”¨äºè®¡ç®—äº‹ä»¶è€—æ—¶ #include sys/time.hint gettimeofday(struct timeval *tv,struct timezone *tz); struct timeval time_t tv_sec; /*seconds*/ ç§’æ•°suseconds_t tv_usec; /* microseconds*/ å¾®ç§’; å»¶æ—¶æ‰§è¡Œä½¿ç¨‹åºç¡çœ  seconds #include unistd.hunsigned intsleep(unsigned intseconds); ä½¿ç¨‹åºç¡çœ  usec å¾®ç§’ #include unistd.hint usleep(useconds_t usec);","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç³»ç»Ÿå‚æ•°"]},{"title":"è‡ªå¯åŠ¨","path":"/2024/05/01/1-å¹³å°ç³»ç»Ÿ-Linux-ç³»ç»Ÿå‚æ•°-è‡ªå¯åŠ¨/","content":"è®¾ç½®è„šæœ¬ - rc.localåœ¨ Ubuntu ç³»ç»Ÿä¸­ï¼Œrc.local è„šæœ¬æ‰¿æ‹…ç€å¼€æœºåè‡ªåŠ¨æ‰§è¡Œç‰¹å®šå‘½ä»¤çš„åŠŸèƒ½ã€‚è¯¥è„šæœ¬çš„é»˜è®¤æ‰§è¡Œç”¨æˆ·ä¸º rootï¼Œæ„å‘³ç€å…¶ä¸­çš„å‘½ä»¤å°†ä»¥è¶…çº§ç”¨æˆ·æƒé™è¿è¡Œã€‚è¿™ç§è®¾è®¡å¯¹ç³»ç»Ÿç®¡ç†éå¸¸é‡è¦ï¼Œå› ä¸ºæŸäº›æ“ä½œï¼Œæ¯”å¦‚å¯åŠ¨ç³»ç»ŸæœåŠ¡æˆ–è¿›è¡Œç³»ç»Ÿçº§é…ç½®ï¼Œéœ€è¦è¶³å¤Ÿçš„æƒé™ã€‚ rc.local è„šæœ¬ä½äº /etc/ ç›®å½•ä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªç³»ç»Ÿç›®å½•ï¼Œä¸“é—¨ç”¨äºå­˜æ”¾é…ç½®æ–‡ä»¶åŠéœ€ä¿è¯ç³»ç»Ÿæ“ä½œé¡ºç•…çš„å…¶ä»–æ–‡ä»¶ã€‚è¦ä¿®æ”¹æ­¤è„šæœ¬ï¼Œéœ€å…·å¤‡ root æƒé™ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ vi æ‰“å¼€è„šæœ¬ï¼š vi /etc/rc.local rc.local è„šæœ¬çš„åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼Œä¸åŒæ®µè½ç”¨æ³¨é‡Šè¿›è¡Œè§£é‡Šï¼Œä»¥ä¾¿ç†è§£æ¯ä¸ªéƒ¨åˆ†çš„åŠŸèƒ½ï¼š #!/bin/sh -e## rc.local## This script is executed at the end of each multiuser runlevel.# Make sure that the script will exit 0 on success or any other# value on error.## In order to enable or disable this script just change the execution# bits.## By default this script does nothing.exit 0 **#!/bin/sh -e**ï¼šæŒ‡å®šä½¿ç”¨çš„è§£é‡Šå™¨ï¼Œå½“è„šæœ¬ä¸­çš„æŸæ¡å‘½ä»¤è¿”å›éé›¶çŠ¶æ€æ—¶ï¼Œè„šæœ¬å°†ç«‹å³é€€å‡ºã€‚ æ³¨é‡Šéƒ¨åˆ†ï¼šæä¾›äº†è„šæœ¬çš„æ“ä½œæŒ‡å¯¼ï¼Œç‰¹åˆ«å¼ºè°ƒäº†æˆåŠŸæ‰§è¡Œæ—¶å¿…é¡»è¿”å› 0 çš„è¦æ±‚ã€‚ **exit 0**ï¼šæ ‡å¿—è„šæœ¬çš„ç»“æŸï¼Œä»»ä½•æ·»åŠ çš„å‘½ä»¤å¿…é¡»ä½äºæ­¤è¡Œä¹‹å‰ã€‚ ä¸ºäº†ç¡®ä¿è¦æ‰§è¡Œçš„æŒ‡ä»¤æœ‰æ•ˆåœ°å¯åŠ¨ï¼Œå¯ä»¥åœ¨ exit 0 ä¹‹å‰æ·»åŠ æ‰€éœ€çš„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€‰æ‹©å¯åŠ¨ Nginx æœåŠ¡ã€‚è¿™å¯é€šè¿‡ç®€å•åœ°å°†ä»¥ä¸‹å‘½ä»¤æ’å…¥åˆ° rc.local ä¸­æ¥å®ç°ï¼š /usr/bin/nginx start åœ¨ç¼–è¾‘æ–‡ä»¶å¹¶æ·»åŠ å®Œå‘½ä»¤åï¼Œéœ€è¦ç¡®ä¿è„šæœ¬å…·æœ‰å¯æ‰§è¡Œæƒé™ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæƒé™ä¿®æ”¹ï¼š chmod +x /etc/rc.d/rc.local éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ/etc/rc.d/rc.local å®é™…ä¸Šæ˜¯ /etc/rc.local çš„è½¯é“¾æ¥ï¼Œå› æ­¤å¯¹è½¯é“¾æ¥çš„ä¿®æ”¹ç›´æ¥å½±å“åŸå§‹è„šæœ¬ã€‚ åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæ§åˆ¶éšæœºå¯åŠ¨çš„æœåŠ¡ç¨‹åºçš„ä¸»è¦ç›®å½•æ˜¯ /etc/init.dã€‚æ­¤ç›®å½•ä¸‹åŒ…å«äº†ä¸€ç³»åˆ—è„šæœ¬æ–‡ä»¶ï¼Œè¿™äº›è„šæœ¬è´Ÿè´£åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶æŒ‰é¡ºåºæ‰§è¡Œç‰¹å®šçš„ç¨‹åºã€‚è¿™ç§è„šæœ¬æ–‡ä»¶çš„ä½œç”¨ç±»ä¼¼äº Windows ç³»ç»Ÿä¸­çš„ autorun.dat æ–‡ä»¶ï¼Œå®ƒä»¬èƒ½å¤ŸæŒ‡ç¤ºç³»ç»Ÿåœ¨å¯åŠ¨æ—¶éœ€è¦æ‰§è¡Œå“ªäº›è¿›ç¨‹ã€‚ ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸€è¿‡ç¨‹ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ /etc ç›®å½•ä¸‹è¿˜åŒ…å«äº†ä¸€ç»„ä»¥ rc å¼€å¤´çš„æ–‡ä»¶å¤¹ï¼Œå¦‚ rc1.d, rc2.d ç›´åˆ° rc6.dã€‚è¿™äº›ç›®å½•å¯¹åº”äº Linux ç³»ç»Ÿä¸åŒçš„è¿è¡Œçº§åˆ«ï¼ˆrunlevelsï¼‰ã€‚é€šå¸¸ï¼Œç”¨æˆ·ä¼šè¿›å…¥çš„ X Windows å¤šç”¨æˆ·è¿è¡Œçº§åˆ«æ˜¯ç¬¬ 5 çº§ï¼Œè¿™æ„å‘³ç€æ¶‰åŠçš„æœåŠ¡ç¨‹åºå­˜æ”¾åœ¨ rc5.d æ–‡ä»¶å¤¹ä¸­ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œå­˜åœ¨çš„è„šæœ¬æ–‡ä»¶åˆ™æŒ‡ç¤ºåœ¨ç¬¬ 5 çº§è¿è¡Œæ—¶åº”å¯åŠ¨çš„æœåŠ¡ã€‚ éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œè¿™äº› rc(1-6).d ç›®å½•ä¸­çš„æ–‡ä»¶å…¶å®æ˜¯æŒ‡å‘ /etc/init.d ç›®å½•ä¸‹æœåŠ¡ç¨‹åºçš„è½¯é“¾æ¥ï¼Œç±»ä¼¼äº Windows ç³»ç»Ÿä¸­çš„å¿«æ·æ–¹å¼ã€‚è¿™ä¸€è®¾è®¡çš„å¥½å¤„åœ¨äºï¼Œæ‰€æœ‰æœåŠ¡ç¨‹åºéƒ½é›†ä¸­ç®¡ç†ï¼Œä¾¿äºç»´æŠ¤å’Œä¿®æ”¹ï¼Œè€Œæ¯ä¸ªçº§åˆ«æ‰€éœ€çš„æœåŠ¡åˆ™é€šè¿‡è½¯é“¾æ¥åˆ†åˆ«æŒ‡å‘ä¸»æœåŠ¡ç¨‹åºï¼Œè¿™æ ·èƒ½å¤Ÿæœ‰æ•ˆåœ°ç®¡ç†ä¸åŒè¿è¡Œçº§åˆ«ä¸‹çš„æœåŠ¡å¯åŠ¨ã€‚ ä»¥å¯åŠ¨ scim ç¨‹åºä¸ºä¾‹ï¼Œé¦–å…ˆéœ€è¦å®šä½è¯¥ç¨‹åºåœ¨ç³»ç»Ÿä¸­çš„å…·ä½“è·¯å¾„ï¼Œä½¿ç”¨ locate å‘½ä»¤å¯ä»¥è½»æ¾æ‰¾åˆ°å®ƒã€‚scim çš„è·¯å¾„æ˜¯ /usr/bin/scimï¼Œè¿™é‡Œçš„ usr ä»£è¡¨ç”¨æˆ·ç¨‹åºçš„å­˜æ”¾ä½ç½®ï¼Œè€Œ bin åˆ™è¡¨æ˜è¯¥ä½ç½®åŒ…å«å¯ä»¥æ‰§è¡Œçš„ç¨‹åºã€‚äº†è§£è¿™ä¸€ç‚¹åï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªè„šæœ¬ï¼Œå°†å…¶æ”¾å…¥ /etc/init.d ç›®å½•ï¼Œå¹¶åœ¨ rc5.d ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªç›¸åº”çš„è½¯é“¾æ¥ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„è„šæœ¬ç¤ºä¾‹ï¼š #!/bin/bash/usr/bin/scim ç¬¬ä¸€è¡Œ #!/bin/bash æ˜¯ä¸€ç§å£°æ˜ï¼ŒæŒ‡æ˜è¯¥è„šæœ¬å°†ä½¿ç”¨ Bash ç»ˆç«¯æ‰§è¡Œã€‚ ç¬¬äºŒè¡Œ /usr/bin/scim åˆ™æ˜¯è¦æ‰§è¡Œçš„å…·ä½“å‘½ä»¤ã€‚ åœ¨åˆ›å»ºé“¾æ¥æ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„åœ¨ rc5.d ç›®å½•ä¸‹ï¼Œæ¯ä¸ªé“¾æ¥çš„å‘½åçº¦å®šï¼šä»¥ S å¼€å¤´çš„é“¾æ¥è¡¨ç¤ºåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶éœ€è¦éšæœºå¯åŠ¨ï¼Œè€Œä»¥ K å¼€å¤´çš„é“¾æ¥åˆ™è¡¨ç¤ºä¸éšæœºå¯åŠ¨ã€‚å› æ­¤ï¼Œå¦‚æœæƒ³è®©æŸä¸ªæœåŠ¡åœ¨å¯åŠ¨æ—¶éšæœºå¯åŠ¨ï¼Œå¯ä»¥å°†é“¾æ¥åç§°ä¸­çš„ K æ”¹ä¸º Sï¼›åä¹‹ï¼Œå°† S æ”¹ä¸º K åˆ™æ„å‘³ç€è¯¥æœåŠ¡ä¸å†éšæœºå¯åŠ¨ã€‚è¿™æ„å‘³ç€ï¼Œé“¾æ¥å¯ä»¥å‘½åä¸º SXXXï¼ˆå…¶ä¸­ XXX ä¸ºè‡ªå®šä¹‰çš„æ ‡è¯†ç¬¦ï¼‰ï¼Œè¿™æ ·ç³»ç»Ÿå°±ä¼šåœ¨å¯åŠ¨æ—¶éšæœºåŠ è½½å®ƒã€‚ æ­¤å¤–ï¼Œåœ¨æŸäº› Linux å‘è¡Œç‰ˆä¸­ï¼Œå¦‚ Red Hatï¼ˆRHï¼‰ï¼Œrc.local æ–‡ä»¶æ˜¯æ‰€æœ‰è„šæœ¬ä¸­æœ€åæ‰§è¡Œçš„ï¼Œæ‰€ä»¥è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•å¯ä»¥å®ç°æœåŠ¡çš„éšæœºå¯åŠ¨ï¼Œå³åœ¨ rc.local æ–‡ä»¶çš„æœ«å°¾åŠ å…¥ /usr/bin/scimï¼Œè¿™åŒæ ·èƒ½è¾¾åˆ°å¼€æœºå¯åŠ¨çš„ç›®çš„ã€‚æ­¤ç§æ–¹å¼çµæ´»ï¼Œé€‚åˆäºæ²¡æœ‰åŠæ³•é€šè¿‡ä¼ ç»Ÿæ–¹å¼å¯åŠ¨çš„æœåŠ¡ã€‚ å…³äºæ”¾åœ¨ rc.local ä¸­æ—¶ä¸å¯åŠ¨çš„é—®é¢˜1. å¢åŠ æ—¥å¿—è¾“å‡ºåŠŸèƒ½ä¸ºäº†æ‰¾å‡ºè„šæœ¬åœ¨ rc.local ä¸­ä¸å¯åŠ¨çš„å…·ä½“åŸå› ï¼Œå¯ä»¥åœ¨è„šæœ¬ä¸­å¢åŠ æ—¥å¿—è¾“å‡ºåŠŸèƒ½ã€‚æ—¥å¿—å¯¹æ’æŸ¥é—®é¢˜è‡³å…³é‡è¦ï¼Œç¡®ä¿å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ‰€æœ‰ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„ Memcached å¯åŠ¨è„šæœ¬ç¤ºä¾‹ï¼ŒåŒ…å«æ—¥å¿—è®°å½•åŠŸèƒ½ï¼š #!/bin/sh -e## rc.local## æ­¤è„šæœ¬åœ¨æ¯ä¸ªå¤šç”¨æˆ·è¿è¡Œçº§åˆ«çš„æœ«å°¾æ‰§è¡Œã€‚## ç¡®ä¿è„šæœ¬åœ¨æˆåŠŸæ—¶è¿”å› exit 0ï¼Œåœ¨å‡ºé”™æ—¶è¿”å›å…¶ä»–å€¼ã€‚## è¦å¯ç”¨æˆ–ç¦ç”¨æ­¤è„šæœ¬ï¼Œåªéœ€æ›´æ”¹æ‰§è¡Œæƒé™ã€‚## é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤è„šæœ¬ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚# å‘é€é”™è¯¯è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶logexec 2/tmp/rc.local.log # å°†æ ‡å‡†è¾“å‡ºå‘é€åˆ°åŒä¸€ä¸ªæ—¥å¿—æ–‡ä»¶exec 1/tmp/rc.local.log 21 # å‘Šè¯‰ sh åœ¨æ‰§è¡Œä¹‹å‰æ˜¾ç¤ºå‘½ä»¤set -x # å¯åŠ¨ Memcached/usr/local/memcache/bin/memcached -p 11211 -m 64m -d -u root# é€€å‡ºè„šæœ¬exit 0 è¿™æ ·ä¿®æ”¹åï¼Œä¸ä»…èƒ½è®°å½•ä¸‹é”™è¯¯ä¿¡æ¯ï¼Œè¿˜èƒ½æŸ¥çœ‹åˆ°æ‰€æœ‰æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ–¹ä¾¿æ’æŸ¥ã€‚è¾“å‡ºçš„ä¿¡æ¯å¯ä»¥åœ¨ /tmp/rc.local.log æ–‡ä»¶ä¸­æ‰¾åˆ°ã€‚ 2. ä¿®æ”¹ rc.local æ–‡ä»¶å¤´éƒ¨åœ¨æŸäº›ç³»ç»Ÿä¸Šï¼Œrc.local æ–‡ä»¶çš„é»˜è®¤è§£é‡Šå™¨å¯èƒ½ä¸æ”¯æŒæŸäº› Bash ç‰¹æ€§ã€‚å¦‚æœé‡åˆ°å…¼å®¹æ€§é—®é¢˜ï¼Œå¯ä»¥å°†æ–‡ä»¶å¤´éƒ¨çš„ /bin/sh ä¿®æ”¹ä¸º /bin/bashï¼š #!/bin/bash ä½¿ç”¨ Bash è§£é‡Šå™¨å¯ä»¥ç¡®ä¿è„šæœ¬ä¸­ä½¿ç”¨çš„æ‰€æœ‰åŠŸèƒ½éƒ½èƒ½å¤Ÿæ­£å¸¸è¿ä½œã€‚ 3. æä¾›æ‰§è¡Œæƒé™å¦‚æœéœ€è¦æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Shell è„šæœ¬ï¼Œæ¯”å¦‚ xxx.shï¼Œåˆ™å¿…é¡»ç¡®ä¿å®ƒå…·å¤‡æ‰§è¡Œæƒé™ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æˆäºˆæ‰§è¡Œæƒé™ï¼š sudo chmod +x xxx.sh åœ¨å¯åŠ¨æ—¶ï¼Œå»ºè®®ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ ¼å¼ç¡®ä¿è„šæœ¬ä»¥æ­£ç¡®çš„æ–¹å¼è¿è¡Œï¼š sudo sh xxx.sh è¿™æ ·åšå°†ç¡®ä¿æ— è®ºæ˜¯æƒé™é—®é¢˜è¿˜æ˜¯ç¯å¢ƒå˜é‡è®¾ç½®ï¼Œéƒ½èƒ½é¡ºåˆ©æ‰§è¡Œè„šæœ¬ã€‚ ä½¿ç”¨ update-rc.d å¢åŠ å¼€æœºå¯åŠ¨æœåŠ¡ç»™ Ubuntu ç³»ç»Ÿæ·»åŠ ä¸€ä¸ªå¼€æœºå¯åŠ¨è„šæœ¬çš„å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š æ–°å»ºè„šæœ¬æ–‡ä»¶ new_service.shåˆ›å»ºä¸€ä¸ªæ–°çš„ shell è„šæœ¬æ–‡ä»¶ï¼Œå¹¶å†™å…¥éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚è„šæœ¬çš„åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š #!/bin/bash# command contentexit 0 åœ¨è¿™é‡Œï¼Œ# command content åº”æ›¿æ¢ä¸ºåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶éœ€è¦æ‰§è¡Œçš„å…·ä½“å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¸Œæœ›åœ¨å¼€æœºæ—¶å¯åŠ¨ä¸€ä¸ªè‡ªå®šä¹‰çš„åº”ç”¨ç¨‹åºï¼Œåˆ™å¯ä»¥å°†å…¶è·¯å¾„æ·»åŠ åˆ°è¯¥ä½ç½®ã€‚exit 0 è¡¨ç¤ºè„šæœ¬æˆåŠŸå®Œæˆï¼Œæ²¡æœ‰é”™è¯¯å‘ç”Ÿã€‚ è®¾ç½®æƒé™ä¸ºäº†ç¡®ä¿æ–°å»ºçš„è„šæœ¬å¯ä»¥è¢«ç³»ç»Ÿæ‰§è¡Œï¼Œéœ€è¦è®¾ç½®åˆé€‚çš„æƒé™ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š sudo chmod 755 new_service.sh æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨æ›´ç®€æ´çš„å‘½ä»¤ï¼š sudo chmod +x new_service.sh è¿™ç¡®ä¿æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½å¤Ÿæ‰§è¡Œè¯¥è„šæœ¬ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒè¯»å’Œå†™çš„æƒé™ã€‚ æŠŠè„šæœ¬æ”¾ç½®åˆ°å¯åŠ¨ç›®å½•ä¸‹å°†è„šæœ¬ç§»åŠ¨åˆ°ç³»ç»Ÿçš„åˆå§‹åŒ–ç›®å½• /etc/init.d/ã€‚è¯¥ç›®å½•ä¸“é—¨å­˜æ”¾åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶éœ€è¦è¿è¡Œçš„æœåŠ¡è„šæœ¬ã€‚æ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š sudo mv new_service.sh /etc/init.d/ å°†è„šæœ¬æ·»åŠ åˆ°å¯åŠ¨è„šæœ¬ä½¿ç”¨ update-rc.d å‘½ä»¤æ¥æ³¨å†Œè„šæœ¬ä¸ºå¼€æœºå¯åŠ¨ã€‚æ‰§è¡Œæ—¶ï¼Œ90 æ˜¯ä¼˜å…ˆçº§å‚æ•°ï¼Œå€¼è¶Šé«˜æ„å‘³ç€è¯¥è„šæœ¬çš„å¯åŠ¨æ—¶é—´è¶Šæ™šã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š cd /etc/init.d/sudo update-rc.d new_service.sh defaults 90 ç§»é™¤ Ubuntu å¼€æœºè„šæœ¬è‹¥éœ€è¦åˆ é™¤å·²ç»æ·»åŠ çš„å¼€æœºå¯åŠ¨è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š sudo update-rc.d -f new_service.sh remove è¯¥å‘½ä»¤ä¼šå¼ºåˆ¶ç§»é™¤è„šæœ¬ï¼Œå¹¶æ¸…ç†æ‰€æœ‰é“¾æ¥åˆ° /etc/init.d/ çš„å¯åŠ¨é¡¹ï¼Œç¡®ä¿ä¸ä¼šåœ¨å¼€æœºæ—¶å†æ¬¡æ‰§è¡Œã€‚ é€šè¿‡ sysv-rc-conf ç®¡ç†å¯åŠ¨æœåŠ¡çš„å¯åŠ¨çº§åˆ«sysv-rc-conf å·¥å…·æä¾›äº†ç›´è§‚çš„ç•Œé¢ï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†å¼€æœºå¯åŠ¨é¡¹ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰“å¼€é…ç½®ç•Œé¢ï¼š sudo sysv-rc-conf åœ¨è¯¥ç•Œé¢ä¸­ï¼Œå¯ä»¥ç›´è§‚åœ°å¼€å¯æˆ–å…³é—­ç‰¹å®šæœåŠ¡åœ¨ä¸åŒè¿è¡Œçº§åˆ«ä¸‹çš„å¯åŠ¨çŠ¶æ€ã€‚ update-rc.d çš„è¯¦ç»†å‚æ•°ä½¿ç”¨ update-rc.d å‘½ä»¤æ—¶ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚æŒ‡å®šè„šæœ¬åç§°å’Œå‚æ•°ã€‚å…·ä½“çš„å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼ˆéœ€åœ¨ root æƒé™ä¸‹æ‰§è¡Œï¼‰ï¼š update-rc.d [-n] [-f] removeupdate-rc.d [-n] defaultsupdate-rc.d [-n] disable|enable [S|2|3|4|5]update-rc.d start|stop å‚æ•°è¯´æ˜ï¼š -n: åªåšæµ‹è¯•ï¼Œä¸å®é™…æ‰§è¡Œæ“ä½œã€‚ -f: å¼ºåˆ¶æ‰§è¡Œæ“ä½œã€‚ å®ä¾‹è¯´æ˜ï¼š (1) æ·»åŠ æ–°çš„å¯åŠ¨è„šæœ¬å‡è®¾éœ€è¦æ·»åŠ ä¸€ä¸ªåä¸º sample_init_script çš„æ–°å¯åŠ¨è„šæœ¬ï¼Œå¹¶æŒ‡å®šå®ƒçš„é»˜è®¤å¯åŠ¨é¡ºåºå’Œè¿è¡Œçº§åˆ«ã€‚å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š update-rc.d sample_init_script defaults è¿™æ¡å‘½ä»¤å®é™…ä¸Šç­‰åŒäºä¸‹é¢çš„å‘½ä»¤ï¼š update-rc.d sample_init_script start 20 2 3 4 5 . stop 20 0 1 6 å…¶ä¸­çš„ 20 è¡¨ç¤ºåœ¨å¯åŠ¨æ—¶çš„ä¼˜å…ˆçº§ï¼ŒSã€2ã€3ã€4ã€5 è¡¨ç¤ºä¸åŒçš„è¿è¡Œçº§åˆ«ã€‚ (2) æŒ‡å®šå¯åŠ¨é¡ºåºä¸º 50 çš„è„šæœ¬å¦‚æœè¦å®‰è£… sample_init_script å¹¶å°†å…¶å¯åŠ¨é¡ºåºè®¾ä¸º 50ï¼Œå¯ä»¥æ‰§è¡Œï¼š update-rc.d sample_init_script defaults 50 (3) ç®¡ç†å¤šä¸ªè„šæœ¬çš„å¯åŠ¨é¡ºåºå‡è®¾æœ‰ä¸¤ä¸ªè„šæœ¬ A å’Œ Bï¼ŒA åº”åœ¨ B å¯åŠ¨ä¹‹å‰ï¼Œä¸”åœ¨ B åœæ­¢ä¹‹åã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®å®ƒä»¬çš„å¯åŠ¨é¡ºåºï¼š update-rc.d A 10 40update-rc.d B 20 30 (4) åˆ é™¤å¯åŠ¨è„šæœ¬è‹¥è¦åˆ é™¤ sample_init_script è„šæœ¬ï¼ˆå¦‚æœè¯¥è„šæœ¬ä¸å­˜åœ¨åˆ™è·³è¿‡ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š update-rc.d -f sample_init_script remove è¯¥å‘½ä»¤ä¼šæ¸…ç†æ‰€æœ‰æŒ‡å‘ /etc/init.d/sample_init_script çš„é“¾æ¥ï¼ŒåŒ…æ‹¬åœ¨ /etc/rcX.d ç›®å½•ä¸‹çš„ç›¸å…³é“¾æ¥ã€‚ (5) ç¦æ­¢ Apache å’Œ MySQL ç»„ä»¶å¼€æœºè‡ªå¯å¦‚æœéœ€è¦å–æ¶ˆ Apache å’Œ MySQL ç»„ä»¶çš„å¼€æœºè‡ªå¯ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š update-rc.d -f apache2 removeupdate-rc.d -f mysql remove æ‰§è¡Œè¿™äº›å‘½ä»¤åï¼Œç³»ç»Ÿå°†åœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶ä¸ä¼šè‡ªåŠ¨åŠ è½½ Apache å’Œ MySQL æœåŠ¡ï¼Œä»è€Œä½¿å…¶ä¸å†å ç”¨ç³»ç»Ÿèµ„æºã€‚ è‡ªå¯åŠ¨æœåŠ¡åœ¨ /etc/systemd/system/my_startup.service æˆ– /usr/lib/systemd/system/startmyapp.service ç¼–è¾‘æˆ–åˆ›å»ºä¸€ä¸ªæœåŠ¡æ–‡ä»¶ [Unit]Description=API Server for Klipper SV1Documentation=https://moonraker.readthedocs.io/Requires=network-online.targetAfter=network-online.target[Install]WantedBy=multi-user.target[Service]Type=simpleUser=forlinxSupplementaryGroups=moonraker-adminRemainAfterExit=yesWorkingDirectory=/home/forlinx/moonrakerEnvironmentFile=/home/forlinx/printer_data/systemd/moonraker.envExecStart=/home/forlinx/moonraker-env/bin/python $MOONRAKER_ARGSRestart=alwaysRestartSec=10 åŠ è½½æœåŠ¡åˆ°è‡ªå¯åŠ¨ä¸­ sudo systemctl daemon-reloadsudo systemctl enable my_startup æ“ä½œæœåŠ¡ # è®¾ç½®å¼€æœºè‡ªå¯åŠ¨systemctl enable startmyapp.service# åœæ­¢å¼€æœºè‡ªå¯åŠ¨systemctl disable startmyapp.service# å¯åŠ¨æœåŠ¡systemctl start startmyapp.service# å…³é—­æœåŠ¡systemctl stop startmyapp.service# é‡æ–°å¯åŠ¨æœåŠ¡systemctl restart startmyapp.service# é‡æ–°åŠ è½½æœåŠ¡é…ç½®æ–‡ä»¶systemctl reload startmyapp.service# æŸ¥çœ‹æœåŠ¡å½“å‰çŠ¶æ€systemctl status startmyapp.service# æŸ¥çœ‹æ‰€æœ‰å·²å¯åŠ¨çš„æœåŠ¡systemctl list-units --type=services# æŸ¥è¯¢æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨systemctl is-enabled startmyapp.service æŸ¥çœ‹å…¨éƒ¨æœåŠ¡åˆ—è¡¨å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹ç³»ç»Ÿä¸­æ‰€æœ‰çš„æœåŠ¡åŠå…¶çŠ¶æ€ï¼š sudo service --status-all æ­¤å‘½ä»¤ä¼šåˆ—å‡ºæ‰€æœ‰å·²æ³¨å†ŒæœåŠ¡ï¼Œæ˜¾ç¤ºå®ƒä»¬å½“å‰çš„è¿è¡ŒçŠ¶æ€ã€‚è¾“å‡ºä¿¡æ¯é€šå¸¸åŒ…æ‹¬ä¸€ä¸ªå­—ç¬¦å’ŒæœåŠ¡çš„åç§°ï¼Œå…¶ä¸­ + è¡¨ç¤ºæœåŠ¡æ­£åœ¨è¿è¡Œï¼Œ- è¡¨ç¤ºæœåŠ¡å·²åœæ­¢ï¼Œ? åˆ™è¡¨ç¤ºæœåŠ¡çš„çŠ¶æ€ä¸æ˜ç¡®ã€‚ å­—æ®µè§£é‡Š disable|enableï¼šè¿™ä¸¤ä¸ªå…³é”®å­—æŒ‡çš„æ˜¯æœåŠ¡åœ¨ /etc/init.d ç›®å½•ä¸‹çš„è„šæœ¬æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ ‡è¯†è¯¥æœåŠ¡æ˜¯å¦è®¾ç½®ä¸ºæ‰‹åŠ¨å¯åŠ¨æˆ–è‡ªåŠ¨å¯åŠ¨ã€‚ ä¾‹å¦‚ï¼šå¦‚æœæŸä¸ªæœåŠ¡çš„è„šæœ¬è¢«æ ‡è®°ä¸º enableï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½è¯¥æœåŠ¡ã€‚ start|stopï¼šè¿™äº›å‘½ä»¤æŒ‡ç¤ºæœåŠ¡çš„å¯åŠ¨æˆ–åœæ­¢ã€‚åŒæ ·ï¼Œè¿™äº›è„šæœ¬ä¹Ÿä½äº /etc/init.d ä¸­ï¼Œä½†æ›´å…·ä½“åœ°è¯´æ˜äº†æœåŠ¡çš„å½“å‰çŠ¶æ€ã€‚ ä¾‹å¦‚ï¼šsudo service service_name start ä¼šå¯åŠ¨å¯¹åº”çš„æœåŠ¡ï¼Œè€Œ sudo service service_name stop åˆ™ä¼šåœæ­¢å®ƒã€‚ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥éšæ—¶æ ¹æ®éœ€æ±‚è°ƒæ•´æœåŠ¡çš„è¿è¡ŒçŠ¶æ€ã€‚ NNï¼šè¿™æ˜¯ä¸€ä¸ªç”±ä¸¤ä½æ•°å­—æ„æˆçš„å€¼ï¼Œç”¨äºæŒ‡å®šæœåŠ¡çš„å¯åŠ¨é¡ºåºã€‚è¾ƒå¤§çš„æ•°å­—ä¼šè¢«ä¼˜å…ˆå¤„ç†ï¼Œç¡®ä¿ä¾èµ–è¾ƒå¤šçš„æœåŠ¡ä¼˜å…ˆå¯åŠ¨ã€‚ ä¾‹å¦‚ï¼šå¦‚æœæœ‰ä¸¤ä¸ªæœåŠ¡ï¼Œåˆ†åˆ«æ ‡è®°ä¸º 90 å’Œ 80ï¼Œè¿™æ„å‘³ç€è®¾ç½®ä¸º 80 çš„æœåŠ¡ä¼šåœ¨è®¾ç½®ä¸º 90 çš„æœåŠ¡ä¹‹å‰å¯åŠ¨æˆ–åœæ­¢ã€‚è¿™ç§æœºåˆ¶ç¡®ä¿äº†ç³»ç»Ÿå†…å„æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»å¾—åˆ°åˆç†ç®¡ç†ã€‚ runlevelï¼šè¿™è¡¨ç¤ºç³»ç»Ÿå½“å‰çš„è¿è¡Œçº§åˆ«ï¼Œå¯ä»¥æ§åˆ¶ç³»ç»Ÿå¯åŠ¨æ—¶å„ä¸ªæœåŠ¡çš„åŠ è½½çŠ¶æ€ã€‚åœ¨ UNIX ç³»ç»Ÿä¸­ï¼Œè¿è¡Œçº§åˆ«å®šä¹‰äº†ç³»ç»Ÿå…è®¸çš„åŠŸèƒ½å’ŒæœåŠ¡çŠ¶æ€ã€‚ ä¾‹å¦‚ï¼šåœ¨ç»å…¸çš„ Linux ç³»ç»Ÿä¸­ï¼Œè¿è¡Œçº§åˆ« 3 é€šå¸¸æ„å‘³ç€ç³»ç»Ÿå¤„äºå¤šç”¨æˆ·æ¨¡å¼ï¼Œè€Œæ²¡æœ‰å›¾å½¢ç•Œé¢ï¼Œè€Œè¿è¡Œçº§åˆ« 5 åˆ™è¡¨ç¤ºç³»ç»Ÿåœ¨å¤šç”¨æˆ·æ¨¡å¼ä¸‹å¹¶ä¸”æœ‰å›¾å½¢ç•Œé¢ã€‚é€šè¿‡è®¾ç½®ä¸åŒçš„è¿è¡Œçº§åˆ«ï¼Œå¯ä»¥çµæ´»åœ°ç®¡ç†ç³»ç»Ÿçš„èµ„æºå’Œè®¿é—®æƒã€‚ é€šè¿‡ä»¥ä¸Šå‘½ä»¤åŠå…¶é€‰é¡¹ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†å’Œç›‘æ§ç³»ç»Ÿä¸­æ‰€æœ‰çš„æœåŠ¡çŠ¶æ€ï¼Œä»è€Œç¡®ä¿ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œå’Œèµ„æºçš„åˆç†åˆ©ç”¨ã€‚ æŸ¥çœ‹æœåŠ¡çŠ¶æ€journalctl æ˜¯ Systemd æ—¥å¿—æ”¶é›†æœåŠ¡ journal çš„ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ã€‚å®ƒå…è®¸ç”¨æˆ·æŸ¥è¯¢å’Œæ“ä½œ systemd journal ä¸­çš„æ—¥å¿—æ¡ç›®ã€‚è¿™å¯¹äºè¯Šæ–­ç³»ç»ŸæœåŠ¡é—®é¢˜ã€è¿½è¸ªé”™è¯¯æˆ–è€…ç›‘æ§ç³»ç»Ÿäº‹ä»¶éå¸¸æœ‰ç”¨ã€‚ä¸‹é¢æ˜¯å‡ ä¸ªä½¿ç”¨ journalctl çš„åŸºæœ¬å‘½ä»¤ç¤ºä¾‹ï¼š æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šæ˜¾ç¤ºç³»ç»Ÿä¸­æ‰€æœ‰æœåŠ¡çš„æ—¥å¿—ã€‚ journalctl æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„æ—¥å¿—ï¼Œå°†æœåŠ¡åæ›¿æ¢ä¸ºæƒ³æŸ¥çœ‹æœåŠ¡çš„æ—¥å¿—åç§°ï¼Œä¾‹å¦‚æŸ¥çœ‹ nginx æœåŠ¡æ—¥å¿—ï¼š journalctl -u æœåŠ¡å.servicejournalctl -u nginx.service å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šåƒ tail -f ä¸€æ ·å®æ—¶æ˜¾ç¤ºæ–°çš„æ—¥å¿—æ¡ç›®ã€‚ journalctl -f æŸ¥çœ‹ç‰¹å®šæ—¶é—´èŒƒå›´å†…çš„æ—¥å¿—ï¼Œè¿™ä¸ªä¾‹å­ä¼šæ˜¾ç¤ºä» 2023 å¹´ 4 æœˆ 1 æ—¥ 0 ç‚¹åˆ° 23 ç‚¹ 59 åˆ† 59 ç§’ä¹‹é—´çš„æ—¥å¿—ã€‚ journalctl --since 2023-04-01 00:00:00 --until 2023-04-01 23:59:59 æŸ¥çœ‹åŒ…å«ç‰¹å®šå…³é”®è¯çš„æ—¥å¿—ï¼Œä½¿ç”¨ grep ç»“åˆ journalctl æ¥è¿‡æ»¤ç‰¹å®šå…³é”®è¯ï¼Œä¾‹å¦‚æŸ¥æ‰¾åŒ…å«â€errorâ€çš„æ—¥å¿—ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ journalctl çš„ grep å‚æ•°ï¼ˆ-g æˆ–â€“grepï¼‰ï¼š journalctl | grep errorjournalctl -u æœåŠ¡å.service --grep å…³é”®å­— æ¸…ç©ºæ—¥å¿—ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šåˆ é™¤æ‰€æœ‰è¶…è¿‡ 1 å¤©çš„æ—¥å¿—æ¡ç›®ã€‚è¯·æ³¨æ„ï¼Œè¿™å°†æ°¸ä¹…åˆ é™¤æ—¥å¿—æ•°æ®ã€‚ journalctl --vacuum-time=1d","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç³»ç»Ÿå‚æ•°"]},{"title":"ç½‘ç»œè¶…æ—¶æ£€æµ‹çš„ä¸‰ç§æ–¹æ³•","path":"/2024/04/30/1-å¹³å°ç³»ç»Ÿ-Linux-ç½‘ç»œ-ç½‘ç»œè¶…æ—¶æ£€æµ‹çš„ä¸‰ç§æ–¹æ³•/","content":"ç½‘ç»œè¶…æ—¶æ£€æµ‹çš„ä¸‰ç§æ–¹æ³• ç½‘ç»œé€šä¿¡ä¸­ï¼Œå¾ˆå¤šæ“ä½œä¼šä½¿å¾—è¿›ç¨‹é˜»å¡ï¼Œè¿™æ—¶ä»¬è¦è®¾å®šæ—¶é—´ï¼Œåˆ°æ—¶é—´åå¼ºåˆ¶è¿”å›ï¼Œé¿å…è¿›ç¨‹åœ¨æ²¡æœ‰æ•°æ®çš„æƒ…å†µä¸‹æ— é™é˜»å¡ è¿™é‡Œä»¬æ€»ç»“ä¸€ä¸‹ç½‘ç»œè¶…æ—¶æ£€æµ‹çš„ä¸‰ç§æ–¹æ³•ï¼š ä¸€ã€é€šè¿‡ setsockopt è®¾ç½®å¥—æ¥å­—å±æ€§ SO_RCVTIMEO struct timeval t = 5, 0if (setsockopt(listenfd, SOL_SOCKET, SO_RCVTIMEO, t, sizeof(t)) == -1) perror(setsockopt); return -1;memset(peeraddr, 0, sizeof(peeraddr));len = sizeof(peeraddr);if ((connfd = accept(listenfd, (struct sockaddr *)peeraddr, len)) == -1) printf(errno=%d: %s , errno, strerror(errno));\tif (errno == EAGAIN) printf(timeout ); return -1; äºŒã€è®¾å®š select å‡½æ•°çš„ä¸€ä¸ªå‚æ•°å®ç°è¶…æ—¶å¤„ç† struct timeval t= 3, 0;while (1) t.tv_sec = 3;\tt.tv_usec = 0;\tif ((ret = select(maxfd+1, rdfs, NULL, NULL, t)) == -1) perror(select); return -1; ä¸‰ã€è®¾å®šä¸€ä¸ªå®šæ—¶å™¨æ•æ‰ SIGALRM ä¿¡å·åšè¶…æ—¶æ§åˆ¶ struct sigaction act;sigaction(SIGALRM, NULL, act); //è·å–SIGALRMä¿¡å·çš„å±æ€§act.sa_handler = handler; // è®¾ç½®SIGALRMä¿¡å·çš„å¤„ç†å‡½æ•°sigaction(SIGALRM, act, NULL); // è®¾ç½®SIGALRMä¿¡å·çš„å±æ€§alarm(3); // å®šæ—¶å™¨è®¾ç½®3ç§’é’Ÿwhile (1) if ((connfd = accept(listenfd, (struct sockaddr *)peeraddr, len)) == -1) if (errno == EINTR) printf(timeout ); return -1; å®šæ—¶å™¨ 3 ç§’é’Ÿå†…æ²¡æœ‰æ•°æ®åˆ°æ¥ï¼Œå†…æ ¸äº§ç”Ÿ SIGALRM ä¿¡å·ä¸­æ–­å½“å‰æ“ä½œã€‚ä»¬çŸ¥é“è®¾ç½®ä¿¡å·æ•æ‰å‡½æ•°å¯ä»¥ç”¨ signal å‡½æ•°æˆ–æ˜¯ sigaction å‡½æ•°ã€‚ä½†è¿™é‡Œåªèƒ½ä½¿ç”¨ sigaction å‡½æ•°ï¼Œå› ä¸º signal è®¾ç½®çš„ä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œå®Œåä¼šé‡æ–°æ‰§è¡Œè¢«ä¸­æ–­çš„æ“ä½œ","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç½‘ç»œ"]},{"title":"ç½‘ç»œé…ç½®","path":"/2024/04/29/1-å¹³å°ç³»ç»Ÿ-Linux-ç½‘ç»œ-ç½‘ç»œé…ç½®/","content":"è¿›å…¥åˆ° Ubuntu ç³»ç»Ÿä¸­é…ç½®ç½‘ç»œæ˜¯ç¡®ä¿è®¡ç®—æœºèƒ½å¤Ÿé¡ºåˆ©è¿æ¥äº’è”ç½‘çš„å…³é”®æ­¥éª¤ã€‚ä¸»è¦éœ€è¦é…ç½®ä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„å†…å®¹ï¼š 1. ä¿®æ”¹æ–‡ä»¶ /etc/network/interfacesæ­¤æ–‡ä»¶ç”¨äºé…ç½® IPã€ç½‘å…³ã€æ©ç ç­‰ç½‘ç»œä¿¡æ¯ã€‚ å‘½ä»¤ï¼š sudo vi /etc/network/interfaces æˆ– sudo gedit /etc/network/interfaces ç¤ºä¾‹é…ç½®ï¼š # interfaces(5) file used by ifup(8) and ifdown(8)auto loiface lo inet loopbackauto eth0iface eth0 inet static address 192.168.1.151 netmask 255.255.255.0 gateway 192.168.1.2 æ³¨æ„ï¼šè®¾ç½®ç½‘å…³æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ sudo route add default gw 192.168.1.1ã€‚ç¡®ä¿ç½‘å…³åœ°å€ä¸ Virtual Network Editor ä¸­çš„ â€œNAT Settingsâ€¦â€ ä¸€è‡´ï¼Œé€šå¸¸ä¸º 192.168.xx.2ã€‚ 2. ä¿®æ”¹æ–‡ä»¶ /etc/resolv.confè¯¥æ–‡ä»¶ä¿å­˜ DNS æœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯ã€‚ å‘½ä»¤ï¼š sudo vi /etc/resolv.conf æˆ– sudo gedit /etc/resolv.conf ç¤ºä¾‹é…ç½®ï¼š nameserver 202.38.64.1 è¿™é‡Œçš„ DNS æœåŠ¡å™¨åœ°å€å¯ä»¥æ ¹æ®å®é™…ç¯å¢ƒè°ƒæ•´ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨æ ¡å›­ç½‘çš„ DNSï¼Œç¡®ä¿èƒ½å¤Ÿæ­£å¸¸è§£æåŸŸåã€‚ 3. è§£å†³ resolv.conf è¢«é‡å†™é—®é¢˜æ¯å½“é‡å¯è™šæ‹Ÿæœºæˆ–ç½‘ç»œæ—¶ï¼Œ/etc/resolv.conf æ–‡ä»¶å¯èƒ½ä¼šè¢«é‡å†™ï¼Œæ¢å¤ä¸ºé»˜è®¤é…ç½®ï¼Œå¯¼è‡´å…ˆå‰ä¿å­˜çš„ DNS è®¾ç½®ä¸¢å¤±ã€‚è¿™ä¸€é—®é¢˜éœ€è¦è§£å†³ï¼Œä»¥é¿å…æ¯æ¬¡éƒ½æ‰‹åŠ¨é…ç½®ã€‚ è§£å†³æ­¥éª¤ï¼š ç†è§£ resolv.conf è¢«é‡å†™çš„åŸå› ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ–‡ä»¶çš„å¼€å¤´ä¼šç»™å‡ºæç¤ºã€‚ åœ¨ /etc/network/interfaces ä¸­å¢åŠ  dns-nameservers å‚æ•°ã€‚è¯¥å‚æ•°çš„ä¼˜å…ˆçº§é«˜äº resolv.confï¼Œç½‘ç»œä¼šé¦–å…ˆè¯»å–æ­¤è®¾ç½®ã€‚ ç¤ºä¾‹é…ç½®ï¼š # interfaces(5) file used by ifup(8) and ifdown(8)auto loiface lo inet loopbackauto eth0iface eth0 inet static address 192.168.1.151 netmask 255.255.255.0 gateway 192.168.1.2 dns-nameservers 202.38.64.1 4. é‡å¯è™šæ‹Ÿæœºç½‘ç»œé…ç½®å®Œæˆåï¼Œéœ€è¦é‡å¯ç½‘ç»œæ‰èƒ½ä½¿è®¾ç½®ç”Ÿæ•ˆã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹æ³•æ¥å®ç°ï¼š é‡å¯ç½‘ç»œæœåŠ¡ï¼š sudo service networking restart æˆ– sudo /etc/init.d/networking restart é‡å¯ç‰¹å®šç½‘å¡ï¼š sudo ifconfig eth0 downsudo ifconfig eth0 up é‡å¯ç½‘å¡ä¸ä¼šå½±å“å…¶ä»–ç½‘å¡ï¼Œå› æ­¤æ›´ä¸ºæ¨èè¿™ç§æ–¹æ³•ã€‚ æµ‹è¯•ç½‘ç»œè¿æ¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ç½‘ç»œæ˜¯å¦é…ç½®æˆåŠŸï¼š ping www.baidu.com å¦‚æœæˆåŠŸå“åº”ï¼Œè¡¨æ˜ç½‘ç»œè¿æ¥æ­£å¸¸ï¼Œå¯ä»¥é¡ºåˆ©ä¸Šç½‘ã€‚ Linux çš„ç½‘ç»œæ¥å£è®¾å¤‡åœ¨ Linux æ“ä½œç³»ç»Ÿä¸­ï¼Œç½‘ç»œæ¥å£æ˜¯å®ç°ç½‘ç»œé€šä¿¡çš„é‡è¦ç»„ä»¶ï¼Œæ¯ä¸ªå¤–å›´è®¾å¤‡çš„ç½‘ç»œæ¥å£éƒ½æœ‰ç›¸åº”çš„åç§°ï¼Œè¿™äº›åç§°éµå¾ªç‰¹å®šçš„å‘½åè§„åˆ™ï¼Œæœ‰åŠ©äºç”¨æˆ·å’Œç³»ç»Ÿå¯¹ç½‘ç»œè®¾å¤‡è¿›è¡Œç®¡ç†å’Œæ“ä½œã€‚ ç½‘ç»œæ¥å£è®¾å¤‡åŠå…¶åç§°ä»¥ä¸‹æ˜¯ Linux ç³»ç»Ÿä¸­å¸¸è§çš„ç½‘ç»œæ¥å£è®¾å¤‡åç§°åŠå…¶è§£é‡Šï¼š loï¼šæœ¬åœ°å›é€æ¥å£ã€‚è¯¥æ¥å£çš„ä¸»è¦åŠŸèƒ½æ˜¯å…è®¸ç½‘ç»œè½¯ä»¶åœ¨æœ¬åœ°è¿›è¡Œæµ‹è¯•å’Œè¿›ç¨‹é—´é€šä¿¡ã€‚ä»»ä½•ç¨‹åºåœ¨ä½¿ç”¨å›é€åœ°å€ï¼ˆé€šå¸¸æ˜¯ 127.0.0.1ï¼‰å‘é€æ•°æ®æ—¶ï¼Œåè®®è½¯ä»¶ä¼šç«‹å³å°†è¿™äº›æ•°æ®è¿”å›ï¼Œè€Œä¸ä¼šç»è¿‡å®é™…çš„ç½‘ç»œä¼ è¾“ã€‚å›é€æ¥å£çš„ä¸€ä¸ªå…¸å‹åº”ç”¨æ˜¯å¼€å‘äººå‘˜æµ‹è¯•ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚åœ¨æ²¡æœ‰ç½‘ç»œè¿æ¥çš„æƒ…å†µä¸‹éªŒè¯åº”ç”¨çš„åŸºæœ¬åŠŸèƒ½ã€‚åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå›é€è®¾å¤‡æ˜¯é¢„å…ˆé…ç½®å¥½çš„ï¼Œå› æ­¤ä¸éœ€è¦é¢å¤–çš„è®¾ç½®ã€‚ ethnï¼šç¬¬ n ä¸ªä»¥å¤ªç½‘å¡æ¥å£ã€‚å…¶ä¸­ï¼Œn çš„å€¼ä» 0 å¼€å§‹é€’å¢ï¼Œè¡¨ç¤ºç³»ç»Ÿä¸­çš„ç¬¬ä¸€ä¸ªã€ç¬¬äºŒä¸ªã€ç¬¬ä¸‰ä¸ªä»¥å¤ªç½‘å¡ç­‰ã€‚ä»¥å¤ªç½‘å¡æ˜¯å¤§å¤šæ•°è®¡ç®—æœºçš„æ ‡å‡†ç½‘ç»œæ¥å£ï¼Œå…¶æ¥å£åä¸­çš„ â€œethâ€ éƒ¨åˆ†è¯†åˆ«äº†ä»¥å¤ªç½‘ç±»å‹ï¼Œè€Œ n è¡¨ç¤ºå¡çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œå¦‚æœç³»ç»Ÿä¸­æœ‰ä¸¤å—ä»¥å¤ªç½‘å¡ï¼Œåˆ™å®ƒä»¬åˆ†åˆ«è¢«å‘½åä¸º eth0 å’Œ eth1ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å‘½ä»¤ ifconfig æˆ– ip link æ¥æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£çš„çŠ¶æ€å’Œé…ç½®ã€‚ pppnï¼šç¬¬ n ä¸ª PPPï¼ˆç‚¹å¯¹ç‚¹åè®®ï¼‰æ¥å£ã€‚PPP æ¥å£é€šå¸¸ç”¨äºé€šè¿‡ä¸²å£å’Œè°ƒåˆ¶è§£è°ƒå™¨å»ºç«‹äº’è”ç½‘è¿æ¥ï¼Œå°¤å…¶æ˜¯åœ¨æ‹¨å·ä¸Šç½‘çš„åœºæ™¯ä¸­æ¯”è¾ƒå¸¸è§ã€‚æ¯ä¸ª PPP æ¥å£æŒ‰ç…§å…¶é…ç½®çš„é¡ºåºè¿›è¡Œè¿æ¥ã€‚ä¾‹å¦‚ï¼Œè‹¥ç³»ç»Ÿä¸­é…ç½®äº†ä¸¤æ¡é€šè¿‡ PPP åè®®çš„çº¿è·¯ï¼Œåˆ™å¯ä»¥ç§°ä¹‹ä¸º ppp0 å’Œ ppp1ã€‚å¯¹äºéœ€è¦é€šè¿‡æ‹¨å·è¿æ¥åˆ°äº’è”ç½‘çš„åœºæ™¯ï¼Œé…ç½® PPP æ¥å£æ˜¯ä¸€ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆã€‚ ç½‘ç»œé…ç½®å‘½ä»¤ hostname ç”¨äºæŸ¥çœ‹æˆ–é…ç½®è®¡ç®—æœºçš„ä¸»æœºåã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å‘½ä»¤ hostname Linux å¯ä»¥å°†ä¸»æœºåè®¾ç½®ä¸ºâ€œLinuxâ€ã€‚ä¸»æœºåä¸ä»…åœ¨ç½‘ç»œä¸­è¯†åˆ«è®¾å¤‡ï¼Œä¹Ÿä¸ºç”¨æˆ·æä¾›äº†ä¾¿åˆ©ï¼Œå°¤å…¶æ˜¯åœ¨ç®¡ç†å¤šå°æœåŠ¡å™¨æ—¶ã€‚ ifconfig è¯¥å‘½ä»¤ç”¨äºæŸ¥çœ‹æˆ–é…ç½®ç½‘ç»œæ¥å£ã€‚åœ¨æ‰§è¡Œ ifconfig åï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºæ‰€æœ‰ç½‘ç»œæ¥å£çš„çŠ¶æ€åŠå…¶å½“å‰é…ç½®ï¼Œå¦‚ IP åœ°å€ã€ç½‘ç»œæ©ç å’Œä¼ è¾“çŠ¶æ€ç­‰ã€‚é€šè¿‡è¯¥å‘½ä»¤ï¼Œç”¨æˆ·å¯ä»¥å¿«é€Ÿè¯Šæ–­ç½‘ç»œé—®é¢˜ã€‚ ifup è¿™ä¸ªå‘½ä»¤ç”¨äºå¯ç”¨æŒ‡å®šçš„ç½‘ç»œæ¥å£ã€‚ä¾‹å¦‚ï¼Œè¿è¡Œ ifup eth0 å°†æ¿€æ´»åä¸ºâ€œeth0â€çš„ç½‘ç»œæ¥å£ï¼Œå…è®¸æ•°æ®åŒ…çš„å‘é€å’Œæ¥æ”¶ã€‚ ifdown ä¸ ifup ç›¸åï¼Œifdown ç”¨æ¥ç¦ç”¨æŒ‡å®šçš„ç½‘ç»œæ¥å£ã€‚æ‰§è¡Œ ifdown eth0 å°†å…³é—­è¯¥æ¥å£ï¼Œæ•°æ®ä¼ è¾“å°†åœæ­¢ï¼Œç”¨äºè¿›è¡Œç»´æŠ¤æˆ–æ•…éšœæ’æŸ¥ã€‚ route æ­¤å‘½ä»¤ç”¨äºæŸ¥çœ‹æˆ–é…ç½®å†…æ ¸è·¯ç”±è¡¨çš„é…ç½®æƒ…å†µã€‚é€šè¿‡è¿è¡Œ route -nï¼Œç”¨æˆ·å¯æŸ¥çœ‹è·¯ç”±è¡¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚ç›®çš„åœ°ã€ç½‘å…³å’Œç½‘ç»œæ¥å£ç­‰ä¿¡æ¯ï¼Œä»è€Œç¡®å®šæ•°æ®åŒ…çš„ä¼ é€è·¯å¾„ã€‚ é…ç½®ä»¥å¤ªç½‘ç»œï¼ä½¿ç”¨å‘½ä»¤ é…ç½® IP åœ°å€ # ifconfig [interface] [ip-address] [netmask â€¦] [broadcast â€¦] [up] [down] é€šè¿‡è¿™æ¡å‘½ä»¤ï¼Œç”¨æˆ·å¯ä»¥ä¸ºç‰¹å®šçš„ç½‘ç»œæ¥å£ï¼ˆå¦‚ eth0ï¼‰åˆ†é…ä¸€ä¸ª IP åœ°å€å’Œç½‘ç»œæ©ç ã€‚ä¾‹å¦‚ï¼Œifconfig eth0 192.168.1.10 netmask 255.255.255.0 up å°†å¯åŠ¨ eth0 æ¥å£ï¼ŒåŒæ—¶æŒ‡å®šå…¶ IP åœ°å€å’Œç½‘ç»œæ©ç ã€‚ é…ç½®é»˜è®¤ç½‘å…³ # route add default gw [IP åœ°å€]# route add 0.0.0.0 netmask 0.0.0.0 eth0 è¿™äº›å‘½ä»¤å…è®¸ç”¨æˆ·è®¾ç½®é»˜è®¤ç½‘å…³ï¼Œä½¿æ•°æ®åŒ…èƒ½å¤Ÿæ­£ç¡®åœ°å‘é€åˆ°å¤–éƒ¨ç½‘ç»œã€‚æ¯”å¦‚ï¼Œroute add default gw 192.168.1.1 è®¾ç½®ç½‘å…³ä¸º 192.168.1.1ï¼Œä»è€Œä½¿å¾—ç³»ç»Ÿèƒ½é€šè¿‡è¿™ä¸ªç½‘å…³è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚ é…ç½® DNS å®¢æˆ·ç«¯ # vi /etc/resolv.conf ç¼–è¾‘ /etc/resolv.conf æ–‡ä»¶å¯ä»¥é…ç½® DNS æœåŠ¡å™¨ï¼Œä»¥ä¾¿è¿›è¡Œåç§°è§£æã€‚ä¾‹å¦‚ï¼Œæ·»åŠ  nameserver 8.8.8.8 å¯ä½¿ç”¨ Google çš„å…¬å…± DNS æœåŠ¡è¿›è¡ŒåŸŸåè§£æã€‚ TCPIP é…ç½®æ–‡ä»¶ etcsysconfignetwork è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†ç³»ç»Ÿçš„åŸºæœ¬ç½‘ç»œä¿¡æ¯ï¼Œå¯¹ç³»ç»Ÿçš„å¯åŠ¨è‡³å…³é‡è¦ã€‚ä¾‹å¦‚ï¼Œæ–‡ä»¶ä¸­å¯èƒ½æŒ‡å®šç½‘ç»œæ˜¯å¦å¯ç”¨ç­‰ä¿¡æ¯ã€‚ etcsysconfignetwork-scripts å­˜æ”¾ç½‘ç»œé…ç½®è„šæœ¬ï¼Œè´Ÿè´£ç³»ç»Ÿå¯åŠ¨æ—¶åˆå§‹åŒ–ç½‘ç»œä¿¡æ¯ã€‚è¿™é‡Œçš„æ¯ä¸ªé…ç½®è„šæœ¬éƒ½æ˜¯ä»¥â€œifcfg-â€å¼€å¤´ï¼Œè¡¨ç¤ºç›¸åº”çš„ç½‘ç»œæ¥å£é…ç½®ã€‚ etcxinetd.conf å®šä¹‰ç”±è¶…çº§è¿›ç¨‹ xinetd å¯åŠ¨çš„ç½‘ç»œæœåŠ¡ï¼Œå…è®¸ç”¨æˆ·å¯¹æœåŠ¡çš„è®¿é—®è¿›è¡Œç»†è‡´æ§åˆ¶ï¼ŒåŒ…æ‹¬é™åˆ¶ IPã€ç«¯å£å’ŒæœåŠ¡å¯åŠ¨æ–¹å¼ç­‰ã€‚ etchosts ç”¨äºä¸»æœºå’Œ IP çš„æ˜ å°„ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ä¸»æœºåè®¿é—®å…¶ä»–è®¡ç®—æœºã€‚ä¾‹å¦‚ï¼Œæ·»åŠ æ¡ç›® 192.168.1.20 myserver å¯ä»¥ç›´æ¥é€šè¿‡ myserver æ¥è®¿é—®è¿™å°è®¡ç®—æœºã€‚ etchost.conf å®šä¹‰ DNS å®¢æˆ·ç«¯çš„æœç´¢é¡ºåºï¼Œé€šå¸¸æŒ‡å®šå…ˆè¿›è¡Œ /etc/hosts æ–‡ä»¶æŸ¥æ‰¾ï¼Œç„¶åå†è¿›è¡Œ DNS æŸ¥æ‰¾ã€‚ etcresolv.conf ç”¨äºæŒ‡å®š DNS æœåŠ¡å™¨çš„åœ°å€ï¼Œç¡®ä¿ç³»ç»Ÿå¯ä»¥å°†åŸŸåè§£æä¸º IP åœ°å€ã€‚ etcservices è¯¥æ–‡ä»¶åŒ…å«äº†æœåŠ¡åç§°å’Œä¸ä¹‹å¯¹åº”çš„ç½‘ç»œç«¯å£å’Œåè®®ï¼Œå¸®åŠ©ç³»ç»Ÿè¯†åˆ«ä¸åŒæœåŠ¡çš„è®¿é—®ã€‚ etcsysconfignetwork-scriptsifcfg-eth0 ç”¨æˆ·å¯åœ¨æ­¤æ–‡ä»¶ä¸­ç¼–è¾‘ç½‘ç»œæ¥å£çš„é…ç½®ï¼Œå¦‚ IP åœ°å€ã€ç½‘å…³å’Œç«™ç‚¹ç­‰ä¿¡æ¯ã€‚ Linux æ”¯æŒä¸€å—ç½‘å¡ç»‘å®šå¤šä¸ª IP ä¾‹å¦‚ï¼Œé€šè¿‡ç¼–è¾‘å­æ¥å£é…ç½®æ–‡ä»¶ ifcfg-eth0:1ï¼Œå¯ä»¥ä¸ºåŒä¸€ç½‘ç»œæ¥å£è®¾ç½®å¤šä¸ª IP åœ°å€ï¼Œä»è€Œå®ç°æ›´çµæ´»çš„ç½‘ç»œé…ç½®ã€‚ Netconfig è°ƒç”¨èœå• é€šè¿‡è¯¥èœå•ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œç½‘ç»œè®¾ç½®ï¼Œé€šè¿‡äº¤äº’å¼ç•Œé¢å¼•å¯¼ç”¨æˆ·å®Œæˆé…ç½®ã€‚ é…ç½® ADSL ç½‘ç»œæ¥å£ å®‰è£… pppoe rpm â€“qa | grep pppoe æ­¤å‘½ä»¤ç”¨äºæ£€æŸ¥ç³»ç»Ÿä¸­æ˜¯å¦å·²å®‰è£… pppoeï¼ˆç‚¹å¯¹ç‚¹åè®®ä»¥å¤ªç½‘ï¼‰ï¼Œç¡®ä¿ç³»ç»Ÿå…·å¤‡å»ºç«‹ ADSL è¿æ¥çš„èƒ½åŠ›ã€‚ é…ç½® pppoe adsl-setup/etc/sysconfig/network-scripts/ifcfg-ppp0adsl-status ä½¿ç”¨ adsl-setup å‘½ä»¤å¼•å¯¼ç”¨æˆ·é…ç½® ADSL ç½‘ç»œï¼Œè¾“å…¥ ISP æä¾›çš„ç”¨æˆ·åå’Œå¯†ç åï¼Œpppoe ä¼šåˆ›å»ºå¿…è¦çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ /etc/sysconfig/network-scripts/ifcfg-ppp0ã€‚åç»­å¯ä»¥è¿è¡Œ adsl-status æŸ¥çœ‹å½“å‰è¿æ¥çŠ¶æ€ã€‚ å¯ç”¨å’ŒæŒ‚æ–­ ADSL ç½‘ç»œè¿æ¥ adsl-start # æˆ– ifup ppp0adsl-stop # æˆ– ifdown ppp0 ä½¿ç”¨ adsl-start å¯ä»¥å¯åŠ¨ ADSL è¿æ¥ï¼Œè€Œ adsl-stop åˆ™ç”¨æ¥å…³é—­è¿æ¥ã€‚é€šè¿‡è¿™äº›å‘½ä»¤ï¼Œç”¨æˆ·èƒ½å¤Ÿæ–¹ä¾¿åœ°æ§åˆ¶ä»–ä»¬çš„ç½‘ç»œè¿æ¥ï¼Œåˆ‡æ¢åœ¨çº¿å’Œç¦»çº¿çŠ¶æ€ã€‚ æ£€æµ‹ç½‘ç»œçŠ¶æ€ Ifconfig æ­¤å‘½ä»¤ç”¨äºæ£€æµ‹å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰ç½‘ç»œæ¥å£çš„çŠ¶æ€ã€‚é€šè¿‡æ‰§è¡Œ ifconfigï¼Œå¯ä»¥æŸ¥çœ‹æ¯ä¸ªç½‘ç»œæ¥å£çš„ IP åœ°å€ã€å­ç½‘æ©ç å’Œä¼ è¾“çŠ¶æ€ï¼Œä¾‹å¦‚ï¼ŒæŸ¥çœ‹ä»¥å¤ªç½‘æ¥å£æ—¶ï¼Œè¾“å‡ºå°†ä¼šåŒ…å«è¯¥æ¥å£çš„ MAC åœ°å€å’Œæ´»åŠ¨çŠ¶æ€ã€‚ Ping é€šè¿‡å‘é€å›æ˜¾è¯·æ±‚åˆ°æŒ‡å®šçš„ IP åœ°å€æˆ–åŸŸåï¼Œä»¥æ£€æµ‹ç½‘ç»œè¿é€šæ€§ã€‚æ‰§è¡Œ ping www.example.com å°†å‘è¯¥ç½‘ç«™å‘é€æ•°æ®åŒ…ï¼Œç­‰å¾…å“åº”ï¼Œå¯ä»¥æ˜¾ç¤ºç½‘ç»œå»¶è¿Ÿä»¥åŠæ•°æ®åŒ…ä¸¢å¤±ç‡ï¼Œè¿™æœ‰åŠ©äºåˆ¤æ–­ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸ä»¥åŠå“åº”é€Ÿåº¦ã€‚ Netstat ç”¨äºæŸ¥çœ‹ç½‘ç»œçŠ¶æ€ï¼Œä¾‹å¦‚å½“å‰æ‰“å¼€çš„è¿æ¥å’Œç›‘å¬çš„ç«¯å£ã€‚æ‰§è¡Œ netstat -tuln å¯ä»¥æ˜¾ç¤ºå½“å‰çš„ç½‘ç»œè¿æ¥åŠå…¶çŠ¶æ€ï¼Œæœ‰åŠ©äºç®¡ç†å‘˜äº†è§£å“ªäº›æœåŠ¡åœ¨è¿è¡Œå¹¶ä¸”ç›‘å¬å“ªäº›ç«¯å£ã€‚ Traceroute è¯¥å‘½ä»¤ç”¨äºè·Ÿè¸ªæ•°æ®åŒ…ä»æºåˆ°ç›®çš„åœ°çš„è·¯ç”±è·¯å¾„ï¼Œæ‰§è¡Œ traceroute www.example.com å°†æ˜¾ç¤ºæ¯ä¸ªç»è¿‡çš„è·¯ç”±å™¨ IP åœ°å€ï¼Œä»è€Œå¸®åŠ©è¯Šæ–­ç½‘ç»œæ€§èƒ½é—®é¢˜ã€‚ Tcpdump ç”¨äºæ•è·å’Œåˆ†æç½‘ç»œæ•°æ®åŒ…ï¼Œæ˜¾ç¤ºæœ¬æœºç½‘ç»œæµé‡çš„çŠ¶æ€ã€‚æ‰§è¡Œ tcpdump -i eth0 å°†å®æ—¶å±•ç¤ºé€šè¿‡æŒ‡å®šç½‘ç»œæ¥å£çš„æ•°æ®åŒ…ä¿¡æ¯ï¼Œè¿™å¯¹äºç½‘ç»œæ•…éšœæ’æŸ¥ä¸ç›‘æ§æä¸ºé‡è¦ã€‚ é…ç½®ç½‘å¡ä¿¡æ¯IPã€ç½‘å…³ã€æ©ç ç½‘å¡é…ç½®é€šå¸¸åœ¨ /etc/network/interfaces æ–‡ä»¶ä¸­è¿›è¡Œï¼ŒåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š auto eth0iface eth0 inet static address 192.168.10.10 netmask 255.255.255.0 gateway 192.168.10.1 DNSDNS é…ç½®åˆ™åœ¨ /etc/resolv.conf æ–‡ä»¶ä¸­è®¾ç½®ï¼Œæ¯”å¦‚ï¼š nameserver 192.168.10.1 å½“å®Œæˆæ›´æ”¹åï¼Œé‡æ–°å¯åŠ¨ç½‘ç»œæœåŠ¡ç”Ÿæ•ˆã€‚ sudo service networking restart æˆ–åœ¨å…¶ä»–ç³»ç»Ÿä¸­ä½¿ç”¨ï¼š systemctl restart network ç³»ç»Ÿé…ç½®ç¤ºä¾‹å¯¹äºç½‘ç»œé…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼š # /etc/sysconfig/network-scripts/ifcfg-eno16777736TYPE=Ethernet # è®¾å¤‡ç±»å‹BOOTPROTO=static # åœ°å€åˆ†é…æ¨¡å¼NAME=eno16777736 # ç½‘ç»œæ¥å£åç§°ONBOOT=yes # æ˜¯å¦å¯åŠ¨IPADDR=192.168.10.10 # IP åœ°å€NETMASK=255.255.255.0 # å­ç½‘æ©ç  GATEWAY=192.168.10.1 # é»˜è®¤ç½‘å…³DNS1=192.168.10.1 # DNS æœåŠ¡å™¨ æ¡¥æ–¹å¼ Bridgeåœ¨æ¡¥æ¥æ¨¡å¼ä¸­ï¼Œè™šæ‹Ÿæœºä¸ä¸»æœºå…±äº«åŒä¸€ç½‘ç»œï¼Œé€šè¿‡è‡ªåŠ¨è·å–æˆ–æ‰‹åŠ¨æŒ‡å®š IP åœ°å€ï¼Œä½¿å…¶ä¸ä¸»æœºå¤„äºåŒä¸€å­ç½‘å†…ã€‚è¿™è¦æ±‚è™šæ‹Ÿæœºçš„ IP åœ°å€ã€ç½‘å…³åŠ DNS è®¾ç½®ä¸ä¸»æœºä¸€è‡´ï¼Œä»è€Œå®ç°ä¸å¤–ç•Œçš„ç›´æ¥é€šä¿¡ã€‚ä¾‹å¦‚ï¼Œå½“è™šæ‹Ÿæœºé…ç½®ä¸ºè·å– DHCP æ—¶ï¼Œå®ƒä¼šå‘ä¸»æœºæ‰€åœ¨ç½‘ç»œä¸­çš„ DHCP æœåŠ¡å™¨è¯·æ±‚ IP åœ°å€ã€‚ NAT æ–¹å¼åœ¨ NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰æ¨¡å¼ä¸‹ï¼Œä¸»æœºè£…å¤‡äº†ä¸€å—åä¸ºéšè—ç½‘å¡ï¼ˆBï¼‰çš„ç½‘ç»œæ¥å£ï¼Œè¿™ä½¿å¾—è™šæ‹Ÿæœºèƒ½é€šè¿‡è¿™å—ç½‘å¡ä¸å¤–éƒ¨ç½‘ç»œè¿æ¥ã€‚è™šæ‹Ÿæœºçš„ç½‘å¡ï¼ˆAï¼‰é»˜è®¤æƒ…å†µä¸‹ä¼šè‡ªåŠ¨æ¥æ”¶ IP åœ°å€ï¼Œä¸»æœºä¸­çš„ DHCP æœåŠ¡ï¼ˆç”± vmware ç­‰è™šæ‹ŸåŒ–è½¯ä»¶æä¾›ï¼‰å°†è´Ÿè´£ IP çš„åˆ†é…ã€‚æ¯”å¦‚ï¼Œè‹¥ä¸»æœºç½‘å¡ B çš„ IP ä¸º 192.168.153.2ï¼Œè™šæ‹Ÿæœºç½‘å¡ A çš„é…ç½®åº”å¦‚ä¸‹ï¼š IP åœ°å€ï¼š192.168.153.139 å­ç½‘æ©ç ï¼š255.255.255.0 ç½‘å…³ï¼š192.168.153.2 DNSï¼š192.168.153.2 Host-Only æ–¹å¼åœ¨ Host-Only æ¨¡å¼ä¸‹ï¼Œç½‘ç»œç»“æ„ä¸ NAT ç›¸ä¼¼ï¼Œä½†ä¸»æœºå……å½“å”¯ä¸€çš„ç½‘å…³ã€‚æ­¤æ¨¡å¼ä»…å…è®¸è™šæ‹Ÿæœºä¸ä¸»æœºä¹‹é—´äº¤æ¢æ•°æ®ï¼Œæ— æ³•è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚è¿™ç§è®¾ç½®é€‚ç”¨äºéœ€è¦éš”ç¦»è™šæ‹Ÿæœºç½‘ç»œç¯å¢ƒçš„åœºæ™¯ã€‚å¯¹äºæ–°åˆ›å»ºè™šæ‹Ÿæœºï¼Œé»˜è®¤ä½¿ç”¨æ¡¥æ¥æ–¹å¼ï¼Œå»ºè®®æ‰‹åŠ¨æŒ‡å®š IP åœ°å€ã€‚è€Œåœ¨ NAT æ¨¡å¼ä¸‹ï¼ŒIP è®¾ç½®ä¸ºè‡ªåŠ¨é€šå¸¸æ›´ä¸ºå®ç”¨ã€‚ä¸è¿‡ï¼Œé€šè¿‡ç²¾ç¡®é…ç½®æ‰‹åŠ¨ IP ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œç¡®ä¿å®ƒä¸ä¸»æœºç½‘å¡ B åœ¨åŒä¸€ç½‘æ®µï¼Œä¸”å…¶ä»–ç½‘ç»œè®¾ç½®æŒ‡å‘ç½‘å¡ B çš„åœ°å€ã€‚ è®¾ç½® Linux çš„ IP åœ°å€åœ¨å‘½ä»¤è¡Œä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ¥é…ç½® IP åœ°å€å’Œé»˜è®¤ç½‘å…³ï¼š sudo ifconfig eth0 192.168.152.30 netmask 255.255.255.0sudo route add default gw 192.168.152.2 è¯´æ˜ï¼šå¦‚æœä»¥æ™®é€šç”¨æˆ·èº«ä»½ï¼ˆå¦‚æµ‹è¯•è´¦æˆ·ï¼‰æ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œç”±äºç¼ºä¹æƒé™ï¼Œéœ€ä½¿ç”¨ sudo æå‡æƒé™ï¼Œè¿™æ ·è¾“å…¥å¯¹åº”ç”¨æˆ·çš„å¯†ç å°±èƒ½ä¸´æ—¶è·å–ç®¡ç†å‘˜æƒé™è¿›è¡Œé…ç½®ã€‚ è®¾ç½®ç½‘å¡çš„ DNS æœåŠ¡å™¨åœ°å€åœ¨ç½‘ç»œç¯å¢ƒä¸­ï¼ŒDNS æœåŠ¡å™¨çš„è§’è‰²è‡³å…³é‡è¦ï¼Œå¯ä»¥å°†ä¾‹å¦‚ www.example.com çš„åŸŸåè§£æä¸º IP åœ°å€ 172.18.0.5ã€‚æ¯å°èƒ½å¤Ÿè”ç½‘çš„ç”µè„‘éƒ½éœ€è¦è®¾ç½® DNSï¼Œä»¥ç¡®ä¿ç½‘ç«™è®¿é—®çš„é¡ºç•…ã€‚è‹¥å¸Œæœ›é…ç½® DNS æœåŠ¡å™¨åœ°å€ï¼Œå¯ç¼–è¾‘ /etc/resolv.conf æ–‡ä»¶ï¼Œä½¿ç”¨å‘½ä»¤ï¼š sudo gedit /etc/resolv.conf åœ¨è¯¥æ–‡ä»¶å†…å¡«å†™ DNS æœåŠ¡å™¨ï¼Œä¾‹å¦‚ï¼š nameserver 8.8.8.8 # Googles Public DNS é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œå¯ä»¥æœ‰æ•ˆè®¾ç½®æ¯ä¸ªç½‘ç»œæ¥å£çš„ DNSï¼Œä»¥ç¡®ä¿ç½‘ç»œåç§°è§£æçš„æ­£ç¡®æ€§å’Œå¿«é€Ÿæ€§ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","Linux","ç½‘ç»œ"]},{"title":"Vmwareå…±äº«æ–‡ä»¶å¤¹","path":"/2024/04/26/1-å¹³å°ç³»ç»Ÿ-VMware-Vmwareå…±äº«æ–‡ä»¶å¤¹/","content":"æŸ¥çœ‹å…±äº«çš„æ–‡ä»¶å¤¹ä½¿ç”¨ vmware-hgfsclient å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰çš„å…±äº«æ–‡ä»¶å¤¹ã€‚è¿™ä¸ªå‘½ä»¤è¢«å¹¿æ³›åº”ç”¨äº VMware è™šæ‹Ÿæœºç¯å¢ƒä¸­ï¼Œä»¥ä¾¿äºå¿«é€Ÿäº†è§£ä¸»æœºä¸è™šæ‹Ÿæœºä¹‹é—´çš„å…±äº«èµ„æºã€‚ è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š vmware-hgfsclient è¿è¡Œåï¼Œç³»ç»Ÿä¼šåˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„å…±äº«æ–‡ä»¶å¤¹åç§°ï¼Œæ–¹ä¾¿ç¡®è®¤éœ€è¦æŒ‚è½½çš„å…±äº«èµ„æºã€‚ æŒ‚è½½å…±äº«æ–‡ä»¶å¤¹è¦å°†å…±äº«æ–‡ä»¶å¤¹æŒ‚è½½åˆ°è™šæ‹Ÿæœºä¸Šï¼Œéœ€è¦ä½¿ç”¨ vmhgfs-fuse å‘½ä»¤ã€‚è¿™ä¸ªå‘½ä»¤ä¼šæŠŠä¸»æœºçš„å…±äº«æ–‡ä»¶å¤¹æ˜ å°„åˆ°è™šæ‹Ÿæœºçš„ä¸€ä¸ªç›®å½•ä¸­ï¼Œä½¿å¾—ä¸¤è€…ä¹‹é—´å¯ä»¥æ— ç¼åœ°å…±äº«æ–‡ä»¶ã€‚ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†ä¸»æœºä¸‹çš„ ShareDir æŒ‚è½½åˆ°è™šæ‹Ÿæœºçš„ /home/forlinx/ShareDir æ–‡ä»¶å¤¹ä¸­ï¼š vmhgfs-fuse .host:/ShareDir /home/forlinx/ShareDir -o subtype=vmhgfs-fuse,allow_other å¦‚æœåœ¨æŒ‚è½½åå‘ç°å…±äº«æ–‡ä»¶å¤¹æ²¡æœ‰å‡ºç°åœ¨æŒ‡å®šä½ç½®ï¼Œå¯ä»¥å°è¯•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š vmhgfs-fuse .host:/ /home/forlinx/ShareDir å¦‚æœæ²¡æœ‰å…¶ä»–é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºï¼Œå°±å¯ä»¥è®¤ä¸ºæŒ‚è½½æˆåŠŸäº†ã€‚ æ³¨æ„ï¼šåœ¨è¿›è¡ŒæŒ‚è½½ä¹‹å‰ï¼Œè¯·ç¡®è®¤ /mnt ç›®å½•ä¸‹çš„ hgfs ç›®å½•å·²ç»å­˜åœ¨ã€‚å¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆ›å»ºå®ƒï¼š mkdir /mnt/hgfs æœ€åï¼Œè¿è¡Œ ls å‘½ä»¤æ¥æŸ¥çœ‹æŒ‚è½½å†…å®¹ï¼Œç¡®ä¿å…±äº«æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶å·²ç»åŒæ­¥ï¼š ls /home/forlinx/ShareDir å¦‚æœèƒ½çœ‹åˆ°æ–‡ä»¶å†…å®¹ï¼Œå°±è¡¨ç¤ºæŒ‚è½½æˆåŠŸã€‚ è‡ªåŠ¨æŒ‚è½½ä¸ºäº†æé«˜å·¥ä½œæ•ˆç‡ï¼Œå¦‚æœæƒ³é¿å…æ¯æ¬¡é‡å¯åéƒ½æ‰‹åŠ¨æŒ‚è½½å…±äº«æ–‡ä»¶å¤¹ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå¯åŠ¨è„šæœ¬ï¼Œå®ç°è‡ªåŠ¨æŒ‚è½½ã€‚ è„šæœ¬é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåä¸º startShare.sh çš„è„šæœ¬æ–‡ä»¶ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š vmhgfs-fuse .host:/ /home/forlinx/ShareDir ä¹‹åï¼Œä¸ºè¯¥è„šæœ¬æ·»åŠ å¯æ‰§è¡Œæƒé™ï¼š chmod a+x startShare.sh æ¥ä¸‹æ¥ï¼Œå°†è¿™ä¸ªè„šæœ¬æ·»åŠ åˆ°ç³»ç»Ÿå¯åŠ¨æ—¶çš„è‡ªå¯ä¸­ï¼Œè¿™æ ·æ¯æ¬¡ç³»ç»Ÿå¯åŠ¨æ—¶éƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œè¿™ä¸ªæŒ‚è½½æ“ä½œã€‚ å¯åŠ¨æ–‡ä»¶å¦‚æœå¸Œæœ›é€šè¿‡ä¿®æ”¹ç³»ç»Ÿçš„å¯åŠ¨æ–‡ä»¶æ¥å®ç°è¿™ä¸€ç›®æ ‡ï¼Œé¦–å…ˆï¼Œåº”è¯¥å¤‡ä»½å½“å‰çš„ /etc/fstab æ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶èƒ½å¤Ÿæ¢å¤ã€‚ä¾‹å¦‚ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š cp /etc/fstab /etc/fstab_bak ç„¶åï¼Œä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚ vimï¼‰æ‰“å¼€ fstab æ–‡ä»¶ï¼š vim /etc/fstab åœ¨æ–‡ä»¶çš„æœ€åæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š # mount hgfs.host:/kali_share /mnt/hgfs fuse.vmhgfs-fuse allow_other 0 0 ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨åï¼Œç³»ç»Ÿå°†åœ¨æ¯æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚è½½æŒ‡å®šçš„å…±äº«æ–‡ä»¶å¤¹ï¼Œè¿™æ ·å°±å¯ä»¥çœå»æ‰‹åŠ¨æŒ‚è½½çš„éº»çƒ¦ï¼Œç¡®ä¿æ–‡ä»¶å§‹ç»ˆå¯ä»¥è®¿é—®ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","VMware"]},{"title":"è™šæ‹Ÿæœºç£ç›˜æ”¶ç¼©","path":"/2024/04/25/1-å¹³å°ç³»ç»Ÿ-VMware-è™šæ‹Ÿæœºç£ç›˜æ”¶ç¼©/","content":"1. åˆ é™¤å¿«ç…§æ‰“å¼€ VMwareï¼Œé€‰æ‹©å·¥å…·æ çš„è™šæ‹Ÿæœºï¼Œé€‰æ‹©å¿«ç…§ï¼Œé€‰æ‹©å¿«ç…§ç®¡ç†å™¨ï¼Œåˆ é™¤ä¸ç”¨çš„å¿«ç…§ 2. åˆ é™¤ç¼“å­˜æ–‡ä»¶æ‰“å¼€è™šæ‹Ÿæœºï¼Œåˆ é™¤è™šæ‹Ÿæœºä¸­çš„ç¼“å­˜æ–‡ä»¶ç›®å½•ï¼š rm -rf /home/forlinx/.cache/vmware/drag_and_drop df -h æŒ‡ä»¤å¯æŸ¥æ‰¾åˆ°ç£ç›˜çœŸå®å æ®çš„ç£ç›˜ç©ºé—´ 3. å‹ç¼©ç£ç›˜ç©ºé—´å½“è™šæ‹Ÿæœºå®‰è£…ç›˜æ‰€å‰©ä½™çš„ç©ºé—´å¤§äº.vmdk æ–‡ä»¶çš„å¤§å°æ—¶ï¼Œå¼ºçƒˆæ¨èä½¿ç”¨ä»¥ä¸‹æ–¹å¼ åœ¨çš„ç»ˆç«¯è¾“å…¥ sudo /usr/bin/vmware-toolbox-cmd disk list ä¸€èˆ¬ä¼šæœ‰ / ç›®å½• å†è¾“å…¥ sudo /usr/bin/vmware-toolbox-cmd disk shrink / å³å‹ç¼©æ ¹ç›®å½• / 4. ä½¿ç”¨ DiskGenius å‹ç¼©å­˜æ”¾åœ¨ç‰©ç†ç¡¬ç›˜ä¸Šçš„è™šæ‹Ÿç£ç›˜æ–‡ä»¶çš„å¤§å°å¹¶æ²¡æœ‰å‡å°ã€‚è™šæ‹Ÿæœºç£ç›˜æ–‡ä»¶åªä¼šæ…¢æ…¢åœ°å˜å¤§ï¼Œè™šæ‹Ÿæœºè½¯ä»¶ä¸ä¼šåœ¨ç”¨æˆ·åˆ é™¤æ•°æ®åå¯¹è™šæ‹Ÿç£ç›˜è¿›è¡Œâ€å‹ç¼©â€ã€‚å¯ä»¥ä½¿ç”¨ DiskGenius è½¯ä»¶è¿›è¡Œå‹ç¼©ã€‚æ¯”å¦‚ä»¬ä½¿ç”¨çš„æ˜¯ VMware è™šæ‹Ÿæœºï¼Œå®ƒçš„è™šæ‹Ÿç£ç›˜æ–‡ä»¶æ˜¯ vmdk æ ¼å¼ã€‚ 1ã€åœ¨ DiskGenius è½¯ä»¶ä¸­ï¼Œé¦–å…ˆæŠŠè¦å‹ç¼©çš„è™šæ‹Ÿç£ç›˜æ‰“å¼€ï¼ˆèœå•ï¼šâ€ç¡¬ç›˜ â€“ æ‰“å¼€è™šæ‹Ÿç¡¬ç›˜æ–‡ä»¶â€ï¼‰ã€‚æ‰“å¼€åå°±å¯ä»¥åœ¨å·¦è¾¹çš„çª—å£ä¸­çœ‹åˆ°åŠ è½½ä¸Šçš„è™šæ‹Ÿç£ç›˜äº†ã€‚ 2ã€ç„¶åä»¬å†æ–°å»ºä¸€ä¸ªå®¹é‡ä¸å°äºæºè™šæ‹Ÿç¡¬ç›˜çš„ vmdk è™šæ‹Ÿç£ç›˜ï¼ˆèœå•ï¼šâ€ç¡¬ç›˜ â€“ æ–°å»ºè™šæ‹Ÿç¡¬ç›˜æ–‡ä»¶ â€“ æ–°å»º VMware è™šæ‹Ÿç¡¬ç›˜æ–‡ä»¶â€ï¼‰ã€‚ 3ã€å¼€å§‹è¿›è¡Œå‹ç¼©ã€‚é€‰æ‹©ï¼ˆèœå•ï¼šâ€å·¥å…· â€“ å…‹éš†ç¡¬ç›˜â€ï¼‰ï¼Œå¼¹å‡ºå¯¹è¯æ¡†åï¼Œåœ¨â€é€‰æ‹©æºç¡¬ç›˜â€æ—¶é€‰æ‹©è¦å‹ç¼©çš„ vmdk è™šæ‹Ÿç£ç›˜ï¼Œåœ¨â€é€‰æ‹©ç›®æ ‡ç¡¬ç›˜â€æ—¶é€‰æ‹©åˆšåˆšä»¬æ–°å»ºçš„ vmdk è™šæ‹Ÿç£ç›˜ï¼Œç„¶åç‚¹â€å¼€å§‹â€ã€‚ 4ã€ç°åœ¨å·²ç»å¤åˆ¶å®Œæ¯•äº†ï¼Œä»¬æ‰¾åˆ°ä¸¤ä¸ªè™šæ‹Ÿç£ç›˜æ–‡ä»¶çš„æ‰€åœ¨è·¯å¾„ï¼Œå¯¹æ¯”ä¸€ä¸‹å¤§å°ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè™šæ‹Ÿç¡¬ç›˜è¢«å‹ç¼©äº†ã€‚ è¿™æ—¶ï¼Œè¿˜éœ€è¦åšä¸€äº›åç»­çš„æ¸…ç†å·¥ä½œã€‚é¦–å…ˆåœ¨ DiskGenius è½¯ä»¶ä¸­å…³é—­åˆšæ‰æ‰“å¼€çš„ä¸¤ä¸ªè™šæ‹Ÿç¡¬ç›˜ï¼Œæˆ–è€…ç›´æ¥å…³é—­ DiskGenius è½¯ä»¶ã€‚ç„¶åå°†æºè™šæ‹Ÿç¡¬ç›˜æ–‡ä»¶æ”¹åï¼ˆå¤‡ç”¨ï¼Œä»¥é˜²ä¸‡ä¸€ï¼‰ï¼Œå†å°†æ–°çš„è™šæ‹Ÿç¡¬ç›˜æ–‡ä»¶æ”¹åä¸ºæºè™šæ‹Ÿç¡¬ç›˜çš„æ–‡ä»¶åï¼ˆæ³¨æ„è¦å®Œå…¨ç›¸åŒï¼‰ã€‚æœ€åæ‰“å¼€è™šæ‹Ÿæœºï¼Œå¯åŠ¨ä¸€ä¸‹è™šæ‹Ÿç³»ç»Ÿï¼Œæ²¡æœ‰é—®é¢˜åå°±å¯ä»¥åˆ é™¤å‹ç¼©å‰çš„æºè™šæ‹Ÿç¡¬ç›˜æ–‡ä»¶äº†ã€‚ 5. å¯¼å‡º OVF é‡æ–°å»ºç«‹æ–° vmdkæœ‰æ—¶å€™åˆ é™¤è™šæ‹Ÿæœºå¿«ç…§å‡ºç°é”™è¯¯ï¼Œä½†å¿«ç…§å›¾æ ‡å·²æ¶ˆå¤±ï¼Œå¯¼è‡´æ— æ³•å†æ¬¡åˆ é™¤ï¼Œé€ æˆæ–‡ä»¶æ®‹ç•™ï¼Œå°±è¿™æ ·è¶Šå †è¶Šå¤šï¼Œæ— æ³•æ¸…ç†ã€‚ ä¼˜ç‚¹æ˜¯å¯ä»¥é‡Šæ”¾å¤§é‡ç©ºé—´ï¼Œç¼ºç‚¹æ˜¯åªèƒ½ä¿ç•™ VMware è™šæ‹Ÿæœºå½“å‰çš„çŠ¶æ€å’Œæ–‡ä»¶ï¼Œä¸¢å¤±å…¶ä»–å¿«ç…§ï¼ˆå¯ä»¥æŒ‰éœ€å…ˆè½¬åˆ°æŸä¸ªå¿«ç…§å†å¯¼å‡º OVFï¼Œè¿™æ ·å°±å¯ä»¥ä¿ç•™å¿«ç…§æ—¶çš„çŠ¶æ€äº†ã€‚åŒæ ·ï¼Œä¼šä¸¢å¤±å…¶ä»–çŠ¶æ€ï¼‰ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š ç‚¹å‡»è¦æ¸…ç†çš„è™šæ‹Ÿæœºï¼Œç„¶åå·¦ä¸Šè§’ç‚¹å‡»æ–‡ä»¶ï¼Œå¯¼å‡ºä¸º OVFï¼ˆåªå­˜äº†è™šæ‹Ÿæœºå½“å‰çš„çŠ¶æ€ï¼Œå¤§æ¦‚æœ‰åå‡ ä¸ª Gï¼‰ï¼Œå­˜åˆ°å…¶ä»–ç©ºé—²çš„ç£ç›˜ä¸‹ã€‚ å°†ä¸Šè¿°æ­¥éª¤å¯¼å‡ºçš„ ovf å†éƒ¨ç½²å‡ºæ¥ï¼Œçœ‹çœ‹è™šæ‹Ÿæœºæ˜¯å¦æ­£å¸¸ã€‚ å¦‚æœæ­£å¸¸å¯ç”¨ï¼Œå°±å¯ä»¥æŠŠè™šæ‹ŸæœºåŸæ¥å ç”¨çš„ç£ç›˜æ¸…ç©ºäº†ï¼Œå¿«é€Ÿé‡Šæ”¾å¤§é‡ç©ºé—´ã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","VMware"]},{"title":"USBè®¾å¤‡è¿æ¥åˆ°WSL","path":"/2024/04/24/1-å¹³å°ç³»ç»Ÿ-WSL-USBè®¾å¤‡è¿æ¥åˆ°WSL/","content":"åœ¨ WSL2ï¼ˆWindows Subsystem for Linux 2ï¼‰ä¸­è¿æ¥ 3D æ‰“å°æœºçš„ USB ç«¯å£ï¼Œé¦–å…ˆéœ€è¦å°†è¯¥è®¾å¤‡ä» Windows ç³»ç»ŸæŒ‚è½½åˆ° Linux ç³»ç»Ÿã€‚è¿™ä¸€è¿‡ç¨‹éœ€è¦åœ¨ Windows ç¯å¢ƒä¸­å®‰è£…ä¸€ä¸ªåä¸º usbipd çš„å·¥å…·ã€‚usbipd å…è®¸ Windows ä¸Šçš„ USB è®¾å¤‡å…±äº«ç»™ WSL2 çš„ Linux ç³»ç»Ÿä½¿ç”¨ã€‚ å®‰è£… usbipdå¯ä»¥é€šè¿‡ä¸‹é¢çš„é“¾æ¥è®¿é—® usbipd çš„ GitHub ä»“åº“ï¼Œä»¥è·å–æ›´å¤šä¿¡æ¯å’Œç›¸å…³æ–‡æ¡£ï¼š usbipd GitHub åœ°å€ åœ¨çš„ Windows å‘½ä»¤è¡Œä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å®‰è£… usbipdï¼š # åœ¨ Windows å‘½ä»¤è¡Œä¸­æ‰§è¡Œwinget install usbipd ç¡®ä¿æ‰§è¡ŒæˆåŠŸã€‚å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ usbipd --version æ¥ç¡®è®¤ usbipd æ˜¯å¦å·²æ­£ç¡®å®‰è£…ï¼Œå¹¶æŸ¥çœ‹å…¶ç‰ˆæœ¬ã€‚ å®‰è£…æ‰€éœ€ç¯å¢ƒåœ¨å®Œæˆ usbipd çš„å®‰è£…åï¼Œéœ€è¦è®¾ç½® WSL2 ç¯å¢ƒä»¥æ”¯æŒ USB è®¾å¤‡çš„æŒ‚è½½ã€‚åœ¨çš„ WSL2 ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š ## åœ¨çš„ WSL ä¸­æ‰§è¡Œsudo apt install linux-tools-virtual hwdatasudo update-alternatives --install /usr/local/bin/usbip usbip `ls /usr/lib/linux-tools/*/usbip | tail -n1` 20 è¿™æ®µä»£ç ä¸»è¦çš„ä½œç”¨æ˜¯å®‰è£…å¿…è¦çš„ Linux å·¥å…·åŒ…ï¼Œå¹¶è®¾ç½® usbip çš„å¯æ‰§è¡Œè·¯å¾„ã€‚ å¦‚æœåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯æç¤ºï¼Œå¦‚ usbipd: error: WSL â€˜usbipâ€™ client not correctly installedï¼Œè¯·æ£€æŸ¥ä¸Šè¿°æ­¥éª¤æ˜¯å¦å®Œå…¨æ‰§è¡Œï¼Œå¿…è¦æ—¶é‡æ–°è¿è¡Œå®‰è£…å‘½ä»¤ä»¥ç¡®ä¿æ‰€æœ‰ç»„ä»¶éƒ½å·²æ­£ç¡®é…ç½®ã€‚ åˆ—å‡ºå¹¶æŒ‚è½½ Windows ä¸­çš„è®¾å¤‡åˆ° Linux ç¯å¢ƒåœ¨å®Œæˆäº†ç¯å¢ƒçš„è®¾ç½®åï¼Œæ¥ä¸‹æ¥éœ€è¦åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ USB è®¾å¤‡å¹¶å°†å…¶æŒ‚è½½åˆ° WSL2 ä¸­ã€‚å¯ä»¥åœ¨ Windows ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š # åœ¨ Windows ç»ˆç«¯ä¸­æ‰§è¡Œusbipd wsl list æ­¤å‘½ä»¤ä¼šæ˜¾ç¤ºå‡ºå½“å‰è¿æ¥çš„æ‰€æœ‰ USB è®¾å¤‡ï¼Œåˆ—è¡¨ä¸­ä¼šåŒ…æ‹¬å®ƒä»¬çš„ busidï¼Œè¿™åœ¨åé¢çš„æ­¥éª¤ä¸­æ˜¯å¿…éœ€çš„ã€‚ ä¸€æ—¦æ‰¾åˆ°äº†æƒ³è¦æŒ‚è½½çš„è®¾å¤‡çš„ busidï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†è¯¥è®¾å¤‡æŒ‚è½½åˆ° Linux ç¯å¢ƒä¸­ï¼š usbipd wsl attach --busid=4-1 è¯·æ ¹æ®æƒ³è¦è¿æ¥çš„å®é™…è®¾å¤‡ ID æ›¿æ¢ 4-1ã€‚æ‰§è¡Œåï¼Œåº”è¯¥èƒ½å¤Ÿåœ¨ WSL2 å†…è®¿é—®åˆ°çš„ 3D æ‰“å°æœºï¼Œæ¥ä¸‹æ¥çš„æ­¥éª¤æ˜¯é…ç½®å’Œä½¿ç”¨æ‰“å°æœºã€‚ é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå¯ä»¥é¡ºåˆ©åœ°åœ¨ WSL2 ç¯å¢ƒä¸­ä½¿ç”¨ USB è®¾å¤‡ï¼Œäº«å—æ›´çµæ´»çš„å¼€å‘å’Œæ‰“å°ä½“éªŒã€‚","categories":["1.å¹³å°ç³»ç»Ÿ","WSL"]},{"title":"Obsidianç¬”è®°å»ºè®¾","path":"/2024/04/23/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-Obsidianç¬”è®°å»ºè®¾/","content":"Obsidian é…ç½®Ctrl+Shift+I åœ¨æ§åˆ¶å°é‡Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼Œæ‰€æœ‰æ’ä»¶çš„æ—¥å¿—éƒ½å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ° Hexo å¿½ç•¥æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ç”±äº hexo çš„æ–‡ç« åªå­˜åœ¨äºÂ sourceÂ ç›®å½•ä¸‹ï¼Œéœ€è¦è®© Obsidian å¿½ç•¥å…¶ä»–æ–‡ä»¶çš„å†…å®¹ä»¥ä¼˜åŒ–æ€§èƒ½ä»¥åŠå‡å°‘ä¸å¿…è¦çš„æœç´¢ç»“æœã€‚å…·ä½“çš„æ“ä½œæ˜¯åœ¨Â è®¾ç½®-æ–‡ä»¶ä¸é“¾æ¥-Exclude Filesï¼Œå°†éœ€è¦å¿½ç•¥çš„æ–‡ä»¶æ·»åŠ è¿›å»ï¼ˆå°¤å…¶æ˜¯ node_modulesï¼‰ã€‚ Templateræ¨¡æ¿é…ç½®è¯´æ˜æ–‡æ¡£ https://silentvoid13.github.io/Templater/introduction.html é¦–å…ˆè¦åˆ›å»ºæ¨¡æ¿ï¼Œå¯ä»¥åœ¨Â sourceÂ ç›®å½•ä¸‹åˆ›å»ºÂ _obsidianÂ æ–‡ä»¶å¤¹ï¼Œå¹¶åˆ›å»ºä¸€ç¯‡Â Post TemplateÂ çš„æ–‡ç« ï¼ˆmd æ–‡ä»¶ï¼‰ï¼Œå†åˆ›å»ºæ–°æ–‡ç« çš„æ—¶å€™ï¼Œåªéœ€è¦ç‚¹å‡»ä¾§è¾¹æ çš„ã€æ’å…¥æ¨¡æ¿ã€æŒ‰é’®å°±å¯ä»¥å¿«é€Ÿç”Ÿæˆ Front-matter ä¿¡æ¯ï¼š ---title: % tp.file.title %date: % tp.file.creation_date(format=YYYY-MM-DD HH:mm:ss) %update: % tp.file.last_modified_date(YYYY-MM-DD HH:mm:ss) %comments: truetags:categories:dg-publish: true---å®šä¹‰è„šæœ¬function generateTimestampUrl() var timestamp = Math.round(new Date() / 1000); var url = timestamp.toString(36) return url; module.exports = generateTimestampUrl; osidian-gitå¿«æ·é”® Ctrl + P æ‰“å¼€å‘½ä»¤é¢æ¿ï¼Œè¾“å…¥ open source control view å¯ç”¨å¯è§†åŒ–æ“ä½œé¢æ¿ obsidian-panguå·²ç”¨ Linter æ›¿ä»£ ä¸­è‹±æ–‡ä¹‹é—´åŠ ç©ºæ ¼ Hidden Folderç›®å½•éšè—æ’ä»¶ FileTreeå·¦ä¾§èœå•å‡ºç°äº†ä¸€ä¸ªÂ File TreeÂ çš„ Tab é¡µï¼Œç‚¹å‡»åå°±å¯ä»¥çœ‹åˆ°æ–‡ä»¶ä»¥æ ‘å½¢çš„ç»“æ„å‘ˆç°ï¼Œå±•å¼€Â sourceÂ æ–‡ä»¶å¤¹ï¼Œå¹¶å³é”®Â _postÂ æ–‡ä»¶å¤¹ï¼Œé€‰æ‹©Â Focuse on FolderÂ åï¼Œå·¦ä¾§çš„æ–‡ä»¶åˆ—è¡¨ä¸­å°±åªä¼šæ˜¾ç¤ºÂ _postÂ æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹äº† Github Publisherå·²ä½¿ç”¨æ•´ä¸ªä»“åº“è¿›è¡ŒåŒæ­¥å‘å¸ƒï¼Œä¸é‡‡ç”¨è¿™ç§å•é¡µé¢å‘å¸ƒå½¢å¼ å°† Obsidian ä¸­çš„æ–‡ç« å’Œæœ¬åœ°é™„ä»¶ä¸Šä¼ åˆ° Github ä»“åº“ï¼Œä¸Šä¼ å‰å¯ä»¥æŒ‡å®šæ–‡ä»¶ç›®å½•ã€è‡ªå®šä¹‰å†…å®¹æ›¿æ¢ç­‰æ“ä½œã€‚ èƒ½å°† Obsidian ä»“åº“é‡Œçš„ä»»æ„ç¬”è®°è‡ªåŠ¨æˆ–è€…æ‰‹åŠ¨åŒæ­¥åˆ° GitHub ä»£ç ä»“åº“çš„ä»»æ„ä½ç½®ã€‚é¦–å…ˆè®¾ç½®å¥½ Github ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬ Github repositoryï¼Œç”¨æˆ·åï¼Œtoken ä»¥åŠ Branchã€‚å½“ç„¶ä¹Ÿå¯ä»¥åœ¨å•ä¸ªç¬”è®°æ–‡ä»¶é‡Œï¼Œé€šè¿‡æ–‡æ¡£å±æ€§ï¼ˆfrontmatterï¼‰ï¼Œå•ç‹¬è®¾ç½®æ¥æ”¶ç¬”è®°ä¸Šä¼ çš„ Github ä»“åº“ä¿¡æ¯ï¼ˆå¯ä»¥é€‰æ‹©åŒä¸€ç”¨æˆ·ä¸‹çš„ä¸åŒä»“åº“ï¼ŒåŒä¸€ä»“åº“ä¸‹çš„ä¸åŒä½ç½®ï¼‰ã€‚ ä¸Šä¼ è®¾ç½® è®¾å®šä¸Šä¼ çš„ç¬”è®°å­˜å‚¨åœ¨ Github ä»“åº“çš„ä½ç½®ã€‚å› ä¸ºçš„ hexo åšå®¢æ—¥å¿—æ–‡ä»¶ä¿å­˜åœ¨ sourceposts ç›®å½•ä¸‹ï¼Œæ•…é€‰æ‹© Fixed Folderï¼Œè®¾å®šå¥½é»˜è®¤ä¸Šä¼ åˆ°çš„ç›®å½•ã€‚ æ–‡ç« å‘å¸ƒ åœ¨æ–‡ç« æ–‡æ¡£å±æ€§æ·»åŠ ä¸€ä¸ª share å±æ€§ï¼ˆå¯ä»¥æ ¹æ®éœ€è¦åœ¨æ’ä»¶è®¾ç½®é‡Œæ”¹æˆå…¶ä»–ä»»æ„åç§°ï¼‰ï¼Œèµ‹äºˆå€¼ trueã€‚æ–‡ç« å†™å¥½åï¼Œshare: true å³é”®å‘å¸ƒã€‚ ShellCommandå¯ä»¥è§£å†³ obsidian æ— æ³•æ‰“å¼€ . å¼€å¤´çš„é»˜è®¤æ–‡ä»¶çš„é—®é¢˜ å†ä»‹ç»ä¸ªç»ˆæä¼˜åŒ–æ–¹æ¡ˆï¼Œä¹‹å‰æ‰§è¡Œå‘½ä»¤æ˜¯é€šè¿‡è¿è¡Œ bat æ–‡ä»¶ï¼Œè€Œ Shell commands å¯ä»¥åœ¨ Obsidian ä¸­è®¾ç½®å¥½å‘½ä»¤ï¼Œå¹¶é€šè¿‡ Obsidian çš„å‘½ä»¤é¢æ¿æˆ–å¿«æ·é”®å¿«é€Ÿè¿è¡Œã€‚ åœ¨æ’ä»¶è®¾ç½®é¢æ¿ä¸­æ·»åŠ å‘½ä»¤ è¿è¡Œåšå®¢ï¼š Shell commands æ²¡æœ‰æ˜¾ç¤ºç»ˆç«¯çª—å£çš„åŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦å¯åŠ¨ powershell å†ä¼ å…¥å‘½ä»¤ æœ‰äº†ç»ˆç«¯çª—å£æ‰å¯ä»¥åœ¨çª—å£ä¸­æŒ‰ Ctrl + C å…³é—­ Hexo æœåŠ¡ï¼Œå¦åˆ™å®ƒä¼šä¸€ç›´å ç”¨ç«¯å£ start powershell -NoExit -Command start http://localhost:4000 ; cd Blog ; hexo s æ‰“å¼€ç«™ç‚¹å’Œä¸»é¢˜é…ç½®æ–‡ä»¶ï¼š start Blog/_config.ymlstart Blog/themes/butterfly4.3.1/_config.yml ç„¶åä¿®æ”¹é»˜è®¤æ‰§è¡Œç¯å¢ƒä¸º PowerShell 5ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªå‘½ä»¤è®¾ç½®ä¸‹åˆ«åï¼Œå°±æ˜¯åœ¨å‘½ä»¤é¢æ¿æ˜¾ç¤ºçš„åå­— Emo æ’ä»¶ç”¨ PicGo æ”¯æŒæ›´å¤šè‡ªå®šä¹‰è®¾ç½® ç”¨äºè‡ªæ‰˜ç®¡å›¾ç‰‡ image auto upload pluginä¹Ÿæ˜¯ç”¨äºè‡ªæ‰˜ç®¡å›¾ç‰‡ Linter æ’ä»¶ç”¨æˆ·åœ¨ä¿å­˜ç¬”è®°æ—¶æŒ‰ç…§ä¸€å®šçš„æ ¼å¼ï¼Œæ ¼å¼åŒ–ç¬”è®°ï¼Œè¿™é‡Œç”¨åˆ°çš„åŠŸèƒ½ï¼š ä¿å­˜ç¬”è®°æ—¶è‡ªåŠ¨æ’å…¥ front-matter è¿›å…¥ Linter çš„è®¾ç½®ï¼Œé€‰æ‹© YAML è®¾ç½®ï¼Œæ‰¾åˆ°å…¶ä¸­çš„æ’å…¥ YAML è®¾ç½®ï¼ˆ Insert YAML attributesï¼‰ï¼Œæ‰“å¼€å¼€å…³åï¼Œè¾“å…¥è¦æ’å…¥çš„ front-matter è‡ªåŠ¨æ›´æ–°æ–‡ä»¶ä¿®æ”¹æ—¶é—´æˆ³ è¿›å…¥ Linter çš„è®¾ç½®ï¼Œé€‰æ‹© YAML è®¾ç½®ï¼Œæ‰¾åˆ°å…¶ä¸­çš„ YAML æ—¶é—´æˆ³ï¼ˆ yaml-timestampï¼‰ï¼Œè®¾ç½®ä¸º Hexo è¯†åˆ«çš„ date å’Œ update æ ¼å¼åŒ–ç¬”è®° ä¸»è¦çš„æ˜¯ä¸€ä¸ªä¸åŒè¯­è¨€ä¸­é—´çš„ç©ºæ ¼è‡ªåŠ¨æ·»åŠ ï¼Œè¿›å…¥ Linter çš„è®¾ç½®ï¼Œé€‰æ‹©ç©ºæ ¼ï¼Œæ‰¾åˆ°å…¶ä¸­çš„ Space between Chinese Japanese or Korean and English or numbersï¼Œæ‰“å¼€å³å¯ å…¶ä»–æ’ä»¶ Image Converter è½¬åŒ–å›¾ç‰‡æ ¼å¼ï¼Œç»Ÿä¸€è½¬ä¸º webpï¼Œå¹¶è®¾ç½®äº†å›¾ç‰‡åˆ†è¾¨ç‡å¤§å°ã€‚ Unique attachments ç”¨äºå°†é™„ä»¶çš„æ–‡ä»¶åç»Ÿä¸€ä¸º â€œå­—æ¯ + æ•°å­—â€çš„æ ¼å¼,è®°ç€åœ¨é…ç½®é‡ŒåŠ å…¥ webp å›¾ç‰‡æ ¼å¼ Image Inserter ç”¨äºæ‰¾å›¾ç‰‡ï¼Œç”¨äºè®¾ç½®æ–‡ç« å°é¢ï¼Œå³è®¾ç½®Â cover.imageÂ å±æ€§ã€‚ ç›®å‰åœ¨ç”¨çš„æ’ä»¶","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨"]},{"title":"LNMPç¯å¢ƒ","path":"/2024/04/22/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-åšå®¢-LNMPç¯å¢ƒ/","content":"å‰è¨€åœ¨é€šè¿‡ Docker éƒ¨ç½² WordPress çš„è¿‡ç¨‹ä¸­ï¼Œæ„è¯†åˆ°è®¸å¤šéœ€è¦ä¿®æ”¹çš„æ–‡ä»¶éƒ½å¿…é¡»é€šè¿‡ docker-compose è„šæœ¬æ˜ å°„åˆ°æœ¬åœ°ï¼Œè¿™è®©æ”¹åŠ¨å˜å¾—ä¸å¤ªæ–¹ä¾¿ã€‚æ­¤å¤–ï¼Œç”±äº Docker çš„ç‰¹æ€§ï¼Œå…³é—­å¹¶é‡å¯å®¹å™¨åï¼Œé‡Œé¢çš„æ•°æ®å¾€å¾€ä¼šä¸¢å¤±ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªèƒ½ä¾èµ–äºæŒä¹…åŒ–å­˜å‚¨ï¼Œè€Œè¿™å¯ä»¥é€šè¿‡ volume æˆ–è€…ç§°ä¸ºâ€æ•°æ®å®¹å™¨â€çš„æ–¹æ¡ˆæ¥å®ç°ã€‚ å®¹å™¨ä¸€æ—¦å…³é—­ï¼Œå¯ä»¥ä½¿ç”¨ -v æˆ–è€… --volumes-from æ¥é‡æ–°åˆ©ç”¨ä»¥å‰çš„æ•°æ®ã€‚æ­¤å¤–ï¼ŒDocker è¿˜æ”¯æŒæŒ‚è½½å®¿ä¸»æœºçš„ç£ç›˜ç›®å½•ï¼Œä»è€Œå®ç°æ•°æ®çš„æ°¸ä¹…å­˜å‚¨ã€‚è¿™ç§æ–¹å¼è™½ç„¶å¯è¡Œï¼Œä½†åœ¨å®é™…æ“ä½œä¸­ï¼Œèƒ½å¤Ÿç›´è§‚åœ°æŸ¥çœ‹å’Œä¿®æ”¹æ‰€æœ‰æ–‡ä»¶æ˜¾å¾—æ›´ä¸ºæ”¾å¿ƒã€‚å› æ­¤ï¼Œå†³å®šé€šè¿‡æ‰‹åŠ¨é…ç½® LNMP çš„åŸºç¡€è¿è¡Œç¯å¢ƒæ¥å»ºç«‹çš„ WordPress ç½‘ç«™ã€‚ ç›®å‰é…ç½® LNMP ç¯å¢ƒå¯é€‰çš„æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š é€šè¿‡å®å¡”é¢æ¿è¿›è¡Œå¯è§†åŒ–é…ç½®ï¼Œé€‚åˆä¸ç†Ÿæ‚‰å‘½ä»¤è¡Œçš„ç”¨æˆ·ã€‚ ä½¿ç”¨è„šæœ¬å®ç°ä¸€é”®é…ç½®ï¼Œå‡å°‘æ‰‹åŠ¨æ“ä½œçš„å¤æ‚æ€§ã€‚ å„è½¯ä»¶ç»„ä»¶ç‹¬ç«‹è¿›è¡Œæ‰‹åŠ¨å®‰è£…ä¸é…ç½®ï¼Œé€‚åˆæ·±å…¥äº†è§£æ¯ä¸ªç»„ä»¶çš„ç”¨æˆ·ã€‚ åœ¨è¿™æ¬¡è®¾ç½®ä¸­ï¼Œé€‰æ‹©é€šè¿‡è„šæœ¬é…ç½®ï¼Œå¹¶å°†ä¹‹å‰ Docker ä¸­æ­å»ºçš„ WordPress çš„æ‰€æœ‰æ•°æ®å¯¼å…¥æ–°çš„ç¯å¢ƒä¸­ã€‚ LNMP ä»‹ç»LNMP æ˜¯ WordPress è¿è¡Œçš„åŸºç¡€ç¯å¢ƒï¼Œå…¶å…¨åç›¸å¯¹åº”çš„æ˜¯å››ä¸ªä¸»è¦ç»„ä»¶ï¼šLinuxã€Nginxã€MySQLMariaDB å’Œ PHPã€‚è¿™äº›ç»„ä»¶çš„è§’è‰²åŠŸèƒ½å¦‚ä¸‹ï¼š Linuxï¼šä½œä¸ºæ“ä½œç³»ç»Ÿï¼Œå®ƒæä¾›äº†åŸºæœ¬çš„ç³»ç»ŸæœåŠ¡å’Œèµ„æºç®¡ç†ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿã€ç”¨æˆ·ç®¡ç†å’Œç½‘ç»œé…ç½®ç­‰ã€‚ Nginxï¼šè¿™æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ Web æœåŠ¡å™¨ï¼Œèƒ½æœ‰æ•ˆå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚å¹¶å°†å…¶è½¬å‘ç»™åç«¯åº”ç”¨ç¨‹åºã€‚Nginx çš„å¼‚æ­¥å¤„ç†èƒ½åŠ›ä½¿å…¶èƒ½å¤Ÿè½»æ¾åº”å¯¹å¤§é‡å¹¶å‘è¯·æ±‚ï¼Œç‰¹åˆ«é€‚åˆç”¨äºåŠ¨æ€ç«™ç‚¹ã€‚ MySQLMariaDBï¼šè¿™ä¸¤è€…éƒ½æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œè´Ÿè´£å­˜å‚¨å’Œç®¡ç†åº”ç”¨ç¨‹åºçš„æ•°æ®ã€‚MySQL å’Œ MariaDB æä¾›å¼ºå¤§çš„æ•°æ®æŸ¥è¯¢å’Œå­˜å‚¨åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§å­˜å‚¨å¼•æ“ã€‚ PHPï¼šä½œä¸ºæœåŠ¡å™¨ç«¯çš„ç¼–ç¨‹è¯­è¨€ï¼ŒPHP å…è®¸å¼€å‘äººå‘˜ç¼–å†™å¤æ‚çš„ç¨‹åºé€»è¾‘ï¼Œå¦‚å¤„ç†ç”¨æˆ·è¯·æ±‚ã€ä¸æ•°æ®åº“äº¤äº’ç­‰ã€‚ LNMP æ¶æ„å…·æœ‰æ˜æ˜¾çš„ä¼˜ç‚¹ï¼š é«˜æ€§èƒ½ï¼šå¦‚å‰æ‰€è¿°ï¼ŒNginx èƒ½å¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚ï¼Œé€‚åˆæµé‡å¯†é›†å‹çš„ç½‘ç«™ã€‚ ç¨³å®šå¯é ï¼šLinux ç³»ç»Ÿä»¥å…¶ç¨³å®šæ€§è‘—ç§°ï¼Œå¹¿æ³›ç”¨äºæœåŠ¡å™¨ç¯å¢ƒï¼Œä¿è¯äº†è‰¯å¥½çš„ç³»ç»ŸæœåŠ¡å’Œèµ„æºç®¡ç†ã€‚ æ˜“äºæ‰©å±•ï¼šé€‰æ‹© MySQL æˆ– MariaDB å¯ä»¥è½»æ¾å®ç°é«˜å¯ç”¨å’Œåˆ†å¸ƒå¼æ¶æ„ï¼Œæ”¯æŒä¸šåŠ¡å¢é•¿ã€‚ çµæ´»å¯å®šåˆ¶ï¼šPHP æ”¯æŒä¸°å¯Œçš„æ¡†æ¶å’Œåº“ï¼Œèƒ½å¤Ÿæ»¡è¶³å¤šæ ·åŒ–çš„ä¸šåŠ¡éœ€æ±‚ã€‚ LNMP æ¶æ„åœ¨ Web å¼€å‘å’Œè¿ç»´é¢†åŸŸå¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ï¼Œå°¤å…¶åœ¨é¢å¯¹é«˜å¹¶å‘å’Œå¤§æ•°æ®åœºæ™¯æ—¶ï¼Œèƒ½å¤Ÿä¿æŒè‰¯å¥½çš„æ€§èƒ½è¡¨ç°ä¸å¯æ‰©å±•æ€§ã€‚ æ­¤å¤–ï¼Œå€¼å¾—ä¸€æçš„æ˜¯è¿˜æœ‰å…¶ä»–å‡ ç§æ¶æ„ã€‚ä¾‹å¦‚ï¼ŒLAMP æ˜¯ Linux + Apache + MySQL + PHP çš„ç»„åˆï¼ŒLNAMP åˆ™æ˜¯ Linux + Nginx + Apache + MySQL + PHPã€‚Apache æ˜¯ä¸€ç§æ’åç¬¬ä¸€çš„ Web æœåŠ¡å™¨è½¯ä»¶ï¼Œä»¥å…¶è·¨å¹³å°ç‰¹æ€§å’Œå®‰å…¨æ€§è¢«å¹¿æ³›é‡‡çº³ï¼Œæ˜¯ç›®å‰æœ€æµè¡Œçš„ Web æœåŠ¡å™¨ä¹‹ä¸€ã€‚ ä¸€é”®å®‰è£… LNMPç™»å½• VPS æˆ–æœåŠ¡å™¨ä½¿ç”¨ PuTTY æˆ–å…¶ä»–ç±»ä¼¼çš„ SSH å·¥å…·ç™»å½•åˆ°çš„ VPS æˆ–æœåŠ¡å™¨ã€‚æˆåŠŸç™»å½•åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å±å¹•ä¼šè¯ï¼š screen -S lnmp å¦‚æœå‡ºç° screen: command not found çš„æç¤ºï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£… screenï¼š apt-get install screen æœ‰å…³ screen çš„è¯¦ç»†ç”¨æ³•ï¼Œè¯·å‚è€ƒå…¶ å®˜æ–¹æ•™ç¨‹ã€‚ ä¸‹è½½å¹¶å®‰è£… LNMP ä¸€é”®å®‰è£…åŒ…å¯ä»¥é€‰æ‹©ä¸‹è½½ä¸¤ä¸ªç‰ˆæœ¬çš„ LNMP å®‰è£…åŒ…ï¼š ä¸‹è½½ç‰ˆï¼šæ¨èç»™ç¾å›½åŠæµ·å¤–çš„ VPS æˆ–ç©ºé—´è¾ƒå°çš„ç”¨æˆ·ä½¿ç”¨ã€‚ å®Œæ•´ç‰ˆï¼šæ¨èç»™å›½å†… VPS ç”¨æˆ·ï¼ŒåŒ…å«äº†ä¸€äº›é¢„å…ˆæ”¾å…¥çš„æºç æ–‡ä»¶ï¼Œæ–¹ä¾¿å¿«é€Ÿå®‰è£…ã€‚ å®‰è£… LNMP ç¨³å®šç‰ˆå¦‚æœå¸Œæœ›è¿›è¡Œæ— äººå€¼å®ˆå®‰è£…ï¼Œå¯ä»¥ä½¿ç”¨æ— äººå€¼å®ˆå‘½ä»¤ç”Ÿæˆå·¥å…·ï¼Œæˆ–æŸ¥çœ‹ç›¸å…³çš„æ— äººå€¼å®ˆè¯´æ˜æ•™ç¨‹ã€‚ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸‹è½½å¹¶è§£å‹ LNMP å®‰è£…åŒ…ï¼š wget http://soft.vpser.net/lnmp/lnmp1.9.tar.gz -cO lnmp1.9.tar.gz tar zxf lnmp1.9.tar.gz cd lnmp1.9 ./install.sh lnmp å¦‚æœçš„ç›®æ ‡æ˜¯å®‰è£… LNMPA æˆ– LAMPï¼Œå°†å‘½ä»¤ä¸­çš„ lnmp æ›¿æ¢ä¸º lnmpa æˆ– lamp å³å¯ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥é€‰æ‹©å•ç‹¬å®‰è£… Nginx æˆ–æ•°æ®åº“ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š ./install.sh nginx æˆ– ./install.sh db å¦‚æœéœ€è¦æ›´æ”¹ç½‘ç«™å’Œæ•°æ®åº“ç›®å½•ã€è‡ªå®šä¹‰ Nginx å‚æ•°æˆ– PHP å‚æ•°æ¨¡å—ï¼ˆå¦‚æ˜¯å¦å¼€å¯ luaï¼‰ï¼Œè¯·åœ¨è¿è¡Œ ./install.sh å‘½ä»¤å‰ä¿®æ”¹å®‰è£…åŒ…ç›®å½•ä¸‹çš„ lnmp.conf æ–‡ä»¶ã€‚è¯¦ç»†çš„å‚æ•°è¯´æ˜å¯ä»¥åœ¨ lnmp.conf æ–‡ä»¶ä¸­æŸ¥çœ‹ã€‚ å¦‚é‡åˆ° wget: command not found çš„æç¤ºï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… wgetï¼š yum install wget æˆ– apt-get install wget å¦‚æœä¸‹è½½é€Ÿåº¦æ…¢æˆ–é‡åˆ°ä¸‹è½½é—®é¢˜ï¼Œè¯·è€ƒè™‘æ›´æ¢å…¶ä»–ä¸‹è½½èŠ‚ç‚¹ï¼Œå…·ä½“æ›¿æ¢æ–¹æ³•å¯ä»¥åœ¨ LNMP çš„æ–‡æ¡£ä¸­æ‰¾åˆ°ã€‚ æ‰§è¡Œ LNMP å®‰è£…å‘½ä»¤è¿è¡Œ LNMP å®‰è£…å‘½ä»¤åï¼Œå¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹æç¤ºï¼š å½“å‰å®‰è£…åŒ…ä¸­æä¾›äº†å¤šç§ MySQL å’Œ MariaDB çš„ç‰ˆæœ¬é€‰é¡¹ã€‚å¦‚æœé€‰æ‹©å®‰è£… MySQL 5.6ã€5.7 æˆ– MariaDB 10ï¼Œç¡®ä¿çš„å†…å­˜é…ç½®è‡³å°‘ä¸º 1Gã€‚å¦‚æœä»…éœ€å®‰è£…æ•°æ®åº“ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š ./install.sh db åœ¨æç¤ºä¸­ï¼Œè¾“å…¥ç›¸åº” MySQL æˆ– MariaDB ç‰ˆæœ¬å‰çš„åºå·å¹¶å›è½¦ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªæ­¥éª¤ã€‚ å¦‚æœé€‰æ‹© MySQL 5.7 æˆ– 8.0 ä¸”ç³»ç»Ÿæ¶æ„ä¸º x86 æˆ– x86_64ï¼Œç³»ç»Ÿä¼šæç¤ºæ˜¯å¦ä½¿ç”¨äºŒè¿›åˆ¶åŒ…è¿›è¡Œå®‰è£…ï¼šâ€Using Generic Binaries [yn]:â€ã€‚è¾“å…¥ y è¡¨ç¤ºä½¿ç”¨äºŒè¿›åˆ¶å®‰è£…ï¼Œè¾“å…¥ n åˆ™ä½¿ç”¨æºç ç¼–è¯‘ã€‚å¦‚æœé€‰æ‹©äº†äºŒè¿›åˆ¶æ–¹å¼ï¼Œå»ºè®®ç¦»çº¿å®‰è£…æˆ–è‡ªè¡Œä¸‹è½½è‡³å®‰è£…åŒ…çš„ src ç›®å½•ã€‚ æ¥ä¸‹æ¥ï¼Œéœ€è¦è®¾ç½® MySQL çš„ root å¯†ç ã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œå¯ä»¥ç›´æ¥å›è½¦ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå¯†ç ï¼ˆä¾‹å¦‚ lnmp.org#éšæœºæ•°å­—ï¼‰ã€‚å¦‚æœéœ€è¦åˆ é™¤é”™è¯¯è¾“å…¥çš„å¯†ç ï¼ŒæŒ‰ä½ Ctrl å¹¶åŒæ—¶æŒ‰ Backspace æˆ–åªæŒ‰ Backspace é”®ï¼ˆæ ¹æ®ç³»ç»Ÿä¸åŒæƒ…å†µè€Œå®šï¼‰ã€‚ æ¥ç€ï¼Œç³»ç»Ÿä¼šè¯¢é—®æ˜¯å¦å¯ç”¨ MySQL InnoDBï¼Œå¼•æ“é»˜è®¤å¼€å¯ï¼Œå»ºè®®ç›´æ¥å›è½¦æˆ–è¾“å…¥ yã€‚å¦‚æœç¡®å®šä¸éœ€è¦ï¼Œå¯ä»¥è¾“å…¥ nã€‚è¯·æ³¨æ„ï¼ŒMySQL 5.7 åŠä»¥ä¸Šç‰ˆæœ¬æ— æ³•å…³é—­ InnoDBã€‚ é€‰æ‹© PHP ç‰ˆæœ¬æ—¶ï¼Œè¯·ç¡®è®¤æ‰€é€‰ç‰ˆæœ¬ä¸çš„ç¨‹åºå…¼å®¹ã€‚è¾“å…¥ç›¸åº” PHP ç‰ˆæœ¬çš„åºå·å¹¶å›è½¦ï¼Œæ¥ä¸‹æ¥ä¼šæç¤ºæ˜¯å¦å®‰è£…å†…å­˜ä¼˜åŒ–é€‰é¡¹ã€‚å¯ä»¥é€‰æ‹©ä¸å®‰è£…ã€Jemalloc æˆ– TCmallocï¼Œç›´æ¥å›è½¦åˆ™ä¸ºé»˜è®¤ä¸å®‰è£…ã€‚ å¦‚æœé€‰æ‹©çš„æ˜¯ LNMPA æˆ– LAMPï¼Œç³»ç»Ÿä¼šè¿›ä¸€æ­¥æç¤ºè®¾ç½®ç®¡ç†å‘˜é‚®ç®±ï¼Œè¯¥é‚®ç®±åœ¨å‡ºç°é”™è¯¯æ—¶ä¼šæ˜¾ç¤ºåœ¨é”™è¯¯é¡µé¢ä¸Šã€‚æ¥ç€ï¼Œé€‰æ‹© Apache ç‰ˆæœ¬ï¼Œè¾“å…¥å¯¹åº”ç‰ˆæœ¬åºå·å¹¶å›è½¦ã€‚ åœ¨æç¤ºâ€Press any key to installâ€¦ or Press Ctrl+c to cancelâ€åï¼ŒæŒ‰ä¸‹å›è½¦é”®ç¡®è®¤å¼€å§‹å®‰è£…ã€‚LNMP è„šæœ¬å°†è‡ªåŠ¨å®‰è£…å’Œç¼–è¯‘ Nginxã€MySQLã€PHPã€phpMyAdmin ç­‰è½¯ä»¶åŠç›¸å…³ç»„ä»¶ã€‚å®‰è£…è€—æ—¶ä»å‡ ååˆ†é’Ÿåˆ°å‡ ä¸ªå°æ—¶ä¸ç­‰ï¼Œå…·ä½“æ—¶é—´ä¾èµ–äºæœºå™¨é…ç½®åŠç½‘ç»œé€Ÿåº¦ã€‚ å®‰è£…å®Œæˆå®‰è£…å®Œæˆåï¼Œç³»ç»Ÿåº”æ˜¾ç¤ºï¼š Nginx: OK, MySQL: OK, PHP: OK åŒæ—¶ï¼ŒNginxã€MySQLã€PHP éƒ½åº”æ˜¾ç¤ºä¸ºè¿è¡ŒçŠ¶æ€ï¼Œå¹¶ç¡®ä¿ 80 å’Œ 3306 ç«¯å£å­˜åœ¨ï¼Œå¹¶æç¤ºå®‰è£…æ—¶é—´åŠâ€Install lnmp V1.9 completed! enjoy it.â€ï¼Œè¯´æ˜å®‰è£…æˆåŠŸã€‚å¦‚æœç³»ç»Ÿå¡åœ¨â€Install lnmp V1.9 completed! enjoy it.â€ä¸è‡ªåŠ¨é€€å‡ºï¼Œå¯ä»¥æŒ‰ Ctrl + c å¼ºåˆ¶é€€å‡ºã€‚ å®Œæˆå®‰è£…åï¼Œå¯ä»¥æŒ‰ç…§æ·»åŠ è™šæ‹Ÿä¸»æœºçš„æ•™ç¨‹æ·»åŠ è™šæ‹Ÿä¸»æœºã€‚éšåï¼Œä½¿ç”¨ SFTP æˆ– FTP æœåŠ¡å™¨ä¸Šä¼ ç½‘ç«™ä»£ç ï¼Œå¹¶å°†åŸŸåè§£æåˆ° VPS æˆ–æœåŠ¡å™¨çš„ IP åœ°å€ã€‚ç¡®ä¿è§£æç”Ÿæ•ˆåï¼Œå³å¯ä½¿ç”¨çš„ç½‘ç«™ã€‚ å®‰è£…å¤±è´¥å¦‚æœå‡ºç°æŸä¸ªéƒ¨åˆ†æ²¡æœ‰æˆåŠŸå®‰è£…çš„æç¤ºï¼Œæ„å‘³ç€å®‰è£…å¤±è´¥ã€‚éœ€è¦ä½¿ç”¨ WinSCP æˆ–å…¶ä»–ç›¸å…³å·¥å…·ï¼Œå°† /root ç›®å½•ä¸‹çš„ lnmp-install.log æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œå¹¶åœ¨ LNMP æ”¯æŒè®ºå›å‘å¸–ï¼Œé™„ä¸Šç³»ç»Ÿçš„å‘è¡Œç‰ˆåç§°ã€ç‰ˆæœ¬å·ä»¥åŠ 32 ä½æˆ– 64 ä½ç­‰ä¿¡æ¯ï¼Œå¹¶å°† lnmp-install.log å‹ç¼©åä¸Šä¼ ï¼Œä¼šé€šè¿‡æ—¥å¿—åˆ†æé”™è¯¯å¹¶æä¾›è§£å†³æ–¹æ¡ˆã€‚ æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒLNMP ä¸ä¼šå®‰è£… FTP æœåŠ¡å™¨ï¼Œè‹¥éœ€è¦ FTP æœåŠ¡å™¨ï¼Œè¯·å‚è€ƒ æ­¤é“¾æ¥ã€‚ æ·»åŠ ã€åˆ é™¤è™šæ‹Ÿä¸»æœºåŠä¼ªé™æ€ç®¡ç†æœ‰å…³å¦‚ä½•æ·»åŠ å’Œåˆ é™¤è™šæ‹Ÿä¸»æœºçš„è¯¦ç»†æ­¥éª¤ï¼Œè¯·è®¿é—® æ­¤é“¾æ¥ã€‚ æ‰©å±•ç»„ä»¶çš„å®‰è£…å¦‚æœéœ€è¦å®‰è£…æ‰©å±•ç»„ä»¶å¦‚ eAcceleratorã€xcacheã€memcachedã€imageMagickã€ionCubeã€redis æˆ– opcacheï¼Œè¯·å‚è€ƒ æ­¤é“¾æ¥ã€‚ LNMP ç›¸å…³è½¯ä»¶çš„ç›®å½•åŠæ–‡ä»¶ä½ç½®å…³äº LNMP ç›¸å…³è½¯ä»¶çš„ç›®å½•å’Œæ–‡ä»¶ä½ç½®çš„ä¿¡æ¯ï¼Œå¯ä»¥è®¿é—® æ­¤é“¾æ¥ã€‚ LNMP çŠ¶æ€ç®¡ç†å‘½ä»¤äº†è§£ LNMP çŠ¶æ€ç®¡ç†å‘½ä»¤çš„è¯¦ç»†å†…å®¹ï¼Œè¯·æŸ¥çœ‹ æ­¤é“¾æ¥ã€‚ ä»…å®‰è£…æ•°æ®åº“æˆ– Nginxä» LNMP 1.5 ç‰ˆæœ¬å¼€å§‹ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ä»…å®‰è£… MySQLMariaDB æ•°æ®åº“æˆ– Nginxã€‚è¦å•ç‹¬å®‰è£… Nginxï¼Œè¯·åœ¨å®‰è£…åŒ…ç›®å½•ä¸‹è¿è¡Œï¼š ./install.sh nginx è¦å•ç‹¬å®‰è£…æ•°æ®åº“ï¼Œè¯·è¿è¡Œï¼š ./install.sh db LNMP ä¸€é”®å®‰è£…åŒ…çš„ç¦»çº¿å®‰è£…è¯·æ³¨æ„ï¼Œç¦»çº¿å®‰è£…å¹¶ä¸æ„å‘³ç€ä¸éœ€è¦æºï¼Œè€Œæ˜¯éœ€è¦åœ¨æœ¬åœ°å»ºç«‹ä¸€ä¸ªæºç”¨äºå®‰è£…ã€‚ å¯¹äº CentOS ç³»ç»Ÿï¼Œç¦»çº¿å®‰è£…çš„è¯¦ç»†æ•™ç¨‹è¯·å‚è€ƒ æ­¤é“¾æ¥ã€‚ å¯¹äº DebianUbuntu å‘è¡Œç‰ˆï¼Œéœ€è¦åœ¨å®Œå…¨ç›¸åŒçš„ä¸´æ—¶ç¯å¢ƒä¸‹ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸‹è½½æ‰€æœ‰å¿…éœ€çš„è½¯ä»¶åŒ…ï¼š apt-get install -d è½¯ä»¶åŒ… ç„¶åé€šè¿‡ dpkg-scanpackages å‘½ä»¤å°†è¿™äº›è½¯ä»¶åŒ…æ‰“åŒ…è‡³æºç›®å½•ã€‚å°†è¯¥ç›®å½•æ‰“åŒ…åä¸Šä¼ è‡³ç›®æ ‡æœåŠ¡å™¨å¹¶è®¾ç½®ä¸ºæºå³å¯ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœé€‰æ‹©åœ¨å®‰è£… MySQLMariaDB æ—¶ä½¿ç”¨â€Generic Binariesâ€ï¼ˆäºŒè¿›åˆ¶åŒ…ï¼‰ï¼Œå¿…é¡»æå‰ä¸‹è½½å¥½æŒ‡å®šçš„äºŒè¿›åˆ¶åŒ…å¹¶ä¸Šä¼ è‡³ LNMP å®‰è£…åŒ…çš„ src ç›®å½•ã€‚ å¸è½½ LNMP ä¸€é”®å®‰è£…åŒ…è¦å¸è½½ LNMP ä¸€é”®å®‰è£…åŒ…ï¼Œè¯·åœ¨ LNMP å®‰è£…åŒ…ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š ./uninstall.sh æŒ‰æç¤ºé€‰æ‹©å½“å‰ç¯å¢ƒç±»å‹å¹¶å›è½¦ç¡®è®¤ï¼Œè¯¥æ“ä½œä¼šåˆ é™¤ LNMP çš„ç›¸å…³ç¨‹åºç»„ä»¶ï¼ŒåŒæ—¶ä¿ç•™ç½‘ç«™æ–‡ä»¶å’Œå¤‡ä»½æ•°æ®åº“ç›®å½•è‡³ /root ç›®å½•ä¸‹ã€‚å¦‚æœè¿˜æœ‰å…¶ä»–éœ€è¦ä¿å­˜çš„æ–‡ä»¶ï¼Œè¯·ç¡®ä¿åœ¨å¸è½½å‰è¿›è¡Œå¤‡ä»½ã€‚ ç‹¬ç«‹å®‰è£…å®‰è£… Nginxä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨çš„ç³»ç»Ÿä¸Šå®‰è£… Nginxï¼š sudo apt install nginx æ­¤å‘½ä»¤é€šè¿‡ APT åŒ…ç®¡ç†å™¨ä»é»˜è®¤è½¯ä»¶æºä¸­ä¸‹è½½å¹¶å®‰è£… Nginxã€‚å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡è®¿é—® http://localhost æ¥æ£€æŸ¥ Nginx æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒNginx ä¼šåœ¨åœ°å€æ è¾“å…¥â€localhostâ€æ—¶æ˜¾ç¤ºæ¬¢è¿é¡µé¢ã€‚ ç¼–è¾‘ Nginx é…ç½®é¦–å…ˆï¼Œè¿›å…¥ Nginx çš„é…ç½®ç›®å½•ï¼š cd /etc/nginx/sites-enabled åˆ é™¤é»˜è®¤é…ç½®æ–‡ä»¶ï¼Œä»¥é˜²æ­¢å®ƒå¹²æ‰°è‡ªå·±çš„è®¾ç½®ï¼š sudo rm -f default æ¥ä¸‹æ¥ï¼Œæ–°å»ºä¸€ä¸ªåä¸º test çš„é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š sudo vim test åœ¨æ‰“å¼€çš„ç¼–è¾‘å™¨ä¸­ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œä»¥é…ç½® Nginx æœåŠ¡ï¼š server listen 80; root /var/www/html; server_name localhost; location / index index.php index.html index.htm; error_page 500 502 503 504 /50x.html; location = /50x.html root /var/www/html; location ~ \\.php$ fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; åœ¨æ­¤é…ç½®ä¸­ï¼Œé‡è¦çš„éƒ¨åˆ†æ˜¯ï¼š listen 80; è¡¨ç¤º Nginx å°†ç›‘å¬ HTTP è¯·æ±‚ã€‚ root /var/www/html; æŒ‡å®šç½‘ç«™æ–‡ä»¶çš„æ ¹ç›®å½•ã€‚ location ~ \\.php$ éƒ¨åˆ†å¯ç”¨å¯¹ PHP æ–‡ä»¶çš„å¤„ç†ã€‚ å®Œæˆè¾“å…¥åï¼ŒæŒ‰ Esc é€€å‡ºæ’å…¥æ¨¡å¼ï¼Œè¾“å…¥ :wq ä¿å­˜å¹¶é€€å‡ºã€‚ å¯åŠ¨ã€è®¾ç½®å¼€æœºå¯åŠ¨ Nginxæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ Nginx æœåŠ¡ï¼š sudo systemctl start nginx æ¥ç€è®¾ç½® Nginx åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œï¼š sudo systemctl enable nginx æ£€æŸ¥ Nginx æœåŠ¡çŠ¶æ€åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­è®¿é—®ä»¥ä¸‹åœ°å€ï¼Œç¡®è®¤ Nginx æœåŠ¡æ­£åœ¨æ­£å¸¸è¿è¡Œï¼š http://çš„äº‘æœåŠ¡å™¨å®ä¾‹çš„å…¬ç½‘ IP å¦‚æœçœ‹åˆ° Nginx æ¬¢è¿é¡µé¢ï¼Œå°±è¯æ˜çš„é…ç½®æˆåŠŸäº†ï¼ MySQL æ•°æ®åº“è¦é…ç½® MySQLï¼Œé¦–å…ˆéœ€è¦é€šè¿‡å‘½ä»¤è¡Œè¿›å…¥ MySQL çš„å‘½ä»¤è¡Œç•Œé¢ã€‚è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤è¿›è¡Œè®¾ç½®ã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å®‰è£… MariaDBï¼Œå®ƒæ˜¯ MySQL çš„ç¤¾åŒºç‰ˆæœ¬ï¼š sudo apt install mariadb-server mariadb-client å¯åŠ¨ MySQLåœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å¯åŠ¨ MySQLï¼š sudo mysql è®¾ç½® root ç”¨æˆ·å¯†ç è¿›å…¥ MySQL åï¼Œéœ€è¦ä¸º root ç”¨æˆ·è®¾ç½®ä¸€ä¸ªå®‰å…¨å¯†ç ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š ALTER USER root@localhost IDENTIFIED WITH mysql_native_password BY mynewpassword; åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå°†å¯†ç è®¾ç½®ä¸º Mysql@1234ï¼Œå› æ­¤å¯ä»¥è¿è¡Œï¼š ALTER USER root@localhost IDENTIFIED WITH mysql_native_password BY Mysql@1234; é€€å‡º MySQLåœ¨è®¾ç½®å¯†ç åï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ä»¥é€€å‡º MySQLï¼š exit; å®‰å…¨é…ç½® MySQLä¸ºäº†æå‡ MySQL çš„å®‰å…¨æ€§ï¼Œæ¥ä¸‹æ¥è¦è¿è¡Œå®‰å…¨é…ç½®å‘½ä»¤ã€‚ä½¿ç”¨ï¼š sudo mysql_secure_installation æ ¹æ®æç¤ºä¾æ¬¡å®Œæˆä»¥ä¸‹é…ç½®é¡¹ï¼š è¾“å…¥ root ç”¨æˆ·çš„å¯†ç ï¼š è¿™é‡Œè¦è¾“å…¥åˆšåˆšè®¾ç½®çš„å¯†ç ï¼Œä¾‹å¦‚ Mysql@1234ã€‚ Securing the MySQL server deployment.Enter password for user root: è¯´æ˜ï¼šåœ¨è¾“å…¥å¯†ç æ—¶ï¼Œç³»ç»Ÿä¸ä¼šæ˜¾ç¤ºå­—ç¬¦ä»¥ç¡®ä¿å®‰å…¨ã€‚åªéœ€è¾“å…¥å¯†ç å¹¶æŒ‰ Enterã€‚ æ›´æ”¹ root ç”¨æˆ·å¯†ç ï¼š ç³»ç»Ÿä¼šè¯¢é—®æ˜¯å¦å¸Œæœ›æ›´æ”¹ root ç”¨æˆ·çš„å¯†ç ï¼Œå¯ä»¥è¾“å…¥ Yã€‚ Change the password for root? (Press y|Y for Yes, any other key for No) : Y ç„¶åå†æ¬¡è¾“å…¥æ–°å¯†ç ï¼Œå¹¶ç¡®è®¤è¾“å…¥ã€‚ åˆ é™¤åŒ¿åç”¨æˆ·ï¼š è¾“å…¥ Y æ¥åˆ é™¤ MySQL è‡ªå¸¦çš„åŒ¿åç”¨æˆ·ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQL å®‰è£…æ—¶ä¼šåˆ›å»ºåŒ¿åç”¨æˆ·ï¼Œè¿™ä¼šè®©ä»»ä½•äººéƒ½èƒ½ç™»å½• MySQLï¼Œä¸éœ€è¦åˆ›å»ºç”¨æˆ·è´¦å·ï¼Œä»…é™äºæµ‹è¯•ä½¿ç”¨ã€‚ Remove anonymous users? (Press y|Y for Yes, any other key for No) : Y ç¦æ­¢ root ç”¨æˆ·è¿œç¨‹ç™»å½•ï¼š è¾“å…¥ Yï¼Œä»¥ç¡®ä¿ root åªå¯ä»¥é€šè¿‡ localhost è¿›è¡Œè¿æ¥ï¼Œé¿å…ä»ç½‘ç»œä¸Šè¢«çŒœæµ‹å¯†ç ã€‚ Disallow root login remotely? (Press y|Y for Yes, any other key for No) : Y ç§»é™¤ test æ•°æ®åº“ï¼š é€šè¿‡è¾“å…¥ Yï¼Œä¼šç§»é™¤ MySQL é»˜è®¤çš„ test æ•°æ®åº“ï¼Œé¿å…å…¶ä»–ç”¨æˆ·éšæ„è®¿é—®ã€‚ Remove test database and access to it? (Press y|Y for Yes, any other key for No) : Y é‡æ–°åŠ è½½æˆæƒè¡¨ï¼š è¾“å…¥ Y ç”¨ä»¥é‡è½½æƒé™è¡¨ï¼Œç¡®ä¿æ‰€æœ‰æ›´æ”¹ç«‹å³ç”Ÿæ•ˆã€‚ Reload privilege tables now? (Press y|Y for Yes, any other key for No) : Y å½“å‘½ä»¤è¡Œå›æ˜¾ All done! æ—¶ï¼Œè¡¨ç¤ºå®‰å…¨é…ç½®å·²å®Œæˆã€‚ æµ‹è¯•ç™»å½•åˆ° MySQL æ•°æ®åº“ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯•æ˜¯å¦èƒ½å¤ŸæˆåŠŸç™»å½• MySQL æ•°æ®åº“ï¼š sudo mysql -uroot -p æ­¤æ—¶å‘½ä»¤è¡Œä¼šæç¤ºè¾“å…¥å¯†ç ï¼š Enter password: åŒæ ·ï¼Œè¾“å…¥å¯†ç æ—¶å‘½ä»¤è¡Œä¸ä¼šæ˜¾ç¤ºå­—ç¬¦ã€‚è¾“å…¥æ­£ç¡®çš„å¯†ç åï¼Œå°†çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„ä¿¡æ¯ï¼Œè¿™è¡¨æ˜å·²æˆåŠŸç™»å½•ï¼š Welcome to the MySQL monitor. Commands end with ; or \\g.Your MySQL connection id is 15Server version: 8.0.29-0ubuntu0.20.04.3 (Ubuntu)Copyright (c) 2000, 2022, Oracle and/or its affiliates.Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners.Type help; or \\h for help. Type \\c to clear the current input statement.mysql å®‰è£… PHPå®‰è£… PHPä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… PHP åŠå…¶å¸¸ç”¨æ¨¡å—ï¼š sudo apt install php7.4-cli php7.4-common php7.4-mysqlnd php7.4-fpm å¯åŠ¨ PHP-FPM æœåŠ¡æ£€æŸ¥å®‰è£…çš„ç‰ˆæœ¬æ˜¯å¦ä¸º 7.4ã€‚å¦‚æœç¡®è®¤æ˜¯ 7.4ï¼Œæ¥ç€å¯åŠ¨ PHP-FPM æœåŠ¡ï¼š systemctl start php7.4-fpm ç„¶åå°† PHP-FPM æœåŠ¡è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨ï¼š systemctl enable php7.4-fpm ä¿®æ”¹ Nginx é…ç½®ä»¥æ”¯æŒ PHPå†æ¬¡æ‰“å¼€ Nginx é…ç½®æ–‡ä»¶ï¼š sudo vim /etc/nginx/sites-enabled/test æŒ‰ä¸‹ i è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œæ‰¾åˆ° fastcgi_pass è¡Œï¼Œå°†å…¶ä¿®æ”¹ä¸ºï¼š fastcgi_pass unix:/var/run/php/php7.4-fpm.sock; å®Œæˆåï¼ŒæŒ‰ Escï¼Œè¾“å…¥ :wq ä¿å­˜å¹¶é€€å‡ºã€‚ éªŒè¯ç¯å¢ƒé…ç½®è‹¥ /var/www/html æ–‡ä»¶å¤¹ä¸‹æœ‰å…¶ä»–æ–‡ä»¶ï¼Œå…ˆç”¨ä»¥ä¸‹å‘½ä»¤åˆ é™¤å®ƒä»¬ï¼š sudo rm -rf /var/www/html/* æ¥ç€ï¼Œåˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼š sudo vim /var/www/html/index.php åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹è¾“å…¥ï¼š ?php phpinfo(); ? ä¿å­˜å¹¶é€€å‡ºåï¼Œé‡å¯ Nginx æœåŠ¡ï¼š sudo systemctl restart nginx æœ€åï¼Œåœ¨æœ¬åœ°æµè§ˆå™¨ä¸­è®¿é—®ä»¥ä¸‹åœ°å€ï¼ŒæŸ¥çœ‹ PHP ç¯å¢ƒé…ç½®æ˜¯å¦æˆåŠŸï¼š http://çš„äº‘æœåŠ¡å™¨å®ä¾‹çš„å…¬ç½‘ IP å¦‚æœé¡µé¢æ˜¾ç¤º PHP ä¿¡æ¯ï¼Œè¯´æ˜ç¯å¢ƒé…ç½®æˆåŠŸï¼","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨","åšå®¢"]},{"title":"Qexoæœ¬åœ°éƒ¨ç½²","path":"/2024/04/19/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-åšå®¢-Qexoæœ¬åœ°éƒ¨ç½²/","content":"Qexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€å¼ºå¤§ã€ç¾è§‚çš„åœ¨çº¿ é™æ€åšå®¢ç¼–è¾‘å™¨ã€‚ä½¿ç”¨ GPL3.0 å¼€æºåè®®ã€‚æ”¯æŒåŒ…æ‹¬ä¸”ä¸é™äºåœ¨ Vercel ç­‰å¹³å°éƒ¨ç½², ä¸ºçš„é™æ€åšå®¢æ·»åŠ åŠ¨æ€çš„å…ƒç´  é¡¹ç›®åœ°å€ï¼š https://github.com/Qexo/Qexo æœ¬åœ°éƒ¨ç½²å®‰è£… mysql sudo apt install mysql-server æŸ¥çœ‹å¹¶æ›´æ–°å¯†ç  sudo cat /etc/mysql/debian.cnf è¿›å…¥ mysqlï¼Œè¾“å…¥ä¸Šé¢æŸ¥è¯¢åˆ°çš„ç”¨æˆ·åå’Œå¯†ç  mysql -u debian-sys-maint -p åˆ›å»º Qexo è¦ä½¿ç”¨è¡¨ create database qexo; å…‹éš† qexo é¡¹ç›®åˆ°æœ¬åœ° git clone https://github.com/Qexo/Qexo.git ç¼–è¾‘é…ç½®ï¼Œä»¥ä½¿ç”¨ Mysql ä¸ºä¾‹, ç¡®è®¤å¥½å®‰è£…ç›¸å…³ä¾èµ–ååœ¨ manage.py çš„åŒçº§ç›®å½•ä¸‹åˆ›å»ºå¹¶ä¿®æ”¹ configs.py import pymysql pymysql.install_as_MySQLdb() DOMAINS = [127.0.0.1, 124.222.246.202] DATABASES = default: ENGINE: django.db.backends.mysql, NAME: æ•°æ®åº“è¡¨, USER: æ•°æ®åº“ç”¨æˆ·å, PASSWORD: æ•°æ®åº“å¯†ç , HOST: 127.0.0.1, PORT: 3306, OPTIONS: init_command: SET sql_mode=STRICT_TRANS_TABLES å®‰è£…ä¾èµ– pip3 install -r requirements.txt python3 manage.py makemigrations python3 manage.py migrate å¯åŠ¨ Qexo åšå®¢ç®¡ç†åç«¯ åå°è¿è¡Œï¼Œé€€å‡º shell ä¹Ÿåœ¨è¿è¡Œ nohup python3 manage.py runserver 0.0.0.0:9082 --noreload è®¿é—®å…¬ç½‘ IP+ ç«¯å£å³å¯æ‰“å¼€ Qexo ç®¡ç†é¡µé¢","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨","åšå®¢"]},{"title":"Hexo+GithubPages éƒ¨ç½²åšå®¢","path":"/2024/04/18/1-å¹³å°ç³»ç»Ÿ-æœåŠ¡å™¨-åšå®¢-Hexo-GithubPages-éƒ¨ç½²åšå®¢/","content":"ä½¿ç”¨ GitHub ç»“åˆ Hexo æ­å»ºé™æ€åšå®¢æˆ–ç½‘ç«™æ—¶ï¼Œå¯ä»¥é€šè¿‡ GitHub Actions å®ç°å®Œæ•´çš„è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹ã€‚è¿™ç§éƒ¨ç½²æ–¹å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå°†æºç ä¸å‘å¸ƒå†…å®¹åˆ†ç¦»ï¼Œä»è€Œæå‡é¡¹ç›®ç®¡ç†çš„æ¸…æ™°åº¦å’Œå®‰å…¨æ€§ã€‚ä»¥ä¸‹ä¸ºè¯¦ç»†æ­¥éª¤å’Œå®ç°æ–¹å¼è¯´æ˜ã€‚ 1. æºç ä»“åº“çš„è®¾ç«‹ä¸ç”¨é€”åœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªç§æœ‰ä»“åº“ï¼Œå‘½åä¸ºä¾‹å¦‚ myblog-sourceï¼Œç”¨äºå­˜æ”¾ Hexo æºä»£ç ã€‚ è¿™ä¸ªä»“åº“åŒ…å«ä»¥ä¸‹å…³é”®å†…å®¹ï¼š _config.ymlï¼šHexo çš„ä¸»é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰ç«™ç‚¹æ ‡é¢˜ã€ä½œè€…ã€éƒ¨ç½²ç›®æ ‡ç­‰ä¿¡æ¯ã€‚ source/_posts/ï¼šå­˜æ”¾æ‰€æœ‰ Markdown æ ¼å¼æ’°å†™çš„åšå®¢æ–‡ç« ã€‚ themes/ï¼šå­˜æ”¾å½“å‰ä½¿ç”¨çš„ä¸»é¢˜ï¼ˆå¦‚ nextã€landscapeï¼‰æˆ–è‡ªå®šä¹‰ä¸»é¢˜ã€‚ scaffolds/ã€scripts/ ç­‰ Hexo ç‰¹æœ‰ç›®å½•ï¼šç”¨äºç”Ÿæˆæ–°æ–‡ç« æ¨¡æ¿æˆ–æ‰©å±•åŠŸèƒ½ã€‚ package.jsonï¼šåˆ—å‡ºé¡¹ç›®ä¾èµ–ï¼ˆå¦‚ hexo-cliã€hexo-renderer-marked ç­‰ï¼‰ï¼Œä¾¿äºä»–äººå¤ç°ç¯å¢ƒã€‚ 2. å‘å¸ƒä»“åº“çš„åˆ›å»ºä¸é…ç½®å¦å»ºä¸€ä¸ª GitHub ä»“åº“ï¼Œå‘½åä¸º username.github.ioï¼Œå…¶ä¸­ username æ˜¯ä½ çš„ GitHub ç”¨æˆ·åï¼ˆä¾‹å¦‚ zhangsan.github.ioï¼‰ã€‚ è¯¥ä»“åº“çš„ä½œç”¨æ˜¯ï¼š å­˜æ”¾ç”± Hexo ç¼–è¯‘ç”Ÿæˆçš„é™æ€ç½‘é¡µæ–‡ä»¶ï¼ˆä½äº public/ ç›®å½•ä¸‹ï¼‰ã€‚ å¯ç”¨ GitHub Pages åŠŸèƒ½ï¼Œä½¿ç½‘ç«™å¯é€šè¿‡ https://username.github.io å…¬å¼€è®¿é—®ã€‚ 2.1 å¯ç”¨ GitHub Pages ï¼š è¿›å…¥ username.github.io ä»“åº“é¡µé¢ã€‚ ç‚¹å‡»é¡¶éƒ¨èœå•çš„ Settingsï¼ˆè®¾ç½®ï¼‰ã€‚ åœ¨å·¦ä¾§å¯¼èˆªæ æ‰¾åˆ° Pagesï¼ˆé¡µé¢ï¼‰é€‰é¡¹ã€‚ åœ¨ Sourceï¼ˆæºï¼‰éƒ¨åˆ†ï¼Œé€‰æ‹©åˆ†æ”¯ï¼ˆå¦‚ main æˆ– gh-pagesï¼‰å’Œæ ¹ç›®å½• /ã€‚ ä¿å­˜åï¼Œé¡µé¢ä¼šæ˜¾ç¤ºå·²éƒ¨ç½²æˆåŠŸçš„ URLï¼Œé€šå¸¸å‡ ç§’å†…å³å¯ç”Ÿæ•ˆã€‚ 3. é…ç½® SSH è®¿é—®æƒé™ç”±äºå·¥ä½œæµéœ€è¦å‘å¦ä¸€ä¸ªä»“åº“æ¨é€å†…å®¹ï¼Œå¿…é¡»è§£å†³æƒé™é—®é¢˜ã€‚æ¨èä½¿ç”¨ Deploy Key + Secrets çš„ç»„åˆæ–¹å¼ï¼Œå®‰å…¨ä¸”é«˜æ•ˆã€‚ 3.1 ç”Ÿæˆ SSH å¯†é’¥å¯¹åœ¨æœ¬åœ°ç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š ssh-keygen -t rsa -b 4096 -C deploy@github.com -f ./github-deploy-key -N è¯¥å‘½ä»¤ä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼š github-deploy-keyï¼šç§é’¥ï¼ˆprivate keyï¼‰ github-deploy-key.pubï¼šå…¬é’¥ï¼ˆpublic keyï¼‰ 3.2 å°†å…¬é’¥æ·»åŠ åˆ°å‘å¸ƒä»“åº“ æ‰“å¼€ username.github.io ä»“åº“ã€‚ è¿›å…¥ Settings Deploy keys Add deploy key å°† github-deploy-key.pub çš„å†…å®¹ç²˜è´´è¿›â€œKeyâ€æ–‡æœ¬æ¡†ã€‚ å‹¾é€‰ Allow write accessï¼ˆå…è®¸å†™å…¥æƒé™ï¼‰ã€‚ ç‚¹å‡»ä¿å­˜ã€‚ æ­¤æ—¶ï¼Œæ‹¥æœ‰å¯¹åº”ç§é’¥çš„æœåŠ¡å°±å¯ä»¥å‘æ­¤ä»“åº“æ¨é€å†…å®¹ã€‚ 3.3 å°†ç§é’¥å­˜å…¥æºç ä»“åº“çš„ Secrets å›åˆ°æºç ä»“åº“ï¼ˆå¦‚ myblog-sourceï¼‰ã€‚ è¿›å…¥ Settings Secrets and variables Actionsã€‚ ç‚¹å‡» New repository secretã€‚ åç§°å¡«å†™ ACTIONS_DEPLOY_KEYï¼ˆä¸ workflow ä¸­å¼•ç”¨çš„ secret åä¸€è‡´ï¼‰ã€‚ å€¼å¡«å†™ github-deploy-key æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹ï¼ˆåŒ…æ‹¬ -----BEGIN OPENSSH PRIVATE KEY----- ç­‰æ ‡è¯†ï¼‰ã€‚ 4. ä½¿ç”¨ GitHub Actions å®ç°è‡ªåŠ¨åŒ–æ„å»ºä¸éƒ¨ç½²ä¸ºäº†å®ç°â€œæäº¤å³å‘å¸ƒâ€çš„ä½“éªŒï¼Œéœ€è¦åœ¨æºç ä»“åº“ä¸­è®¾ç½®è‡ªåŠ¨åŒ–çš„ CICD æµç¨‹ã€‚GitHub Actions æä¾›äº†è¿™ä¸€èƒ½åŠ›ã€‚ 4.1 åˆ›å»ºå·¥ä½œæµæ–‡ä»¶åœ¨æºç ä»“åº“ä¸­åˆ›å»ºè·¯å¾„ .github/workflows/deploy.ymlï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š name: Deploy Hexo Site on: push: branches: - main #ç›‘å¬mainåˆ†æ”¯çš„æ¨é€ env: GIT_USER: luhuaCyan GIT_EMAIL: liuluhua7@gmail.com DEPLOY_REPO: luhuaCyan/luhuaCyan.github.io DEPLOY_BRANCH: main jobs: build-and-deploy: #éƒ¨ç½²GitHub Pagesçš„ä¸»è¦ä½œä¸šã€‚å®šä¹‰æ­¥éª¤æ¥æ„å»ºå¹¶å‡†å¤‡è¦å‘å¸ƒçš„å†…å®¹ã€‚ è¯¥ä½œä¸šåœ¨ Ubuntu æœ€æ–°ç‰ˆæœ¬çš„ç¯å¢ƒä¸­è¿è¡Œã€‚ runs-on: ubuntu-latest #ä½œä¸šè¿è¡Œçš„ç¯å¢ƒ steps: #æ‰§è¡Œçš„æ­¥éª¤ - name: Checkout source code #æ£€å‡ºæºä»£ç  uses: actions/checkout@v4 #ä½¿è°ƒç”¨ actions/checkout@v4 å¯ä»¥å®ç° Checkout ä¸€ä¸ª git ä»“åº“åˆ°å®¹å™¨ã€‚ with: persist-credentials: true # ä¿æŒå‡­æ®ï¼ˆé»˜è®¤é€šå¸¸ä¸ºtrueï¼‰ fetch-depth: 1 # æµ…å…‹éš†ï¼Œåªè·å–æœ€æ–°çš„æäº¤ï¼Œå‡å°‘å…‹éš†æ—¶é—´ token: $ secrets.ACTIONS_DEPLOY_KEY - name: Setup Node.js 20 #è®¾ç½® Node.js çš„ç‰ˆæœ¬ä¸º 20ã€‚ uses: actions/setup-node@v4 #è°ƒç”¨ actions/setup-node@v4 å¯ä»¥é…ç½®å®¹å™¨ Node.js ç¯å¢ƒã€‚ with: #with.node-version å¯ä»¥æŒ‡å®š Node.js ç‰ˆæœ¬ã€‚ node-version: 20 cache: npm # è‡ªåŠ¨ç¼“å­˜ npm ä¾èµ– - name: Install dependencies run: | npm install npm install hexo-cli -g npm install hexo-theme-stellar # å®‰è£…ä¸»é¢˜ - name: Configure theme run: | # å¤åˆ¶ä¸»é¢˜é…ç½®æ–‡ä»¶ cp _config.theme.stellar.yml node_modules/hexo-theme-stellar/_config.yml cp _config.theme.stellar.widgets.yml node_modules/hexo-theme-stellar/_data/widgets.yml - name: Generate static files run: hexo generate - name: Deploy to GitHub Pages uses: peaceiris/actions-gh-pages@v3 with: external_repository: luhuaCyan/luhuaCyan.github.io # æ·»åŠ æ­¤è¡ŒæŒ‡å®šç›®æ ‡ä»“åº“ publish_branch: main # å‘å¸ƒåˆ†æ”¯ publish_dir: ./public # å‘å¸ƒç›®å½• personal_token: $ secrets.ACTIONS_DEPLOY_KEY user_name: github-actions[bot] # ç”¨æˆ·å user_email: github-actions[bot]@users.noreply.github.com # ç”¨æˆ·é‚®ç®± æ–‡æ¡£ï¼šhttps://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-deploy-to-external-repository-external_repository 4.2 å·¥ä½œæµæ‰§è¡Œé€»è¾‘ï¼š å½“ä½ å‘æºç ä»“åº“çš„ main åˆ†æ”¯æ¨é€ä»£ç æ—¶ï¼Œè§¦å‘æ­¤ workflowã€‚ GitHub Actions è‡ªåŠ¨å¯åŠ¨ä¸€ä¸ª Ubuntu è™šæ‹Ÿæœºç¯å¢ƒã€‚ æ‹‰å–æºç ï¼Œå®‰è£… Node.js åŠ Hexo æ‰€éœ€ä¾èµ–ã€‚ æ‰§è¡Œ hexo generate å‘½ä»¤ï¼Œå°† Markdown æ–‡ä»¶ç¼–è¯‘æˆ HTMLã€CSSã€JS ç­‰é™æ€èµ„æºï¼Œè¾“å‡ºåˆ° public/ æ–‡ä»¶å¤¹ã€‚ ä½¿ç”¨ç§é’¥ï¼ˆdeploy keyï¼‰å°† public/ å†…å®¹æ¨é€åˆ° username.github.io ä»“åº“ã€‚ 5. éªŒè¯éƒ¨ç½²æµç¨‹æ˜¯å¦æ­£å¸¸å®Œæˆä¸Šè¿°é…ç½®åï¼Œè¿›è¡Œä¸€æ¬¡æµ‹è¯•ï¼š åœ¨ myblog-source ä¸­æ·»åŠ ä¸€ç¯‡æ–°æ–‡ç« ï¼Œä¾‹å¦‚ source/_posts/hello-world.mdã€‚ æäº¤å¹¶æ¨é€è‡³ main åˆ†æ”¯ï¼š git add .git commit -m Add first postgit push origin main è¿›å…¥ Actions æ ‡ç­¾é¡µï¼ŒæŸ¥çœ‹ workflow æ˜¯å¦å¯åŠ¨å¹¶æˆåŠŸè¿è¡Œã€‚ æˆåŠŸåï¼Œè¿›å…¥ username.github.io ä»“åº“ï¼Œç¡®è®¤ public/ ä¸­çš„æ–‡ä»¶å·²è¢«åŒæ­¥ã€‚ æµè§ˆ https://username.github.ioï¼ŒæŸ¥çœ‹æ–°æ–‡ç« æ˜¯å¦ä¸Šçº¿ã€‚ Github å›¾åºŠé…ç½® åˆ›å»ºä¸€ä¸ª public ä»“åº“ è¿›å…¥ Settings-Developer Settings-Personal access tokens (classic) ç”Ÿæˆ token è®¾ç½®è‡ªå®šä¹‰åŸŸåä¸º https://raw.staticdn.net/liuluhua/liuluhua.github.io/ImageBed GitHubGithub Pages éƒ¨ç½²GitHub Pages æ˜¯ç”± GitHub å®˜æ–¹æä¾›çš„ä¸€ç§å…è´¹çš„é™æ€ç«™ç‚¹æ‰˜ç®¡æœåŠ¡ï¼Œè®©å¯ä»¥åœ¨ GitHub ä»“åº“é‡Œæ‰˜ç®¡å’Œå‘å¸ƒè‡ªå·±çš„é™æ€ç½‘ç«™é¡µé¢ã€‚ åˆ›å»º GitHub è´¦å·ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåŸºäºç”¨æˆ·å.github.io çš„ä»“åº“ ä½¿ç”¨ GitHub Pages è¿›è¡Œéƒ¨ç½²ï¼Œæ‰€å»ºä»“åº“å¿…é¡»å–åä¸ºâ€GitHub ç”¨æˆ·å.github.ioâ€ å‹¾é€‰â€Add a README fileâ€ï¼Œä¸ç„¶åé¢ä¼šçœ‹ä¸åˆ° GitHub Pages åŸŸåå’Œéƒ¨ç½²åˆ†æ”¯ ä»“åº“éœ€è¦åˆ›å»ºä¸ºå…¬æœ‰ä»“åº“ï¼Œå³ public ä»“åº“å¤§å°é™åˆ¶ä¸º åˆ›å»ºå®Œæˆå GitHub Pages ç»™æä¾›äº†ä¸€ä¸ªæ ¼å¼ä¸º https://GitHubç”¨æˆ·å.github.io çš„å…è´¹åŸŸåï¼Œå¹¶ä¸”ç›¸åº”çš„ç½‘ç«™æ˜¯ä»è¯¥ä»“åº“çš„ mainmaster åˆ†æ”¯æ„å»ºå¾—åˆ°çš„ è‡ªå®šä¹‰åŸŸåï¼Œåœ¨ GitHub ä»“åº“ Settings-Pages-Custom domain æ·»åŠ è‡ªå·±çš„åŸŸå GitHub ActionsGitHub Actions æ˜¯ GitHub æä¾›çš„ä¸€é¡¹æŒç»­é›†æˆï¼ˆCIï¼‰å’ŒæŒç»­éƒ¨ç½²ï¼ˆCDï¼‰æœåŠ¡ï¼Œå…è®¸å¼€å‘è€…è‡ªåŠ¨åŒ–è½¯ä»¶å¼€å‘å·¥ä½œæµç¨‹ã€‚é€šè¿‡ GitHub Actionsï¼Œå¯ä»¥åœ¨ GitHub ä¸Šè¿è¡Œè‡ªå®šä¹‰çš„ä»£ç ï¼ˆç§°ä¸ºåŠ¨ä½œï¼‰ï¼Œä»¥å“åº”å­˜å‚¨åº“ä¸­çš„äº‹ä»¶ï¼Œä¾‹å¦‚æ¨é€ä»£ç ã€åˆ›å»ºæ‹‰å–è¯·æ±‚ç­‰ã€‚ ä¸€ä¸ª GitHub Actions çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯ workflowï¼ˆå·¥ä½œæµï¼‰ï¼Œå®ƒæ˜¯ä¸€ç³»åˆ—ç”±åŠ¨ä½œç»„æˆçš„è‡ªå®šä¹‰ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡å¯ä»¥åœ¨ç‰¹å®šçš„äº‹ä»¶è§¦å‘æ—¶è‡ªåŠ¨æ‰§è¡Œã€‚æ¯ä¸ª workflow éƒ½å®šä¹‰äº†ä¸€ç³»åˆ—æ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤åˆåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªåŠ¨ä½œã€‚workflow å¯ä»¥ç”¨ YAML æ ¼å¼å®šä¹‰ï¼Œå¹¶å­˜å‚¨åœ¨å­˜å‚¨åº“çš„ .github/workflows ç›®å½•ä¸­ã€‚ é€šè¿‡ GitHub Actionsï¼Œå®ç°å°†ä»£ç åŒæ­¥ GitHub ä¹‹åï¼Œç”± GitHub Actions æ‰§è¡Œé¡µé¢çš„å‘å¸ƒã€‚ æ‰§è¡Œ GitHub Actionsï¼Œåœ¨éœ€è¦æ‰§è¡Œçš„å‚¨å­˜åº“ä¸­å‰å¾€Â Settings Pages Sourceï¼Œå¹¶å°†Â SourceÂ æ”¹ä¸ºÂ GitHub Actionsã€‚ åœ¨å‚¨å­˜åº“ä¸­å»ºç«‹Â .github/workflows/blogPublish.yml å¹¶å†™å…¥å†…å®¹ ç¯å¢ƒå˜é‡é…ç½®åœ¨ Settings â€“ Secrets and Variables â€“ Actions é‡Œé¢,é…ç½®åï¼Œå¯ä»¥åœ¨ actions é‡Œé¢é€šè¿‡Â $ secrets.dingtalk_secret è°ƒç”¨åˆ°å¯¹åº”çš„æ•°æ® æ–‡ç« æ›´æ–°æ—¶é—´é—®é¢˜ä½¿ç”¨ Github Actions é€ æˆçš„æ–‡ç« æ›´æ–°æ—¶é—´é—®é¢˜å‚è€ƒåŸæ–‡ï¼š https://mrseawave.github.io/blogs/articles/2021/01/07/ci-hexo-update-time/ å½“ä½¿ç”¨ Github Actions è‡ªåŠ¨åŒ–éƒ¨ç½²æ—¶ï¼Œå‘ç°éƒ¨ç½²æˆåŠŸåï¼Œæ‰€æœ‰æ–‡ç« çš„æ›´æ–°æ—¶é—´éƒ½å˜æˆäº†æ­¤æ¬¡æäº¤ä¿®æ”¹çš„æ—¶é—´ï¼Œä½†æœ‰äº›æ–‡ç« åœ¨ä¸Šä¸€æ¬¡æäº¤åæ˜¯æ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•ä¿®æ”¹çš„ã€‚ è¿™æ˜¯å› ä¸º git åœ¨æ¨é€æ›´æ–°æ—¶ï¼Œå¹¶ä¸è®°å½•ä¿å­˜æ–‡ä»¶çš„è®¿é—®æ—¶é—´ã€ä¿®æ”¹æ—¶é—´ç­‰å…ƒä¿¡æ¯ï¼Œï¼ˆåŸå› åœ¨è¿™é‡Œï¼‰æ‰€ä»¥æ¯æ¬¡ä½¿ç”¨ git æŠŠé¡¹ç›® clone ä¸‹æ¥æ—¶ï¼Œæ–‡ä»¶çš„æ—¶é—´éƒ½æ˜¯å…‹éš†æ—¶çš„æ—¶é—´ã€‚åˆå› ä¸ºå¦‚æœæ²¡æœ‰åœ¨ front-matter ä¸­æŒ‡å®š updatedï¼ŒHexo ä¼šé»˜è®¤ä½¿ç”¨æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ä½œä¸ºæ–‡ç« çš„æ›´æ–°æ—¶é—´ï¼Œæ‰€ä»¥ä¼šå‡ºç°æ‰€æœ‰æ–‡ç« çš„æ›´æ–°æ—¶é—´éƒ½å‘ç”Ÿå˜åŒ–çš„æƒ…å†µã€‚ æ€»çš„æ¥è¯´ï¼Œä½¿ç”¨ git clone ä¸‹æ¥çš„æ–‡ä»¶çš„æ—¶é—´éƒ½ä¸æ˜¯åŸæ¥æ–‡ä»¶çš„æ—¶é—´ï¼Œè€Œè‡ªåŠ¨åŒ–éƒ¨ç½²æ¯æ¬¡éƒ½éœ€è¦ clone æºç æ‰èƒ½è¿›è¡Œåé¢çš„ç”Ÿæˆå’Œéƒ¨ç½²æ“ä½œï¼Œæ‰€ä»¥ç›®å‰å¦‚æœæƒ³æ­£ç¡®æ˜¾ç¤ºæ›´æ–°æ—¶é—´ã€‚å¯¹äº Github Actions å¯ä»¥ä½¿ç”¨å‘½ä»¤åœ¨æ„å»ºä¹‹å‰è¿›è¡Œå¤„ç† jobs: deploy_gh_pages: steps: - name: Restore file modification time run: | git ls-files -z | while read -d path; do touch -d $(git log -1 --format=@%ct $path) $path; done å¦‚æœ git å‘½ä»¤ä¸å¥½ç”¨ï¼Œ ä¹Ÿå¯ä»¥ä½¿ç”¨ find å‘½ä»¤ find source/_posts -name *.md | while read file; do touch -d $(git log -1 --format=@%ct $file) $file; done å®é™…ä¸Šï¼Œclone ä¸‹æ¥çš„æ–‡ä»¶çš„æ—¶é—´è¿˜æ˜¯å…‹éš†æ—¶çš„æ—¶é—´ï¼Œç„¶åé€šè¿‡ä¸Šé¢çš„å‘½ä»¤ï¼Œå®ƒå°† clone ä¸‹æ¥çš„æ–‡ä»¶çš„æ—¶é—´æ”¹æˆäº†è¯¥æ–‡ä»¶æœ€è¿‘ä¸€æ¬¡å˜åŠ¨çš„æ¨é€æ—¶é—´ï¼ˆä¹Ÿå³æ–‡ä»¶æœ€åä¸€æ¬¡ä¿®æ”¹çš„ push æ—¶é—´ï¼‰ã€‚ æ³¨ï¼šå¦‚æœ github actions ä¸­ä½¿ç”¨ actionscheckout@v2ï¼Œè¯·è®¾å®šå®ƒçš„å‚æ•° fetch-depth: 0ï¼Œå› ä¸º 0 è¡¨ç¤ºè·å–æ‰€æœ‰åˆ†æ”¯å’Œæ ‡ç­¾çš„æ‰€æœ‰å†å²è®°å½•ã€‚é»˜è®¤å€¼ä¸º 1 gitignoreåœ¨ Git ä»“åº“çš„æ ¹ç›®å½•ä¸‹ç¼–è¾‘æœ‰.gitignore æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€äº›ä¸éœ€è¦ä¸Šä¼ è‡³ GitHub çš„å†…å®¹ï¼Œåˆ—åœ¨è¯¥æ–‡ä»¶ä¸­çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹å°†ä¼šè¢«å¿½ç•¥ï¼Œä¸åœ¨ä¸Šä¼  Hexo å¿½ç•¥æ–‡ä»¶.DS_StoreThumbs.dbdb.json*.lognode_modules/public/.deploy*/_multiconfig.yml Obsidian å¿½ç•¥æ–‡ä»¶.obsidian/workspace .obsidian æ–‡ä»¶æœ¬èº«æ˜¯å¯ä»¥åŒæ­¥çš„ï¼Œå½“å‰å­˜å‚¨åº“çš„æ’ä»¶ä»¥åŠç›¸å…³çš„é…ç½®éƒ½ä¼šä¸‹è½½åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œå› æ­¤å°†å…¶åŒæ­¥åˆ° git è®°å½•ä¸­ä¹Ÿæ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå‡å¦‚åˆ‡æ¢è®¾å¤‡å°±ä¸éœ€è¦é‡æ–°ä¸ºå½“å‰çš„å­˜å‚¨åº“é‡æ–°é…ç½® Obsidian äº†ã€‚ GitHub ä»“åº“éƒ¨ç½²æºç ä»“åº“éƒ¨ç½² åˆ›å»ºä¸€ä¸ªç§æœ‰ä»“åº“ï¼Œæ­¤å¤„åˆ›å»ºä¸€ä¸ª BlogDeploy ä»“åº“ï¼Œä»“åº“æ‹‰å–åˆ°æœ¬åœ°åï¼Œåœ¨ä»“åº“ä¸­éƒ¨ç½² Hexoä½¿ç”¨ åˆ›å»º gitignore æ–‡ä»¶ï¼Œæ’é™¤ Hexo ä¸ç”¨ä¸Šä¼ çš„æ–‡ä»¶ åŒæ­¥ä»“åº“åˆ°è¿œç«¯ å‘å¸ƒä»“åº“éƒ¨ç½² åˆ›å»ºä¸€ä¸ª GitHub ä»“åº“ï¼Œä»“åº“å¿…é¡»å–åä¸ºâ€GitHub ç”¨æˆ·å.github.ioâ€ ä»“åº“éœ€è¦åˆ›å»ºä¸ºå…¬æœ‰ä»“åº“ï¼Œå³ public åˆ›å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œåˆ†æ”¯åä¸º ImageBedï¼Œç”¨äºåšå›¾åºŠä¸Šä¼  è·å– Tokenï¼Œé€‰æ‹©ç”¨æˆ· Settings-Developer settings-Personal access tokensï¼Œtoken çš„æƒé™è·å–ï¼Œå‹¾ä¸Š workflow å³å¯ å›¾åºŠåˆ†æ”¯åˆ›å»ºç”¨äºå­˜å‚¨å›¾ç‰‡ï¼Œå›¾åºŠåˆ†æ”¯çš„ç›¸å…³ä¿¡æ¯éƒ¨ç½²å®Œæˆåï¼Œéœ€è¦åœ¨ PicGo ä¸­è¿›è¡Œé…ç½® git checkout -b my-test //åœ¨å½“å‰åˆ†æ”¯ä¸‹åˆ›å»ºmy-testçš„æœ¬åœ°åˆ†æ”¯åˆ†æ”¯git push origin my-test //å°†my-teståˆ†æ”¯æ¨é€åˆ°è¿œç¨‹git branch --set-upstream-to=origin/my-test //å°†æœ¬åœ°åˆ†æ”¯my-testå…³è”åˆ°è¿œç¨‹åˆ†æ”¯my-testä¸Š git branch -a //æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯","categories":["1.å¹³å°ç³»ç»Ÿ","æœåŠ¡å™¨","åšå®¢"]},{"title":"å¤§å°ç«¯å­—èŠ‚åºå’Œä½åº","path":"/2024/04/15/2-ç¼–ç¨‹è¯­è¨€-Cè¯­è¨€-ä½è¿ç®—-å¤§å°ç«¯å­—èŠ‚åºå’Œä½åº/","content":"å¤§å°ç«¯çš„æ•°æ®åå‘ä¾‹ï¼šä¸€ä¸ª 32 ä½ unsigned long æ•°æ®ç±»å‹çš„åå‘ unsigned long wrd;wrd = ((wrd0xFF000000)24)|((wrd0x00FF0000)8)|((wrd0x0000FF00)8)|((wrd0x000000FF)24); å¯¹ wrd å˜é‡ä¸­çš„ 32 ä½æ•´æ•°è¿›è¡Œå­—èŠ‚åè½¬ï¼Œå³å°†å­—èŠ‚é¡ºåºä»å¤§ç«¯æ ¼å¼ï¼ˆbig-endianï¼‰è½¬æ¢ä¸ºå°ç«¯æ ¼å¼ï¼ˆlittle-endianï¼‰ï¼Œæˆ–åä¹‹ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™æ®µä»£ç å°† wrd ä¸­çš„ 4 ä¸ªå­—èŠ‚çš„ä½ç½®äº’æ¢ã€‚ ((wrd0xFF000000)24) æå– wrd çš„æœ€é«˜å­—èŠ‚ï¼ˆç¬¬ 1 ä¸ªå­—èŠ‚ï¼‰ï¼Œå¹¶å³ç§» 24 ä½ï¼Œå°†å…¶ç§»åˆ°æœ€ä½å­—èŠ‚ä½ç½®ã€‚ ((wrd0x00FF0000)8) æå– wrd çš„ç¬¬ 2 ä¸ªå­—èŠ‚ï¼Œå¹¶å³ç§» 8 ä½ï¼Œå°†å…¶ç§»åˆ°å€’æ•°ç¬¬ 2 ä¸ªå­—èŠ‚ä½ç½®ã€‚ ((wrd0x0000FF00)8) æå– wrd çš„ç¬¬ 3 ä¸ªå­—èŠ‚ï¼Œå¹¶å·¦ç§» 8 ä½ï¼Œå°†å…¶ç§»åˆ°ç¬¬ 2 ä¸ªå­—èŠ‚ä½ç½®ã€‚ ((wrd0x000000FF)24) æå– wrd çš„æœ€ä½å­—èŠ‚ï¼ˆç¬¬ 4 ä¸ªå­—èŠ‚ï¼‰ï¼Œå¹¶å·¦ç§» 24 ä½ï¼Œå°†å…¶ç§»åˆ°æœ€é«˜å­—èŠ‚ä½ç½®ã€‚ æœ€åï¼Œé€šè¿‡æŒ‰ä½æˆ–è¿ç®— (|) å°†è¿™äº›ä½ç»„åˆæˆæ–°çš„ 32 ä½æ•´æ•°ï¼Œä»è€Œå®ç°å­—èŠ‚é¡ºåºçš„å®Œå…¨åè½¬ã€‚ä¾‹å¦‚ï¼Œå°† 0x12345678 å˜ä¸º 0x78563412ã€‚ æŒ‰ä½é€†åºunsigned long wrd;wrd = (((wrd0xaaaaaaaa)1)|((wrd0x55555555)1));wrd = (((wrd0xcccccccc)2)|((wrd0x33333333)2));wrd = (((wrd0xf0f0f0f0)4)|((wrd0x0f0f0f0f)4));wrd = (((wrd0xff00ff00)8)|((wrd0x00ff00ff)8));return ((wrd16) | (wrd16)); å°† wrd å˜é‡ä¸­çš„ 32 ä½æ•´æ•°æŒ‰ä½è¿›è¡Œåè½¬ï¼ˆå³å°†äºŒè¿›åˆ¶çš„æœ€é«˜ä½ä¸æœ€ä½ä½äº¤æ¢ï¼Œæ¬¡é«˜ä½ä¸æ¬¡ä½ä½äº¤æ¢ï¼Œä»¥æ­¤ç±»æ¨ï¼‰ï¼Œå®ç°32 ä½æ•´æ•°çš„æ¯”ç‰¹ç¿»è½¬ã€‚ ä»£ç çš„å®ç°åˆ†å¤šä¸ªæ­¥éª¤ï¼Œé€æ­¥å®ç°ä½çš„åè½¬ï¼š wrd = (((wrd0xaaaaaaaa)1)|((wrd0x55555555)1)); å°† wrd çš„ç›¸é‚»ä¸¤ä½äº’æ¢ï¼ˆå¥‡æ•°ä½ä¸å¶æ•°ä½äº’æ¢ï¼‰ã€‚ wrd = (((wrd0xcccccccc)2)|((wrd0x33333333)2)); å°† wrd çš„æ¯ 2 ä½ç»„å†…çš„ä½äº’æ¢ã€‚ wrd = (((wrd0xf0f0f0f0)4)|((wrd0x0f0f0f0f)4)); å°† wrd çš„æ¯ 4 ä½ç»„å†…çš„ä½äº’æ¢ã€‚ wrd = (((wrd0xff00ff00)8)|((wrd0x00ff00ff)8)); å°† wrd çš„æ¯ 8 ä½ç»„å†…çš„ä½äº’æ¢ã€‚ return ((wrd16) | (wrd16)); å°† wrd çš„é«˜ 16 ä½å’Œä½ 16 ä½äº¤æ¢ã€‚ æœ€ç»ˆç»“æœæ˜¯ wrd ä¸­çš„ 32 ä½è¢«å®Œå…¨æŒ‰ä½åè½¬ï¼Œå¦‚å°† 0x12345678 å˜ä¸º 0x1E6A2C48ã€‚ å¤§å°ç«¯å­—èŠ‚åºå¤§ç«¯å­—èŠ‚åºï¼ˆBig-Endianï¼‰å’Œå°ç«¯å­—èŠ‚åºï¼ˆLittle-Endianï¼‰æ˜¯ä¸¤ç§ä¸åŒçš„å­—èŠ‚å­˜å‚¨é¡ºåºæ–¹å¼ï¼Œç”¨äºåœ¨å¤šå­—èŠ‚æ•°æ®ç±»å‹ï¼ˆå¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ï¼‰åœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºã€‚ä¸ç®¡æ˜¯ Motorla æ¨¡å¼è¿˜æ˜¯ Intel æ¨¡å¼ï¼Œåªæœ‰æ•°æ®å­˜åœ¨è·¨å­—èŠ‚å­˜å‚¨çš„æ—¶å€™ï¼Œæ‰ä¼šæœ‰æ‰€åŒºåˆ«ï¼Œå•ä¸ªå­—èŠ‚æ•°æ®ä¸¤è€…æ— å·®å¼‚ã€‚å¤§ç«¯æ¨¡å¼ï¼ˆmotoloraï¼‰ä¸‹ï¼Œæ•°æ®çš„å¤„ç†æ–¹å¼å’Œå¹³å¸¸æ‰‹å†™çš„é¡ºåºç›¸åŒã€‚ ä¿¡å·çš„èµ·å§‹ä½å°±æ˜¯ä¿¡å·çš„æœ€ä½ä½ã€‚ LSBï¼šleast significant byte(æŸä¸ªä¿¡å·çš„æœ€ä½å­—èŠ‚) MSBï¼šmost significant byte(æŸä¸ªä¿¡å·çš„æœ€â¾¼å­—èŠ‚) lsbï¼šleast significant bit(æŸä¸ªä¿¡å·ä¸­æŸä¸ªå­—èŠ‚çš„æœ€ä½æœ‰æ•ˆä½) msbï¼šmost significant bit(æŸä¸ªä¿¡å·ä¸­æŸä¸ªå­—èŠ‚çš„æœ€â¾¼æœ‰æ•ˆä½) å¤§ç«¯å­—èŠ‚åº å¤§ç«¯æ¨¡å¼ä¹Ÿç§° Motorla æ¨¡å¼ï¼Œå­˜å‚¨æ•°æ®çš„æ ¼å¼ä¸ºé«˜å­—èŠ‚ï¼ˆæœ€é«˜æœ‰æ•ˆå­—èŠ‚ï¼‰ä¿å­˜åœ¨ä½çš„å­˜å‚¨åœ°å€ï¼Œè€Œä½å­—èŠ‚ï¼ˆæœ€ä½æœ‰æ•ˆå­—èŠ‚ï¼‰ä¿å­˜åœ¨é«˜çš„å­˜å‚¨åœ°å€ã€‚ æ•°æ®çš„é«˜ä½å­—èŠ‚å­˜å‚¨åœ¨ä½åœ°å€ä½ç½®ï¼Œä½ä½å­—èŠ‚å­˜å‚¨åœ¨é«˜åœ°å€ä½ç½®ã€‚ä¾‹å¦‚ï¼Œæ•´æ•°å€¼ 0x12345678 åœ¨å¤§ç«¯å­—èŠ‚åºä¸­çš„å­˜å‚¨é¡ºåºå¦‚ä¸‹ï¼š åœ°å€ï¼š 0x1000 0x1001 0x1002 0x1003æ•°æ®ï¼š 0x12 0x34 0x56 0x78 å°ç«¯å­—èŠ‚åºå°ç«¯æ¨¡å¼ä¹Ÿç§° Intel æ¨¡å¼ï¼Œå­˜å‚¨æ•°æ®çš„æ ¼å¼ä¸ºä½å­—èŠ‚ä¿å­˜åœ¨è¾ƒä½çš„å­˜å‚¨åœ°å€ï¼Œè€Œé«˜å­—èŠ‚ä¿å­˜åœ¨é«˜çš„å­˜å‚¨åœ°å€ã€‚ æ•°æ®çš„ä½ä½å­—èŠ‚å­˜å‚¨åœ¨ä½åœ°å€ä½ç½®ï¼Œé«˜ä½å­—èŠ‚å­˜å‚¨åœ¨é«˜åœ°å€ä½ç½®ã€‚ä½¿ç”¨åŒæ ·çš„ç¤ºä¾‹å€¼ 0x12345678ï¼Œå°ç«¯å­—èŠ‚åºçš„å­˜å‚¨é¡ºåºå¦‚ä¸‹ï¼š åœ°å€ï¼š 0x1000 0x1001 0x1002 0x1003æ•°æ®ï¼š 0x78 0x56 0x34 0x12 æ‰©å±•æ•°æ®åœ¨å­˜å‚¨å™¨ä¸­çš„å­˜æ”¾é¡ºåºä½åº z å­—èŠ‚ä¸­ä½åº - å‡åºï¼šlsb åœ¨ä¸€ä¸ª Byte çš„æœ€å³è¾¹ï¼Œmsb åœ¨ä¸€ä¸ª Byte çš„æœ€å·¦è¾¹ï¼š Byteï¼šb7-b6-b5-b4-b3-b2-b1-b0 å­—èŠ‚ä¸­ä½åº - é™åºï¼šlsb åœ¨ä¸€ä¸ª Byte çš„æœ€å·¦è¾¹ï¼Œmsb åœ¨ä¸€ä¸ª Byte çš„æœ€å³è¾¹ï¼š Byteï¼šb0-b1-b2-b3-b4-b5-b6-b7 å­—èŠ‚åº å°ç«¯å­˜å‚¨ï¼š å¯¹äºå¤§äºä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ç±»å‹çš„æ•°æ®ï¼Œåœ¨å­˜å‚¨å™¨ä¸­ï¼Œä½å­—èŠ‚å­˜å‚¨åœ¨ä½åœ°å€ï¼Œé«˜å­—èŠ‚å­˜å‚¨åœ¨é«˜åœ°å€ï¼› å¤§ç«¯å­˜å‚¨ï¼š å¯¹äºå¤§äºä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ç±»å‹çš„æ•°æ®ï¼Œåœ¨å­˜å‚¨å™¨ä¸­ï¼Œé«˜å­—èŠ‚å­˜å‚¨åœ¨ä½åœ°å€ï¼Œä½å­—èŠ‚å­˜å‚¨åœ¨é«˜åœ°å€ï¼› å˜é‡å¦‚æœç›´æ¥åœ¨ç¨‹åºä¸­ä½¿ç”¨ä¸€ä¸ª Uint16 çš„å˜é‡ï¼Œä¸ä½¿ç”¨æŒ‡é’ˆæ—¶ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š è·å–è¯¥å˜é‡çš„ä½å­—èŠ‚ï¼šUint8 Temp = (Uint8)(gusVar 0xFF) è·å–è¯¥å˜é‡çš„é«˜å­—èŠ‚ï¼šUint8 Temp = (Uint8)((gusVar 8) 0xFF) å°†è¯¥å˜é‡èµ‹ç»™å…¶ä»–å˜é‡ï¼šUint16 Temp = gusVar; å¦‚æœä½¿ç”¨æŒ‡é’ˆæ¥è·å–å­˜å‚¨åœ¨ 0 å’Œ 1 åœ°å€çš„å€¼â€0x5A5â€ï¼Œåˆ†ä¸ºä»¥ä¸‹æƒ…å†µï¼š å­˜å‚¨æ–¹å¼æ˜¯å¤§ç«¯ï¼Œ0 åœ°å€æ”¾ 0x05ï¼Œ1 åœ°å€æ”¾ 0xA5: å­˜å‚¨æ–¹å¼æ˜¯å°ç«¯ï¼Œ0 åœ°å€æ”¾ 0xA5ï¼Œ1 åœ°å€æ”¾ 0x05; å­˜æ”¾é¡ºåºæ•°æ®åœ¨æŠ¥æ–‡ä¸­çš„å­˜æ”¾é¡ºåºä¾èµ–äºå­—èŠ‚åºå’Œå­—èŠ‚ä¸­çš„ä½åºæ’åºæ–¹å¼ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼š å­—èŠ‚åºï¼šByte0ã€Byte1ã€Byte2ã€Byte3ã€Byte4ã€Byte5ã€Byte6ã€Byte7 ä½åºï¼šbit7ã€bit6ã€bit5ã€bit4ã€bit3ã€bit2ã€bit1ã€bit0 Motorola_LSB å’Œ Motorola_MSB çš„åŒºåˆ«æ˜¯æŸä¸ªä¿¡å·èµ·å§‹ä½ç½®ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œåœ¨æŠ¥æ–‡ä¸­çš„æ˜ å°„ç©ºé—´ä¸ä¸€æ ·ï¼Œæ˜ å°„é¡ºåºä¸€æ ·(ä½å­—èŠ‚æ”¾åœ¨é«˜å­—èŠ‚ï¼Œé«˜å­—èŠ‚æ”¾åœ¨ä½åœ°å€ï¼Œä½åºéƒ½æ˜¯ä»å³åˆ°å·¦æ˜¯ b0 åˆ° b7)ã€‚ Intel(å°ç«¯) ä¿¡å·å€¼ï¼š0x5A5ï¼ŒäºŒè¿›åˆ¶ï¼š010110100101b ä¿¡å·èµ·å§‹ä½ï¼šbyte1 çš„ bit4ï¼Œåœ¨æŠ¥æ–‡ä¸­çš„ç´¢å¼•æ˜¯ 12 ä¿¡å·é•¿åº¦ï¼š12bit typedef struct Uint8 Byte0; Uint8 Byte1; Uint8 Byte2; Uint8 Byte3; Uint8 Byte4; Uint8 Byte5; Uint8 Byte6; Uint8 Byte7;IntelOrder;IntelOrder gstrMsg;Uint16 gusVal = 0x5A5;gstrMsg.Byte1 = (gstrMsg.Byte1 0x0F) | ((Uint8)(gusVal 0x0F) 4); gstrMsg.Byte2 = (gstrMsg.Byte2 0xF0) | ((Uint8)(gusVal 0xF0) 4); gstrMsg.Byte2 = (gstrMsg.Byte2 0x0F) | ((Uint8)((gusVal 8) 0x0F)); Motorola_LSB(å¤§ç«¯) ä¿¡å·å€¼ï¼š0x5A5ï¼ŒäºŒè¿›åˆ¶ï¼š010110100101b ä¿¡å·èµ·å§‹ä½ï¼šbyte1 çš„ bit4ï¼Œåœ¨æŠ¥æ–‡ä¸­çš„ç´¢å¼•æ˜¯ 12 ä¿¡å·é•¿åº¦ï¼š12bit typedef struct Uint8 Byte0; Uint8 Byte1; Uint8 Byte2; Uint8 Byte3; Uint8 Byte4; Uint8 Byte5; Uint8 Byte6; Uint8 Byte7;IntelOrder;IntelOrder gstrMsg;Uint16 gusVal = 0x5A5;gstrMsg.Byte0 = (Uint8)((gusVal 4) 0xFF);gstrMsg.Byte1 = (gstrMsg.Byte1 0x0F) | ((Uint8)(gusVal 4)); Motorola_MSB(å¤§ç«¯) ä¿¡å·å€¼ï¼š0x5A5ï¼ŒäºŒè¿›åˆ¶ï¼š010110100101b ä¿¡å·èµ·å§‹ä½ï¼šbyte1 çš„ bit4ï¼Œåœ¨æŠ¥æ–‡ä¸­çš„ç´¢å¼•æ˜¯ 12 ä¿¡å·é•¿åº¦ï¼š12bit typedef struct Uint8 Byte0; Uint8 Byte1; Uint8 Byte2; Uint8 Byte3; Uint8 Byte4; Uint8 Byte5; Uint8 Byte6; Uint8 Byte7;IntelOrder;IntelOrder gstrMsg;Uint16 gusVal = 0x5A5;gstrMsg.Byte1 = (gstrMsg.Byte1 0xE0) | ((Uint8)((gusVal 7) 0x1F));gstrMsg.Byte2 = (gstrMsg.Byte2 0xFE) | ((Uint8)(gusVal 0x7F)); ä¼ è¾“é¡ºåº å­—èŠ‚é¡ºåºï¼šå…ˆä¼  Byte0ï¼Œæœ€åä¼  Byte7ï¼› å­—èŠ‚å†…ä½åºï¼šå…ˆä¼  bit7ï¼Œæœ€åä¼  bit0ï¼› 64 ä½å’Œ 32 ä½çš„ä¸åŒ64 ä½å’Œ 32 ä½çš„å¤§å°ç«¯æƒ…å†µæ˜¯ç±»ä¼¼çš„ï¼Œä½†å­˜åœ¨ä¸€äº›ç»†å¾®å·®å¼‚ã€‚åœ¨ 64 ä½ç³»ç»Ÿä¸­ï¼Œæ•°æ®è¢«åˆ’åˆ†ä¸º 8 å­—èŠ‚ï¼ˆ64 ä½ï¼‰ï¼Œè€Œåœ¨ 32 ä½ç³»ç»Ÿä¸­ï¼Œæ•°æ®è¢«åˆ’åˆ†ä¸º 4 å­—èŠ‚ï¼ˆ32 ä½ï¼‰ã€‚å› æ­¤ï¼Œå­—èŠ‚çš„é¡ºåºå’Œå¯¹é½æ–¹å¼åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ª 64 ä½æ•´æ•°å€¼ 0x1122334455667788ã€‚åœ¨å¤§ç«¯å­—èŠ‚åºä¸­ï¼Œå­˜å‚¨é¡ºåºå¦‚ä¸‹ï¼š åœ°å€ï¼š 0x1000 0x1001 0x1002 0x1003 0x1004 0x1005 0x1006 0x1007æ•°æ®ï¼š 0x11 0x22 0x33 0x44 0x55 0x66 0x77 0x88 è€Œåœ¨å°ç«¯å­—èŠ‚åºä¸­ï¼Œå­˜å‚¨é¡ºåºå¦‚ä¸‹ï¼š åœ°å€ï¼š 0x1000 0x1001 0x1002 0x1003 0x1004 0x1005 0x1006 0x1007æ•°æ®ï¼š 0x88 0x77 0x66 0x55 0x44 0x33 0x22 0x11 æ¯”è¾ƒæ•´æ•°å€¼ 0x12345678 åœ¨ 64 ä½å’Œ 32 ä½ç³»ç»Ÿä¸Šï¼Œä»¥å¤§ç«¯å­—èŠ‚åºå’Œå°ç«¯å­—èŠ‚åºå­˜å‚¨çš„ç¤ºä¾‹ï¼š 64 ä½ç³»ç»Ÿå¤§ç«¯å­—èŠ‚åºï¼š åœ°å€ï¼š 0x1000 0x1001 0x1002 0x1003 0x1004 0x1005 0x1006 0x1007æ•°æ®ï¼š 0x12 0x34 0x56 0x78 0x00 0x00 0x00 0x00 64 ä½ç³»ç»Ÿå°ç«¯å­—èŠ‚åºï¼š åœ°å€ï¼š 0x1000 0x1001 0x1002 0x1003 0x1004 0x1005 0x1006 0x1007æ•°æ®ï¼š 0x00 0x00 0x00 0x00 0x78 0x56 0x34 0x12 32 ä½ç³»ç»Ÿå¤§ç«¯å­—èŠ‚åºï¼š åœ°å€ï¼š 0x1000 0x1001 0x1002 0x1003æ•°æ®ï¼š 0x12 0x34 0x56 0x78 32 ä½ç³»ç»Ÿå°ç«¯å­—èŠ‚åºï¼š åœ°å€ï¼š 0x1000 0x1001 0x1002 0x1003æ•°æ®ï¼š 0x78 0x56 0x34 0x12 å½±å“å­—èŠ‚åºçš„é€‰æ‹©å¯¹äºä¸åŒçš„è®¡ç®—æœºä½“ç³»ç»“æ„å’Œé€šä¿¡åè®®è‡³å…³é‡è¦ã€‚å®ƒä¸»è¦å½±å“ä»¥ä¸‹æ–¹é¢ï¼š æ•°æ®ä¼ è¾“ï¼šåœ¨ç½‘ç»œé€šä¿¡å’Œæ•°æ®äº¤æ¢ä¸­ï¼Œå¦‚æœé€šä¿¡åŒæ–¹ä½¿ç”¨ä¸åŒçš„å­—èŠ‚åºï¼Œå°±éœ€è¦è¿›è¡Œå­—èŠ‚åºçš„è½¬æ¢ï¼Œä»¥ç¡®ä¿æ­£ç¡®è§£é‡Šå’Œä¼ è¾“æ•°æ®ã€‚ æ–‡ä»¶æ ¼å¼ï¼šæŸäº›æ–‡ä»¶æ ¼å¼ï¼ˆå¦‚å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ï¼‰å¯èƒ½ä½¿ç”¨ç‰¹å®šçš„å­—èŠ‚åºæ¥å­˜å‚¨æ•°æ®ï¼Œå› æ­¤è¯»å–å’Œè§£æè¿™äº›æ–‡ä»¶æ—¶éœ€è¦è€ƒè™‘å­—èŠ‚åºã€‚ å¤„ç†å™¨æ¶æ„ï¼šä¸åŒçš„å¤„ç†å™¨æ¶æ„å¯èƒ½é‡‡ç”¨ä¸åŒçš„å­—èŠ‚åºã€‚ä¾‹å¦‚ï¼Œx86 æ¶æ„ä½¿ç”¨å°ç«¯å­—èŠ‚åºï¼Œè€Œ PowerPC æ¶æ„ä½¿ç”¨å¤§ç«¯å­—èŠ‚åºã€‚åœ¨å¼€å‘è½¯ä»¶æ—¶ï¼Œéœ€è¦æ ¹æ®ç›®æ ‡å¤„ç†å™¨æ¶æ„çš„å­—èŠ‚åºé€‰æ‹©é€‚å½“çš„æ•°æ®å¤„ç†æ–¹å¼ã€‚ æ­£ç¡®åœ°å¤„ç†å­—èŠ‚åºæ˜¯ç¡®ä¿è·¨å¹³å°å…¼å®¹æ€§å’Œæ•°æ®ä¸€è‡´æ€§çš„é‡è¦æ–¹é¢ï¼Œç‰¹åˆ«æ˜¯åœ¨ç½‘ç»œé€šä¿¡å’Œæ•°æ®äº¤æ¢çš„æƒ…å†µä¸‹ã€‚ æ ¡éªŒæ–¹æ³•int main() unsigned int num = 0x01020304; unsigned char *ptr = (unsigned char*)num; if (*ptr == 0x01) printf(å¤§ç«¯å­—èŠ‚åº ); else printf(å°ç«¯å­—èŠ‚åº ); return 0;//è”åˆä½“int checkCPU()\tunion w int a; char b;\tc;\tc.a = 1;\treturn(c.b==1)","categories":["2.ç¼–ç¨‹è¯­è¨€","Cè¯­è¨€","ä½è¿ç®—"]},{"title":"Matlabé™æ€ä»£ç è½¬æ¢ä¸ºåŠ¨æ€åŠ è½½","path":"/2024/04/12/2-ç¼–ç¨‹è¯­è¨€-Matlab-Matlabé™æ€ä»£ç è½¬æ¢ä¸ºåŠ¨æ€åŠ è½½/","content":"1. å°† MATLAB è½¬æ¢ä¸º CC++ ä»£ç åœ¨å°† MATLAB ä»£ç è½¬æ¢ä¸º C æˆ– C++ ä»£ç æ—¶ï¼Œé€šå¸¸ä½¿ç”¨ MATLAB çš„ MATLAB Coder å·¥å…·ã€‚è¿™ä¸ªå·¥å…·å¯ä»¥å°† MATLAB å‡½æ•°ã€è„šæœ¬ã€ç”šè‡³æ•´ä¸ªé¡¹ç›®è½¬æ¢ä¸ºç›¸åº”çš„ C æˆ– C++ ä»£ç ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š æ‰“å¼€ MATLAB ç¯å¢ƒå¹¶åŠ è½½è¦è½¬æ¢çš„è„šæœ¬æˆ–å‡½æ•°ã€‚ åœ¨å‘½ä»¤çª—å£ä¸­è¾“å…¥ codegen å‘½ä»¤ï¼Œåé¢è·Ÿä¸Šæƒ³è¦è½¬æ¢çš„å‡½æ•°åã€‚ä¾‹å¦‚ï¼šcodegen myFunction -args 0ï¼Œå…¶ä¸­ myFunction æ˜¯çš„ MATLAB å‡½æ•°åï¼Œ-args åé¢çš„å‚æ•°æ˜¯å‡½æ•°çš„è¾“å…¥ç±»å‹ã€‚ MATLAB å°†ç”Ÿæˆä¸€ä¸ªä»¥ CC++ è¯­è¨€ç¼–å†™çš„ä»£ç å‰¯æœ¬ï¼Œè¾“å‡ºåˆ°å½“å‰å·¥ä½œç›®å½•ä¸‹ã€‚ 2. åœ¨æ–‡ä»¶ä¸­æ‰§è¡Œ MakefileåŸ·è¡Œ Makefile çš„è¿‡ç¨‹å°±æ˜¯é€šè¿‡è¯¥æ–‡ä»¶æ§åˆ¶ç¼–è¯‘æµç¨‹ã€‚ä»¥ä¸‹æ˜¯ç”¨æ¥äº¤å‰ç¼–è¯‘ä»£ç çš„ Makefile ç¤ºä¾‹ï¼š CC:= arm-none-linux-gnueabi-gccOBJS:=$(patsubst %.c, %.o, $(wildcard *.c))PRO_NAME:= libmatlab.so$(PRO_NAME):$(OBJS)\t$(CC) -shared -o $(PRO_NAME) $(OBJS)%.o:%.c\t$(CC) -c -Wall -I. -o $@ $\tclean:\trm -rf *.o $(PRO_NAME) CC å˜é‡æŒ‡å®šäº†äº¤å‰ç¼–è¯‘å™¨ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ arm-none-linux-gnueabi-gccï¼‰ï¼Œè¯¥ç¼–è¯‘å™¨ç”¨äºç¼–è¯‘é€‚ç”¨äº ARM æ¶æ„çš„ä»£ç ã€‚ OBJS è‡ªåŠ¨ç”Ÿæˆå½“å‰ç›®å½•ä¸‹æ‰€æœ‰ C æºæ–‡ä»¶çš„ç›®æ ‡æ–‡ä»¶åˆ—è¡¨ï¼Œçœå»äº†æ‰‹åŠ¨ç»´æŠ¤å¯¹è±¡æ–‡ä»¶åˆ—è¡¨çš„çƒ¦æ¼ã€‚ PRO_NAME æ˜¯æ‰€ç”Ÿæˆçš„å…±äº«åº“çš„åç§° libmatlab.soã€‚ æ­¤ Makefile å®šä¹‰äº†ç”Ÿæˆå…±äº«åº“çš„è§„åˆ™ï¼šåœ¨ $(PRO_NAME) ä¾èµ–çš„ç›®æ ‡æ–‡ä»¶æ„å»ºæˆåŠŸåï¼Œé“¾æ¥æˆæœ€ç»ˆçš„å…±äº«åº“ã€‚ 3. æ‰§è¡Œ makeï¼Œç”ŸæˆåŠ¨æ€åº“æ–‡ä»¶åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ make å‘½ä»¤ï¼Œè¿™å°†è§¦å‘ Makefile çš„é»˜è®¤ç›®æ ‡ã€‚åœ¨çš„ç»ˆç«¯ä¸­è¾“å…¥ï¼š make å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œç³»ç»Ÿå°†æŒ‰ç…§ Makefile ä¸­å®šä¹‰çš„è§„åˆ™è¿›è¡Œç¼–è¯‘å¹¶ç”Ÿæˆ libmatlab.so æ–‡ä»¶ã€‚è¿™ä¸€æ­¥éª¤ä¼šå°†æ‰€æœ‰çš„ C æºæ–‡ä»¶ç¼–è¯‘æˆå¯¹è±¡æ–‡ä»¶ï¼Œå¹¶é“¾æ¥æˆä¸€ä¸ªå…±äº«åº“ã€‚ 4. å°†åŠ¨æ€åº“æ–‡ä»¶æ·»åŠ åˆ°å¼€å‘æ¿ä¸Šçš„ /opt ç›®å½•ä¸‹å°†ç”Ÿæˆçš„ libmatlab.so åº“æ–‡ä»¶å¤åˆ¶åˆ°å¼€å‘æ¿çš„ /opt ç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®ç°ï¼š scp libmatlab.so user@your_board_ip:/opt è¯·ç¡®ä¿æ›¿æ¢ user å’Œ your_board_ip ä¸ºå®é™…çš„ç”¨æˆ·åå’Œå¼€å‘æ¿çš„ IP åœ°å€ã€‚å¤åˆ¶å®Œæˆåï¼Œçš„å¼€å‘æ¿å°†åœ¨ /opt ç›®å½•ä¸­æ‰¾åˆ°è¿™ä¸ªåŠ¨æ€åº“ã€‚ åœ¨è½¯ä»¶é¡¹ç›®çš„ .pro æ–‡ä»¶ä¸­çš„ LIBS é€‰é¡¹ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œä»¥ä¾¿ç¼–è¯‘å™¨èƒ½å¤Ÿæ‰¾åˆ°å¹¶é“¾æ¥åˆ° libmatlab.soï¼š -L./extlibrary/matlab -lmatlab -Wl,-rpath,/opt å…¶ä¸­ï¼š -L æŒ‡å®šåº“æ–‡ä»¶çš„è·¯å¾„ã€‚ -l è¡¨ç¤ºè¦é“¾æ¥çš„åº“åï¼ˆå»æ‰å‰é¢çš„ lib å’Œåé¢çš„ .soï¼‰ã€‚ -Wl,-rpath æŒ‡å®šè¿è¡Œæ—¶çš„åº“æœç´¢è·¯å¾„ã€‚ 5. å¤åˆ¶å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶æœ€åï¼Œç¡®ä¿å°† Matlab ç¼–è¯‘ç”Ÿæˆçš„å…¨éƒ¨ CC++ å¤´æ–‡ä»¶ï¼Œä»¥åŠé€šè¿‡ Makefile ç”Ÿæˆçš„åº“æ–‡ä»¶å¤åˆ¶åˆ°é¡¹ç›®çš„å·¥ç¨‹ç›®å½•ä¸‹ã€‚è¿™å¯ä»¥é€šè¿‡ç®€å•çš„ cp å‘½ä»¤æ¥å®Œæˆï¼Œä¾‹å¦‚ï¼š cp /path/to/matlab/headers/*.h /path/to/your/project/include/cp /opt/libmatlab.so /path/to/your/project/lib/ è¿™ä¸€æ­¥ç¡®ä¿åœ¨ç¼–è¯‘çš„é¡¹ç›®æ—¶ï¼Œç¼–è¯‘å™¨èƒ½å¤Ÿæ‰¾åˆ°æ‰€æœ‰éœ€è¦çš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶ï¼Œä½¿å¾—ç¼–è¯‘è¿‡ç¨‹é¡ºåˆ©è¿›è¡Œã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Matlab"]},{"title":"ä»Matlabç”Ÿæˆç‹¬ç«‹Cè¯­è¨€ä»£ç ","path":"/2024/04/11/2-ç¼–ç¨‹è¯­è¨€-Matlab-ä»Matlabç”Ÿæˆç‹¬ç«‹Cè¯­è¨€ä»£ç /","content":"MATLAB CoderMATLAB Coder æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå®ƒå¯ä»¥ä» MATLAB ä»£ç ç”Ÿæˆç‹¬ç«‹çš„ã€å¯é˜…è¯»ä¸”å¯ç§»æ¤çš„ CC++ ä»£ç ã€‚è¿™ä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿåœ¨å„ç§ä¸åŒçš„å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨å…¶ MATLAB å¼€å‘çš„ç®—æ³•å’ŒåŠŸèƒ½ï¼Œè€Œæ— éœ€å®Œå…¨ä¾èµ– MATLAB ç¯å¢ƒã€‚ MATLAB ç®—æ³•è½¬åŒ–ä¸ºåµŒå…¥å¼ C ä»£ç çš„å®ç°è¦æ±‚ æ•°æ®ç±»å‹ç®¡ç†åœ¨å°† MATLAB ç®—æ³•è½¬æ¢ä¸º C ä»£ç ä¹‹å‰ï¼Œå¿…é¡»æ˜ç¡®æ¯ä¸ªå˜é‡çš„æ•°æ®ç±»å‹ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨å›¾åƒå¤„ç†é¢†åŸŸï¼Œåƒç´ å€¼é€šå¸¸ä½¿ç”¨ 8 ä½æ— ç¬¦å·æ•´æ•° (uint8) è¡¨ç¤ºã€‚è¿™ç§è¡¨ç¤ºæ–¹å¼ç¡®ä¿äº†æ¯ä¸ªåƒç´ çš„å€¼èŒƒå›´åœ¨ 0 åˆ° 255 ä¹‹é—´ï¼Œä½¿å…¶éå¸¸é€‚åˆäºç°åº¦å›¾åƒçš„è¡¨å¾ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨éŸ³é¢‘å¤„ç†ä¸­ï¼Œé‡‡æ ·å€¼é€šå¸¸ä½¿ç”¨ 16 ä½æœ‰ç¬¦å·æ•´æ•° (int16) è¿›è¡Œè¡¨ç¤ºï¼Œä»¥ä¾¿è¦†ç›– -32768 åˆ° 32767 çš„éŸ³é¢‘ä¿¡å·å¹…åº¦ã€‚å› æ­¤ï¼Œåœ¨ C ä»£ç ä¸­åº”æ˜¾å¼å®šä¹‰è¿™äº›æ•°æ®ç±»å‹ï¼Œä»¥ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œç›¸å…³å˜é‡çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š uint8_t pixel_value; // ç”¨äºå­˜å‚¨å›¾åƒçš„åƒç´ å€¼int16_t sample_value; // ç”¨äºå­˜å‚¨éŸ³é¢‘çš„é‡‡æ ·å€¼ å†…å­˜é™æ€åˆ†é…MATLAB å…è®¸åŠ¨æ€å˜åŒ–å˜é‡çš„å¤§å°ï¼Œè€Œè¿™ä¸€ç‰¹æ€§åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­å¹¶ä¸å¯è¡Œã€‚ä¸ºäº†ç¡®ä¿ä»£ç åœ¨åµŒå…¥å¼è®¾å¤‡ä¸Šé«˜æ•ˆè¿è¡Œï¼Œåº”åœ¨ç¼–è¯‘æ—¶å®Œæˆå†…å­˜åˆ†é…ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤„ç†ä¸€å¹…å›ºå®šå°ºå¯¸çš„å›¾åƒæ—¶ï¼Œå¯ä»¥äº‹å…ˆå®šä¹‰ä¸€ä¸ªæ•°ç»„ä»¥å­˜å‚¨åƒç´ å€¼ï¼Œä»è€Œé¿å…åœ¨è¿è¡Œæ—¶è¿›è¡ŒåŠ¨æ€å†…å­˜åˆ†é…ã€‚è¿™ç§åšæ³•æé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå“åº”é€Ÿåº¦ï¼Œæé«˜äº†ä»£ç çš„å¯é¢„æµ‹æ€§ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š uint8_t image[HEIGHT][WIDTH]; // é¢„å®šä¹‰å›¾åƒçš„é«˜åº¦å’Œå®½åº¦ é™ä½è®¡ç®—å¤æ‚æ€§å’Œå†…å­˜å ç”¨åµŒå…¥å¼è½¯ä»¶è®¾è®¡è€…åœ¨å°†é«˜å±‚ç®—æ³•æ˜ å°„åˆ°æœ‰é™èµ„æºçš„ç¡¬ä»¶æ—¶ï¼Œå¿…é¡»é™ä½ç®—æ³•çš„å¤æ‚æ€§ã€‚è¿™ä¸€è¿‡ç¨‹é€šå¸¸åŒ…æ‹¬ä¼˜åŒ–ç®—æ³•é€»è¾‘ï¼Œä»¥å‡å°‘å…¶å¯¹ CPU å’Œå†…å­˜çš„éœ€æ±‚ã€‚ä¸€ä¸ªå¸¸è§çš„åšæ³•æ˜¯é‡‡ç”¨å›ºå®šç‚¹æ•°å­¦è¿ç®—è€Œéæµ®ç‚¹è¿ç®—ï¼Œå› ä¸ºæµ®ç‚¹è¿ç®—é€šå¸¸éœ€è¦æ˜¾è‘—æ›´å¤šçš„è®¡ç®—èµ„æºå’Œå†…å­˜ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œåœ¨ C ä»£ç ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ•´æ•°æ¥è¿›è¡Œå®šç‚¹è¿ç®—ï¼Œä»¥ä¾¿æä¾›æ›´é«˜çš„æ•ˆç‡ï¼š #define FIXED_POINT_SHIFT 8int32_t fixed_point_value = (int32_t)(input_value * (1 FIXED_POINT_SHIFT)); // å®šç‚¹è¡¨ç¤º æ”¯æŒå®šç‚¹è¿ç®—åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œæ•´ä¸ªç®—æ³•å¿…é¡»ä¸¥æ ¼åœ°å®šä¹‰ä¸ºå®šç‚¹æ•°æ®ç±»å‹ã€‚è¿™æ„å‘³ç€ä»»ä½•æµ®ç‚¹æ•°è¿ç®—éƒ½éœ€è½¬åŒ–ä¸ºå®šç‚¹æ•°è¿ç®—ã€‚åœ¨ C ä»£ç ä¸­ï¼Œç¨‹åºçš„æ•°å­¦è¿ç®—å¿…é¡»é€šè¿‡å·¦å³ç§»ä½æ“ä½œæ¥å®ç°å®šç‚¹æ•°çš„ä¹˜æ³•å’Œé™¤æ³•ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š int32_t multiply_fixed_point(int32_t a, int32_t b) return (int32_t)((a * b) FIXED_POINT_SHIFT); // å®šç‚¹ä¹˜æ³• é€‚é…åµŒå…¥å¼ MATLAB åŠŸèƒ½ ç¼–å†™é€‚ç”¨äºåµŒå…¥å¼ MATLAB çš„å‡½æ•°æ˜¯å®ç°é«˜æ•ˆç®—æ³•çš„é‡è¦æ­¥éª¤ã€‚ç„¶è€Œï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­ï¼Œå¿…é¡»æ³¨æ„å¹¶éæ‰€æœ‰çš„ MATLAB å·¥å…·ç®±å‡½æ•°éƒ½èƒ½åœ¨åµŒå…¥å¼ MATLAB çš„å­é›†ç¯å¢ƒä¸­ä½¿ç”¨ã€‚å·¥å…·ç®±å‡½æ•°å¯ä»¥è¢«è§†ä½œæ¨¡æ¿æˆ–ç¤ºä¾‹ï¼Œå¸®åŠ©ç”¨æˆ·åœ¨èµ„æºå—é™çš„è®¡ç®—å’Œå­˜å‚¨ç¯å¢ƒä¸­å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œåœ¨æŸäº›å®æ—¶ç³»ç»Ÿä¸­ï¼Œå¤æ‚çš„å›¾å½¢ç•Œé¢å·¥å…·ç®±å‡½æ•°å¯èƒ½ä¸å¯ç”¨ï¼Œç”¨æˆ·å¯ä»¥å€ŸåŠ©ç®€å•çš„æ•°å­¦è®¡ç®—å‡½æ•°ï¼Œç¡®ä¿æ ¸å¿ƒç®—æ³•å¾—ä»¥é¡ºåˆ©è¿è¡Œã€‚è€ƒè™‘åˆ°èµ„æºé™åˆ¶ï¼Œé‡‡ç”¨åŸºç¡€çš„æ•°å­¦å‡½æ•°ï¼Œä¸ä»…èƒ½ä¿æŒåŠŸèƒ½çš„å®ç°ï¼Œè¿˜èƒ½æé«˜æ€§èƒ½ã€‚ åœ¨åµŒå…¥å¼ MATLAB ç¼–ç¨‹çš„è¿‡ç¨‹ä¸­ï¼ŒEMLMEX å·¥å…·çš„ä½¿ç”¨è‡³å…³é‡è¦ã€‚å®ƒèƒ½å¤Ÿæœ‰æ•ˆæ£€æµ‹å¯èƒ½å‡ºç°çš„æ‰€æœ‰è¯­æ³•é”™è¯¯ã€‚åœ¨æ¯æ¬¡ç¼–è¯‘æ—¶ï¼ŒEMLMEX éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä»½ç¼–è¯‘æŠ¥å‘Šï¼ŒæŠ¥å‘Šä¸­è¯¦ç»†æè¿°äº†å‘ç°çš„é—®é¢˜ï¼Œå¹¶æä¾›äº†æ¶‰åŠå‡ºé”™ä»£ç è¡Œåœ¨ç¨‹åºä¸­çš„å‡†ç¡®é“¾æ¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŸè¡Œä»£ç å› æ‹¼å†™é”™è¯¯è€Œæœªèƒ½é€šè¿‡ç¼–è¯‘ï¼ŒEMLMEX å°†æ¸…æ¥šåœ°æŒ‡å‡ºå…·ä½“çš„è¡Œå·å’Œé”™è¯¯ç±»å‹ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿè¿…é€Ÿè¿›è¡Œè°ƒæ•´ã€‚è¿™æ ·çš„é«˜æ•ˆæœºåˆ¶æ˜¾è‘—æå‡äº†å¼€å‘æµç¨‹çš„ä¾¿åˆ©æ€§ã€‚ ç”Ÿæˆ CC++ ä»£ç çš„æ­¥éª¤ä½¿ç”¨ MATLAB Coder ç”Ÿæˆ CC++ ä»£ç çš„è¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹ä¸‰æ­¥ï¼š å‡†å¤‡ MATLAB ç®—æ³•: ç¡®ä¿æ‰€è¦ç”Ÿæˆä»£ç çš„ MATLAB æ–‡ä»¶ç¼–å†™æ— è¯¯ã€‚å‡½æ•°éœ€è¦ä»¥é€‚åˆä»£ç ç”Ÿæˆçš„æ ¼å¼ä¹¦å†™ï¼Œä¾‹å¦‚ä¸ä½¿ç”¨ä¸å…¼å®¹çš„å‡½æ•°æˆ–ç‰¹æ€§ã€‚ æ£€æŸ¥ MATLAB ä»£ç çš„å…¼å®¹æ€§: æœ‰äº› MATLAB ä»£ç çš„è¯­å¥å¹¶ä¸èƒ½ç›´æ¥è½¬æ¢æˆ CC++ ä»£ç ã€‚å› æ­¤ï¼Œè¿›è¡Œå…¼å®¹æ€§æ£€æŸ¥æ˜¯å¿…è¦çš„ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨åç»­æ­¥éª¤ä¸­å‡ºç°é”™è¯¯ã€‚ ç”Ÿæˆæºä»£ç æˆ– MEX æ–‡ä»¶: æœ€ç»ˆæ­¥éª¤æ˜¯é€šè¿‡ MATLAB Coder å·¥å…·é€‰æ‹©åˆé€‚çš„è¾“å‡ºç±»å‹ç”Ÿæˆ CC++ ä»£ç æˆ–è€… MEX æ–‡ä»¶ã€‚ ç•Œé¢ç¼–å†™ MATLAB æ–‡ä»¶: åˆ›å»ºä¸€ä¸ªåä¸º foo.m çš„ MATLAB æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­åŒ…å«äº†ä¸¤ä¸ªæ•°ç›¸ä¹˜çš„åŠŸèƒ½ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š function c = foo(a, b) %#codegen% è¯¥å‡½æ•°ç”¨äºè®¡ç®—å‚æ•° a å’Œ b çš„ä¹˜ç§¯c = a * b; % æ‰§è¡Œä¹˜æ³•æ“ä½œ åœ¨æ­¤ä»£ç ä¸­ï¼Œ%#codegen æ³¨è§£ä¸ä»…æ˜¯ä¸€ä¸ªæŒ‡ç¤ºï¼Œå®ƒè¿˜ç”¨äºå‘ŠçŸ¥ç¼–è¯‘å™¨åœ¨è¿›è¡Œä»£ç ç”Ÿæˆæ—¶ä¸è¦ç”Ÿæˆå…³äºä¸å…¼å®¹è¯­æ³•çš„è­¦å‘Šã€‚è¿™æ ·çš„è®¾è®¡ä½¿å¾—åœ¨ä¸ C æˆ– C++ ç­‰è¯­è¨€äº¤äº’æ—¶ï¼Œå¯ä»¥ç¡®ä¿ä¿æŒè‰¯å¥½çš„å…¼å®¹æ€§ã€‚ é€‰æ‹©ç¼–è¯‘å™¨: æ‰“å¼€ MATLAB çš„å‘½ä»¤çª—å£ï¼Œè¾“å…¥å¹¶æ‰§è¡Œ mex -setupï¼Œæ¥ç€å°†å‡ºç°ä¸€ç³»åˆ—å·²å®‰è£…ç¼–è¯‘å™¨çš„é€‰é¡¹ã€‚åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„ç¼–è¯‘å™¨ï¼Œæ¯”å¦‚ Microsoft Visual C++ï¼Œä»¥ç¡®ä¿æ¥ä¸‹æ¥çš„æ­¥éª¤èƒ½å¤Ÿé¡ºåˆ©è¿›è¡Œã€‚ å¯åŠ¨ MATLAB Coder: åœ¨å‘½ä»¤çª—å£ä¸­è¾“å…¥ coder å¹¶æŒ‰ä¸‹å›è½¦é”®ï¼Œæ­¤æ“ä½œä¼šå¼¹å‡º MATLAB Coder Project å¯¹è¯æ¡†ï¼Œè¿™ä¸ºæ¥ä¸‹æ¥çš„é¡¹ç›®è®¾ç½®æä¾›äº†ä¸€ä¸ªå‹å¥½çš„ç”¨æˆ·ç•Œé¢ã€‚ åˆ›å»ºæ–°é¡¹ç›®: åœ¨ â€œNewâ€ é€‰é¡¹å¡çš„ Name ä¸­å¡«å…¥é¡¹ç›®åç§° foo.prjï¼Œç„¶åå•å‡» OK è¿›å…¥ MEX Function å¯¹è¯æ¡†ï¼Œå¼€å§‹è®¾ç½®é¡¹ç›®çš„å…·ä½“å‚æ•°ã€‚ æ·»åŠ æ–‡ä»¶: ç‚¹å‡» Overview é€‰é¡¹å¡ä¸­çš„ Add filesï¼Œé€‰æ‹©å¹¶æ‰“å¼€å…ˆå‰åˆ›å»ºçš„ foo.m æ–‡ä»¶ã€‚è¿™ä¸€æ“ä½œç¡®ä¿äº†é¡¹ç›®ä¸­æœ‰å¤„ç†ä¹˜æ³•æ‰€éœ€çš„ä»£ç ã€‚ å®šä¹‰è¾“å…¥å˜é‡: é€‰ä¸­å˜é‡ aï¼Œç„¶åé€‰æ‹© Define by Exampleâ€¦ã€‚åœ¨å¼¹å‡ºçš„ MATLAB Expression è¾“å…¥æ¡†ä¸­è¾“å…¥å€¼ 5ï¼Œç„¶åç‚¹å‡» OKã€‚è¿™ä¸€è¿‡ç¨‹åŒæ ·é€‚ç”¨äºå˜é‡ bï¼Œå…¶è¾“å…¥å€¼ä¸º 6ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå®šä¹‰è¾“å…¥å˜é‡èƒ½æœ‰æ•ˆåœ°å¸®åŠ© MATLAB Coder ç†è§£å‡½æ•°çš„è¿è¡Œç¯å¢ƒã€‚ è®¾ç½®è¾“å‡ºç±»å‹: åœ¨ Build é€‰é¡¹å¡ä¸­ï¼Œå°† Output type è®¾ç½®ä¸º cc++ Static Libraryï¼Œå¹¶è¯·ç¡®ä¿å‹¾é€‰ Generate code onlyã€‚è¿™æ ·è®¾ç½®æ„å‘³ç€ç”Ÿæˆçš„ä»£ç å°†ä¼šç¼–è¯‘æˆä¸€ä¸ªé™æ€åº“å½¢å¼ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæœ‰åŠ©äºåç»­åœ¨å…¶ä»–è¯­è¨€ä¸­çš„è°ƒç”¨ã€‚ æ›´å¤šè®¾ç½®: ç‚¹å‡» More settingsï¼Œé€‰æ‹© General - Language è®¾ç½®ä¸º C++ï¼Œåœ¨ Interface é€‰é¡¹ä¸­å»æ‰æ‰€æœ‰é€‰é¡¹ï¼Œä»¥ç¡®ä¿ç”Ÿæˆçš„ä»£ç å…¼å®¹æ€§å’Œç®€æ´æ€§ï¼Œå®Œæˆè®¾ç½®åç‚¹å‡» Closeã€‚ ç”Ÿæˆä»£ç : ç‚¹å‡» Build è¿›è¡Œä»£ç ç¼–è¯‘ã€‚åœ¨ç¼–è¯‘å®Œæˆåçš„ç•Œé¢ä¸­ï¼Œå¯ä»¥ç‚¹å‡» View report æ¥æŸ¥çœ‹ç”Ÿæˆçš„æŠ¥å‘Šï¼Œå…¶ä¸­è¯¦ç»†åˆ—å‡ºå˜é‡ aã€b å’Œ c çš„ä¿¡æ¯ã€‚è¿™ä¸€æ­¥éª¤å¯¹äºæ£€æŸ¥ä»£ç çš„æ­£ç¡®æ€§å’Œæ€§èƒ½è‡³å…³é‡è¦ã€‚ ç¼–å†™æµ‹è¯•ä»£ç : åˆ›å»ºä¸€ä¸ªåä¸º test.cpp çš„æ–‡ä»¶ï¼Œåœ¨æ­¤æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹ä»£ç ï¼Œä»¥ä¾¿äºæµ‹è¯•ç”Ÿæˆçš„åŠŸèƒ½ï¼š #include stdafx.h#include foo.h#include iostreamusing namespace std;int _tmain(int argc, _TCHAR* argv[]) double a = 0.0, b = 0.0, c = 0.0; cout Enter two numbers: ; cin a b; // ä»æ ‡å‡†è¾“å…¥è¯»å–ç”¨æˆ·è¾“å…¥çš„ä¸¤ä¸ªæ•° c = foo(a, b); // è°ƒç”¨ç”Ÿæˆçš„ foo å‡½æ•°æ‰§è¡Œä¹˜æ³•è¿ç®— cout c = c endl; // è¾“å‡ºä¹˜æ³•ç»“æœ return 0; å‘½ä»¤è¡Œç›´æ¥åº”ç”¨ EMLC å·¥å…·ï¼Œç”¨æˆ·å¯ä»¥å°†é€‚ç”¨äºåµŒå…¥å¼ MATLAB çš„ç¨‹åºè½¬æ¢ä¸º C æºä»£ç ã€‚ä¸¾ä¾‹è€Œè¨€ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å°† adaptive-stats-roi.m ç¨‹åºç”Ÿæˆ C ä»£ç ï¼š emlc adaptive-stats-roi.m -egIn-c -report æ­¤å¤„ï¼Œ-report é€‰é¡¹å…è®¸ç”¨æˆ·ç”Ÿæˆä¸€ä»½åŒ…å« C æºæ–‡ä»¶è¶…é“¾æ¥çš„ HTML æŠ¥å‘Šï¼ŒåŒæ—¶è‡ªåŠ¨ç”Ÿæˆ MATLAB å‡½æ•°æ‰€éœ€çš„å¤´æ–‡ä»¶ã€‚è¿™ç§æ•´åˆçš„æ–¹å¼ä½¿ç”¨æˆ·èƒ½å¤Ÿæ–¹ä¾¿åœ°å°†ç°æœ‰çš„ C ä»£ç èå…¥åµŒå…¥å¼ MATLAB æµç¨‹ä¸­ã€‚ å¯¹äºå·²ç»å¼€å‘çš„ C å‡½æ•°åº“ï¼Œå¼€å‘è€…é€šå¸¸å¸Œæœ›åœ¨ç¨‹åºä¸­é‡å¤åˆ©ç”¨å®ƒä»¬ã€‚åµŒå…¥å¼ MATLAB æä¾›äº† C ç¨‹åºæ¥å£ç¨‹åº em1_cevalï¼Œå…è®¸ç”¨æˆ·åœ¨åµŒå…¥å¼ MATLAB ä¸­è°ƒç”¨å¤–éƒ¨ C å‡½æ•°ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ roi_stats.m ç¨‹åºä¸­ï¼Œç”¨æˆ·å¯ä»¥æŠŠè°ƒç”¨ MATLAB å‡½æ•° mysort æ›¿æ¢ä¸ºå·²å­˜åœ¨çš„ C å‡½æ•° c_sortï¼š Bool c_sort(float U[], int n, int m) // C function implementation for sorting è¿™ç§æ›¿æ¢æ¶‰åŠåˆ°äº† em1_ceval å‡½æ•°çš„ä½¿ç”¨ï¼Œå®ƒèƒ½å¤Ÿå°†è¾“å…¥å’Œè¾“å‡ºå‚æ•°çš„æ•°å€¼æˆ–å˜é‡ä¼ é€’ç»™ C å‡½æ•°ï¼Œä»è€Œå®ç°åŠŸèƒ½çš„å¤ç”¨å’Œæ•ˆç‡çš„æå‡ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š % Sort the sub-matrix onlysorted = em1_ceval(C_sort, em1_rref(V(1)), em1_wref(V(1)), count, int(numel(V)));","categories":["2.ç¼–ç¨‹è¯­è¨€","Matlab"]},{"title":"Flaskæ¨¡å—","path":"/2024/04/10/2-ç¼–ç¨‹è¯­è¨€-Python-Flaskæ¨¡å—/","content":"ä»€ä¹ˆæ˜¯ Flaskï¼ŸFlask æ˜¯ä¸€ä¸ªç”¨ Python ç¼–å†™çš„è½»é‡çº§ Web æ¡†æ¶ã€‚å®ƒä»¥ç®€å•ã€çµæ´»å’Œå¯æ‰©å±•è‘—ç§°ï¼Œç‰¹åˆ«é€‚åˆå¿«é€Ÿå¼€å‘å’ŒåŸå‹è®¾è®¡ã€‚Flask éµå¾ª WSGI(Web Server Gateway Interface)æ ‡å‡†ï¼Œå¹¶ä½¿ç”¨ Jinja2 æ¨¡æ¿å¼•æ“ã€‚å®ƒçš„æ ¸å¿ƒè®¾è®¡æ˜¯æœ€å°åŒ–é»˜è®¤åŠŸèƒ½ï¼ŒåŒæ—¶å…è®¸é€šè¿‡æ’ä»¶å’Œæ‰©å±•è½»æ¾æ·»åŠ æ‰€éœ€çš„åŠŸèƒ½ã€‚ Flask çš„ç‰¹ç‚¹ è½»é‡çº§ï¼šåªæä¾›åŸºç¡€çš„ Web å¼€å‘åŠŸèƒ½ï¼Œæ²¡æœ‰å¼ºåˆ¶æ€§çš„é¡¹ç›®ç»“æ„ã€‚ æ¨¡å—åŒ–å’Œå¯æ‰©å±•æ€§ï¼šé€šè¿‡æ‰©å±•æ”¯æŒæ•°æ®åº“ ORMï¼ˆå¦‚ SQLAlchemyï¼‰ã€è¡¨å•å¤„ç†ï¼ˆå¦‚ WTFormsï¼‰ç­‰åŠŸèƒ½ã€‚ ç®€æ´æ¸…æ™°ï¼šéå¸¸é€‚åˆåˆå­¦è€…ï¼Œä»£ç ç®€å•æ˜“è¯»ã€‚ ç¤¾åŒºæ´»è·ƒï¼šæ‹¥æœ‰å¤§é‡æ–‡æ¡£ã€æ•™ç¨‹å’Œç¬¬ä¸‰æ–¹æ‰©å±•æ”¯æŒã€‚ å­¦ä¹  Flask çš„å…³é”®è·¯çº¿1. åŸºç¡€çŸ¥è¯† Python åŸºç¡€ï¼šæŒæ¡ Python è¯­æ³•ã€å‡½æ•°ã€æ¨¡å—å’ŒåŒ…çš„ä½¿ç”¨ã€‚ HTTP åè®®ï¼šäº†è§£ HTTP çš„è¯·æ±‚æ–¹æ³•ï¼ˆGETã€POST ç­‰ï¼‰ã€çŠ¶æ€ç ã€URLã€è¯·æ±‚å¤´å’Œå“åº”å¤´ã€‚ HTMLCSSJSï¼šæŒæ¡åŸºæœ¬çš„å‰ç«¯æŠ€æœ¯ï¼Œç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢ã€‚ 2. Flask æ ¸å¿ƒæ¦‚å¿µ å®‰è£…ä¸å¿«é€Ÿå¼€å§‹ï¼š ä½¿ç”¨ pip install flask å®‰è£… Flaskã€‚ å­¦ä¹ æ„å»ºä¸€ä¸ªç®€å•çš„ â€œHello, Worldâ€ åº”ç”¨ã€‚ è·¯ç”±ä¸è§†å›¾å‡½æ•°ï¼š å­¦ä¹ ä½¿ç”¨ @app.route() å®šä¹‰è·¯ç”±ã€‚ ç†è§£åŠ¨æ€è·¯ç”±å’Œ URL å˜é‡ã€‚ æ¨¡æ¿å¼•æ“ï¼š å­¦ä¹ ä½¿ç”¨ Jinja2 æ¨¡æ¿å¼•æ“ã€‚ ç†è§£æ¨¡æ¿ç»§æ‰¿å’ŒåŠ¨æ€æ¸²æŸ“ HTMLã€‚ è¯·æ±‚ä¸å“åº”ï¼š ä½¿ç”¨ request è§£æè¡¨å•æ•°æ®ã€æŸ¥è¯¢å‚æ•°å’Œæ–‡ä»¶ä¸Šä¼ ã€‚ ä½¿ç”¨ Response å¯¹è±¡æ„å»ºè‡ªå®šä¹‰å“åº”ã€‚ é™æ€æ–‡ä»¶ï¼š å­¦ä¹ å¦‚ä½•æä¾› CSSã€JS å’Œå›¾ç‰‡ç­‰é™æ€æ–‡ä»¶ã€‚ è¡¨å•å¤„ç†ï¼š å­¦ä¹ å¦‚ä½•å¤„ç† HTML è¡¨å•ï¼Œåˆæ­¥äº†è§£ CSRF ä¿æŠ¤ã€‚ 3. é«˜çº§åŠŸèƒ½ **è“å›¾ (Blueprints)**ï¼š ç†è§£æ¨¡å—åŒ–åº”ç”¨çš„æ„å»ºæ–¹å¼ã€‚ é€šè¿‡è“å›¾æ‹†åˆ†å¤§é¡¹ç›®ï¼Œæé«˜ä»£ç ç»„ç»‡æ€§ã€‚ æ•°æ®åº“ï¼š å­¦ä¹  Flask-SQLAlchemy é›†æˆã€‚ æŒæ¡åŸºæœ¬çš„ CRUD æ“ä½œã€‚ è®¤è¯ä¸æˆæƒï¼š ä½¿ç”¨ Flask-Login å®ç°ç”¨æˆ·ç™»å½•å’Œä¼šè¯ç®¡ç†ã€‚ å­¦ä¹ åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ã€‚ é”™è¯¯å¤„ç†ï¼š è‡ªå®šä¹‰é”™è¯¯é¡µé¢ï¼ˆå¦‚ 404 å’Œ 500ï¼‰ã€‚ ä¸­é—´ä»¶ï¼š ç†è§£è¯·æ±‚é’©å­ï¼ˆbefore_requestã€after_requestï¼‰çš„ä½œç”¨ã€‚ API å¼€å‘ï¼š ä½¿ç”¨ Flask æ„å»º RESTful APIã€‚ å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Flask-RESTful æˆ– Flask-RESTXã€‚ 4. éƒ¨ç½²ä¸ä¼˜åŒ– éƒ¨ç½²ï¼š ä½¿ç”¨ Gunicornã€uWSGI ç­‰éƒ¨ç½² Flask åº”ç”¨ã€‚ ä½¿ç”¨ Docker æ‰“åŒ…å’Œéƒ¨ç½² Flask é¡¹ç›®ã€‚ æ—¥å¿—å’Œè°ƒè¯•ï¼š é…ç½®æ—¥å¿—è®°å½•ã€‚ å­¦ä¹ è°ƒè¯•å·¥å…·ï¼ˆå¦‚ Flask-DebugToolbarï¼‰ã€‚ æ€§èƒ½ä¼˜åŒ–ï¼š å­¦ä¹ ç¼“å­˜æœºåˆ¶ï¼ˆå¦‚ Flask-Cachingï¼‰ã€‚ ä½¿ç”¨ CDN æå‡é™æ€èµ„æºåŠ è½½é€Ÿåº¦ã€‚ 5. ç»¼åˆé¡¹ç›® æ„å»ºä¸€ä¸ªå®Œæ•´çš„ Web åº”ç”¨ï¼š ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆæ³¨å†Œã€ç™»å½•ã€æ³¨é”€ï¼‰ã€‚ æ•°æ®åº“æ“ä½œï¼ˆä¾‹å¦‚åšå®¢æˆ–ç•™è¨€æ¿ï¼‰ã€‚ å‰åç«¯åˆ†ç¦»ï¼ˆå¦‚ä½¿ç”¨å‰ç«¯æ¡†æ¶ Vue.js æˆ– Reactï¼‰ã€‚ 6. æ‰©å±•é˜…è¯» Flask å®˜æ–¹æ–‡æ¡£ï¼šhttps://flask.palletsprojects.com/ å­¦ä¹  Flask æ‰©å±•ï¼Œå¦‚ï¼š Flask-Mailï¼ˆé‚®ä»¶å‘é€ï¼‰ Flask-Migrateï¼ˆæ•°æ®åº“è¿ç§»ï¼‰ Flask-SocketIOï¼ˆå®æ—¶é€šä¿¡ï¼‰ é€šè¿‡ä»¥ä¸Šå­¦ä¹ è·¯çº¿ï¼Œé€æ­¥æŒæ¡ Flask çš„æ ¸å¿ƒåŠŸèƒ½å’Œå¸¸è§æ‰©å±•ï¼Œå¯ä»¥é«˜æ•ˆå¼€å‘è‡ªå·±çš„ Web åº”ç”¨ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Python"]},{"title":"OpenCV å›¾ç‰‡ç›¸ä¼¼åº¦","path":"/2024/04/09/2-ç¼–ç¨‹è¯­è¨€-Python-OpenCV-å›¾ç‰‡ç›¸ä¼¼åº¦/","content":"å€¼å“ˆå¸Œç®—æ³•ã€å·®å€¼å“ˆå¸Œç®—æ³•å’Œæ„ŸçŸ¥å“ˆå¸Œç®—æ³•æ˜¯ç”¨äºå›¾åƒç›¸ä¼¼æ€§æ¯”è¾ƒçš„é‡è¦å·¥å…·ã€‚è¿™ä¸‰ç§ç®—æ³•çš„è¿”å›å€¼éƒ½åœ¨ 0 åˆ° 64 ä¹‹é—´ï¼Œæ•°å€¼è¶Šå°ï¼Œè¡¨æ˜å›¾åƒä¹‹é—´çš„ç›¸ä¼¼åº¦è¶Šé«˜ã€‚å…¶ä¸­ï¼Œ64 ä½çš„å“ˆå¸Œå€¼å¯ä»¥é€šè¿‡æ±‰æ˜è·ç¦»è¿›è¡Œæ¯”è¾ƒï¼Œæ±‰æ˜è·ç¦»è¡¨ç¤ºä¸¤ä¸ªäºŒè¿›åˆ¶å­—ç¬¦ä¸²ä¹‹é—´ä¸åŒçš„ä½æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œæ±‰æ˜è·ç¦»ä¸º 0 ä»£è¡¨ä¸¤å¼ å›¾ç‰‡å®Œå…¨ç›¸åŒï¼Œè€Œå€¼ä¸º 64 åˆ™è¡¨ç¤ºå®ƒä»¬ä¹‹é—´å·®å¼‚æœ€å¤§ã€‚åŒæ—¶ï¼Œä¸‰ç›´æ–¹å›¾å’Œå•é€šé“ç›´æ–¹å›¾çš„è¿”å›å€¼èŒƒå›´åˆ™æ˜¯ 0 åˆ° 1ï¼Œå€¼è¶Šå¤§ï¼ŒåŒæ ·ä»£è¡¨ç€æ›´é«˜çš„ç›¸ä¼¼åº¦ã€‚ ä¸‹é¢æ˜¯ç›¸å…³ç®—æ³•çš„æºä»£ç ï¼Œå±•ç¤ºäº†å¦‚ä½•é€šè¿‡ Python å’Œ OpenCV è¿›è¡Œå›¾ç‰‡å“ˆå¸Œå¤„ç†åŠç›¸ä¼¼åº¦è®¡ç®—ï¼š import osimport cv2import numpy as npfrom PIL import Imageimport requestsfrom io import BytesIOimport matplotlibimport shutilimport concurrent.futuresimport itertoolsimport psutilimport timefrom queue import Queuematplotlib.use(TkAgg)import matplotlib.pyplot as pltdef aHash(img): # å‡å€¼å“ˆå¸Œç®—æ³• # ç¼©æ”¾ä¸º8*8 img = cv2.resize(img, (8, 8)) # è½¬æ¢ä¸ºç°åº¦å›¾ gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY) # sä¸ºåƒç´ å’Œåˆå€¼ä¸º0ï¼Œhash_strä¸ºhashå€¼åˆå€¼ä¸º s = 0 hash_str = # éå†ç´¯åŠ æ±‚åƒç´ å’Œ for i in range(8): for j in range(8): s = s + gray[i, j] # æ±‚å¹³å‡ç°åº¦ avg = s / 64 # ç°åº¦å¤§äºå¹³å‡å€¼ä¸º1ç›¸åä¸º0ç”Ÿæˆå›¾ç‰‡çš„hashå€¼ for i in range(8): for j in range(8): if gray[i, j] avg: hash_str = hash_str + 1 else: hash_str = hash_str + 0 return hash_strdef dHash(img): # å·®å€¼å“ˆå¸Œç®—æ³• # ç¼©æ”¾8*8 img = cv2.resize(img, (9, 8)) # è½¬æ¢ç°åº¦å›¾ gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY) hash_str = # æ¯è¡Œå‰ä¸€ä¸ªåƒç´ å¤§äºåä¸€ä¸ªåƒç´ ä¸º1ï¼Œç›¸åä¸º0ï¼Œç”Ÿæˆå“ˆå¸Œ for i in range(8): for j in range(8): if gray[i, j] gray[i, j + 1]: hash_str = hash_str + 1 else: hash_str = hash_str + 0 return hash_strdef pHash(img): # æ„ŸçŸ¥å“ˆå¸Œç®—æ³• # ç¼©æ”¾32*32 img = cv2.resize(img, (32, 32)) # , interpolation=cv2.INTER_CUBIC # è½¬æ¢ä¸ºç°åº¦å›¾ gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY) # å°†ç°åº¦å›¾è½¬ä¸ºæµ®ç‚¹å‹ï¼Œå†è¿›è¡Œdctå˜æ¢ dct = cv2.dct(np.float32(gray)) # opencvå®ç°çš„æ©ç æ“ä½œ dct_roi = dct[0:8, 0:8] hash = [] avreage = np.mean(dct_roi) for i in range(dct_roi.shape[0]): for j in range(dct_roi.shape[1]): if dct_roi[i, j] avreage: hash.append(1) else: hash.append(0) return hashdef calculate(image1, image2): # ç°åº¦ç›´æ–¹å›¾ç®—æ³• # è®¡ç®—å•é€šé“çš„ç›´æ–¹å›¾çš„ç›¸ä¼¼å€¼ hist1 = cv2.calcHist([image1], [0], None, [256], [0.0, 255.0]) hist2 = cv2.calcHist([image2], [0], None, [256], [0.0, 255.0]) # è®¡ç®—ç›´æ–¹å›¾çš„é‡åˆåº¦ degree = 0 for i in range(len(hist1)): if hist1[i] != hist2[i]: degree = degree + \\ (1 - abs(hist1[i] - hist2[i]) / max(hist1[i], hist2[i])) else: degree = degree + 1 degree = degree / len(hist1) return degreedef classify_hist_with_split(image1, image2, size=(256, 256)): # RGBæ¯ä¸ªé€šé“çš„ç›´æ–¹å›¾ç›¸ä¼¼åº¦ # å°†å›¾åƒresizeåï¼Œåˆ†ç¦»ä¸ºRGBä¸‰ä¸ªé€šé“ï¼Œå†è®¡ç®—æ¯ä¸ªé€šé“çš„ç›¸ä¼¼å€¼ image1 = cv2.resize(image1, size) image2 = cv2.resize(image2, size) sub_image1 = cv2.split(image1) sub_image2 = cv2.split(image2) sub_data = 0 for im1, im2 in zip(sub_image1, sub_image2): sub_data += calculate(im1, im2) sub_data = sub_data / 3 return sub_datadef cmpHash(hash1, hash2): # Hashå€¼å¯¹æ¯” # ç®—æ³•ä¸­1å’Œ0é¡ºåºç»„åˆèµ·æ¥çš„å³æ˜¯å›¾ç‰‡çš„æŒ‡çº¹hashã€‚é¡ºåºä¸å›ºå®šï¼Œä½†æ˜¯æ¯”è¾ƒçš„æ—¶å€™å¿…é¡»æ˜¯ç›¸åŒçš„é¡ºåºã€‚ # å¯¹æ¯”ä¸¤å¹…å›¾çš„æŒ‡çº¹ï¼Œè®¡ç®—æ±‰æ˜è·ç¦»ï¼Œå³ä¸¤ä¸ª64ä½çš„hashå€¼æœ‰å¤šå°‘æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸åŒçš„ä½æ•°è¶Šå°ï¼Œå›¾ç‰‡è¶Šç›¸ä¼¼ # æ±‰æ˜è·ç¦»ï¼šä¸€ç»„äºŒè¿›åˆ¶æ•°æ®å˜æˆå¦ä¸€ç»„æ•°æ®æ‰€éœ€è¦çš„æ­¥éª¤ï¼Œå¯ä»¥è¡¡é‡ä¸¤å›¾çš„å·®å¼‚ï¼Œæ±‰æ˜è·ç¦»è¶Šå°ï¼Œåˆ™ç›¸ä¼¼åº¦è¶Šé«˜ã€‚æ±‰æ˜è·ç¦»ä¸º0ï¼Œå³ä¸¤å¼ å›¾ç‰‡å®Œå…¨ä¸€æ · n = 0 # hashé•¿åº¦ä¸åŒåˆ™è¿”å›-1ä»£è¡¨ä¼ å‚å‡ºé”™ if len(hash1) != len(hash2): return -1 # éå†åˆ¤æ–­ for i in range(len(hash1)): # ä¸ç›¸ç­‰åˆ™nè®¡æ•°+1ï¼Œnæœ€ç»ˆä¸ºç›¸ä¼¼åº¦ if hash1[i] != hash2[i]: n = n + 1 return ndef getImageByUrl(url): # æ ¹æ®å›¾ç‰‡url è·å–å›¾ç‰‡å¯¹è±¡ html = requests.get(url, verify=False) image = Image.open(BytesIO(html.content)) return imagedef PILImageToCV(): # PIL Imageè½¬æ¢æˆOpenCVæ ¼å¼ path = /Users/waldenz/Documents/Work/doc/TestImages/t3.png img = Image.open(path) plt.subplot(121) plt.imshow(img) print(isinstance(img, np.ndarray)) img = cv2.cvtColor(np.asarray(img), cv2.COLOR_RGB2BGR) print(isinstance(img, np.ndarray)) plt.subplot(122) plt.imshow(img) plt.show()def CVImageToPIL(): # OpenCVå›¾ç‰‡è½¬æ¢ä¸ºPIL image path = /Users/waldenz/Documents/Work/doc/TestImages/t3.png img = cv2.imread(path) # cv2.imshow(OpenCV,img) plt.subplot(121) plt.imshow(img) img2 = Image.fromarray(cv2.cvtColor(img, cv2.COLOR_BGR2RGB)) plt.subplot(122) plt.imshow(img2) plt.show()def bytes_to_cvimage(filebytes): # å›¾ç‰‡å­—èŠ‚æµè½¬æ¢ä¸ºcv image image = Image.open(filebytes) img = cv2.cvtColor(np.asarray(image), cv2.COLOR_RGB2BGR) return imgdef runAllImageSimilaryFun(para1, para2): # å‡å€¼ã€å·®å€¼ã€æ„ŸçŸ¥å“ˆå¸Œç®—æ³•ä¸‰ç§ç®—æ³•å€¼è¶Šå°ï¼Œåˆ™è¶Šç›¸ä¼¼,ç›¸åŒå›¾ç‰‡å€¼ä¸º0 # ä¸‰ç›´æ–¹å›¾ç®—æ³•å’Œå•é€šé“çš„ç›´æ–¹å›¾ 0-1ä¹‹é—´ï¼Œå€¼è¶Šå¤§ï¼Œè¶Šç›¸ä¼¼ã€‚ ç›¸åŒå›¾ç‰‡ä¸º1 # t1,t2 14;19;10; 0.70;0.75 # t1,t3 39 33 18 0.58 0.49 # s1,s2 7 23 11 0.83 0.86 æŒºç›¸ä¼¼çš„å›¾ç‰‡ # c1,c2 11 29 17 0.30 0.31 # if para1.startswith(http): # # æ ¹æ®é“¾æ¥ä¸‹è½½å›¾ç‰‡ï¼Œå¹¶è½¬æ¢ä¸ºopencvæ ¼å¼ # img1 = getImageByUrl(para1) # img1 = cv2.cvtColor(np.asarray(img1), cv2.COLOR_RGB2BGR) # # img2 = getImageByUrl(para2) # img2 = cv2.cvtColor(np.asarray(img2), cv2.COLOR_RGB2BGR) # else: # é€šè¿‡imreadæ–¹æ³•ç›´æ¥è¯»å–ç‰©ç†è·¯å¾„ img1 = cv2.imread(para1) img2 = cv2.imread(para2) # # æ£€æŸ¥æ˜¯å¦æˆåŠŸè¯»å–å›¾åƒ # if img1 is None: # print(fError: Unable to read image para1.) # if img2 is None: # print(fError: Unable to read image para2.) hash1 = aHash(img1) hash2 = aHash(img2) n1 = cmpHash(hash1, hash2) # print(å‡å€¼å“ˆå¸Œç®—æ³•ç›¸ä¼¼åº¦aHashï¼š, n1) hash1 = dHash(img1) hash2 = dHash(img2) n2 = cmpHash(hash1, hash2) # print(å·®å€¼å“ˆå¸Œç®—æ³•ç›¸ä¼¼åº¦dHashï¼š, n2) hash1 = pHash(img1) hash2 = pHash(img2) n3 = cmpHash(hash1, hash2) # print(æ„ŸçŸ¥å“ˆå¸Œç®—æ³•ç›¸ä¼¼åº¦pHashï¼š, n3) n4 = classify_hist_with_split(img1, img2) # print(ä¸‰ç›´æ–¹å›¾ç®—æ³•ç›¸ä¼¼åº¦ï¼š, n4) n5 = calculate(img1, img2) # print(å•é€šé“çš„ç›´æ–¹å›¾, n5) # print(%d %d %d %.2f %.2f % (n1, n2, n3, round(n4[0], 2), n5[0])) # print(%.2f %.2f %.2f %.2f %.2f % (1 - float(n1 / 64), 1 - # float(n2 / 64), 1 - float(n3 / 64), round(n4[0], 2), n5[0])) if n1==0 or n2==0 or n3==0 or n4==1 or n5==1: # æ„å»ºç›®æ ‡æ–‡ä»¶è·¯å¾„ dest1 = os.path.join(destination_dir, os.path.basename(para1)) dest2 = os.path.join(destination_dir, os.path.basename(para2)) # ç§»åŠ¨æ–‡ä»¶ shutil.move(para1, dest1) shutil.move(para2, dest2) print(å‡å€¼å“ˆå¸Œç®—æ³•ç›¸ä¼¼åº¦aHashï¼š, n1) print(å·®å€¼å“ˆå¸Œç®—æ³•ç›¸ä¼¼åº¦dHashï¼š, n2) print(æ„ŸçŸ¥å“ˆå¸Œç®—æ³•ç›¸ä¼¼åº¦pHashï¼š, n3) print(ä¸‰ç›´æ–¹å›¾ç®—æ³•ç›¸ä¼¼åº¦ï¼š, n4) print(å•é€šé“çš„ç›´æ–¹å›¾, n5) # plt.subplot(121) # plt.imshow(Image.fromarray(cv2.cvtColor(img1, cv2.COLOR_BGR2RGB))) # plt.subplot(122) # plt.imshow(Image.fromarray(cv2.cvtColor(img2, cv2.COLOR_BGR2RGB))) # plt.show()def monitor_memory_and_submit_tasks(queue, executor, destination_dir): while not queue.empty(): if psutil.virtual_memory().percent 90: p1, p2 = queue.get() executor.submit(runAllImageSimilaryFun, p1, p2) else: print(Memory usage above 90%, waiting...) time.sleep(1) # ç­‰å¾…1ç§’åå†æ¬¡æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µif __name__ == __main__: source_dir = E:/00.Arch/Compare/WeiXin/ destination_dir = E:/00.Arch/Compare/ouput/ # è·å–ç›®å½•ä¸‹æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶è·¯å¾„ # image_files = [os.path.join(source_dir, f) for f in os.listdir(source_dir) if f.endswith(.png)] image_files=[] for root, _, files in os.walk(source_dir): for file in files: if file.lower().endswith((.jpg)): image_files.append(os.path.join(root, file)) # ä½¿ç”¨ç»„åˆç”Ÿæˆæ‰€æœ‰æˆå¯¹å›¾ç‰‡ image_combinations = list(itertools.combinations(image_files, 2)) # ä½¿ç”¨é˜Ÿåˆ—å­˜å‚¨ä»»åŠ¡ task_queue = Queue() for p1, p2 in image_combinations: task_queue.put((p1, p2)) # ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†å›¾åƒæ¯”å¯¹ with concurrent.futures.ThreadPoolExecutor() as executor: monitor_memory_and_submit_tasks(task_queue, executor, destination_dir) # p1 = E:/00.Arch/Compare/WeiXin/IMG_20230809_214702.jpg # p2 = E:/00.Arch/Compare/WeiXin/IMG_20230809_214714.jpg # destination_dir = E:/00.Arch/Compare/ouput/ # # ç¡®ä¿ç›®æ ‡ç›®å½•å­˜åœ¨ # os.makedirs(destination_dir, exist_ok=True) # # # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ # if not os.path.exists(p1): # print(fError: File p1 does not exist.) # if not os.path.exists(p2): # print(fError: File p2 does not exist.) # runAllImageSimilaryFun(p1, p2) æµ‹è¯•æ—¶ï¼Œå¤šä¸ªå›¾åƒè¢«ç”¨æ¥éªŒè¯ä¸åŒç®—æ³•çš„å‡†ç¡®åº¦ã€‚å…¶ä¸­äº”ä¸ªå€¼åˆ†åˆ«ä»£è¡¨å‡å€¼å“ˆå¸Œç®—æ³•ã€å·®å€¼å“ˆå¸Œç®—æ³•ã€æ„ŸçŸ¥å“ˆå¸Œç®—æ³•ã€ä¸‰ç›´æ–¹å›¾ç®—æ³•å’Œå•é€šé“ç›´æ–¹å›¾çš„ç›¸ä¼¼åº¦ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå…·ä½“çš„ç›¸ä¼¼åº¦ç»“æœå°†ä¹ æƒ¯æ€§åœ°åœ¨æ§åˆ¶å°è¾“å‡ºï¼Œä¾¿äºç›´è§‚åˆ†æã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Python"]},{"title":"pipä¸‹è½½ç½‘ç»œé—®é¢˜","path":"/2024/04/08/2-ç¼–ç¨‹è¯­è¨€-Python-pipä¸‹è½½ç½‘ç»œé—®é¢˜/","content":"åœ¨ä½¿ç”¨ Python å®‰è£…åŒ…å·¥å…· pip æ—¶ç»å¸¸ä¼šå‡ºç°ä¸‹è½½å¾ˆæ…¢çš„æƒ…å†µï¼Œè¿™å…¶ä¸­æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†åŸå› å’Œ pip çš„æºæœ‰å…³ï¼Œåœ¨å®‰è£… python åï¼Œé€šå¸¸ python è§£é‡Šå™¨è‡ªå¸¦ pip è¿™ä¸ªå·¥å…·ï¼Œä½†æ˜¯è¿™é‡Œ pip æ˜¯è®¾ç½®çš„é»˜è®¤æºï¼Œä¹Ÿå°±æ˜¯å®˜æ–¹æºï¼šhttps://pypi.org/simpleï¼Œè¿™ä¸ªæºåœ¨å›½å†…çš„ä¸‹è½½é€Ÿåº¦æ˜¯å¾ˆæ…¢çš„ï¼Œæ‰€ä»¥ä¸ºäº†æé«˜åŒ…çš„ä¸‹è½½é€Ÿåº¦å¯ä»¥é€šè¿‡æ¢æºæ¥å®ç°ã€‚ ä¸´æ—¶ä½¿ç”¨å‚æ•°å¯ä»¥åœ¨ä½¿ç”¨ pip çš„æ—¶å€™åŠ å‚æ•° -i https://pypi.tuna.tsinghua.edu.cn/simple pip install -i https://pypi.tuna.tsinghua.edu.cn/simple markdown è¿™æ ·å°±ä¼šä»æ¸…åè¿™è¾¹çš„é•œåƒå»å®‰è£… markdownã€‚ # æ¸…åæºpip install markdown -i https://pypi.tuna.tsinghua.edu.cn/simple# é˜¿é‡Œæºpip install markdown -i https://mirrors.aliyun.com/pypi/simple/# è…¾è®¯æºpip install markdown -i http://mirrors.cloud.tencent.com/pypi/simple# è±†ç“£æºpip install markdown -i http://pypi.douban.com/simple/# ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦pip install markdown -i http://pypi.mirrors.ustc.edu.cn/simple/ æŠ¥é”™æœªæ·»åŠ ä¿¡ä»»æºpip install beautifulsoup4 --trusted-host mirrors.aliyun.com æ°¸ä¹…ä¿®æ”¹å‘½ä»¤è¡Œ# æ¸…åæºpip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple# é˜¿é‡Œæºpip config set global.index-url https://mirrors.aliyun.com/pypi/simple/# è…¾è®¯æºpip config set global.index-url http://mirrors.cloud.tencent.com/pypi/simple# è±†ç“£æºpip config set global.index-url http://pypi.douban.com/simple/# æ¢å›é»˜è®¤æºpip config unset global.index-url é…ç½®æ–‡ä»¶ Linux ä¸‹ ~/.pip/pip.conf Windows ä¸‹ %HOMEPATH%\\pip\\pip.iniå†…å®¹å¦‚ä¸‹ï¼š [global]index-url = https://pypi.tuna.tsinghua.edu.cn/simple æŠ¥é”™æœªæ·»åŠ ä¿¡ä»»æº[install]trusted-host=pypi.douban.com","categories":["2.ç¼–ç¨‹è¯­è¨€","Python"]},{"title":"Webéƒ¨ç½²","path":"/2024/04/05/2-ç¼–ç¨‹è¯­è¨€-Python-Webéƒ¨ç½²/","content":"æ­å»ºå¼€å‘ç¯å¢ƒé¦–å…ˆï¼Œç¡®è®¤ç³»ç»Ÿå®‰è£…çš„ Python ç‰ˆæœ¬æ˜¯ 3.7.xï¼š $ python3 --versionPython 3.7.0 ç„¶åï¼Œç”¨ pip å®‰è£…å¼€å‘ Web App éœ€è¦çš„ç¬¬ä¸‰æ–¹åº“ï¼š å¼‚æ­¥æ¡†æ¶ aiohttpï¼š $pip3 install aiohttp å‰ç«¯æ¨¡æ¿å¼•æ“ jinja2ï¼š $ pip3 install jinja2 MySQL 5.x æ•°æ®åº“ï¼Œä» å®˜æ–¹ç½‘ç«™ ä¸‹è½½å¹¶å®‰è£…ï¼Œå®‰è£…å®Œæ¯•åï¼Œè¯·åŠ¡å¿…ç‰¢è®° root å£ä»¤ã€‚ä¸ºé¿å…é—å¿˜å£ä»¤ï¼Œå»ºè®®ç›´æ¥æŠŠ root å£ä»¤è®¾ç½®ä¸º passwordï¼› MySQL çš„ Python å¼‚æ­¥é©±åŠ¨ç¨‹åº aiomysqlï¼š $ pip3 install aiomysql é¡¹ç›®ç»“æ„é€‰æ‹©ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œç„¶åï¼Œå»ºç«‹å¦‚ä¸‹çš„ç›®å½•ç»“æ„ï¼š awesome-python3-webapp/ -- æ ¹ç›®å½•|+- backup/ -- å¤‡ä»½ç›®å½•|+- conf/ -- é…ç½®æ–‡ä»¶|+- dist/ -- æ‰“åŒ…ç›®å½•|+- www/ -- Webç›®å½•ï¼Œå­˜æ”¾.pyæ–‡ä»¶| || +- static/ -- å­˜æ”¾é™æ€æ–‡ä»¶| || +- templates/ -- å­˜æ”¾æ¨¡æ¿æ–‡ä»¶|+- ios/ -- å­˜æ”¾iOS Appå·¥ç¨‹|+- LICENSE -- ä»£ç LICENSE åˆ›å»ºå¥½é¡¹ç›®çš„ç›®å½•ç»“æ„åï¼Œå»ºè®®åŒæ—¶å»ºç«‹ git ä»“åº“å¹¶åŒæ­¥è‡³ GitHubï¼Œä¿è¯ä»£ç ä¿®æ”¹çš„å®‰å…¨ã€‚ Web éª¨æ¶ç”±äºçš„ Web App å»ºç«‹åœ¨ asyncio çš„åŸºç¡€ä¸Šï¼Œå› æ­¤ç”¨ aiohttp å†™ä¸€ä¸ªåŸºæœ¬çš„ app.pyï¼š import logging; logging.basicConfig(level=logging.INFO)import asyncio, os, json, timefrom datetime import datetimefrom aiohttp import webdef index(request): return web.Response(body=bh1Awesome/h1)@asyncio.coroutinedef init(loop): app = web.Application(loop=loop) app.router.add_route(GET, /, index) srv = yield from loop.create_server(app.make_handler(), 127.0.0.1, 9000) logging.info(server started at http://127.0.0.1:9000...) return srvloop = asyncio.get_event_loop()loop.run_until_complete(init(loop))loop.run_forever() è¿è¡Œ python app.pyï¼ŒWeb App å°†åœ¨ 9000 ç«¯å£ç›‘å¬ HTTP è¯·æ±‚ï¼Œå¹¶ä¸”å¯¹é¦–é¡µ / è¿›è¡Œå“åº”ï¼š $ python3 app.pyINFO:root:server started at http://127.0.0.1:9000... è¿™é‡Œç®€å•åœ°è¿”å›ä¸€ä¸ª Awesome å­—ç¬¦ä¸²ï¼Œåœ¨æµè§ˆå™¨ä¸­å¯ä»¥çœ‹åˆ°æ•ˆæœ è¿™è¯´æ˜çš„ Web App éª¨æ¶å·²ç»æ­å¥½äº†ï¼Œå¯ä»¥è¿›ä¸€æ­¥å¾€é‡Œé¢æ·»åŠ æ›´å¤šçš„ä¸œè¥¿ã€‚ ORMORM å…¨ç§°æ˜¯ï¼šObject Relational Mapping(å¯¹è±¡å…³ç³»æ˜ å°„)ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯åœ¨ç¼–ç¨‹ä¸­ï¼ŒæŠŠé¢å‘å¯¹è±¡çš„æ¦‚å¿µè·Ÿæ•°æ®åº“ä¸­è¡¨çš„æ¦‚å¿µå¯¹åº”èµ·æ¥ã€‚ä¸¾ä¾‹æ¥è¯´å°±æ˜¯ï¼Œå®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£å°±å¯¹åº”ç€ä¸€å¼ è¡¨ï¼Œè¿™ä¸ªå¯¹è±¡çš„å®ä¾‹ï¼Œå°±å¯¹åº”ç€è¡¨ä¸­çš„ä¸€æ¡è®°å½•ã€‚ åœ¨ä¸€ä¸ª Web App ä¸­ï¼Œæ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬ç”¨æˆ·ä¿¡æ¯ã€å‘å¸ƒçš„æ—¥å¿—ã€è¯„è®ºç­‰ï¼Œéƒ½å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚åœ¨ awesome-python3-webapp ä¸­ï¼Œé€‰æ‹© MySQL ä½œä¸ºæ•°æ®åº“ã€‚ Web App é‡Œé¢æœ‰å¾ˆå¤šåœ°æ–¹éƒ½è¦è®¿é—®æ•°æ®åº“ã€‚è®¿é—®æ•°æ®åº“éœ€è¦åˆ›å»ºæ•°æ®åº“è¿æ¥ã€æ¸¸æ ‡å¯¹è±¡ï¼Œç„¶åæ‰§è¡Œ SQL è¯­å¥ï¼Œæœ€åå¤„ç†å¼‚å¸¸ï¼Œæ¸…ç†èµ„æºã€‚è¿™äº›è®¿é—®æ•°æ®åº“çš„ä»£ç å¦‚æœåˆ†æ•£åˆ°å„ä¸ªå‡½æ•°ä¸­ï¼ŒåŠ¿å¿…æ— æ³•ç»´æŠ¤ï¼Œä¹Ÿä¸åˆ©äºä»£ç å¤ç”¨ã€‚ æ‰€ä»¥ï¼Œè¦é¦–å…ˆæŠŠå¸¸ç”¨çš„ SELECTã€INSERTã€UPDATE å’Œ DELETE æ“ä½œç”¨å‡½æ•°å°è£…èµ·æ¥ã€‚ ç”±äº Web æ¡†æ¶ä½¿ç”¨äº†åŸºäº asyncio çš„ aiohttpï¼Œè¿™æ˜¯åŸºäºåç¨‹çš„å¼‚æ­¥æ¨¡å‹ã€‚åœ¨åç¨‹ä¸­ï¼Œä¸èƒ½è°ƒç”¨æ™®é€šçš„åŒæ­¥ IO æ“ä½œï¼Œå› ä¸ºæ‰€æœ‰ç”¨æˆ·éƒ½æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æœåŠ¡çš„ï¼Œåç¨‹çš„æ‰§è¡Œé€Ÿåº¦å¿…é¡»éå¸¸å¿«ï¼Œæ‰èƒ½å¤„ç†å¤§é‡ç”¨æˆ·çš„è¯·æ±‚ã€‚è€Œè€—æ—¶çš„ IO æ“ä½œä¸èƒ½åœ¨åç¨‹ä¸­ä»¥åŒæ­¥çš„æ–¹å¼è°ƒç”¨ï¼Œå¦åˆ™ï¼Œç­‰å¾…ä¸€ä¸ª IO æ“ä½œæ—¶ï¼Œç³»ç»Ÿæ— æ³•å“åº”ä»»ä½•å…¶ä»–ç”¨æˆ·ã€‚ è¿™å°±æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ä¸ªåŸåˆ™ï¼šä¸€æ—¦å†³å®šä½¿ç”¨å¼‚æ­¥ï¼Œåˆ™ç³»ç»Ÿæ¯ä¸€å±‚éƒ½å¿…é¡»æ˜¯å¼‚æ­¥ï¼Œâ€å¼€å¼“æ²¡æœ‰å›å¤´ç®­â€ã€‚ å¹¸è¿çš„æ˜¯ aiomysql ä¸º MySQL æ•°æ®åº“æä¾›äº†å¼‚æ­¥ IO çš„é©±åŠ¨ã€‚ åˆ›å»ºè¿æ¥æ± éœ€è¦åˆ›å»ºä¸€ä¸ªå…¨å±€çš„è¿æ¥æ± ï¼Œæ¯ä¸ª HTTP è¯·æ±‚éƒ½å¯ä»¥ä»è¿æ¥æ± ä¸­ç›´æ¥è·å–æ•°æ®åº“è¿æ¥ã€‚ä½¿ç”¨è¿æ¥æ± çš„å¥½å¤„æ˜¯ä¸å¿…é¢‘ç¹åœ°æ‰“å¼€å’Œå…³é—­æ•°æ®åº“è¿æ¥ï¼Œè€Œæ˜¯èƒ½å¤ç”¨å°±å°½é‡å¤ç”¨ã€‚ è¿æ¥æ± ç”±å…¨å±€å˜é‡ __pool å­˜å‚¨ï¼Œç¼ºçœæƒ…å†µä¸‹å°†ç¼–ç è®¾ç½®ä¸º utf8ï¼Œè‡ªåŠ¨æäº¤äº‹åŠ¡ï¼š @asyncio.coroutinedef create_pool(loop, **kw): logging.info(create database connection pool...) global __pool __pool = yield from aiomysql.create_pool( host=kw.get(host, localhost), port=kw.get(port, 3306), user=kw[user], password=kw[password], db=kw[db], charset=kw.get(charset, utf8), autocommit=kw.get(autocommit, True), maxsize=kw.get(maxsize, 10), minsize=kw.get(minsize, 1), loop=loop ) Selectè¦æ‰§è¡Œ SELECT è¯­å¥ï¼Œç”¨ select å‡½æ•°æ‰§è¡Œï¼Œéœ€è¦ä¼ å…¥ SQL è¯­å¥å’Œ SQL å‚æ•°ï¼š @asyncio.coroutinedef select(sql, args, size=None): log(sql, args) global __pool with (yield from __pool) as conn: cur = yield from conn.cursor(aiomysql.DictCursor) yield from cur.execute(sql.replace(?, %s), args or ()) if size: rs = yield from cur.fetchmany(size) else: rs = yield from cur.fetchall() yield from cur.close() logging.info(rows returned: %s % len(rs)) return rs SQL è¯­å¥çš„å ä½ç¬¦æ˜¯ ?ï¼Œè€Œ MySQL çš„å ä½ç¬¦æ˜¯ %sï¼Œselect() å‡½æ•°åœ¨å†…éƒ¨è‡ªåŠ¨æ›¿æ¢ã€‚æ³¨æ„è¦å§‹ç»ˆåšæŒä½¿ç”¨å¸¦å‚æ•°çš„ SQLï¼Œè€Œä¸æ˜¯è‡ªå·±æ‹¼æ¥ SQL å­—ç¬¦ä¸²ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢ SQL æ³¨å…¥æ”»å‡»ã€‚ æ³¨æ„åˆ° yield from å°†è°ƒç”¨ä¸€ä¸ªå­åç¨‹ï¼ˆä¹Ÿå°±æ˜¯åœ¨ä¸€ä¸ªåç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªåç¨‹ï¼‰å¹¶ç›´æ¥è·å¾—å­åç¨‹çš„è¿”å›ç»“æœã€‚ å¦‚æœä¼ å…¥ size å‚æ•°ï¼Œå°±é€šè¿‡ fetchmany() è·å–æœ€å¤šæŒ‡å®šæ•°é‡çš„è®°å½•ï¼Œå¦åˆ™ï¼Œé€šè¿‡ fetchall() è·å–æ‰€æœ‰è®°å½•ã€‚ Insert, Update, Deleteè¦æ‰§è¡Œ INSERTã€UPDATEã€DELETE è¯­å¥ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªé€šç”¨çš„ execute() å‡½æ•°ï¼Œå› ä¸ºè¿™ 3 ç§ SQL çš„æ‰§è¡Œéƒ½éœ€è¦ç›¸åŒçš„å‚æ•°ï¼Œä»¥åŠè¿”å›ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºå½±å“çš„è¡Œæ•°ï¼š @asyncio.coroutinedef execute(sql, args): log(sql) with (yield from __pool) as conn: try: cur = yield from conn.cursor() yield from cur.execute(sql.replace(?, %s), args) affected = cur.rowcount yield from cur.close() except BaseException as e: raise return affected execute() å‡½æ•°å’Œ select() å‡½æ•°æ‰€ä¸åŒçš„æ˜¯ï¼Œcursor å¯¹è±¡ä¸è¿”å›ç»“æœé›†ï¼Œè€Œæ˜¯é€šè¿‡ rowcount è¿”å›ç»“æœæ•°ã€‚ ORMæœ‰äº†åŸºæœ¬çš„ select() å’Œ execute() å‡½æ•°ï¼Œå°±å¯ä»¥å¼€å§‹ç¼–å†™ä¸€ä¸ªç®€å•çš„ ORM äº†ã€‚ è®¾è®¡ ORM éœ€è¦ä»ä¸Šå±‚è°ƒç”¨è€…è§’åº¦æ¥è®¾è®¡ã€‚ å…ˆè€ƒè™‘å¦‚ä½•å®šä¹‰ä¸€ä¸ª User å¯¹è±¡ï¼Œç„¶åæŠŠæ•°æ®åº“è¡¨ users å’Œå®ƒå…³è”èµ·æ¥ã€‚ from orm import Model, StringField, IntegerFieldclass User(Model): __table__ = users id = IntegerField(primary_key=True) name = StringField() æ³¨æ„åˆ°å®šä¹‰åœ¨ User ç±»ä¸­çš„ __table__ã€id å’Œ name æ˜¯ç±»çš„å±æ€§ï¼Œä¸æ˜¯å®ä¾‹çš„å±æ€§ã€‚æ‰€ä»¥ï¼Œåœ¨ç±»çº§åˆ«ä¸Šå®šä¹‰çš„å±æ€§ç”¨æ¥æè¿° User å¯¹è±¡å’Œè¡¨çš„æ˜ å°„å…³ç³»ï¼Œè€Œå®ä¾‹å±æ€§å¿…é¡»é€šè¿‡ __init__() æ–¹æ³•å»åˆå§‹åŒ–ï¼Œæ‰€ä»¥ä¸¤è€…äº’ä¸å¹²æ‰°ï¼š # åˆ›å»ºå®ä¾‹:user = User(id=123, name=Michael)# å­˜å…¥æ•°æ®åº“:user.insert()# æŸ¥è¯¢æ‰€æœ‰Userå¯¹è±¡:users = User.findAll() å®šä¹‰ Modelé¦–å…ˆè¦å®šä¹‰çš„æ˜¯æ‰€æœ‰ ORM æ˜ å°„çš„åŸºç±» Modelï¼š class Model(dict, metaclass=ModelMetaclass): def __init__(self, **kw): super(Model, self).__init__(**kw) def __getattr__(self, key): try: return self[key] except KeyError: raise AttributeError(rModel object has no attribute %s % key) def __setattr__(self, key, value): self[key] = value def getValue(self, key): return getattr(self, key, None) def getValueOrDefault(self, key): value = getattr(self, key, None) if value is None: field = self.__mappings__[key] if field.default is not None: value = field.default() if callable(field.default) else field.default logging.debug(using default value for %s: %s % (key, str(value))) setattr(self, key, value) return value Model ä» dict ç»§æ‰¿ï¼Œæ‰€ä»¥å…·å¤‡æ‰€æœ‰ dict çš„åŠŸèƒ½ï¼ŒåŒæ—¶åˆå®ç°äº†ç‰¹æ®Šæ–¹æ³• __getattr__() å’Œ __setattr__()ï¼Œå› æ­¤åˆå¯ä»¥åƒå¼•ç”¨æ™®é€šå­—æ®µé‚£æ ·å†™ï¼š user[id]123 user.id123 ä»¥åŠ Field å’Œå„ç§ Field å­ç±»ï¼š class Field(object): def __init__(self, name, column_type, primary_key, default): self.name = name self.column_type = column_type self.primary_key = primary_key self.default = default def __str__(self): return %s, %s:%s % (self.__class__.__name__, self.column_type, self.name) æ˜ å°„ varchar çš„ StringFieldï¼š class StringField(Field): def __init__(self, name=None, primary_key=False, default=None, ddl=varchar(100)): super().__init__(name, ddl, primary_key, default) æ³¨æ„åˆ° Model åªæ˜¯ä¸€ä¸ªåŸºç±»ï¼Œå¦‚ä½•å°†å…·ä½“çš„å­ç±»å¦‚ User çš„æ˜ å°„ä¿¡æ¯è¯»å–å‡ºæ¥å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯é€šè¿‡ metaclassï¼šModelMetaclassï¼š class ModelMetaclass(type): def __new__(cls, name, bases, attrs): # æ’é™¤Modelç±»æœ¬èº«: if name==Model: return type.__new__(cls, name, bases, attrs) # è·å–tableåç§°: tableName = attrs.get(__table__, None) or name logging.info(found model: %s (table: %s) % (name, tableName)) # è·å–æ‰€æœ‰çš„Fieldå’Œä¸»é”®å: mappings = dict() fields = [] primaryKey = None for k, v in attrs.items(): if isinstance(v, Field): logging.info( found mapping: %s == %s % (k, v)) mappings[k] = v if v.primary_key: # æ‰¾åˆ°ä¸»é”®: if primaryKey: raise RuntimeError(Duplicate primary key for field: %s % k) primaryKey = k else: fields.append(k) if not primaryKey: raise RuntimeError(Primary key not found.) for k in mappings.keys(): attrs.pop(k) escaped_fields = list(map(lambda f: `%s` % f, fields)) attrs[__mappings__] = mappings # ä¿å­˜å±æ€§å’Œåˆ—çš„æ˜ å°„å…³ç³» attrs[__table__] = tableName attrs[__primary_key__] = primaryKey # ä¸»é”®å±æ€§å attrs[__fields__] = fields # é™¤ä¸»é”®å¤–çš„å±æ€§å # æ„é€ é»˜è®¤çš„SELECT, INSERT, UPDATEå’ŒDELETEè¯­å¥: attrs[__select__] = select `%s`, %s from `%s` % (primaryKey, , .join(escaped_fields), tableName) attrs[__insert__] = insert into `%s` (%s, `%s`) values (%s) % (tableName, , .join(escaped_fields), primaryKey, create_args_string(len(escaped_fields) + 1)) attrs[__update__] = update `%s` set %s where `%s`=? % (tableName, , .join(map(lambda f: `%s`=? % (mappings.get(f).name or f), fields)), primaryKey) attrs[__delete__] = delete from `%s` where `%s`=? % (tableName, primaryKey) return type.__new__(cls, name, bases, attrs) è¿™æ ·ï¼Œä»»ä½•ç»§æ‰¿è‡ª Model çš„ç±»ï¼ˆæ¯”å¦‚ Userï¼‰ï¼Œä¼šè‡ªåŠ¨é€šè¿‡ ModelMetaclass æ‰«ææ˜ å°„å…³ç³»ï¼Œå¹¶å­˜å‚¨åˆ°è‡ªèº«çš„ç±»å±æ€§å¦‚ __table__ã€__mappings__ ä¸­ã€‚ ç„¶åï¼Œå¾€ Model ç±»æ·»åŠ  class æ–¹æ³•ï¼Œå°±å¯ä»¥è®©æ‰€æœ‰å­ç±»è°ƒç”¨ class æ–¹æ³•ï¼š class Model(dict): ... @classmethod @asyncio.coroutine def find(cls, pk): find object by primary key. rs = yield from select(%s where `%s`=? % (cls.__select__, cls.__primary_key__), [pk], 1) if len(rs) == 0: return None return cls(**rs[0]) User ç±»ç°åœ¨å°±å¯ä»¥é€šè¿‡ç±»æ–¹æ³•å®ç°ä¸»é”®æŸ¥æ‰¾ï¼š user = yield from User.find(123) å¾€ Model ç±»æ·»åŠ å®ä¾‹æ–¹æ³•ï¼Œå°±å¯ä»¥è®©æ‰€æœ‰å­ç±»è°ƒç”¨å®ä¾‹æ–¹æ³•ï¼š class Model(dict): ... @asyncio.coroutine def save(self): args = list(map(self.getValueOrDefault, self.__fields__)) args.append(self.getValueOrDefault(self.__primary_key__)) rows = yield from execute(self.__insert__, args) if rows != 1: logging.warn(failed to insert record: affected rows: %s % rows) è¿™æ ·ï¼Œå°±å¯ä»¥æŠŠä¸€ä¸ª User å®ä¾‹å­˜å…¥æ•°æ®åº“ï¼š user = User(id=123, name=Michael)yield from user.save() æœ€åä¸€æ­¥æ˜¯å®Œå–„ ORMï¼Œå¯¹äºæŸ¥æ‰¾ï¼Œå¯ä»¥å®ç°ä»¥ä¸‹æ–¹æ³•ï¼š findAll() - æ ¹æ® WHERE æ¡ä»¶æŸ¥æ‰¾ï¼› findNumber() - æ ¹æ® WHERE æ¡ä»¶æŸ¥æ‰¾ï¼Œä½†è¿”å›çš„æ˜¯æ•´æ•°ï¼Œé€‚ç”¨äº select count(*) ç±»å‹çš„ SQLã€‚ä»¥åŠ update() å’Œ remove() æ–¹æ³•ã€‚æ‰€æœ‰è¿™äº›æ–¹æ³•éƒ½å¿…é¡»ç”¨ @asyncio.coroutine è£…é¥°ï¼Œå˜æˆä¸€ä¸ªåç¨‹ã€‚è°ƒç”¨æ—¶éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š user.save() æ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œå› ä¸ºè°ƒç”¨ save() ä»…ä»…æ˜¯åˆ›å»ºäº†ä¸€ä¸ªåç¨‹ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œå®ƒã€‚ä¸€å®šè¦ç”¨ï¼š yield from user.save() æ‰çœŸæ­£æ‰§è¡Œäº† INSERT æ“ä½œã€‚ ç¼–å†™ Modelæœ‰äº† ORMï¼Œå°±å¯ä»¥æŠŠ Web App éœ€è¦çš„ 3 ä¸ªè¡¨ç”¨ Model è¡¨ç¤ºå‡ºæ¥ï¼š import time, uuidfrom orm import Model, StringField, BooleanField, FloatField, TextFielddef next_id(): return %015d%s000 % (int(time.time() * 1000), uuid.uuid4().hex)class User(Model): __table__ = users id = StringField(primary_key=True, default=next_id, ddl=varchar(50)) email = StringField(ddl=varchar(50)) passwd = StringField(ddl=varchar(50)) admin = BooleanField() name = StringField(ddl=varchar(50)) image = StringField(ddl=varchar(500)) created_at = FloatField(default=time.time)class Blog(Model): __table__ = blogs id = StringField(primary_key=True, default=next_id, ddl=varchar(50)) user_id = StringField(ddl=varchar(50)) user_name = StringField(ddl=varchar(50)) user_image = StringField(ddl=varchar(500)) name = StringField(ddl=varchar(50)) summary = StringField(ddl=varchar(200)) content = TextField() created_at = FloatField(default=time.time)class Comment(Model): __table__ = comments id = StringField(primary_key=True, default=next_id, ddl=varchar(50)) blog_id = StringField(ddl=varchar(50)) user_id = StringField(ddl=varchar(50)) user_name = StringField(ddl=varchar(50)) user_image = StringField(ddl=varchar(500)) content = TextField() created_at = FloatField(default=time.time) åœ¨ç¼–å†™ ORM æ—¶ï¼Œç»™ä¸€ä¸ª Field å¢åŠ ä¸€ä¸ª default å‚æ•°å¯ä»¥è®© ORM è‡ªå·±å¡«å…¥ç¼ºçœå€¼ï¼Œéå¸¸æ–¹ä¾¿ã€‚å¹¶ä¸”ï¼Œç¼ºçœå€¼å¯ä»¥ä½œä¸ºå‡½æ•°å¯¹è±¡ä¼ å…¥ï¼Œåœ¨è°ƒç”¨ save() æ—¶è‡ªåŠ¨è®¡ç®—ã€‚ ä¾‹å¦‚ï¼Œä¸»é”® id çš„ç¼ºçœå€¼æ˜¯å‡½æ•° next_idï¼Œåˆ›å»ºæ—¶é—´ created_at çš„ç¼ºçœå€¼æ˜¯å‡½æ•° time.timeï¼Œå¯ä»¥è‡ªåŠ¨è®¾ç½®å½“å‰æ—¥æœŸå’Œæ—¶é—´ã€‚ æ—¥æœŸå’Œæ—¶é—´ç”¨ float ç±»å‹å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œè€Œä¸æ˜¯ datetime ç±»å‹ï¼Œè¿™ä¹ˆåšçš„å¥½å¤„æ˜¯ä¸å¿…å…³å¿ƒæ•°æ®åº“çš„æ—¶åŒºä»¥åŠæ—¶åŒºè½¬æ¢é—®é¢˜ï¼Œæ’åºéå¸¸ç®€å•ï¼Œæ˜¾ç¤ºçš„æ—¶å€™ï¼Œåªéœ€è¦åšä¸€ä¸ª float åˆ° str çš„è½¬æ¢ï¼Œä¹Ÿéå¸¸å®¹æ˜“ã€‚ åˆå§‹åŒ–æ•°æ®åº“è¡¨å¦‚æœè¡¨çš„æ•°é‡å¾ˆå°‘ï¼Œå¯ä»¥æ‰‹å†™åˆ›å»ºè¡¨çš„ SQL è„šæœ¬ï¼š -- schema.sqldrop database if exists awesome;create database awesome;use awesome;grant select, insert, update, delete on awesome.* to www-data@localhost identified by www-data;create table users ( `id` varchar(50) not null, `email` varchar(50) not null, `passwd` varchar(50) not null, `admin` bool not null, `name` varchar(50) not null, `image` varchar(500) not null, `created_at` real not null, unique key `idx_email` (`email`), key `idx_created_at` (`created_at`), primary key (`id`)) engine=innodb default charset=utf8;create table blogs ( `id` varchar(50) not null, `user_id` varchar(50) not null, `user_name` varchar(50) not null, `user_image` varchar(500) not null, `name` varchar(50) not null, `summary` varchar(200) not null, `content` mediumtext not null, `created_at` real not null, key `idx_created_at` (`created_at`), primary key (`id`)) engine=innodb default charset=utf8;create table comments ( `id` varchar(50) not null, `blog_id` varchar(50) not null, `user_id` varchar(50) not null, `user_name` varchar(50) not null, `user_image` varchar(500) not null, `content` mediumtext not null, `created_at` real not null, key `idx_created_at` (`created_at`), primary key (`id`)) engine=innodb default charset=utf8; å¦‚æœè¡¨çš„æ•°é‡å¾ˆå¤šï¼Œå¯ä»¥ä» Model å¯¹è±¡ç›´æ¥é€šè¿‡è„šæœ¬è‡ªåŠ¨ç”Ÿæˆ SQL è„šæœ¬ï¼Œä½¿ç”¨æ›´ç®€å•ã€‚ æŠŠ SQL è„šæœ¬æ”¾åˆ° MySQL å‘½ä»¤è¡Œé‡Œæ‰§è¡Œï¼š $ mysql -u root -p schema.sql å°±å®Œæˆäº†æ•°æ®åº“è¡¨çš„åˆå§‹åŒ–ã€‚ ç¼–å†™æ•°æ®è®¿é—®ä»£ç æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥çœŸæ­£å¼€å§‹ç¼–å†™ä»£ç æ“ä½œå¯¹è±¡äº†ã€‚æ¯”å¦‚ï¼Œå¯¹äº User å¯¹è±¡ï¼Œå°±å¯ä»¥åšå¦‚ä¸‹æ“ä½œï¼š import ormfrom models import User, Blog, Commentdef test(): yield from orm.create_pool(user=www-data, password=www-data, database=awesome) u = User(name=Test, email=test@example.com, passwd=1234567890, image=about:blank) yield from u.save()for x in test(): pass å¯ä»¥åœ¨ MySQL å®¢æˆ·ç«¯å‘½ä»¤è¡ŒæŸ¥è¯¢ï¼Œçœ‹çœ‹æ•°æ®æ˜¯ä¸æ˜¯æ­£å¸¸å­˜å‚¨åˆ° MySQL é‡Œé¢äº†ã€‚ Web æ¡†æ¶åœ¨æ­£å¼å¼€å§‹ Web å¼€å‘å‰ï¼Œéœ€è¦ç¼–å†™ä¸€ä¸ª Web æ¡†æ¶ã€‚ aiohttp å·²ç»æ˜¯ä¸€ä¸ª Web æ¡†æ¶äº†ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦è‡ªå·±å°è£…ä¸€ä¸ªï¼Ÿ åŸå› æ˜¯ä»ä½¿ç”¨è€…çš„è§’åº¦æ¥è¯´ï¼Œaiohttp ç›¸å¯¹æ¯”è¾ƒåº•å±‚ï¼Œç¼–å†™ä¸€ä¸ª URL çš„å¤„ç†å‡½æ•°éœ€è¦è¿™ä¹ˆå‡ æ­¥ï¼š ç¬¬ä¸€æ­¥ï¼Œç¼–å†™ä¸€ä¸ªç”¨ @asyncio.coroutine è£…é¥°çš„å‡½æ•°ï¼š @asyncio.coroutinedef handle_url_xxx(request): pass ç¬¬äºŒæ­¥ï¼Œä¼ å…¥çš„å‚æ•°éœ€è¦è‡ªå·±ä» request ä¸­è·å–ï¼š url_param = request.match_info[key]query_params = parse_qs(request.query_string) æœ€åï¼Œéœ€è¦è‡ªå·±æ„é€  Response å¯¹è±¡ï¼š text = render(template, data)return web.Response(text.encode(utf-8)) è¿™äº›é‡å¤çš„å·¥ä½œå¯ä»¥ç”±æ¡†æ¶å®Œæˆã€‚ä¾‹å¦‚ï¼Œå¤„ç†å¸¦å‚æ•°çš„ URL/blog/id å¯ä»¥è¿™ä¹ˆå†™ï¼š @get(/blog/id)def get_blog(id): pass å¤„ç† query_string å‚æ•°å¯ä»¥é€šè¿‡å…³é”®å­—å‚æ•° **kw æˆ–è€…å‘½åå…³é”®å­—å‚æ•°æ¥æ”¶ï¼š @get(/api/comments)def api_comments(*, page=1): pass å¯¹äºå‡½æ•°çš„è¿”å›å€¼ï¼Œä¸ä¸€å®šæ˜¯ web.Response å¯¹è±¡ï¼Œå¯ä»¥æ˜¯ strã€bytes æˆ– dictã€‚ å¦‚æœå¸Œæœ›æ¸²æŸ“æ¨¡æ¿ï¼Œå¯ä»¥è¿™ä¹ˆè¿”å›ä¸€ä¸ª dictï¼š return __template__: index.html, data: ... å› æ­¤ï¼ŒWeb æ¡†æ¶çš„è®¾è®¡æ˜¯å®Œå…¨ä»ä½¿ç”¨è€…å‡ºå‘ï¼Œç›®çš„æ˜¯è®©ä½¿ç”¨è€…ç¼–å†™å°½å¯èƒ½å°‘çš„ä»£ç ã€‚ ç¼–å†™ç®€å•çš„å‡½æ•°è€Œéå¼•å…¥ request å’Œ web.Response è¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„å¥½å¤„ï¼Œå°±æ˜¯å¯ä»¥å•ç‹¬æµ‹è¯•ï¼Œå¦åˆ™ï¼Œéœ€è¦æ¨¡æ‹Ÿä¸€ä¸ª request æ‰èƒ½æµ‹è¯•ã€‚ @get å’Œ@postè¦æŠŠä¸€ä¸ªå‡½æ•°æ˜ å°„ä¸ºä¸€ä¸ª URL å¤„ç†å‡½æ•°ï¼Œå…ˆå®šä¹‰ @get()ï¼š def get(path): Define decorator @get(/path) def decorator(func): @functools.wraps(func) def wrapper(*args, **kw): return func(*args, **kw) wrapper.__method__ = GET wrapper.__route__ = path return wrapper return decorator è¿™æ ·ï¼Œä¸€ä¸ªå‡½æ•°é€šè¿‡ @get() çš„è£…é¥°å°±é™„å¸¦äº† URL ä¿¡æ¯ã€‚ @post ä¸ @get å®šä¹‰ç±»ä¼¼ã€‚ å®šä¹‰ RequestHandlerURL å¤„ç†å‡½æ•°ä¸ä¸€å®šæ˜¯ä¸€ä¸ª coroutineï¼Œå› æ­¤ç”¨ RequestHandler() æ¥å°è£…ä¸€ä¸ª URL å¤„ç†å‡½æ•°ã€‚ RequestHandler æ˜¯ä¸€ä¸ªç±»ï¼Œç”±äºå®šä¹‰äº† __call__() æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥å°†å…¶å®ä¾‹è§†ä¸ºå‡½æ•°ã€‚ RequestHandler ç›®çš„å°±æ˜¯ä» URL å‡½æ•°ä¸­åˆ†æå…¶éœ€è¦æ¥æ”¶çš„å‚æ•°ï¼Œä» request ä¸­è·å–å¿…è¦çš„å‚æ•°ï¼Œè°ƒç”¨ URL å‡½æ•°ï¼Œç„¶åæŠŠç»“æœè½¬æ¢ä¸º web.Response å¯¹è±¡ï¼Œè¿™æ ·ï¼Œå°±å®Œå…¨ç¬¦åˆ aiohttp æ¡†æ¶çš„è¦æ±‚ï¼š class RequestHandler(object): def __init__(self, app, fn): self._app = app self._func = fn ... @asyncio.coroutine def __call__(self, request): kw = ... è·å–å‚æ•° r = yield from self._func(**kw) return r å†ç¼–å†™ä¸€ä¸ª add_route å‡½æ•°ï¼Œç”¨æ¥æ³¨å†Œä¸€ä¸ª URL å¤„ç†å‡½æ•°ï¼š def add_route(app, fn): method = getattr(fn, __method__, None) path = getattr(fn, __route__, None) if path is None or method is None: raise ValueError(@get or @post not defined in %s. % str(fn)) if not asyncio.iscoroutinefunction(fn) and not inspect.isgeneratorfunction(fn): fn = asyncio.coroutine(fn) logging.info(add route %s %s = %s(%s) % (method, path, fn.__name__, , .join(inspect.signature(fn).parameters.keys()))) app.router.add_route(method, path, RequestHandler(app, fn)) æœ€åä¸€æ­¥ï¼ŒæŠŠå¾ˆå¤šæ¬¡ add_route() æ³¨å†Œçš„è°ƒç”¨ï¼š add_route(app, handles.index)add_route(app, handles.blog)add_route(app, handles.create_comment)... å˜æˆè‡ªåŠ¨æ‰«æï¼š # è‡ªåŠ¨æŠŠhandleræ¨¡å—çš„æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å‡½æ•°æ³¨å†Œäº†:add_routes(app, handlers) add_routes() å®šä¹‰å¦‚ä¸‹ï¼š def add_routes(app, module_name): n = module_name.rfind(.) if n == (-1): mod = __import__(module_name, globals(), locals()) else: name = module_name[n+1:] mod = getattr(__import__(module_name[:n], globals(), locals(), [name]), name) for attr in dir(mod): if attr.startswith(_): continue fn = getattr(mod, attr) if callable(fn): method = getattr(fn, __method__, None) path = getattr(fn, __route__, None) if method and path: add_route(app, fn) æœ€åï¼Œåœ¨ app.py ä¸­åŠ å…¥ middlewareã€jinja2 æ¨¡æ¿å’Œè‡ªæ³¨å†Œçš„æ”¯æŒï¼š app = web.Application(loop=loop, middlewares=[ logger_factory, response_factory])init_jinja2(app, filters=dict(datetime=datetime_filter))add_routes(app, handlers)add_static(app) middlewaremiddleware æ˜¯ä¸€ç§æ‹¦æˆªå™¨ï¼Œä¸€ä¸ª URL åœ¨è¢«æŸä¸ªå‡½æ•°å¤„ç†å‰ï¼Œå¯ä»¥ç»è¿‡ä¸€ç³»åˆ—çš„ middleware çš„å¤„ç†ã€‚ ä¸€ä¸ª middleware å¯ä»¥æ”¹å˜ URL çš„è¾“å…¥ã€è¾“å‡ºï¼Œç”šè‡³å¯ä»¥å†³å®šä¸ç»§ç»­å¤„ç†è€Œç›´æ¥è¿”å›ã€‚middleware çš„ç”¨å¤„å°±åœ¨äºæŠŠé€šç”¨çš„åŠŸèƒ½ä»æ¯ä¸ª URL å¤„ç†å‡½æ•°ä¸­æ‹¿å‡ºæ¥ï¼Œé›†ä¸­æ”¾åˆ°ä¸€ä¸ªåœ°æ–¹ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè®°å½• URL æ—¥å¿—çš„ logger å¯ä»¥ç®€å•å®šä¹‰å¦‚ä¸‹ï¼š @asyncio.coroutinedef logger_factory(app, handler): @asyncio.coroutine def logger(request): # è®°å½•æ—¥å¿—: logging.info(Request: %s %s % (request.method, request.path)) # ç»§ç»­å¤„ç†è¯·æ±‚: return (yield from handler(request)) return logger è€Œ response è¿™ä¸ª middleware æŠŠè¿”å›å€¼è½¬æ¢ä¸º web.Response å¯¹è±¡å†è¿”å›ï¼Œä»¥ä¿è¯æ»¡è¶³ aiohttp çš„è¦æ±‚ï¼š @asyncio.coroutinedef response_factory(app, handler): @asyncio.coroutine def response(request): # ç»“æœ: r = yield from handler(request) if isinstance(r, web.StreamResponse): return r if isinstance(r, bytes): resp = web.Response(body=r) resp.content_type = application/octet-stream return resp if isinstance(r, str): resp = web.Response(body=r.encode(utf-8)) resp.content_type = text/html;charset=utf-8 return resp if isinstance(r, dict): ... æœ‰äº†è¿™äº›åŸºç¡€è®¾æ–½ï¼Œå°±å¯ä»¥ä¸“æ³¨åœ°å¾€ handlers æ¨¡å—ä¸æ–­æ·»åŠ  URL å¤„ç†å‡½æ•°äº†ï¼Œå¯ä»¥æå¤§åœ°æé«˜å¼€å‘æ•ˆç‡ã€‚ é…ç½®æ–‡ä»¶æœ‰äº† Web æ¡†æ¶å’Œ ORM æ¡†æ¶ï¼Œå°±å¯ä»¥å¼€å§‹è£…é… App äº†ã€‚ é€šå¸¸ï¼Œä¸€ä¸ª Web App åœ¨è¿è¡Œæ—¶éƒ½éœ€è¦è¯»å–é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚æ•°æ®åº“çš„ç”¨æˆ·åã€å£ä»¤ç­‰ï¼Œåœ¨ä¸åŒçš„ç¯å¢ƒä¸­è¿è¡Œæ—¶ï¼ŒWeb App å¯ä»¥é€šè¿‡è¯»å–ä¸åŒçš„é…ç½®æ–‡ä»¶æ¥è·å¾—æ­£ç¡®çš„é…ç½®ã€‚ ç”±äº Python æœ¬èº«è¯­æ³•ç®€å•ï¼Œå®Œå…¨å¯ä»¥ç›´æ¥ç”¨ Python æºä»£ç æ¥å®ç°é…ç½®ï¼Œè€Œä¸éœ€è¦å†è§£æä¸€ä¸ªå•ç‹¬çš„ .properties æˆ–è€… .yaml ç­‰é…ç½®æ–‡ä»¶ã€‚ é»˜è®¤çš„é…ç½®æ–‡ä»¶åº”è¯¥å®Œå…¨ç¬¦åˆæœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œè¿™æ ·ï¼Œæ— éœ€ä»»ä½•è®¾ç½®ï¼Œå°±å¯ä»¥ç«‹åˆ»å¯åŠ¨æœåŠ¡å™¨ã€‚ æŠŠé»˜è®¤çš„é…ç½®æ–‡ä»¶å‘½åä¸º config_default.pyï¼š # config_default.pyconfigs = db: host: 127.0.0.1, port: 3306, user: www-data, password: www-data, database: awesome , session: secret: AwEsOmE ä¸Šè¿°é…ç½®æ–‡ä»¶ç®€å•æ˜äº†ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦éƒ¨ç½²åˆ°æœåŠ¡å™¨æ—¶ï¼Œé€šå¸¸éœ€è¦ä¿®æ”¹æ•°æ®åº“çš„ host ç­‰ä¿¡æ¯ï¼Œç›´æ¥ä¿®æ”¹ config_default.py ä¸æ˜¯ä¸€ä¸ªå¥½åŠæ³•ï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯ç¼–å†™ä¸€ä¸ª config_override.pyï¼Œç”¨æ¥è¦†ç›–æŸäº›é»˜è®¤è®¾ç½®ï¼š # config_override.pyconfigs = db: host: 192.168.0.100 æŠŠ config_default.py ä½œä¸ºå¼€å‘ç¯å¢ƒçš„æ ‡å‡†é…ç½®ï¼ŒæŠŠ config_override.py ä½œä¸ºç”Ÿäº§ç¯å¢ƒçš„æ ‡å‡†é…ç½®ï¼Œå°±å¯ä»¥æ—¢æ–¹ä¾¿åœ°åœ¨æœ¬åœ°å¼€å‘ï¼Œåˆå¯ä»¥éšæ—¶æŠŠåº”ç”¨éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šã€‚ åº”ç”¨ç¨‹åºè¯»å–é…ç½®æ–‡ä»¶éœ€è¦ä¼˜å…ˆä» config_override.py è¯»å–ã€‚ä¸ºäº†ç®€åŒ–è¯»å–é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æŠŠæ‰€æœ‰é…ç½®è¯»å–åˆ°ç»Ÿä¸€çš„ config.py ä¸­ï¼š # config.pyconfigs = config_default.configstry: import config_override configs = merge(configs, config_override.configs)except ImportError: pass è¿™æ ·ï¼Œå°±å®Œæˆäº† App çš„é…ç½®ã€‚ MVCç°åœ¨ï¼ŒORM æ¡†æ¶ã€Web æ¡†æ¶å’Œé…ç½®éƒ½å·²å°±ç»ªï¼Œå¯ä»¥å¼€å§‹ç¼–å†™ä¸€ä¸ªæœ€ç®€å•çš„ MVCï¼ŒæŠŠå®ƒä»¬å…¨éƒ¨å¯åŠ¨èµ·æ¥ã€‚ é€šè¿‡ Web æ¡†æ¶çš„ @get å’Œ ORM æ¡†æ¶çš„ Model æ”¯æŒï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°ç¼–å†™ä¸€ä¸ªå¤„ç†é¦–é¡µ URL çš„å‡½æ•°ï¼š @get(/)def index(request): users = yield from User.findAll() return __template__: test.html, users: users __template__ æŒ‡å®šçš„æ¨¡æ¿æ–‡ä»¶æ˜¯ test.htmlï¼Œå…¶ä»–å‚æ•°æ˜¯ä¼ é€’ç»™æ¨¡æ¿çš„æ•°æ®ï¼Œæ‰€ä»¥åœ¨æ¨¡æ¿çš„æ ¹ç›®å½• templates ä¸‹åˆ›å»º test.htmlï¼š !DOCTYPE htmlhtmlhead meta charset=utf-8 / titleTest users - Awesome Python Webapp/title/headbody h1All users/h1 % for u in users % p u.name / u.email /p % endfor %/body/html æ¥ä¸‹æ¥ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œå¯ä»¥ç”¨å‘½ä»¤è¡Œå¯åŠ¨ Web æœåŠ¡å™¨ï¼š $ python3 app.py ç„¶åï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—® http://localhost:9000/ã€‚ å¦‚æœæ•°æ®åº“çš„ users è¡¨ä»€ä¹ˆå†…å®¹ä¹Ÿæ²¡æœ‰ï¼Œå°±æ— æ³•åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°å¾ªç¯è¾“å‡ºçš„å†…å®¹ã€‚å¯ä»¥è‡ªå·±åœ¨ MySQL çš„å‘½ä»¤è¡Œé‡Œç»™ users è¡¨æ·»åŠ å‡ æ¡è®°å½•ï¼Œç„¶åå†è®¿é—® æ„å»ºå‰ç«¯å¯¹äºå¤æ‚çš„ HTML å‰ç«¯é¡µé¢æ¥è¯´ï¼Œéœ€è¦ä¸€å¥—åŸºç¡€çš„ CSS æ¡†æ¶æ¥å®Œæˆé¡µé¢å¸ƒå±€å’ŒåŸºæœ¬æ ·å¼ã€‚å¦å¤–ï¼ŒjQuery ä½œä¸ºæ“ä½œ DOM çš„ JavaScript åº“ä¹Ÿå¿…ä¸å¯å°‘ã€‚ ä»é›¶å¼€å§‹å†™ CSS ä¸å¦‚ç›´æ¥ä»ä¸€ä¸ªå·²æœ‰çš„åŠŸèƒ½å®Œå–„çš„ CSS æ¡†æ¶å¼€å§‹ã€‚æœ‰å¾ˆå¤š CSS æ¡†æ¶å¯ä¾›é€‰æ‹©ã€‚è¿™æ¬¡é€‰æ‹© uikit è¿™ä¸ªå¼ºå¤§çš„ CSS æ¡†æ¶ã€‚å®ƒå…·å¤‡å®Œå–„çš„å“åº”å¼å¸ƒå±€ï¼Œæ¼‚äº®çš„ UIï¼Œä»¥åŠä¸°å¯Œçš„ HTML ç»„ä»¶ï¼Œè®©èƒ½è½»æ¾è®¾è®¡å‡ºç¾è§‚è€Œç®€æ´çš„é¡µé¢ã€‚ å¯ä»¥ä» uikité¦–é¡µ ä¸‹è½½æ‰“åŒ…çš„èµ„æºæ–‡ä»¶ã€‚ æ‰€æœ‰çš„é™æ€èµ„æºæ–‡ä»¶ç»Ÿä¸€æ”¾åˆ° www/static ç›®å½•ä¸‹ï¼Œå¹¶æŒ‰ç…§ç±»åˆ«å½’ç±»ï¼š static/+- css/| +- addons/| | +- uikit.addons.min.css| | +- uikit.almost-flat.addons.min.css| | +- uikit.gradient.addons.min.css| +- awesome.css| +- uikit.almost-flat.addons.min.css| +- uikit.gradient.addons.min.css| +- uikit.min.css+- fonts/| +- fontawesome-webfont.eot| +- fontawesome-webfont.ttf| +- fontawesome-webfont.woff| +- FontAwesome.otf+- js/ +- awesome.js +- html5.js +- jquery.min.js +- uikit.min.js ç”±äºå‰ç«¯é¡µé¢è‚¯å®šä¸æ­¢é¦–é¡µä¸€ä¸ªé¡µé¢ï¼Œæ¯ä¸ªé¡µé¢éƒ½æœ‰ç›¸åŒçš„é¡µçœ‰å’Œé¡µè„šã€‚å¦‚æœæ¯ä¸ªé¡µé¢éƒ½æ˜¯ç‹¬ç«‹çš„ HTML æ¨¡æ¿ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹é¡µçœ‰å’Œé¡µè„šçš„æ—¶å€™ï¼Œå°±éœ€è¦æŠŠæ¯ä¸ªæ¨¡æ¿éƒ½æ”¹ä¸€éï¼Œè¿™æ˜¾ç„¶æ˜¯æ²¡æœ‰æ•ˆç‡çš„ã€‚ å¸¸è§çš„æ¨¡æ¿å¼•æ“å·²ç»è€ƒè™‘åˆ°äº†é¡µé¢ä¸Šé‡å¤çš„ HTML éƒ¨åˆ†çš„å¤ç”¨é—®é¢˜ã€‚æœ‰çš„æ¨¡æ¿é€šè¿‡ include æŠŠé¡µé¢æ‹†æˆä¸‰éƒ¨åˆ†ï¼š html % include file=inc_header.html % % include file=index_body.html % % include file=inc_footer.html %/html è¿™æ ·ï¼Œç›¸åŒçš„éƒ¨åˆ† inc_header.html å’Œ inc_footer.html å°±å¯ä»¥å…±äº«ã€‚ ä½†æ˜¯ include æ–¹æ³•ä¸åˆ©äºé¡µé¢æ•´ä½“ç»“æ„çš„ç»´æŠ¤ã€‚jinjia2 çš„æ¨¡æ¿è¿˜æœ‰å¦ä¸€ç§â€ç»§æ‰¿â€æ–¹å¼ï¼Œå®ç°æ¨¡æ¿çš„å¤ç”¨æ›´ç®€å•ã€‚ â€œç»§æ‰¿â€æ¨¡æ¿çš„æ–¹å¼æ˜¯é€šè¿‡ç¼–å†™ä¸€ä¸ªâ€çˆ¶æ¨¡æ¿â€ï¼Œåœ¨çˆ¶æ¨¡æ¿ä¸­å®šä¹‰ä¸€äº›å¯æ›¿æ¢çš„ blockï¼ˆå—ï¼‰ã€‚ç„¶åï¼Œç¼–å†™å¤šä¸ªâ€å­æ¨¡æ¿â€ï¼Œæ¯ä¸ªå­æ¨¡æ¿éƒ½å¯ä»¥åªæ›¿æ¢çˆ¶æ¨¡æ¿å®šä¹‰çš„ blockã€‚æ¯”å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªæœ€ç®€å•çš„çˆ¶æ¨¡æ¿ï¼š !-- base.html --html head title% block title% è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåä¸ºtitleçš„block % endblock %/title /head body % block content % è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåä¸ºcontentçš„block % endblock % /body/html å¯¹äºå­æ¨¡æ¿ a.htmlï¼Œåªéœ€è¦æŠŠçˆ¶æ¨¡æ¿çš„ title å’Œ content æ›¿æ¢æ‰ï¼š % extends base.html %% block title % A % endblock %% block content % h1Chapter A/h1 pblablabla.../p% endblock % å¯¹äºå­æ¨¡æ¿ b.htmlï¼Œå¦‚æ³•ç‚®åˆ¶ï¼š % extends base.html %% block title % B % endblock %% block content % h1Chapter B/h1 ul lilist 1/li lilist 2/li /ul% endblock % è¿™æ ·ï¼Œä¸€æ—¦å®šä¹‰å¥½çˆ¶æ¨¡æ¿çš„æ•´ä½“å¸ƒå±€å’Œ CSS æ ·å¼ï¼Œç¼–å†™å­æ¨¡æ¿å°±ä¼šéå¸¸å®¹æ˜“ã€‚ è®©é€šè¿‡ uikit è¿™ä¸ª CSS æ¡†æ¶æ¥å®Œæˆçˆ¶æ¨¡æ¿ __base__.html çš„ç¼–å†™ï¼š !DOCTYPE htmlhtmlhead meta charset=utf-8 / % block meta %!-- block meta --% endblock % title% block title % ? % endblock % - Awesome Python Webapp/title link rel=stylesheet href=/static/css/uikit.min.css link rel=stylesheet href=/static/css/uikit.gradient.min.css link rel=stylesheet href=/static/css/awesome.css / script src=/static/js/jquery.min.js/script script src=/static/js/md5.js/script script src=/static/js/uikit.min.js/script script src=/static/js/awesome.js/script % block beforehead %!-- before head --% endblock %/headbody nav class=uk-navbar uk-navbar-attached uk-margin-bottom div class=uk-container uk-container-center a href=/ class=uk-navbar-brandAwesome/a ul class=uk-navbar-nav li data-url=blogsa href=/i class=uk-icon-home/i æ—¥å¿—/a/li lia target=_blank href=#i class=uk-icon-book/i æ•™ç¨‹/a/li lia target=_blank href=#i class=uk-icon-code/i æºç /a/li /ul div class=uk-navbar-flip ul class=uk-navbar-nav % if user % li class=uk-parent data-uk-dropdown a href=#0i class=uk-icon-user/i user.name /a div class=uk-dropdown uk-dropdown-navbar ul class=uk-nav uk-nav-navbar lia href=/signouti class=uk-icon-sign-out/i ç™»å‡º/a/li /ul /div /li % else % lia href=/signini class=uk-icon-sign-in/i ç™»é™†/a/li lia href=/registeri class=uk-icon-edit/i æ³¨å†Œ/a/li % endif % /ul /div /div /nav div class=uk-container uk-container-center div class=uk-grid !-- content -- % block content % % endblock % !-- // content -- /div /div div class=uk-margin-large-top style=background-color:#eee; border-top:1px solid #ccc; div class=uk-container uk-container-center uk-text-center div class=uk-panel uk-margin-top uk-margin-bottom p a target=_blank href=# class=uk-icon-button uk-icon-weibo/a a target=_blank href=# class=uk-icon-button uk-icon-github/a a target=_blank href=# class=uk-icon-button uk-icon-linkedin-square/a a target=_blank href=# class=uk-icon-button uk-icon-twitter/a /p pPowered by a href=#Awesome Python Webapp/a. Copyright copy; 2014. [a href=/manage/ target=_blankManage/a]/p pa href=http://www.liaoxuefeng.com/ target=_blankwww.liaoxuefeng.com/a. All rights reserved./p a target=_blank href=#i class=uk-icon-html5 style=font-size:64px; color: #444;/i/a /div /div /div/body/html __base__.html å®šä¹‰çš„å‡ ä¸ª block ä½œç”¨å¦‚ä¸‹ï¼š ç”¨äºå­é¡µé¢å®šä¹‰ä¸€äº› metaï¼Œä¾‹å¦‚ rss feedï¼š % block meta % ... % endblock % è¦†ç›–é¡µé¢çš„æ ‡é¢˜ï¼š % block title % ... % endblock % å­é¡µé¢å¯ä»¥åœ¨ head æ ‡ç­¾å…³é—­å‰æ’å…¥ JavaScript ä»£ç ï¼š % block beforehead % ... % endblock % å­é¡µé¢çš„ content å¸ƒå±€å’Œå†…å®¹ï¼š % block content % ...% endblock % æŠŠé¦–é¡µæ”¹é€ ä¸€ä¸‹ï¼Œä» __base__.html ç»§æ‰¿ä¸€ä¸ª blogs.htmlï¼š % extends __base__.html %% block title %æ—¥å¿—% endblock %% block content % div class=uk-width-medium-3-4 % for blog in blogs % article class=uk-article h2a href=/blog/ blog.id blog.name /a/h2 p class=uk-article-metaå‘è¡¨äº blog.created_at/p p blog.summary /p pa href=/blog/ blog.id ç»§ç»­é˜…è¯» i class=uk-icon-angle-double-right/i/a/p /article hr class=uk-article-divider % endfor % /div div class=uk-width-medium-1-4 div class=uk-panel uk-panel-header h3 class=uk-panel-titleå‹æƒ…é“¾æ¥/h3 ul class=uk-list uk-list-line lii class=uk-icon-thumbs-o-up/i a target=_blank href=#ç¼–ç¨‹/a/li lii class=uk-icon-thumbs-o-up/i a target=_blank href=#è¯»ä¹¦/a/li lii class=uk-icon-thumbs-o-up/i a target=_blank href=#Pythonæ•™ç¨‹/a/li lii class=uk-icon-thumbs-o-up/i a target=_blank href=#Gitæ•™ç¨‹/a/li /ul /div /div% endblock % ç›¸åº”åœ°ï¼Œé¦–é¡µ URL çš„å¤„ç†å‡½æ•°æ›´æ–°å¦‚ä¸‹ï¼š @get(/)def index(request): summary = Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. blogs = [ Blog(id=1, name=Test Blog, summary=summary, created_at=time.time()-120), Blog(id=2, name=Something New, summary=summary, created_at=time.time()-3600), Blog(id=3, name=Learn Swift, summary=summary, created_at=time.time()-7200) ] return __template__: blogs.html, blogs: blogs Blog çš„åˆ›å»ºæ—¥æœŸæ˜¾ç¤ºçš„æ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œå› ä¸ºå®ƒæ˜¯ç”±è¿™æ®µæ¨¡æ¿æ¸²æŸ“å‡ºæ¥çš„ï¼š p class=uk-article-metaå‘è¡¨äº blog.created_at /p è§£å†³æ–¹æ³•æ˜¯é€šè¿‡ jinja2 çš„ filterï¼ˆè¿‡æ»¤å™¨ï¼‰ï¼ŒæŠŠä¸€ä¸ªæµ®ç‚¹æ•°è½¬æ¢æˆæ—¥æœŸå­—ç¬¦ä¸²ã€‚æ¥ç¼–å†™ä¸€ä¸ª datetime çš„ filterï¼Œåœ¨æ¨¡æ¿é‡Œç”¨æ³•å¦‚ä¸‹ï¼š p class=uk-article-metaå‘è¡¨äº blog.created_at|datetime /p filter éœ€è¦åœ¨åˆå§‹åŒ– jinja2 æ—¶è®¾ç½®ã€‚ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š def datetime_filter(t): delta = int(time.time() - t) if delta 60: return 1åˆ†é’Ÿå‰ if delta 3600: return %såˆ†é’Ÿå‰ % (delta // 60) if delta 86400: return %så°æ—¶å‰ % (delta // 3600) if delta 604800: return %så¤©å‰ % (delta // 86400) dt = datetime.fromtimestamp(t) return %så¹´%sæœˆ%sæ—¥ % (dt.year, dt.month, dt.day)...init_jinja2(app, filters=dict(datetime=datetime_filter))... ç°åœ¨ï¼Œå®Œå–„çš„é¦–é¡µæ˜¾ç¤ºå¦‚ä¸‹ ç¼–å†™ APIä»€ä¹ˆæ˜¯ Web API å‘¢ï¼Ÿ å¦‚æœæƒ³è¦è·å–ä¸€ç¯‡ Blogï¼Œè¾“å…¥ http://localhost:9000/blog/123ï¼Œå°±å¯ä»¥çœ‹åˆ° id ä¸º 123 çš„ Blog é¡µé¢ï¼Œä½†è¿™ä¸ªç»“æœæ˜¯ HTML é¡µé¢ï¼Œå®ƒåŒæ—¶æ··åˆåŒ…å«äº† Blog çš„æ•°æ®å’Œ Blog çš„å±•ç¤ºä¸¤ä¸ªéƒ¨åˆ†ã€‚å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œé˜…è¯»èµ·æ¥æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ï¼Œå¦‚æœæœºå™¨è¯»å–ï¼Œå°±å¾ˆéš¾ä» HTML ä¸­è§£æå‡º Blog çš„æ•°æ®ã€‚ å¦‚æœä¸€ä¸ª URL è¿”å›çš„ä¸æ˜¯ HTMLï¼Œè€Œæ˜¯æœºå™¨èƒ½ç›´æ¥è§£æçš„æ•°æ®ï¼Œè¿™ä¸ª URL å°±å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ª Web APIã€‚æ¯”å¦‚ï¼Œè¯»å– http://localhost:9000/api/blogs/123ï¼Œå¦‚æœèƒ½ç›´æ¥è¿”å› Blog çš„æ•°æ®ï¼Œé‚£ä¹ˆæœºå™¨å°±å¯ä»¥ç›´æ¥è¯»å–ã€‚ REST å°±æ˜¯ä¸€ç§è®¾è®¡ API çš„æ¨¡å¼ã€‚æœ€å¸¸ç”¨çš„æ•°æ®æ ¼å¼æ˜¯ JSONã€‚ç”±äº JSON èƒ½ç›´æ¥è¢« JavaScript è¯»å–ï¼Œæ‰€ä»¥ï¼Œä»¥ JSON æ ¼å¼ç¼–å†™çš„ REST é£æ ¼çš„ API å…·æœ‰ç®€å•ã€æ˜“è¯»ã€æ˜“ç”¨çš„ç‰¹ç‚¹ã€‚ ç¼–å†™ API æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿç”±äº API å°±æ˜¯æŠŠ Web App çš„åŠŸèƒ½å…¨éƒ¨å°è£…äº†ï¼Œæ‰€ä»¥ï¼Œé€šè¿‡ API æ“ä½œæ•°æ®ï¼Œå¯ä»¥æå¤§åœ°æŠŠå‰ç«¯å’Œåç«¯çš„ä»£ç éš”ç¦»ï¼Œä½¿å¾—åç«¯ä»£ç æ˜“äºæµ‹è¯•ï¼Œå‰ç«¯ä»£ç ç¼–å†™æ›´ç®€å•ã€‚ ä¸€ä¸ª API ä¹Ÿæ˜¯ä¸€ä¸ª URL çš„å¤„ç†å‡½æ•°ï¼Œå¸Œæœ›èƒ½ç›´æ¥é€šè¿‡ä¸€ä¸ª @api æ¥æŠŠå‡½æ•°å˜æˆ JSON æ ¼å¼çš„ REST APIï¼Œè¿™æ ·ï¼Œè·å–æ³¨å†Œç”¨æˆ·å¯ä»¥ç”¨ä¸€ä¸ª API å®ç°å¦‚ä¸‹ï¼š @get(/api/users)def api_get_users(*, page=1): page_index = get_page_index(page) num = yield from User.findNumber(count(id)) p = Page(num, page_index) if num == 0: return dict(page=p, users=()) users = yield from User.findAll(orderBy=created_at desc, limit=(p.offset, p.limit)) for u in users: u.passwd = ****** return dict(page=p, users=users) åªè¦è¿”å›ä¸€ä¸ª dictï¼Œåç»­çš„ response è¿™ä¸ª middleware å°±å¯ä»¥æŠŠç»“æœåºåˆ—åŒ–ä¸º JSON å¹¶è¿”å›ã€‚ éœ€è¦å¯¹ Error è¿›è¡Œå¤„ç†ï¼Œå› æ­¤å®šä¹‰ä¸€ä¸ª APIErrorï¼Œè¿™ç§ Error æ˜¯æŒ‡ API è°ƒç”¨æ—¶å‘ç”Ÿäº†é€»è¾‘é”™è¯¯ï¼ˆæ¯”å¦‚ç”¨æˆ·ä¸å­˜åœ¨ï¼‰ï¼Œå…¶ä»–çš„ Error è§†ä¸º Bugï¼Œè¿”å›çš„é”™è¯¯ä»£ç ä¸º internalerrorã€‚ å®¢æˆ·ç«¯è°ƒç”¨ API æ—¶ï¼Œå¿…é¡»é€šè¿‡é”™è¯¯ä»£ç æ¥åŒºåˆ† API è°ƒç”¨æ˜¯å¦æˆåŠŸã€‚é”™è¯¯ä»£ç æ˜¯ç”¨æ¥å‘Šè¯‰è°ƒç”¨è€…å‡ºé”™çš„åŸå› ã€‚å¾ˆå¤š API ç”¨ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºé”™è¯¯ç ï¼Œè¿™ç§æ–¹å¼å¾ˆéš¾ç»´æŠ¤é”™è¯¯ç ï¼Œå®¢æˆ·ç«¯æ‹¿åˆ°é”™è¯¯ç è¿˜éœ€è¦æŸ¥è¡¨å¾—çŸ¥é”™è¯¯ä¿¡æ¯ã€‚æ›´å¥½çš„æ–¹å¼æ˜¯ç”¨å­—ç¬¦ä¸²è¡¨ç¤ºé”™è¯¯ä»£ç ï¼Œä¸éœ€è¦çœ‹æ–‡æ¡£ä¹Ÿèƒ½çŒœåˆ°é”™è¯¯åŸå› ã€‚ å¯ä»¥åœ¨æµè§ˆå™¨ç›´æ¥æµ‹è¯• APIï¼Œä¾‹å¦‚ï¼Œè¾“å…¥ http://localhost:9000/api/usersï¼Œå°±å¯ä»¥çœ‹åˆ°è¿”å›çš„ JSONï¼š åŠŸèƒ½æ³¨å†Œå’Œç™»å½•ç”¨æˆ·ç®¡ç†æ˜¯ç»å¤§éƒ¨åˆ† Web ç½‘ç«™éƒ½éœ€è¦è§£å†³çš„é—®é¢˜ã€‚ç”¨æˆ·ç®¡ç†æ¶‰åŠåˆ°ç”¨æˆ·æ³¨å†Œå’Œç™»å½•ã€‚ ç”¨æˆ·æ³¨å†Œç›¸å¯¹ç®€å•ï¼Œå¯ä»¥å…ˆé€šè¿‡ API æŠŠç”¨æˆ·æ³¨å†Œè¿™ä¸ªåŠŸèƒ½å®ç°äº†ï¼š _RE_EMAIL = re.compile(r^[a-z0-9\\.\\-\\_]+\\@[a-z0-9\\-\\_]+(\\.[a-z0-9\\-\\_]+)1,4$)_RE_SHA1 = re.compile(r^[0-9a-f]40$)@post(/api/users)def api_register_user(*, email, name, passwd): if not name or not name.strip(): raise APIValueError(name) if not email or not _RE_EMAIL.match(email): raise APIValueError(email) if not passwd or not _RE_SHA1.match(passwd): raise APIValueError(passwd) users = yield from User.findAll(email=?, [email]) if len(users) 0: raise APIError(register:failed, email, Email is already in use.) uid = next_id() sha1_passwd = %s:%s % (uid, passwd) user = User(id=uid, name=name.strip(), email=email, passwd=hashlib.sha1(sha1_passwd.encode(utf-8)).hexdigest(), image=http://www.gravatar.com/avatar/%s?d=mms=120 % hashlib.md5(email.encode(utf-8)).hexdigest()) yield from user.save() # make session cookie: r = web.Response() r.set_cookie(COOKIE_NAME, user2cookie(user, 86400), max_age=86400, httponly=True) user.passwd = ****** r.content_type = application/json r.body = json.dumps(user, ensure_ascii=False).encode(utf-8) return r æ³¨æ„ç”¨æˆ·å£ä»¤æ˜¯å®¢æˆ·ç«¯ä¼ é€’çš„ç»è¿‡ SHA1 è®¡ç®—åçš„ 40 ä½ Hash å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æœåŠ¡å™¨ç«¯å¹¶ä¸çŸ¥é“ç”¨æˆ·çš„åŸå§‹å£ä»¤ã€‚ æ¥ä¸‹æ¥å¯ä»¥åˆ›å»ºä¸€ä¸ªæ³¨å†Œé¡µé¢ï¼Œè®©ç”¨æˆ·å¡«å†™æ³¨å†Œè¡¨å•ï¼Œç„¶åï¼Œæäº¤æ•°æ®åˆ°æ³¨å†Œç”¨æˆ·çš„ APIï¼š % extends __base__.html %% block title %æ³¨å†Œ% endblock %% block beforehead %scriptfunction validateEmail(email) var re = /^[a-z0-9\\.\\-\\_]+\\@[a-z0-9\\-\\_]+(\\.[a-z0-9\\-\\_]+)1,4$/; return re.test(email.toLowerCase());$(function () var vm = new Vue( el: #vm, data: name: , email: , password1: , password2: , methods: submit: function (event) event.preventDefault(); var $form = $(#vm); if (! this.name.trim()) return $form.showFormError(è¯·è¾“å…¥åå­—); if (! validateEmail(this.email.trim().toLowerCase())) return $form.showFormError(è¯·è¾“å…¥æ­£ç¡®çš„Emailåœ°å€); if (this.password1.length 6) return $form.showFormError(å£ä»¤é•¿åº¦è‡³å°‘ä¸º6ä¸ªå­—ç¬¦); if (this.password1 !== this.password2) return $form.showFormError(ä¸¤æ¬¡è¾“å…¥çš„å£ä»¤ä¸ä¸€è‡´); var email = this.email.trim().toLowerCase(); $form.postJSON(/api/users, name: this.name.trim(), email: email, passwd: CryptoJS.SHA1(email + : + this.password1).toString() , function (err, r) if (err) return $form.showFormError(err); return location.assign(/); ); ); $(#vm).show(););/script% endblock %% block content % div class=uk-width-2-3 h1æ¬¢è¿æ³¨å†Œï¼/h1 form id=vm v-on=submit: submit class=uk-form uk-form-stacked div class=uk-alert uk-alert-danger uk-hidden/div div class=uk-form-row label class=uk-form-labelåå­—:/label div class=uk-form-controls input v-model=name type=text maxlength=50 placeholder=åå­— class=uk-width-1-1 /div /div div class=uk-form-row label class=uk-form-labelç”µå­é‚®ä»¶:/label div class=uk-form-controls input v-model=email type=text maxlength=50 placeholder=your-name@example.com class=uk-width-1-1 /div /div div class=uk-form-row label class=uk-form-labelè¾“å…¥å£ä»¤:/label div class=uk-form-controls input v-model=password1 type=password maxlength=50 placeholder=è¾“å…¥å£ä»¤ class=uk-width-1-1 /div /div div class=uk-form-row label class=uk-form-labelé‡å¤å£ä»¤:/label div class=uk-form-controls input v-model=password2 type=password maxlength=50 placeholder=é‡å¤å£ä»¤ class=uk-width-1-1 /div /div div class=uk-form-row button type=submit class=uk-button uk-button-primaryi class=uk-icon-user/i æ³¨å†Œ/button /div /form /div% endblock % è¿™æ ·å°±æŠŠç”¨æˆ·æ³¨å†Œçš„åŠŸèƒ½å®Œæˆäº† ç”¨æˆ·ç™»å½•æ¯”ç”¨æˆ·æ³¨å†Œå¤æ‚ã€‚ç”±äº HTTP åè®®æ˜¯ä¸€ç§æ— çŠ¶æ€åè®®ï¼Œè€ŒæœåŠ¡å™¨è¦è·Ÿè¸ªç”¨æˆ·çŠ¶æ€ï¼Œå°±åªèƒ½é€šè¿‡ cookie å®ç°ã€‚å¤§å¤šæ•° Web æ¡†æ¶æä¾›äº† Session åŠŸèƒ½æ¥å°è£…ä¿å­˜ç”¨æˆ·çŠ¶æ€çš„ cookieã€‚ Session çš„ä¼˜ç‚¹æ˜¯ç®€å•æ˜“ç”¨ï¼Œå¯ä»¥ç›´æ¥ä» Session ä¸­å–å‡ºç”¨æˆ·ç™»å½•ä¿¡æ¯ã€‚ Session çš„ç¼ºç‚¹æ˜¯æœåŠ¡å™¨éœ€è¦åœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€ä¸ªæ˜ å°„è¡¨æ¥å­˜å‚¨ç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼Œå¦‚æœæœ‰ä¸¤å°ä»¥ä¸ŠæœåŠ¡å™¨ï¼Œå°±éœ€è¦å¯¹ Session åšé›†ç¾¤ï¼Œå› æ­¤ï¼Œä½¿ç”¨ Session çš„ Web App å¾ˆéš¾æ‰©å±•ã€‚ é‡‡ç”¨ç›´æ¥è¯»å– cookie çš„æ–¹å¼æ¥éªŒè¯ç”¨æˆ·ç™»å½•ï¼Œæ¯æ¬¡ç”¨æˆ·è®¿é—®ä»»æ„ URLï¼Œéƒ½ä¼šå¯¹ cookie è¿›è¡ŒéªŒè¯ï¼Œè¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯ä¿è¯æœåŠ¡å™¨å¤„ç†ä»»æ„çš„ URL éƒ½æ˜¯æ— çŠ¶æ€çš„ï¼Œå¯ä»¥æ‰©å±•åˆ°å¤šå°æœåŠ¡å™¨ã€‚ ç”±äºç™»å½•æˆåŠŸåæ˜¯ç”±æœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ª cookie å‘é€ç»™æµè§ˆå™¨ï¼Œæ‰€ä»¥ï¼Œè¦ä¿è¯è¿™ä¸ª cookie ä¸ä¼šè¢«å®¢æˆ·ç«¯ä¼ªé€ å‡ºæ¥ã€‚ å®ç°é˜²ä¼ªé€  cookie çš„å…³é”®æ˜¯é€šè¿‡ä¸€ä¸ªå•å‘ç®—æ³•ï¼ˆä¾‹å¦‚ SHA1ï¼‰ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š å½“ç”¨æˆ·è¾“å…¥äº†æ­£ç¡®çš„å£ä»¤ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡å™¨å¯ä»¥ä»æ•°æ®åº“å–åˆ°ç”¨æˆ·çš„ idï¼Œå¹¶æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è®¡ç®—å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼š ç”¨æˆ·id + è¿‡æœŸæ—¶é—´ + SHA1(ç”¨æˆ·id + ç”¨æˆ·å£ä»¤ + è¿‡æœŸæ—¶é—´ + SecretKey) å½“æµè§ˆå™¨å‘é€ cookie åˆ°æœåŠ¡å™¨ç«¯åï¼ŒæœåŠ¡å™¨å¯ä»¥æ‹¿åˆ°çš„ä¿¡æ¯åŒ…æ‹¬ï¼š ç”¨æˆ· id è¿‡æœŸæ—¶é—´ SHA1 å€¼å¦‚æœæœªåˆ°è¿‡æœŸæ—¶é—´ï¼ŒæœåŠ¡å™¨å°±æ ¹æ®ç”¨æˆ· id æŸ¥æ‰¾ç”¨æˆ·å£ä»¤ï¼Œå¹¶è®¡ç®—ï¼š SHA1(ç”¨æˆ·id + ç”¨æˆ·å£ä»¤ + è¿‡æœŸæ—¶é—´ + SecretKey) å¹¶ä¸æµè§ˆå™¨ cookie ä¸­çš„å“ˆå¸Œè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™è¯´æ˜ç”¨æˆ·å·²ç™»å½•ï¼Œå¦åˆ™ï¼Œcookie å°±æ˜¯ä¼ªé€ çš„ã€‚ è¿™ä¸ªç®—æ³•çš„å…³é”®åœ¨äº SHA1 æ˜¯ä¸€ç§å•å‘ç®—æ³•ï¼Œå³å¯ä»¥é€šè¿‡åŸå§‹å­—ç¬¦ä¸²è®¡ç®—å‡º SHA1 ç»“æœï¼Œä½†æ— æ³•é€šè¿‡ SHA1 ç»“æœåæ¨å‡ºåŸå§‹å­—ç¬¦ä¸²ã€‚ æ‰€ä»¥ç™»å½• API å¯ä»¥å®ç°å¦‚ä¸‹ï¼š @post(/api/authenticate)def authenticate(*, email, passwd): if not email: raise APIValueError(email, Invalid email.) if not passwd: raise APIValueError(passwd, Invalid password.) users = yield from User.findAll(email=?, [email]) if len(users) == 0: raise APIValueError(email, Email not exist.) user = users[0] # check passwd: sha1 = hashlib.sha1() sha1.update(user.id.encode(utf-8)) sha1.update(b:) sha1.update(passwd.encode(utf-8)) if user.passwd != sha1.hexdigest(): raise APIValueError(passwd, Invalid password.) # authenticate ok, set cookie: r = web.Response() r.set_cookie(COOKIE_NAME, user2cookie(user, 86400), max_age=86400, httponly=True) user.passwd = ****** r.content_type = application/json r.body = json.dumps(user, ensure_ascii=False).encode(utf-8) return r # è®¡ç®—åŠ å¯†cookie:def user2cookie(user, max_age): # build cookie string by: id-expires-sha1 expires = str(int(time.time() + max_age)) s = %s-%s-%s-%s % (user.id, user.passwd, expires, _COOKIE_KEY) L = [user.id, expires, hashlib.sha1(s.encode(utf-8)).hexdigest()] return -.join(L) å¯¹äºæ¯ä¸ª URL å¤„ç†å‡½æ•°ï¼Œå¦‚æœéƒ½å»å†™è§£æ cookie çš„ä»£ç ï¼Œé‚£ä¼šå¯¼è‡´ä»£ç é‡å¤å¾ˆå¤šæ¬¡ã€‚ åˆ©ç”¨ middle åœ¨å¤„ç† URL ä¹‹å‰ï¼ŒæŠŠ cookie è§£æå‡ºæ¥ï¼Œå¹¶å°†ç™»å½•ç”¨æˆ·ç»‘å®šåˆ° request å¯¹è±¡ä¸Šï¼Œè¿™æ ·ï¼Œåç»­çš„ URL å¤„ç†å‡½æ•°å°±å¯ä»¥ç›´æ¥æ‹¿åˆ°ç™»å½•ç”¨æˆ·ï¼š @asyncio.coroutinedef auth_factory(app, handler): @asyncio.coroutine def auth(request): logging.info(check user: %s %s % (request.method, request.path)) request.__user__ = None cookie_str = request.cookies.get(COOKIE_NAME) if cookie_str: user = yield from cookie2user(cookie_str) if user: logging.info(set current user: %s % user.email) request.__user__ = user return (yield from handler(request)) return auth # è§£å¯†cookie:@asyncio.coroutinedef cookie2user(cookie_str): Parse cookie and load user if cookie is valid. if not cookie_str: return None try: L = cookie_str.split(-) if len(L) != 3: return None uid, expires, sha1 = L if int(expires) time.time(): return None user = yield from User.find(uid) if user is None: return None s = %s-%s-%s-%s % (uid, user.passwd, expires, _COOKIE_KEY) if sha1 != hashlib.sha1(s.encode(utf-8)).hexdigest(): logging.info(invalid sha1) return None user.passwd = ****** return user except Exception as e: logging.exception(e) return None è¿™æ ·ï¼Œå°±å®Œæˆäº†ç”¨æˆ·æ³¨å†Œå’Œç™»å½•çš„åŠŸèƒ½ã€‚ ç¼–å†™æ—¥å¿—åˆ›å»ºé¡µåœ¨ Web å¼€å‘ä¸­ï¼Œåç«¯ä»£ç å†™èµ·æ¥å…¶å®æ˜¯ç›¸å½“å®¹æ˜“çš„ã€‚ ä¾‹å¦‚ï¼Œç¼–å†™ä¸€ä¸ª REST APIï¼Œç”¨äºåˆ›å»ºä¸€ä¸ª Blogï¼š @post(/api/blogs)def api_create_blog(request, *, name, summary, content): check_admin(request) if not name or not name.strip(): raise APIValueError(name, name cannot be empty.) if not summary or not summary.strip(): raise APIValueError(summary, summary cannot be empty.) if not content or not content.strip(): raise APIValueError(content, content cannot be empty.) blog = Blog(user_id=request.__user__.id, user_name=request.__user__.name, user_image=request.__user__.image, name=name.strip(), summary=summary.strip(), content=content.strip()) yield from blog.save() return blog ç¼–å†™åç«¯ Python ä»£ç ä¸ä½†å¾ˆç®€å•ï¼Œè€Œä¸”éå¸¸å®¹æ˜“æµ‹è¯•ï¼Œä¸Šé¢çš„ APIï¼šapi_create_blog() æœ¬èº«åªæ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ã€‚ Web å¼€å‘çœŸæ­£å›°éš¾çš„åœ°æ–¹åœ¨äºç¼–å†™å‰ç«¯é¡µé¢ã€‚å‰ç«¯é¡µé¢éœ€è¦æ··åˆ HTMLã€CSS å’Œ JavaScriptï¼Œå¦‚æœå¯¹è¿™ä¸‰è€…æ²¡æœ‰æ·±å…¥åœ°æŒæ¡ï¼Œç¼–å†™çš„å‰ç«¯é¡µé¢å°†å¾ˆå¿«éš¾ä»¥ç»´æŠ¤ã€‚ æ›´å¤§çš„é—®é¢˜åœ¨äºï¼Œå‰ç«¯é¡µé¢é€šå¸¸æ˜¯åŠ¨æ€é¡µé¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‰ç«¯é¡µé¢å¾€å¾€æ˜¯ç”±åç«¯ä»£ç ç”Ÿæˆçš„ã€‚ ç”Ÿæˆå‰ç«¯é¡µé¢æœ€æ—©çš„æ–¹å¼æ˜¯æ‹¼æ¥å­—ç¬¦ä¸²ï¼š s = htmlheadtitle + title + /title/headbody + body + /body/html æ˜¾ç„¶è¿™ç§æ–¹å¼å®Œå…¨ä¸å…·å¤‡å¯ç»´æŠ¤æ€§ã€‚æ‰€ä»¥æœ‰ç¬¬äºŒç§æ¨¡æ¿æ–¹å¼ï¼š htmlhead title title /title/headbody body /body/html ASPã€JSPã€PHP ç­‰éƒ½æ˜¯ç”¨è¿™ç§æ¨¡æ¿æ–¹å¼ç”Ÿæˆå‰ç«¯é¡µé¢ã€‚ å¦‚æœåœ¨é¡µé¢ä¸Šå¤§é‡ä½¿ç”¨ JavaScriptï¼ˆäº‹å®ä¸Šå¤§éƒ¨åˆ†é¡µé¢éƒ½ä¼šï¼‰ï¼Œæ¨¡æ¿æ–¹å¼ä»ç„¶ä¼šå¯¼è‡´ JavaScript ä»£ç ä¸åç«¯ä»£ç ç»‘å¾—éå¸¸ç´§å¯†ï¼Œä»¥è‡³äºéš¾ä»¥ç»´æŠ¤ã€‚å…¶æ ¹æœ¬åŸå› åœ¨äºè´Ÿè´£æ˜¾ç¤ºçš„ HTML DOM æ¨¡å‹ä¸è´Ÿè´£æ•°æ®å’Œäº¤äº’çš„ JavaScript ä»£ç æ²¡æœ‰åˆ†å‰²æ¸…æ¥šã€‚ è¦ç¼–å†™å¯ç»´æŠ¤çš„å‰ç«¯ä»£ç ç»éæ˜“äº‹ã€‚å’Œåç«¯ç»“åˆçš„ MVC æ¨¡å¼å·²ç»æ— æ³•æ»¡è¶³å¤æ‚é¡µé¢é€»è¾‘çš„éœ€è¦äº†ï¼Œæ‰€ä»¥ï¼Œæ–°çš„ MVVMï¼šModel View ViewModel æ¨¡å¼åº”è¿è€Œç”Ÿã€‚ MVVM æœ€æ—©ç”±å¾®è½¯æå‡ºæ¥ï¼Œå®ƒå€Ÿé‰´äº†æ¡Œé¢åº”ç”¨ç¨‹åºçš„ MVC æ€æƒ³ï¼Œåœ¨å‰ç«¯é¡µé¢ä¸­ï¼ŒæŠŠ Model ç”¨çº¯ JavaScript å¯¹è±¡è¡¨ç¤ºï¼š script var blog = name: hello, summary: this is summary, content: this is content... ;/script View æ˜¯çº¯ HTMLï¼š form action=/api/blogs method=post input name=name input name=summary textarea name=content/textarea button type=submitOK/button/form ç”±äº Model è¡¨ç¤ºæ•°æ®ï¼ŒView è´Ÿè´£æ˜¾ç¤ºï¼Œä¸¤è€…åšåˆ°äº†æœ€å¤§é™åº¦çš„åˆ†ç¦»ã€‚ æŠŠ Model å’Œ View å…³è”èµ·æ¥çš„å°±æ˜¯ ViewModelã€‚ViewModel è´Ÿè´£æŠŠ Model çš„æ•°æ®åŒæ­¥åˆ° View æ˜¾ç¤ºå‡ºæ¥ï¼Œè¿˜è´Ÿè´£æŠŠ View çš„ä¿®æ”¹åŒæ­¥å› Modelã€‚ ViewModel å¦‚ä½•ç¼–å†™ï¼Ÿéœ€è¦ç”¨ JavaScript ç¼–å†™ä¸€ä¸ªé€šç”¨çš„ ViewModelï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥å¤ç”¨æ•´ä¸ª MVVM æ¨¡å‹äº†ã€‚ å¥½æ¶ˆæ¯æ˜¯å·²æœ‰è®¸å¤šæˆç†Ÿçš„ MVVM æ¡†æ¶ï¼Œä¾‹å¦‚ AngularJSï¼ŒKnockoutJS ç­‰ã€‚é€‰æ‹© Vue è¿™ä¸ªç®€å•æ˜“ç”¨çš„ MVVM æ¡†æ¶æ¥å®ç°åˆ›å»º Blog çš„é¡µé¢ templates/manage_blog_edit.htmlï¼š % extends __base__.html %% block title %ç¼–è¾‘æ—¥å¿—% endblock %% block beforehead %scriptvar ID = id , action = action ;function initVM(blog) var vm = new Vue( el: #vm, data: blog, methods: submit: function (event) event.preventDefault(); var $form = $(#vm).find(form); $form.postJSON(action, this.$data, function (err, r) if (err) $form.showFormError(err); else return location.assign(/api/blogs/ + r.id); ); ); $(#vm).show();$(function () if (ID) getJSON(/api/blogs/ + ID, function (err, blog) if (err) return fatal(err); $(#loading).hide(); initVM(blog); ); else $(#loading).hide(); initVM( name: , summary: , content: ); );/script% endblock %% block content % div class=uk-width-1-1 uk-margin-bottom div class=uk-panel uk-panel-box ul class=uk-breadcrumb lia href=/manage/commentsè¯„è®º/a/li lia href=/manage/blogsæ—¥å¿—/a/li lia href=/manage/usersç”¨æˆ·/a/li /ul /div /div div id=error class=uk-width-1-1 /div div id=loading class=uk-width-1-1 uk-text-center spani class=uk-icon-spinner uk-icon-medium uk-icon-spin/i æ­£åœ¨åŠ è½½.../span /div div id=vm class=uk-width-2-3 form v-on=submit: submit class=uk-form uk-form-stacked div class=uk-alert uk-alert-danger uk-hidden/div div class=uk-form-row label class=uk-form-labelæ ‡é¢˜:/label div class=uk-form-controls input v-model=name name=name type=text placeholder=æ ‡é¢˜ class=uk-width-1-1 /div /div div class=uk-form-row label class=uk-form-labelæ‘˜è¦:/label div class=uk-form-controls textarea v-model=summary rows=4 name=summary placeholder=æ‘˜è¦ class=uk-width-1-1 style=resize:none;/textarea /div /div div class=uk-form-row label class=uk-form-labelå†…å®¹:/label div class=uk-form-controls textarea v-model=content rows=16 name=content placeholder=å†…å®¹ class=uk-width-1-1 style=resize:none;/textarea /div /div div class=uk-form-row button type=submit class=uk-button uk-button-primaryi class=uk-icon-save/i ä¿å­˜/button a href=/manage/blogs class=uk-buttoni class=uk-icon-times/i å–æ¶ˆ/a /div /form /div% endblock % åˆå§‹åŒ– Vue æ—¶ï¼ŒæŒ‡å®š 3 ä¸ªå‚æ•°ï¼š elï¼šæ ¹æ®é€‰æ‹©å™¨æŸ¥æ‰¾ç»‘å®šçš„ Viewï¼Œè¿™é‡Œæ˜¯ #vmï¼Œå°±æ˜¯ id ä¸º vm çš„ DOMï¼Œå¯¹åº”çš„æ˜¯ä¸€ä¸ª div æ ‡ç­¾ï¼› dataï¼šJavaScript å¯¹è±¡è¡¨ç¤ºçš„ Modelï¼Œåˆå§‹åŒ–ä¸º name: , summary: , content: ï¼› methodsï¼šView å¯ä»¥è§¦å‘çš„ JavaScript å‡½æ•°ï¼Œsubmit å°±æ˜¯æäº¤è¡¨å•æ—¶è§¦å‘çš„å‡½æ•°ã€‚ æ¥ä¸‹æ¥ï¼Œåœ¨ form æ ‡ç­¾ä¸­ï¼Œç”¨å‡ ä¸ªç®€å•çš„ v-modelï¼Œå°±å¯ä»¥è®© Vue æŠŠ Model å’Œ View å…³è”èµ·æ¥ï¼š !-- inputçš„valueå’ŒModelçš„nameå…³è”èµ·æ¥äº† --input v-model=name class=uk-width-1-1 Form è¡¨å•é€šè¿‡ form v-on=submit: submit æŠŠæäº¤è¡¨å•çš„äº‹ä»¶å…³è”åˆ° submit æ–¹æ³•ã€‚ éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œåœ¨ MVVM ä¸­ï¼ŒModel å’Œ View æ˜¯åŒå‘ç»‘å®šçš„ã€‚å¦‚æœåœ¨ Form ä¸­ä¿®æ”¹äº†æ–‡æœ¬æ¡†çš„å€¼ï¼Œå¯ä»¥åœ¨ Model ä¸­ç«‹åˆ»æ‹¿åˆ°æ–°çš„å€¼ã€‚è¯•è¯•åœ¨è¡¨å•ä¸­è¾“å…¥æ–‡æœ¬ï¼Œç„¶ååœ¨ Chrome æµè§ˆå™¨ä¸­æ‰“å¼€ JavaScript æ§åˆ¶å°ï¼Œå¯ä»¥é€šè¿‡ vm.name è®¿é—®å•ä¸ªå±æ€§ï¼Œæˆ–è€…é€šè¿‡ vm.$data è®¿é—®æ•´ä¸ª Model å¦‚æœåœ¨ JavaScript é€»è¾‘ä¸­ä¿®æ”¹äº† Modelï¼Œè¿™ä¸ªä¿®æ”¹ä¼šç«‹åˆ»åæ˜ åˆ° View ä¸Šã€‚è¯•è¯•åœ¨ JavaScript æ§åˆ¶å°è¾“å…¥ vm.name = MVVMç®€ä»‹ï¼Œå¯ä»¥çœ‹åˆ°æ–‡æœ¬æ¡†çš„å†…å®¹è‡ªåŠ¨è¢«åŒæ­¥äº† åŒå‘ç»‘å®šæ˜¯ MVVM æ¡†æ¶æœ€å¤§çš„ä½œç”¨ã€‚å€ŸåŠ©äº MVVMï¼ŒæŠŠå¤æ‚çš„æ˜¾ç¤ºé€»è¾‘äº¤ç»™æ¡†æ¶å®Œæˆã€‚ç”±äºåç«¯ç¼–å†™äº†ç‹¬ç«‹çš„ REST APIï¼Œæ‰€ä»¥ï¼Œå‰ç«¯ç”¨ AJAX æäº¤è¡¨å•éå¸¸å®¹æ˜“ï¼Œå‰åç«¯åˆ†ç¦»å¾—éå¸¸å½»åº•ã€‚ æ—¥å¿—åˆ—è¡¨é¡µMVVM æ¨¡å¼ä¸ä½†å¯ç”¨äº Form è¡¨å•ï¼Œåœ¨å¤æ‚çš„ç®¡ç†é¡µé¢ä¸­ä¹Ÿèƒ½å¤§æ˜¾èº«æ‰‹ã€‚ä¾‹å¦‚ï¼Œåˆ†é¡µæ˜¾ç¤º Blog çš„åŠŸèƒ½ï¼Œå…ˆæŠŠåç«¯ä»£ç å†™å‡ºæ¥ï¼š åœ¨ apis.py ä¸­å®šä¹‰ä¸€ä¸ª Page ç±»ç”¨äºå­˜å‚¨åˆ†é¡µä¿¡æ¯ï¼š class Page(object): def __init__(self, item_count, page_index=1, page_size=10): self.item_count = item_count self.page_size = page_size self.page_count = item_count // page_size + (1 if item_count % page_size 0 else 0) if (item_count == 0) or (page_index self.page_count): self.offset = 0 self.limit = 0 self.page_index = 1 else: self.page_index = page_index self.offset = self.page_size * (page_index - 1) self.limit = self.page_size self.has_next = self.page_index self.page_count self.has_previous = self.page_index 1 def __str__(self): return item_count: %s, page_count: %s, page_index: %s, page_size: %s, offset: %s, limit: %s % (self.item_count, self.page_count, self.page_index, self.page_size, self.offset, self.limit) __repr__ = __str__ åœ¨ handlers.py ä¸­å®ç° APIï¼š @get(/api/blogs)def api_blogs(*, page=1): page_index = get_page_index(page) num = yield from Blog.findNumber(count(id)) p = Page(num, page_index) if num == 0: return dict(page=p, blogs=()) blogs = yield from Blog.findAll(orderBy=created_at desc, limit=(p.offset, p.limit)) return dict(page=p, blogs=blogs) ç®¡ç†é¡µé¢ï¼š @get(/manage/blogs)def manage_blogs(*, page=1): return __template__: manage_blogs.html, page_index: get_page_index(page) æ¨¡æ¿é¡µé¢é¦–å…ˆé€šè¿‡ APIï¼šGET /api/blogs?page=? æ‹¿åˆ° Modelï¼š page: has_next: true, page_index: 1, page_count: 2, has_previous: false, item_count: 12 , blogs: [...] ç„¶åï¼Œé€šè¿‡ Vue åˆå§‹åŒ– MVVMï¼š scriptfunction initVM(data) var vm = new Vue( el: #vm, data: blogs: data.blogs, page: data.page , methods: edit_blog: function (blog) location.assign(/manage/blogs/edit?id= + blog.id); , delete_blog: function (blog) if (confirm(ç¡®è®¤è¦åˆ é™¤ + blog.name + ï¼Ÿåˆ é™¤åä¸å¯æ¢å¤ï¼)) postJSON(/api/blogs/ + blog.id + /delete, function (err, r) if (err) return alert(err.message || err.error || err); refresh(); ); ); $(#vm).show();$(function() getJSON(/api/blogs, page: page_index , function (err, results) if (err) return fatal(err); $(#loading).hide(); initVM(results); ););/script View çš„å®¹å™¨æ˜¯ #vmï¼ŒåŒ…å«ä¸€ä¸ª tableï¼Œç”¨ v-repeat å¯ä»¥æŠŠ Model çš„æ•°ç»„ blogs ç›´æ¥å˜æˆå¤šè¡Œçš„ trï¼š div id=vm class=uk-width-1-1 a href=/manage/blogs/create class=uk-button uk-button-primaryi class=uk-icon-plus/i æ–°æ—¥å¿—/a table class=uk-table uk-table-hover thead tr th class=uk-width-5-10æ ‡é¢˜ / æ‘˜è¦/th th class=uk-width-2-10ä½œè€…/th th class=uk-width-2-10åˆ›å»ºæ—¶é—´/th th class=uk-width-1-10æ“ä½œ/th /tr /thead tbody tr v-repeat=blog: blogs td a target=_blank v-attr=href: /blog/+blog.id v-text=blog.name/a /td td a target=_blank v-attr=href: /user/+blog.user_id v-text=blog.user_name/a /td td span v-text=blog.created_at.toDateTime()/span /td td a href=#0 v-on=click: edit_blog(blog)i class=uk-icon-edit/i a href=#0 v-on=click: delete_blog(blog)i class=uk-icon-trash-o/i /td /tr /tbody /table div v-component=pagination v-with=page/div/div å¾€ Model çš„ blogs æ•°ç»„ä¸­å¢åŠ ä¸€ä¸ª Blog å…ƒç´ ï¼Œtable å°±ç¥å¥‡åœ°å¢åŠ äº†ä¸€è¡Œï¼›æŠŠ blogs æ•°ç»„çš„æŸä¸ªå…ƒç´ åˆ é™¤ï¼Œtable å°±ç¥å¥‡åœ°å‡å°‘äº†ä¸€è¡Œã€‚æ‰€æœ‰å¤æ‚çš„ Model-View çš„æ˜ å°„é€»è¾‘å…¨éƒ¨ç”± MVVM æ¡†æ¶å®Œæˆï¼Œåªéœ€è¦åœ¨ HTML ä¸­å†™ä¸Š v-repeat æŒ‡ä»¤ï¼Œå°±ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡äº†ã€‚ å¯ä»¥æŠŠ v-repeat=blog: blogs çœ‹æˆå¾ªç¯ä»£ç ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥åœ¨ä¸€ä¸ª tr å†…éƒ¨å¼•ç”¨å¾ªç¯å˜é‡ blogã€‚v-text å’Œ v-attr æŒ‡ä»¤åˆ†åˆ«ç”¨äºç”Ÿæˆæ–‡æœ¬å’Œ DOM èŠ‚ç‚¹å±æ€§ã€‚ æ•ˆç‡ç°åœ¨ï¼Œå·²ç»æŠŠä¸€ä¸ª Web App çš„æ¡†æ¶å®Œå…¨æ­å»ºå¥½äº†ï¼Œä»åç«¯çš„ API åˆ°å‰ç«¯çš„ MVVMï¼Œæµç¨‹å·²ç»è·‘é€šäº†ã€‚ åœ¨ç»§ç»­å·¥ä½œå‰ï¼Œæ³¨æ„åˆ°æ¯æ¬¡ä¿®æ”¹ Python ä»£ç ï¼Œéƒ½å¿…é¡»åœ¨å‘½ä»¤è¡Œå…ˆ Ctrl-C åœæ­¢æœåŠ¡å™¨ï¼Œå†é‡å¯ï¼Œæ”¹åŠ¨æ‰èƒ½ç”Ÿæ•ˆã€‚ åœ¨å¼€å‘é˜¶æ®µï¼Œæ¯å¤©éƒ½è¦ä¿®æ”¹ã€ä¿å­˜å‡ åæ¬¡ä»£ç ï¼Œæ¯æ¬¡ä¿å­˜éƒ½æ‰‹åŠ¨æ¥è¿™ä¹ˆä¸€ä¸‹éå¸¸éº»çƒ¦ï¼Œä¸¥é‡åœ°é™ä½äº†çš„å¼€å‘æ•ˆç‡ã€‚æœ‰æ²¡æœ‰åŠæ³•è®©æœåŠ¡å™¨æ£€æµ‹åˆ°ä»£ç ä¿®æ”¹åè‡ªåŠ¨é‡æ–°åŠ è½½å‘¢ï¼Ÿ Django çš„å¼€å‘ç¯å¢ƒåœ¨ Debug æ¨¡å¼ä¸‹å°±å¯ä»¥åšåˆ°è‡ªåŠ¨é‡æ–°åŠ è½½ï¼Œå¦‚æœç¼–å†™çš„æœåŠ¡å™¨ä¹Ÿèƒ½å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå°±èƒ½å¤§å¤§æå‡å¼€å‘æ•ˆç‡ã€‚ å¯æƒœçš„æ˜¯ï¼ŒDjango æ²¡æŠŠè¿™ä¸ªåŠŸèƒ½ç‹¬ç«‹å‡ºæ¥ï¼Œä¸ç”¨ Django å°±äº«å—ä¸åˆ°ï¼Œæ€ä¹ˆåŠï¼Ÿ å…¶å® Python æœ¬èº«æä¾›äº†é‡æ–°è½½å…¥æ¨¡å—çš„åŠŸèƒ½ï¼Œä½†ä¸æ˜¯æ‰€æœ‰æ¨¡å—éƒ½èƒ½è¢«é‡æ–°è½½å…¥ã€‚å¦ä¸€ç§æ€è·¯æ˜¯æ£€æµ‹ www ç›®å½•ä¸‹çš„ä»£ç æ”¹åŠ¨ï¼Œä¸€æ—¦æœ‰æ”¹åŠ¨ï¼Œå°±è‡ªåŠ¨é‡å¯æœåŠ¡å™¨ã€‚ æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªè¾…åŠ©ç¨‹åº pymonitor.pyï¼Œè®©å®ƒå¯åŠ¨ wsgiapp.pyï¼Œå¹¶æ—¶åˆ»ç›‘æ§ www ç›®å½•ä¸‹çš„ä»£ç æ”¹åŠ¨ï¼Œæœ‰æ”¹åŠ¨æ—¶ï¼Œå…ˆæŠŠå½“å‰ wsgiapp.py è¿›ç¨‹æ€æ‰ï¼Œå†é‡å¯ï¼Œå°±å®Œæˆäº†æœåŠ¡å™¨è¿›ç¨‹çš„è‡ªåŠ¨é‡å¯ã€‚ è¦ç›‘æ§ç›®å½•æ–‡ä»¶çš„å˜åŒ–ï¼Œä¹Ÿæ— éœ€è‡ªå·±æ‰‹åŠ¨å®šæ—¶æ‰«æï¼ŒPython çš„ç¬¬ä¸‰æ–¹åº“ watchdog å¯ä»¥åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„ API æ¥ç›‘æ§ç›®å½•æ–‡ä»¶çš„å˜åŒ–ï¼Œå¹¶å‘é€é€šçŸ¥ã€‚å…ˆç”¨ pip å®‰è£…ï¼š $ pip3 install watchdog åˆ©ç”¨ watchdog æ¥æ”¶æ–‡ä»¶å˜åŒ–çš„é€šçŸ¥ï¼Œå¦‚æœæ˜¯ .py æ–‡ä»¶ï¼Œå°±è‡ªåŠ¨é‡å¯ wsgiapp.py è¿›ç¨‹ã€‚ åˆ©ç”¨ Python è‡ªå¸¦çš„ subprocess å®ç°è¿›ç¨‹çš„å¯åŠ¨å’Œç»ˆæ­¢ï¼Œå¹¶æŠŠè¾“å…¥è¾“å‡ºé‡å®šå‘åˆ°å½“å‰è¿›ç¨‹çš„è¾“å…¥è¾“å‡ºä¸­ï¼š #!/usr/bin/env python3# -*- coding: utf-8 -*-__author__ = Michael Liaoimport os, sys, time, subprocessfrom watchdog.observers import Observerfrom watchdog.events import FileSystemEventHandlerdef log(s): print([Monitor] %s % s)class MyFileSystemEventHander(FileSystemEventHandler): def __init__(self, fn): super(MyFileSystemEventHander, self).__init__() self.restart = fn def on_any_event(self, event): if event.src_path.endswith(.py): log(Python source file changed: %s % event.src_path) self.restart()command = [echo, ok]process = Nonedef kill_process(): global process if process: log(Kill process [%s]... % process.pid) process.kill() process.wait() log(Process ended with code %s. % process.returncode) process = Nonedef start_process(): global process, command log(Start process %s... % .join(command)) process = subprocess.Popen(command, stdin=sys.stdin, stdout=sys.stdout, stderr=sys.stderr)def restart_process(): kill_process() start_process()def start_watch(path, callback): observer = Observer() observer.schedule(MyFileSystemEventHander(restart_process), path, recursive=True) observer.start() log(Watching directory %s... % path) start_process() try: while True: time.sleep(0.5) except KeyboardInterrupt: observer.stop() observer.join()if __name__ == __main__: argv = sys.argv[1:] if not argv: print(Usage: ./pymonitor your-script.py) exit(0) if argv[0] != python3: argv.insert(0, python3) command = argv path = os.path.abspath(.) start_watch(path, None) ä¸€å…± 70 è¡Œå·¦å³çš„ä»£ç ï¼Œå°±å®ç°äº† Debug æ¨¡å¼çš„è‡ªåŠ¨é‡æ–°åŠ è½½ã€‚ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨æœåŠ¡å™¨ï¼š $ python3 pymonitor.py wsgiapp.py æˆ–è€…ç»™ pymonitor.py åŠ ä¸Šå¯æ‰§è¡Œæƒé™ï¼Œå¯åŠ¨æœåŠ¡å™¨ï¼š $ ./pymonitor.py app.py åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ä¸€ä¸ª .py æ–‡ä»¶ï¼Œä¿®æ”¹åä¿å­˜ï¼Œçœ‹çœ‹å‘½ä»¤è¡Œè¾“å‡ºï¼Œæ˜¯ä¸æ˜¯è‡ªåŠ¨é‡å¯äº†æœåŠ¡å™¨ï¼š $ ./pymonitor.py app.py [Monitor] Watching directory /Users/michael/Github/awesome-python3-webapp/www...[Monitor] Start process python app.py......INFO:root:application (/Users/michael/Github/awesome-python3-webapp/www) will start at 0.0.0.0:9000...[Monitor] Python source file changed: /Users/michael/Github/awesome-python-webapp/www/handlers.py[Monitor] Kill process [2747]...[Monitor] Process ended with code -9.[Monitor] Start process python app.py......INFO:root:application (/Users/michael/Github/awesome-python3-webapp/www) will start at 0.0.0.0:9000... ç°åœ¨ï¼Œåªè¦ä¸€ä¿å­˜ä»£ç ï¼Œå°±å¯ä»¥åˆ·æ–°æµè§ˆå™¨çœ‹åˆ°æ•ˆæœï¼Œå¤§å¤§æå‡äº†å¼€å‘æ•ˆç‡ã€‚ å®Œå–„åœ¨ Web App æ¡†æ¶å’ŒåŸºæœ¬æµç¨‹è·‘é€šåï¼Œå‰©ä¸‹çš„å·¥ä½œå…¨éƒ¨æ˜¯ä½“åŠ›æ´»äº†ï¼šåœ¨ Debug å¼€å‘æ¨¡å¼ä¸‹å®Œæˆåç«¯æ‰€æœ‰ APIã€å‰ç«¯æ‰€æœ‰é¡µé¢ã€‚éœ€è¦åšçš„äº‹æƒ…åŒ…æ‹¬ï¼š æŠŠå½“å‰ç”¨æˆ·ç»‘å®šåˆ° request ä¸Šï¼Œå¹¶å¯¹ URL/manage/ è¿›è¡Œæ‹¦æˆªï¼Œæ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯ç®¡ç†å‘˜èº«ä»½ï¼š @asyncio.coroutinedef auth_factory(app, handler): @asyncio.coroutine def auth(request): logging.info(check user: %s %s % (request.method, request.path)) request.__user__ = None cookie_str = request.cookies.get(COOKIE_NAME) if cookie_str: user = yield from cookie2user(cookie_str) if user: logging.info(set current user: %s % user.email) request.__user__ = user if request.path.startswith(/manage/) and (request.__user__ is None or not request.__user__.admin): return web.HTTPFound(/signin) return (yield from handler(request)) return auth åç«¯ API åŒ…æ‹¬ï¼š è·å–æ—¥å¿—ï¼šGET apiblogs åˆ›å»ºæ—¥å¿—ï¼šPOST apiblogs ä¿®æ”¹æ—¥å¿—ï¼šPOST apiblogs:blog_id åˆ é™¤æ—¥å¿—ï¼šPOST apiblogs:blog_iddelete è·å–è¯„è®ºï¼šGET apicomments åˆ›å»ºè¯„è®ºï¼šPOST apiblogs:blog_idcomments åˆ é™¤è¯„è®ºï¼šPOST apicomments:comment_iddelete åˆ›å»ºæ–°ç”¨æˆ·ï¼šPOST apiusers è·å–ç”¨æˆ·ï¼šGET apiusersç®¡ç†é¡µé¢åŒ…æ‹¬ï¼š è¯„è®ºåˆ—è¡¨é¡µï¼šGET managecomments æ—¥å¿—åˆ—è¡¨é¡µï¼šGET manageblogs åˆ›å»ºæ—¥å¿—é¡µï¼šGET manageblogscreate ä¿®æ”¹æ—¥å¿—é¡µï¼šGET manageblogs ç”¨æˆ·åˆ—è¡¨é¡µï¼šGET manageusersç”¨æˆ·æµè§ˆé¡µé¢åŒ…æ‹¬ï¼š æ³¨å†Œé¡µï¼šGET register ç™»å½•é¡µï¼šGET signin æ³¨é”€é¡µï¼šGET signout é¦–é¡µï¼šGET æ—¥å¿—è¯¦æƒ…é¡µï¼šGET blog:blog_idæŠŠæ‰€æœ‰çš„åŠŸèƒ½å®ç°ï¼Œç¬¬ä¸€ä¸ª Web App å°±å®£å‘Šå®Œæˆï¼ éƒ¨ç½²å¾ˆå¤šåšå¼€å‘çš„åŒå­¦æŠŠéƒ¨ç½²è¿™ä»¶äº‹æƒ…çœ‹æˆæ˜¯è¿ç»´åŒå­¦çš„å·¥ä½œï¼Œè¿™ç§çœ‹æ³•æ˜¯å®Œå…¨é”™è¯¯çš„ã€‚é¦–å…ˆï¼Œæœ€è¿‘æµè¡Œ DevOps ç†å¿µï¼Œå°±æ˜¯è¯´ï¼Œå¼€å‘å’Œè¿ç»´è¦å˜æˆä¸€ä¸ªæ•´ä½“ã€‚å…¶æ¬¡ï¼Œè¿ç»´çš„éš¾åº¦ï¼Œå…¶å®è·Ÿå¼€å‘è´¨é‡æœ‰å¾ˆå¤§çš„å…³ç³»ã€‚ä»£ç å†™å¾—åƒåœ¾ï¼Œè¿ç»´å†å¥½ä¹Ÿæ¶ä¸ä½å¤©å¤©æŒ‚æ‰ã€‚æœ€åï¼ŒDevOps ç†å¿µéœ€è¦æŠŠè¿ç»´ã€ç›‘æ§ç­‰åŠŸèƒ½èå…¥åˆ°å¼€å‘ä¸­ã€‚æƒ³æœåŠ¡å™¨å‡çº§æ—¶ä¸ä¸­æ–­ç”¨æˆ·æœåŠ¡ï¼Ÿé‚£å°±å¾—åœ¨å¼€å‘æ—¶è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚ ä¸‹é¢ï¼Œå°±æ¥æŠŠ awesome-python3-webapp éƒ¨ç½²åˆ° Linux æœåŠ¡å™¨ã€‚ æ­å»º Linux æœåŠ¡å™¨è¦éƒ¨ç½²åˆ° Linuxï¼Œé¦–å…ˆå¾—æœ‰ä¸€å° Linux æœåŠ¡å™¨ã€‚è¦åœ¨å…¬ç½‘ä¸Šä½“éªŒçš„åŒå­¦ï¼Œå¯ä»¥åœ¨ Amazon çš„ AWS ç”³è¯·ä¸€å° EC2 è™šæ‹Ÿæœºï¼ˆå…è´¹ä½¿ç”¨ 1 å¹´ï¼‰ï¼Œæˆ–è€…ä½¿ç”¨å›½å†…çš„ä¸€äº›äº‘æœåŠ¡å™¨ï¼Œä¸€èˆ¬éƒ½æä¾› Ubuntu Server çš„é•œåƒã€‚æƒ³åœ¨æœ¬åœ°éƒ¨ç½²çš„åŒå­¦ï¼Œè¯·å®‰è£…è™šæ‹Ÿæœºï¼Œæ¨èä½¿ç”¨ VirtualBoxã€‚ é€‰æ‹©çš„ Linux æœåŠ¡å™¨ç‰ˆæœ¬æ˜¯ Ubuntu Server 14.04 LTSï¼ŒåŸå› æ˜¯ apt å¤ªç®€å•äº†ã€‚å¦‚æœå‡†å¤‡ä½¿ç”¨å…¶ä»– Linux ç‰ˆæœ¬ï¼Œä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚ Linux å®‰è£…å®Œæˆåï¼Œè¯·ç¡®ä¿ ssh æœåŠ¡æ­£åœ¨è¿è¡Œï¼Œå¦åˆ™ï¼Œéœ€è¦é€šè¿‡ apt å®‰è£…ï¼š $ sudo apt-get install openssh-server æœ‰äº† ssh æœåŠ¡ï¼Œå°±å¯ä»¥ä»æœ¬åœ°è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šã€‚å»ºè®®æŠŠå…¬é’¥å¤åˆ¶åˆ°æœåŠ¡å™¨ç«¯ç”¨æˆ·çš„ .ssh/authorized_keys ä¸­ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥é€šè¿‡è¯ä¹¦å®ç°æ— å¯†ç è¿æ¥ã€‚ éƒ¨ç½²æ–¹å¼åˆ©ç”¨ Python è‡ªå¸¦çš„ asyncioï¼Œå·²ç»ç¼–å†™äº†ä¸€ä¸ªå¼‚æ­¥é«˜æ€§èƒ½æœåŠ¡å™¨ã€‚ä½†æ˜¯ï¼Œè¿˜éœ€è¦ä¸€ä¸ªé«˜æ€§èƒ½çš„ Web æœåŠ¡å™¨ï¼Œè¿™é‡Œé€‰æ‹© Nginxï¼Œå®ƒå¯ä»¥å¤„ç†é™æ€èµ„æºï¼ŒåŒæ—¶ä½œä¸ºåå‘ä»£ç†æŠŠåŠ¨æ€è¯·æ±‚äº¤ç»™ Python ä»£ç å¤„ç†ã€‚è¿™ä¸ªæ¨¡å‹å¦‚ä¸‹ Nginx è´Ÿè´£åˆ†å‘è¯·æ±‚ åœ¨æœåŠ¡å™¨ç«¯ï¼Œéœ€è¦å®šä¹‰å¥½éƒ¨ç½²çš„ç›®å½•ç»“æ„ï¼š /+- srv/ +- awesome/ -- Web Appæ ¹ç›®å½• +- www/ -- å­˜æ”¾Pythonæºç  | +- static/ -- å­˜æ”¾é™æ€èµ„æºæ–‡ä»¶ +- log/ -- å­˜æ”¾log åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²ï¼Œè¦è€ƒè™‘åˆ°æ–°ç‰ˆæœ¬å¦‚æœè¿è¡Œä¸æ­£å¸¸ï¼Œéœ€è¦å›é€€åˆ°æ—§ç‰ˆæœ¬æ—¶æ€ä¹ˆåŠã€‚æ¯æ¬¡ç”¨æ–°çš„ä»£ç è¦†ç›–æ‰æ—§çš„æ–‡ä»¶æ˜¯ä¸è¡Œçš„ï¼Œéœ€è¦ä¸€ä¸ªç±»ä¼¼ç‰ˆæœ¬æ§åˆ¶çš„æœºåˆ¶ã€‚ç”±äº Linux ç³»ç»Ÿæä¾›äº†è½¯é“¾æ¥åŠŸèƒ½ï¼Œæ‰€ä»¥ï¼ŒæŠŠ www ä½œä¸ºä¸€ä¸ªè½¯é“¾æ¥ï¼Œå®ƒæŒ‡å‘å“ªä¸ªç›®å½•ï¼Œå“ªä¸ªç›®å½•å°±æ˜¯å½“å‰è¿è¡Œçš„ç‰ˆæœ¬ è€Œ Nginx å’Œ python ä»£ç çš„é…ç½®æ–‡ä»¶åªéœ€è¦æŒ‡å‘ www ç›®å½•å³å¯ã€‚ Nginx å¯ä»¥ä½œä¸ºæœåŠ¡è¿›ç¨‹ç›´æ¥å¯åŠ¨ï¼Œä½† app.py è¿˜ä¸è¡Œï¼Œæ‰€ä»¥ï¼ŒSupervisor ç™»åœºï¼Supervisor æ˜¯ä¸€ä¸ªç®¡ç†è¿›ç¨‹çš„å·¥å…·ï¼Œå¯ä»¥éšç³»ç»Ÿå¯åŠ¨è€Œå¯åŠ¨æœåŠ¡ï¼Œå®ƒè¿˜æ—¶åˆ»ç›‘æ§æœåŠ¡è¿›ç¨‹ï¼Œå¦‚æœæœåŠ¡è¿›ç¨‹æ„å¤–é€€å‡ºï¼ŒSupervisor å¯ä»¥è‡ªåŠ¨é‡å¯æœåŠ¡ã€‚ æ€»ç»“ä¸€ä¸‹éœ€è¦ç”¨åˆ°çš„æœåŠ¡æœ‰ï¼š Nginxï¼šé«˜æ€§èƒ½ Web æœåŠ¡å™¨ + è´Ÿè´£åå‘ä»£ç†ï¼› Supervisorï¼šç›‘æ§æœåŠ¡è¿›ç¨‹çš„å·¥å…·ï¼› MySQLï¼šæ•°æ®åº“æœåŠ¡ã€‚åœ¨ Linux æœåŠ¡å™¨ä¸Šç”¨ apt å¯ä»¥ç›´æ¥å®‰è£…ä¸Šè¿°æœåŠ¡ï¼š $ sudo apt-get install nginx supervisor python3 mysql-server ç„¶åï¼Œå†æŠŠè‡ªå·±çš„ Web App ç”¨åˆ°çš„ Python åº“å®‰è£…äº†ï¼š $ sudo pip3 install jinja2 aiomysql aiohttp åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½• /srv/awesome/ ä»¥åŠç›¸åº”çš„å­ç›®å½•ã€‚ åœ¨æœåŠ¡å™¨ä¸Šåˆå§‹åŒ– MySQL æ•°æ®åº“ï¼ŒæŠŠæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ schema.sql å¤åˆ¶åˆ°æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š $ mysql -u root -p schema.sql æœåŠ¡å™¨ç«¯å‡†å¤‡å°±ç»ªã€‚ éƒ¨ç½²ç”¨ FTP è¿˜æ˜¯ SCP è¿˜æ˜¯ rsync å¤åˆ¶æ–‡ä»¶ï¼Ÿå¦‚æœéœ€è¦æ‰‹åŠ¨å¤åˆ¶ï¼Œç”¨ä¸€æ¬¡ä¸¤æ¬¡è¿˜è¡Œï¼Œä¸€å¤©å¦‚æœéƒ¨ç½² 50 æ¬¡ä¸ä½†æ…¢ã€æ•ˆç‡ä½ï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ã€‚ æ­£ç¡®çš„éƒ¨ç½²æ–¹å¼æ˜¯ä½¿ç”¨å·¥å…·é…åˆè„šæœ¬å®Œæˆè‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚Fabric å°±æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·ã€‚ç”±äº Fabric æ˜¯ç”¨ Python 2.x å¼€å‘çš„ï¼Œæ‰€ä»¥ï¼Œéƒ¨ç½²è„šæœ¬è¦ç”¨ Python 2.7 æ¥ç¼–å†™ï¼Œæœ¬æœºè¿˜å¿…é¡»å®‰è£… Python 2.7 ç‰ˆæœ¬ã€‚ è¦ç”¨ Fabric éƒ¨ç½²ï¼Œéœ€è¦åœ¨æœ¬æœºï¼ˆæ˜¯å¼€å‘æœºå™¨ï¼Œä¸æ˜¯ Linux æœåŠ¡å™¨ï¼‰å®‰è£… Fabricï¼š $ easy_install fabric Linux æœåŠ¡å™¨ä¸Šä¸éœ€è¦å®‰è£… Fabricï¼ŒFabric ä½¿ç”¨ SSH ç›´æ¥ç™»å½•æœåŠ¡å™¨å¹¶æ‰§è¡Œéƒ¨ç½²å‘½ä»¤ã€‚ ä¸‹ä¸€æ­¥æ˜¯ç¼–å†™éƒ¨ç½²è„šæœ¬ã€‚Fabric çš„éƒ¨ç½²è„šæœ¬å« fabfile.pyï¼ŒæŠŠå®ƒæ”¾åˆ° awesome-python-webapp çš„ç›®å½•ä¸‹ï¼Œä¸ www ç›®å½•å¹³çº§ï¼š awesome-python-webapp/+- fabfile.py+- www/+- ... Fabric çš„è„šæœ¬ç¼–å†™å¾ˆç®€å•ï¼Œé¦–å…ˆå¯¼å…¥ Fabric çš„ APIï¼Œè®¾ç½®éƒ¨ç½²æ—¶çš„å˜é‡ï¼š # fabfile.pyimport os, refrom datetime import datetime# å¯¼å…¥Fabric API:from fabric.api import *# æœåŠ¡å™¨ç™»å½•ç”¨æˆ·å:env.user = michael# sudoç”¨æˆ·ä¸ºroot:env.sudo_user = root# æœåŠ¡å™¨åœ°å€ï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œä¾æ¬¡éƒ¨ç½²:env.hosts = [192.168.0.3]# æœåŠ¡å™¨MySQLç”¨æˆ·åå’Œå£ä»¤:db_user = www-datadb_password = www-data ç„¶åï¼Œæ¯ä¸ª Python å‡½æ•°éƒ½æ˜¯ä¸€ä¸ªä»»åŠ¡ã€‚å…ˆç¼–å†™ä¸€ä¸ªæ‰“åŒ…çš„ä»»åŠ¡ï¼š _TAR_FILE = dist-awesome.tar.gzdef build(): includes = [static, templates, transwarp, favicon.ico, *.py] excludes = [test, .*, *.pyc, *.pyo] local(rm -f dist/%s % _TAR_FILE) with lcd(os.path.join(os.path.abspath(.), www)): cmd = [tar, --dereference, -czvf, ../dist/%s % _TAR_FILE] cmd.extend([--exclude=\\%s\\ % ex for ex in excludes]) cmd.extend(includes) local( .join(cmd)) Fabric æä¾› local(...) æ¥è¿è¡Œæœ¬åœ°å‘½ä»¤ï¼Œwith lcd(path) å¯ä»¥æŠŠå½“å‰å‘½ä»¤çš„ç›®å½•è®¾å®šä¸º lcd() æŒ‡å®šçš„ç›®å½•ï¼Œæ³¨æ„ Fabric åªèƒ½è¿è¡Œå‘½ä»¤è¡Œå‘½ä»¤ï¼ŒWindows ä¸‹å¯èƒ½éœ€è¦ Cgywin ç¯å¢ƒã€‚ åœ¨ awesome-python-webapp ç›®å½•ä¸‹è¿è¡Œï¼š $ fab build çœ‹çœ‹æ˜¯å¦åœ¨ dist ç›®å½•ä¸‹åˆ›å»ºäº† dist-awesome.tar.gz çš„æ–‡ä»¶ã€‚ æ‰“åŒ…åï¼Œå°±å¯ä»¥ç»§ç»­ç¼–å†™ deploy ä»»åŠ¡ï¼ŒæŠŠæ‰“åŒ…æ–‡ä»¶ä¸Šä¼ è‡³æœåŠ¡å™¨ï¼Œè§£å‹ï¼Œé‡ç½® www è½¯é“¾æ¥ï¼Œé‡å¯ç›¸å…³æœåŠ¡ï¼š _REMOTE_TMP_TAR = /tmp/%s % _TAR_FILE_REMOTE_BASE_DIR = /srv/awesomedef deploy(): newdir = www-%s % datetime.now().strftime(%y-%m-%d_%H.%M.%S) # åˆ é™¤å·²æœ‰çš„taræ–‡ä»¶: run(rm -f %s % _REMOTE_TMP_TAR) # ä¸Šä¼ æ–°çš„taræ–‡ä»¶: put(dist/%s % _TAR_FILE, _REMOTE_TMP_TAR) # åˆ›å»ºæ–°ç›®å½•: with cd(_REMOTE_BASE_DIR): sudo(mkdir %s % newdir) # è§£å‹åˆ°æ–°ç›®å½•: with cd(%s/%s % (_REMOTE_BASE_DIR, newdir)): sudo(tar -xzvf %s % _REMOTE_TMP_TAR) # é‡ç½®è½¯é“¾æ¥: with cd(_REMOTE_BASE_DIR): sudo(rm -f www) sudo(ln -s %s www % newdir) sudo(chown www-data:www-data www) sudo(chown -R www-data:www-data %s % newdir) # é‡å¯PythonæœåŠ¡å’ŒnginxæœåŠ¡å™¨: with settings(warn_only=True): sudo(supervisorctl stop awesome) sudo(supervisorctl start awesome) sudo(/etc/init.d/nginx reload) æ³¨æ„ run() å‡½æ•°æ‰§è¡Œçš„å‘½ä»¤æ˜¯åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œwith cd(path) å’Œ with lcd(path) ç±»ä¼¼ï¼ŒæŠŠå½“å‰ç›®å½•åœ¨æœåŠ¡å™¨ç«¯è®¾ç½®ä¸º cd() æŒ‡å®šçš„ç›®å½•ã€‚å¦‚æœä¸€ä¸ªå‘½ä»¤éœ€è¦ sudo æƒé™ï¼Œå°±ä¸èƒ½ç”¨ run()ï¼Œè€Œæ˜¯ç”¨ sudo() æ¥æ‰§è¡Œã€‚ é…ç½® Supervisorä¸Šé¢è®© Supervisor é‡å¯ awesome çš„å‘½ä»¤ä¼šå¤±è´¥ï¼Œå› ä¸ºè¿˜æ²¡æœ‰é…ç½® Supervisor å‘¢ã€‚ ç¼–å†™ä¸€ä¸ª Supervisor çš„é…ç½®æ–‡ä»¶ awesome.confï¼Œå­˜æ”¾åˆ° /etc/supervisor/conf.d/ ç›®å½•ä¸‹ï¼š [program:awesome]command = /srv/awesome/www/app.pydirectory = /srv/awesome/wwwuser = www-datastartsecs = 3redirect_stderr = truestdout_logfile_maxbytes = 50MBstdout_logfile_backups = 10stdout_logfile = /srv/awesome/log/app.log é…ç½®æ–‡ä»¶é€šè¿‡ [program:awesome] æŒ‡å®šæœåŠ¡åä¸º awesomeï¼Œcommand æŒ‡å®šå¯åŠ¨ app.pyã€‚ ç„¶åé‡å¯ Supervisor åï¼Œå°±å¯ä»¥éšæ—¶å¯åŠ¨å’Œåœæ­¢ Supervisor ç®¡ç†çš„æœåŠ¡äº†ï¼š $ sudo supervisorctl reload$ sudo supervisorctl start awesome$ sudo supervisorctl statusawesome RUNNING pid 1401, uptime 5:01:34 é…ç½® NginxSupervisor åªè´Ÿè´£è¿è¡Œ app.pyï¼Œè¿˜éœ€è¦é…ç½® Nginxã€‚æŠŠé…ç½®æ–‡ä»¶ awesome æ”¾åˆ° /etc/nginx/sites-available/ ç›®å½•ä¸‹ï¼š server listen 80; # ç›‘å¬80ç«¯å£ root /srv/awesome/www; access_log /srv/awesome/log/access_log; error_log /srv/awesome/log/error_log; # server_name awesome.liaoxuefeng.com; # é…ç½®åŸŸå # å¤„ç†é™æ€æ–‡ä»¶/favicon.ico: location /favicon.ico root /srv/awesome/www; # å¤„ç†é™æ€èµ„æº: location ~ ^\\/static\\/.*$ root /srv/awesome/www; # åŠ¨æ€è¯·æ±‚è½¬å‘åˆ°9000ç«¯å£: location / proxy_pass http://127.0.0.1:9000; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Host $host; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; ç„¶ååœ¨ /etc/nginx/sites-enabled/ ç›®å½•ä¸‹åˆ›å»ºè½¯é“¾æ¥ï¼š $ pwd/etc/nginx/sites-enabled$ sudo ln -s /etc/nginx/sites-available/awesome . è®© Nginx é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œä¸å‡ºæ„å¤–ï¼Œçš„ awesome-python3-webapp åº”è¯¥æ­£å¸¸è¿è¡Œï¼š $ sudo /etc/init.d/nginx reload å¦‚æœæœ‰ä»»ä½•é”™è¯¯ï¼Œéƒ½å¯ä»¥åœ¨ /srv/awesome/log ä¸‹æŸ¥æ‰¾ Nginx å’Œ App æœ¬èº«çš„ logã€‚å¦‚æœ Supervisor å¯åŠ¨æ—¶æŠ¥é”™ï¼Œå¯ä»¥åœ¨ /var/log/supervisor ä¸‹æŸ¥çœ‹ Supervisor çš„ logã€‚ å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—® Linux æœåŠ¡å™¨ä¸Šçš„ awesome-python3-webapp äº† å¦‚æœåœ¨å¼€å‘ç¯å¢ƒæ›´æ–°äº†ä»£ç ï¼Œåªéœ€è¦åœ¨å‘½ä»¤è¡Œæ‰§è¡Œï¼š $ fab build$ fab deploy è‡ªåŠ¨éƒ¨ç½²å®Œæˆï¼åˆ·æ–°æµè§ˆå™¨å°±å¯ä»¥çœ‹åˆ°æœåŠ¡å™¨ä»£ç æ›´æ–°åçš„æ•ˆæœã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Python"]},{"title":"åˆ©ç”¨chardetè¯†åˆ«æ–‡ä»¶ç¼–ç ","path":"/2024/04/04/2-ç¼–ç¨‹è¯­è¨€-Python-åˆ©ç”¨chardetè¯†åˆ«æ–‡ä»¶ç¼–ç /","content":"å¸¸è§ç¼–ç æ ¼å¼ ASCII, UTF-8, UTF-16 (2 variants), UTF-32 (4 variants)Big5, GB2312, EUC-TW, HZ-GB-2312, ISO-2022-CN (Traditional and Simplified Chinese)EUC-JP, SHIFT_JIS, CP932, ISO-2022-JP (Japanese)EUC-KR, ISO-2022-KR (Korean)KOI8-R, MacCyrillic, IBM855, IBM866, ISO-8859-5, windows-1251 (Cyrillic)ISO-8859-5, windows-1251 (Bulgarian)ISO-8859-1, windows-1252 (Western European languages)ISO-8859-7, windows-1253 (Greek)ISO-8859-8, windows-1255 (Visual and Logical Hebrew)TIS-620 (Thai) æµ‹è¯•ä»£ç  import chardetopen_file = open(file=miui.cpp,mode=rb) # ä»¥äºŒè¿›åˆ¶æ¨¡å¼è¯»å–æ–‡ä»¶data = open_file.read() # è·å–æ–‡ä»¶å†…å®¹print(data) open_file.close() # å…³é—­æ–‡ä»¶result = chardet.detect(data) # æ£€æµ‹æ–‡ä»¶å†…å®¹print(result) #encoding: utf-8, confidence: 0.99, language: è¾“å‡ºç»“æœ encoding: utf-8 è¡¨ç¤ºæ£€æµ‹åˆ°æ–‡ä»¶çš„ç¼–ç æ ¼å¼ä¸ºutf-8confidence: 0.99 è¡¨ç¤ºå¯ä¿¡åº¦ä¸ºç™¾åˆ†ä¹‹ä¹åä¹language: è¡¨ç¤ºæ–‡ä»¶å†…å®¹çš„è¯­è¨€","categories":["2.ç¼–ç¨‹è¯­è¨€","Python"]},{"title":"å­¦ä¹ è·¯çº¿","path":"/2024/04/03/2-ç¼–ç¨‹è¯­è¨€-Python-å­¦ä¹ è·¯çº¿/","content":"Python è‡ªå­¦è®¡åˆ’Python çš„ä¸»ä½“å†…å®¹å¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š 1. é¢å‘è¿‡ç¨‹é¢å‘è¿‡ç¨‹ç¼–ç¨‹æ˜¯ Python çš„åŸºç¡€ç»„æˆéƒ¨åˆ†ï¼Œè¿™ä¸€éƒ¨åˆ†æ¶µç›–äº†åŸºæœ¬çš„è¡¨è¾¾å¼ã€æ¡ä»¶è¯­å¥ï¼ˆå¦‚ if è¯­å¥ï¼‰ã€å¾ªç¯ç»“æ„ï¼ˆå¦‚ for å’Œ while å¾ªç¯ï¼‰ä»¥åŠå‡½æ•°çš„å®šä¹‰ä¸ä½¿ç”¨ã€‚å¦‚æœæœ‰ä»»ä½•ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€ï¼Œç‰¹åˆ«æ˜¯åƒ C è¯­è¨€è¿™æ ·çš„è¯­è¨€ï¼Œè¿™ä¸€éƒ¨åˆ†å†…å®¹å°±ä¼šæ˜¾å¾—æ¯”è¾ƒç›´è§‚ã€‚ä¾‹å¦‚ï¼Œå¾ªç¯ç»“æ„å¯ä»¥ç”¨æ¥å¤„ç†é‡å¤ä»»åŠ¡ï¼Œè€Œå‡½æ•°åˆ™å¸®åŠ©ç»„ç»‡ä»£ç ï¼Œé¿å…é‡å¤ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•çš„å‡½æ•°å¯ä»¥è½»æ¾åœ°è®¡ç®—ä¸¤ä¸ªæ•°å­—çš„å’Œï¼š def add(a, b): return a + b å¦‚æœæ²¡æœ‰ç¼–ç¨‹çš„åŸºç¡€ï¼Œå»ºè®®ä»ä¸€æœ¬åŸºç¡€æ€§å‚è€ƒä¹¦å¼€å§‹å­¦ä¹ ï¼Œä¾‹å¦‚ã€ŠPython Programmingã€‹ã€‚è¿™æœ¬ä¹¦çš„å†…å®¹é€šä¿—æ˜“æ‡‚ï¼Œé¢å‘è®¡ç®—æœºå¯¼è®ºï¼Œè¯»è€…ä¸éœ€è¦æœ‰ç¼–ç¨‹ç»éªŒä¹Ÿèƒ½é¡ºåˆ©å…¥é—¨ã€‚ 2. é¢å‘å¯¹è±¡åœ¨ Python ä¸­ï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹æ˜¯å¦ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œæ¶‰åŠåˆ°åŸºæœ¬çš„é¢å‘å¯¹è±¡æ¦‚å¿µï¼Œæ¯”å¦‚ç±»ã€å¯¹è±¡ã€æ–¹æ³•ã€å±æ€§å’Œç»§æ‰¿ç­‰ã€‚Python æ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œå¼ºè°ƒâ€ä¸€åˆ‡çš†å¯¹è±¡â€ã€‚ä¸ Java å’Œ C++ ä¸åŒï¼ŒPython çš„é¢å‘å¯¹è±¡æœºåˆ¶ç›¸å¯¹æ¾æ•£ï¼Œæ„å‘³ç€å­¦ä¹ è€…å¯ä»¥æ›´çµæ´»åœ°è¿›è¡Œåˆ›é€ å’Œä¿®æ”¹ã€‚ ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªç±»å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š class Animal: def __init__(self, name): self.name = name def speak(self): return fself.name says hello. æ¾æ•£çš„ç»“æ„ä½¿å¾—å­¦ä¹ å’Œç»´æŠ¤ä»£ç å˜å¾—ç®€å•ï¼Œä½†ä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„çµæ´»æ€§ï¼Œå®¹æ˜“è®©åˆå­¦è€…çŠ¯é”™ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹æ—¶ï¼Œéœ€è¦æ³¨æ„å¦‚ä½•ç®¡ç†å’Œç»´æŠ¤è‡ªå·±çš„ä»£ç ã€‚ 3. åº”ç”¨åŠŸèƒ½Python çš„åº”ç”¨åŠŸèƒ½åŒ…æ‹¬è¾“å…¥è¾“å‡ºï¼ˆIOï¼‰ã€æ•°æ®å®¹å™¨å¦‚åˆ—è¡¨ï¼ˆlistï¼‰å’Œå­—å…¸ï¼ˆdictionaryï¼‰ã€å†…ç½®å‡½æ•°ã€æ¨¡å—å’Œæ ¼å¼åŒ–å­—ç¬¦ä¸²ç­‰ã€‚è¿™äº›æ¦‚å¿µåœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­ä¹ŸåŒæ ·å­˜åœ¨ï¼Œå…·æœ‰å¾ˆå¼ºçš„å®ç”¨æ€§å’Œå¯ç§»æ¤æ€§ã€‚ä¾‹å¦‚ï¼Œå­—å…¸æ˜¯ä¸€ç§çµæ´»çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥ä½¿ç”¨é”®å€¼å¯¹çš„æ–¹å¼å­˜å‚¨æ•°æ®ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡é”®å¿«é€Ÿè®¿é—®åˆ°å¯¹åº”çš„å€¼ï¼š person = name: Alice, age: 30print(person[name]) # è¾“å‡º: Alice è¿™äº›åº”ç”¨åŠŸèƒ½ä½¿å¾— Python æˆä¸ºä¸€ä¸ªé«˜æ•ˆå’Œæ˜“äºä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼Œé€‚åˆå¼€å‘å„ç§ç±»å‹çš„åº”ç”¨ã€‚ 4. é«˜çº§è¯­æ³•Python è¿˜æä¾›äº†ä¸€äº›é«˜çº§è¯­æ³•ï¼Œå¦‚ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€åˆ—è¡¨æ¨å¯¼ã€å‡½æ•°å¼ç¼–ç¨‹ã€è£…é¥°å™¨å’Œç‰¹æ®Šæ–¹æ³•ç­‰ã€‚è¿™äº›é«˜çº§åŠŸèƒ½è™½ç„¶ä¸æ˜¯å­¦ä¹  Python çš„å¿…éœ€ï¼Œä½†å®ƒä»¬ä½¿ç¼–ç¨‹æ›´åŠ ç®€æ´å’Œä¼˜é›…ã€‚ä¾‹å¦‚ï¼Œåˆ—è¡¨æ¨å¯¼èƒ½å¤Ÿåœ¨ä¸€è¡Œä¸­å®ç°å¤æ‚çš„åˆ—è¡¨åˆ›å»ºï¼Œç›¸è¾ƒäºä¼ ç»Ÿçš„å¾ªç¯ä½¿ç”¨ï¼Œèƒ½å¤Ÿå‡å°‘ä»£ç é‡ï¼Œæé«˜å¯è¯»æ€§ï¼š squares = [x**2 for x in range(10)] è¿™é‡Œï¼Œä»…ç”¨ä¸€è¡Œä»£ç å°±ç”Ÿæˆäº†ä» 0 åˆ° 9 çš„å¹³æ–¹åˆ—è¡¨ï¼Œè¿™åœ¨ç”¨ä¼ ç»Ÿçš„ for å¾ªç¯æ—¶éœ€è¦æ›´å¤šçš„è¡Œæ•°ã€‚ Web å¼€å‘æ–¹å‘ é˜…è¯»èµ„æ–™: å®Œæˆã€Šç®€æ˜ Python æ•™ç¨‹ã€‹ã€‚è¿™æœ¬ä¹¦ä»¥æ¸…æ™°æ˜“æ‡‚çš„è¯­è¨€ä¸ºåˆå­¦è€…ä»‹ç» Python çš„åŸºæœ¬æ¦‚å¿µå’Œè¯­æ³•ç»“æ„ï¼Œé€‚åˆåˆæ¬¡æ¥è§¦ç¼–ç¨‹çš„è¯»è€…ã€‚ é€‚åº”å¼€å‘ç¯å¢ƒ: å®‰è£… Python æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶è®¾ç½®å¥½å¼€å‘ç¯å¢ƒï¼ˆæ¨èä½¿ç”¨ Anaconda æˆ–ç›´æ¥å®‰è£… Pythonï¼‰ã€‚ç†Ÿæ‚‰åŸºæœ¬çš„å‘½ä»¤è¡Œæ“ä½œï¼ˆä¾‹å¦‚åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€å®‰è£…åŒ…ç­‰ï¼‰ï¼Œä¸ºåç»­é¡¹ç›®æ‰“ä¸‹åŸºç¡€ã€‚ é¡¹ç›®ç›®æ ‡: ç¼–å†™ä¸€ä¸ªç®€å•çš„ç½‘ç»œçˆ¬è™«ã€‚ å¿…å­¦æ¨¡å—: re: å­¦ä¹ æ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºæå–ç½‘é¡µå†…å®¹ï¼ˆä¾‹å¦‚è·å–ç½‘é¡µä¸­çš„ç‰¹å®šä¿¡æ¯ï¼‰ã€‚ urllib2: å¤„ç† URL è¯·æ±‚ä¸ HTTP å“åº”ï¼Œä»è€Œè·å–ç½‘é¡µæ•°æ®ã€‚ sqlite3: äº†è§£å¦‚ä½•ä½¿ç”¨ SQLite æ•°æ®åº“å­˜å‚¨æŠ“å–çš„æ•°æ®ã€‚ threading å’Œ Queue: å®ç°å¤šçº¿ç¨‹çˆ¬å–ï¼Œæé«˜æŠ“å–æ•ˆç‡å’Œé€Ÿåº¦ã€‚ å®æ–½ç»†èŠ‚: å­¦ä¹ å¦‚ä½•ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åˆ†ææŠ“å–åˆ°çš„æ•°æ®ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œå¯ä»¥ä»æ–‡ç« ä¸­æå–å‡ºæ ‡é¢˜ã€ä½œè€…åŠå‘å¸ƒæ—¶é—´ã€‚ å®ç°ç¨‹åºè‡ªåŠ¨é‡å¯åŠŸèƒ½ï¼Œå½“è·å–æ•°æ®çš„è¯·æ±‚å¤±è´¥æ—¶å¯ä»¥è‡ªåŠ¨ç»§ç»­ï¼Œç¡®ä¿çˆ¬è™«çš„æŒç»­æŠ“å–çš„ç¨³å®šæ€§å’Œæœ‰æ•ˆæ€§ã€‚ é€‰æ‹©æ¡†æ¶: å­¦ä¹  Flask æˆ– webpy ç­‰è½»é‡çº§ Web å¼€å‘æ¡†æ¶ã€‚è¿™äº›æ¡†æ¶æ˜“äºä¸Šæ‰‹ï¼Œå¹¶ä¸”å…·æœ‰ä¸°å¯Œçš„æ–‡æ¡£æ”¯æŒï¼Œé€‚åˆåˆå­¦è€…è¿›è¡Œå®è·µã€‚ æ•°æ®åº“æ¥å£: æŒæ¡å¦‚ä½•è¿æ¥å’Œæ“ä½œ SQLite æ•°æ®åº“ï¼Œä»¥ä¾¿åœ¨çš„ Web åº”ç”¨ä¸­å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ã€‚ é¡¹ç›®å®ä¾‹: å¼€å‘ä¸€ä¸ªç®€å•çš„ Web åº”ç”¨ï¼Œå¦‚åšå®¢ï¼Œè‡³å°‘å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š ç”¨æˆ·å¯ä»¥æ³¨å†Œå’Œç™»å½•ã€‚ ç”¨æˆ·å¯ä»¥å‘è¡¨æ–°æ–‡ç« ã€‚ ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å·²æœ‰æ–‡ç« çš„åˆ—è¡¨ï¼Œå¹¶ç‚¹å‡»è¿›å…¥æŸ¥çœ‹è¯¦ç»†å†…å®¹ã€‚ é¡¹ç›®åŠŸèƒ½å®æ–½: åŸºäºå‰é¢çš„å­¦ä¹ ï¼Œç»™çš„ Web åº”ç”¨å¢åŠ ä¸€ä¸ªå°åŠŸèƒ½ï¼Œæ¯”å¦‚è¯„è®ºåŠŸèƒ½ï¼Œç”¨æˆ·èƒ½åœ¨æ–‡ç« ä¸‹æ–¹ç•™ä¸‹è¯„è®ºã€‚ æµ‹è¯•ä¸ä¸Šçº¿: æµ‹è¯•åŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ç­‰ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§å’Œæ­£ç¡®æ€§ã€‚ ç†è§£åŸºæœ¬çš„éƒ¨ç½²æµç¨‹ï¼ˆå¦‚ä½¿ç”¨ Heroku æˆ– VPS æ¥ä¸Šçº¿çš„åº”ç”¨ï¼‰ï¼Œè®©çš„é¡¹ç›®ä»å¼€å‘ç¯å¢ƒè½¬å˜ä¸ºç”Ÿäº§ç¯å¢ƒã€‚ ç®—æ³•ä¸æ•°æ®ç»“æ„åœ¨ Python ä¸­ï¼Œå¸¸ç”¨çš„æ•°æ®ç»“æ„åŒ…æ‹¬ listã€tupleã€setã€frozenset å’Œ dictï¼Œä»¥åŠ collections æ¨¡å—ä¸­çš„ OrderedDictã€defaultdictã€dequeã€namedtuple å’Œ Counter ç­‰ã€‚ç‰¹åˆ«æ˜¯å¯¹è¿™äº›æ•°æ®ç»“æ„çš„ç‰¹æ€§å’Œä½¿ç”¨åœºæ™¯è¿›è¡Œæ·±å…¥ç†è§£ï¼Œå¯ä»¥å¸®åŠ©åœ¨ä¸åŒçš„ç¼–ç¨‹ä»»åŠ¡ä¸­é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼Œä»è€Œæé«˜ä»£ç çš„æ•ˆç‡ã€‚ ä¾‹å¦‚ï¼Œäº†è§£å½“éœ€è¦ä¸€ä¸ªå¯å˜çš„ã€æœ‰åºçš„æ•°æ®é›†åˆæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ OrderedDictï¼Œè€Œåœ¨éœ€è¦ä¸€ä¸ªæ— é‡å¤å…ƒç´ çš„é›†åˆæ—¶ï¼Œåº”é€‰æ‹© setã€‚æ­¤å¤–ï¼ŒæŒæ¡åŸºæœ¬çš„ç®—æ³•æ€æƒ³ï¼Œå¦‚é€’å½’ã€äºŒåˆ†æŸ¥æ‰¾ç­‰ï¼Œå¯ä»¥å¸®åŠ©ç¼–å†™å‡ºé«˜æ•ˆä¸”æ˜“ç”¨çš„ä»£ç ã€‚å¦‚æœæƒ³é€šè¿‡å®è·µæ¥åŠ æ·±ç†è§£ï¼Œæ¨èåœ¨ ACM ç«èµ›å¹³å°æˆ– LeetCode ç­‰ç½‘ç«™ä¸Šè¿›è¡Œåˆ·é¢˜è®­ç»ƒã€‚ Python ä¸æ•°æ®åº“åœ¨ç½‘ç«™ä¸šåŠ¡çš„åç«¯ï¼Œä¸»æµçš„æ•°æ®åº“ç±»å‹æœ‰ä¸‰ç§ï¼šå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰ã€æ–‡æ¡£å‹æ•°æ®åº“ï¼ˆå¦‚ MongoDBï¼‰ä»¥åŠå†…å­˜å‹æ•°æ®åº“ï¼ˆå¦‚ Redisï¼‰ã€‚è¿™äº›æ•°æ®åº“å„è‡ªå…·æœ‰ä¸åŒçš„ä¼˜åŠ¿å’Œé€‚ç”¨åœºæ™¯ã€‚ä½œä¸ºåç«¯ç¨‹åºå‘˜ï¼Œäº†è§£å¦‚ä½•çµæ´»ä½¿ç”¨è¿™äº›æ•°æ®åº“ä»¥åŠå®ƒä»¬å„è‡ªçš„ç‰¹ç‚¹è‡³å…³é‡è¦ï¼Œå°¤å…¶æ˜¯ MySQL å’Œ Redisã€‚ SQLiteSQLite æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ•°æ®åº“ï¼Œå¼•å…¥äº†ç®€ä¾¿çš„æ–‡ä»¶å­˜å‚¨æ–¹å¼ï¼Œé€‚åˆå¿«é€Ÿå¼€å‘å’Œå°å‹åº”ç”¨ã€‚å¯ä»¥å‚è€ƒ SQLite Python Tutorial æ¥æŒæ¡åŸºç¡€çŸ¥è¯†ã€‚ã€ŠThe Definitive Guide to SQLiteã€‹æ˜¯ä¸€æœ¬æ·±å…¥è§£æ SQLite çš„ä¹¦ç±ï¼Œé€‚åˆéœ€è¦æ›´é«˜æ•ˆä½¿ç”¨è¯¥æ•°æ®åº“çš„å¼€å‘è€…ã€‚ åœ¨ä½¿ç”¨ SQLite 3 æ—¶ï¼Œäº†è§£ä¸€äº›åŸºæœ¬çš„å‘½ä»¤å’Œæ“ä½œæ˜¯è‡³å…³é‡è¦çš„ã€‚å¯ä»¥é€šè¿‡é˜…è¯» SQLite Documentation æ¥è·å–ç›¸å…³ä¿¡æ¯ã€‚ MySQLMySQL æ˜¯ä¸€ç§æµè¡Œçš„å…³ç³»æ•°æ®åº“ï¼Œå¯¹äºéœ€è¦è¿›è¡Œå¤§æ•°æ®é‡å­˜å‚¨å’Œæ“ä½œçš„åº”ç”¨å°¤ä¸ºåˆé€‚ã€‚æƒ³è¦æ¥è§¦ MySQL çš„å¼€å‘è€…å¯æŸ¥é˜… Python MySQL Database Access çš„æ•™ç¨‹ã€‚ MongoDBMongoDB ä½œä¸º NoSQL çš„ä¸€å‘˜ï¼Œå› å…¶çµæ´»çš„æ•°æ®æ¨¡å‹è€Œå—åˆ°å¹¿æ³›æ¬¢è¿ã€‚å¯¹äºç†Ÿæ‚‰ SQL çš„å¼€å‘è€…ï¼Œå­¦ä¹  MongoDB çš„é—¨æ§›ç›¸å¯¹è¾ƒä½ã€‚æ¨èé˜…è¯» MongoDBå®˜æ–¹æ–‡æ¡£ è¿›è¡Œå…¥é—¨ã€‚ä¸¤ä¸ªå¸¸ç”¨çš„ Python é©±åŠ¨æ˜¯ï¼š PyMongo - æä¾›äº†ç±»ä¼¼ Mongo Shell çš„æ¥å£ï¼Œä¾¿äºå®ç° MongoDB çš„å„ç§æ“ä½œã€‚ MongoEngine - ä½œä¸º MongoDB çš„ ORM æ¡†æ¶ï¼Œå®ƒæŠŠæ•°æ®æ¨¡å‹è½¬åŒ–ä¸º Python å¯¹è±¡ï¼Œé€šç”¨æ€§å’Œæ˜“ç”¨æ€§è¾ƒé«˜ã€‚ RedisRedis æ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„é«˜æ€§èƒ½é”®å€¼å­˜å‚¨æ•°æ®åº“ã€‚è™½ç„¶ Redis éœ€è¦ä¸€å®šçš„å­¦ä¹ æˆæœ¬ï¼Œä½†å®ƒèƒ½å¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼Œå°¤å…¶åœ¨å®æ—¶åº”ç”¨ä¸­ã€‚å…¥é—¨æ¨èé˜…è¯» The Little Redis Bookã€‚å¸¸ç”¨çš„ Python å®¢æˆ·ç«¯é©±åŠ¨åŒ…æ‹¬ï¼š redis-py - å®˜æ–¹æ”¯æŒçš„ Redis Python å®¢æˆ·ç«¯ã€‚ æ›´å¤šå®¢æˆ·ç«¯é€‰æ‹©å¯ä»¥å‚è€ƒ Redis Clientsã€‚ Python çš„ Web æ¡†æ¶Python æ‹¥æœ‰ä¼—å¤š Web æ¡†æ¶ä¾›å¼€å‘è€…é€‰æ‹©ï¼Œé€‚åˆä¸åŒç±»å‹çš„é¡¹ç›®ã€‚å¯ä»¥åœ¨ Python Web Frameworks ä¸­ä¸€è§ˆè¿™äº›æ¡†æ¶ä¼˜åŠ¿ã€‚å¦‚æœæ‰¾ä¸åˆ°åˆé€‚çš„æ¡†æ¶ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘åŸºäºè‡ªå·±çš„éœ€æ±‚å¼€å‘ä¸€ä¸ªã€‚è¿™äº›æ¡†æ¶ä¹‹æ‰€ä»¥å¦‚æ­¤ç¹å¤šï¼Œåæ˜ äº† Python ç¤¾åŒºçš„æ´»è·ƒå’Œå¤šæ ·åŒ–ã€‚ web.pyweb.pyæ˜¯ä¸€ä¸ªç®€çº¦è€Œå¼ºå¤§çš„ Python Web æ¡†æ¶ã€‚å®ƒè¢«å…¬å¼€å½’å±ï¼Œæ„å‘³ç€å¯ä»¥å°†å…¶ç”¨äºä»»ä½•ç›®çš„ï¼Œè€Œä¸å—é™åˆ¶ã€‚ é¡¹ç›®é“¾æ¥: åœ¨çº¿ demo åˆ›å§‹äºº: Aaron Swartz çš„åšå®¢ã€åœ¨ GitHub ä¸Šæœ‰åˆ†äº«ã€‘ã€‚ FlaskFlaskæ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Web åº”ç”¨æ¡†æ¶ï¼ŒåŸºäº Werkzeug WSGI å·¥å…·åŒ…å’Œ Jinja2 æ¨¡æ¿å¼•æ“ã€‚å®ƒé‡‡ç”¨ BSD è®¸å¯ï¼Œå› æ­¤å…è®¸è‡ªç”±ä½¿ç”¨å’Œä¿®æ”¹ã€‚Flask è¢«ç§°ä¸ºå¾®æ¡†æ¶ï¼Œå› ä¸ºå®ƒæ ¸å¿ƒéƒ¨åˆ†ç®€å•ä½†å¯æ‰©å±•ã€‚ å®æˆ˜æ•™ç¨‹: Flask Mega-Tutorial TornadoTornadoæ˜¯ä¸€ä¸ªå¼‚æ­¥æ¡†æ¶ï¼Œæœ€åˆåœ¨ FriendFeed å¼€å‘ï¼Œä¹‹ååœ¨ Facebook æ”¶è´­åå¼€æºã€‚Tornado æ˜¯ä¸€ä¸ª Python web æ¡†æ¶å’Œå¼‚æ­¥ç½‘ç»œåº“ï¼Œéå¸¸é€‚åˆæ„å»ºé«˜æ€§èƒ½çš„éé˜»å¡å®æ—¶ Web åº”ç”¨ã€‚å¦‚æœå¸Œæœ›çš„ Web åº”ç”¨å…·æœ‰é«˜å¹¶å‘çš„èƒ½åŠ›ï¼ŒTornado å°†æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ é¡¹ç›®é“¾æ¥: Tornado on GitHub DjangoDjangoæ˜¯ä¸€ä¸ªé«˜çº§ Python Web æ¡†æ¶ï¼Œæ—¨åœ¨é¼“åŠ±å¿«é€Ÿå¼€å‘ä»¥åŠå¹²å‡€ã€åŠ¡å®çš„è®¾è®¡ã€‚ä½œä¸ºä¸€ä¸ªå…¨æ ˆå¼æ¡†æ¶ï¼ŒDjango æ‹¥æœ‰è®¸å¤šå†…ç½®ç»„ä»¶ï¼Œç¡®ä¿å¿«é€Ÿæ„å»ºå¯é çš„ web åº”ç”¨ã€‚ èµ„æ–™é“¾æ¥: Django èµ„æ–™","categories":["2.ç¼–ç¨‹è¯­è¨€","Python"]},{"title":"çˆ¬è™«","path":"/2024/04/01/2-ç¼–ç¨‹è¯­è¨€-Python-çˆ¬è™«/","content":"å‰è¨€æœ€è¿‘æƒ³æŠŠä¸€ä¸ªåšå®¢ç½‘ç«™çš„æ–‡ç« éƒ½çˆ¬ä¸‹æ¥å­˜åˆ°æœ¬åœ°ï¼Œæ­£å¥½å€Ÿè¿™ä¸ªæœºä¼šè®°å½•ä¸€ä¸‹çˆ¬è™«çš„è®¾è®¡æ€è·¯ã€‚è¿™ç¯‡ç¬”è®°ä¼šä»é›¶å¼€å§‹è®²è§£ï¼Œå³ä½¿ä½ æ²¡æœ‰å¤ªå¤šç¼–ç¨‹ç»éªŒï¼Œè·Ÿç€åšä¹Ÿèƒ½å†™å‡ºè‡ªå·±çš„çˆ¬è™«ã€‚ å·¥å…·é€‰æ‹©çˆ¬è™«è¯´ç™½äº†å°±æ˜¯æ¨¡æ‹Ÿæµè§ˆå™¨å»è®¿é—®ç½‘é¡µï¼Œç„¶åæŠŠéœ€è¦çš„å†…å®¹æå–å‡ºæ¥ã€‚Python æœ‰å¾ˆå¤šç°æˆçš„åº“å¯ä»¥ç”¨ï¼š å·¥å…· ç”¨é€” ç‰¹ç‚¹ requests å‘é€ HTTP è¯·æ±‚ ç®€å•å¥½ç”¨ï¼Œå¤§å¤šæ•°æƒ…å†µå¤Ÿç”¨ BeautifulSoup è§£æ HTML è¯­æ³•ç›´è§‚ï¼Œå®¹æ˜“ä¸Šæ‰‹ Selenium æµè§ˆå™¨è‡ªåŠ¨åŒ– èƒ½å¤„ç† JavaScript æ¸²æŸ“çš„é¡µé¢ï¼Œä½†é€Ÿåº¦æ…¢ Scrapy ä¸“ä¸šçˆ¬è™«æ¡†æ¶ åŠŸèƒ½å¼ºå¤§ï¼Œé€‚åˆå¤§å‹é¡¹ç›® å¯¹äºæ™®é€šçš„é™æ€ç½‘ç«™ï¼Œrequests + BeautifulSoup å°±è¶³å¤Ÿäº†ã€‚å¦‚æœæ˜¯é‚£ç§éœ€è¦ JavaScript æ‰èƒ½åŠ è½½å†…å®¹çš„ç½‘ç«™ï¼ˆæ¯”å¦‚æ— é™æ»šåŠ¨åŠ è½½çš„é¡µé¢ï¼‰ï¼Œå°±éœ€è¦ç”¨ Seleniumã€‚ åŠ¨æ‰‹ä¹‹å‰å…ˆææ¸…æ¥šç½‘ç«™ç»“æ„ä¸ç®¡çˆ¬ä»€ä¹ˆç½‘ç«™ï¼Œç¬¬ä¸€æ­¥éƒ½æ˜¯æ‰“å¼€æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œçœ‹çœ‹ç½‘é¡µçš„çœŸå®ç»“æ„ã€‚ æŸ¥çœ‹ç½‘é¡µæºç å³é”® - æŸ¥çœ‹ç½‘é¡µæºç ï¼Œçœ‹çœ‹å†…å®¹æ˜¯ç›´æ¥å†™åœ¨ HTML é‡Œï¼Œè¿˜æ˜¯é€šè¿‡ JavaScript åŠ¨æ€åŠ è½½çš„ã€‚ åˆ†ææ•°æ®æ¥æºåˆ‡æ¢åˆ° Network æ ‡ç­¾ï¼Œåˆ·æ–°é¡µé¢ï¼Œè§‚å¯Ÿç½‘ç»œè¯·æ±‚ã€‚å¾ˆå¤šç°ä»£ç½‘ç«™çš„æ•°æ®æ˜¯é€šè¿‡ API è¿”å›çš„ JSON æ ¼å¼ï¼Œç›´æ¥è¯·æ±‚ API æ¯”è§£æ HTML æ–¹ä¾¿å¤šäº†ã€‚ æ‰¾è§„å¾‹æ¯”å¦‚æ–‡ç« åˆ—è¡¨é¡µçš„ URL æ˜¯ä¸æ˜¯æœ‰è§„å¾‹ï¼Ÿåˆ†é¡µæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿæ–‡ç« è¯¦æƒ…é¡µçš„ URL æ ¼å¼æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿè¿™äº›è§„å¾‹å†³å®šäº†çˆ¬è™«çš„è®¾è®¡æ€è·¯ã€‚ å®æˆ˜ï¼šçˆ¬å– findmoney.club åšå®¢ä¸‹é¢ä»¥ https://www.findmoney.club/ ä¸ºä¾‹ï¼Œæ¼”ç¤ºå®Œæ•´çš„çˆ¬è™«è®¾è®¡è¿‡ç¨‹ã€‚ åˆ†æç½‘ç«™è¿™ä¸ªç½‘ç«™ç”¨çš„æ˜¯ Next.js æ¡†æ¶ï¼Œæœ‰ä¸ªç‰¹ç‚¹ï¼šé¡µé¢æ•°æ®éƒ½åµŒåœ¨ HTML é‡Œçš„ä¸€ä¸ª script id=__NEXT_DATA__ æ ‡ç­¾ä¸­ï¼Œæ˜¯ JSON æ ¼å¼ã€‚ æ‰“å¼€é¦–é¡µçš„æºç ï¼Œæœç´¢ __NEXT_DATA__ï¼Œä½ ä¼šå‘ç°é‡Œé¢æœ‰ä¸ª allNavPages æ•°ç»„ï¼ŒåŒ…å«äº†æ‰€æœ‰æ–‡ç« çš„åŸºæœ¬ä¿¡æ¯ï¼šæ ‡é¢˜ã€åˆ†ç±»ã€é“¾æ¥ç­‰ã€‚ åŒæ ·åœ°ï¼Œæ‰“å¼€æŸç¯‡æ–‡ç« çš„é¡µé¢ï¼Œ__NEXT_DATA__ é‡Œæœ‰ä¸ª post å¯¹è±¡ï¼ŒåŒ…å«æ–‡ç« çš„è¯¦ç»†å†…å®¹ã€‚è¿™äº›æ•°æ®å­˜å‚¨åœ¨ Notion çš„ block ç»“æ„ä¸­ã€‚ å®‰è£…ä¾èµ–pip install requests beautifulsoup4 markdownify requestsï¼šå‘é€ç½‘ç»œè¯·æ±‚ beautifulsoup4ï¼šè§£æ HTMLï¼ˆè™½ç„¶æˆ‘ä»¬ä¸»è¦è§£æ JSONï¼Œä½†ä¹Ÿå¯èƒ½ç”¨åˆ°ï¼‰ markdownifyï¼šæŠŠ HTML è½¬æˆ Markdown å®Œæ•´ä»£ç #!/usr/bin/env python3# -*- coding: utf-8 -*-FindMoney.club åšå®¢çˆ¬è™«å°†ç½‘ç«™çš„æ‰€æœ‰æ–‡ç« çˆ¬å–å¹¶è½¬æ¢ä¸º Markdown æ ¼å¼ä¿å­˜import requestsimport jsonimport osimport reimport timefrom urllib.parse import urljoin, quoteclass FindMoneyCrawler: çˆ¬è™«ä¸»ç±» def __init__(self, output_dir=./articles): self.base_url = https://www.findmoney.club self.output_dir = output_dir self.session = requests.Session() # è®¾ç½®è¯·æ±‚å¤´ï¼Œæ¨¡æ‹Ÿæµè§ˆå™¨è®¿é—® # è¿™ä¸€æ­¥å¾ˆé‡è¦ï¼Œå¾ˆå¤šç½‘ç«™ä¼šæ£€æŸ¥ User-Agent self.session.headers.update( User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36, Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8, Accept-Language: zh-CN,zh;q=0.9,en;q=0.8, ) # åˆ›å»ºè¾“å‡ºç›®å½• os.makedirs(output_dir, exist_ok=True) def get_page(self, url): è·å–é¡µé¢å†…å®¹ï¼Œå¸¦é‡è¯•æœºåˆ¶ max_retries = 3 for i in range(max_retries): try: response = self.session.get(url, timeout=30) response.raise_for_status() return response.text except requests.RequestException as e: print(fè¯·æ±‚å¤±è´¥ (i+1/max_retries): e) if i max_retries - 1: time.sleep(2) # ç­‰å¾…2ç§’åé‡è¯• return None def extract_next_data(self, html): ä» HTML ä¸­æå– __NEXT_DATA__ JSON æ•°æ® # ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… script æ ‡ç­¾ä¸­çš„ JSON # ä¸ºä»€ä¹ˆä¸ç”¨ BeautifulSoupï¼Ÿå› ä¸ºè¿™ç§åœºæ™¯æ­£åˆ™æ›´ç®€æ´ pattern = rscript id=__NEXT_DATA__ type=application/json(.*?)/script match = re.search(pattern, html, re.DOTALL) if match: try: return json.loads(match.group(1)) except json.JSONDecodeError as e: print(fJSON è§£æé”™è¯¯: e) return None return None def get_all_articles(self): è·å–æ‰€æœ‰æ–‡ç« åˆ—è¡¨ print(æ­£åœ¨è·å–æ–‡ç« åˆ—è¡¨...) html = self.get_page(self.base_url) if not html: print(è·å–é¦–é¡µå¤±è´¥) return [] data = self.extract_next_data(html) if not data: print(è§£æé¦–é¡µæ•°æ®å¤±è´¥) return [] # ä» pageProps ä¸­æå–æ–‡ç« åˆ—è¡¨ try: all_pages = data[props][pageProps][allNavPages] # è¿‡æ»¤å‡ºæ–‡ç« ï¼ˆæœ‰äº›å¯èƒ½æ˜¯èœå•æˆ–å…¶ä»–ç±»å‹ï¼‰ articles = [ page for page in all_pages if page.get(href) and not page.get(href).startswith(/#) ] print(fæ‰¾åˆ° len(articles) ç¯‡æ–‡ç« ) return articles except KeyError as e: print(fæ•°æ®ç»“æ„å¼‚å¸¸: e) return [] def get_article_content(self, article_url): è·å–å•ç¯‡æ–‡ç« çš„è¯¦ç»†å†…å®¹ full_url = urljoin(self.base_url, article_url) html = self.get_page(full_url) if not html: return None data = self.extract_next_data(html) if not data: return None try: return data[props][pageProps][post] except KeyError: return None def notion_blocks_to_markdown(self, post_data): å°† Notion blocks è½¬æ¢ä¸º Markdown æ ¼å¼ if not post_data or blockMap not in post_data: return blocks = post_data.get(blockMap, ).get(block, ) content_ids = post_data.get(content, []) markdown_lines = [] # æ·»åŠ æ–‡ç« æ ‡é¢˜ title = post_data.get(title, æ— æ ‡é¢˜) markdown_lines.append(f# title ) # æ·»åŠ å…ƒä¿¡æ¯ if post_data.get(category): markdown_lines.append(f**åˆ†ç±»**: post_data[category]) if post_data.get(tags): tags = , .join(post_data[tags]) markdown_lines.append(f**æ ‡ç­¾**: tags) if post_data.get(summary): markdown_lines.append(f**æ‘˜è¦**: post_data[summary]) if post_data.get(publishDay): markdown_lines.append(f**å‘å¸ƒæ—¥æœŸ**: post_data[publishDay]) markdown_lines.append( --- ) # éå†å†…å®¹å— for block_id in content_ids: if block_id not in blocks: continue block = blocks[block_id].get(value, ) block_type = block.get(type, ) properties = block.get(properties, ) # è·å–æ–‡æœ¬å†…å®¹ text_content = self._extract_rich_text(properties.get(title, [])) # æ ¹æ®å—ç±»å‹è½¬æ¢ä¸º Markdown if block_type == header: markdown_lines.append(f# text_content) elif block_type == sub_header: markdown_lines.append(f## text_content) elif block_type == sub_sub_header: markdown_lines.append(f### text_content) elif block_type == text: if text_content: markdown_lines.append(text_content) else: markdown_lines.append() # ç©ºè¡Œ elif block_type == bulleted_list: markdown_lines.append(f- text_content) elif block_type == numbered_list: markdown_lines.append(f1. text_content) elif block_type == quote: markdown_lines.append(f text_content) elif block_type == code: language = block.get(properties, ).get(language, [[]])[0][0] markdown_lines.append(f```language) markdown_lines.append(text_content) markdown_lines.append(```) elif block_type == image: source = properties.get(source, [[]])[0][0] if source: markdown_lines.append(f![image](source)) elif block_type == divider: markdown_lines.append(---) elif block_type == callout: markdown_lines.append(f **æç¤º**: text_content) return .join(markdown_lines) def _extract_rich_text(self, rich_text_array): ä» Notion çš„å¯Œæ–‡æœ¬æ•°ç»„ä¸­æå–çº¯æ–‡æœ¬å’Œæ ¼å¼ if not rich_text_array: return result = [] for item in rich_text_array: if not isinstance(item, list) or len(item) == 0: continue text = item[0] # å¤„ç†æ ¼å¼ï¼ˆç²—ä½“ã€é“¾æ¥ç­‰ï¼‰ if len(item) 1 and isinstance(item[1], list): for format_item in item[1]: if isinstance(format_item, list): format_type = format_item[0] if len(format_item) 0 else format_value = format_item[1] if len(format_item) 1 else if format_type == b: # ç²—ä½“ text = f**text** elif format_type == i: # æ–œä½“ text = f*text* elif format_type == a: # é“¾æ¥ text = f[text](format_value) elif format_type == c: # ä»£ç  text = f`text` elif isinstance(format_item, str): if format_item == b: text = f**text** elif format_item == i: text = f*text* result.append(text) return .join(result) def sanitize_filename(self, name): æ¸…ç†æ–‡ä»¶åï¼Œç§»é™¤ä¸åˆæ³•å­—ç¬¦ # æ›¿æ¢ Windows ä¸å…è®¸çš„æ–‡ä»¶åå­—ç¬¦ invalid_chars = r[:/\\\\|?*] name = re.sub(invalid_chars, _, name) # é™åˆ¶é•¿åº¦ if len(name) 100: name = name[:100] return name.strip() def save_article(self, article_info, content): ä¿å­˜æ–‡ç« ä¸º Markdown æ–‡ä»¶ title = article_info.get(title, æ— æ ‡é¢˜) category = article_info.get(category, æœªåˆ†ç±») # åˆ›å»ºåˆ†ç±»ç›®å½• category_dir = os.path.join(self.output_dir, self.sanitize_filename(category)) os.makedirs(category_dir, exist_ok=True) # ç”Ÿæˆæ–‡ä»¶å filename = self.sanitize_filename(title) + .md filepath = os.path.join(category_dir, filename) # å†™å…¥æ–‡ä»¶ with open(filepath, w, encoding=utf-8) as f: f.write(content) print(f å·²ä¿å­˜: filepath) return filepath def run(self): è¿è¡Œçˆ¬è™« print(= * 50) print(FindMoney.club åšå®¢çˆ¬è™«) print(= * 50) # è·å–æ–‡ç« åˆ—è¡¨ articles = self.get_all_articles() if not articles: print(æ²¡æœ‰æ‰¾åˆ°æ–‡ç« ) return success_count = 0 fail_count = 0 for i, article in enumerate(articles, 1): title = article.get(title, æ— æ ‡é¢˜) href = article.get(href, ) print(f [i/len(articles)] æ­£åœ¨å¤„ç†: title) # è·å–æ–‡ç« è¯¦æƒ… post_data = self.get_article_content(href) if not post_data: print(f è·å–å¤±è´¥ï¼Œè·³è¿‡) fail_count += 1 continue # è½¬æ¢ä¸º Markdown markdown_content = self.notion_blocks_to_markdown(post_data) # ä¿å­˜æ–‡ä»¶ self.save_article(article, markdown_content) success_count += 1 # ç¤¼è²Œæ€§å»¶è¿Ÿï¼Œé¿å…è¯·æ±‚å¤ªé¢‘ç¹ # è¿™æ˜¯çˆ¬è™«çš„åŸºæœ¬ç¤¼ä»ªï¼Œä¸è¦ç»™å¯¹æ–¹æœåŠ¡å™¨å¤ªå¤§å‹åŠ› time.sleep(1) print( + = * 50) print(fçˆ¬å–å®Œæˆï¼æˆåŠŸ: success_count, å¤±è´¥: fail_count) print(fæ–‡ç« ä¿å­˜åœ¨: os.path.abspath(self.output_dir)) print(= * 50)if __name__ == __main__: # å¯ä»¥åœ¨è¿™é‡Œä¿®æ”¹è¾“å‡ºç›®å½• crawler = FindMoneyCrawler(output_dir=./findmoney_articles) crawler.run() ä»£ç è§£è¯»æ ¸å¿ƒé€»è¾‘ è·å–æ–‡ç« åˆ—è¡¨ï¼šè®¿é—®é¦–é¡µï¼Œä» __NEXT_DATA__ ä¸­æå– allNavPages éå†æ¯ç¯‡æ–‡ç« ï¼šæ ¹æ® URL è®¿é—®æ–‡ç« é¡µé¢ï¼Œè·å–è¯¦ç»†å†…å®¹ å†…å®¹è½¬æ¢ï¼šæŠŠ Notion çš„å—ç»“æ„è½¬æ¢ä¸º Markdown æ ¼å¼ ä¿å­˜æ–‡ä»¶ï¼šæŒ‰åˆ†ç±»åˆ›å»ºç›®å½•ï¼Œä¿å­˜ä¸º .md æ–‡ä»¶ å‡ ä¸ªå…³é”®ç‚¹æ¨¡æ‹Ÿæµè§ˆå™¨ self.session.headers.update( User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) ...,) å¾ˆå¤šç½‘ç«™ä¼šæ£€æŸ¥ User-Agent è¯·æ±‚å¤´ï¼Œå¦‚æœå‘ç°ä¸æ˜¯æ­£å¸¸æµè§ˆå™¨å°±ä¼šæ‹’ç»è®¿é—®ã€‚æ‰€ä»¥æˆ‘ä»¬è¦ä¼ªè£…æˆæµè§ˆå™¨ã€‚ é”™è¯¯å¤„ç†å’Œé‡è¯• for i in range(max_retries): try: response = self.session.get(url, timeout=30) ... except requests.RequestException as e: time.sleep(2) # ç­‰å¾…åé‡è¯• ç½‘ç»œè¯·æ±‚éš¾å…ä¼šå¤±è´¥ï¼ŒåŠ ä¸Šé‡è¯•æœºåˆ¶èƒ½æé«˜æˆåŠŸç‡ã€‚ ç¤¼è²Œæ€§å»¶è¿Ÿ time.sleep(1) # æ¯æ¬¡è¯·æ±‚åç­‰å¾…1ç§’ ä¸è¦ä¸€è‚¡è„‘åœ°ç‹‚å‘è¯·æ±‚ï¼Œç»™å¯¹æ–¹æœåŠ¡å™¨ç•™ç‚¹å–˜æ¯çš„æœºä¼šã€‚è¿™æ˜¯çˆ¬è™«çš„åŸºæœ¬ç´ å…»ã€‚ è¿è¡Œæ–¹æ³•æŠŠä»£ç ä¿å­˜ä¸º crawler.pyï¼Œç„¶ååœ¨å‘½ä»¤è¡Œè¿è¡Œï¼š python crawler.py çˆ¬å–çš„æ–‡ç« ä¼šä¿å­˜åœ¨ ./findmoney_articles ç›®å½•ä¸‹ï¼ŒæŒ‰åˆ†ç±»æ•´ç†å¥½ã€‚ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆè¢«ç½‘ç«™å°ç¦äº†æ€ä¹ˆåŠï¼Ÿ é™ä½è¯·æ±‚é¢‘ç‡ï¼ˆå¢åŠ  time.sleep çš„æ—¶é—´ï¼‰ ä½¿ç”¨ä»£ç† IP æ›´æ¢ User-Agent é¡µé¢å†…å®¹æ˜¯ JavaScript æ¸²æŸ“çš„ç”¨ Selenium æ¨¡æ‹Ÿæµè§ˆå™¨ï¼š from selenium import webdriverfrom selenium.webdriver.chrome.options import Optionsoptions = Options()options.add_argument(--headless) # æ— å¤´æ¨¡å¼ï¼Œä¸æ˜¾ç¤ºæµè§ˆå™¨çª—å£driver = webdriver.Chrome(options=options)driver.get(https://example.com)# ç­‰å¾…é¡µé¢åŠ è½½time.sleep(3)# è·å–æ¸²æŸ“åçš„ HTMLhtml = driver.page_sourcedriver.quit() ç™»å½•åæ‰èƒ½è®¿é—®çš„å†…å®¹éœ€è¦å…ˆæ¨¡æ‹Ÿç™»å½•è·å– Cookieï¼š session = requests.Session()# ç™»å½•login_data = username: your_username, password: your_passwordsession.post(https://example.com/login, data=login_data)# åç»­è¯·æ±‚è‡ªåŠ¨å¸¦ä¸Š Cookieresponse = session.get(https://example.com/protected-page) æ€»ç»“è®¾è®¡çˆ¬è™«çš„ä¸€èˆ¬æµç¨‹ï¼š åˆ†æç›®æ ‡ç½‘ç«™ï¼šç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ç ”ç©¶é¡µé¢ç»“æ„å’Œæ•°æ®æ¥æº é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼šé™æ€é¡µé¢ç”¨ requestsï¼ŒåŠ¨æ€é¡µé¢ç”¨ Selenium ç¼–å†™çˆ¬è™«é€»è¾‘ï¼šè·å–é¡µé¢ - è§£ææ•°æ® - ä¿å­˜ç»“æœ å¤„ç†å¼‚å¸¸æƒ…å†µï¼šé‡è¯•æœºåˆ¶ã€é”™è¯¯å¤„ç†ã€å»¶è¿Ÿæ§åˆ¶ è®°ä½å‡ ä¸ªåŸåˆ™ï¼š éµå®ˆç½‘ç«™çš„ robots.txt è§„åˆ™ æ§åˆ¶è¯·æ±‚é¢‘ç‡ï¼Œä¸è¦ç»™æœåŠ¡å™¨é€ æˆå‹åŠ› ä»…ç”¨äºä¸ªäººå­¦ä¹ å’Œç ”ç©¶ï¼Œä¸è¦ç”¨äºå•†ä¸šç”¨é€”æˆ–ä¾µçŠ¯ç‰ˆæƒ çˆ¬è™«æœ¬èº«æ˜¯ä¸ªä¸­æ€§çš„æŠ€æœ¯ï¼Œå…³é”®çœ‹ä½ æ€ä¹ˆç”¨å®ƒã€‚å¸Œæœ›è¿™ç¯‡ç¬”è®°èƒ½å¸®åˆ°ä½ ï¼","categories":["2.ç¼–ç¨‹è¯­è¨€","Python"]},{"title":"ç¬”è®°","path":"/2024/03/29/2-ç¼–ç¨‹è¯­è¨€-Python-ç¬”è®°/","content":"Python æ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„è§£é‡Šå‹è®¡ç®—æœºç¨‹åºè®¾è®¡è¯­è¨€ï¼Œå¯ä»¥å¤„ç†ç³»ç»Ÿè¿ç»´ã€å›¾å½¢å¤„ç†ã€æ•°å­¦å¤„ç†ã€æ–‡æœ¬å¤„ç†ã€æ•°æ®åº“ç¼–ç¨‹ã€ç½‘ç»œç¼–ç¨‹ã€web ç¼–ç¨‹ã€å¤šåª’ä½“åº”ç”¨ã€pymo å¼•æ“ã€é»‘å®¢ç¼–ç¨‹ã€çˆ¬è™«ç¼–å†™ã€æœºå™¨å­¦ä¹ ã€äººå·¥æ™ºèƒ½ç­‰ç­‰ã€‚ åŸºç¡€å…¥é—¨Python åŸºç¡€Python ç®€ä»‹Python å®‰è£…è¯­æ³•æ ¼å¼ä¸ç¼–ç è§„èŒƒPython åŒ…ç®¡ç†åŠå…¶ç‰ˆæœ¬ç®¡ç†å·¥å…·çš„ä½¿ç”¨æ¨¡å—å¯¼å…¥åœ¨ Python ä¸­ï¼Œå¯ä»¥å¯¼å…¥å„ç§æ¨¡å—æ¥æ‰©å±•åŠŸèƒ½ï¼Œä»¥ä¸‹æ˜¯å¯¼å…¥æ¨¡å—çš„å‡ ç§æ–¹å¼ï¼š å¯¼å…¥æ•´ä¸ªæ¨¡å—: import module1, module2 ä»æ¨¡å—ä¸­ä»…å¯¼å…¥ç‰¹å®šçš„å‡½æ•°ã€ç±»æˆ–å˜é‡: from modname import name1 éœ€è¦æ³¨æ„ï¼Œå¯¼å…¥çš„æ¨¡å—å¿…é¡»ä½äºå¯æ‰§è¡Œç¨‹åºçš„åŒä¸€ç›®å½•ä¸‹ï¼Œæˆ–è€…è¯¥æ¨¡å—åº”åœ¨ Python çš„ç³»ç»Ÿè·¯å¾„ä¸­ã€‚ ç±»å‹ä¸è¿ç®—ï¼ˆåŒ…æ‹¬å®¹å™¨ä»¥åŠå®¹å™¨çš„è®¿é—®ä½¿ç”¨ï¼‰Python çš„å­—ç¬¦ä¸²Listï¼Œsetï¼ŒDictï¼Œtuple ç­‰ç±»å‹ï¼ˆåŒ…æ‹¬è®¿é—®ã€æ·»åŠ ã€åˆ é™¤ç­‰è¶…ä½œï¼‰åˆ‡ç‰‡åˆ—è¡¨æ¨å€’ç”Ÿæˆå™¨è¿­ä»£å™¨å’Œè§£æè¯­å¥ä¸è¯­æ³•ä»¥åŠæ–‡ä»¶æ“ä½œå¸¸ç”¨å…³é”®å­—è¿ç®—ç¬¦å’ŒåŸºæœ¬è¿ç®—ï¼ˆä½è¿ç®—ï¼‰èµ‹å€¼ã€è¡¨è¾¾å¼ä»¥åŠè¾“å…¥è¾“å‡ºè¾“å…¥å¤„ç†ä¸é”™è¯¯æ£€æŸ¥åœ¨ Python ä¸­ï¼Œå½“é€šè¿‡ input() å‡½æ•°è¯»å–è¾“å…¥æ—¶ï¼Œå¾—åˆ°çš„æ•°æ®ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼ˆstrï¼‰ã€‚ä¾‹å¦‚ï¼Œæ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š birth = input(birth: )if birth 2000: print(00å‰)else: print(00å) å‡è®¾ç”¨æˆ·è¾“å…¥ 1982ï¼Œç¨‹åºå°†å¼•å‘å¦‚ä¸‹é”™è¯¯ï¼š Traceback (most recent call last): File stdin, line 1, in moduleTypeError: unorderable types: str() int() è¿™ä¸ªé”™è¯¯çš„åŸå› åœ¨äºå­—ç¬¦ä¸²ç±»å‹æ— æ³•ç›´æ¥ä¸æ•´æ•°è¿›è¡Œæ¯”è¾ƒã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å°†è¾“å…¥çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´å‹ï¼Œä½¿ç”¨ int() å‡½æ•°ã€‚ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼š s = input(birth: )birth = int(s)if birth 2000: print(00å‰)else: print(00å) é‡æ–°è¿è¡Œè¿™æ®µä»£ç åï¼Œå¦‚æœè¾“å…¥ 1982ï¼Œç¨‹åºä¼šæ­£ç¡®è¾“å‡º 00å‰ã€‚ä½†å¦‚æœè¾“å…¥ä¸€ä¸ªéæ•°å­—çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ abcï¼Œå°†ä¼šé‡åˆ°å¦ä¸€ä¸ªç±»å‹çš„é”™è¯¯ï¼š Traceback (most recent call last): File stdin, line 1, in moduleValueError: invalid literal for int() with base 10: abc è¿™è¡¨ç¤º int() å‡½æ•°æ— æ³•å°†å­—ç¬¦ä¸² abc è½¬æ¢ä¸ºä¸€ä¸ªæ•´æ•°ï¼Œç¨‹åºå› æ­¤å´©æºƒã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å®ç°é”™è¯¯æ£€æŸ¥æœºåˆ¶ã€‚ å¼‚å¸¸å¤„ç†Python å…è®¸ä½¿ç”¨ try è¯­å—æ¥æµ‹è¯•å¯èƒ½å‘ç”Ÿå¼‚å¸¸çš„ä»£ç ï¼Œè€Œåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä»£ç ä¼šè·³è½¬åˆ° except å—å¤„ç†ç›¸åº”çš„é”™è¯¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š try: # æµ‹è¯•è¯­å¥except [ExceptionType]: # å¤„ç†å¼‚å¸¸çš„ä»£ç  è¯­å¥æ¡ä»¶åˆ¤æ–­Python çš„æ¡ä»¶åˆ¤æ–­ä¾èµ–äºç¼©è¿›çš„è§„åˆ™ã€‚å¦‚æœ if è¯­å¥çš„æ¡ä»¶ä¸º Trueï¼Œç´§æ¥ç€çš„ç¼©è¿›è¯­å¥å°†ä¼šè¢«æ‰§è¡Œï¼›å¦‚æœæ¡ä»¶ä¸º Falseï¼Œåˆ™æ‰§è¡Œ else è¯­å¥å—ä¸­çš„å†…å®¹ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š if birth 2000: print(00å‰)else: print(00å) åŠ¡å¿…è®°å¾—åœ¨æ¡ä»¶åæ·»åŠ å†’å·ï¼ˆ:ï¼‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå½“éœ€è¦è¿›è¡Œæ›´å¤æ‚çš„æ¡ä»¶åˆ¤æ–­æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ elif è¯­å¥ï¼Œè¡¨ç¤ºâ€å¦åˆ™å¦‚æœâ€ã€‚å®Œæ•´å½¢å¼å¦‚ï¼š if condition1: action1elif condition2: action2elif condition3: action3else: action4 if è¯­å¥ä»ä¸Šåˆ°ä¸‹è¿›è¡Œåˆ¤æ–­ã€‚ä¸€æ—¦æ‰¾åˆ°ä¸€ä¸ªä¸º True çš„æ¡ä»¶ï¼Œç›¸åº”çš„åŠ¨ä½œè¢«æ‰§è¡Œåï¼Œå…¶ä½™æ¡ä»¶å°†è¢«å¿½ç•¥ã€‚ if x: print(True) åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œåªè¦ x æ˜¯éé›¶å€¼ã€éç©ºå­—ç¬¦ä¸²æˆ–éç©ºåˆ—è¡¨ï¼Œåˆ¤æ–­ç»“æœå³ä¸º Trueï¼›å¦åˆ™ä¸º Falseã€‚ å¾ªç¯å¾ªç¯ä½¿è®¡ç®—æœºèƒ½å¤Ÿé«˜æ•ˆåœ°æ‰§è¡Œé‡å¤æ€§ä»»åŠ¡ï¼ŒPython æ”¯æŒä¸¤ç§åŸºæœ¬å¾ªç¯ï¼šfor...in å¾ªç¯å’Œ while å¾ªç¯ã€‚ 1. for...in å¾ªç¯ è¿™ç§å¾ªç¯ç»“æ„ç”¨äºéå†åˆ—è¡¨æˆ–å…ƒç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚ä¾‹å¦‚ï¼š names = [Michael, Bob, Tracy]for name in names: print(name) åœ¨æ­¤ä»£ç ä¸­ï¼Œfor å¾ªç¯ä¼šå°† names åˆ—è¡¨ä¸­çš„æ¯ä¸ªåå­—ä¾æ¬¡èµ‹å€¼ç»™å˜é‡ nameï¼Œå¹¶æ‰§è¡Œç¼©è¿›ä»£ç å—ã€‚ å¦‚æœæƒ³è®¡ç®— 1 åˆ° 10 çš„æ•´æ•°ä¹‹å’Œï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š sum = 0for x in [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]: sum = sum + xprint(sum) è¦è®¡ç®—ä» 1 åˆ° 100 çš„æ•´æ•°ä¹‹å’Œï¼Œå¯ä»¥å€ŸåŠ© range() å‡½æ•°ï¼Œè¯¥å‡½æ•°ç”Ÿæˆä¸€ä¸ªæ•´æ•°åºåˆ—ï¼Œå¹¶ç”¨ list() å‡½æ•°è½¬æ¢ä¸ºåˆ—è¡¨ï¼š list(range(5)) # è¾“å‡º [0, 1, 2, 3, 4] è¦è®¡ç®— 1 åˆ° 100 çš„æ•´æ•°ä¹‹å’Œï¼Œå¯ä»¥ä½¿ç”¨ï¼š total = sum(range(101)) # è¾“å‡º 5050 2. while å¾ªç¯ while å¾ªç¯ä¼šåœ¨æ¡ä»¶ä¸ºçœŸæ—¶æŒç»­æ‰§è¡Œï¼Œæ¡ä»¶ä¸ºå‡æ—¶é€€å‡ºã€‚ä¾‹å¦‚ï¼Œæƒ³è®¡ç®— 100 ä»¥å†…æ‰€æœ‰å¥‡æ•°ä¹‹å’Œï¼Œå¯ä»¥å†™ï¼š sum = 0n = 99while n 0: sum = sum + n n = n - 2print(sum) æ­¤å¤„ï¼Œå˜é‡ n æ¯æ¬¡å¾ªç¯åéƒ½ä¼šå‡å°‘ 2ï¼Œç›´åˆ°å…¶ä¸å†æ»¡è¶³ while æ¡ä»¶ä¸ºæ­¢ã€‚ æå‰é€€å‡ºå’Œè·³è¿‡1. break è¯­å¥ break å¯ç”¨äºæå‰ç»“æŸå¾ªç¯ã€‚ä¾‹å¦‚ï¼š n = 1while n = 100: if n 10: break print(n) n = n + 1print(END) æ‰§è¡Œä¸Šè¿°ä»£ç æ—¶ï¼Œå°†æ‰“å°å‡º 1 è‡³ 10 åï¼Œç´§æ¥ç€æ˜¾ç¤º ENDï¼Œæ˜¾ç¤º break çš„æ•ˆæœæ˜¯ç«‹å³é€€å‡ºå¾ªç¯ã€‚ 2. continue è¯­å¥ continue ä½¿ç¨‹åºè·³è¿‡å½“å‰å¾ªç¯ï¼Œç›´æ¥è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ã€‚ä¾‹å¦‚ï¼Œè‹¥åªæƒ³æ‰“å° 1 åˆ° 10 ä¹‹é—´çš„å¥‡æ•°ï¼Œå¯ä»¥è¿™æ ·å¤„ç†ï¼š n = 0while n 10: n = n + 1 if n % 2 == 0: continue print(n) è¿è¡Œåï¼Œè¾“å‡ºä¸º 1, 3, 5, 7, 9ï¼Œè¡¨æ˜ continue è·³è¿‡äº†æ‰€æœ‰çš„å¶æ•°è¾“å‡ºã€‚ å‡½æ•°ä»¥åŠå‡½æ•°å¼ç¼–ç¨‹å…¥é—¨å‡½æ•°åŸºç¡€ä½œç”¨åŸŸå‚æ•°ä¸è¿”å›å€¼ï¼ˆå¤šè¿”å›å€¼ã€é»˜è®¤å‚æ•°ç­‰ï¼‰é«˜é˜¶å‡½æ•°ä¸€ä¸ªå‡½æ•°å¯ä»¥æ¥æ”¶å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™æ ·çš„å‡½æ•°è¢«ç§°ä¸ºé«˜é˜¶å‡½æ•°ã€‚é«˜é˜¶å‡½æ•°åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­å æ®ç€é‡è¦çš„åœ°ä½ï¼Œå®ƒä½¿å¾—å‡½æ•°çš„ä½¿ç”¨æ›´åŠ çµæ´»å¤šå˜ã€‚ å‡½æ•° map()map() å‡½æ•°æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„é«˜é˜¶å‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯å‡½æ•°ï¼Œå¦ä¸€ä¸ªæ˜¯å¯è¿­ä»£å¯¹è±¡ï¼ˆIterableï¼‰ã€‚map() å°†æŒ‡å®šçš„å‡½æ•°åº”ç”¨äºåºåˆ—ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œmap() è¿”å›çš„æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼ˆIteratorï¼‰ï¼Œå› æ­¤è¦æå–ç»“æœï¼Œå¿…é¡»ä½¿ç”¨ for å¾ªç¯ã€next() å‡½æ•°ï¼Œæˆ–è€…é€šè¿‡å°†å…¶è½¬æ¢ä¸ºåˆ—è¡¨ï¼ˆlistï¼‰æ¥å®ç°ã€‚ ç¤ºä¾‹ï¼š def f(x): return x * x # å®šä¹‰ä¸€ä¸ªå‡½æ•° f(x)ï¼Œè¿”å› x çš„å¹³æ–¹r = map(f, [1, 2, 3, 4, 5, 6]) # ä½¿ç”¨ map å‡½æ•°å°† f(x) åº”ç”¨äº [1, 2, 3, 4, 5, 6] åˆ—è¡¨çš„æ¯ä¸ªå…ƒç´ print(print(r), r) # ç›´æ¥æ‰“å° rï¼Œå¾—åˆ°çš„æ˜¯ r å˜é‡æŒ‡å‘çš„åœ°å€# è¾“å‡ºç¤ºä¾‹ï¼šprint(r) map object at 0x02658A30print(list(r) = , list(r)) # å°† r è½¬æ¢ä¸ºåˆ—è¡¨å¹¶æ‰“å°# è¾“å‡ºç¤ºä¾‹ï¼šlist(r) = [1, 4, 9, 16, 25, 36]# ä½¿ç”¨ for å¾ªç¯é€ä¸ªè¾“å‡ºfor n in r: print(n)# è¾“å‡ºï¼š# 1# 4# 9# 16# 25# 36 ç¤ºä¾‹æå–æ–¹å¼ ä½¿ç”¨ for å¾ªç¯è¾“å‡ºæ¯ä¸ªå…ƒç´ ï¼šå…ˆå°†ç”Ÿæˆå™¨ç”¨äº for å¾ªç¯ï¼Œé€ä¸ªæ‰“å°å‡ºå¹³æ–¹çš„ç»“æœã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸€æ—¦ç”Ÿæˆå™¨è¢«éå†åï¼Œå®ƒå°±æ— æ³•å†æ¬¡ä½¿ç”¨ã€‚ ä½¿ç”¨ next() å‡½æ•°é€ä¸ªæå–ï¼š while True: try: print(next(r)) except StopIteration as e: print(e.value) break# è¾“å‡ºï¼š# 1# 4# 9# 16# 25# 36# None å‡½æ•° reduce()reduce() å‡½æ•°ç”¨äºå°†ä¸€ä¸ªäºŒå…ƒå‡½æ•°ä½œç”¨äºä¸€ä¸ªåºåˆ—ï¼Œå¹¶é€šè¿‡é€æ­¥è¿­ä»£è®¡ç®—å‡ºæœ€ç»ˆç»“æœã€‚å®ƒéœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯å…·æœ‰ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œå¦ä¸€ä¸ªæ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚reduce() çš„å·¥ä½œæœºåˆ¶æ˜¯å°†è®¡ç®—ç»“æœä¸æ–­åœ°åº”ç”¨äºç´¯ç§¯å€¼å’Œåºåˆ—çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚ å…¬å¼ä¸ºï¼š reduce(f, [x1, x2, x3, x4]) = f(f(f(x1, x2), x3), x4) ç¤ºä¾‹ 1ï¼š from functools import reduce # éœ€è¦å¼•å…¥ functools åº“def f(x, y): return x * y # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸¤ä¸ªæ•°çš„ä¹˜ç§¯# å°†å‡½æ•° f ä½œä¸ºå‚æ•°ä¼ å…¥ reduce å‡½æ•°print(reduce(f, [1, 2, 3, 4])) # è¾“å‡ºç»“æœ# è¾“å‡ºç¤ºä¾‹ï¼š24 è§£æï¼š ç¬¬ä¸€æ­¥ï¼šè®¡ç®— f(1, 2)ï¼Œè¾“å‡ºç»“æœä¸º 1 * 2 = 2ã€‚ ç¬¬äºŒæ­¥ï¼šå°†ç¬¬ä¸€æ­¥çš„è¾“å‡ºå€¼ 2 å½“ä½œç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ‰§è¡Œ f(2, 3)ï¼Œè¾“å‡ºç»“æœä¸º 2 * 3 = 6ã€‚ ç¬¬ä¸‰æ­¥ï¼šåœ¨å‰ä¸€æ­¥çš„åŸºç¡€ä¸Šï¼Œè®¡ç®— f(6, 4)ï¼Œå¾—åˆ°ç»“æœ 6 * 4 = 24ã€‚ ç¤ºä¾‹ 2ï¼š def MySum(x, y): return x + y # å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸¤ä¸ªæ•°çš„å’Œprint(reduce(MySum, [1, 2, 3, 4, 5])) # è¾“å‡ºç»“æœä¸º 1 + 2 + 3 + 4 + 5# è¾“å‡ºç¤ºä¾‹ï¼š15 åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œreduce(MySum, [1, 2, 3, 4, 5]) çš„è®¡ç®—è¿‡ç¨‹ç›¸å½“äºï¼š 1 + 2 3 3 + 3 6 6 + 4 10 10 + 5 15 é€’å½’åŒ¿åå‡½æ•°ï¼šlambdaå‡½æ•°å¼ç¼–ç¨‹å·¥å…·ï¼šfilter å’Œ reduceæ–‡ä»¶æ“ä½œæ–‡æœ¬æ–‡ä»¶ã€äºŒè¿›åˆ¶æ–‡ä»¶è¯»å†™æ–‡ä»¶å’Œç›®å½•æ“ä½œåºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ¨¡å—ä¸é¢å‘å¯¹è±¡æ¨¡å—ä»£ç ç¼–å†™åŸºç¡€ç±»ä»£ç ç¼–å†™åŸºç¡€å¤šçº¿ç¨‹ã€Re æ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨å¤šçº¿ç¨‹Python çš„å¤šçº¿ç¨‹æŠ€æœ¯åœ¨ IO å¯†é›†å‹ä»»åŠ¡ä¸­è¡¨ç°ä¼˜è¶Šï¼Œä½†åœ¨è®¡ç®—å¯†é›†å‹ä»»åŠ¡ä¸­å´å—é™äºå…¨å±€è§£é‡Šå™¨é”çš„å½±å“ã€‚å› æ­¤ï¼Œé’ˆå¯¹ä¸åŒçš„ä»»åŠ¡ç±»å‹ï¼Œå¼€å‘è€…éœ€è¦åœ¨å¤šçº¿ç¨‹å’Œå…¶ä»–å¹¶è¡Œå¤„ç†æŠ€æœ¯ï¼ˆå¦‚ multiprocessing æ¨¡å—æˆ–å¼‚æ­¥ç¼–ç¨‹ï¼‰ä¹‹é—´åšå‡ºæ˜æ™ºçš„é€‰æ‹©ã€‚è¿™ä¼šç¡®ä¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿå¹³è¡¡æ€§èƒ½å’Œèµ„æºä½¿ç”¨ï¼Œè¾¾åˆ°æœ€ä½³æ•ˆæœã€‚ æ‰§è¡Œæ§åˆ¶æ‰§è¡Œ Python ä»£ç çš„è¿‡ç¨‹æ˜¯ç”± Python è™šæ‹Ÿæœºï¼ˆPython Virtual Machine, PVMï¼‰è´Ÿè´£çš„ã€‚åœ¨è¿™ä¸ªç¯å¢ƒä¸­ï¼Œå°½ç®¡å¯ä»¥åŒæ—¶åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œä½†å®é™…ä¸Šåœ¨ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªæ§åˆ¶çº¿ç¨‹åœ¨è¿è¡Œã€‚è¿™ç§è¡Œä¸ºæºäº Python çš„è®¾è®¡ä½¿å¾—æ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦é€šè¿‡å…¨å±€è§£é‡Šå™¨é”ï¼ˆGlobal Interpreter Lock, GILï¼‰æ¥è®¿é—®è§£é‡Šå™¨ï¼Œç¡®ä¿æ¯ä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œ Python å­—èŠ‚ç ã€‚ GIL çš„ä½œç”¨å…¨å±€è§£é‡Šå™¨é”ï¼ˆGILï¼‰æ˜¯ä¸€ä¸ªæœºåˆ¶ï¼Œç”¨äºç¡®ä¿åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œ Python å­—èŠ‚ç ã€‚è¿™ä¸ªé”é˜²æ­¢äº†çº¿ç¨‹ä¹‹é—´çš„ç«äº‰æ¡ä»¶ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æ€§èƒ½ä¸Šçš„é™åˆ¶ã€‚å…·ä½“çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š è®¾ç½® GILï¼šå½“ä¸€ä¸ªçº¿ç¨‹å‡†å¤‡æ‰§è¡Œä»£ç æ—¶ï¼Œé¦–å…ˆä¼šè·å– GILï¼Œç¡®ä¿å…¶å®ƒçº¿ç¨‹æ— æ³•æ‰§è¡Œå­—èŠ‚ç ã€‚ åˆ‡æ¢è¿›çº¿ç¨‹ï¼šä¸€æ—¦è·å¾— GILï¼Œè¯¥çº¿ç¨‹å¯ä»¥å¼€å§‹è¿è¡Œã€‚ æ‰§è¡Œä»¥ä¸‹æ“ä½œä¹‹ä¸€ï¼š è¿è¡Œä¸€ä¸ªæŒ‡å®šæ•°é‡çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œè¿™æ„å‘³ç€å®ƒä¼šæ‰§è¡Œå…·ä½“çš„ä»£ç è¡Œã€‚ çº¿ç¨‹ä¸»åŠ¨è®©å‡ºæ§åˆ¶æƒï¼Œå¦‚æœçº¿ç¨‹è¿›å…¥ä¼‘çœ æˆ–ç­‰å¾…çŠ¶æ€ã€‚ åˆ‡æ¢å‡ºçº¿ç¨‹ï¼šè‹¥çº¿ç¨‹è¯·æ±‚ IO æ“ä½œæˆ–å‡ºç°é˜»å¡ï¼Œè¿™ä¸ªçº¿ç¨‹ä¼šæ”¾å¼ƒ GILï¼Œè¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œè®©å…¶ä»–ç­‰å¾…çš„çº¿ç¨‹æœ‰æœºä¼šè¿è¡Œã€‚ è§£é” GILï¼šå®Œæˆæ‰§è¡Œåï¼Œä¼šé‡Šæ”¾ GILï¼Œå±äºå½“å‰çº¿ç¨‹çš„è¿è¡Œæ§åˆ¶æƒç»“æŸã€‚ è¿”å›æ­¥éª¤ 1ï¼šå†æ¬¡è¿›å…¥è·å– GIL çš„å¾ªç¯ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œã€‚ IO å¯†é›†å‹ä¸è®¡ç®—å¯†é›†å‹åœ¨ IO å¯†é›†å‹æ“ä½œä¸­ï¼Œå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å–ç­‰ï¼Œçº¿ç¨‹åœ¨ç­‰å¾… IO æ“ä½œå®Œæˆæ—¶ä¼šä¸»åŠ¨é‡Šæ”¾ GILã€‚è¿™æ ·ï¼Œå…¶ä»–çº¿ç¨‹ä¾¿å¯ä»¥åˆ©ç”¨è¿™æ®µæ—¶é—´æ‰§è¡Œä»–ä»¬çš„æ“ä½œï¼Œæé«˜äº†åº”ç”¨ç¨‹åºçš„æ•´ä½“æ•ˆç‡ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç­‰å¾…ä»æœåŠ¡å™¨æ¥æ”¶æ•°æ®æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥è¿›è¡Œæ–‡ä»¶å†™å…¥æˆ–è¯»å–ï¼Œä»è€Œæœ€å¤§é™åº¦åœ°æé«˜äº†èµ„æºä½¿ç”¨ç‡ã€‚ ç›¸å¯¹è€Œè¨€ï¼Œè®¡ç®—å¯†é›†å‹æ“ä½œï¼Œæ¯”å¦‚å¤§é‡çš„æ•°å­¦è®¡ç®—æˆ–æ•°æ®å¤„ç†ï¼Œç”±äºçº¿ç¨‹åœ¨æ‰§è¡Œæ—¶ä¼šæŒç»­å æœ‰ GILï¼Œå› æ­¤å³ä¾¿æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå®ƒä»¬å¹¶ä¸èƒ½æœ‰æ•ˆåœ°å¹¶è¡Œå¤„ç†ä»»åŠ¡ã€‚è¿™é€šå¸¸ä¼šå¯¼è‡´å¤šçº¿ç¨‹æ•ˆæœä¸ä½³ï¼Œåè€Œå¢åŠ äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾åœ¨è¿›è¡Œå›¾åƒå¤„ç†ä»»åŠ¡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½åœ¨è¿›è¡Œå¤æ‚çš„åƒç´ è®¡ç®—ã€‚ç”±äº GIL çš„å­˜åœ¨ï¼Œè¿™äº›çº¿ç¨‹ä¸èƒ½å……åˆ†åˆ©ç”¨å¤šæ ¸ CPU çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œæœ€ç»ˆçš„æ‰§è¡Œé€Ÿåº¦æ¯”å•çº¿ç¨‹æƒ…å†µä¸‹è¿˜è¦æ…¢ã€‚ çº¿ç¨‹æ¨¡å—threading æ¨¡å—çš„ç±»ä¸å‡½æ•° ç±»å¯¹è±¡ Threadï¼šæ‰§è¡Œçº¿ç¨‹ Timerï¼šåœ¨æŒ‡å®šæ—¶é—´åæ‰§è¡Œçº¿ç¨‹ Lockï¼šåŸå§‹é”ï¼ˆäº’æ–¥é”ï¼‰ RLockï¼šé‡å…¥é” Conditionï¼šæ¡ä»¶å˜é‡ Eventï¼šäº‹ä»¶å˜é‡ Semaphoreï¼šæ§åˆ¶åŒæ—¶æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡ BoundedSemaphoreï¼šå¸¦è¾¹ç•Œçš„ä¿¡å·é‡ Barrierï¼šæ‰€æœ‰çº¿ç¨‹åœ¨è¾¾åˆ°ä¸€å®šæ•°é‡åæ‰ç»§ç»­æ‰§è¡Œ å‡½æ•° activeCount()ï¼šè¿”å›å½“å‰æ´»åŠ¨çº¿ç¨‹æ•°é‡ currentThread()ï¼šè¿”å›å½“å‰çº¿ç¨‹å¯¹è±¡ enumerate()ï¼šè¿”å›å½“å‰æ´»åŠ¨çº¿ç¨‹çš„åˆ—è¡¨ settrace(func)ï¼šä¸ºæ‰€æœ‰çº¿ç¨‹è®¾ç½®è·Ÿè¸ªå‡½æ•° setprofile(func)ï¼šä¸ºæ‰€æœ‰çº¿ç¨‹è®¾ç½®é…ç½®æ–‡ä»¶å‡½æ•° stack_size(size=None)ï¼šè·å–æˆ–è®¾ç½®çº¿ç¨‹æ ˆçš„å¤§å° Thread ç±»çš„å±æ€§ä¸æ–¹æ³•åœ¨ threading æ¨¡å—ä¸­çš„ Thread ç±»ä¸»è¦æä¾›äº†ä¸€äº›å¸¸ç”¨çš„å±æ€§å’Œæ–¹æ³•ï¼š å±æ€§ nameï¼šçº¿ç¨‹åç§° identï¼šçº¿ç¨‹æ ‡è¯†ç¬¦ daemonï¼šæ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ æ–¹æ³• __init__(self, group=None, target=None, name=None, args=(), kwargs=None, *, daemon=None)ï¼šåˆå§‹åŒ–çº¿ç¨‹ start()ï¼šå¼€å§‹æ‰§è¡Œçº¿ç¨‹ join(timeout=None)ï¼šé˜»å¡ï¼Œç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è¶…æ—¶ is_alive()ï¼šæ£€æŸ¥çº¿ç¨‹æ˜¯å¦å­˜æ´» isDaemon()ï¼šæ£€æŸ¥çº¿ç¨‹æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ setDaemon(daemonic)ï¼šè®¾ç½®çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ ä½¿ç”¨ Threading æ¨¡å—åˆ›å»ºçº¿ç¨‹Python å¸¸ç”¨çš„å¤šçº¿ç¨‹æ¨¡å—ä¸»è¦æœ‰ threading å’Œ Queueã€‚åœ¨è¿™é‡Œï¼Œå°†é‡ç‚¹è®¨è®º threading æ¨¡å—çš„ä½¿ç”¨ã€‚ threading æ¨¡å—ä¸­çš„ Thread ç±»æ˜¯æ‰§è¡Œçº¿ç¨‹çš„ä¸»è¦å¯¹è±¡ã€‚ä½¿ç”¨ Thread ç±»ï¼Œå¯ä»¥é€šè¿‡å‡ ç§æ–¹æ³•åˆ›å»ºçº¿ç¨‹ã€‚ä»¥ä¸‹æ˜¯æœ€å¸¸ç”¨çš„ä¸‰ç§æ–¹å¼ï¼š åˆ›å»º Thread çš„å®ä¾‹ï¼Œå¹¶ä¼ é€’ç»™å®ƒä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼ˆå‡½æ•°æˆ–ç±»çš„å®ä¾‹æ–¹æ³•ï¼‰ã€‚ é€šè¿‡æ´¾ç”Ÿ Thread çš„å­ç±»ï¼Œå¹¶åˆ›å»ºå­ç±»çš„å®ä¾‹ã€‚ ä½¿ç”¨ callable ç»“åˆ args å‚æ•°ä¼ é€’é¢å¤–çš„å‚æ•°ã€‚ å¯è°ƒç”¨å¯¹è±¡ï¼ˆå‡½æ•°ï¼Œç±»çš„å®ä¾‹æ–¹æ³•ï¼‰ä½¿ç”¨å¤šçº¿ç¨‹é¦–å…ˆï¼Œä»‹ç»å¦‚ä½•åˆ›å»ºä¸€ä¸ª Thread å®ä¾‹ï¼Œå¹¶å°†å‡½æ•°ä¼ é€’ç»™å®ƒä½œä¸ºå¯è°ƒç”¨å¯¹è±¡ã€‚ä¸‹é¢æ˜¯å…·ä½“çš„å®ç°æ­¥éª¤ï¼š ç¤ºä¾‹ï¼šåˆ›å»º Thread å®ä¾‹å¹¶ä¼ é€’ç»™å®ƒä¸€ä¸ªå‡½æ•° from threading import Threadfrom time import sleep, ctimedef func(name, sec): print(---å¼€å§‹---, name, æ—¶é—´, ctime()) sleep(sec) print(***ç»“æŸ***, name, æ—¶é—´, ctime())# åˆ›å»º Thread å®ä¾‹t1 = Thread(target=func, args=(ç¬¬ä¸€ä¸ªçº¿ç¨‹, 1))t2 = Thread(target=func, args=(ç¬¬äºŒä¸ªçº¿ç¨‹, 2))# å¯åŠ¨çº¿ç¨‹è¿è¡Œt1.start()t2.start()# ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•t1.join() # join() ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢ï¼Œå¦‚æœä¸è°ƒç”¨ä¼šå¯¼è‡´ä¸»çº¿ç¨‹æŒ‚èµ·t2.join() åœ¨è¿è¡Œä¸Šè¿°ä»£ç æ—¶ï¼Œè¾“å‡ºç»“æœå¯èƒ½æ˜¯ï¼š ---å¼€å§‹--- ç¬¬ä¸€ä¸ªçº¿ç¨‹ æ—¶é—´ Fri Nov 29 11:34:31 2019---å¼€å§‹--- ç¬¬äºŒä¸ªçº¿ç¨‹ æ—¶é—´ Fri Nov 29 11:34:31 2019***ç»“æŸ*** ç¬¬ä¸€ä¸ªçº¿ç¨‹ æ—¶é—´ Fri Nov 29 11:34:32 2019***ç»“æŸ*** ç¬¬äºŒä¸ªçº¿ç¨‹ æ—¶é—´ Fri Nov 29 11:34:33 2019 é€šè¿‡è¯¥ç¤ºä¾‹å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªçº¿ç¨‹å‡ ä¹åŒæ—¶å¼€å§‹ï¼Œå°½ç®¡çº¿ç¨‹ä¸€éœ€è¦çš„æ—¶é—´çŸ­ä¸€äº›ï¼Œä½†ä»–ä»¬çš„å¼€å§‹æ—¶é—´éå¸¸æ¥è¿‘ã€‚è¿™è¡¨æ˜å¤šçº¿ç¨‹çš„ç¡®å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼ŒèŠ‚çº¦äº†æ—¶é—´ï¼Œæ€»å…±è¿è¡Œçº¦ä¸¤ç§’ï¼Œè€Œå¦‚æœæŒ‰é¡ºåºè¿è¡Œä¼šé•¿è¾¾ä¸‰ç§’ï¼ŒèŠ‚çœäº†çº¦ä¸€ç§’ã€‚ åœ¨åˆ›å»º Thread å®ä¾‹æ—¶ï¼Œéœ€è¦æ¥æ”¶ target å’Œ argsï¼ˆä¹Ÿå¯ä»¥æ˜¯ kwargsï¼‰ä¸¤ä¸ªå‚æ•°ã€‚target ç”¨äºæ¥æ”¶éœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹è°ƒç”¨çš„å¯¹è±¡ï¼Œargs ç”¨äºæ¥æ”¶è°ƒç”¨å¯¹è±¡æ‰€éœ€çš„å‚æ•°ï¼Œæ³¨æ„ args æ¥å—çš„æ˜¯å…ƒç»„ï¼Œkwargs æ¥å—çš„æ˜¯å­—å…¸ã€‚ æ³¨æ„ï¼š start() æ–¹æ³•å¯åŠ¨çº¿ç¨‹çš„æ‰§è¡Œï¼Œè€Œ join() æ–¹æ³•åˆ™ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œç›´åˆ°æ–°çº¿ç¨‹å®Œæˆæ‰§è¡Œã€‚è°ƒç”¨ join() æ˜¯å¯é€‰çš„ï¼Œåªæœ‰åœ¨éœ€è¦ç­‰å¾…çº¿ç¨‹å®Œæˆåå†è¿›è¡Œå…¶ä»–æ“ä½œæ—¶æ‰éœ€è¦ä½¿ç”¨ã€‚ æ´¾ç”Ÿ Thread çš„å­ç±»ï¼Œå¹¶åˆ›å»ºå­ç±»çš„å®ä¾‹é™¤äº†åˆ›å»ºçº¿ç¨‹çš„å®ä¾‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ç»§æ‰¿ Thread ç±»æ¥åˆ›å»ºè‡ªå®šä¹‰çº¿ç¨‹ã€‚è¿™æ ·å¯ä»¥æ›´å¥½åœ°å°è£…çº¿ç¨‹é€»è¾‘ï¼Œä¾¿åˆ©åç»­æ‰©å±•ã€‚ ç¤ºä¾‹ï¼šæ´¾ç”Ÿ Thread çš„å­ç±» from threading import Threadfrom time import sleep, ctime# åˆ›å»º Thread çš„å­ç±»class MyThread(Thread): def __init__(self, func, args): :param func: å¯è°ƒç”¨çš„å¯¹è±¡ :param args: å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•° Thread.__init__(self) # åˆ«å¿˜è®°è°ƒç”¨ Thread çš„åˆå§‹åŒ–æ–¹æ³• self.func = func self.args = args def run(self): self.func(*self.args)def func(name, sec): print(---å¼€å§‹---, name, æ—¶é—´, ctime()) sleep(sec) print(***ç»“æŸ***, name, æ—¶é—´, ctime())def main(): # åˆ›å»º Thread å®ä¾‹ t1 = MyThread(func, (1, 1)) t2 = MyThread(func, (2, 2)) # å¯åŠ¨çº¿ç¨‹è¿è¡Œ t1.start() t2.start() # ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯• t1.join() t2.join()if __name__ == __main__: main() åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ª MyThread ç±»ï¼Œå®ƒç»§æ‰¿è‡ª Threadã€‚é€šè¿‡é‡è½½ run() æ–¹æ³•ï¼Œå°†ä¼ é€’çš„å¯è°ƒç”¨å¯¹è±¡æ‰§è¡Œã€‚åœ¨ä½¿ç”¨è‡ªå®šä¹‰å­ç±»åï¼Œçº¿ç¨‹çš„é€»è¾‘æ›´åŠ æ¸…æ™°å’Œæ˜“äºç®¡ç†ã€‚ æ‹“å±•ï¼šè·å–å¯è°ƒç”¨å¯¹è±¡çš„è¿”å›å€¼åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸­ï¼Œç›´æ¥ä»å­çº¿ç¨‹ä¸­è·å–è¿”å›å€¼æ˜¯ä¸å¯è¡Œçš„ã€‚æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡åœ¨å­ç±»ä¸­æ·»åŠ å±æ€§æ¥ä¿å­˜è¿è¡Œç»“æœï¼Œå¹¶æä¾›ä¸€ä¸ªè·å–ç»“æœçš„æ–¹æ³•ã€‚ ç¤ºä¾‹ï¼šè·å–å¤šçº¿ç¨‹ä¸­ç¨‹åºè¿è¡Œçš„ç»“æœ from threading import Threadfrom time import sleep, ctime# åˆ›å»º Thread çš„å­ç±»class MyThread(Thread): def __init__(self, func, args): :param func: å¯è°ƒç”¨çš„å¯¹è±¡ :param args: å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•° Thread.__init__(self) self.func = func self.args = args self.result = None def run(self): self.result = self.func(*self.args) def getResult(self): return self.resultdef func(name, sec): print(---å¼€å§‹---, name, æ—¶é—´, ctime()) sleep(sec) print(***ç»“æŸ***, name, æ—¶é—´, ctime()) return secdef main(): # åˆ›å»º Thread å®ä¾‹ t1 = MyThread(func, (1, 1)) t2 = MyThread(func, (2, 2)) # å¯åŠ¨çº¿ç¨‹è¿è¡Œ t1.start() t2.start() # ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯• t1.join() t2.join() # è·å–çº¿ç¨‹ä¸­ç¨‹åºçš„è¿è¡Œç»“æœ print(t1.getResult()) print(t2.getResult())if __name__ == __main__: main() åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä¸º MyThread ç±»æ·»åŠ äº†ä¸€ä¸ª result å±æ€§æ¥å­˜å‚¨è¿è¡Œç»“æœï¼Œå¹¶æä¾›äº† getResult() æ–¹æ³•ä»¥ä¾›è·å–ã€‚è¿™æ ·å¯ä»¥è½»æ¾åœ°è·å–æ¯ä¸ªçº¿ç¨‹çš„æ‰§è¡Œç»“æœï¼Œä¹Ÿä¸ºä»¥åçš„æ‰©å±•ç•™å‡ºäº†ç©ºé—´ã€‚ çº¿ç¨‹åŒæ­¥çº¿ç¨‹ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆ Queueï¼‰ç½‘ç»œç¼–ç¨‹ä»€ä¹ˆæ˜¯ Socket?requests ç½‘ç»œåº“çš„ç®€ä»‹å’Œä½¿ç”¨Python å®è·µç½‘ç»œçˆ¬è™«ç½‘ç»œçˆ¬è™«æŠ€æœ¯ä»·å€¼ã€ç®€å•çš„ç½‘ç»œçˆ¬è™«æ¶æ„URI ç®¡ç†å™¨åŠå…¶å®ç°æ–¹æ³•ç½‘é¡µä¸‹è½½åŠå…¶ urllib2ã€requests çš„ä½¿ç”¨ç½‘é¡µè§£æå™¨å’Œ BeautifulSoup æ¨¡å—æ•°æ®åˆ†æä¸æœºå™¨å­¦ä¹ åº“ä»¥åŠç›¸å…³ç®—æ³•ä»‹ç»æ•°æ®åˆ†æåº“ï¼šNumpyScipyPandasæœºå™¨å­¦ä¹ åº“ï¼šScikit-Learnæ•°æ®å¯è§†åŒ–åº“ï¼šMatplotlibæ–‡æœ¬åˆ†æåº“ï¼šNLTKç½‘ç»œåˆ†æåº“ï¼šigraph","categories":["2.ç¼–ç¨‹è¯­è¨€","Python"]},{"title":"è®¾ç½®flaskåç«¯CORSè·¨åŸŸè®¿é—®","path":"/2024/03/27/2-ç¼–ç¨‹è¯­è¨€-Python-è®¾ç½®flaskåç«¯CORSè·¨åŸŸè®¿é—®/","content":"è®¾ç½®å‰åç«¯åˆ†ç¦» ç¯å¢ƒæ­å»ºflask é¡¹ç›®åœ°å€ https://tutorial.helloflask.com/ å®‰è£… flask å’Œ flask-cors cors ç”¨äºå…è®¸æœåŠ¡å™¨è¿›è¡Œè·¨åŸŸè®¿é—® pip install flaskpip install flask-cors æµè§ˆå™¨ js å‰ç«¯ä»£ç function SendUrlToServer(url, method)\tlet requestUrl = http://124.222.246.202:8081/fetch-sub-url?url=+url;\t/*let requestUrl = ?url=http://127.0.0.1:8081/fetch-sub-url*/\tfetch(requestUrl, method: method,\theaders: Content-Type: application/json\t,\t/*body: JSON.stringify( url: url )*/\t).then(response = response.text()).then(data = console.log(Response from server:);).catch(error = console.error(Error sending data:, error););function RSS() SendUrlToServer(https://rsshub.app/bilibili/ranking/0/3/1, GET); æœåŠ¡å™¨ç«¯ python ä»£ç from flask import Flask, request, jsonifyfrom flask_cors import CORSimport requestsimport feedparser##get python pathimport ospython_path = os.environ.get(PYTHONPATH)print(PYTHONPATH:, python_path)##get endapp = Flask(__name__)#CORS(app, resources=r/*: origins: http://127.0.0.1:80) # å…è®¸æŒ‡å®šçš„æ¥æºè®¿é—®CORS(app)@app.route(/fetch-sub-url, methods=[GET,POST])def fetch_sub_url(): #data = request.get_json() #url = data.get(url) #url = https://www.baidu.com url = request.args.get(url) print (current url is ===+url) try: response = requests.get(url) response_text = response.text return response_text except requests.exceptions.RequestException as e: return jsonify(error: str(e)) # è§£æRSS feed #feed = feedparser.parse(url) # æ‰“å°feedçš„æ ‡é¢˜ #print(Feed Title:, feed.feed.title) # æ‰“å°feedä¸­çš„æ¡ç›® #for entry in feed.entries: # print( Title:, entry.title) # print(Link:, entry.link) # print(description:, entry.description) #return feedif __name__ == __main__: app.run(host=0.0.0.0, port=8081) åç«¯æœåŠ¡å¼€æœºè‡ªå¯ systemdetcsystemdsystem å¯åŠ¨ [Unit]Description=Start Python BackEnd With HtmlAfter=multi-user.target[Service]WorkingDirectory=/home/ubuntuType=idle#ExecStart=/home/ubuntu/html/BackEnd/start_backend.shExecStart=/usr/bin/python3 /home/ubuntu/html/BackEnd/main.pyUser=ubuntuGroup=ubuntuEnvironment=PYTHONPATH=/home/ubuntu/.local/lib/python3.10/site-packages[Install]WantedBy=multi-user.target å°†æœåŠ¡å•å…ƒæ–‡ä»¶å¤åˆ¶åˆ° systemd ç›®å½•ï¼š å°†çš„æœåŠ¡å•å…ƒæ–‡ä»¶å¤åˆ¶åˆ°etcsystemdsystemç›®å½•ä¸‹ã€‚å¯ä»¥ä½¿ç”¨ sudo å‘½ä»¤è¿›è¡Œæ‹·è´ï¼Œç¡®ä¿æ–‡ä»¶çš„æƒé™è®¾ç½®æ­£ç¡®ã€‚ sudo cp your-service-name.service /etc/systemd/system/ é‡æ–°åŠ è½½ systemd é…ç½®ï¼š éœ€è¦é‡æ–°åŠ è½½ systemd é…ç½®ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚ sudo systemctl daemon-reload å¯ç”¨æœåŠ¡ï¼š è¦å¯ç”¨æœåŠ¡ï¼Œä½¿å…¶åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š sudo systemctl enable your-service-name.service è¿™å°†ä¼šåœ¨é€‚å½“çš„è¿è¡Œçº§åˆ«ä¸‹åˆ›å»ºç¬¦å·é“¾æ¥ï¼Œä»¥ä¾¿æœåŠ¡åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ã€‚ å¯åŠ¨æœåŠ¡ï¼š å¦‚æœæƒ³ç«‹å³å¯åŠ¨æœåŠ¡ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡ sudo systemctl start your-service-name.service å®Œæ•´åç«¯å¤„ç†ä»£ç ï¼š from flask import Flask, request, make_response, jsonifyfrom flask_cors import CORSfrom werkzeug.middleware.proxy_fix import ProxyFiximport requestsimport hashlibimport timeimport xmltodictimport osimport jsonimport socketimport asynciofrom aiohttp import web# root_dir = /home/ubuntu/html/# pic_dir = 0.res/Picture/# name = 1#request.args.get(id)# act_addr = os.path.join(root_dir,pic_dir,name);# fileNameList = # for file_name in os.listdir(act_addr):# fileNameList += pic_dir+name+/+file_name# print(fileNameList)app = Flask(__name__)app.wsgi_app = ProxyFix(app.wsgi_app)# åªå…è®¸ç‰¹å®šè·¯ç”±æ”¯æŒè·¨åŸŸè¯·æ±‚CORS(app, origins=[http://124.222.246.202,http://127.0.0.1])HOME_PATH = /home/ubuntu/BlogData/#@app.route(/, methods=[GET])#def home_index():# index_html = open(/home/ubuntu/liuluhua.github.io/index.html, r)# print (æ–‡ä»¶å: , index_html.name)# print (æ˜¯å¦å·²å…³é—­ : , index_html.closed)# print (è®¿é—®æ¨¡å¼ : , index_html.mode)# return index_html.read()@app.route(/get_ip, methods=[GET])def ip_addr(): ip_addr = request.remote_addr api_url = fhttps://ipinfo.io/ip_addr/json response = requests.get(api_url) data = response.json() ret_data = æ¥è‡ª+data.get(country)+ +data.get(region)+çš„+data.get(ip)+æœ‹å‹; return ret_data@app.route(/get_picture, methods=[GET])def picture_show(): pic_dir = 0.res/Picture/ name = request.args.get(id) act_addr = os.path.join(HOME_PATH,pic_dir,name); fileNameList = for file_name in os.listdir(act_addr): fileNameList += fimg src=pic_dirname/file_name alt=file_name print(file_name) print (fileNameList) return (fileNameList)@app.route(/getFileContent, methods=[POST])def getFileContent(): filePath = request.get_json().get(filePos) print(filePath) f = open(filePath) lines = f.read() f.close() return lines@app.route(/getFileList, methods=[POST])def getFileList(): #return json.dumps(request.get_json()) + getDirList(HOME_PATH+Python); return getDirList(HOME_PATH+Python);def getDirList(dir_path,ret_list=None,depth=0): base_list = sorted(os.scandir(dir_path),key=lambda entry: (not entry.is_dir(), entry.name)) if ret_list is None: ret_list = [] for entry in base_list: if entry.is_dir(): ret_list.append(detailssummaryspan class=tree-item) ret_list.append(entry.name+/span/summary) getDirList(entry.path, ret_list, depth+1) ret_list.append(/details) else: file_pos = dir_path.replace(/home/ubuntu/html,) ret_list.append(fdetailssummary \\ span class=tree-item onclick=openFile(\\file_pos/entry.name\\) + entry.name+/summary/details) return .join(ret_list)@app.route(/signin, methods=[POST])def signin(): print(post signin) username = request.form.get(username) password = request.form.get(password) button_clicked = request.form.get(signin) # æˆ–è€…ä½¿ç”¨ signup #jsonify(response: test) # ç¡®å®šå“ªä¸ªæŒ‰é’®è¢«ç‚¹å‡»äº† if button_clicked == signin: # å¤„ç†ç™»å½•æ“ä½œ return fLogin: Username=username, Password=password elif button_clicked == signup: # å¤„ç†æ³¨å†Œæ“ä½œ return fSignup: Username=username, Password=password else: # æ²¡æœ‰æŒ‰é’®è¢«ç‚¹å‡»æˆ–è€…æœªçŸ¥æŒ‰é’®åç§° return Unknown button pressed@app.route(/wechat, methods=[GET])def wechat_signature(): data = request.args echostr = data.get(echostr) signature = data.get(signature) timestamp = data.get(timestamp) nonce = data.get(nonce) if not signature or not timestamp or not nonce: return False tmp_str = .join(sorted([******, timestamp, nonce])) tmp_str = hashlib.sha1(tmp_str.encode(UTF-8)).hexdigest() if tmp_str == signature: return echostr else: print(Failed) return Failed@app.route(/wechat, methods=[POST])def wechat_communication(): #è·å–å¾®ä¿¡æœåŠ¡å™¨postè¿‡æ¥çš„xmlæ•°æ® xml = request.data # æŠŠxmlæ ¼å¼çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè½¬æ¢æˆå­—å…¸è¿›è¡Œå–å€¼ req = xmltodict.parse(xml)[xml] # åˆ¤æ–­postè¿‡æ¥çš„æ•°æ®ä¸­æ•°æ®ç±»å‹æ˜¯ä¸æ˜¯æ–‡æœ¬ if text == req.get(MsgType): # è·å–ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå¼€å§‹æ„é€ è¿”å›æ•°æ®ï¼ŒæŠŠç”¨æˆ·å‘é€çš„ä¿¡æ¯åŸå°ä¸åŠ¨çš„è¿”å›è¿‡å»ï¼Œå­—å…¸æ ¼å¼ resp = ToUserName:req.get(FromUserName), FromUserName:req.get(ToUserName), CreateTime:int(time.time()), MsgType:text, Content:req.get(Content) # æŠŠæ„é€ çš„å­—å…¸è½¬æ¢æˆxmlæ ¼å¼ xml = xmltodict.unparse(xml:resp) # print(req.get(Content)) # è¿”å›æ•°æ® return xml else: resp = ToUserName: req.get(FromUserName, ), FromUserName: req.get(ToUserName, ), CreateTime: int(time.time()), MsgType: text, Content: I LOVE ITCAST xml = xmltodict.unparse(xml:resp) return xmlif __name__ == __main__: app.run(host=127.0.0.1, port=9080)","categories":["2.ç¼–ç¨‹è¯­è¨€","Python"]},{"title":"èµ„æ–™","path":"/2024/03/26/2-ç¼–ç¨‹è¯­è¨€-Python-èµ„æ–™/","content":"0. GitHubGitHub æ‹¥æœ‰ä¸°å¯Œçš„å¼€æºé¡¹ç›®ï¼Œç”¨æˆ·å¯ä»¥æ‰¾åˆ°å¤§é‡çš„ Python åº“å’Œå·¥å…·ï¼Œä¾‹å¦‚ Pipenvï¼Œå®ƒèƒ½æœ‰æ•ˆåœ°ç®¡ç† Python é¡¹ç›®çš„ä¾èµ–å’Œè™šæ‹Ÿç¯å¢ƒã€‚ 1. Python Code ExamplesPython Code Examples æ˜¯ä¸€ä¸ªæå¥½çš„åœ¨çº¿èµ„æºï¼Œæä¾›å¤šç§ Python ä»£ç ç¤ºä¾‹ã€‚åœ¨è¿™ä¸ªç½‘ç«™ä¸Šï¼Œå­¦ä¹ è€…å¯ä»¥é€šè¿‡æœç´¢å…·ä½“çš„åŠŸèƒ½å®ç°ï¼Œæ‰¾åˆ°ç›¸å…³çš„ä»£ç èŒƒä¾‹è¿›è¡Œå‚è€ƒã€‚åœ¨é¢å¯¹ç‰¹å®šé—®é¢˜æ—¶ï¼ŒæŸ¥æ‰¾ç›¸å…³ç¤ºä¾‹å¹¶è¿›è¡Œæ¨¡ä»¿å¯ä»¥åŠ é€Ÿå­¦ä¹ è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼Œè‹¥æƒ³å®ç°å­—ç¬¦ä¸²çš„æ’åºï¼Œåªéœ€è¦è¾“å…¥â€string sortâ€ï¼Œå°±èƒ½æ‰¾åˆ°ä¼—å¤šç›¸å…³çš„ä»£ç ç‰‡æ®µï¼Œä»ä¸­å­¦ä¹ å’Œç†è§£å…¶ç”¨æ³•ã€‚ 2. Python ä¸­æ–‡å­¦ä¹ å¤§æœ¬è¥Pythonä¸­æ–‡å­¦ä¹ å¤§æœ¬è¥ æ˜¯ä¸€ä¸ªä¸ºä¸­æ–‡ç”¨æˆ·æä¾› Python å­¦ä¹ èµ„æ–™çš„å¹³å°ã€‚åœ¨è¿™é‡Œï¼Œèƒ½æ‰¾åˆ°ä¸°å¯Œçš„ Flask èµ„æºï¼ŒåŒ…æ‹¬ä¹¦ç±ã€è§†é¢‘æ•™ç¨‹å’Œä»£ç ç¤ºä¾‹ï¼Œå‡ ä¹æ¶µç›–äº†å­¦ä¹  Flask æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ã€‚æ— è®ºæ˜¯æƒ³å¿«é€Ÿä¸Šæ‰‹æ„å»º Web åº”ç”¨ï¼Œè¿˜æ˜¯æ·±å…¥ç†è§£ Flask çš„åº•å±‚æœºåˆ¶ï¼Œéƒ½èƒ½åœ¨è¿™ä¸ªç½‘ç«™ä¸Šæ‰¾åˆ°åˆé€‚çš„æŒ‡å—ã€‚ 3. Python Module of the Week Python 3 Module of the Week Python Module of the Week è¿™ä¸ªç³»åˆ—çš„æ–‡ç« è‡´åŠ›äºä»‹ç» Python çš„æ ‡å‡†åº“ï¼Œæ¯ä¸€ç¯‡æ–‡ç« è¯¦ç»†è®²è§£ä¸€ä¸ªæ¨¡å—çš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œcollections æ¨¡å—æä¾›äº†å¤šç§ç‰¹æ®Šçš„å®¹å™¨æ•°æ®ç±»å‹ï¼Œé€‚åˆä¸åŒçš„æ•°æ®å­˜å‚¨éœ€æ±‚ï¼Œå­¦ä¹ è¿™äº›æ¨¡å—èƒ½å¸®åŠ©æ›´é«˜æ•ˆåœ°ä½¿ç”¨ Pythonã€‚ 4. Welcome to Python for you and meWelcome to Python for you and me æ˜¯ä¸€ä¸ªä¸“ä¸ºåˆå­¦è€…è®¾è®¡çš„ç½‘ç«™ã€‚å®ƒä»¥ç®€å•æ˜“æ‡‚çš„æ–¹å¼ä»‹ç» Python çš„åŸºæœ¬è¯­æ³•ã€æ•°æ®ç»“æ„å’Œé¡¹ç›®ç»éªŒã€‚é€šè¿‡å®ä¾‹å’Œç»ƒä¹ ï¼Œåˆå­¦è€…å¯ä»¥é€æ­¥æŒæ¡ Python çš„ç²¾é«“ï¼Œæå‡ç¼–ç¨‹æŠ€èƒ½ã€‚ 5. CheckiO is a code game codersCheckiO æ˜¯ä¸€ä¸ªç‹¬ç‰¹çš„å­¦ä¹ å¹³å°ï¼Œå°†ç¼–ç¨‹ä¸æ¸¸æˆç»“åˆåœ¨ä¸€èµ·ã€‚ç”¨æˆ·åœ¨è¿™ä¸ªç½‘ç«™ä¸Šå¯ä»¥é€šè¿‡è§£å†³ä¸€ç³»åˆ—ç¼–ç¨‹æŒ‘æˆ˜æ¥æå‡è‡ªå·±çš„æŠ€èƒ½ã€‚æ¯ä¸ªå…³å¡éƒ½è¦æ±‚ç¼–å†™ä»£ç æ¥å®Œæˆç‰¹å®šä»»åŠ¡ï¼Œè¿™ç§äº’åŠ¨å­¦ä¹ æ–¹å¼ä¸ä»…æœ‰è¶£ï¼Œè¿˜èƒ½æœ‰æ•ˆæé«˜çš„é€»è¾‘æ€ç»´ä¸ç¼–ç¨‹èƒ½åŠ›ã€‚ 6. Python åŸºç¡€æ•™ç¨‹PythonåŸºç¡€æ•™ç¨‹ æ˜¯ä¸€ä¸ªå¹¿ä¸ºäººçŸ¥çš„å­¦ä¹ å¹³å°ï¼Œæä¾› Python çš„åŸºç¡€çŸ¥è¯†ã€‚å¦‚æœå®Œå…¨æ²¡æœ‰ç¼–ç¨‹ç»éªŒï¼Œå»ºè®®ä»è¿™ä¸ªç½‘ç«™å¼€å§‹ã€‚å®ƒæ¶µç›–äº† Python çš„åŸºæœ¬è¯­æ³•ã€æ•°æ®ç±»å‹ã€æ§åˆ¶ç»“æ„ç­‰å†…å®¹ï¼Œå¹¶é…æœ‰ç®€å•çš„ä¾‹å­å’Œç»ƒä¹ ï¼Œå¸®åŠ©æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚ å­¦ä¹ èµ„æº A Byte of Python: è¯¥ä¹¦æä¾› Python çš„åŸºæœ¬çŸ¥è¯†ï¼Œè¾¹å­¦ä¹ è¾¹å®è·µçš„æ–¹å¼åŠ æ·±ç†è§£ã€‚ Googleâ€™s Python Lessons: Google å‘å¸ƒçš„ Python æ•™ç¨‹ï¼Œå†…å®¹æ¸…æ™°ï¼Œéå¸¸é€‚åˆè‡ªå­¦è€…ã€‚ Python Documentation: å®˜æ–¹åœ¨çº¿æ–‡æ¡£ï¼Œé€‚åˆæ·±å…¥äº†è§£ Python å„ä¸ªæ¨¡å—åŠå…¶ä½¿ç”¨ã€‚ CS61A: SICP with Python: MIT è¯¾ç¨‹ï¼Œç»“åˆ Python æ·±å…¥æ¢è®¨è®¡ç®—æœºç§‘å­¦çš„åŸºæœ¬åŸç†ã€‚ Python Guideï¼šç”± requests çš„ä½œè€…ç¼–å†™ï¼Œå°¤å…¶åå‘è½¯ä»¶å·¥ç¨‹æ–¹é¢çš„å®è·µã€‚ Use Pythonï¼šæä¾›ä¸€äº›æ›´ä¸ºå®é™…çš„ Python ä½¿ç”¨æŠ€å·§å’Œæ¡ˆä¾‹ã€‚ Python æ ¸å¿ƒç¼–ç¨‹ï¼šå…¨é¢ä»‹ç» Python è¯­è¨€çš„å„ä¸ªæ–¹é¢ã€‚ Dive Into Pythonï¼šä¸€æœ¬å¼€æºçš„ä¼˜è´¨ä¹¦ç±ã€‚ Fluent Pythonï¼šæ·±å…¥æ¢è®¨ Python çš„é«˜çº§ä¸»é¢˜ã€‚ Python3 Cookbookï¼šæ”¶é›†äº†ä¼—å¤š Python ç¼–ç¨‹æŠ€å·§ã€‚ Python æ ¸å¿ƒç¼–ç¨‹ Python ç½‘ç»œæ•°æ®é‡‡é›† åˆ©ç”¨ Python è¿›è¡Œæ•°æ®åˆ†æ","categories":["2.ç¼–ç¨‹è¯­è¨€","Python"]},{"title":"Qtå®ç°éŸ³é¢‘ä»é‡‡é›†åˆ°ç¿»è¯‘è¾“å‡º","path":"/2024/03/25/3-å¼€å‘æ¡†æ¶-Qt-Project-Qtå®ç°éŸ³é¢‘ä»é‡‡é›†åˆ°ç¿»è¯‘è¾“å‡º/","content":"æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Qt (C++) å®ç°ä¸€ä¸ªå®Œæ•´çš„éŸ³é¢‘å¤„ç†æµæ°´çº¿ï¼š**éŸ³é¢‘é‡‡é›† - è¯­éŸ³è½¬æ–‡å­— (ASR) - æœºå™¨ç¿»è¯‘ (MT)**ã€‚æ–¹æ¡ˆæ ¸å¿ƒé‡‡ç”¨ Qt åŸç”Ÿå¤šåª’ä½“æ¨¡å—è¿›è¡ŒéŸ³é¢‘å½•åˆ¶ï¼Œå¹¶å¯¹æ¥è…¾è®¯äº‘çš„è¯­éŸ³è¯†åˆ«å’Œæœºå™¨ç¿»è¯‘ APIï¼Œå…¨æµç¨‹ä½¿ç”¨ C++ å®ç°ï¼Œé¿å…å¼•å…¥ Python ç»„ä»¶çš„å¤æ‚æ€§ã€‚ 1. ç³»ç»Ÿæ¶æ„è®¾è®¡ç³»ç»Ÿä¸»è¦åŒ…å«éŸ³é¢‘é‡‡é›†ã€ASR è¯†åˆ«ã€æœºå™¨ç¿»è¯‘ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—ã€‚æ•°æ®æµå‘æ¸…æ™°ï¼Œæ¨¡å—é—´é€šè¿‡ä¿¡å·æ§½æˆ–å›è°ƒæœºåˆ¶è§£è€¦ã€‚ æ ¸å¿ƒæµç¨‹å›¾graph LR A[éŸ³é¢‘æº] --|PCM Stream| B(Qt éŸ³é¢‘é‡‡é›†æ¨¡å—) B --|Buffer| Cæ•°æ®å¤„ç† C --|Base64 ç¼–ç | D[è…¾è®¯äº‘ ASR API] D --|ä¸­æ–‡æ–‡æœ¬| E[è…¾è®¯äº‘ MT API] E --|è‹±æ–‡æ–‡æœ¬| F[UI æ˜¾ç¤º] style B fill:#f9f,stroke:#333 style D fill:#bbf,stroke:#333 style E fill:#bbf,stroke:#333 æ¨¡å—èŒè´£ éŸ³é¢‘é‡‡é›†æ¨¡å—ï¼šåˆ©ç”¨ QAudioSource (Qt6) æˆ– QAudioInput (Qt5) é‡‡é›† PCM éŸ³é¢‘æ•°æ®ã€‚æ”¯æŒéº¦å…‹é£è¾“å…¥å’Œç³»ç»Ÿå†…å½•ï¼ˆLoopbackï¼‰ã€‚ ASR è¯†åˆ«æ¨¡å—ï¼šé€šè¿‡ HTTPS Post è¯·æ±‚è°ƒç”¨è…¾è®¯äº‘ ä¸€å¥è¯è¯†åˆ« APIï¼Œå°†éŸ³é¢‘æ•°æ®è½¬æ¢ä¸ºä¸­æ–‡æ–‡æœ¬ã€‚ æœºå™¨ç¿»è¯‘æ¨¡å—ï¼šè°ƒç”¨è…¾è®¯äº‘ æ–‡æœ¬ç¿»è¯‘ APIï¼Œå°†è¯†åˆ«åˆ°çš„ä¸­æ–‡ç¿»è¯‘ä¸ºè‹±æ–‡ã€‚ 2. ç¯å¢ƒå‡†å¤‡ä¸é…ç½®Qt æ¨¡å—ä¾èµ–åœ¨ CMakeLists.txt æˆ– .pro æ–‡ä»¶ä¸­æ·»åŠ å¿…è¦çš„æ¨¡å—æ”¯æŒï¼š # CMakeLists.txtfind_package(Qt6 REQUIRED COMPONENTS Multimedia Network)target_link_libraries(mytarget PRIVATE Qt6::Multimedia Qt6::Network) è…¾è®¯äº‘ API å‡†å¤‡ä½¿ç”¨äº‘æœåŠ¡å‰ï¼Œéœ€åœ¨è…¾è®¯äº‘æ§åˆ¶å°è·å– API å¯†é’¥ï¼š SecretId: ç”¨äºæ ‡è¯†èº«ä»½ã€‚ SecretKey: ç”¨äºç”Ÿæˆç­¾åï¼Œä¸¥ç¦ç¡¬ç¼–ç åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®é€šè¿‡ä¸´æ—¶å¯†é’¥æœåŠ¡å™¨è·å–ï¼‰ã€‚ 3. éŸ³é¢‘é‡‡é›† (Audio Acquisition)Qt Multimedia æ¨¡å—æä¾›äº†å¼ºå¤§çš„éŸ³é¢‘æ”¯æŒã€‚æˆ‘ä»¬ä¸»è¦ä½¿ç”¨ QAudioSource ç±»æ¥é‡‡é›†åŸå§‹éŸ³é¢‘æµã€‚ æ ¸å¿ƒå‚æ•°é…ç½®ä¸ºäº†è·å¾—æœ€ä½³çš„è¯†åˆ«æ•ˆæœï¼Œå¿…é¡»ä½¿ç”¨è…¾è®¯äº‘ ASR å»ºè®®çš„éŸ³é¢‘æ ¼å¼ï¼š å‚æ•° å€¼ è¯´æ˜ é‡‡æ ·ç‡ 16000 Hz è¯­éŸ³è¯†åˆ«æ ‡å‡†é‡‡æ ·ç‡ å£°é“æ•° 1 (Mono) å•å£°é“å‡å°‘æ•°æ®é‡ä¸”æ»¡è¶³éœ€æ±‚ æ ¼å¼ Int16 PCM 16ä½æœ‰ç¬¦å·æ•´å‹ (Little Endian) è®¾å¤‡é€‰æ‹©ï¼šéº¦å…‹é£ vs ç³»ç»Ÿå†…å½•å¯ä»¥é€šè¿‡éå† QMediaDevices æ¥é€‰æ‹©ç‰¹å®šè®¾å¤‡ã€‚ éº¦å…‹é£ï¼šé€šå¸¸æ˜¯ defaultAudioInput()ã€‚ ç³»ç»Ÿå†…å½•ï¼šåœ¨ Windows ä¸Šé€šå¸¸ç§°ä¸º â€œç«‹ä½“å£°æ··éŸ³ (Stereo Mix)â€ã€‚ [!TIP]ä»£ç æŠ€å·§ï¼šé€šè¿‡åˆ¤æ–­è®¾å¤‡åç§°å­—ç¬¦ä¸²ï¼ˆå¦‚ â€œMixâ€ æˆ– â€œæ··éŸ³â€ï¼‰æ¥è‡ªåŠ¨ç­›é€‰å†…å½•è®¾å¤‡ã€‚ å…³é”®ä»£ç å®ç°void AudioCapture::startCapture() // 1. åˆå§‹åŒ–éŸ³é¢‘æ ¼å¼ QAudioFormat format; format.setSampleRate(16000); format.setChannelConfig(QAudioFormat::ChannelConfigMono); format.setSampleFormat(QAudioFormat::Int16); // 2. é€‰æ‹©è¾“å…¥è®¾å¤‡ï¼ˆç¤ºä¾‹ï¼šæŸ¥æ‰¾ç«‹ä½“å£°æ··éŸ³ï¼Œæœªæ‰¾åˆ°åˆ™ç”¨é»˜è®¤ï¼‰ const auto devices = QMediaDevices::audioInputs(); QAudioDevice inputDevice = QMediaDevices::defaultAudioInput(); for (const auto device : devices) if (device.description().contains(Stereo Mix) || device.description().contains(ç«‹ä½“å£°æ··éŸ³)) inputDevice = device; break; // 3. åˆ›å»ºå½•éŸ³å¯¹è±¡ mpAudioSource = new QAudioSource(inputDevice, format, this); // 4. ç»‘å®š IO è®¾å¤‡è¯»å– // start() è¿”å›ä¸€ä¸ª QIODeviceï¼Œæˆ‘ä»¬å¯ä»¥ç›‘å¬å…¶ readyRead ä¿¡å· mpIoDevice = mpAudioSource-start(); connect(mpIoDevice, QIODevice::readyRead, this, [this]() // è¯»å–éŸ³é¢‘æ•°æ®å¹¶è¿½åŠ åˆ°ç¼“å­˜ QByteArray data = mpIoDevice-readAll(); m_audioBuffer.append(data); ); 4. äº‘ API é‰´æƒ (Signature v3)è…¾è®¯äº‘ API éœ€è¦ä¸¥æ ¼çš„é‰´æƒç­¾åï¼ˆTC3-HMAC-SHA256ï¼‰ã€‚è¿™æ˜¯å®ç°éš¾ç‚¹ä¹‹ä¸€ã€‚ ç­¾åæµç¨‹ **æ‹¼æ¥è§„èŒƒè¯·æ±‚ä¸² (CanonicalRequest)**ï¼šåŒ…å« HTTP æ–¹æ³•ã€URIã€æŸ¥è¯¢å­—ç¬¦ä¸²ã€Headers ç­‰ã€‚ **æ‹¼æ¥å¾…ç­¾åå­—ç¬¦ä¸² (StringToSign)**ï¼šåŒ…å«ç®—æ³•æ ‡è¯†ã€æ—¶é—´æˆ³ã€å‡­è¯èŒƒå›´å’Œè§„èŒƒè¯·æ±‚ä¸²çš„å“ˆå¸Œå€¼ã€‚ **è®¡ç®—ç­¾å (Signature)**ï¼šä½¿ç”¨ SecretKey æ´¾ç”Ÿå‡º SigningKeyï¼Œå¯¹ StringToSign è¿›è¡Œ HMAC-SHA256 è®¡ç®—ã€‚ æ„é€  Authorization å¤´ï¼šå°†ç­¾åç»„åˆæˆæœ€ç»ˆçš„ HTTP Headerã€‚ [!IMPORTANT]ç­¾åè®¡ç®—æ¶‰åŠå¤šæ¬¡ HMAC-SHA256 å“ˆå¸Œï¼Œå»ºè®®å°è£…ä¸€ä¸ªé€šç”¨çš„ Signer ç±»ã€‚ç¡®ä¿æ—¶é—´æˆ³ (Timestamp) ä¸æœåŠ¡å™¨æ—¶é—´è¯¯å·®ä¸è¶…è¿‡ 5 åˆ†é’Ÿã€‚ 5. è¯­éŸ³è½¬æ–‡å­— (ASR) å®ç°ä½¿ç”¨ ä¸€å¥è¯è¯†åˆ« (SentenceRecognition) æ¥å£ï¼Œé€‚ç”¨äº 60ç§’ä»¥å†…çš„çŸ­è¯­éŸ³ã€‚ è¯·æ±‚æ„é€ ä½ éœ€è¦æ„å»ºä¸€ä¸ª JSON è¯·æ±‚ä½“ï¼Œå¹¶å°†å…¶ Base64 ç¼–ç åçš„éŸ³é¢‘æ•°æ®æ”¾å…¥ Data å­—æ®µã€‚ void AsrClient::recognize(const QByteArray pcmData) // æ„å»ºè¯·æ±‚åŒ…ä½“ QJsonObject json; json[ProjectId] = 0; json[SubServiceType] = 2; // 2: å®æ—¶è¯†åˆ« json[EngSerViceType] = 16k_zh; // 16k ä¸­æ–‡æ¨¡å‹ json[SourceType] = 1; // 1: è¯­éŸ³æ•°æ®ç›´æ¥ä¼ è¾“ json[VoiceFormat] = wav; // æˆ– pcmï¼Œéœ€ä¸é‡‡é›†æ ¼å¼ä¸€è‡´ json[UsrAudioKey] = QUuid::createUuid().toString(); json[Data] = QString(pcmData.toBase64()); // éŸ³é¢‘æµ Base64 json[DataLen] = pcmData.size(); // åŸå§‹æ•°æ®é•¿åº¦ QByteArray payload = QJsonDocument(json).toJson(QJsonDocument::Compact); // å‘é€å¸¦æœ‰ç­¾åçš„ HTTPS POST è¯·æ±‚... post(https://asr.tencentcloudapi.com, SentenceRecognition, 2019-06-14, payload); 6. æœºå™¨ç¿»è¯‘ (MT) å®ç°æ‹¿åˆ° ASR è¿”å›çš„ä¸­æ–‡æ–‡æœ¬åï¼Œç´§æ¥ç€è°ƒç”¨ æ–‡æœ¬ç¿»è¯‘ (TextTranslate) æ¥å£ã€‚ ç¿»è¯‘é€»è¾‘ç¿»è¯‘æ¥å£çš„é‰´æƒé€»è¾‘ä¸ ASR å®Œå…¨ä¸€è‡´ï¼Œåªéœ€ä¿®æ”¹ Endpoint å’Œ Actionã€‚ void TmtClient::translate(const QString sourceText) QJsonObject json; json[SourceText] = sourceText; json[Source] = zh; // æºè¯­è¨€ json[Target] = en; // ç›®æ ‡è¯­è¨€ json[ProjectId] = 0; QByteArray payload = QJsonDocument(json).toJson(QJsonDocument::Compact); // å¤ç”¨ç½‘ç»œå‘é€é€»è¾‘ // Endpoint: tmt.tencentcloudapi.com // Action: TextTranslate // Version: 2018-03-21 post(https://tmt.tencentcloudapi.com, TextTranslate, 2018-03-21, payload); å“åº”å¤„ç†// å‡è®¾è¿™æ˜¯ networkManager çš„ finished æ§½å‡½æ•°void TmtClient::onReplyFinished(QNetworkReply* reply) QByteArray responseData = reply-readAll(); QJsonObject root = QJsonDocument::fromJson(responseData).object(); // è§£æå¦‚: Response - TargetText if (root.contains(Response)) QJsonObject responseObj = root[Response].toObject(); if (responseObj.contains(TargetText)) QString targetText = responseObj[TargetText].toString(); emit translationReady(targetText); // å‘é€ä¿¡å·ç»™ UI 7. é€»è¾‘æ•´åˆä¸ä¼˜åŒ–ä¸ºäº†ä¿è¯ UI æµç•…ï¼Œå»ºè®®å°†ç½‘ç»œè¯·æ±‚å’ŒéŸ³é¢‘ç¼–ç æ”¾åœ¨é UI çº¿ç¨‹å¤„ç†ï¼Œå°½ç®¡ QNetworkAccessManager æœ¬èº«æ˜¯å¼‚æ­¥çš„ï¼Œä½† Base64 ç¼–ç å¤§æ®µéŸ³é¢‘å¯èƒ½ä¼šçŸ­æš‚é˜»å¡ä¸»çº¿ç¨‹ã€‚ äº¤äº’æ—¶åºå›¾sequenceDiagram participant User participant App as Qt Application participant ASR as Tencent Cloud ASR participant MT as Tencent Cloud MT User-App: ç‚¹å‡» å¼€å§‹å½•éŸ³ App-App: QAudioSource::start() loop éŸ³é¢‘é‡‡é›† App-App: ç¼“å­˜ PCM æ•°æ® end User-App: ç‚¹å‡» åœæ­¢å¹¶ç¿»è¯‘ App-App: QAudioSource::stop() App-ASR: HTTPS POST (Audio Data) ASR--App: è¿”å›ä¸­æ–‡æ–‡æœ¬ (JSON) App-App: è§£æä¸­æ–‡ App-MT: HTTPS POST (Chinese Text) MT--App: è¿”å›è‹±æ–‡æ–‡æœ¬ (JSON) App-User: æ›´æ–° UI æ˜¾ç¤ºç»“æœ æ€§èƒ½è¯´æ˜ VAD ä¼˜åŒ–ï¼šå¦‚æœåœ¨ readyRead ä¸­åˆ†æ PCM æŒ¯å¹…å‘ç°é•¿æ—¶é—´é™éŸ³ï¼Œå¯è‡ªåŠ¨è§¦å‘åœæ­¢é€»è¾‘ï¼Œå®ç°â€œè¯´å®Œå³åœâ€çš„ä½“éªŒã€‚ WAV å¤´å¤„ç†ï¼šè™½ç„¶ API æ”¯æŒ PCMï¼Œä½†å°è£… 44 å­—èŠ‚çš„æ ‡å‡† WAV å¤´èƒ½æé«˜å…¼å®¹æ€§ï¼Œä¾¿äºè°ƒè¯•æ—¶ä¿å­˜æ–‡ä»¶æ’­æ”¾æ£€æŸ¥ã€‚ 8. å‚è€ƒæ¥æº è…¾è®¯äº‘ - ä¸€å¥è¯è¯†åˆ«æ¥å£æ–‡æ¡£ è…¾è®¯äº‘ - æ–‡æœ¬ç¿»è¯‘æ¥å£æ–‡æ¡£ Qt Documentation - QAudioSource","tags":["Qt","è…¾è®¯äº‘","ASR","æœºå™¨ç¿»è¯‘"],"categories":["3.å¼€å‘æ¡†æ¶,Qt"]},{"title":"Qtå­¦ä¹ æ¦‚è§ˆ","path":"/2024/03/21/3-å¼€å‘æ¡†æ¶-Qt-Qtå­¦ä¹ æ¦‚è§ˆ/","content":"Qt åŸºç¡€éƒ¨åˆ†Qt å…¥é—¨ç¯å¢ƒæ­å»ºåœ¨å¼€å§‹ Qt å¼€å‘ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦å®‰è£… Qt å’Œ Qt Creatorã€‚ä»¥ä¸‹æ˜¯ä¸åŒæ“ä½œç³»ç»Ÿä¸Šçš„è¯¦ç»†å®‰è£…æ­¥éª¤ï¼š Windows ç³»ç»Ÿï¼š è®¿é—® Qt å®˜æ–¹ç½‘ç«™ ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ Qt åœ¨çº¿å®‰è£…å™¨ã€‚ è¿è¡Œå®‰è£…å™¨ï¼Œé€‰æ‹©éœ€è¦å®‰è£…çš„ Qt ç‰ˆæœ¬ï¼ˆå¦‚ Qt 6.3 LTSï¼‰å’Œæ¨¡å—ï¼ˆå¦‚ Qt Desktopï¼‰ã€‚ é…ç½®å®‰è£…è·¯å¾„ï¼Œå¹¶é€‰æ‹©å®‰è£… Qt Creatorã€‚ ç­‰å¾…å®‰è£…å®Œæˆåï¼Œæ‰“å¼€ Qt Creator å¹¶é…ç½®å¼€å‘ç¯å¢ƒã€‚ macOS ç³»ç»Ÿï¼š ä¸‹è½½å¹¶å®‰è£… Qt Online Installer for macOSã€‚ æŒ‰ç…§å®‰è£…å‘å¯¼é€‰æ‹©éœ€è¦çš„ Qt ç»„ä»¶ã€‚ å®‰è£…å®Œæˆåï¼Œæ‰“å¼€ Qt Creator å¹¶è®¾ç½®å¼€å‘ç¯å¢ƒã€‚ Linux ç³»ç»Ÿï¼š ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£… Qt å’Œ Qt Creatorï¼š sudo apt-get install qt5-default qtcreator ä¹Ÿå¯ä»¥é€šè¿‡ Qt å®˜æ–¹ç½‘ç«™ä¸‹è½½ç¦»çº¿å®‰è£…åŒ…å¹¶æ‰‹åŠ¨å®‰è£…ã€‚ ç¬¬ä¸€ä¸ª Qt åº”ç”¨åˆ›å»ºä¸€ä¸ªç®€å•çš„ â€œHello Worldâ€ åº”ç”¨ï¼Œå­¦ä¹ åŸºæœ¬çš„é¡¹ç›®ç»“æ„å’Œè¿è¡Œæµç¨‹ï¼š æ‰“å¼€ Qt Creatorï¼Œé€‰æ‹© â€œæ–‡ä»¶â€ - â€œæ–°å»ºé¡¹ç›®â€ã€‚ é€‰æ‹© â€œåº”ç”¨ç¨‹åºâ€ - â€œQt Widgets åº”ç”¨ç¨‹åºâ€ã€‚ å¡«å†™é¡¹ç›®åç§°ï¼ˆå¦‚ â€œHelloWorldâ€ï¼‰å’Œé¡¹ç›®è·¯å¾„ã€‚ åœ¨ mainwindow.h ä¸­æ·»åŠ ä¸€ä¸ª QLabel æ˜¾ç¤º â€œHello Worldâ€ã€‚ ç¼–è¯‘å¹¶è¿è¡Œé¡¹ç›®ï¼ŒæŸ¥çœ‹ç»“æœã€‚ Qt å¯¹è¯æ¡†æ ‡å‡†å¯¹è¯æ¡†Qt æä¾›äº†ä¸€ç³»åˆ—æ ‡å‡†å¯¹è¯æ¡†ï¼Œå¸¸ç”¨çš„æœ‰ï¼š QMessageBoxï¼šç”¨äºæ˜¾ç¤ºæ¶ˆæ¯æ¡†ã€‚ QMessageBox::information(this, æç¤º, è¿™æ˜¯ä¸€ä¸ªä¿¡æ¯å¯¹è¯æ¡†); QFileDialogï¼šç”¨äºæ–‡ä»¶é€‰æ‹©ã€‚ QString fileName = QFileDialog::getOpenFileName(this, æ‰“å¼€æ–‡ä»¶, , æ–‡æœ¬æ–‡ä»¶ (*.txt)); QColorDialogï¼šç”¨äºé€‰æ‹©é¢œè‰²ã€‚ QColor color = QColorDialog::getColor(Qt::red, this); è‡ªå®šä¹‰å¯¹è¯æ¡†åˆ›å»ºè‡ªå®šä¹‰å¯¹è¯æ¡†çš„æ­¥éª¤å¦‚ä¸‹ï¼š ç»§æ‰¿ QDialog ç±»ï¼Œè®¾è®¡ UI ç•Œé¢ã€‚ æ·»åŠ å¿…è¦çš„æ§ä»¶ï¼ˆå¦‚æŒ‰é’®ã€è¾“å…¥æ¡†ï¼‰ã€‚ å®ç°æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼Œå¤„ç†ç”¨æˆ·è¾“å…¥ã€‚ åœ¨ä¸»çª—å£ä¸­æ˜¾ç¤ºå¯¹è¯æ¡†ï¼š MyDialog dialog(this);dialog.exec(); Qt çª—å£çª—å£ç±»å‹ ä¸»çª—å£ï¼ˆMainWindowï¼‰ï¼šåº”ç”¨ç¨‹åºçš„ä¸»ç•Œé¢ã€‚ å¯¹è¯æ¡†ï¼ˆDialogï¼‰ï¼šç”¨äºä¸´æ—¶äº¤äº’çš„çª—å£ã€‚ MDIï¼ˆå¤šæ–‡æ¡£ç•Œé¢ï¼‰ï¼šå…è®¸å¤šä¸ªå­çª—å£åœ¨ä¸»çª—å£ä¸­æ‰“å¼€ã€‚ çª—å£å±æ€§è®¾ç½®çª—å£çš„åŸºæœ¬å±æ€§ï¼š æ ‡é¢˜ï¼š setWindowTitle(æˆ‘çš„åº”ç”¨ç¨‹åº); å¤§å°ï¼š resize(800, 600); å›¾æ ‡ï¼š setWindowIcon(QIcon(icon.png)); è‡ªå®šä¹‰çª—å£éƒ¨ä»¶è‡ªå®šä¹‰æ§ä»¶é€šè¿‡ç»§æ‰¿ QWidget åˆ›å»ºè‡ªå®šä¹‰æ§ä»¶ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œç»§æ‰¿ QWidgetã€‚ åœ¨ paintEvent æ–¹æ³•ä¸­å®ç°ç»˜åˆ¶é€»è¾‘ã€‚ åœ¨ event æ–¹æ³•ä¸­å¤„ç†äº‹ä»¶ã€‚ ç»˜åˆ¶ä¸äº‹ä»¶å¤„ç† ç»˜åˆ¶ï¼š void MyWidget::paintEvent(QPaintEvent *) QPainter painter(this); painter.drawText(10, 20, Hello, World!); äº‹ä»¶å¤„ç†ï¼š void MyWidget::mousePressEvent(QMouseEvent *event) // å¤„ç†é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶ event-accept(); Qt ä¸­çº§å¸ƒå±€ç®¡ç†å¸ƒå±€ç±»å‹ å‚ç›´å¸ƒå±€ï¼ˆQVBoxLayoutï¼‰ï¼š QVBoxLayout *layout = new QVBoxLayout;layout-addWidget(button1);layout-addWidget(button2); æ°´å¹³å¸ƒå±€ï¼ˆQHBoxLayoutï¼‰ï¼š QHBoxLayout *layout = new QHBoxLayout;layout-addWidget(label);layout-addWidget(lineEdit); ç½‘æ ¼å¸ƒå±€ï¼ˆQGridLayoutï¼‰ï¼š QGridLayout *layout = new QGridLayout;layout-addWidget(button1, 0, 0);layout-addWidget(button2, 0, 1); åµŒå¥—å¸ƒå±€é€šè¿‡åµŒå¥—å¸ƒå±€å®ç°å¤æ‚ç•Œé¢ï¼š QVBoxLayout *mainLayout = new QVBoxLayout;QHBoxLayout *topLayout = new QHBoxLayout;topLayout-addWidget(label);topLayout-addWidget(lineEdit);mainLayout-addLayout(topLayout);mainLayout-addWidget(textEdit); äº‹ä»¶å¤„ç†äº‹ä»¶æ¨¡å‹Qt çš„äº‹ä»¶æ¨¡å‹åŒ…æ‹¬äº‹ä»¶çš„ç”Ÿæˆã€ä¼ é€’å’Œå¤„ç†ã€‚å¸¸è§çš„äº‹ä»¶æœ‰é¼ æ ‡äº‹ä»¶ã€é”®ç›˜äº‹ä»¶å’Œç»˜åˆ¶äº‹ä»¶ã€‚ è‡ªå®šä¹‰äº‹ä»¶ å®šä¹‰è‡ªå®šä¹‰äº‹ä»¶ç±»ï¼š class MyEvent : public QEvent public: MyEvent(int type) : QEvent(type) ; å‘é€äº‹ä»¶ï¼š QCoreApplication::postEvent(receiver, new MyEvent(MyEvent::Type)); å¤„ç†äº‹ä»¶ï¼š bool MyWidget::event(QEvent *event) if (event-type() == MyEvent::Type) // å¤„ç†è‡ªå®šä¹‰äº‹ä»¶ return true; return QWidget::event(event); äºŒç»´ç»˜å›¾QPainter ä½¿ç”¨ä½¿ç”¨ QPainter ç»˜åˆ¶åŸºæœ¬å½¢çŠ¶å’Œæ–‡æœ¬ï¼š void MyWidget::paintEvent(QPaintEvent *) QPainter painter(this); painter.setBrush(Qt::blue); painter.drawRect(10, 10, 100, 100); painter.setPen(Qt::red); painter.drawText(20, 20, Hello, World!); å›¾å½¢è§†å›¾æ¡†æ¶ä½¿ç”¨ QGraphicsView å’Œ QGraphicsScene è¿›è¡Œå¤æ‚å›¾å½¢ç»˜åˆ¶ï¼š QGraphicsScene scene;scene.addRect(10, 10, 100, 100);QGraphicsView view(scene);view.show(); å®¹å™¨æ ‡å‡†å®¹å™¨ç±» QListï¼š QListQString list;list Apple Banana; QMapï¼š QMapQString, int map;map[Apple] = 5; QSetï¼š QSetint set;set 1 2 3; æ¨¡å‹è§†å›¾æ¶æ„å°†æ•°æ®ä¸ UI åˆ†ç¦»ï¼š QStringListModel model;model.setStringList(list);QListView view;view.setModel(model); æ•°æ®åº“Qt SQL æ¨¡å—ä½¿ç”¨ QSqlDatabase å’Œ QSqlQuery è¿›è¡Œæ•°æ®åº“æ“ä½œï¼š QSqlDatabase db = QSqlDatabase::addDatabase(QSQLITE);db.setDatabaseName(example.db);QSqlQuery query;query.exec(SELECT * FROM table); æ•°æ®æ¨¡å‹ä¸è§†å›¾ç»‘å®šå°†æ•°æ®åº“æ•°æ®ä¸ UI ç»„ä»¶ç»‘å®šï¼š QSqlTableModel model;model.setTable(table);QTableView view;view.setModel(model); å¤šçº¿ç¨‹Qt çº¿ç¨‹ç±»ä½¿ç”¨ QThread åˆ›å»ºå’Œç®¡ç†çº¿ç¨‹ï¼š class MyThread : public QThread void run() override // çº¿ç¨‹æ‰§è¡Œçš„ä»£ç  ;MyThread thread;thread.start(); çº¿ç¨‹é—´é€šä¿¡ä½¿ç”¨ä¿¡å·ä¸æ§½è¿›è¡Œæ•°æ®ä¼ é€’ï¼š class MyThread : public QThread Q_OBJECTpublic: void run() override emit send_data(Hello from thread); signals: void send_data(const QString data);; ç½‘ç»œç½‘ç»œç¼–ç¨‹åŸºç¡€ä½¿ç”¨ QNetworkAccessManager è¿›è¡Œ HTTP è¯·æ±‚ï¼š QNetworkAccessManager *manager = new QNetworkAccessManager(this);connect(manager, QNetworkAccessManager::finished, this, MyClass::replyFinished);manager-get(QNetworkRequest(QUrl(http://example.com))); TCPIP é€šä¿¡å®ç°åŸºæœ¬çš„ TCP å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼š // å®¢æˆ·ç«¯QTcpSocket socket;socket.connectToHost(localhost, 8080);socket.write(Hello, Server); // æœåŠ¡å™¨QTcpServer server;server.listen(QHostAddress::Any, 8080);connect(server, QTcpServer::newConnection, this, MyClass::handleConnection); Qt é«˜çº§å›½é™…åŒ– ç¿»è¯‘å·¥å…·ï¼šQt æä¾›äº† Qt Linguist å·¥å…·æ¥å¤„ç†ç¿»è¯‘æ–‡ä»¶ï¼Œæ”¯æŒ .tsï¼ˆç¿»è¯‘æºæ–‡ä»¶ï¼‰å’Œ .qmï¼ˆç¼–è¯‘åçš„ç¿»è¯‘æ–‡ä»¶ï¼‰æ ¼å¼ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡ Qt Linguist æ·»åŠ ã€ç¼–è¾‘ç¿»è¯‘å†…å®¹ï¼Œå¹¶å¯¼å‡ºä¸º .qm æ–‡ä»¶ä¾›åº”ç”¨åŠ è½½ã€‚ä¾‹å¦‚ï¼Œå¼€å‘è€…å¯ä»¥å°†ç•Œé¢ä¸­çš„æ–‡æœ¬å­—ç¬¦ä¸²æå–åˆ° .ts æ–‡ä»¶ä¸­ï¼Œç”±ç¿»è¯‘äººå‘˜è¿›è¡Œç¿»è¯‘ï¼Œç„¶åç¼–è¯‘æˆ .qm æ–‡ä»¶ï¼Œæœ€ååœ¨åº”ç”¨ä¸­åŠ è½½ç›¸åº”çš„ç¿»è¯‘æ–‡ä»¶ä»¥å®ç°å¤šè¯­è¨€æ”¯æŒã€‚ è¯­è¨€åˆ‡æ¢æœºåˆ¶ï¼šåœ¨ Qt åº”ç”¨ä¸­ï¼Œå¯ä»¥é€šè¿‡ QLocale ç±»è®¾ç½®åº”ç”¨çš„è¯­è¨€ç¯å¢ƒï¼Œå¹¶ä½¿ç”¨ QTranslator ç±»åŠ è½½ä¸åŒçš„ç¿»è¯‘æ–‡ä»¶æ¥å®ç°åŠ¨æ€è¯­è¨€åˆ‡æ¢ã€‚ä¾‹å¦‚ï¼Œå¼€å‘è€…å¯ä»¥åœ¨åº”ç”¨åˆå§‹åŒ–æ—¶æ£€æµ‹ç³»ç»Ÿè¯­è¨€ï¼Œæˆ–è€…æä¾›ä¸€ä¸ªè¯­è¨€é€‰æ‹©ç•Œé¢ï¼Œè®©ç”¨æˆ·é€‰æ‹©è¯­è¨€ï¼Œç„¶åé€šè¿‡åŠ è½½å¯¹åº”çš„ .qm æ–‡ä»¶æ¥åˆ‡æ¢ç•Œé¢è¯­è¨€ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š #include QApplication#include QTranslator#include QLocaleint main(int argc, char *argv[]) QApplication app(argc, argv); QTranslator translator; // æ ¹æ®ç³»ç»Ÿè¯­è¨€åŠ è½½ç¿»è¯‘æ–‡ä»¶ translator.load(app_ + QLocale::system().name()); app.installTranslator(translator); // æ˜¾ç¤ºä¸»çª—å£ MainWindow window; window.show(); return app.exec(); è‡ªå®šä¹‰æ ·å¼ æ ·å¼è¡¨ï¼ˆQSSï¼‰ï¼šQt æ ·å¼è¡¨ï¼ˆQSSï¼ŒQt Style Sheetsï¼‰æ˜¯ä¸€ç§ç±»ä¼¼ CSS çš„è¯­è¨€ï¼Œç”¨äºè‡ªå®šä¹‰æ§ä»¶çš„å¤–è§‚ã€‚é€šè¿‡åœ¨åº”ç”¨ä¸­åŠ è½½ QSS æ–‡ä»¶ï¼Œå¼€å‘è€…å¯ä»¥ç»Ÿä¸€è®¾ç½®æ§ä»¶çš„å­—ä½“ã€é¢œè‰²ã€è¾¹è·ç­‰æ ·å¼ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ QSS ä»£ç è‡ªå®šä¹‰æŒ‰é’®çš„æ ·å¼ï¼š QPushButton background-color: #4CAF50; color: white; padding: 10px; border: none; border-radius: 5px;QPushButton:hover background-color: #45a049; å°†ä¸Šè¿°ä»£ç ä¿å­˜ä¸º styles.qss æ–‡ä»¶ï¼Œå¹¶åœ¨åº”ç”¨ä¸­åŠ è½½ï¼š app.setStyleSheet(QPushButton background-color: #4CAF50; color: white; padding: 10px; border: none; border-radius: 5px; ); åˆ›å»ºè‡ªå®šä¹‰æ ·å¼ï¼šé™¤äº†ä½¿ç”¨ QSSï¼Œå¼€å‘è€…è¿˜å¯ä»¥é€šè¿‡ç»§æ‰¿ QStyle ç±»æ¥åˆ›å»ºå®Œå…¨è‡ªå®šä¹‰çš„æ§ä»¶æ ·å¼ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è‡ªå®šä¹‰æŒ‰é’®çš„å¤–è§‚å’Œè¡Œä¸ºï¼š #include QApplication#include QStyle#include QPainterclass CustomStyle : public QStyle public: CustomStyle() : QStyle() void drawControl(ControlElement element, const QStyleOption option, QPainter *painter, const QWidget *widget) const override if (element == CE_PushButton) // è‡ªå®šä¹‰æŒ‰é’®çš„ç»˜åˆ¶é€»è¾‘ painter-save(); painter-setRenderHint(QPainter::Antialiasing); painter-setPen(Qt::NoPen); painter-setBrush(Qt::green); painter-drawRoundedRect(option.rect, 5, 5); painter-restore(); else QStyle::drawControl(element, option, painter, widget); ;int main(int argc, char *argv[]) QApplication app(argc, argv); app.setStyle(new CustomStyle()); QPushButton button(Custom Button); button.show(); return app.exec(); ä¸‰ç»´ç»˜å›¾ Qt 3D æ¨¡å—ï¼šQt 3D æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºå’Œæ¸²æŸ“ä¸‰ç»´åœºæ™¯çš„æ¨¡å—ï¼Œæä¾›äº†å®æ—¶æ¸²æŸ“ã€åŠ¨ç”»ã€ç²’å­æ•ˆæœç­‰åŠŸèƒ½ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡ Qt 3D åˆ›å»ºå¤æ‚çš„ä¸‰ç»´åœºæ™¯ï¼Œå¹¶ä¸ Qt GUI æ— ç¼é›†æˆã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ä¸‰ç»´åœºæ™¯ï¼š #include Qt3DCore/QEntity#include Qt3DRender/QCamera#include Qt3DRender/QLight#include Qt3DExtras/QOrbitCameraController#include Qt3DCore/QTransform#include Qt3DRender/QMaterial#include Qt3DRender/QGeometry#include Qt3DRender/QBuffer#include Qt3DRender/QAttributeint main() // åˆ›å»ºä¸»å®ä½“ Qt3DCore::QEntity *scene = new Qt3DCore::QEntity; // åˆ›å»ºç›¸æœº Qt3DRender::QCamera *camera = scene-addComponent(new Qt3DRender::QCamera); camera-setPosition(QVector3D(0.0f, 0.0f, 5.0f)); camera-setUpVector(QVector3D(0.0f, 1.0f, 0.0f)); camera-setViewCenter(QVector3D(0.0f, 0.0f, 0.0f)); // åˆ›å»ºç¯å…‰ Qt3DCore::QEntity *lightEntity = new Qt3DCore::QEntity(scene); Qt3DRender::QLight *light = new Qt3DRender::QLight(lightEntity); light-setColor(Qt::white); light-setPosition(QVector3D(5.0f, 5.0f, 5.0f)); // åˆ›å»ºç«‹æ–¹ä½“ Qt3DCore::QEntity *cubeEntity = new Qt3DCore::QEntity(scene); Qt3DRender::QGeometry *geometry = new Qt3DRender::QGeometry(cubeEntity); Qt3DRender::QBuffer *vertexBuffer = new Qt3DRender::QBuffer(geometry); QByteArray vertexData = attribute vec3 aPosition; void main() gl_Position = aPosition; ; vertexBuffer-setData(vertexData); Qt3DRender::QAttribute *positionAttribute = new Qt3DRender::QAttribute(geometry); positionAttribute-setName(Qt3DRender::QAttribute::defaultPositionAttributeName()); positionAttribute-setBuffer(vertexBuffer); positionAttribute-setVertexBaseType(Qt3DRender::QAttribute::Float); positionAttribute-setVertexSize(3); geometry-addAttribute(positionAttribute); Qt3DRender::QMaterial *material = new Qt3DRender::QMaterial(cubeEntity); material-setEffect(new Qt3DRender::QEffect); cubeEntity-addComponent(geometry); cubeEntity-addComponent(material); // åˆ›å»ºæ¸²æŸ“çª—å£ Qt3DExtras::QOrbitCameraController *cameraController = new Qt3DExtras::QOrbitCameraController(); cameraController-setCamera(camera); cameraController-setLinearSpeed(5.0f); cameraController-setLookSpeed(100.0f); Qt3DExtras::Qt3DWindow view; view.setRootEntity(scene); view.setCamera(camera); view.show(); return app.exec(); ç‰©ç†å¼•æ“é›†æˆï¼šQt 3D æ”¯æŒä¸ç‰©ç†å¼•æ“ï¼ˆå¦‚ PhysXï¼‰é›†æˆï¼Œä»¥å®ç°çœŸå®çš„ç‰©ç†æ¨¡æ‹Ÿæ•ˆæœã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ä¸‰ç»´åœºæ™¯ä¸­æ·»åŠ åˆšä½“ã€ç¢°æ’ä½“å’Œçº¦æŸï¼Œä»¥æ¨¡æ‹Ÿç‰©ä½“çš„ç‰©ç†è¡Œä¸ºã€‚ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•åœ¨ Qt 3D ä¸­æ·»åŠ ä¸€ä¸ªç‰©ç†ä½“ï¼š #include Qt3DCore/QEntity#include Qt3DPhysics/Qt3DPhysicsint main() // åˆ›å»ºä¸»å®ä½“ Qt3DCore::QEntity *scene = new Qt3DCore::QEntity; // åˆå§‹åŒ–ç‰©ç†å¼•æ“ Qt3DPhysics::QPhysicsManager *physicsManager = new Qt3DPhysics::QPhysicsManager(scene); physicsManager-setGravity(QVector3D(0.0f, -9.8f, 0.0f)); // åˆ›å»ºä¸€ä¸ªç‰©ç†ä½“ Qt3DCore::QEntity *physicsEntity = new Qt3DCore::QEntity(scene); Qt3DPhysics::QPhysicsBody *physicsBody = new Qt3DPhysics::QPhysicsBody(physicsEntity); physicsBody-setMass(1.0f); physicsBody-setLinearDamping(0.5f); physicsBody-setAngularDamping(0.5f); // æ·»åŠ ç¢°æ’ä½“ Qt3DPhysics::QCollisionShape *collisionShape = new Qt3DPhysics::QCollisionShape(physicsEntity); collisionShape-setShape(new Qt3DPhysics::QSphereShape(1.0f)); physicsEntity-addComponent(physicsBody); physicsEntity-addComponent(collisionShape); // å°†ç‰©ç†ä½“æ·»åŠ åˆ°åœºæ™¯ä¸­ scene-addComponent(physicsManager); // æ˜¾ç¤ºåœºæ™¯ Qt3DExtras::Qt3DWindow view; view.setRootEntity(scene); view.show(); return app.exec(); åˆ›å»ºæ’ä»¶ æ’ä»¶æ¶æ„æ¦‚è¿°ï¼šQt æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æ’ä»¶æœºåˆ¶ï¼Œå…è®¸å¼€å‘è€…å°†åº”ç”¨ç¨‹åºåŠŸèƒ½æ¨¡å—åŒ–ã€‚æ’ä»¶å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½å’Œå¸è½½ï¼Œä»è€Œæ— éœ€é‡æ–°ç¼–è¯‘ä¸»åº”ç”¨ç¨‹åºå³å¯æ‰©å±•åŠŸèƒ½ã€‚Qt æ’ä»¶é€šå¸¸åŒ…å«ä¸€ä¸ªæ¥å£ç±»å’Œå®ç°ç±»ï¼Œé€šè¿‡ Q_PLUGIN_METADATA å®è¿›è¡Œæ³¨å†Œã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„æ’ä»¶æ¥å£ï¼š #ifndef MYPLUGIN_INTERFACE_H#define MYPLUGIN_INTERFACE_H#include QObjectclass MyPluginInterface : public QObject Q_OBJECTpublic: virtual ~MyPluginInterface() virtual void doSomething() = 0;;#define MyPluginInterface_iid org.qt-project.MyPluginInterfaceQ_DECLARE_INTERFACE(MyPluginInterface, MyPluginInterface_iid)#endif // MYPLUGIN_INTERFACE_H å¼€å‘ä¸åŠ è½½æ’ä»¶ï¼šå¼€å‘è€…å¯ä»¥é€šè¿‡ç»§æ‰¿æ’ä»¶æ¥å£å¹¶å®ç°å…·ä½“åŠŸèƒ½æ¥åˆ›å»ºæ’ä»¶ã€‚æ’ä»¶éœ€è¦åœ¨ .pro æ–‡ä»¶ä¸­ä½¿ç”¨ TEMPLATE = lib å’Œ CONFIG += plugin è¿›è¡Œé…ç½®ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„æ’ä»¶å®ç°ç¤ºä¾‹ï¼š #include myplugininterface.h#include QObjectclass MyPlugin : public MyPluginInterface Q_OBJECT Q_PLUGIN_METADATA(IID MyPluginInterface_iid FILE myplugin.json)public: MyPlugin(QObject *parent = nullptr) : QObject(parent) ~MyPlugin() void doSomething() override qDebug() Plugin: Doing something...; ; åœ¨ä¸»åº”ç”¨ç¨‹åºä¸­ï¼Œå¯ä»¥é€šè¿‡ QPluginLoader åŠ è½½æ’ä»¶å¹¶è°ƒç”¨å…¶åŠŸèƒ½ï¼š #include QApplication#include QPluginLoader#include myplugininterface.hint main(int argc, char *argv[]) QApplication app(argc, argv); QPluginLoader loader(path/to/myplugin.so); QObject *plugin = loader.instance(); MyPluginInterface *interface = qobject_castMyPluginInterface*(plugin); if (interface) interface-doSomething(); return app.exec(); åµŒå…¥å¼ç¼–ç¨‹ åµŒå…¥å¼å¹³å°æ”¯æŒï¼šQt æä¾›äº†å¯¹å¤šç§åµŒå…¥å¼å¹³å°çš„æ”¯æŒï¼Œå¦‚ Raspberry Piã€BeagleBone ç­‰ã€‚å¼€å‘è€…å¯ä»¥ä½¿ç”¨ Qt åˆ›å»ºé«˜æ€§èƒ½çš„åµŒå…¥å¼ GUI åº”ç”¨ç¨‹åºï¼Œå¹¶é€šè¿‡ Qt Creator çš„è·¨å¹³å°ç¼–è¯‘å·¥å…·é“¾è¿›è¡Œäº¤å‰ç¼–è¯‘ã€‚ä¾‹å¦‚ï¼Œåœ¨ Raspberry Pi ä¸Šè¿è¡Œ Qt åº”ç”¨ç¨‹åºï¼Œéœ€è¦åœ¨ .pro æ–‡ä»¶ä¸­é…ç½®äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼š # é…ç½®äº¤å‰ç¼–è¯‘å™¨CC = /path/to/gccCXX = /path/to/g++# é…ç½®ç›®æ ‡æœºå™¨çš„ç¯å¢ƒTARGET = myappTEMPLATE = appQT += core gui ä¼˜åŒ–ä¸è°ƒè¯•æŠ€å·§ï¼šåœ¨åµŒå…¥å¼ç¯å¢ƒä¸­ï¼Œä¼˜åŒ–å’Œè°ƒè¯•æ˜¯éå¸¸é‡è¦çš„ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•ä¼˜åŒ–æ€§èƒ½ï¼š ç¡¬ä»¶åŠ é€Ÿï¼šåˆ©ç”¨ GPU åŠ é€Ÿæ¸²æŸ“ï¼Œé€šè¿‡åœ¨ .pro æ–‡ä»¶ä¸­å¯ç”¨ QT += quickã€‚ ä¼˜åŒ–ç¼–è¯‘é€‰é¡¹ï¼šåœ¨ .pro æ–‡ä»¶ä¸­æ·»åŠ  CONFIG += release ä»¥å¯ç”¨å‘å¸ƒæ¨¡å¼ï¼Œç¦ç”¨è°ƒè¯•ä¿¡æ¯ã€‚ å‡å°‘èµ„æºä½¿ç”¨ï¼šä¼˜åŒ–å›¾åƒå’ŒéŸ³é¢‘èµ„æºï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚ è°ƒè¯•æŠ€å·§ï¼š ä½¿ç”¨ gdb è¿›è¡Œè¿œç¨‹è°ƒè¯•ã€‚ é€šè¿‡ä¸²å£æˆ– SSH è¿æ¥åˆ°ç›®æ ‡è®¾å¤‡è¿›è¡Œæ—¥å¿—è¾“å‡ºå’Œè°ƒè¯•ã€‚ ä½¿ç”¨ Qt Creator çš„å†…ç½®è°ƒè¯•å·¥å…·è¿›è¡Œç¬¦å·çº§è°ƒè¯•ã€‚ é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œå¼€å‘è€…å¯ä»¥é«˜æ•ˆåœ°å¼€å‘å’Œè°ƒè¯•åµŒå…¥å¼ Qt åº”ç”¨ç¨‹åºã€‚","categories":["3.å¼€å‘æ¡†æ¶","Qt"]},{"title":"Qt çº¿ç¨‹ç®¡ç†ï¼šQThread çš„å¤šé¢åº”ç”¨","path":"/2024/03/18/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qt-çº¿ç¨‹ç®¡ç†/","content":"Qt çº¿ç¨‹ç®¡ç†ï¼šä» QThread åˆ° QThreadPoolåœ¨ Qt ä¸­ï¼Œå¤šçº¿ç¨‹å¼€å‘ä¸»è¦å›´ç»• QThreadï¼ˆåº•å±‚æ§åˆ¶ï¼‰å’Œ QThreadPoolï¼ˆæ•ˆç‡å¤ç”¨ï¼‰å±•å¼€ã€‚ QThreadï¼šæ‰‹åŠ¨ç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼Œé€‚ç”¨äºå¸¸é©»åå°ä»»åŠ¡ã€‚ QThreadPoolï¼šè‡ªåŠ¨ç®¡ç†çº¿ç¨‹æ± ï¼Œé€‚ç”¨äºå¤§é‡çŸ­æ—¶ã€å¹¶è¡Œçš„è€—æ—¶ä»»åŠ¡ã€‚ ä¸‰ç§å®ç°æ–¹æ¡ˆå¯¹æ¯” ç‰¹æ€§ moveToThread (æ¨è) å­ç±»åŒ– QThread çº¿ç¨‹æ±  (QThreadPool) ç”Ÿå‘½å‘¨æœŸ æ‰‹åŠ¨ç®¡ç† æ‰‹åŠ¨ç®¡ç† è‡ªåŠ¨å›æ”¶ å¼€é”€ è¾ƒé«˜ (æ¯ä»»åŠ¡ä¸€çº¿ç¨‹) è¾ƒé«˜ æä½ (çº¿ç¨‹å¤ç”¨) è§£è€¦åº¦ æé«˜ ä½ é«˜ é€‚ç”¨åœºæ™¯ ç½‘ç»œé€šä¿¡ã€å¸¸é©»ç›‘æ§ åº•å±‚æ§åˆ¶ã€æ­»å¾ªç¯ æ‰«æä»»åŠ¡ã€é«˜å¹¶å‘è®¡ç®— ä¸€ã€ çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸä¸æ§åˆ¶ (QThread)1. å¯åŠ¨ä¸é€€å‡º start()ï¼šå¯åŠ¨çº¿ç¨‹ï¼Œè§¦å‘ started() ä¿¡å·ã€‚ exit(int) quit()ï¼šå‘Šè¯‰çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯é€€å‡ºã€‚ terminate()ï¼šå±é™©æ“ä½œï¼ å¼ºåˆ¶ç»ˆæ­¢çº¿ç¨‹ï¼Œå¯èƒ½å¯¼è‡´èµ„æºæœªé‡Šæ”¾æˆ–æ­»é”ã€‚ 2. çŠ¶æ€ä¸å†…å­˜ isRunning() isFinished()ï¼šæŸ¥è¯¢çŠ¶æ€ã€‚ wait()ï¼šé˜»å¡ç­‰å¾…çº¿ç¨‹ç»“æŸã€‚ è‡ªåŠ¨é‡Šæ”¾ï¼šå»ºè®® connect(thread, QThread::finished, thread, QObject::deleteLater); äºŒã€ æ–¹æ¡ˆä¸€ï¼šmoveToThread (æ¨è)æ ¸å¿ƒæ€æƒ³ï¼šé€šè¿‡ moveToThread å°†é€»è¾‘ç±»ï¼ˆWorkerï¼‰æ¨å‘æŒ‡å®šçš„ QThreadã€‚ // åœ¨æ§åˆ¶å™¨ä¸­åº”ç”¨Worker *worker = new Worker;worker-moveToThread(workerThread); connect(workerThread, QThread::finished, worker, QObject::deleteLater);connect(this, Controller::operate, worker, Worker::doWork);workerThread.start(); ä¸‰ã€ æ–¹æ¡ˆäºŒï¼šå­ç±»åŒ– QThread (ä¼ ç»Ÿ)æ ¸å¿ƒæ€æƒ³ï¼šé‡å†™ run() å‡½æ•°ã€‚æ³¨æ„ï¼šQThread å¯¹è±¡æœ¬èº«åœ¨æ—§çº¿ç¨‹ï¼Œåªæœ‰ run() å†…éƒ¨åœ¨æ–°çº¿ç¨‹ã€‚ class WorkerThread : public QThread void run() override // æ–°çº¿ç¨‹æ‰§è¡Œé€»è¾‘ emit resultReady(done); exec(); // å¼€å¯äº‹ä»¶å¾ªç¯ ; å››ã€ æŠ€æœ¯æ·±ç©¶ï¼šäº‹ä»¶å¾ªç¯ä¸å¼‚æ­¥é€šçŸ¥1. è·¨çº¿ç¨‹ä¿¡å·æ§½Qt é»˜è®¤ä½¿ç”¨ Queued Connectionï¼šä¿¡å·å‘é€åå…¥é˜Ÿï¼Œæ¥æ”¶è€…åœ¨è‡ªå·±çš„çº¿ç¨‹å¾ªç¯ä¸­å¼‚æ­¥æ‰§è¡Œæ§½å‡½æ•°ã€‚ 2. é«˜é¢‘æ•°æ®é€šçŸ¥å¯¹äºé«˜å¹¶å‘é‡‡é›†ï¼Œå¯ç»“åˆ QWaitCondition ä¸ QApplication::postEvent() å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œå¹³è¡¡é‡‡é›†ä¸å¤„ç†çš„å‹åŠ›ã€‚ äº”ã€ æ–¹æ¡ˆä¸‰ï¼šçº¿ç¨‹æ±  (QThreadPool)æ ¸å¿ƒæ€æƒ³ï¼šåœ¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºä¸€ç»„çº¿ç¨‹é‡å¤ä½¿ç”¨ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯çº¿ç¨‹çš„ç³»ç»Ÿå¼€é”€ã€‚ 1. æ ¸å¿ƒç”¨æ³•ï¼šQRunnableè¦ä½¿ç”¨çº¿ç¨‹æ± ï¼Œéœ€è¦å­ç±»åŒ– QRunnable å¹¶å®ç° run()ã€‚ class MyTask : public QRunnable void run() override qDebug() ä»»åŠ¡åœ¨çº¿ç¨‹ QThread::currentThreadId() è¿è¡Œ; ;// æäº¤ä»»åŠ¡QThreadPool::globalInstance()-start(new MyTask()); 2. ç®¡ç†ä¸ä¼˜åŒ– å…¨å…¨å±€å®ä¾‹ï¼šQThreadPool::globalInstance() è®¿é—®é¢„å®šä¹‰çš„å…¨å±€æ± ã€‚ è‡ªåŠ¨åˆ é™¤ï¼šQThreadPool é»˜è®¤ä¼šè‡ªåŠ¨ delete å·²å®Œæˆçš„ QRunnableã€‚ é™é¢æ§åˆ¶ï¼šsetMaxThreadCount() è®¾ç½®å¹¶å‘ä¸Šé™ï¼ˆé»˜è®¤å€¼ä¸º CPU æ ¸å¿ƒæ•°ï¼‰ã€‚ è¿‡æœŸå›æ”¶ï¼šé—²ç½® 30 ç§’åçš„çº¿ç¨‹ä¼šè‡ªåŠ¨é”€æ¯ï¼ˆå¯é€šè¿‡ setExpiryTimeout ä¿®æ”¹ï¼‰ã€‚ 3. å®æˆ˜æ¡ˆä¾‹ï¼šIP åœ°å€æ‰«æå™¨class ScanIpTask : public QRunnable public: QString ip; ScanIpTask(QString addr) : ip(addr) void run() override int exitCode = QProcess::execute(ping, -n, 1, ip); qDebug() ip (exitCode == 0 ? å­˜æ´» : æ— æ³•è®¿é—®); ;// æ‰¹é‡æäº¤for(int i=0; i255; i++) auto task = new ScanIpTask(QString(192.168.1.%1).arg(i)); QThreadPool::globalInstance()-start(task); å…­ã€ å®æˆ˜å»ºè®®ä¸æ³¨æ„äº‹é¡¹1. UI é™åˆ¶ ä¸¥ç¦ï¼šåœ¨é GUI çº¿ç¨‹ç›´æ¥æ“ä½œç•Œé¢æ§ä»¶ã€‚ 2. èµ„æºå®‰å…¨ å¤šçº¿ç¨‹å…±äº«æ•°æ®æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ QMutexã€QReadWriteLock æˆ– QSemaphore è¿›è¡Œä¿æŠ¤ã€‚ 3. å·¥å…·å¤‡å¿˜ QThread::currentThreadId()ï¼šå®šä½å½“å‰çº¿ç¨‹ã€‚ QThread::idealThreadCount()ï¼šè·å– CPU ç†æƒ³å¹¶å‘æ•°ã€‚ å‚è€ƒï¼š Qt Documentation - QThreadPool Class Qt Documentation - QThread Class","tags":["Qt","å¤šçº¿ç¨‹"],"categories":["3.å¼€å‘æ¡†æ¶","Qt","Publish"]},{"title":"Qtä¿¡å·ä¸æ§½æœºåˆ¶æ·±åº¦è§£æ","path":"/2024/03/12/3-å¼€å‘æ¡†æ¶-Qt-Publish-Qt-ä¿¡å·æ§½æœºåˆ¶/","content":"1. æ ¸å¿ƒæ¦‚è¿°ä¿¡å·æ§½ï¼ˆSignals Slotsï¼‰æ˜¯ Qt æ¡†æ¶çš„æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ï¼Œç”¨äºå®ç°å¯¹è±¡é—´çš„é€šä¿¡ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰ çš„ä¸€ç§å®ç°ï¼Œä½†æ¯”æ ‡å‡†çš„å›è°ƒå‡½æ•°æœºåˆ¶æ›´åŠ çµæ´»å’Œå®‰å…¨ã€‚ 1.1 åŸºæœ¬æ¦‚å¿µ ä¿¡å· (Signal): å½“å¯¹è±¡çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼ˆä¾‹å¦‚æŒ‰é’®è¢«ç‚¹å‡»ã€æ•°æ®å¤„ç†å®Œæˆï¼‰ï¼Œç”±å¯¹è±¡å‘å‡ºçš„é€šçŸ¥ã€‚ä¿¡å·çš„å‘å‡ºæ˜¯â€å¹¿æ’­â€å¼çš„ï¼Œå‘å‡ºè€…ä¸å…³å¿ƒæ˜¯å¦æœ‰æ¥æ”¶è€…ï¼Œä¹Ÿä¸å…³å¿ƒæ¥æ”¶è€…æ˜¯è°ã€‚ æ§½ (Slot): ç”¨äºæ¥æ”¶ä¿¡å·å¹¶æ‰§è¡Œç›¸åº”æ“ä½œçš„æˆå‘˜å‡½æ•°ã€‚å½“ä¿¡å·è¢«å‘å‡ºæ—¶ï¼Œä¸å…¶è¿æ¥çš„æ§½å‡½æ•°ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚ è¿æ¥ (Connect): å°†ä¿¡å·ä¸æ§½ç»‘å®šåœ¨ä¸€èµ·çš„æœºåˆ¶ã€‚ 1.2 å¯¹è±¡æ ‘ä¸å†…å­˜ç®¡ç†Qt æä¾›äº†ä¸€ç§åŸºäºå¯¹è±¡æ ‘ï¼ˆObject Treeï¼‰çš„å†…å­˜ç®¡ç†æœºåˆ¶ã€‚æ‰€æœ‰ç»§æ‰¿è‡ª QObject çš„ç±»éƒ½å¯ä»¥æŒ‡å®šä¸€ä¸ªçˆ¶å¯¹è±¡ï¼ˆParentï¼‰ã€‚ å½“çˆ¶å¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨é”€æ¯å…¶æ‰€æœ‰çš„å­å¯¹è±¡ã€‚ è¿™æå¤§åœ°ç®€åŒ–äº†å†…å­˜ç®¡ç†ï¼Œç‰¹åˆ«æ˜¯åœ¨ GUI ç¼–ç¨‹ä¸­ï¼ˆä¾‹å¦‚ï¼Œå…³é—­çª—å£æ—¶è‡ªåŠ¨é‡Šæ”¾çª—å£å†…çš„æ‰€æœ‰æ§ä»¶ï¼‰ã€‚ ä»£ç ç¤ºä¾‹ï¼š // åˆ›å»ºä¸€ä¸ªçˆ¶å¯¹è±¡ dlgQDialog *dlg = new QDialog(nullptr);// åˆ›å»ºå­å¯¹è±¡ btnï¼ŒæŒ‡å®š dlg ä¸ºçˆ¶å¯¹è±¡QPushButton *btn = new QPushButton(dlg);// æ­¤æ—¶ä¸éœ€è¦æ‰‹åŠ¨ delete btnï¼Œåªéœ€ delete dlg å³å¯delete dlg; // btn ä¼šè¢«è‡ªåŠ¨é”€æ¯ 1.3 å…ƒå¯¹è±¡ç³»ç»Ÿ (Meta-Object System)Qt çš„å…ƒå¯¹è±¡ç³»ç»Ÿæ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œä¸º C++ æä¾›äº†ä¿¡å·ä¸æ§½æœºåˆ¶ã€è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯ (RTTI) å’ŒåŠ¨æ€å±æ€§ç³»ç»Ÿã€‚ åŸºç±» QObject: æ‰€æœ‰éœ€è¦ä½¿ç”¨å…ƒå¯¹è±¡ç³»ç»ŸåŠŸèƒ½çš„ç±»éƒ½å¿…é¡»ç»§æ‰¿è‡ª QObjectã€‚ Q_OBJECT å®: å¿…é¡»å‡ºç°åœ¨ç±»çš„ç§æœ‰å£°æ˜åŒºï¼Œç”¨äºå¯ç”¨å…ƒå¯¹è±¡ç‰¹æ€§ã€‚ MOC (å…ƒå¯¹è±¡ç¼–è¯‘å™¨): ä¸º QObject å­ç±»ç”Ÿæˆå®ç°å…ƒå¯¹è±¡ç‰¹æ€§æ‰€éœ€çš„ä»£ç ã€‚ æ³¨æ„ï¼šQt çš„å…ƒå¯¹è±¡ç³»ç»Ÿä¸æ”¯æŒ C++ æ¨¡æ¿ç±»ã€‚ 2. è¿æ¥è¯­æ³•Qt æä¾›äº†å¤šç§ä¿¡å·æ§½è¿æ¥è¯­æ³•ï¼Œä» Qt 5 å¼€å§‹æ¨èä½¿ç”¨å‡½æ•°æŒ‡é’ˆå†™æ³•ï¼ŒQt 6 è¿›ä¸€æ­¥å¼ºåŒ–äº†è¿™ä¸€ç°ä»£ C++ é£æ ¼ã€‚ 2.1 å‡½æ•°æŒ‡é’ˆå†™æ³•ï¼ˆæ¨èï¼‰Qt 5 å¼•å…¥äº†åŸºäºå‡½æ•°æŒ‡é’ˆçš„è¿æ¥è¯­æ³•ï¼ŒQt 6 å°†å…¶ä½œä¸ºé¦–é€‰æ–¹å¼ï¼š // connect(sender, SenderClass::signal, receiver, ReceiverClass::slot);QObject::connect(button, QPushButton::clicked, app, QApplication::quit); è¿™ç§æ–¹å¼çš„ä¼˜åŠ¿åœ¨äºï¼š ç¼–è¯‘æ—¶æ£€æŸ¥ï¼šç¼–è¯‘å™¨ä¼šæ£€æŸ¥ä¿¡å·å’Œæ§½çš„å‚æ•°ç±»å‹æ˜¯å¦åŒ¹é…ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯ã€‚ éšå¼å‚æ•°è½¬æ¢ï¼šç¼–è¯‘å™¨å¯å¯¹å…¼å®¹ç±»å‹è‡ªåŠ¨æ‰§è¡Œéšå¼è½¬æ¢ã€‚ æ•ˆç‡æ›´é«˜ï¼šç›´æ¥ä½¿ç”¨å‡½æ•°æŒ‡é’ˆï¼Œé¿å…äº†è¿è¡Œæ—¶è§£æå­—ç¬¦ä¸²çš„å¼€é”€ï¼Œè¿æ¥é€Ÿåº¦æ›´å¿«ã€‚ 2.2 Lambda è¡¨è¾¾å¼Qt æ”¯æŒç›´æ¥ä½¿ç”¨ C++11 Lambda è¡¨è¾¾å¼ä½œä¸ºæ§½å‡½æ•°ï¼Œç¼–å†™ç®€çŸ­é€»è¾‘æ—¶éå¸¸æ–¹ä¾¿ï¼š connect(pushBtn, QPushButton::clicked, [=](bool checked) qDebug() Button clicked! checked;); Lambda è¡¨è¾¾å¼ç‰¹ç‚¹ï¼š åŒ¿åå‡½æ•°ï¼šå¯ä»¥å®šä¹‰åœ¨è¿æ¥è¯­å¥ä¸­ï¼Œé¿å…äº†å•ç‹¬å®šä¹‰æ§½å‡½æ•°ã€‚ æ•è·å˜é‡ï¼š[=] è¡¨ç¤ºä»¥å€¼ä¼ é€’æ–¹å¼æ•è·ä½œç”¨åŸŸä¸­çš„æ‰€æœ‰è‡ªåŠ¨å˜é‡ï¼ŒåŒ…æ‹¬ this æŒ‡é’ˆã€‚ä½¿ç”¨ [] ä¸ºå¼•ç”¨ä¼ é€’ã€‚ ç±»å‹å®‰å…¨ï¼šç¼–è¯‘å™¨ä¼šæ£€æŸ¥ Lambda è¡¨è¾¾å¼çš„å‚æ•°ç±»å‹æ˜¯å¦ä¸ä¿¡å·åŒ¹é…ã€‚ æ³¨æ„ï¼šåœ¨ Lambda ä¸­ä½¿ç”¨å±€éƒ¨å˜é‡æ—¶ï¼Œéœ€æ³¨æ„å˜é‡çš„ç”Ÿå‘½å‘¨æœŸã€‚ 2.3 ä¸Šä¸‹æ–‡å¯¹è±¡è‡ªåŠ¨æ–­å¼€å½“ä½¿ç”¨ Lambda æˆ–ä»¿å‡½æ•°ä½œä¸ºæ§½æ—¶ï¼Œæ¨èä½¿ç”¨å¸¦æœ‰ä¸Šä¸‹æ–‡å¯¹è±¡çš„ connect é‡è½½ï¼š connect(sender, Sender::signal, contextObject, [=]() // Lambda é€»è¾‘); å½“ contextObject è¢«é”€æ¯æ—¶ï¼Œè¿æ¥ä¼šè‡ªåŠ¨æ–­å¼€ã€‚è¿™å¯ä»¥é˜²æ­¢å‘å·²é”€æ¯å¯¹è±¡ä¼ é€’ä¿¡å·å¯¼è‡´çš„å´©æºƒï¼ˆæ‚¬ç©ºæŒ‡é’ˆé—®é¢˜ï¼‰ï¼Œæ˜¯ Qt 6 æ¨èçš„æœ€ä½³å®è·µã€‚ 2.4 è¿æ¥è§„åˆ™ å‚æ•°åŒ¹é…: æ§½å‡½æ•°çš„å‚æ•°ä¸ªæ•°å¿…é¡»å°‘äºæˆ–ç­‰äºä¿¡å·çš„å‚æ•°ä¸ªæ•°ã€‚ ä¿¡å·çš„å‚æ•°ç±»å‹å¿…é¡»ä¸æ§½å‡½æ•°å¯¹åº”ä½ç½®çš„å‚æ•°ç±»å‹ä¸€è‡´ã€‚ æ§½å‡½æ•°å¯ä»¥å¿½ç•¥ä¿¡å·éšåå¤šä½™çš„å‚æ•°ã€‚ å¤šå¯¹å¤šå…³ç³»: ä¸€ä¸ªä¿¡å· - å¤šä¸ªæ§½: ä¿¡å·å‘å‡ºæ—¶ï¼Œæ‰€æœ‰æ§½å‡½æ•°é€ä¸ªè¢«è°ƒç”¨ï¼ˆé¡ºåºä¸ç¡®å®šï¼‰ã€‚ å¤šä¸ªä¿¡å· - ä¸€ä¸ªæ§½: ä»»æ„ä¸€ä¸ªä¿¡å·å‘å‡ºï¼Œè¯¥æ§½å‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ã€‚ ä¿¡å·è¿æ¥ä¿¡å·: connect(obj1, ClassA::signal1, obj2, ClassB::signal2); å½“ signal1 å‘å‡ºæ—¶ï¼Œsignal2 ä¼šéšä¹‹å‘å‡ºã€‚ âš ï¸ é™·é˜±è­¦å‘Šï¼šä½¿ç”¨ä¿¡å·è¿ä¿¡å·æ—¶ï¼Œsender() è¿”å›çš„æ˜¯è½¬å‘ä¿¡å·çš„å¯¹è±¡ï¼Œè€ŒéåŸå§‹è§¦å‘è€…ï¼š// secondButton ç‚¹å‡»åè§¦å‘ firstButton çš„ clicked ä¿¡å·connect(m_secondButton, QPushButton::clicked, m_firstButton, QPushButton::clicked);connect(m_firstButton, QPushButton::clicked, this, MyWidget::buttonClickedSlot);void MyWidget::buttonClickedSlot() auto button = qobject_castQPushButton*(sender()); // æ— è®ºç‚¹å‡»å“ªä¸ªæŒ‰é’®ï¼Œbutton å§‹ç»ˆæŒ‡å‘ m_firstButton æ­¤æ—¶æ— æ³•åŒºåˆ†åŸå§‹å‘é€è€…ï¼Œåº”é¿å…åœ¨éœ€è¦è¯†åˆ«æ¥æºçš„åœºæ™¯ä½¿ç”¨ä¿¡å·è¿ä¿¡å·ã€‚ 3. Qt 6 æ–°ç‰¹æ€§Qt 6 å¼•å…¥ä¸€æ¬¡æ€§è¿æ¥å’Œå£°æ˜å¼å±æ€§ç»‘å®šç³»ç»Ÿï¼Œè¿›ä¸€æ­¥ç®€åŒ–ä¿¡å·æ§½ä½¿ç”¨ã€‚ 3.1 Qt::SingleShotConnectionï¼ˆä¸€æ¬¡æ€§è¿æ¥ï¼‰æ§½å‡½æ•°è§¦å‘åä»…æ‰§è¡Œä¸€æ¬¡ï¼Œè‡ªåŠ¨æ–­å¼€ï¼Œæ— éœ€æ‰‹åŠ¨ disconnect()ï¼š connect(sender, Sender::signal, receiver, Receiver::slot, Qt::SingleShotConnection);// å¯ä¸å…¶ä»–ç±»å‹ç»„åˆconnect(sender, Sender::signal, receiver, Receiver::slot, Qt::QueuedConnection | Qt::SingleShotConnection); å…¸å‹åœºæ™¯ï¼šåˆå§‹åŒ–äº‹ä»¶ã€é¦–æ¬¡æ“ä½œå¼•å¯¼ã€å¼‚æ­¥å®Œæˆå›è°ƒã€‚ 3.2 QProperty ç»‘å®šç³»ç»Ÿå°† QML å£°æ˜å¼ç»‘å®šå¼•å…¥ C++ï¼Œå±æ€§å€¼è‡ªåŠ¨è·Ÿè¸ªä¾èµ–å˜åŒ–ï¼š QPropertyint width100, height50, area;area.setBinding([]() return width.value() * height.value(); );width = 200; // area è‡ªåŠ¨æ›´æ–°ä¸º 10000 å€¼å˜åŒ–ç›‘å¬ï¼šonValueChanged() å˜åŒ–æ—¶è§¦å‘ï¼Œsubscribe() ç«‹å³æ‰§è¡Œä¸€æ¬¡å¹¶ç›‘å¬åç»­å˜åŒ–ã€‚ ä¸ QObject é›†æˆï¼šä½¿ç”¨ Q_OBJECT_BINDABLE_PROPERTY å®é…åˆ Q_PROPERTYï¼Œè¯¦è§å®˜æ–¹æ–‡æ¡£ã€‚ æ‰¹é‡æ›´æ–°ï¼šQt::beginPropertyUpdateGroup() endPropertyUpdateGroup() é¿å…ä¸­é—´æ€è®¡ç®—ã€‚ å¯¹æ¯”é¡¹ QProperty ä¿¡å·æ§½ ç¼–ç¨‹èŒƒå¼ å£°æ˜å¼ï¼Œè‡ªåŠ¨è¿½è¸ª å‘½ä»¤å¼ï¼Œæ‰‹åŠ¨è¿æ¥ é€‚ç”¨åœºæ™¯ å±æ€§è®¡ç®—ã€UI ç»‘å®š äº‹ä»¶é€šçŸ¥ã€ä¸šåŠ¡é€»è¾‘ 3.3 è¿æ¥ç±»å‹é€ŸæŸ¥ ç±»å‹ è¯´æ˜ AutoConnectionï¼ˆé»˜è®¤ï¼‰ åŒçº¿ç¨‹ç›´æ¥è°ƒç”¨ï¼Œè·¨çº¿ç¨‹äº‹ä»¶é˜Ÿåˆ— DirectConnection åŒæ­¥ç«‹å³è°ƒç”¨ QueuedConnection å¼‚æ­¥ï¼Œé€šè¿‡æ¥æ”¶è€…çº¿ç¨‹äº‹ä»¶é˜Ÿåˆ— BlockingQueuedConnection é˜»å¡å¼è·¨çº¿ç¨‹ï¼Œå‘é€è€…ç­‰å¾…æ§½æ‰§è¡Œå®Œæ¯• UniqueConnection é˜²æ­¢é‡å¤è¿æ¥ SingleShotConnection Qt 6 æ–°å¢ï¼Œä¸€æ¬¡æ€§è¿æ¥ 3.4 QMetaObject::Connectionconnect() è¿”å›è¿æ¥å¥æŸ„ï¼Œç”¨äºæ£€æŸ¥æœ‰æ•ˆæ€§æˆ–æ‰‹åŠ¨æ–­å¼€ï¼š QMetaObject::Connection conn = connect(sender, S::sig, receiver, R::slot);if (conn) /* è¿æ¥æœ‰æ•ˆ */ QObject::disconnect(conn); // æ‰‹åŠ¨æ–­å¼€ RAII ç®¡ç†ï¼šå°è£…è¿æ¥å¥æŸ„åˆ°ç±»ä¸­ï¼Œææ„æ—¶è‡ªåŠ¨ disconnect()ã€‚ 4. è‡ªå®šä¹‰ä¿¡å·ä¸æ§½è¦ä½¿ç”¨ä¿¡å·æ§½æœºåˆ¶ï¼Œç±»å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š ç»§æ‰¿è‡ª QObject æˆ–å…¶å­ç±»ã€‚ åœ¨ç±»å£°æ˜çš„ç§æœ‰åŒºèµ·å§‹å¤„æ·»åŠ  Q_OBJECT å®ã€‚ ç¤ºä¾‹ä»£ç : // newspaper.hclass Newspaper : public QObject Q_OBJECT // å¿…é¡»æ·»åŠ public: Newspaper(const QString name) : m_name(name) void send() emit newPaper(m_name); // å‘é€ä¿¡å· signals: // ä¿¡å·å£°æ˜åŒº // ä¿¡å·åªéœ€å£°æ˜ï¼Œæ— éœ€å®ç°ï¼Œè¿”å›å€¼ä¸º void void newPaper(const QString name);private: QString m_name;;// reader.hclass Reader : public QObject Q_OBJECTpublic: // æ§½å‡½æ•°å¯ä»¥æ˜¯æ™®é€šæˆå‘˜å‡½æ•°ã€é™æ€å‡½æ•°ã€è™šå‡½æ•°ç­‰ void receiveNewspaper(const QString name) qDebug() Receives Newspaper: name; ; æ³¨æ„äº‹é¡¹: signals: å…³é”®å­— public/private/protected å¯¹ä¿¡å·æ— æ•ˆï¼Œä¿¡å·é»˜è®¤æ˜¯ public çš„ï¼ˆå› ä¸ºéœ€è¦è¢« connectï¼‰ã€‚ emit: ç”¨äºè§¦å‘ä¿¡å·ï¼Œè™½ç„¶åªæ˜¯ä¸€ä¸ªå®ï¼ˆç©ºå®šä¹‰ï¼‰ï¼Œä½†ä¸ºäº†ä»£ç å¯è¯»æ€§ï¼Œå»ºè®®ä¿ç•™ã€‚ MOC: åªæœ‰æ·»åŠ äº† Q_OBJECTï¼ŒQt çš„å…ƒå¯¹è±¡ç¼–è¯‘å™¨ï¼ˆMOCï¼‰æ‰ä¼šå¤„ç†è¯¥ç±»ï¼Œç”Ÿæˆæ”¯æŒä¿¡å·æ§½æ‰€éœ€çš„ moc_xxx.cpp æ–‡ä»¶ã€‚ 5. è¿›é˜¶æŠ€å·§5.1 ä½¿ç”¨ sender() å‡å°‘æ§½å‡½æ•°å¤„ç†å¤šä¸ªåŒç±»æ§ä»¶æ—¶ï¼Œä½¿ç”¨ QObject::sender() æ–¹æ³•å¯ä»¥åœ¨å•ä¸€æ§½å‡½æ•°ä¸­è¯†åˆ«ä¿¡å·æ¥æºï¼Œæœ‰æ•ˆå‡å°‘ä»£ç å†—ä½™ã€‚ å¸¸è§„å†™æ³•ï¼ˆæ§½å‡½æ•°æ•°é‡éšæ§ä»¶å¢åŠ ï¼‰ï¼š connect(m_firstButton, QPushButton::clicked, this, MyWidget::firstButtonSlot);connect(m_secondButton, QPushButton::clicked, this, MyWidget::secondButtonSlot);// æ¯ä¸ªæŒ‰é’®éœ€è¦å•ç‹¬çš„æ§½å‡½æ•°... ä¼˜åŒ–å†™æ³•ï¼ˆç»Ÿä¸€æ§½å‡½æ•° + sender() è¯†åˆ«ï¼‰ï¼š m_firstButton = new QPushButton(first, this);m_secondButton = new QPushButton(second, this);// æ‰€æœ‰æŒ‰é’®è¿æ¥åˆ°åŒä¸€ä¸ªæ§½å‡½æ•°connect(m_firstButton, QPushButton::clicked, this, MyWidget::onButtonClicked);connect(m_secondButton, QPushButton::clicked, this, MyWidget::onButtonClicked);void MyWidget::onButtonClicked() auto button = qobject_castQPushButton*(sender()); if (button == m_firstButton) qDebug() First button clicked; else if (button == m_secondButton) qDebug() Second button clicked; 5.2 æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œåœ¨è‡ªåŠ¨åŒ–æµ‹è¯•æˆ–ç‰¹å®šåŠŸèƒ½å®ç°æ—¶ï¼Œå¯é€šè¿‡ä»£ç æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œï¼š // æ¨¡æ‹Ÿç‚¹å‡»æŒ‰é’®m_firstButton-click();// æ¨¡æ‹Ÿå¸¦åŠ¨ç”»æ•ˆæœçš„ç‚¹å‡»ï¼ˆé»˜è®¤ 100msï¼‰m_firstButton-animateClick(100);// åˆ‡æ¢æŒ‰é’®çš„é€‰ä¸­çŠ¶æ€ï¼ˆé€‚ç”¨äº checkable æŒ‰é’®ï¼‰m_firstButton-toggle();// è®¾ç½®æŒ‰é’®é€‰ä¸­çŠ¶æ€m_firstButton-setChecked(true); QPushButton æä¾›çš„ç›¸å…³æ§½å‡½æ•°ï¼š public Q_SLOTS: void setIconSize(const QSize size); void animateClick(int msec = 100); void click(); void toggle(); void setChecked(bool); 6. åŸç†æ·±åº¦è§£ææœ¬ç« æ·±å…¥å‰–æä¿¡å·æ§½çš„åº•å±‚å®ç°ï¼Œå¸®åŠ©ç†è§£å…¶å·¥ä½œæœºåˆ¶å’Œæ€§èƒ½ç‰¹æ€§ã€‚ 6.1 MOC (å…ƒå¯¹è±¡ç¼–è¯‘å™¨)MOCï¼ˆMeta-Object Compilerï¼Œå…ƒå¯¹è±¡ç¼–è¯‘å™¨ï¼‰æ˜¯ Qt å°†æ‰©å±•è¯­æ³•ç¿»è¯‘ä¸ºæ ‡å‡† C++ çš„å·¥å…·ã€‚signalsã€slotsã€emitã€Q_OBJECT ç­‰å…³é”®å­—éœ€è¦é€šè¿‡ MOC é¢„å¤„ç†ã€‚ Q_OBJECT å®å±•å¼€Q_OBJECT å±•å¼€åä¼šç”Ÿæˆä¸€ä¸ª QMetaObject å…ƒå¯¹è±¡é™æ€ç±»åŠç›¸å…³æ“ä½œå‡½æ•°ï¼š // Q_OBJECT å®å±•å¼€åç”Ÿæˆçš„æ ¸å¿ƒæˆå‘˜class MyClass : public QObject // ... ç”¨æˆ·ä»£ç  ... // === Q_OBJECT å®å±•å¼€å†…å®¹ ===public: static const QMetaObject staticMetaObject; // é™æ€å…ƒå¯¹è±¡ virtual const QMetaObject *metaObject() const override; virtual void *qt_metacast(const char *) override; virtual int qt_metacall(QMetaObject::Call, int, void **) override; private: static void qt_static_metacall(QObject *, QMetaObject::Call, int, void **);; MOC ä»£ç ç”Ÿæˆæµç¨‹ä»¥ä¸‹é¢çš„ç±»ä¸ºä¾‹ï¼š // widget.h - ç”¨æˆ·ç¼–å†™çš„å¤´æ–‡ä»¶class Widget : public QObject Q_OBJECTpublic: Widget(QObject *parent = nullptr);signals: void valueChanged(int newValue); void textChanged(const QString text);public slots: void setValue(int value); void reset();; é¢„å¤„ç†é˜¶æ®µä¼šè°ƒç”¨ moc ç¨‹åºï¼Œç”Ÿæˆ moc_widget.cpp æ–‡ä»¶ã€‚MOC ç”Ÿæˆçš„ä»£ç ç»“æ„å¦‚ä¸‹ï¼š flowchart TB subgraph MOC[moc_widget.cpp ç”Ÿæˆå†…å®¹] A[qt_meta_stringdata_Widgetbr/ä¿¡å·æ§½å‡½æ•°åå­—ç¬¦ä¸²è¡¨] B[qt_meta_data_Widgetbr/å…ƒæ•°æ®æ•°ç»„ï¼ˆç´¢å¼•ã€å‚æ•°ä¿¡æ¯ï¼‰] C[Widget::staticMetaObjectbr/QMetaObject é™æ€å®ä¾‹] D[qt_static_metacall()br/æ§½å‡½æ•°è°ƒç”¨åˆ†å‘å™¨] E[ä¿¡å·å‡½æ•°å®ç°br/valueChanged() / textChanged()] end A -- C B -- C C -- D D -- E MOC å¤„ç†è¿‡ç¨‹ï¼š é¢„å¤„ç†: æ‰«æå¤´æ–‡ä»¶ï¼Œæ‰¾åˆ°åŒ…å« Q_OBJECT çš„ç±»ã€‚ å­—ç¬¦ä¸²åŒ–: å°† signals å’Œ slots ä¸‹çš„å‡½æ•°åè½¬æ¢ä¸ºå­—ç¬¦æ•°ç»„ï¼Œå¹¶ç”Ÿæˆåç§°ç´¢å¼•å·ï¼ˆidxï¼‰ã€‚ ç”Ÿæˆå…ƒæ•°æ®æ•°ç»„: åˆ›å»º qt_meta_data_Widget æ•°ç»„ï¼ˆç±»åå†³å®šåç¼€ï¼‰ï¼š // å…ƒæ•°æ®æ•°ç»„ç»“æ„ç¤ºä¾‹static const uint qt_meta_data_Widget[] = // content: 9, // revision 0, // classname (å­—ç¬¦ä¸²è¡¨åç§») 0, 0, // classinfo 4, 14, // methods: 4ä¸ªæ–¹æ³•ï¼Œä»ç´¢å¼•14å¼€å§‹ 0, 0, // properties 0, 0, // enums/sets 0, 0, // constructors 0, // flags 2, // signalCount: 2ä¸ªä¿¡å· // signals: name, argc, parameters, tag, flags 1, 1, 34, 2, 0x06, // valueChanged(int) 3, 1, 37, 2, 0x06, // textChanged(QString) // slots: name, argc, parameters, tag, flags 5, 1, 40, 2, 0x0a, // setValue(int) 6, 0, 43, 2, 0x0a, // reset() // ...; å…¶ä¸­ 4, 14 è¡¨ç¤ºæœ‰ 4 ä¸ªæ–¹æ³•ï¼Œ14 æ˜¯ uint åç§»ä½ç½®ï¼Œå³ qt_meta_data_Widget[14] æŒ‡å‘ç¬¬ä¸€ä¸ªæ–¹æ³•æè¿°ã€‚ ç”Ÿæˆå›è°ƒå‡½æ•°: åˆ›å»º qt_static_metacall å‡½æ•°ï¼Œç”¨äºé€šè¿‡ ID è°ƒç”¨ç›®æ ‡ç±»çš„æ§½å‡½æ•°ï¼š void Widget::qt_static_metacall(QObject *_o, QMetaObject::Call _c, int _id, void **_a) if (_c == QMetaObject::InvokeMetaMethod) auto *_t = static_castWidget *(_o); switch (_id) case 0: _t-valueChanged((*reinterpret_castint*(_a[1]))); break; case 1: _t-textChanged((*reinterpret_castQString*(_a[1]))); break; case 2: _t-setValue((*reinterpret_castint*(_a[1]))); break; case 3: _t-reset(); break; default: break; // ... ä¿¡å·ç´¢å¼•æ£€æŸ¥ç­‰ ç”Ÿæˆ QMetaObject å®ä¾‹: åŒ…å«ç±»åã€ç»§æ‰¿å…³ç³»ã€ä¿¡å·æ§½ä¿¡æ¯ç­‰ã€‚ ç¼–è¯‘: ç¼–è¯‘å™¨å°†åŸ cpp æºç å’Œç”Ÿæˆçš„ moc cpp ä¸€èµ·ç¼–è¯‘ã€‚ 6.2 connect è¿æ¥æœºåˆ¶connect å‡½æ•°å†…éƒ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š sequenceDiagram participant App as åº”ç”¨ä»£ç  participant Connect as QObject::connect() participant Sender as å‘é€æ–¹ QObject participant Meta as QMetaObject App-Connect: connect(sender, S::sig, receiver, R::slot) Connect-Meta: è§£æä¿¡å·å‡½æ•°æŒ‡é’ˆ â†’ è·å–ä¿¡å·ç´¢å¼• Connect-Meta: è§£ææ§½å‡½æ•°æŒ‡é’ˆ â†’ è·å–æ§½ç´¢å¼• Connect-Connect: æ ¡éªŒå‚æ•°ç±»å‹å…¼å®¹æ€§ Connect-Sender: åœ¨ connectionLists[signalIndex] æ·»åŠ è¿æ¥ Note over Sender: è¿æ¥ä¿¡æ¯: receiver*, slotIndex, connectionType Connect--App: è¿”å› QMetaObject::Connection ä¿¡å·æ§½ç´¢å¼•è§£æ: é€šè¿‡å‡½æ•°æŒ‡é’ˆè·å–ä¿¡å·å’Œæ§½çš„å…ƒå¯¹è±¡ç´¢å¼•ã€‚ å‚æ•°æ ¡éªŒ: éªŒè¯ä¿¡å·æ§½å‚æ•°ç±»å‹æ˜¯å¦å…¼å®¹ã€‚ å»ºç«‹è¿æ¥: åœ¨å‘é€æ–¹çš„ QObjectConnectionListVector è¿æ¥é“¾è¡¨å®¹å™¨çš„ä¿¡å·ç´¢å¼•å¤„ï¼Œæ·»åŠ ç›®æ ‡å¯¹è±¡æŒ‡é’ˆå’Œæ§½å‡½æ•°ç´¢å¼•å·ã€‚ 6.3 ä¿¡å·å‘å°„ä¸æ§½è°ƒç”¨æµç¨‹å½“è°ƒç”¨ emit signal() æ—¶ï¼Œå®é™…æ‰§è¡Œäº†ä»¥ä¸‹æ­¥éª¤ï¼š sequenceDiagram participant Code as ç”¨æˆ·ä»£ç  participant Signal as ä¿¡å·å‡½æ•° participant Activate as QMetaObject::activate() participant ConnList as ConnectionList participant Slot as æ§½å‡½æ•° Code-Signal: emit valueChanged(42) Signal-Activate: activate(sender, staticMetaObject, signalIndex, args) Activate-ConnList: æ ¹æ® signalIndex æŸ¥æ‰¾è¿æ¥é“¾è¡¨ loop éå†æ‰€æœ‰æ¥æ”¶è€… ConnList-Activate: è¿”å› receiver, slotIndex, type alt DirectConnection (åŒçº¿ç¨‹) Activate-Slot: qt_static_metacall(receiver, slotIndex, args) else QueuedConnection (è·¨çº¿ç¨‹) Activate-Activate: å°†è°ƒç”¨å°è£…ä¸º QMetaCallEvent Activate-Slot: postEvent åˆ°æ¥æ”¶è€…çº¿ç¨‹äº‹ä»¶é˜Ÿåˆ— end end è°ƒç”¨ä¿¡å·å‡½æ•°: ä¿¡å·å‡½æ•°åœ¨ moc_xxx.cpp ä¸­å®ç°ï¼Œå†…éƒ¨è°ƒç”¨ QMetaObject::activate()ã€‚ æŸ¥æ‰¾è¿æ¥è¡¨: activate å‡½æ•°åœ¨ QObjectConnectionListVector è¿æ¥é“¾è¡¨å®¹å™¨ä¸­ï¼Œæ ¹æ®ä¿¡å·ç´¢å¼•å·æŸ¥æ‰¾å¯¹åº”çš„æ¥æ”¶è€…é“¾è¡¨ã€‚é“¾è¡¨ä¸­å­˜æ”¾äº†æ¯ä¸ªæ¥æ”¶å¯¹è±¡æŒ‡é’ˆå’Œæ§½å‡½æ•° IDã€‚ è°ƒç”¨æ§½å‡½æ•°: éå†è¯¥ä¿¡å·å…³è”çš„é“¾è¡¨ï¼Œè·å–æ‰€æœ‰ç›®æ ‡å¯¹è±¡æŒ‡é’ˆå’Œæ§½å‡½æ•°ç´¢å¼•ã€‚ é€šè¿‡ qt_static_metacall å›è°ƒå‡½æ•°è°ƒç”¨æ§½å‡½æ•°ã€‚ æ£€æŸ¥çº¿ç¨‹äº²å’Œæ€§ï¼ˆThread Affinityï¼‰ï¼šåŒçº¿ç¨‹ç›´æ¥è°ƒç”¨ï¼ˆDirect Connectionï¼‰ï¼Œä¸åŒçº¿ç¨‹é€šè¿‡äº‹ä»¶é˜Ÿåˆ—å‘é€ï¼ˆQueued Connectionï¼‰ã€‚ 6.4 æ€§èƒ½åˆ†æä¿¡å·æ§½çš„è°ƒç”¨è™½ç„¶çµæ´»ï¼Œä½†æ¯”ç›´æ¥çš„ C++ å‡½æ•°å›è°ƒè¦æ…¢ï¼ŒåŸå› åŒ…æ‹¬ï¼š æŸ¥æ‰¾å¼€é”€: éœ€è¦åœ¨è¿æ¥åˆ—è¡¨ä¸­å®šä½æ¥æ”¶è€…ã€‚ å‚æ•°ç¼–ç»„: å°¤å…¶æ˜¯è·¨çº¿ç¨‹è°ƒç”¨æ—¶ï¼Œéœ€è¦å¯¹å‚æ•°è¿›è¡Œæ‰“åŒ…ï¼ˆMarshallingï¼‰ã€‚ å®‰å…¨æ£€æŸ¥: ä¿¡å·æ§½æœºåˆ¶åŒ…å«äº†å¾ˆå¤šè¿è¡Œæ—¶çš„ä¸€è‡´æ€§æ£€æŸ¥ã€‚ ç»“è®º: åªæœ‰åœ¨æé«˜é¢‘æ¬¡è°ƒç”¨çš„æ­»å¾ªç¯å…³é”®è·¯å¾„ä¸­æ‰éœ€è¦è€ƒè™‘å…¶æ€§èƒ½æŸè€—ã€‚åœ¨ç»å¤§å¤šæ•° GUI äº‹ä»¶å“åº”å’Œå¸¸è§„ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œè¿™ç§å¾®å°çš„æ€§èƒ½å·®å¼‚æ˜¯å¯ä»¥å¿½ç•¥ä¸è®¡çš„ã€‚ Qt 6 æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼š ä½¿ç”¨å¸¸å¼•ç”¨æˆ–ç§»åŠ¨è¯­ä¹‰ä¼ é€’å¤§å¯¹è±¡ï¼Œå‡å°‘æ‹·è´å¼€é”€ã€‚ ä½¿ç”¨ std::shared_ptr è·¨çº¿ç¨‹å…±äº«æ•°æ®ã€‚ é«˜é¢‘ä¿¡å·è€ƒè™‘ä½¿ç”¨ Qt::DirectConnection é¿å…é˜Ÿåˆ—è°ƒåº¦ã€‚ 6.5 éšå¼å…±äº«ä¸æ•°æ®ä¼ é€’æ•ˆç‡Qt çš„éšå¼å…±äº«ï¼ˆImplicit Sharingï¼‰é‡‡ç”¨å†™æ—¶å¤åˆ¶ï¼ˆCOWï¼‰ç­–ç•¥ï¼šå¤šä¸ªå¯¹è±¡å…±äº«åŒä¸€æ•°æ®ï¼Œä»…åœ¨ä¿®æ”¹æ—¶è§¦å‘æ·±æ‹·è´ã€‚QStringã€QByteArrayã€QList ç­‰å®¹å™¨å‡æ”¯æŒã€‚ QByteArray b1 = hello;QByteArray b2 = b1; // æµ…æ‹·è´ï¼Œå…±äº«å†…å­˜b2 = modified; // ä¿®æ”¹æ—¶æ‰æ·±æ‹·è´ ä¿¡å·æ§½ä¼ é€’åŒæ ·å—ç›Šï¼šæ¥æ”¶æ–¹åœ¨æœªä¿®æ”¹æ•°æ®å‰ä¸å‘é€æ–¹å…±äº«å†…å­˜ï¼Œè·¨çº¿ç¨‹ï¼ˆQueued Connectionï¼‰äº¦ç„¶ã€‚ æœ€ä½³å®è·µï¼šä½¿ç”¨å¸¸å¼•ç”¨ä¼ é€’ï¼Œé¿å…ä¸´æ—¶å˜é‡æ„é€ å¼€é”€ï¼š void processData(const QByteArray data);signals: void dataReady(const QByteArray data); å¹¶éæ‰€æœ‰ Qt ç±»å‹éƒ½æ”¯æŒéšå¼å…±äº«ï¼Œä½¿ç”¨å‰è¯·æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚ 7. æ€»ç»“è¿æ¥æ–¹å¼å¯¹æ¯” è¿æ¥æ–¹å¼ ç‰¹ç‚¹ æ¨èç¨‹åº¦ å‡½æ•°æŒ‡é’ˆ ç±»å‹å®‰å…¨ï¼Œæ•ˆç‡é«˜ï¼Œç¼–è¯‘æœŸæ£€æŸ¥ âœ… æ¨è Lambda è¡¨è¾¾å¼ ç®€æ´æ–¹ä¾¿ï¼Œé€‚åˆå¿«é€Ÿå®šä¹‰å¤„ç†é€»è¾‘ âœ… æ¨è å¸¦ä¸Šä¸‹æ–‡å¯¹è±¡ è‡ªåŠ¨æ–­å¼€ï¼Œé˜²æ­¢æ‚¬ç©ºæŒ‡é’ˆ âœ… å¼ºçƒˆæ¨è Qt 6 æ–°ç‰¹æ€§é€ŸæŸ¥ ç‰¹æ€§ è¯´æ˜ Qt::SingleShotConnection ä¸€æ¬¡æ€§è¿æ¥ï¼Œè§¦å‘åè‡ªåŠ¨æ–­å¼€ QProperty å£°æ˜å¼å±æ€§ç»‘å®šï¼Œè‡ªåŠ¨ä¾èµ–è¿½è¸ª QObjectBindableProperty QObject é›†æˆçš„å¯ç»‘å®šå±æ€§ Qt::beginPropertyUpdateGroup() æ‰¹é‡å±æ€§æ›´æ–°ä¼˜åŒ– ä¼˜ç¼ºç‚¹åˆ†æä¼˜ç‚¹: ç±»å‹å®‰å…¨: ç¼–è¯‘æœŸå‚æ•°åŒ¹é…æ£€æŸ¥ï¼ˆå‡½æ•°æŒ‡é’ˆå†™æ³•ï¼‰ã€‚ æ¾è€¦åˆ: å‘é€è€…å®Œå…¨ä¸éœ€è¦çŸ¥é“æ¥æ”¶è€…çš„å­˜åœ¨ï¼Œåˆ©äºæ¨¡å—åŒ–å’Œ MVC æ¶æ„ã€‚ Qt 6 å¢å¼º: ä¸€æ¬¡æ€§è¿æ¥ã€å±æ€§ç»‘å®šç³»ç»Ÿè¿›ä¸€æ­¥ç®€åŒ–ä»£ç ã€‚ ç¼ºç‚¹: æ€§èƒ½ç¨ä½äºç›´æ¥å›è°ƒï¼ˆçº¦æ…¢ 10 å€ï¼Œä½†ç»å¯¹è€—æ—¶ä»æ˜¯å¾®ç§’çº§ï¼‰ã€‚ éœ€è¦ä¾èµ– MOC å·¥å…·ã€‚ å‚è€ƒæ¥æº Qt 6 Signals Slots å®˜æ–¹æ–‡æ¡£ - ä¿¡å·æ§½æœºåˆ¶æƒå¨å‚è€ƒ Qt Property System å®˜æ–¹æ–‡æ¡£ - QProperty ç»‘å®šç³»ç»Ÿè¯¦è§£ Qt Implicit Sharing å®˜æ–¹æ–‡æ¡£ - éšå¼å…±äº«æœºåˆ¶è¯´æ˜ Qt Meta-Object System å®˜æ–¹æ–‡æ¡£ - MOC å…ƒå¯¹è±¡ç³»ç»Ÿ","tags":["Qt","ä¿¡å·æ§½","C++","Qt6"],"categories":["3.å¼€å‘æ¡†æ¶","Qt","ä¿¡å·æ§½"]},{"title":"QComboBoxæ ·å¼è¡¨","path":"/2024/02/29/3-å¼€å‘æ¡†æ¶-Qt-æ§ä»¶-QComboBoxæ ·å¼è¡¨/","content":"å­—ä½“æ ·å¼QComboBox font-family: Microsoft YaHei; font-size: 14px; color: #000000; font-style: italic; font-weight: bold; font-family ä¸ºè®¾ç½®å­—ä½“ç±»å‹ï¼Œæ ‡å‡†å½¢å¼éœ€è¦åŠ åŒå¼•å·ï¼Œä¸åŠ ä¹Ÿå¯èƒ½ä¼šç”Ÿæ•ˆï¼Œå…·ä½“çœ‹ç³»ç»Ÿæ˜¯å¦æ”¯æŒï¼Œä¸­è‹±æ–‡éƒ½æ”¯æŒï¼Œä½†è¦ä¿è¯å­—ä½“ç¼–ç æ”¯æŒï¼Œä¸€èˆ¬ç¨‹åºç¼–ç ä¸ºâ€utf-8â€æ—¶æ²¡é—®é¢˜ã€‚ font-size ä¸ºè®¾ç½®å­—ä½“å¤§å°ï¼Œå•ä½ä¸€èˆ¬ä½¿ç”¨ px åƒç´  font-style ä¸ºè®¾ç½®å­—ä½“æ–œä½“ï¼Œitalic ä¸ºæ–œä½“ï¼Œ normal ä¸ºä¸æ–œä½“ font-weight ä¸ºè®¾ç½®å­—ä½“åŠ ç²—ï¼Œbold ä¸ºåŠ ç²—ï¼Œ normal ä¸ºä¸åŠ ç²— color ä¸ºè®¾ç½®å­—ä½“é¢œè‰²ï¼Œå¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶æ•°è¡¨ç¤ºé¢œè‰²ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æŸäº›ç‰¹æ®Šçš„å­—ä½“é¢œè‰²ï¼šred, green, blue ç­‰ï¼Œæˆ–è€…ä½¿ç”¨ rgb(r,g,b) å’Œ rgba(r,g,b,a) æ¥è®¾ç½®ï¼Œå…¶ä¸­ rã€gã€bã€a å€¼ä¸º 0~255ï¼Œå¦‚æœæƒ³ä¸æ˜¾ç¤ºé¢œè‰²å¯ä»¥è®¾ç½®å€¼ä¸ºé€æ˜ transparent å­—ä½“é¢œè‰²ç”¨çš„æ˜¯ color å±æ€§ï¼Œæ²¡æœ‰ font-color è¿™ä¸ªå±æ€§çš„ å¯¹äºå­—ä½“æ ·å¼ï¼Œå¯ä»¥æŠŠ family size style weight ç»Ÿä¸€è®¾ç½®åœ¨ font å±æ€§ä¸­ï¼š font: bold italic 18px Microsoft YaHei; è¿™é‡Œå‡ºç°çš„é¡ºåºè¦æ±‚æ˜¯ style å’Œ weight å¿…é¡»å‡ºç°åœ¨å¼€å¤´ï¼Œsize å’Œ family åœ¨åé¢ï¼Œè€Œä¸” size å¿…é¡»åœ¨ family ä¹‹å‰ï¼Œå¦åˆ™æ ·å¼å°†ä¸ç”Ÿæ•ˆï¼Œfont ä¸­ä¸èƒ½è®¾ç½®é¢œè‰²ï¼Œå¯ä»¥å•ç‹¬è®¾ç½® style weight å’Œ sizeï¼Œä¸èƒ½å•ç‹¬è®¾ç½® family æ–‡å­—ä½ç½®padding-left: 10px;padding-top: 8px;padding-right: 7px;padding-bottom: 9px; padding-left ä¸ºè®¾ç½®æŒ‰é’®(åŒ…æ‹¬é€‰æ‹©æ¡†å’Œæ–‡å­—)è·ç¦»å·¦è¾¹è¾¹ç•Œçš„è·ç¦» padding-top ä¸ºè®¾ç½®æŒ‰é’®(åŒ…æ‹¬é€‰æ‹©æ¡†å’Œæ–‡å­—)è·ç¦»é¡¶è¾¹è¾¹ç•Œçš„è·ç¦» padding-right ä¸ºè®¾ç½®æŒ‰é’®(åŒ…æ‹¬é€‰æ‹©æ¡†å’Œæ–‡å­—)è·ç¦»å³è¾¹è¾¹ç•Œçš„è·ç¦» padding-bottom ä¸ºè®¾ç½®æŒ‰é’®(åŒ…æ‹¬é€‰æ‹©æ¡†å’Œæ–‡å­—)è·ç¦»åº•è¾¹è¾¹ç•Œçš„è·ç¦» åœ¨ qss ä¸­ï¼Œå±æ€§ text-align å¯¹ QComboBox æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œä¸€èˆ¬ padding-left ç›¸å½“äº x åæ ‡ï¼Œpadding-top ç›¸å½“äº y åæ ‡ï¼Œè®¾ç½®è¿™ä¸¤ä¸ªå°±å¯ä»¥ç²¾ç¡®åœ°è°ƒèŠ‚æ–‡å­—çš„æ˜¾ç¤ºä½ç½® ä¸‹é¢è°ƒèŠ‚å­—ä½“å·¦é—´è·ä¸º 30px QComboBox font-family: Microsoft YaHei; font-size: 14px; color: #000000; font-style: italic; font-weight: bold; padding-left: 30px; å¯ä»¥çœ‹åˆ°è®¾ç½®çš„ padding-left åªå¯¹æŒ‰é’®æ¡†æ–‡å­—èµ·ä½œç”¨ï¼Œå¯¹ä¸‹æ‹‰åˆ—è¡¨ä¸èµ·ä½œç”¨ï¼Œåé¢ä¼šå•ç‹¬è®¨è®ºä¸‹æ‹‰æ¡†æ ·å¼ è¾¹æ¡†æ ·å¼border-style: solid;border-width: 2px;border-color: aqua; border-style ä¸ºè®¾ç½®è¾¹æ¡†æ ·å¼ï¼Œsolid ä¸ºå®çº¿ï¼Œ dashed ä¸ºè™šçº¿ï¼Œ dotted ä¸ºç‚¹çº¿ï¼Œ none ä¸ºä¸æ˜¾ç¤ºï¼ˆå¦‚æœä¸è®¾ç½® border-style çš„è¯ï¼Œé»˜è®¤ä¼šè®¾ç½®ä¸º noneï¼‰ border-width ä¸ºè®¾ç½®è¾¹æ¡†å®½åº¦ï¼Œå•ä½ä¸º px åƒç´  border-color ä¸ºè®¾ç½®è¾¹æ¡†é¢œè‰²ï¼Œå¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶æ•°è¡¨ç¤ºé¢œè‰²ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æŸäº›ç‰¹æ®Šçš„å­—ä½“é¢œè‰²ï¼šred, green, blue ç­‰ï¼Œæˆ–è€…ä½¿ç”¨ rgb(r,g,b) å’Œ rgba(r,g,b,a) æ¥è®¾ç½®ï¼Œå…¶ä¸­ rã€gã€bã€a å€¼ä¸º 0~255ï¼Œå¦‚æœæƒ³ä¸æ˜¾ç¤ºé¢œè‰²å¯ä»¥è®¾ç½®å€¼ä¸ºé€æ˜ transparent QComboBox font-family: Microsoft YaHei; font-size: 14px; color: #000000; font-style: italic; font-weight: bold; padding-left: 30px; border-width: 2px; border-style: solid; border-color: aqua; ä¹Ÿå¯ä»¥æŠŠ border çš„ width style color ä¸€èµ·è®¾ç½®åœ¨ border å±æ€§ä¸­ï¼š border: 2px solid aqua; ä½†å¿…é¡»æ³¨æ„çš„æ˜¯ï¼Œå€¼çš„é¡ºåºå¿…é¡»æ˜¯æŒ‰ç…§ width style color æ¥å†™ï¼Œä¸ç„¶ä¸ä¼šç”Ÿæ•ˆï¼å¦‚æœä¸æƒ³æ˜¾ç¤ºè¾¹æ¡†å¯ä»¥ç›´æ¥è®¾ç½® border å±æ€§å€¼ä¸º none ä¹Ÿå¯ä»¥å•ç‹¬è®¾ç½®æŸä¸€æ¡è¾¹æ¡†çš„æ ·å¼ border-top-style: solid;border-top-width: 2px;border-top-color: red;border-top: 2px solid red; border-top-style ä¸ºè®¾ç½®é¡¶éƒ¨è¾¹æ¡†æ ·å¼ border-top-width ä¸ºè®¾ç½®é¡¶éƒ¨è¾¹æ¡†å®½åº¦ border-top-color ä¸ºè®¾ç½®é¡¶éƒ¨è¾¹æ¡†é¢œè‰² border-top ä¸ºè®¾ç½®é¡¶éƒ¨è¾¹æ¡† width style color çš„å±æ€§ï¼ŒåŸç†å’Œ border ä¸€è‡´å…¶å®ƒä¸‰ä¸ªè¾¹æ¡†ï¼šright bottom left è¾¹æ¡†çš„è®¾ç½®éƒ½ç›¸åŒ è®¾ç½®è¾¹æ¡†åŠå¾„border-top-left-radius: 20px;border-top-right-radius: 20px;border-bottom-left-radius: 20px;border-bottom-right-radius: 20px;border-radius: 20px; border-top-left-radius ä¸ºè®¾ç½®å·¦ä¸Šè§’åœ†è§’åŠå¾„ï¼Œå•ä½ px åƒç´  border-top-right-radius ä¸ºè®¾ç½®å³ä¸Šè§’åœ†è§’åŠå¾„ï¼Œå•ä½ px åƒç´  border-bottom-left-radius ä¸ºè®¾ç½®å·¦ä¸‹è§’åœ†è§’åŠå¾„ï¼Œå•ä½ px åƒç´  border-bottom-right-radius ä¸ºè®¾ç½®å³ä¸Šè§’åœ†è§’åŠå¾„ï¼Œå•ä½ px åƒç´  border-radius ä¸ºè®¾ç½®æ‰€æœ‰è¾¹æ¡†åœ†è§’åŠå¾„ï¼Œå•ä½ä¸º px åƒç´ ï¼Œé€šè¿‡åœ†è§’åŠå¾„å¯ä»¥å®ç°åœ†å½¢çš„ QComboBox ä¸‹é¢æ¥è®¾ç½®å·¦ä¸Šè§’å’Œå·¦ä¸‹è§’åŠå¾„ QComboBox font-family: Microsoft YaHei; font-size: 14px; color: #000000; font-style: italic; font-weight: bold; padding-left: 30px; border-width: 2px; border-style: solid; border-color: aqua; border-top-left-radius: 13px; border-bottom-left-radius: 13px; èƒŒæ™¯æ ·å¼background-color: #2E3648;background-image: url(./image.png);background-repeat: no-repeat; background-position: left center;background: url(./image.png) no-repeat left center #2E3648; background-color ä¸ºè®¾ç½®èƒŒæ™¯é¢œè‰²ï¼Œå¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶æ•°è¡¨ç¤ºé¢œè‰²ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æŸäº›ç‰¹æ®Šçš„å­—ä½“é¢œè‰²ï¼šred, green, blue ç­‰ï¼Œæˆ–è€…ä½¿ç”¨ rgb(r,g,b) å’Œ rgba(r,g,b,a) æ¥è®¾ç½®ï¼Œå…¶ä¸­ rã€gã€bã€a å€¼ä¸º 0~255ï¼Œå¦‚æœæƒ³ä¸æ˜¾ç¤ºé¢œè‰²å¯ä»¥è®¾ç½®å€¼ä¸ºé€æ˜ transparent background-image ä¸ºè®¾ç½®èƒŒæ™¯å›¾ç‰‡ï¼Œå›¾ç‰‡è·¯å¾„ä¸º url(image-path) background-repeat ä¸ºè®¾ç½®èƒŒæ™¯å›¾æ˜¯å¦é‡å¤å¡«å……èƒŒæ™¯ï¼Œå¦‚æœèƒŒæ™¯å›¾ç‰‡å°ºå¯¸å°äºèƒŒæ™¯å®é™…å¤§å°çš„è¯ï¼Œé»˜è®¤ä¼šè‡ªåŠ¨é‡å¤å¡«å……å›¾ç‰‡ï¼Œå¯ä»¥è®¾ç½®ä¸º no-repeat ä¸é‡å¤ï¼Œrepeat-x åœ¨ x è½´é‡å¤ï¼Œrepeat-y åœ¨ y è½´é‡å¤ background-position ä¸ºè®¾ç½®èƒŒæ™¯å›¾ç‰‡æ˜¾ç¤ºä½ç½®ï¼Œåªæ”¯æŒ left right top bottom centerï¼›å€¼ left right center ä¸ºè®¾ç½®æ°´å¹³ä½ç½®ï¼Œå€¼ top bottom center ä¸ºè®¾ç½®å‚ç›´ä½ç½® æ¯”å¦‚ç»™ QComboBox å·¦è¾¹æ·»åŠ ä¸€ä¸ªèƒŒæ™¯å›¾ç‰‡ QComboBox font-family: Microsoft YaHei; font-size: 14px; color: #BDC8E2; font-style: italic; font-weight: bold; padding-left: 30px; border-width: 1px; border-style: solid; border-color: aqua; background-color: #2E3648; background-image: url(./image.png); background-repeat: no-repeat; background-position: left center; å¯¹äº backgroundï¼Œå¯ä»¥æŠŠ color image repeat position ä¸€èµ·è®¾ç½®åœ¨ background å±æ€§ä¸­ï¼š background: url(./image.png) no-repeat left center #2E3648; color image repeat position è¿™äº›å±æ€§å€¼å‡ºç°çš„é¡ºåºå¯ä»¥ä»»æ„ åŠ¨æ€æ ·å¼å¯ä»¥è®¾ç½®é¼ æ ‡æ‚¬æµ®æ—¶çš„æ ·å¼ QComboBox:hover color: green; background-color: black; å½“ä¸‹æ‹‰åˆ—è¡¨æ˜¾ç¤ºå‡ºæ¥æ—¶çš„æ ·å¼ QComboBox:on color: red; background-color: black; å½“ä¸‹æ‹‰æ¡†æŒ‰é’®å¯ç¼–è¾‘è¾“å…¥æ–‡å­—æ—¶çš„æ ·å¼ QComboBox:editable color: white; background-color: #2E3648; æƒ³è¦å¯ç¼–è¾‘æ ·å¼ç”Ÿæ•ˆéœ€è¦è®¾ç½®ä¸‹æ‹‰æ¡†æŒ‰é’®ä¸ºå¯ç¼–è¾‘ï¼Œæ¯”å¦‚è°ƒç”¨ setEditable() æ–¹æ³•ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸€æ—¦å¯ç¼–è¾‘æ ·å¼ç”Ÿæ•ˆï¼Œå…¶å®ƒç±»ä¼¼äº hoverã€on æ‰€è®¾ç½®çš„æ ·å¼éƒ½ä¼šè¢«è¦†ç›–æ‰ï¼Œé™¤éå†æ¬¡è®¾ç½®ä¸ºä¸å¯ç¼–è¾‘ ä¸‹æ‹‰å›¾æ ‡ä¸‹æ‹‰å›¾æ ‡å±äºä¸‹æ‹‰æ¡†æŒ‰é’®çš„ä¸€ä¸ªå­æ§ä»¶ drop-downï¼Œè€Œ drop-down ä¸­åˆåŒ…å« down-arrow å­æ§ä»¶ï¼Œç”¨æ ·å¼è¡¨æŠŠè¿™ä¸¤ä¸ªæ§ä»¶æ˜¾ç¤ºå‡ºæ¥ï¼š QComboBox font-family: Microsoft YaHei; font-size: 14px; color: #000000; font-style: normal; font-weight: bold;QComboBox::drop-down border: 1px solid red;QComboBox::down-arrow border: 1px solid green; åœ¨æ ·å¼è¡¨ä¸­ï¼Œè®¾ç½® drop-down è¾¹æ¡†é¢œè‰²ä¸ºçº¢è‰²ï¼Œdown-arrow è¾¹æ¡†ä¸ºç»¿è‰²ã€‚ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ drop-down æ§ä»¶çš„å¤§å°å’Œä½ç½®ï¼š QComboBox font-family: Microsoft YaHei; font-size: 14px; color: #000000; font-style: normal; font-weight: bold; padding-left: 6px;QComboBox::drop-down width:28px; height:22px; border: 1px solid red; subcontrol-position: center top; subcontrol-origin: padding;QComboBox::down-arrow border: 1px solid green; width å’Œ height è®¾ç½® drop-down çš„å®½é«˜ subcontrol-position è®¾ç½® drop-down çš„ä½ç½®ï¼Œåªæ”¯æŒ left right top bottom centerï¼›å€¼ left right center ä¸ºè®¾ç½®æ°´å¹³ä½ç½®ï¼Œå€¼ top bottom center ä¸ºè®¾ç½®å‚ç›´ä½ç½® subcontrol-origin è®¾ç½® drop-down çš„å¯¹é½æ–¹å¼ï¼Œä¸€èˆ¬è®¾ç½®ä¸º padding å¦‚æœæƒ³è¦è‡ªå®šä¹‰çš„ widthã€heightã€subcontrol-position ç”Ÿæ•ˆï¼Œå¿…é¡»åœ¨ QComboBox æŒ‰é’®ä¸­è®¾ç½® padding çš„å€¼ï¼Œå“ªæ€•è®¾ç½®å€¼ä¸º 0ï¼Œå¦åˆ™æ— æ³•ç”Ÿæ•ˆï¼ å½“ç„¶ï¼Œä¹Ÿå¯ä»¥è®¾ç½® drop-down çš„åœ†è§’åŠå¾„ border-radiusï¼Œå±æ€§å€¼å’Œå…¶å®ƒæ§ä»¶æ ·å¼çš„è®¾ç½®æ–¹å¼ä¸€æ ·ï¼š border-top-left-radius: 6px;border-top-right-radius: 6px;border-bottom-left-radius: 6px;border-bottom-right-radius: 6px;border-radius: 6px; åŒæ—¶ï¼Œè¿˜å¯ä»¥å¾€ drop-down æ·»åŠ å›¾ç‰‡ï¼Œæ–¹å¼æœ‰ä¸¤ç§ï¼š image: url(./arrow_down.png);background-image: url(./arrow_down.png); image è®¾ç½®å”¯ä¸€çš„è‡ªåŠ¨é€‚åº”ä¸é‡å¤çš„å›¾ç‰‡ï¼Œè€Œ background-image åˆ™éœ€è¦æ‰‹åŠ¨è°ƒèŠ‚å®ƒçš„ repeat, position å±æ€§å€¼ã€‚è¿™é‡Œï¼Œä¸æ¨èåœ¨ drop-down ä¸­è®¾ç½®å›¾ç‰‡ï¼Œå› ä¸ºå®ƒæœ‰ä¸€ä¸ªæ›´å¥½æ”¾å›¾ç‰‡çš„æ§ä»¶ down-arrow","categories":["3.å¼€å‘æ¡†æ¶","Qt","æ§ä»¶"]},{"title":"QLabelæ ·å¼è¡¨","path":"/2024/02/28/3-å¼€å‘æ¡†æ¶-Qt-æ§ä»¶-QLabelæ ·å¼è¡¨/","content":"QLabel font-family: Microsoft YaHei; font-size: 14px; color: #BDC8E2; background-color: #2E3648; å­—ä½“æ ·å¼font-family: Microsoft YaHei;font-size: 14px;font-style: italic;font-weight: bold;color: #BDC8E2;font: bold italic 18px Microsoft YaHei; font-family ä¸ºè®¾ç½®å­—ä½“ç±»å‹ï¼Œæ ‡å‡†å½¢å¼éœ€è¦åŠ åŒå¼•å·ï¼Œä¸åŠ ä¹Ÿå¯èƒ½ä¼šç”Ÿæ•ˆï¼Œå…·ä½“çœ‹ç³»ç»Ÿæ˜¯å¦æ”¯æŒï¼Œä¸­è‹±æ–‡éƒ½æ”¯æŒï¼Œä½†è¦ä¿è¯å­—ä½“ç¼–ç æ”¯æŒï¼Œä¸€èˆ¬ç¨‹åºç¼–ç ä¸ºâ€utf-8â€æ—¶æ²¡é—®é¢˜ã€‚ font-size ä¸ºè®¾ç½®å­—ä½“å¤§å°ï¼Œå•ä½ä¸€èˆ¬ä½¿ç”¨ px åƒç´  font-style ä¸ºè®¾ç½®å­—ä½“æ–œä½“æ ·å¼ï¼Œitalic ä¸ºæ–œä½“ï¼Œ normal ä¸ºä¸æ–œä½“ font-weight ä¸ºè®¾ç½®å­—ä½“åŠ ç²—æ ·å¼ï¼Œbold ä¸ºåŠ ç²—ï¼Œ normal ä¸ºä¸åŠ ç²— font ä¸ºåŒæ—¶è®¾ç½®å­—ä½“ style weight size family çš„æ ·å¼ï¼Œä½†æ˜¯ style å’Œ weight å¿…é¡»å‡ºç°åœ¨å¼€å¤´ï¼Œsize å’Œ family åœ¨åé¢ï¼Œè€Œä¸” size å¿…é¡»åœ¨ family ä¹‹å‰ï¼Œå¦åˆ™æ ·å¼å°†ä¸ç”Ÿæ•ˆï¼Œfont ä¸­ä¸èƒ½è®¾ç½®é¢œè‰²ï¼Œå¯ä»¥å•ç‹¬è®¾ç½® style weight å’Œ sizeï¼Œä¸èƒ½å•ç‹¬è®¾ç½® family color ä¸ºè®¾ç½®å­—ä½“é¢œè‰²ï¼Œå¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶æ•°è¡¨ç¤ºé¢œè‰²ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æŸäº›ç‰¹æ®Šçš„å­—ä½“é¢œè‰²ï¼šred, green, blue ç­‰ï¼Œæˆ–è€…ä½¿ç”¨ rgb(r,g,b) å’Œ rgba(r,g,b,a) æ¥è®¾ç½®ï¼Œå…¶ä¸­ rã€gã€bã€a å€¼ä¸º 0~255ï¼Œå¦‚æœæƒ³ä¸æ˜¾ç¤ºé¢œè‰²å¯ä»¥è®¾ç½®å€¼ä¸ºé€æ˜ transparent å­—ä½“é¢œè‰²ç”¨çš„æ˜¯ color å±æ€§ï¼Œæ²¡æœ‰ font-color è¿™ä¸ªå±æ€§çš„ æ–‡å­—ä½ç½®padding-left: 10px;padding-top: 8px;padding-right: 7px;padding-bottom: 9px; padding-left ä¸ºè®¾ç½®æ–‡å­—è·ç¦»å·¦è¾¹è¾¹ç•Œçš„è·ç¦» padding-top ä¸ºè®¾ç½®æ–‡å­—è·ç¦»é¡¶è¾¹è¾¹ç•Œçš„è·ç¦» padding-right ä¸ºè®¾ç½®æ–‡å­—è·ç¦»å³è¾¹è¾¹ç•Œçš„è·ç¦» padding-bottom ä¸ºè®¾ç½®æ–‡å­—è·ç¦»åº•è¾¹è¾¹ç•Œçš„è·ç¦» åœ¨ qss ä¸­ï¼Œå±æ€§ text-align å¯¹ Label æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œåªèƒ½é€šè¿‡è®¾ç½® padding æ¥å®ç°æ–‡å­—çš„æ˜¾ç¤ºä½ç½®ï¼›ä¸€èˆ¬ padding-left ç›¸å½“äº x åæ ‡ï¼Œpadding-top ç›¸å½“äº y åæ ‡ï¼Œè®¾ç½®è¿™ä¸¤ä¸ªå°±å¯ä»¥åœ¨ä»»æ„ä½ç½®æ˜¾ç¤ºäº†ï¼ˆé»˜è®¤æƒ…å†µä¸‹æ–‡å­—æ˜¯ä¸Šä¸‹å·¦å³éƒ½å±…ä¸­æ˜¾ç¤ºçš„ï¼‰ è¾¹æ¡†æ ·å¼border-style: solid;border-width: 2px;border-color: red;border: 2px solid red; border-style ä¸ºè®¾ç½®è¾¹æ¡†æ ·å¼ï¼Œsolid ä¸ºå®çº¿ï¼Œ dashed ä¸ºè™šçº¿ï¼Œ dotted ä¸ºç‚¹çº¿ï¼Œ none ä¸ºä¸æ˜¾ç¤ºï¼ˆå¦‚æœä¸è®¾ç½® border-style çš„è¯ï¼Œé»˜è®¤ä¼šè®¾ç½®ä¸º noneï¼‰ border-width ä¸ºè®¾ç½®è¾¹æ¡†å®½åº¦ï¼Œå•ä½ä¸º px åƒç´  border-color ä¸ºè®¾ç½®è¾¹æ¡†é¢œè‰²ï¼Œå¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶æ•°è¡¨ç¤ºé¢œè‰²ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æŸäº›ç‰¹æ®Šçš„å­—ä½“é¢œè‰²ï¼šred, green, blue ç­‰ï¼Œæˆ–è€…ä½¿ç”¨ rgb(r,g,b) å’Œ rgba(r,g,b,a) æ¥è®¾ç½®ï¼Œå…¶ä¸­ rã€gã€bã€a å€¼ä¸º 0~255ï¼Œå¦‚æœæƒ³ä¸æ˜¾ç¤ºé¢œè‰²å¯ä»¥è®¾ç½®å€¼ä¸ºé€æ˜ transparent border ä¸ºåŒæ—¶è®¾ç½® border çš„ width style color å±æ€§ï¼Œä½†å€¼çš„é¡ºåºå¿…é¡»æ˜¯æŒ‰ç…§ width style color æ¥å†™ï¼Œä¸ç„¶ä¸ä¼šç”Ÿæ•ˆï¼ä¹Ÿå¯ä»¥å•ç‹¬è®¾ç½®æŸä¸€æ¡è¾¹æ¡†çš„æ ·å¼ border-top-style: solid;border-top-width: 2px;border-top-color: red;border-top: 2px solid red; border-top-style ä¸ºè®¾ç½®é¡¶éƒ¨è¾¹æ¡†æ ·å¼ border-top-width ä¸ºè®¾ç½®é¡¶éƒ¨è¾¹æ¡†å®½åº¦ border-top-color ä¸ºè®¾ç½®é¡¶éƒ¨è¾¹æ¡†é¢œè‰² border-top ä¸ºè®¾ç½®é¡¶éƒ¨è¾¹æ¡† width style color çš„å±æ€§ï¼ŒåŸç†å’Œ border ä¸€è‡´å…¶å®ƒä¸‰ä¸ªè¾¹æ¡†ï¼šright bottom left è¾¹æ¡†çš„è®¾ç½®éƒ½ç›¸åŒ è®¾ç½®è¾¹æ¡†åŠå¾„border-top-left-radius: 20px;border-top-right-radius: 20px;border-bottom-left-radius: 20px;border-bottom-right-radius: 20px;border-radius: 20px; border-top-left-radius ä¸ºè®¾ç½®å·¦ä¸Šè§’åœ†è§’åŠå¾„ï¼Œå•ä½ px åƒç´  border-top-right-radius ä¸ºè®¾ç½®å³ä¸Šè§’åœ†è§’åŠå¾„ï¼Œå•ä½ px åƒç´  border-bottom-left-radius ä¸ºè®¾ç½®å·¦ä¸‹è§’åœ†è§’åŠå¾„ï¼Œå•ä½ px åƒç´  border-bottom-right-radius ä¸ºè®¾ç½®å³ä¸Šè§’åœ†è§’åŠå¾„ï¼Œå•ä½ px åƒç´  border-radius ä¸ºè®¾ç½®æ‰€æœ‰è¾¹æ¡†åœ†è§’åŠå¾„ï¼Œå•ä½ä¸º px åƒç´ ï¼Œé€šè¿‡åœ†è§’åŠå¾„å¯ä»¥å®ç°åœ†å½¢çš„ Label èƒŒæ™¯æ ·å¼background-color: #2E3648;background-image: url(./image.png);background-repeat: no-repeat; background-position: left center;background: url(./image.png) no-repeat left center #2E3648; background-color ä¸ºè®¾ç½®èƒŒæ™¯é¢œè‰²ï¼Œå¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶æ•°è¡¨ç¤ºé¢œè‰²ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æŸäº›ç‰¹æ®Šçš„å­—ä½“é¢œè‰²ï¼šred, green, blue ç­‰ï¼Œæˆ–è€…ä½¿ç”¨ rgb(r,g,b) å’Œ rgba(r,g,b,a) æ¥è®¾ç½®ï¼Œå…¶ä¸­ rã€gã€bã€a å€¼ä¸º 0~255ï¼Œå¦‚æœæƒ³ä¸æ˜¾ç¤ºé¢œè‰²å¯ä»¥è®¾ç½®å€¼ä¸ºé€æ˜ transparent background-image ä¸ºè®¾ç½®èƒŒæ™¯å›¾ç‰‡ï¼Œå›¾ç‰‡è·¯å¾„ä¸º url(image-path) background-repeat ä¸ºè®¾ç½®èƒŒæ™¯å›¾æ˜¯å¦é‡å¤å¡«å……èƒŒæ™¯ï¼Œå¦‚æœèƒŒæ™¯å›¾ç‰‡å°ºå¯¸å°äºèƒŒæ™¯å®é™…å¤§å°çš„è¯ï¼Œé»˜è®¤ä¼šè‡ªåŠ¨é‡å¤å¡«å……å›¾ç‰‡ï¼Œå¯ä»¥è®¾ç½®ä¸º no-repeat ä¸é‡å¤ï¼Œrepeat-x åœ¨ x è½´é‡å¤ï¼Œrepeat-y åœ¨ y è½´é‡å¤ background-position ä¸ºè®¾ç½®èƒŒæ™¯å›¾ç‰‡æ˜¾ç¤ºä½ç½®ï¼Œåªæ”¯æŒ left right top bottom centerï¼›å€¼ left right center ä¸ºè®¾ç½®æ°´å¹³ä½ç½®ï¼Œå€¼ top bottom center ä¸ºè®¾ç½®å‚ç›´ä½ç½® background ä¸ºè®¾ç½®èƒŒæ™¯çš„æ‰€æœ‰å±æ€§ï¼Œcolor image repeat position è¿™äº›å±æ€§å€¼å‡ºç°çš„é¡ºåºå¯ä»¥ä»»æ„ ç¤ºä¾‹QLabel font-family: Microsoft YaHei; font-size: 18px; color: #BDC8E2; font-style: normal; font-weight: normal; border-style: solid; border-width: 2px; border-color: aqua; border-radius: 20px; padding-left: 20px; padding-top: 0px; background-color: #2E3648; background-image: url(./image.png); background-repeat: no-repeat; background-position: left center; åŠ¨æ€æ ·å¼é¼ æ ‡æ‚¬æµ®æ—¶çš„æ ·å¼ QLabel:hovercolor: red;border-color: green; background-color: aqua; æ ‡ç­¾ç¦æ­¢æ—¶çš„æ ·å¼ QLabel:disabledcolor: blue;border-color: brown; background-color: aqua; ä¸è¿‡ï¼Œé—æ†¾çš„æ˜¯ï¼Œæ ‡ç­¾å¹¶æ²¡æœ‰ç‚¹å‡» pressed è¿™ç§æ ·å¼çš„","categories":["3.å¼€å‘æ¡†æ¶","Qt","æ§ä»¶"]},{"title":"QPushButtonæ ·å¼è¡¨","path":"/2024/02/27/3-å¼€å‘æ¡†æ¶-Qt-æ§ä»¶-QPushButtonæ ·å¼è¡¨/","content":"QPushButton font-family: Microsoft YaHei; font-size: 16px; color: #BDC8E2; background-color: #2E3648; å­—ä½“æ ·å¼font-family: Microsoft YaHei;font-size: 14px;font-style: italic;font-weight: bold;color: #BDC8E2;font: bold italic 18px Microsoft YaHei; font-family ä¸ºè®¾ç½®å­—ä½“ç±»å‹ï¼Œæ ‡å‡†å½¢å¼éœ€è¦åŠ åŒå¼•å·ï¼Œä¸åŠ ä¹Ÿå¯èƒ½ä¼šç”Ÿæ•ˆï¼Œå…·ä½“çœ‹ç³»ç»Ÿæ˜¯å¦æ”¯æŒï¼Œä¸­è‹±æ–‡éƒ½æ”¯æŒï¼Œä½†è¦ä¿è¯å­—ä½“ç¼–ç æ”¯æŒï¼Œä¸€èˆ¬ç¨‹åºç¼–ç ä¸ºâ€utf-8â€æ—¶æ²¡é—®é¢˜ã€‚ font-size ä¸ºè®¾ç½®å­—ä½“å¤§å°ï¼Œå•ä½ä¸€èˆ¬ä½¿ç”¨ px åƒç´  font-style ä¸ºè®¾ç½®å­—ä½“æ–œä½“ï¼Œitalic ä¸ºæ–œä½“ï¼Œ normal ä¸ºä¸æ–œä½“ font-weight ä¸ºè®¾ç½®å­—ä½“åŠ ç²—ï¼Œbold ä¸ºåŠ ç²—ï¼Œ normal ä¸ºä¸åŠ ç²— font ä¸ºåŒæ—¶è®¾ç½®å­—ä½“ style weight size family çš„æ ·å¼ï¼Œä½†æ˜¯ style å’Œ weight å¿…é¡»å‡ºç°åœ¨å¼€å¤´ï¼Œsize å’Œ family åœ¨åé¢ï¼Œè€Œä¸” size å¿…é¡»åœ¨ family ä¹‹å‰ï¼Œå¦åˆ™æ ·å¼å°†ä¸ç”Ÿæ•ˆï¼Œfont ä¸­ä¸èƒ½è®¾ç½®é¢œè‰²ï¼Œå¯ä»¥å•ç‹¬è®¾ç½® style weight å’Œ sizeï¼Œä¸èƒ½å•ç‹¬è®¾ç½® family color ä¸ºè®¾ç½®å­—ä½“é¢œè‰²ï¼Œå¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶æ•°è¡¨ç¤ºé¢œè‰²ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æŸäº›ç‰¹æ®Šçš„å­—ä½“é¢œè‰²ï¼šred, green, blue ç­‰ï¼Œæˆ–è€…ä½¿ç”¨ rgb(r,g,b) å’Œ rgba(r,g,b,a) æ¥è®¾ç½®ï¼Œå…¶ä¸­ rã€gã€bã€a å€¼ä¸º 0~255ï¼Œå¦‚æœæƒ³ä¸æ˜¾ç¤ºé¢œè‰²å¯ä»¥è®¾ç½®å€¼ä¸ºé€æ˜ transparent å­—ä½“é¢œè‰²ç”¨çš„æ˜¯ color å±æ€§ï¼Œæ²¡æœ‰ font-color è¿™ä¸ªå±æ€§çš„ æ–‡å­—ä½ç½®text-align: left center;padding-left: 10px;padding-top: 8px;padding-right: 7px;padding-bottom: 9px; text-align ä¸ºè®¾ç½®æ–‡å­—ä½ç½®ï¼Œåªæ”¯æŒ left right top bottom centerï¼›å€¼ left right center ä¸ºè®¾ç½®æ°´å¹³ä½ç½®ï¼Œå€¼ top bottom center ä¸ºè®¾ç½®å‚ç›´ä½ç½® padding-left ä¸ºè®¾ç½®æ–‡å­—è·ç¦»å·¦è¾¹è¾¹ç•Œçš„è·ç¦» padding-top ä¸ºè®¾ç½®æ–‡å­—è·ç¦»é¡¶è¾¹è¾¹ç•Œçš„è·ç¦» padding-right ä¸ºè®¾ç½®æ–‡å­—è·ç¦»å³è¾¹è¾¹ç•Œçš„è·ç¦» padding-bottom ä¸ºè®¾ç½®æ–‡å­—è·ç¦»åº•è¾¹è¾¹ç•Œçš„è·ç¦» ç‰¹æ®Šçš„ä½ç½®å¯ä»¥ä½¿ç”¨ text-align æ¥è®¾ç½®ï¼Œå¦‚æœè¦ç²¾ç¡®è®¾ç½®ä½ç½®åªèƒ½é€šè¿‡ padding æ¥è®¾ç½®ï¼Œä¸€èˆ¬ padding-left ç›¸å½“äº x åæ ‡ï¼Œpadding-top ç›¸å½“äº y åæ ‡ï¼Œè®¾ç½®è¿™ä¸¤ä¸ªå°±å¯ä»¥æ˜¾ç¤ºä»»æ„ä½ç½®æ˜¾ç¤ºäº†ï¼ˆé»˜è®¤æƒ…å†µä¸‹æ–‡å­—æ˜¯ä¸Šä¸‹å·¦å³éƒ½å±…ä¸­æ˜¾ç¤ºçš„ï¼‰ è¾¹æ¡†æ ·å¼border-style: solid;border-width: 2px;border-color: red;border: 2px solid red; border-style ä¸ºè®¾ç½®è¾¹æ¡†æ ·å¼ï¼Œsolid ä¸ºå®çº¿ï¼Œ dashed ä¸ºè™šçº¿ï¼Œ dotted ä¸ºç‚¹çº¿ï¼Œ none ä¸ºä¸æ˜¾ç¤ºï¼ˆå¦‚æœä¸è®¾ç½® border-style çš„è¯ï¼Œé»˜è®¤ä¼šè®¾ç½®ä¸º noneï¼‰ border-width ä¸ºè®¾ç½®è¾¹æ¡†å®½åº¦ï¼Œå•ä½ä¸º px åƒç´  border-color ä¸ºè®¾ç½®è¾¹æ¡†é¢œè‰²ï¼Œå¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶æ•°è¡¨ç¤ºé¢œè‰²ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æŸäº›ç‰¹æ®Šçš„å­—ä½“é¢œè‰²ï¼šred, green, blue ç­‰ï¼Œæˆ–è€…ä½¿ç”¨ rgb(r,g,b) å’Œ rgba(r,g,b,a) æ¥è®¾ç½®ï¼Œå…¶ä¸­ rã€gã€bã€a å€¼ä¸º 0~255ï¼Œå¦‚æœæƒ³ä¸æ˜¾ç¤ºé¢œè‰²å¯ä»¥è®¾ç½®å€¼ä¸ºé€æ˜ transparent border ä¸ºåŒæ—¶è®¾ç½® border çš„ width style color å±æ€§ï¼Œä½†å€¼çš„é¡ºåºå¿…é¡»æ˜¯æŒ‰ç…§ width style color æ¥å†™ï¼Œä¸ç„¶ä¸ä¼šç”Ÿæ•ˆï¼ ä¹Ÿå¯ä»¥å•ç‹¬è®¾ç½®æŸä¸€æ¡è¾¹æ¡†çš„æ ·å¼ border-top-style: solid;border-top-width: 2px;border-top-color: red;border-top: 2px solid red;border-right-style: solid;border-right-width: 3px;border-right-color: green;border-right: 3px solid green;border-bottom-style: solid;border-bottom-width: 2px;border-bottom-color: blue;border-bottom: 2px solid blue;border-left-style: solid;border-left-width: 3px;border-left-color: aqua;border-left: 3px solid aqua; border-top-style ä¸ºè®¾ç½®é¡¶éƒ¨è¾¹æ¡†æ ·å¼ border-top-width ä¸ºè®¾ç½®é¡¶éƒ¨è¾¹æ¡†å®½åº¦ border-top-color ä¸ºè®¾ç½®é¡¶éƒ¨è¾¹æ¡†é¢œè‰² border-top ä¸ºè®¾ç½®é¡¶éƒ¨è¾¹æ¡† width style color çš„å±æ€§ï¼ŒåŸç†å’Œ border ä¸€è‡´å…¶å®ƒä¸‰ä¸ªè¾¹æ¡†ï¼šright bottom left è¾¹æ¡†çš„è®¾ç½®éƒ½ç›¸åŒ è®¾ç½®è¾¹æ¡†åŠå¾„border-top-left-radius: 20px;border-top-right-radius: 20px;border-bottom-left-radius: 20px;border-bottom-right-radius: 20px;border-radius: 20px; border-top-left-radius ä¸ºè®¾ç½®å·¦ä¸Šè§’åœ†è§’åŠå¾„ï¼Œå•ä½ px åƒç´  border-top-right-radius ä¸ºè®¾ç½®å³ä¸Šè§’åœ†è§’åŠå¾„ï¼Œå•ä½ px åƒç´  border-bottom-left-radius ä¸ºè®¾ç½®å·¦ä¸‹è§’åœ†è§’åŠå¾„ï¼Œå•ä½ px åƒç´  border-bottom-right-radius ä¸ºè®¾ç½®å³ä¸Šè§’åœ†è§’åŠå¾„ï¼Œå•ä½ px åƒç´  border-radius ä¸ºè®¾ç½®æ‰€æœ‰è¾¹æ¡†åœ†è§’åŠå¾„ï¼Œå•ä½ä¸º px åƒç´ ï¼Œé€šè¿‡åœ†è§’åŠå¾„å¯ä»¥å®ç°åœ†å½¢çš„ PushButton èƒŒæ™¯æ ·å¼background-color: #2E3648;background-image: url(./image.png);background-repeat: no-repeat; background-position: left center;background: url(./image.png) no-repeat left center #2E3648; background-color ä¸ºè®¾ç½®èƒŒæ™¯é¢œè‰²ï¼Œå¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶æ•°è¡¨ç¤ºé¢œè‰²ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æŸäº›ç‰¹æ®Šçš„å­—ä½“é¢œè‰²ï¼šred, green, blue ç­‰ï¼Œæˆ–è€…ä½¿ç”¨ rgb(r,g,b) å’Œ rgba(r,g,b,a) æ¥è®¾ç½®ï¼Œå…¶ä¸­ rã€gã€bã€a å€¼ä¸º 0~255ï¼Œå¦‚æœæƒ³ä¸æ˜¾ç¤ºé¢œè‰²å¯ä»¥è®¾ç½®å€¼ä¸ºé€æ˜ transparent background-image ä¸ºè®¾ç½®èƒŒæ™¯å›¾ç‰‡ï¼Œå›¾ç‰‡è·¯å¾„ä¸º url(image-path) background-repeat ä¸ºè®¾ç½®èƒŒæ™¯å›¾æ˜¯å¦é‡å¤å¡«å……èƒŒæ™¯ï¼Œå¦‚æœèƒŒæ™¯å›¾ç‰‡å°ºå¯¸å°äºèƒŒæ™¯å®é™…å¤§å°çš„è¯ï¼Œé»˜è®¤ä¼šè‡ªåŠ¨é‡å¤å¡«å……å›¾ç‰‡ï¼Œå¯ä»¥è®¾ç½®ä¸º no-repeat ä¸é‡å¤ï¼Œrepeat-x åœ¨ x è½´é‡å¤ï¼Œrepeat-y åœ¨ y è½´é‡å¤ background-position ä¸ºè®¾ç½®èƒŒæ™¯å›¾ç‰‡æ˜¾ç¤ºä½ç½®ï¼Œåªæ”¯æŒ left right top bottom centerï¼›å€¼ left right center ä¸ºè®¾ç½®æ°´å¹³ä½ç½®ï¼Œå€¼ top bottom center ä¸ºè®¾ç½®å‚ç›´ä½ç½® background ä¸ºè®¾ç½®èƒŒæ™¯çš„æ‰€æœ‰å±æ€§ï¼Œcolor image repeat position è¿™äº›å±æ€§å€¼å‡ºç°çš„é¡ºåºå¯ä»¥ä»»æ„ ç¤ºä¾‹QPushButton font-family: Microsoft YaHei; font-size: 16px; color: #BDC8E2; font-style: italic; font-weight: bold; text-align: left center; padding-left: 25px; padding-top: 0px; border-style: solid; border-width: 2px; border-color: aqua; border-radius: 20px; background-color: #2E3648; background-image: url(./image.png); background-repeat: no-repeat; background-position: left center; åŠ¨æ€æ ·å¼è®¾ç½®é¼ æ ‡æ‚¬æµ®æ—¶çš„æ ·å¼ QPushButton:hover\tcolor: red;\tborder-color: green; background-color: aqua; é¼ æ ‡ç‚¹å‡»æ—¶çš„æ ·å¼ QPushButton:pressed\tcolor: green;\tborder-color: blueviolet; background-color: black; æŒ‰é’®ç¦æ­¢æ—¶çš„æ ·å¼ QPushButton:disabled\tcolor: blue;\tborder-color: brown; background-color: aqua; ä¸‹æ‹‰èœå•å¯¹äº QPushButtonï¼Œå¯ä»¥ç»™å®ƒè®¾ç½®æ·»åŠ ä¸€ä¸ªä¸‹æ‹‰èœå•ï¼Œè¿™éœ€è¦è°ƒç”¨ QPushButton çš„ setMenu() æ–¹æ³•ï¼Œå½“èœå•è®¾ç½®æˆåŠŸåï¼ŒQPushButton å°±ä¼šé»˜è®¤æ·»åŠ ä¸€ä¸ª menu-indicator ä¸‹æ‹‰èœå•æŒ‡ç¤ºå™¨å›¾æ ‡ï¼Œå¯ä»¥å¯¹è¿™ä¸ªèœå•å›¾æ ‡è¿›è¡Œæ ·å¼ä¿®æ”¹ QPushButton::menu-indicator image: url(./image.png); subcontrol-position: right center; subcontrol-origin: padding; right: 10px; top: 15px; image ä¸ºè®¾ç½®èœå•æŒ‡ç¤ºå™¨å›¾æ ‡ subcontrol-position è®¾ç½®èœå•æŒ‡ç¤ºå™¨å›¾æ ‡çš„ä½ç½®ï¼Œå¦‚æœä¸è®¾ç½®çš„è¯ä¼šé»˜è®¤æ”¾åœ¨å³ä¸‹è§’ subcontrol-origin ä¸ºè®¾ç½®èœå•æŒ‡ç¤ºå™¨å›¾æ ‡ä¸æŒ‰é’®ä¹‹é—´çš„åœé ä½ç½®ï¼Œé»˜è®¤ä¸º padding right top left bottom ä¸ºè®¾ç½®èœå•æŒ‡ç¤ºå™¨å›¾æ ‡è·ç¦»æŒ‰é’®å››ä¸ªä½ç½®çš„è·ç¦» å½“ç„¶ä¸‹æ‹‰èœå•æŒ‡ç¤ºå™¨å›¾æ ‡ä¹Ÿæœ‰åŠ¨æ€æ ·å¼ QPushButton::menu-indicator:hover image: url(./image1.png)QPushButton::menu-indicator:pressed image: url(./image2.png)QPushButton::menu-indicator:open image: url(./image2.png) å¯¹äº menu-indicator æ¥è¯´ pressed å’Œ open åŸç†ç›¸åŒ","categories":["3.å¼€å‘æ¡†æ¶","Qt","æ§ä»¶"]},{"title":"Linuxä¸‹Cç¨‹åºæ’å…¥shellè„šæœ¬","path":"/2024/02/26/2-ç¼–ç¨‹è¯­è¨€-Shell-Linuxä¸‹Cç¨‹åºæ’å…¥shellè„šæœ¬/","content":"linux ä¸‹ C ç¨‹åºæ’å…¥æ‰§è¡Œ shell è„šæœ¬æœ€è¿‘åœ¨çœ‹æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿï¼Œçœ‹åˆ°ä¸€ä¸ªå‡½æ•°å«åš execve()ï¼Œè¿™ä¸ªå‡½æ•°å¾ˆæœ‰æ„æ€ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹æ’å…¥å¦å¤–ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œï¼Œä½†æ˜¯åˆä¸åƒ fork()ä¸€æ ·äº§ç”Ÿä¸€ä¸ªå­è¿›ç¨‹ï¼Œexecve()æ’å…¥çš„è¿›ç¨‹å’ŒåŸè¿›ç¨‹å…±äº«è¿›ç¨‹å·ï¼Œå°±å¥½åƒæ‰§è¡Œè¿™è¿›ç¨‹å°±åƒæ‰§è¡Œè¿‡ç¨‹è°ƒç”¨ä¸€èˆ¬éšæ„ã€‚ å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š int execve(const char *filename, char *const argv[], char *const envp[]); EXAMPLE The following program is designed to be execed by the second program below. It just echoes its command-line one per line. * myecho.c * #include stdio.h#include stdlib.hintmain(int argc, char *argv[])\tint j;\tfor (j = 0; j argc; j++)\tprintf(argv[%d]: %s , j, argv[j]);\texit(EXIT_SUCCESS); This program can be used to exec the program named in its command-line argument: * execve.c * #include stdio.h#include stdlib.h#include unistd.hintmain(int argc, char *argv[])\tchar *newargv[] = NULL, hello, world, NULL ;\tchar *newenviron[] = NULL ;\tif (argc != 2) fprintf(stderr, Usage: %s file-to-exec , argv[0]); exit(EXIT_FAILURE); newargv[0] = argv[1];\texecve(argv[1], newargv, newenviron);\tperror(execve); /* execve() only returns on error */\texit(EXIT_FAILURE); We can use the second program to exec the first as follows: $ cc myecho.c -o myecho$ cc execve.c -o execve$ ./execve ./myechoargv[0]: ./myechoargv[1]: helloargv[2]: world æ’å…¥ä¸€ä¸ª shell è„šæœ¬æ‰§è¡Œï¼š#include stdio.h#include stdlib.h#include unistd.hintmain(int argc, char *argv[])\tchar *newargv[] = /etc ;\tchar *newenviron[] = NULL ;\tif (argc != 2) fprintf(stderr, Usage: %s file-to-exec , argv[0]); exit(EXIT_FAILURE); newargv[0] = argv[1];\texecve(argv[1], newargv, newenviron);\tperror(execve); /* execve() only returns on error */\texit(EXIT_FAILURE); script.sh å¦‚ä¸‹ï¼š #!/bin/bashls æ‰§è¡Œï¼š ./execve ./script.sh ä¼šåœ¨å½“å‰ç»ˆç«¯ä¸‹è¾“å‡ºæ‰€æœ‰çš„æ–‡ä»¶ yca@ubuntu:~/æ¡Œé¢/hello$ ./execve ./script.sh1 execve hello1 hello3 hello5 hello_lex1.txt execve.c hello1.c hello3.cpp hello5.c k_maxBubble hello hello1.o hello3.o hello5.o k_max.cBubble.c hello.c hello2.c hello3.s hello5.s lex.yy.cQuickSort.c hello.lex hello2.o hello4 hello5.s1 script.shQuicksort1.c hello.sh hello2.s hello4.c hello51.s","categories":["2.ç¼–ç¨‹è¯­è¨€","Shell"]},{"title":"shellä»‹ç»","path":"/2024/02/23/2-ç¼–ç¨‹è¯­è¨€-Shell-shellä»‹ç»/","content":"shellshell æ˜¯ä¸€ä¸ªç¼–ç¨‹è¯­è¨€ï¼Œå®ƒå®šä¹‰äº†å„ç§å˜é‡å’Œå‚æ•°ï¼Œå¹¶æä¾›äº†è®¸å¤šåœ¨é«˜çº§è¯­è¨€ä¸­æ‰å…·æœ‰çš„æ§åˆ¶ç»“æ„ï¼ŒåŒ…æ‹¬å¾ªç¯å’Œåˆ†æ”¯ï¼›ä¹Ÿæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œè§£é‡Šå™¨ï¼Œäº¤äº’å¼åœ°è§£é‡Šå’Œæ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼›è¿˜æ˜¯å†…æ ¸çš„ä¿æŠ¤å·¥å…·ï¼Œå®ƒè°ƒç”¨äº†ç³»ç»Ÿæ ¸å¿ƒçš„å¤§éƒ¨åˆ†åŠŸèƒ½æ¥æ‰§è¡Œç¨‹åºã€å»ºç«‹æ–‡ä»¶å¹¶ä»¥å¹¶è¡Œçš„æ–¹å¼åè°ƒå„ä¸ªç¨‹åºçš„è¿è¡Œã€‚ Shell æœ‰ä¸¤ç§æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ï¼š äº¤äº’å¼ï¼ˆInteractiveï¼‰ï¼šè§£é‡Šæ‰§è¡Œç”¨æˆ·çš„å‘½ä»¤ï¼Œç”¨æˆ·è¾“å…¥ä¸€æ¡å‘½ä»¤ï¼ŒShell å°±è§£é‡Šæ‰§è¡Œä¸€æ¡ã€‚ æ‰¹å¤„ç†ï¼ˆBatchï¼‰ï¼šç”¨æˆ·äº‹å…ˆå†™ä¸€ä¸ª Shell è„šæœ¬ (Script)ï¼Œshell è„šæœ¬æ˜¯ shell å‘½ä»¤çš„æœ‰é™åºåˆ—ï¼Œå°†å„ç±»å‘½ä»¤é¢„å…ˆæ”¾å…¥å…¶ä¸­ï¼Œæ–¹ä¾¿ä¸€æ¬¡æ€§æ‰§è¡Œçš„ä¸€ä¸ªç¨‹åºæ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæ–¹ä¾¿ç®¡ç†å‘˜è¿›è¡Œè®¾ç½®æˆ–è€…ç®¡ç†ï¼Œè€Œä¸å¿…ä¸€æ¡ä¸€æ¡åœ°æ•²å‘½ä»¤ã€‚ Shell è„šæœ¬æ˜¯è§£é‡Šæ‰§è¡Œçš„ï¼Œä¸éœ€è¦ç¼–è¯‘ï¼ŒShell ç¨‹åºä»è„šæœ¬ä¸­ä¸€è¡Œä¸€è¡Œè¯»å–å¹¶æ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œç›¸å½“äºä¸€ä¸ªç”¨æˆ·æŠŠè„šæœ¬ä¸­çš„å‘½ä»¤ä¸€è¡Œä¸€è¡Œæ•²åˆ° Shell æç¤ºç¬¦ä¸‹æ‰§è¡Œ Linux çš„ Shell ç§ç±»ä¼—å¤šï¼Œå¸¸è§çš„æœ‰ï¼šBourne Shellï¼ˆusrbinsh æˆ–binshï¼‰ã€Bourne Again Shellï¼ˆbinbashï¼‰ã€C Shellï¼ˆusrbincshï¼‰ã€K Shellï¼ˆusrbinkshï¼‰ã€Shell for Rootï¼ˆsbinshï¼‰ç­‰ç­‰ã€‚ ä¸åŒçš„ Shell è¯­è¨€çš„è¯­æ³•æœ‰æ‰€ä¸åŒï¼Œæ‰€ä»¥ä¸èƒ½äº¤æ¢ä½¿ç”¨ã€‚å…³æ³¨çš„é‡ç‚¹æ˜¯ Bashï¼ŒBash ä¹Ÿæ˜¯å¤§å¤šæ•° Linux ç³»ç»Ÿé»˜è®¤çš„ Shellã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œäººä»¬å¹¶ä¸åŒºåˆ† Bourne Shell å’Œ Bourne Again Shellï¼Œæ‰€ä»¥ï¼Œåœ¨ä¸‹é¢çš„æ–‡å­—ä¸­ï¼Œå¯ä»¥çœ‹åˆ°#!binshï¼Œå®ƒåŒæ ·ä¹Ÿå¯ä»¥æ”¹ä¸º#!binbashã€‚ ç¼–å†™ Shell è„šæœ¬çš„æ ¼å¼æ˜¯å›ºå®šçš„ï¼Œä¸€ä¸ªç®€å•çš„ shell è„šæœ¬å¦‚ä¸‹ï¼š #!/bin/sh#print hello world in the console windowa = hello worldecho $a é¦–è¡Œä¸­çš„ç¬¦å· #! å‘Šè¯‰ç³»ç»Ÿå…¶åè·¯å¾„æ‰€æŒ‡å®šçš„ç¨‹åºå³æ˜¯è§£é‡Šæ­¤è„šæœ¬æ–‡ä»¶çš„ Shell ç¨‹åºã€‚ å¦‚æœé¦–è¡Œæ²¡æœ‰è¿™å¥è¯ï¼Œåœ¨æ‰§è¡Œè„šæœ¬æ–‡ä»¶çš„æ—¶å€™ï¼Œå°†ä¼šå‡ºç°é”™è¯¯ã€‚ åç»­çš„éƒ¨åˆ†å°±æ˜¯ä¸»ç¨‹åºï¼ŒShell è„šæœ¬åƒé«˜çº§è¯­è¨€ä¸€æ ·ï¼Œä¹Ÿæœ‰å˜é‡èµ‹å€¼ï¼Œä¹Ÿæœ‰æ§åˆ¶è¯­å¥ã€‚ é™¤ç¬¬ä¸€è¡Œå¤–ï¼Œä»¥#å¼€å¤´çš„è¡Œå°±æ˜¯æ³¨é‡Šè¡Œï¼Œç›´åˆ°æ­¤è¡Œçš„ç»“æŸã€‚ å¦‚æœä¸€è¡Œæœªå®Œæˆï¼Œå¯ä»¥åœ¨è¡Œå°¾åŠ ä¸Š â€œï¼Œè¿™ä¸ªç¬¦å·è¡¨æ˜ä¸‹ä¸€è¡Œä¸æ­¤è¡Œä¼šåˆå¹¶ä¸ºåŒä¸€è¡Œã€‚ ç¼–è¾‘å®Œæ¯•ï¼Œå°†è„šæœ¬å­˜ç›˜ä¸º filename.shï¼Œæ–‡ä»¶ååç¼€ sh è¡¨æ˜è¿™æ˜¯ä¸€ä¸ª Bash è„šæœ¬æ–‡ä»¶ã€‚æ‰§è¡Œæ–¹å¼ï¼š 1.åŠ å¯æ‰§è¡Œæƒé™ chmod u+x filename.sh ./filename.sh2.æ‰§è¡Œé€šè¿‡bashè¿è¡Œ /bin/bash filename.sh3.å°†è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ chmod u+x filename.sh PATH+=:/home/fs/Temp filename.sh //ä»»æ„ç›®å½•è¿è¡Œ4.æ·»åŠ åˆ°binæ–‡ä»¶å¤¹ chmod u+x filename.sh sudo mv filename.sh /bin/ æ³¨æ„ï¼Œä¸€å®šè¦å†™æˆ.filename.shï¼Œè€Œä¸æ˜¯ filename.shã€‚è¿è¡Œå…¶å®ƒäºŒè¿›åˆ¶çš„ç¨‹åºä¹Ÿä¸€æ ·ï¼Œç›´æ¥å†™ filename.shï¼Œlinux ç³»ç»Ÿä¼šå» PATH é‡Œå¯»æ‰¾æœ‰æ²¡æœ‰å« filename.sh çš„ï¼Œè€Œåªæœ‰bin, sbin, usrbinï¼Œusrsbin ç­‰åœ¨ PATH é‡Œï¼Œçš„å½“å‰ç›®å½•é€šå¸¸ä¸åœ¨ PATH é‡Œï¼Œæ‰€ä»¥å†™æˆ filename.sh æ˜¯ä¼šæ‰¾ä¸åˆ°å‘½ä»¤çš„ï¼Œè¦ç”¨.filename.sh å‘Šè¯‰ç³»ç»Ÿè¯´ï¼Œå°±åœ¨å½“å‰ç›®å½•æ‰¾ã€‚ é€ŸæŸ¥è¡¨ å‘½ä»¤ å«ä¹‰ %!xxd å°†äºŒè¿›åˆ¶æ–‡ä»¶è½¬æ¢ä¸º 16 è¿›åˆ¶å’Œ ASCII è¡¨å½¢å¼æŸ¥çœ‹ * ä»£è¡¨é€šé…ç¬¦ï¼Œå¯ä»£è¡¨ä»»æ„é•¿åº¦çš„ä»»æ„å­—ç¬¦ï¼› ï¼Ÿ å¯ä»£è¡¨å•ä¸ªé•¿åº¦çš„ä»»æ„å­—ç¬¦ [] é€šé…æ‹¬å·ä¸­çš„å…ƒç´  [^â€¦â€¦] é™¤å»æ‹¬å·ä¸­çš„å…ƒç´ ï¼Œå…¶ä»–é€šé… file å°†è¾“å‡ºé‡å®šå‘åˆ° file ä¸­å»ï¼ˆæ–°å»ºï¼‰ file å°†è¾“å‡ºé‡å®šå‘åˆ° file ä¸­å»ï¼ˆè¿½åŠ æ¨¡å¼ï¼‰ file å°† file ä½œä¸ºæ ‡å‡†è¾“å…¥ 2 æˆ– â€“æ ‡å‡†é”™è¯¯ pipe ç®¡é“,å°†ç¬¬ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºç¬¬äºŒä¸ªå‘½ä»¤çš„è¾“å…¥ shell å‘½ä»¤ä½¿ç”¨ tab è¡¥é½ï¼šå‘½ä»¤ æ–‡ä»¶å è·¯å¾„ history ï¼šæŸ¥çœ‹å‘½ä»¤å†å² é€šé…ç¬¦ *ï¼šåŒ¹é…ä»»æ„é•¿åº¦ä»»æ„å­—ç¬¦ä¸² ç®¡é“ |ï¼šç¬¬ä¸€ä¸ªæŒ‡ä»¤çš„è¾“å‡ºä½œä¸ºç¬¬äºŒä¸ªæŒ‡ä»¤çš„è¾“å…¥ï¼šls /usr/bin | wc -l é‡å®šå‘ : å‘½ä»¤ç½®æ¢ï¼šåæ’‡å· ls `pwd` å¸¸ç”¨å‘½ä»¤ ç”¨æˆ·ç®¡ç†å‘½ä»¤ è¿›ç¨‹ç®¡ç†å‘½ä»¤ é€šé…ç¬¦*?[...][-][^...][a-z, ABC] // è¡¨ç¤ºåŒ¹é…aåˆ°zå’ŒA,B,Cä¸­ä»»æ„ä¸€ä¸ªå­—ç¬¦ls file[3-4][5-9].c /*è¡¨ç¤ºååŒ¹é…æ–‡ä»¶åå«[3-4]ä¸­çš„ä¸€ä¸ªå­—ç¬¦å’Œ[5-9]ä¸­çš„ä¸€ä¸ªå­—ç¬¦ï¼Œä¸¤ä¸ªå­—ç¬¦çš„å…±ä¸¤ä¸ªå­—ç¬¦çš„æ–‡ä»¶åéƒ½ç¬¦åˆè§„åˆ™ã€‚*/ ç®¡é“| å°†ç¬¬ä¸€ä¸ªå‘½ä»¤çš„æ­£ç¡®è¾“å‡ºå†…å®¹ é€šè¿‡ç®¡é“è¾“å‡ºç»™ ç¬¬äºŒä¸ªå‘½ä»¤ä½œä¸ºè¾“å…¥.è¦æ±‚ç¬¬ä¸€ä¸ªå‘½ä»¤æœ‰è¾“å‡ºï¼Œç¬¬äºŒä¸ªå‘½ä»¤æœ‰è¾“å…¥åŠŸèƒ½ã€‚ é‡å®šå‘echo hello world test å°†å†…å®¹è¾“å‡ºåˆ°æ–‡ä»¶ test ä¸­ã€‚ echo hello Eric test å°†å­—ç¬¦ä¸²å†…å®¹è¿½åŠ åˆ° test ä¸­,åœ¨ test åŸæœ‰çš„å†…å®¹ä¸Šæ·»åŠ  2 2 å°†æŠ¥é”™ä¿¡æ¯é‡å®šå‘æˆ–è¿½åŠ åˆ°æŒ‡å®šæ–‡ä»¶. å°†æ­£ç¡®ä¿¡æ¯å’Œé”™è¯¯ä¿¡æ¯ä¸€èµ·é‡å®šå‘æˆ–è¿½åŠ åˆ°æŒ‡å®šæ–‡ä»¶ã€‚ 0 æ ‡å‡†è¾“å…¥ stdin 1 æ ‡å‡†è¾“å‡º stdout â€˜ â€™ main() return ; fflush(stdout); 2 æ ‡å‡†å‡ºé”™ stderr /dev/null æ˜¯ä¸€ä¸ªè¢«ç§°ä½œ Linux é»‘æ´çš„æ–‡ä»¶ï¼ŒæŠŠè¾“å‡ºä¿¡æ¯é‡å®šå‘åˆ°è¿™ä¸ªæ–‡ä»¶ç­‰åŒäºåˆ é™¤æ•°æ® cat /dev/null ~/.bash_history // åˆ©ç”¨/dev/nullæ¸…ç©ºæŒ‡å®šæ–‡ä»¶ã€‚/dev/zero command file å°†è¾“å‡ºé‡å®šå‘åˆ° fileã€‚ command file å°†è¾“å…¥é‡å®šå‘åˆ° fileã€‚ command file å°†è¾“å‡ºä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘åˆ° fileã€‚ n file å°†æ–‡ä»¶æè¿°ç¬¦ä¸º n çš„æ–‡ä»¶é‡å®šå‘åˆ° fileã€‚ n file å°†æ–‡ä»¶æè¿°ç¬¦ä¸º n çš„æ–‡ä»¶ä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘åˆ° fileã€‚ n m å°†è¾“å‡ºæ–‡ä»¶ m å’Œ n åˆå¹¶ã€‚ n m å°†è¾“å…¥æ–‡ä»¶ m å’Œ n åˆå¹¶ã€‚ tag å°†å¼€å§‹æ ‡è®° tag å’Œç»“æŸæ ‡è®° tag ä¹‹é—´çš„å†…å®¹ä½œä¸ºè¾“å…¥ã€‚ ç®¡é“å’Œé‡å®šå‘çš„æ¯”è¾ƒcommand1 | command2 å·¦è¾“å‡º | å³è¾“å…¥ command file å·¦è¾“å‡º å³æ–‡ä»¶ command file å·¦è¾“å…¥ å³æ–‡ä»¶ ç®¡é“çš„å‘½ä»¤åŒæ—¶æ‰§è¡Œ,command2 ç­‰å¾… command1 çš„è¾“å‡º (é˜»å¡) é‡å®šå‘æ˜¯æœ‰ä¼˜å…ˆçº§çš„,ç”±è¿›ç¨‹ä¼˜å…ˆçº§å†³å®š. å¸¸ç”¨å‘½ä»¤less/more alias å®šä¹‰åˆ«å alias md=mkdirmd dir1 dir2 //mdå°±æ˜¯mkdiräº†,è¿™é‡Œåˆ›å»ºäº†ä¸¤ä¸ªç›®å½•(æ–‡ä»¶å¤¹)dir1å’Œdir2. head/tail sort æ’åºå‘½ä»¤ cat /etc/passwd | sort -t: -k 4 -n //-tæŒ‡å®šåˆ†éš”ç¬¦ -k 4 æŒ‡å®šåˆ†éš”åçš„æ®µ, -n å®Œæ•´æ¯”è¾ƒã€‚manman 1 å¯æ‰§è¡Œç¨‹åºæˆ–Shellå‘½ä»¤man 2 ?man 3 ? ç”¨æˆ·ç®¡ç†å‘½ä»¤adduserdeluser --remove-home //åˆ é™¤ç”¨æˆ·çš„åŒæ—¶ï¼Œåˆ é™¤å…¶å·¥ä½œç›®å½•chownchown xiaomeng jielun //å°†æ–‡ä»¶jielunçš„æ‰€æœ‰è€…æ”¹ä¸ºxiaomeng.su åˆ‡æ¢ç”¨æˆ·passwd ä¿®æ”¹å¯†ç sudo //ç”¨è¶…çº§ç”¨æˆ·æƒé™æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ï¼›sudo passwd //æ™®é€šç”¨æˆ·ä¿®æ”¹rootç”¨æˆ·å¯†ç ;usermodusermod -l Ez xiaoming //æ›´æ”¹ç”¨æˆ·åxiaomingä¸ºEz,è¦ä¿è¯ç”¨æˆ·ä¸åœ¨ç™»é™†çŠ¶æ€; ç›¸å…³æ–‡ä»¶: /etc/passwd/etc/shadow/etc/skel//etc/group/etc/gshadowchmod æ”¹å˜æ–‡ä»¶è¯»å†™æ‰§è¡Œæƒé™rw- r-- r--110 100 1006 4 4| | |å…¶ä»–ç”¨æˆ·| |ç»„ç”¨æˆ·æƒé™|æ‰€å±è€…çš„æƒé™Xm è¿›ç¨‹ç®¡ç†ä¿¡æ¯è¿›ç¨‹çš„æ¦‚å¿µ:ç¨‹æ˜¯æŒ‡æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºçš„å®ä¾‹ã€‚æ¯ä¸ªè¿è¡Œçš„ç¨‹åºéƒ½åœ¨ç³»ç»Ÿä¸­ä½œä¸ºä¸€ä¸ªè¿›ç¨‹å­˜åœ¨ã€‚è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œä»»åŠ¡è°ƒåº¦å’Œèµ„æºç®¡ç†çš„åŸºæœ¬å•ä½ï¼Œå®ƒæ‹¥æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ã€æ‰§è¡Œä»£ç ã€æ•°æ®å’Œèµ„æºã€‚è¿›ç¨‹ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œå½¼æ­¤éš”ç¦»ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä¸€ä¸ªè¿›ç¨‹çš„å¼‚å¸¸ä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹çš„æ­£å¸¸è¿è¡Œã€‚è¿›ç¨‹ä¸ç¨‹åºçš„åŒºåˆ«:ç¨‹åºæ˜¯ä¸€ç»„é™æ€çš„æŒ‡ä»¤å’Œæ•°æ®çš„é›†åˆï¼Œå®ƒä»¬å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼›è€Œè¿›ç¨‹æ˜¯ç¨‹åºçš„å®ä¾‹ï¼Œæ˜¯ç¨‹åºåœ¨å†…å­˜ä¸­çš„æ‰§è¡Œè¿‡ç¨‹ã€‚ç¨‹åºåªæ˜¯é™æ€çš„ä»£ç å’Œæ•°æ®çš„é›†åˆï¼Œè€Œè¿›ç¨‹æ˜¯å…·æœ‰åŠ¨æ€ç‰¹æ€§ã€åœ¨ç³»ç»Ÿä¸­è¿è¡Œçš„å®ä½“ã€‚ è¿›ç¨‹ ç¨‹åº å®šä¹‰ è¿›ç¨‹æ˜¯æ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„å®ä¾‹ã€‚åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹ä»£è¡¨äº†ä¸€ä¸ªç‹¬ç«‹çš„æ‰§è¡Œå•å…ƒï¼Œæ‹¥æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ã€ç¨‹åºä»£ç ã€æ•°æ®å’Œèµ„æºã€‚æ¯ä¸ªè¿è¡Œçš„ç¨‹åºéƒ½ä»¥è¿›ç¨‹çš„å½¢å¼å­˜åœ¨ã€‚ ç¨‹åºæ˜¯ä¸€ç»„æŒ‡ä»¤å’Œæ•°æ®çš„é›†åˆï¼Œå®ƒæ˜¯é™æ€çš„ã€å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„æ–‡ä»¶ï¼Œæè¿°äº†å¦‚ä½•æ‰§è¡Œç‰¹å®šä»»åŠ¡ã€‚ç¨‹åºæœ¬èº«å¹¶ä¸å ç”¨ç³»ç»Ÿèµ„æºï¼Œåªæœ‰åœ¨è¢«åŠ è½½åˆ°å†…å­˜å¹¶è¿è¡Œæ—¶ï¼Œæ‰æˆä¸ºä¸€ä¸ªè¿›ç¨‹ã€‚ ç‰¹æ€§ è¿›ç¨‹æ˜¯ä¸€ä¸ªåŠ¨æ€çš„å®ä½“ï¼Œå…·æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥å¤„äºè¿è¡Œã€å°±ç»ªã€é˜»å¡ã€æŒ‚èµ·ç­‰ä¸åŒçŠ¶æ€ï¼Œè€Œä¸”è¿›ç¨‹ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œå½¼æ­¤éš”ç¦»ã€‚ ç¨‹åºæ˜¯ä¸€ä¸ªé™æ€çš„å®ä½“ï¼Œåªæ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„æ–‡ä»¶ï¼Œå¹¶ä¸å…·æœ‰è‡ªå·±çš„æ‰§è¡ŒçŠ¶æ€å’Œèµ„æºã€‚ ç”Ÿå‘½å‘¨æœŸ è¿›ç¨‹ä»åˆ›å»ºã€è¿è¡Œåˆ°ç»ˆæ­¢ï¼Œè¿›ç¨‹æœ‰ä¸€ä¸ªæ˜ç¡®çš„ç”Ÿå‘½å‘¨æœŸã€‚å½“è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œå®ƒå ç”¨çš„èµ„æºä¼šè¢«æ“ä½œç³»ç»Ÿå›æ”¶ã€‚ ç¨‹åºæœ¬èº«æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œåªæœ‰åœ¨è¢«åŠ è½½åˆ°å†…å­˜å¹¶æ‰§è¡Œä¸ºè¿›ç¨‹åï¼Œæ‰ä¼šæœ‰ç”Ÿå‘½å‘¨æœŸã€‚ è¿›ç¨‹å’Œç¨‹åºä¹‹é—´æ˜¯ä¸€ç§ä»ç¨‹åºåˆ°è¿›ç¨‹çš„å®ä¾‹åŒ–å…³ç³»ã€‚å½“è¿è¡Œä¸€ä¸ªç¨‹åºæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºè¯¥ç¨‹åºåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„è¿›ç¨‹ï¼Œä½¿å¾—ç¨‹åºåœ¨å†…å­˜ä¸­å¾—ä»¥æ‰§è¡Œã€‚ è¿›ç¨‹çš„æŸ¥çœ‹: ps -auxps -elf è¿›ç¨‹çš„å‡ ç§çŠ¶æ€: è¿è¡Œï¼ˆRunningï¼‰ï¼šè¡¨ç¤ºè¿›ç¨‹æ­£åœ¨è¿è¡Œæˆ–æ­£åœ¨æ‰§è¡Œã€‚ å°±ç»ªï¼ˆReadyï¼‰ï¼šè¡¨ç¤ºè¿›ç¨‹å·²ç»å‡†å¤‡å¥½è¿è¡Œï¼Œä½†ç”±äºç³»ç»Ÿèµ„æºé™åˆ¶æˆ–å…¶ä»–è¿›ç¨‹çš„è¿è¡Œï¼Œå®ƒæš‚æ—¶è¿˜æ²¡æœ‰å¾—åˆ°å¤„ç†å™¨çš„åˆ†é…ã€‚ é˜»å¡ï¼ˆBlockedï¼‰ï¼šä¹Ÿç§°ä¸ºç­‰å¾…ï¼ˆWaitingï¼‰ï¼Œè¡¨ç¤ºè¿›ç¨‹ç”±äºç­‰å¾…æŸä¸ªäº‹ä»¶çš„å‘ç”Ÿï¼ˆå¦‚ IO æ“ä½œå®Œæˆã€ä¿¡å·ç­‰ï¼‰è€Œæš‚åœæ‰§è¡Œï¼Œç›´åˆ°äº‹ä»¶å‘ç”Ÿæ‰èƒ½ç»§ç»­è¿è¡Œã€‚ æŒ‚èµ·ï¼ˆSuspendedï¼‰ï¼šè¡¨ç¤ºè¿›ç¨‹è¢«æš‚æ—¶æŒ‚èµ·ï¼Œä¸å ç”¨ CPU èµ„æºï¼Œå¹¶ä¸”å¯èƒ½è¢«æ”¾ç½®åœ¨ç£ç›˜ä¸Šã€‚è¿™ç§çŠ¶æ€é€šå¸¸ç”¨äºç³»ç»Ÿä¸­çš„ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œå¦‚è¿›ç¨‹è¢«è°ƒè¯•æˆ–ç”±äºå†…å­˜ä¸è¶³è€Œè¢«ç½®æ¢å‡ºæ¥ã€‚ shell å‘½ä»¤è¡Œä¸‹æŸ¥æ‰¾åœ¨å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ä¸­æŸ¥æ‰¾å†…å®¹åŒ…å« string çš„æ–‡ä»¶å¹¶åˆ—å‡ºå­—ç¬¦æ‰€åœ¨çš„æ–‡ä»¶,æ‰€åœ¨è¡ŒåŠæ‰€åœ¨è¡Œçš„å†…å®¹: find ./ -name * -exec grep -n string ./ \\; ä½¿ç”¨ find æŸ¥æ‰¾æ—¶å¸Œæœ›å¿½ç•¥æŸä¸ªç›®å½• (-prune): å¦‚æœå¸Œæœ›åœ¨app ç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶ï¼Œä½†ä¸å¸Œæœ›åœ¨appbin ç›®å½•ä¸‹æŸ¥æ‰¾: find /app -name /app/bin -prune -o -print ä½¿ç”¨ type é€‰é¡¹: å¦‚æœè¦åœ¨etc ç›®å½•ä¸‹æŸ¥æ‰¾æ‰€æœ‰çš„ç›®å½•: find /etc -type d -print å¦‚æœè¦åœ¨etc ç›®å½•ä¸‹æŸ¥æ‰¾.svn çš„ç›®å½•: find /etc -name .svn -type d -print ä¸ºäº†åœ¨å½“å‰ç›®å½•ä¸‹æŸ¥æ‰¾é™¤ç›®å½•ä»¥å¤–çš„æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶: find . ! -type d -print ä¸ºäº†åœ¨å½“å‰ç›®å½•ä¸‹æŸ¥æ‰¾æ‰€æœ‰çš„ç¬¦å·é“¾æ¥æ–‡ä»¶ï¼Œå¯ä»¥ç”¨: find . -type | -print ä¸ºäº†ç”¨ ls -l å‘½ä»¤åˆ—å‡ºæ‰€åŒ¹é…åˆ°çš„æ–‡ä»¶ï¼Œå¯ä»¥æŠŠ ls -l å‘½ä»¤æ”¾åœ¨ find å‘½ä»¤çš„ -exec é€‰é¡¹ä¸­: find . -type f -exec ls -l \\; æ³¨ï¼šf è¡¨ç¤ºæ™®é€šæ–‡ä»¶ shell è„šæœ¬å„ç§æ‰§è¡Œæ–¹å¼source ./*.sh . ./*.sh ./*.sh çš„åŒºåˆ« ./*.sh çš„æ‰§è¡Œæ–¹å¼ç­‰ä»·äº sh ./*.sh æˆ–è€… bash ./*.shï¼Œ æ­¤ä¸‰ç§æ‰§è¡Œè„šæœ¬çš„æ–¹å¼éƒ½æ˜¯é‡æ–°å¯åŠ¨ä¸€ä¸ªå­ shell,åœ¨å­ shell ä¸­æ‰§è¡Œæ­¤è„šæœ¬ã€‚ .source ./*.sh å’Œ . ./*.sh çš„æ‰§è¡Œæ–¹å¼æ˜¯ç­‰ä»·çš„ï¼Œå³ä¸¤ç§æ‰§è¡Œæ–¹å¼éƒ½æ˜¯åœ¨å½“å‰ shell è¿›ç¨‹ä¸­æ‰§è¡Œæ­¤è„šæœ¬ï¼Œè€Œä¸æ˜¯é‡æ–°å¯åŠ¨ä¸€ä¸ª shell è€Œåœ¨å­ shell è¿›ç¨‹ä¸­æ‰§è¡Œæ­¤è„šæœ¬ã€‚éªŒè¯ä¾æ®ï¼šæ²¡æœ‰è¢« export å¯¼å‡ºçš„å˜é‡ï¼ˆå³éç¯å¢ƒå˜é‡ï¼‰æ˜¯ä¸èƒ½è¢«å­ shell ç»§æ‰¿çš„éªŒè¯ç»“æœï¼š [root@localhost ~]#name=dangxu //å®šä¹‰ä¸€èˆ¬å˜é‡[root@localhost ~]# echo $namedangxu[root@localhost ~]# cat test.sh //éªŒè¯è„šæœ¬ï¼Œå®ä¾‹åŒ–æ ‡é¢˜ä¸­çš„./*.sh#!/bin/shecho $name[root@localhost ~]# ls -l test.sh //éªŒè¯è„šæœ¬å¯æ‰§è¡Œ-rwxr-xr-x 1 root root 23 Feb 611:09 test.sh[root@localhost ~]# ./test.sh //ä»¥ä¸‹ä¸‰ä¸ªå‘½ä»¤è¯æ˜äº†ç»“è®ºä¸€[root@localhost ~]# sh ./test.sh[root@localhost ~]# bash ./test.sh[root@localhost ~]# . ./test.sh //ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤è¯æ˜äº†ç»“è®ºäºŒdangxu[root@localhost ~]# source ./test.shdangxu[root@localhost ~]#","categories":["2.ç¼–ç¨‹è¯­è¨€","Shell"]},{"title":"Shellä»»åŠ¡","path":"/2024/02/22/2-ç¼–ç¨‹è¯­è¨€-Shell-Shellä»»åŠ¡/","content":"è®¡åˆ’ä»»åŠ¡æœåŠ¡ç¨‹åºä¸€æ¬¡æ€§è®¡åˆ’ä»»åŠ¡â€œat æ—¶é—´â€æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºåœ¨æŒ‡å®šçš„æ—¶é—´æ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡ã€‚ é€šè¿‡ä½¿ç”¨è¯¥å‘½ä»¤ï¼Œå¯ä»¥å®‰æ’è®¡åˆ’åœ¨å°†æ¥çš„æŸä¸ªæ—¶é—´è¿è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬ã€‚ æ—¶é—´å‚æ•°å¯ä»¥é‡‡ç”¨å¤šç§æ ¼å¼ï¼Œå¦‚ HH:MMï¼ŒHH:MM AMPM æˆ–è€…æ˜å¤©çš„æ—¥æœŸã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å°†åœ¨ä¸‹åˆ 2 ç‚¹è¿è¡Œä¸€ä¸ªè„šæœ¬ï¼š at 2pm è„šæœ¬è·¯å¾„ æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡â€œat -lâ€å‘½ä»¤ç”¨äºåˆ—å‡ºå½“å‰è®¡åˆ’çš„ at ä»»åŠ¡åˆ—è¡¨ï¼Œæ˜¾ç¤ºå·²ç»è¢«å®‰æ’çš„ä»»åŠ¡åŠå…¶ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ä»»åŠ¡åºå·ã€æ‰§è¡Œæ—¶é—´ç­‰ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å°†åˆ—å‡ºå½“å‰è®¡åˆ’çš„ at ä»»åŠ¡åˆ—è¡¨ï¼š at -l å–æ¶ˆè®¡åˆ’ä»»åŠ¡â€œatrm ä»»åŠ¡åºå·â€å‘½ä»¤ç”¨äºå–æ¶ˆä¸€ä¸ªå·²ç»è®¡åˆ’çš„ at ä»»åŠ¡ï¼Œå…¶ä¸­ä»»åŠ¡åºå·æ˜¯é€šè¿‡â€at -lâ€å‘½ä»¤åˆ—å‡ºçš„ä»»åŠ¡çš„åºå·ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å°†å–æ¶ˆä»»åŠ¡åºå·ä¸º 1 çš„ at ä»»åŠ¡ï¼š atrm 1 é•¿æœŸæ€§è®¡åˆ’ä»»åŠ¡crontab -e åˆ›å»ºã€ç¼–è¾‘è®¡åˆ’ä»»åŠ¡ crontab -l æŸ¥çœ‹å½“å‰è®¡åˆ’ä»»åŠ¡ crontab -r åˆ é™¤æŸæ¡è®¡åˆ’ä»»åŠ¡ crontab -u ç¼–è¾‘ä»–äººçš„è®¡åˆ’ä»»åŠ¡ demo: crontab -e crontab -l25 3 * * 1,3,5 /usr/bin/tar -czvf backup.tar /home/wwwroot whereis rm æ—¶é—´å‘¨æœŸè®¾ç½®ï¼š25 3 * * 1,3,5 ä¾æ¬¡å¯¹åº” åˆ†é’Ÿï¼Œå°æ—¶ï¼Œæ—¥æœŸï¼Œæœˆä»½ï¼Œæ˜ŸæœŸ ä»»åŠ¡å†…å®¹:è¦è¿è¡Œçš„å‘½ä»¤ /usr/bin/tar -czvf backup.tar /home/wwwroot","categories":["2.ç¼–ç¨‹è¯­è¨€","Shell"]},{"title":"Shellå’Œç»ˆç«¯å’Œæ§åˆ¶å°çš„åŒºåˆ«","path":"/2024/02/21/2-ç¼–ç¨‹è¯­è¨€-Shell-Shellå’Œç»ˆç«¯å’Œæ§åˆ¶å°çš„åŒºåˆ«/","content":"shellã€æ§åˆ¶å°ã€ç»ˆç«¯çš„åŒºåˆ«ç»ˆç«¯(terminalï¼Œæˆ–è€…å«ç‰©ç†ç»ˆç«¯ï¼‰ï¼šæ˜¯ä¸€ç§è®¾å¤‡ï¼Œä¸æ˜¯ä¸€ä¸ªç¨‹åºï¼Œä¸€èˆ¬è¯´çš„å°±æ˜¯èƒ½æä¾›å‘½ä»¤è¡Œç”¨æˆ·ç•Œé¢çš„è®¾å¤‡ï¼Œå…¸å‹çš„æ˜¯å±å¹•å’Œé”®ç›˜ï¼Œæˆ–å…¶ä»–çš„ä¸€äº›ç‰©ç†ç»ˆç«¯ã€‚ è™šæ‹Ÿç»ˆç«¯ï¼šå±å¹•å’Œé”®ç›˜åªæ˜¯ä¸€ä¸ªç»ˆç«¯ï¼Œå¯èƒ½ä¸å¤Ÿç”¨ï¼Œåˆä¸æƒ³å¢åŠ è®¾å¤‡æŠ•å…¥ï¼Œå°±äº§ç”Ÿäº†è™šæ‹Ÿç»ˆç«¯ã€‚ gnome-terminal,urxvtï¼Œmltermï¼Œxterm ç­‰ç­‰æ˜¯ä¸€ä¸ªç¨‹åºï¼ŒèŒè´£æ˜¯æ¨¡æ‹Ÿç»ˆç«¯è®¾å¤‡ï¼Œå’Œè™šæ‹Ÿç»ˆç«¯çš„åŒºåˆ«è¡¨é¢ä¸Šåœ¨äºå®ƒä»¥ GUI å½¢å¼çš„çª—å£å‡ºç°ï¼Œå†…éƒ¨åˆ™æ˜¯ç¨‹åºç»“æ„å’Œç³»ç»Ÿæ§åˆ¶ç»“æ„æœ‰æ‰€ä¸åŒï¼Œä½†æœ¬è´¨ä¸Šå·®ä¸å¤šã€‚ æ§åˆ¶å°ï¼ˆconsole):æ˜¾ç¤ºç³»ç»Ÿæ¶ˆæ¯çš„ç»ˆç«¯å°±å«æ§åˆ¶å°ï¼ŒLinux é»˜è®¤æ‰€æœ‰è™šæ‹Ÿç»ˆç«¯éƒ½æ˜¯æ§åˆ¶å°ï¼Œéƒ½èƒ½æ˜¾ç¤ºç³»ç»Ÿæ¶ˆæ¯ã€‚ ä½†æœ‰æ—¶ä¸“æŒ‡ CLI ä¸‹çš„æ¨¡æ‹Ÿç»ˆç«¯è®¾å¤‡çš„ä¸€ä¸ªç¨‹åºï¼Œå’Œ gnome-terminal,urxvtï¼Œmltermï¼Œxterm ç­‰ç›¸åŒï¼Œåªæ˜¯ CLI å’Œ GUI ç•Œé¢çš„åŒºåˆ«ã€‚ ä¸€èˆ¬ console æœ‰ 6 ä¸ªï¼Œtty1-6ï¼ŒCTRL+ALT+f1~6 åˆ‡æ¢ã€‚ shellï¼šshell æ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œshell çš„ä¸€åˆ‡æ“ä½œéƒ½åœ¨è®¡ç®—æœºå†…éƒ¨ï¼Œè´Ÿè´£å¤„ç†äººæœºäº¤äº’ï¼Œæ‰§è¡Œè„šæœ¬ç­‰ï¼Œæ˜¯æ“ä½œç³»ç»Ÿèƒ½æ­£å¸¸è¿è¡Œçš„é‡è¦ç»„æˆéƒ¨åˆ†,bashï¼Œashï¼Œzshï¼Œtcsh ç­‰æ˜¯ shell è¿™ä¸ªæŠ½è±¡æ¦‚å¿µçš„ä¸€ç§å…·ä½“çš„å®ç°ï¼Œéƒ½æ˜¯ä¸€ä¸ªç¨‹åºï¼Œéƒ½èƒ½ç”Ÿæˆä¸€ä¸ªè¿›ç¨‹å¯¹è±¡ å¦‚æœæƒ³æ¢ shell çš„ç¨‹åºï¼Œå¯ä»¥ä¿®æ”¹etcpasswdï¼ŒæŠŠé‡Œé¢çš„binbash æ¢æˆæƒ³è¦çš„ shellï¼Œæˆ–è€…ç”¨ chsh å‘½ä»¤æ¥åˆ‡æ¢ ç»ˆç«¯å’Œ Shellshell ä¸ç»ˆç«¯çš„å…³ç³»ï¼šshell æŠŠä¸€äº›ä¿¡æ¯é€‚å½“çš„è¾“é€åˆ°ç»ˆç«¯è®¾å¤‡ï¼ŒåŒæ—¶è¿˜æ¥æ”¶æ¥è‡ªç»ˆç«¯è®¾å¤‡çš„è¾“å…¥ã€‚ä¸€èˆ¬æ¯ä¸ª shell è¿›ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªç»ˆç«¯å…³è”ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚ å­—ç¬¦ç¨‹åº â€” è™šæ‹Ÿç»ˆç«¯ â€” å›¾åƒæ˜¾ç¤º shell â€” xterm â€” X11 ç»ˆç«¯å’Œæ§åˆ¶å°ç»ˆç«¯ï¼Œè‹±æ–‡å«åš terminal ,é€šå¸¸ç®€ç§°ä¸º term ï¼Œæ¯”å¦‚åœ¨ X ä¸‹çš„ xterm. æ§åˆ¶å°ï¼Œè‹±æ–‡å«åš consoleã€‚ è¦æ˜ç™½è¿™ä¸¤è€…çš„å…³ç³»ï¼Œè¿˜å¾—ä»ä»¥å‰çš„å¤šäººä½¿ç”¨çš„è®¡ç®—æœºå¼€å§‹ã€‚ å¤§å®¶éƒ½çŸ¥é“ï¼Œæœ€åˆçš„è®¡ç®—æœºç”±äºä»·æ ¼æ˜‚è´µï¼Œå› æ­¤ï¼Œä¸€å°è®¡ç®—æœºä¸€èˆ¬æ˜¯ç”±å¤šä¸ªäººåŒæ—¶ä½¿ç”¨çš„ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ä¸€å°è®¡ç®—æœºéœ€è¦è¿æ¥ä¸Šè®¸å¤šå¥—é”®ç›˜å’Œæ˜¾ç¤ºå™¨æ¥ä¾›å¤šä¸ªäºº ä½¿ç”¨ã€‚ åœ¨ä»¥å‰ä¸“é—¨æœ‰è¿™ç§å¯ä»¥è¿ä¸Šä¸€å°ç”µè„‘çš„è®¾å¤‡ï¼Œåªæœ‰æ˜¾ç¤ºå™¨å’Œé”®ç›˜ï¼Œè¿˜æœ‰ç®€å•çš„å¤„ç†ç”µè·¯ï¼Œæœ¬èº«ä¸å…·æœ‰å¤„ç†è®¡ç®—æœºä¿¡æ¯çš„èƒ½åŠ›ï¼Œä»–æ˜¯è´Ÿè´£è¿æ¥åˆ°ä¸€å°æ­£å¸¸çš„è®¡ç®— æœºä¸Šï¼ˆé€šå¸¸æ˜¯é€šè¿‡ä¸²å£ï¼‰ ï¼Œç„¶åç™»é™†è®¡ç®—æœºï¼Œå¹¶å¯¹è¯¥è®¡ç®—æœºè¿›è¡Œæ“ä½œã€‚ å½“ç„¶ï¼Œé‚£æ—¶å€™çš„è®¡ç®—æœºæ“ä½œç³»ç»Ÿéƒ½æ˜¯å¤šä»»åŠ¡å¤šç”¨æˆ·çš„æ“ä½œç³»ç»Ÿã€‚ è¿™æ ·ä¸€å°åªæœ‰æ˜¾ç¤ºå™¨å’Œé”®ç›˜èƒ½å¤Ÿé€šè¿‡ä¸²å£è¿æ¥åˆ°è®¡ç®—æœº çš„è®¾å¤‡å°±å«åšç»ˆç«¯ã€‚ è€Œæ§åˆ¶å°åˆæ˜¯ä»€ä¹ˆå›äº‹å‘¢ï¼Ÿ å­¦æœºç”µçš„äººåº”è¯¥çŸ¥é“ï¼Œä¸€å°æœºåºŠï¼Œæˆ–è€…æ•°æ§è®¾å¤‡çš„æ§åˆ¶ç®±ï¼Œé€šå¸¸ä¼šè¢«ç§°ä¸ºæ§åˆ¶å°ï¼Œé¡¾åæ€ä¹‰ï¼Œæ§åˆ¶å°å°±æ˜¯ä¸€ä¸ªç›´æ¥æ§åˆ¶è®¾å¤‡çš„å°é¢ï¼ˆä¸€ä¸ªé¢æ¿ï¼Œä¸Šé¢æœ‰å¾ˆå¤šæ§åˆ¶æŒ‰ é’®ï¼‰ã€‚ åœ¨è®¡ç®—æœºé‡Œï¼ŒæŠŠé‚£å¥—ç›´æ¥è¿æ¥åœ¨ç”µè„‘ä¸Šçš„é”®ç›˜å’Œæ˜¾ç¤ºå™¨å°±å«åšæ§åˆ¶å°ã€‚ è¯·æ³¨æ„å®ƒå’Œç»ˆç«¯çš„åŒºåˆ«ï¼Œç»ˆç«¯æ˜¯é€šè¿‡ä¸²å£è¿æ¥ä¸Šçš„ï¼Œä¸æ˜¯è®¡ç®—æœºæœ¬èº«å°±æœ‰çš„è®¾å¤‡ï¼Œè€Œæ§åˆ¶å°æ˜¯ è®¡ç®—æœºæœ¬èº«å°±æœ‰çš„è®¾å¤‡ï¼Œä¸€ä¸ªè®¡ç®—æœºåªæœ‰ä¸€ä¸ªæ§åˆ¶å°ã€‚ è®¡ç®—æœºå¯åŠ¨çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„ä¿¡æ¯éƒ½ä¼šæ˜¾ç¤ºåˆ°æ§åˆ¶å°ä¸Šï¼Œè€Œä¸ä¼šæ˜¾ç¤ºåˆ°ç»ˆç«¯ä¸Šã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ§åˆ¶å°æ˜¯è®¡ç®—æœºçš„åŸº æœ¬è®¾å¤‡ï¼Œè€Œç»ˆç«¯æ˜¯é™„åŠ è®¾å¤‡ã€‚ å½“ç„¶ï¼Œç”±äºæ§åˆ¶å°ä¹Ÿæœ‰ç»ˆç«¯ä¸€æ ·çš„åŠŸèƒ½ï¼Œæ§åˆ¶å°æœ‰æ—¶å€™ä¹Ÿè¢«æ¨¡ç³Šçš„ç»Ÿç§°ä¸ºç»ˆç«¯ã€‚ è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸­ï¼Œä¸ç»ˆç«¯ä¸ç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å†…æ ¸æ¶ˆæ¯ï¼Œåå°æœåŠ¡æ¶ˆæ¯ï¼Œéƒ½å¯ä»¥æ˜¾ç¤ºåˆ°æ§åˆ¶å°ä¸Šï¼Œä½†ä¸ä¼šæ˜¾ç¤ºåˆ°ç»ˆç«¯ä¸Šã€‚ ä»¥ä¸Šæ˜¯æ§åˆ¶å°å’Œç»ˆç«¯çš„å†å²é—ç•™åŒºåˆ«ã€‚ ç°åœ¨ç”±äºè®¡ç®—æœºç¡¬ä»¶è¶Šæ¥è¶Šä¾¿å®œï¼Œé€šå¸¸éƒ½æ˜¯ä¸€ä¸ªäººç‹¬å ä¸€å°è®¡ç®—æœºè¶…åšï¼Œä¸å†è¿æ¥ä»¥å‰é‚£ç§çœŸæ­£æ„ä¹‰ä¸Šçš„â€ç»ˆç«¯è®¾å¤‡äº†â€ï¼Œå› æ­¤ï¼Œç»ˆç«¯å’Œæ§åˆ¶å°çš„æ¦‚å¿µä¹Ÿæ…¢æ…¢æ¼”åŒ–äº†ã€‚ ç»ˆç«¯å’Œæ§åˆ¶å°ç”±ç¡¬ä»¶çš„æ¦‚å¿µï¼Œæ¼”åŒ–æˆäº†è½¯ä»¶çš„æ¦‚å¿µã€‚ ç°åœ¨è¯´çš„ç»ˆç«¯ï¼Œæ¯”å¦‚ linux ä¸­çš„è™šæ‹Ÿç»ˆç«¯ï¼Œéƒ½æ˜¯è½¯ä»¶çš„æ¦‚å¿µï¼Œä»–ç”¨è®¡ç®—æœºçš„è½¯ä»¶æ¥æ¨¡æ‹Ÿä»¥å‰ç¡¬ä»¶çš„æ–¹å¼ã€‚ æ¯”å¦‚åœ¨ linux ä¸­ï¼Œç”¨ alt+f1 ~ f6 å¯ä»¥åˆ‡æ¢å…­ä¸ªè™šæ‹Ÿç»ˆç«¯ï¼Œå°±å¥½æ¯”æ˜¯ä»¥å‰å¤šäººå…¬ç”¨çš„è®¡ç®—æœºä¸­çš„å…­ä¸ªç»ˆç«¯è®¾å¤‡ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªå«â€è™šæ‹Ÿç»ˆç«¯â€çš„åŸå› ã€‚ å½“ç„¶ï¼Œç°åœ¨çš„ linux ä¹Ÿå¯ä»¥é€šè¿‡ä¸²å£ çº¿ï¼Œè¿æ¥ä¸€ä¸ªçœŸæ­£çš„ç»ˆç«¯ï¼Œç°åœ¨è¿™ç§ç»ˆç«¯è®¾å¤‡å·²ç»éå¸¸ç½•è§äº†ï¼Œä½†æ˜¯è¿˜å­˜åœ¨ï¼Œåªæ˜¯ä¸€èˆ¬äººå¾ˆéš¾è§åˆ°ã€‚ ä¹Ÿæœ‰äººåˆ©ç”¨ä»¥å‰çš„è€ç”µè„‘ï¼ˆ386ï¼Œ486ï¼‰è£…ä¸Šä¸€ä¸ªä¸²å£é€šä¿¡ è½¯ä»¶ï¼Œè¿ä¸Šä¸€å°è®¡ç®—æœºï¼Œæ¥æ¨¡æ‹Ÿä¸€ä¸ªç»ˆç«¯æ¥ç”¨ã€‚è¿™æ ·å¯ä»¥è¾¾åˆ°ä¸€å°ç”µè„‘å¤šäººä½¿ç”¨çš„ç›®çš„ã€‚ ç®€å•çš„è¯´ï¼Œèƒ½ç›´æ¥æ˜¾ç¤ºç³»ç»Ÿæ¶ˆæ¯çš„é‚£ä¸ªç»ˆç«¯ç§°ä¸ºæ§åˆ¶å°ï¼Œå…¶ä»–çš„åˆ™ç§°ä¸ºç»ˆç«¯ã€‚ ä½†æ˜¯åœ¨ linux ç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªæ¦‚å¿µä¹Ÿå·²ç»æ¨¡ç³ŠåŒ–äº†ã€‚ æ¯”å¦‚ä¸‹é¢è¿™æ¡å‘½ä»¤ï¼š echo hello,world /dev/console è¿™æ¡å‘½ä»¤çš„ç›®çš„æ˜¯å°†â€hello,worldâ€æ˜¾ç¤ºåˆ°æ§åˆ¶å°ä¸Šdevconsole æ˜¯æ§åˆ¶å°è®¾å¤‡çš„è®¾å¤‡åã€‚ åœ¨ linux ä¸­ï¼Œåœ¨å­—ç¬¦æ¨¡å¼ä¸‹ï¼Œæ— è®ºåœ¨å“ªä¸ªè™šæ‹Ÿç»ˆç«¯ä¸‹æ‰§è¡Œè¿™æ¡å‘½ä»¤ï¼Œå­—ç¬¦ hello,world éƒ½ä¼šæ˜¾ç¤ºåœ¨å½“å‰çš„è™šæ‹Ÿç»ˆç«¯ä¸‹ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œlinux æŠŠå½“å‰çš„ç»ˆç«¯å½“ä½œæ§åˆ¶å°æ¥çœ‹å¾…ã€‚ å¯è§ï¼Œlinux ä¸­å·²ç»å®Œå…¨æ·¡åŒ–äº†æ§åˆ¶å°å’Œç»ˆç«¯çš„åŒºåˆ«ã€‚ ä½†æ˜¯åœ¨å…¶ä»–çš„ UNIX ç±»ç³»ç»Ÿä¸­ï¼Œå´å¾ˆæ˜æ˜¾çš„æœ‰è™šæ‹Ÿç»ˆç«¯å’Œæ§åˆ¶å°çš„åŒºåˆ«ã€‚æ¯”å¦‚ freeBSD ç³»ç»Ÿã€‚ åœ¨ freebsd ä¸­ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªâ€ç»ˆç«¯â€æ‰æ˜¯çœŸæ­£çš„æ§åˆ¶å°ã€‚ ï¼ˆå°±æ˜¯è¯´æŒ‰ alt+f1 å¾—åˆ°çš„é‚£ä¸ªè™šæ‹Ÿç»ˆç«¯ï¼‰ï¼Œæ— è®ºåœ¨å“ªä¸ªè™šæ‹Ÿç»ˆç«¯ä¸Šæ‰§è¡Œä¸Šé¢çš„é‚£æ¡å‘½ä»¤ï¼ˆå“ªæ€•æ˜¯é€šè¿‡ç½‘ç»œè¿æ¥çš„ä¼ªç»ˆç«¯ä¸Šæ‰§è¡Œè¿™æ¡å‘½ä»¤ï¼‰ã€‚ hello,world å­—ç¬¦æ€»ä¼šæ˜¾ç¤ºåˆ°ç¬¬ä¸€ä¸ªâ€ç»ˆç«¯â€ä¹Ÿå°±æ˜¯ çœŸæ­£çš„æ§åˆ¶å°ä¸Šã€‚ å¦å¤–ï¼Œå…¶ä»–çš„ä¸€äº›ç³»ç»Ÿå†…éƒ¨ä¿¡æ¯ï¼Œæ¯”å¦‚å“ªä¸ªç”¨æˆ·åœ¨å“ªä¸ªç»ˆç«¯ç™»é™†ï¼Œç³»ç»Ÿæœ‰ä½•ä¸¥é‡é”™è¯¯è­¦å‘Šç­‰ä¿¡æ¯ï¼Œå…¨éƒ½æ˜¾ç¤ºåœ¨è¿™ä¸ªçœŸæ­£çš„æ§åˆ¶å°ä¸Šã€‚ åœ¨è¿™é‡Œï¼Œå°±æ˜ æ˜¾çš„åŒºåˆ†äº†ç»ˆç«¯å’Œæ§åˆ¶å°çš„æ¦‚å¿µã€‚å…¶ä»– UNIX ä¸­ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚ æ¯”å¦‚ Tru64 unix åœ¨ X ä¸‹æœ‰ä¸€ä¸ªæ§åˆ¶å°æ¨¡æ‹Ÿè½¯ä»¶ï¼Œæ— è®ºåœ¨å“ªé‡Œè¾“å…¥ echo â€œhello,worldâ€ devconsole å‘½ä»¤ï¼Œhello,world æ€»ä¼šæ˜¾ç¤ºåœ¨è¿™ä¸ªæ§åˆ¶å°æ¨¡æ‹Ÿå™¨ä¸­ã€‚ åœ¨ X ç•Œé¢ä¸‹ç”¨çš„é‚£äº›è¾“å…¥å‘½ä»¤çš„è½¯ä»¶ï¼Œæ¯”å¦‚ xterm ,rxvt, gnome-terminal ç­‰ç­‰ï¼Œéƒ½åº”è¯¥è¢«ç§°ä¸ºç»ˆç«¯æ¨¡æ‹Ÿè½¯ä»¶ã€‚ è¯·æ³¨æ„å®ƒå’Œæ§åˆ¶å°æ¨¡æ‹Ÿè½¯ä»¶çš„åŒºåˆ«ã€‚ linux ä¸­å¥½è±¡æ²¡æœ‰æ§åˆ¶å°æ¨¡æ‹Ÿè½¯ä»¶ã€‚ åœ¨ X ä¸­çš„ç»ˆç«¯æ¨¡æ‹Ÿ è½¯ä»¶ä¸­è¾“å…¥çš„ echo â€œhello,worldâ€devconsole å‘½ä»¤çš„è¾“å‡ºä¿¡æ¯ï¼Œéƒ½ä¼šè¾“å‡ºåˆ°å¯åŠ¨è¯¥ X æœåŠ¡å™¨çš„è™šæ‹Ÿç»ˆç«¯ä¸Šã€‚ æ¯”å¦‚ï¼Œç”¨å­—ç¬¦æ–¹å¼ç™»é™†ç³»ç»Ÿã€‚ è¿›å…¥ç¬¬ä¸€ä¸ªè™šæ‹Ÿç»ˆç«¯ï¼Œç„¶å startx å¯åŠ¨ X æœåŠ¡å™¨ã€‚ å†æ‰“å¼€ xterm æ¥è¾“å…¥ echo â€œhello,worldâ€devconsole å‘½ä»¤ï¼Œé‚£ä¹ˆå­—ç¬¦ä¸² hello,world å°±æ˜¾ç¤ºåœ¨ç¬¬ä¸€ä¸ªè™šæ‹Ÿç»ˆç«¯ä¸Šã€‚ æŒ‰ ctrl+alt+f1ï¼Œå›åˆ°é‚£ä¸ªå¯åŠ¨ X æœåŠ¡å™¨çš„ç»ˆç«¯ï¼Œå°±å¯ä»¥çœ‹åˆ° hello, world å­—ç¬¦ä¸²ã€‚ ç°åœ¨è¯¥æ˜ç™½ç»ˆç«¯å’Œæ§åˆ¶å°çš„åŒºåˆ«äº†å§ã€‚ å†ç®€å•çš„è¯´ï¼Œæ§åˆ¶å°æ˜¯ç›´æ¥å’Œè®¡ç®—æœºç›¸è¿æ¥çš„åŸç”Ÿè®¾å¤‡ï¼Œç»ˆç«¯æ˜¯é€šè¿‡ç”µç¼†ã€ç½‘ç»œç­‰ç­‰å’Œä¸»æœºè¿æ¥çš„è®¾å¤‡ã€‚ åœ¨ä»¥å‰çš„ç¡¬ä»¶ç»ˆç«¯è®¾å¤‡ä¸­ï¼Œç”±äºç”Ÿäº§å‚å®¶ä¸åŒï¼Œæ‰€éµå¾ªçš„æ ‡å‡†ä¸åŒï¼Œå› æ­¤æœ‰ä¸åŒçš„å‹å·æ ‡å‡†ã€‚ æ¯”å¦‚ vt100 ç­‰ã€‚è¿™é‡Œçš„ vt100 å°±æ˜¯ä¸€ä¸ªæ ‡å‡†ï¼Œé‚£ä¹ˆç°åœ¨ ä»¬æ‰€è¯´çš„ç»ˆç«¯ï¼Œå¾€å¾€ä¸æ˜¯çœŸæ­£çš„ç¡¬ä»¶ç»ˆç«¯äº†ï¼Œè€Œæ˜¯ç»ˆç«¯æ¨¡æ‹Ÿè½¯ä»¶äº†ï¼Œå› æ­¤ä¸åŒçš„ç»ˆç«¯æ¨¡æ‹Ÿè½¯ä»¶å¯èƒ½ç¬¦åˆä¸åŒçš„æ ‡å‡†ï¼Œè¿˜æœ‰ä¸€äº›ç»ˆç«¯æ¨¡æ‹Ÿè½¯ä»¶ç¬¦åˆå¾ˆå¤šç§ä¸åŒç»ˆç«¯çš„æ ‡ å‡†ã€‚ æ¯”å¦‚ gnome çš„ç»ˆç«¯æ¨¡æ‹Ÿè½¯ä»¶ gnome-terminalï¼Œä»–æä¾›å¥½å‡ ä¸­æ ‡å‡†å¯ä¾›ç”¨æˆ·é€‰æ‹©ã€‚ ç”¨æˆ·åªè¦è®¾ç½®ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚ ç°åœ¨ï¼Œç”±äºåŸå…ˆçš„è¿™äº›è®¾å¤‡åœ¨çš„è§†çº¿ä¸­æ¸æ¸æ·¡å‡ºï¼Œæ§åˆ¶å°å’Œç»ˆç«¯çš„æ¦‚å¿µä¹Ÿæ…¢æ…¢è°ˆåŒ–ã€‚ æ™®é€šç”¨æˆ·å¯ä»¥ç®€å•çš„æŠŠç»ˆç«¯å’Œæ§åˆ¶å°ç†è§£ä¸ºï¼šå¯ä»¥è¾“å…¥å‘½ä»¤è¡Œå¹¶æ˜¾ç¤ºç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„ä¿¡æ¯ä»¥åŠç¨‹åºè¿è¡Œç»“æœçš„çª—å£ã€‚ ä¸å¿…è¦ä¸¥æ ¼åŒºåˆ†è¿™ä¸¤è€…çš„å·®åˆ«ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Shell"]},{"title":"ShellåŸºç¡€","path":"/2024/02/20/2-ç¼–ç¨‹è¯­è¨€-Shell-ShellåŸºç¡€/","content":"å˜é‡å®šä¹‰Shell æ”¯æŒè‡ªå®šä¹‰å˜é‡ï¼Œä¸åŒºåˆ†æ•°æ®ç±»å‹,å…¨éƒ¨è¯†åˆ«ä¸ºå­—ç¬¦ä¸² å®šä¹‰å˜é‡æ—¶ï¼Œå‘½åç¬¦åˆæ ‡è¯†ç¬¦è§„å®šï¼Œå˜é‡åä¸åŠ  $ ç¬¦å· varName=value æ³¨æ„å˜é‡åå’Œç­‰å·ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼ŒåŒæ—¶å˜é‡åçš„å‘½ä»¤éµå¾ªä»¥ä¸‹è§„åˆ™ é¦–ä¸ªå­—ç¬¦å¿…é¡»ä¸ºå­—æ¯ ä¸­é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œæ”¯æŒä¸‹åˆ’çº¿ ä¸èƒ½ä½¿ç”¨æ ‡ç‚¹ç¬¦å·ï¼Œä¸èƒ½ä½¿ç”¨ bash é‡Œçš„å…³é”®å­— ä½¿ç”¨ä½¿ç”¨ä¸€ä¸ªå®šä¹‰è¿‡çš„å˜é‡ï¼Œåªè¦åœ¨å˜é‡åå‰é¢åŠ  $ ç¬¦å·å³å¯ echo $varNameecho $varName //å¸®åŠ©è¿›è¡Œè¾¹ç•Œè¯†åˆ« å˜é‡åå¤–çš„èŠ±æ‹¬å·æ—¶å¯é€‰çš„ï¼Œå¯ä»¥ç”¨äºå¸®åŠ©è§£é‡Šå™¨è¯†åˆ«å˜é‡ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µ for skill in Adado\techo i am good at $skillScriptdone å¦‚æœä¸ç»™ skill å˜é‡åŠ {}ï¼Œè§£é‡Šå™¨ä¼šæŠŠ $skillScript å½“æˆä¸€ä¸ªå˜é‡ é‡æ–°å®šä¹‰å·²å®šä¹‰çš„å˜é‡å¯ä»¥è¢«é‡æ–°å®šä¹‰ myUrl=http://see.xidian.edu.cn/cpp/linux/echo $myUrlmyUrl=http://see.xidian.edu.cn/cpp/shell/echo $myUrl ç¬¬äºŒæ¬¡èµ‹å€¼çš„æ—¶å€™ä¸èƒ½å†™ $myUrl=http://see.xidian.edu.cn/cpp/shell/ï¼Œåªæœ‰ä½¿ç”¨å˜é‡æ—¶æ‰åŠ  $ ç¬¦å· åªè¯»å˜é‡ä½¿ç”¨ readonly å¯ä»¥å°†å˜é‡å®šä¹‰ä¸ºåªè¯»å˜å˜é‡ï¼Œåªè¯»å˜é‡çš„å€¼ä¸èƒ½è¢«æ”¹å˜ #!/bin/bashmyUrl=http://see.xidian.edu.cn/cpp/shell/readonly myUrlmyUrl=http://see.xidian.edu.cn/cpp/danpianji/ è¿è¡Œè„šæœ¬ï¼Œä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š /bin/sh: NAME: This variable is read only. åˆ é™¤å˜é‡ä½¿ç”¨ unset å¯ä»¥åˆ é™¤å˜é‡ï¼Œunset ä¸èƒ½åˆ é™¤åªè¯»å˜é‡ unset å˜é‡åset æ˜¾ç¤ºæœ¬åœ°çš„æ‰€æœ‰å˜é‡ å˜é‡ç±»å‹ä½ç½®å˜é‡æ¥æ”¶ç”¨æˆ·å‚æ•° $0 è¡¨ç¤ºå½“å‰è„šæœ¬åç§° $1 è¡¨ç¤ºæ¥æ”¶çš„ç¬¬ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•° $2 è¡¨ç¤ºç¬¬äºŒä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨ $# å‚æ•°çš„ä¸ªæ•°$? å‘½ä»¤æ‰§è¡Œç»“æœ,å‡½æ•°è¿”å›ç»“æœ,$$ è¿›ç¨‹id$1,$2..$9,$10, $11$@ $* $* å½“åšæ•´ä½“å¤„ç† ç¯å¢ƒå˜é‡ (å…¨å±€å¯ä»¥è®¿é—®çš„å˜é‡)è„šæœ¬ä¸­å®šä¹‰çš„å˜é‡åªåœ¨æœ¬è„šæœ¬æœ‰æ•ˆ envexport å˜é‡å //å°†å±€éƒ¨å˜é‡å˜ä¸ºå…¨å±€å˜é‡ ç‰¹æ®Šå˜é‡ $0 å½“å‰è„šæœ¬çš„æ–‡ä»¶å $n ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°ï¼Œ$1,$2 $# ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„å‚æ•°ä¸ªæ•° $* ä¼ é€’ç»™è„šæœ¬æˆ–å‡½æ•°çš„æ‰€æœ‰å‚æ•° $@ $? ä¸Šä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€æˆ–å‡½æ•°çš„è¿”å›å€¼ $$ å½“å‰ shell è¿›ç¨‹ ID $* å’Œ $@ çš„åŒºåˆ« #!/bin/bashecho \\$*= $*echo \\\\$*\\=$*echo \\$@= $@echo \\\\$@\\=$@echo print each param from \\$*for var in $*do\techo $vardoneecho print each param from \\$@for var in $@do\techo $vardoneecho print each param from \\\\$*\\for var in $*do\techo $vardoneecho print each param from \\\\$@\\for var in $@do\techo $vardone è¿è¡Œ .test.sh â€œaâ€ â€œbâ€ â€œcâ€ â€œdâ€ï¼Œçœ‹åˆ°ä¸‹é¢çš„ç»“æœï¼š $*= a b c d$*= a b c d$@= a b c d$@= a b c dprint each param from $*abcdprint each param from $@abcdprint each param from $*a b c dprint each param from $@abcd æ›¿æ¢ï¼Œè¿ç®—ç¬¦ï¼Œå­—ç¬¦ä¸²ï¼Œæ•°ç»„æ›¿æ¢å¦‚æœè¡¨è¾¾å¼ä¸­åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼ŒShell å°†ä¼šè¿›è¡Œæ›¿æ¢ã€‚ä¾‹å¦‚ï¼Œåœ¨åŒå¼•å·ä¸­ä½¿ç”¨å˜é‡å°±æ˜¯ä¸€ç§æ›¿æ¢ï¼Œè½¬ä¹‰å­—ç¬¦ä¹Ÿæ˜¯ä¸€ç§æ›¿æ¢ã€‚ #!/bin/basha=10echo -e Value of a is $a è¿™é‡Œ -e è¡¨ç¤ºå¯¹è½¬ä¹‰å­—ç¬¦è¿›è¡Œæ›¿æ¢ã€‚å¦‚æœä¸ä½¿ç”¨ -e é€‰é¡¹ï¼Œå°†ä¼šåŸæ ·è¾“å‡º Value of a is 10 å‘½ä»¤æ›¿æ¢å‘½ä»¤æ›¿æ¢æ˜¯å°†ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºå¦ä¸€ä¸ªå‘½ä»¤çš„å‚æ•°ã€‚å‘½ä»¤æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚ command1 `command2` å…¶ä¸­ï¼Œå‘½ä»¤ command2 çš„è¾“å‡ºå°†ä½œä¸ºå‘½ä»¤ command1 çš„å‚æ•°ã€‚ ls `pwd` //è¿™é‡Œæ˜¯åå¼•å·,å’Œ~æ˜¯åŒä¸€ä¸ªæŒ‰é”® pwd å‘½ä»¤ç”¨äºæ˜¾ç¤ºå½“å‰ç›®å½•çš„ç»å¯¹è·¯å¾„ã€‚åœ¨ä¸Šé¢çš„å‘½ä»¤è¡Œä¸­ï¼Œä½¿ç”¨å‘½ä»¤ç½®æ¢ç¬¦ï¼Œå°† pwd çš„è¿è¡Œç»“æœä½œä¸º ls å‘½ä»¤çš„å‚æ•°ã€‚æœ€ç»ˆï¼Œå‘½ä»¤æ‰§è¡Œç»“æœæ˜¯æ˜¾ç¤ºå½“å‰ç›®å½•çš„æ–‡ä»¶å†…å®¹ã€‚ éœ€è¦æ³¨æ„å‘½ä»¤ç½®æ¢å’Œç®¡é“ pipe çš„åŒºåˆ« å˜é‡æ›¿æ¢å˜é‡æ›¿æ¢å¯ä»¥æ ¹æ®å˜é‡çš„çŠ¶æ€ï¼ˆæ˜¯å¦ä¸ºç©ºã€æ˜¯å¦å®šä¹‰ç­‰ï¼‰æ¥æ”¹å˜å®ƒçš„å€¼å¯ä»¥ä½¿ç”¨çš„å˜é‡æ›¿æ¢å½¢å¼ å½¢å¼ è¯´æ˜ ${var} å˜é‡æœ¬æ¥çš„å€¼ ${var:-word} å¦‚æœå˜é‡ var ä¸ºç©ºæˆ–å·²è¢«åˆ é™¤ (unset)ï¼Œé‚£ä¹ˆè¿”å› wordï¼Œä½†ä¸æ”¹å˜ var çš„å€¼ã€‚ ${var:word} å¦‚æœå˜é‡ var ä¸ºç©ºæˆ–å·²è¢«åˆ é™¤(unset)ï¼Œé‚£ä¹ˆè¿”å›wordï¼Œå¹¶å°† var çš„å€¼è®¾ç½®ä¸º wordã€‚ ${var:?message} å¦‚æœå˜é‡ var ä¸ºç©ºæˆ–å·²è¢«åˆ é™¤ (unset)ï¼Œé‚£ä¹ˆå°†æ¶ˆæ¯ message é€åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œå¯ä»¥ç”¨æ¥æ£€æµ‹å˜é‡ var æ˜¯å¦å¯ä»¥è¢«æ­£å¸¸èµ‹å€¼ã€‚è‹¥æ­¤æ›¿æ¢å‡ºç°åœ¨ Shell è„šæœ¬ä¸­ï¼Œé‚£ä¹ˆè„šæœ¬å°†åœæ­¢è¿è¡Œã€‚ ${var:+word} å¦‚æœå˜é‡ var è¢«å®šä¹‰ï¼Œé‚£ä¹ˆè¿”å› wordï¼Œä½†ä¸æ”¹å˜ var çš„å€¼ã€‚ è¿ç®—ç¬¦Bash æ”¯æŒå¾ˆå¤šè¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬ï¼š ç®—æ•°è¿ç®—ç¬¦ å…³ç³»è¿ç®—ç¬¦ å¸ƒå°”è¿ç®—ç¬¦ å­—ç¬¦ä¸²è¿ç®—ç¬¦ æ–‡ä»¶æµ‹è¯•è¿ç®—ç¬¦ç®—æ•°è¿ç®—ç¬¦awk å’Œ exprï¼Œexpr #!/bin/bashval=`expr 2 + 2`echo value : $valval=`expr 2 \\* 2`echo value : $val è¾“å‡º value : 4 value : 4 è¡¨è¾¾å¼å’Œè¿ç®—ç¬¦ä¹‹é—´è¦æœ‰ç©ºæ ¼ï¼Œä¾‹å¦‚ 2+2 æ˜¯ä¸å¯¹çš„ï¼Œå¿…é¡»å†™æˆ 2 + 2 å®Œæ•´çš„è¡¨è¾¾å¼è¦è¢« åŒ…å«ï¼Œæ³¨æ„è¿™ä¸ªå­—ç¬¦ä¸æ˜¯å¸¸ç”¨çš„å•å¼•å·ï¼Œåœ¨ Esc é”®ä¸‹è¾¹ ä¹˜å· * å‰è¾¹å¿…é¡»åŠ åæ–œæ  \\ æ‰èƒ½å®ç°ä¹˜æ³•è¿ç®— `+``-``*``/``%`å–ä½™`=`èµ‹å€¼`==`ç›¸ç­‰`!=`ä¸ç­‰ å…³ç³»è¿ç®—ç¬¦å…³ç³»è¿ç®—ç¬¦åªæ”¯æŒæ•°å­—ï¼Œä¸æ”¯æŒå­—ç¬¦ä¸²ï¼Œé™¤éå­—ç¬¦ä¸²çš„å€¼æ˜¯æ•°å­—-eq ç›¸ç­‰-ne ä¸ç­‰-gt å·¦ä¾§å¤§äºå³ä¾§ï¼Œè¿”å› true-lt å°äº-ge å¤§äºç­‰äº-le å°äºç­‰äºå¸ƒå°”è¿ç®—ç¬¦! é-a ä¸-o æˆ–å­—ç¬¦ä¸²è¿ç®—ç¬¦ [ -z $String ] echo $? `=` æ£€æµ‹ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰è¿”å› trueã€‚`!=` ä¸ç­‰`-z` æ£€æµ‹å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º0ï¼Œä¸º0è¿”å› true`-n` æ£€æµ‹å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º0ï¼Œä¸ä¸º0è¿”å› true`str` æ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºè¿”å› trueã€‚ æ–‡ä»¶æµ‹è¯•è¿ç®—ç¬¦æ–‡ä»¶æµ‹è¯•è¿ç®—ç¬¦ç”¨äºæ£€æµ‹ Unix æ–‡ä»¶çš„å„ç§å±æ€§ [ -d /etc/fstab ] echo $? æ“ä½œç¬¦ ä½œç”¨ -b file æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯å—è®¾å¤‡æ–‡ä»¶ -c file æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯å­—ç¬¦è®¾å¤‡æ–‡ä»¶ -d file æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯ç›®å½• -f file æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯æ™®é€šæ–‡ä»¶ï¼ˆæ—¢ä¸æ˜¯ç›®å½•ï¼Œä¹Ÿä¸æ˜¯è®¾å¤‡æ–‡ä»¶ï¼‰ -g file æ£€æµ‹æ–‡ä»¶æ˜¯å¦è®¾ç½®äº† SGID ä½ -k file æ£€æµ‹æ–‡ä»¶æ˜¯å¦è®¾ç½®äº†ç²˜ç€ä½ (Sticky Bit) -p file æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯å…·åç®¡é“ -u file æ£€æµ‹æ–‡ä»¶æ˜¯å¦è®¾ç½®äº† SUID ä½ -r file æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯è¯» -w file æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯å†™ -x file æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œ -s file æ£€æµ‹æ–‡ä»¶æ˜¯å¦ä¸ºç©ºï¼ˆæ–‡ä»¶å¤§å°æ˜¯å¦å¤§äº 0ï¼‰ -e file æ£€æµ‹æ–‡ä»¶ï¼ˆåŒ…æ‹¬ç›®å½•ï¼‰æ˜¯å¦å­˜åœ¨ å­—ç¬¦ä¸²å­—ç¬¦ä¸²å¯ä»¥ç”¨å•å¼•å·ï¼Œä¹Ÿå¯ä»¥ç”¨åŒå¼•å·ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨å¼•å· å•å¼•å·é‡Œçš„ä»»ä½•å­—ç¬¦éƒ½ä¼šåŸæ ·è¾“å‡ºï¼Œå•å¼•å·å­—ç¬¦ä¸²ä¸­çš„å˜é‡æ˜¯æ— æ•ˆçš„ å•å¼•å·å­—ä¸²ä¸­ä¸èƒ½å‡ºç°å•å¼•å·ï¼ˆå¯¹å•å¼•å·ä½¿ç”¨è½¬ä¹‰ç¬¦åä¹Ÿä¸è¡Œï¼‰ åŒå¼•å·é‡Œå¯ä»¥æœ‰å˜é‡ åŒå¼•å·é‡Œå¯ä»¥å‡ºç°è½¬ä¹‰å­—ç¬¦ æ•°ç»„bash æ”¯æŒä¸€ç»´æ•°ç»„ï¼ˆä¸æ”¯æŒå¤šç»´æ•°ç»„ï¼‰ï¼Œå¹¶ä¸”æ²¡æœ‰é™å®šæ•°ç»„çš„å¤§å°ã€‚ç±»ä¼¼ä¸ C è¯­è¨€ï¼Œæ•°ç»„å…ƒç´ çš„ä¸‹æ ‡ç”± 0 å¼€å§‹ç¼–å·ã€‚è·å–æ•°ç»„ä¸­çš„å…ƒç´ è¦åˆ©ç”¨ä¸‹æ ‡ï¼Œä¸‹æ ‡å¯ä»¥æ˜¯æ•´æ•°æˆ–ç®—æœ¯è¡¨è¾¾å¼ï¼Œå…¶å€¼åº”å¤§äºæˆ–ç­‰äº 0ã€‚ å®šä¹‰æ•°ç»„ åœ¨ Shell ä¸­ï¼Œç”¨æ‹¬å·æ¥è¡¨ç¤ºæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ ç”¨â€ç©ºæ ¼â€ç¬¦å·åˆ†å‰²å¼€ã€‚å®šä¹‰æ•°ç»„çš„ä¸€èˆ¬å½¢å¼ä¸ºï¼š array_name=(value1 ... valuen) è¿˜å¯ä»¥å•ç‹¬å®šä¹‰æ•°ç»„çš„å„ä¸ªåˆ†é‡ï¼š array_name[0]=value0array_name[1]=value1array_name[2]=value2 è¯»å–æ•°ç»„è¯»å–æ•°ç»„å…ƒç´ å€¼çš„ä¸€èˆ¬æ ¼å¼æ˜¯ï¼š $array_name[index] ä½¿ç”¨ @ æˆ– * å¯ä»¥è·å–æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´  $array_name[*]$array_name[@] è·å–æ•°ç»„é•¿åº¦æˆ–å–æ•°ç»„é•¿åº¦çš„æ–¹æ³•ä¸è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ–¹æ³•ç›¸åŒï¼Œä¾‹å¦‚ï¼š # å–å¾—æ•°ç»„å…ƒç´ çš„ä¸ªæ•°length=$#array_name[@]# æˆ–è€…length=$#array_name[*]# å–å¾—æ•°ç»„å•ä¸ªå…ƒç´ çš„é•¿åº¦lengthn=$#array_name[n] é€»è¾‘è¯­å¥åŠŸèƒ½è¯­å¥read æ˜¯ç”¨æ¥è¯»å–ç”¨æˆ·è¾“å…¥ä¿¡æ¯çš„å‘½ä»¤ï¼Œèƒ½å¤ŸæŠŠæ¥æ”¶åˆ°çš„ç”¨æˆ·è¾“å…¥ä¿¡æ¯èµ‹å€¼ç»™åé¢çš„æŒ‡å®šå˜é‡ï¼Œ-p å‚æ•°ç”¨äºå‘ç”¨æˆ·æ˜¾ç¤ºä¸€å®šçš„æç¤ºä¿¡æ¯ã€‚ æ“ä½œç¬¦ ä½œç”¨ -p â€œ æç¤ºå†…å®¹ â€œ -t ç­‰å¾…ç”¨æˆ·è¾“å…¥æ—¶é—´ -n è¯»çš„å­—ç¬¦ä¸ªæ•° -s éšè—è¾“å…¥ read -n 5 AA BB CCread AA BB CChello xiaoming, mingtian you kongread -p Enter your scoreï¼ˆ0-100ï¼‰ï¼š GRADE åˆ¤æ–­è¯­å¥åˆ¤æ–­è¯­å¥æ ¼å¼ï¼š [ æ¡ä»¶è¡¨è¾¾å¼ ] å¯¹åº”ä¸¤è¾¹åº”å‡æœ‰ä¸€ä¸ªç©ºæ ¼ é€»è¾‘æµ‹è¯•è¯­å¥ï¼š ä¸ (å½“å‰é¢çš„å‘½ä»¤æ‰§è¡ŒæˆåŠŸåæ‰ä¼šæ‰§è¡Œå®ƒåé¢çš„å‘½ä»¤) æˆ–ï¼ˆå½“å‰é¢çš„å‘½ä»¤æ‰§è¡Œå¤±è´¥åæ‰ä¼šæ‰§è¡Œå®ƒåé¢çš„å‘½ä»¤ï¼‰ ï¼ éï¼ˆæŠŠæ¡ä»¶æµ‹è¯•ä¸­çš„åˆ¤æ–­ç»“æœå–ç›¸åå€¼ï¼‰ å¾—åˆ°å½“å‰å†…å­˜å‰©ä½™é‡ï¼š FreeMem=`free -m | grep Mem: | awk print $4`[ $FreeMem -lt 1024 ] echo Insufficient Memory break è¯­å¥break å‘½ä»¤å…è®¸è·³å‡ºæ‰€æœ‰å¾ªç¯ï¼ˆç»ˆæ­¢æ‰§è¡Œåé¢çš„æ‰€æœ‰å¾ªç¯ï¼‰ã€‚åœ¨åµŒå¥—å¾ªç¯ä¸­ï¼Œbreak å‘½ä»¤åé¢è¿˜å¯ä»¥è·Ÿä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè·³å‡ºç¬¬å‡ å±‚å¾ªç¯ã€‚ä¾‹å¦‚ï¼š break n //è¡¨ç¤ºè·³å‡ºç¬¬ n å±‚å¾ªç¯ã€‚ continue è¯­å¥continue å‘½ä»¤ä¸ break å‘½ä»¤ç±»ä¼¼ï¼Œåªæœ‰ä¸€ç‚¹å·®åˆ«ï¼Œå®ƒä¸ä¼šè·³å‡ºæ‰€æœ‰å¾ªç¯ï¼Œä»…ä»…è·³å‡ºå½“å‰å¾ªç¯ã€‚åŒæ ·ï¼Œcontinue åé¢ä¹Ÿå¯ä»¥è·Ÿä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºè·³å‡ºç¬¬å‡ å±‚å¾ªç¯ã€‚ ç»“æ„è¯­å¥case casecase var in1)...;;2|3|4)...;;esac case å·¥ä½œæ–¹å¼å¦‚ä¸Šæ‰€ç¤ºã€‚å–å€¼åé¢å¿…é¡»ä¸ºå…³é”®å­— inï¼Œæ¯ä¸€æ¨¡å¼å¿…é¡»ä»¥å³æ‹¬å·ç»“æŸã€‚å–å€¼å¯ä»¥ä¸ºå˜é‡æˆ–å¸¸æ•°ã€‚åŒ¹é…å‘ç°å–å€¼ç¬¦åˆæŸä¸€æ¨¡å¼åï¼Œå…¶é—´æ‰€æœ‰å‘½ä»¤å¼€å§‹æ‰§è¡Œç›´è‡³ ;;ã€‚;; ä¸å…¶ä»–è¯­è¨€ä¸­çš„ break ç±»ä¼¼ï¼Œæ„æ€æ˜¯è·³åˆ°æ•´ä¸ª case è¯­å¥çš„æœ€åã€‚ demo: #!/bin/bashread -p è¯·è¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶æŒ‰Enteré”®ç¡®è®¤ï¼š KEYcase $KEY in[a-z]|[A-Z]) echo è¾“å…¥çš„æ˜¯ å­—æ¯ã€‚ ;;[0-9]) echo è¾“å…¥çš„æ˜¯ æ•°å­—ã€‚ ;;*) echo è¾“å…¥çš„æ˜¯ ç©ºæ ¼ã€åŠŸèƒ½é”®æˆ–å…¶ä»–æ§åˆ¶å­—ç¬¦ã€‚esac å–å€¼å°†æ£€æµ‹åŒ¹é…çš„æ¯ä¸€ä¸ªæ¨¡å¼ã€‚ä¸€æ—¦æ¨¡å¼åŒ¹é…ï¼Œåˆ™æ‰§è¡Œå®ŒåŒ¹é…æ¨¡å¼ç›¸åº”å‘½ä»¤åä¸å†ç»§ç»­å…¶ä»–æ¨¡å¼ã€‚å¦‚æœæ— ä¸€åŒ¹é…æ¨¡å¼ï¼Œä½¿ç”¨æ˜Ÿå· * æ•è·è¯¥å€¼ï¼Œå†æ‰§è¡Œåé¢çš„å‘½ä»¤ã€‚ if if [ ] thenelsefiif [ ] thenelif [ ] thenelsefi demo: #!/bin/bashread -p Enter The Users Password : PASSWDfor UNAME in `cat users.txt`doid $UNAME /dev/null ï¼ˆå°±æ˜¯å’Œ2è¿™ä¸¤ä¸ªçš„ç»“åˆä½“ï¼‰if [ $? -eq 0 ] then echo Already existselse useradd $UNAME /dev/null echo $PASSWD | passwd --stdin $UNAME /dev/null if [ $? -eq 0 ] then echo $UNAME , Create success else echo $UNAME , Create failure fifidone å¾ªç¯è¯­å¥for for å˜é‡ in åˆ—è¡¨do..donefor ((i=0; iN; i++))dodonefor var in `ls`for var in $(ls)for var #åˆ—è¡¨çš„å†…å®¹æ˜¯ä½ç½®å‚æ•°å˜é‡æ—¶ï¼Œå¯ä»¥çœç•¥in ... åˆ—è¡¨æ˜¯ä¸€ç»„å€¼ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ç­‰ï¼‰ç»„æˆçš„åºåˆ—ï¼Œæ¯ä¸ªå€¼é€šè¿‡ç©ºæ ¼åˆ†éš”ã€‚æ¯å¾ªç¯ä¸€æ¬¡ï¼Œå°±å°†åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå€¼èµ‹ç»™å˜é‡ã€‚ demo: HLIST=`echo www.baidu.com`for IP in $HLISTdo ping -c 3 -i 0.2 -W 3 $IP /dev/nullif [ $? -eq 0 ] then echo baidu is onlineelse echo baidu is offlinefidone while while è¡¨è¾¾å¼do..donewhile (($i $loop))do...done while å¾ªç¯ç”¨äºä¸æ–­æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤ï¼Œä¹Ÿç”¨äºä»è¾“å…¥æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼›å‘½ä»¤é€šå¸¸ä¸ºæµ‹è¯•æ¡ä»¶ã€‚ demo: PRICE=$(expr $RANDOM % 1000)TIMES=0echo å•†å“å®é™…ä»·æ ¼ä¸º0-999ä¹‹é—´ï¼ŒçŒœçŒœçœ‹æ˜¯å¤šå°‘ï¼Ÿwhile truedo read -p è¯·è¾“å…¥çŒœæµ‹çš„ä»·æ ¼æ•°ç›®ï¼š INT let TIMES++ if [ $INT -eq $PRICE ] ; then echo æ­å–œç­”å¯¹äº†ï¼Œå®é™…ä»·æ ¼æ˜¯ $PRICE echo æ€»å…±çŒœæµ‹äº† $TIMES æ¬¡ exit 0 elif [ $INT -gt $PRICE] ; then echo å¤ªé«˜äº†ï¼ else echo å¤ªä½äº†ï¼ fidone untilluntil å¾ªç¯æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤ç›´è‡³æ¡ä»¶ä¸º true æ—¶åœæ­¢ã€‚until å¾ªç¯ä¸ while å¾ªç¯åœ¨å¤„ç†æ–¹å¼ä¸Šåˆšå¥½ç›¸åã€‚ä¸€èˆ¬ while å¾ªç¯ä¼˜äº until å¾ªç¯ã€‚ a=0until [ ! $a -lt 10 ]doecho $aa=`expr $a + 1`done å‡½æ•°å‡½æ•°å®šä¹‰ function_name () list of commands [ return value ]function function_name () list of commands [ return value ] å¦‚æœå¸Œæœ›ç›´æ¥ä»ç»ˆç«¯è°ƒç”¨å‡½æ•°ï¼Œå¯ä»¥å°†å‡½æ•°å®šä¹‰åœ¨ä¸»ç›®å½•ä¸‹çš„ .profile æ–‡ä»¶ï¼Œè¿™æ ·æ¯æ¬¡ç™»å½•åï¼Œåœ¨å‘½ä»¤æç¤ºç¬¦åé¢è¾“å…¥å‡½æ•°åå­—å°±å¯ä»¥ç«‹å³è°ƒç”¨ã€‚è¿”å›å€¼å‡½æ•°è¿”å›å€¼ï¼Œå¯ä»¥æ˜¾å¼å¢åŠ  return è¯­å¥ï¼›å¦‚æœä¸åŠ ï¼Œä¼šå°†æœ€åä¸€æ¡å‘½ä»¤è¿è¡Œç»“æœä½œä¸ºè¿”å›å€¼ã€‚æ¥æ”¶å‡½æ•°è¿”å›å€¼ç”¨ $?ã€‚Shell å‡½æ•°è¿”å›å€¼åªèƒ½æ˜¯æ•´æ•°ï¼Œä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºå‡½æ•°æ‰§è¡ŒæˆåŠŸä¸å¦ï¼Œ0 è¡¨ç¤ºæˆåŠŸï¼Œå…¶ä»–å€¼è¡¨ç¤ºå¤±è´¥ã€‚ï¼ˆè¿”å›å€¼èŒƒå›´ 0-255ï¼‰å¦‚æœ return å…¶ä»–æ•°æ®ï¼Œæ¯”å¦‚ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¾€å¾€ä¼šå¾—åˆ°é”™è¯¯æç¤ºï¼šâ€numeric argument requiredâ€ã€‚å¦‚æœä¸€å®šè¦è®©å‡½æ•°è¿”å›å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆå®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œç”¨æ¥æ¥æ”¶å‡½æ•°çš„è®¡ç®—ç»“æœï¼Œè„šæœ¬åœ¨éœ€è¦çš„æ—¶å€™è®¿é—®è¿™ä¸ªå˜é‡æ¥è·å¾—å‡½æ•°è¿”å›å€¼ã€‚è°ƒç”¨è°ƒç”¨å‡½æ•°åªéœ€è¦ç»™å‡ºå‡½æ•°åï¼Œä¸éœ€è¦åŠ æ‹¬å·ã€‚ Hello() echo hello, worldHelloHello2() echo hello2, worldreturn 1Hello2ret=$? è¾“å‡ºç»™äº†å˜é‡ var=$(Hello2) åˆ é™¤åƒåˆ é™¤å˜é‡ä¸€æ ·ï¼Œåˆ é™¤å‡½æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨ unset å‘½ä»¤ï¼Œä¸è¿‡è¦åŠ ä¸Š .f é€‰é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š unset .f function_name å‚æ•°åœ¨ Shell ä¸­ï¼Œè°ƒç”¨å‡½æ•°æ—¶å¯ä»¥å‘å…¶ä¼ é€’å‚æ•°ã€‚åœ¨å‡½æ•°ä½“å†…éƒ¨ï¼Œé€šè¿‡ $n çš„å½¢å¼æ¥è·å–å‚æ•°çš„å€¼ï¼Œä¾‹å¦‚ï¼Œ$1 è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ$2 è¡¨ç¤ºç¬¬äºŒä¸ªå‚æ•° è·å–ç¬¬åä¸ªå‚æ•°éœ€è¦ $10ã€‚å½“ n10 æ—¶ï¼Œéœ€è¦ä½¿ç”¨ $n æ¥è·å–å‚æ•°ã€‚ $# ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°ä¸ªæ•°ã€‚ $* æ˜¾ç¤ºæ‰€æœ‰ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°ã€‚ $@ ä¸ $* ç›¸åŒï¼Œä½†æ˜¯ç•¥æœ‰åŒºåˆ« $? å‡½æ•°çš„è¿”å›å€¼ã€‚ ä¼ å‚: function add_fun () add_fun str1 str2 str3 æ–‡ä»¶åŒ…å«Shell ä¹Ÿå¯ä»¥åŒ…å«å¤–éƒ¨è„šæœ¬ï¼Œå°†å¤–éƒ¨è„šæœ¬çš„å†…å®¹åˆå¹¶åˆ°å½“å‰è„šæœ¬ã€‚ . filenamesource filename ä¸¤ç§æ–¹å¼çš„æ•ˆæœç›¸åŒï¼Œç®€å•èµ·è§ï¼Œä¸€èˆ¬ä½¿ç”¨ç‚¹å· (.)ï¼Œä½†æ˜¯æ³¨æ„ç‚¹å· (.) å’Œæ–‡ä»¶åä¸­é—´æœ‰ä¸€ç©ºæ ¼ è¢«åŒ…å«è„šæœ¬ä¸éœ€è¦æœ‰æ‰§è¡Œæƒé™","categories":["2.ç¼–ç¨‹è¯­è¨€","Shell"]},{"title":"Shellç¯å¢ƒå˜é‡","path":"/2024/02/19/2-ç¼–ç¨‹è¯­è¨€-Shell-Shellç¯å¢ƒå˜é‡/","content":"ç¯å¢ƒå˜é‡åœ¨æ“ä½œç³»ç»Ÿä¸­æ‰®æ¼”ç€æä¸ºé‡è¦çš„è§’è‰²ï¼Œå®ƒä»¬æŒ‡å®šäº†ç³»ç»Ÿçš„è¿è¡Œç¯å¢ƒï¼ŒåŒ…æ‹¬ä¸€äº›åŸºæœ¬çš„å‚æ•°ï¼Œå¦‚ä¸´æ—¶æ–‡ä»¶å¤¹ä½ç½®å’Œç³»ç»Ÿæ–‡ä»¶å¤¹ä½ç½®ç­‰ã€‚ä¸‹é¢å°†æ›´è¯¦ç»†åœ°æ¢è®¨ Linux çš„ç¯å¢ƒå˜é‡ï¼Œæ¶µç›–å˜é‡çš„ç§ç±»ã€è®¾ç½®æ–¹æ³•åŠå¸¸ç”¨ç¯å¢ƒå˜é‡çš„ç¤ºä¾‹ã€‚ ä¸€ã€Linux çš„å˜é‡ç§ç±»æ ¹æ®å˜é‡çš„ç”Ÿå­˜å‘¨æœŸï¼ŒLinux å˜é‡å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸¤ç±»ï¼š æ°¸ä¹…å˜é‡ï¼šè¿™äº›å˜é‡éœ€è¦åœ¨ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹ã€‚ä¸€æ—¦æ›´æ”¹ï¼Œå®ƒä»¬ä¼šå¯¹æœªæ¥çš„æ‰€æœ‰ä¼šè¯æœ‰æ•ˆã€‚ ä¸´æ—¶å˜é‡ï¼šè¿™äº›å˜é‡ä½¿ç”¨ export å‘½ä»¤å£°æ˜åï¼Œä»…åœ¨å½“å‰çš„ shell ä¼šè¯ä¸­æœ‰æ•ˆã€‚ä¸€æ—¦å…³é—­ shellï¼Œæ­¤å˜é‡ä¾¿å¤±æ•ˆã€‚ äºŒã€è®¾ç½®å˜é‡çš„ä¸‰ç§æ–¹æ³• åœ¨ /etc/profile æ–‡ä»¶ä¸­æ·»åŠ å˜é‡ã€å¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼ˆæ°¸ä¹…çš„ï¼‰ã€‘ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚ VIï¼‰ç¼–è¾‘ /etc/profile æ–‡ä»¶ï¼Œå¯ä»¥å°†å˜é‡æ·»åŠ åˆ°æ‰€æœ‰ç”¨æˆ·çš„ç¯å¢ƒä¸­ã€‚ä¾‹å¦‚ï¼Œæƒ³è¦æ·»åŠ ä¸€ä¸ªæ–°çš„è·¯å¾„åˆ° PATH å˜é‡ä¸­ï¼Œå¯ä»¥è¿™æ ·åšï¼š # vi /etc/profile åœ¨æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼š export PATH=/home/fs:$PATH æ³¨ï¼šä¿®æ”¹å®Œæ–‡ä»¶åï¼Œè®°å¾—æ‰§è¡Œ source /etc/profile å‘½ä»¤ï¼Œä½¿æ›´æ”¹ç«‹å³ç”Ÿæ•ˆï¼Œå¦åˆ™å°†åœ¨ä¸‹æ¬¡é‡æ–°ç™»å½•æ—¶æ‰ä¼šç”Ÿæ•ˆã€‚ åœ¨ç”¨æˆ·ç›®å½•ä¸‹çš„ .bash_profile æ–‡ä»¶ä¸­å¢åŠ å˜é‡ã€å¯¹å•ä¸€ç”¨æˆ·ç”Ÿæ•ˆï¼ˆæ°¸ä¹…çš„ï¼‰ã€‘æ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸åä¸º .bash_profileã€‚ä¿®æ”¹è¿™ä¸€æ–‡ä»¶ä¹Ÿå¯ä»¥å®ç°å˜é‡çš„æŒä¹…åŒ–ã€‚ä¾‹å¦‚ï¼Œå¯¹ç”¨æˆ· guok çš„ .bash_profile æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼š # vi /home/guok/.bash_profile æ·»åŠ å¦‚ä¸‹å†…å®¹ä»¥è®¾ç½® CLASSPATHï¼š export CLASSPATH=./JAVA_HOME/lib:$JAVA_HOME/jre/lib æ³¨ï¼šåŒæ ·åœ°ï¼Œä¿®æ”¹åéœ€è¦è¿è¡Œ source /home/guok/.bash_profile ä»¥å¿«é€Ÿåº”ç”¨æ›´æ”¹ã€‚ ç›´æ¥è¿è¡Œ export å‘½ä»¤å®šä¹‰å˜é‡ã€åªå¯¹å½“å‰ shellï¼ˆBASHï¼‰æœ‰æ•ˆï¼ˆä¸´æ—¶çš„ï¼‰ã€‘å¦‚æœåœ¨å‘½ä»¤è¡Œè¿è¡Œ export å‘½ä»¤ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªä»…åœ¨å½“å‰ä¼šè¯å†…æœ‰æ•ˆçš„å˜é‡ï¼Œä¾‹å¦‚ï¼š export TEMP_VAR=Temporary Value è¿™ä¸ªå˜é‡åœ¨å½“å‰çš„ shell è¢«å…³é—­åå°†å¤±æ•ˆã€‚å¦‚æœé‡æ–°æ‰“å¼€ä¸€ä¸ª shellï¼Œéœ€è¦å†æ¬¡è®¾å®šè¯¥å˜é‡ã€‚ ä¸‰ã€PATH å£°æ˜PATH ç¯å¢ƒå˜é‡æ˜¯ç³»ç»ŸæŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶æ—¶çš„é‡è¦å‚æ•°ã€‚å®ƒçš„æ ¼å¼ä¸ºï¼šPATH=$PATH:your_custom_pathï¼Œå…¶ä¸­å¯ä»¥æ·»åŠ è‡ªå·±çš„è·¯å¾„ï¼Œå¹¶ç”¨å†’å· : è¿›è¡Œéš”å¼€ã€‚ä¸ºäº†ä½¿è·¯å¾„æ›´æ”¹ç«‹å³ç”Ÿæ•ˆï¼Œå¯ä»¥æ‰§è¡Œï¼š source ~/.bash_profile éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå°†å½“å‰è·¯å¾„ ./ æ·»åŠ åˆ° PATH ä¸­å¯èƒ½ä¼šå¼•èµ·å®‰å…¨é—®é¢˜ï¼Œå®¹æ˜“å—åˆ°æ„æƒ³ä¸åˆ°çš„æ”»å‡»ã€‚å®Œæˆè®¾ç½®åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰çš„ PATHï¼š echo $PATH è¿™æ ·å¯ä»¥ç¡®ä¿èƒ½å¤Ÿè¿…é€Ÿè®¿é—®ä½äº PATH ä¸­ç›®å½•çš„ç¨‹åºï¼Œé¿å…æ¯æ¬¡éƒ½è¾“å…¥å®Œæ•´è·¯å¾„ã€‚ å››ã€å¸¸ç”¨çš„ç¯å¢ƒå˜é‡ å˜é‡å å†…å®¹ PATH æŒ‡å®š shell æŸ¥æ‰¾å‘½ä»¤æˆ–ç¨‹åºçš„ç›®å½• HOME å½“å‰ç”¨æˆ·çš„ä¸»ç›®å½• HISTSIZE è®°å½•çš„å†å²å‘½ä»¤æ•° LOGNAME å½“å‰ç”¨æˆ·çš„ç™»å½•å HOSTNAME ä¸»æœºçš„åç§° SHELL å½“å‰ç”¨æˆ·ä½¿ç”¨çš„ shell ç±»å‹ LANGUAGE è¯­è¨€ç›¸å…³çš„ç¯å¢ƒå˜é‡ MAIL å½“å‰ç”¨æˆ·çš„é‚®ä»¶å­˜æ”¾ç›®å½• PS1 åŸºæœ¬æç¤ºç¬¦ï¼ˆroot ç”¨æˆ·ä¸º #ï¼Œæ™®é€šç”¨æˆ·ä¸º $ï¼‰ äº”ã€å¸¸ç”¨çš„ç¯å¢ƒå˜é‡ç›¸å…³å‘½ä»¤ æ˜¾ç¤ºç¯å¢ƒå˜é‡ HOME fs@ubuntu:~$ echo $HOME/home/fs è®¾ç½®ä¸€ä¸ªæ–°çš„ç¯å¢ƒå˜é‡ HELLO fs@ubuntu:~$ export HELLO=Hellofs@ubuntu:~$ echo $HELLOHello ä½¿ç”¨ env å‘½ä»¤æ˜¾ç¤ºæ‰€æœ‰ç¯å¢ƒå˜é‡ fs@ubuntu:~$ envSSH_AGENT_PID=2427GPG_AGENT_INFO=/tmp/keyring-Sqfg93/gpg:0:1...HELLO=Hello... ä½¿ç”¨ set å‘½ä»¤æ˜¾ç¤ºæ‰€æœ‰æœ¬åœ°å®šä¹‰çš„ shell å˜é‡ fs@ubuntu:~$ setBASH=/bin/bashBASH_VERSION=2.05b.0(1)-release... ä½¿ç”¨ unset å‘½ä»¤æ¥æ¸…é™¤ç¯å¢ƒå˜é‡ fs@ubuntu:~$ export TEST=Test # å¢åŠ ä¸€ä¸ªç¯å¢ƒå˜é‡ TESTfs@ubuntu:~$ env | grep TEST # éªŒè¯ç¯å¢ƒå˜é‡ TEST æ˜¯å¦å­˜åœ¨TEST=Testfs@ubuntu:~$ unset TEST # åˆ é™¤ç¯å¢ƒå˜é‡ TESTfs@ubuntu:~$ env | grep TEST # ç¡®è®¤å˜é‡å·²è¢«åˆ é™¤ ä½¿ç”¨ readonly å‘½ä»¤è®¾ç½®åªè¯»å˜é‡ fs@ubuntu:~$ export TEST=Test # å¢åŠ ç¯å¢ƒå˜é‡ TESTfs@ubuntu:~$ readonly TEST # å°† TEST è®¾ä¸ºåªè¯»fs@ubuntu:~$ unset TEST # å°è¯•åˆ é™¤åªè¯»å˜é‡# è¾“å‡ºå°†æ˜¾ç¤ºä¸å¯åˆ é™¤çš„é”™è¯¯ä¿¡æ¯ é€šè¿‡è¿™äº›æ“ä½œï¼Œç”¨æˆ·å¯ä»¥æ¸…æ™°åœ°ç®¡ç†å’Œè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä»è€Œå®šåˆ¶ Linux ç³»ç»Ÿçš„è¡Œä¸ºå’Œæ€§èƒ½ï¼Œä»¥é€‚åº”ä¸åŒçš„éœ€æ±‚å’Œå·¥ä½œç¯å¢ƒã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Shell"]},{"title":"Shellè„šæœ¬","path":"/2024/02/16/2-ç¼–ç¨‹è¯­è¨€-Shell-Shellè„šæœ¬/","content":"Shell è„šæœ¬çš„æœ¬è´¨Shell è„šæœ¬å®é™…ä¸Šæ˜¯ä¸€ç³»åˆ—æœ‰åºçš„ shell å‘½ä»¤é›†åˆï¼Œé€šè¿‡è¿™äº›å‘½ä»¤ï¼Œå¯ä»¥è‡ªåŠ¨åŒ–æ‰§è¡Œæ“ä½œï¼Œæå¤§åœ°æé«˜å·¥ä½œæ•ˆç‡ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹è„šæœ¬ï¼š #!/bin/bash devnull æ˜¯ä¸€ä¸ªè¢«ç§°ä½œ Linux é»‘æ´çš„æ–‡ä»¶ï¼ŒæŠŠè¾“å‡ºä¿¡æ¯é‡å®šå‘åˆ°è¿™ä¸ªæ–‡ä»¶ç­‰åŒäºåˆ é™¤æ•°æ® æ‰§è¡Œè„šæœ¬ æ”¹å˜è„šæœ¬æƒé™ä½¿ç”¨ chmod å‘½ä»¤èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™ï¼Œtest.sh å˜ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼š chmod u+x test.sh./test.sh # æ‰§è¡Œè„šæœ¬# è¾“å‡ºçš„æ–‡ä»¶è·¯å¾„ä¸º /home/fs/Temp/test.sh ç›´æ¥è°ƒç”¨ Bash æ‰§è¡Œè„šæœ¬é€šè¿‡æŒ‡å®š Bash è§£é‡Šå™¨æ¥è¿è¡Œè„šæœ¬ï¼š /bin/bash test.sh è®¾ç½® PATH å˜é‡ä¿®æ”¹ PATH ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥åœ¨ä»»æ„ç›®å½•ä¸‹æ‰§è¡Œ test.shï¼š chmod u+x test.shPATH+=:/home/fs/Temp # å°†è„šæœ¬æ‰€åœ¨è·¯å¾„è¿½åŠ åˆ° PATHtest.sh # åœ¨ä»»ä½•ä½ç½®å¯ä»¥ç›´æ¥æ‰§è¡Œ å°†è„šæœ¬ç§»åŠ¨åˆ°å¯æ‰§è¡Œç›®å½•ä½¿ç”¨ sudo å‘½ä»¤å°†è„šæœ¬ç§»åŠ¨åˆ° /bin/ ç›®å½•ï¼Œä»¥ä¾¿å…¨å±€å¯ç”¨ï¼š chmod u+x test.shsudo mv test.sh /bin/ Shell å˜é‡è‡ªå®šä¹‰å˜é‡ æ•°æ®ç±»å‹Shell ä¸åŒºåˆ†å˜é‡çš„æ•°æ®ç±»å‹ï¼Œæ‰€æœ‰å˜é‡éƒ½è§†ä¸ºå­—ç¬¦ä¸²ã€‚å³ä¾¿å°†æ•°å­—èµ‹å€¼ç»™å˜é‡ï¼Œå®ƒä»ä¼šè¢«è§†ä¸ºå­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼š number=123echo $number # è¾“å‡º 123 å‘½åè§„åˆ™å˜é‡åéœ€éµå¾ªæ ‡è¯†ç¬¦è§„å®šï¼Œå¦‚ä»¥å­—æ¯æˆ–ä¸‹åˆ’çº¿å¼€å¤´ï¼Œå¯ä»¥åŒ…å«å­—æ¯ã€æ•°å­—åŠä¸‹åˆ’çº¿ã€‚ å¼•ç”¨å˜é‡ä½¿ç”¨ $ ç›´æ¥å¼•ç”¨å˜é‡ï¼Œä¹Ÿå¯ä»¥ç”¨ $ è¿›è¡Œè¾¹ç•Œè¯†åˆ«ï¼Œé˜²æ­¢ä¸åç»­å­—ç¬¦æ··æ·†ï¼š Var=Helloecho $Var # Helloecho $Varworld # Helloworld åªè¯»å˜é‡å®šä¹‰åä¸å¯æ›´æ”¹ï¼š readonly varname åˆ é™¤å˜é‡å¯ä»¥ä½¿ç”¨ unset å‘½ä»¤åˆ é™¤æŸä¸ªå˜é‡ï¼š unset varname æ˜¾ç¤ºå˜é‡ä½¿ç”¨ set å‘½ä»¤å¯æŸ¥çœ‹å½“å‰è„šæœ¬ä¸­çš„æ‰€æœ‰å˜é‡ã€‚ ä½ç½®å˜é‡ ä½ç½®å‚æ•°å˜é‡æä¾›äº†è„šæœ¬è¿è¡Œæ—¶çš„ä¼ å…¥å‚æ•°ï¼š $#: å‚æ•°ä¸ªæ•° $?: ä¸Šä¸€æ¡å‘½ä»¤çš„è¿”å›ç»“æœ $$: å½“å‰è¿›ç¨‹ ID $1, $2, ...: ä»£è¡¨ç¬¬ 1 ä¸ªã€ç¬¬ 2 ä¸ªå‚æ•°ï¼Œ$10, $11 æ”¯æŒåˆ° 11 ä¸ªåé¢çš„å‚æ•° $@: æ‰€æœ‰å‚æ•°ï¼ˆä»¥ç©ºæ ¼åˆ†éš”ï¼‰ $*: æ‰€æœ‰å‚æ•°ä½œä¸ºä¸€ä¸ªæ•´ä½“ ç¯å¢ƒå˜é‡ (å…¨å±€å˜é‡) ä½¿ç”¨ env å‘½ä»¤å¯ä»¥æ˜¾ç¤ºå½“å‰ç¯å¢ƒå˜é‡ã€‚ export å‘½ä»¤å¯ä»¥å°†å±€éƒ¨å˜é‡æå‡ä¸ºå…¨å±€å˜é‡ï¼Œä»¥ä¾¿åœ¨å­è¿›ç¨‹ä¸­è®¿é—®ï¼š export variable_name åœ¨è„šæœ¬å†…éƒ¨å®šä¹‰çš„å˜é‡åªåœ¨å½“å‰è„šæœ¬ä¸­æœ‰æ•ˆï¼Œä¸ä¼šå½±å“å…¨å±€ç¯å¢ƒã€‚ åŠŸèƒ½è¯­å¥readread å‘½ä»¤ç”¨äºä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®ï¼Œå¯ä»¥è®¾å®šæç¤ºä¿¡æ¯æˆ–è¾“å…¥é™åˆ¶ã€‚ read -p è¯·è¾“å…¥å†…å®¹: user_input -t: æŒ‡å®šç­‰å¾…ç”¨æˆ·è¾“å…¥çš„æ—¶é—´ï¼ˆç§’ï¼‰ -n: é™åˆ¶è¯»å–çš„å­—ç¬¦æ•° -s: éšè—ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚è¾“å…¥å¯†ç ï¼‰ ç¤ºä¾‹ï¼š read -n 5 user_variable # åªè¯»å– 5 ä¸ªå­—ç¬¦ exprexpr å‘½ä»¤ç”¨äºè¿›è¡Œç®—æœ¯è¿ç®—ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š sum=$(expr $AA + $BB) # ç”¨ expr è®¡ç®— AA å’Œ BB çš„å’Œ# ç­‰ä»·äºsum=$(($AA + $BB)) # ä½¿ç”¨å†…ç½®çš„ç®—æœ¯æ‰©å±• testtest å‘½ä»¤ç”¨äºæ¡ä»¶åˆ¤æ–­ï¼Œæ”¯æŒå¤šç§ç±»å‹çš„æ¯”è¾ƒï¼š å­—ç¬¦ä¸²æ¯”è¾ƒï¼š =: åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ !=: åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ç›¸ç­‰ æ•´æ•°æ¯”è¾ƒï¼š -eq: ç›¸ç­‰ -ne: ä¸ç›¸ç­‰ -gt: å¤§äº -ge: å¤§äºæˆ–ç­‰äº -lt: å°äº -le: å°äºæˆ–ç­‰äº æ–‡ä»¶å±æ€§æ£€æŸ¥ï¼š -d: åˆ¤æ–­æ˜¯å¦ä¸ºç›®å½• -f: åˆ¤æ–­æ˜¯å¦ä¸ºæ–‡ä»¶ -r: åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯è¯» -w: åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯å†™ åˆ¤æ–­è¯­å¥åˆ¤æ–­è¯­å¥çš„åŸºæœ¬æ ¼å¼ä¸º \\[ æ¡ä»¶è¡¨è¾¾å¼ \\]ï¼Œæ¡ä»¶è¡¨è¾¾å¼ç”¨äºè¯„ä¼°æ–‡ä»¶æˆ–ç›®å½•çš„ç‰¹æ€§ã€é€»è¾‘æ¡ä»¶æˆ–æ•°å€¼æ¯”è¾ƒç­‰ã€‚ä¸¤è¾¹éœ€ç•™æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œä»¥ç¡®ä¿æ­£ç¡®è¯†åˆ«ã€‚ æ–‡ä»¶æµ‹è¯•è¯­å¥ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¯­å¥ç”¨äºåˆ¤æ–­ /etc/fstab æ˜¯å¦ä¸ºä¸€ä¸ªç›®å½•ï¼Œè¿”å›çš„ $? è¡¨ç¤ºè¯¥å‘½ä»¤çš„æ‰§è¡ŒçŠ¶æ€ï¼Œ0 è¡¨ç¤ºæˆåŠŸï¼Œå…¶ä»–å€¼è¡¨ç¤ºå¤±è´¥ï¼š [ -d /etc/fstab ] echo $? æ“ä½œç¬¦ ä½œç”¨ -d æµ‹è¯•æ–‡ä»¶æ˜¯å¦ä¸ºç›®å½•ç±»å‹ -e æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨ -f åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸ºå¸¸è§„æ–‡ä»¶ -r æµ‹è¯•å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¯»å–è¯¥æ–‡ä»¶ -w æµ‹è¯•å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å†™å…¥è¯¥æ–‡ä»¶ -x æµ‹è¯•å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™æ‰§è¡Œè¯¥æ–‡ä»¶ é€»è¾‘æµ‹è¯•è¯­å¥é€»è¾‘æµ‹è¯•è¯­å¥å…è®¸é€šè¿‡ç»„åˆå¤šä¸ªæ¡ä»¶æ¥è¡¨è¾¾é€»è¾‘å…³ç³»ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæƒ³åœ¨æŸä¸ªæ–‡ä»¶å­˜åœ¨ä¸”å…·æœ‰è¯»å–æƒé™æ—¶æ‰§è¡ŒæŸä¸ªå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ï¼š ä¸ï¼ˆè¡¨ç¤ºå‰é¢çš„å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œæ‰ä¼šæ‰§è¡Œåé¢çš„å‘½ä»¤ï¼‰ ! éï¼ˆè¡¨ç¤ºåè½¬æ¡ä»¶æµ‹è¯•çš„ç»“æœï¼Œä¾‹å¦‚ï¼Œå¦‚æœæ¡ä»¶ä¸ºçœŸåˆ™åè½¬ä¸ºå‡ï¼‰ æ•´æ•°å€¼æ¯”è¾ƒè¯­å¥æ•´æ•°å€¼æ¯”è¾ƒè¯­å¥ç”¨äºå¯¹æ•°å€¼è¿›è¡Œæ¯”è¾ƒã€‚æ¯”å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åˆ¤æ–­ä¸¤ä¸ªæ•°å€¼æ˜¯å¦ç›¸ç­‰ï¼š [ 10 -eq 10 ] echo $? å¦‚æœæ¯”è¾ƒå†…å­˜æƒ…å†µï¼Œä¸‹é¢çš„è„šæœ¬å¯ä»¥è·å–å½“å‰å‰©ä½™å†…å­˜å¹¶åˆ¤æ–­æ˜¯å¦å……è¶³ï¼š FreeMem=`free -m | grep Mem: | awk print $4`[ $FreeMem -lt 1024 ] echo Insufficient Memory æ“ä½œç¬¦ ä½œç”¨ -eq åˆ¤æ–­æ˜¯å¦ç­‰äº -ne åˆ¤æ–­æ˜¯å¦ä¸ç­‰äº -gt åˆ¤æ–­æ˜¯å¦å¤§äº -lt åˆ¤æ–­æ˜¯å¦å°äº -le åˆ¤æ–­æ˜¯å¦å°äºæˆ–ç­‰äº -ge åˆ¤æ–­æ˜¯å¦å¤§äºæˆ–ç­‰äº å­—ç¬¦ä¸²æ¯”è¾ƒè¯­å¥å­—ç¬¦ä¸²æ¯”è¾ƒè¯­å¥ç”¨äºè¯„ä¼°å­—ç¬¦ä¸²é—´çš„å…³ç³»ã€‚æ¯”å¦‚ï¼Œç”¨äºæ£€æŸ¥æŸä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºçš„è¯­å¥å¦‚ä¸‹ï¼š [ -z $String ] echo $? æ“ä½œç¬¦ ä½œç”¨ æ¯”è¾ƒå­—ç¬¦ä¸²å†…å®¹æ˜¯å¦ç›¸åŒ ! æ¯”è¾ƒå­—ç¬¦ä¸²å†…å®¹æ˜¯å¦ä¸åŒ -z åˆ¤æ–­å­—ç¬¦ä¸²å†…å®¹æ˜¯å¦ä¸ºç©º é€šè¿‡è¿™äº›åŸºæœ¬çš„æµ‹è¯•è¯­å¥å’Œæ¯”è¾ƒæ“ä½œç¬¦ï¼Œç”¨æˆ·å¯ä»¥çµæ´»åœ°è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œè¿™åœ¨è„šæœ¬ç¼–å†™ä¸­è‡³å…³é‡è¦ã€‚ç†è§£è¿™äº›åŸºç¡€å¯ä»¥å¸®åŠ©ç”¨æˆ·æ›´æœ‰æ•ˆåœ°è¿›è¡Œç¼–ç¨‹ä¸è‡ªåŠ¨åŒ–å¤„ç†ã€‚ ç»“æ„è¯­å¥æ¡ä»¶è¯­å¥æ¡ä»¶è¯­å¥ç”¨äºæ ¹æ®ç‰¹å®šæ¡ä»¶çš„çœŸå‡æ¥æ‰§è¡Œä¸åŒçš„ä»£ç å—ã€‚ä»¥ä¸‹æ˜¯åŸºæœ¬çš„ç»“æ„ç¤ºä¾‹ï¼š if [ condition ]; then # å¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œæ‰§è¡Œçš„ä»£ç fi åœ¨è¿™ä¸ªç»“æ„ä¸­ï¼Œå¦‚æœæ–¹æ‹¬å·ä¸­çš„æ¡ä»¶ä¸ºçœŸï¼Œæ¥ä¸‹æ¥çš„ä»£ç å—å°±ä¼šè¢«æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œå¦‚æœæƒ³æ£€æŸ¥æŸä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹ä»£ç ï¼š if [ -f example.txt ]; then echo æ–‡ä»¶å­˜åœ¨fi ç¬¬äºŒç§å½¢å¼çš„æ¡ä»¶è¯­å¥æä¾›äº†ä¸€ä¸ªâ€å¦åˆ™â€çš„é€‰é¡¹ï¼š if [ condition ]; then # å¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œæ‰§è¡Œçš„ä»£ç else # å¦‚æœæ¡ä»¶ä¸ä¸ºçœŸï¼Œæ‰§è¡Œçš„ä»£ç fi ä¾‹å¦‚ï¼Œæ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶çš„å­˜åœ¨æ€§ï¼Œå¹¶åœ¨å…¶ä¸å­˜åœ¨æ—¶æä¾›åé¦ˆï¼š if [ -f example.txt ]; then echo æ–‡ä»¶å­˜åœ¨else echo æ–‡ä»¶ä¸å­˜åœ¨fi casecase è¯­å¥æ˜¯ä¸€ç§å¤šåˆ†æ”¯é€‰æ‹©ç»“æ„ï¼Œå¯ä»¥è®©æ ¹æ®å˜é‡çš„å€¼æ‰§è¡Œä¸åŒçš„ä»£ç å—ã€‚å…¶åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š case var in pattern1) # ä¸ pattern1 åŒ¹é…æ—¶æ‰§è¡Œçš„ä»£ç  ;; pattern2|pattern3) # ä¸ pattern2æˆ– pattern3 åŒ¹é…æ—¶æ‰§è¡Œçš„ä»£ç  ;;esac ä¾‹å¦‚ï¼Œå‡è®¾è¦æ ¹æ®ç”¨æˆ·è¾“å…¥çš„é¢œè‰²æ¥è¾“å‡ºç›¸åº”çš„æ¶ˆæ¯ï¼š case $color in red) echo é€‰æ‹©çš„æ˜¯çº¢è‰² ;; green) echo é€‰æ‹©çš„æ˜¯ç»¿è‰² ;; blue) echo é€‰æ‹©çš„æ˜¯è“è‰² ;; *) echo æœªçŸ¥é¢œè‰² ;;esac å¾ªç¯è¯­å¥å¾ªç¯è¯­å¥ç”¨äºé‡å¤æ‰§è¡Œä»£ç å—ï¼Œç›´åˆ°æ»¡è¶³æŸä¸ªæ¡ä»¶ä¸ºæ­¢ã€‚ for å¾ªç¯ç”¨äºåœ¨ä¸€ä¸ªé¢„å®šä¹‰çš„åˆ—è¡¨ä¸­éå†æ¯ä¸ªå…ƒç´ ï¼Œå…¶åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š for var in list; do # å¾ªç¯ä¸­çš„ä»£ç done ä¾‹å¦‚ï¼Œåˆ—å‡ºæ•°å­— 1 åˆ° 5 çš„ç¤ºä¾‹ï¼š for num in 1 2 3 4 5; do echo å½“å‰æ•°å­—æ˜¯ $numdone while å¾ªç¯åœ¨æ¡ä»¶æˆç«‹æ—¶ç»§ç»­æ‰§è¡Œä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š while [ condition ]; do # å¾ªç¯ä¸­çš„ä»£ç done ä¾‹å¦‚ï¼Œä½¿ç”¨ while å¾ªç¯æ‰“å°å°äº 5 çš„æ•°å­—ï¼š count=1while [ $count -le 5 ]; do echo å½“å‰è®¡æ•°æ˜¯ $count count=$((count + 1))done until å¾ªç¯åˆ™æ˜¯å½“æ¡ä»¶ä¸æˆç«‹æ—¶ç»§ç»­æ‰§è¡Œï¼ŒåŸºæœ¬å½¢å¼å¦‚ä¸‹ï¼š until [ condition ]; do # å¾ªç¯ä¸­çš„ä»£ç done ä¾‹å¦‚ï¼Œä½¿ç”¨ until å¾ªç¯æ‰“å°æ•°å­—ï¼Œç›´åˆ°è®¡æ•°è¾¾åˆ° 5ï¼š count=1until [ $count -gt 5 ]; do echo å½“å‰è®¡æ•°æ˜¯ $count count=$((count + 1))done å‡½æ•°å®šä¹‰å’Œä½¿ç”¨å‡½æ•°çš„è¿‡ç¨‹ç›¸å¯¹ç›´è§‚ã€‚å‡½æ•°çš„è¿”å›å€¼å¯ä»¥é€šè¿‡ç‰¹æ®Šå˜é‡ $? æ¥è·å–ï¼Œè¿™ä¸ªå˜é‡ä¼šå­˜å‚¨å‡½æ•°æ‰§è¡Œåè¿”å›çš„ç»“æœã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿”å›å€¼çš„èŒƒå›´æ˜¯ 0 åˆ° 255ï¼Œå…¶ä¸­ 0 é€šå¸¸è¡¨ç¤ºæˆåŠŸï¼Œå…¶ä»–å€¼åˆ™ç”¨äºæŒ‡ç¤ºä¸åŒçš„é”™è¯¯æˆ–å¼‚å¸¸çŠ¶æ€ã€‚è¿™ç§è®¾å®šä¸ºé”™è¯¯å¤„ç†å’Œè°ƒè¯•æä¾›äº†ä¾¿åˆ©ã€‚ å‡½æ•°å®šä¹‰ç¤ºä¾‹function_name() # åœ¨è¿™é‡Œç¼–å†™ä»£ç  åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œfunction_name æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°åï¼Œå‡½æ•°ä½“å†…å¯ä»¥åŒ…å«ä»»ä½•æœ‰æ•ˆçš„ Bash ä»£ç ã€‚ä¸€æ—¦å®šä¹‰äº†å‡½æ•°ï¼Œå°±å¯ä»¥åœ¨è„šæœ¬çš„å…¶ä»–éƒ¨åˆ†è¿›è¡Œè°ƒç”¨ã€‚ ä¼ é€’å‚æ•°ç¤ºä¾‹å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå°†å‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œä¾‹å¦‚ï¼š function_name arg1 arg2 åœ¨è¿™é‡Œï¼Œarg1 å’Œ arg2 æ˜¯ä¼ é€’ç»™ function_name å‡½æ•°çš„å‚æ•°ã€‚è¿™äº›å‚æ•°å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨é€šè¿‡ $1ã€$2 çš„æ–¹å¼è®¿é—®ï¼Œå…¶ä¸­ $1 è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ$2 è¡¨ç¤ºç¬¬äºŒä¸ªå‚æ•°ã€‚ä¸¾ä¸ªä¾‹å­ï¼š greet() echo Hello, $1! Welcome to the world of Bash scripting.greet Alice åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“è°ƒç”¨ greet Alice æ—¶ï¼Œå‡½æ•°å°†è¾“å‡º Hello, Alice! Welcome to the world of Bash scripting.ã€‚è¿™æ ·ï¼Œå‡½æ•°ä¸ä»…å°è£…äº†ä»£ç ï¼Œè¿˜å¯ä»¥æ ¹æ®ä¼ å…¥ä¸åŒçš„å‚æ•°è¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºã€‚ è·å–è¿”å›å€¼ç¤ºä¾‹å‡è®¾æœ‰ä¸€ä¸ªè®¡ç®—ä¸¤ä¸ªæ•°å’Œçš„å‡½æ•°ï¼š sum() return $(($1 + $2))sum 5 10echo The return value is $? åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œsum å‡½æ•°è®¡ç®— 5 å’Œ 10 çš„å’Œï¼Œå¹¶å°†ç»“æœä½œä¸ºè¿”å›å€¼ã€‚ç„¶åï¼Œé€šè¿‡ echo The return value is $? å¯ä»¥çœ‹åˆ°å‡½æ•°è¿”å›çš„ç»“æœæ˜¯ 0ï¼Œå› ä¸º Bash åªä¼šè¿”å› 0-255 çš„æ•°å€¼ã€‚å¦‚æœå¸Œæœ›åœ¨å‡½æ•°ä¸­ç›´æ¥è¾“å‡ºç»“æœè€Œä¸æ˜¯è¿”å›å®ƒï¼Œå¯ä»¥ä½¿ç”¨ echoï¼Œä½†è¦çŸ¥é“è¿™å’Œè¿”å›å€¼æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µã€‚ å°ç»“å‡½æ•°æ˜¯ Bash è„šæœ¬ä¸­éå¸¸é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œå®ƒä»¬å…è®¸é‡ç”¨ä»£ç å¹¶ç»„ç»‡é€»è¾‘ã€‚é€šè¿‡å‡½æ•°ï¼Œå¯ä»¥å¤„ç†å¤æ‚çš„ä»»åŠ¡ï¼Œåªéœ€ä¸€æ¬¡å®šä¹‰ï¼Œä¾¿å¯å¤šæ¬¡è°ƒç”¨ï¼Œå¹¶ä¸”å¯ä»¥çµæ´»åœ°ä¼ é€’å‚æ•°ï¼Œä»è€Œæé«˜è„šæœ¬çš„æ•ˆç‡å’Œå¯è¯»æ€§ã€‚æŒæ¡å‡½æ•°çš„ä½¿ç”¨ï¼Œèƒ½å¤Ÿä½¿çš„è„šæœ¬æ›´å…·æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤æ€§ã€‚ Shell è„šæœ¬å„ç§æ‰§è¡Œæ–¹å¼åœ¨ä½¿ç”¨ Shell è„šæœ¬æ—¶ï¼Œäº†è§£ä¸åŒæ‰§è¡Œæ–¹å¼çš„åŒºåˆ«éå¸¸é‡è¦ã€‚å…³æ³¨çš„æ˜¯ä¸‰ç§æ‰§è¡Œè„šæœ¬çš„æ–¹å¼ï¼š./*.shã€. ./*.sh å’Œ source ./*.shã€‚ æ‰§è¡Œæ–¹å¼çš„æ¯”è¾ƒ1. ./*.shã€sh ./*.sh å’Œ bash ./*.shè¿™ä¸‰ç§æ–¹å¼æœ¬è´¨ä¸Šæ˜¯ç›¸åŒçš„ã€‚å®ƒä»¬éƒ½å¯åŠ¨äº†ä¸€ä¸ªæ–°çš„å­ Shell è¿›ç¨‹ï¼Œåœ¨è¿™ä¸ªå­è¿›ç¨‹ä¸­æ‰§è¡Œè„šæœ¬ã€‚æ‰§è¡Œåï¼Œæ‰€æœ‰åœ¨è¿™ä¸ªè„šæœ¬å†…å®šä¹‰çš„å˜é‡å’Œæ›´æ”¹çš„çŠ¶æ€éƒ½ä¸ä¼šå½±å“åˆ°çˆ¶ Shellã€‚å¯ä»¥ç†è§£ä¸ºï¼Œå­ Shell å°±åƒä¸€ä¸ªä¸´æ—¶çš„å·¥ä½œç¯å¢ƒï¼Œæ“ä½œç»“æŸåï¼Œå®ƒä¾¿ä¼šæ¶ˆå¤±ï¼Œå¸¦èµ°çš„åªä¼šæ˜¯è‡ªå·±æ‰€åšçš„è®°å½•ã€‚ ç¤ºä¾‹name=dangxu # å®šä¹‰ä¸€èˆ¬å˜é‡echo $name # è¾“å‡ºï¼šdangxu æ¥ä¸‹æ¥ï¼Œå‡è®¾åœ¨ test.sh æ–‡ä»¶å†…æœ‰å¦‚ä¸‹å†…å®¹ï¼š #!/bin/shecho $name # è¾“å‡ºå˜é‡å†…å®¹ æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š ./test.sh # è¾“å‡ºä¸ºç©ºï¼Œå› ä¸ºåœ¨å­ Shell ä¸­æ²¡æœ‰ç»§æ‰¿åˆ°å˜é‡sh ./test.sh # è¾“å‡ºä¸ºç©ºbash ./test.sh # è¾“å‡ºä¸ºç©º å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸‰ä¸ªå‘½ä»¤ä¸­ï¼Œname å˜é‡æ²¡æœ‰è¢«ä¼ é€’ç»™å­ Shellï¼Œæ‰€ä»¥è„šæœ¬å†…éƒ¨è¾“å‡ºä¸ºç©ºã€‚ 2. . ./*.sh å’Œ source ./*.shè¿™ä¸¤ç§æ–¹å¼æ˜¯ç­‰ä»·çš„ï¼Œéƒ½æ˜¯åœ¨å½“å‰ Shell è¿›ç¨‹ä¸­æ‰§è¡Œè„šæœ¬ã€‚ä¸å‰é¢çš„æ–¹æ³•ä¸åŒï¼Œå½“å‰ Shell çš„ä¸Šä¸‹æ–‡è¢«ä¿ç•™ï¼Œå˜é‡çš„å®šä¹‰å’ŒçŠ¶æ€çš„æ”¹å˜ä¼šåœ¨å½“å‰ç¯å¢ƒä¸­ç”Ÿæ•ˆã€‚ ç¤ºä¾‹ç»§ç»­ä½¿ç”¨ä¹‹å‰çš„ test.sh å†…å®¹ï¼Œåœ¨å½“å‰ Shell ä¸­è¿è¡Œï¼š . ./test.sh # è¿™é‡Œå°†è¾“å‡ºå˜é‡å†…å®¹ï¼šdangxusource ./test.sh # åŒæ ·å°†è¾“å‡ºå˜é‡å†…å®¹ï¼šdangxu åœ¨è¿™ä¸¤ç§æ‰§è¡Œæ–¹å¼ä¸­ï¼Œå› ä¸ºæ˜¯åœ¨å½“å‰ Shell ä¸­è¿è¡Œè„šæœ¬ï¼Œæ‰€ä»¥å˜é‡ name çš„å€¼å¯ä»¥è¢«æ­£ç¡®åœ°è¾“å‡ºã€‚ éªŒè¯ä¾æ®Shell çš„æœºåˆ¶å†³å®šäº†éç¯å¢ƒå˜é‡ï¼ˆæœªä½¿ç”¨ export å…³é”®å­—å¯¼å‡ºçš„å˜é‡ï¼‰ä¸ä¼šè¢«å­ Shell ç»§æ‰¿ã€‚è¿™ä¸€ç‰¹æ€§æ˜¯åˆ¤æ–­è„šæœ¬æ‰§è¡Œä¸Šä¸‹æ–‡çš„å…³é”®ä¾æ®ã€‚ éªŒè¯ç»“æœé€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œå¯ä»¥åœ¨ç»ˆç«¯ä¸‹è§‚å¯Ÿåˆ°å˜é‡çš„è¡Œä¸ºï¼š [root@localhost ~]# name=dangxu # å®šä¹‰å˜é‡[root@localhost ~]# echo $name # è¾“å‡ºï¼šdangxu[root@localhost ~]# cat test.sh # éªŒè¯è„šæœ¬#!/bin/shecho $name # å°†è¾“å‡ºå˜é‡å†…å®¹ æ¥ä¸‹æ¥éªŒè¯æ–‡ä»¶æƒé™ï¼Œç¡®ä¿è„šæœ¬å¯æ‰§è¡Œï¼š [root@localhost ~]# ls -l test.sh-rwxr-xr-x 1 root root 23 Feb 6 11:09 test.sh ç„¶ååˆ†åˆ«æ‰§è¡Œä¸åŒçš„å‘½ä»¤æ¥éªŒè¯çš„ç»“è®ºï¼š ä½¿ç”¨å­ Shell æ‰§è¡Œï¼š ./test.sh # è¾“å‡ºä¸ºç©ºsh ./test.sh # è¾“å‡ºä¸ºç©ºbash ./test.sh # è¾“å‡ºä¸ºç©º åœ¨å½“å‰ Shell ä¸­æ‰§è¡Œï¼š . ./test.sh # è¾“å‡ºï¼šdangxusource ./test.sh # è¾“å‡ºï¼šdangxu æœ€ç»ˆï¼Œé€šè¿‡è¿™äº›å®ä¾‹å’ŒéªŒè¯å¾—å‡ºç»“è®ºï¼Œæ¸…æ™°åœ°äº†è§£äº†å„ç§ Shell è„šæœ¬æ‰§è¡Œæ–¹å¼çš„è¡Œä¸ºåŠå…¶åŒºåˆ«ã€‚è¿™å¯¹äºæ—¥å¸¸çš„ Shell ç¼–ç¨‹å’Œè°ƒè¯•éƒ½æ˜¯è‡³å…³é‡è¦çš„ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","Shell"]},{"title":"ä½¿ç”¨æœåŠ¡å¯åŠ¨ç¨‹åºæ—¥å¿—ä¹±ç è§£å†³","path":"/2024/02/15/2-ç¼–ç¨‹è¯­è¨€-Shell-ä½¿ç”¨æœåŠ¡å¯åŠ¨ç¨‹åºæ—¥å¿—ä¹±ç è§£å†³/","content":"ä½¿ç”¨ service å¯åŠ¨ Qt ç¨‹åºæ—¶ï¼Œè¾“å‡ºçš„æ—¥å¿—æ˜¯ä¸­æ–‡ä¹±ç  ç›´æ¥å¯åŠ¨ç¨‹åºï¼Œè¾“å‡ºçš„æ—¥å¿—å´æ˜¯æ­£å¸¸çš„ï¼Œè¿™ç§é—®é¢˜è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ æ–¹æ¡ˆä¸€ç¼–è¾‘ service æ–‡ä»¶ vim /sbin/service åœ¨ env -i åé¢åŠ ä¸Š LANG=$LANG ç³»ç»Ÿæœ¬èº«éœ€æ”¯æŒä¸­æ–‡è¯­è¨€åŒ… æ–¹æ¡ˆäºŒåœ¨å¯åŠ¨è„šæœ¬ä¸­å¼•å…¥ç¯å¢ƒå˜é‡","categories":["2.ç¼–ç¨‹è¯­è¨€","Shell"]},{"title":"JavaScript","path":"/2024/02/14/2-ç¼–ç¨‹è¯­è¨€-å…¶ä»–è¯­æ³•-JavaScript/","content":"ç¤ºä¾‹åˆ†æ//åœ¨å½“å‰é¡µé¢é‡æ–°è½½å…¥é¡µé¢function reloadPageContent(reloadPage) window.location.replace(reloadPage);//æŒ‰é’®ç‚¹å‡»å±•å¼€æˆ–éšè—function updateClick() $(document).ready((function() //readyå‡½æ•°æ¥ç¡®ä¿æ–‡æ¡£åŠ è½½å®Œæ¯•åå†æ‰§è¡Œä»£ç (jqueryåº“ä»£ç )\t$(a).click((function() //ä¸ºæ–‡æ¡£ä¸­çš„æ‰€æœ‰aæ ‡ç­¾ç»‘å®šç‚¹å‡»äº‹ä»¶ $(this).next(.menu).toggle()//æ‰¾åˆ°å½“å‰è¢«ç‚¹å‡»çš„aæ ‡ç­¾çš„ä¸‹ä¸€ä¸ª.menuç±»çš„å…ƒç´ ï¼Œåˆ‡æ¢å®ƒçš„å¯è§æ€§\t)) ))//è·å–å¹¶æ›´æ–°innerHTMLä¸­çš„å†…å®¹function getInnerHTML(filePos) var xhr = new XMLHttpRequest(); xhr.open(GET, filePos, true); xhr.onreadystatechange = function() if (xhr.readyState === 4 xhr.status === 200) var htmlContent = xhr.responseText; document.getElementById(mainmenu).innerHTML = htmlContent; updateClick(); ; xhr.send();function showPicture() fetch(http://124.222.246.202/get_picture?id=1, method: GET,headers: Content-Type: application/json,) .then(response = response.text()) .then(data = document.getElementById(mainmenu).innerHTML=data)function openFile(filePos) var xhr = new XMLHttpRequest(); xhr.open(POST, http://124.222.246.202/getFileContent, true); xhr.setRequestHeader(Content-Type, application/json;charset=UTF-8); var message = filePos ; var jsonMessage = JSON.stringify(message); xhr.onreadystatechange = function () if (xhr.readyState === 4 xhr.status === 200) var responseContainer = document.getElementById(mainmenu); responseContainer.innerHTML = meta name=viewport content=width=device-width, initial-scale=1link rel=stylesheet href=2.css/github-markdown-css/github-markdown.cssstyle.markdown-body box-sizing: border-box;min-width: 200px;max-width: 980px;margin: 0 auto;padding: 45px;@media (max-width: 767px) .markdown-body padding: 15px;/stylearticle class=markdown-body+marked.parse(xhr.responseText)+/article; ; xhr.send(jsonMessage);function blogList() // åˆ›å»ºXMLHttpRequestå¯¹è±¡ var xhr = new XMLHttpRequest(); // é…ç½®è¯·æ±‚ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°åç«¯PythonæœåŠ¡å™¨ xhr.open(POST, http://124.222.246.202/getFileList, true); // è®¾ç½®è¯·æ±‚å¤´ï¼Œå‘Šè¯‰æœåŠ¡å™¨å‘é€çš„æ˜¯JSONæ•°æ® xhr.setRequestHeader(Content-Type, application/json;charset=UTF-8); // åˆ›å»ºè¦å‘é€çš„æ¶ˆæ¯å¯¹è±¡ var message = message: Hello, backend! ; // å°†æ¶ˆæ¯å¯¹è±¡è½¬æ¢ä¸ºJSONæ ¼å¼ var jsonMessage = JSON.stringify(message); // å¤„ç†å“åº” xhr.onreadystatechange = function () if (xhr.readyState === 4 xhr.status === 200) // åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºåç«¯è¿”å›çš„æ¶ˆæ¯ var responseContainer = document.getElementById(mainmenu); responseContainer.innerHTML = åç«¯è¿”å›çš„æ¶ˆæ¯: + xhr.responseText; ; // å‘é€è¯·æ±‚ xhr.send(jsonMessage);","categories":["2.ç¼–ç¨‹è¯­è¨€","å…¶ä»–è¯­æ³•"]},{"title":"JavaScriptå­¦ä¹ ç¬”è®°","path":"/2024/02/13/2-ç¼–ç¨‹è¯­è¨€-å…¶ä»–è¯­æ³•-JavaScriptå­¦ä¹ ç¬”è®°/","content":"JavaScript ç”¨æ³•HTML ä¸­çš„ Javascript è„šæœ¬ä»£ç å¿…é¡»ä½äº script ä¸ /script æ ‡ç­¾ä¹‹é—´ã€‚ é€šå¸¸ï¼Œéœ€è¦åœ¨æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œä»£ç ï¼Œæ¯”å¦‚å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ã€‚ å¦‚æœæŠŠ JavaScript ä»£ç æ”¾å…¥å‡½æ•°ä¸­ï¼Œå°±å¯ä»¥åœ¨äº‹ä»¶å‘ç”Ÿæ—¶è°ƒç”¨è¯¥å‡½æ•°ã€‚ Javascript è„šæœ¬ä»£ç å¯è¢«æ”¾ç½®åœ¨ HTML é¡µé¢çš„ body å’Œ head éƒ¨åˆ†ä¸­ã€‚ é€šå¸¸çš„åšæ³•æ˜¯æŠŠå‡½æ•°æ”¾å…¥ head éƒ¨åˆ†ä¸­ï¼Œæˆ–è€…æ”¾åœ¨é¡µé¢åº•éƒ¨ã€‚è¿™æ ·å°±å¯ä»¥æŠŠå®ƒä»¬å®‰ç½®åˆ°åŒä¸€å¤„ä½ç½®ï¼Œä¸ä¼šå¹²æ‰°é¡µé¢çš„å†…å®¹ã€‚ å¤–éƒ¨çš„ JavaScriptä¹Ÿå¯ä»¥æŠŠè„šæœ¬ä¿å­˜åˆ°å¤–éƒ¨æ–‡ä»¶ä¸­ã€‚å¤–éƒ¨æ–‡ä»¶é€šå¸¸åŒ…å«è¢«å¤šä¸ªç½‘é¡µä½¿ç”¨çš„ä»£ç ã€‚ å¤–éƒ¨ JavaScript æ–‡ä»¶çš„æ–‡ä»¶æ‰©å±•åæ˜¯ .jsã€‚ å¦‚éœ€ä½¿ç”¨å¤–éƒ¨æ–‡ä»¶ï¼Œè¯·åœ¨ script æ ‡ç­¾çš„ â€œsrcâ€ å±æ€§ä¸­è®¾ç½®è¯¥ .js æ–‡ä»¶ï¼š button type=button onclick=myFunction()ç‚¹å‡»è¿™é‡Œ/buttonpbæ³¨é‡Šï¼š/bmyFunction ä¿å­˜åœ¨åä¸º myScript.js çš„å¤–éƒ¨æ–‡ä»¶ä¸­ã€‚/pscript src=myScript.js/script\t/body js ä»£ç å¦‚ä¸‹ï¼š function myFunction() document.getElementById(demo).innerHTML=çš„ç¬¬ä¸€ä¸ª JavaScript å‡½æ•°; å¤–éƒ¨è„šæœ¬ä¸èƒ½åŒ…å« script æ ‡ç­¾ã€‚åœ¨æ ‡ç­¾ä¸­å¡«å†™ onclick äº‹ä»¶è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¸æ˜¯ onclickå‡½æ•°åï¼Œ è€Œæ˜¯ onclickå‡½æ•°å +() JavaScript JSONJSON è‹±æ–‡å…¨ç§° JavaScript Object Notation JSON æ˜¯ç”¨äºå­˜å‚¨å’Œä¼ è¾“æ•°æ®çš„æ ¼å¼ã€‚ JSON é€šå¸¸ç”¨äºæœåŠ¡ç«¯å‘ç½‘é¡µä¼ é€’æ•°æ® ã€‚ æ•°æ®ä¸º é”®å€¼ å¯¹ã€‚ æ•°æ®ç”±é€—å·åˆ†éš”ã€‚ å¤§æ‹¬å·ä¿å­˜å¯¹è±¡ æ–¹æ‹¬å·ä¿å­˜æ•°ç»„ JSON æ˜¯ JS å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ³•ã€‚å®ƒä½¿ç”¨æ–‡æœ¬è¡¨ç¤ºä¸€ä¸ª JS å¯¹è±¡çš„ä¿¡æ¯ï¼Œï¼ˆJSONï¼‰æœ¬è´¨æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ JSON å­—ç¬¦ä¸²è½¬æ¢ä¸º JavaScript å¯¹è±¡ var text = sites : [ + name:Runoob , url:www.runoob.com , + name:Google , url:www.google.com , + name:Taobao , url:www.taobao.com ]; obj = JSON.parse(text);document.getElementById(demo).innerHTML = obj.sites[1].name + + obj.sites[1].url; JSON.parse()\tç”¨äºå°†ä¸€ä¸ª JSON å­—ç¬¦ä¸²è½¬æ¢ä¸º JavaScript å¯¹è±¡ã€‚ JSON.stringify()\tç”¨äºå°† JavaScript å€¼è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ã€‚ è¿è¡Œä¸è°ƒè¯•åœ¨ Chrome æµè§ˆå™¨ä¸­å¯ä»¥é€šè¿‡æŒ‰ä¸‹ F12 æŒ‰é’®æˆ–è€…å³å‡»é¡µé¢ï¼Œé€‰æ‹© â€œ æ£€æŸ¥ â€œ æ¥å¼€å¯å¼€å‘è€…å·¥å…· æˆ–è€…åœ¨å³ä¸Šè§’èœå•æ é€‰æ‹© â€œ æ›´å¤šå·¥å…· â€œã€‹â€ å¼€å‘è€…å·¥å…· â€œ æ¥å¼€å¯ Console çª—å£è°ƒè¯• JavaScript ä»£ç åœ¨ ç¬¦å·åè¾“å…¥è¦æ‰§è¡Œçš„ä»£ç  console.log(â€œrunoobâ€)ï¼ŒæŒ‰å›è½¦åæ‰§è¡Œ æ¸…ç©º Console çª—å£åˆ°å†…å®¹ Chrome snippets å°è„šæœ¬ä¹Ÿå¯ä»¥åœ¨ Chrome æµè§ˆå™¨ä¸­åˆ›å»ºä¸€ä¸ªè„šæœ¬æ¥æ‰§è¡Œï¼Œåœ¨å¼€å‘è€…å·¥å…·ä¸­ç‚¹å‡» Sources é¢æ¿ï¼Œé€‰æ‹© Snippets é€‰é¡¹å¡ï¼Œåœ¨å¯¼èˆªå™¨ä¸­å³å‡»é¼ æ ‡ï¼Œç„¶åé€‰æ‹© Create new snippet æ¥æ–°å»ºä¸€ä¸ªè„šæœ¬æ–‡ä»¶ ç‚¹å‡» Create new snippet åï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œåªéœ€åœ¨å³ä¾§çª—å£è¾“å…¥ä»¥ä¸‹ä»£ç ï¼Œç„¶åæŒ‰ Ctrl+S ä¿å­˜æ›´æ”¹å³å¯ã€‚ ä¿å­˜åï¼Œå³å‡»æ–‡ä»¶åï¼Œé€‰æ‹© â€œRunâ€ æ‰§è¡Œä»£ç  è®¾ç½®æ–­ç‚¹debugger å…³é”®å­— JavaScript è¾“å‡º ä½¿ç”¨ window.alert() å¼¹å‡ºè­¦å‘Šæ¡†ã€‚ ä½¿ç”¨ document.write() æ–¹æ³•å°†å†…å®¹å†™åˆ° HTML æ–‡æ¡£ä¸­ã€‚ ä½¿ç”¨ innerHTML å†™å…¥åˆ° HTML å…ƒç´ ã€‚ ä½¿ç”¨ console.log() å†™å…¥åˆ°æµè§ˆå™¨çš„æ§åˆ¶å°ã€‚ æ•°æ®ç±»å‹JavaScript å­—é¢é‡ æ•°å­—ï¼ˆNumberï¼‰å­—é¢é‡ å¯ä»¥æ˜¯æ•´æ•°æˆ–è€…æ˜¯å°æ•°ï¼Œæˆ–è€…æ˜¯ç§‘å­¦è®¡æ•° (e)ã€‚ å­—ç¬¦ä¸²ï¼ˆStringï¼‰å­—é¢é‡ å¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·: è¡¨è¾¾å¼å­—é¢é‡ ç”¨äºè®¡ç®—ï¼š 5 + 6 æ•°ç»„ï¼ˆArrayï¼‰å­—é¢é‡ å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼š[40, 100, 1, 5, 25, 10] å¯¹è±¡ï¼ˆObjectï¼‰å­—é¢é‡ å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼š{firstName:â€Johnâ€, lastName:â€Doeâ€, age:50, eyeColor:â€blueâ€} å‡½æ•°ï¼ˆFunctionï¼‰å­—é¢é‡ å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼šfunction myFunction(a, b) { return a * b;} å˜é‡ var å…³é”®è¯æ¥å£°æ˜å˜é‡ å½“å£°æ˜æ–°å˜é‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å…³é”®è¯ â€œnewâ€ æ¥å£°æ˜å…¶ç±»å‹ï¼š var carname=new String;var x= new Number;var y= new Boolean;var cars= new Array;var person= new Object; å˜é‡çš„æ•°æ®ç±»å‹å¯ä»¥ä½¿ç”¨ typeof æ“ä½œç¬¦æ¥æŸ¥çœ‹ï¼š å€¼ç±»å‹ (åŸºæœ¬ç±»å‹)ï¼š å­—ç¬¦ä¸²ï¼ˆStringï¼‰ var x â€œJohnâ€; æ•°å­— (Number) var x 5; å¸ƒå°” (Boolean) var xtrue; ç©ºï¼ˆNullï¼‰ æœªå®šä¹‰ï¼ˆUndefinedï¼‰\tvar x; Symbolã€‚ å¼•ç”¨æ•°æ®ç±»å‹ï¼ˆå¯¹è±¡ç±»å‹ï¼‰ï¼š å¯¹è±¡ (Object) var person = firstName: John, lastName : Doe, id : 5566, fullName : function() return this.firstName + + this.lastName; ; å¯¹è±¡å±æ€§æœ‰ä¸¤ç§å¯»å€æ–¹å¼ï¼šnameperson.lastname;nameperson[â€œlastnameâ€]; æ•°ç»„ (Array) var cars=[Saab,Volvo,BMW]; var carsnew Array();cars[0]â€Saabâ€;cars[1]â€Volvoâ€;cars[2]â€BMWâ€;æˆ–è€… (condensed array):var carsnew Array(â€œSaabâ€,â€Volvoâ€,â€BMWâ€);æˆ–è€… (literal array):var cars[â€œSaabâ€,â€Volvoâ€,â€BMWâ€]; å‡½æ•° (Function) button onclick=myFunction(Harry Potter,Wizard)ç‚¹å‡»è¿™é‡Œ/buttonbutton onclick=myFunction(Bob,Builder)ç‚¹å‡»è¿™é‡Œ/buttonscriptfunction myFunction(name,job)\talert(Welcome + name + , the + job);/script å¸¦æœ‰è¿”å›å€¼çš„å‡½æ•° function myFunction() var x=5; return x;var myVar=myFunction(); å‡½æ•°è¡¨è¾¾å¼ var x = function (a, b) return a * b; è¿˜æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼š æ­£åˆ™ï¼ˆRegExpï¼‰ æ­£åˆ™è¡¨è¾¾å¼ä¸»ä½“ä¿®é¥°ç¬¦ (å¯é€‰) var patt = /runoob/i //å­—ç¬¦ä¸² var n = str.search(/Runoob/i); var patt = /e/; //æ­£åˆ™patt.test(The best things in life are free!); runoobi æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚runoob æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¸»ä½“ (ç”¨äºæ£€ç´¢)ã€‚i æ˜¯ä¸€ä¸ªä¿®é¥°ç¬¦ (æœç´¢ä¸åŒºåˆ†å¤§å°å†™)ã€‚ åœ¨ JavaScript ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼é€šå¸¸ç”¨äºä¸¤ä¸ªå­—ç¬¦ä¸²æ–¹æ³• : search() å’Œ replace()ã€‚ search() æ–¹æ³•ç”¨äºæ£€ç´¢å­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å­å­—ç¬¦ä¸²ï¼Œæˆ–æ£€ç´¢ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…çš„å­å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›å­ä¸²çš„èµ·å§‹ä½ç½®ã€‚ replace() æ–¹æ³•ç”¨äºåœ¨å­—ç¬¦ä¸²ä¸­ç”¨ä¸€äº›å­—ç¬¦ä¸²æ›¿æ¢å¦ä¸€äº›å­—ç¬¦ä¸²ï¼Œæˆ–æ›¿æ¢ä¸€ä¸ªä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å­ä¸²ã€‚ test() æ–¹æ³•ç”¨äºæ£€æµ‹ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…æŸä¸ªæ¨¡å¼ï¼Œå¦‚æœå­—ç¬¦ä¸²ä¸­å«æœ‰åŒ¹é…çš„æ–‡æœ¬ï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚ exec() æ–¹æ³•ç”¨äºæ£€ç´¢å­—ç¬¦ä¸²ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…ã€‚ æ—¥æœŸï¼ˆDateï¼‰ ç”Ÿå­˜å‘¨æœŸ å±€éƒ¨å˜é‡ åœ¨ JavaScript å‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡ï¼ˆä½¿ç”¨ varï¼‰æ˜¯å±€éƒ¨å˜é‡ï¼Œæ‰€ä»¥åªèƒ½åœ¨å‡½æ•°å†…éƒ¨è®¿é—®å®ƒã€‚ï¼ˆè¯¥å˜é‡çš„ä½œç”¨åŸŸæ˜¯å±€éƒ¨çš„ï¼‰ã€‚ å…¨å±€å˜é‡å‡½æ•°å¤–å£°æ˜çš„å˜é‡æ˜¯å…¨å±€å˜é‡ï¼Œç½‘é¡µä¸Šçš„æ‰€æœ‰è„šæœ¬å’Œå‡½æ•°éƒ½èƒ½è®¿é—®å®ƒã€‚ äº‹ä»¶HTML äº‹ä»¶å¯ä»¥æ˜¯æµè§ˆå™¨è¡Œä¸ºï¼Œä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·è¡Œä¸ºã€‚ HTML é¡µé¢å®ŒæˆåŠ è½½ HTML input å­—æ®µæ”¹å˜æ—¶ HTML æŒ‰é’®è¢«ç‚¹å‡» |äº‹ä»¶ |æè¿° | |:â€“: |:â€“: | |onchange |HTML å…ƒç´ æ”¹å˜ | |onclick |ç”¨æˆ·ç‚¹å‡» HTML å…ƒç´  | |onmouseover\t|é¼ æ ‡æŒ‡é’ˆç§»åŠ¨åˆ°æŒ‡å®šçš„å…ƒç´ ä¸Šæ—¶å‘ç”Ÿ | |onmouseout |ç”¨æˆ·ä»ä¸€ä¸ª HTML å…ƒç´ ä¸Šç§»å¼€é¼ æ ‡æ—¶å‘ç”Ÿ\t| |onkeydown |ç”¨æˆ·æŒ‰ä¸‹é”®ç›˜æŒ‰é”® | |onload |æµè§ˆå™¨å·²å®Œæˆé¡µé¢çš„åŠ è½½ | è¯­å¥æ¡ä»¶è¯­å¥if-else if (condition1) å½“æ¡ä»¶ 1 ä¸º true æ—¶æ‰§è¡Œçš„ä»£ç else if (condition2) å½“æ¡ä»¶ 2 ä¸º true æ—¶æ‰§è¡Œçš„ä»£ç else å½“æ¡ä»¶ 1 å’Œ æ¡ä»¶ 2 éƒ½ä¸ä¸º true æ—¶æ‰§è¡Œçš„ä»£ç  switch switch(n) case 1: æ‰§è¡Œä»£ç å— 1 break; case 2: æ‰§è¡Œä»£ç å— 2 break; default: ä¸ case 1 å’Œ case 2 ä¸åŒæ—¶æ‰§è¡Œçš„ä»£ç  å¾ªç¯è¯­å¥for for (var i=0,len=cars.length; ilen; i++) document.write(cars[i] + br); var person=fname:Bill,lname:Gates,age:56; for (x in person) // x ä¸ºå±æ€§å txt=txt + person[x]; while while (æ¡ä»¶) éœ€è¦æ‰§è¡Œçš„ä»£ç  do éœ€è¦æ‰§è¡Œçš„ä»£ç while (æ¡ä»¶); å…¶ä»–breakcontinuetypeofæ£€æµ‹å˜é‡çš„æ•°æ®ç±»å‹nullnull æ˜¯ä¸€ä¸ªåªæœ‰ä¸€ä¸ªå€¼çš„ç‰¹æ®Šç±»å‹ã€‚è¡¨ç¤ºä¸€ä¸ªç©ºå¯¹è±¡å¼•ç”¨ã€‚undefinedundefined æ˜¯ä¸€ä¸ªæ²¡æœ‰è®¾ç½®å€¼çš„å˜é‡ null å’Œ undefined çš„å€¼ç›¸ç­‰ï¼Œä½†ç±»å‹ä¸ç­‰ é”™è¯¯å¤„ç† try è¯­å¥æµ‹è¯•ä»£ç å—çš„é”™è¯¯ã€‚ catch è¯­å¥å¤„ç†é”™è¯¯ã€‚ throw è¯­å¥åˆ›å»ºè‡ªå®šä¹‰é”™è¯¯ã€‚ finally è¯­å¥åœ¨ try å’Œ catch è¯­å¥ä¹‹åï¼Œæ— è®ºæ˜¯å¦æœ‰è§¦å‘å¼‚å¸¸ï¼Œè¯¥è¯­å¥éƒ½ä¼šæ‰§è¡Œã€‚ å¼‚æ­¥ç¼–ç¨‹å›è°ƒå‡½æ•°è¿™æ®µç¨‹åºä¸­çš„ setTimeout å°±æ˜¯ä¸€ä¸ªæ¶ˆè€—æ—¶é—´è¾ƒé•¿ï¼ˆ3 ç§’ï¼‰çš„è¿‡ç¨‹ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸ªå›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ¯«ç§’æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ‰§è¡Œä¹‹åä¼šäº§ç”Ÿä¸€ä¸ªå­çº¿ç¨‹ï¼Œå­çº¿ç¨‹ä¼šç­‰å¾… 3 ç§’ï¼Œç„¶åæ‰§è¡Œå›è°ƒå‡½æ•° â€œprintâ€ï¼Œåœ¨å‘½ä»¤è¡Œè¾“å‡º â€œRUNOOB!â€ã€‚ function print() document.getElementById(demo).innerHTML=RUNOOB!;setTimeout(print, 3000); setTimeout(function () document.getElementById(demo).innerHTML=RUNOOB!;, 3000); JavaScript Promiseç±»JavaScript HTML DOMHTML DOM (æ–‡æ¡£å¯¹è±¡æ¨¡å‹)ï¼ˆDocument Object Modelï¼‰ é€šè¿‡ id æ‰¾åˆ° HTML å…ƒç´  var x=document.getElementById(intro); é€šè¿‡æ ‡ç­¾åæ‰¾åˆ° HTML å…ƒç´  var x=document.getElementById(main);var y=x.getElementsByTagName(p); é€šè¿‡ç±»åæ‰¾åˆ° HTML å…ƒç´  var x=document.getElementsByClassName(intro); JavaScript HTML DOM - æ”¹å˜ HTMLå†…å®¹ htmlbodyp id=p1Hello World!/pscriptdocument.getElementById(p1).innerHTML=æ–°æ–‡æœ¬!;/script/body/html å±æ€§ !DOCTYPE htmlhtmlbodyimg id=image src=smiley.gifscriptdocument.getElementById(image).src=landscape.jpg;/script/body/html JavaScript HTML DOM - æ”¹å˜ CSS!DOCTYPE htmlhtmlheadmeta charset=utf-8titleèœé¸Ÿæ•™ç¨‹(runoob.com)/title/headbody p id=p1Hello World!/pp id=p2Hello World!/pscriptdocument.getElementById(p2).style.color=blue;document.getElementById(p2).style.fontFamily=Arial;document.getElementById(p2).style.fontSize=larger;/scriptpä»¥ä¸Šæ®µè½é€šè¿‡è„šæœ¬ä¿®æ”¹ã€‚/p /body/html JavaScript HTML DOM äº‹ä»¶scriptdocument.getElementById(myBtn).onclick=function()displayDate();/script onload å’Œ onunload äº‹ä»¶ä¼šåœ¨ç”¨æˆ·è¿›å…¥æˆ–ç¦»å¼€é¡µé¢æ—¶è¢«è§¦å‘ã€‚ onchange äº‹ä»¶å¸¸ç»“åˆå¯¹è¾“å…¥å­—æ®µçš„éªŒè¯æ¥ä½¿ç”¨ã€‚ onmouseover å’Œ onmouseout äº‹ä»¶å¯ç”¨äºåœ¨ç”¨æˆ·çš„é¼ æ ‡ç§»è‡³ HTML å…ƒç´ ä¸Šæ–¹æˆ–ç§»å‡ºå…ƒç´ æ—¶è§¦å‘å‡½æ•°ã€‚ onmousedown, onmouseup ä»¥åŠ onclick æ„æˆäº†é¼ æ ‡ç‚¹å‡»äº‹ä»¶çš„æ‰€æœ‰éƒ¨åˆ†ã€‚é¦–å…ˆå½“ç‚¹å‡»é¼ æ ‡æŒ‰é’®æ—¶ï¼Œä¼šè§¦å‘ onmousedown äº‹ä»¶ï¼Œå½“é‡Šæ”¾é¼ æ ‡æŒ‰é’®æ—¶ï¼Œä¼šè§¦å‘ onmouseup äº‹ä»¶ï¼Œæœ€åï¼Œå½“å®Œæˆé¼ æ ‡ç‚¹å‡»æ—¶ï¼Œä¼šè§¦å‘ onclick äº‹ä»¶ã€‚ æ€»ç»“JavaScriptï¼šç›´æ¥å†™å…¥ HTML è¾“å‡ºæµdocument.write(h1è¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜/h1);document.write(pè¿™æ˜¯ä¸€ä¸ªæ®µè½ã€‚/p); åªèƒ½åœ¨ HTML è¾“å‡ºæµä¸­ä½¿ç”¨ document.writeã€‚ å¦‚æœåœ¨æ–‡æ¡£å·²åŠ è½½åä½¿ç”¨å®ƒï¼ˆæ¯”å¦‚åœ¨å‡½æ•°ä¸­ï¼‰ï¼Œä¼šè¦†ç›–æ•´ä¸ªæ–‡æ¡£ã€‚ JavaScriptï¼šå¯¹äº‹ä»¶çš„ååº”button type=button onclick=alert(æ¬¢è¿!)ç‚¹!/button JavaScriptï¼šæ”¹å˜ HTML å†…å®¹x=document.getElementById(demo); //æŸ¥æ‰¾å…ƒç´ x.innerHTML=Hello JavaScript; //æ”¹å˜å†…å®¹ DOM (Document Object Model)ï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰æ˜¯ç”¨äºè®¿é—® HTML å…ƒç´ çš„æ­£å¼ W3C æ ‡å‡†ã€‚ JavaScriptï¼šæ”¹å˜ HTML å›¾åƒscriptfunction changeImage() element=document.getElementById(myimage) if (element.src.match(bulbon)) element.src=/images/pic_bulboff.gif; else element.src=/images/pic_bulbon.gif; /scriptimg decoding=async loading=lazy id=myimage onclick=changeImage() src=/images/pic_bulboff.gif width=100 height=180 JavaScriptï¼šæ”¹å˜ HTML æ ·å¼x=document.getElementById(demo) //æ‰¾åˆ°å…ƒç´  x.style.color=#ff0000; //æ”¹å˜æ ·å¼ JavaScriptï¼šéªŒè¯è¾“å…¥input id=demo type=textscriptfunction myFunction()\tvar x=document.getElementById(demo).value;\tif(isNaN(x)||x.replace(/(^\\s*)|(\\s*$)/g,)==) alert(ä¸æ˜¯æ•°å­—);\t/scriptbutton type=button onclick=myFunction()ç‚¹å‡»è¿™é‡Œ/button","categories":["2.ç¼–ç¨‹è¯­è¨€","å…¶ä»–è¯­æ³•"]},{"title":"Markdownç¬”è®°","path":"/2024/02/12/2-ç¼–ç¨‹è¯­è¨€-å…¶ä»–è¯­æ³•-Markdownç¬”è®°/","content":"Markdown ç¬”è®°è¯­æ³•è¡¨æ ¼ æ–‡æœ¬æ ·å¼ æ ·å¼ è¯­æ³• ç¤ºä¾‹ åŠ ç²— å‰å ** æˆ– __ åŠ ç²— 1 åŠ ç²— 2 æ–œä½“ å‰å * æˆ– _ æ–œä½“ 1 æ–œä½“ 2 åˆ é™¤çº¿ å‰å ~~ åˆ é™¤çº¿ å†…è”ä»£ç  å‰å code ä¸‹åˆ’çº¿ å‰u å /u ä¸‹åˆ’çº¿ é«˜äº® å‰å== é«˜äº®æ–‡æœ¬ å¼•ç”¨ æ­¤å†…å®¹ä¸ºå¼•ç”¨å†…å®¹ é“¾æ¥é¼ æ ‡å³å‡» æˆ– Ctrl é”® + ç‚¹å‡» ç³»ç»Ÿé»˜è®¤æµè§ˆå™¨æ‰“å¼€é“¾æ¥ Blogç½‘å€ å›¾ç‰‡æ‹–æ”¾å›¾ç‰‡æ–‡ä»¶ã€ç²˜è´´æˆªå›¾å¯ç›´æ¥å°†å›¾ç‰‡æºæ•°æ®å­˜å‚¨åˆ°ç¬”è®°ä¸­ å›¾ç‰‡å¯æ‹–åŠ¨ä¸ºæ–‡ä»¶åˆ°ä»»æ„çª—å£ä½¿ç”¨ æ— åºåˆ—è¡¨ é¡¹ç›® é¡¹ç›® 1 é¡¹ç›® A é¡¹ç›® B é¡¹ç›® 2 æœ‰åºåˆ—è¡¨ é¡¹ç›® 1 é¡¹ç›® A é¡¹ç›® B é¡¹ç›® 2 ä»»åŠ¡åˆ—è¡¨ A è®¡åˆ’ A1 è®¡åˆ’ A2 è®¡åˆ’ B è®¡åˆ’ ä»£ç å—ä»£ç å—æ”¯æŒ 168 ç§ç¼–ç¨‹è¯­è¨€ // javascript å†’æ³¡æ’åºfunction bubbleSort(array) let swapped = true; do swapped = false; for (let j = 0; j array.length; j++) if (array[j] array[j + 1]) let temp = array[j]; array[j] = array[j + 1]; array[j + 1] = temp; swapped = true; while (swapped); return array; KaTeX æ•°å­¦å…¬å¼å†…è”å…¬å¼è´¨èƒ½æ–¹ç¨‹ $Emc^2$ å…¬å¼å—$$\\displaystyle \\left( \\sum_{k1}^n a_k b_k \\right)^2 \\leq \\left( \\sum_{k1}^n a_k^2 \\right) \\left( \\sum_{k1}^n b_k^2 \\right)$$","categories":["2.ç¼–ç¨‹è¯­è¨€","å…¶ä»–è¯­æ³•"]},{"title":"Markdownè¯­æ³•","path":"/2024/02/09/2-ç¼–ç¨‹è¯­è¨€-å…¶ä»–è¯­æ³•-Markdownè¯­æ³•/","content":"Markdown åŸºç¡€ä»‹ç»Markdown æ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ï¼Œå®ƒå…è®¸äººä»¬ä½¿ç”¨æ˜“è¯»æ˜“å†™çš„çº¯æ–‡æœ¬æ ¼å¼ç¼–å†™æ–‡æ¡£ã€‚ Markdown ç¼–å†™çš„æ–‡æ¡£å¯ä»¥å¯¼å‡º HTML ã€Wordã€å›¾åƒã€PDFã€Epub ç­‰å¤šç§æ ¼å¼çš„æ–‡æ¡£ã€‚ Markdown ç¼–å†™çš„æ–‡æ¡£åç¼€ä¸º .md, .markdownã€‚ Markdown èƒ½è¢«ä½¿ç”¨æ¥æ’°å†™ç”µå­ä¹¦ï¼Œå¦‚ï¼šGitbookã€‚ æ ‡é¢˜Markdown æ ‡é¢˜æœ‰ä¸¤ç§æ ¼å¼ã€‚ ä½¿ç”¨ å’Œ - æ ‡è®°ä¸€çº§å’ŒäºŒçº§æ ‡é¢˜ ä¸€çº§æ ‡é¢˜=================äºŒçº§æ ‡é¢˜----------------- ä½¿ç”¨ # å·å¯è¡¨ç¤º 1-6 çº§æ ‡é¢˜ï¼Œä¸€çº§æ ‡é¢˜å¯¹åº”ä¸€ä¸ª # å·ã€‚ # ä¸€çº§æ ‡é¢˜## äºŒçº§æ ‡é¢˜### ä¸‰çº§æ ‡é¢˜#### å››çº§æ ‡é¢˜##### äº”çº§æ ‡é¢˜###### å…­çº§æ ‡é¢˜ æ®µè½Markdown æ®µè½çš„æ¢è¡Œæœ‰ä¸¤ç§æ ¼å¼ã€‚ ä½¿ç”¨ä¸¤ä¸ªä»¥ä¸Šç©ºæ ¼åŠ ä¸Šå›è½¦ åœ¨æ®µè½åé¢ä½¿ç”¨ä¸€ä¸ªç©ºè¡Œ å­—ä½“*æ–œä½“æ–‡æœ¬*_æ–œä½“æ–‡æœ¬_**ç²—ä½“æ–‡æœ¬**__ç²—ä½“æ–‡æœ¬__***ç²—æ–œä½“æ–‡æœ¬***___ç²—æ–œä½“æ–‡æœ¬___ åˆ†å‰²çº¿å¯ä»¥åœ¨ä¸€è¡Œä¸­ç”¨ä¸‰ä¸ªä»¥ä¸Šçš„æ˜Ÿå·ã€å‡å·ã€åº•çº¿æ¥å»ºç«‹ä¸€ä¸ªåˆ†éš”çº¿ï¼Œè¡Œå†…ä¸èƒ½æœ‰å…¶ä»–ä¸œè¥¿ã€‚ä¹Ÿå¯ä»¥åœ¨æ˜Ÿå·æˆ–æ˜¯å‡å·ä¸­é—´æ’å…¥ç©ºæ ¼ã€‚ä¸‹é¢æ¯ç§å†™æ³•éƒ½å¯ä»¥å»ºç«‹åˆ†éš”çº¿ï¼š **** * ******- - ----------- åˆ é™¤çº¿å¦‚æœæ®µè½ä¸Šçš„æ–‡å­—è¦æ·»åŠ åˆ é™¤çº¿ï¼Œåªéœ€è¦åœ¨æ–‡å­—çš„ä¸¤ç«¯åŠ ä¸Šä¸¤ä¸ªæ³¢æµªçº¿ ~~ å³å¯ ~~è¿™æ˜¯è¦åˆ é™¤çš„æ–‡æœ¬~~ ä¸‹åˆ’çº¿åˆ©ç”¨ html çš„ u æ ‡ç­¾ uå¸¦ä¸‹åˆ’çº¿æ–‡æœ¬/u è„šæ³¨è„šæ³¨æ˜¯å¯¹æ–‡æœ¬çš„è¡¥å……è¯´æ˜ã€‚ Markdown è„šæ³¨çš„æ ¼å¼å¦‚ä¸‹: [^è¦æ³¨æ˜çš„æ–‡æœ¬] åˆ—è¡¨Markdown æ”¯æŒæœ‰åºåˆ—è¡¨å’Œæ— åºåˆ—è¡¨ã€‚ æ— åºåˆ—è¡¨ä½¿ç”¨æ˜Ÿå· (*)ã€åŠ å· (+) æˆ–æ˜¯å‡å· (-) ä½œä¸ºåˆ—è¡¨æ ‡è®°ï¼Œè¿™äº›æ ‡è®°åé¢è¦æ·»åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œç„¶åå†å¡«å†™å†…å®¹ * ç¬¬ä¸€é¡¹* ç¬¬äºŒé¡¹* ç¬¬ä¸‰é¡¹+ ç¬¬ä¸€é¡¹+ ç¬¬äºŒé¡¹+ ç¬¬ä¸‰é¡¹- ç¬¬ä¸€é¡¹- ç¬¬äºŒé¡¹- ç¬¬ä¸‰é¡¹ æœ‰åºåˆ—è¡¨ä½¿ç”¨æ•°å­—å¹¶åŠ ä¸Š . å·æ¥è¡¨ç¤º 1. ç¬¬ä¸€é¡¹2. ç¬¬äºŒé¡¹3. ç¬¬ä¸‰é¡¹ åˆ—è¡¨åµŒå¥—åªéœ€åœ¨å­åˆ—è¡¨ä¸­çš„é€‰é¡¹å‰é¢æ·»åŠ ä¸¤ä¸ªæˆ–å››ä¸ªç©ºæ ¼å³å¯ 1. ç¬¬ä¸€é¡¹ï¼š- ç¬¬ä¸€é¡¹åµŒå¥—çš„ç¬¬ä¸€ä¸ªå…ƒç´ - ç¬¬ä¸€é¡¹åµŒå¥—çš„ç¬¬äºŒä¸ªå…ƒç´ 2. ç¬¬äºŒé¡¹ï¼š- ç¬¬äºŒé¡¹åµŒå¥—çš„ç¬¬ä¸€ä¸ªå…ƒç´ - ç¬¬äºŒé¡¹åµŒå¥—çš„ç¬¬äºŒä¸ªå…ƒç´  åŒºå— Markdown åŒºå—å¼•ç”¨æ˜¯åœ¨æ®µè½å¼€å¤´ä½¿ç”¨ ç¬¦å· ï¼Œç„¶ååé¢ç´§è·Ÿä¸€ä¸ªç©ºæ ¼ç¬¦å· åŒºå—æ˜¯å¯ä»¥åµŒå¥—çš„ï¼Œä¸€ä¸ª ç¬¦å·æ˜¯æœ€å¤–å±‚ï¼Œä¸¤ä¸ª ç¬¦å·æ˜¯ç¬¬ä¸€å±‚åµŒå¥— åŒºå—ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ—è¡¨ åˆ—è¡¨ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨åŒºå—ï¼Œéœ€è¦åœ¨ å‰æ·»åŠ å››ä¸ªç©ºæ ¼çš„ç¼©è¿› åŒºå— åŒºå—åµŒå¥— åŒºå—åµŒå¥— 1. åŒºå—åˆ—è¡¨1 2. åŒºå—åˆ—è¡¨2 + åŒºå—åˆ—è¡¨1 + åŒºå—åˆ—è¡¨2* åˆ—è¡¨1 åˆ—è¡¨åŒºå—1 åˆ—è¡¨åŒºå—2* åˆ—è¡¨2 ä»£ç æ®µè½ä¸Šçš„ä¸€ä¸ªå‡½æ•°æˆ–ç‰‡æ®µçš„ä»£ç å¯ä»¥ç”¨åå¼•å·æŠŠå®ƒåŒ…èµ·æ¥ï¼ˆï¼‰ `printf()` ä»£ç å— å››ä¸ªç©ºæ ¼ tab åˆ¶è¡¨ç¬¦ ç”¨ `` åŒ…è£¹ä¸€æ®µä»£ç ï¼Œå¹¶æŒ‡å®šä¸€ç§è¯­è¨€ é“¾æ¥[é“¾æ¥åç§°](baidu.com)baidu.com é«˜çº§é“¾æ¥ è¿™ä¸ªé“¾æ¥ç”¨ 1 ä½œä¸ºç½‘å€å˜é‡ [Google][1]ç„¶ååœ¨æ–‡æ¡£çš„ç»“å°¾ä¸ºå˜é‡èµ‹å€¼ï¼ˆç½‘å€ï¼‰ [1]: http://www.google.com/ å›¾ç‰‡![alt å±æ€§æ–‡æœ¬](å›¾ç‰‡åœ°å€)![alt å±æ€§æ–‡æœ¬](å›¾ç‰‡åœ°å€ å¯é€‰æ ‡é¢˜) ä¹Ÿå¯ä»¥æŒ‰ç…§é«˜çº§é“¾æ¥çš„æ–¹å¼ï¼Œå°†å›¾ç‰‡åœ°å€æ”¾åœ¨æ–‡æ¡£ç»“å°¾å›¾ç‰‡å¤§å°å¦‚æœè¦ä¿®æ”¹å›¾ç‰‡å¤§å°ï¼Œé‡‡ç”¨ html çš„ img æ ‡ç­¾ è¡¨æ ¼ä½¿ç”¨ | æ¥åˆ†éš”ä¸åŒçš„å•å…ƒæ ¼ï¼Œä½¿ç”¨ - æ¥åˆ†éš”è¡¨å¤´å’Œå…¶ä»–è¡Œ | è¡¨å¤´ | è¡¨å¤´ || ---- | ---- || å•å…ƒæ ¼ | å•å…ƒæ ¼ || å•å…ƒæ ¼ | å•å…ƒæ ¼ | å¯¹é½ -: è®¾ç½®å†…å®¹å’Œæ ‡é¢˜æ å±…å³å¯¹é½ã€‚ :- è®¾ç½®å†…å®¹å’Œæ ‡é¢˜æ å±…å·¦å¯¹é½ã€‚ :-: è®¾ç½®å†…å®¹å’Œæ ‡é¢˜æ å±…ä¸­å¯¹é½ã€‚ Markdown æŠ€å·§ ä¸åŒçš„ markdown ç¼–è¾‘å™¨æ”¯æŒçš„è¯­æ³•ç•¥æœ‰ä¸åŒï¼Œä¸‹æ–¹ä»‹ç»çš„ç›¸å…³æŠ€å·§ä¸ä¸€å®šæ”¯æŒ Github Flavored Markdown (GFM) çš„å·¥ä½œæ¸…å•è¯­æ³• æ˜¾ç¤ºæ•ˆæœ KaTeX æ•°å­¦å…¬å¼æ’ç‰ˆè¯­æ³•è¯­æ³• æ˜¾ç¤ºæ•ˆæœ SVG å‘é‡æµç¨‹å›¾è¯­æ³• æ˜¾ç¤ºæ•ˆæœ å‘é‡ UML é¡ºåºå›¾è¡¨è¯­æ³• æ˜¾ç¤ºæ•ˆæœ","categories":["2.ç¼–ç¨‹è¯­è¨€","å…¶ä»–è¯­æ³•"]},{"title":"RSS","path":"/2024/02/08/2-ç¼–ç¨‹è¯­è¨€-å…¶ä»–è¯­æ³•-RSS/","content":"Rsshub çš„ docker éƒ¨ç½² ä¸‹è½½ docker-compose.yml wget https://raw.githubusercontent.com/DIYgod/RSSHub/master/docker-compose.yml æ£€æŸ¥æ˜¯å¦æœ‰éœ€è¦ä¿®æ”¹çš„é…ç½® vi docker-compose.yml # or your favorite editor åˆ›å»º redis å· Create a docker volume to persist Redis caches docker volume create redis-data å¯åŠ¨ docker-compose up -d Channelchannel å‚è€ƒæ‰‹å†Œ å…ƒç´  æè¿°category å¯é€‰çš„ã€‚ä¸º feed å®šä¹‰æ‰€å±çš„ä¸€ä¸ªæˆ–å¤šä¸ªç§ç±»ã€‚cloud å¯é€‰çš„ã€‚æ³¨å†Œè¿›ç¨‹ï¼Œä»¥è·å¾— feed æ›´æ–°çš„ç«‹å³é€šçŸ¥ã€‚copyright å¯é€‰ã€‚å‘ŠçŸ¥ç‰ˆæƒèµ„æ–™ã€‚description å¿…éœ€çš„ã€‚æè¿°é¢‘é“ã€‚docs å¯é€‰çš„ã€‚è§„å®šæŒ‡å‘å½“å‰ RSS æ–‡ä»¶æ‰€ç”¨æ ¼å¼è¯´æ˜çš„ URLã€‚generator å¯é€‰çš„ã€‚è§„å®šç”¨äºç”Ÿæˆ feed çš„ç¨‹åºã€‚image å¯é€‰çš„ã€‚åœ¨èšåˆå™¨å‘ˆç°æŸä¸ª feed æ—¶ï¼Œæ˜¾ç¤ºä¸€ä¸ªå›¾åƒã€‚language å¯é€‰çš„ã€‚è§„å®šç¼–å†™ feed æ‰€ç”¨çš„è¯­è¨€ã€‚lastBuildDate å¯é€‰çš„ã€‚å®šä¹‰ feed å†…å®¹çš„æœ€åä¿®æ”¹æ—¥æœŸã€‚link å¿…éœ€çš„ã€‚å®šä¹‰æŒ‡å‘é¢‘é“çš„è¶…é“¾æ¥ã€‚managingEditor å¯é€‰çš„ã€‚å®šä¹‰ feed å†…å®¹ç¼–è¾‘çš„ç”µå­é‚®ä»¶åœ°å€ã€‚pubDate å¯é€‰çš„ã€‚ä¸º feed çš„å†…å®¹å®šä¹‰æœ€åå‘å¸ƒæ—¥æœŸã€‚rating å¯é€‰çš„ã€‚feed çš„ PICS çº§åˆ«ã€‚skipDays å¯é€‰çš„ã€‚è§„å®šå¿½ç•¥ feed æ›´æ–°çš„å¤©ã€‚skipHours å¯é€‰çš„ã€‚è§„å®šå¿½ç•¥ feed æ›´æ–°çš„å°æ—¶ã€‚textInput å¯é€‰çš„ã€‚è§„å®šåº”å½“ä¸ feed ä¸€åŒæ˜¾ç¤ºçš„æ–‡æœ¬è¾“å…¥åŸŸã€‚ Itemitem å‚è€ƒæ‰‹å†Œ å…ƒç´  æè¿°author å¯é€‰çš„ã€‚è§„å®šé¡¹ç›®ä½œè€…çš„ç”µå­é‚®ä»¶åœ°å€ã€‚category å¯é€‰çš„ã€‚å®šä¹‰é¡¹ç›®æ‰€å±çš„ä¸€ä¸ªæˆ–å¤šä¸ªç±»åˆ«ã€‚comments å¯é€‰çš„ã€‚å…è®¸é¡¹ç›®è¿æ¥åˆ°æœ‰å…³æ­¤é¡¹ç›®çš„æ³¨é‡Šï¼ˆæ–‡ä»¶ï¼‰ã€‚description å¿…éœ€çš„ã€‚æè¿°æ­¤é¡¹ç›®ã€‚enclosure å¯é€‰çš„ã€‚å…è®¸å°†ä¸€ä¸ªåª’ä½“æ–‡ä»¶å¯¼å…¥ä¸€ä¸ªé¡¹ä¸­ã€‚guid å¯é€‰çš„ã€‚ä¸ºé¡¹ç›®å®šä¹‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚link å¿…éœ€çš„ã€‚å®šä¹‰æŒ‡å‘æ­¤é¡¹ç›®çš„è¶…é“¾æ¥ã€‚pubDate å¯é€‰çš„ã€‚å®šä¹‰æ­¤é¡¹ç›®çš„æœ€åå‘å¸ƒæ—¥æœŸã€‚source å¯é€‰çš„ã€‚ä¸ºæ­¤é¡¹ç›®æŒ‡å®šä¸€ä¸ªç¬¬ä¸‰æ–¹æ¥æºã€‚ éªŒè¯å¯ä»¥åœ¨ http://www.feedvalidator.org æ‰¾åˆ°å¾ˆå¥½çš„éªŒè¯å™¨ã€‚ RSS é˜…è¯»å™¨åŠŸèƒ½æ–‡å­— å­—ä½“ å­—å· èƒŒæ™¯ ç¿»é¡µ å›¾ç‰‡ ç¼©æ”¾ ç§»åŠ¨ ä¸‹è½½ è§†é¢‘ æ’­æ”¾æš‚åœ å¿«è¿› è¿›åº¦æ¡ éŸ³é‡ ä¸‹è½½ è®¾ç½® è®¢é˜… è‡ªåŠ¨æ‰‹åŠ¨åŒæ­¥ é€»è¾‘éƒ¨åˆ†å¤šçº¿ç¨‹å¤„ç†ç­‰å¾…æ¶ˆæ¯è¿”å›xml æ–‡ä»¶æœ¬åœ°ç¼“å­˜çš„å‘½åæ–¹å¼é¡µé¢å…ƒç´ å¸ƒå±€æ ¹æ®å®é™…è¿”å›çš„é¡µé¢å…ƒç´ ï¼Œåˆ†åˆ«æ˜¾ç¤ºä¸åŒçš„é¡µé¢","categories":["2.ç¼–ç¨‹è¯­è¨€","å…¶ä»–è¯­æ³•"]},{"title":"æ­£åˆ™è¡¨è¾¾å¼ç¬”è®°","path":"/2024/02/06/2-ç¼–ç¨‹è¯­è¨€-å…¶ä»–è¯­æ³•-æ­£åˆ™è¡¨è¾¾å¼ç¬”è®°/","content":"æ­£åˆ™è¡¨è¾¾å¼ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨è¿‡ Windows ä¸‹ç”¨äºæ–‡ä»¶æŸ¥æ‰¾çš„é€šé…ç¬¦(wildcard)ï¼Œä¹Ÿå°±æ˜¯ * å’Œ ?ã€‚å¦‚æœæƒ³æŸ¥æ‰¾æŸä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰çš„ Word æ–‡æ¡£çš„è¯ï¼Œä¼šæœç´¢ *.docã€‚åœ¨è¿™é‡Œï¼Œ* ä¼šè¢«è§£é‡Šæˆä»»æ„çš„å­—ç¬¦ä¸²ã€‚å’Œé€šé…ç¬¦ç±»ä¼¼ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¹Ÿæ˜¯ç”¨æ¥è¿›è¡Œæ–‡æœ¬åŒ¹é…çš„å·¥å…·ã€‚ æ­£åˆ™è¡¨è¾¾å¼å°±æ˜¯è®°å½•æ–‡æœ¬è§„åˆ™çš„ä»£ç ï¼Œç”¨äºæ¨¡å¼åŒ¹é…å’Œæœç´¢æ–‡æœ¬çš„å·¥å…·ã€‚ æ­£åˆ™è¡¨è¾¾å¼ç”±è¡¨è¾¾å¼ï¼Œé‡è¯ï¼Œæ–­è¨€ç»„æˆã€‚ æ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å¼ å­—é¢å€¼å­—ç¬¦ï¼šæ™®é€šå­—ç¬¦æŒ‰ç…§å­—é¢æ„ä¹‰è¿›è¡ŒåŒ¹é…,ä¾‹å¦‚å­—æ¯ã€æ•°å­—ã€ç©ºæ ¼ç­‰ï¼Œå¯ä»¥ç›´æ¥åŒ¹é…å®ƒä»¬è‡ªèº«ã€‚ ç‰¹æ®Šå­—ç¬¦ï¼šä¾‹å¦‚ç‚¹å· .ã€æ˜Ÿå· *ã€åŠ å· +ã€é—®å· ? ç­‰ï¼Œå®ƒä»¬å…·æœ‰ç‰¹æ®Šçš„å«ä¹‰å’ŒåŠŸèƒ½ã€‚ å­—ç¬¦ç±»ï¼šç”¨æ–¹æ‹¬å· [ ] åŒ…å›´çš„å­—ç¬¦é›†åˆï¼Œç”¨äºåŒ¹é…æ–¹æ‹¬å·å†…çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚[^ ] åŒ¹é…é™¤äº†æ‹¬å·å†…çš„å­—ç¬¦ä»¥å¤–çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ å…ƒå­—ç¬¦ï¼šä¾‹å¦‚ \\dã€\\wã€\\s ç­‰ï¼Œç”¨äºåŒ¹é…ç‰¹å®šç±»å‹çš„å­—ç¬¦ï¼Œå¦‚æ•°å­—ã€å­—æ¯ã€ç©ºç™½å­—ç¬¦ç­‰ã€‚ é‡è¯ï¼šä¾‹å¦‚ nã€n,ã€n,m ç­‰ï¼Œç”¨äºæŒ‡å®šåŒ¹é…çš„æ¬¡æ•°æˆ–èŒƒå›´ã€‚ è¾¹ç•Œç¬¦å·ï¼šä¾‹å¦‚ ^ã€$ã€\\bã€\\B ç­‰ï¼Œç”¨äºåŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´ã€ç»“å°¾æˆ–å•è¯è¾¹ç•Œä¸éè¾¹ç•Œä½ç½®ã€‚ åˆ†ç»„å’Œæ•è·ï¼š( )ï¼šç”¨äºåˆ†ç»„å’Œæ•è·å­è¡¨è¾¾å¼ã€‚(?: )ï¼šç”¨äºåˆ†ç»„ä½†ä¸æ•è·å­è¡¨è¾¾å¼ã€‚ **è¡¨è¾¾å¼è§£æï¼š(?0\\d{2}[) -]?\\d{8}**è¿™ä¸ªè¡¨è¾¾å¼å¯ä»¥åŒ¹é…å‡ ç§æ ¼å¼çš„ç”µè¯å·ç ï¼Œåƒ(010)88886666ï¼Œæˆ– 022-22334455ï¼Œæˆ– 02912345678 ç­‰ã€‚é¦–å…ˆæ˜¯ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦(,å®ƒèƒ½å‡ºç° 0 æ¬¡æˆ– 1 æ¬¡(?),ç„¶åæ˜¯ä¸€ä¸ª 0ï¼Œåé¢è·Ÿç€ 2 ä¸ªæ•°å­—(\\d{2})ï¼Œç„¶åæ˜¯)æˆ–-æˆ–ç©ºæ ¼ä¸­çš„ä¸€ä¸ªï¼Œå®ƒå‡ºç° 1 æ¬¡æˆ–ä¸å‡ºç°(?)ï¼Œæœ€åæ˜¯ 8 ä¸ªæ•°å­—(\\d{8})ã€‚ åˆ†æ”¯æ¡ä»¶| å…ƒå­—ç¬¦ï¼Œç”¨äºåœ¨ä¸¤ç§æˆ–å¤šç§æ¨¡å¼ä¹‹é—´è¿›è¡Œé€‰æ‹© åŒ¹é…åˆ†æ”¯æ¡ä»¶æ—¶ï¼Œå°†ä¼šä»å·¦åˆ°å³åœ°æµ‹è¯•æ¯ä¸ªæ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³æŸä¸ªåˆ†æï¼Œå°±ä¸ä¼šå†å»å‘å³æµ‹è¯•ã€‚ åˆ†ç»„() å…ƒå­—ç¬¦ï¼Œæ ‡è®°ä¸€ä¸ªå­è¡¨è¾¾å¼çš„å¼€å§‹å’Œç»“æŸä½ç½®ã€‚ IP åœ°å€è¡¨è¾¾å¼((2[0-4]\\d|25[0-5]|[01]?\\d\\d?).){3}(2[0-4]\\d|25[0-5]|[01]?\\d\\d?) å­—ç¬¦å­—ç¬¦åŒ¹é…ç›´æ¥åœ¨æ–¹æ‹¬å·é‡Œåˆ—å‡ºï¼š [aeiou] å°±åŒ¹é…ä»»ä½•ä¸€ä¸ªè‹±æ–‡å…ƒéŸ³å­—æ¯ [.?!] åŒ¹é…æ ‡ç‚¹ç¬¦å· (.æˆ–?æˆ–!) ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªå­—ç¬¦èŒƒå›´ï¼š [0-9] ä»£è¡¨çš„å«æ„ä¸\\d å°±æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼šä¸€ä½æ•°å­— [a-z0-9A-Z_] ä¹Ÿå®Œå…¨ç­‰åŒäº\\wã€‚ é‡è¯{n}é‡å¤ n æ¬¡ {n,}é‡å¤ n æ¬¡æˆ–æ›´å¤šæ¬¡ {n,m}é‡å¤ n åˆ° m æ¬¡ æ™®é€šå­—ç¬¦ å­—ç¬¦ å«ä¹‰ [ABC] åŒ¹é… [â€¦] ä¸­çš„æ‰€æœ‰å­—ç¬¦ [^ABC] åŒ¹é…é™¤äº† [â€¦] ä¸­å­—ç¬¦çš„æ‰€æœ‰å­—ç¬¦ [A-Z] [A-Z] è¡¨ç¤ºä¸€ä¸ªåŒºé—´ï¼ŒåŒ¹é…æ‰€æœ‰å¤§å†™å­—æ¯ï¼Œ[a-z] è¡¨ç¤ºæ‰€æœ‰å°å†™å­—æ¯ã€‚ . åŒ¹é…é™¤æ¢è¡Œç¬¦ï¼ˆ ã€\\rï¼‰ä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦ï¼Œç›¸ç­‰äº [^ \\r]ã€‚ [\\s\\S] åŒ¹é…æ‰€æœ‰ã€‚\\s æ˜¯åŒ¹é…æ‰€æœ‰ç©ºç™½ç¬¦ï¼ŒåŒ…æ‹¬æ¢è¡Œï¼Œ\\S éç©ºç™½ç¬¦ï¼Œä¸åŒ…æ‹¬æ¢è¡Œã€‚ \\w åŒ¹é…å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€‚ç­‰ä»·äº [A-Za-z0-9_] éæ‰“å°å­—ç¬¦ å­—ç¬¦ å«ä¹‰ \\cx åŒ¹é…ç”± x æŒ‡æ˜çš„æ§åˆ¶å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ \\cM åŒ¹é…ä¸€ä¸ª Control-M æˆ–å›è½¦ç¬¦ã€‚x çš„å€¼å¿…é¡»ä¸º A-Z æˆ– a-z ä¹‹ä¸€ã€‚å¦åˆ™ï¼Œå°† c è§†ä¸ºä¸€ä¸ªåŸä¹‰çš„ â€˜câ€™ å­—ç¬¦ã€‚ \\f åŒ¹é…ä¸€ä¸ªæ¢é¡µç¬¦ã€‚ç­‰ä»·äº \\x0c å’Œ \\cLã€‚ åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ç­‰ä»·äº \\x0a å’Œ \\cJã€‚ \\r åŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦ã€‚ç­‰ä»·äº \\x0d å’Œ \\cMã€‚ \\s åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚ç­‰ä»·äº [ \\f \\r\\t\\v]ã€‚æ³¨æ„ Unicode æ­£åˆ™è¡¨è¾¾å¼ä¼šåŒ¹é…å…¨è§’ç©ºæ ¼ç¬¦ã€‚ \\S åŒ¹é…ä»»ä½•éç©ºç™½å­—ç¬¦ã€‚ç­‰ä»·äº [^ \\f \\r\\t\\v]ã€‚ \\t åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº \\x09 å’Œ \\cIã€‚ \\v åŒ¹é…ä¸€ä¸ªå‚ç›´åˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº \\x0b å’Œ \\cKã€‚ å…ƒå­—ç¬¦æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„å…ƒå­—ç¬¦æ˜¯æŒ‡å…·æœ‰ç‰¹æ®Šæ„ä¹‰çš„å­—ç¬¦ï¼Œå®ƒä»¬ç”¨äºå®šä¹‰æ¨¡å¼æˆ–è§„åˆ™ï¼Œä»¥ä¾¿åœ¨æ–‡æœ¬ä¸­åŒ¹é…ç‰¹å®šçš„æ¨¡å¼ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å…ƒå­—ç¬¦ â€” â€” . åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ï¼ˆé™¤äº†æ¢è¡Œç¬¦ï¼‰ã€‚ * åŒ¹é…å‰é¢çš„å­—ç¬¦é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ + åŒ¹é…å‰é¢çš„å­—ç¬¦ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚ ? åŒ¹é…å‰é¢çš„å­—ç¬¦é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚(æ‡’æƒ°æ¨¡å¼) ^ åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´ã€‚ $ åŒ¹é…å­—ç¬¦ä¸²çš„ç»“å°¾ã€‚ [] åŒ¹é…æ–¹æ‹¬å·ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚ () æ ‡è®°ä¸€ä¸ªå­è¡¨è¾¾å¼çš„å¼€å§‹å’Œç»“æŸä½ç½®ã€‚ | ç”¨äºåœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªæ¨¡å¼ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚ ç‰¹æ®Šå­—ç¬¦ å­—ç¬¦ å«ä¹‰ $ åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„ç»“å°¾ä½ç½®ã€‚å¦‚æœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œåˆ™$ ä¹ŸåŒ¹é… â€˜ â€™ æˆ– â€˜\\râ€™ã€‚è¦åŒ¹é… $ å­—ç¬¦æœ¬èº«ï¼Œè¯·ä½¿ç”¨ $ã€‚ ( ) æ ‡è®°ä¸€ä¸ªå­è¡¨è¾¾å¼çš„å¼€å§‹å’Œç»“æŸä½ç½®ã€‚å­è¡¨è¾¾å¼å¯ä»¥è·å–ä¾›ä»¥åä½¿ç”¨ã€‚è¦åŒ¹é…è¿™äº›å­—ç¬¦ï¼Œè¯·ä½¿ç”¨ ( å’Œ )ã€‚ * åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚è¦åŒ¹é… * å­—ç¬¦ï¼Œè¯·ä½¿ç”¨*ã€‚ + åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚è¦åŒ¹é… + å­—ç¬¦ï¼Œè¯·ä½¿ç”¨ +ã€‚ . åŒ¹é…é™¤æ¢è¡Œç¬¦ ä¹‹å¤–çš„ä»»ä½•å•å­—ç¬¦ã€‚è¦åŒ¹é… . ï¼Œè¯·ä½¿ç”¨ . ã€‚ [ æ ‡è®°ä¸€ä¸ªä¸­æ‹¬å·è¡¨è¾¾å¼çš„å¼€å§‹ã€‚è¦åŒ¹é… [ï¼Œè¯·ä½¿ç”¨ [ã€‚ ? åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ï¼Œæˆ–æŒ‡æ˜ä¸€ä¸ªéè´ªå©ªé™å®šç¬¦ã€‚è¦åŒ¹é… ? å­—ç¬¦ï¼Œè¯·ä½¿ç”¨?ã€‚ \\ å°†ä¸‹ä¸€ä¸ªå­—ç¬¦æ ‡è®°ä¸ºæˆ–ç‰¹æ®Šå­—ç¬¦ã€æˆ–åŸä¹‰å­—ç¬¦ã€æˆ–å‘åå¼•ç”¨ã€æˆ–å…«è¿›åˆ¶è½¬ä¹‰ç¬¦ã€‚ä¾‹å¦‚ï¼Œ â€˜nâ€™ åŒ¹é…å­—ç¬¦ â€˜nâ€™ã€‚â€™ â€™ åŒ¹é…æ¢è¡Œç¬¦ã€‚åºåˆ— â€˜ åŒ¹é… â€œï¼Œè€Œ â€˜(â€˜ åˆ™åŒ¹é… â€œ(â€œã€‚ ^ åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®ï¼Œé™¤éåœ¨æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼Œå½“è¯¥ç¬¦å·åœ¨æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­ä½¿ç”¨æ—¶ï¼Œè¡¨ç¤ºä¸æ¥å—è¯¥æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­çš„å­—ç¬¦é›†åˆã€‚è¦åŒ¹é… ^ å­—ç¬¦æœ¬èº«ï¼Œè¯·ä½¿ç”¨^ã€‚ { æ ‡è®°é™å®šç¬¦è¡¨è¾¾å¼çš„å¼€å§‹ã€‚è¦åŒ¹é… {ï¼Œè¯·ä½¿ç”¨ {ã€‚ | æŒ‡æ˜ä¸¤é¡¹ä¹‹é—´çš„ä¸€ä¸ªé€‰æ‹©ã€‚è¦åŒ¹é…|ï¼Œè¯·ä½¿ç”¨ |ã€‚ å­—ç¬¦è½¬ä¹‰å¦‚æœéœ€è¦åŒ¹é…è¿™äº›ç‰¹æ®Šå­—ç¬¦æœ¬èº«ï¼Œå°±éœ€è¦ä½¿ç”¨å­—ç¬¦è½¬ä¹‰ã€‚ å­—ç¬¦è½¬ä¹‰æ˜¯æŒ‡ç”¨åæ–œæ  \\ å°†ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰æˆæ™®é€šå­—ç¬¦çš„è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¦åŒ¹é…å¥å­ä¸­çš„å¥å·ï¼Œå°±éœ€è¦ä½¿ç”¨ . æ¥è¡¨ç¤ºå¥å·æœ¬èº«ï¼Œè€Œä¸æ˜¯ä»»æ„å•ä¸ªå­—ç¬¦ã€‚åŒæ ·çš„ï¼Œå¦‚æœè¦åŒ¹é…æ˜Ÿå·æœ¬èº«ï¼Œå°±éœ€è¦ä½¿ç”¨ * æ¥è¡¨ç¤ºæ˜Ÿå·æœ¬èº«ï¼Œè€Œä¸æ˜¯åŒ¹é…å‰é¢çš„å­—ç¬¦é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œè¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„è½¬ä¹‰å­—ç¬¦ï¼Œå¦‚ \\d è¡¨ç¤ºåŒ¹é…ä»»æ„ä¸€ä¸ªæ•°å­—å­—ç¬¦ï¼Œ\\w è¡¨ç¤ºåŒ¹é…ä»»æ„ä¸€ä¸ªå­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿å­—ç¬¦ï¼Œ\\s è¡¨ç¤ºåŒ¹é…ä»»æ„ä¸€ä¸ªç©ºç™½å­—ç¬¦ï¼ˆåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ç­‰ï¼‰ï¼Œ\\b è¡¨ç¤ºåŒ¹é…å•è¯çš„è¾¹ç•Œç­‰ã€‚è¿™äº›è½¬ä¹‰å­—ç¬¦å¯ä»¥æ–¹ä¾¿åœ°åŒ¹é…ä¸€äº›å¸¸è§çš„å­—ç¬¦ç±»å‹ï¼Œé¿å…äº†æ‰‹åŠ¨è¾“å…¥æ‰€æœ‰å¯èƒ½çš„å­—ç¬¦çš„éº»çƒ¦ã€‚ åˆ†æ”¯æ¡ä»¶| å…ƒå­—ç¬¦ï¼Œç”¨äºåœ¨ä¸¤ç§æˆ–å¤šç§æ¨¡å¼ä¹‹é—´è¿›è¡Œé€‰æ‹© åŒ¹é…åˆ†ææ¡ä»¶æ—¶ï¼Œå°†ä¼šä»å·¦åˆ°å³åœ°æµ‹è¯•æ¯ä¸ªæ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³æŸä¸ªåˆ†æï¼Œå°±ä¸ä¼šå†å»å‘å³æµ‹è¯•ã€‚ åˆ†ç»„() å…ƒå­—ç¬¦ï¼Œæ ‡è®°ä¸€ä¸ªå­è¡¨è¾¾å¼çš„å¼€å§‹å’Œç»“æŸä½ç½®ã€‚ä¾‹å¦‚ IP åœ°å€è¡¨è¾¾å¼:((2[0-4]\\\\d|25[0-5]|[01]?\\\\d\\\\d?).)3(2[0-4]\\\\d|25[0-5]|[01]?\\\\d\\\\d?) é™å®šç¬¦ å­—ç¬¦ å«ä¹‰ * åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œzoèƒ½åŒ¹é… â€œzâ€ ä»¥åŠ â€œzooâ€ã€‚ ç­‰ä»·äº {0,}ã€‚ + åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œzo+ èƒ½åŒ¹é… â€œzoâ€ ä»¥åŠ â€œzooâ€ï¼Œä½†ä¸èƒ½åŒ¹é… â€œzâ€ã€‚+ ç­‰ä»·äº {1,}ã€‚ ? åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚ä¾‹å¦‚ï¼Œdo(es)? å¯ä»¥åŒ¹é… â€œdoâ€ ã€ â€œdoesâ€ã€ â€œdoxyâ€ ä¸­çš„ â€œdoâ€ å’Œ â€œdoesâ€ã€‚? ç­‰ä»·äº {0,1}ã€‚ {n} n æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚åŒ¹é…ç¡®å®šçš„ n æ¬¡ã€‚ä¾‹å¦‚ï¼Œo{2} ä¸èƒ½åŒ¹é… â€œBobâ€ ä¸­çš„ oï¼Œä½†æ˜¯èƒ½åŒ¹é… â€œfoodâ€ ä¸­çš„ä¸¤ä¸ª oã€‚ {n,} n æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚è‡³å°‘åŒ¹é… n æ¬¡ã€‚ä¾‹å¦‚ï¼Œo{2,} ä¸èƒ½åŒ¹é… â€œBobâ€ ä¸­çš„ oï¼Œä½†èƒ½åŒ¹é… â€œfooooodâ€ ä¸­çš„æ‰€æœ‰ oã€‚o{1,} ç­‰ä»·äº o+ã€‚o{0,} åˆ™ç­‰ä»·äº o*ã€‚ {n,m} m å’Œ n å‡ä¸ºéè´Ÿæ•´æ•°ï¼Œå…¶ä¸­ n mã€‚æœ€å°‘åŒ¹é… n æ¬¡ä¸”æœ€å¤šåŒ¹é… m æ¬¡ã€‚ä¾‹å¦‚ï¼Œo{1,3} å°†åŒ¹é… â€œfoooooodâ€ ä¸­çš„å‰ä¸‰ä¸ª oã€‚o{0,1} ç­‰ä»·äº o?ã€‚è¯·æ³¨æ„åœ¨é€—å·å’Œä¸¤ä¸ªæ•°ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚ å®šä½ç¬¦ å­—ç¬¦ å«ä¹‰ ^ åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²å¼€å§‹çš„ä½ç½®ã€‚å¦‚æœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œ^ è¿˜ä¼šä¸ æˆ– \\r ä¹‹åçš„ä½ç½®åŒ¹é…ã€‚ $ åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²ç»“å°¾çš„ä½ç½®ã€‚å¦‚æœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œ$ è¿˜ä¼šä¸ æˆ– \\r ä¹‹å‰çš„ä½ç½®åŒ¹é…ã€‚ \\b åŒ¹é…ä¸€ä¸ªå•è¯è¾¹ç•Œï¼Œå³å­—ä¸ç©ºæ ¼é—´çš„ä½ç½®ã€‚ \\B éå•è¯è¾¹ç•ŒåŒ¹é…ã€‚ ä¸èƒ½å°†é™å®šç¬¦ä¸å®šä½ç¬¦ä¸€èµ·ä½¿ç”¨ã€‚ç”±äºåœ¨ç´§é æ¢è¡Œæˆ–è€…å•è¯è¾¹ç•Œçš„å‰é¢æˆ–åé¢ä¸èƒ½æœ‰ä¸€ä¸ªä»¥ä¸Šä½ç½®ï¼Œå› æ­¤ä¸å…è®¸è¯¸å¦‚ ^* ä¹‹ç±»çš„è¡¨è¾¾å¼ è½¬ä¹‰å­—ç¬¦ä¸åä¹‰å­—ç¬¦ åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œè¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„è½¬ä¹‰å­—ç¬¦,è½¬ä¹‰å­—ç¬¦å¯ä»¥æ–¹ä¾¿åœ°åŒ¹é…ä¸€äº›å¸¸è§çš„å­—ç¬¦ç±»å‹: â€” â€” \\d è¡¨ç¤ºåŒ¹é…ä»»æ„ä¸€ä¸ªæ•°å­—å­—ç¬¦ \\w è¡¨ç¤ºåŒ¹é…ä»»æ„ä¸€ä¸ªå­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿å­—ç¬¦ \\s è¡¨ç¤ºåŒ¹é…ä»»æ„ä¸€ä¸ªç©ºç™½å­—ç¬¦ï¼ˆåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ç­‰ï¼‰ \\b è¡¨ç¤ºåŒ¹é…å•è¯çš„è¾¹ç•Œç­‰ã€‚ åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œåä¹‰å­—ç¬¦æ˜¯æŒ‡ç”¨äºåŒ¹é…é™¤äº†æŸäº›å­—ç¬¦ä¹‹å¤–çš„ä»»æ„å­—ç¬¦çš„ç‰¹æ®Šå­—ç¬¦ã€‚ åä¹‰å­—ç¬¦ä»¥ \\ å¼€å¤´ï¼Œåé¢è·Ÿç€ä¸€ä¸ªå¤§å†™å­—æ¯ï¼Œè¡¨ç¤ºåŒ¹é…é™¤äº†è¿™ä¸ªå­—ç¬¦ç±»åˆ«ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ä¹‹å¤–çš„æ‰€æœ‰å­—ç¬¦ã€‚ â€” â€” \\D åŒ¹é…ä»»æ„ä¸€ä¸ªéæ•°å­—å­—ç¬¦ã€‚ \\W åŒ¹é…ä»»æ„ä¸€ä¸ªéå­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿å­—ç¬¦ã€‚ \\S åŒ¹é…ä»»æ„ä¸€ä¸ªéç©ºç™½å­—ç¬¦ã€‚ \\B åŒ¹é…ä¸åœ¨å•è¯è¾¹ç•Œä¸Šçš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚ æ³¨é‡Šå°æ‹¬å·çš„å¦ä¸€ç§ç”¨é€”æ˜¯é€šè¿‡è¯­æ³• (?#comment) æ¥åŒ…å«æ³¨é‡Š IP åœ°å€ 2[0-4]\\d(?#200-249)|250-5|[01]?\\d\\d?(?#0-199)ã€‚ è´ªå©ªå’Œæ‡’æƒ°å½“æ­£åˆ™è¡¨è¾¾å¼ä¸­åŒ…å«èƒ½æ¥å—é‡å¤çš„é™å®šç¬¦æ—¶ï¼Œé€šå¸¸çš„è¡Œä¸ºæ˜¯ï¼ˆåœ¨ä½¿æ•´ä¸ªè¡¨è¾¾å¼èƒ½å¾—åˆ°åŒ¹é…çš„å‰æä¸‹ï¼‰åŒ¹é…å°½å¯èƒ½å¤šçš„å­—ç¬¦ã€‚ ä»¥è¿™ä¸ªè¡¨è¾¾å¼ä¸ºä¾‹ï¼ša.*bï¼Œå®ƒå°†ä¼šåŒ¹é…æœ€é•¿çš„ä»¥ a å¼€å§‹ï¼Œä»¥ b ç»“æŸçš„å­—ç¬¦ä¸²ã€‚ å¦‚æœç”¨å®ƒæ¥æœç´¢ aabab çš„è¯ï¼Œå®ƒä¼šåŒ¹é…æ•´ä¸ªå­—ç¬¦ä¸² aababã€‚è¿™è¢«ç§°ä¸ºè´ªå©ªåŒ¹é…ã€‚ æœ‰æ—¶ï¼Œä»¬æ›´éœ€è¦æ‡’æƒ°åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯åŒ¹é…å°½å¯èƒ½å°‘çš„å­—ç¬¦ã€‚ å‰é¢ç»™å‡ºçš„é™å®šç¬¦éƒ½å¯ä»¥è¢«è½¬åŒ–ä¸ºæ‡’æƒ°åŒ¹é…æ¨¡å¼ï¼Œåªè¦åœ¨å®ƒåé¢åŠ ä¸Šä¸€ä¸ªé—®å·?ã€‚ è¿™æ · .*? å°±æ„å‘³ç€åŒ¹é…ä»»æ„æ•°é‡çš„é‡å¤ï¼Œä½†æ˜¯åœ¨èƒ½ä½¿æ•´ä¸ªåŒ¹é…æˆåŠŸçš„å‰æä¸‹ä½¿ç”¨æœ€å°‘çš„é‡å¤ã€‚ ç°åœ¨çœ‹çœ‹æ‡’æƒ°ç‰ˆçš„ä¾‹å­å§ï¼š a.*?b åŒ¹é…æœ€çŸ­çš„ï¼Œä»¥ a å¼€å§‹ï¼Œä»¥ b ç»“æŸçš„å­—ç¬¦ä¸²ã€‚å¦‚æœæŠŠå®ƒåº”ç”¨äº aabab çš„è¯ï¼Œå®ƒä¼šåŒ¹é… aabï¼ˆç¬¬ä¸€åˆ°ç¬¬ä¸‰ä¸ªå­—ç¬¦ï¼‰å’Œ abï¼ˆç¬¬å››åˆ°ç¬¬äº”ä¸ªå­—ç¬¦ï¼‰ã€‚ è¿ç®—ç¬¦ä¼˜å…ˆçº§æ­£åˆ™è¡¨è¾¾å¼ä»å·¦åˆ°å³è¿›è¡Œè®¡ç®—ï¼Œå¹¶éµå¾ªä¼˜å…ˆçº§é¡ºåºï¼Œè¿™ä¸ç®—æœ¯è¡¨è¾¾å¼éå¸¸ç±»ä¼¼ã€‚ ç›¸åŒä¼˜å…ˆçº§çš„ä»å·¦åˆ°å³è¿›è¡Œè¿ç®—ï¼Œä¸åŒä¼˜å…ˆçº§çš„è¿ç®—å…ˆé«˜åä½ã€‚ä¸‹è¡¨ä»æœ€é«˜åˆ°æœ€ä½è¯´æ˜äº†å„ç§æ­£åˆ™è¡¨è¾¾å¼è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é¡ºåºï¼š è¿ç®—ç¬¦ æè¿° \\ è½¬ä¹‰ç¬¦ (), (?:), (?), [] åœ†æ‹¬å·å’Œæ–¹æ‹¬å· *, +, ?, {n}, {n,}, {n,m} é™å®šç¬¦ ^, $, \\ä»»ä½•å…ƒå­—ç¬¦ã€ä»»ä½•å­—ç¬¦ å®šä½ç‚¹å’Œåºåˆ—ï¼ˆå³ï¼šä½ç½®å’Œé¡ºåºï¼‰ | æ›¿æ¢ï¼Œâ€ æˆ– â€œ æ“ä½œ,å­—ç¬¦å…·æœ‰é«˜äºæ›¿æ¢è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ï¼Œä½¿å¾—m åå‘å¼•ç”¨ä½¿ç”¨å°æ‹¬å·æŒ‡å®šä¸€ä¸ªå­è¡¨è¾¾å¼åï¼ŒåŒ¹é…è¿™ä¸ªå­è¡¨è¾¾å¼çš„æ–‡æœ¬ (ä¹Ÿå°±æ˜¯æ­¤åˆ†ç»„æ•è·çš„å†…å®¹) å¯ä»¥åœ¨è¡¨è¾¾å¼æˆ–å…¶å®ƒç¨‹åºä¸­ä½œè¿›ä¸€æ­¥çš„å¤„ç†ã€‚ åå‘å¼•ç”¨ç”¨äºé‡å¤æœç´¢å‰é¢æŸä¸ªåˆ†ç»„åŒ¹é…çš„æ–‡æœ¬ã€‚ä¾‹å¦‚ï¼Œ\\1 ä»£è¡¨åˆ†ç»„ 1 åŒ¹é…çš„æ–‡æœ¬ã€‚ åˆ†ç»„ 0 å¯¹åº”æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼ \\b(\\w+)\\b\\s+\\1\\b å¯ä»¥ç”¨æ¥åŒ¹é…é‡å¤çš„å•è¯ï¼Œåƒ go go, æˆ–è€… kitty kittyã€‚ æ€»ç»“ ç¡®å®šéœ€è¦åŒ¹é…çš„åŸºæœ¬å­—ç¬¦æˆ–å­—ç¬¦ç±»åˆ«é›†åˆç­‰ ç¡®å®šåŒ¹é…çš„å­—ç¬¦æˆ–å­—ç¬¦é›†åˆçš„æ•°é‡ ç‰¹æ®Šå­—ç¬¦å’Œè½¬ä¹‰å­—ç¬¦çš„å¤„ç† è¾¹ç•Œå’Œä½ç½®çš„åŒ¹é… ä½¿ç”¨æ•è·ç»„ () è¿›è¡Œå¤šç»„åŒ¹é… ä½¿ç”¨åå‘å¼•ç”¨ ä½¿ç”¨é€»è¾‘æ“ä½œç¬¦è¿›è¡Œåˆ¤å®š æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦å«ä¹‰è¡¨ å­—ç¬¦ å«ä¹‰ \\ å°†ä¸‹ä¸€ä¸ªå­—ç¬¦æ ‡è®°ä¸ºä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ã€æˆ–ä¸€ä¸ªåŸä¹‰å­—ç¬¦ã€æˆ–ä¸€ä¸ª å‘åå¼•ç”¨ã€æˆ–ä¸€ä¸ªå…«è¿›åˆ¶è½¬ä¹‰ç¬¦ã€‚ä¾‹å¦‚ï¼Œn åŒ¹é…å­—ç¬¦ â€œnâ€ã€‚\\ åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚åºåˆ— \\\\ åŒ¹é… â€œ\\ è€Œ â€œ(â€œ åˆ™åŒ¹é… â€œ(â€œã€‚ ^ åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®ã€‚å¦‚æœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œ^ ä¹ŸåŒ¹é… \\ æˆ– \\\\r ä¹‹åçš„ä½ç½®ã€‚ $ åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„ç»“æŸä½ç½®ã€‚å¦‚æœè®¾ç½®äº†RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œ$ ä¹ŸåŒ¹é… \\ æˆ– \\\\r ä¹‹å‰çš„ä½ç½®ã€‚ * åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œzoèƒ½åŒ¹é… â€œzâ€ ä»¥åŠ â€œzooâ€ã€‚ ç­‰ä»·äº{0,}ã€‚ + åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œzo+ èƒ½åŒ¹é… â€œzoâ€ ä»¥åŠ â€œzooâ€ï¼Œä½†ä¸èƒ½åŒ¹é… â€œzâ€ã€‚+ ç­‰ä»·äº {1,}ã€‚ ? åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€do(es)?â€ å¯ä»¥åŒ¹é… â€œdoâ€ æˆ– â€œdoesâ€ ã€‚? ç­‰ä»·äº {0,1}ã€‚ {n} n æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚åŒ¹é…ç¡®å®šçš„ n æ¬¡ã€‚ä¾‹å¦‚ï¼Œo2 ä¸èƒ½åŒ¹é… â€œBobâ€ ä¸­çš„ oï¼Œä½†æ˜¯èƒ½åŒ¹é… â€œfoodâ€ ä¸­çš„ä¸¤ä¸ª oã€‚ {n,} n æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚è‡³å°‘åŒ¹é… n æ¬¡ã€‚ä¾‹å¦‚ï¼Œo2, ä¸èƒ½åŒ¹é… â€œBobâ€ ä¸­çš„ oï¼Œä½†èƒ½åŒ¹é… â€œfooooodâ€ ä¸­çš„æ‰€æœ‰ oã€‚o1, ç­‰ä»·äº o+ã€‚o0, åˆ™ç­‰ä»·äº o*ã€‚ {n,m} m å’Œ n å‡ä¸ºéè´Ÿæ•´æ•°ï¼Œå…¶ä¸­ n mã€‚æœ€å°‘åŒ¹é… n æ¬¡ä¸”æœ€å¤šåŒ¹é… m æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€o{1,3}â€ å°†åŒ¹é… â€œfoooooodâ€ ä¸­çš„å‰ä¸‰ä¸ª oã€‚o0,1 ç­‰ä»·äº o?ã€‚è¯·æ³¨æ„åœ¨é€—å·å’Œä¸¤ä¸ªæ•°ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚ ? å½“è¯¥å­—ç¬¦ç´§è·Ÿåœ¨ä»»ä½•ä¸€ä¸ªå…¶ä»–é™åˆ¶ç¬¦ (*, +, ?, {n}, {n,}, {n,m}) åé¢æ—¶ï¼ŒåŒ¹é…æ¨¡å¼æ˜¯éè´ªå©ªçš„ã€‚éè´ªå©ªæ¨¡å¼å°½å¯èƒ½å°‘çš„åŒ¹é…æ‰€æœç´¢çš„å­—ç¬¦ä¸²ï¼Œè€Œé»˜è®¤çš„è´ªå©ªæ¨¡å¼åˆ™å°½å¯èƒ½å¤šçš„åŒ¹é…æ‰€æœç´¢çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå­—ç¬¦ä¸² â€œooooâ€ï¼Œo+? å°†åŒ¹é…å•ä¸ª â€œoâ€ï¼Œè€Œ o+ å°†åŒ¹é…æ‰€æœ‰ oã€‚ . åŒ¹é…é™¤æ¢è¡Œç¬¦ï¼ˆ ã€\\rï¼‰ä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚è¦åŒ¹é…åŒ…æ‹¬ \\ åœ¨å†…çš„ä»»ä½•å­—ç¬¦ï¼Œè¯·ä½¿ç”¨åƒ (. ) çš„æ¨¡å¼ã€‚ (pattern) åŒ¹é… pattern å¹¶è·å–è¿™ä¸€åŒ¹é…ã€‚æ‰€è·å–çš„åŒ¹é…å¯ä»¥ä»äº§ç”Ÿçš„ Matches é›†åˆå¾—åˆ°ï¼Œåœ¨ VBScript ä¸­ä½¿ç”¨ SubMatches é›†åˆï¼Œåœ¨ JScript ä¸­åˆ™ä½¿ç”¨ $0â€¦$9 å±æ€§ã€‚è¦åŒ¹é…åœ†æ‹¬å·å­—ç¬¦ï¼Œè¯·ä½¿ç”¨ ( æˆ– )ã€‚ (?:pattern) åŒ¹é… pattern ä½†ä¸è·å–åŒ¹é…ç»“æœï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ˜¯ä¸€ä¸ªéè·å–åŒ¹é…ï¼Œä¸è¿›è¡Œå­˜å‚¨ä¾›ä»¥åä½¿ç”¨ã€‚è¿™åœ¨ä½¿ç”¨ â€œ æˆ– â€œ å­—ç¬¦ ( ) æ¥ç»„åˆä¸€ä¸ªæ¨¡å¼çš„å„ä¸ªéƒ¨åˆ†æ˜¯å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œ industr(?:y (?pattern) æ­£å‘è‚¯å®šé¢„æŸ¥ï¼ˆlook ahead positive assertï¼‰ï¼Œåœ¨ä»»ä½•åŒ¹é…patternçš„å­—ç¬¦ä¸²å¼€å§‹å¤„åŒ¹é…æŸ¥æ‰¾å­—ç¬¦ä¸²ã€‚è¿™æ˜¯ä¸€ä¸ªéè·å–åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥åŒ¹é…ä¸éœ€è¦è·å–ä¾›ä»¥åä½¿ç”¨ã€‚ä¾‹å¦‚ï¼ŒWindows(?95 98 (?!pattern) æ­£å‘å¦å®šé¢„æŸ¥ (negative assert)ï¼Œåœ¨ä»»ä½•ä¸åŒ¹é… pattern çš„å­—ç¬¦ä¸²å¼€å§‹å¤„åŒ¹é…æŸ¥æ‰¾å­—ç¬¦ä¸²ã€‚è¿™æ˜¯ä¸€ä¸ªéè·å–åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥åŒ¹é…ä¸éœ€è¦è·å–ä¾›ä»¥åä½¿ç”¨ã€‚ä¾‹å¦‚ Windows(?!95 98 (?pattern) åå‘(look behind)è‚¯å®šé¢„æŸ¥ï¼Œä¸æ­£å‘è‚¯å®šé¢„æŸ¥ç±»ä¼¼ï¼Œåªæ˜¯æ–¹å‘ç›¸åã€‚ä¾‹å¦‚ï¼Œ(?95 98 (? åå‘å¦å®šé¢„æŸ¥ï¼Œä¸æ­£å‘å¦å®šé¢„æŸ¥ç±»ä¼¼ï¼Œåªæ˜¯æ–¹å‘ç›¸åã€‚ä¾‹å¦‚ â€œ(?â€ èƒ½åŒ¹é… â€œ3.1Windowsâ€ ä¸­çš„ â€œWindowsâ€ï¼Œä½†ä¸èƒ½åŒ¹é… â€œ2000Windowsâ€ ä¸­çš„ â€œWindowsâ€ã€‚ x y åŒ¹é… x æˆ– yã€‚ä¾‹å¦‚ï¼Œz [xyz] å­—ç¬¦é›†åˆã€‚åŒ¹é…æ‰€åŒ…å«çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ[abc] å¯ä»¥åŒ¹é… â€œplainâ€ ä¸­çš„ aã€‚ [^xyz] è´Ÿå€¼å­—ç¬¦é›†åˆã€‚åŒ¹é…æœªåŒ…å«çš„ä»»æ„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ[^abc] å¯ä»¥åŒ¹é… â€œplainâ€ ä¸­çš„pã€lã€iã€nã€‚ [a-z] å­—ç¬¦èŒƒå›´ã€‚åŒ¹é…æŒ‡å®šèŒƒå›´å†…çš„ä»»æ„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ[a-z] å¯ä»¥åŒ¹é… a åˆ° z èŒƒå›´å†…çš„ä»»æ„å°å†™å­—æ¯å­—ç¬¦ã€‚ [^a-z] è´Ÿå€¼å­—ç¬¦èŒƒå›´ã€‚åŒ¹é…ä»»ä½•ä¸åœ¨æŒ‡å®šèŒƒå›´å†…çš„ä»»æ„å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ[^a-z] å¯ä»¥åŒ¹é…ä»»ä½•ä¸åœ¨ a åˆ° z èŒƒå›´å†…çš„ä»»æ„å­—ç¬¦ã€‚ \\b åŒ¹é…ä¸€ä¸ªå•è¯è¾¹ç•Œï¼Œä¹Ÿå°±æ˜¯æŒ‡å•è¯å’Œç©ºæ ¼é—´çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œer\\\\b å¯ä»¥åŒ¹é…â€neverâ€ ä¸­çš„ erï¼Œä½†ä¸èƒ½åŒ¹é… â€œverbâ€ ä¸­çš„ erã€‚ \\B åŒ¹é…éå•è¯è¾¹ç•Œã€‚er\\\\B èƒ½åŒ¹é… â€œverbâ€ ä¸­çš„ erï¼Œä½†ä¸èƒ½åŒ¹é… â€œneverâ€ ä¸­çš„ erã€‚ \\cx åŒ¹é…ç”± x æŒ‡æ˜çš„æ§åˆ¶å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ \\cM åŒ¹é…ä¸€ä¸ª Control-M æˆ–å›è½¦ç¬¦ã€‚x çš„å€¼å¿…é¡»ä¸º A-Z æˆ– a-z ä¹‹ä¸€ã€‚å¦åˆ™ï¼Œå°† c è§†ä¸ºä¸€ä¸ªåŸä¹‰çš„c å­—ç¬¦ã€‚ \\d åŒ¹é…ä¸€ä¸ªæ•°å­—å­—ç¬¦ã€‚ç­‰ä»·äº [0-9]ã€‚ \\D åŒ¹é…ä¸€ä¸ªéæ•°å­—å­—ç¬¦ã€‚ç­‰ä»·äº [^0-9]ã€‚ \\f åŒ¹é…ä¸€ä¸ªæ¢é¡µç¬¦ã€‚ç­‰ä»·äº \\x0c å’Œ \\cLã€‚ åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ç­‰ä»·äº \\x0a å’Œ \\cJã€‚ \\r åŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦ã€‚ç­‰ä»·äº \\x0d å’Œ \\cMã€‚ \\s åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚ç­‰ä»·äº [ \\f \\r\\t\\v]ã€‚ \\S åŒ¹é…ä»»ä½•éç©ºç™½å­—ç¬¦ã€‚ç­‰ä»·äº [^ \\f \\r\\t\\v]ã€‚ \\t åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº \\x09 å’Œ \\cIã€‚ \\v åŒ¹é…ä¸€ä¸ªå‚ç›´åˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº \\x0b å’Œ \\cKã€‚ \\w åŒ¹é…å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€‚ç­‰ä»·äº[A-Za-z0-9_]ã€‚ \\W åŒ¹é…éå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€‚ç­‰ä»·äº[^A-Za-z0-9_]ã€‚ \\xn åŒ¹é… nï¼Œå…¶ä¸­ n ä¸ºåå…­è¿›åˆ¶è½¬ä¹‰å€¼ã€‚åå…­è¿›åˆ¶è½¬ä¹‰å€¼å¿…é¡»ä¸ºç¡®å®šçš„ä¸¤ä¸ªæ•°å­—é•¿ã€‚ä¾‹å¦‚ï¼Œ\\\\x41 åŒ¹é… â€œAâ€ã€‚\\\\x041 åˆ™ç­‰ä»·äº \\\\x04 â€œ1â€ã€‚æ­£åˆ™è¡¨è¾¾å¼ä¸­å¯ä»¥ä½¿ç”¨ ASCII ç¼–ç ã€‚ um åŒ¹é… numï¼Œå…¶ä¸­ num æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ã€‚å¯¹æ‰€è·å–çš„åŒ¹é…çš„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼Œ(.)\\\\1 åŒ¹é…ä¸¤ä¸ªè¿ç»­çš„ç›¸åŒå­—ç¬¦ã€‚ æ ‡è¯†ä¸€ä¸ªå…«è¿›åˆ¶è½¬ä¹‰å€¼æˆ–ä¸€ä¸ªå‘åå¼•ç”¨ã€‚å¦‚æœ ä¹‹å‰è‡³å°‘ n ä¸ªè·å–çš„å­è¡¨è¾¾å¼ï¼Œåˆ™ n ä¸ºå‘åå¼•ç”¨ã€‚å¦åˆ™ï¼Œå¦‚æœ n ä¸ºå…«è¿›åˆ¶æ•°å­— (0-7)ï¼Œåˆ™ n ä¸ºä¸€ä¸ªå…«è¿›åˆ¶è½¬ä¹‰å€¼ã€‚ m æ ‡è¯†ä¸€ä¸ªå…«è¿›åˆ¶è½¬ä¹‰å€¼æˆ–ä¸€ä¸ªå‘åå¼•ç”¨ã€‚å¦‚æœ m ä¹‹å‰è‡³å°‘æœ‰ nm ä¸ªè·å¾—å­è¡¨è¾¾å¼ï¼Œåˆ™ nm ä¸ºå‘åå¼•ç”¨ã€‚å¦‚æœ m ä¹‹å‰è‡³å°‘æœ‰ n ä¸ªè·å–ï¼Œåˆ™ n ä¸ºä¸€ä¸ªåè·Ÿæ–‡å­— m çš„å‘åå¼•ç”¨ã€‚å¦‚æœå‰é¢çš„æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œè‹¥ n å’Œ m å‡ä¸ºå…«è¿›åˆ¶æ•°å­— (0-7)ï¼Œåˆ™ m å°†åŒ¹é…å…«è¿›åˆ¶è½¬ä¹‰å€¼ nmã€‚ ml å¦‚æœ n ä¸ºå…«è¿›åˆ¶æ•°å­— (0-3)ï¼Œä¸” m å’Œ l å‡ä¸ºå…«è¿›åˆ¶æ•°å­— (0-7)ï¼Œåˆ™åŒ¹é…å…«è¿›åˆ¶è½¬ä¹‰å€¼ nmlã€‚ \\un åŒ¹é… nï¼Œå…¶ä¸­ n æ˜¯ä¸€ä¸ªç”¨å››ä¸ªåå…­è¿›åˆ¶æ•°å­—è¡¨ç¤ºçš„ Unicode å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ \\u00A9 åŒ¹é…ç‰ˆæƒç¬¦å· (?)ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","å…¶ä»–è¯­æ³•"]},{"title":"Kalman Filter é€šä¿—è®²è§£-CSDNåšå®¢","path":"/2024/02/05/2-ç¼–ç¨‹è¯­è¨€-ç»“æ„ç®—æ³•-Kalman-Filter-é€šä¿—è®²è§£-CSDNåšå®¢/","content":"å¼•è¨€Kalman Filterï¼Œå¾ˆå¤šäººåˆšå¬åˆ°è¿™ä¸ªåè¯æ—¶ï¼Œæ€»æ˜¯ä¼šä¸‹æ„è¯†è®¤ä¸ºè¿™å°±æ˜¯ä¸ª æ»¤æ³¢å™¨ã€‚æˆ‘è¿™é‡Œæƒ³è¦é‡ç‚¹å£°æ˜çš„æ˜¯ï¼ŒKalman Filter ä¸æ˜¯æ»¤æ³¢ï¼Œå®ƒæ˜¯ä¸€ç§ä¿¡æ¯èåˆçš„è¿‡ç¨‹ã€‚é‚£ä¹ˆ Kalman Filter åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿå®ƒåœ¨é‚£äº›æ–¹é¢æœ‰ç€åº”ç”¨ï¼Œå®ƒçš„åŸºæœ¬åŸç†åˆæ˜¯ä»€ä¹ˆã€‚å¦‚æœä½ å‚è€ƒå›½å†…çš„è®ºå›æˆ–è€…æ•™æä¸Šï¼Œä½ ä¸€å®šä¼šå‘ç°ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ä¸€äº›å¤æ‚å…¬å¼ä¸æ¯ç‡¥æŠ½è±¡çš„è¯´æ˜ã€‚è¿™é‡Œæˆ‘ä»¬å°†é€šè¿‡å°½é‡é€šä¿—æ˜“æ‡‚çš„è®²è§£æ¥ç»™å¤§å®¶è§£é‡Šä¸‹ä»€ä¹ˆå« Kalman Fiterã€‚ å…ˆç¹ä¸ºå¿«æ­£å¦‚æˆ‘å‰é¢æåˆ°çš„ï¼Œä»å®šä¹‰åŠå¤æ‚å…¬å¼å»ç†è§£å¡å°”æ›¼æ»¤æ³¢ï¼Œå¯¹å’±ä»¬å‡¡äººæ¥è¯´åŸºæœ¬æ˜¯ä¸å¯èƒ½çš„ã€‚æˆ‘ä»¬å°†å…¬å¼ç®€åŒ–ï¼Œå…ˆä»ä¸‹é¢çš„å…¬å¼æ¥å¼€å§‹è®²è§£ï¼š å…¶ä¸­ä¸‹æ ‡ k k k æ˜¯æŒ‡çŠ¶æ€ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒçœ‹æˆé—´éš”ï¼Œæ¯”å¦‚ k 1 k1 k=1 æŒ‡ 1msï¼Œ k 2 k2 k=2 æŒ‡ 2msã€‚æˆ‘ä»¬çš„ç›®çš„å°±æ˜¯è¦æ‰¾åˆ°åœ¨çŠ¶æ€ k k k æ—¶ X X X çš„ä¼°è®¡ã€‚åœ¨å…¬å¼ä¸­ Z k Z_k Zkâ€‹å°±æ˜¯çœŸå®æµ‹é‡å€¼ã€‚æˆ‘ä»¬è¦ç‰¢è®°ï¼Œè¿™äº›æµ‹é‡å€¼å¹¶ä¸å¯é ã€‚ï¼ˆå¦‚æœè¿™äº›æµ‹é‡å€¼æ˜¯å¯é çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ²¡å¿…è¦å­¦ kalman filter äº†ï¼šï¼‰ï¼‰ã€‚ K k K_k Kkâ€‹æŒ‡å¡å°”æ›¼å¢ç›Šï¼ˆè¿™æ˜¯æ•´ä¸ªå…¬å¼ä¸­çš„æ ¸å¿ƒç‚¹ï¼‰ã€‚ X k âˆ’ 1 ^ \\hat{X_{k-1}} Xkâˆ’1â€‹^â€‹å°±æ˜¯ä¸Šä¸€çŠ¶æ€æ—¶çš„ä¼°è®¡ã€‚åœ¨ä¸Šè¿°å…¬å¼ä¸­ï¼Œæˆ‘ä»¬å”¯ä¸€æœªçŸ¥çš„é‡å°±æ˜¯å¡å°”æ›¼å¢ç›Š K k K_k Kkâ€‹ã€‚åƒæµ‹é‡å€¼åŠä¸Šä¸€çŠ¶æ€ä¼°è®¡ï¼Œæˆ‘ä»¬éƒ½å·²ç»çŸ¥é“äº†ã€‚å½“ç„¶äº†ï¼Œæ±‚å‡ºå¡å°”æ›¼å¢ç›Šå¹¶ä¸ç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰æ–¹æ³•æ¥è§£å†³å®ƒã€‚æˆ‘ä»¬ä»å¦ä¸€è§’åº¦æ¥æ€è€ƒï¼Œè®©æˆ‘ä»¬å‡è®¾å¡å°”æ›¼å¢ç›Šä¸º 0.5ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä»€ä¹ˆå‘¢ï¼Ÿå®ƒå°±æ˜¯ä¸ªç®€å•çš„å¹³å‡ï¼æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬åº”è¯¥æ‰¾åˆ°å¯¹åº”äºæ¯ä¸ªçŠ¶æ€çš„æ›´åŠ æ™ºèƒ½åŒ–çš„å¡å°”æ›¼å¢ç›Šç³»æ•°ã€‚å½’æ ¹ç»“åº•å°±æ˜¯ï¼š å¡å°”æ›¼æ»¤æ³¢å™¨ä¸ºæ¯ä¸ªç»“æœçŠ¶æ€æ‰¾åˆ°æœ€ä¼˜çš„å¹³å‡å› å­ã€‚ ä¸çŸ¥æ€çš„ï¼Œè¿˜è®°å¾—ä¸€äº›å…³äºè¿‡å»çš„çŠ¶æ€ã€‚ å¦‚ä½•ï¼ŒKalman Filter ç¥å¥‡å§ï¼ åˆ†æ­¥æŒ‡å—ä¸‹é¢æ˜¯åˆ†å¸ƒæŒ‡å—ï¼Œå¯ä»¥å¿«é€Ÿå¼€å§‹å¡å°”æ›¼æ»¤æ³¢ã€‚ Step1 æ„å»ºæ¨¡å‹è¿™æ˜¯æœ€é‡è¦çš„æ­¥éª¤ã€‚é¦–å…ˆï¼Œä½ å¿…é¡»ç¡®ä¿å¡å°”æ›¼æ»¤æ³¢çš„æ¡ä»¶ç¬¦åˆä½ çš„é—®é¢˜ã€‚æˆ‘ä»¬è¿˜è®°å¾—å¡å°”æ›¼æ»¤æ³¢çš„ä¸¤ä¸ªå…¸å‹æ–¹ç¨‹ï¼ˆwikiï¼‰ï¼šx k A x k âˆ’ 1 + B u k + W k âˆ’ 1 x_k Ax_{k-1}+Bu_k+W_{k-1} xkâ€‹=Axkâˆ’1â€‹+Bukâ€‹+Wkâˆ’1â€‹z k H x k + v k z_k Hx_k+v_k zkâ€‹=Hxkâ€‹+vkâ€‹ ç¬¬ä¸€ä¸ªå…¬å¼æ„å‘³ç€æ¯ä¸ª x k x_k xkâ€‹å¯ä»¥é€šè¿‡ä¸€ä¸ªçº¿æ€§éšæœºæ–¹ç¨‹æ¥è¡¨ç¤ºã€‚ä»»ä½•ä¸€ä¸ª x k x_k xkâ€‹éƒ½æ˜¯å®ƒå‰ä¸€çŠ¶æ€çš„çš„åªåŠ ä¸Šæ§åˆ¶ä¿¡å· u k u_k ukâ€‹åŠå¤„ç†å™ªå£° W k âˆ’ 1 W_{k-1} Wkâˆ’1â€‹çš„çº¿æ€§ç»„åˆã€‚å¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œå¹¶ä¸éœ€è¦æ§åˆ¶ä¿¡å· u k u_k ukâ€‹ã€‚ ç¬¬äºŒä¸ªå…¬å¼å‘Šè¯‰æˆ‘ä»¬ï¼Œä»»ä½•æµ‹é‡å€¼ï¼ˆè¿™é‡Œæˆ‘ä»¬å¹¶ä¸ç¡®å®šå®ƒæ˜¯å¦å‡†ç¡®ï¼‰æ˜¯å½“å‰çŠ¶æ€ä¿¡å·å€¼åŠæµ‹é‡å™ªå£°çš„çº¿æ€§ç»„åˆï¼Œæˆ‘ä»¬é»˜è®¤è¯¥å€¼æœä»é«˜æ–¯åˆ†å¸ƒã€‚ è¿™ä¸¤ä¸ªå…¬å¼ä¸­çš„å¤„ç†å™ªå£°åŠæµ‹é‡å™ªå£°ï¼Œæˆ‘ä»¬éƒ½è®¤ä¸ºæ˜¯ç»Ÿè®¡ç‹¬ç«‹çš„ã€‚ æ–¹ç¨‹å¼ä¸­çš„ç³»æ•° A , B A,B A,B åŠ H H H æ˜¯ä¸€èˆ¬å½¢å¼çš„çŸ©é˜µã€‚ä½†æ˜¯åœ¨å¤§å¤šæ•°çš„ä¿¡å·å¤„ç†é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ¨¡å‹ä¸­ï¼Œè¿™äº›ç³»æ•°éƒ½ä»…ä»…æ˜¯æ•°å€¼ã€‚è€Œä¸”å½“è¿™äº›å€¼åœ¨çŠ¶æ€é—´å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾å®ƒä»¬å°±æ˜¯å¸¸æ•°ã€‚ å¦‚æœæˆ‘ä»¬ç¡®å®šæˆ‘ä»¬çš„ç³»ç»Ÿç¬¦åˆè¿™ä¸ªæ¨¡å‹ï¼ˆå¤§å¤šæ•°çš„ç³»ç»Ÿéƒ½æ˜¯ç¬¦åˆçš„ï¼‰ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œå°±åªå‰©ä¸‹ä¼°è®¡å™ªå£°å‡½æ•° W k âˆ’ 1 W_{k-1} Wkâˆ’1â€‹åŠ v k v_k vkâ€‹çš„å‡å€¼å’Œæ ‡å‡†å·®ã€‚æˆ‘ä»¬çŸ¥é“åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæ²¡æœ‰å“ªä¸ªä¿¡å·æ˜¯çº¯é«˜æ–¯åˆ†å¸ƒçš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿‘ä¼¼æ¥è¿›è¡Œå‡è®¾ã€‚ è¿™ä¸æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬å°†çœ‹åˆ°å¡å°”æ›¼æ»¤æ³¢ç®—æ³•è¯•å›¾æ”¶æ•›åˆ°æ­£ç¡®çš„ä¼°è®¡ï¼Œå³ä½¿é«˜æ–¯å™ªå£°å‚æ•°ä¼°è®¡å¾ˆå·®ã€‚ è¿™é‡Œæˆ‘ä»¬è¦å§‹ç»ˆç‰¢è®°äºå¿ƒçš„æ˜¯ï¼šâ€œä½ ä¼°è®¡å™ªå£°å‚æ•°è¶Šå‡†ç¡®ï¼Œä½ å°±èƒ½è·å¾—æ›´å¥½çš„ä¼°è®¡â€ Step2 å¼€å§‹å¤„ç†å¦‚æœä½ æˆåŠŸçš„å°†ä½ çš„æ¨¡å‹æ‹Ÿåˆåˆ°å¡å°”æ›¼æ»¤æ³¢å™¨ä¸­ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„æ­¥éª¤å°±æ˜¯å†³å®šå¿…è¦çš„å‚æ•°åŠä½ çš„åˆå§‹å€¼ã€‚ æˆ‘ä»¬æœ‰ä¸¤ä¸ªä¸åŒçš„æ–¹ç¨‹é›†åˆï¼šæ—¶é—´æ›´æ–°ï¼ˆé¢„æµ‹ï¼‰åŠæµ‹é‡æ›´æ–°ï¼ˆæ ¡å‡†ï¼‰ã€‚ä¸¤ä¸ªæ–¹ç¨‹é›†åˆéƒ½æ˜¯åº”ç”¨åœ¨ç¬¬ k k k ä¸ªçŠ¶æ€ æˆ‘ä»¬åœ¨æ­¥éª¤ä¸€ä¸­å»ºç«‹æ¨¡å‹ï¼Œå› æ­¤æˆ‘ä»¬çŸ¥é“çŸ©é˜µ A,B å’Œ Hã€‚å¾ˆå¯èƒ½ï¼Œä»–ä»¬éƒ½æ˜¯æ•°å€¼å¸¸é‡ã€‚å¹¶ä¸”ä»–ä»¬æå¯èƒ½éƒ½æ˜¯æ•°å€¼ 1. æˆ‘å»ºè®®ä½ ä»¬é‡æ–°å†™ä¸‹è¿™äº›å…¬å¼ï¼Œå¹¶çœ‹çœ‹å¦‚ä½•å»ç®€åŒ–è¿™äº›å…¬å¼ã€‚.ä¸Šè¿°å…¬å¼ä¸­æœ€ç—›è‹¦çš„äº‹å„¿å°±æ˜¯ç¡®å®š R å’Œ Q äº†ã€‚R è¿˜ç›¸å¯¹æ¯”è¾ƒå®¹æ˜“æ‰¾å‡ºï¼Œå› ä¸ºï¼Œé€šå¸¸æ¥è®²ï¼Œæˆ‘ä»¬å¯¹ç¯å¢ƒä¸­çš„å™ªå£°è¿˜æ˜¯æ¯”è¾ƒç¡®å®šçš„ã€‚ä½†æ˜¯å¯»æ‰¾ Q å°±å¹¶ä¸æ˜æ˜¾äº†ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½ç»™ä½ ä¸€ä¸ªæŒ‡å®šçš„æ–¹æ³•ã€‚ ä¸ºäº†å¼€å§‹è¿™ä¸ªå¤„ç†ï¼Œæˆ‘ä¹ˆéœ€è¦çŸ¥é“ x 0 x_0 x0â€‹å’Œ P 0 P_0 P0â€‹çš„ä¼°è®¡ Step3 è¿­ä»£åœ¨æˆ‘ä»¬æ”¶é›†äº†æˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯åï¼Œæˆ‘ä»¬å¼€å§‹å¤„ç†æµç¨‹ï¼Œç°åœ¨æˆ‘ä»¬å¯è¿­ä»£ä¼°è®¡ã€‚æˆ‘ä»¬è¦ç‰¢è®°ä¸Šä¸€çŠ¶æ€çš„ä¼°è®¡å°†æˆä¸ºå½“å‰çŠ¶æ€çš„ä¼°è®¡çš„è¾“å…¥ã€‚è¿™é‡Œï¼Œå…ˆéªŒä¼°è®¡æŒ‡æµ‹é‡æ›´æ–°æ ¡å‡†å‰çš„ç²—ç•¥ä¼°è®¡ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åœ¨æµ‹é‡æ›´æ–°å…¬å¼ä¸­çš„å…ˆéªŒå€¼ åœ¨æµ‹é‡æ›´æ–°å…¬å¼ä¸­ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†åœ¨çŠ¶æ€ k æ—¶ x çš„ä¼°è®¡ã€‚å¹¶ä¸”æ‰¾åˆ°äº†ä¸ºäº†çŠ¶æ€ k+1 ä¼°è®¡æ‰€éœ€è¦çš„å€¼ã€‚ æˆ‘ä»¬è®¡ç®—çš„å¡å°”æ›¼å¢ç›Šï¼Œåœ¨ä¸‹ä¸€ä¸ªè¿­ä»£æ­¥éª¤ä¸­å¹¶ä¸éœ€è¦ã€‚ è¿™æ˜¯ä¸€ç»„æ–¹ç¨‹ä¸­éšè—çš„ï¼Œç¥ç§˜çš„ï¼Œæœ€é‡è¦çš„éƒ¨åˆ†ã€‚ æˆ‘ä»¬åœ¨æµ‹é‡æ›´æ–°é˜¶æ®µè¯„ä¼°çš„å€¼ä¹Ÿç§°ä¸ºåéªŒå€¼ã€‚è¿™ä¹Ÿæ˜¯è¯´å¾—é€šçš„ã€‚ ä¸€ä¸ªç®€å•çš„ä¾‹å­å¦‚æœå°ä¼™ä¼´ä»¬åœ¨çœ‹åˆ°è¿™é‡Œè¿˜æœ‰ç‚¹ç¨€é‡Œç³Šæ¶‚çš„ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬æ‰¾ä¸ªä¾‹å­æ¥åŠ æ·±ä¸‹ç†è§£ã€‚ ç°åœ¨ï¼Œè®©æˆ‘ä»¬åŠªåŠ›å»ä¼°è®¡ä¸€ä¸ªæ ‡é‡éšæœºå¸¸æ•°ï¼Œä¾‹å¦‚æ¥è‡ªæŸä¸ªä¿¡å·æºçš„â€œç”µå‹è¯»æ•°â€ã€‚å‡è®¾å®ƒæœ‰ä¸€ä¸ªæ’å®šçš„ a V ç”µå‹ï¼Œä½†æ˜¯æˆ‘ä»¬è¯»æ•°ä¼šä¸å‡†ç¡®ï¼Œå¯èƒ½ä¼šè¯»é«˜äº†ï¼Œä¹Ÿæœ‰å¯èƒ½è¯»ä½äº†ã€‚æˆ‘ä»¬å‡è®¾æµ‹é‡å™ªå£°çš„çš„æ ‡å‡†å·®ä¸º 0.1 Vã€‚ ç°åœ¨æˆ‘ä»¬æ¥æ„å»ºæˆ‘ä»¬çš„æ¨¡å‹ï¼š å°±åƒæˆ‘ä¹‹å‰è¯´çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ–¹ç¨‹ç®€åŒ–æˆéå¸¸ç®€å•çš„å½¢å¼ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸€ç»´çš„ä¿¡å·çš„é—®é¢˜ï¼Œå› æ­¤æˆ‘ä»¬æ¨¡å‹ä¸­çš„æ¯ä¸ªç³»æ•°éƒ½æ˜¯æ•°å€¼ï¼Œè€Œä¸æ˜¯çŸ©é˜µã€‚ æˆ‘ä»¬å¹¶æ²¡æœ‰æ§åˆ¶ä¿¡å· u k u_k ukâ€‹ å› ä¸ºä¿¡å·æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œé‚£ä¹ˆå¸¸æ•° A å°±æ˜¯ 1ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»çŸ¥é“ä¸‹ä¸€ä¸ªå€¼ç­‰äºå…ˆå‰çš„å€¼ã€‚æˆ‘ä»¬å¾ˆå¹¸è¿ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬æœ‰ä¸€ä¸ªæ’å®šçš„å€¼ï¼Œä½†æ˜¯å³ä½¿å®ƒå…·æœ‰å…¶ä»–ä»»ä½•çº¿æ€§æ€§è´¨ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å°†å®ƒå‡è®¾æˆ 1. å€¼ H1,å› ä¸ºæˆ‘ä»¬çŸ¥é“æµ‹é‡å€¼æ˜¯ç”±çŠ¶æ€å€¼å’Œä¸€äº›å™ªå£°ç»„æˆçš„ã€‚ä½ å¾ˆå°‘ä¼šé‡åˆ°ç°å®ç”Ÿæ´»ä¸­ï¼ŒH ä¸ 1 ä¸ç›¸åŒçš„æƒ…å†µ æœ€åï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬å¾—åˆ°äº†ä¸‹é¢çš„æµ‹é‡å€¼ TIME (ms) 1 2 3 4 5 6 7 8 9 10 VALUE (V) 0.39 0.50 0.48 0.29 0.25 0.32 0.34 0.48 0.41 0.45 æˆ‘ä»¬åº”è¯¥ä»æŸå¤„å¼€å§‹ï¼Œæ¯”å¦‚è¯´ k0ã€‚æˆ‘ä»¬åº”è¯¥æ‰¾åˆ°æˆ–è€…å‡è®¾æŸä¸ªåˆå§‹çŠ¶æ€ã€‚è¿™é‡Œæˆ‘ä»¬ç»™å‡ºäº†ä¸€äº›åˆå§‹å€¼ã€‚æˆ‘ä»¬å‡è®¾ $X_00$ å¹¶ä¸” $P_01$ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸é€‰æ‹© $P_00$ å‘¢ï¼Ÿè¿™å¾ˆç®€å•ã€‚å¦‚æœæˆ‘ä»¬è¿™æ ·é€‰æ‹©ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€ç¯å¢ƒä¸­ä¸å­˜åœ¨å™ªå£°ï¼Œè€Œè¿™ä¸ªå‡è®¾å°†å¯¼è‡´åœ¨ k çŠ¶æ€ä¸‹ X çš„æ‰€æœ‰ç»“æœä¼°è®¡å€¼ä¸º 0ï¼ˆä¿ç•™åˆå§‹çŠ¶æ€ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¸å– $P_00$ æˆ‘ä»¬æ¥å†™æ—¶é—´æ›´æ–°å’Œæµ‹é‡æ›´æ–°æ–¹ç¨‹ ![è¿™é‡Œå†™å›¾ç‰‡æè¿°](https://img-blog.csdn.net/20180603164207725?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTA2NjUyMTY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70) æ¯ä¸€è½®è®¡ç®—çš„æ­¥éª¤ï¼š","tags":["clippings"],"categories":["2.ç¼–ç¨‹è¯­è¨€","ç»“æ„ç®—æ³•"]},{"title":"PIDç®—æ³•","path":"/2024/02/02/2-ç¼–ç¨‹è¯­è¨€-ç»“æ„ç®—æ³•-PIDç®—æ³•/","content":"ç®€ä»‹æ— äººæœºå¯ä»¥åœ¨ç©ºä¸­è¿›è¡Œæ™ºèƒ½è‡ªåŠ¨é£è¡Œï¼Œç›´å‡æœºèƒ½å¤Ÿæ‚¬åœåœ¨ç©ºä¸­ï¼Œè€Œåœ°é“åˆ™å¯ä»¥åœ¨æ¯ä¸ªç«™ç‚¹ç²¾å‡†åœ°åœä¸‹ã€‚è¿™å…¶ä¸­ï¼Œç«è½¦æŒ‰ç…§é¢„å®šé€Ÿåº¦è¡Œé©¶ï¼Œå¹³è¡¡è½¦ä¹Ÿèƒ½åšåˆ°ä¿æŒç›´ç«‹å¹³è¡¡ï¼Œæ‰€æœ‰è¿™äº›ç°ä»£æŠ€æœ¯çš„å®ç°èƒŒåï¼Œç¦»ä¸å¼€è‡ªåŠ¨æ§åˆ¶æŠ€æœ¯ã€‚è¿™ç§æŠ€æœ¯ä½¿å¾—æœºå™¨åœ¨å„è‡ªçš„é¢†åŸŸå˜å¾—æ›´åŠ æ™ºèƒ½ä¸é«˜æ•ˆã€‚ è‡ªåŠ¨æ§åˆ¶æŠ€æœ¯æ˜¯ 20 ä¸–çºªå‘å±•æœ€å¿«ã€å½±å“æœ€å¤§çš„æŠ€æœ¯ä¹‹ä¸€ï¼Œå®ƒå·²ç»æˆä¸º 21 ä¸–çºªæœ€é‡è¦çš„é«˜æŠ€æœ¯ä¹‹ä¸€ã€‚åœ¨ç§‘æŠ€ã€ç”Ÿäº§ã€å†›äº‹ã€ç®¡ç†ä¹ƒè‡³çš„æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œè‡ªåŠ¨æ§åˆ¶æŠ€æœ¯éƒ½æ‰®æ¼”ç€ä¸å¯æˆ–ç¼ºçš„è§’è‰²ã€‚ç®€å•æ¥è¯´ï¼Œè‡ªåŠ¨æ§åˆ¶æŠ€æœ¯æ˜¯æ§åˆ¶è®ºçš„æŠ€æœ¯å®ç°ï¼Œæ˜¯é€šè¿‡å…·å¤‡ç‰¹å®šæ§åˆ¶åŠŸèƒ½çš„è‡ªåŠ¨æ§åˆ¶ç³»ç»Ÿæ¥å®Œæˆç‰¹å®šçš„æ§åˆ¶ä»»åŠ¡ï¼Œç¡®ä¿æŸä¸ªè¿‡ç¨‹æŒ‰ç…§é¢„è®¾è¦æ±‚è¿è¡Œï¼Œä»è€Œå®ç°é¢„å®šç›®æ ‡ã€‚ è‡ªåŠ¨æ§åˆ¶åŸç†æ ¹æ®æ§åˆ¶æ–¹å¼çš„ä¸åŒï¼Œè‡ªåŠ¨æ§åˆ¶ç³»ç»Ÿä¸€èˆ¬åˆ†ä¸ºé—­ç¯æ§åˆ¶å’Œå¼€ç¯æ§åˆ¶ä¸¤ç§ç±»å‹ã€‚ é—­ç¯æ§åˆ¶é—­ç¯æ§åˆ¶ï¼Œåˆç§°è´Ÿåé¦ˆæ§åˆ¶ï¼Œå…¶å·¥ä½œåŸç†ä¸äººç±»æˆ–åŠ¨ç‰©çš„ç›®æ ‡å¯¼å‘è¡Œä¸ºç±»ä¼¼ã€‚é—­ç¯æ§åˆ¶ç³»ç»Ÿç”±å¤šä¸ªéƒ¨åˆ†æ„æˆï¼šä¼ æ„Ÿå™¨ã€æ§åˆ¶è£…ç½®å’Œæ‰§è¡Œæœºæ„ã€‚ä¼ æ„Ÿå™¨å¦‚åŒç”Ÿç‰©çš„æ„Ÿå®˜ï¼Œè´Ÿè´£æ£€æµ‹è¢«æ§å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ï¼ˆè¾“å‡ºé‡ï¼‰ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºç‰©ç†æˆ–ç”µä¿¡å·ä¼ è¾“ç»™æ§åˆ¶è£…ç½®ã€‚æ§åˆ¶è£…ç½®ç›¸å½“äºäººä½“çš„ç¥ç»ç³»ç»Ÿï¼Œå®ƒä¼šæ¯”è¾ƒè¢«æ§å¯¹è±¡çš„å®é™…çŠ¶æ€å’Œè®¾å®šç›®æ ‡ï¼Œä»¥ä¾¿ç”Ÿæˆä¸€ä¸ªæ§åˆ¶ä¿¡å·ï¼Œé€šè¿‡æ‰§è¡Œæœºæ„æ¥é©±åŠ¨è¢«æ§å¯¹è±¡ï¼Œè°ƒæ•´å…¶åˆ°è¾¾ç†æƒ³çŠ¶æ€ã€‚ åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé—­ç¯æ§åˆ¶çš„æ–¹æ³•å¤šç§å¤šæ ·ï¼Œæ¶µç›–äº†æœ€ä¼˜æ§åˆ¶ã€è‡ªé€‚åº”æ§åˆ¶ã€ä¸“å®¶æ§åˆ¶ã€æ¨¡ç³Šæ§åˆ¶ã€å®¹é”™æ§åˆ¶å’Œæ™ºèƒ½æ§åˆ¶ç­‰ï¼Œå¹¿æ³›åº”ç”¨äºç°ä»£å·¥ä¸šåŠç§‘æŠ€é¢†åŸŸã€‚ å¼€ç¯æ§åˆ¶å¼€ç¯æ§åˆ¶ï¼Œä¹Ÿè¢«ç§°ä¸ºç¨‹åºæ§åˆ¶ï¼Œæ˜¯ä¾æ®äº‹å…ˆè®¾å®šçš„ç¨‹åºä¾æ¬¡å‘å‡ºä¿¡å·ä»¥æ§åˆ¶å¯¹è±¡ã€‚æ ¹æ®ä¿¡å·äº§ç”Ÿçš„æ–¹å¼ï¼Œå¼€ç¯æ§åˆ¶å¯ä»¥åˆ†ä¸ºæ—¶é™æ§åˆ¶ã€æ¬¡åºæ§åˆ¶å’Œæ¡ä»¶æ§åˆ¶ã€‚ä» 20 ä¸–çºª 80 å¹´ä»£ä»¥æ¥ï¼Œåº”ç”¨å¾®ç”µå­æŠ€æœ¯ç”Ÿäº§çš„å¯ç¼–ç¨‹åºæ§åˆ¶å™¨å·²åœ¨å„ç±»å·¥ä¸šæ§åˆ¶ä¸­å¾—åˆ°å¹¿æ³›åº”ç”¨ï¼Œä¾‹å¦‚ç”µæ¢¯æ§åˆ¶ã€æ•°æ§æœºåºŠå’Œè‡ªæ¥æ°´å‚çš„è¿è¡Œç®¡ç†ï¼Œè¡¨ç°å‡ºæå¤§çš„çµæ´»æ€§å’Œæ•ˆç‡ã€‚ ç„¶è€Œï¼Œåœ¨å®é™…æƒ…å†µä¸­ï¼Œå¤§å¤šæ•°ç³»ç»Ÿéƒ½å€¾å‘äºä½¿ç”¨é—­ç¯æ§åˆ¶ï¼Œå› ä¸ºé—­ç¯æ§åˆ¶å…·å¤‡åé¦ˆè°ƒèŠ‚åŠŸèƒ½ï¼Œå¯ä»¥å®æ—¶ç›‘æµ‹ç³»ç»ŸçŠ¶æ€ï¼Œå¹¶åŸºäºåå·®è¿›è¡ŒåŠ¨æ€è°ƒæ•´ï¼Œç¡®ä¿çŠ¶æ€æœ€ç»ˆè¶‹è¿‘äºé¢„è®¾ç›®æ ‡ã€‚ PID æ§åˆ¶å™¨åŸç†PID æ§åˆ¶ç®—æ³•æ˜¯é—­ç¯æ§åˆ¶ä¸­ä¸€ç§åŸºç¡€è€Œé‡è¦çš„æ§åˆ¶ç®—æ³•ï¼Œå·²æœ‰è¿‘ 70 å¹´çš„ä½¿ç”¨å†å²ï¼Œå®ƒä»¥ç®€å•çš„ç»“æ„ã€è‰¯å¥½çš„ç¨³å®šæ€§å’Œå¯é çš„å·¥ä½œæ€§èƒ½ï¼Œå¹¿æ³›åº”ç”¨äºå·¥ä¸šæ§åˆ¶é¢†åŸŸã€‚å°¤å…¶åœ¨å¯¹ç³»ç»ŸåŠ¨æ€ç‰¹æ€§ä¸å®Œå…¨äº†è§£æˆ–è€…æ— æ³•æœ‰æ•ˆæµ‹é‡ç³»ç»Ÿå‚æ•°æ—¶ï¼ŒPID æ§åˆ¶æŠ€æœ¯å°¤ä¸ºé€‚ç”¨ã€‚ åœ¨ä¸€ä¸ªå•å›è·¯æ§åˆ¶ç³»ç»Ÿä¸­ï¼Œå—åˆ°å¤–ç•Œæ‰°åŠ¨çš„å½±å“æ—¶ï¼Œè¢«æ§å˜é‡çš„å€¼ä¼šåç¦»è®¾å®šå€¼ï¼Œäº§ç”Ÿè¯¯å·®ã€‚è‡ªåŠ¨æ§åˆ¶ç³»ç»Ÿä¼šå°†æ¥è‡ªä¼ æ„Ÿå™¨çš„æµ‹é‡å€¼ä¸è®¾å®šå€¼è¿›è¡Œæ¯”è¾ƒï¼Œäº§ç”Ÿçš„è¯¯å·®å€¼éšåé€šè¿‡æ¯”ä¾‹ã€ç§¯åˆ†å’Œå¾®åˆ†è¿ç®—ç”Ÿæˆä¸€ä¸ªæ ‡å‡†æ§åˆ¶ä¿¡å·ï¼Œè¿›è€Œè°ƒæ•´æ‰§è¡Œæœºæ„çš„åŠ¨ä½œã€‚PID æ§åˆ¶å™¨çš„æ ¸å¿ƒä¾¿æ˜¯åŸºäºè¯¯å·®ï¼Œé€šè¿‡æ¯”ä¾‹ï¼ˆPï¼‰ã€ç§¯åˆ†ï¼ˆIï¼‰ä¸å¾®åˆ†ï¼ˆDï¼‰ä¸‰è€…çš„è®¡ç®—ï¼Œå¾—åˆ°æ‰€éœ€çš„æ§åˆ¶é‡ã€‚å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼šPID æ§åˆ¶ç®—æ³•çš„æ ¸å¿ƒè¦ç´ å°±æ˜¯æ¯”ä¾‹ï¼ˆPï¼‰ã€ç§¯åˆ†ï¼ˆIï¼‰ã€å¾®åˆ†ï¼ˆDï¼‰ã€‚ â‘  æ¯”ä¾‹ï¼ˆPï¼‰æ§åˆ¶æ¯”ä¾‹æ§åˆ¶æ˜¯æœ€åŸºæœ¬çš„æ§åˆ¶æ–¹å¼ã€‚å…¶ç†å¿µæ˜¯ç³»ç»Ÿä¸€æ—¦å‘ç°åå·®ï¼Œæ¯”ä¾‹è°ƒèŠ‚å°±ä¼šç«‹å³åšå‡ºååº”ï¼ŒåŠªåŠ›å‡å°‘è¿™ç§åå·®ã€‚æ¯”ä¾‹æ§åˆ¶èƒ½å¿«é€Ÿè°ƒæ•´ï¼Œå‡å°è¯¯å·®ï¼Œä½†å¦‚æœæ¯”ä¾‹å‚æ•°è®¾ç½®è¿‡å¤§ï¼Œç³»ç»Ÿå°†å¯èƒ½å´©æºƒï¼Œç”šè‡³å˜å¾—ä¸ç¨³å®šã€‚å°½ç®¡æ¯”ä¾‹æ§åˆ¶å¸¦æ¥å¿«é€Ÿçš„å“åº”ï¼Œå¾€å¾€åœ¨ç¨³æ€æ¡ä»¶ä¸‹ä»ä¼šå­˜åœ¨è¯¯å·®ã€‚ â‘¡ ç§¯åˆ†ï¼ˆIï¼‰æ§åˆ¶ç§¯åˆ†æ§åˆ¶çš„è¾“å‡ºä¸è¯¯å·®ä¿¡å·åœ¨æ—¶é—´ä¸Šçš„ç§¯ç´¯é‡æˆæ­£æ¯”ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå³ä½¿è¯¯å·®éå¸¸å°ï¼Œç§¯åˆ†é¡¹ä¹Ÿä¼šé€æ¸å¢åŠ ï¼Œæ¨åŠ¨æ§åˆ¶å™¨çš„è¾“å‡ºä»¥ä½¿ç¨³æ€è¯¯å·®è¶‹è¿‘äºé›¶ã€‚ç„¶è€Œï¼Œç”±äºç§¯åˆ†çš„ç´¯ç§¯ç‰¹æ€§ï¼Œè°ƒèŠ‚é€Ÿåº¦å¯èƒ½å˜æ…¢ï¼Œè¿‡å¿«çš„å¢ç›Šå°†å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šã€‚å› æ­¤ï¼Œç§¯åˆ†é¡¹é€šå¸¸ä¸æ¯”ä¾‹é¡¹ç»“åˆä½¿ç”¨ï¼Œå½¢æˆ PI è°ƒèŠ‚å™¨ï¼Œä»¥å‡å°‘ç¨³æ€è¯¯å·®ã€‚ â‘¢ å¾®åˆ†ï¼ˆDï¼‰æ§åˆ¶å¾®åˆ†æ§åˆ¶åˆ™æ˜¯å°†æ§åˆ¶å™¨çš„è¾“å‡ºä¸è¯¯å·®ä¿¡å·çš„å˜åŒ–ç‡ï¼ˆå³è¯¯å·®çš„å˜åŒ–é€Ÿåº¦ï¼‰ç›¸è”ç³»ã€‚è‡ªåŠ¨æ§åˆ¶ç³»ç»Ÿåœ¨è°ƒæ•´çš„è¿‡ç¨‹ä¸­å¸¸å¸¸ä¼šäº§ç”ŸæŒ¯è¡ï¼Œå°¤å…¶æ˜¯åœ¨å­˜åœ¨è¾ƒå¤§å»¶è¿Ÿçš„æƒ…å½¢ä¸‹ï¼Œè¿™ç§ç°è±¡æ›´ä¸ºæ˜æ˜¾ã€‚å¾®åˆ†æ§åˆ¶å¯ä»¥æå‰é¢„æµ‹è¯¯å·®å˜åŒ–ï¼Œè¿›è€Œé¿å…è¿‡å¤§çš„è¶…è°ƒã€‚å› æ­¤ï¼Œå½“æ§åˆ¶å¯¹è±¡å…·æœ‰æ˜¾è‘—æƒ¯æ€§æˆ–æ»åç‰¹æ€§æ—¶ï¼Œæ¯”ä¾‹+å¾®åˆ†ï¼ˆPDï¼‰æ§åˆ¶å™¨å¯ä»¥æ”¹å–„ç³»ç»Ÿåœ¨è°ƒèŠ‚è¿‡ç¨‹ä¸­çš„åŠ¨æ€ç‰¹æ€§ã€‚ åœ¨è‡ªåŠ¨è°ƒèŠ‚ç³»ç»Ÿä¸­ï¼Œå¹²æ‰°åˆšå‡ºç°æ—¶å¾®åˆ†æ§åˆ¶ç«‹åˆ»èµ·æ•ˆï¼ŒåŒæ—¶æ¯”ä¾‹æ§åˆ¶ä¼šéšç€è¯¯å·®çš„åŠ å¤§è€Œå¢åŠ ä½œç”¨ï¼Œå¸®åŠ©ç³»ç»Ÿè¿…é€Ÿç¨³å®šã€‚ä¹‹åï¼Œç§¯åˆ†æ§åˆ¶ä¼šæ¸æ¸å¢å¼ºç›´è‡³æ¶ˆé™¤ä½™å·®ï¼Œå®ç°è®¾å®šå€¼ä¸Šçš„ç²¾ç¡®æ§åˆ¶ã€‚ åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒPID æ§åˆ¶ç®—æ³•æœ‰ä¸¤ç§è®¡ç®—æ–¹æ³•ï¼šä½ç½®å¼ç®—æ³•å’Œå¢é‡ç®—æ³•ã€‚å¢é‡ç®—æ³•ç›¸è¾ƒäºæ ‡å‡†ç®—æ³•ï¼Œæ ¹æ®ç›¸é‚»ä¸¤æ¬¡è¿ç®—çš„å·®å¼‚è®¡ç®—ã€‚ æ ‡å‡†çš„ä½ç½®å¼è®¡ç®—æ³•å…¬å¼ï¼š[P_{out}(t) K_p \\cdot e(t) + K_i \\cdot \\sum e(t) + K_d \\cdot (e(t) - e(t-1))] å¢é‡æ³•è®¡ç®—å…¬å¼ï¼š[\\Delta P P_{out}(t) - P_{out}(t-1) K_p \\cdot (e(t) - e(t-1)) + K_i \\cdot e(t) + K_d \\cdot (e(t) - 2e(t-1) + e(t-2))] PID æ§åˆ¶å™¨çš„å‚æ•°æ•´å®šPID æ§åˆ¶å™¨çš„å‚æ•°æ•´å®šæ˜¯æ§åˆ¶ç³»ç»Ÿè®¾è®¡çš„æ ¸å¿ƒå†…å®¹ï¼Œå¸¸è§æ–¹æ³•å¯ä»¥å¤§è‡´åˆ†ä¸ºç†è®ºè®¡ç®—æ•´å®šæ³•å’Œå·¥ç¨‹æ•´å®šæ³•ã€‚å‰è€…ä¾èµ–äºæ‰€è®¾è®¡ç³»ç»Ÿçš„æ•°å­¦æ¨¡å‹ï¼Œç»è¿‡ç†è®ºè®¡ç®—ç¡®å®šæ§åˆ¶å™¨çš„å‚æ•°ã€‚åè€…æ›´åŠ ä¾èµ–ç»éªŒï¼Œé€šå¸¸åœ¨å®é™…å·¥ç¨‹ä¸­è¿›è¡Œè¯•éªŒè°ƒæ•´ã€‚å¸¸ç”¨çš„å‚æ•°æ•´å®šæ–¹æ³•åŒ…æ‹¬ä¸´ç•Œæ¯”ä¾‹æ³•ã€ååº”æ›²çº¿æ³•å’Œè¡°å‡æ³•ã€‚ åœ¨çš„ç»éªŒä¸­ï¼ŒPID å‚æ•°çš„ç¡®å®šæ­¥éª¤å¦‚ä¸‹ï¼š ç¡®å®šæ¯”ä¾‹ç³»æ•° Kpå…ˆå°†ç§¯åˆ†é¡¹å’Œå¾®åˆ†é¡¹å»æ‰ï¼Œä½¿å…¶æˆä¸ºçº¯æ¯”ä¾‹è°ƒèŠ‚ã€‚è®¾å®šè¾“å…¥ä¸ºç³»ç»Ÿæœ€å¤§è¾“å‡ºçš„ 60% è‡³ 70%ï¼Œä» 0 å¼€å§‹é€æ¸æå‡ Kp ç›´è‡³è§‚å¯Ÿåˆ°ç³»ç»Ÿå¼€å§‹æŒ¯è¡ã€‚éšåé€æ­¥å‡å° Kpï¼Œç›´è‡³ç³»ç»Ÿæ¢å¤ç¨³å®šã€‚è®°å½•æ­¤æ—¶çš„ Kpï¼Œå¹¶å°†æœ€ç»ˆæ¯”ä¾‹ç³»æ•°è®¾å®šä¸ºå…¶ 70% è‡³ 80%ã€‚ ç¡®å®šç§¯åˆ†æ—¶é—´å¸¸æ•° TiKp ç¡®å®šåï¼Œè®¾å®šä¸€ä¸ªè¾ƒå¤§çš„ç§¯åˆ†æ—¶é—´å¸¸æ•° Tï¼Œç„¶åé€æ¸å‡å°åˆ°ç³»ç»Ÿå½¢æˆæŒ¯è¡ï¼Œå†é€æ­¥å¢å¤§ T ç›´è‡³æ¶ˆå¤±ã€‚æœ€ç»ˆè®°å½• Tï¼Œå¹¶å°† PID æ§åˆ¶å™¨çš„ Ti å€¼è®¾å®šä¸ºå½“å‰çš„ 150% è‡³ 180%ã€‚ ç¡®å®šå¾®åˆ†æ—¶é—´å¸¸æ•° Tdå¾®åˆ†æ—¶é—´å¸¸æ•° Td ä¸€èˆ¬è®¾ä¸º 0ï¼Œä½¿ PID è°ƒèŠ‚è½¬å˜ä¸º PI è°ƒèŠ‚ã€‚å¦‚æœéè¦è®¾å®šï¼Œå–ä¸æŒ¯è¡æ—¶çš„å€¼çš„ 30% å³å¯ã€‚ ç³»ç»Ÿç©ºè½½ã€å¸¦è½½è”è°ƒæœ€åè¿›è¡Œ PID å‚æ•°çš„å¾®è°ƒï¼Œç¡®ä¿å…¶æ»¡è¶³ç‰¹å®šæ€§èƒ½è¦æ±‚ã€‚ é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œè¯»è€…å¯ä»¥æ›´æ·±å…¥åœ°ç†è§£ PID æ§åˆ¶çš„å·¥ä½œåŸç†ã€‚æ¥ä¸‹æ¥ï¼Œå°†ä»¥ç”µæœºè½¬é€Ÿæ§åˆ¶ç³»ç»Ÿä¸ºä¾‹ï¼Œå½¢è±¡åœ°å±•ç¤º PID ä¸ºä»€ä¹ˆèƒ½ä½¿ç³»ç»Ÿè¾¾åˆ°è®¾å®šå€¼ã€‚ åœ¨ç”µæœºè½¬é€Ÿæ§åˆ¶ç³»ç»Ÿä¸­ï¼Œè¾“å…¥é‡æ˜¯ç›®æ ‡è®¾å®šå€¼ï¼ˆè®¾å®šè½¬é€Ÿï¼‰ï¼Œæµ‹é‡è£…ç½®å®æ—¶æµ‹é‡å½“å‰è½¬é€Ÿã€‚æ§åˆ¶å™¨ï¼ˆPID æ§åˆ¶å™¨ï¼‰æ ¹æ®åå·®è®¡ç®—æ§åˆ¶å€¼ï¼Œæœ€ç»ˆè¾“å‡ºç»™æ‰§è¡Œæœºæ„ã€‚åˆå§‹çŠ¶æ€ä¸‹ç”µæœºè½¬é€Ÿä¸ºé›¶ï¼Œè®¾å®šå€¼ä¸º 100 RPMï¼Œåˆ™æ§åˆ¶è¿‡ç¨‹æ˜¯ï¼š å½“å‰é€Ÿåº¦åå·®è®¡ç®—ä¸º (U_e(k) U_r(k) - U_d(k)) PID æ§åˆ¶å™¨è®¡ç®—æ¯”ä¾‹ã€ç§¯åˆ†å’Œå¾®åˆ†æ§åˆ¶å€¼ï¼Œåˆå¹¶å¾—å‡ºå½“å‰æ§åˆ¶å€¼ã€‚ è¯¥è¿‡ç¨‹ä¸æ–­é‡å¤ï¼Œæœ€ç»ˆç”µæœºåœ¨åŠ è´Ÿè½½æ—¶ä»ç„¶èƒ½å¤Ÿç¨³å®šåœ¨è®¾å®šå€¼ã€‚ æœ€åï¼Œå’±ä»¬å€Ÿç”¨å•æ‘†ç°è±¡è¿›ä¸€æ­¥è¯´æ˜ PID æ§åˆ¶çš„åŸåˆ™ã€‚æŠ¬é«˜å•æ‘†çš„å°çƒåæ”¾æ‰‹ï¼Œå°çƒä¼šå› é‡åŠ›è‡ªç„¶æ‘†åŠ¨æœ€ç»ˆé™æ­¢ã€‚è¿™ä¸ªç°è±¡åæ˜ äº†æ¯”ä¾‹éƒ¨åˆ†ï¼Œé‡åŠ›ç›¸å½“äºç³»ç»Ÿçš„â€æ¢å¤åŠ›â€ï¼Œå…¶å§‹ç»ˆæŒ‡å‘å¹³è¡¡ä½ç½®ã€‚åŒæ ·ï¼Œç©ºæ°”é˜»åŠ›çš„å­˜åœ¨ä½¿å¾—å°çƒæœ€ç»ˆå›åˆ°é™æ­¢çŠ¶æ€ï¼Œç±»ä¼¼äº PID ä¸­å¾®åˆ†éƒ¨åˆ†çš„ä½œç”¨ã€‚ç§¯åˆ†åœ¨æ­¤çš„è§’è‰²åˆ™ç›¸ä¼¼äºæŠµæ¶ˆå¤–ç•Œæ‰°åŠ¨çš„é¢å¤–åŠ›é‡ï¼Œç¡®ä¿ç³»ç»Ÿå‡†ç¡®å¹³è¡¡ã€‚ é€šè¿‡è¿™æ ·çš„å¯¹æ¯”ï¼Œè¯»è€…èƒ½å¤Ÿæ›´å½¢è±¡æ˜“æ‡‚åœ°æŠŠæ¡ PID æ§åˆ¶çš„æœ¬è´¨ä¸æœºåˆ¶ã€‚PID çš„ä¸‰ä¸ªéƒ¨åˆ†ç›¸äº’è¡¥å……ï¼Œç¡®ä¿æ§åˆ¶ç³»ç»Ÿç¨³å®šã€å¯é ã€‚ ä»£ç #includestdio.h#includestdlib.h//#includeMacianPID.h/**PID æ§åˆ¶å…¶å®æ˜¯å¯¹åå·®çš„æ§åˆ¶è¿‡ç¨‹ã€‚ *å¦‚æœåå·®ä¸º0,åˆ™æ¯”ä¾‹ç¯èŠ‚ä¸èµ·ä½œç”¨ï¼Œåªæœ‰å­˜åœ¨åå·®æ—¶ï¼Œæ¯”ä¾‹ç¯èŠ‚æ‰èµ·ä½œç”¨ã€‚ *ç§¯åˆ†ç¯èŠ‚ä¸»è¦æ˜¯ç”¨æ¥æ¶ˆé™¤é™å·®ï¼Œæ‰€è°“é™å·®ï¼Œå°±æ˜¯ç³»ç»Ÿç¨³å®šåè¾“å‡ºå€¼å’Œè®¾å®šå€¼ä¹‹é—´çš„å·®å€¼ï¼Œç§¯åˆ†ç¯èŠ‚å®é™…ä¸Šå°±æ˜¯åå·®ç´¯è®¡çš„è¿‡ç¨‹ï¼ŒæŠŠç´¯è®¡çš„è¯¯å·®åŠ åˆ°åŸæœ‰ç³»ç»Ÿä¸Šä»¥æŠµæ¶ˆç³»ç»Ÿé€ æˆçš„é™å·®ã€‚ *å¾®åˆ†ä¿¡å·åˆ™ååº”äº†åå·®ä¿¡å·çš„å˜åŒ–è§„å¾‹ï¼Œæˆ–è€…è¯´æ˜¯å˜åŒ–è¶‹åŠ¿ï¼Œæ ¹æ®åå·®ä¿¡å·çš„å˜åŒ–è¶‹åŠ¿æ¥è¿›è¡Œè¶…å‰è°ƒèŠ‚ï¼Œä»è€Œå¢åŠ äº†ç³»ç»Ÿçš„å¿«é€Ÿæ€§ã€‚ 1.æ¯”ä¾‹ç³»æ•° Kp çš„ä½œç”¨æ˜¯åŠ å¿«ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ï¼Œæé«˜ç³»ç»Ÿçš„è°ƒèŠ‚ç²¾åº¦ã€‚Kp è¶Šå¤§ï¼Œç³»ç»Ÿçš„å“åº”é€Ÿåº¦è¶Šå¿«ï¼Œç³»ç»Ÿçš„è°ƒèŠ‚ç²¾åº¦è¶Šé«˜ï¼Œä½†æ˜¯å®¹æ˜“äº§ç”Ÿè¶…è°ƒï¼Œç”šè‡³ä¼šä½¿ç³»ç»Ÿä¸ç¨³å®šã€‚Kp å–å€¼è¿‡å°ï¼Œåˆ™ä¼šé™ä½è°ƒèŠ‚ç²¾åº¦ï¼Œä½¿å“åº”é€Ÿåº¦ç¼“æ…¢ï¼Œä»è€Œå»¶é•¿è°ƒèŠ‚æ—¶é—´ï¼Œæ˜¯ç³»ç»Ÿé™æ€ã€åŠ¨æ€ç‰¹æ€§å˜å·®ï¼›2.ç§¯åˆ†ä½œç”¨ç³»æ•° Ki çš„ä½œç”¨æ˜¯æ¶ˆé™¤ç³»ç»Ÿçš„ç¨³æ€è¯¯å·®ã€‚Ki è¶Šå¤§ï¼Œç³»ç»Ÿçš„é™æ€è¯¯å·®æ¶ˆé™¤çš„è¶Šå¿«ï¼Œä½†æ˜¯ Ki è¿‡å¤§ï¼Œåœ¨å“åº”è¿‡ç¨‹çš„åˆæœŸä¼šäº§ç”Ÿç§¯åˆ†é¥±å’Œçš„ç°è±¡ï¼Œä»è€Œå¼•èµ·å“åº”è¿‡ç¨‹çš„è¾ƒå¤§è¶…è°ƒã€‚è‹¥ Ki è¿‡å°ï¼Œå°†ä½¿ç³»ç»Ÿé™æ€è¯¯å·®éš¾ä»¥æ¶ˆé™¤ï¼Œå½±å“ç³»ç»Ÿçš„è°ƒèŠ‚ç²¾åº¦ï¼›3.å¾®åˆ†ç³»æ•° Kd çš„ä½œç”¨æ˜¯æ”¹å–„ç³»ç»Ÿçš„åŠ¨æ€ç‰¹æ€§ï¼Œå…¶ä½œç”¨ä¸»è¦æ˜¯åœ¨å“åº”è¿‡ç¨‹ä¸­æŠ‘åˆ¶åå·®å‘ä»»ä½•æ–¹å‘çš„å˜åŒ–ï¼Œå¯¹åå·®å˜åŒ–è¿›è¡Œæå‰é¢„æŠ¥ã€‚ä½†æ˜¯ kd è¿‡å¤§ï¼Œä¼šä½¿å“åº”è¿‡ç¨‹æå‰åˆ¶åŠ¨ï¼Œä»è€Œå»¶é•¿è°ƒèŠ‚æ—¶é—´ï¼Œè€Œä¸”ä¼šé™ä½ç³»ç»Ÿçš„æŠ—å¹²æ‰°æ€§ã€‚ 12/16 å»é™¤å˜ç§¯åˆ†PIDæ§åˆ¶æ–¹å¼ å˜ç§¯åˆ† PID çš„åŸºæœ¬æ€æƒ³æ˜¯è®¾æ³•æ”¹å˜ç§¯åˆ†é¡¹çš„ç´¯åŠ é€Ÿåº¦ï¼Œä½¿å…¶ä¸åå·®å¤§å°ç›¸å¯¹åº”ï¼šåå·®è¶Šå¤§ï¼Œç§¯åˆ†è¶Šæ…¢; åå·®è¶Šå°ï¼Œç§¯åˆ†è¶Šå¿«*/struct _pid\tfloat SetParam; //å®šä¹‰è®¾å®šå€¼ float ActualParam;\t//å®šä¹‰å®é™…å€¼ float err; //å®šä¹‰åå·®å€¼\tfloat err_next; //å®šä¹‰ä¸Šä¸€ä¸ªåå·®å€¼ float err_last; //å®šä¹‰æœ€ä¸Šå‰çš„åå·®å€¼ float Kp,Ki,Kd; //å®šä¹‰æ¯”ä¾‹ã€ç§¯åˆ†ã€å¾®åˆ† float voltage; //æ§åˆ¶æ‰§è¡Œå™¨çš„å˜é‡ float integral; //å®šä¹‰ç§¯åˆ†å€¼ //ç§¯åˆ†åˆ†ç¦»\tå½“è¢«æ§é‡ä¸è®¾å®šå€¼åå·®è¾ƒå¤§æ—¶ï¼Œå–æ¶ˆç§¯åˆ†ä½œç”¨ã€‚å½“è¢«æ§é‡æ¥è¿‘è®¾å®šå€¼æ—¶ï¼Œå¼•å…¥ç§¯åˆ†æ§åˆ¶ï¼Œå·²æ¶ˆé™¤é™å·®ï¼Œæé«˜ç²¾åº¦ float err_max; //ç§¯åˆ†åˆ†ç¦» è¢«æ§é‡ä¸è®¾å®šåå·®æœ€å¤§å€¼ //æŠ—ç§¯åˆ†é¥±å’Œ æ§åˆ¶å™¨è¾“å‡ºç»§ç»­å¢å¤§ æ‰§è¡Œå™¨å¼€åº¦ä¸å¯èƒ½å¼€å¤§ æ­¤æ—¶è¾“å‡ºæ§åˆ¶é‡è¶…å‡ºæ­£å¸¸è¿è¡ŒèŒƒå›´è€Œè¿›å…¥é¥±å’ŒåŒº float umax; // æŠ—ç§¯åˆ†é¥±å’Œ æ§åˆ¶é‡æé™èŒƒå›´ float umin; // æŠ—ç§¯åˆ†é¥±å’Œ æ§åˆ¶é‡æé™èŒƒå›´ pid; void PID_init()\tpid.SetParam = 0.0;\tpid.ActualParam = 0.0;\tpid.err = 0.0;\tpid.err_next = 0.0; pid.err_last = 0.0;\tpid.integral = 0.0;\tpid.Kp = 0.200000;\tpid.Ki = 0.015000;\tpid.Kd = 0.200000;\tpid.err_max = 200;\tpid.umax = 400;\tpid.umin= -200; float PID_realize(float param)//\tfloat incrementParam ;\tint index; pid.SetParam = param;\tpid.err = pid.SetParam - pid.ActualParam; if( pid.ActualParam pid.umax ) //æŠ—ç§¯åˆ†é¥±å’Œ if(\tabs(pid.err) pid.err_max ) //ç§¯åˆ†åˆ†ç¦»è¿‡ç¨‹ index = 0; else index = 1; if( pid.err 0 ) pid.integral+=pid.err; else if( pid.ActualParam pid.umin ) if(\tabs(pid.err) pid.err_max ) index = 0; else index = 1; if(pid.err 0 ) pid.integral+=pid.err; else if(abs(pid.err) pid.err_max) //ç§¯åˆ†åˆ†ç¦»è¿‡ç¨‹ index=0; else index=1; pid.integral+=pid.err; //pid.integral/2 æ¢¯å½¢ç§¯åˆ†ï¼› æ¶ˆé™¤ä½™å·® æé«˜ç§¯åˆ†é¡¹è¿ç®—ç²¾åº¦ çŸ©å½¢ç§¯åˆ†æ”¹ä¸ºæ¢¯å½¢ç§¯åˆ† pid.voltage = pid.Kp*pid.err + index*pid.Ki*pid.integral/2 + pid.Kd*(pid.err-pid.err_last);\tpid.err_last = pid.err;\tpid.ActualParam = pid.voltage*1.0; //å¢é‡å¼PID ç»“æœä¸æœ€è¿‘ä¸‰æ¬¡çš„åå·®æœ‰å…³ æé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ //incrementParam = pid.Kp*(pid.err-pid.err_next) + pid.Ki*pid.err + pid.Kd*(pid.err-2*pid.err_next+pid.err_last); //pid.ActualParam += incrementParam;\t//pid.err_last = pid.err_next;\t//pid.err_next = pid.err; return pid.ActualParam;int main()\tPID_init();\tint count=0; while(count1000) float speed=PID_realize(200.0); printf(%f ,speed); count++; if(count%6 ==0) printf( ); return 0;","categories":["2.ç¼–ç¨‹è¯­è¨€","ç»“æ„ç®—æ³•"]},{"title":"åŸºç¡€ç®—æ³•","path":"/2024/02/01/2-ç¼–ç¨‹è¯­è¨€-ç»“æ„ç®—æ³•-åŸºç¡€ç®—æ³•/","content":"10 å¤§åŸºç¡€å®ç”¨ç®—æ³•åŠå…¶è®²è§£ç®—æ³•ä¸€ï¼šå¿«é€Ÿæ’åºç®—æ³•å¿«é€Ÿæ’åºæ˜¯ä¸€ç§é«˜æ•ˆçš„æ’åºç®—æ³•ï¼Œç”±è®¡ç®—æœºç§‘å­¦å®¶ä¸œå°¼Â·éœå°”å‘å±•è€Œæˆã€‚å…¶æ ¸å¿ƒç†å¿µæ˜¯åˆ©ç”¨åˆ†æ²»æ³•å°†å¾…æ’åºçš„æ•°ç»„åˆ†æˆå¤šä¸ªå­æ•°ç»„ï¼Œé€šè¿‡é€’å½’ä¸æ–­æ’åºã€‚å¿«é€Ÿæ’åºåœ¨å¹³å‡æƒ…å†µä¸‹ï¼Œæ’åº n ä¸ªé¡¹ç›®çš„æ¯”è¾ƒæ¬¡æ•°ä¸º ÎŸ(n log n)ï¼Œè€Œåœ¨æœ€åæƒ…å†µä¸‹åˆ™éœ€è¦ ÎŸ(nÂ²) æ¬¡æ¯”è¾ƒã€‚ä½†å…¶å®ï¼Œæœ€åæƒ…å†µå¹¶ä¸å¸¸è§ï¼Œå¿«é€Ÿæ’åºçš„æ€§èƒ½é€šå¸¸ä¼˜äºå…¶ä»–å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º ÎŸ(n log n) çš„ç®—æ³•ã€‚è¿™ä¸»è¦å½’å› äºå…¶å†…éƒ¨å¾ªç¯åœ¨è®¸å¤šè®¡ç®—æœºæ¶æ„ä¸Šå¯ä»¥è¢«æœ‰æ•ˆåœ°å®ç°ã€‚ ç®—æ³•æ­¥éª¤ï¼š é€‰æ‹©åŸºå‡†ï¼šä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ ä½œä¸ºåŸºå‡†ï¼ˆpivotï¼‰ã€‚ åˆ†åŒºæ“ä½œï¼šé‡æ–°æ’åºæ•°åˆ—ï¼Œç¡®ä¿æ‰€æœ‰æ¯”åŸºå‡†å°çš„å…ƒç´ åœ¨åŸºå‡†å‰é¢ï¼Œè€Œæ‰€æœ‰æ¯”åŸºå‡†å¤§çš„å…ƒç´ åœ¨åŸºå‡†åé¢ã€‚ é€’å½’æ’åºï¼šå¯¹åŸºå‡†å‰åä¸¤ä¸ªå­æ•°ç»„é€’å½’åº”ç”¨ä¸Šè¿°æ­¥éª¤ï¼Œç›´åˆ°æ¯ä¸ªå­æ•°ç»„çš„å¤§å°ä¸ºé›¶æˆ–ä¸€ã€‚ ä¾‹å¦‚ï¼Œç»™å®šæ•°ç»„ [3, 6, 8, 10, 1, 2, 1]ï¼Œé€‰æ‹© 3 ä½œä¸ºåŸºå‡†ï¼Œåˆ†åŒºåå¯èƒ½å¾—åˆ° [1, 2, 1, 3, 6, 8, 10]ï¼Œç„¶åé€’å½’æ’åº [1, 2, 1] å’Œ [6, 8, 10]ã€‚ ç®—æ³•äºŒï¼šå †æ’åºç®—æ³•å †æ’åºåˆ©ç”¨å †è¿™ä¸€æ•°æ®ç»“æ„è¿›è¡Œæ’åºã€‚å †æ˜¯è¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘å¹¶ä¸”éµå¾ªå †çš„æ€§è´¨ï¼Œå³æ¯ä¸ªçˆ¶èŠ‚ç‚¹çš„é”®å€¼æ€»æ˜¯å¤§äºæˆ–å°äºå…¶å­èŠ‚ç‚¹çš„é”®å€¼ã€‚å †æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸º ÎŸ(n log n)ï¼Œé€‚åˆåœ¨å¤§è§„æ¨¡æ•°æ®å¤„ç†æ—¶ä½¿ç”¨ã€‚ ç®—æ³•æ­¥éª¤ï¼š åˆ›å»ºå †ï¼šæ„å»ºä¸€ä¸ªæœ€å¤§å †ï¼ˆæˆ–è€…æœ€å°å †ï¼‰ã€‚ äº¤æ¢å…ƒç´ ï¼šå°†å †çš„æœ€å¤§å…ƒç´ ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰ä¸å †çš„æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ã€‚ è°ƒæ•´å †ï¼šå‡å°å †çš„å¤§å°å¹¶å¯¹æ ¹èŠ‚ç‚¹è¿›è¡Œä¸‹æ²‰æ“ä½œï¼Œç»´æŠ¤å †çš„æ€§è´¨ã€‚ é‡å¤ï¼šæŒç»­æ‰§è¡Œæ­¥éª¤ 2 å’Œæ­¥éª¤ 3ï¼Œç›´åˆ°å †çš„å¤§å°ä¸º 1ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥ç¡®ä¿æ‰€æœ‰å…ƒç´ æŒ‰é¡ºåºæ’åˆ—ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåˆå§‹å † [10, 9, 8, 7, 6] è¢«è°ƒæ•´ä¸º [9, 7, 8, 10, 6]ï¼Œå¹¶ç»§ç»­é€æ­¥å½¢æˆæœ‰åºæ•°ç»„ã€‚ ç®—æ³•ä¸‰ï¼šå½’å¹¶æ’åºå½’å¹¶æ’åºæ˜¯ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•ï¼Œå±äºåˆ†æ²»æ³•çš„å…¸å‹åº”ç”¨ï¼Œèƒ½é«˜æ•ˆå¤„ç†å¤§æ•°æ®é›†ã€‚ ç®—æ³•æ­¥éª¤ï¼š ç”³è¯·ç©ºé—´ï¼šä¸ºåˆå¹¶ååºåˆ—ç”³è¯·ä¸€ä¸ªå¤§å°ä¸ºä¸¤ä¸ªå·²æ’åºåºåˆ—ä¹‹å’Œçš„ç©ºé—´ã€‚ æŒ‡é’ˆåˆå§‹åŒ–ï¼šè®¾å®šä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘ä¸¤ä¸ªå·²æ’åºåºåˆ—çš„å¼€å§‹ä½ç½®ã€‚ åˆå¹¶æ“ä½œï¼šæ¯”è¾ƒä¸¤ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ ï¼Œé€‰æ‹©è¾ƒå°çš„å…ƒç´ æ”¾å…¥åˆå¹¶ç©ºé—´ï¼Œå¹¶ç§»åŠ¨ç›¸åº”æŒ‡é’ˆã€‚ é‡å¤æ¯”è¾ƒï¼šç»§ç»­ç›´åˆ°å…¶ä¸­ä¸€ä¸ªæŒ‡é’ˆåˆ°è¾¾åºåˆ—å°¾éƒ¨ã€‚ å¤åˆ¶å‰©ä½™å…ƒç´ ï¼šå°†å‰©ä¸‹çš„åºåˆ—å…¨éƒ¨å¤åˆ¶åˆ°åˆå¹¶åºåˆ—çš„å°¾éƒ¨ã€‚ ä¾‹å¦‚ï¼Œå°† [1, 3, 5] å’Œ [2, 4, 6] åˆå¹¶åˆ°åŒä¸€ç©ºé—´ï¼Œæœ€ç»ˆå½¢æˆæ’åºåçš„åºåˆ— [1, 2, 3, 4, 5, 6]ã€‚ ç®—æ³•å››ï¼šäºŒåˆ†æŸ¥æ‰¾ç®—æ³•äºŒåˆ†æŸ¥æ‰¾ç®—æ³•æ˜¯ä¸€ç§é«˜æ•ˆçš„æœç´¢ç®—æ³•ï¼Œåªé€‚ç”¨äºæœ‰åºæ•°ç»„ã€‚å…¶æ¯ä¸€æ­¥éƒ½å°†æœç´¢èŒƒå›´ç¼©å°ä¸€åŠï¼Œå…·æœ‰ ÎŸ(log n) çš„æ—¶é—´å¤æ‚åº¦ã€‚ ç®—æ³•æ­¥éª¤ï¼š ç¡®å®šä¸­é—´å…ƒç´ ï¼šä»æ•°ç»„ä¸­é€‰å–ä¸­é—´å…ƒç´ ï¼Œå¦‚æœè¯¥å…ƒç´ æ˜¯ç›®æ ‡ï¼Œåˆ™æœç´¢ç»“æŸã€‚ èŒƒå›´ç¼©å°ï¼šå¦‚æœç›®æ ‡å€¼ä¸ä¸­é—´å…ƒç´ ä¸ç¬¦ï¼Œåˆ™æ ¹æ®ç›®æ ‡å€¼ä¸ä¸­é—´å…ƒç´ çš„å¤§å°å…³ç³»ï¼Œé€‰æ‹©æ–°çš„æœç´¢èŒƒå›´ã€‚ é‡å¤æŸ¥æ‰¾ï¼šè¯¥è¿‡ç¨‹æŒç»­è¿›è¡Œï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡å€¼æˆ–èŒƒå›´ä¸ºç©ºã€‚ ä¾‹å¦‚ï¼Œåœ¨åˆ—è¡¨ [1, 2, 3, 4, 5] ä¸­æŸ¥æ‰¾ 3ï¼Œç¬¬ä¸€ä¸ªä¸­é—´å…ƒç´ æ˜¯ 3ï¼Œç›´æ¥æ‰¾åˆ°ç›®æ ‡ã€‚ ç®—æ³•äº”ï¼šBFPRT(çº¿æ€§æŸ¥æ‰¾ç®—æ³•)BFPRT ç®—æ³•ï¼Œä¹Ÿç§°ä¸ºâ€ä¸­ä½æ•°çš„ä¸­ä½æ•°â€ï¼Œç”¨äºé€‰æ‹©ç¬¬ k å¤§æˆ–ç¬¬ k å°çš„å…ƒç´ ï¼Œä¿è¯åœ¨æœ€åæƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦ä¸º ÎŸ(n)ã€‚ ç®—æ³•æ­¥éª¤ï¼š åˆ†ç»„ï¼šå°†å…ƒç´ åˆ†ä¸º n5 ç»„ï¼Œæ¯ç»„åŒ…å« 5 ä¸ªå…ƒç´ ã€‚ è®¡ç®—ä¸­ä½æ•°ï¼šå¯¹æ¯ç»„æ’åºå¹¶æå–ä¸­ä½æ•°ã€‚ é€’å½’æŸ¥æ‰¾ï¼šé€’å½’è°ƒç”¨é€‰æ‹©ç®—æ³•æ‰¾åˆ°ä¸­ä½æ•°çš„ä¸­ä½æ•°ï¼Œä»¥æ­¤ä½œä¸ºåŸºå‡†è¿›è¡Œåˆ†å‰²ã€‚ åˆ†å‰²æ•°ç»„ï¼šæ ¹æ®ä¸­ä½æ•°ï¼Œå°†æ•°ç»„åˆ†ä¸ºå°äºå’Œå¤§äºè¯¥ä¸­ä½æ•°çš„éƒ¨åˆ†ã€‚ é€’å½’æœç´¢ï¼šæ ¹æ® k çš„å€¼åˆ¤æ–­åœ¨å·¦è¾¹è¿˜æ˜¯å³è¾¹ç»§ç»­æœç´¢ï¼Œç›´åˆ°ç¡®å®š k-th å…ƒç´ ã€‚ æ¯”å¦‚ï¼Œåœ¨æ•°ç»„ [1, 5, 2, 6, 3] ä¸­é€‰æ‹©ç¬¬ k å¤§çš„å…ƒç´ æ—¶ï¼Œé€šè¿‡å¤šæ¬¡åˆ†å‰²å’Œé€‰æ‹©ä¸­ä½æ•°æ¥ç¼©å°èŒƒå›´ã€‚ ç®—æ³•å…­ï¼šDFSï¼ˆæ·±åº¦ä¼˜å…ˆæœç´¢ï¼‰æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰æ˜¯ä¸€ç§æœ‰æ•ˆçš„æ ‘å’Œå›¾éå†æ–¹æ³•ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°½å¯èƒ½æ·±åœ°æ¢ç´¢åˆ†æ”¯ï¼Œç›´åˆ°è®¿é—®åˆ°æ‰€æœ‰èŠ‚ç‚¹ã€‚ ç®—æ³•æ­¥éª¤ï¼š è®¿é—®èŠ‚ç‚¹ï¼šè®¿é—®èµ·å§‹èŠ‚ç‚¹ vã€‚ é€’å½’éå†ï¼šä»æœªè®¿é—®è¿‡çš„é‚»æ¥ç‚¹å‡ºå‘ï¼Œè¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†ã€‚ å›æº¯å¤„ç†ï¼šä¸€æ—¦æ•´ä¸ªåˆ†æ”¯è¢«éå†å®Œï¼Œå›æº¯å¹¶æ£€æŸ¥å…¶ä»–æœªè®¿é—®çš„èŠ‚ç‚¹ã€‚ ä¾‹å¦‚ï¼Œä»èŠ‚ç‚¹ A å¼€å§‹ï¼ŒDFS å¯èƒ½è®¿é—®é¡ºåºä¸º A - B - D - Cï¼Œç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹è¢«è®¿é—®ã€‚åŸºäºè¿™ä¸€æ¦‚å¿µï¼Œè¿˜å¯ç”Ÿæˆæ‹“æ‰‘æ’åºç”¨äºè§£å†³æœ€å¤§è·¯å¾„ç­‰é—®é¢˜ã€‚ ç®—æ³•ä¸ƒï¼šBFSï¼ˆå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼‰å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæ²¿ç€å›¾çš„å®½åº¦é€å±‚éå†æ‰€æœ‰èŠ‚ç‚¹ã€‚ä¸»è¦ç”¨äºå¯»æ‰¾æœ€çŸ­è·¯å¾„ã€‚ ç®—æ³•æ­¥éª¤ï¼š å…¥é˜Ÿæ ¹èŠ‚ç‚¹ï¼šå°†æ ¹èŠ‚ç‚¹æ”¾å…¥é˜Ÿåˆ—ã€‚ æ¢æŸ¥èŠ‚ç‚¹ï¼šå–å‡ºé˜Ÿå¤´èŠ‚ç‚¹ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºç›®æ ‡ã€‚å¦‚æœæ˜¯ï¼Œåˆ™ç»“æŸæœç´¢ã€‚ é˜Ÿåˆ—å¤„ç†ï¼šå°†å°šæœªè®¿é—®çš„å­èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—ã€‚ é‡å¤æ­¥éª¤ï¼šç›´è‡³é˜Ÿåˆ—ä¸ºç©ºï¼Œæˆ–è€…ç›®æ ‡è¢«æ‰¾åˆ°ã€‚ åœ¨ä¸€æ£µæ ‘ä¸­ï¼Œä» Node A å¼€å§‹ï¼ŒBFS å¯èƒ½ä¼šæŒ‰å±‚è®¿é—®æ¯ä¸€è¡Œçš„èŠ‚ç‚¹ï¼Œä¿è¯æ‰¾åˆ°æœ€çŸ­çš„è·¯å¾„ã€‚ ç®—æ³•å…«ï¼šDijkstra ç®—æ³•Dijkstra ç®—æ³•æ˜¯æ±‚è§£å•æºæœ€çŸ­è·¯å¾„çš„ç»å…¸ç®—æ³•ï¼Œé€‚ç”¨äºéè´Ÿæƒé‡çš„æœ‰å‘å›¾ã€‚ ç®—æ³•æ­¥éª¤ï¼š åˆå§‹åŒ–ï¼šè®¾å®šæºèŠ‚ç‚¹ S çš„è·ç¦»ä¸ºé›¶ï¼Œå…¶ä»–èŠ‚ç‚¹çš„è·ç¦»ä¸ºæ— ç©·å¤§ã€‚ é€‰æ‹©é¡¶ç‚¹ï¼šä»æœªè®¿é—®çš„èŠ‚ç‚¹ä¸­é€‰æ‹©è·ç¦»æœ€å°çš„èŠ‚ç‚¹ï¼Œæ ‡è®°ä¸ºå·²è®¿é—®ã€‚ æ›´æ–°è·ç¦»ï¼šå¯¹æ‰€æœ‰é‚»æ¥çš„èŠ‚ç‚¹ï¼Œè‹¥é€šè¿‡å½“å‰èŠ‚ç‚¹çš„è·ç¦»æ›´å°ï¼Œåˆ™æ›´æ–°å®ƒä»¬çš„è·ç¦»å€¼ã€‚ é‡å¤ï¼šæŒç»­è¿›è¡Œä¸Šè¿°æ­¥éª¤ç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹å‡å·²è®¿é—®ã€‚ ä¾‹å¦‚ï¼Œåœ¨æœ‰å‘å›¾ä¸­ï¼ŒDijkstra ç®—æ³•èƒ½å¤Ÿä»æºèŠ‚ç‚¹å‡ºå‘æ‰¾åˆ°å…¶ä½™æ‰€æœ‰èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ï¼Œå¸®åŠ©è§£å†³å¦‚è·¯ç”±é—®é¢˜ç­‰å¤šé¡¹åº”ç”¨ã€‚ ç®—æ³•ä¹ï¼šåŠ¨æ€è§„åˆ’ç®—æ³•åŠ¨æ€è§„åˆ’æ˜¯ä¸€ç§é€šè¿‡å°†åŸé—®é¢˜åˆ†è§£ä¸ºç®€å•çš„å­é—®é¢˜ï¼Œä»è€Œé«˜æ•ˆè§£å†³å¤æ‚é—®é¢˜çš„æ–¹æ³•ã€‚å¸¸ç”¨äºä¼˜åŒ–é—®é¢˜ä¸­ã€‚ ç®—æ³•æ­¥éª¤ï¼š æœ€ä¼˜å­ç»“æ„ï¼šç¡®å®šé—®é¢˜çš„æœ€ä¼˜è§£æ˜¯å¦åŒ…å«å­é—®é¢˜çš„æœ€ä¼˜è§£ã€‚ é‡å å­é—®é¢˜ï¼šè¯†åˆ«å‡ºç›¸åŒçš„å­é—®é¢˜ï¼Œä¿è¯æ¯ä¸ªå­é—®é¢˜åªè®¡ç®—ä¸€æ¬¡å¹¶å­˜å‚¨ç»“æœä»¥æé«˜æ•ˆç‡ã€‚ æ„å»ºé€’å½’å…³ç³»ï¼šé€šè¿‡é€’å½’æˆ–è¿­ä»£æ„å»ºç®—æ³•ä»¥è§£å†³å®é™…é—®é¢˜ã€‚ ä¾‹å¦‚ï¼ŒèƒŒåŒ…é—®é¢˜éœ€è¦åœ¨ç»™å®šç‰©å“ä¸­é€‰æ‹©ç»„åˆä»¥æœ€å¤§åŒ–ä»·å€¼ï¼Œåˆ©ç”¨åŠ¨æ€è§„åˆ’å¯ä»¥æ˜¾è‘—æé«˜è®¡ç®—æ•ˆç‡ã€‚ ç®—æ³•åï¼šæœ´ç´ è´å¶æ–¯åˆ†ç±»ç®—æ³•æœ´ç´ è´å¶æ–¯åˆ†ç±»ç®—æ³•åŸºäºè´å¶æ–¯å®šç†ï¼Œé€šè¿‡ç‰¹å¾ä¹‹é—´ç‹¬ç«‹æ€§çš„å‡è®¾æ¥å¤„ç†åˆ†ç±»é—®é¢˜ã€‚ ç®—æ³•æ­¥éª¤ï¼š ç‰¹å¾ç‹¬ç«‹ï¼šå‡è®¾ç‰¹å¾ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œå¯¹æ¯ä¸ªç‰¹å¾çš„æ¡ä»¶æ¦‚ç‡è¿›è¡Œä¼°è®¡ã€‚ è®¡ç®—æ¦‚ç‡ï¼šåŸºäºè®­ç»ƒæ•°æ®è®¡ç®—æ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡ã€‚ åˆ†ç±»å†³ç­–ï¼šé€šè¿‡è®¡ç®—åéªŒæ¦‚ç‡ï¼Œé€‰æ‹©å…·æœ‰æœ€é«˜æ¦‚ç‡çš„åˆ†ç±»ç»“æœã€‚ æœ´ç´ è´å¶æ–¯ç®—æ³•åœ¨è®¸å¤šå®é™…åº”ç”¨ä¸­ï¼ˆå¦‚æ–‡æœ¬åˆ†ç±»å’Œåƒåœ¾é‚®ä»¶è¿‡æ»¤ï¼‰è¡¨ç°è‰¯å¥½ï¼Œè™½å‡è®¾è¾ƒä¸ºç®€å•ï¼Œä½†å…¶æ•ˆç‡å’Œå‡†ç¡®æ€§å¾€å¾€ä»¤äººæƒŠè®¶ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","ç»“æ„ç®—æ³•"]},{"title":"æ•æ·å¼€å‘","path":"/2024/01/31/2-ç¼–ç¨‹è¯­è¨€-ç»“æ„ç®—æ³•-æ•æ·å¼€å‘/","content":"æ•æ·å¼€å‘æ¨¡å¼æ˜¯ä¸€ç§è½¯ä»¶å¼€å‘æ–¹æ³•è®ºï¼Œæ—¨åœ¨é€šè¿‡è¿­ä»£å’Œå¢é‡çš„æ–¹å¼äº¤ä»˜é«˜è´¨é‡çš„è½¯ä»¶äº§å“ã€‚å®ƒå¼ºè°ƒçµæ´»æ€§ã€å¿«é€Ÿå“åº”å˜åŒ–ã€å›¢é˜Ÿåä½œä»¥åŠæŒç»­äº¤ä»˜ã€‚æ•æ·å¼€å‘æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡çŸ­å‘¨æœŸçš„å¼€å‘è¿­ä»£ï¼ˆé€šå¸¸ç§°ä¸ºâ€è¿­ä»£â€æˆ–â€å†²åˆºâ€ï¼‰æ¥é€æ­¥æ„å»ºå’Œå®Œå–„äº§å“ï¼Œä»è€Œå¿«é€Ÿé€‚åº”éœ€æ±‚å˜åŒ–å¹¶æŒç»­å‘å®¢æˆ·äº¤ä»˜ä»·å€¼ã€‚ æ•æ·å¼€å‘çš„ä¸»è¦ç‰¹ç‚¹ è¿­ä»£ä¸å¢é‡å¼€å‘ï¼šé¡¹ç›®åˆ†ä¸ºå¤šä¸ªè¿­ä»£ï¼Œæ¯ä¸ªè¿­ä»£æŒç»­ 1 åˆ° 4 å‘¨ã€‚åœ¨æ¯ä¸ªè¿­ä»£ç»“æŸæ—¶ï¼Œå›¢é˜Ÿäº¤ä»˜ä¸€ä¸ªå¯å·¥ä½œçš„äº§å“å¢é‡ï¼Œé€æ­¥å®Œå–„äº§å“ã€‚ æŒç»­åé¦ˆä¸æ”¹è¿›ï¼šé€šè¿‡é¢‘ç¹çš„åé¦ˆå¾ªç¯ï¼Œå›¢é˜Ÿèƒ½å¤Ÿåœ¨æ¯ä¸ªè¿­ä»£ååæ€å¹¶æ”¹è¿›å¼€å‘è¿‡ç¨‹ï¼Œç¡®ä¿é¡¹ç›®æœç€æ­£ç¡®çš„æ–¹å‘å‘å±•ã€‚ æ‹¥æŠ±å˜åŒ–ï¼šæ•æ·å¼€å‘é¼“åŠ±å›¢é˜Ÿé€‚åº”éœ€æ±‚çš„å˜åŒ–ï¼Œè€Œä¸æ˜¯ä¸¥æ ¼æŒ‰ç…§æœ€åˆçš„è®¡åˆ’æ‰§è¡Œã€‚éœ€æ±‚çš„å˜åŒ–è¢«è§†ä¸ºå®¢æˆ·å¯¹å¸‚åœºçš„ååº”ï¼Œè€Œéå¯¹é¡¹ç›®çš„å¹²æ‰°ã€‚ è·¨èŒèƒ½å›¢é˜Ÿï¼šæ•æ·å›¢é˜Ÿé€šå¸¸æ˜¯å°å‹çš„ã€è·¨èŒèƒ½çš„ï¼ŒåŒ…å«å¼€å‘äººå‘˜ã€æµ‹è¯•äººå‘˜ã€è®¾è®¡å¸ˆå’Œå…¶ä»–ç›¸å…³è§’è‰²ã€‚è¿™ç§ç»“æ„æœ‰åŠ©äºå›¢é˜Ÿå¿«é€Ÿåšå‡ºå†³ç­–å¹¶é«˜æ•ˆåä½œã€‚ å®¢æˆ·å‚ä¸ï¼šå®¢æˆ·ï¼ˆæˆ–å…¶ä»£è¡¨ï¼‰æ˜¯æ•æ·å›¢é˜Ÿçš„é‡è¦æˆå‘˜ï¼ŒæŒç»­æä¾›åé¦ˆï¼Œç¡®ä¿å¼€å‘å‡ºçš„äº§å“ç¬¦åˆæœŸæœ›ã€‚ ç”¨æˆ·æ•…äº‹å’Œä»»åŠ¡ç®¡ç†ï¼šéœ€æ±‚é€šå¸¸è¢«åˆ†è§£ä¸ºç”¨æˆ·æ•…äº‹ï¼ˆUser Storiesï¼‰ï¼Œæ¯ä¸ªæ•…äº‹æè¿°äº†ç”¨æˆ·çš„æŸç§éœ€æ±‚æˆ–åŠŸèƒ½ã€‚å›¢é˜Ÿæ ¹æ®ç”¨æˆ·æ•…äº‹åˆ¶å®šä»»åŠ¡å¹¶è¿›è¡Œå¼€å‘ã€‚ çœ‹æ¿å’Œä»»åŠ¡æ¿ï¼šæ•æ·å›¢é˜Ÿå¸¸ä½¿ç”¨çœ‹æ¿ï¼ˆKanbanï¼‰æˆ–ä»»åŠ¡æ¿ï¼ˆTask Boardï¼‰æ¥è·Ÿè¸ªå·¥ä½œè¿›åº¦ï¼Œç¡®ä¿æ‰€æœ‰ä»»åŠ¡æŒ‰æ—¶å®Œæˆã€‚ å¸¸è§çš„æ•æ·å¼€å‘æ¡†æ¶ Scrumï¼šä¸€ç§å¹¿æ³›ä½¿ç”¨çš„æ•æ·æ¡†æ¶ï¼Œå¼ºè°ƒå›ºå®šé•¿åº¦çš„å†²åˆºã€æ¯æ—¥ç«™ä¼šã€å†²åˆºè¯„å®¡å’Œå›é¡¾ï¼Œä»¥åŠäº§å“è´Ÿè´£äººï¼ˆProduct Ownerï¼‰å’Œ Scrum Master çš„è§’è‰²ã€‚ çœ‹æ¿ï¼ˆKanbanï¼‰ï¼šä¸€ç§å¼ºè°ƒæŒç»­äº¤ä»˜å’Œæµç¨‹ä¼˜åŒ–çš„æ•æ·æ–¹æ³•ï¼Œé€šè¿‡å¯è§†åŒ–å·¥ä½œæµç¨‹å’Œé™åˆ¶åœ¨åˆ¶å“ï¼ˆWIPï¼‰æ¥æé«˜å›¢é˜Ÿæ•ˆç‡ã€‚ æé™ç¼–ç¨‹ï¼ˆXP, Extreme Programmingï¼‰ï¼šä¸€ç§å¼ºè°ƒå·¥ç¨‹å®è·µçš„æ•æ·æ–¹æ³•ï¼Œé‡ç‚¹åŒ…æ‹¬æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰ã€ç»“å¯¹ç¼–ç¨‹ã€æŒç»­é›†æˆç­‰ã€‚ æ•æ·å¼€å‘çš„ä¼˜ç‚¹ å¿«é€Ÿäº¤ä»˜ï¼šé€šè¿‡çŸ­å‘¨æœŸçš„è¿­ä»£ï¼Œæ•æ·å¼€å‘èƒ½å¤Ÿæ›´å¿«åœ°äº¤ä»˜å¯ç”¨çš„è½¯ä»¶äº§å“ã€‚ æ›´é«˜çš„çµæ´»æ€§ï¼šæ•æ·å¼€å‘èƒ½å¤Ÿå¿«é€Ÿå“åº”éœ€æ±‚å˜åŒ–ï¼Œé€‚åº”å¸‚åœºå’Œå®¢æˆ·çš„åŠ¨æ€éœ€æ±‚ã€‚ æé«˜å®¢æˆ·æ»¡æ„åº¦ï¼šé€šè¿‡æŒç»­äº¤ä»˜å’Œå®¢æˆ·å‚ä¸ï¼Œæ•æ·å¼€å‘èƒ½å¤Ÿæ›´å¥½åœ°æ»¡è¶³å®¢æˆ·éœ€æ±‚ã€‚ æŒç»­æ”¹è¿›ï¼šå›¢é˜Ÿé€šè¿‡å®šæœŸåæ€å’Œå›é¡¾ï¼Œä¸æ–­ä¼˜åŒ–å¼€å‘æµç¨‹å’Œäº§å“è´¨é‡ã€‚ æ•æ·å¼€å‘çš„æŒ‘æˆ˜ æ–‡åŒ–è½¬å˜ï¼šç»„ç»‡éœ€è¦é€‚åº”ä»ä¼ ç»Ÿç€‘å¸ƒå¼å¼€å‘å‘æ•æ·å¼€å‘çš„æ–‡åŒ–è½¬å˜ï¼Œè¿™å¯èƒ½éœ€è¦æ—¶é—´å’ŒåŠªåŠ›ã€‚ éœ€æ±‚ç®¡ç†ï¼šåœ¨æ•æ·å¼€å‘ä¸­ï¼Œéœ€æ±‚ç®¡ç†å¯èƒ½å˜å¾—å¤æ‚ï¼Œç‰¹åˆ«æ˜¯åœ¨é¢å¯¹é¢‘ç¹å˜åŒ–çš„æƒ…å†µä¸‹ã€‚ å›¢é˜Ÿåä½œï¼šæ•æ·å¼€å‘ä¾èµ–äºå›¢é˜Ÿçš„é«˜æ•ˆåä½œï¼Œä»»ä½•æ²Ÿé€šä¸ç•…æˆ–è§’è‰²ä¸æ˜ç¡®éƒ½ä¼šå½±å“é¡¹ç›®è¿›åº¦ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","ç»“æ„ç®—æ³•"]},{"title":"æœ€å°äºŒä¹˜æ³•","path":"/2024/01/30/2-ç¼–ç¨‹è¯­è¨€-ç»“æ„ç®—æ³•-æœ€å°äºŒä¹˜æ³•/","content":"æœ€å°äºŒä¹˜æ³•ï¼ˆåˆç§°æœ€å°å¹³æ–¹æ³•ï¼‰æ˜¯ä¸€ç§å¹¿æ³›åº”ç”¨äºæ•°æ®åˆ†æå’Œç»Ÿè®¡æ¨æ–­çš„æŠ€æœ¯ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æœ€å°åŒ–æ•°æ®ç‚¹ä¸æ‹Ÿåˆå‡½æ•°ä¹‹é—´çš„è¯¯å·®çš„å¹³æ–¹å’Œï¼Œæ¥å¯»æ‰¾æ•°æ®çš„æœ€ä½³åŒ¹é…ã€‚æ¢å¥è¯è¯´ï¼Œæœ€å°äºŒä¹˜æ³•èƒ½å¤Ÿæœ‰æ•ˆåœ°å¸®åŠ©ä»¬æ‰¾åˆ°ä¸€ä¸ªå‡½æ•°ï¼Œä½¿å¾—è¯¥å‡½æ•°ä¸ç»™å®šæ•°æ®ç‚¹çš„è·ç¦»å°½å¯èƒ½å°ã€‚è¿™ç§æ–¹æ³•ä¸ä»…é€‚ç”¨äºç®€å•çš„çº¿æ€§å›å½’ï¼Œä¹Ÿèƒ½å¤Ÿæ‰©å±•åº”ç”¨äºå¤šç§å½¢å¼çš„æ›²çº¿æ‹Ÿåˆã€‚ å‡è®¾å·²çŸ¥æœ‰ N ä¸ªç‚¹ï¼Œè®¾è¿™æ¡ç›´çº¿æ–¹ç¨‹ä¸ºï¼š y aÂ·x + b å…¶ä¸­ï¼Œa å’Œ b çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š åˆ©ç”¨æœ€å°äºŒä¹˜æ³•ï¼Œä»¬å¯ä»¥è¿…é€Ÿä¼°è®¡å‡ºæœªçŸ¥çš„æ•°æ®å€¼ï¼Œå¹¶ç¡®ä¿è¿™äº›ä¼°è®¡å€¼ä¸å®é™…è§‚æµ‹å€¼ä¹‹é—´çš„è¯¯å·®çš„å¹³æ–¹å’Œè¾¾åˆ°æœ€å°ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¬æ‹¥æœ‰ä¸€ç»„è§‚æµ‹ç‚¹ï¼Œè¿™äº›ç‚¹å¯èƒ½ä»£è¡¨æŸç§ç‰©ç†ç°è±¡æˆ–å®éªŒç»“æœã€‚é€šè¿‡åº”ç”¨æœ€å°äºŒä¹˜æ³•ï¼Œä»¬å¯ä»¥å¾—åˆ°ç¬¦åˆè¿™äº›ç‚¹è¶‹åŠ¿çš„ä¸€æ¡ç›´çº¿ï¼Œè¿™æ¡çº¿èƒ½æœ‰æ•ˆæ€»ç»“å’Œæè¿°è¿™äº›è§‚æµ‹æ•°æ®ã€‚ å‡è®¾ä»¬æœ‰ N ä¸ªæ•°æ®ç‚¹ï¼Œè¿™äº›æ•°æ®ç‚¹å¯èƒ½ä»£è¡¨å¤šç§æƒ…å†µï¼Œæ¯”å¦‚ä¸€ç»„å­¦ç”Ÿçš„è€ƒè¯•æˆç»©å’Œå­¦ä¹ æ—¶é—´ã€‚ä»¬çš„ç›®æ ‡æ˜¯æ‹Ÿåˆä¸€æ¡ç›´çº¿ï¼Œè¿™æ¡ç›´çº¿å¯ä»¥å¸®åŠ©ä»¬ç†è§£å­¦ä¹ æ—¶é—´ä¸è€ƒè¯•æˆç»©ä¹‹é—´çš„å…³ç³»ã€‚è¯¥ç›´çº¿å¯ä»¥ç”¨ä»¥ä¸‹æ•°å­¦è¡¨è¾¾å¼è¡¨ç¤ºï¼š [ y a \\cdot x + b ] è¿™é‡Œçš„ ( y ) è¡¨ç¤ºè€ƒè¯•æˆç»©ï¼Œ( x ) è¡¨ç¤ºå­¦ä¹ æ—¶é—´ï¼Œ ( a ) æ˜¯æ–œç‡ï¼Œåæ˜ äº†å­¦ä¹ æ—¶é—´æ¯å¢åŠ ä¸€ä¸ªå•ä½ï¼Œè€ƒè¯•æˆç»©çš„å˜åŒ–é‡ï¼›è€Œ ( b ) åˆ™æ˜¯æˆªè·ï¼Œè¡¨ç¤ºå½“å­¦ä¹ æ—¶é—´ä¸ºé›¶æ—¶ï¼Œé¢„è®¡çš„è€ƒè¯•æˆç»©ã€‚ ä¸ºäº†è®¡ç®—è¿™ä¸¤ä¸ªå‚æ•° ( a ) å’Œ ( b )ï¼Œä»¬éœ€è¦ä½¿ç”¨ä»¥ä¸‹å…¬å¼ï¼š æ–œç‡ ( a ) çš„è®¡ç®—å…¬å¼æ–œç‡ ( a ) çš„è®¡ç®—å…¬å¼ä¸ºï¼š [ a \\frac{N \\cdot \\Sigma (x_i \\cdot y_i) - \\Sigma x_i \\cdot \\Sigma y_i}{N \\cdot \\Sigma (x_i^2) - (\\Sigma x_i)^2} ] åœ¨è¿™ä¸ªå…¬å¼ä¸­ï¼š ( \\Sigma (x_i \\cdot y_i) ) æ˜¯æ‰€æœ‰æ•°æ®ç‚¹çš„ ( x ) å’Œ ( y ) å€¼ä¹˜ç§¯çš„æ€»å’Œã€‚ ( \\Sigma x_i ) æ˜¯æ‰€æœ‰ ( x ) å€¼çš„æ€»å’Œã€‚ ( \\Sigma y_i ) æ˜¯æ‰€æœ‰ ( y ) å€¼çš„æ€»å’Œã€‚ ( \\Sigma (x_i^2) ) æ˜¯æ‰€æœ‰ ( x ) å€¼çš„å¹³æ–¹çš„æ€»å’Œã€‚ ä¾‹å¦‚ï¼Œå‡è®¾ä»¬æœ‰ä»¥ä¸‹å­¦ä¹ æ—¶é—´ï¼ˆå°æ—¶ï¼‰å’Œç›¸åº”è€ƒè¯•æˆç»©ï¼ˆåˆ†æ•°ï¼‰çš„æ•°æ®ç‚¹ï¼š å­¦ä¹ æ—¶é—´ (x) è€ƒè¯•æˆç»© (y) 1 60 2 70 3 75 4 80 5 90 åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡è®¡ç®—ç›¸å…³çš„æ±‚å’Œï¼Œå¯ä»¥ä»£å…¥å…¬å¼è®¡ç®—å‡ºæ–œç‡ ( a )ã€‚ æˆªè· ( b ) çš„è®¡ç®—å…¬å¼æˆªè· ( b ) çš„è®¡ç®—å…¬å¼ä¸ºï¼š [ b \\frac{\\Sigma (x_i^2) \\cdot \\Sigma y_i - \\Sigma x_i \\cdot \\Sigma (x_i \\cdot y_i)}{N \\cdot \\Sigma (x_i^2) - (\\Sigma x_i)^2} ] è¿™ä¸€å…¬å¼åŒæ ·ä¾èµ–äºä¹‹å‰æåˆ°çš„æ±‚å’Œé¡¹ï¼Œç›®çš„æ˜¯æ‰¾å‡ºå½“å­¦ä¹ æ—¶é—´ä¸ºé›¶æ—¶ï¼Œè€ƒç”Ÿçš„æœŸæœ›æˆç»©ã€‚é€šè¿‡åŒæ ·çš„ä¾‹å­ï¼Œä»¬å¯ä»¥é€šè¿‡æ’å…¥æ•°æ®è®¡ç®—å‡ºæˆªè· ( b )ã€‚ è¿™äº›å…¬å¼æä¾›äº†ä¸€ç§æœ‰æ•ˆçš„æ–¹æ³•æ¥é‡åŒ–å˜é‡ä¹‹é—´çš„çº¿æ€§å…³ç³»ã€‚å¯¹äºå…¬å¼æ¨å¯¼çš„è¯¦ç»†è¿‡ç¨‹ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œç½‘ä¸Šæœ‰è®¸å¤šèµ„æºï¼Œå¦‚ç»Ÿè®¡å’Œæœºå™¨å­¦ä¹ æ•™æï¼Œæä¾›äº†ç›¸å…³è§£é‡Šå’Œç¤ºä¾‹ä»£ç ï¼Œæ–¹ä¾¿è¯»è€…è¿›ä¸€æ­¥æŸ¥é˜…ã€‚é€šè¿‡å®è·µå’Œç¤ºä¾‹ï¼Œå°†èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£çº¿æ€§å›å½’çš„åŸºæœ¬æ¦‚å¿µåŠå…¶åº”ç”¨ã€‚ ç®—æ³•ä»£ç ä»¥ä¸‹æ˜¯å®ç°æœ€å°äºŒä¹˜æ³•è¿›è¡Œç›´çº¿æ‹Ÿåˆçš„æ ¸å¿ƒä»£ç ï¼š //-------------------------------------------------------------//åŠŸèƒ½ : æœ€å°äºŒä¹˜æ³•ç›´çº¿æ‹Ÿåˆ y = aÂ·x + bï¼Œ è®¡ç®—ç³»æ•°a å’Œ b//å‚æ•° : x -- è¾ç…§åº¦çš„æ•°ç»„// y -- åŠŸç‡çš„æ•°ç»„// num -- æ•°ç»„åŒ…å«çš„å…ƒç´ ä¸ªæ•°ï¼Œx[]å’Œy[]çš„å…ƒç´ ä¸ªæ•°å¿…é¡»ç›¸ç­‰//è¿”å› : æ‹Ÿåˆè®¡ç®—æˆåŠŸè¿”å›true, æ‹Ÿåˆè®¡ç®—å¤±è´¥è¿”å›false//-------------------------------------------------------------bool leastSquareLinearFit(float x[], float y[], const int num, float a, float b) float sum_x2 = 0.0; float sum_y = 0.0; float sum_x = 0.0; float sum_xy = 0.0; try for (int i = 0; i num; ++i) sum_x2 += x[i] * x[i]; sum_y += y[i]; sum_x += x[i]; sum_xy += x[i] * y[i]; catch (...) return false; a = (num * sum_xy - sum_x * sum_y) / (num * sum_x2 - sum_x * sum_x); b = (sum_x2 * sum_y - sum_x * sum_xy) / (num * sum_x2 - sum_x * sum_x); return true; æ•°æ®æ ·æœ¬åœ¨è¿›è¡Œæ‹Ÿåˆè®¡ç®—æ—¶ï¼Œä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç¤ºä¾‹æ•°æ®ï¼š x: è¡¨ç¤ºè¾ç…§åº¦çš„æµ®ç‚¹æ•°æ•°ç»„ float x[96] = 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.46667,11.4667, 31.6, 52.7333, 80.3333, 116.333, 156.6, 199.4, 242.2, 283.4, 329.2, 379.333, 431.333,482.6, 541, 594.4, 643.533, 692.133, 736.267, 772.667, 810.133, 841.867, 868.2, 892.4, 917.667,939.8, 954.667, 969, 976.8, 983.4, 987.467, 994.933, 1023.67, 875.2, 873.933, 758.8, 678.2,515.867, 782.533, 908.8, 779.2, 831.4, 645.533, 734.067, 679.533, 610.267, 565.067, 512.467,462, 405.2, 354.133, 302, 247.8, 191.533, 140, 94.2667, 57.5333, 25.9333, 4, 0, 0, 0, 0, 0, 0, 0, 0,0, 0, 0; y: è¡¨ç¤ºåŠŸç‡çš„æµ®ç‚¹æ•°æ•°ç»„ float y[96] = 0.595, 0.595, 0.595, 0.595, 0.595, 0.595, 0.595, 0.595, 0.595, 0.595, 0.595,0.595, 0.595, 0.595, 0.595, 0.595, 0.595, 0.595, 0.595, 0.595, 0.595, 0.595, 0.595, 0.595, 0.595,0.595, 0.595, 0.595, 0.595, 0.595, 0.595, 0.595, 1.785, 2.57833, 3.927, 5.79233, 7.379, 9.48133,11.1473, 12.4167, 13.6627, 16.193701, 18.248699, 19.042, 19.042, 19.105301, 16.6383,17.240999, 14.631, 11.8217, 11.663, 12.155, 15.488, 21.859301, 19.32, 19.042, 19.6133, 21.105,22.9937, 20.827299, 23.858299, 23.0333, 19.2883, 15.6937, 21.5893, 23.802999, 20.518299,21.5893, 17.907301, 17.971001, 17.574301, 16.781, 15.5513, 12.3773, 10.2747, 8.60867,6.86333, 5.39567, 3.88767, 2.856, 2.142, 2.142, 0.952, 0.952, 0.952, 0.952, 0.952, 0.952, 0.952,0.952, 0.952, 0.952, 0.952, 0.952, 0.952, 0.952; è®¡ç®—ç»“æœåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡è°ƒç”¨ leastSquareLinearFit å‡½æ•°ï¼Œä»¬å¯ä»¥è®¡ç®—å‡ºæœ€ç»ˆç»“æœï¼š æ–œç‡ ( a ) è®¡ç®—ç»“æœä¸º 0.0215136 æˆªè· ( b ) è®¡ç®—ç»“æœä¸º 0.608488 è¿™äº›ç»“æœæ˜¾ç¤ºäº†è¾ç…§åº¦å˜åŒ–ä¸åŠŸç‡ä¹‹é—´çš„å…³ç³»ï¼Œä¸ºåç»­æ•°æ®åˆ†æå¥ å®šäº†åŸºç¡€ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","ç»“æ„ç®—æ³•"]},{"title":"æ ˆå’Œé˜Ÿåˆ—","path":"/2024/01/29/2-ç¼–ç¨‹è¯­è¨€-ç»“æ„ç®—æ³•-æ ˆå’Œé˜Ÿåˆ—/","content":"æ ˆï¼ˆstackï¼‰æ ˆæ˜¯é™å®šä»…åœ¨è¡¨çš„ä¸€ç«¯è¿›è¡Œæ’å…¥æˆ–åˆ é™¤æ“ä½œçš„çº¿æ€§è¡¨ã€‚ä»¬æŠŠå…è®¸æ’å…¥å’Œåˆ é™¤æ“ä½œçš„ä¸€ç«¯ç§°ä¸ºæ ˆé¡¶ï¼ˆtopï¼‰ï¼Œå¦ä¸€ç«¯ç§°ä¸ºæ ˆåº•ï¼ˆbottomï¼‰ã€‚ä¸å«ä»»ä½•æ•°æ®å…ƒç´ çš„æ ˆç§°ä¸ºç©ºæ ˆã€‚æ ˆåˆç§°ä¸ºâ€åè¿›å…ˆå‡ºï¼ˆLast In First Outï¼Œç®€ç§° LIFOï¼‰çš„çº¿æ€§è¡¨â€ï¼Œç®€ç§°ä¸º LIFO ç»“æ„ã€‚ æ ˆçš„æ’å…¥æ“ä½œï¼Œç§°ä¸ºè¿›æ ˆå…¥æ ˆå‹æ ˆã€‚æ ˆçš„åˆ é™¤æ“ä½œï¼Œç§°ä¸ºå‡ºæ ˆå¼¹æ ˆã€‚ æ ˆçš„é¡ºåºå­˜å‚¨ç»“æ„åŠå®ç° å®šä¹‰ typedef int data_t; //å®šä¹‰æ ˆä¸­æ•°æ®å…ƒç´ çš„æ•°æ®ç±»å‹typedef struct\tdate_t *data; //ç”¨æŒ‡é’ˆæŒ‡å‘æ ˆçš„å­˜å‚¨ç©ºé—´\tint maxlen; //å½“å‰æ ˆçš„æœ€å¤§å…ƒç´ ä¸ªæ•°\tint top; //æŒ‡å‘æ ˆé¡¶ä½ç½®ï¼ˆæ•°ç»„ä¸‹æ ‡ï¼‰çš„å˜é‡seqstack_t; //é¡ºåºæ ˆç±»å‹å®šä¹‰ åˆ›å»ºæ ˆ seqstack_t *CreateEmptyStack(int max_len)\tseqstack_t *stack;\tstack = (seqstack_t *)malloc(sizeof(seqstack_t));\tstack-data = (data_t *)malloc(sizeof(data_t)*max_len);\tstack-top = -1;\tstack-max_len = max_len;\treturn stack; æ‘§æ¯ä¸€ä¸ªæ ˆ void DestroyStack(seqstack_t *stack)\tif(stack != NULL) if(stack-data != NULL) free(stack-data); free(stack); æ¸…ç©ºä¸€ä¸ªæ ˆ void ClearStack(seqstack_t *stack)\tif(stack != NULL) stack-top = -1; åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©º int EmptyStack(seqstack_t *stack)\tif(stack == NULL) return -1;\treturn(stack-top == -1 ? 1 : 0); 5ã€åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºæ»¡ int FullStack(seqstack_t *stack)\tif(stack == NULL) return -1;\treturn(stack-top == (stack-max_len - 1) ? 1 : 0); d 6ã€è¿›æ ˆ int PushStack(seqstack_t *stack ,data_t x)\tif(FullStack(stack)) return -1;\telse stack-top++; stack-data[stack-top] = x; return 0; 7ã€å‡ºæ ˆ int PopStack(seqstack_t *stack,data_t *x)\tif(EmptySqstack(stack)) return -1;\telse *x = stack-data[stack-top]; stack-top--; return 0; 8ã€å–æ ˆé¡¶å…ƒç´  int GetTop(seqstack_t *stack,data_t *x)\tif(EmptyStack(stack)) return -1;\telse *x = stack-data[stack-top];\treturn 0; æ ˆçš„é“¾å¼å­˜å‚¨ç»“æ„åŠå®ç°è‹¥æ˜¯æ ˆä¸­å…ƒç´ çš„æ•°ç›®å˜åŒ–èŒƒå›´è¾ƒå¤§æˆ–ä¸æ¸…æ¥šæ ˆå…ƒç´ çš„æ•°ç›®ï¼Œå°±åº”è¯¥è€ƒè™‘ä½¿ç”¨é“¾å¼å­˜å‚¨ç»“æ„ã€‚äººä»¬å°†ç”¨é“¾å¼å­˜å‚¨ç»“æ„è¡¨ç¤ºçš„æ ˆç§°ä½œâ€é“¾æ ˆâ€ã€‚é“¾æ ˆé€šå¸¸ç”¨ä¸€ä¸ªæ— å¤´ç»“ç‚¹çš„å•é“¾è¡¨è¡¨ç¤ºã€‚æ’å…¥æ“ä½œå’Œåˆ é™¤æ“ä½œå‡åœ¨é“¾è¡¨å¤´éƒ¨è¿›è¡Œï¼Œé“¾è¡¨å°¾éƒ¨å°±æ˜¯æ ˆåº•ï¼Œæ ˆé¡¶æŒ‡é’ˆå°±æ˜¯å¤´æŒ‡é’ˆã€‚ å®šä¹‰ typedef int data_t;typedef struct node_t\tdata_t data; //æ•°æ®åŸŸ\tstruct node_t *next; //é“¾æ¥æŒ‡é’ˆåŸŸlinkstack_t; //é“¾æ ˆç±»å‹å®šä¹‰ åˆ›å»ºç©ºæ ˆï¼š linkstack_t *CreateLinkstack()\tlinkstack_t *top;\ttop = (linkstack_t *)malloc(sizeof(linkstack_t));\ttop-next = NULL;\treturn top; åˆ¤æ–­æ˜¯å¦ä¸ºç©ºæ ˆï¼š int EmptyStack(linkstack_t *top)\treturn (top-next == NULL ? 1 : 0); å…¥æ ˆ void PushStack(linkstack_t *top,data_t x)\tlinkstack_t *p;\tp = (linkstack_t *)malloc(sizeof(linkstack_t));\tp-data = x;\tp-next = top-next;\ttop-next = p;\treturn; å‡ºæ ˆ int PopStack(linkstack_t stack,data_t *x)\tif(stack-next == NULL || stack == NULL) return -1;\tlinkstack_t p;\tp = stack-next;\tstack-next = p-next;\tif(x != NULL) *x = p-data;\tfree(p);\treturn 0; linkstack#include stdio.h#include stdlib.h#include linkstack.hlinkstack_t *CreateEmptyLinkstack()\tlinkstack_t *s;\ts = (linkstack_t *)malloc(sizeof(linkstack_t));\ts-next = NULL;\treturn s;void DestroyLinkstack(linkstack_t *stack)\tif (stack) /* clear the stack linked list */ ClearLinkstack(stack); /* free the stack header */ free(stack);\tint EmptyLinkstack(linkstack_t *stack)\tif (stack) return ((NULL == stack-next) ? 1 : 0); else return -1;\tvoid ClearLinkstack(linkstack_t *stack)\tlinkstack_t *node; /* node to be removed */\tif (!stack) return;\twhile ( NULL != stack-next ) /* disconnect the one to be removed */ node = stack-next; stack-next = node-next; free(node); return;int PushStack(linkstack_t *stack, data_t x)\tlinkstack_t *node; /* node to be inserted */\tif (!stack) return -1;\tnode = (linkstack_t *)malloc(sizeof(linkstack_t));\tif (NULL == node) return -1; node-data = x;\t/* insert from the head of the link list * its cheaper to push from the head of the single-linked * list. */\tnode-next = stack-next;\tstack-next = node;\treturn 0;int PopStack(linkstack_t *stack, data_t *data)\tlinkstack_t *node; /* node to be removed */ if (!stack) return -1;\tif (!(stack-next)) return -1; /* stack is empty */\t/* pop from the head of the list */\tnode = stack-next;\tstack-next = node-next;\tif (data) *data = node-data; /* now we can free the node safely */\tfree(node); return 0;int GetTop(linkstack_t *stack, data_t *data)\tif (!stack) return -1;\tif (!(stack-next)) return -1; /* stack is empty */ if (data) *data = stack-next-data; return 0;void\tVisitStack(linkstack_t *stack)\tlinkstack_t *node; /* node to be iterated */ if (!stack) return;\t/* print from the base to the top */\tprintf(stack = );\tif (stack-next) /* list is not empty */ node = stack-next; while (NULL != node) printf(%d,, node-data); node = node-next; printf(\\b ); else printf( ); æ ˆçš„åº”ç”¨é€’å½’é€’å½’ï¼šå‡½æ•°åœ¨è‡ªèº«çš„å‡½æ•°ä½“å†…ç›´æ¥æˆ–é—´æ¥åœ°è°ƒç”¨è‡ªèº«ã€‚ ç¤ºä¾‹ï¼šé€’å½’æ³•æ±‚æ–æ³¢é‚£å¥‘æ•°åˆ— int Fbi(int i) if(i2) return i==0?0:1;\treturn Fbi(i-1)+Fbi(i-2);int main() int i;\tfor(i=0;i40;i++) printf(%d\\t,Fbi(i));\tprintf( );\treturn 0; è¦å®ç°é€’å½’ï¼Œå¿…è¦çš„ä¸¤ä¸ªæ¡ä»¶æ˜¯é€’å½’å‡ºå£å’Œé€’å½’é€»è¾‘ã€‚åœ¨ç¤ºä¾‹ç¨‹åºä¸­ï¼Œif(i2)å°±æ˜¯é€’å½’å‡ºå£ï¼Œè€Œ Fbi(i-1)+Fbi(i-2)å°±æ˜¯é€’å½’é€»è¾‘ã€‚å¯¹æ¯”é€’å½’ä»£ç å’Œéé€’å½’ï¼ˆè¿­ä»£ï¼‰ä»£ç ï¼Œä»¬å¯ä»¥çœ‹å‡ºé€’å½’å’Œè¿­ä»£çš„åŒºåˆ«ï¼šè¿­ä»£ä½¿ç”¨å¾ªç¯ç»“æ„ï¼Œè€Œé€’å½’ä½¿ç”¨åˆ†æ”¯ç»“æ„ åœ¨æŸäº›ç¨‹åºä¸­ï¼Œé€’å½’èƒ½ä½¿å¾—ç¨‹åºç»“æ„ç®€æ´æ¸…æ™°ï¼Œå®¹æ˜“ç†è§£ã€‚ä½†æ˜¯å¤§é‡çš„è°ƒç”¨é€’å½’å‡½æ•°ä¼šå»ºç«‹è®¸å¤šè¯¥å‡½æ•°çš„å‰¯æœ¬ï¼Œéœ€è¦å¤§é‡çš„å†…å­˜å­˜å‚¨ç©ºé—´ã€‚è€Œè¿­ä»£æ³•åˆ™æ— éœ€å¤§é‡çš„å­˜å‚¨ç©ºé—´ã€‚ è¦æƒ³å®ç°é€’å½’ï¼Œä»¬éœ€è¦æ˜ç™½é€’å½’çš„è¿‡ç¨‹æœ¬è´¨ä¸Šæ˜¯å‡½æ•°è¿”å›é¡ºåºæ˜¯å…¶è°ƒç”¨é¡ºåºçš„é€†åºï¼Œå³ï¼šå…ˆè¡Œè°ƒç”¨çš„å‡½æ•°ä¼šåœ¨åé¢è·å¾—è¿”å›å€¼ã€‚è¿™ç§å…ˆè¡Œå­˜å‚¨æ•°æ®ï¼Œå¹¶åœ¨ä¹‹åé€†åºæ¢å¤å¾—åˆ°æ•°æ®çš„è¿‡ç¨‹ï¼Œæ˜¾ç„¶å¾ˆç¬¦åˆæ ˆè¿™ç§æ•°æ®ç»“æ„ã€‚å› æ­¤ï¼Œç¼–è¯‘å™¨ä½¿ç”¨æ ˆæ¥å®ç°å‡½æ•°çš„é€’å½’ã€‚ åœ¨è°ƒç”¨é˜¶æ®µï¼Œå¯¹äºæ¯å±‚é€’å½’ï¼Œå‡½æ•°çš„å±€éƒ¨å˜é‡ã€å‚æ•°ã€è¿”å›åœ°å€éƒ½è¢«å‹å…¥æ ˆä¸­ï¼Œå†å»è°ƒç”¨ä¸‹æ¬¡é€’å½’ã€‚åœ¨è¿”å›é˜¶æ®µï¼Œä¾æ¬¡å¼¹å‡ºä½äºæ ˆé¡¶çš„å‡½æ•°ï¼Œè·å¾—è®¡ç®—ç»“æœã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆéœ€è¦â€é€’å½’å‡ºå£â€çš„åŸå› ï¼Œé€’å½’å‡ºå£å¯ä»¥çœ‹åšæ˜¯ä»å‹æ ˆåˆ°å¼¹æ ˆçš„çŠ¶æ€è½¬å˜å› ç´ ã€‚ åç¼€ï¼ˆé€†æ³¢å…°ï¼‰è¡¨ç¤ºæ³•ä¸­ç¼€è¡¨è¾¾å¼ï¼Œå³è¿ç®—ç¬¦ï¼ˆæ­¤å¤„ç‰¹æŒ‡ç®—æ•°è¿ç®—ç¬¦ï¼‰åœ¨æ“ä½œæ•°ä¸­é—´ã€‚9+(3-1)*3+10/2 åç¼€è¡¨ç¤ºæ³•ï¼Œä¹Ÿç§°ä¸ºé€†æ³¢å…°è¡¨ç¤ºæ³•ï¼Œå³è¿ç®—ç¬¦åœ¨ä¸¤ä¸ªæ“ä½œæ•°ä¹‹åå‡ºç° 9 3 1 - 3 * + 10 2 / + åç¼€è¡¨è¾¾å¼çš„ç®—æ³•è§„åˆ™ï¼šä»å·¦åˆ°å³éå†è¡¨è¾¾å¼ï¼Œè‹¥é‡åˆ°æ•°å­—åˆ™è¿›æ ˆï¼Œé‡åˆ°è¿ç®—ç¬¦åˆ™å¼¹å‡ºæ ˆé¡¶ä¸¤ä¸ªå…ƒç´ è¿›è¡Œè¿ç®—ï¼Œè®¡ç®—ç»“æœå†æ¬¡å‹æ ˆï¼Œæœ€åè®¡ç®—å¾—åˆ°çš„ç»“æœå°±æ˜¯æœ€ç»ˆç»“æœã€‚ ä»¬ä»¥ 9 3 1 - 3 * + 10 2 / + è¿›è¡Œè®²è§£ï¼ˆæ“ä½œæ•°å…¥æ ˆï¼‰ åˆå§‹åŒ–ä¸€ä¸ªç©ºæ ˆï¼Œæ­¤æ ˆç”¨äºå¯¹è¦è®¡ç®—çš„æ“ä½œæ•°çš„è¿›å‡ºåŠå­˜å‚¨ã€‚ 9ã€3ã€1 éƒ½æ˜¯æ•°å­—ï¼Œå› æ­¤ä¾æ¬¡å…¥æ ˆ æ¥ä¸‹æ¥æ˜¯-ï¼Œæ˜¯ç¬¦å·ï¼Œå¼¹å‡ºæ ˆé¡¶ä¸¤ä¸ªå…ƒç´ ä½œä¸ºæ“ä½œæ•°ï¼Œæ³¨æ„å…ˆå¼¹å‡ºçš„å…ƒç´ åœ¨ç¬¦å·å³ä¾§ï¼Œåå¼¹å‡ºçš„å…ƒç´ åœ¨ç¬¦å·å·¦ä¾§ï¼Œå³ 3 - 1ï¼Œå¾—åˆ°è®¡ç®—ç»“æœ 2ï¼Œå°† 2 å‹æ ˆã€‚ æ•°å­— 3 è¿›æ ˆ åé¢æ˜¯ *ï¼Œæ ˆé¡¶ä¸¤ä¸ªå…ƒç´ å¼¹æ ˆè¿›è¡Œè¿ç®— 2 * 3ï¼Œå¾—åˆ°ç»“æœ 6ï¼Œå†å‹å…¥æ ˆ åé¢æ˜¯+ï¼Œæ ˆé¡¶ä¸¤ä¸ªå…ƒç´ å¼¹æ ˆè¿›è¡Œè¿ç®— 9 + 6ï¼Œå¾—åˆ°ç»“æœ 15ï¼Œå†å‹å…¥æ ˆ æ•°å­— 10 å’Œ 2 è¿›æ ˆ åé¢æ˜¯ï¼Œæ ˆé¡¶ä¸¤ä¸ªå…ƒç´ å¼¹æ ˆè¿›è¡Œè¿ç®— 10 2ï¼Œå¾—åˆ°ç»“æœ 5ï¼Œå†å‹å…¥æ ˆ æœ€åä¸€ä¸ªç¬¦å·æ˜¯+ï¼Œæ ˆé¡¶ä¸¤ä¸ªå…ƒç´ å¼¹æ ˆè¿›è¡Œè¿ç®— 15 + 5ï¼Œå¾—åˆ°ç»“æœ 20 æœ€ç»ˆç»“æœæ˜¯ 20ï¼Œæ ˆå˜ä¸ºç©ºï¼Œç»“æŸè¿ç®—ã€‚ ä¸­ç¼€è¡¨è¾¾å¼è½¬åŒ–ä¸ºåç¼€è¡¨è¾¾å¼çš„è§„åˆ™ï¼šä»å·¦åˆ°å³éå†ä¸­ç¼€è¡¨è¾¾å¼çš„æ¯ä¸ªæ•°å­—å’Œç¬¦å·ï¼Œè‹¥æ˜¯æ•°å­—å°±è¾“å‡ºï¼Œå³æˆä¸ºåç¼€è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼›è‹¥æ˜¯ç¬¦å·åˆ™åˆ¤æ–­å…¶ä¸æ ˆé¡¶ç¬¦å·çš„ä¼˜å…ˆçº§ï¼Œæ˜¯å³æ‹¬å·æˆ–ä¼˜å…ˆçº§ä½äºæˆ–ç­‰äºæ ˆé¡¶ç¬¦å·çš„åˆ™æ ˆé¡¶å…ƒç´ ä¾æ¬¡å‡ºæ ˆå¹¶è¾“å‡ºï¼Œç›´è‡³é‡åˆ°ä¸€ä¸ªæ¯”å…¶ä¼˜å…ˆçº§ä½çš„è¿ç®—ç¬¦ä¸ºæ­¢ï¼Œå¹¶å°†å½“å‰ç¬¦å·è¿›æ ˆï¼Œä¸€ç›´åˆ°æœ€ç»ˆè¾“å‡ºåç¼€è¡¨è¾¾å¼ä¸ºæ­¢ã€‚ ä»¬ä»¥ 9+(3-1)*3+10/2------9 3 1 - 3 * + 10 2 / + è¿›è¡Œè®²è§£ï¼ˆè¿ç®—ç¬¦å…¥æ ˆï¼‰ åˆå§‹åŒ–ä¸€ä¸ªç©ºæ ˆï¼Œç”¨äºå¯¹ç¬¦å·è¿›å‡ºæ ˆä½¿ç”¨ã€‚ ç¬¬ä¸€ä¸ªæ•°å­—æ˜¯ 9ï¼Œè¾“å‡º 9ã€‚åé¢çš„ç¬¦å·+å…¥æ ˆã€‚ ç¬¬ä¸‰ä¸ªå­—ç¬¦æ˜¯ï¼ˆï¼Œä¾ç„¶æ˜¯ç¬¦å·ï¼Œå› å…¶æ˜¯å·¦æ‹¬å·è¿˜æœªé…å¯¹ï¼Œæ•…è¿›æ ˆã€‚ ç¬¬å››ä¸ªå­—ç¬¦æ˜¯æ•°å­— 3ï¼Œè¾“å‡ºï¼Œæ­¤æ—¶è¡¨è¾¾å¼ä¸º 9 3ï¼Œæ¥ç€ç¬¦å·-è¿›æ ˆã€‚ æ¥ä¸‹æ¥æ˜¯æ•°å­— 1ï¼Œè¾“å‡ºï¼Œæ­¤æ—¶è¡¨è¾¾å¼ä¸º 9 3 1ï¼Œåé¢æ˜¯ç¬¦å·ï¼‰ï¼Œæ­¤æ—¶ä»¬éœ€è¦æŠŠï¼ˆä¹‹å‰çš„æ‰€æœ‰å…ƒç´ éƒ½å‡ºæ ˆï¼Œç›´è‡³è¾“å‡ºï¼ˆä¸ºæ­¢ã€‚æ­¤æ—¶æ€»çš„è¡¨è¾¾å¼æ˜¯ 9 3 1 -ã€‚ ç´§æ¥ç€æ˜¯ç¬¦å· *ï¼Œå› ä¸ºæ­¤æ—¶çš„æ ˆé¡¶ç¬¦å·æ˜¯+ï¼Œä¼˜å…ˆçº§ä½äº *ï¼Œå› æ­¤ä¸è¾“å‡ºï¼Œ* è¿›æ ˆã€‚ç´§æ¥ç€æ˜¯æ•°å­— 3ï¼Œè¾“å‡ºï¼Œæ€»è¡¨è¾¾å¼ä¸º 9 3 1 â€“ 3. ä¹‹åæ˜¯ç¬¦å·+ï¼Œæ­¤æ—¶æ ˆé¡¶å…ƒç´ æ˜¯ *ï¼Œæ¯”+ä¼˜å…ˆçº§é«˜ï¼Œå› æ­¤æ ˆä¸­å…ƒç´ å‡ºæ ˆå¹¶è¾“å‡ºï¼ˆå› ä¸ºæ²¡æœ‰æ¯”+æ›´ä½ä¼˜å…ˆçº§çš„ç¬¦å·ï¼Œæ‰€ä»¥å…¨éƒ¨å‡ºæ ˆï¼‰ï¼Œæ€»è¾“å‡ºè¡¨è¾¾å¼ä¸º 9 3 1 â€“ 3 * +ã€‚ç„¶åå°†è¿™ä¸ªç¬¦å·+è¿›æ ˆã€‚ ç´§æ¥ç€è¾“å‡ºæ•°å­— 10ï¼Œæ€»è¡¨è¾¾å¼ä¸º 9 3 1 â€“ 3 * + 10ã€‚ä¹‹åæ˜¯ç¬¦å· /ï¼Œæ‰€ä»¥ / è¿›æ ˆã€‚ æœ€åä¸€ä¸ªæ•°å­—ä¸º 2ï¼Œæ­¤æ—¶æ€»è¡¨è¾¾å¼ä¸º 9 3 1 â€“ 3 * + 10 2ã€‚ å› å·²åˆ°æœ€åï¼Œæ‰€ä»¥å°†æ ˆä¸­ç¬¦å·å…¨éƒ¨å‡ºæ ˆã€‚æœ€ç»ˆè·å¾—çš„åç¼€è¡¨è¾¾å¼ä¸º 9 3 1 â€“ 3 * + 10 2 / +ã€‚ é˜Ÿåˆ—é˜Ÿåˆ—æ˜¯åªå…è®¸åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥æ“ä½œï¼Œè€Œåœ¨å¦ä¸€ç«¯è¿›è¡Œåˆ é™¤æ“ä½œçš„çº¿æ€§è¡¨ã€‚é˜Ÿåˆ—æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºï¼ˆFirst In First Outï¼‰çš„çº¿æ€§è¡¨ï¼Œç®€ç§° FIFOã€‚å…è®¸æ’å…¥æ“ä½œçš„ä¸€ç«¯ç§°ä¸ºé˜Ÿå°¾ï¼Œå…è®¸åˆ é™¤æ“ä½œçš„ä¸€ç«¯ç§°ä¸ºé˜Ÿå¤´ã€‚ é˜Ÿåˆ—ä½œä¸ºç‰¹æ®Šçš„çº¿æ€§è¡¨ï¼Œæœ‰é¡ºåºé˜Ÿåˆ—å’Œé“¾å¼é˜Ÿåˆ—ä¸¤ç§å½¢å¼ã€‚ é˜Ÿåˆ—çš„é¡ºåºå­˜å‚¨ç»“æ„åŠå®ç°å¦‚æœä»¬è¦å»ºç«‹å…ƒç´ ä¸ªæ•°ä¸º n çš„é˜Ÿåˆ—ï¼Œåˆ™éœ€è¦å»ºç«‹ä¸€ä¸ªæ•°ç»„é•¿åº¦ä¸å°äº n çš„æ•°ç»„ï¼Œæ•°ç»„ä¸‹æ ‡ä¸º 0 çš„ä¸ºé˜Ÿå¤´ï¼Œå½“æœ€å¤§ä¸‹æ ‡çš„ä¸ºé˜Ÿå°¾ã€‚è‹¥æœ‰å…ƒç´ è¦å…¥é˜Ÿï¼Œåˆ™åªéœ€å°†å…¶å­˜å‚¨åœ¨ç¬¬ n+1 ä¸ªä½ç½®å³å¯ã€‚è€Œè‹¥æƒ³å‡ºé˜Ÿï¼Œåˆ™åˆ é™¤äº†ä¸‹æ ‡ä¸º 0 çš„å…ƒç´ åï¼Œæ‰€æœ‰åœ¨å…¶åçš„å…ƒç´ éƒ½éœ€è¦å‘å‰ç§»åŠ¨ä¸€æ ¼ï¼Œå³ä¿æŒä¸‹æ ‡ä¸º 0 çš„å…ƒç´ ä¸ºé˜Ÿå¤´ã€‚ä½†è¿™æ ·åšæ˜¾ç„¶æµªè´¹äº†å¤§é‡æ—¶é—´ã€‚ è§£å†³è¯¥é—®é¢˜çš„æ–¹æ³•å°±æ˜¯ä¸å†é™åˆ¶ä¸‹æ ‡ä¸º 0 çš„å…ƒç´ ä¸ºé˜Ÿå¤´ï¼Œæ¯æ¬¡å‡ºé˜Ÿåï¼Œé˜Ÿå¤´è‡ªåŠ¨å˜æˆå½“å‰æ•°ç»„ä¸‹æ ‡æœ€å°çš„å…ƒç´ å³å¯ã€‚è¿™æ ·å°±æ— éœ€æ‰€æœ‰å…ƒç´ å‘å‰ç§»åŠ¨ã€‚ä½†æ˜¯ï¼Œè‹¥å¦‚æ­¤åšï¼Œåˆ™ä¼šé€ æˆå¤§é‡çš„å·²å‡ºé˜Ÿçš„å…ƒç´ çš„å­˜å‚¨ç©ºé—´æµªè´¹ã€‚è€Œä¸”ï¼Œè‹¥æ­¤æ—¶å…¥é˜Ÿå…ƒç´ å·²ç»å¤§äº nï¼Œåˆ™ä»¬éœ€è¦æ›´å¤§çš„å­˜å‚¨ç©ºé—´æ‰è¡Œï¼Œä½†é˜Ÿå¤´ä½ç½®æœ‰å¤§é‡ç©ºé—´æœªåˆ©ç”¨ï¼Œç©ºé—´æµªè´¹ä¸¥é‡ã€‚ è§£å†³ä»¥ä¸Šé—®é¢˜çš„æ–¹æ³•å°±æ˜¯å¦‚æœåé¢æ»¡äº†ï¼Œåˆ™ä»¬å°±ä»å¤´å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯å°†é˜Ÿåˆ—åšæˆå¤´å°¾ç›¸æ¥çš„å¾ªç¯ã€‚ä»¬æŠŠè¿™ç§å¤´å°¾ç›¸æ¥çš„é¡ºåºå­˜å‚¨ç»“æ„çš„é˜Ÿåˆ—ç§°ä¸ºå¾ªç¯é˜Ÿåˆ—ã€‚ åœ¨å¾ªç¯é˜Ÿåˆ—ä¸­ï¼Œå½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œæœ‰ front=rearï¼Œè€Œå½“æ‰€æœ‰é˜Ÿåˆ—ç©ºé—´å…¨å æ»¡æ—¶ï¼Œä¹Ÿæœ‰ front=rearã€‚ä¸ºäº†åŒºåˆ«è¿™ä¸¤ç§æƒ…å†µï¼Œè§„å®šå¾ªç¯é˜Ÿåˆ—æœ€å¤šåªèƒ½æœ‰ MaxSize-1 ä¸ªé˜Ÿåˆ—å…ƒç´ ï¼Œå½“å¾ªç¯é˜Ÿåˆ—ä¸­åªå‰©ä¸‹ä¸€ä¸ªç©ºå­˜å‚¨å•å…ƒæ—¶ï¼Œé˜Ÿåˆ—å°±å·²ç»æ»¡äº†ã€‚å› æ­¤ï¼Œé˜Ÿåˆ—åˆ¤ç©ºçš„æ¡ä»¶æ—¶ front=rearï¼Œè€Œé˜Ÿåˆ—åˆ¤æ»¡çš„æ¡ä»¶æ—¶ front=ï¼ˆrear+1ï¼‰%MaxSizeã€‚ é˜Ÿå¤´æŒ‡é’ˆ frontï¼ŒæŒ‡å‘é˜Ÿå¤´å…ƒç´ çš„ä½ç½®çš„å‰ä¸€ä¸ªä½ç½®ã€‚å³æŒ‡å‘é¢„ç•™çš„ä½ç½®ï¼› é˜Ÿå°¾æŒ‡é’ˆ rearï¼ŒæŒ‡å‘é˜Ÿå°¾å…ƒç´ çš„ä½ç½®ï¼› å…¥é˜Ÿï¼š rear = (rear + 1) % N (maxsize)ï¼Œç„¶åå…ƒç´ æ”¾å…¥é˜Ÿå°¾ rear æ‰€æŒ‡å‘çš„ä½ç½®ï¼› å‡ºé˜Ÿï¼š front = (front + 1) % Nï¼Œç„¶åå–å‡ºé˜Ÿå¤´æŒ‡é’ˆ front æ‰€æŒ‡å‘çš„å…ƒç´ ï¼› é˜Ÿç©ºï¼š front == rear; é˜Ÿæ»¡ï¼š (rear + 1) % N == front, N ä¸ºæ•°ç»„çš„å…ƒç´ ä¸ªæ•°ï¼› ä¸ºäº†åŒºåˆ«ç©ºé˜Ÿå’Œæ»¡é˜Ÿï¼Œæ»¡é˜Ÿå…ƒç´ ä¸ªæ•°æ¯”æ•°ç»„å…ƒç´ ä¸ªæ•°å°‘ä¸€ä¸ªã€‚ è¿™æ ·ï¼Œä»¬å°±éœ€è¦ä¸¤ä¸ªæŒ‡ç¤ºå…¶é˜Ÿå¤´ï¼ˆfrontï¼‰å’Œé˜Ÿå°¾ï¼ˆrearï¼‰çš„ä¸‹æ ‡å˜é‡ã€‚ #define N 64 //é˜Ÿåˆ—ä¸­æ•°æ®å…ƒç´ çš„æ•°æ®ç±»å‹typedef int data_t;typedef struct\tdata_t data[N]; //ç”¨æ•°ç»„ä½œä¸ºé˜Ÿåˆ—çš„å‚¨å­˜ç©ºé—´\tint front,rear; //æŒ‡ç¤ºé˜Ÿå¤´ä½ç½®å’Œé˜Ÿå°¾ä½ç½®çš„æŒ‡é’ˆsequeue_t; å½“ (rear+1)%QueueSize==front æ—¶ï¼Œæ­¤æ—¶é˜Ÿå°¾çš„ä¸‹ä¸ªä½ç½®å°±æ˜¯é˜Ÿå¤´ï¼Œåˆ™è¯¥é˜Ÿåˆ—ä¸ºæ»¡é˜Ÿåˆ—ã€‚æ³¨æ„ rear çš„ä½ç½®ä¸æ˜¯é˜Ÿå°¾å…ƒç´ çš„ä½ç½®ï¼Œè€Œæ˜¯é˜Ÿå°¾å…ƒç´ çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œå³å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œé˜Ÿåˆ—ä¸­è¿˜æœ‰ä¸€ä¸ªç©ºé—²å­˜å‚¨ç©ºé—´ï¼Œä½†ä»¬è§„å®šè¯¥çŠ¶æ€ä¸‹å°±æ˜¯æ»¡é˜Ÿåˆ—ã€‚ é‚£ä¹ˆï¼Œå®šä¹‰å¥½é˜Ÿåˆ—çš„çš„é˜Ÿå¤´å’Œé˜Ÿå°¾ä½ç½®ï¼Œä»¬æ¥è€ƒè™‘æ€æ ·è®¡ç®—é˜Ÿåˆ—é•¿åº¦ã€‚ å½“ rearfront æ—¶ï¼Œè¡¨ç¤ºé˜Ÿå°¾åœ¨é˜Ÿå¤´å³è¾¹ï¼Œæ­¤æ—¶é˜Ÿåˆ—é•¿åº¦ä¸º rear-frontï¼› å½“ rearfront æ—¶ï¼Œè¡¨ç¤ºé˜Ÿå°¾åœ¨é˜Ÿå‹å·¦è¾¹ï¼Œæ­¤æ—¶è®¡ç®—é˜Ÿåˆ—é•¿åº¦åº”åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå³ rear ä¸€éƒ¨åˆ†ï¼ŒQueueSize-front ä¸€éƒ¨åˆ†ï¼Œæ€»ä½“é•¿åº¦ä¸º rear-front+QueueSizeã€‚ é€šç”¨è®¡ç®—é˜Ÿåˆ—é•¿åº¦çš„å…¬å¼æ˜¯ length=(rear-front+QueueSize)%QueueSize åˆ›å»ºç©ºé˜Ÿåˆ— sequeue_t *CreateEmptySequeue()\tsequeue_t *queue;\tqueue = (sequeue_t *)malloc(sizeof(sequeue_t));\tif (NULL == queue) return NULL;\tqueue-front = queue-rear = 0;\treturn queue; æ‘§æ¯ä¸€ä¸ªé˜Ÿåˆ— voidDestroySequeue(sequeue_t *queue)\tif (NULL != queue) free(queue); åˆ¤æ–­ä¸€ä¸ªé˜Ÿåˆ—æ˜¯å¦ä¸ºç©º intEmptySequeue(sequeue_t *queue)\tif (NULL == queue) return-1;\treturn (queue-front == queue-rear ? 1 : 0); åˆ¤æ–­ä¸€ä¸ªé˜Ÿåˆ—æ˜¯å¦ä¸ºæ»¡ intFullSequeue(sequeue_t *queue)\tif (NULL == queue) return-1;\treturn ((queue-rear + 1) % N == queue-front ? 1 : 0); æ¸…ç©ºä¸€ä¸ªé˜Ÿåˆ— voidClearSequeue(sequeue_t *queue)\tif (NULL == queue) return;\tqueue-front = queue-rear = 0;\treturn; å…¥é˜Ÿ intEnQueue(sequeue_t *queue, data_t x)\tif (NULL == queue) return - 1;\tif (1 == FullSequeue(queue)) return-1; /* full */\tqueue-rear = (queue-rear + 1) % N;\tqueue-data[queue-rear] = x;\treturn 0; å‡ºé˜Ÿ intDeQueue(sequeue_t *queue, data_t *x)\tif (NULL == queue) return-1;\tif (1 == EmptySequeue(queue)) return-1; /* empty */\tqueue-front = (queue-front + 1) % N;\tif (NULL != x) *x = queue-data[queue-front]; return 0; é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„åŠå®ç°é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„æœ¬è´¨ä¸Šæ˜¯ä»å•é“¾è¡¨æ¼”åŒ–è€Œæ¥çš„ã€‚å°†å•é“¾è¡¨æ”¹é€ æˆé“¾å¼é˜Ÿåˆ—ï¼Œå¦‚æœå°†å¤´ç»“ç‚¹åšä¸ºé˜Ÿå¤´ï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹åšä¸ºé˜Ÿå°¾ï¼Œåˆ™è¯¥é˜Ÿåˆ—çš„å‡ºé˜Ÿæ“ä½œæ–¹ä¾¿ï¼Œè€Œå…¥é˜Ÿæ“ä½œè¾ƒæ…¢ï¼›åä¹‹ï¼Œå¦‚æœå°†å¤´ç»“ç‚¹åšä¸ºé˜Ÿå°¾ï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹åšä¸ºé˜Ÿå¤´ï¼Œåˆ™è¯¥é˜Ÿåˆ—çš„å…¥é˜Ÿæ“ä½œæ–¹ä¾¿ï¼Œè€Œå‡ºé˜Ÿæ“ä½œè¾ƒæ…¢ã€‚é‚£ä¹ˆï¼Œèƒ½å¦å°†å•é“¾è¡¨ç¨åŠ æ”¹è¿›ï¼Œä½¿å¾—è¯¥é“¾å¼é˜Ÿåˆ—çš„å…¥é˜Ÿæ“ä½œå’Œå‡ºé˜Ÿæ“ä½œä¸€æ ·æ–¹ä¾¿å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œåªéœ€è¦æ”¹è¿›å¤´ç»“ç‚¹ã€‚å°†â€å¤´ç»“ç‚¹å­˜å‚¨ä¸€ä¸ª next æŒ‡é’ˆâ€æ”¹ä¸ºâ€å¤´ç»“ç‚¹å­˜å‚¨ä¸¤ä¸ªæŒ‡é’ˆ front å’Œ rearâ€ï¼Œfront æŒ‡é’ˆæŒ‡å‘é˜Ÿå¤´ï¼Œrear æŒ‡é’ˆæŒ‡å‘é˜Ÿå°¾ã€‚è¿™æ ·ä»¬è¿›è¡Œå‡ºé˜Ÿå…¥é˜Ÿæ“ä½œæ—¶ï¼Œåªéœ€è¦è®¿é—®è¿™ä¸¤ä¸ªæŒ‡é’ˆå°±èƒ½å¿«é€Ÿåœ°æ‰¾åˆ°é˜Ÿå¤´é˜Ÿå°¾ã€‚ é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„å®šä¹‰ï¼Œå°†å•é“¾è¡¨çš„å¤´ç»“ç‚¹ç¨åŠ æ”¹é€  typedef int data_t;typedef struct node_t//å®šä¹‰å•é“¾è¡¨\tdata_t data;\tstruct node_t *next;linknode_t, *linklist_t;typedef struct//å®šä¹‰é“¾å¼é˜Ÿåˆ— linklist_t front, rear;linkqueue_t; åˆ›å»ºç©ºé˜Ÿåˆ— linkqueue_t *CreateEmptyLinkqueue()\tlinkqueue_t *lp = (linkqueue_t *)malloc(sizeof(linkqueue_t));\tif(lp == NULL) return;\tlp-front = lp-rear = (linknode_t *)malloc(sizeof(linknode_t));\tif(lp-front == NULL) return;\tlp-front-next = NULL;\treturn lp; æ‘§æ¯ä¸€ä¸ªé“¾é˜Ÿåˆ— void DestroyLinkqueue(linkqueue_t *queue)\tif(queue != NULL) ClearLinkqueue(queue); free(queue); æ¸…ç©ºä¸€ä¸ªé“¾é˜Ÿåˆ— void ClearLinkqueue(linkqueue_t *queue)\tlinknode_t *qnode;\twhile(q-front) qnode = queue-front; queue-front= qnode-next; free(qnode); queue-rear = NULL; åˆ¤å®šé“¾å¼é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º ç”±äºå•é“¾è¡¨çš„å±æ€§ï¼Œé“¾å¼é˜Ÿåˆ—å‡ ä¹ä¸ä¼šå‡ºç°â€é˜Ÿåˆ—å·²æ»¡â€çš„æƒ…å†µï¼Œå› æ­¤ä¸è€ƒè™‘åˆ¤å®šé“¾å¼é˜Ÿåˆ—æ˜¯å¦å·²æ»¡çš„æ“ä½œã€‚åˆ¤å®šé“¾å¼é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œåªéœ€è¦åˆ¤å®šé˜Ÿåˆ—çš„ front æŒ‡é’ˆæ˜¯å¦ä¸ºç©ºå³å¯ã€‚ int EmptyLinkqueue(linkqueue_t *queue)\tif(queue == NULL) return-1;\treturn(queue-front == queue-rear ? 1 : 0); é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„â€”â€”å…¥é˜Ÿæ“ä½œ å…¥é˜Ÿæ“ä½œå…¶å®å°±æ˜¯åœ¨é“¾è¡¨å°¾éƒ¨æ’å…¥èŠ‚ç‚¹ã€‚ï¼ˆéœ€è¦åˆ¤å®šæ’å…¥æ—¶é“¾è¡¨æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœé“¾è¡¨ä¸ºç©ºï¼Œåˆ™ front å’Œ rear ä¸¤ä¸ªæŒ‡é’ˆéƒ½éœ€è¦æ“ä½œï¼‰æ–°æ¥çš„æ•°æ®èŠ‚ç‚¹é™„åœ¨å½“å‰ rear èŠ‚ç‚¹ä¹‹åï¼Œå¹¶å°† rear èŠ‚ç‚¹æŒ‡å‘è¯¥èŠ‚ç‚¹å³å¯ã€‚ int EnQueue(linkqueue_t *queue,data_t x)\tlinknode_t *node_new;\tif(queue == NULL) return-1;\tnode_new = (linknode_t *)malloc(sizeof(linknode_t));\tif(node_new == NULL) return-1;\tnode_new-data = x;\tnode_new-next = NULL;\tif(queue-front-next == NULL) queue-front-next = queue-rear = node_new; else queue-rear-next = node_new; queue-rear = node_new; return 0; é˜Ÿåˆ—çš„é“¾å¼å­˜å‚¨ç»“æ„â€”â€”å‡ºé˜Ÿæ“ä½œ å‡ºé˜Ÿæ“ä½œå°±æ˜¯å°†é“¾è¡¨çš„å¤´ç»“ç‚¹çš„åç»§èŠ‚ç‚¹å‡ºé˜Ÿï¼Œå¹¶å°†å…¶ä¹‹åçš„èŠ‚ç‚¹è®¾ç½®ä¸ºå¤´ç»“ç‚¹çš„åç»§èŠ‚ç‚¹ã€‚è‹¥é“¾è¡¨é™¤å¤´ç»“ç‚¹å¤–ä»…å‰©ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™éœ€å°† rear æŒ‡å‘å¤´ç»“ç‚¹ã€‚ int DeQueue(linkqueue_t *queue,data_t *x)\tlinknode_t *node_remove;\tif(queue == NULL || queue-front-next == NULL) return-1;\tnode_remove = queue-front-next;\tqueue-front-next = node_remove-next;\tif(x != NULL) *x = node_remove-data;\tfree(node_remove);\treturn 0; é“¾å¼é˜Ÿåˆ—ä»£ç typedef int data_t;typedef struct node_t\tdata_t data;\tstruct node_t *next; linknode_t, *linklist_t;typedef struct\tlinklist_t front, rear; linkqueue_t;linkqueue_t *CreateEmptyLinkqueue()//åˆ›å»ºç©ºé˜Ÿåˆ—\tlinkqueue_t *queue;\tqueue = (linkqueue_t *)malloc(sizeof(linkqueue_t));\tif (NULL == queue) perror(Create Empty LinkQueue Error); return NULL; queue-rear = queue-front = NULL;\treturn queue;int ClearLinkqueue(linkqueue_t *queue)//æ¸…ç©ºé˜Ÿåˆ—\tlinknode_t *node_remove;\tnode_remove = queue-front;\twhile (NULL != node_remove) queue-front = queue-front-next; free (node_remove); node_remove = queue-front; queue-rear = NULL;\treturn OK;int DestroyLinkqueue(linkqueue_t *queue)//é”€æ¯é˜Ÿåˆ—\tif (queue) ClearLinkqueue(queue); free(queue); return OK; else printf(DestroyLinkqueue Error ); return ERROR;\tint EmptyLinkqueue(linkqueue_t *queue)//åˆ¤å®šé˜Ÿåˆ—æ˜¯å¦ä¸ºç©º\tif (!queue) printf(EmptyLinkqueue Error ); return -1; return queue-front == NULL ? OK : ERROR;int EnQueue(linkqueue_t *queue, data_t x)//å…¥é˜Ÿ\tlinknode_t *node_new;\tif (!queue) printf(EnQueue Error ); return ERROR; node_new = (linknode_t *)malloc(sizeof(linknode_t));\tnode_new-data = x;\tnode_new-next = NULL;\tif(EmptyLinkqueue(queue)==OK) queue-front = queue-rear = node_new; else queue-rear-next = node_new; queue-rear = node_new; return OK;int DeQueue(linkqueue_t *queue, data_t *x)//å‡ºé˜Ÿ\tlinknode_t *node_remove;\tif(!queue) printf(DeQueue Error ); return ERROR; if(EmptyLinkqueue(queue)==OK) printf(queue is Empty ); return ERROR; node_remove = queue-front;\tqueue-front = node_remove-next;\tif (NULL == queue-front) queue-rear = NULL;\tif(x) *x = node_remove-data; free(node_remove);\treturn OK;int VisitQueue(linkqueue_t *queue)//éå†é˜Ÿåˆ—\tlinknode_t *node;\tprintf(aueue = );\tnode = queue-front;\tif (NULL == node) printf( ); return OK; while (NULL != node) printf(%d,, node-data); node = node-next; printf(\\b );\treturn OK; çƒé’Ÿé—®é¢˜çƒé’Ÿæ˜¯ä¸€ä¸ªåˆ©ç”¨çƒçš„ç§»åŠ¨æ¥è®°å½•æ—¶é—´çš„ç®€å•è£…ç½®ã€‚å®ƒæœ‰ä¸‰ä¸ªå¯ä»¥å®¹çº³è‹¥å¹²ä¸ªçƒçš„æŒ‡ç¤ºå™¨ï¼šåˆ†é’ŸæŒ‡ç¤ºå™¨ï¼Œäº”åˆ†é’ŸæŒ‡ç¤ºå™¨ï¼Œå°æ—¶æŒ‡ç¤ºå™¨ã€‚è‹¥åˆ†é’ŸæŒ‡ç¤ºå™¨ä¸­æœ‰ 2 ä¸ªçƒï¼Œäº”åˆ†é’ŸæŒ‡ç¤ºå™¨ä¸­æœ‰ 6 ä¸ªçƒï¼Œå°æ—¶æŒ‡ç¤ºå™¨ä¸­æœ‰ 5 ä¸ªçƒï¼Œåˆ™æ—¶é—´ä¸º 5:32ã€‚æ¯è¿‡ä¸€åˆ†é’Ÿï¼Œçƒé’Ÿå°±ä¼šä»çƒé˜Ÿåˆ—çš„é˜Ÿé¦–å–å‡ºä¸€ä¸ªçƒæ”¾å…¥åˆ†é’ŸæŒ‡ç¤ºå™¨ï¼Œåˆ†é’ŸæŒ‡ç¤ºå™¨æœ€å¤šå¯å®¹çº³ 4 ä¸ªçƒã€‚å½“æ”¾å…¥ç¬¬äº”ä¸ªçƒæ—¶ï¼Œåœ¨åˆ†é’ŸæŒ‡ç¤ºå™¨çš„ 4 ä¸ªçƒå°±ä¼šæŒ‰ç…§ä»–ä»¬è¢«æ”¾å…¥æ—¶çš„ç›¸åé¡ºåºåŠ å…¥çƒé˜Ÿåˆ—çš„é˜Ÿå°¾ã€‚è€Œç¬¬äº”ä¸ªçƒå°±ä¼šè¿›å…¥äº”åˆ†é’ŸæŒ‡ç¤ºå™¨ã€‚æŒ‰æ­¤ç±»æ¨ï¼Œäº”åˆ†é’ŸæŒ‡ç¤ºå™¨æœ€å¤šå¯æ”¾ 11 ä¸ªçƒï¼Œå°æ—¶æŒ‡ç¤ºå™¨æœ€å¤šå¯æ”¾ 11 ä¸ªçƒã€‚ å½“å°æ—¶æŒ‡ç¤ºå™¨æ”¾å…¥ç¬¬ 12 ä¸ªçƒæ—¶ï¼ŒåŸæ¥çš„ 11 ä¸ªçƒæŒ‰ç…§ä»–ä»¬è¢«æ”¾å…¥æ—¶çš„ç›¸åé¡ºåºåŠ å…¥çƒé˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç„¶åç¬¬ 12 ä¸ªçƒä¹Ÿå›åˆ°é˜Ÿå°¾ã€‚è¿™æ—¶ï¼Œä¸‰ä¸ªæŒ‡ç¤ºå™¨å‡ä¸ºç©ºï¼Œå›åˆ°åˆå§‹çŠ¶æ€ï¼Œä»è€Œå½¢æˆä¸€ä¸ªå¾ªç¯ã€‚å› æ­¤ï¼Œè¯¥çƒé’Ÿè¡¨ç¤ºæ—¶é—´çš„èŒƒå›´æ˜¯ä» 0ï¼š00 åˆ° 11ï¼š59ã€‚ æ€è€ƒï¼šçƒé’Ÿéœ€è¦å¤šå°‘ä¸ªçƒï¼Œæ‰èƒ½å®ç°è®¡æ—¶èŒƒå›´ä¸º 0ï¼š00 åˆ° 11ï¼š59ï¼Ÿ æç¤ºï¼šä½¿ç”¨ 3 ä¸ªæ ˆæ¥åˆ†åˆ«è¡¨ç¤º 1min æŒ‡ç¤ºå™¨ã€5min æŒ‡ç¤ºå™¨å’Œ 1h æŒ‡ç¤ºå™¨ï¼Œä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—æ¥å­˜å‚¨å°çƒ #include stdio.h#include stdlib.h#define MAXSIZE_1 5#define MAXSIZE_2 12#define MAXSIZE_ball 28#define OK 1#define ERROR 0typedef int data_t;typedef struct //ä¸€åˆ†é’Ÿçš„é¡ºåºæ ˆ\tdata_t data[MAXSIZE_1];\tint top;one_min_t;typedef struct //äº”åˆ†é’Ÿä¸ä¸€å°æ—¶çš„é¡ºåºæ ˆ\tdata_t data[MAXSIZE_2];\tint top;five_min_t;typedef struct //æ‰€æœ‰å°çƒçš„å­˜æ”¾é˜Ÿåˆ—\tdata_t data[MAXSIZE_ball];\tint front;\tint rear;SqQueue;int main() int i; data_t *the_ball; one_min_t *one_min; five_min_t *five_min,*one_hour; SqQueue *ball; one_min = CreateEmptyStack(); five_min = CreateEmptyStack(); one_hour = CreateEmptyStack(); ball = CreateEmptyQueue(); for(i = 0; i MAXSIZE_ball; i++) EnQueue(ball,i+1); DeQueue(ball,the_ball); if(0==PushStack(one_min,the_ball)) for(i=0; i4; i++) PopStack(one_min,the_ball); EnQueue(ball,the_ball); return 0;int PushStack(SqStack *s,data_t e)//å‹æ ˆ\tif(s-top==MAXSIZE-1) printf(Stack is Full ); return ERROR; s-top++;\ts-data[s-top]=e;\treturn OK;int PopStack(SqStack *s,data_t *e)//å¼¹æ ˆ\tif(s-top==-1) printf(Stack is Empty ); return ERROR; *e=s-data[s-top];\ts-top--;\treturn OK;SqStack* CreateEmptyStack()//åˆ›å»ºæ ˆ SqStack *stack = (SqStack*)malloc(sizeof(SqStack)); if(stack==NULL) printf(CreateEmptyStack Error ); exit(0); stack-top=-1; return stack;int EmptyStack(SqStack *s)//åˆ¤æ–­æ ˆæ˜¯å¦æ˜¯ç©ºæ ˆ return -1==s-top?OK:ERROR;int FullStack(SqStack *s)//åˆ¤æ–­æ ˆæ˜¯å¦æ˜¯æ»¡æ ˆ return MAXSIZE-1==s-top?OK:ERROR;int ClearStack(SqStack *s)//æ¸…ç©ºæ ˆå†…å…ƒç´  s-top=-1; return OK;SqQueue *CreateEmptyQueue()//åˆ›å»ºé˜Ÿåˆ—\tSqQueue *sq = (SqQueue*)malloc(sizeof(SqQueue));\tif(sq==NULL) printf(CreateEmptyQueue Error ); return NULL; sq-front=0;\tsq-rear=0;\treturn sq;int EmptyQueue(SqQueue *Q)//åˆ¤æ–­é˜Ÿæ˜¯å¦ä¸ºç©º\tif(Q==NULL) printf(EmptyQueue Error ); return -1; if(Q-rear==Q-front) return OK;\telse return ERROR;int FullQueue(SqQueue *Q)//åˆ¤æ–­é˜Ÿæ˜¯å¦å·²æ»¡\tif(Q==NULL) printf(EmptyQueue Error ); return -1; if((Q-rear+1)%MAXSIZE==Q-front) return OK;\telse return ERROR;int EnQueue(SqQueue *Q,data_t e)//å…ƒç´ eå…¥é˜Ÿ\tif(FullQueue(Q)==OK) printf(Queue is Full ); return ERROR; Q-data[Q-rear]=e;\tQ-rear=(Q-rear+1)%MAXSIZE;\treturn OK;int DeQueue(SqQueue *Q,data_t *e)//å…ƒç´ å‡ºé˜Ÿï¼Œå‡ºé˜Ÿå…ƒç´ å­˜å‚¨åœ¨eä¸­\tif(EmptyQueue(Q)==OK) printf(Queue is Empty ); return ERROR; *e=Q-data[Q-front];\tQ-front=(Q-front+1)%MAXSIZE;\treturn OK; #includestdio.h#includestdlib.h#define ONEMIN 5#define FIVEMIN 12#define ONEHOUR 12#define BALLQUE 28#define OK 1#define ERROR 0typedef int data_t;typedef struct\tdata_t *data;\tint top;//æ ˆé¡¶\tint maxlen;SqStack;typedef struct\tdata_t *data;\tint front;//é˜Ÿå¤´ä½ç½®\tint rear;//é˜Ÿå°¾ä½ç½®\tint maxlen;SqQueue;/**************************é˜Ÿåˆ—éƒ¨åˆ†**************************/SqQueue *CreateEmptyQueue(int length)//åˆ›å»ºé˜Ÿåˆ—\tSqQueue *sq = (SqQueue*)malloc(sizeof(SqQueue));\tif(sq==NULL) printf(CreateEmptyQueue Error ); return NULL; sq-data = (data_t*)malloc(sizeof(data_t)*length);\tsq-maxlen=length;\tsq-front=0;\tsq-rear=0;\treturn sq;int EmptyQueue(SqQueue *Q)//åˆ¤æ–­é˜Ÿæ˜¯å¦ä¸ºç©º\tif(Q==NULL) printf(EmptyQueue Error ); return -1; if(Q-rear==Q-front) return OK;\telse return ERROR;int FullQueue(SqQueue *Q)//åˆ¤æ–­é˜Ÿæ˜¯å¦å·²æ»¡\tif(Q==NULL) printf(EmptyQueue Error ); return -1; if((Q-rear+1)%Q-maxlen==Q-front) return OK;\telse return ERROR;int EnQueue(SqQueue *Q,data_t e)\tif(FullQueue(Q)==OK) printf(Queue is Full ); return ERROR; Q-data[Q-rear]=e;\tQ-rear=(Q-rear+1)%Q-maxlen;\treturn OK;int DeQueue(SqQueue *Q,data_t *e)\tif(EmptyQueue(Q)==OK) printf(Queue is Empty ); return ERROR; *e=Q-data[Q-front];\tQ-front=(Q-front+1)%Q-maxlen;\treturn OK;/**************************æ ˆéƒ¨åˆ†**************************/int PushStack(SqStack *s,data_t e)//å‹æ ˆ\tif(s-top==s-maxlen-1) printf(Stack is Full ); return ERROR; s-top++;\ts-data[s-top]=e;\treturn OK;data_t PopStack(SqStack *s)//å¼¹æ ˆ\tif(s-top==-1) printf(Stack is Empty ); return ERROR; data_t e=s-data[s-top];\ts-top--;\treturn e;SqStack* CreateEmptyStack(int length)//åˆ›å»ºæ ˆ SqStack *stack = (SqStack*)malloc(sizeof(SqStack)); if(stack==NULL) printf(CreateEmptyStack Error ); exit(0); stack-data = (data_t*)malloc(sizeof(data_t)*length);\tstack-maxlen=length; stack-top=-1; return stack;int EmptyStack(SqStack *s)//åˆ¤æ–­æ ˆæ˜¯å¦æ˜¯ç©ºæ ˆ return -1==s-top?OK:ERROR;int FullStack(SqStack *s)//åˆ¤æ–­æ ˆæ˜¯å¦æ˜¯æ»¡æ ˆ return s-maxlen-1==s-top?OK:ERROR;void ShowTime(SqStack *one_min,SqStack *five_min,SqStack *one_hour)//è®¡ç®—çƒé’Ÿå†…3ä¸ªæ ˆçš„å°çƒæ‰€ä»£è¡¨çš„æ—¶é—´å¹¶æ‰“å°\tint hour,minute;\tminute=(one_min-top+1)+(five_min-top+1)*5;\thour=one_hour-top+1;\tprintf(time: %d:%d ,hour,minute);int main()\tSqStack *one_min = CreateEmptyStack(ONEMIN);//1åˆ†é’Ÿæ ˆ\tSqStack *five_min = CreateEmptyStack(FIVEMIN);//5åˆ†é’Ÿæ ˆ\tSqStack *one_hour = CreateEmptyStack(ONEHOUR);//1å°æ—¶æ ˆ\tSqQueue *ballque = CreateEmptyQueue(BALLQUE);//çƒé˜Ÿåˆ—\tint i;\tdata_t data;\tfor(i=1;i=ballque-maxlen-1;i++) EnQueue(ballque,i); while(1) DeQueue(ballque,data);//å‡ºé˜Ÿä¸€ä¸ªçƒ PushStack(one_min,data);//å‹å…¥1åˆ†é’Ÿæ ˆä¸­ if(FullStack(one_min)==OK)//å¦‚æœ1åˆ†é’Ÿæ ˆå·²æ»¡ for(i=0;ione_min-maxlen-1;i++)//å¼¹å‡º4ä¸ªå…ƒç´ åˆ°é˜Ÿåˆ—ä¸­ EnQueue(ballque,PopStack(one_min)); PushStack(five_min,PopStack(one_min));//ç¬¬5ä¸ªå‹å…¥5åˆ†é’Ÿæ ˆ if(FullStack(five_min)==OK)//å¦‚æœ5åˆ†é’Ÿæ ˆå·²æ»¡ for(i=0;ifive_min-maxlen-1;i++)//å¼¹å‡º11ä¸ªå…ƒç´ åˆ°é˜Ÿåˆ—ä¸­ EnQueue(ballque,PopStack(five_min)); PushStack(one_hour,PopStack(five_min));//ç¬¬12ä¸ªå…ƒç´ å‹å…¥1å°æ—¶æ ˆ if(FullStack(one_hour)==OK)//å¦‚æœ1å°æ—¶æ ˆå·²æ»¡ for(i=0;ione_hour-maxlen;i++)//å¼¹å‡º12ä¸ªå…ƒç´ åˆ°é˜Ÿåˆ—ä¸­ EnQueue(ballque,PopStack(one_hour)); ShowTime(one_min,five_min,one_hour);//æ‰“å°æ—¶é—´ sleep(1);//å»¶æ—¶1ç§’ return 0; ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—é˜Ÿåˆ—çš„å£°æ˜å¦‚ä¸‹ï¼Œè¯·å®ç°å®ƒçš„ä¸¤ä¸ªå‡½æ•° appendTail å’Œ deleteHeadï¼Œåˆ†åˆ«å®Œæˆåœ¨é˜Ÿåˆ—å°¾éƒ¨æ’å…¥å…ƒç´ å’Œåœ¨é˜Ÿåˆ—å¤´éƒ¨åˆ é™¤èŠ‚ç‚¹çš„åŠŸèƒ½ã€‚ template typename Tclass CQueuepublic: CQueue(void); ~CQueue(void); void appendTail(const T element); T deleteHead();private: stackT stack1; stackT stack2;; æ€è·¯ï¼šæ ˆæ˜¯å…ˆè¿›åå‡ºï¼Œè€Œé˜Ÿåˆ—æ˜¯å…ˆè¿›å…ˆå‡ºçš„ï¼Œè€Œè¦ç”¨æ ˆå®ç°é˜Ÿåˆ—çš„è¯ï¼Œä¸¤æ­¥æ“ä½œå¦‚ä¸‹ï¼š è¿›é˜Ÿåˆ—ï¼šç¬¬ä¸€ä¸ªæ ˆ stack1 ä¸“é—¨ç”¨æ¥å‹å…¥æ•°æ®ï¼› å‡ºé˜Ÿåˆ—ï¼šè¦æŠŠé˜Ÿåˆ—å¤´éƒ¨å…ƒç´ è¾“å‡ºï¼Œè€Œè¿™ä¸ªå¤´éƒ¨ä¼šåœ¨ stack1 ä¸­çš„åº•éƒ¨ï¼Œå› æ­¤ä»¬éœ€è¦åˆ©ç”¨è¾…åŠ©æ ˆ stack2 ï¼ŒæŠŠ stack1 å…ƒç´ ä¾æ¬¡å‹å…¥ stack2ï¼Œè¿™æ ·åŸæ¥ stack1 ä¸­çš„åº•éƒ¨å…ƒç´ å˜æˆ stack2 çš„æ ˆé¡¶ï¼Œè€Œè¿™å°±æ˜¯é˜Ÿåˆ—çš„ headï¼Œå°†ä¹‹è¾“å‡ºå³å¯ã€‚ ä¸Šé¢åˆ†ææ˜¯é’ˆå¯¹ stack2 ç©ºçš„æƒ…å†µï¼Œè‹¥ stack2 éç©ºï¼Œåˆ™è¦ç»§ç»­æŠŠ stack2 ä¸­å…ƒç´ ä¾æ¬¡ pop å‡ºæ¥ã€‚ //è¿›é˜Ÿåˆ—template typename T void CQueueT::appendTail(const T element) stack1.push(element);//å‡ºé˜Ÿåˆ—template typename T T CQueueT::deleteHead() if (stack2.empty()) //è‹¥stack2æ˜¯ç©ºçš„ï¼Œåˆ™æŠŠstack1çš„å…ƒç´ copyè¿‡æ¥ while (!stack1.empty()) T data = stack1.top(); stack1.pop(); stack2.push(data); if (stack2.empty()) throw new exception(queue is empty); //å–stack2æ ˆé¡¶å…ƒç´ ï¼Œå³é˜Ÿåˆ—çš„head T head = stack2.top(); stack2.pop(); return head; æ•°ç»„å®ç°é˜Ÿåˆ— //æ•°ç»„å®ç°é˜Ÿåˆ—template typename Tclass CArrayQueuepublic: CArrayQueue(void); ~CArrayQueue(void); void appendTail(const T element); T deleteHead();private: const static int nSize; T Array[10]; int nHead; int nTail;;template typename T const int CArrayQueueT:: nSize = 10;template typename T CArrayQueueT::CArrayQueue(void) this-nHead = 0; this-nTail = -1;template typename T CArrayQueueT::~CArrayQueue(void) this-nHead = 0; this-nTail = -1;//è¿›é˜Ÿåˆ—template typename T void CArrayQueueT::appendTail(const T element) if (nTail - nHead = nSize) throw new exception(Queue is full!); Array[(++nTail) % nSize] = element; if (nHead / nSize 0 ) nTail -= nSize; nHead -= nSize; //å‡ºé˜Ÿåˆ—template typename T T CArrayQueueT::deleteHead() T Head = Array[nHead++]; return Head;","categories":["2.ç¼–ç¨‹è¯­è¨€","ç»“æ„ç®—æ³•"]},{"title":"æ»¤æ³¢ç®—æ³•","path":"/2024/01/26/2-ç¼–ç¨‹è¯­è¨€-ç»“æ„ç®—æ³•-æ»¤æ³¢ç®—æ³•/","content":"åœ¨è¿›è¡Œæ•°æ®æ”¶é›†çš„è¿‡ç¨‹ä¸­ï¼Œéš¾å…ä¼šé­é‡åˆ°éšæœºè¯¯å·®ã€‚è¿™ç§è¯¯å·®æºäºéšæœºå¹²æ‰°ï¼Œå…¶ç‰¹å¾æ˜¯åœ¨ç›¸åŒæ¡ä»¶ä¸‹æµ‹é‡åŒä¸€ç‰©ç†é‡æ—¶ï¼Œè¯¯å·®çš„å¤§å°å’Œç¬¦å·è¡¨ç°å‡ºæ— è§„å¾‹çš„å˜åŒ–ï¼Œéš¾ä»¥é¢„æµ‹ã€‚ä¾‹å¦‚ï¼Œåœ¨ç›‘æµ‹æ¸©åº¦æ—¶ï¼ŒæŸæ¬¡æµ‹é‡è®°å½• ä¸º 22.5Â°Cï¼Œä¸‹ä¸€æ¬¡åˆ™å¯èƒ½ æ˜¯ 22.7Â°Cï¼Œååˆå› åˆ° 22.4Â°Cï¼Œè¿™ç§æ³¢åŠ¨çœ‹ä¼¼å¶ç„¶ï¼Œä½†åœ¨å¤šæ¬¡æµ‹é‡åï¼Œå¯ä»¥å‘ç°å…¶ç»“æœå´èƒ½å¤Ÿç¬¦åˆæŸç§ç»Ÿè®¡è§„å¾‹ã€‚ä¸ºäº†å‡å°‘éšæœºå¹²æ‰°å¯¼è‡´çš„è¿™äº›è¯¯å·®ï¼Œç¡¬ä»¶å±‚é¢å¯ä»¥é‡‡ç”¨æ»¤æ³¢æŠ€æœ¯ï¼Œè½¯ä»¶å±‚é¢åˆ™å¯ä»¥åˆ©ç”¨ç‰¹å®šçš„è½¯ä»¶ç®—æ³•å®ç°æ•°å­—æ»¤æ³¢ã€‚ æ•°å­—æ»¤æ³¢ç®—æ³•æ˜¯ç³»ç»Ÿæµ‹æ§ç®—æ³•ä¸­éå¸¸å…³é”®çš„ä¸€éƒ¨åˆ†ï¼Œå…¶å…·æœ‰æå¼ºçš„å®æ—¶æ€§ã€‚åˆ©ç”¨æ•°å­—æ»¤æ³¢å™¨å…‹æœéšæœºå¹²æ‰°å¸¦æ¥çš„è¯¯å·®ï¼Œå…·ä½“æœ‰ä»¥ä¸‹å‡ ä¸ªæ˜¾è‘—ä¼˜ç‚¹ï¼š æˆæœ¬æ•ˆç›Šé«˜ï¼šæ•°å­—æ»¤æ³¢ä¸éœ€è¦é¢å¤–çš„ç¡¬ä»¶è®¾å¤‡ï¼Œä»…ä¾èµ–ä¸€ä¸ªè®¡ç®—è¿‡ç¨‹ï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„å¯é æ€§ï¼ŒåŒæ—¶é¿å…äº†é˜»æŠ—åŒ¹é…é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œä¼ ç»Ÿçš„æ¨¡æ‹Ÿæ»¤æ³¢å™¨å¯èƒ½å› é¢‘ç‡ä¸åŒ¹é…è€Œæ— æ³•æœ‰æ•ˆå¤„ç†æŸäº›ä¿¡å·ï¼Œä½†æ•°å­—æ»¤æ³¢å™¨èƒ½å¤Ÿç¨³å®šåœ°å¤„ç†é‚£äº›é¢‘ç‡æä½çš„ä¿¡å·ï¼Œè¿™æ˜¯æ¨¡æ‹Ÿè®¾å¤‡æ‰€æ— æ³•åšåˆ°çš„ã€‚ å…±ç”¨æ€§å¼ºï¼šæ•°å­—æ»¤æ³¢ä½¿ç”¨è½¯ä»¶å®ç°ï¼Œä¸€å°ç³»ç»Ÿä¸­å¤šæ¡è¾“å…¥é€šé“å¯ä»¥å…±äº«åŒä¸€ä¸ªæ»¤æ³¢ç¨‹åºï¼Œè¿™æ— ç–‘é™ä½äº†æ•´ä½“çš„ç³»ç»Ÿå¼€æ”¯ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€å¥—æ°”è±¡ç›‘æµ‹ç³»ç»Ÿä¸­ï¼Œå¯¹äºé£é€Ÿã€æ°”æ¸©å’Œæ¹¿åº¦ç­‰å¤šä¸ªä¼ æ„Ÿå™¨æ•°æ®ï¼Œå¯ä»¥ä»…ç”¨ä¸€ä¸ªè½¯ä»¶ç®—æ³•å¯¹æ‰€æœ‰ä¿¡å·è¿›è¡Œæ»¤æ³¢ï¼Œé¿å…äº†ä¸ºæ¯ä¸ªä¿¡å·é…å¤‡ç‹¬ç«‹ç¡¬ä»¶çš„é«˜æ˜‚æˆæœ¬ã€‚ çµæ´»æ€§ï¼šé€šè¿‡ç®€å•åœ°è°ƒæ•´æ»¤æ³¢å™¨çš„ç¨‹åºæˆ–è¿ç®—ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æ”¹å˜æ»¤æ³¢ç‰¹æ€§ã€‚å¯¹äºå»é™¤ä½é¢‘å¹²æ‰°å’Œéšæœºä¿¡å·ï¼Œè¿™ç§çµæ´»æ€§å°¤ä¸ºé‡è¦ã€‚ä¾‹å¦‚ï¼Œå½“å¯Ÿè§‰æŸä¸€æµ‹é‡ç³»ç»Ÿå—åˆ°ä½é¢‘å™ªå£°å½±å“æ—¶ï¼Œåªéœ€æ›´æ–°ç¨‹åºè®¾ç½®ï¼Œå°±èƒ½ç«‹åˆ»ä¼˜åŒ–ä¿¡å·å¤„ç†ï¼Œç¡®ä¿æœ€ç»ˆç»“æœçš„å‡†ç¡®æ€§ã€‚ å¸¸ç”¨ç®—æ³•å¤šæ ·ï¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¸¸ç”¨çš„æ•°å­—æ»¤æ³¢ç®—æ³•åŒ…æ‹¬æœ‰é™å¹…æ»¤æ³¢æ³•ã€ä¸­å€¼æ»¤æ³¢æ³•ã€ç®—æœ¯å¹³å‡æ»¤æ³¢æ³•ã€åŠ æƒå¹³å‡æ»¤æ³¢æ³•å’Œæ»‘åŠ¨å¹³å‡æ»¤æ³¢æ³•ç­‰ã€‚è¿™äº›ç®—æ³•å„æœ‰ç‰¹ç‚¹ï¼Œä¾‹å¦‚ï¼Œä¸­å€¼æ»¤æ³¢æ³•åœ¨å¤„ç†å«æœ‰è„‰å†²å™ªå£°çš„ä¿¡å·æ—¶è¡¨ç°å°¤ä¸ºå‡ºè‰²ï¼Œè€Œæ»‘åŠ¨å¹³å‡æ»¤æ³¢æ³•åˆ™é€‚åˆäºå¹³æ»‘æ•´ä½“è¶‹åŠ¿ã€‚ ç„¶è€Œï¼Œä¹Ÿéœ€æ³¨æ„ä¸ªåˆ«ç®—æ³•åœ¨è·å–æœ‰æ•ˆé‡‡æ ·å€¼æ—¶å¯èƒ½éœ€è¦å¯¹æ•°æ®è¿›è¡Œå¤šæ¬¡é‡‡æ ·ï¼Œè¿™åœ¨é‡‡æ ·é€Ÿåº¦è¾ƒæ…¢çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå½±å“ç³»ç»Ÿçš„å®æ—¶æ€§ã€‚åœ¨é«˜é€Ÿå®æ—¶ç›‘æµ‹çš„åœºåˆï¼Œè¿™ç§å»¶è¿Ÿå¯èƒ½å¯¼è‡´æ•°æ®å¤±çœŸæˆ–é”™è¿‡é‡è¦ä¿¡æ¯ã€‚å› æ­¤ï¼Œé€‰æ‹©é€‚åˆçš„æ»¤æ³¢ç®—æ³•å’Œè®¾è®¡åˆç†çš„é‡‡æ ·ç­–ç•¥æ˜¯æå‡æ•°æ®æ”¶é›†å‡†ç¡®æ€§å’ŒåŠæ—¶æ€§çš„å…³é”®å› ç´ ã€‚ é€’æ¨å¹³å‡æ»¤æ³¢ï¼ˆæ»‘åŠ¨å¹³å‡æ»¤æ³¢æ³•ï¼‰ é€’æ¨å¹³å‡æ»¤æ³¢ï¼Œä¹Ÿç§°æ»‘åŠ¨å¹³å‡æ»¤æ³¢æ³•ï¼Œæ˜¯ä¸€ç§é€šè¿‡å¹³æ»‘æ•°æ®æ¥æŠ‘åˆ¶å™ªå£°å’Œæ³¢åŠ¨çš„æŠ€æœ¯ã€‚å®ƒå°†è¿ç»­çš„ N ä¸ªé‡‡æ ·å€¼è§†ä½œä¸€ä¸ªå›ºå®šé•¿åº¦çš„é˜Ÿåˆ—ï¼Œå…¶ä¸­æ¯é‡‡æ ·åˆ°ä¸€ä¸ªæ–°æ•°æ®ï¼Œå°±ä¼šå°†å…¶æ”¾å…¥é˜Ÿå°¾ï¼Œè€Œé˜Ÿé¦–çš„ä¸€ä¸ªæ—§æ•°æ®æ‚„ç„¶è¢«ä¸¢å¼ƒã€‚è¿™ç§å…ˆè¿›å…ˆå‡ºçš„å¤„ç†æ–¹å¼ç¡®ä¿äº†æ¯æ¬¡è®¡ç®—å¹³å‡å€¼æ—¶ï¼Œé˜Ÿåˆ—ä¸­æ€»æ˜¯æœ€æ–°çš„ N ä¸ªæ•°æ®ç‚¹ã€‚ æ»¤æ³¢çš„è¿‡ç¨‹å¦‚ä¸‹ï¼šä»é˜Ÿåˆ—ä¸­çš„ N ä¸ªæ•°æ®è¿›è¡Œç®—æœ¯å¹³å‡è¿ç®—ï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªæ–°çš„æ»¤æ³¢ç»“æœã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒN å€¼è®¾å®šä¸º 12ï¼Œè¿™ä»£è¡¨å°†è¿‡å»çš„ 12 ä¸ªæ•°æ®å€¼ç»“åˆåœ¨ä¸€èµ·ï¼Œä¸ºå½“å‰å€¼æä¾›æ›´ç¨³å®šçš„è¡¨ç°ã€‚ æ»¤æ³¢ç®—æ³•å¯¹å‘¨æœŸæ€§å¹²æ‰°å¦‚ç”µç£å¹²æ‰°å’ŒæŒ¯åŠ¨å™ªå£°å…·æœ‰è‰¯å¥½çš„æŠ‘åˆ¶ä½œç”¨ï¼Œå› å…¶å¯ä»¥æœ‰æ•ˆåœ°å¹³æ»‘ç³»ç»Ÿè¾“å‡ºï¼Œå°¤å…¶é€‚ç”¨äºé«˜é¢‘æŒ¯è¡ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œåœ¨æµ‹é‡æ¸©åº¦æ—¶ï¼Œå¦‚æœä¼ æ„Ÿå™¨å—åˆ°é£é€Ÿå˜åŒ–çš„å½±å“ï¼Œä½¿ç”¨æ»‘åŠ¨å¹³å‡æ³•å°±èƒ½å¹³æ»‘æ¸©åº¦å€¼ï¼Œä½¿å…¶æ³¢åŠ¨å‡å°‘ï¼Œä¾¿äºè§‚å¯ŸçœŸå®æ¸©åº¦è¶‹åŠ¿ã€‚ ç„¶è€Œï¼Œè¿™ç§æ»¤æ³¢æ–¹æ³•çš„çµæ•åº¦ç›¸å¯¹è¾ƒä½ï¼Œå¯¹å¶ç„¶å‡ºç°çš„è„‰å†²æ€§å¹²æ‰°ï¼Œæ¯”å¦‚ç¬é—´çš„ç”µå‹å°–å³°æˆ–æœºæ¢°æ•²å‡»ç­‰ï¼Œæ»¤æ³¢æ•ˆæœä¸ä½³ã€‚è¿™æ„å‘³ç€å¦‚æœé‡‡æ ·æ•°æ®ä¸­å‡ºç°çªå‘æ€§å¹²æ‰°ï¼Œæ»¤æ³¢ç»“æœå¯èƒ½ä¸ä¼šå¾—åˆ°æœ‰æ•ˆçš„ä¿®æ­£ï¼Œå› æ­¤åœ¨é¢ä¸´ä¸¥é‡è„‰å†²å¹²æ‰°çš„ç¯å¢ƒä¸­ï¼Œæ»‘åŠ¨å¹³å‡æ³•å¯èƒ½å¹¶ä¸é€‚ç”¨ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ»‘åŠ¨å¹³å‡æ³•å¯èƒ½ä¼šæ¶ˆè€—ä¸€å®šçš„ RAMï¼Œå› ä¸ºå®ƒéœ€è¦ä¸º N ä¸ªæ•°æ®åˆ†é…å­˜å‚¨ç©ºé—´ã€‚æ­¤å¤–ï¼Œä½¿ç”¨ç¯å‹é˜Ÿåˆ—çš„ç»“æ„å¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†ç¼“å†²åŒºï¼Œä½¿å¾—åœ¨ä¸æ–­è·å¾—æ–°æ•°æ®çš„åŒæ—¶ï¼Œä¿æŒå­˜å‚¨æ•ˆç‡ã€‚ C è¯­è¨€ä»£ç å¦‚ä¸‹ï¼š #define N 12char value_buf[N];char i = 0;char filter() char count; int sum = 0; value_buf[i++] = get_ad(); // å°†æ–°çš„é‡‡æ ·å€¼å­˜å…¥ç¼“å†²åŒº if (i == N) i = 0; // å¾ªç¯ç¼“å†²åŒº for (count = 0; count N; count++) sum += value_buf[count]; // è®¡ç®—å½“å‰ç¼“å†²åŒºçš„å’Œ return (char)(sum / N); // è¿”å›å¹³å‡å€¼ è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸º filter çš„å‡½æ•°ï¼Œå®ç°äº†é€’æ¨å¹³å‡æ»¤æ³¢ï¼ˆæ»‘åŠ¨å¹³å‡æ»¤æ³¢æ³•ï¼‰ã€‚å®ƒä½¿ç”¨ä¸€ä¸ªé•¿åº¦ä¸º Nï¼ˆå®šä¹‰ä¸º 12ï¼‰çš„ç¼“å†²åŒº value_buf æ¥å­˜å‚¨é‡‡æ ·å€¼ã€‚æ¯å½“è°ƒç”¨ filter å‡½æ•°æ—¶ï¼Œå®ƒä¼šè·å¾—ä¸€ä¸ªæ–°çš„é‡‡æ ·å€¼ï¼Œé¦–å…ˆå°†å…¶å­˜å…¥ç¼“å†²åŒºï¼Œç„¶åè®¡ç®—å¹¶è¿”å›è¯¥ç¼“å†²åŒºå†…æ‰€æœ‰é‡‡æ ·å€¼çš„å¹³å‡å€¼ï¼Œå®ç°æ•°æ®çš„å¹³æ»‘å¤„ç†ã€‚å¦‚æœ i è¾¾åˆ° Nï¼Œä»£ç ä¼šå°† i é‡è®¾ä¸º 0ï¼Œä»è€Œå®ç°ä¸€ä¸ªå¾ªç¯ç¼“å†²åŒºçš„è¡Œä¸ºã€‚ æ»‘åŠ¨å¹³å‡æ»¤æ³¢çš„æ–¹å¼è®¾è®¡äº†ä¸€æ¬¡é‡‡æ ·çš„å¤„ç†ç­–ç•¥ï¼Œå°†å½“å‰é‡‡æ ·å€¼ä¸è¿‡å»çš„è‹¥å¹²ä¸ªé‡‡æ ·å€¼ä¸€èµ·è¿›è¡Œå¹³å‡ï¼Œè¿™æœ‰æ•ˆåœ°è¿‡æ»¤äº†åŸå§‹æ•°æ®ä¸­çš„æç«¯å˜åŒ–ã€‚å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¼šé¢„å…ˆä¸º N ä¸ªæ•°æ®åˆ†é…å†…å­˜ç©ºé—´ä»¥ä¾›å­˜å‚¨ã€‚æ¯æ¬¡æ–°æ•°æ®çš„åŠ å…¥ä¼šä¼´éšæœ€æ—§çš„æ•°æ®è¢«åˆ é™¤ï¼Œä»è€Œå§‹ç»ˆä¿æŒæœ€æ–°çš„ N ä¸ªæœ‰æ•ˆæ•°æ®ã€‚è¿™ç§è®¾è®¡ç¡®ä¿äº†å¯¹æ•°æ®çš„è¿ç»­æ›´æ–°å’Œé«˜æ•ˆç®¡ç†ï¼Œéå¸¸é€‚åˆå¤„ç†åŠ¨æ€å˜åŒ–çš„ä¿¡å·ã€‚ ç¨‹åºä»£ç çš„ç®€å•å­˜å–ç»“æ„å±•ç¤ºäº†å¦‚ä½•ä¸æ–­æ›´æ–°å’Œè®¡ç®—æ»‘åŠ¨å¹³å‡å€¼ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š char value_buff[N];char i=0;char filter() char count; int sum=0; value_buff[i++] = get_data(); // è¯»å–æ–°æ•°æ® if(i == N) i = 0; // å®ç°ç¯å½¢é˜Ÿåˆ— for(count = 0; count N; count++) sum += value_buff[count]; // ç´¯åŠ æ‰€æœ‰æ•°æ® return (char)(sum / N); // è¿”å›å¹³å‡å€¼ æ•´ä½“æ¥çœ‹ï¼Œæ»‘åŠ¨å¹³å‡æ»¤æ³¢æ³•æ˜¯æœ‰æ•ˆä¸”ç®€å•çš„ä¸€ç§æ•°æ®å¤„ç†æ–¹æ³•ï¼Œå°¤å…¶é€‚åˆéœ€è¦å¹³æ»‘è¾“å‡ºç»“æœçš„åº”ç”¨åœºæ™¯ã€‚ ä¸­ä½å€¼å¹³å‡æ»¤æ³¢æ³•ä¸­ä½å€¼å¹³å‡æ»¤æ³¢æ³•ï¼Œä¹Ÿè¢«ç§°ä¸ºé˜²è„‰å†²å¹²æ‰°å¹³å‡æ»¤æ³¢æ³•ï¼Œæ˜¯ä¸€ç§æœ‰æ•ˆçš„ä¿¡å·å¤„ç†æŠ€æœ¯ã€‚å®ƒæ—¨åœ¨ä»ä¸€ç»„æ•°æ®ä¸­å»é™¤å¼‚å¸¸å€¼å’Œè„‰å†²å¹²æ‰°ï¼Œæå–æ›´ä¸ºç¨³å®šçš„å¹³å‡å€¼ã€‚ åŸç† æ“ä½œæµç¨‹ï¼š é‡‡é›† N ä¸ªæ•°æ®ã€‚é¦–å…ˆï¼Œå»æ‰è¿™ä¸€ç»„æ•°æ®ä¸­çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚æ¥ç€ï¼Œå¯¹å‰©ä½™çš„ N-2 ä¸ªæ•°æ®è¿›è¡Œå¹³å‡è®¡ç®—ã€‚è¿™ç§æ–¹æ³•ç»“åˆäº†ä¸­ä½å€¼æ»¤æ³¢æ³•çš„ä¼˜ç‚¹ä¸ç®—æœ¯å¹³å‡æ»¤æ³¢æ³•çš„ä¼˜ç‚¹ï¼Œé™ä½äº†å¶ç„¶è„‰å†²å¹²æ‰°å¯¹ç»“æœçš„å½±å“ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœé‡‡é›†åˆ°çš„ä¸€ç»„æ•°æ®ä¸º [5, 4, 3, 2, 1, 4, 5, 8, 3, 7, 2, 3, 6, 7]ï¼Œå½“ N è®¾ä¸º 5 æ—¶ï¼Œé¦–å…ˆå»æ‰æœ€å¤§å€¼ 8 å’Œæœ€å°å€¼ 1ï¼Œå‰©ä½™æ•°æ®ä¸º [5, 4, 3, 4, 3]ï¼Œæœ€åå¾—å‡ºå®ƒä»¬çš„å¹³å‡å€¼ã€‚ ä¼˜ç‚¹ï¼š è„‰å†²å¹²æ‰°çš„æ¶ˆé™¤ï¼šä¸­ä½å€¼å¹³å‡æ»¤æ³¢æ³•èƒ½å¤Ÿæœ‰æ•ˆæ¶ˆé™¤å¶ç„¶å‡ºç°çš„è„‰å†²å¹²æ‰°ã€‚ä¾‹å¦‚ï¼Œå½“æŸä¸ªä¼ æ„Ÿå™¨å—åˆ°ç¬æ—¶ç”µå‡»æˆ–å™ªå£°å½±å“ï¼Œå¯¼è‡´ä¸€ä¸ªæ•°æ®ç‚¹å¼‚å¸¸é«˜æˆ–ä½æ—¶ï¼Œä¸­ä½å€¼çš„æ–¹æ³•å¯ä»¥é¿å…è¿™ä¸€å¼‚å¸¸å€¼å¯¹å¹³å‡çš„å½±å“ã€‚ æŠ‘åˆ¶å‘¨æœŸæ€§å¹²æ‰°ï¼šå¯¹äºå‘¨æœŸæ€§å¹²æ‰°ï¼ˆå¦‚ç”µæºé¢‘ç‡å¹²æ‰°ï¼‰ï¼Œä¸­ä½å€¼ç®—æ³•å±•ç°å‡ºè‰¯å¥½çš„æŠ‘åˆ¶èƒ½åŠ›ï¼Œå› ä¸ºå®ƒåªå…³æ³¨ä¸­å¿ƒä½ç½®çš„æ•°æ®ï¼Œè€Œå¿½ç•¥æ‰é‚£äº›æ³¢åŠ¨è¾ƒå¤§çš„æç«¯å€¼ã€‚ é«˜å¹³æ»‘åº¦ï¼šåœ¨é«˜é¢‘æŒ¯è¡çš„ç³»ç»Ÿä¸­ï¼Œè¯¥ç®—æ³•æä¾›äº†è¾ƒå¥½çš„å¹³æ»‘æ•ˆæœï¼Œé€‚ç”¨äºä¿¡å·éœ€è¦ç¨³å®šçš„åº”ç”¨åœºæ™¯ï¼Œå¦‚æ¸©æ¹¿åº¦ç›‘æµ‹ã€‚ ç¼ºç‚¹ï¼š è®¡ç®—é€Ÿåº¦ï¼šä¸ç®—æœ¯å¹³å‡æ»¤æ³¢æ³•ä¸€æ ·ï¼Œä¸­ä½å€¼å¹³å‡æ»¤æ³¢çš„è®¡ç®—é€Ÿåº¦è¾ƒæ…¢ã€‚è¿™æ˜¯å› ä¸ºå®ƒéœ€è¦å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œè€Œæ’åºé€šå¸¸æ˜¯ä¸€ä¸ªè®¡ç®—é‡è¾ƒå¤§çš„æ“ä½œï¼Œå°¤å…¶æ˜¯åœ¨æ•°æ®é‡è¾ƒå¤§çš„æƒ…å†µä¸‹ã€‚ å†…å­˜æ¶ˆè€—ï¼šè¯¥æ–¹æ³•åœ¨å¤„ç†æ•°æ®æ—¶å¯èƒ½ä¼šå ç”¨è¾ƒå¤šçš„ RAMã€‚åœ¨ä¿å­˜å’Œå¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œåº”è€ƒè™‘ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚ ç¤ºä¾‹ä»£ç ä¸‹é¢æ˜¯åº”ç”¨ä¸­ä½å€¼å¹³å‡æ»¤æ³¢æ³•çš„ C++ ç¤ºä¾‹ä»£ç ã€‚åœ¨è¿™äº›ä»£ç ä¸­ï¼Œé¦–å…ˆè·å–ä¸€ç»„æ•°æ®ï¼Œç„¶åè¿›è¡Œæ’åºï¼Œå»æ‰æœ€å¤§å’Œæœ€å°å€¼ï¼Œå¹¶è®¡ç®—å¹³å‡å€¼ã€‚ #define FILTER_N 5 // å®šä¹‰é‡‡æ ·æ•°é‡int Filter() int i; int filter_sum = 0; int filter_max, filter_min; int filter_buf[FILTER_N]; // è¿›è¡Œæ•°æ®é‡‡é›† for(i = 0; i FILTER_N; i++) filter_buf[i] = Get_AD(); // è·å–æ•°æ® delay(1); // å»¶æ—¶ç¡®ä¿æ•°æ®ç¨³å®š filter_max = filter_buf[0]; filter_min = filter_buf[0]; filter_sum = filter_buf[0]; // å¯»æ‰¾æœ€å¤§å€¼å’Œæœ€å°å€¼ for(i = 1; i FILTER_N; i++) if(filter_buf[i] filter_max) filter_max = filter_buf[i]; if(filter_buf[i] filter_min) filter_min = filter_buf[i]; filter_sum += filter_buf[i]; // å»æ‰æœ€å¤§å€¼å’Œæœ€å°å€¼åè®¡ç®—å¹³å‡ filter_sum = filter_sum - filter_max - filter_min; return filter_sum / (FILTER_N - 2); è¯¦ç»†è¿‡ç¨‹è¯´æ˜ æ•°æ®é‡‡é›†ï¼šé€šè¿‡ Get_AD() å‡½æ•°ä»ä¼ æ„Ÿå™¨è·å–è¾“å…¥æ•°æ®ï¼Œå¾ªç¯æ‰§è¡Œç›¸åº”çš„å»¶æ—¶ç¡®ä¿æ•°æ®å‡†ç¡®ã€‚ æ•°æ®åˆ†æï¼šé¦–å…ˆåˆå§‹åŒ–æœ€å¤§å€¼å’Œæœ€å°å€¼ä¸ºç¬¬ä¸€é¡¹æ•°æ®ï¼Œéšåéå†æ‰€æœ‰é‡‡é›†çš„æ•°æ®ï¼Œä»¥ç¡®å®šçœŸæ­£çš„æœ€å¤§å’Œæœ€å°å€¼ã€‚ å¤„ç†ç»“æœï¼šè®¡ç®—æ‰€æœ‰æ•°æ®çš„å’Œï¼Œç„¶åå‡å»æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œæœ€åå°†ç»“æœé™¤ä»¥ N-2ï¼ˆæœ‰æ•ˆæ•°æ®ç‚¹çš„æ•°é‡ï¼‰å¾—åˆ°æœ€ç»ˆçš„å¹³å‡å€¼ã€‚ æ€»ç»“ä½¿ç”¨ä¸­ä½å€¼å¹³å‡æ»¤æ³¢æ³•å¯ä»¥æœ‰æ•ˆåœ°æ¶ˆé™¤æ•°æ®ä¸­çš„è„‰å†²å¹²æ‰°å’Œæç«¯å¼‚å¸¸å€¼ï¼Œå°¤å…¶é€‚åˆäºæ•°æ®æ³¢åŠ¨è¾ƒå¤§çš„åœºæ™¯ã€‚å°½ç®¡è®¡ç®—é€Ÿåº¦è¾ƒæ…¢ä¸”å¯èƒ½å ç”¨è¾ƒå¤šå†…å­˜ï¼Œä½†åœ¨éœ€è¦ç¨³å®šè¾“å‡ºçš„åº”ç”¨åœºåˆï¼Œä½¿ç”¨æ­¤æ–¹æ³•å¾€å¾€èƒ½å¤Ÿè·å¾—æ›´ä¸ºå¯é çš„ç»“æœã€‚ é™å¹…æ»¤æ³¢ç®—æ³•åœ¨è¿™ä¸ªç®—æ³•çš„è¿ä½œè¿‡ç¨‹ä¸­ï¼Œå®ƒé¦–å…ˆè®¡ç®—ä¸¤æ¬¡ç›¸é‚»é‡‡æ ·çš„æ•°æ®å·®å¼‚ï¼Œä¹Ÿå°±æ˜¯ä¸¤æ¬¡æ•°æ®çš„å¢é‡ã€‚ç„¶åï¼Œå°†è¿™ä¸ªå¢é‡çš„ç»å¯¹å€¼ä¸é¢„å…ˆè®¾å®šçš„å…è®¸æœ€å¤§å·®å€¼ ( A ) è¿›è¡Œæ¯”è¾ƒã€‚è¿™æ ·çš„æ¯”è¾ƒå†³å®šäº†æ–°æ•°æ®çš„æœ‰æ•ˆæ€§ã€‚ å…·ä½“æ­¥éª¤ è®¡ç®—å¢é‡ï¼šå°†æœ€æ–°é‡‡æ ·å€¼ä¸å‰ä¸€æ¬¡é‡‡æ ·å€¼ç›¸å‡ï¼Œå¾—åˆ°çš„æ•°æ®ç§°ä¸ºå¢é‡ã€‚å‡è®¾æœ‰ä¸¤æ¬¡æµ‹é‡æ¸©åº¦çš„æ•°æ®ï¼Œç¬¬ä¸€æ¬¡æµ‹é‡çš„æ¸©åº¦ä¸º 20Â°Cï¼Œç¬¬äºŒæ¬¡ä¸º 21.5Â°Cï¼Œå¢é‡ä¸º ( 21.5 - 20 1.5 )Â°Cã€‚ æ¯”è¾ƒç»å¯¹å€¼ï¼šæ¥ç€ï¼Œå–å¢é‡çš„ç»å¯¹å€¼ 1.5Â°Cï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡æœ€å¤§å…è®¸å·®å€¼ ( A )ã€‚å‡è®¾è®¾å®š ( A 2 )Â°Cï¼Œåˆ™ ( 1.5 )Â°C â‰¤ ( 2 )Â°Cï¼Œæ­¤æ—¶å¯ä»¥è®¤ä¸ºæœ¬æ¬¡é‡‡æ ·æœ‰æ•ˆã€‚ é€‰æ‹©æ•°æ®ï¼šå¦‚æœå¢é‡å°äºæˆ–ç­‰äº ( A )ï¼Œæ–°é‡‡æ ·å€¼è¢«è§†ä¸ºæœ‰æ•ˆæ•°æ®ï¼Œè¢«æ¥å—å¹¶ä½œä¸ºæœ€æ–°çš„æ•°æ®ã€‚å¦‚æœå¢é‡å¤§äº ( A )ï¼Œé‚£ä¹ˆæœ¬æ¬¡æ•°æ®è¢«è®¤ä¸ºå¼‚å¸¸ï¼Œç³»ç»Ÿå°†ä½¿ç”¨ä¸Šä¸€æ¬¡çš„æœ‰æ•ˆæ•°æ®ä½œä¸ºæœ¬æ¬¡æ•°æ®ï¼Œä»¥ç¡®ä¿è¾“å‡ºçš„ç¨³å®šæ€§å’Œå‡†ç¡®æ€§ã€‚ä¾‹å¦‚ï¼Œè‹¥æœ¬æ¬¡å¢é‡è®¡ç®—ä¸º 2.5Â°Cï¼Œè€Œ ( A 2 )Â°Cï¼Œç³»ç»Ÿä¼šé€‰æ‹©ä¸Šä¸€æ¬¡çš„æœ‰æ•ˆæ•°æ®ï¼Œè€Œéæ–°çš„å¼‚å¸¸æ•°æ®ã€‚ ç®—æ³•çš„ç¨‹åºä»£ç å¦‚ä¸‹ï¼š #define A // å…è®¸çš„æœ€å¤§å·®å€¼char data; // ä¸Šä¸€æ¬¡çš„æ•°æ®char filter() char data_new; // æ–°æ•°æ®å˜é‡ data_new = get_data(); // è·å¾—æ–°æ•°æ®å˜é‡ if ((data_new - data) A || (data - data_new A)) return data; // å¦‚æœå¢é‡è¶…å‡ºé™åˆ¶ï¼Œè¿”å›ä¸Šä¸€æ¬¡æ•°æ® else return data_new; // å¦åˆ™è¿”å›æ–°æ•°æ® åº”ç”¨åœºæ™¯é™å¹…æ»¤æ³¢ç®—æ³•ç‰¹åˆ«é€‚ç”¨äºå¤„ç†å˜åŒ–ç¼“æ…¢çš„ä¿¡å·ï¼Œæ¯”å¦‚æ¸©åº¦ç›‘æµ‹ã€ç‰©ä½“ä½ç½®è¿½è¸ªç­‰åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œåœ¨ç›‘æ§æˆ¿é—´æ¸©åº¦æ—¶ï¼Œå¦‚æœæ¢æµ‹å™¨è¯»å–åˆ°çš„æ¸©åº¦çªå˜ï¼Œå¯èƒ½æ˜¯ç”±äºå¤–éƒ¨ç¯å¢ƒç¬é—´å˜åŒ–å¼•èµ·çš„ã€‚é€šè¿‡é™å¹…æ»¤æ³¢ï¼Œå¯ä»¥æœ‰æ•ˆå¿½ç•¥è¿™äº›çªå‘çš„å¼‚å¸¸æ•°æ®ï¼Œç¡®ä¿ç³»ç»Ÿè¾“å‡ºçš„æ¸©åº¦å€¼åæ˜ çš„æ˜¯ç¯å¢ƒçš„çœŸå®çŠ¶æ€ã€‚ å¯¹äºé€‰å–åˆé€‚çš„æœ€å¤§å…è®¸å·®å€¼ ( A ) æ¥è¯´ï¼Œè¿™é€šå¸¸æ˜¯éå¸¸å…³é”®çš„ä¸€æ­¥ã€‚å®ƒçš„å¤§å°å› è¢«æµ‹å¯¹è±¡çš„ä¸åŒè€Œå¼‚ï¼Œå¯èƒ½éœ€è¦ä¾èµ–ç»éªŒæ•°æ®æˆ–è¿›è¡Œå®éªŒæ¥ç¡®å®šã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåˆç†è®¾å®š ( A ) å°†æé«˜ç®—æ³•çš„é²æ£’æ€§ï¼Œä¿è¯æ•°æ®çš„æœ‰æ•ˆæ€§å’Œå‡†ç¡®æ€§ã€‚ä¾‹å¦‚ï¼ŒæŸäº›ç¯å¢ƒä¸­çš„æ¸©åº¦å˜åŒ–é€šå¸¸å¾ˆç¼“å’Œï¼Œé€‰å– ( A 1 )Â°C å¯èƒ½å°±è¶³å¤Ÿäº†ï¼›è€Œåœ¨æ°”æ¸©å˜åŒ–è¾ƒå¤§çš„åœ°åŒºï¼Œåˆ™å¯èƒ½éœ€è¦è®¾ç½® ( A 3Â° )C æˆ–æ›´é«˜ï¼Œä»¥é¿å…è¯¯åˆ¤ã€‚ ç®—æœ¯å¹³å‡æ»¤æ³¢ç®—æ³•ç®—æœ¯å¹³å‡æ»¤æ³¢ç®—æ³•æ˜¯ä¸€ç§ç®€å•æœ‰æ•ˆçš„ä¿¡å·å¤„ç†æŠ€æœ¯ï¼Œå…¶æ ¸å¿ƒåŸç†åœ¨äºå¯¹è¿ç»­çš„ N æ¬¡é‡‡æ ·å€¼è¿›è¡Œè®¡ç®—ï¼Œæ±‚å¾—å…¶å¹³å‡å€¼ï¼Œä»è€Œå‡å°‘éšæœºå¹²æ‰°å¯¹ä¿¡å·çš„å½±å“ã€‚è¿™ç§æ–¹æ³•ç‰¹åˆ«é€‚ç”¨äºå­˜åœ¨éšæœºå™ªå£°çš„ä¿¡å·ï¼Œå¦‚æ¸©åº¦ä¼ æ„Ÿå™¨çš„è¾“å‡ºã€ç”µå‹ä¿¡å·æˆ–å…¶ä»–ä¼ æ„Ÿå™¨æ•°æ®ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä¿¡å·å¯èƒ½ä¼šå—åˆ°ç¯å¢ƒå› ç´ çš„æ³¢åŠ¨å½±å“è€Œäº§ç”Ÿå¹²æ‰°ï¼Œå¯¼è‡´è¯»æ•°ä¸ç¨³å®šã€‚ ç®—æ³•å®ç°ä»¥ä¸‹æ˜¯è¯¥ç®—æ³•çš„åŸºæœ¬ç¨‹åºä»£ç ç¤ºä¾‹ï¼Œç”¨äºè®¡ç®— N æ¬¡é‡‡æ ·å€¼çš„ç®—æœ¯å¹³å‡ï¼š char filter() int sum = 0; // åˆå§‹åŒ–æ€»å’Œå˜é‡ for (int count = 0; count N; count++) // å¾ªç¯ N æ¬¡è¿›è¡Œé‡‡æ · sum += get_data(); // ç´¯åŠ æ¯æ¬¡é‡‡æ ·å€¼ delay(); // è¯»å–ä¸‹ä¸€ä¸ªæ•°æ®å‰çš„å»¶è¿Ÿï¼Œç¡®ä¿æ•°æ®ç¨³å®š return (char)(sum / N); // è¿”å› N æ¬¡é‡‡æ ·å€¼çš„å¹³å‡å€¼ ç®—æ³•è¯¦è§£æ­¤ç®—æ³•ä¸­ï¼Œget_data() å‡½æ•°æ˜¯ç”¨æ¥è·å–å½“å‰é‡‡æ ·å€¼çš„ã€‚åœ¨å¾ªç¯ä¸­ï¼Œsum å˜é‡é€æ­¥ç´¯åŠ è¿™äº›å€¼ï¼Œè€Œ delay() å‡½æ•°åˆ™ç”¨äºåœ¨æ¯æ¬¡é‡‡æ ·ä¹‹é—´å¼•å…¥å¿…è¦çš„å»¶æ—¶ï¼Œç¡®ä¿ä¿¡å·è¯»å–çš„ç¨³å®šæ€§ã€‚ä¾‹å¦‚ï¼Œå‡è®¾åœ¨æµ‹é‡æ¸©åº¦ï¼Œå½“ç¯å¢ƒæ¸©åº¦å› é£é€Ÿæˆ–é˜³å…‰ç…§å°„ç­‰å› ç´ å˜åŒ–æ—¶ï¼Œè¿ç»­é‡‡æ ·ä»¥æ•æ‰ç¨³å®šè¯»æ•°å°¤ä¸ºé‡è¦ã€‚ å¹³æ»‘ç¨‹åº¦ä¸çµæ•åº¦çš„å…³ç³»ç®—æœ¯å¹³å‡æ»¤æ³¢ç®—æ³•åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå…¶è¡¨ç°ä¸é€‰æ‹©çš„ N å€¼æœ‰ç›´æ¥å…³ç³»ï¼š å¤§ N å€¼ï¼šä¾‹å¦‚ï¼Œå½“ N å–å€¼ä¸º 32ï¼Œç®—æ³•ä¼šå¯¹æ›´å¤šçš„æ ·æœ¬è¿›è¡Œå¹³å‡å¤„ç†ã€‚è¿™ä¼šå¯¼è‡´ç»“æœå˜å¾—å¹³æ»‘ï¼Œå‡å°‘çŸ­æ—¶é—´å†…çš„æ³¢åŠ¨ï¼Œä½†ä¹Ÿä¼šä½¿ç³»ç»Ÿå¯¹ç¬æ—¶å˜åŒ–çš„ä¸æ•æ„Ÿã€‚ä¾‹å¦‚ï¼Œåœ¨æ¸©åº¦å˜åŒ–å‰§çƒˆçš„ç¯å¢ƒä¸‹ï¼Œå¤§ N å€¼å¯èƒ½ä¼šå¯¼è‡´æµ‹é‡å“åº”è¿Ÿç¼“ï¼Œä»è€Œä¸§å¤±å¯¹çªå‘æ¸©åº¦å˜åŒ–çš„åŠæ—¶æ„ŸçŸ¥ã€‚ å° N å€¼ï¼šç›¸å¯¹è€Œè¨€ï¼Œå½“ N å–å€¼ä¸º 4ï¼Œç³»ç»Ÿå¯ä»¥æ›´å¿«ååº”ï¼Œçµæ•åº¦æé«˜ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ•æ‰åˆ°ä¿¡å·çš„å˜åŒ–ã€‚ç„¶è€Œï¼Œè¿™æ ·ä¼šå¢åŠ è¾“å‡ºä¿¡å·çš„æ³¢åŠ¨æ€§ï¼Œå¯èƒ½ä½¿å¾—æµ‹é‡è¿‡ç¨‹ä¸­çš„å™ªå£°æ›´ä¸ºæ˜æ˜¾ã€‚ N å€¼çš„é€‰æ‹©ä¸ºäº†ç®€åŒ–è®¡ç®—å’Œæé«˜å¤„ç†é€Ÿåº¦ï¼ŒN é€šå¸¸ä¼šé€‰æ‹©ä¸º 2 çš„æ•´æ•°å¹‚ï¼ˆä¾‹å¦‚ 4ã€8ã€16ã€32ï¼‰ï¼Œè¿™æ ·å¯ä»¥åˆ©ç”¨ä½ç§»æ“ä½œä»£æ›¿é™¤æ³•ï¼Œä»è€Œæé«˜è¿ç®—æ•ˆç‡ã€‚æ¯”å¦‚ï¼Œå¯¹äº N16ï¼Œå¯ä»¥é€šè¿‡å³ç§» 4 ä½ä»£æ›¿é™¤ä»¥ 16 çš„æ“ä½œï¼Œè¿™åœ¨åµŒå…¥å¼ç³»ç»Ÿå’Œå®æ—¶å¤„ç†åœºæ™¯ä¸­å°¤å…¶é‡è¦ï¼Œå› ä¸ºè¿ç®—é€Ÿåº¦ç›´æ¥å½±å“äº†ç³»ç»Ÿçš„å“åº”èƒ½åŠ›ã€‚ é€šè¿‡åˆç†è®¾ç½® N å€¼ï¼Œç®—æœ¯å¹³å‡æ»¤æ³¢ç®—æ³•èƒ½åœ¨çµæ•åº¦å’Œå¹³æ»‘åº¦ä¹‹é—´æ‰¾åˆ°ä¸€ä¸ªå¹³è¡¡ç‚¹ï¼Œä»¥é€‚åº”ä¸åŒçš„ä¿¡å·å¤„ç†éœ€æ±‚ã€‚ åŠ æƒå¹³å‡æ»¤æ³¢ç®—æ³•åŠ æƒå¹³å‡æ»¤æ³¢ç®—æ³•æ˜¯ä¸ºäº†è§£å†³ç®—æœ¯å¹³å‡æ»¤æ³¢ç®—æ³•åœ¨å¹³æ»‘åº¦å’Œçµæ•åº¦ä¹‹é—´å­˜åœ¨çš„å†²çªè€Œæå‡ºçš„ä¸€ç§æ–¹æ³•ã€‚ç®—æœ¯å¹³å‡æ»¤æ³¢åœ¨å¹³æ»‘æ•°æ®æ—¶å¯èƒ½ä¼šä¸¢å¤±ä¸€äº›é‡è¦çš„ç»†èŠ‚ï¼Œè€ŒåŠ æƒå¹³å‡æ»¤æ³¢åˆ™é€šè¿‡èµ‹äºˆä¸åŒé‡‡æ ·å€¼ä¸åŒçš„é‡è¦æ€§æ¥æ”¹å–„è¿™ä¸€é—®é¢˜ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒçš„åŸç†æ˜¯å¯¹äºè¿ç»­ N æ¬¡é‡‡æ ·å€¼ï¼Œåˆ†åˆ«ä¹˜ä»¥ä¸åŒçš„åŠ æƒç³»æ•°ï¼Œç„¶åæ±‚å‡ºè¿™äº›åŠ æƒå€¼çš„åŠ å’Œã€‚åŠ æƒç³»æ•°çš„ç‰¹ç‚¹æ˜¯ä¸€èˆ¬é‡‡ç”¨ä»å°åˆ°å¤§çš„åˆ†é…æ–¹å¼ï¼Œä»¥å¢å¼ºå¯¹åç»­é‡‡æ ·å€¼çš„å…³æ³¨ï¼Œä»è€Œæ›´æœ‰æ•ˆåœ°æ•æ‰åˆ°æ•°æ®å˜åŒ–çš„è¶‹åŠ¿ã€‚ åŠ æƒç³»æ•°é€šå¸¸æ˜¯å°äº 1 çš„å®æ•°ï¼Œå¹¶ä¸”å®ƒä»¬çš„æ€»å’Œå¿…é¡»ç­‰äº 1ã€‚è¿™ä¸€è®¾ç½®ç¡®ä¿äº†åŠ æƒè¿ç®—åçš„ç»“æœä»ç„¶æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„é‡‡æ ·å€¼ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ 5 ä¸ªé‡‡æ ·å€¼ï¼Œå…¶å¯¹åº”çš„åŠ æƒç³»æ•°æ˜¯ 0.1ã€0.2ã€0.3ã€0.4ã€0.0ï¼Œé‚£ä¹ˆè¿™äº›ç³»æ•°çš„æ€»å’Œä¸º 1.0ï¼Œèƒ½å¤Ÿæœ‰æ•ˆæå‡æœ€è¿‘å‡ æ¬¡çš„é‡‡æ ·åœ¨æœ€ç»ˆç»“æœä¸­çš„å½±å“åŠ›ã€‚ åŠ æƒå¹³å‡æ•°å­—æ»¤æ³¢çš„æ•°å­¦æ¨¡å‹å¯ä»¥è¡¨ç¤ºä¸ºï¼š [ D \\sum_{i0}^{N-1} C_i X_{N-i} ] å…¶ä¸­ï¼š ( D ) ä¸º N ä¸ªé‡‡æ ·å€¼çš„åŠ æƒå¹³å‡å€¼ï¼› ( X_{N-i} ) ä¸ºç¬¬ ( N-i ) æ¬¡é‡‡æ ·å€¼ï¼› ( N ) ä¸ºé‡‡æ ·æ¬¡æ•°ï¼› ( C_i ) ä¸ºåŠ æƒç³»æ•°ã€‚ åœ¨å…¬å¼ä¸­ï¼ŒåŠ æƒç³»æ•° ( C_i ) æ˜¾ç¤ºäº†å„ä¸ªé‡‡æ ·å€¼åœ¨æœ€ç»ˆå¹³å‡å€¼ä¸­æ‰€å çš„æ¯”ä¾‹ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¶Šé åçš„é‡‡æ ·å€¼ï¼Œå…¶å¯¹åº”çš„åŠ æƒå€¼ä¼šè¶Šå¤§ï¼Œè¿™ç§ç­–ç•¥æœ‰åŠ©äºå¢åŠ æ–°è¿‘æ•°æ®åœ¨æœ€ç»ˆç»“æœä¸­çš„é‡è¦æ€§ï¼Œä»è€Œæ›´æ•æ„Ÿåœ°åæ˜ é‡‡æ ·å€¼çš„å˜åŒ–ã€‚ åŠ æƒå¹³å‡æ»¤æ³¢æ–¹æ³•çš„æ ¸å¿ƒåœ¨äºå®ƒèƒ½å¤Ÿä»ä¼—å¤šä¿¡å·ä¸­çªå‡ºä¸€ä¸ªç‰¹å®šä¿¡å·ï¼ŒåŒæ—¶å‹åˆ¶å…¶ä»–éƒ¨åˆ†çš„ä¿¡å·ï¼Œä»è€Œæé«˜å¯¹å‚æ•°å˜åŒ–çš„æ„ŸçŸ¥èƒ½åŠ›å’Œä¿¡å·å¤„ç†çš„æ•ˆç‡ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®ç°åŠ æƒå¹³å‡æ»¤æ³¢çš„æ ·ä¾‹ç¨‹åºä»£ç ï¼š char jq[N] = 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12; // åŠ æƒç³»æ•°è¡¨ï¼Œå­˜æ”¾äºç¨‹åºå­˜å‚¨åŒºchar sum_jq = 1 + 2 + 3 + 4 + 5 + 6 + 7 + 8 + 9 + 10 + 11 + 12; // è®¡ç®—åŠ æƒç³»æ•°çš„æ€»å’Œchar filter() char count; char value_buff[N]; // å­˜å‚¨è·å–åˆ°çš„é‡‡æ ·å€¼ int sum = 0; // ç”¨äºå­˜å‚¨åŠ æƒå’Œ // è·å– N æ¬¡é‡‡æ ·å€¼ for (count = 0; count N; count++) value_buff[count] = get_data(); // ä»å¤–éƒ¨è·å–æ•°æ® delay(); // ç­‰å¾…ä¸€å®šæ—¶é—´ä»¥ç¨³å®šæ•°æ® // è®¡ç®—åŠ æƒå’Œ for (count = 0; count N; count++) sum += value_buff[count] * jq[count]; // æ¯ä¸ªé‡‡æ ·å€¼ä¹˜ä»¥å…¶å¯¹åº”çš„æƒé‡ return (char)(sum / sum_jq); // è¿”å›åŠ æƒå¹³å‡å€¼ åœ¨è¿™æ®µä»£ç ä¸­ï¼Œjq æ•°ç»„åŒ…å«äº†åŠ æƒç³»æ•°ï¼Œè€Œ get_data() å‡½æ•°è´Ÿè´£è·å–å®é™…çš„é‡‡æ ·å€¼ã€‚è¿™ç§å®ç°æ–¹å¼ç¡®ä¿äº†ç¨‹åºèƒ½å¤Ÿçµæ´»å¤„ç†æ•°æ®å¹¶æœ‰æ•ˆæå–å‡ºé‡è¦ä¿¡å·ï¼Œè¿›è€Œè·å¾—æœŸæœ›çš„æ»¤æ³¢æ•ˆæœã€‚ ä½é€šæ»¤æ³¢ä½é€šæ»¤æ³¢æ˜¯ä¿¡å·å¤„ç†ä¸­çš„ä¸€ç§é‡è¦æŠ€æœ¯ï¼Œå…¶ä½œç”¨åœ¨äºå»é™¤é«˜é¢‘å™ªå£°ï¼ŒåŒæ—¶ä¿ç•™ä½é¢‘ä¿¡å·ã€‚ä¸ºäº†å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œæ™®é€šçš„ç¡¬ä»¶ RC ä½é€šæ»¤æ³¢å™¨å¯é€šè¿‡å¾®åˆ†æ–¹ç¨‹è¡¨ç¤ºã€‚ç„¶è€Œï¼Œé€šè¿‡ä½¿ç”¨å·®åˆ†æ–¹ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨è½¯ä»¶ç®—æ³•æ¨¡æ‹Ÿç¡¬ä»¶æ»¤æ³¢çš„æ•ˆæœã€‚ç»è¿‡æ¨å¯¼ï¼Œæœ€ç»ˆå¾—åˆ°ä½é€šæ»¤æ³¢çš„ç®—æ³•å¦‚ä¸‹ï¼š Yn = a * Xn + (1 - a) * Yn-1 åœ¨ä¸Šè¿°å…¬å¼ä¸­ï¼š Xn è¡¨ç¤ºæœ¬æ¬¡çš„é‡‡æ ·å€¼ã€‚ Yn-1 æ˜¯ä¸Šæ¬¡çš„æ»¤æ³¢è¾“å‡ºå€¼ã€‚ a æ˜¯æ»¤æ³¢ç³»æ•°ï¼Œé€šå¸¸å…¶å€¼è¿œå°äº 1ï¼Œå†³å®šäº†å½“å‰é‡‡æ ·å¯¹è¾“å‡ºçš„å½±å“ç¨‹åº¦ã€‚ Yn æ˜¯æœ¬æ¬¡æ»¤æ³¢çš„è¾“å‡ºå€¼ã€‚ ä»å…¬å¼ä¸­ï¼Œå¯ä»¥çœ‹å‡ºï¼Œæœ¬æ¬¡çš„æ»¤æ³¢è¾“å‡ºå€¼ä¸»è¦ä¾èµ–äºä¸Šæ¬¡çš„è¾“å‡ºå€¼ï¼Œè€Œä¸æ˜¯ç›´æ¥åŸºäºä¸Šæ¬¡çš„é‡‡æ ·å€¼ã€‚è¿™ä¸€ç‰¹æ€§ä½¿å¾—è¯¥ç®—æ³•ä¸åŠ æƒå¹³å‡æ»¤æ³¢æœ‰äº†æœ¬è´¨çš„åŒºåˆ«ï¼šåŠ æƒå¹³å‡æ»¤æ³¢ä¼šç›´æ¥ç»“åˆæ‰€æœ‰è¿‡å»çš„é‡‡æ ·å€¼ç»™äºˆæƒé‡ï¼Œè€Œæ­¤ç®—æ³•å¼ºè°ƒäº†è¿‡å»è¾“å‡ºçš„æŒç»­å½±å“ã€‚è¿™ä½¿å¾—ä½é€šæ»¤æ³¢å™¨åœ¨ä¿¡å·å¤„ç†æ—¶èƒ½å¤Ÿæœ‰æ•ˆåœ°å‡å°‘å› å¿«é€Ÿå˜åŒ–å¼•èµ·çš„æ³¢åŠ¨ï¼Œä»è€Œå®ç°å¹³æ»‘æ•ˆæœã€‚ åŒæ ·é‡è¦çš„æ˜¯ï¼Œä½é€šæ»¤æ³¢çš„æˆªæ­¢é¢‘ç‡å¯ä»¥é€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š fL = a / (2 * Ï€ * t) ï¼ˆå…¶ä¸­ Ï€ çº¦ç­‰äº 3.14ï¼‰ åœ¨è¿™ä¸ªå…¬å¼ä¸­ï¼š a æ˜¯æ»¤æ³¢ç³»æ•°ã€‚ t æ˜¯é‡‡æ ·é—´éš”æ—¶é—´ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾é‡‡æ ·é—´éš”æ—¶é—´ t ä¸º 0.5 ç§’ï¼ˆå³æ¯ç§’é‡‡æ · 2 æ¬¡ï¼‰ï¼Œä¸”è®¾å®š a ä¸º 132ï¼Œåˆ™å¯ä»¥è¿™æ ·è®¡ç®—æˆªæ­¢é¢‘ç‡ï¼š fL = (1/32) / (2 * 3.14 * 0.5) = 0.01 Hz å½“ç›®æ ‡å‚æ•°æ˜¯å˜åŒ–å¾ˆæ…¢çš„ç‰©ç†é‡æ—¶ï¼Œè¯¥æ»¤æ³¢ç®—æ³•æ˜¾å¾—ç‰¹åˆ«æœ‰æ•ˆï¼Œå®ƒèƒ½å¤Ÿæœ‰æ•ˆåœ°å°†é«˜é¢‘å™ªå£°è¿‡æ»¤æ‰ï¼Œæé«˜ä¿¡å·çš„ç¨³å®šæ€§ã€‚ç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¯¥ç®—æ³•æ— æ³•æ»¤é™¤é«˜äº 12 é‡‡æ ·é¢‘ç‡çš„å¹²æ‰°ä¿¡å·ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œç”±äºé‡‡æ ·é¢‘ç‡ä¸º 2Hzï¼Œå› æ­¤å¯¹äº 1Hz ä»¥ä¸Šçš„å¹²æ‰°ä¿¡å·ï¼Œéœ€è¦é‡‡ç”¨å…¶ä»–æ›´å¼ºçš„æ»¤æ³¢æ–¹æ³•åŠ ä»¥å¤„ç†ã€‚ è™½ç„¶ä½é€šæ»¤æ³¢ç®—æ³•ä¸åŠ æƒå¹³å‡æ»¤æ³¢å­˜åœ¨ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†åŠ æƒç³»æ•°ä»…æœ‰ä¸¤ä¸ªï¼ša å’Œ 1-aã€‚ä¸ºç®€åŒ–è®¡ç®—ï¼Œå¯ä»¥å°† a å–ä¸ºä¸€ä¸ªæ•´æ•°ï¼Œè€Œå°† 1-a ç”¨ 256-a æ¥æ›¿ä»£ï¼Œä»è€Œé¿å…å¤æ‚çš„æµ®ç‚¹è¿ç®—ã€‚ä¸ºäº†ç¡®ä¿è®¡ç®—çš„å‡†ç¡®æ€§ï¼Œè¿‡æ»¤è¾“å‡ºå€¼ä½¿ç”¨åŒå­—èŠ‚è¡¨ç¤ºï¼Œå…¶ä¸­ä¸€ä¸ªå­—èŠ‚å­˜å‚¨æ•´æ•°éƒ¨åˆ†ï¼Œå¦ä¸€ä¸ªå­—èŠ‚å­˜å‚¨å°æ•°éƒ¨åˆ†ã€‚è¿™ç§è®¾è®¡é¿å…äº†å› æ¯æ¬¡è®¡ç®—æ—¶èˆå»å°¾æ•°è€Œå¼•èµ·çš„è¾“å‡ºä¸å˜é—®é¢˜ï¼Œç¡®ä¿äº†æ»¤æ³¢çš„æœ‰æ•ˆæ€§ã€‚ é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå¯ä»¥åœ¨è½¯ä»¶ä¸­æœ‰æ•ˆå®ç°ä½é€šæ»¤æ³¢å™¨çš„åŠŸèƒ½ï¼Œé«˜æ•ˆåœ°å¤„ç†å’Œä¼˜åŒ–ä¿¡å·ï¼Œæ»¡è¶³å„ç§æ•°æ®å¤„ç†éœ€æ±‚ã€‚ å¡å°”æ›¼æ»¤æ³¢å¡å°”æ›¼æ»¤æ³¢å™¨æ˜¯ä¸€ä¸ª â€œoptimalrecursivedataprocessingalgorithmï¼ˆæœ€ä¼˜åŒ–è‡ªå›å½’æ•°æ®å¤„ç†ç®—æ³•ï¼‰â€ã€‚å¯¹äºè§£å†³å¾ˆå¤§éƒ¨åˆ†çš„é—®é¢˜ï¼Œä»–æ˜¯æœ€ä¼˜ï¼Œæ•ˆç‡æœ€é«˜ç”šè‡³æ˜¯æœ€æœ‰ç”¨çš„ã€‚ å‡è®¾è¦ç ”ç©¶çš„å¯¹è±¡æ˜¯ä¸€ä¸ªæˆ¿é—´çš„æ¸©åº¦ã€‚æ ¹æ®çš„ç»éªŒåˆ¤æ–­ï¼Œè¿™ä¸ªæˆ¿é—´çš„æ¸©åº¦æ˜¯æ’å®šçš„ï¼Œä¹Ÿå°±æ˜¯ä¸‹ä¸€åˆ†é’Ÿçš„æ¸©åº¦ç­‰äºç°åœ¨è¿™ä¸€åˆ†é’Ÿçš„æ¸©åº¦ï¼ˆå‡è®¾ç”¨ä¸€åˆ†é’Ÿæ¥åšæ—¶é—´å•ä½ï¼‰ï¼ˆè¿™é‡Œçš„å‡è®¾ç›¸å½“äºçŠ¶æ€æ–¹ç¨‹çš„ç³»æ•° A ä¸º 1ï¼‰ã€‚å‡è®¾å¯¹çš„ç»éªŒä¸æ˜¯ 100%çš„ç›¸ä¿¡ï¼Œå¯èƒ½ä¼šæœ‰ä¸Šä¸‹åå·®å‡ åº¦ã€‚æŠŠè¿™äº›åå·®çœ‹æˆæ˜¯é«˜æ–¯ç™½å™ªå£°ï¼ˆWhite GaussianNoiseï¼‰ï¼ˆè¿™é‡Œå°±æ˜¯ W(k)ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¿™äº›åå·®è·Ÿå‰åæ—¶é—´æ˜¯æ²¡æœ‰å…³ç³»çš„è€Œä¸”ç¬¦åˆé«˜æ–¯åˆ†é…ï¼ˆGaussian Distributionï¼‰ã€‚å¦å¤–åœ¨æˆ¿é—´é‡Œæ”¾ä¸€ä¸ªæ¸©åº¦è®¡ï¼Œä½†æ˜¯è¿™ä¸ªæ¸©åº¦è®¡ä¹Ÿä¸å‡†ç¡®çš„ï¼Œæµ‹é‡å€¼ä¼šæ¯”å®é™…å€¼åå·®ã€‚ä¹ŸæŠŠè¿™äº›åå·®çœ‹æˆæ˜¯é«˜æ–¯ç™½å™ªå£°ã€‚ï¼ˆæ¸©åº¦è®¡çš„æµ‹é‡å€¼å°±æ˜¯ Z(k),è€Œç”±äºæ¸©åº¦æµ‹åˆ°çš„æ¸©åº¦å°±æ˜¯æ¸©åº¦ï¼Œä¸ç”¨å†æ¢ç®—ï¼Œæ‰€ä»¥ç³»æ•° H å°±æ˜¯ 1ï¼Œåå·®å°±æ˜¯ V(k)ï¼‰å¥½äº†ï¼Œç°åœ¨å¯¹äºæŸä¸€åˆ†é’Ÿæœ‰ä¸¤ä¸ªæœ‰å…³äºè¯¥æˆ¿é—´çš„æ¸©åº¦å€¼ï¼šæ ¹æ®ç»éªŒçš„é¢„æµ‹å€¼ï¼ˆç³»ç»Ÿçš„é¢„æµ‹å€¼ X(k|k-1)ï¼‰å’Œæ¸©åº¦è®¡çš„å€¼ï¼ˆæµ‹é‡å€¼ Z(k)ï¼‰ã€‚ä¸‹é¢è¦ç”¨è¿™ä¸¤ä¸ªå€¼ç»“åˆä»–ä»¬å„è‡ªçš„å™ªå£°æ¥ä¼°ç®—å‡ºæˆ¿é—´çš„å®é™…æ¸©åº¦å€¼ã€‚ å‡å¦‚è¦ä¼°ç®— k æ—¶åˆ»çš„æ˜¯å®é™…æ¸©åº¦å€¼ã€‚é¦–å…ˆè¦æ ¹æ® k-1 æ—¶åˆ»çš„æ¸©åº¦å€¼ï¼Œæ¥é¢„æµ‹ k æ—¶åˆ»çš„æ¸©åº¦ã€‚å› ä¸ºç›¸ä¿¡æ¸©åº¦æ˜¯æ’å®šçš„ï¼Œæ‰€ä»¥ä¼šå¾—åˆ° k æ—¶åˆ»çš„æ¸©åº¦é¢„æµ‹å€¼æ˜¯è·Ÿ k-1 æ—¶åˆ»ä¸€æ ·çš„ï¼Œå‡è®¾æ˜¯ 23 åº¦ï¼ŒåŒæ—¶è¯¥å€¼çš„é«˜æ–¯å™ªå£°çš„åå·®æ˜¯ 5 åº¦ï¼ˆ5 æ˜¯è¿™æ ·å¾—åˆ°çš„ï¼šå¦‚æœ k-1 æ—¶åˆ»ä¼°ç®—å‡ºçš„æœ€ä¼˜æ¸©åº¦å€¼çš„åå·®ï¼ˆp(k-1|k-1)å°±æ˜¯ä¸Šä¸€æ—¶åˆ»çš„ p(k|k)ï¼‰æ˜¯ 3ï¼Œå¯¹è‡ªå·±é¢„æµ‹çš„ä¸ç¡®å®šåº¦æ˜¯ 4 åº¦ï¼Œä»–ä»¬å¹³æ–¹ç›¸åŠ å†å¼€æ–¹ï¼Œå°±æ˜¯ 5ï¼ˆç®—å‡ºæ¥çš„å°±æ˜¯ P(k|k-1)ï¼‰ï¼‰ã€‚ç„¶åï¼Œä»æ¸©åº¦è®¡é‚£é‡Œå¾—åˆ°äº† k æ—¶åˆ»çš„æ¸©åº¦å€¼ï¼ˆæµ‹é‡å€¼ Z(k)ï¼‰ï¼Œå‡è®¾æ˜¯ 25 åº¦ï¼ŒåŒæ—¶è¯¥å€¼çš„åå·®æ˜¯ 4 åº¦ã€‚ç”±äºç”¨äºä¼°ç®— k æ—¶åˆ»çš„å®é™…æ¸©åº¦æœ‰ä¸¤ä¸ªæ¸©åº¦å€¼ï¼Œåˆ†åˆ«æ˜¯ 23 åº¦å’Œ 25 åº¦ã€‚ç©¶ç«Ÿå®é™…æ¸©åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿç›¸ä¿¡è‡ªå·±è¿˜æ˜¯ç›¸ä¿¡æ¸©åº¦è®¡å‘¢ï¼Ÿç©¶ç«Ÿç›¸ä¿¡è°å¤šä¸€ç‚¹ï¼Œå¯ä»¥ç”¨ä»–ä»¬çš„ covarianceï¼ˆåæ–¹å·®ï¼‰æ¥åˆ¤æ–­ã€‚å› ä¸º `Kg^2=5^2/(5^2+4^2)`ï¼Œæ‰€ä»¥ ` Kg=0.78`ï¼Œå¯ä»¥ä¼°ç®—å‡º k æ—¶åˆ»çš„å®é™…æ¸©åº¦å€¼æ˜¯ï¼š`23+0.78*(25-23)=24.56` åº¦ã€‚å¯ä»¥çœ‹å‡ºï¼Œå› ä¸ºæ¸©åº¦è®¡çš„ covariance æ¯”è¾ƒå°ï¼ˆæ¯”è¾ƒç›¸ä¿¡æ¸©åº¦è®¡ï¼‰ï¼Œæ‰€ä»¥ä¼°ç®—å‡ºçš„æœ€ä¼˜æ¸©åº¦å€¼åå‘æ¸©åº¦è®¡çš„å€¼ã€‚ ç°åœ¨å·²ç»å¾—åˆ° k æ—¶åˆ»çš„æœ€ä¼˜æ¸©åº¦å€¼äº†ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è¦è¿›å…¥ k+1 æ—¶åˆ»ï¼Œè¿›è¡Œæ–°çš„æœ€ä¼˜ä¼°ç®—ã€‚åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œå¥½åƒè¿˜æ²¡çœ‹åˆ°ä»€ä¹ˆè‡ªå›å½’çš„ä¸œè¥¿å‡ºç°ã€‚å¯¹äº†ï¼Œåœ¨è¿›å…¥ k+1 æ—¶åˆ»ä¹‹å‰ï¼Œè¿˜è¦ç®—å‡º k æ—¶åˆ»é‚£ä¸ªæœ€ä¼˜å€¼ï¼ˆ24.56 åº¦ï¼‰çš„åå·®ã€‚ç®—æ³•å¦‚ä¸‹ï¼š((1-Kg)*5^2)^0.5=2.35ã€‚è¿™é‡Œçš„ 5 å°±æ˜¯ä¸Šé¢çš„ k æ—¶åˆ»é¢„æµ‹çš„é‚£ä¸ª 23 åº¦æ¸©åº¦å€¼çš„åå·®ï¼Œå¾—å‡ºçš„ 2.35 å°±æ˜¯è¿›å…¥ k+1 æ—¶åˆ»ä»¥å k æ—¶åˆ»ä¼°ç®—å‡ºçš„æœ€ä¼˜æ¸©åº¦å€¼çš„åå·®ï¼ˆå¯¹åº”äºä¸Šé¢çš„ 3ï¼‰ã€‚ å°±æ˜¯è¿™æ ·ï¼Œå¡å°”æ›¼æ»¤æ³¢å™¨å°±ä¸æ–­çš„æŠŠ covariance é€’å½’ï¼Œä»è€Œä¼°ç®—å‡ºæœ€ä¼˜çš„æ¸©åº¦å€¼ã€‚ä»–è¿è¡Œçš„å¾ˆå¿«ï¼Œè€Œä¸”å®ƒåªä¿ç•™äº†ä¸Šä¸€æ—¶åˆ»çš„ covarianceã€‚ä¸Šé¢çš„ Kgï¼Œå°±æ˜¯å¡å°”æ›¼å¢ç›Šï¼ˆKalman Gainï¼‰ã€‚ kalman æ»¤æ³¢å™¨ç®—æ³•é¦–å…ˆï¼Œå…ˆè¦å¼•å…¥ä¸€ä¸ªç¦»æ•£æ§åˆ¶è¿‡ç¨‹çš„ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿå¯ç”¨ä¸€ä¸ªçº¿æ€§éšæœºå¾®åˆ†æ–¹ç¨‹ï¼ˆLinear Stochastic Difference equationï¼‰æ¥æè¿°ï¼š x(k)æ˜¯ k æ—¶åˆ»çš„ç³»ç»ŸçŠ¶æ€ï¼Œu(k)æ˜¯ k æ—¶åˆ»å¯¹ç³»ç»Ÿçš„æ§åˆ¶é‡ã€‚A å’Œ B æ˜¯ç³»ç»Ÿå‚æ•°ï¼Œå¯¹äºå¤šæ¨¡å‹ç³»ç»Ÿï¼Œä»–ä»¬ä¸ºçŸ©é˜µã€‚y(k)æ˜¯ k æ—¶åˆ»çš„æµ‹é‡å€¼ï¼ŒH æ˜¯æµ‹é‡ç³»ç»Ÿçš„å‚æ•°ï¼Œå¯¹äºå¤šæµ‹é‡ç³»ç»Ÿï¼ŒH ä¸ºçŸ©é˜µã€‚q(k)å’Œ r(k)åˆ†åˆ«è¡¨ç¤ºè¿‡ç¨‹å’Œæµ‹é‡çš„å™ªå£°ã€‚ä»–ä»¬è¢«å‡è®¾æˆé«˜æ–¯ç™½å™ªå£°(White Gaussian Noise)ï¼Œä»–ä»¬çš„ covariance åˆ†åˆ«æ˜¯ Qï¼ŒRï¼ˆè¿™é‡Œå‡è®¾ä»–ä»¬ä¸éšç³»ç»ŸçŠ¶æ€å˜åŒ–è€Œå˜åŒ–ï¼‰ã€‚ å¯¹äºæ»¡è¶³ä¸Šé¢çš„æ¡ä»¶(çº¿æ€§éšæœºå¾®åˆ†ç³»ç»Ÿï¼Œè¿‡ç¨‹å’Œæµ‹é‡éƒ½æ˜¯é«˜æ–¯ç™½å™ªå£°)ï¼Œå¡å°”æ›¼æ»¤æ³¢å™¨æ˜¯æœ€ä¼˜çš„ä¿¡æ¯å¤„ç†å™¨ã€‚ä¸‹å›¾ç»™å‡º KF ç®—æ³•çš„æµç¨‹å’Œäº”ä¸ªæ ¸å¿ƒæ›´æ–°æ–¹ç¨‹å¦‚ä¸‹ï¼š ä¸‹é¢æ¥ç»“åˆ covariances æ¥ä¼°ç®—ç³»ç»Ÿçš„æœ€ä¼˜åŒ–è¾“å‡ºï¼ˆç±»ä¼¼ä¸Šä¸€èŠ‚é‚£ä¸ªæ¸©åº¦çš„ä¾‹å­ï¼‰ã€‚é¦–å…ˆè¦åˆ©ç”¨ç³»ç»Ÿçš„è¿‡ç¨‹æ¨¡å‹ï¼Œæ¥é¢„æµ‹ä¸‹ä¸€çŠ¶æ€çš„ç³»ç»Ÿã€‚å‡è®¾ç°åœ¨çš„ç³»ç»ŸçŠ¶æ€æ˜¯ kï¼Œæ ¹æ®ç³»ç»Ÿçš„æ¨¡å‹ï¼Œå¯ä»¥åŸºäºç³»ç»Ÿçš„ä¸Šä¸€çŠ¶æ€è€Œé¢„æµ‹å‡ºç°åœ¨çŠ¶æ€ï¼š X(k|k-1)=A X(k-1|k-1)+B U(k) â€¦â€¦â€¦.. (1) å¼(1)ä¸­ï¼ŒX(k|k-1)æ˜¯åˆ©ç”¨ä¸Šä¸€çŠ¶æ€é¢„æµ‹çš„ç»“æœï¼ŒX(k-1|k-1)æ˜¯ä¸Šä¸€çŠ¶æ€æœ€ä¼˜çš„ç»“æœï¼ŒU(k)ä¸ºç°åœ¨çŠ¶æ€çš„æ§åˆ¶é‡ï¼Œå¦‚æœæ²¡æœ‰æ§åˆ¶é‡ï¼Œå®ƒå¯ä»¥ä¸º 0ã€‚ åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œçš„ç³»ç»Ÿç»“æœå·²ç»æ›´æ–°äº†ï¼Œå¯æ˜¯ï¼Œå¯¹åº”äº X(k|k-1)çš„ covariance è¿˜æ²¡æ›´æ–°ã€‚ç”¨ P è¡¨ç¤º covarianceï¼š P(k|k-1)=A P(k-1|k-1) Aâ€™+Q â€¦â€¦â€¦ (2) å¼(2)ä¸­ï¼ŒP(k|k-1)æ˜¯ X(k|k-1)å¯¹åº”çš„ covarianceï¼ŒP(k-1|k-1)æ˜¯ X(k-1|k-1)å¯¹åº”çš„ covarianceï¼ŒAâ€™è¡¨ç¤º A çš„è½¬ç½®çŸ©é˜µï¼ŒQ æ˜¯ç³»ç»Ÿè¿‡ç¨‹çš„ covarianceã€‚å¼å­ 1ï¼Œ2 å°±æ˜¯å¡å°”æ›¼æ»¤æ³¢å™¨ 5 ä¸ªå…¬å¼å½“ä¸­çš„å‰ä¸¤ä¸ªï¼Œä¹Ÿå°±æ˜¯å¯¹ç³»ç»Ÿçš„é¢„æµ‹ã€‚ ç°åœ¨æœ‰äº†ç°åœ¨çŠ¶æ€çš„é¢„æµ‹ç»“æœï¼Œç„¶åå†æ”¶é›†ç°åœ¨çŠ¶æ€çš„æµ‹é‡å€¼ã€‚ç»“åˆé¢„æµ‹å€¼å’Œæµ‹é‡å€¼ï¼Œå¯ä»¥å¾—åˆ°ç°åœ¨çŠ¶æ€(k)çš„æœ€ä¼˜åŒ–ä¼°ç®—å€¼ X(k|k)ï¼š X(k|k)= X(k|k-1)+Kg(k) (Z(k)-H X(k|k-1)) â€¦â€¦â€¦ (3) å…¶ä¸­ Kg ä¸ºå¡å°”æ›¼å¢ç›Š(Kalman Gain)ï¼š Kg(k)= P(k|k-1) Hâ€™ / (H P(k|k-1) Hâ€™ + R) â€¦â€¦â€¦ (4) åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œå·²ç»å¾—åˆ°äº† k çŠ¶æ€ä¸‹æœ€ä¼˜çš„ä¼°ç®—å€¼ X(k|k)ã€‚ä½†æ˜¯ä¸ºäº†è¦å¦å¡å°”æ›¼æ»¤æ³¢å™¨ä¸æ–­çš„è¿è¡Œä¸‹å»ç›´åˆ°ç³»ç»Ÿè¿‡ç¨‹ç»“æŸï¼Œè¿˜è¦æ›´æ–° k çŠ¶æ€ä¸‹ X(k|k)çš„ covarianceï¼š P(k|k)=ï¼ˆI-Kg(k) Hï¼‰P(k|k-1) â€¦â€¦â€¦ (5) å…¶ä¸­ I ä¸º 1 çš„çŸ©é˜µï¼Œå¯¹äºå•æ¨¡å‹å•æµ‹é‡ï¼ŒI1ã€‚å½“ç³»ç»Ÿè¿›å…¥ k+1 çŠ¶æ€æ—¶ï¼ŒP(k|k)å°±æ˜¯å¼å­(2)çš„ P(k-1|k1)ã€‚è¿™æ ·ï¼Œç®—æ³•å°±å¯ä»¥è‡ªå›å½’çš„è¿ç®—ä¸‹å»ã€‚ å¡å°”æ›¼æ»¤æ³¢å™¨çš„åŸç†åŸºæœ¬æè¿°äº†ï¼Œå¼å­ 1ï¼Œ2ï¼Œ3ï¼Œ4 å’Œ 5 å°±æ˜¯ä»–çš„ 5 ä¸ªåŸºæœ¬å…¬å¼ã€‚æ ¹æ®è¿™ 5 ä¸ªå…¬å¼ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„å®ç°è®¡ç®—æœºçš„ç¨‹åºã€‚ kalman å®ç°æŠŠæˆ¿é—´çœ‹æˆä¸€ä¸ªç³»ç»Ÿï¼Œç„¶åå¯¹è¿™ä¸ªç³»ç»Ÿå»ºæ¨¡ã€‚å½“ç„¶ï¼Œè§çš„æ¨¡å‹ä¸éœ€è¦éå¸¸åœ°ç²¾ç¡®ã€‚æ‰€çŸ¥é“çš„è¿™ä¸ªæˆ¿é—´çš„æ¸©åº¦æ˜¯è·Ÿå‰ä¸€æ—¶åˆ»çš„æ¸©åº¦ç›¸åŒçš„ï¼Œæ‰€ä»¥ A1ã€‚æ²¡æœ‰æ§åˆ¶é‡ï¼Œæ‰€ä»¥ U(k)0ã€‚å› æ­¤å¾—å‡ºï¼š X(k|k-1)=X(k-1|k-1) â€¦â€¦â€¦.. (6) å¼å­ï¼ˆ2ï¼‰å¯ä»¥æ”¹æˆï¼š P(k|k-1)=P(k-1|k-1) +Q â€¦â€¦â€¦ (7) å› ä¸ºæµ‹é‡çš„å€¼æ˜¯æ¸©åº¦è®¡çš„ï¼Œè·Ÿæ¸©åº¦ç›´æ¥å¯¹åº”ï¼Œæ‰€ä»¥ H1ã€‚å¼å­ 3ï¼Œ4ï¼Œ5 å¯ä»¥æ”¹æˆä»¥ä¸‹ï¼š X(k|k)= X(k|k-1)+Kg(k) (Z(k)-X(k|k-1)) â€¦â€¦â€¦ (8)Kg(k)= P(k|k-1) / (P(k|k-1) + R) â€¦â€¦â€¦ (9)P(k|k)=ï¼ˆ1-Kg(k)ï¼‰P(k|k-1) â€¦â€¦â€¦ (10) ç°åœ¨æ¨¡æ‹Ÿä¸€ç»„æµ‹é‡å€¼ä½œä¸ºè¾“å…¥ã€‚å‡è®¾æˆ¿é—´çš„çœŸå®æ¸©åº¦ä¸º 25 åº¦ï¼Œæ¨¡æ‹Ÿäº† 200 ä¸ªæµ‹é‡å€¼ï¼Œè¿™äº›æµ‹é‡å€¼çš„å¹³å‡å€¼ä¸º 25 åº¦ï¼Œä½†æ˜¯åŠ å…¥äº†æ ‡å‡†åå·®ä¸ºå‡ åº¦çš„é«˜æ–¯ç™½å™ªå£°ï¼ˆåœ¨å›¾ä¸­ä¸ºè“çº¿ï¼‰ã€‚ ä¸ºäº†ä»¤å¡å°”æ›¼æ»¤æ³¢å™¨å¼€å§‹å·¥ä½œï¼Œéœ€è¦å‘Šè¯‰å¡å°”æ›¼ä¸¤ä¸ªé›¶æ—¶åˆ»çš„åˆå§‹å€¼ï¼Œæ˜¯ X(0|0)å’Œ P(0|0)ã€‚ä»–ä»¬çš„å€¼ä¸ç”¨å¤ªåœ¨æ„ï¼Œéšä¾¿ç»™ä¸€ä¸ªå°±å¯ä»¥äº†ï¼Œå› ä¸ºéšç€å¡å°”æ›¼çš„å·¥ä½œï¼ŒX ä¼šé€æ¸çš„æ”¶æ•›ã€‚ä½†æ˜¯å¯¹äº Pï¼Œä¸€èˆ¬ä¸è¦å– 0ï¼Œå› ä¸ºè¿™æ ·å¯èƒ½ä¼šä»¤å¡å°”æ›¼å®Œå…¨ç›¸ä¿¡ç»™å®šçš„ X(0|0)æ˜¯ç³»ç»Ÿæœ€ä¼˜çš„ï¼Œä»è€Œä½¿ç®—æ³•ä¸èƒ½æ”¶æ•›ã€‚é€‰äº† X(0|0)1 åº¦ï¼ŒP(0|0)10ã€‚ è¯¥ç³»ç»Ÿçš„çœŸå®æ¸©åº¦ä¸º 25 åº¦ï¼Œå›¾ä¸­ç”¨é»‘çº¿è¡¨ç¤ºã€‚å›¾ä¸­çº¢çº¿æ˜¯å¡å°”æ›¼æ»¤æ³¢å™¨è¾“å‡ºçš„æœ€ä¼˜åŒ–ç»“æœï¼ˆè¯¥ç»“æœåœ¨ç®—æ³•ä¸­è®¾ç½®äº† Q1e-6ï¼ŒR1e-1ï¼‰ã€‚ matlab ä¸‹é¢çš„ kalman æ»¤æ³¢ç¨‹åºï¼š clearN=200;w(1)=0;w=randn(1,N)x(1)=0;a=1;for k=2:N;x(k)=a*x(k-1)+w(k-1);endV=randn(1,N);q1=std(V);Rvv=q1.^2;q2=std(x);Rxx=q2.^2;q3=std(w);Rww=q3.^2;c=0.2;Y=c*x+V;p(1)=0;s(1)=0;for t=2:N;p1(t)=a.^2*p(t-1)+Rww;b(t)=c*p1(t)/(c.^2*p1(t)+Rvv);s(t)=a*s(t-1)+b(t)*(Y(t)-a*c*s(t-1));p(t)=p1(t)-c*b(t)*p1(t);endt=1:N;plot(t,s,r,t,Y,g,t,x,b); Kalman è¿‡ç¨‹è¯¦è§£ï¼š é¢„æµ‹ï¼šåšå‡ºå…ˆéªŒä¼°è®¡ x[n|n-1]=A*x[n-1|n-1] ã€å¯¹äºä¸€ç»´çš„æƒ…å†µï¼ŒA å¯ä»¥çœ‹æˆä¸€ä¸ªå¸¸æ•°ä½¿ç”¨ï¼Œç»å¸¸å– 1ï¼ŒåŒæ—¶å¯¹äº B ç»å¸¸å–é›¶(â€”å¯èƒ½æœ‰äººä¼šæœ‰ç–‘é—®ï¼šå– 0 æ²¡äº‹å—ï¼Œå¯ä»¥æ”¾å¿ƒçš„å‘Šè¯‰ï¼Œé—®é¢˜ä¸å¤§ã€‚åè¿‡æ¥æƒ³æƒ³ï¼Œè¿™åªæ˜¯ä¸€ä¸ªä¼°è®¡ï¼Œå¯ä»¥åœ¨ä¼°è®¡å™ªå£°æ–¹å·®å¾—åˆ°ä¿®æ­£)ã€‘ å‘å‰æ¨ç®—åæ–¹å·®ï¼šåšå‡ºé¢„æµ‹åçš„æ–°çš„æ¦‚ç‡åˆ†å¸ƒçš„æ–¹å·®ï¼ˆé¢„æµ‹ä¸Šæ¬¡çš„æœ€ä¼˜ä¼°è®¡ä¸ºå½“å‰æ—¶åˆ»çš„å…ˆéªŒä¼°è®¡è¿™ä¸ªè¿‡ç¨‹å¯ä»¥å½“æˆä¸€ä¸ªç¬¦åˆé¢„æµ‹è¿‡ç¨‹å™ªå£°åˆ†å¸ƒçš„å’Œå¦ä¸€ä¸ª(ä¸Šä¸€æ¬¡çš„æœ€ä¼˜ä¼°è®¡å¯ä»¥çœ‹åšé«˜æ–¯åˆ†å¸ƒçš„)ä¹Ÿç¬¦åˆé«˜æ–¯åˆ†å¸ƒçš„ç›¸åŠ ã€‚é¢„æµ‹ç»“æœä¹Ÿæ˜¯ç¬¦åˆé«˜æ–¯å™ªå£°åˆ†å¸ƒçš„ï¼Œæ–¹å·®æ˜¯ä¸¤ä¸ªç›¸äº’ç‹¬ç«‹çš„æ–¹å·®ä¹‹å’Œï¼‰ã€‚ ã€å¯¹äºä¸€ç»´çš„æƒ…å†µ,P[n|n-1]=P[n-1|n-1]+Qã€‚ Q ä¸ºé¢„æµ‹æ–¹å·®ï¼Œä»£è¡¨å¯¹é¢„æµ‹çš„ä¸ä¿¡ä»»ç¨‹åº¦ï¼Œå·¥ç¨‹ä¸Šæ ¹æ®å®é™…è°ƒèŠ‚ä»¥æ”¹å–„æ»¤æ³¢å™¨çš„æ€§èƒ½:åŠ¨æ€æ•ˆæœå’Œå»å™ªæ•ˆæœã€‘ è®¡ç®—å¡å°”æ›¼å¢ç›Šï¼š ã€å¯¹äºä¸€ç»´çš„æƒ…å†µï¼ŒK[n]=H*P[n|n-1]/H^2*P[n|n-1]+Rã€‚å…¶ä¸­ H æ˜¯å¯¹è§‚æµ‹çš„å“åº”å€æ•°ï¼Œé€šå¸¸å– 1ï¼ŒR ä¸ºæµ‹é‡çš„æ–¹å·®ï¼Œå·¥ç¨‹ä¸Šä¸€èˆ¬éƒ½å¯ä»¥ç›´æ¥è·å¾—ã€‘ æ›´ä¼°è®¡å€¼ï¼šåšå‡ºåéªŒä¼°è®¡ï¼Œä¿®æ­£åçš„ä¼°è®¡å€¼ï¼Œæ›´æ¥è¿‘çœŸå®å€¼ã€‚ ã€å¯¹äºä¸€ç»´çš„æƒ…å†µï¼Œæœ€ä¼˜ä¼°è®¡ç”±ä¸‹å¼ç»™å‡ºï¼šx[n|n]=x[n|n-1]+K[n]*z[n]-x[n|n-1]ã€‚å…¶ä¸­ z[n]ä¸ºè§‚æµ‹å€¼ã€‘ æ›´æ–°è¯¯å·®åæ–¹å·®ï¼šå¾—åˆ°æœ€ä¼˜ä¼°è®¡çš„æ¦‚ç‡åˆ†å¸ƒçš„æ–¹å·®ã€‚ ã€å¯¹äºä¸€ç»´çš„æƒ…å†µï¼Œæ–°çš„è¯¯å·®åæ–¹å·®ç”±ä¸‹ç»™å‡ºï¼šP[n|n]=(1-K[n]*H)*P[n|n-1]ã€‘ ä»£ç å®ç°// ä¸€ç»´æ»¤æ³¢å™¨ä¿¡æ¯ç»“æ„ä½“typedef struct double filterValue; // k-1æ—¶åˆ»çš„æ»¤æ³¢å€¼ï¼ŒæŒ‡çš„æ˜¯åœ¨ä¸Šä¸€ä¸ªæ—¶åˆ»çš„ä¼°è®¡å€¼ double kalmanGain; // Kalmanå¢ç›Šï¼Œæ§åˆ¶å½“å‰ä¼°è®¡å€¼ä¸æ–°æµ‹é‡å€¼çš„èåˆç¨‹åº¦ double A; // çŠ¶æ€è½¬ç§»æ¨¡å‹ï¼Œx(n)=A*x(n-1)+u(n)ï¼Œu(n)æœä»æ­£æ€åˆ†å¸ƒN(0,Q) double H; // è§‚æµ‹æ¨¡å‹ï¼Œz(n)=H*x(n)+w(n)ï¼Œw(n)æœä»æ­£æ€åˆ†å¸ƒN(0,R) double Q; // è¿‡ç¨‹å™ªå£°æ–¹å·®ï¼Œé‡åŒ–é¢„æµ‹è¿‡ç¨‹ä¸­çš„ä¸ç¡®å®šæ€§ double R; // æµ‹é‡å™ªå£°æ–¹å·®ï¼Œé€šè¿‡å®éªŒè·å–ï¼Œæ­¤å€¼å†³å®šäº†æµ‹é‡çš„å¯é æ€§ double P; // ä¼°è®¡è¯¯å·®åæ–¹å·®ï¼Œåæ˜ äº†å½“å‰ä¼°è®¡çš„å‡†ç¡®ç¨‹åº¦ KalmanInfo;/** * @brief Init_KalmanInfo åˆå§‹åŒ–æ»¤æ³¢å™¨çš„åˆå§‹å‚æ•° * @param info æ»¤æ³¢å™¨æŒ‡é’ˆï¼ŒæŒ‡å‘KalmanInfoç»“æ„ä½“ * @param Q é¢„æµ‹å™ªå£°æ–¹å·®ï¼Œç”±ç³»ç»Ÿå¤–éƒ¨ç¡®å®š * @param R æµ‹é‡å™ªå£°æ–¹å·®ï¼Œç”±ç³»ç»Ÿå¤–éƒ¨ç¡®å®š */void Init_KalmanInfo(KalmanInfo* info, double Q, double R) info-A = 1; // çŠ¶æ€è½¬ç§»çŸ©é˜µè®¾ç½®ä¸º1ï¼Œè¡¨ç¤ºå½“å‰çŠ¶æ€ç­‰äºä¸Šä¸€ä¸ªçŠ¶æ€ info-H = 1; // è§‚æµ‹çŸ©é˜µè®¾ç½®ä¸º1ï¼Œè¡¨ç¤ºç›´æ¥æµ‹é‡çŠ¶æ€ info-P = 10; // åéªŒçŠ¶æ€ä¼°è®¡å€¼çš„è¯¯å·®åˆå§‹å€¼ï¼Œè®¾ç½®ä¸º10ä»¥å‡å°‘åˆæœŸä¸ç¡®å®šæ€§çš„å½±å“ info-Q = Q; // è¿‡ç¨‹å™ªå£°æ–¹å·®ï¼Œå½±å“æ»¤æ³¢æ”¶æ•›é€Ÿåº¦ï¼Œéœ€æ ¹æ®å®é™…æƒ…å†µè®¾å®š info-R = R; // æµ‹é‡å™ªå£°æ–¹å·®ï¼Œå»ºè®®é€šè¿‡å®éªŒç»Ÿè®¡è·å¾—ï¼Œå¯¹æµ‹é‡å‡†ç¡®æ€§å¾ˆé‡è¦ info-filterValue = 0; // åˆå§‹æ»¤æ³¢å€¼è®¾ä¸º0ï¼Œè¡¨ç¤ºå¼€å§‹çš„çŠ¶æ€double KalmanFilter(KalmanInfo* kalmanInfo, double lastMeasurement) // é¢„æµ‹ä¸‹ä¸€æ—¶åˆ»çš„å€¼ double predictValue = kalmanInfo-A * kalmanInfo-filterValue; // åŸºäºä¸Šä¸€ä¸ªæ»¤æ³¢å€¼è¿›è¡Œé¢„æµ‹ï¼Œæ­¤å¤„é€‚åˆå¤šç§åº”ç”¨åœºæ™¯ // æ›´æ–°åæ–¹å·® kalmanInfo-P = kalmanInfo-A * kalmanInfo-A * kalmanInfo-P + kalmanInfo-Q; // è®¡ç®—å…ˆéªŒå‡æ–¹å·®ï¼Œåæ˜ å½“å‰é¢„æµ‹çš„ä¸ç¡®å®šæ€§ double preValue = kalmanInfo-filterValue; // è®°å½•ä¸Šæ¬¡å®é™…çš„æ»¤æ³¢å€¼ï¼Œä¸ºåç»­å¯èƒ½çš„è®¡ç®—åšå‡†å¤‡ // è®¡ç®—Kalmanå¢ç›Š kalmanInfo-kalmanGain = kalmanInfo-P * kalmanInfo-H / (kalmanInfo-P * kalmanInfo-H * kalmanInfo-H + kalmanInfo-R); // Kalmanå¢ç›Šåœ¨0åˆ°1ä¹‹é—´ï¼Œè¾ƒå¤§æ—¶è¡¨ç¤ºå¯¹æµ‹é‡å€¼çš„ä¿¡ä»»åº¦æé«˜ // ä¿®æ­£ç»“æœï¼Œç»“åˆé¢„æµ‹å€¼ä¸æ–°æµ‹é‡å€¼ kalmanInfo-filterValue = predictValue + (lastMeasurement - predictValue) * kalmanInfo-kalmanGain; // é€šè¿‡æ®‹ä½™ï¼ˆæµ‹é‡å€¼ä¸é¢„æµ‹å€¼ä¹‹å·®ï¼‰æ¥è°ƒæ•´ä¼°è®¡ï¼Œè¾“å‡ºå½“å‰æ—¶åˆ»çš„æ»¤æ³¢å€¼ // æ›´æ–°åéªŒä¼°è®¡åæ–¹å·® kalmanInfo-P = (1 - kalmanInfo-kalmanGain * kalmanInfo-H) * kalmanInfo-P; // æ›´æ–°åçš„åæ–¹å·®åæ˜ äº†æ›´å‡†ç¡®çš„çŠ¶æ€ä¼°è®¡ç»“æœ return kalmanInfo-filterValue; // è¿”å›å½“å‰æ—¶åˆ»çš„æ»¤æ³¢å€¼ æ­¤ä»£ç å®ç°äº†ä¸€ä¸ªç®€å•çš„ä¸€ç»´ Kalman æ»¤æ³¢å™¨ï¼Œä¸»è¦ç”¨äºä¿¡å·é¢„æµ‹å’Œå™ªå£°æŠ‘åˆ¶ã€‚æ»¤æ³¢å™¨çš„æœ‰æ•ˆæ€§åœ¨äºè°ƒæ•´å‚æ•° Q å’Œ Rï¼Œè¿™äº›å‚æ•°ç›´æ¥å½±å“æ»¤æ³¢å™¨å¯¹ä¸åŒæ¥æºå™ªå£°çš„æ•æ„Ÿåº¦ï¼Œä½¿å¾—å®ƒå¯ä»¥åœ¨åŠ¨æ€ç¯å¢ƒä¸‹æä¾›å¹³æ»‘ä¸”å‡†ç¡®çš„ä¼°è®¡ã€‚é€šè¿‡åˆç†è®¾ç½®è¿™äº›åˆå§‹å€¼å’Œæ›´æ–°æ­¥éª¤ï¼ŒKalman æ»¤æ³¢å™¨å°†èƒ½å¤Ÿé€æ¸å­¦ä¹ å¹¶ä¼˜åŒ–å¯¹ç¯å¢ƒçŠ¶æ€çš„é¢„æµ‹ã€‚","categories":["2.ç¼–ç¨‹è¯­è¨€","ç»“æ„ç®—æ³•"]},{"title":"è®¾è®¡æ¨¡å¼","path":"/2024/01/25/2-ç¼–ç¨‹è¯­è¨€-ç»“æ„ç®—æ³•-è®¾è®¡æ¨¡å¼/","content":"å•ä¸€èŒè´£åŸåˆ™å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principleï¼ŒSRPï¼‰å¼ºè°ƒä¸€ä¸ªç±»åº”è¯¥ä»…æœ‰ä¸€ä¸ªèŒè´£æˆ–åŸå› å»æ”¹å˜ã€‚æ¢å¥è¯è¯´ï¼Œæ¯ä¸ªæ¨¡å—æˆ–ç±»åº”è¯¥ä¸“æ³¨äºå…¶ç‰¹å®šçš„åŠŸèƒ½ï¼Œé¿å…æ‰¿æ‹…è¿‡å¤šçš„è´£ä»»ã€‚è¿™æ ·å¯ä»¥ä½¿ä»£ç æ›´æ˜“äºç†è§£ã€æµ‹è¯•å’Œç»´æŠ¤ã€‚ ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç”µå­å•†åŠ¡ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªâ€œè®¢å•å¤„ç†â€ç±»å¦‚æœåŒæ—¶è´Ÿè´£å¤„ç†è®¢å•çš„åˆ›å»ºã€æ”¯ä»˜ä»¥åŠè®¢å•çŠ¶æ€çš„æ›´æ–°ï¼Œå°±ä¼šå˜å¾—å¤æ‚ä¸”éš¾ä»¥ç®¡ç†ã€‚å°†è¿™äº›èŒè´£è¿›è¡Œæ‹†åˆ†ï¼Œæ¯ä¸ªæ¨¡å—ä¸“æ³¨äºä¸€ä¸ªç‰¹å®šçš„ä»»åŠ¡ï¼Œæ¯”å¦‚â€œåˆ›å»ºè®¢å•ç±»â€ã€â€œæ”¯ä»˜å¤„ç†ç±»â€å’Œâ€œè®¢å•çŠ¶æ€æ›´æ–°ç±»â€ï¼Œè¿™æ ·å°±èƒ½åœ¨ä»£ç çš„ç»´æŠ¤å’Œæ‰©å±•ä¸Šå¸¦æ¥æ›´å¤§çš„çµæ´»æ€§ã€‚ å¼€æ”¾-å°é—­åŸåˆ™å¼€æ”¾-å°é—­åŸåˆ™ï¼ˆOpen-Closed Principleï¼ŒOCPï¼‰æŒ‡å‡ºè½¯ä»¶å®ä½“ï¼ˆç±»ã€æ¨¡å—ã€å‡½æ•°ç­‰ï¼‰åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ã€‚è¿™æ„å‘³ç€åœ¨ä¸æ”¹å˜ç°æœ‰ä»£ç çš„å‰æä¸‹ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ æ–°ä»£ç æ¥æ‰©å±•ç³»ç»Ÿçš„åŠŸèƒ½ã€‚ ä»¥ä¸€ä¸ªå›¾å½¢ç»˜åˆ¶ç¨‹åºä¸ºä¾‹ï¼Œæœ€å¼€å§‹ç³»ç»Ÿåªæ”¯æŒç»˜åˆ¶åœ†å½¢å’ŒçŸ©å½¢ã€‚å¦‚æœæœªæ¥éœ€è¦æ·»åŠ ç»˜åˆ¶ä¸‰è§’å½¢çš„åŠŸèƒ½ï¼Œéµå¾ªå¼€æ”¾-å°é—­åŸåˆ™çš„è®¾è®¡å…è®¸é€šè¿‡æ–°å¢ä¸€ä¸ªâ€œä¸‰è§’å½¢â€ç±»ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹åŸæœ‰çš„åœ†å½¢å’ŒçŸ©å½¢ç±»ã€‚è¿™ç§è®¾è®¡ä¸ä»…æé«˜äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ï¼Œä¹Ÿé™ä½äº†å¼•å…¥æ–°åŠŸèƒ½æ—¶å¯èƒ½å¸¦æ¥çš„é”™è¯¯é£é™©ã€‚ ä¾èµ–å€’è½¬åŸåˆ™ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆDependency Inversion Principleï¼ŒDIPï¼‰è¦æ±‚é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œè€Œæ˜¯åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚æ¢å¥è¯è¯´ï¼Œç¨‹åºåº”é€šè¿‡æ¥å£æˆ–æŠ½è±¡ç±»è€Œéå…·ä½“å®ç°æ¥è¿›è¡Œäº¤äº’ã€‚ ä»¥æ•°æ®è®¿é—®å±‚å’Œä¸šåŠ¡é€»è¾‘å±‚ä¸ºä¾‹ã€‚ä¸šåŠ¡é€»è¾‘å±‚åº”è¯¥ä¾èµ–äºä¸€ä¸ªæ•°æ®è®¿é—®æ¥å£ï¼Œæ¯”å¦‚â€œIDatabaseAccessâ€ï¼Œè€Œä¸æ˜¯å¯¹å…·ä½“çš„æ•°æ®è®¿é—®ç±»â€œSqlDatabaseAccessâ€è¿›è¡Œä¾èµ–ã€‚è¿™æ ·ï¼Œå¦‚æœæœªæ¥éœ€è¦æ›´æ¢æ•°æ®åº“ï¼Œä¾‹å¦‚ä» SQL Server è¿ç§»åˆ° MongoDBï¼Œåªéœ€å®ç°ä¸€ä¸ªæ–°çš„â€œMongoDatabaseAccessâ€ç±»ï¼Œè€Œä¸šåŠ¡é€»è¾‘å±‚çš„ä»£ç æ— éœ€æ›´æ”¹ã€‚è¿™ç§æ–¹æ³•æé«˜äº†ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ è¿ªç±³ç‰¹æ³•åˆ™è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆLaw of Demeterï¼‰ä¹Ÿç§°ä¸ºâ€œæœ€å°‘çŸ¥è¯†åŸåˆ™â€ï¼Œæå€¡ä¸€ä¸ªå¯¹è±¡ä¸åº”è¯¥ä¸»åŠ¨å»äº†è§£å…¶ä»–å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚ï¼Œå°¤å…¶æ˜¯å…¶éç›´æ¥ä¾èµ–çš„å¯¹è±¡ã€‚è¿™ä¸€åŸåˆ™æ—¨åœ¨é™ä½å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæé«˜ç³»ç»Ÿçš„æ¨¡å—åŒ–ã€‚ ä¸€ä¸ªå…¬å¸é¡¹ç›®ç®¡ç†ç³»ç»Ÿä¸ºä¾‹ï¼Œåœ¨ä¸€ä¸ªâ€œé¡¹ç›®â€å¯¹è±¡ä¸­ï¼Œå¯èƒ½åŒ…å«å¯¹â€œå›¢é˜Ÿâ€å¯¹è±¡çš„å¼•ç”¨ã€‚æ ¹æ®è¿ªç±³ç‰¹æ³•åˆ™ï¼Œâ€œé¡¹ç›®â€å¯¹è±¡ä¸åº”ç›´æ¥è®¿é—®â€œå›¢é˜Ÿâ€æˆå‘˜çš„å…·ä½“ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œä¸åº”é€šè¿‡â€œé¡¹ç›®â€å¯¹è±¡ç›´æ¥è·å–å›¢é˜Ÿæˆå‘˜çš„é‚®ç®±ï¼Œè€Œåº”æä¾›ä¸€ä¸ªæ–¹æ³•å¦‚â€œgetTeamMemberEmails()â€ï¼Œè¿™æ ·â€œé¡¹ç›®â€åªéœ€è¦ä¸â€œå›¢é˜Ÿâ€è¿›è¡Œäº’åŠ¨ï¼Œè€Œä¸éœ€è¦å…³æ³¨â€œå›¢é˜Ÿâ€å†…éƒ¨çš„å®ç°ç»†èŠ‚ã€‚è¿™ç§è®¾è®¡ä½¿å¾—å¯¹è±¡ä¹‹é—´çš„äº¤äº’å˜å¾—ç®€å•å’Œæ¸…æ™°ï¼Œå‡å°‘äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚ åˆ›å»ºå‹æ¨¡å¼åˆ›å»ºå‹æ¨¡å¼çš„ä¸»è¦ç›®æ ‡æ˜¯é€šè¿‡å„ç§æ–¹å¼æ¥åˆ›å»ºå¯¹è±¡ï¼Œä»è€Œæé«˜è½¯ä»¶è®¾è®¡çš„çµæ´»æ€§å’Œé‡ç”¨æ€§ã€‚è¿™äº›æ¨¡å¼æä¾›äº†è§£å†³å®ä¾‹åˆ›å»ºè¿‡ç¨‹çš„æ ‡å‡†æ–¹æ³•ï¼Œä½¿å¾—ä»£ç æ›´æ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚ ç®€å•å·¥å‚æ¨¡å¼ç®€å•å·¥å‚æ¨¡å¼æ˜¯ä¸€ç§ä¸å±äº GoF è®¾è®¡æ¨¡å¼çš„æ¨¡å¼ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªå·¥å‚ç±»æ¥åˆ›å»ºå¯¹è±¡ã€‚å·¥å‚ç±»æ ¹æ®è¾“å…¥çš„å‚æ•°æ¥å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªå…·ä½“ç±»ã€‚æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªæ±½è½¦ç”Ÿäº§ç³»ç»Ÿä¸­ï¼Œç®€å•å·¥å‚å¯ä»¥æ ¹æ®è½¦å‹å‚æ•°ï¼ˆå¦‚â€œè½¿è½¦â€æˆ–â€œSUVâ€ï¼‰æ¥ç”Ÿæˆä¸åŒç±»å‹çš„æ±½è½¦å¯¹è±¡ã€‚è¿™ç§æ¨¡å¼çš„ä¼˜ç‚¹åœ¨äº Clients ä¸éœ€è¦ç›´æ¥ä¾èµ–å…·ä½“ç±»ï¼Œåªéœ€ä¾èµ–å·¥å‚æ¥å£ã€‚ class CarFactory public static Car createCar(String type) if (type.equals(Sedan)) return new Sedan(); else if (type.equals(SUV)) return new SUV(); return null; æŠ½è±¡å·¥å‚æŠ½è±¡å·¥å‚æ¨¡å¼æä¾›ä¸€ä¸ªæ¥å£ï¼Œç”¨äºåˆ›å»ºç›¸å…³æˆ–ä¾èµ–å¯¹è±¡çš„å®¶æ—ï¼Œè€Œæ— é¡»æ˜ç¡®æŒ‡å®šå…·ä½“ç±»ã€‚æŠ½è±¡å·¥å‚çš„ç›®çš„æ˜¯ä¸ºäº†ä¸€æ¬¡æ€§åˆ›å»ºä¸€ç³»åˆ—ç›¸å…³å¯¹è±¡ï¼Œåœ¨ç”¨æˆ·å¯¹ç³»ç»Ÿè¿›è¡Œæ‰©å±•æ—¶ï¼Œä¸ä¼šå¼•å…¥å¤ªå¤šçš„å˜åŒ–ã€‚å…¸å‹åº”ç”¨åœºæ™¯å¦‚è·¨å¹³å°çš„ UI ç»„ä»¶åº“ï¼Œå…è®¸ç”¨æˆ·åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸‹åˆ›å»ºç¬¦åˆå„è‡ªé£æ ¼çš„ç•Œé¢å…ƒç´ ã€‚ interface GUIFactory Button createButton(); Checkbox createCheckbox();class WindowsFactory implements GUIFactory public Button createButton() return new WindowsButton(); public Checkbox createCheckbox() return new WindowsCheckbox(); å»ºé€ è€…æ¨¡å¼å»ºé€ è€…æ¨¡å¼å…è®¸é€æ­¥æ„å»ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ã€‚åœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå°†å…¶æ„å»ºè¿‡ç¨‹ä¸è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚å¸¸è§äºå¤æ‚å¯¹è±¡çš„åˆ›å»ºï¼Œå°¤å…¶æ˜¯å½“å¯¹è±¡çš„æ„é€ å¤æ‚ï¼Œæˆ–è€…æ„é€ å‚æ•°ä¸å®¹æ˜“å½’ç±»æ—¶ã€‚ class Car private String engine; private int wheels; public void setEngine(String engine) this.engine = engine; public void setWheels(int wheels) this.wheels = wheels; class CarBuilder private Car car; public CarBuilder() car = new Car(); public CarBuilder buildEngine(String engine) car.setEngine(engine); return this; public CarBuilder buildWheels(int wheels) car.setWheels(wheels); return this; public Car build() return car; å·¥å‚æ–¹æ³•å·¥å‚æ–¹æ³•æ¨¡å¼å…è®¸åˆ›å»ºå¯¹è±¡çš„å®ä¾‹ï¼Œä½†å°†å®ä¾‹åŒ–çš„è¿‡ç¨‹å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†å°†å®ä¾‹åŒ–çš„å·¥ä½œæ”¾åœ¨ä¸€ä¸ªå­ç±»ä¸­å®ç°ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä»£ç çš„æ‰©å±•æ€§å¢å¼ºï¼Œå¯ä»¥é¿å¼€åœ¨ç±»çš„å¤šä¸ªä½ç½®è¿›è¡Œä¿®æ”¹ã€‚ abstract class Creator public abstract Product factoryMethod();class ConcreteCreatorA extends Creator public Product factoryMethod() return new ConcreteProductA(); åŸå‹æ¨¡å¼åŸå‹æ¨¡å¼é€šè¿‡æ‹·è´ç°æœ‰å¯¹è±¡çš„æ–¹å¼æ¥åˆ›å»ºæ–°å¯¹è±¡ï¼Œè€Œä¸æ˜¯é€šè¿‡æ„é€ å‡½æ•°è¿›è¡Œåˆ›å»ºã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåˆ›å»ºå¯¹è±¡çš„å¼€é”€è¾ƒå¤§ï¼Œä½¿ç”¨ç°æœ‰å¯¹è±¡æ‹·è´çš„æ–¹å¼å¯ä»¥æå‡æ•ˆç‡ã€‚å®ƒé€‚ç”¨äºå¯¹è±¡çš„åˆ›å»ºæˆæœ¬è¾ƒé«˜æ—¶ï¼Œä¾‹å¦‚å¤§é‡é…ç½®å’Œåˆå§‹åŒ–æ•°æ®çš„æƒ…å¢ƒã€‚ class Prototype implements Cloneable private String data; public Prototype(String data) this.data = data; public Prototype clone() throws CloneNotSupportedException return (Prototype) super.clone(); å•ä¾‹æ¨¡å¼å•ä¾‹æ¨¡å¼ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚åœ¨éœ€è¦æ§åˆ¶å®ä¾‹æ•°é‡çš„æƒ…å†µä¸‹ï¼Œå•ä¾‹æ¨¡å¼éå¸¸æœ‰ç”¨ã€‚å…¸å‹åœºæ™¯åŒ…æ‹¬æ—¥å¿—è®°å½•å™¨ã€é…ç½®ç®¡ç†å™¨ç­‰ï¼Œåœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå¤šä¸ªå®ä¾‹å¯èƒ½ä¼šå¼•èµ·èµ„æºæµªè´¹æˆ–ä¸ä¸€è‡´æ€§é—®é¢˜ã€‚ class Singleton private static Singleton instance; private Singleton() public static synchronized Singleton getInstance() if (instance == null) instance = new Singleton(); return instance; ç»“æ„å‹æ¨¡å¼ç»“æ„å‹æ¨¡å¼å…³æ³¨äºå¦‚ä½•å°†ç±»æˆ–å¯¹è±¡ç»„åˆæˆæ›´å¤§çš„ç»“æ„ï¼Œä»¥ä¾¿å®ç°çµæ´»çš„ä»£ç ç»„ç»‡å’Œæé«˜ç³»ç»Ÿçš„å¯å¤ç”¨æ€§ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„ç»“æ„å‹æ¨¡å¼ï¼Œæ¯ç§æ¨¡å¼éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ç‰¹ç‚¹å’Œåº”ç”¨åœºæ™¯ã€‚ é€‚é…å™¨æ¨¡å¼é€‚é…å™¨æ¨¡å¼é€šè¿‡å°†ä¸€ä¸ªæ¥å£è½¬æ¢æˆå¦ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾—æœ¬æ¥å› ä¸ºæ¥å£ä¸å…¼å®¹è€Œæ— æ³•ä¸€åŒå·¥ä½œçš„ç±»èƒ½åè°ƒèµ·æ¥ã€‚ä¾‹å¦‚ï¼Œåœ¨ç°ä»£åŸå¸‚ä¸­ï¼Œç”µæºæ’åº§çš„æ ‡å‡†å› åœ°åŒºè€Œå¼‚ã€‚æ¬§æ´²æ ‡å‡†çš„æ’å¤´é€šå¸¸æ˜¯ä¸¤å¤´å¸¦æœ‰åœ†å­”çš„æ’å¤´ï¼Œè€Œç¾å›½çš„æ’å¤´åˆ™ä¸ºæ‰å¹³åŒè„šè®¾è®¡ã€‚å‡è®¾æœ‰ä¸€å°åªèƒ½æ¥å—ç¾å›½æ ‡å‡†æ’å¤´çš„è®¾å¤‡ï¼Œä½†æ¥å…¥çš„æ˜¯æ¬§æ´²æ ‡å‡†æ’å¤´ã€‚æ­¤æ—¶ï¼Œä¸€ä¸ªé€‚é…å™¨çš„å¼•å…¥å¯ä»¥å°†æ¬§æ´²æ’å¤´è½¬æ¢ä¸ºé€‚åˆç¾å›½æ’åº§çš„ç±»å‹ï¼Œä»è€Œä½¿è®¾å¤‡æ­£å¸¸å·¥ä½œã€‚è¿™ä¸ªæ¨¡å¼åœ¨è½¯ä»¶å¼€å‘ä¸­å°¤ä¸ºå…³é”®ï¼Œç‰¹åˆ«æ˜¯åœ¨é›†æˆç¬¬ä¸‰æ–¹åº“æˆ–è€…è€æ—§ä»£ç æ—¶ï¼Œå¯ä»¥å¹³æ»‘åœ°ä¸å½“å‰ä½¿ç”¨çš„ç³»ç»Ÿå…¼å®¹ã€‚è¿™æ ·ï¼Œå¼€å‘è€…èƒ½å¤Ÿç»§ç»­åˆ©ç”¨ç°æœ‰çš„èµ„æºï¼Œè€Œä¸å¿…é‡å†™æ•´ä¸ªç³»ç»Ÿã€‚ ä»£ç ç¤ºä¾‹ï¼š// ç›®æ ‡æ¥å£public interface Target void request();// é€‚é…è€…ç±»public class Adaptee public void specificRequest() System.out.println(Called specificRequest); // é€‚é…å™¨ç±»public class Adapter implements Target private Adaptee adaptee; public Adapter(Adaptee adaptee) this.adaptee = adaptee; @Override public void request() adaptee.specificRequest(); æ¡¥æ¥æ¨¡å¼æ¡¥æ¥æ¨¡å¼é€šè¿‡å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ƒçš„å…·ä½“å®ç°éƒ¨åˆ†åˆ†éš”å¼€æ¥ï¼Œä½¿å¾—äºŒè€…å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚æ ¸å¿ƒåœ¨äºå¼•å…¥ä¸€ä¸ªæ¡¥æ¥æ¥å£ï¼Œåˆ›å»ºä¸€ä¸ªæŠ½è±¡å±‚ï¼Œè¿™æ ·å…·ä½“å®ç°ä¸æŠ½è±¡å®šä¹‰ä¸å†å¼ºå…³è”ã€‚è€ƒè™‘ä¸€ä¸ªå›¾å½¢ç»˜åˆ¶ç¨‹åºï¼Œå…¶ä¸­å­˜åœ¨ä¸åŒå½¢çŠ¶ï¼ˆå¦‚åœ†å½¢ã€çŸ©å½¢ï¼‰å’Œè‰²å½©ï¼ˆå¦‚çº¢è‰²ã€è“è‰²ï¼‰ã€‚ä½¿ç”¨æ¡¥æ¥æ¨¡å¼ï¼Œå¯ä»¥å°†å½¢çŠ¶å®šä¹‰ä¸è‰²å½©å®šä¹‰åˆ†å¼€ï¼Œä»è€Œä½¿åœ¨æ–°å¢ä¸€ä¸ªå½¢çŠ¶æˆ–é¢œè‰²æ—¶ï¼Œä¸ä¼šå½±å“å…¶ä»–éƒ¨åˆ†çš„å®ç°ã€‚ä¾‹å¦‚ï¼Œè‹¥æ·»åŠ ä¸€ä¸ªç»¿è‰²çš„ä¸‰è§’å½¢ï¼Œä»…éœ€è¦å®ç°ä¸‰è§’å½¢çš„ç›¸å…³æ¥å£ä»¥åŠä¸ç»¿è‰²ç›¸å…³çš„é¢œè‰²å®ç°ï¼Œè€Œä¸éœ€è¦æ›´æ”¹ç°æœ‰çš„ä»£ç ç»“æ„ã€‚ ä»£ç ç¤ºä¾‹ï¼š// å½¢çŠ¶æ¥å£public interface Shape void draw();// é¢œè‰²æ¥å£public interface Color void fill();// å®ç°å½¢çŠ¶çš„ç±»public class Circle implements Shape private Color color; public Circle(Color color) this.color = color; @Override public void draw() System.out.print(Drawing Circle in ); color.fill(); // å®ç°é¢œè‰²çš„ç±»public class Red implements Color @Override public void fill() System.out.println(Red Color); ç»„åˆæ¨¡å¼ç»„åˆæ¨¡å¼å…è®¸å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ï¼Œä»¥è¡¨ç¤ºéƒ¨åˆ†ä¸æ•´ä½“çš„å±‚æ¬¡å…³ç³»ã€‚å®ƒé€šè¿‡æä¾›ä¸€è‡´çš„æ¥å£ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„æ“ä½œä¿æŒä¸€è‡´æ€§ã€‚ä»¥æ–‡ä»¶ç³»ç»Ÿä¸ºä¾‹ï¼Œç”¨æˆ·å¯ä»¥å°†æ–‡ä»¶å’Œç›®å½•è§†ä¸ºæ ‘å½¢ç»“æ„çš„èŠ‚ç‚¹ã€‚ä¸€ä¸ªç›®å½•ä¸­å¯ä»¥åŒ…å«å¤šä¸ªæ–‡ä»¶æˆ–å­ç›®å½•ï¼Œè€Œæ¯ä¸ªæ–‡ä»¶å’Œç›®å½•åˆå¯è¢«è§†ä½œä¸€ä¸ªç‹¬ç«‹çš„èŠ‚ç‚¹ã€‚é€šè¿‡ç»„åˆæ¨¡å¼ï¼Œæ“ä½œæ–‡ä»¶å’Œç›®å½•æ—¶ï¼Œå¯ä»¥ä»…ä½¿ç”¨ç»Ÿä¸€çš„æ¥å£ï¼Œä»è€Œç®€åŒ–äº†æ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç”¨ç›¸åŒçš„æ–¹æ³•æ¥æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ï¼Œæ— éœ€è€ƒè™‘å®ƒä»¬çš„å…·ä½“ç±»å‹ã€‚ ä»£ç ç¤ºä¾‹ï¼š// ç»„ä»¶æ¥å£public interface File void display();// å¶å­èŠ‚ç‚¹ç±»public class ImageFile implements File private String name; public ImageFile(String name) this.name = name; @Override public void display() System.out.println(Displaying image: + name); // å®¹å™¨ç±»public class Directory implements File private ListFile files = new ArrayList(); private String name; public Directory(String name) this.name = name; public void add(File file) files.add(file); @Override public void display() System.out.println(Directory: + name); for (File file : files) file.display(); è£…é¥°æ¨¡å¼è£…é¥°æ¨¡å¼å…è®¸åœ¨ä¸æ”¹å˜å¯¹è±¡åŸæœ‰ç»“æ„çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°ä¸ºå…¶å¢åŠ æ–°çš„åŠŸèƒ½å’Œè´£ä»»ã€‚è¿™ç§æ¨¡å¼æ¯”å­ç±»åŒ–æ–¹æ¡ˆæ›´å…·çµæ´»æ€§ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨è¿è¡Œæ—¶ä¸ºå¯¹è±¡å¢åŠ å¤šç§åŠŸèƒ½ã€‚ä»¥å’–å•¡ä¸ºä¾‹ï¼Œä¸€æ¯åŸºæœ¬å’–å•¡å¯ä»¥é€šè¿‡æ·»åŠ ç‰›å¥¶ã€ç³–æˆ–é¦™æ–™ç­‰é…æ–™æ¥æ”¹å˜å…¶é£å‘³ã€‚æ¯ç§æ·»åŠ ç‰©å°±åƒæ˜¯ä¸€ä¸ªè£…é¥°è€…ï¼Œå¯ä»¥ç‹¬ç«‹åœ°æ·»åŠ åˆ°å’–å•¡ä¸­ï¼Œå½¢æˆå¤šç§ä¸åŒçš„ç»„åˆã€‚è¿™æ ·ï¼Œæ— éœ€ä¿®æ”¹å’–å•¡çš„åŸå§‹é…æ–¹ï¼Œå°±å¯ä»¥åœ¨å¤šä¸ªå’–å•¡å®ä¾‹ä¸­å…±äº«è¿™äº›åŠŸèƒ½ï¼Œå½“éœ€è¦æ·»åŠ æ–°åŠŸèƒ½æ—¶ï¼Œåªéœ€ç®€å•åœ°åˆ›å»ºä¸€ä¸ªæ–°çš„è£…é¥°è€…ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœåŸæœ‰çš„å’–å•¡å¯¹è±¡æ˜¯ä¸€ä¸ª SimpleCoffee ç±»ï¼Œå¯ä»¥é€šè¿‡å®ç° CoffeeDecorator ç±»æ¥æ„å»ºä¸åŒç§ç±»çš„å’–å•¡è£…é¥°å“ï¼Œæ¯”å¦‚ MilkDecoratorã€SugarDecorator å’Œ SpiceDecoratorã€‚ interface Coffee String getDescription(); double cost();class SimpleCoffee implements Coffee public String getDescription() return Simple Coffee; public double cost() return 1.00; abstract class CoffeeDecorator implements Coffee protected Coffee coffee; public CoffeeDecorator(Coffee coffee) this.coffee = coffee; public String getDescription() return coffee.getDescription(); public double cost() return coffee.cost(); class MilkDecorator extends CoffeeDecorator public MilkDecorator(Coffee coffee) super(coffee); public String getDescription() return coffee.getDescription() + , Milk; public double cost() return coffee.cost() + 0.50; å¤–è§‚æ¨¡å¼å¤–è§‚æ¨¡å¼æ„åœ¨é€šè¿‡æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œæ¥ç®€åŒ–å¤æ‚ç³»ç»Ÿçš„ä½¿ç”¨æ–¹æ³•ï¼Œå¹¶éšè—å†…éƒ¨å¤æ‚æ€§ã€‚è¿™ç§æ¨¡å¼å¯¹ç”¨æˆ·è€Œè¨€ï¼Œä½¿å¾—å„ä¸ªå­ç³»ç»Ÿé—´çš„äº¤äº’å˜å¾—ç›´è§‚ä¸”æ˜“äºä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå¤šåª’ä½“æ’­æ”¾è½¯ä»¶ä¸­ï¼Œç”¨æˆ·éœ€è¦åŒæ—¶æ§åˆ¶éŸ³é¢‘ã€è§†é¢‘å’Œå­—å¹•è¿™ä¸‰ä¸ªå­ç³»ç»Ÿã€‚æ²¡æœ‰å¤–è§‚æ¨¡å¼çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦åˆ†åˆ«è°ƒç”¨ä¸åŒçš„æ“ä½œï¼Œè¿™å¾ˆå®¹æ˜“å¯¼è‡´æ··æ·†ã€‚ å¼•å…¥å¤–è§‚æ¨¡å¼åï¼Œå¯ä»¥è®¾è®¡ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œæ¯”å¦‚ MediaFacadeï¼Œç”¨æˆ·åªéœ€è°ƒç”¨ç®€å•çš„æ–¹æ³•æ¥åŒæ—¶æ§åˆ¶éŸ³è§†é¢‘çš„æ’­æ”¾å’Œåœæ­¢ï¼Œè€Œæ— éœ€äº†è§£æ¯ä¸ªå­ç³»ç»Ÿçš„åº•å±‚å®ç°ã€‚è¿™æ ·ï¼Œç»´æŠ¤å’Œä½¿ç”¨å˜å¾—æ›´ä¸ºæ–¹ä¾¿ã€‚ class AudioSystem public void play() System.out.println(Audio Playing); public void stop() System.out.println(Audio Stopped); class VideoSystem public void play() System.out.println(Video Playing); public void stop() System.out.println(Video Stopped); class SubtitleSystem public void show() System.out.println(Subtitle Showing); public void hide() System.out.println(Subtitle Hidden); class MediaFacade private AudioSystem audio; private VideoSystem video; private SubtitleSystem subtitle; public MediaFacade() audio = new AudioSystem(); video = new VideoSystem(); subtitle = new SubtitleSystem(); public void play() audio.play(); video.play(); subtitle.show(); public void stop() audio.stop(); video.stop(); subtitle.hide(); äº«å…ƒæ¨¡å¼äº«å…ƒæ¨¡å¼é€šè¿‡å…±äº«å¯¹è±¡æ¥æœ‰æ•ˆç®¡ç†å¤§é‡ç»†ç²’åº¦å¯¹è±¡ï¼Œä»è€Œå‡å°‘å†…å­˜å ç”¨ã€‚è¯¥æ¨¡å¼åœ¨å¤„ç†å¤§é‡ç›¸ä¼¼å¯¹è±¡æ—¶æ˜¾ç¤ºå‡ºå·¨å¤§çš„æ•ˆç›Šã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ä¸­ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½å¯ä»¥è§†ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚å½“æ–‡æ¡£ä¸­å­˜åœ¨å¤§é‡ç›¸åŒå­—ç¬¦æ—¶ï¼Œä¾‹å¦‚å­—æ¯â€œaâ€ï¼Œä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•ä¼šåœ¨å†…å­˜ä¸­åˆ›å»ºå¤šä¸ªâ€œaâ€å­—ç¬¦å¯¹è±¡ï¼Œè¿™æ˜¾ç„¶æ˜¯ä½æ•ˆçš„ã€‚ é€šè¿‡äº«å…ƒæ¨¡å¼ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå­—ç¬¦å·¥å‚ï¼Œè¿™ä¸ªå·¥å‚è´Ÿè´£ç®¡ç†å’Œå…±äº«å­—ç¬¦å¯¹è±¡ã€‚å½“éœ€è¦ä½¿ç”¨æŸä¸ªå­—ç¬¦æ—¶ï¼Œå·¥å‚é¦–å…ˆæ£€æŸ¥æ˜¯å¦å·²æœ‰ç›¸åº”çš„å­—ç¬¦å¯¹è±¡ã€‚å¦‚æœå·²æœ‰ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥å¯¹è±¡ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦å¯¹è±¡ã€‚è¿™ç§æ–¹æ³•æå¤§èŠ‚çœäº†å†…å­˜ï¼ŒåŒæ—¶æå‡äº†æ€§èƒ½ã€‚ class CharacterFlyweight private char character; public CharacterFlyweight(char character) this.character = character; public char getCharacter() return character; class CharacterFactory private MapCharacter, CharacterFlyweight characterMap = new HashMap(); public CharacterFlyweight getCharacter(char c) if (!characterMap.containsKey(c)) characterMap.put(c, new CharacterFlyweight(c)); return characterMap.get(c); ä»£ç†æ¨¡å¼ä»£ç†æ¨¡å¼ç”¨äºä¸ºå…¶ä»–å¯¹è±¡æä¾›ä»£ç†ï¼Œä»è€Œæ§åˆ¶å¯¹è¯¥å¯¹è±¡çš„è®¿é—®ã€‚é€šè¿‡è¿™ç§æ¨¡å¼ï¼Œå¯ä»¥åœ¨ä¸æ”¹åŠ¨ç›®æ ‡å¯¹è±¡çš„å‰æä¸‹ï¼Œè¿›è¡Œå„ç§æ“ä½œã€‚ä¸€ä¸ªå¸¸è§çš„åº”ç”¨åœºæ™¯æ˜¯ç½‘ç»œæœåŠ¡ä¸­çš„ä»£ç†æœåŠ¡å™¨ï¼Œç”¨æˆ·åœ¨è¯·æ±‚æ•°æ®æ—¶ï¼Œå¯ä»¥é€šè¿‡ä»£ç†æœåŠ¡å™¨å®ç°å¯¹ç›®æ ‡æœåŠ¡å™¨çš„è¯·æ±‚å¤„ç†ã€‚ ä»£ç†ä¸ä»…å¯ä»¥ç”¨äºè¯·æ±‚è½¬å‘ï¼Œè¿˜å¯ä»¥ç”¨äºæƒé™æ§åˆ¶ã€æ•°æ®ç¼“å­˜ç­‰åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œåœ¨è®¿é—®ä¸€ä¸ªéœ€è¦è®¤è¯çš„æœåŠ¡æ—¶ï¼Œä»£ç†å¯ä»¥åœ¨è½¬å‘è¯·æ±‚å‰å…ˆè¿›è¡Œç”¨æˆ·èº«ä»½éªŒè¯ã€‚è¿™æ ·ä¸€æ¥ï¼Œç³»ç»Ÿçš„çµæ´»æ€§å’Œå®‰å…¨æ€§å¾—ä»¥å¢å¼ºï¼ŒåŒæ—¶è¿˜å¯ä»¥ä¿æŒä¸åŸå§‹å¯¹è±¡çš„ä¸€è‡´æ€§ã€‚ interface Image void display();class RealImage implements Image private String filename; public RealImage(String filename) this.filename = filename; loadImageFromDisk(); private void loadImageFromDisk() System.out.println(Loading + filename); public void display() System.out.println(Displaying + filename); class ProxyImage implements Image private RealImage realImage; private String filename; public ProxyImage(String filename) this.filename = filename; public void display() if (realImage == null) realImage = new RealImage(filename); realImage.display(); è¡Œä¸ºå‹æ¨¡å¼è¡Œä¸ºå‹æ¨¡å¼ä¸“æ³¨äºå¯¹è±¡ä¹‹é—´çš„è´£ä»»åˆ†é…å’Œé€šä¿¡ï¼Œå¸®åŠ©å»ºç«‹æ¸…æ™°çš„åˆä½œæ–¹å¼ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„è¡Œä¸ºå‹æ¨¡å¼çš„ä»‹ç»åŠå…¶ç‰¹ç‚¹ã€‚ è§‚å¯Ÿè€…æ¨¡å¼è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œä½¿å¾—å½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½èƒ½æ”¶åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°ã€‚è¿™ç§æ¨¡å¼åœ¨è®¸å¤šå®é™…åº”ç”¨åœºæ™¯ä¸­ååˆ†å¸¸è§ã€‚ä¾‹å¦‚ï¼Œåœ¨æ°”è±¡ç«™å†…ï¼Œå½“æ¸©åº¦ã€æ¹¿åº¦æˆ–æ°”å‹ç­‰æ°”è±¡æ•°æ®å˜åŒ–æ—¶ï¼Œå¤šä¸ªæ˜¾ç¤ºè®¾å¤‡ï¼ˆå¦‚ç”µå­æ˜¾ç¤ºå±ã€æ‰‹æœºåº”ç”¨ç¨‹åºç­‰ï¼‰å°†å³æ—¶æ›´æ–°å…¶æ˜¾ç¤ºä¿¡æ¯ï¼Œç¡®ä¿ç”¨æˆ·è·å¾—æœ€æ–°çš„æ•°æ®ã€‚æ­¤å¤–ï¼Œæ–°é—»ç½‘ç«™çš„è®¢é˜…åŠŸèƒ½ä¹Ÿæ˜¯ç»å…¸çš„åº”ç”¨ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©è®¢é˜…è‡ªå·±æ„Ÿå…´è¶£çš„æ–°é—»ä¸“é¢˜ï¼Œå½“ç›¸å…³å†…å®¹æ›´æ–°æ—¶ï¼Œç³»ç»Ÿä¼šé€šè¿‡ç”µå­é‚®ä»¶æˆ–æ¨é€é€šçŸ¥çš„æ–¹å¼ç›´æ¥å°†ä¿¡æ¯é€è¾¾ç”¨æˆ·ã€‚è¿™ç§åŠæ—¶çš„ä¿¡æ¯ä¼ é€’æœºåˆ¶å¢å¼ºäº†ç”¨æˆ·çš„è·å–ä½“éªŒï¼Œæé«˜äº†ç³»ç»Ÿçš„äº’åŠ¨æ€§ã€‚ ä»£ç ç¤ºä¾‹ï¼š // ä¼ªä»£ç ç¤ºä¾‹class Subject private ListObserver observers = new ArrayList(); public void addObserver(Observer observer) observers.add(observer); public void notifyObservers() for (Observer observer : observers) observer.update(); class ConcreteObserver implements Observer public void update() // å®ç°æ›´æ–°é€»è¾‘ æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ¨¡æ¿æ–¹æ³•æ¨¡å¼é€šè¿‡å®šä¹‰ä¸€ä¸ªç®—æ³•çš„æ¡†æ¶å¹¶å°†æŸäº›æ­¥éª¤çš„å®ç°ç•™ç»™å­ç±»ï¼Œä»è€Œæä¾›äº†çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼šçƒ˜ç„™çš„è¿‡ç¨‹åŒ…æ‹¬é¢„çƒ­çƒ¤ç®±ã€å‡†å¤‡é£Ÿæã€æ··åˆææ–™ã€çƒ˜ç„™ç­‰æ­¥éª¤ã€‚æ¨¡æ¿æ–¹æ³•æ¨¡å¼ç¡®ä¿è¿™ä¸€ç³»åˆ—æ­¥éª¤çš„æ‰§è¡Œé¡ºåºå’ŒåŸºæœ¬æµç¨‹å§‹ç»ˆä¸å˜ï¼Œè€Œå­ç±»å¯ä»¥æ ¹æ®ç‰¹å®šçš„éœ€æ±‚å®ç°ä¸åŒçš„æ­¥éª¤ï¼Œå¦‚åˆ¶ä½œå·§å…‹åŠ›è›‹ç³•æˆ–é¦™è‰è›‹ç³•æ—¶æ‰€éœ€çš„å…·ä½“ææ–™å’Œé…æ–¹å¯èƒ½ä¸åŒã€‚è¿™æ ·ï¼Œæ— è®ºä½¿ç”¨ä½•ç§å£å‘³çš„è›‹ç³•ï¼ŒåŸºæœ¬çš„çƒ˜ç„™æµç¨‹å§‹ç»ˆä¿æŒä¸€è‡´ã€‚ä»£ç ç¤ºä¾‹ï¼š abstract class AbstractBaker public final void bake() preheatOven(); prepareIngredients(); mixIngredients(); bakeCake(); protected abstract void prepareIngredients(); protected abstract void mixIngredients(); private void preheatOven() // å›ºå®šæ­¥éª¤ private void bakeCake() // å›ºå®šæ­¥éª¤ class ChocolateCakeBaker extends AbstractBaker protected void prepareIngredients() // ç‰¹å®šçš„ææ–™å‡†å¤‡ protected void mixIngredients() // ç‰¹å®šçš„æ··åˆæ–¹æ³• å‘½ä»¤æ¨¡å¼å‘½ä»¤æ¨¡å¼å°†è¯·æ±‚å°è£…ä¸ºå¯¹è±¡ï¼Œä»è€Œæ”¯æŒå¯¹è¯·æ±‚çš„å‚æ•°åŒ–ã€è¯·æ±‚çš„æ’é˜Ÿå’Œè¯·æ±‚æ—¥å¿—åŠŸèƒ½ã€‚è¿™ä¸€æ¨¡å¼åœ¨å›¾å½¢ç”¨æˆ·ç•Œé¢ä¸­åº”ç”¨å¹¿æ³›ï¼Œç”¨æˆ·çš„æ“ä½œï¼ˆå¦‚ç‚¹å‡»æŒ‰é’®ã€é€‰æ‹©èœå•é¡¹ç­‰ï¼‰å¯ä»¥è¡¨ç¤ºä¸ºå‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œæ–‡æœ¬ç¼–è¾‘å™¨æ”¯æŒçš„â€œå‰ªåˆ‡â€ã€â€œå¤åˆ¶â€å’Œâ€œç²˜è´´â€ç­‰æ“ä½œï¼Œå¯ä»¥å®ç°ä¸ºç‹¬ç«‹çš„å‘½ä»¤å¯¹è±¡ã€‚è¿™ç§å°è£…æ–¹æ³•çš„å¥½å¤„åœ¨äºï¼Œè¿™äº›å‘½ä»¤å¯ä»¥è¢«è½»æ¾ç®¡ç†ã€æ’¤é”€æˆ–é‡åšï¼Œæå‡äº†ç”¨æˆ·äº¤äº’çš„çµæ´»æ€§ä¸ä½“éªŒã€‚ä»£ç ç¤ºä¾‹ï¼š interface Command void execute(); void undo();class CutCommand implements Command public void execute() // æ‰§è¡Œå‰ªåˆ‡æ“ä½œ public void undo() // æ’¤é”€å‰ªåˆ‡æ“ä½œ class CopyCommand implements Command public void execute() // æ‰§è¡Œå¤åˆ¶æ“ä½œ public void undo() // æ’¤é”€å¤åˆ¶æ“ä½œ çŠ¶æ€æ¨¡å¼çŠ¶æ€æ¨¡å¼å…è®¸ä¸€ä¸ªå¯¹è±¡æ ¹æ®å…¶å†…éƒ¨çŠ¶æ€çš„å˜åŒ–æ”¹å˜å…¶è¡Œä¸ºã€‚è¿™ä¸€æ¨¡å¼ç‰¹åˆ«é€‚ç”¨äºé‚£äº›å…·æœ‰å¤šç§çŠ¶æ€å¹¶èƒ½åœ¨çŠ¶æ€é—´è½¬æ¢çš„å¤æ‚ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œåœ¨æŸæ¬¾æ¸¸æˆä¸­ï¼Œè§’è‰²çš„çŠ¶æ€å¯ä»¥æ˜¯â€œå¾…æœºâ€ã€â€œè¡Œèµ°â€ã€â€œæ”»å‡»â€ç­‰ã€‚æ¯ç§çŠ¶æ€éƒ½æœ‰ç‹¬ç‰¹çš„è¡Œä¸ºå’Œå“åº”ï¼Œè€ŒçŠ¶æ€æ¨¡å¼ä½¿çŠ¶æ€çš„ç®¡ç†å’Œè½¬æ¢å˜å¾—æ›´ä¸ºæ¸…æ™°å’Œç®€åŒ–ã€‚é€šè¿‡é›†ä¸­ç®¡ç†ä¸åŒçŠ¶æ€ä¸‹çš„é€»è¾‘ï¼Œç¨‹åºå¯ä»¥åœ¨çŠ¶æ€æ”¹å˜æ—¶è¿…é€Ÿåšå‡ºååº”ï¼Œæé«˜äº†æ‰§è¡Œæ•ˆç‡ã€‚ä»£ç ç¤ºä¾‹ï¼š interface State void handle();class IdleState implements State public void handle() // å¤„ç†å¾…æœºçŠ¶æ€çš„é€»è¾‘ class WalkingState implements State public void handle() // å¤„ç†è¡Œèµ°çŠ¶æ€çš„é€»è¾‘ class Character private State currentState; public void setState(State state) currentState = state; public void action() currentState.handle(); èŒè´£é“¾æ¨¡å¼èŒè´£é“¾æ¨¡å¼é€šè¿‡å°†è¯·æ±‚çš„å‘é€è€…ä¸æ¥æ”¶è€…è§£è€¦ï¼Œä½¿å¾—å¤šä¸ªå¯¹è±¡æœ‰æœºä¼šå¤„ç†è¯·æ±‚ã€‚è¿™ç§æ¨¡å¼ä¸­ï¼Œå¤„ç†è¯·æ±‚çš„å¯¹è±¡æŒ‰é¡ºåºè¿æ¥æˆä¸€æ¡é“¾ï¼Œå¯ä»¥é€çº§ä¼ é€’è¯·æ±‚ã€‚ä»¥å®¢æˆ·æœåŠ¡ä¸­å¿ƒä¸ºä¾‹ï¼Œç”¨æˆ·çš„é—®é¢˜å¯èƒ½ä¼šç»å†å¤šä¸ªå¤„ç†é˜¶æ®µï¼Œä»åˆçº§æ”¯æŒåˆ°æŠ€æœ¯æ”¯æŒï¼Œç”šè‡³æ¸—é€åˆ°æ›´é«˜çº§çš„å¤„ç†å±‚çº§ã€‚æ¯ä¸ªé˜¶æ®µéƒ½æœ‰ä¸“å‘˜è´Ÿè´£ç‰¹å®šç±»å‹çš„é—®é¢˜ï¼Œé—®é¢˜ä¼šåœ¨è¿™äº›é˜¶æ®µé—´æµè½¬ï¼Œç›´åˆ°å¾—åˆ°è§£å†³æˆ–è€…æ”¾å¼ƒã€‚è¿™ç§ç»“æ„åŒ–çš„è¯·æ±‚å¤„ç†æ–¹æ³•æå‡äº†å“åº”æ•ˆç‡å’Œå®¢æˆ·æ»¡æ„åº¦ã€‚ä»£ç ç¤ºä¾‹ï¼š abstract class Handler protected Handler next; public void setNext(Handler next) this.next = next; public abstract void handleRequest(Request request);class LevelOneHandler extends Handler public void handleRequest(Request request) if (request.isSimple()) // å¤„ç†ç®€å•è¯·æ±‚ else if (next != null) next.handleRequest(request); class LevelTwoHandler extends Handler public void handleRequest(Request request) if (request.isTechnical()) // å¤„ç†æŠ€æœ¯è¯·æ±‚ else if (next != null) next.handleRequest(request); è§£é‡Šå™¨æ¨¡å¼è§£é‡Šå™¨æ¨¡å¼ä¸ºç‰¹å®šè¯­è¨€å®šä¹‰è¯­æ³•ï¼Œå¹¶æä¾›è§£æå’Œæ‰§è¡Œæ–¹å¼ã€‚æ­¤æ¨¡å¼åœ¨éœ€è¦åŠ¨æ€è§£è¯»å’Œæ‰§è¡Œé€»è¾‘çš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œè®¡ç®—å™¨ç¨‹åºå¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼æ¥è¡¨ç¤ºæ•°å­¦è¿ç®—ï¼Œé€šè¿‡è§£é‡Šå™¨æ¨¡å¼ï¼Œç¨‹åºèƒ½å¤Ÿè§£æç”¨æˆ·è¾“å…¥çš„è¡¨è¾¾å¼ï¼Œå¦‚â€œ3 + 5 * 2â€ï¼Œå¹¶è®¡ç®—å‡ºæ­£ç¡®çš„ç»“æœã€‚è¿™ç§çµæ´»çš„è§£æèƒ½åŠ›ä½¿å¾—ç¨‹åºå¯ä»¥å¤„ç†ç”¨æˆ·è‡ªä¸»å®šä¹‰çš„è¡¨è¾¾å¼ï¼Œæ‹“å®½äº†è½¯ä»¶çš„é€‚ç”¨èŒƒå›´ã€‚ ä»£ç ç¤ºä¾‹ï¼š interface Expression int interpret();class Number implements Expression private int number; public Number(int number) this.number = number; public int interpret() return number; class Addition implements Expression private Expression left; private Expression right; public Addition(Expression left, Expression right) this.left = left; this.right = right; public int interpret() return left.interpret() + right.interpret(); ä¸­ä»‹è€…æ¨¡å¼ä¸­ä»‹è€…æ¨¡å¼é€šè¿‡å¼•å…¥ä¸€ä¸ªä¸­ä»‹ç±»ï¼Œæ˜¾è‘—ç®€åŒ–äº†å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ï¼Œä½¿å¾—å¯¹è±¡é—´çš„è€¦åˆåº¦é™ä½ã€‚è¿™ç§æ–¹å¼å‡å°‘äº†ç»„ä»¶ä¹‹é—´çš„ç›´æ¥ä¾èµ–ï¼Œä½¿å¾—ç³»ç»Ÿæ›´åŠ çµæ´»ã€‚åœ¨ä¸€ä¸ªèŠå¤©åº”ç”¨çš„åœºæ™¯ä¸­ï¼Œæ‰€æœ‰ç”¨æˆ·å¹¶ä¸ç›´æ¥äº’ç›¸äº¤æµï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªä¸­å¤®æœåŠ¡å™¨è¿›è¡Œæ¶ˆæ¯çš„ä¼ é€’å’Œç®¡ç†ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ· A å‘é€æ¶ˆæ¯ç»™ç”¨æˆ· B æ—¶ï¼Œæ¶ˆæ¯é¦–å…ˆåˆ°è¾¾ä¸­ä»‹æœåŠ¡å™¨ï¼Œç”±ä¸­ä»‹æœåŠ¡å™¨å†è½¬å‘ç»™ç”¨æˆ· Bã€‚å¦‚æ­¤ä¸€æ¥ï¼ŒæœåŠ¡å™¨ä¸ä»…å¯ä»¥ç»Ÿä¸€ç®¡ç†æ¶ˆæ¯ï¼Œè¿˜å¯ä»¥å¤„ç†æ¶ˆæ¯çš„å­˜å‚¨ã€è½¬å‘ä»¥åŠç”¨æˆ·çš„åœ¨çº¿çŠ¶æ€ç­‰åŠŸèƒ½ï¼Œæœ‰æ•ˆæå‡äº†ç®¡ç†çš„æ•ˆç‡å’Œæ‰©å±•æ€§ã€‚ä»£ç ç¤ºä¾‹ï¼š class Mediator private ListUser users = new ArrayList(); public void registerUser(User user) users.add(user); public void sendMessage(String message, User sender) for (User user : users) // å‘é€æ¶ˆæ¯ç»™é™¤äº†å‘ä»¶äººä»¥å¤–çš„æ‰€æœ‰ç”¨æˆ· if (user != sender) user.receive(message); è®¿é—®è€…æ¨¡å¼è®¿é—®è€…æ¨¡å¼çš„æ ¸å¿ƒåœ¨äºå¯ä»¥åœ¨ä¸æ”¹å˜å…ƒç´ ç±»çš„åŸºç¡€ä¸Šï¼ŒåŠ¨æ€åœ°ä¸ºè¢«è®¿é—®çš„å…ƒç´ æ·»åŠ æ–°æ“ä½œã€‚è¿™ä¸€è®¾è®¡å°¤å…¶é€‚ç”¨äºé‚£äº›ç»“æ„ç›¸å¯¹ç¨³å®šä½†æ“ä½œéœ€æ±‚é¢‘ç¹å˜åŒ–çš„ç³»ç»Ÿã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä¸€ä¸ªå¤æ‚çš„æ•°æ®ç»“æ„ï¼ˆå¦‚å›¾å½¢åº“ï¼‰ä¸­ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ªä¸åŒçš„è®¿é—®è€…ï¼Œæ¯ä¸ªè®¿é—®è€…è´Ÿè´£ä¸ºä¸åŒç±»å‹çš„å›¾å½¢ï¼ˆå¦‚åœ†å½¢ã€æ–¹å½¢æˆ–ä¸‰è§’å½¢ï¼‰å®æ–½ç‹¬ç‰¹çš„æ¸²æŸ“ç­–ç•¥ã€‚è¿™æ ·ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡å®ç°æ–°çš„è®¿é—®è€…ç±»æ¥æ‰©å±•åŠŸèƒ½ï¼Œè€Œä¸å¿…ä¿®æ”¹ä»»ä½•å›¾å½¢ç±»ã€‚ä»£ç ç¤ºä¾‹ï¼š interface Visitor void visit(Circle circle); void visit(Square square);class Circle void accept(Visitor visitor) visitor.visit(this); class Square void accept(Visitor visitor) visitor.visit(this); ç­–ç•¥æ¨¡å¼ç­–ç•¥æ¨¡å¼é€šè¿‡å®šä¹‰ä¸€ç³»åˆ—å¯äº’æ¢çš„ç®—æ³•ï¼Œè®©å®¢æˆ·ç«¯å¯ä»¥åœ¨è¿è¡Œæ—¶é€‰æ‹©å…·ä½“çš„ç­–ç•¥ã€‚è¿™ç§æ¨¡å¼ç‰¹åˆ«é€‚åˆäºé‚£äº›éœ€è¦æ ¹æ®ç‰¹å®šæ¡ä»¶å¿«é€Ÿåˆ‡æ¢è¡Œä¸ºçš„åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªåœ¨çº¿é›¶å”®å•†çš„è´­ç‰©å¹³å°ä¸­ï¼Œä¸åŒçš„ä¿ƒé”€æ´»åŠ¨éœ€è¦ä¸åŒçš„æŠ˜æ‰£ç­–ç•¥ï¼Œå¦‚æ»¡å‡ã€ç™¾åˆ†æ¯”æŠ˜æ‰£ç­‰ã€‚æ¯ä¸€ç§æŠ˜æ‰£ç­–ç•¥éƒ½å¯ä»¥ç‹¬ç«‹åœ°å®ç°ï¼Œä»è€Œç®€åŒ–äº†ç³»ç»Ÿçš„ç»´æŠ¤å’Œæ‰©å±•è¿‡ç¨‹ã€‚ç”¨æˆ·åœ¨ç»“è´¦æ—¶ï¼Œç³»ç»Ÿä¼šæ ¹æ®å…¶è´­ç‰©æƒ…å†µè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜çš„æŠ˜æ‰£ç­–ç•¥ã€‚ä»£ç ç¤ºä¾‹ï¼š interface DiscountStrategy double applyDiscount(double price);class FullReductionStrategy implements DiscountStrategy public double applyDiscount(double price) return price - 50; // æ»¡å‡50 class PercentageDiscountStrategy implements DiscountStrategy public double applyDiscount(double price) return price * 0.9; // 90% çš„ä»·æ ¼ å¤‡å¿˜å½•æ¨¡å¼å¤‡å¿˜å½•æ¨¡å¼å…è®¸å¯¹è±¡åœ¨ä¸æš´éœ²å†…éƒ¨çŠ¶æ€çš„æƒ…å†µä¸‹ï¼Œä¿å­˜å’Œæ¢å¤å…¶çŠ¶æ€ã€‚è¿™ä¸€æ¨¡å¼ç‰¹åˆ«é€‚åˆäºéœ€è¦å®ç°æ’¤é”€æˆ–æ¢å¤åŠŸèƒ½çš„åº”ç”¨åœºåˆã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€æ¬¾æ–‡æœ¬å¤„ç†å™¨ä¸­ï¼Œä¸ºäº†æä¾›ç”¨æˆ·æ’¤å›æœ€è¿‘ç¼–è¾‘æ“ä½œçš„èƒ½åŠ›ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é‡‡ç”¨å¤‡å¿˜å½•æ¨¡å¼æ¥ä¿å­˜æ–‡æœ¬çš„å¤šä¸ªç¼–è¾‘çŠ¶æ€ã€‚æ¯å½“ç”¨æˆ·åšå‡ºæ”¹å˜æ—¶ï¼Œåº”ç”¨ç¨‹åºä¾¿ä¼šåˆ›å»ºä¸€ä¸ªçŠ¶æ€å¿«ç…§ï¼Œç”¨æˆ·éšæ—¶å¯ä»¥é€‰æ‹©æ¢å¤åˆ°ä¹‹å‰æŸä¸ªç‰¹å®šçš„çŠ¶æ€ã€‚ä»£ç ç¤ºä¾‹ï¼š class Memento private String state; public Memento(String state) this.state = state; public String getState() return state; class TextEditor private String content; public Memento save() return new Memento(content); public void restore(Memento memento) this.content = memento.getState(); è¿­ä»£å™¨æ¨¡å¼è¿­ä»£å™¨æ¨¡å¼æä¾›äº†ä¸€ç§é¡ºåºè®¿é—®é›†åˆå¯¹è±¡ä¸­å…ƒç´ çš„æ–¹å¼ï¼ŒåŒæ—¶åˆä¸æš´éœ²é›†åˆçš„å†…éƒ¨ç»“æ„ã€‚è¿™ç§æ¨¡å¼é€šå¸¸è¢«åº”ç”¨äºå„ç§é›†åˆç±»ï¼Œå¦‚åˆ—è¡¨ã€æ ‘æˆ–å…¶ä»–å¤æ‚çš„æ•°æ®ç»“æ„ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ä¸€ä¸ªç”µå•†å¹³å°çš„è´­ç‰©è½¦ä¸­ï¼Œç”¨æˆ·èƒ½å¤Ÿé€ä¸€æŸ¥çœ‹è´­ç‰©è½¦ä¸­çš„å•†å“ã€‚é€šè¿‡è¿­ä»£å™¨çš„å®ç°ï¼Œç”¨æˆ·å¯ä»¥ä¾¿æ·åœ°è®¿é—®æ¯ä¸€ä»¶å•†å“ï¼Œè€Œæ— éœ€äº†è§£èƒŒåå¤æ‚çš„å®ç°ç»†èŠ‚ã€‚ä»£ç ç¤ºä¾‹ï¼š interface Iterator boolean hasNext(); Object next();class ShoppingCart private ListItem items = new ArrayList(); public void addItem(Item item) items.add(item); public Iterator iterator() return new ShoppingCartIterator(); private class ShoppingCartIterator implements Iterator private int index = 0; public boolean hasNext() return index items.size(); public Object next() return items.get(index++);","categories":["2.ç¼–ç¨‹è¯­è¨€","ç»“æ„ç®—æ³•"]},{"title":"ç®—æ³•","path":"/2024/01/24/2-ç¼–ç¨‹è¯­è¨€-ç»“æ„ç®—æ³•-ç®—æ³•/","content":"æåˆ°ç®—æ³•æ—¶ï¼Œå°±ä¸èƒ½å¿½è§†æ•°æ®ç»“æ„ä¹‹é—´çš„ç´§å¯†è”ç³»ã€‚ä»¬ç»å¸¸ä¼šè§åˆ°è¿™æ ·ä¸€ä¸ªè‘—åçš„å…¬å¼ï¼š æ•°æ®ç»“æ„ + ç®—æ³• ç¨‹åºä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸ªå…¬å¼ï¼Œä»¬ä¸å¦¨å…ˆçœ‹ä¸€å¼ ç¤ºæ„å›¾ï¼Œæ¥å…·ä½“å±•ç¤ºç®—æ³•ä¸æ•°æ®ç»“æ„çš„å…³ç³»ã€‚ ç®—æ³•çš„å®šä¹‰ç®—æ³•å¯ä»¥è¢«è§†ä¸ºä¸€ç³»åˆ—æœ‰ç©·çš„è§„åˆ™ã€è¯­å¥å’ŒæŒ‡ä»¤çš„é›†åˆã€‚è¿™äº›æŒ‡ä»¤æŒ‡æ˜äº†å¦‚ä½•é€šè¿‡ç‰¹å®šçš„æ­¥éª¤è§£å†³æŸä¸ªå…·ä½“çš„é—®é¢˜ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåˆ¶ä½œä¸€æ¯å’–å•¡çš„è¿‡ç¨‹å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§ç®—æ³•ï¼Œå®ƒåŒ…å«äº†æ­¥éª¤ï¼Œæ¯”å¦‚ï¼š1ï¼‰çƒ§æ°´ï¼Œ2ï¼‰å†²æ³¡å’–å•¡ç²‰ï¼Œ3ï¼‰åŠ å…¥ç‰›å¥¶ç­‰ã€‚æ¯ä¸€æ­¥éƒ½å¿…é¡»æ¸…æ™°åœ°å®šä¹‰ï¼Œæ‰èƒ½ç¡®ä¿æœ€ç»ˆå¾—åˆ°ä¸€æ¯ç¾å‘³çš„å’–å•¡ã€‚ ä¸€ã€ç®—æ³•çš„ç‰¹æ€§åœ¨è®¨è®ºç®—æ³•æ—¶ï¼Œæœ‰å‡ ä¸ªå…³é”®ç‰¹æ€§æ˜¯å¿…é¡»äº†è§£çš„ï¼š æœ‰ç©·æ€§ç®—æ³•çš„æ‰§è¡Œæ­¥éª¤æ˜¯æœ‰é™çš„ï¼Œæ„å‘³ç€åœ¨æŸä¸ªç‰¹å®šçš„æ—¶é—´å†…ï¼Œç®—æ³•ä¸€å®šèƒ½å¤Ÿå®Œæˆã€‚ ç¡®å®šæ€§æ¯ä¸ªæ­¥éª¤åº”å½“æ¸…æ™°æ˜ç¡®ï¼Œæ²¡æœ‰æ­§ä¹‰ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºä¸€ä¸ªæ¨¡ç³Šçš„æ­¥éª¤å¯èƒ½å¯¼è‡´é”™è¯¯çš„ç»“æœã€‚ å¯è¡Œæ€§ç®—æ³•çš„æ¯ä¸€è®¡ç®—æ­¥éª¤éƒ½è¦åœ¨åˆç†çš„æ—¶é—´é™åˆ¶å†…å®Œæˆï¼Œç¡®ä¿ç®—æ³•åœ¨å®é™…åº”ç”¨ä¸­çš„å¯ç”¨æ€§ã€‚ è¾“å…¥ä¸€ä¸ªç®—æ³•å¯ä»¥æ¥æ”¶ä¸€ä¸ªæˆ–å¤šä¸ªå¤–éƒ¨è¾“å…¥ã€‚ä¾‹å¦‚ï¼Œè®¡ç®—ä¸¤ä¸ªæ•°å­—çš„å’Œéœ€è¦ç”¨æˆ·æä¾›è¿™ä¸¤ä¸ªæ•°å­—ä½œä¸ºè¾“å…¥ã€‚ è¾“å‡ºä¸€ä¸ªç®—æ³•å¿…é¡»ä¼šç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªè¾“å‡ºç»“æœï¼Œè¿™å®é™…ä¸Šæ˜¯ç®—æ³•æ‰§è¡Œçš„ç›®çš„æ‰€åœ¨ã€‚ äºŒã€å¦‚ä½•è¯„ä»·ä¸€ä¸ªç®—æ³•çš„å¥½åè¯„ä¼°ä¸€ä¸ªç®—æ³•çš„å¥½åï¼Œéœ€è¦ä»å¤šä¸ªè§’åº¦è¿›è¡Œè€ƒé‡ï¼š æ—¶é—´æ¶ˆè€—ç®—æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ—¶é—´æ¶ˆè€—æ˜¯ä¸€ä¸ªé‡è¦æŒ‡æ ‡ã€‚ä¾‹å¦‚ï¼Œåœ¨æ’åºç®—æ³•ä¸­ï¼Œæ—¶é—´å¤æ‚åº¦å¯ä»¥å†³å®šå…¶åœ¨å¤„ç†å¤§æ•°æ®é›†æ—¶çš„è¡¨ç°ã€‚ å­˜å‚¨ç©ºé—´æ¶ˆè€—ä¸€äº›ç®—æ³•åœ¨è¿è¡ŒæœŸé—´å¯èƒ½éœ€è¦å¤§é‡å†…å­˜ï¼Œè¿™ä¼šå½±å“åˆ°ç¨‹åºçš„æ€§èƒ½å’Œå¯ç”¨æ€§ï¼Œå› æ­¤è¦è€ƒè™‘å­˜å‚¨ç©ºé—´çš„æ¶ˆè€—ã€‚ æ˜“äºç†è§£å’Œå®ç°ç®—æ³•çš„è®¾è®¡åº”å½“åº”æ˜“äºç†è§£ä¸å®ç°ï¼Œè¿™ä¸ä»…æœ‰åŠ©äºç¼–ç¨‹ï¼Œè¿˜æ–¹ä¾¿åæœŸçš„è°ƒè¯•ä¸ç»´æŠ¤ã€‚ä¾‹å¦‚ï¼Œå¿«é€Ÿæ’åºçš„ç®—æ³•ç›¸å¯¹é€šä¿—æ˜“æ‡‚ï¼Œå› è€Œè¢«å¹¿æ³›ä½¿ç”¨ã€‚ ä¸‰ã€æ—¶é—´å¤æ‚åº¦æ—¶é—´å¤æ‚åº¦æ˜¯ç”¨æ¥æè¿°ç®—æ³•éšè¾“å…¥è§„æ¨¡å¢é•¿è€Œå¢é•¿çš„æ—¶é—´æ¶ˆè€—æƒ…å†µã€‚ä»¬å…ˆä»‹ç»å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š é—®é¢˜çš„è§„æ¨¡è¾“å…¥æ•°æ®çš„å¤§å°é€šå¸¸ç”¨ n æ¥è¡¨ç¤ºã€‚æ›´å¤§çš„ n æ„å‘³ç€æ›´å¤æ‚çš„è®¡ç®—ã€‚ æ—¶é—´å¤æ‚åº¦ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯æ¶ˆè€—æ—¶é—´ä¸é—®é¢˜è§„æ¨¡ n ä¹‹é—´çš„å‡½æ•°å…³ç³»ï¼Œé€šå¸¸è®°ä¸º T(n)ã€‚ 1. è¯­å¥çš„é¢‘åº¦è¯­å¥çš„é¢‘åº¦æ˜¯æŒ‡åœ¨ä¸€ä¸ªç®—æ³•ä¸­å¯æ‰§è¡Œçš„è¯­å¥è¢«åå¤æ‰§è¡Œçš„æ¬¡æ•°ã€‚å‡è®¾æŸä¸ªå¯æ‰§è¡Œè¯­å¥çš„æ‰§è¡Œæ—¶é—´ä¸º tï¼Œå¹¶ä¸”æ‰§è¡Œæ¬¡æ•°ä¸º fï¼Œé‚£ä¹ˆè¯¥è¯­å¥æ‰€è€—è´¹çš„æ—¶é—´å¯ä»¥è®¡ç®—ä¸ºï¼št*f ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªç®—æ³•éœ€è¦æ‰§è¡Œçš„å¾ªç¯ä½“ä¸­å­˜åœ¨äº”ä¸ªå¯æ‰§è¡Œè¯­å¥ï¼Œæ¯ä¸ªè¯­å¥æ‰§è¡Œçš„æ—¶é—´ä¸º 1 æ¯«ç§’ï¼Œé‚£ä¹ˆæ€»è€—æ—¶ä¸º 5 æ¯«ç§’ã€‚ä»¥ä¸‹é¢ç¨‹åºä¸ºä¾‹ï¼Œæ±‚ä¸¤ä¸ª N é˜¶æ–¹é˜µä¹˜ç§¯ï¼š void MATRIXM(A, B, C) float A[n][n], B[n][n], C[n][n]; int i, j, k; // è¯­å¥é¢‘åº¦ for (i = 0; i n; i++) // n+1 for (j = 0; j n; j++) // n(n+1) C[i][j] = 0; // n*n for (k = 0; k n; k++) // n*n(n+1) C[i][j] = C[i][j] + A[i][k] * B[k][j]; // n*n*n 2. ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯æ‰€æœ‰å¯æ‰§è¡Œè¯­å¥çš„é¢‘åº¦ä¹‹å’Œï¼Œè®°ä¸º T(n)ã€‚T(n) æ˜¯ç®—æ³•æ‰€éœ€æ—¶é—´çš„ä¸€ç§ä¼°è®¡ï¼Œå…¶ä¸­ n ä¸ºé—®é¢˜çš„è§„æ¨¡ï¼ˆæˆ–å¤§å°ã€ä½“ç§¯ï¼‰ã€‚å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé—®é¢˜çš„è§„æ¨¡ n ä¸ºçŸ©é˜µçš„é˜¶ï¼Œè¯¥ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼š T(n) = (n+1) + n(n+1) + n^2 + n^2(n+1) + n^3 = 2n^3 + 3n^2 + 2n + 1 å½“é—®é¢˜è§„æ¨¡ n è¶‹è¿‘äºæ— ç©·å¤§æ—¶ï¼Œlim(T(n)/(nÂ³) =2ï¼Œæ•… T(n) ä¸ nÂ³ ä¸ºåŒé˜¶æ— ç©·å¤§ï¼Œæˆ–è€…è¯´ T(n) ä¸ nÂ³ æˆæ­£æ¯”ã€T(n) çš„é‡çº§ä¸º nÂ³ï¼Œè®°ä¸º T(n) = O(nÂ³); é—®é¢˜è§„æ¨¡ n çš„æŸä¸ªå‡½æ•° f(n), T(n) O (f(n))ã€‚éšç€é—®é¢˜è§„æ¨¡ n çš„å¢å¤§ï¼Œç®—æ³•æ‰§è¡Œæ—¶é—´çš„å¢é•¿ç‡å’Œ f(n)çš„å¢é•¿ç‡ç›¸åŒ","categories":["2.ç¼–ç¨‹è¯­è¨€","ç»“æ„ç®—æ³•"]},{"title":"g++å‚æ•°ä»‹ç»","path":"/2024/01/23/6-å¼€å‘å·¥å…·-ç¼–è¯‘é“¾æ¥-g-å‚æ•°ä»‹ç»/","content":"ä»‹ç»gcc and g++åˆ†åˆ«æ˜¯ gnu çš„ c c++ç¼–è¯‘å™¨ï¼Œgccg++åœ¨æ‰§è¡Œç¼–è¯‘å·¥ä½œçš„æ—¶å€™ï¼Œæ€»å…±éœ€è¦ 4 æ­¥ é¢„å¤„ç†,ç”Ÿæˆ.i çš„æ–‡ä»¶ å°†é¢„å¤„ç†åçš„æ–‡ä»¶ä¸è½¬æ¢æˆæ±‡ç¼–è¯­è¨€,ç”Ÿæˆæ–‡ä»¶.s æœ‰æ±‡ç¼–å˜ä¸ºç›®æ ‡ä»£ç (æœºå™¨ä»£ç )ç”Ÿæˆ.o çš„æ–‡ä»¶ è¿æ¥ç›®æ ‡ä»£ç ,ç”Ÿæˆå¯æ‰§è¡Œç¨‹åº æ€»ä½“é€‰é¡¹ -E åªæ¿€æ´»é¢„å¤„ç†,è¿™ä¸ªä¸ç”Ÿæˆæ–‡ä»¶,éœ€è¦æŠŠå®ƒé‡å®šå‘åˆ°ä¸€ä¸ªè¾“å‡ºæ–‡ä»¶é‡Œé¢. gcc -E hello.c pianoapan.txtgcc -E hello.c | more æ…¢æ…¢çœ‹å§,ä¸€ä¸ª hello word ä¹Ÿè¦ä¸å¤„ç†æˆ 800 è¡Œçš„ä»£ç  -S åªæ¿€æ´»é¢„å¤„ç†å’Œç¼–è¯‘ï¼Œå°±æ˜¯æŒ‡æŠŠæ–‡ä»¶ç¼–è¯‘æˆä¸ºæ±‡ç¼–ä»£ç ã€‚ gcc -S hello.c ä»–å°†ç”Ÿæˆ.s çš„æ±‡ç¼–ä»£ç ï¼Œå¯ä»¥ç”¨æ–‡æœ¬ç¼–è¾‘å™¨å¯Ÿçœ‹ -c åªæ¿€æ´»é¢„å¤„ç†,ç¼–è¯‘,å’Œæ±‡ç¼–,ä¹Ÿå°±æ˜¯ä»–åªæŠŠç¨‹åºåšæˆ obj æ–‡ä»¶ gcc -c hello.c ä»–å°†ç”Ÿæˆ.o çš„ obj æ–‡ä»¶ ç›®å½•é€‰é¡¹-Idir åœ¨æ˜¯ç”¨#includeâ€fileâ€çš„æ—¶å€™,gccg++ä¼šå…ˆåœ¨å½“å‰ç›®å½•æŸ¥æ‰¾æ‰€åˆ¶å®šçš„å¤´æ–‡ä»¶,å¦‚æœæ²¡æœ‰æ‰¾åˆ°,ä»–å›åˆ°ç¼ºçœçš„å¤´æ–‡ä»¶ç›®å½•æ‰¾,å¦‚æœä½¿ç”¨-I åˆ¶å®šäº†ç›®å½•,ä»–å›å…ˆåœ¨æ‰€åˆ¶å®šçš„ç›®å½•æŸ¥æ‰¾,ç„¶åå†æŒ‰å¸¸è§„çš„é¡ºåºå»æ‰¾.å¯¹äº#include,gccg++ä¼šåˆ°-I åˆ¶å®šçš„ç›®å½•æŸ¥æ‰¾,æŸ¥æ‰¾ä¸åˆ°,ç„¶åå°†åˆ°ç³»ç»Ÿçš„ç¼ºçœçš„å¤´æ–‡ä»¶ç›®å½•æŸ¥æ‰¾-include file -i ç›¸å½“äºâ€#includeâ€åŒ…å«æŸä¸ªä»£ç ,ç®€å•æ¥è¯´,å°±æ˜¯ä¾¿ä»¥æŸä¸ªæ–‡ä»¶,éœ€è¦å¦ä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™,å°±å¯ä»¥ç”¨å®ƒè®¾å®š,åŠŸèƒ½å°±ç›¸å½“äºåœ¨ä»£ç ä¸­ä½¿ç”¨#include gcc hello.c -include /root/pianopan.h -I-å°±æ˜¯å–æ¶ˆå‰ä¸€ä¸ªå‚æ•°çš„åŠŸèƒ½,æ‰€ä»¥ä¸€èˆ¬åœ¨-Idir ä¹‹åä½¿ç”¨-idirafter dir åœ¨-I çš„ç›®å½•é‡Œé¢æŸ¥æ‰¾å¤±è´¥,è®²åˆ°è¿™ä¸ªç›®å½•é‡Œé¢æŸ¥æ‰¾. -iprefix prefix -iwithprefix dir ä¸€èˆ¬ä¸€èµ·ä½¿ç”¨,å½“-I çš„ç›®å½•æŸ¥æ‰¾å¤±è´¥,ä¼šåˆ° prefix+dir ä¸‹æŸ¥æ‰¾ -Ldir åˆ¶å®šç¼–è¯‘çš„æ—¶å€™ï¼Œæœç´¢åº“çš„è·¯å¾„ã€‚æ¯”å¦‚è‡ªå·±çš„åº“ï¼Œå¯ä»¥ç”¨å®ƒåˆ¶å®šç›®å½•ï¼Œä¸ç„¶ç¼–è¯‘å™¨å°†åªåœ¨æ ‡å‡†åº“çš„ç›®å½•æ‰¾ã€‚è¿™ä¸ª dir å°±æ˜¯ç›®å½•çš„åç§°ã€‚ -llibrary åˆ¶å®šç¼–è¯‘çš„æ—¶å€™ä½¿ç”¨çš„åº“ gcc -lcurses hello.c ä½¿ç”¨ ncurses åº“ç¼–è¯‘ç¨‹åº è°ƒè¯•é€‰é¡¹ -g åªæ˜¯ç¼–è¯‘å™¨ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œäº§ç”Ÿè°ƒè¯•ä¿¡æ¯ã€‚ -gstabs æ­¤é€‰é¡¹ä»¥ stabs æ ¼å¼å£°ç§°è°ƒè¯•ä¿¡æ¯,ä½†æ˜¯ä¸åŒ…æ‹¬ gdb è°ƒè¯•ä¿¡æ¯. -gstabs+ æ­¤é€‰é¡¹ä»¥ stabs æ ¼å¼å£°ç§°è°ƒè¯•ä¿¡æ¯,å¹¶ä¸”åŒ…å«ä»…ä¾› gdb ä½¿ç”¨çš„é¢å¤–è°ƒè¯•ä¿¡æ¯. -ggdb æ­¤é€‰é¡¹å°†å°½å¯èƒ½çš„ç”Ÿæˆ gdb çš„å¯ä»¥ä½¿ç”¨çš„è°ƒè¯•ä¿¡æ¯. -glevel è¯·æ±‚ç”Ÿæˆè°ƒè¯•ä¿¡æ¯ï¼ŒåŒæ—¶ç”¨ level æŒ‡å‡ºéœ€è¦å¤šå°‘ä¿¡æ¯ï¼Œé»˜è®¤çš„ level å€¼æ˜¯ 2 é“¾æ¥æ–¹å¼é€‰é¡¹ï¼š-static æ­¤é€‰é¡¹å°†ç¦æ­¢ä½¿ç”¨åŠ¨æ€åº“ã€‚ ä¼˜ç‚¹ï¼šç¨‹åºè¿è¡Œä¸ä¾èµ–äºå…¶ä»–åº“ ç¼ºç‚¹ï¼šæ–‡ä»¶æ¯”è¾ƒå¤§ -shared (-G) æ­¤é€‰é¡¹å°†å°½é‡ä½¿ç”¨åŠ¨æ€åº“ï¼Œä¸ºé»˜è®¤é€‰é¡¹ ä¼˜ç‚¹ï¼šç”Ÿæˆæ–‡ä»¶æ¯”è¾ƒå° ç¼ºç‚¹ï¼šè¿è¡Œæ—¶éœ€è¦ç³»ç»Ÿæä¾›åŠ¨æ€åº“ -symbolic å»ºç«‹å…±äº«ç›®æ ‡æ–‡ä»¶çš„æ—¶å€™,æŠŠå¼•ç”¨ç»‘å®šåˆ°å…¨å±€ç¬¦å·ä¸Š. å¯¹æ‰€æœ‰æ— æ³•è§£æçš„å¼•ç”¨ä½œå‡ºè­¦å‘Š(é™¤éç”¨è¿æ¥ç¼–è¾‘é€‰é¡¹ -Xlinker -z -Xlinker defsâ€™å–ä»£)ã€‚ æ³¨ï¼šåªæœ‰éƒ¨åˆ†ç³»ç»Ÿæ”¯æŒè¯¥é€‰é¡¹. é”™è¯¯ä¸å‘Šè­¦é€‰é¡¹ -Wall ä¸€èˆ¬ä½¿ç”¨è¯¥é€‰é¡¹ï¼Œå…è®¸å‘å‡º GCC èƒ½å¤Ÿæä¾›çš„æ‰€æœ‰æœ‰ç”¨çš„è­¦å‘Šã€‚ä¹Ÿå¯ä»¥ç”¨-W{warning}æ¥æ ‡è®°æŒ‡å®šçš„è­¦å‘Šã€‚ -pedantic å…è®¸å‘å‡º ANSIISO C æ ‡å‡†æ‰€åˆ—å‡ºçš„æ‰€æœ‰è­¦å‘Š -pedantic-errors å…è®¸å‘å‡º ANSIISO C æ ‡å‡†æ‰€åˆ—å‡ºçš„é”™è¯¯ -werror æŠŠæ‰€æœ‰è­¦å‘Šè½¬æ¢ä¸ºé”™è¯¯ï¼Œä»¥åœ¨è­¦å‘Šå‘ç”Ÿæ—¶ä¸­æ­¢ç¼–è¯‘è¿‡ç¨‹ -w å…³é—­æ‰€æœ‰è­¦å‘Š,å»ºè®®ä¸è¦ä½¿ç”¨æ­¤é¡¹ é¢„å¤„ç†é€‰é¡¹ -Dmacro ç›¸å½“äº C è¯­è¨€ä¸­çš„#define macro -Dmacrodefn ç›¸å½“äº C è¯­è¨€ä¸­çš„#define macrodefn -Umacro ç›¸å½“äº C è¯­è¨€ä¸­çš„#undef macro -undef å–æ¶ˆå¯¹ä»»ä½•éæ ‡å‡†å®çš„å®šä¹‰ å…¶ä»–é€‰é¡¹-o åˆ¶å®šç›®æ ‡åç§°,ç¼ºçœçš„æ—¶å€™,gcc ç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶æ˜¯ a.out gcc -o hello.exe hello.c (å“¦,windowsç”¨ä¹ æƒ¯äº†)gcc -o hello.asm -S hello.c -O0 -O1 -O2 -O3 ç¼–è¯‘å™¨çš„ä¼˜åŒ–é€‰é¡¹çš„ 4 ä¸ªçº§åˆ«ï¼Œ-O0 è¡¨ç¤ºæ²¡æœ‰ä¼˜åŒ–,-O1 ä¸ºç¼ºçœå€¼ï¼Œ-O3 ä¼˜åŒ–çº§åˆ«æœ€é«˜ -fpic ç¼–è¯‘å™¨å°±ç”Ÿæˆä½ç½®æ— å…³ç›®æ ‡ç .é€‚ç”¨äºå…±äº«åº“(shared library). -fPIC ç¼–è¯‘å™¨å°±è¾“å‡ºä½ç½®æ— å…³ç›®æ ‡ç .é€‚ç”¨äºåŠ¨æ€è¿æ¥(dynamic linking),å³ä½¿åˆ†æ”¯éœ€è¦å¤§èŒƒå›´è½¬ç§». -v æ˜¾ç¤ºè¯¦ç»†çš„ç¼–è¯‘ã€æ±‡ç¼–ã€è¿æ¥å‘½ä»¤ -pipe ä½¿ç”¨ç®¡é“ä»£æ›¿ç¼–è¯‘ä¸­ä¸´æ—¶æ–‡ä»¶,åœ¨ä½¿ç”¨é gnu æ±‡ç¼–å·¥å…·çš„æ—¶å€™,å¯èƒ½æœ‰äº›é—®é¢˜ gcc -pipe -o hello.exe hello.c -ansi å…³é—­ gnu c ä¸­ä¸ ansi c ä¸å…¼å®¹çš„ç‰¹æ€§,æ¿€æ´» ansi c çš„ä¸“æœ‰ç‰¹æ€§(åŒ…æ‹¬ç¦æ­¢ä¸€äº› asm inline typeof å…³é”®å­—,ä»¥åŠ UNIX,vax ç­‰é¢„å¤„ç†å®, -fno-asm æ­¤é€‰é¡¹å®ç° ansi é€‰é¡¹çš„åŠŸèƒ½çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒç¦æ­¢å°† asm,inline å’Œ typeof ç”¨ä½œå…³é”®å­—ã€‚ -fno-strict-prototype åªå¯¹ g++èµ·ä½œç”¨,ä½¿ç”¨è¿™ä¸ªé€‰é¡¹,g++å°†å¯¹ä¸å¸¦å‚æ•°çš„å‡½æ•°,éƒ½è®¤ä¸ºæ˜¯æ²¡æœ‰æ˜¾å¼çš„å¯¹å‚æ•°çš„ä¸ªæ•°å’Œç±»å‹è¯´æ˜,è€Œä¸æ˜¯æ²¡æœ‰å‚æ•°.è€Œ gcc æ— è®ºæ˜¯å¦ä½¿ç”¨è¿™ä¸ªå‚æ•°,éƒ½å°†å¯¹æ²¡æœ‰å¸¦å‚æ•°çš„å‡½æ•°,è®¤ä¸ºåŸæ²¡æœ‰æ˜¾å¼è¯´æ˜çš„ç±»å‹ -fthis-is-varialble å°±æ˜¯å‘ä¼ ç»Ÿ c++çœ‹é½,å¯ä»¥ä½¿ç”¨ this å½“ä¸€èˆ¬å˜é‡ä½¿ç”¨. -fcond-mismatch å…è®¸æ¡ä»¶è¡¨è¾¾å¼çš„ç¬¬äºŒå’Œç¬¬ä¸‰å‚æ•°ç±»å‹ä¸åŒ¹é…,è¡¨è¾¾å¼çš„å€¼å°†ä¸º void ç±»å‹ -funsigned-char -fno-signed-char -fsigned-char -fno-unsigned-char è¿™å››ä¸ªå‚æ•°æ˜¯å¯¹ char ç±»å‹è¿›è¡Œè®¾ç½®,å†³å®šå°† char ç±»å‹è®¾ç½®æˆ unsigned char(å‰ ä¸¤ä¸ªå‚æ•°)æˆ–è€… signed char(åä¸¤ä¸ªå‚æ•°) -imacros file å°† file æ–‡ä»¶çš„å®,æ‰©å±•åˆ° gccg++çš„è¾“å…¥æ–‡ä»¶,å®å®šä¹‰æœ¬èº«å¹¶ä¸å‡ºç°åœ¨è¾“å…¥æ–‡ä»¶ä¸­ -nostdinc ä½¿ç¼–è¯‘å™¨ä¸å†ç³»ç»Ÿç¼ºçœçš„å¤´æ–‡ä»¶ç›®å½•é‡Œé¢æ‰¾å¤´æ–‡ä»¶,ä¸€èˆ¬å’Œ-I è”åˆä½¿ç”¨,æ˜ç¡®é™å®šå¤´æ–‡ä»¶çš„ä½ç½® -nostdin C++ è§„å®šä¸åœ¨ g++æŒ‡å®šçš„æ ‡å‡†è·¯ç»ä¸­æœç´¢,ä½†ä»åœ¨å…¶ä»–è·¯å¾„ä¸­æœç´¢,.æ­¤é€‰é¡¹åœ¨åˆ›å»º libg++åº“ä½¿ç”¨ -C åœ¨é¢„å¤„ç†çš„æ—¶å€™,ä¸åˆ é™¤æ³¨é‡Šä¿¡æ¯,ä¸€èˆ¬å’Œ-E ä½¿ç”¨,æœ‰æ—¶å€™åˆ†æç¨‹åºï¼Œç”¨è¿™ä¸ªå¾ˆæ–¹ä¾¿çš„ -M ç”Ÿæˆæ–‡ä»¶å…³è”çš„ä¿¡æ¯ã€‚åŒ…å«ç›®æ ‡æ–‡ä»¶æ‰€ä¾èµ–çš„æ‰€æœ‰æºä»£ç å¯ä»¥ç”¨ gcc -M hello.c æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œå¾ˆç®€å•ã€‚ -MM å’Œä¸Šé¢çš„é‚£ä¸ªä¸€æ ·ï¼Œä½†æ˜¯å®ƒå°†å¿½ç•¥ç”±#include é€ æˆçš„ä¾èµ–å…³ç³»ã€‚ -MD å’Œ-M ç›¸åŒï¼Œä½†æ˜¯è¾“å‡ºå°†å¯¼å…¥åˆ°.d çš„æ–‡ä»¶é‡Œé¢ -MMD å’Œ-MM ç›¸åŒï¼Œä½†æ˜¯è¾“å‡ºå°†å¯¼å…¥åˆ°.d çš„æ–‡ä»¶é‡Œé¢ -Wa,option æ­¤é€‰é¡¹ä¼ é€’ option ç»™æ±‡ç¼–ç¨‹åº;å¦‚æœ option ä¸­é—´æœ‰é€—å·,å°±å°† option åˆ†æˆå¤šä¸ªé€‰é¡¹,ç„¶åä¼ é€’ç»™ä¼šæ±‡ç¼–ç¨‹åº -Wl.option æ­¤é€‰é¡¹ä¼ é€’ option ç»™è¿æ¥ç¨‹åº;å¦‚æœ option ä¸­é—´æœ‰é€—å·,å°±å°† option åˆ†æˆå¤šä¸ªé€‰é¡¹,ç„¶åä¼ é€’ç»™ä¼šè¿æ¥ç¨‹åº. -x language filename è®¾å®šæ–‡ä»¶æ‰€ä½¿ç”¨çš„è¯­è¨€,ä½¿åç¼€åæ— æ•ˆ,å¯¹ä»¥åçš„å¤šä¸ªæœ‰æ•ˆ.ä¹Ÿå°±æ˜¯æ ¹æ®çº¦å®š C è¯­è¨€çš„åç¼€åç§°æ˜¯.c çš„ï¼Œè€Œ C++çš„åç¼€åæ˜¯.C æˆ–è€….cppå¯ä»¥ä½¿ç”¨çš„å‚æ•°æœ‰ä¸‹é¢çš„è¿™äº› `câ€™, `objective-câ€™, `c-headerâ€™, `c++â€™, `cpp-outputâ€™, `assemblerâ€™, and `assembler-with-cppâ€™. gcc -x c hello.pig -x none filename å…³æ‰ä¸Šä¸€ä¸ªé€‰é¡¹ï¼Œä¹Ÿå°±æ˜¯è®© gcc æ ¹æ®æ–‡ä»¶ååç¼€ï¼Œè‡ªåŠ¨è¯†åˆ«æ–‡ä»¶ç±»å‹ gcc -x c hello.pig -x none hello2.c","categories":["6.å¼€å‘å·¥å…·","ç¼–è¯‘é“¾æ¥"]},{"title":"GCCç¼–è¯‘æµç¨‹","path":"/2024/01/22/6-å¼€å‘å·¥å…·-ç¼–è¯‘é“¾æ¥-GCCç¼–è¯‘æµç¨‹/","content":"GCC ç¼–è¯‘æµç¨‹GCCï¼ˆGNU Compiler Collectionï¼‰æ˜¯ä¸€æ¬¾å¼ºå¤§çš„ç¼–è¯‘å™¨ï¼Œä¸»è¦ç”¨äºå°† Cã€C++ ç­‰è¯­è¨€çš„æºä»£ç ç¼–è¯‘æˆæœºå™¨å¯æ‰§è¡Œæ–‡ä»¶ã€‚æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºå››ä¸ªä¸»è¦æ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æœ‰å…¶ç‰¹å®šçš„åŠŸèƒ½å’Œé‡è¦æ€§ã€‚ Step 1: é¢„å¤„ç†åœ¨é¢„å¤„ç†é˜¶æ®µï¼ŒGCC ä¼šå¤„ç†ä¸€äº›ç‰¹æ®Šçš„æŒ‡ä»¤å’Œæ–‡ä»¶ï¼š å¤´æ–‡ä»¶åŠ è½½ï¼šæºä»£ç ä¸­é€šå¸¸ä¼šä½¿ç”¨ #include æŒ‡ä»¤æ¥å¼•ç”¨å¤–éƒ¨åº“æˆ–å…¶ä»–æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œ#include stdio.h å…è®¸ä»¬ä½¿ç”¨æ ‡å‡†è¾“å…¥è¾“å‡ºå‡½æ•°ã€‚ å®å®šä¹‰æ›¿æ¢ï¼šé€šè¿‡ #define æŒ‡ä»¤å®šä¹‰çš„å®ä¼šè¢«ç›´æ¥æ›¿æ¢æˆå…¶å¯¹åº”çš„å€¼ï¼Œç®€åŒ–ä»£ç çš„ç¼–å†™ã€‚ä¾‹å¦‚ï¼Œ#define PI 3.14 ä¼šå°†æºä»£ç ä¸­çš„ PI æ›¿æ¢æˆ 3.14ã€‚ æ¡ä»¶ç¼–è¯‘ï¼šä½¿ç”¨ #ifdef å’Œ #ifndef ç­‰æŒ‡ä»¤ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„æ¡ä»¶å¯ç”¨æˆ–ç¦ç”¨ä»£ç å—ã€‚è¿™åœ¨å¤„ç†ä¸åŒå¹³å°æˆ–åŠŸèƒ½æ¨¡å—æ—¶å°¤å…¶æœ‰ç”¨ã€‚ å»é™¤æ³¨é‡Šï¼šæ‰€æœ‰çš„æ³¨é‡Šï¼ˆå¦‚ // å’Œ /* */ï¼‰éƒ½ä¼šåœ¨æ­¤æ­¥éª¤è¢«ç§»é™¤ï¼Œå› ä¸ºå®ƒä»¬å¯¹ç¼–è¯‘è¿‡ç¨‹æ²¡æœ‰æ„ä¹‰ã€‚ é€šè¿‡è¿™ä¸ªæ­¥éª¤ï¼ŒGCC ç”Ÿæˆä¸€ä¸ªåä¸º name.i çš„é¢„å¤„ç†æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«äº†æ‰€æœ‰çš„åŠ è½½å†…å®¹å’Œæ›¿æ¢ç»“æœã€‚è¿™ä¸€è¿‡ç¨‹çš„å‘½ä»¤ä¸ºï¼š gcc -E name.c -o name.i æˆ–ç®€å†™ä¸ºï¼š gcc -o name.i -E name.c Step 2: ç¼–è¯‘åœ¨ç¼–è¯‘é˜¶æ®µï¼ŒGCC å¯¹ name.i æ–‡ä»¶è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š è¯­æ³•æ£€æŸ¥ï¼šç¼–è¯‘å™¨ä¼šæ£€æŸ¥ä»£ç æ˜¯å¦ç¬¦åˆ C è¯­è¨€çš„è¯­æ³•è§„èŒƒã€‚å¦‚æœå‘ç°ä»»ä½•é”™è¯¯å¦‚ç¼ºå°‘åˆ†å·ã€æ‹¬å·ä¸åŒ¹é…ç­‰ï¼ŒGCC ä¼šç«‹å³æŠ¥é”™å¹¶ç»ˆæ­¢ç¼–è¯‘è¿‡ç¨‹ã€‚æ¯”å¦‚ï¼Œå¦‚æœä»£ç ä¸­æœ‰é”™è¯¯ï¼Œè¾“å‡ºå¯èƒ½ä¼šæç¤ºå‡ºé”™çš„è¡Œå’Œå…·ä½“é”™è¯¯ä¿¡æ¯ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½é—®é¢˜ã€‚ ç”Ÿæˆæ±‡ç¼–ä»£ç ï¼šå¦‚æœæ²¡æœ‰è¯­æ³•é”™è¯¯ï¼Œç¼–è¯‘å™¨æ¥ç€ç”Ÿæˆæ±‡ç¼–è¯­è¨€ä»£ç ï¼Œæ–‡ä»¶åä¸º name.sã€‚ è¿™ä¸ªæ­¥éª¤çš„å‘½ä»¤å¦‚ä¸‹ï¼š gcc -S name.i -o name.s æˆ–ç®€å†™ä¸ºï¼š gcc -o name.s -S name.i Step 3: æ±‡ç¼–åœ¨æ±‡ç¼–é˜¶æ®µï¼ŒGCC å°†æ±‡ç¼–ä»£ç è½¬æ¢ä¸ºæœºå™¨ä»£ç ï¼Œå³ç›®æ ‡æ–‡ä»¶ï¼ˆ.o æ–‡ä»¶ï¼‰ã€‚è¿™ä¸€æ­¥éª¤å¯ä»¥è§†ä¸ºå°†é«˜çº§è¯­è¨€ç¿»è¯‘æˆè®¡ç®—æœºèƒ½å¤Ÿç›´æ¥ç†è§£çš„æŒ‡ä»¤é›†ã€‚ æœºå™¨ç ç”Ÿæˆï¼šæ±‡ç¼–ä»£ç ä¸­æ¯ä¸€æ¡æŒ‡ä»¤éƒ½ä¼šè¢«è½¬åŒ–ä¸ºç›¸åº”çš„æœºå™¨æŒ‡ä»¤ï¼Œå½¢æˆä¸€ä¸ªç›®æ ‡æ–‡ä»¶ name.oã€‚æ­¤æ–‡ä»¶åŒ…å«äº†ç¼–è¯‘åçš„ä»£ç ï¼Œä½†å°šæœªé“¾æ¥æˆå®Œæ•´çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ æ‰§è¡Œæ±‡ç¼–çš„å‘½ä»¤ä¸ºï¼š gcc -c name.s -o name.o æˆ–ç®€å†™ä¸ºï¼š gcc -o name.o -c name.s Step 4: é“¾æ¥æœ€åä¸€ä¸ªæ­¥éª¤æ˜¯é“¾æ¥ã€‚é“¾æ¥çš„ä¸»è¦å·¥ä½œæ˜¯å°†ä¸€ä¸ªæˆ–å¤šä¸ªç›®æ ‡æ–‡ä»¶ï¼ˆname.o å’Œå¯èƒ½çš„å…¶ä»–.o æ–‡ä»¶ï¼‰ç»“åˆèµ·æ¥ï¼Œç”Ÿæˆä¸€ä¸ªæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼ŒGCC å°†å¤„ç†ç›®æ ‡æ–‡ä»¶ä¹‹é—´çš„ç¬¦å·å¼•ç”¨ï¼Œå°†å®ƒä»¬åˆå¹¶ï¼Œå¹¶ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¦‚å¯ç§°ä¸º name çš„æ–‡ä»¶ï¼‰ã€‚å¦‚æœç¨‹åºä¾èµ–äºå¤–éƒ¨åº“ï¼Œé“¾æ¥å™¨ä¼šåœ¨è¿™é‡Œæ‰¾åˆ°å¹¶åŒ…å«æ‰€éœ€çš„åº“æ–‡ä»¶ã€‚ æ‰§è¡Œé“¾æ¥çš„å‘½ä»¤ä¸ºï¼š gcc name.o -o name æˆ–ç®€å†™ä¸ºï¼š gcc -o name name.o ç»è¿‡è¿™å››ä¸ªæ­¥éª¤åï¼Œç¼–è¯‘å®Œæˆï¼Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿä¸­è¿è¡Œã€‚æ•´ä¸ªè¿‡ç¨‹ç¡®ä¿ä»£ç ä»äººç±»å¯è¯»çš„é«˜çº§è¯­è¨€è½¬åŒ–ä¸ºæœºå™¨èƒ½å¤Ÿç†è§£å’Œæ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚","categories":["6.å¼€å‘å·¥å…·","ç¼–è¯‘é“¾æ¥"]},{"title":"Makeå’ŒMakefile","path":"/2024/01/19/6-å¼€å‘å·¥å…·-ç¼–è¯‘é“¾æ¥-Makeå’ŒMakefile/","content":"åœ¨å¼€å‘ä¸€ä¸ªç³»ç»Ÿæ—¶ï¼Œä¸€èˆ¬ä¼šå°†ç³»ç»Ÿåˆ’åˆ†ä¸ºå¤šä¸ªæ¨¡å—ã€‚è¿™ç§æ¨¡å—åŒ–çš„æ–¹å¼æ”¹å–„äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ï¼Œä¾¿äºæ›´æ”¹å’Œè°ƒè¯•ã€‚ç„¶è€Œï¼Œä¸åŒæ¨¡å—ä¹‹é—´çš„å…³è”ä¸å¯é¿å…ï¼Œæ¨¡å—çš„ä¿®æ”¹å¯èƒ½éœ€è¦å¯¹å…¶ä»–æ¨¡å—è¿›è¡Œæ›´æ–°ã€‚å¯¹äºå°å‹ç³»ç»Ÿè€Œè¨€ï¼Œæ‰‹åŠ¨ç¼–è¯‘å’Œè¿æ¥éå¸¸é«˜æ•ˆä¸”ç®€å•ï¼Œä½†å½“é¢å¯¹å¤§å‹ç³»ç»Ÿï¼ŒåŒ…æ‹¬å¤šä¸ªæ¨¡å—æ—¶ï¼Œæ‰‹åŠ¨ç¼–è¯‘çš„æ–¹å¼å°±æ˜¾å¾—ç¹çä¸”å®¹æ˜“å‡ºé”™ã€‚ å› æ­¤ï¼ŒLinux ç³»ç»Ÿå¼•å…¥äº† make å‘½ä»¤æ¥è‡ªåŠ¨ç®¡ç†ç›®æ ‡æ–‡ä»¶çš„æ›´æ–°ã€‚ä¸æ‰‹åŠ¨ç¼–è¯‘ç›¸æ¯”ï¼Œmake å‘½ä»¤çš„ä¸»è¦ä¼˜ç‚¹æ˜¯åªæ›´æ–°é‚£äº›è¢«ä¿®æ”¹è¿‡çš„æ–‡ä»¶ã€‚åœ¨ Linux ä¸­ï¼Œæ–‡ä»¶æœ‰ä¸€ä¸ªæœ€åä¿®æ”¹æ—¶é—´ï¼Œmake é€šè¿‡è¿™ä¸€æ—¶é—´æˆ³æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°ç¼–è¯‘è¯¥æ–‡ä»¶ã€‚è¿™æ ·ï¼Œæœªä¿®æ”¹çš„æ–‡ä»¶ä¸ä¼šè¢«é‡å¤å¤„ç†ï¼Œé¿å…äº†ä¸å¿…è¦çš„æµªè´¹ï¼ŒåŒæ—¶ç¡®ä¿ä¸ä¼šé—æ¼éœ€è¦æ›´æ–°çš„æ–‡ä»¶ã€‚ æ¨¡å—ä¸æ¨¡å—ä¹‹é—´å¯èƒ½å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œmake å‘½ä»¤æ­£æ˜¯æ ¹æ®è¿™äº›ä¾èµ–å…³ç³»è¿›è¡Œè‡ªåŠ¨ç»´æŠ¤çš„ã€‚å› æ­¤ï¼Œç†è§£ä¾èµ–å…³ç³»æ˜¯ç†è§£ make å‘½ä»¤çš„å…³é”®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œmake å¹¶ä¸è‡ªåŠ¨çŸ¥é“è¿™äº›ä¾èµ–å…³ç³»ï¼Œç¨‹åºå‘˜éœ€è¦åœ¨ä¸€ä¸ªå«åš Makefile çš„æ–‡ä»¶ä¸­æ˜¾å¼åœ°å®šä¹‰å®ƒä»¬ã€‚ Makemake æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ„å»ºå·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥è‡ªåŠ¨åŒ–ç¼–è¯‘å’Œæ„å»ºç¨‹åºã€‚è¿™å¯¹å¤§å‹é¡¹ç›®å°¤å…¶é‡è¦ï¼Œå¯ä»¥å¤§å¤§ç®€åŒ–å¤æ‚é¡¹ç›®çš„æ„å»ºè¿‡ç¨‹ã€‚ make é€šè¿‡è¯»å–åä¸º Makefile çš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ ¹æ®å…¶ä¸­å®šä¹‰çš„è§„åˆ™å’Œä¾èµ–å…³ç³»ï¼Œè¯†åˆ«å‡ºå“ªäº›æ–‡ä»¶éœ€è¦é‡æ–°ç¼–è¯‘ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„ç¼–è¯‘å‘½ä»¤ã€‚ åœ¨è‹±è¯­ä¸­ï¼ŒMake è¿™ä¸ªè¯çš„æ„æ€æ˜¯â€åˆ¶ä½œâ€ã€‚åœ¨å‘½ä»¤è¡Œä¸­ï¼Œä½¿ç”¨ make å‘½ä»¤æ—¶ï¼Œå¦‚æœéœ€è¦ç”Ÿæˆæ–‡ä»¶ a.txtï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®ç°ï¼š $ make a.txt ä½†æ˜¯ï¼Œå¦‚æœç›´æ¥æ‰§è¡Œæ­¤å‘½ä»¤ï¼Œmake å¹¶ä¸çŸ¥é“å¦‚ä½•ç”Ÿæˆ a.txtã€‚å®ƒéœ€è¦ä¾èµ–äº Makefile ä¸­å®šä¹‰çš„è§„åˆ™ã€‚è¿™æ¡å‘½ä»¤çš„ä»£è¡¨æ€§è§„åˆ™å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š å‡è®¾ a.txt ä¾èµ–äº b.txt å’Œ c.txtï¼Œä¸¤è€…åˆå¹¶ç”Ÿæˆ a.txtã€‚ä¸ºæ­¤ï¼Œmake éœ€è¦æ˜ç™½ä»¥ä¸‹è§„åˆ™ï¼š a.txt: b.txt c.txt cat b.txt c.txt a.txt è¿™æ ·çš„è§„åˆ™éœ€è¦å†™å…¥ Makefile ä¸­ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒMakefile çš„åç§°å¹¶ä¸æ˜¯å”¯ä¸€çš„ï¼Œå¯ä»¥å†™ä¸º makefileï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šå…¶ä»–æ–‡ä»¶åï¼Œä¾‹å¦‚ï¼š $ make -f rules.txt $ make --file=rules.txt è¿™æ ·ï¼Œmake å‘½ä»¤ä¼šæ ¹æ® rules.txt æ–‡ä»¶ä¸­çš„è§„åˆ™æ‰§è¡Œç›¸åº”æ“ä½œã€‚ Make å‘½ä»¤make å‘½ä»¤å¯ä»¥å¸¦æœ‰å››ç§å‚æ•°ï¼šæ ‡å¿—ã€å®å®šä¹‰ã€æ–‡ä»¶åå’Œç›®æ ‡æ–‡ä»¶åï¼Œå…¶æ ‡å‡†å½¢å¼ä¸ºï¼š make [flags] [macro definitions] [targets] åœ¨ Unix ç³»ç»Ÿä¸­ï¼Œå¸¸ç”¨çš„æ ‡å¿—é€‰é¡¹åŠå…¶å«ä¹‰å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š æ ‡å¿—ä½ å«ä¹‰ -f file æŒ‡å®šæ–‡ä»¶ file ä½œä¸ºæè¿°æ–‡ä»¶ï¼›å¦‚æœ file ä¸º -ï¼Œåˆ™æè¿°æ–‡ä»¶æŒ‡å‘æ ‡å‡†è¾“å…¥ã€‚ç³»ç»Ÿé»˜è®¤æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„ makefile æˆ– Makefile æ–‡ä»¶ã€‚ -i å¿½ç•¥å‘½ä»¤æ‰§è¡Œè¿”å›çš„é”™è¯¯ä¿¡æ¯ã€‚ -s æ²‰é»˜æ¨¡å¼ï¼Œæ‰§è¡Œå‰ä¸è¾“å‡ºå‘½ä»¤è¡Œä¿¡æ¯ã€‚ -r ç¦æ­¢ä½¿ç”¨å†…ç½®è§„åˆ™ã€‚ -n éæ‰§è¡Œæ¨¡å¼ï¼Œæ‰“å°æ‰€æœ‰æ‰§è¡Œå‘½ä»¤ï¼Œä½†ä¸å®é™…æ‰§è¡Œã€‚ -t æ›´æ–°ç›®æ ‡æ–‡ä»¶ã€‚ -q make æ ¹æ®ç›®æ ‡æ–‡ä»¶æ˜¯å¦å·²æ›´æ–°è¿”å›çŠ¶æ€ä¿¡æ¯â€0â€æˆ–éâ€0â€ã€‚ -p è¾“å‡ºæ‰€æœ‰å®å®šä¹‰å’Œç›®æ ‡æ–‡ä»¶æè¿°ã€‚ -d è°ƒè¯•æ¨¡å¼ï¼Œè¾“å‡ºæœ‰å…³æ–‡ä»¶åŠæ£€æµ‹æ—¶é—´çš„è¯¦ç»†ä¿¡æ¯ã€‚ åœ¨ Linux ä¸‹ï¼ŒæŸäº›æ ‡å¿—é€‰é¡¹ä¸ Unix ç³»ç»Ÿç•¥æœ‰ä¸åŒï¼Œä»¥ä¸‹æ˜¯ä¸åŒä¹‹å¤„ï¼š æ ‡å¿—ä½ å«ä¹‰ -c dir åœ¨è¯»å– Makefile ä¹‹å‰åˆ‡æ¢åˆ°æŒ‡å®šç›®å½• dirã€‚ -I dir æŒ‡å®šæœç´¢ç›®å½•ä»¥åŒ…å«å…¶ä»– Makefile æ–‡ä»¶ã€‚ -h å¸®åŠ©æ–‡æ¡£ï¼Œæ˜¾ç¤ºæ‰€æœ‰çš„ make é€‰é¡¹ã€‚ -w åœ¨å¤„ç† Makefile å‰åæ˜¾ç¤ºå·¥ä½œç›®å½•ã€‚ åœ¨å‘½ä»¤è¡Œå‚æ•°ä¸­ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šç›®æ ‡ target æ¥å‘Šè¯‰ make éœ€è¦ç¼–è¯‘çš„ç›®æ ‡ã€‚å¦‚æœå‘½ä»¤è¡Œä¸­æœªæŒ‡å®šç›®æ ‡ï¼Œåˆ™ make ä¼šé»˜è®¤æ‰§è¡Œæè¿°æ–‡ä»¶ä¸­å®šä¹‰çš„ç¬¬ä¸€ä¸ªç›®æ ‡ã€‚ é€šå¸¸ï¼ŒMakefile ä¸­è¿˜å®šä¹‰æœ‰ clean ç›®æ ‡ï¼Œç”¨äºæ¸…é™¤ç¼–è¯‘è¿‡ç¨‹äº§ç”Ÿçš„ä¸­é—´æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š clean: rm -f *.o å½“è¿è¡Œ make clean æ—¶ï¼Œä¼šæ‰§è¡Œ rm -f *.o å‘½ä»¤ï¼Œåˆ é™¤æ‰€æœ‰ä¸­é—´æ–‡ä»¶ã€‚ éšå«è§„åˆ™ make å·¥å…·åŒ…æ‹¬å†…ç½®çš„éšå«è§„åˆ™ï¼Œè¿™äº›è§„åˆ™å®šä¹‰äº†ä»ä¸åŒçš„ä¾èµ–æ–‡ä»¶ç”Ÿæˆç‰¹å®šç±»å‹ç›®æ ‡çš„æ–¹æ³•ã€‚Unix ç³»ç»Ÿæ”¯æŒåŸºäºæ–‡ä»¶æ‰©å±•åçš„éšå«è§„åˆ™ï¼Œä¾‹å¦‚ï¼Œå°† .c æ–‡ä»¶ç¼–è¯‘ä¸º .o æ–‡ä»¶ï¼š .c: .o $(CC) $(CFLAGS) $(CPPFLAGS) -c -o $@ $ ç³»ç»Ÿä¸­å¸¸è§çš„æ–‡ä»¶æ‰©å±•ååŠå…¶å«ä¹‰å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š æ‰©å±•å å«ä¹‰ .o ç›®æ ‡æ–‡ä»¶ .c C æºæ–‡ä»¶ .f FORTRAN æºæ–‡ä»¶ .s æ±‡ç¼–æºæ–‡ä»¶ .y Yacc-C æºè¯­æ³• .l Lex æºè¯­æ³• åœ¨æ—©æœŸ Unix ç³»ç»Ÿä¸­ä¹Ÿæ”¯æŒ Yacc-C å’Œ Lex æºè¯­æ³•ã€‚ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šé¦–å…ˆåœ¨ Makefile ä¸­æŸ¥æ‰¾ä¸ç›®æ ‡æ–‡ä»¶ç›¸å…³çš„ .C æ–‡ä»¶ã€‚å¦‚æœå­˜åœ¨ä¾èµ–çš„ .y å’Œ .l æ–‡ä»¶ï¼Œåˆ™ä¼šå…ˆå°†å…¶è½¬æ¢ä¸º .c æ–‡ä»¶åå†ç¼–è¯‘ç”Ÿæˆå¯¹åº”çš„ .o æ–‡ä»¶ï¼›å¦‚æœåªæœ‰ .y æ–‡ä»¶ï¼Œç³»ç»Ÿåˆ™ä¼šç›´æ¥ç¼–è¯‘è¯¥æ–‡ä»¶ã€‚ GNU make ä¸ä»…æ”¯æŒåç¼€è§„åˆ™ï¼Œè¿˜æ”¯æŒå¦ä¸€ç±»éšå«è§„åˆ™ï¼Œç§°ä¸ºæ¨¡å¼è§„åˆ™ã€‚è¿™ç±»è§„åˆ™æ›´ä¸ºé€šç”¨ï¼Œå¯ä»¥å®šä¹‰å¤æ‚çš„ä¾èµ–è§„åˆ™ã€‚æ¨¡å¼è§„åˆ™çš„è¯­æ³•ç±»ä¼¼äºæ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†ç›®æ ‡åç§°å‰å¤šäº†ä¸€ä¸ª % ç¬¦å·ã€‚ ä¾‹å¦‚ï¼Œä¸‹é¢çš„æ¨¡å¼è§„åˆ™å®šä¹‰äº†å¦‚ä½•å°†ä»»æ„ file.c æ–‡ä»¶è½¬æ¢ä¸º file.oï¼š %.c: %.o $(CC) $(CFLAGS) $(CPPFLAGS) -c -o $@ $ MakefileMakefile æ˜¯ä¸€ä¸ªåŒ…å«æ„å»ºè§„åˆ™çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå®šä¹‰äº†é¡¹ç›®ä¸­å„ä¸ªæºæ–‡ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»åŠå¦‚ä½•ç”Ÿæˆç›®æ ‡æ–‡ä»¶ã€‚make ä¾æ® Makefile ä¸­çš„è§„åˆ™æ¥åˆ¤æ–­å“ªäº›æ–‡ä»¶éœ€è¦é‡æ–°ç¼–è¯‘ï¼Œå¹¶æ‰§è¡Œç›¸åº”å‘½ä»¤ç”Ÿæˆç›®æ ‡æ–‡ä»¶ã€‚ è§„åˆ™Makefile åŒ…å«äº†ä¸€ç³»åˆ—è§„åˆ™ï¼Œæ¯ä¸ªè§„åˆ™å®šä¹‰äº†ä¸€ä¸ªæˆ–å¤šä¸ªç›®æ ‡æ–‡ä»¶åŠå…¶æ‰€éœ€çš„ä¾èµ–æ–‡ä»¶å’Œç¼–è¯‘å‘½ä»¤ã€‚è§„åˆ™çš„å½¢å¼å¦‚ä¸‹ï¼š target: prerequisites commands target æ˜¯è§„åˆ™çš„ç›®æ ‡ï¼Œprerequisites æ˜¯å‰ç½®æ¡ä»¶ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ã€‚å‘½ä»¤è¡Œä¸­å¿…é¡»ä»¥ tab é”®å¼€å¤´ï¼Œä»¥æ‰§è¡Œç›¸å…³å‘½ä»¤ã€‚ ç›®æ ‡æ˜¯å¿…éœ€çš„ï¼Œè€Œå‰ç½®æ¡ä»¶å’Œå‘½ä»¤æ˜¯å¯é€‰çš„ï¼Œä½†è‡³å°‘éœ€è¦æœ‰ä¸€ä¸ªã€‚æ¯æ¡è§„åˆ™è¡¨æ˜ä¸¤ä»¶äº‹ï¼šæ„å»ºç›®æ ‡çš„å‰ç½®æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•æ„å»ºã€‚ ç›®æ ‡ä¸€ä¸ªç›®æ ‡å®šä¹‰äº†ä¸€æ¡è§„åˆ™ã€‚ç›®æ ‡é€šå¸¸æ˜¯æ–‡ä»¶åï¼Œè¡¨ç¤º make å°†è¦æ„å»ºçš„å¯¹è±¡ï¼Œæ¯”å¦‚ a.txtã€‚ ç›®æ ‡å¯ä»¥æ˜¯å•ä¸ªæ–‡ä»¶åï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªæ–‡ä»¶åï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼›é™¤äº†æ–‡ä»¶åï¼Œç›®æ ‡è¿˜å¯ä»¥æ˜¯æŸä¸ªæ“ä½œçš„åç§°ï¼Œè¿™è¢«ç§°ä¸ºä¼ªç›®æ ‡ï¼ˆphony targetï¼‰ï¼š clean: rm *.o åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œç›®æ ‡æ˜¯ cleanï¼Œè¿™æ˜¯ä¸€ä¸ªä¼ªç›®æ ‡ï¼Œè¡¨ç¤ºæ‰§è¡Œåˆ é™¤å¯¹è±¡æ–‡ä»¶çš„æ“ä½œã€‚å½“è¿è¡Œ $ make clean æ—¶ï¼Œmake ä¼šå»æ‰§è¡Œç›¸åº”çš„å‘½ä»¤ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå½“å‰ç›®å½•å«æœ‰åä¸º clean çš„æ–‡ä»¶ï¼Œmake å¯èƒ½ä¸ä¼šæ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå› ä¸ºå®ƒè®¤ä¸ºç›®æ ‡å·²ç»å­˜åœ¨ï¼Œå°±ä¸éœ€è¦å†æ„å»ºã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å£°æ˜ clean ä¸ºâ€ä¼ªç›®æ ‡â€ï¼š .PHONY: cleanclean: rm *.o ä¸€æ—¦å£°æ˜ä¸ºä¼ªç›®æ ‡ï¼Œmake å°±ä¸ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨åä¸º clean çš„æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨æ¯æ¬¡è¿è¡Œæ—¶éƒ½æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤ã€‚ .PHONY è¿˜æœ‰å…¶ä»–å¾ˆå¤šå†…ç½®ç›®æ ‡åï¼Œå¯ä»¥æŸ¥çœ‹æ‰‹å†Œã€‚å¦‚æœè¿è¡Œ make å‘½ä»¤æ—¶æ²¡æœ‰æŒ‡å®šç›®æ ‡ï¼Œé»˜è®¤æ‰§è¡Œ Makefile ä¸­çš„ç¬¬ä¸€ä¸ªç›®æ ‡ã€‚ä¾‹å¦‚ï¼š $ make ä¼šæ‰§è¡Œ Makefile ç¬¬ä¸€ä¸ªç›®æ ‡ã€‚ ç¤ºä¾‹ï¼šæ‰§è¡Œå¤šä¸ªç›®æ ‡.PHONY: cleanclean: rm *.o temp.PHONY: cleanall cleanobj cleandiffcleanall: cleanobj cleandiff rm programcleanobj: rm *.ocleandiff: rm *.diff ä¸Šè¿°ç¤ºä¾‹å®šä¹‰äº†å¤šä¸ªç›®æ ‡çš„æ‰§è¡Œç»“æ„ï¼Œclean ä¼šåˆ é™¤ä¸­é—´æ–‡ä»¶ï¼Œcleanall åˆ™åœ¨æ‰§è¡Œ cleanobj å’Œ cleandiff ååˆ é™¤æœ€ç»ˆç¨‹åºæ–‡ä»¶ã€‚","categories":["6.å¼€å‘å·¥å…·","ç¼–è¯‘é“¾æ¥"]},{"title":"æ„å»ºå·¥å…·Make","path":"/2024/01/18/6-å¼€å‘å·¥å…·-ç¼–è¯‘é“¾æ¥-æ„å»ºå·¥å…·Make/","content":"Make çš„åŸºæœ¬æ¦‚å¿µä¸ä½¿ç”¨ä»£ç è½¬åŒ–ä¸ºå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ç§°ä¸ºç¼–è¯‘ï¼ˆcompileï¼‰ã€‚åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•å®‰æ’å„ä¸ªæ–‡ä»¶çš„ç¼–è¯‘é¡ºåºåˆ™ç§°ä¸ºæ„å»ºï¼ˆbuildï¼‰ã€‚åœ¨å„ç§æ„å»ºå·¥å…·ä¸­ï¼ŒMake æ˜¯æœ€å¸¸ç”¨çš„é€‰æ‹©ä¹‹ä¸€ã€‚è‡ª 1977 å¹´é—®ä¸–ä»¥æ¥ï¼ŒMake ä¸»è¦è¢«åº”ç”¨äº C è¯­è¨€é¡¹ç›®ã€‚ç„¶è€Œï¼Œå®é™…ä¸Šï¼Œåªè¦æŸä¸ªæ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œä»»ä½•é¡¹ç›®éƒ½å¯ä»¥ä½¿ç”¨ Make è¿›è¡Œé‡æ–°æ„å»ºã€‚ æœ¬æ–‡å°†é€æ­¥ä»‹ç» Make å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•ï¼Œé€‚åˆæ²¡æœ‰åŸºç¡€çš„è¯»è€…ï¼Œåªéœ€æŒæ¡å‘½ä»¤è¡Œæ“ä½œå³å¯è½»æ¾ç†è§£ã€‚å‚è€ƒèµ„æ–™ä¸»è¦åŒ…æ‹¬ Isaac Schlueter çš„ã€ŠMakefile æ–‡ä»¶æ•™ç¨‹ã€‹å’Œã€ŠGNU Make æ‰‹å†Œã€‹ã€‚ ä¸€ã€Make çš„æ¦‚å¿µâ€œMakeâ€åœ¨è‹±è¯­ä¸­çš„å«ä¹‰æ˜¯â€œåˆ¶ä½œâ€ã€‚Make å‘½ä»¤æ­£æ˜¯åŸºäºè¿™ä¸ªå«ä¹‰ï¼Œå…¶ç›®çš„åœ¨äºç”ŸæˆæŒ‡å®šçš„æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œè‹¥è¦ç”Ÿæˆåä¸º a.txt çš„æ–‡ä»¶ï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š $ make a.txt ç„¶è€Œï¼Œç›´æ¥è¾“å…¥è¿™æ¡å‘½ä»¤å¹¶ä¸ä¼šäº§ç”Ÿä»»ä½•æ•ˆæœï¼Œå› ä¸º Make å‘½ä»¤å¹¶ä¸è‡ªçŸ¥å¦‚ä½•ç”Ÿæˆ a.txtï¼Œè¿™å°±éœ€è¦äº‹å…ˆå®šä¹‰è§„åˆ™ï¼Œå‘ŠçŸ¥ Make å¦‚ä½•è°ƒç”¨å…¶ä»–å‘½ä»¤ä»¥å®Œæˆè¿™é¡¹ä»»åŠ¡ã€‚ å‡è®¾ a.txt ä¾èµ–äº b.txt å’Œ c.txtï¼Œå®ƒæ˜¯é€šè¿‡å°†åä¸¤ä¸ªæ–‡ä»¶åˆå¹¶çš„ç»“æœã€‚é‚£ä¹ˆï¼ŒMake éœ€è¦äº†è§£å¦‚ä¸‹è§„åˆ™ï¼š a.txt: b.txt c.txt cat b.txt c.txt a.txt è¿™æ®µè§„åˆ™çš„æ„æ€æ˜¯ï¼Œé¦–å…ˆç¡®è®¤ b.txt å’Œ c.txt è¿™ä¸¤ä¸ªæºæ–‡ä»¶å¿…é¡»å­˜åœ¨ã€‚æ¥ä¸‹æ¥ï¼Œæ‰§è¡Œ cat å‘½ä»¤å°†è¿™ä¸¤ä¸ªæ–‡ä»¶çš„å†…å®¹åˆå¹¶ï¼Œå¹¶è¾“å‡ºåˆ°æ–°æ–‡ä»¶ a.txt ä¸­ã€‚è¿™æ„å‘³ç€ï¼Œæ‰§è¡Œ make a.txt å®é™…ä¸ŠåŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ã€‚ æ‰€æœ‰è¿™ç±»è§„åˆ™éƒ½è®°å½•åœ¨ä¸€ä¸ªåä¸º Makefile çš„æ–‡ä»¶ä¸­ï¼ŒMake å‘½ä»¤ä¾èµ–è¿™ä¸ªæ–‡ä»¶è¿›è¡Œæ„å»ºã€‚Makefile æ–‡ä»¶ä¹Ÿå¯ä»¥å‘½åä¸º makefileï¼Œæˆ–é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šå…¶ä»–åç§°ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŒ‡å®šä½¿ç”¨åä¸º rules.txt çš„æ–‡ä»¶ï¼š $ make -f rules.txt æˆ–è€…ï¼š $ make --file=rules.txt è¿™æ¡å‘½ä»¤è¯´æ˜ Make å°†ä¾æ® rules.txt æ–‡ä»¶ä¸­çš„è§„åˆ™è¿›è¡Œæ„å»ºã€‚ æ€»ä¹‹ï¼ŒMake å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ ¹æ®é¢„å®šä¹‰çš„ Shell å‘½ä»¤è¿›è¡Œæ„å»ºçš„å·¥å…·ã€‚å®ƒçš„è§„åˆ™ç®€æ´æ˜äº†ï¼šç”¨æˆ·è®¾å®šéœ€è¦æ„å»ºçš„ç›®æ ‡æ–‡ä»¶ã€æ–‡ä»¶æ‰€ä¾èµ–çš„æºæ–‡ä»¶ï¼Œä»¥åŠå½“æºæ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶å¦‚ä½•é‡æ–°æ„å»ºç›®æ ‡æ–‡ä»¶ã€‚é€šè¿‡è¿™äº›æ¸…æ™°çš„æŒ‡ç¤ºï¼ŒMake èƒ½å¤Ÿæœ‰æ•ˆåœ°æ”¯æŒè‡ªåŠ¨åŒ–çš„æ„å»ºè¿‡ç¨‹ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚ äºŒã€Makefile æ–‡ä»¶çš„æ ¼å¼æ„å»ºè§„åˆ™éƒ½å†™åœ¨ Makefile æ–‡ä»¶é‡Œé¢ï¼Œè¦å­¦ä¼šå¦‚ä½•ä½¿ç”¨ Make å‘½ä»¤ï¼Œå°±å¿…é¡»æŒæ¡å¦‚ä½•ç¼–å†™ Makefile æ–‡ä»¶ã€‚ 2.1 æ¦‚è¿°Makefile æ–‡ä»¶ç”±ä¸€ç³»åˆ—è§„åˆ™ï¼ˆrulesï¼‰æ„æˆã€‚æ¯æ¡è§„åˆ™çš„å½¢å¼å¦‚ä¸‹ï¼š target : prerequisites[tab] commands åœ¨è¿™ä¸ªæ ¼å¼ä¸­ï¼Œç¬¬ä¸€è¡Œçš„å†’å·å‰é¢çš„éƒ¨åˆ†ç§°ä¸ºâ€ç›®æ ‡â€ï¼ˆtargetï¼‰ï¼Œå†’å·åé¢çš„éƒ¨åˆ†ç§°ä¸ºâ€å‰ç½®æ¡ä»¶â€ï¼ˆprerequisitesï¼‰ã€‚ç¬¬äºŒè¡Œå¿…é¡»ç”±ä¸€ä¸ª tab é”®èµ·é¦–ï¼Œåé¢è·Ÿç€â€å‘½ä»¤â€ï¼ˆcommandsï¼‰ã€‚ ç›®æ ‡æ˜¯å¿…éœ€çš„ï¼Œä¸å¯çœç•¥ï¼› å‰ç½®æ¡ä»¶å’Œå‘½ä»¤éƒ½æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯ä¸¤è€…ä¹‹ä¸­è‡³å°‘å¿…é¡»å­˜åœ¨ä¸€ä¸ªã€‚ æ¯æ¡è§„åˆ™æ˜ç¡®äº†æ„å»ºç›®æ ‡æ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼Œä»¥åŠå¦‚ä½•æ„å»ºè¿™ä¸ªç›®æ ‡ã€‚ä»¥ä¸‹å°†è¯¦ç»†è®²è§£æ¯æ¡è§„åˆ™çš„ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ã€‚ 2.2 ç›®æ ‡ï¼ˆtargetï¼‰ä¸€ä¸ªç›®æ ‡ï¼ˆtargetï¼‰æ„æˆä¸€æ¡è§„åˆ™ã€‚ç›®æ ‡é€šå¸¸è¡¨ç¤ºæ–‡ä»¶åï¼ŒæŒ‡æ˜ Make å‘½ä»¤æ‰€è¦æ„å»ºçš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œç›®æ ‡å¯ä»¥æ˜¯ a.txtã€‚ç›®æ ‡å¯ä»¥æ˜¯å•ä¸ªæ–‡ä»¶åï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªæ–‡ä»¶åï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚ é™¤äº†æ–‡ä»¶åï¼Œç›®æ ‡è¿˜å¯ä»¥æ˜¯æŸä¸ªæ“ä½œçš„åå­—ï¼Œè¿™ç§æƒ…å†µç§°ä¸ºâ€ä¼ªç›®æ ‡â€ï¼ˆphony targetï¼‰ï¼š clean:\trm *.o åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç›®æ ‡æ˜¯ cleanï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶åï¼Œè€Œæ˜¯ä¸€ä¸ªæ“ä½œçš„åå­—ï¼Œä½œç”¨æ˜¯åˆ é™¤å¯¹è±¡æ–‡ä»¶ã€‚å¯ä»¥é€šè¿‡è¿è¡Œ $ make clean æ¥æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå½“å‰ç›®å½•ä¸­å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶åä¸º cleanï¼Œè¯¥å‘½ä»¤å°†ä¸ä¼šæ‰§è¡Œã€‚å› ä¸º Make ä¼šå‘ç° clean å·²å­˜åœ¨ï¼Œè®¤ä¸ºæ²¡æœ‰å¿…è¦é‡æ–°æ„å»ºï¼Œå°±ä¸ä¼šæ‰§è¡ŒæŒ‡å®šçš„ rm å‘½ä»¤ã€‚ ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥æ˜ç¡®å£°æ˜ clean ä¸ºâ€ä¼ªç›®æ ‡â€ï¼Œå†™æ³•å¦‚ä¸‹ï¼š .PHONY: cleanclean:\trm *.o temp é€šè¿‡å£°æ˜ clean ä¸ºâ€ä¼ªç›®æ ‡â€ï¼ŒMake å°†ä¸ä¼šæ£€æŸ¥ clean æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè€Œæ˜¯æ¯æ¬¡è¿è¡Œéƒ½æ‰§è¡Œå¯¹åº”å‘½ä»¤ã€‚åƒ .PHONY è¿™æ ·çš„å†…ç½®ç›®æ ‡åè¿˜æœ‰ä¸å°‘ï¼Œè¯¦ç»†ä¿¡æ¯å¯æŸ¥é˜…å®˜æ–¹æ‰‹å†Œã€‚ å¦‚æœåœ¨è¿è¡Œ Make å‘½ä»¤æ—¶æ²¡æœ‰æŒ‡å®šç›®æ ‡ï¼Œé»˜è®¤æ‰§è¡Œ Makefile æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªç›®æ ‡ï¼š $ make ä¸Šé¢ä»£ç å°†æ‰§è¡Œ Makefile æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªç›®æ ‡ã€‚ 2.3 å‰ç½®æ¡ä»¶ï¼ˆprerequisitesï¼‰å‰ç½®æ¡ä»¶é€šå¸¸æ˜¯ä¸€ç»„æ–‡ä»¶åï¼Œå¤šä¸ªæ–‡ä»¶åä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ã€‚å®ƒæŒ‡å®šäº†â€ç›®æ ‡â€æ˜¯å¦éœ€è¦é‡æ–°æ„å»ºçš„åˆ¤æ–­æ ‡å‡†ï¼šåªè¦æœ‰ä¸€ä¸ªå‰ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæˆ–è€…æœ‰æ›´æ–°ï¼ˆå‰ç½®æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´æˆ³æ¯”ç›®æ ‡çš„æ—¶é—´æˆ³æ–°ï¼‰ï¼Œâ€ç›®æ ‡â€å°±éœ€è¦è¿›è¡Œé‡æ–°æ„å»ºã€‚ ä¾‹å¦‚ï¼š result.txt: source.txt\tcp source.txt result.txt åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæ„å»º result.txt çš„å‰ç½®æ¡ä»¶æ˜¯ source.txtã€‚å¦‚æœå½“å‰ç›®å½•ä¸­å­˜åœ¨ source.txtï¼Œmake result.txt å‘½ä»¤å°†å¯ä»¥æ­£å¸¸è¿è¡Œï¼›å¦åˆ™ï¼Œå¿…é¡»å†å†™ä¸€æ¡è§„åˆ™ï¼Œæ¥ç”Ÿæˆ source.txtã€‚ source.txt:\techo this is the source source.txt åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œsource.txt åé¢æ²¡æœ‰å‰ç½®æ¡ä»¶ï¼Œè¡¨ç¤ºå®ƒä¸å…¶ä»–æ–‡ä»¶æ— å…³ã€‚åªè¦æ­¤æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ¯æ¬¡è°ƒç”¨ make source.txt éƒ½å°†ç”Ÿæˆè¿™ä¸ªæ–‡ä»¶ã€‚ $ make result.txt$ make result.txt æ‰§è¡Œè¿™ä¸¤æ¡å‘½ä»¤æ—¶ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œå°†é¦–å…ˆç”Ÿæˆ source.txtï¼Œç„¶åç”Ÿæˆ result.txtã€‚ç¬¬äºŒæ¬¡æ‰§è¡Œæ—¶ï¼ŒMake ä¼šå‘ç° source.txt æœªå‘ç”Ÿå˜åŠ¨ï¼ˆæ—¶é—´æˆ³æ™šäº result.txtï¼‰ï¼Œå› æ­¤ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œï¼Œresult.txt åŒæ ·ä¸ä¼šè¢«é‡æ–°ç”Ÿæˆã€‚ å¦‚æœéœ€è¦ç”Ÿæˆå¤šä¸ªæ–‡ä»¶ï¼Œå¸¸ç”¨ä¸‹é¢çš„å†™æ³•ï¼š source: file1 file2 file3 åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œsource ä¸ºä¸€ä¸ªä¼ªç›®æ ‡ï¼Œå…·æœ‰ä¸‰ä¸ªå‰ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹åº”çš„å‘½ä»¤ã€‚æ‰§è¡Œ $ make source å‘½ä»¤åï¼Œå°†ä¸€æ¬¡æ€§ç”Ÿæˆ file1ã€file2 å’Œ file3ã€‚è¿™ç§æ–¹å¼ç›¸æ¯”äºé€ä¸€ç”Ÿæˆå„ä¸ªç›®æ ‡ï¼Œæ›´åŠ é«˜æ•ˆå’Œä¾¿æ·ã€‚ $ make file1$ make file2$ make file3 2.4 å‘½ä»¤ï¼ˆcommandsï¼‰å‘½ä»¤ï¼ˆcommandsï¼‰è¡¨ç¤ºå¦‚ä½•æ›´æ–°ç›®æ ‡æ–‡ä»¶ï¼Œç”±ä¸€è¡Œæˆ–å¤šè¡Œçš„ Shell å‘½ä»¤ç»„æˆã€‚è¿™äº›å‘½ä»¤æ˜¯æ„å»ºâ€ç›®æ ‡â€çš„å…·ä½“æŒ‡ä»¤ï¼Œå…¶è¿è¡Œç»“æœé€šå¸¸æ˜¯ç”Ÿæˆç›®æ ‡æ–‡ä»¶ã€‚ æ¯è¡Œå‘½ä»¤ä¹‹å‰å¿…é¡»æœ‰ä¸€ä¸ª tab é”®ã€‚å¦‚æœå¸Œæœ›ä½¿ç”¨å…¶ä»–é”®ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®å˜é‡ .RECIPEPREFIX è¿›è¡Œå£°æ˜ã€‚ .RECIPEPREFIX = all: echo Hello, world åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé€šè¿‡ .RECIPEPREFIX å°†å¤§äºå·ï¼ˆï¼‰æ›¿ä»£äº† tab é”®ã€‚å› æ­¤ï¼Œæ¯è¡Œå‘½ä»¤éƒ½ä»¥å¤§äºå·ä½œä¸ºå‰ç¼€ï¼Œè€Œä¸æ˜¯ tab é”®ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæ¯è¡Œå‘½ä»¤åœ¨å•ç‹¬çš„ Shell ä¸­æ‰§è¡Œã€‚è¿™äº› Shell ä¹‹é—´æ²¡æœ‰ç»§æ‰¿å…³ç³»ã€‚ä¾‹å¦‚ï¼š var-lost:\texport foo=bar\techo foo=[$$foo] å¦‚æœæ‰§è¡Œ make var-lostï¼Œå°†æ— æ³•è·å–åˆ° foo çš„å€¼ï¼Œå› ä¸ºä¸¤è¡Œå‘½ä»¤åœ¨ä¸åŒçš„è¿›ç¨‹ä¸­æ‰§è¡Œã€‚è§£å†³æ­¤é—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•æ˜¯å°†ä¸¤è¡Œå‘½ä»¤åˆå¹¶ä¸ºä¸€è¡Œï¼Œå¹¶ç”¨åˆ†å·åˆ†éš”ï¼š var-kept:\texport foo=bar; echo foo=[$$foo] å¦ä¸€ä¸ªè§£å†³åŠæ³•æ˜¯åœ¨æ¢è¡Œç¬¦å‰åŠ ä¸Šåæ–œæ è¿›è¡Œè½¬ä¹‰ï¼š var-kept:\texport foo=bar; \\\techo foo=[$$foo] æœ€åï¼Œå¯ä»¥ä½¿ç”¨ .ONESHELL: å‘½ä»¤æ¥ç¡®ä¿æ‰€æœ‰å‘½ä»¤åœ¨åŒä¸€ Shell ä¸­æ‰§è¡Œï¼š .ONESHELL: var-kept:\texport foo=bar;\techo foo=[$$foo] ä¸‰ã€Makefile æ–‡ä»¶çš„è¯­æ³•3.1 æ³¨é‡Šåœ¨ Makefile ä¸­ï¼Œæ³¨é‡Šä»¥äº•å·ï¼ˆ#ï¼‰å¼€å§‹ã€‚ä»»ä½•åœ¨äº•å·ä¹‹åçš„å†…å®¹éƒ½ä¼šè¢«å¿½ç•¥ï¼Œé€šå¸¸ç”¨äºè§£é‡Šä»£ç çš„æ„å›¾æˆ–æä¾›é¢å¤–çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š # è¿™æ˜¯æ³¨é‡Šresult.txt: source.txt# è¿™ä¹Ÿæ˜¯æ³¨é‡Šcp source.txt result.txt # è¿™ä¹Ÿæ˜¯æ³¨é‡Š ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ³¨é‡Šæ¸…æ¥šåœ°è§£é‡Šäº†å„è¡Œå‘½ä»¤çš„å«ä¹‰ï¼Œå¸®åŠ©åç»­ç»´æŠ¤äººå‘˜ç†è§£ä»£ç ç»“æ„ã€‚ 3.2 å›å£°ï¼ˆechoingï¼‰åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œmake å‘½ä»¤åœ¨æ‰§è¡Œæ¯æ¡å‘½ä»¤æ—¶ä¼šå…ˆæ‰“å°å‡ºè¿™æ¡å‘½ä»¤çš„å†…å®¹ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºâ€œå›å£°â€ï¼ˆechoingï¼‰ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„è§„åˆ™ä¸­ï¼š test:# è¿™æ˜¯æµ‹è¯• æ‰§è¡Œå‘½ä»¤ make test æ—¶ï¼Œå°†çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼š $ make test # è¿™æ˜¯æµ‹è¯• å¦‚æœå¸Œæœ›æŠ‘åˆ¶è¯¥å›å£°ï¼Œåªéœ€åœ¨å‘½ä»¤å‰åŠ ä¸Š @ ç¬¦å·ã€‚ä¾‹å¦‚ï¼š test:@# è¿™æ˜¯æµ‹è¯• ç„¶åå†æ¬¡è¿è¡Œ make testï¼Œå°†ä¸ä¼šæœ‰ä»»ä½•è¾“å‡ºã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¿ç•™å‘½ä»¤çš„è¾“å‡ºä¿¡æ¯æ˜¯æœ‰å¸®åŠ©çš„ï¼Œä½†åœ¨å¤„ç†æ³¨é‡Šæˆ–åªéœ€è¦æ˜¾ç¤ºçš„ echo å‘½ä»¤æ—¶ä½¿ç”¨ @ ç¬¦å·æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œä¾‹å¦‚ï¼š test:@echo TODO 3.3 é€šé…ç¬¦é€šé…ç¬¦ï¼ˆwildcardï¼‰å…è®¸åœ¨ Makefile ä¸­æŒ‡å®šä¸€ç»„ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶åï¼Œç±»ä¼¼äº Bash ä¸­çš„å†™æ³•ã€‚ä¸»è¦çš„é€šé…ç¬¦åŒ…æ‹¬æ˜Ÿå·ï¼ˆ*ï¼‰ã€é—®å·ï¼ˆ?ï¼‰å’Œæ–¹æ‹¬å·ï¼ˆ[...]ï¼‰ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ *.o å¯ä»¥è¡¨ç¤ºå½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ‰©å±•åä¸º .o çš„æ–‡ä»¶ã€‚ clean:\trm -f *.o è¿™æ¡è§„åˆ™ä¼šåˆ é™¤å½“å‰ç›®å½•ä¸­æ‰€æœ‰ä»¥ .o ä½œä¸ºåç¼€çš„æ–‡ä»¶ï¼Œç®€åŒ–äº†æ¸…ç†å·¥ä½œçš„æ­¥éª¤ã€‚ 3.4 æ¨¡å¼åŒ¹é…Make å‘½ä»¤æ”¯æŒå¯¹æ–‡ä»¶åè¿›è¡Œç±»ä¼¼æ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å¼åŒ¹é…ã€‚ä¸»è¦ç¬¦å·ä¸º %ã€‚å‡è®¾å½“å‰ç›®å½•ä¸‹æœ‰ f1.c å’Œ f2.c ä¸¤ä¸ªæºç æ–‡ä»¶ï¼Œå¦‚æœå¸Œæœ›å°†å®ƒä»¬ç¼–è¯‘æˆå„è‡ªçš„å¯¹è±¡æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ¨¡å¼åŒ¹é…çš„è§„åˆ™ï¼š %.o: %.c è¿™æ¡è§„åˆ™ç›¸å½“äºæ‰‹åŠ¨åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶çš„å…³ç³»ï¼š f1.o: f1.cf2.o: f2.c ä½¿ç”¨åŒ¹é…ç¬¦ %ï¼Œå¯ä»¥å¤§å¹…åº¦å‡å°‘å†—ä½™çš„è§„åˆ™å®šä¹‰ï¼Œæ–¹ä¾¿ç®¡ç†å’Œæ›´æ–°ã€‚ 3.5 å˜é‡å’Œèµ‹å€¼ç¬¦Makefile æ”¯æŒè‡ªå®šä¹‰å˜é‡ï¼Œä½¿ç”¨ç­‰å·ï¼ˆ=ï¼‰è¿›è¡Œèµ‹å€¼æ“ä½œã€‚ä¾‹å¦‚ï¼š txt = Hello Worldtest:\t@echo $(txt) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå˜é‡ txt è¢«èµ‹å€¼ä¸º Hello Worldï¼Œå¹¶é€šè¿‡ @echo å‘½ä»¤è¿›è¡Œè¾“å‡ºã€‚å˜é‡çš„è°ƒç”¨éœ€ä½¿ç”¨ $( ) åŒ…è£¹ã€‚è‹¥è¦è°ƒç”¨ Shell ç¯å¢ƒå˜é‡ï¼Œåˆ™éœ€è¦åœ¨ç¾å…ƒç¬¦å·å‰å†åŠ ä¸€ä¸ªç¾å…ƒç¬¦å·ï¼Œä»¥é˜²æ­¢ Make å‘½ä»¤å¯¹å…¶è¿›è¡Œè½¬ä¹‰ï¼š test:\t@echo $$HOME æ­¤å¤–ï¼Œå˜é‡çš„å€¼å¯ä»¥æŒ‡å‘å…¶ä»–å˜é‡ï¼Œä¾‹å¦‚ï¼š v1 = $(v2) è¿™é‡Œé¢ä¸´ä¸€ä¸ªé—®é¢˜ï¼šv1 çš„å€¼æ˜¯åœ¨å®šä¹‰æ—¶æ‰©å±•ï¼ˆé™æ€æ‰©å±•ï¼‰è¿˜æ˜¯è¿è¡Œæ—¶æ‰©å±•ï¼ˆåŠ¨æ€æ‰©å±•ï¼‰ï¼Ÿå¦‚æœ v2 çš„å€¼æ˜¯åŠ¨æ€çš„ï¼Œåˆ™ä¸¤ç§æ‰©å±•æ–¹å¼çš„ç»“æœå¯èƒ½ä¼šå‡ºç°å·®å¼‚ã€‚ä¸ºäº†è§£å†³æ­¤ç±»é—®é¢˜ï¼ŒMakefile æä¾›äº†å››ç§èµ‹å€¼è¿ç®—ç¬¦ï¼ˆ=, :=, ?=, +=ï¼‰ï¼Œå…·ä½“åŒºåˆ«å¯å‚è€ƒç›¸å…³èµ„æ–™ï¼Œä¾‹å¦‚ StackOverflowã€‚ VARIABLE = valueï¼šåœ¨æ‰§è¡Œæ—¶æ‰©å±•ï¼Œå…è®¸é€’å½’æ‰©å±•ã€‚ VARIABLE := valueï¼šåœ¨å®šä¹‰æ—¶æ‰©å±•ã€‚ VARIABLE ?= valueï¼šåªæœ‰åœ¨è¯¥å˜é‡ä¸ºç©ºæ—¶æ‰è®¾ç½®å€¼ã€‚ VARIABLE += valueï¼šå°†å€¼è¿½åŠ åˆ°å˜é‡çš„å°¾éƒ¨ã€‚ 3.6 å†…ç½®å˜é‡ï¼ˆImplicit Variablesï¼‰Make å‘½ä»¤æ”¯æŒä¸€ç³»åˆ—å†…ç½®å˜é‡ï¼Œä¾‹å¦‚ $(CC) ä»£è¡¨å½“å‰ä½¿ç”¨çš„ç¼–è¯‘å™¨ï¼Œ$(MAKE) ä»£è¡¨å½“å‰ä½¿ç”¨çš„ Make å·¥å…·ã€‚è¿™äº›å˜é‡æ—¨åœ¨å¢å¼ºè·¨å¹³å°çš„å…¼å®¹æ€§ã€‚å†…ç½®å˜é‡çš„è¯¦ç»†æ¸…å•å¯åœ¨æ‰‹å†Œä¸­æ‰¾åˆ°ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š output:\t$(CC) -o output input.c åœ¨æ‰§è¡Œè¯¥ç›®æ ‡æ—¶ï¼Œ$(CC) ä¼šè¢«æ›¿æ¢ä¸ºæ‰€é€‰ç¼–è¯‘å™¨çš„å‘½ä»¤ã€‚ 3.7 è‡ªåŠ¨å˜é‡ï¼ˆAutomatic Variablesï¼‰Make å‘½ä»¤æä¾›äº†ä¸€äº›è‡ªåŠ¨å˜é‡ï¼Œè¿™äº›å˜é‡çš„å€¼ä¸å½“å‰è§„åˆ™å¯†åˆ‡ç›¸å…³ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š $@ï¼šæŒ‡ä»£å½“å‰ç›®æ ‡ï¼Œå³ Make å‘½ä»¤æ­£åœ¨æ„å»ºçš„é‚£ä¸ªç›®æ ‡ã€‚ ä¾‹å¦‚ï¼Œåœ¨å¦‚ä¸‹è§„åˆ™ä¸­ï¼š a.txt b.txt:\ttouch $@ è¿™é‡Œçš„ $@ åˆ†åˆ«åœ¨æ‰§è¡Œæ—¶æŒ‡å‘ a.txt å’Œ b.txtã€‚ $ï¼šæŒ‡ä»£ç¬¬ä¸€ä¸ªå‰ç½®æ¡ä»¶ã€‚ ç¤ºä¾‹ï¼š a.txt: b.txt c.txt\tcp $ $@ è¿™é‡Œï¼Œ$ ä¼šæ›¿æ¢ä¸º b.txtï¼Œå³å¤åˆ¶ b.txt åˆ° a.txtã€‚ $?ï¼šæŒ‡ä»£æ¯”ç›®æ ‡æ›´æ–°çš„æ‰€æœ‰å‰ç½®æ¡ä»¶ã€‚ $^ï¼šæŒ‡ä»£æ‰€æœ‰å‰ç½®æ¡ä»¶ã€‚ $*ï¼šè¡¨ç¤ºä¸æ¨¡å¼ç¬¦ % åŒ¹é…çš„éƒ¨åˆ†ã€‚ $(@D) ä¸ $(@F)ï¼šåˆ†åˆ«æŒ‡å‘$@çš„ç›®å½•åå’Œæ–‡ä»¶åã€‚ ä¾‹å¦‚ï¼š dest/%.txt: src/%.txt\t@[ -d dest ] || mkdir dest\tcp $ $@ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œsrc/ ç›®å½•ä¸‹çš„æ–‡æœ¬æ–‡ä»¶å°†è¢«å¤åˆ¶åˆ° dest/ ç›®å½•ä¸­ï¼Œå‰ææ˜¯å…ˆæ£€æŸ¥ dest/ ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚ 3.8 åˆ¤æ–­å’Œå¾ªç¯Makefile ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼ Bash çš„è¯­æ³•è¿›è¡Œæ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯ã€‚ä¾‹å¦‚ï¼š ifeq ($(CC), gcc)libs = $(libs_for_gcc)elselibs = $(normal_libs)endif æ­¤ä»£ç ç”¨äºåˆ¤æ–­å½“å‰çš„ç¼–è¯‘å™¨æ˜¯ä¸æ˜¯ gccï¼Œç„¶åæ ¹æ®åˆ¤æ–­ç»“æœé€‰æ‹©ä¸åŒçš„åº“æ–‡ä»¶ã€‚æ­¤å¤–ï¼Œå¾ªç¯çš„å†™æ³•å¦‚ä¸‹ï¼š LIST = onetwo threeall:\tfor i in $(LIST); do \\ echo $$i; \\\tdone è¿™ä¸ªå¾ªç¯ä¼šä¾æ¬¡è¾“å‡º onetwo å’Œ threeã€‚ 3.9 å‡½æ•°Makefile ä¸­ä¹Ÿå¯ä»¥å®šä¹‰å’Œè°ƒç”¨å‡½æ•°ã€‚å‡½æ•°çš„è°ƒç”¨æ ¼å¼ä¸º $(function arguments)ã€‚Makefile æä¾›äº†å¤šç§å†…ç½®å‡½æ•°ä¾›ä½¿ç”¨ï¼Œä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸ç”¨çš„ç¤ºä¾‹ï¼š shell å‡½æ•°ï¼šæ‰§è¡Œ Shell å‘½ä»¤ã€‚ srcfiles := $(shell echo src/00..99.txt) wildcard å‡½æ•°ï¼šåœ¨ Makefile ä¸­æ›¿ä»£ Bash çš„é€šé…ç¬¦ã€‚ srcfiles := $(wildcard src/*.txt) subst å‡½æ•°ï¼šç”¨äºæ–‡æœ¬æ›¿æ¢ã€‚ $(subst from, to, text) ä¾‹å¦‚ï¼Œå°†å­—ç¬¦ä¸² feet on the street ä¸­çš„ ee æ›¿æ¢ä¸º EEã€‚ $(subst ee, EE, feet on the street) patsubst å‡½æ•°ï¼šç”¨äºæ¨¡å¼æ›¿æ¢ã€‚ $(patsubst pattern, replacement, text) ä¾‹å¦‚ï¼Œå°†æ–‡ä»¶å x.c c bar.c æ›¿æ¢ä¸º x.c.o bar.oã€‚ æ›¿æ¢åç¼€åå‡½æ•°ï¼šæ ¼å¼ä¸º å˜é‡å + å†’å· + åç¼€åæ›¿æ¢è§„åˆ™ï¼Œæ˜¯ patsubst å‡½æ•°çš„ä¸€ç§ç®€å†™å½¢å¼ã€‚ min: $(OUTPUT:.js=.min.js) è¿™è¡¨ç¤ºå°†å˜é‡ OUTPUT ä¸­çš„åç¼€ .js æ›¿æ¢ä¸º .min.jsã€‚ å››ã€Makefile çš„å®ä¾‹ï¼ˆ1ï¼‰æ‰§è¡Œå¤šä¸ªç›®æ ‡å®šä¹‰å¤šä¸ªä¼ªç›®æ ‡ï¼Œä»¥ä¾¿åœ¨æ¸…ç†è¿‡ç¨‹ä¸­å¯ä»¥åŒæ—¶åˆ é™¤è®¸å¤šä¸åŒç±»å‹çš„æ–‡ä»¶ï¼š .PHONY: clean all cleanobj cleandiffcleanall: clean obj cleandiff\trm programcleanobj:\trm *.ocleandiff:\trm *.diff é€šè¿‡è°ƒç”¨ make cleanallï¼Œä¼šæ‰§è¡Œæ‰€æœ‰æ¸…ç†ç›®æ ‡ï¼Œå…¨é¢åˆ é™¤ä¸åŒåç¼€çš„æ–‡ä»¶ï¼Œæ–¹ä¾¿é¡¹ç›®ç®¡ç†ã€‚ ï¼ˆ2ï¼‰ç¼–è¯‘ C è¯­è¨€é¡¹ç›®ä½¿ç”¨ Makefile ç¼–è¯‘ C è¯­è¨€é¡¹ç›®çš„åŸºæœ¬ç»“æ„ç¤ºä¾‹å¦‚ä¸‹ï¼š edit: main.o kbd.o command.o display.o\tcc -o edit main.o kbd.o command.o display.omain.o: main.c defs.h\tcc -c main.ckbd.o: kbd.c defs.h command.h\tcc -c kbd.ccommand.o: command.c defs.h command.h\tcc -c command.cdisplay.o: display.c defs.h\tcc -c display.cclean:\trm edit main.o kbd.o command.o display.o.PHONY: edit clean åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œedit ç›®æ ‡ä¾èµ–äºå¤šä¸ªæ¨¡å—çš„å¯¹è±¡æ–‡ä»¶ï¼Œç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨å¤„ç†è¿™äº›ä¾èµ–å…³ç³»ï¼Œä»è€Œå®ç°å°†æºä»£ç ç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ã€‚æ¸…ç†ç›®æ ‡åˆ™æä¾›äº†æ–¹ä¾¿å¿«é€Ÿçš„åˆ é™¤ç¼–è¯‘ç”Ÿæˆæ–‡ä»¶çš„æ–¹å¼ã€‚","categories":["6.å¼€å‘å·¥å…·","ç¼–è¯‘é“¾æ¥"]},{"title":"ç¼–è¯‘å’Œé“¾æ¥","path":"/2024/01/17/6-å¼€å‘å·¥å…·-ç¼–è¯‘é“¾æ¥-ç¼–è¯‘å’Œé“¾æ¥/","content":"gcc ç¼–è¯‘è¿‡ç¨‹GCCï¼ˆGNU Compiler Collectionï¼‰æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç¼–è¯‘å™¨ï¼Œå¹¿æ³›åº”ç”¨äº Linux ç¯å¢ƒä¸­ã€‚GCC è´Ÿè´£å°† C è¯­è¨€æºä»£ç ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè®¸å¤š GNU å·¥å…·éƒ½æ˜¯é€šè¿‡å®ƒå®Œæˆç¼–è¯‘çš„ã€‚ä»¥ä¸‹æ˜¯ GCC çš„ç¼–è¯‘è¿‡ç¨‹æ­¥éª¤å’Œè¯¦ç»†ç¤ºä¾‹ã€‚ ç¼–è¯‘è¿‡ç¨‹æ­¥éª¤ é¢„å¤„ç†æºæ–‡ä»¶ç»è¿‡é¢„å¤„ç†ï¼Œç”Ÿæˆä»¥ .i ç»“å°¾çš„ä¸­é—´æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨ -E å‚æ•°æ¥ç”Ÿæˆè¿™ä¸ªæ–‡ä»¶ã€‚è¿™ä¸ªé˜¶æ®µä¸»è¦å¤„ç† #include æŒ‡ä»¤å¼•å…¥çš„å¤´æ–‡ä»¶å’Œå®å®šä¹‰ï¼Œå°†å®ƒä»¬æ’å…¥åˆ°æºä»£ç ä¸­ã€‚ ç¤ºä¾‹ï¼š gcc -E hello.c -o hello.i ç”Ÿæˆ hello.i åï¼ŒæŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥å‘ç°é™¤äº†æºä»£ç å¤–ï¼Œè¿˜æœ‰å¤§é‡çš„å¤´æ–‡ä»¶å’Œå®å®šä¹‰å†…å®¹ã€‚ ç¼–è¯‘ä»é¢„å¤„ç†æ–‡ä»¶ç”Ÿæˆæ±‡ç¼–è¯­è¨€æ–‡ä»¶ï¼Œä½¿ç”¨ -S å‚æ•°ã€‚æ­¤æ­¥éª¤å°†æºä»£ç ç¿»è¯‘æˆæ±‡ç¼–è¯­è¨€ï¼Œè¿™äº›æ–‡ä»¶é€šå¸¸ä»¥ .s åç¼€å­˜å‚¨ã€‚ ç¤ºä¾‹ï¼š gcc -S hello.i -o hello.s åœ¨ hello.s æ–‡ä»¶ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ï¼Œå¯èƒ½ä¼šæ¶‰åŠåˆ°å¤„ç†å™¨æ¶æ„ç›¸å…³çš„æŒ‡ä»¤ã€‚ æ±‡ç¼–æ±‡ç¼–è¯­è¨€æ–‡ä»¶ç»è¿‡æ±‡ç¼–ï¼Œç”Ÿæˆç›®æ ‡æ–‡ä»¶ .oã€‚å¯ä»¥ä½¿ç”¨ -c å‚æ•°æ¥è¿›è¡Œè¿™ä¸€æ­¥ã€‚ç›®æ ‡æ–‡ä»¶åŒ…å«æœºå™¨ä»£ç ï¼Œä½†å°šæœªé“¾æ¥ã€‚ ç¤ºä¾‹ï¼š gcc -c hello.s -o hello.o æŸ¥çœ‹ hello.o æ–‡ä»¶æ—¶ï¼Œä¼šå‘ç°å…¶ä¸­åŒ…å«äº†äºŒè¿›åˆ¶ç ï¼Œè®¡ç®—æœºèƒ½å¤Ÿç†è§£çš„æ ¼å¼ã€‚ é“¾æ¥å°†ç›®æ ‡æ–‡ä»¶é“¾æ¥ï¼Œç”Ÿæˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿™ä¸€è¿‡ç¨‹æ¶‰åŠåˆ°å°†ç¨‹åºçš„å„ä¸ªéƒ¨åˆ†æ•´åˆåœ¨ä¸€èµ·ï¼ŒåŒ…æ‹¬æ‰€æœ‰å¼•ç”¨å’Œä¾èµ–ã€‚ ç¤ºä¾‹ï¼š gcc hello.o -o hello æ‰§è¡Œè¿™ä¸ªæ­¥éª¤åï¼Œä¾¿å¯ä»¥å¾—åˆ°å¯æ‰§è¡Œçš„ hello æ–‡ä»¶ã€‚ æ— è®ºæ˜¯åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¿˜æ˜¯æ—¥å¸¸è°ƒè¯•ï¼Œä½¿ç”¨ gcc hello.c -o hello å¯ä»¥ä¸€æ­¥åˆ°ä½ï¼Œè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰ä¸Šè¿°æ­¥éª¤ã€‚ é™æ€é“¾æ¥åº“å’ŒåŠ¨æ€é“¾æ¥åº“é™æ€é“¾æ¥åº“é™æ€é“¾æ¥åº“æ˜¯åœ¨ç¨‹åºç¼–è¯‘æ—¶å°±è¢«åŠ è½½è¿›æ¥ï¼Œå½¢æˆä¸€ä¸ªæ•´ä½“ã€‚è¿™ä½¿å¾—æœ€ç»ˆç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä½“ç§¯æ›´å¤§ï¼Œè€Œä¸”é™æ€åº“æ— æ³•å…±äº«ã€‚ åŠ¨æ€é“¾æ¥åº“åŠ¨æ€é“¾æ¥åº“åˆ™æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶è¢«åŠ è½½ï¼Œè¿™ç§æ–¹å¼å…è®¸å¤šä¸ªç¨‹åºå…±äº«åŒä¸€æ®µä»£ç ã€‚ ç¤ºä¾‹è€ƒè™‘ä»¥ä¸‹çš„ä¸‰ä¸ªæºæ–‡ä»¶ï¼Œå…¶ä¸­ hello.c ä¸ºç‹¬ç«‹æ–‡ä»¶ï¼Œå¦‚æœç›´æ¥ç¼–è¯‘ hello.cï¼Œä¼šå› ä¸ºç¼ºå°‘ main å‡½æ•°è€ŒæŠ¥é”™ã€‚è§£å†³æ–¹æ¡ˆæœ‰ï¼š ç¼–è¯‘æˆå¯¹è±¡æ–‡ä»¶å¹¶é“¾æ¥é¦–å…ˆï¼Œå°†æºæ–‡ä»¶ç¼–è¯‘ä¸º .o æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œé“¾æ¥ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚ ä½¿ç”¨é™æ€é“¾æ¥åº“åœ¨ Linux å¹³å°ï¼Œåº“æ–‡ä»¶ä¸€èˆ¬å­˜æ”¾åœ¨ /usr/lib å’Œ /lib ç›®å½•ã€‚é™æ€åº“ä»¥ libxxxx.a ä¸ºå‘½åè§„åˆ™ï¼ŒåŠ¨æ€åº“ä»¥ libxxxx.so.major.minor å‘½åï¼Œå…¶ä¸­ major å’Œ minor åˆ†åˆ«è¡¨ç¤ºä¸»ç‰ˆæœ¬å·å’Œå‰¯ç‰ˆæœ¬å·ã€‚ é™æ€åº“çš„ç”Ÿæˆå¯åˆ†ä¸ºä¸¤æ­¥ï¼š å…ˆç¼–è¯‘æºæ–‡ä»¶ç”Ÿæˆ .o æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶ä¸­éƒ½æœ‰ç¬¦å·è¡¨ã€‚ ä½¿ç”¨ ar å‘½ä»¤å°†å¤šä¸ª .o æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ª .a æ–‡ä»¶ï¼Œå½¢æˆé™æ€åº“ã€‚ ç¤ºä¾‹ï¼š ar rcs libmyhello.a hello.o ä½¿ç”¨æ—¶ï¼Œé€šè¿‡é“¾æ¥å™¨è¿å…¥é™æ€åº“ã€‚è°ƒç”¨æ—¶ï¼Œä¸éœ€è¦æŒ‡å®šåº“å‰ç¼€å’Œåç¼€ï¼Œä¾‹å¦‚ -lmyhelloï¼Œå°±å¯ä»¥é“¾æ¥ libmyhello.aã€‚ gcc -o hello main.c -static -L. -lmyhello å…¶ä¸­ -static é€‰é¡¹è¡¨ç¤ºä½¿ç”¨é™æ€é“¾æ¥åº“ï¼Œ-L. é€‰é¡¹æŒ‡å®šå½“å‰è·¯å¾„ä¸ºé™æ€åº“æœç´¢è·¯å¾„ã€‚ åŠ¨æ€é“¾æ¥åº“ç”ŸæˆåŠ¨æ€é“¾æ¥åº“çš„è¿‡ç¨‹ä¸åŒã€‚é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªä¸­é—´æ–‡ä»¶ï¼Œä½¿ç”¨ -shared å’Œ -fPIC é€‰é¡¹æ ‡è®°ã€‚-fPIC è¡¨ç¤ºç”Ÿæˆçš„ä»£ç ä¸ç‰¹å®šå†…å­˜åœ°å€æ— å…³ï¼Œä¾¿äºé‡ç”¨ã€‚ ç¤ºä¾‹ï¼š gcc -shared -fPIC -c hello.cgcc -shared -fPIC -o libmyhello.so hello.o æœ€åï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼š gcc -o hello main.c -L. -lmyhello è¿è¡Œæ—¶ï¼Œå¦‚æœç¨‹åºæ‰¾ä¸åˆ° libmyhello.soï¼Œéœ€è¦å°†å…¶æ”¾åœ¨ /lib æˆ– /usr/lib ä¸‹ï¼Œæˆ–åœ¨ /etc/ld.so.conf æ–‡ä»¶ä¸­æ·»åŠ åº“æ–‡ä»¶ç›®å½•ï¼Œå¹¶è¿è¡Œ ldconfig å‘½ä»¤æ›´æ–°åº“ç¼“å­˜ã€‚","categories":["6.å¼€å‘å·¥å…·","ç¼–è¯‘é“¾æ¥"]},{"title":"CppCheck","path":"/2024/01/16/6-å¼€å‘å·¥å…·-è°ƒè¯•-CppCheck/","content":"CppCheck çš„å®‰è£…å’Œä½¿ç”¨CppCheck æ¦‚è¿°CppCheck æ˜¯ä¸€ä¸ªæ—¨åœ¨æ£€æµ‹ CC++ ä»£ç ç¼ºé™·çš„é™æ€æ£€æŸ¥å·¥å…·ã€‚ä¸ CC++ ç¼–è¯‘å™¨ä»¥åŠå…¶ä»–åˆ†æå·¥å…·ä¸åŒï¼ŒCppCheck ä¸“æ³¨äºè¯†åˆ«é‚£äº›ç¼–è¯‘å™¨æ— æ³•æ•æ‰åˆ°çš„ bugï¼Œè€Œä¸ä¼šå¹²æ‰°äºè¯­æ³•é”™è¯¯çš„æ£€æŸ¥ã€‚ç®€å•æ¥è¯´ï¼Œé™æ€ä»£ç æ£€æŸ¥æ˜¯ä¸€ç§åˆ©ç”¨å·¥å…·æ¥è¯„ä¼°ä»¬ç¼–å†™çš„ä»£ç æ˜¯å¦å®‰å…¨ä¸”ç¨³å¥ï¼Œæ˜¯å¦å­˜åœ¨æ½œåœ¨çš„é—®é¢˜ã€‚ ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸‹é¢è¿™æ®µä»£ç ï¼š int n = 10; char* buffer = new char[n]; buffer[n] = 0; å°½ç®¡è¿™æ®µä»£ç ç¬¦åˆè¯­æ³•è§„èŒƒï¼ŒCppCheck å°±å¯èƒ½ä¼šå‘å‡ºè­¦å‘Šï¼Œæç¤ºæ­¤è¡Œä»£ç å¯èƒ½å¯¼è‡´ç¼“å†²åŒºæº¢å‡ºã€‚è¿™ç§æº¢å‡ºçš„é—®é¢˜é€šå¸¸æ˜¯å› ä¸ºæ•°ç»„ä¸‹æ ‡è¶…å‡ºèŒƒå›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒæˆ–è€…æ•°æ®æŸåã€‚CppCheck åœ¨çº¿é™æ€åˆ†æä¸­æä¾›äº†æ›´ä¸¥æ ¼çš„æ£€æµ‹ï¼Œå¸®åŠ©å¼€å‘è€…åœ¨ç¼–è¯‘ä¹‹å‰è¯†åˆ«å’Œä¿®å¤æ½œåœ¨çš„é”™è¯¯ï¼Œè¿™æ— ç–‘æ˜¯æå‡ä»£ç è´¨é‡çš„ä¸€å¤§åˆ©å™¨ã€‚ ç›®å‰æ¯”è¾ƒæµè¡Œçš„ CC++ é™æ€ä»£ç æ£€æŸ¥å·¥å…·é™¤äº† CppCheck å¤–ï¼Œè¿˜æœ‰ pc-lint ç­‰ã€‚è™½ç„¶ pc-lint ä½œä¸ºè€ç‰Œå·¥å…·å…¶åŠŸèƒ½å¼ºå¤§ï¼Œä½†å®ƒæ˜¯æ”¶è´¹è½¯ä»¶ï¼Œå¹¶ä¸”é…ç½®ä¸Šç›¸å¯¹å¤æ‚ã€‚è€Œ CppCheck åˆ™æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æºè½¯ä»¶ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ å‹å¥½ï¼Œé€‚åˆå¹¿æ³›çš„å¼€å‘è€…ç¾¤ä½“ã€‚ CppCheck å®‰è£…å’Œä½¿ç”¨è¦å®‰è£… CppCheckï¼Œè¯·è®¿é—® CppCheck å®˜ç½‘ ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ã€‚CppCheck çš„ä½¿ç”¨æ–¹å¼æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«ä¸º GUI æ–¹å¼å’Œå‘½ä»¤è¡Œæ–¹å¼ã€‚ GUI æ–¹å¼å®‰è£…å®Œæˆåï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ cppcheck-gui æ¥æ£€æµ‹ä»£ç ï¼Œç•Œé¢å¦‚ä¸‹ï¼š åœ¨ç•Œé¢ä¸­ï¼Œå¯ä»¥é€‰æ‹©è¦æ£€æŸ¥çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œè®¾ç½®æ£€æŸ¥é€‰é¡¹ï¼Œç„¶åä¸€é”®æ£€æµ‹ï¼Œéå¸¸ç›´è§‚æ–¹ä¾¿ã€‚ å‘½ä»¤è¡Œæ–¹å¼ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå¿«é€Ÿè¿è¡Œ CppCheckï¼Œå‘½ä»¤è¡Œç•Œé¢ç¤ºä¾‹å¦‚ä¸‹ï¼š åœ¨å‘½ä»¤è¡Œä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„å‚æ•°æ¥å®šåˆ¶æ£€æŸ¥è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ --enable=style æ¥æ£€æŸ¥ä»£ç é£æ ¼é—®é¢˜ï¼Œæˆ–ä½¿ç”¨ --output-file=result.txt å°†è¾“å‡ºç»“æœä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚ é›†æˆåˆ° IDE å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨Visual Studio (VS)å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å°† CppCheck åµŒå…¥åˆ° Visual Studio ä¸­ï¼Œæ–¹ä¾¿åœ°å¯¹é¡¹ç›®ä¸­çš„æ–‡ä»¶è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶æ”¯æŒé”™è¯¯çš„è·³è½¬åŠŸèƒ½ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š åœ¨ Visual Studio ä¸­ï¼Œæ‰“å¼€èœå•ï¼šå·¥å…· å¤–éƒ¨å·¥å…·ã€‚ ç‚¹å‡»â€æ·»åŠ â€æŒ‰é’®ã€‚ åœ¨å¼¹å‡ºçš„çª—å£ä¸­ï¼Œè®¾ç½®æ ‡é¢˜ï¼Œä¾‹å¦‚ Cppcheckã€‚ è®¾ç½®å‘½ä»¤ä¸º C:\\Program Files (x86)\\Cppcheck\\cppcheck.exeï¼ˆè¯·æ ¹æ®å®é™…å®‰è£…è·¯å¾„è°ƒæ•´ï¼‰ã€‚ åœ¨å‚æ•°æ¡†ä¸­è¾“å…¥ï¼š--quiet --verbose --template=vs $(ItemPath)ã€‚ åœ¨åˆå§‹ç›®å½•æ¡†ä¸­è®¾ç½®ä¸º $(ItemDir)ã€‚ ç¡®ä¿é€‰ä¸­â€ä½¿ç”¨è¾“å‡ºçª—å£â€å¤é€‰æ¡†ã€‚ é€šè¿‡åå¤ç‚¹å‡»â€ä¸Šç§»â€æŒ‰é’®ï¼Œå°†è¯¥å‘½ä»¤ç§»åŠ¨åˆ°åˆ—è¡¨é¡¶éƒ¨ï¼Œä»¥ä¾¿æ›´æ–¹ä¾¿åœ°è¯†åˆ«ã€‚ ç‚¹å‡»â€ç¡®å®šâ€ä¿å­˜è®¾ç½®ã€‚ è¿™æ ·ä¸€æ¥ï¼Œåœ¨ Visual Studio ä¸­å°±å¯ä»¥é€šè¿‡å·¥å…·èœå•è½»æ¾è°ƒç”¨ CppCheck è¿›è¡Œä»£ç æ£€æŸ¥ã€‚ Qt Creatoråœ¨ Qt Creator ä¸­ï¼ŒåŒæ ·å¯ä»¥é€šè¿‡ç®€å•çš„æ­¥éª¤å°† CppCheck é›†æˆåˆ°å¼€å‘ç¯å¢ƒä¸­ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š æ‰“å¼€ Qt Creatorï¼Œç‚¹å‡»èœå•ï¼šå·¥å…· å¤–éƒ¨ é…ç½®... æ·»åŠ ã€‚ åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼Œå¡«å†™å¦‚ä¸‹å‚æ•°ï¼š å‘½ä»¤ï¼šè®¾ç½®ä¸º CppCheck çš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ã€‚ å‚æ•°ï¼šå¯ä»¥è¾“å…¥ --enable=all æ¥å¯ç”¨æ‰€æœ‰æ£€æŸ¥ã€‚ åˆå§‹ç›®å½•ï¼šè®¾ç½®ä¸ºé¡¹ç›®çš„æ ¹ç›®å½•ã€‚ ä»¥ä¸‹æ˜¯è®¾ç½®åçš„å¯¹è¯æ¡†ç¤ºä¾‹ï¼š å®Œæˆè®¾ç½®åï¼Œå¯ä»¥é€šè¿‡èœå• å·¥å…· å¤–éƒ¨ CppCheck æ¥å¼€å§‹æ£€æŸ¥æŒ‡å®šç›®å½•ä¸‹çš„ä»£ç æ–‡ä»¶ï¼Œç¡®ä¿å¼€å‘è¿‡ç¨‹ä¸­çš„ä»£ç è´¨é‡ã€‚","categories":["6.å¼€å‘å·¥å…·","è°ƒè¯•"]},{"title":"GDBè°ƒè¯•","path":"/2024/01/15/6-å¼€å‘å·¥å…·-è°ƒè¯•-GDBè°ƒè¯•/","content":"GDB è°ƒè¯•æŒ‡å—GDBï¼ˆGNU Debuggerï¼‰æ˜¯ä¸€ç§å¼ºå¤§çš„è°ƒè¯•å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜é€æ­¥æ£€æŸ¥ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„è¡Œä¸ºã€‚ä½¿ç”¨ GDBï¼Œå¯ä»¥è®¾ç½®æ–­ç‚¹ï¼Œå•æ­¥æ‰§è¡Œä»£ç ï¼Œå¹¶æŸ¥çœ‹å˜é‡çš„å€¼ï¼Œç¡®ä¿ç¨‹åºæŒ‰ç…§é¢„æœŸè¿è¡Œã€‚ é‡æ–°ç¼–è¯‘ç¨‹åºåœ¨ä½¿ç”¨ GDB è°ƒè¯•ä¹‹å‰ï¼Œç¨‹åºå¿…é¡»ä»¥è°ƒè¯•æ¨¡å¼é‡æ–°ç¼–è¯‘ã€‚è¿™æ„å‘³ç€éœ€è¦åœ¨ç¼–è¯‘å‘½ä»¤ä¸­æ·»åŠ  -g é€‰é¡¹ã€‚ä¾‹å¦‚ï¼š gcc -g main.c -o main.out æ‰§è¡Œä¸Šè¿°å‘½ä»¤åï¼Œä¼šç”Ÿæˆä¸€ä¸ªå¯ä»¥ä½¿ç”¨ GDB è¿›è¡Œè°ƒè¯•çš„å¯æ‰§è¡Œæ–‡ä»¶ main.outã€‚ç¡®ä¿ä¸è¦åˆ é™¤æºä»£ç æ–‡ä»¶ main.cï¼Œå› ä¸º GDB åœ¨è¿è¡Œæ—¶éœ€è¦æºä»£ç æ¥æ˜¾ç¤ºç›¸å…³çš„è¡Œå·å’Œå˜é‡ä¿¡æ¯ã€‚å¦‚è‹¥åˆ é™¤ï¼ŒGDB å°†æ— æ³•æ­£ç¡®æ‰§è¡Œæ–­ç‚¹å’Œå•æ­¥è°ƒè¯•ã€‚ å¯åŠ¨è°ƒè¯•å¼€å§‹è°ƒè¯• main.out æ–‡ä»¶å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š gdb ./main.out æˆ–è€…ï¼š gdb main.out ä¸€æ—¦è¿›å…¥ GDB ç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨ list æˆ–å…¶ç®€å†™ l å‘½ä»¤åˆ—å‡ºå½“å‰è°ƒè¯•ç¨‹åºçš„æºä»£ç ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºå½“å‰ç¨‹åºçš„å‰ 10 è¡Œä»£ç ã€‚æŒ‰å›è½¦é”®å¯ä»¥æ˜¾ç¤ºæ¥ä¸‹æ¥çš„ä»£ç è¡Œã€‚ æ–­ç‚¹ä¸å•æ­¥è°ƒè¯•è¦å¯åŠ¨ç¨‹åºå¹¶è®¾ç½®ç¬¬ä¸€ä¸ªæ–­ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ start å‘½ä»¤ã€‚å½“ç¨‹åºå¯åŠ¨æ—¶ï¼ŒGDB ä¼šåœ¨ main() å‡½æ•°çš„é»˜è®¤æ–­ç‚¹å¤„æš‚åœã€‚ä¾‹å¦‚ï¼Œå®ƒä¼šåé¦ˆå¦‚ä¸‹ä¿¡æ¯ï¼š é»˜è®¤æ–­ç‚¹1åœ¨main()å¤„ï¼Œå…·ä½“è¡Œæ•°ä¸ºæœ¬æ–‡ä»¶çš„ç¬¬13è¡Œ å‡è®¾ç¬¬ 13 è¡Œçš„ä»£ç æ˜¯ï¼š int a = 5; è¦æŸ¥çœ‹å†…å­˜ä¸­å˜é‡çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ print a æˆ–å…¶ç®€å†™ p aã€‚é€šè¿‡è¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥æ£€æŸ¥å˜é‡ a çš„å½“å‰å€¼ã€‚ç”±äº int a = 5; è¿™ä¸€æŒ‡ä»¤å°šæœªæ‰§è¡Œï¼Œå› æ­¤åœ¨è¿™ä¹‹å‰ï¼Œ a çš„å€¼å°†æ˜¯æœªåˆå§‹åŒ–çŠ¶æ€ä¸‹çš„é»˜è®¤å€¼ã€‚ åœ¨å•æ­¥æ‰§è¡Œä¸­ï¼Œæœ‰å‡ ä¸ªé‡è¦çš„å‘½ä»¤ï¼š n æˆ– next: æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚è¿™ä¸ªå‘½ä»¤ä»…æ¨è¿›åˆ°ä¸‹ä¸€è¡Œï¼Œä¸è¿›å…¥è°ƒç”¨çš„å‡½æ•°ã€‚ s æˆ– step: æ‰§è¡Œå½“å‰è¡Œå¹¶è¿›å…¥å‡½æ•°å†…éƒ¨ã€‚å¦‚æœå½“å‰è¡Œæ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œå®ƒä¼šè®©è¿›å…¥è¯¥å‡½æ•°ã€‚ ä¾‹å¦‚ï¼Œå½“ç¨‹åºè¿è¡Œåˆ°ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä½¿ç”¨ step å‘½ä»¤åï¼ŒGDB ä¼šæ˜¾ç¤ºå½“å‰è¢«è°ƒç”¨çš„å‡½æ•°çš„å‚æ•°å·²è¢«èµ‹å€¼ï¼Œå¹¶ä¸”ä¼šå®šä½åˆ°å‚æ•°å¯¹åº”è¡Œã€‚ æŸ¥çœ‹å‡½æ•°è°ƒç”¨å †æ ˆä½¿ç”¨ bt å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰å‡½æ•°çš„è°ƒç”¨å †æ ˆã€‚æ¯ä¸ªå‡½æ•°éƒ½æœ‰è‡ªå·±çš„ç¼–å·å’Œå½“å‰æ‰§è¡Œè¡Œã€‚ä¾‹å¦‚ï¼Œå¯èƒ½ä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š ç¼–å·0 change å‡½æ•° å®šä½åˆ°ç¬¬6è¡Œç¼–å·1 mainå‡½æ•° å®šä½åˆ°ç¬¬15è¡Œ è¿™é‡Œçš„ç¼–å· 0 è¡¨ç¤ºå½“å‰åœ¨ change å‡½æ•°ï¼Œç¼–å· 1 è¡¨ç¤ºå¯ä»¥è·³è½¬å› main å‡½æ•°ã€‚ f num: åˆ‡æ¢åˆ°æŒ‡å®šçš„å †æ ˆå¸§ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡è¾“å…¥ f 1ï¼Œå¯ä»¥è¿”å›åˆ° main å‡½æ•°å¹¶æŸ¥çœ‹å…¶ä½ç½®ã€‚ é€€å‡ºè°ƒè¯•å®Œæˆè°ƒè¯•åï¼Œè¾“å…¥ q å¯ä»¥å®‰å…¨é€€å‡º GDBã€‚ ä½¿ç”¨ GDB è°ƒè¯•çš„æ¡ˆä¾‹è§£æåœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šä½¿ç”¨è¯¸å¦‚å–åœ°å€ç¬¦ å’Œåå…­è¿›åˆ¶ç¬¦å· 0x ç­‰ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰å¦‚ä¸‹å˜é‡èµ‹å€¼ï¼š int a = b; // è¿™å°†å­˜å‚¨bçš„åœ°å€ åœ¨å‘½ä»¤è¡Œè°ƒè¯•ä¸­ï¼Œå¯èƒ½çœ‹åˆ°ä¸‹åˆ—å†…å­˜åœ°å€çš„è¾“å‡ºæ¥åé¦ˆå‚æ•°çš„å€¼ï¼š a = 0xbffff064 // å˜é‡açš„åœ°å€b = 0xbffff068 // å˜é‡bçš„åœ°å€ é€šè¿‡å¦‚ä¸‹è¯­å¥ï¼Œå°†å†…å­˜åœ°å€ä¸­çš„å€¼èµ‹ç»™å˜é‡ï¼š int temp = *a; // tempç°åœ¨ä¸º5ï¼Œå³aæŒ‡å‘çš„å€¼int temp = a; // tempç°åœ¨ä¸ºæŒ‡å‘bçš„å†…å­˜åœ°å€0xbffff064 ä½¿ç”¨ x å‘½ä»¤æŸ¥çœ‹å†…å­˜å†…å®¹ä¹Ÿæ˜¯ä¸€ç§å¸¸è§æ“ä½œã€‚ä¾‹å¦‚ï¼Œå‘½ä»¤ï¼š x/3d 0x7fffffffde14 è¯¥å‘½ä»¤å°†è¾“å‡ºå†…å­˜åœ°å€ 0x7fffffffde14 å¤„çš„è¿ç»­ 3 ä¸ªå€¼ï¼Œå¹¶ä»¥åè¿›åˆ¶æ ¼å¼å±•ç¤ºã€‚ é€šè¿‡è¿™äº›å‘½ä»¤å’Œæ“ä½œï¼Œå¯ä»¥æ·±å…¥äº†è§£ç¨‹åºçš„å†…éƒ¨è¿ä½œï¼Œæé«˜è°ƒè¯•æ•ˆç‡ï¼Œç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§ä¸ç¨³å®šæ€§ã€‚ æ®µé”™è¯¯å€ŸåŠ© GDB æŸ¥æ‰¾æ–¹æ³•åœ¨è°ƒè¯•ç¨‹åºæ—¶ï¼Œ segment faultï¼ˆæ®µé”™è¯¯ï¼‰æ˜¯å¸¸è§ä¸”ä»¤äººæ²®ä¸§çš„é—®é¢˜ä¹‹ä¸€ã€‚å¯ä»¥ä½¿ç”¨ gdbï¼ˆGNU è°ƒè¯•å™¨ï¼‰æ¥å¸®åŠ©å®šä½å’Œè§£å†³è¿™äº›é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ gdb å’Œ ulimit å‘½ä»¤çš„è¯¦ç»†æŒ‡å—ï¼Œå¯ä»¥å¸®åŠ©å‘ç°å’Œè§£å†³æ®µé”™è¯¯ã€‚ ä½¿ç”¨ ulimit è®¾ç½®èµ„æºé™åˆ¶ulimit å‘½ä»¤åœ¨ Unix å’Œ Linux ç³»ç»Ÿä¸­ç”¨äºæ§åˆ¶ shell å¯åŠ¨è¿›ç¨‹æ‰€ä½¿ç”¨çš„èµ„æºã€‚ç†è§£å¦‚ä½•è®¾ç½®å’ŒæŸ¥çœ‹è¿™äº›é™åˆ¶è‡³å…³é‡è¦ï¼Œå› ä¸ºæŸäº›èµ„æºé™åˆ¶å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºæ„å¤–å´©æºƒæˆ–æ— æ³•æ­£å¸¸è¿è¡Œã€‚ èµ„æºé™åˆ¶é€‰é¡¹ -Hï¼šè®¾ç½®ç¡¬èµ„æºé™åˆ¶ã€‚ç¡¬é™åˆ¶æ˜¯ç³»ç»Ÿå…è®¸çš„æœ€å¤§å€¼ï¼Œåªæœ‰è¶…çº§ç”¨æˆ·å¯ä»¥ä¿®æ”¹ã€‚ -Sï¼šè®¾ç½®è½¯èµ„æºé™åˆ¶ã€‚è½¯é™åˆ¶æ˜¯å¯ä»¥éšæ—¶æ›´æ”¹çš„ï¼Œç”¨æˆ·å¯ä»¥éšæ„è°ƒæ•´ä»¥é€‚åº”å…¶éœ€æ±‚ã€‚ -aï¼šæ˜¾ç¤ºå½“å‰æ‰€æœ‰èµ„æºçš„é™åˆ¶ï¼ŒåŒ…æ‹¬æ–‡ä»¶æè¿°ç¬¦æ•°é‡ã€å †æ ˆå¤§å°ç­‰ã€‚ -c sizeï¼šè®¾ç½® core æ–‡ä»¶ï¼ˆç¨‹åºå´©æºƒæ—¶ç”Ÿæˆçš„è½¬å‚¨æ–‡ä»¶ï¼‰çš„æœ€å¤§å€¼ï¼Œå•ä½ä¸º blocksã€‚æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶å¯¹äºè°ƒè¯•æ®µé”™è¯¯éå¸¸æœ‰ç”¨ã€‚ -d sizeï¼šè®¾ç½®æ•°æ®æ®µçš„æœ€å¤§å€¼ï¼Œå•ä½ä¸º kbytesã€‚å¦‚æœæ•°æ®æ®µè¶…å‡ºæ­¤é™åˆ¶ï¼Œç¨‹åºå¯èƒ½ä¼šå› å†…å­˜ä¸è¶³è€Œå‘ç”Ÿæ®µé”™è¯¯ã€‚ -f sizeï¼šè®¾ç½®åˆ›å»ºæ–‡ä»¶çš„æœ€å¤§å€¼ï¼Œå•ä½ä¸º blocksã€‚è¿™å¯ä»¥é˜²æ­¢ç¨‹åºç”Ÿæˆè¿‡å¤šæˆ–è¿‡å¤§çš„ä¸´æ—¶æ–‡ä»¶ã€‚ -l sizeï¼šè®¾ç½®å¯ä»¥åœ¨å†…å­˜ä¸­é”å®šè¿›ç¨‹çš„æœ€å¤§å€¼ï¼Œå•ä½ä¸º kbytesã€‚è¿‡é«˜çš„é”å®šå†…å­˜å¯èƒ½ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºã€‚ -m sizeï¼šè®¾ç½®å¯ä»¥ä½¿ç”¨çš„å¸¸é©»å†…å­˜çš„æœ€å¤§å€¼ï¼Œå•ä½ä¸º kbytesã€‚è¿™æœ‰åŠ©äºé™åˆ¶ç¨‹åºçš„å†…å­˜ä½¿ç”¨ã€‚ -n sizeï¼šè®¾ç½®å†…æ ¸å¯ä»¥åŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„æœ€å¤§æ•°é‡ï¼Œå•ä½ä¸º nã€‚å¦‚æœæ­¤é™åˆ¶è¿‡ä½ï¼Œç¨‹åºå¯èƒ½æ— æ³•å¼€å¯æ–°çš„æ–‡ä»¶æˆ–å¥—æ¥å­—ã€‚ -p sizeï¼šè®¾ç½®ç®¡é“ç¼“å†²åŒºçš„æœ€å¤§å€¼ï¼Œå•ä½ä¸º kbytesã€‚ç¼“å†²åŒºé™åˆ¶å¯ä»¥å½±å“è¾“å…¥è¾“å‡ºçš„æ€§èƒ½ã€‚ -s sizeï¼šè®¾ç½®å †æ ˆå¤§å°çš„æœ€å¤§é™åˆ¶ï¼Œå•ä½ä¸º kbytesã€‚è‹¥å †æ ˆå¤§å°ä¸å¤Ÿï¼Œå¯èƒ½ä¼šå¯¼è‡´æ ˆæº¢å‡ºã€‚ -t sizeï¼šè®¾ç½® CPU ä½¿ç”¨æ—¶é—´çš„æœ€å¤§é™åˆ¶ï¼Œå•ä½ä¸º secondsã€‚è¿‡é«˜çš„ä½¿ç”¨æ—¶é—´å¯ä»¥å½±å“ç³»ç»Ÿæ€§èƒ½ã€‚ -v sizeï¼šè®¾ç½®è™šæ‹Ÿå†…å­˜çš„æœ€å¤§å€¼ï¼Œå•ä½ä¸º kbytesã€‚è®¾ç½®è™šæ‹Ÿå†…å­˜çš„é™åˆ¶å¯ä»¥å¸®åŠ©é¿å…å†…å­˜æº¢å‡ºã€‚ -u ç¨‹åºæ•°ç›®ï¼šé™åˆ¶ç”¨æˆ·å¯å¼€å¯çš„ç¨‹åºæœ€å¤§æ•°ç›®ã€‚è¿™ä¸ªé™åˆ¶å–å†³äºç”¨æˆ·çš„æœºå™¨å’Œç‰¹æ€§ã€‚ æŸ¥çœ‹å’Œè®¾ç½®èµ„æºé™åˆ¶è¦æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„èµ„æºé™åˆ¶ï¼Œå¯ä»¥æ‰§è¡Œï¼š ulimit -a è¿™å°†åˆ—å‡ºæ‰€æœ‰ç›¸å…³è®¾ç½®åŠå…¶å½“å‰å€¼ï¼Œæ¯”å¦‚ï¼š core file size (blocks -c) unlimiteddata seg size (kbytes -d) 2097152file size (blocks -f) unlimited... å¦‚æœå¸Œæœ›ç¨‹åºç”Ÿæˆæ ¸å¿ƒæ–‡ä»¶ï¼Œä»è€Œæ–¹ä¾¿åç»­è°ƒè¯•ï¼Œå¯ä»¥è®¾ç½®æ ¸å¿ƒæ–‡ä»¶çš„æœ€å¤§å€¼ä¸ºæ— é™åˆ¶ï¼š ulimit -c unlimited å†æ¬¡æ‰§è¡Œ ulimit -a ç¡®è®¤è®¾ç½®å·²ç»ç”Ÿæ•ˆã€‚ ä½¿ç”¨ GDB è°ƒè¯•ç¨‹åºå½“ç¨‹åºå‘ç”Ÿæ®µé”™è¯¯æ—¶ï¼Œç”Ÿæˆçš„æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶è‡³å…³é‡è¦ã€‚ä½¿ç”¨ gdb å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åˆ†æè¯¥æ–‡ä»¶å¹¶å¯»æ‰¾å¯¼è‡´å´©æºƒçš„åŸå› ã€‚ æ‰“å¼€ gdbé¦–å…ˆï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ‰“å¼€çš„å¯æ‰§è¡Œæ–‡ä»¶å’Œç”Ÿæˆçš„æ ¸å¿ƒæ–‡ä»¶ï¼š gdb xxx core å…¶ä¸­ï¼Œxxx æ˜¯çš„å¯æ‰§è¡Œç¨‹åºçš„åç§°ï¼Œcore æ˜¯ç”Ÿæˆçš„æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ã€‚æˆåŠŸå¯åŠ¨åï¼Œgdb ä¼šåŠ è½½ç›¸å…³ä¿¡æ¯ã€‚ æŸ¥çœ‹æ®µé”™è¯¯è¦æŸ¥çœ‹å¯¼è‡´æ®µé”™è¯¯çš„å…·ä½“ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š bt bt è¡¨ç¤º â€œbacktraceâ€ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šæ˜¾ç¤ºå‡½æ•°è°ƒç”¨æ ˆçš„è¯¦ç»†ä¿¡æ¯ã€‚åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªä¿¡æ¯å¯ä»¥å¸®åŠ©ç¡®å®šå“ªä¸€éƒ¨åˆ†ä»£ç å‡ºé—®é¢˜äº†ã€‚ åˆ—å‡ºå‡ºé”™ä½ç½®ä»£ç å¦‚æœæƒ³æŸ¥çœ‹å‡ºé”™çš„å…·ä½“æºä»£ç ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨ï¼š list è¿™ä¸ªå‘½ä»¤ä¼šæ˜¾ç¤ºå½“å‰æ‰€åœ¨å‡½æ•°çš„æºç ï¼Œå¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜æ‰€åœ¨ã€‚ é€šè¿‡ç»“åˆä½¿ç”¨ ulimit å’Œ gdbï¼Œå°†èƒ½å¤Ÿæ›´æ·±å…¥åœ°äº†è§£å¹¶è§£å†³æ®µé”™è¯¯ï¼Œä½¿çš„ç¨‹åºæ›´åŠ ç¨³å®šå’Œå¯é ã€‚ GDB ç®€æ˜“è°ƒè¯•æ–¹æ³•GDB å¯ä»¥å¯¹ç¨‹åºè¿›è¡Œæ–­ç‚¹è°ƒè¯•ï¼Œå•æ­¥è°ƒè¯•ï¼Œå¦‚æœç”¨ gdb è°ƒè¯•ï¼Œéœ€è¦å¯¹ç¨‹åºé‡æ–°ç¼–è¯‘ï¼Œæ ¼å¼ä¸º: gcc â€“gmain.c â€“o main.out è¿™æ ·ç”Ÿæˆçš„ main.out æ‰èƒ½ç”¨ gdb è°ƒè¯•ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è°ƒè¯•çš„æ—¶å€™ä¸èƒ½åˆ é™¤åŸä»£ç æ–‡ä»¶ï¼Œå³ main.c ï¼Œå¦‚æœå°† main.c åˆ é™¤äº†ï¼Œgdb ä¾ç„¶ä¸æ”¯æŒæ–­ç‚¹ã€å•æ­¥è°ƒè¯•ã€‚ ç”¨ gdb è°ƒè¯•ç¨‹åºæ ¼å¼ï¼š gdb ./main.out æˆ–gdb main.out åˆ—å‡ºå½“å‰è°ƒè¯•ç¨‹åºçš„éƒ¨åˆ†ï¼ˆå‰ 10 è¡Œï¼‰æºä»£ç  list æˆ–è€… l å†æŒ‰ä¸€æ¬¡å›è½¦ï¼ˆé»˜è®¤æ‰§è¡Œä¸Šä¸€æ¬¡å‘½ä»¤ï¼‰ï¼Œç»§ç»­åˆ—å‡ºä¸‹é¢çš„æºä»£ç  å•æ­¥è°ƒè¯•å‘½ä»¤ï¼š start æ‰§è¡Œåæ˜¾ç¤ºï¼šé»˜è®¤æ–­ç‚¹ 1 åœ¨ main()å¤„ï¼Œæ–­ç‚¹å¤„æŒ‡ä»¤ä¸ºï¼š int a=5; æŸ¥çœ‹å†…å­˜ä¸­å˜é‡çš„å€¼ print a ç®€å†™ p a å›è½¦æ˜¾ç¤º a çš„å€¼ å› ä¸º int a=5; æŒ‡ä»¤è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œæ‰€ä»¥ a ä¸ºç¼–è¯‘å™¨ç»™çš„é»˜è®¤å€¼ã€‚ ä¸‹ä¸€æ¡æŒ‡ä»¤ n //n----next æ‰§è¡Œä¸€è¡Œæºä»£ç å¹¶è¿›å…¥å‡½æ•°å†…éƒ¨ s //s----step å½“å‰è¢«è°ƒç”¨å‡½æ•°å°†å®å‚èµ‹äºå½¢å‚ï¼Œå¹¶å®šä½ æŸ¥çœ‹å‡½æ•°å †æ ˆ bt ç¼–å· 0 change å‡½æ•° å®šä½åˆ°ç¬¬ 6 è¡Œ ç¼–å· 1 main å‡½æ•° å®šä½åˆ°ç¬¬ 15 è¡Œ ç¼–å· 0 åœ¨æœ€ä¸Šå±‚ï¼Œæ‰€ä»¥å½“å‰åœ¨ change å‡½æ•°ä¸­ f ç¼–å·å¯ä»¥å®šä½åˆ°å“ªä¸€å±‚å‡½æ•° f(frame)åˆ‡æ¢è°ƒç”¨çš„ä¸Šä¸‹æ–‡ï¼Œè¿›å…¥ç›¸åº”çš„æ ˆé‡Œï¼Œä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥æ‰“å°æ ˆå±‚ç¼–å·ï¼Œå½“å‰çš„å‡½æ•°åï¼Œå‡½æ•°å‚æ•°å€¼ï¼Œå‡½æ•°æ‰€åœ¨çš„æ–‡ä»¶åŠè¡Œå·ï¼Œå‡½æ•°æ‰§è¡Œåˆ°çš„è¯­å¥ç­‰ç­‰ï¼› f 1 è¿›å…¥åˆ°ç¼–å· 1 çš„å‡½æ•°ä¸­ï¼Œå³ main å‡½æ•° å¹¶å®šä½åˆ° 15 è¡Œçš„é‚£æ¡è¯­å¥ q é€€å‡ºè°ƒè¯• å¸¸ç”¨çš„ GDB æŒ‡ä»¤å¸¸è§æ–­ç‚¹è®¾ç½®ä¸åˆ é™¤å‘½ä»¤ å‘½ä»¤æ ¼å¼ ä½œç”¨ break + è®¾ç½®æ–­ç‚¹çš„è¡Œå· ç”¨äºåœ¨ç¨‹åºä¸­å¯¹åº”è¡Œè®¾ç½®æ–­ç‚¹ tbreak + è¡Œå·æˆ–å‡½æ•°å è®¾ç½®ä¸´æ—¶æ–­ç‚¹ï¼Œåˆ°è¾¾åè¢«è‡ªåŠ¨æ¸…é™¤ break + filename + è¡Œå· ç”¨äºåœ¨æŒ‡å®šæ–‡ä»¶çš„å¯¹åº”è¡Œè®¾ç½®æ–­ç‚¹ break + 0xâ€¦ ç”¨äºåœ¨å†…å­˜æŸä¸€ä½ç½®å¤„æš‚åœ break + è¡Œå· + if + æ¡ä»¶ ç”¨äºè®¾ç½®æ¡ä»¶æ–­ç‚¹ï¼Œåœ¨å¾ªç¯ä¸­ä½¿ç”¨éå¸¸æ–¹ä¾¿ info breakpoints/watchpoints æŸ¥çœ‹æ–­ç‚¹ã€è§‚å¯Ÿç‚¹çš„æƒ…å†µ clear + è¦æ¸…é™¤æ–­ç‚¹çš„è¡Œå· ç”¨äºæ¸…é™¤å¯¹åº”è¡Œçš„æ–­ç‚¹ delete + è¦æ¸…é™¤æ–­ç‚¹çš„ç¼–å· æ¸…é™¤æ–­ç‚¹å’Œè‡ªåŠ¨æ˜¾ç¤ºçš„è¡¨è¾¾å¼ï¼ˆåŒºåˆ«ï¼šclear æç¤ºè¡Œå·ï¼Œdelete æç¤ºç¼–å·ï¼‰ disable + æ–­ç‚¹ç¼–å· è®©æ‰€æœ‰æ–­ç‚¹æš‚æ—¶å¤±æ•ˆï¼ˆå¤šä¸ªç¼–å·å¯ç”¨ç©ºæ ¼åˆ†éš”ï¼‰ enable + æ–­ç‚¹ç¼–å· ä¸ disable ç›¸åï¼Œä½¿æ–­ç‚¹é‡æ–°ç”Ÿæ•ˆ awatch + å˜é‡ è®¾ç½®è§‚å¯Ÿç‚¹ï¼Œå˜é‡è¢«è¯»æˆ–å†™æ—¶ç¨‹åºæš‚åœ rwatch + å˜é‡ è®¾ç½®è§‚å¯Ÿç‚¹ï¼Œå˜é‡è¢«è¯»æ—¶ç¨‹åºæš‚åœ watch + å˜é‡ åŒ awatch æ•°æ®ç›¸å…³å‘½ä»¤ å‘½ä»¤æ ¼å¼ ä½œç”¨ display + è¡¨è¾¾å¼ æ˜¾ç¤ºè¡¨è¾¾å¼çš„å€¼ï¼ˆç¨‹åºåˆ°æ–­ç‚¹æ—¶è‡ªåŠ¨æ˜¾ç¤ºï¼‰ info display æ˜¾ç¤ºå½“å‰æ‰€æœ‰éœ€è¦æ˜¾ç¤ºçš„è¡¨è¾¾å¼æƒ…å†µ delete + display ç¼–å· åˆ é™¤æŸä¸ªè¦æ˜¾ç¤ºçš„è¡¨è¾¾å¼ disable + display ç¼–å· ä½¿æŸä¸ªè¦æ˜¾ç¤ºçš„è¡¨è¾¾å¼æš‚æ—¶æ— æ•ˆ enable + display ç¼–å· æ¢å¤ disable display å‘½ä»¤å¤±æ•ˆçš„è¡¨è¾¾å¼ undisplay + display ç¼–å· ç»“æŸæŸä¸ªè¡¨è¾¾å¼å€¼çš„æ˜¾ç¤º whatis + ç¼–å· æŸ¥çœ‹æŸä¸ªè¡¨è¾¾å¼çš„æ•°æ®ç±»å‹ printï¼ˆpï¼‰+ å˜é‡æˆ–è¡¨è¾¾å¼ æ‰“å°å˜é‡æˆ–è¡¨è¾¾å¼çš„å€¼ set + å˜é‡ = å˜é‡å€¼ æ”¹å˜ç¨‹åºä¸­æŸä¸ªå˜é‡çš„å€¼ è¿è¡Œç¯å¢ƒç›¸å…³å‘½ä»¤ å‘½ä»¤æ ¼å¼ ä½œç”¨ set args è®¾ç½®è¿è¡Œå‚æ•° show args æ˜¾ç¤ºè¿è¡Œå‚æ•° set width + æ•°ç›® è®¾ç½® GDB çš„è¡Œå®½ cd + å·¥ä½œç›®å½• åˆ‡æ¢å·¥ä½œç›®å½• run ç¨‹åºå¼€å§‹æ‰§è¡Œ stepï¼ˆsï¼‰ è¿›å…¥å¼å•æ­¥æ‰§è¡Œï¼ˆè¿›å…¥å­å‡½æ•°ï¼‰ nextï¼ˆnï¼‰ éè¿›å…¥å¼å•æ­¥æ‰§è¡Œï¼ˆä¸è¿›å…¥å­å‡½æ•°ï¼‰ finish ä¸€ç›´è¿è¡Œåˆ°å‡½æ•°è¿”å› until + è¡Œæ•° è¿è¡Œåˆ°æŒ‡å®šè¡Œå· continueï¼ˆcï¼‰ æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹æˆ–ç¨‹åºç»“æŸ return è¿”å›å€¼ æ”¹å˜ç¨‹åºæµç¨‹ï¼Œç»“æŸå½“å‰å‡½æ•°å¹¶è¿”å›æŒ‡å®šå€¼ call + å‡½æ•° åœ¨å½“å‰ä½ç½®æ‰§è¡ŒæŒ‡å®šçš„å‡½æ•° å †æ ˆç›¸å…³å‘½ä»¤ å‘½ä»¤æ ¼å¼ ä½œç”¨ back æˆ– bt æ‰“å°æ ˆå¸§æŒ‡é’ˆï¼ˆå¯æŒ‡å®šè¦æ‰“å°çš„ä¸ªæ•°ï¼‰ frame æ‰“å°æ ˆå¸§ info reg æŸ¥çœ‹å¯„å­˜å™¨ä½¿ç”¨æƒ…å†µ info stack æŸ¥çœ‹å †æ ˆæƒ…å†µ up è·³åˆ°ä¸Šä¸€å±‚å‡½æ•° down è·³åˆ°ä¸‹ä¸€å±‚å‡½æ•°ï¼ˆä¸ up ç›¸å¯¹ï¼‰","categories":["6.å¼€å‘å·¥å…·","è°ƒè¯•"]},{"title":"ä»£ç æ—¥å¿—è¾“å‡º","path":"/2024/01/12/6-å¼€å‘å·¥å…·-è°ƒè¯•-ä»£ç æ—¥å¿—è¾“å‡º/","content":"å®å®šä¹‰é€šè¿‡ä¸€ä¸ªå®å®šä¹‰æŠŠè¦æ‰“å°çš„ä¿¡æ¯å†™åˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œä¸ä»…å¯ä»¥è®°å½•ç¨‹åºæ¯æ¬¡è¿è¡Œçš„çŠ¶æ€ä¾¿äº debugï¼Œè€Œä¸”åœ¨å‘å¸ƒæ—¶åªéœ€è¦æ³¨é‡Šæ‰å®å®šä¹‰è€Œä¸å¿…åˆ é™¤æ¯ä¸€ä¸ªä½¿ç”¨è¯¥å®çš„åœ°æ–¹ï¼Œä¸ä¼šå‡ºç°å› åˆ é™¤ä»£ç è€Œå‡ºç°çš„é”™è¯¯ã€‚ å®è¿˜å¯ä»¥åŠ ä¸€ä¸ªå‚æ•°ä¼ å…¥æ–‡ä»¶çš„è·¯å¾„ï¼Œå°±å¯ä»¥è‡ªå®šä¹‰æ—¥å¿—æ–‡ä»¶çš„ä½ç½®ã€‚ #define TRACEOUT(p) \\ \\time_t timeval; \\timeval=time(NULL); \\FILE *log; \\log = fopen(log.txt,a);\\fprintf(log,%s -- %s ,p,ctime(timeval));\\fclose(log); \\#define LOG_DBG(fmt,...) \\do \\fprintf(stdout,[DEBUG] %s:%d - fmt , \\__FILE__,__LINE__, ##__VA_ARGS__); \\ while(0)#define LOG_ERR(fmt,...) \\do \\fprintf(stderr,[ERROR] %s:%d - fmt , \\__FILE__,__LINE__, ##__VA_ARGS__); \\ while(0)int main()\tTRACEOUT(hello);\tLOG_DBG(hello);\tLOG_ERR(hello);\treturn 0; å‡½æ•°#include stdarg.h#include stdio.h#include time.h#define LOG_FILE ./a.log#define LOG_DEFAULT( fmt, ... ) log_out( LOG_FILE, __FILE__, __LINE__, fmt, ##__VA_ARGS__)#define LOG_TOXFILE( flog, fmt, ... ) log_out( flog, __FILE__, __LINE__, fmt, ##__VA_ARGS__) int log_out(char* flog, char *file, int line, char* fmt, ...) va_list arg; char pre[128], tmp[1024]; long clock; struct tm *c_ptr; FILE *fp; time( clock ); c_ptr = localtime(clock); sprintf( pre, [%04d%02d%02d%02d%02d%02d_%s.%d], c_ptr-tm_year+1900, c_ptr-tm_mon+1, c_ptr-tm_mday, c_ptr-tm_hour, c_ptr-tm_min, c_ptr-tm_sec, file, line ); va_start(arg, fmt); vsprintf(tmp, fmt, arg); va_end (arg); //log to stdout if( !flog ) printf( %-32.32s %s, pre, tmp ); return 0; //log to file if( !(fp = fopen( flog, at ) ) ) return -1; fprintf( fp, %-32.32s %s, pre, tmp ); fclose( fp ); return 0; è°ƒç”¨æ–¹æ³•ï¼š LOG_DEFAULT æ—¥å¿—è¾“å‡ºåˆ°é»˜è®¤çš„æ—¥å¿—æ–‡ä»¶ LOG_TOXFILE æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶ï¼Œå‚æ•°æ˜¯ 0ï¼Œåˆ™æ—¥å¿—æ‰“å°åˆ°æ ‡å‡†è¾“å‡º","categories":["6.å¼€å‘å·¥å…·","è°ƒè¯•"]},{"title":"ä»£ç æ³¨é‡Š","path":"/2024/01/11/6-å¼€å‘å·¥å…·-è°ƒè¯•-ä»£ç æ³¨é‡Š/","content":"æ³¨é‡Šéƒ¨åˆ†å‡½æ•°éƒ¨åˆ† function/*************************************************Function: // å‡½æ•°åç§°Description: // å‡½æ•°åŠŸèƒ½ã€æ€§èƒ½ç­‰çš„æè¿°Calls: // è¢«æœ¬å‡½æ•°è°ƒç”¨çš„å‡½æ•°æ¸…å•Called By: // è°ƒç”¨æœ¬å‡½æ•°çš„å‡½æ•°æ¸…å•Table Accessed: // è¢«è®¿é—®çš„è¡¨ï¼ˆæ­¤é¡¹ä»…å¯¹äºç‰µæ‰¯åˆ°æ•°æ®åº“æ“ä½œçš„ç¨‹åºï¼‰Table Updated: // è¢«ä¿®æ”¹çš„è¡¨ï¼ˆæ­¤é¡¹ä»…å¯¹äºç‰µæ‰¯åˆ°æ•°æ®åº“æ“ä½œçš„ç¨‹åºï¼‰Input: // è¾“å…¥å‚æ•°è¯´æ˜ï¼ŒåŒ…æ‹¬æ¯ä¸ªå‚æ•°çš„ä½œ// ç”¨ã€å–å€¼è¯´æ˜åŠå‚æ•°é—´å…³ç³»ã€‚Output: // å¯¹è¾“å‡ºå‚æ•°çš„è¯´æ˜ã€‚Return: // å‡½æ•°è¿”å›å€¼çš„è¯´æ˜Others: // å…¶å®ƒè¯´æ˜*************************************************/ å…¨å±€å˜é‡ global variable/* The ErrorCode when SCCP translate *//* Global Title failure, as follows */ // å˜é‡ä½œç”¨ã€å«ä¹‰/* 0 ï¼ SUCCESS 1 ï¼ GT Table error *//* 2 ï¼ GT error Others ï¼ no use */ // å˜é‡å–å€¼èŒƒå›´/* only function SCCPTranslate() in *//* this modual can modify it, and other *//* module can visit it through call *//* the function GetGTTransErrorCode() */ // ä½¿ç”¨æ–¹æ³• å¤´æ–‡ä»¶ .h/************************************************************Copyright (C), 1988-1999, Huawei Tech. Co., Ltd.FileName: test.cppAuthor: Version : Date:Description: // æ¨¡å—æè¿°Version: // ç‰ˆæœ¬ä¿¡æ¯Function List: // ä¸»è¦å‡½æ•°åŠå…¶åŠŸèƒ½1. -------History: // å†å²ä¿®æ”¹è®°å½•author time version descDavid 96/10/12 1.0 build this moudle***********************************************************/ é…ç½®æ–‡ä»¶ .cfg/*************************************************Copyright (C), 1988-1999, Huawei Tech. Co., Ltd.File name: // æ–‡ä»¶åAuthor: Version: Date: // ä½œè€…ã€ç‰ˆæœ¬åŠå®Œæˆæ—¥æœŸDescription: // ç”¨äºè¯¦ç»†è¯´æ˜æ­¤ç¨‹åºæ–‡ä»¶å®Œæˆçš„ä¸»è¦åŠŸèƒ½ï¼Œä¸å…¶ä»–æ¨¡å—// æˆ–å‡½æ•°çš„æ¥å£ï¼Œè¾“å‡ºå€¼ã€å–å€¼èŒƒå›´ã€å«ä¹‰åŠå‚æ•°é—´çš„æ§// åˆ¶ã€é¡ºåºã€ç‹¬ç«‹æˆ–ä¾èµ–ç­‰å…³ç³»Others: // å…¶å®ƒå†…å®¹çš„è¯´æ˜Function List: // ä¸»è¦å‡½æ•°åˆ—è¡¨ï¼Œæ¯æ¡è®°å½•åº”åŒ…æ‹¬å‡½æ•°ååŠåŠŸèƒ½ç®€è¦è¯´æ˜1. ....History: // ä¿®æ”¹å†å²è®°å½•åˆ—è¡¨ï¼Œæ¯æ¡ä¿®æ”¹è®°å½•åº”åŒ…æ‹¬ä¿®æ”¹æ—¥æœŸã€ä¿®æ”¹// è€…åŠä¿®æ”¹å†…å®¹ç®€è¿°1. Date:Author:Modification:2. ...*************************************************/ DoxygenDoxygen æ˜¯ä¸€ä¸ªç¨‹åºçš„æ–‡ä»¶äº§ç”Ÿå·¥å…·ï¼Œå¯å°†ç¨‹åºä¸­çš„ç‰¹å®šæ‰¹æ³¨è½¬æ¢æˆä¸ºè¯´æ˜æ–‡ä»¶ã€‚é€šå¸¸åœ¨å†™ç¨‹åºæ—¶ï¼Œæˆ–å¤šæˆ–å°‘éƒ½ä¼šå†™ä¸Šæ‰¹æ³¨ï¼Œä½†æ˜¯å¯¹äºå…¶å®ƒäººè€Œè¨€ï¼Œè¦ç›´æ¥æ¢ç´¢ç¨‹åºé‡Œçš„æ‰¹æ³¨ï¼Œä¸æ‰“æé“è¾¾å°¼å·åŒæ ·çš„è¾›è‹¦ã€‚å¤§éƒ¨åˆ†æœ‰ç”¨çš„æ‰¹æ³¨éƒ½æ˜¯å±äºé’ˆå¯¹å‡½å¼ï¼Œç±»åˆ«ç­‰ç­‰çš„è¯´æ˜ã€‚æ‰€ä»¥ï¼Œå¦‚æœèƒ½ä¾æ®ç¨‹åºæœ¬èº«çš„ç»“æ„ï¼Œå°†æ‰¹æ³¨ç»è¿‡å¤„ç†é‡æ–°æ•´ç†æˆä¸ºä¸€ä¸ªçº¯ç²¹çš„å‚è€ƒæ‰‹å†Œï¼Œå¯¹äºåé¢åˆ©ç”¨çš„ç¨‹åºä»£ç çš„äººè€Œè¨€å°†ä¼šå‡å°‘è®¸å¤šçš„è´Ÿæ‹…ã€‚ä¸è¿‡ï¼Œåè¿‡æ¥è¯´ï¼Œæ•´ç†æ–‡ä»¶çš„å·¥ä½œå¯¹äºæ¥è¯´ï¼Œå°±æ˜¯æ²‰é‡çš„è´Ÿæ‹…ã€‚ Doxygen å°±æ˜¯åœ¨å†™æ‰¹æ³¨æ—¶ï¼Œç¨å¾®æŒ‰ç…§ä¸€äº›å®ƒæ‰€åˆ¶è®¢çš„è§„åˆ™ã€‚æ¥ç€ï¼Œä»–å°±å¯ä»¥å¸®äº§ç”Ÿå‡ºæ¼‚äº®çš„æ–‡æ¡£äº†ã€‚ å› æ­¤ï¼ŒDoxygen çš„ä½¿ç”¨å¯åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†: ç‰¹å®šæ ¼å¼çš„æ‰¹æ³¨æ’°å†™ åˆ©ç”¨ Doxygen çš„å·¥å…·æ¥äº§ç”Ÿæ–‡æ¡£ ç›®å‰ Doxygen å¯å¤„ç†çš„ç¨‹åºè¯­è¨€åŒ…å«ï¼š CC++ Java IDL (Corba, Microsoft åŠ KDE-DCOP ç±»å‹) è€Œå¯äº§ç”Ÿå‡ºæ¥çš„æ–‡æ¡£æ ¼å¼æœ‰ï¼š HTML XML LaTeX RTF Unix Man Pageè€Œå…¶ä¸­è¿˜å¯è¡ç”Ÿå‡ºä¸å°‘å…¶å®ƒæ ¼å¼ã€‚HTML å¯ä»¥æ‰“åŒ…æˆ CHM æ ¼å¼ï¼Œè€Œ LaTeX å¯ä»¥é€è¿‡ä¸€äº›å·¥å…·äº§ç”Ÿå‡º PS æˆ–æ˜¯ PDF æ–‡æ¡£ã€‚ å®‰è£… å®‰è£… Doxygen å®‰è£… graphviz graphviz æ˜¯ä¸€ä¸ªç”± ATT å®éªŒå®¤å¯åŠ¨çš„å¼€æºå·¥å…·åŒ…ï¼Œç”¨äºç»˜åˆ¶ DOT è¯­è¨€è„šæœ¬æè¿°çš„å›¾å½¢ã€‚Doxygen ä½¿ç”¨ graphviz è‡ªåŠ¨ç”Ÿæˆç±»ä¹‹é—´å’Œæ–‡ä»¶ä¹‹é—´çš„è°ƒç”¨å…³ç³»å›¾ï¼Œå¦‚ä¸éœ€è¦æ­¤åŠŸèƒ½å¯ä¸å®‰è£…è¯¥å·¥å…·åŒ…ã€‚ å®‰è£… Windows Help Workshop Doxygen ä½¿ç”¨è¿™ä¸ªå·¥å…·å¯ä»¥ç”Ÿæˆ CHM æ ¼å¼çš„æ–‡æ¡£ã€‚ é…ç½®Doxygen äº§ç”Ÿæ–‡æ¡£å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ã€‚ åœ¨ç¨‹åºä»£ç ä¸­åŠ ä¸Šç¬¦åˆ Doxygen æ‰€å®šä¹‰æ‰¹æ³¨æ ¼å¼ ä½¿ç”¨ Doxywizard è¿›è¡Œé…ç½® ä½¿ç”¨ Doxygen æ¥äº§ç”Ÿæ‰¹æ³¨æ–‡æ¡£ æ’°å†™æ­£ç¡®æ ¼å¼çš„æ‰¹æ³¨å¹¶éæ‰€æœ‰ç¨‹åºä»£ç ä¸­çš„æ‰¹æ³¨éƒ½ä¼šè¢« Doxygen æ‰€å¤„ç†ã€‚å¿…éœ€ä¾ç…§æ­£ç¡®çš„æ ¼å¼æ’°å†™ã€‚åŸåˆ™ä¸Šï¼ŒDoxygen ä»…å¤„ç†ä¸ç¨‹åºç»“æ„ç›¸å…³çš„æ‰¹æ³¨ï¼Œå¦‚ Functionï¼ŒClass ï¼Œæ¡£æ¡ˆçš„æ‰¹æ³¨ç­‰ã€‚å¯¹äº Function å†…éƒ¨çš„æ‰¹æ³¨åˆ™ä¸åšå¤„ç†ã€‚Doxygen å¯å¤„ç†ä¸‹é¢å‡ ç§ç±»å‹çš„æ‰¹æ³¨ã€‚ JavaDoc ç±»å‹ï¼š /*** ... æ‰¹æ³¨ ...*/ Qt ç±»å‹ï¼š /*!* ... æ‰¹æ³¨ ...*/ å•è¡Œå‹å¼çš„æ‰¹æ³¨ï¼š /// ... æ‰¹æ³¨ ... æˆ– //! ... æ‰¹æ³¨ ... è¦ä½¿ç”¨å“ªç§å‹æ€å®Œå…¨çœ‹è‡ªå·±çš„å–œå¥½ã€‚ä»¥ç¬”è€…è‡ªå·±æ¥è¯´ï¼Œå¤§èŒƒå›´çš„æ³¨è§£ä¼šä½¿ç”¨ JavaDoc å‹çš„ã€‚å•è¡Œçš„æ‰¹æ³¨åˆ™ä½¿ç”¨â€â€œ çš„ç±»å‹ã€‚æ­¤å¤–ï¼Œç”±äº Doxygen å¯¹äºæ‰¹æ³¨æ˜¯è§†ä¸ºåœ¨è§£é‡Šåé¢çš„ç¨‹åºä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»»ä½•ä¸€ä¸ªæ‰¹æ³¨éƒ½æ˜¯åœ¨è¯´æ˜å…¶åçš„ç¨‹åºä»£ç ã€‚å¦‚æœè¦æ‰¹æ³¨å‰é¢çš„ç¨‹å¼ç åˆ™éœ€ç”¨ä¸‹é¢æ ¼å¼çš„æ‰¹æ³¨ç¬¦å·ã€‚ /*! ... æ‰¹æ³¨ ... *//** ... æ‰¹æ³¨ ... *///! ... æ‰¹æ³¨ .../// ... æ‰¹æ³¨ ... ä¸Šé¢è¿™ä¸ªæ–¹å¼å¹¶ä¸é€‚ç”¨äºä»»ä½•åœ°æ–¹ï¼Œåªèƒ½ç”¨åœ¨ class çš„ member æˆ–æ˜¯ function çš„å‚æ•°ä¸Šã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œè‹¥æœ‰ä¸‹é¢è¿™æ ·çš„ classã€‚ class MyClass public: int member1 ; int member2: void member_function();; åŠ ä¸Šæ‰¹æ³¨åï¼Œå°±å˜æˆè¿™æ ·ï¼š /*** çš„è‡ªè®¢ç±»åˆ«è¯´æ˜ ...*/class MyClass public: int member1 ; /// ç¬¬ä¸€ä¸ª member è¯´æ˜ ... int member2: /// ç¬¬äºŒä¸ª member è¯´æ˜ ... int member_function(int a, int b);;/*** è‡ªè®¢ç±»åˆ«çš„ member_funtion è¯´æ˜ ...** @param a å‚æ•° a çš„è¯´æ˜* @param b å‚æ•° b çš„è¯´æ˜** @return ä¼ å› a+bã€‚*/int MyClass::member_function( int a, int b )\treturn a+b ; å½“ä½¿ç”¨ Doxygen äº§ç”Ÿè¯´æ˜æ–‡æ¡£æ—¶ï¼ŒDoxygen ä¼šå¸® parsing çš„ç¨‹å¼ç ã€‚å¹¶ä¸”ä¾æ®ç¨‹åºç»“æ„å»ºç«‹å¯¹åº”çš„æ–‡ä»¶ã€‚ç„¶åå†å°†çš„æ‰¹æ³¨ï¼Œä¾æ®å…¶ä½ç½®å¥—å…¥äºæ­£ç¡®çš„åœ°æ–¹ã€‚å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œé™¤äº†ä¸€èˆ¬æ–‡å­—è¯´æ˜å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶å®ƒç‰¹åˆ«çš„æŒ‡ä»¤ï¼Œåƒæ˜¯@param åŠ@return ç­‰ã€‚è¿™æ­£æ˜¯ Doxygen å¦å¤–ä¸€ä¸ªé‡è¦çš„éƒ¨åˆ†ï¼Œå› ä¸ºä¸€ä¸ªç±»åˆ«æˆ–æ˜¯å‡½å¼å…¶å®éƒ½æœ‰å›ºå®šå‡ ä¸ªè¦è¯´æ˜çš„éƒ¨åˆ†ã€‚ä¸ºäº†è®© Doxygen èƒ½å¤Ÿåˆ¤æ–­ï¼Œæ‰€æœ‰å°±å¿…éœ€ä½¿ç”¨è¿™äº›æŒ‡ä»¤ï¼Œæ¥å‘Šè¯‰ Doxygen åé¢çš„æ‰¹æ³¨æ˜¯åœ¨è¯´æ˜ä»€ä¹ˆä¸œè¥¿ã€‚Doxygen åœ¨å¤„ç†æ—¶ï¼Œå°±ä¼šå¸®æŠŠè¿™äº›éƒ¨åˆ†åšç‰¹åˆ«çš„å¤„ç†æˆ–æ˜¯æ’ç‰ˆã€‚ç”šè‡³æ˜¯åˆ¶ä½œå‚è€ƒè¿ç»“ã€‚ é¦–å…ˆï¼Œå…ˆè¯´æ˜åœ¨ Doxygen ä¸­å¯¹äºç±»åˆ«æˆ–æ˜¯å‡½æ•°æ‰¹æ³¨çš„ä¸€ä¸ªç‰¹å®šæ ¼å¼ã€‚ /*** class æˆ– function çš„ç®€æ˜“è¯´æ˜...** class æˆ– function çš„è¯¦ç»†è¯´æ˜...* ...*/ ä¸Šé¢è¿™ä¸ªä¾‹å­è¦è¯´çš„æ˜¯ï¼Œåœ¨ Doxygen å¤„ç†ä¸€ä¸ª class æˆ–æ˜¯ function æ³¨è§£æ—¶ï¼Œä¼šå…ˆåˆ¤æ–­ç¬¬ä¸€è¡Œä¸ºç®€æ˜“è¯´æ˜ã€‚è¿™ä¸ªç®€æ˜“è¯´æ˜å°†ä¸€ç›´åˆ°ç©ºä¸€è¡Œçš„å‡ºç°ã€‚æˆ–æ˜¯é‡åˆ°ç¬¬ä¸€ä¸ªâ€.â€ ä¸ºæ­¢ã€‚ä¹‹åçš„æ‰¹æ³¨å°†ä¼šè¢«è§†ä¸ºè¯¦ç»†è¯´æ˜ã€‚ä¸¤è€…çš„å·®å¼‚åœ¨äº Doxygen åœ¨æŸäº›åœ°æ–¹åªä¼šæ˜¾ç¤ºç®€æ˜“è¯´æ˜ï¼Œè€Œä¸æ˜¾ç¤ºè¯¦ç»†è¯´æ˜ã€‚å¦‚ï¼šclass æˆ– function çš„åˆ—è¡¨ã€‚ å¦ä¸€ç§æ¯”è¾ƒæ¸…æ¥šçš„æ–¹å¼æ˜¯æŒ‡å®š@brief çš„æŒ‡ä»¤ã€‚è¿™å°†ä¼šæ˜ç¡®çš„å‘Šè¯‰ Doxygenï¼Œä½•è€…æ˜¯ç®€æ˜“è¯´æ˜ã€‚ä¾‹å¦‚ï¼š /*** @brief class æˆ– function çš„ç®€æ˜“è¯´æ˜...** class æˆ– function çš„è¯¦ç»†è¯´æ˜...* ...*/ é™¤äº†è¿™ä¸ª class åŠ function å¤–ï¼ŒDoxygen ä¹Ÿå¯é’ˆå¯¹æ¡£æ¡ˆåšè¯´æ˜ï¼Œæ¡ä»¶æ˜¯è¯¥æ‰¹æ³¨éœ€ç½®äºæ¡£æ¡ˆçš„å‰é¢ã€‚ä¸»è¦ä¹Ÿæ˜¯åˆ©ç”¨ä¸€äº›æŒ‡ä»¤ï¼Œé€šå¸¸è¿™éƒ¨åˆ†æ³¨è§£éƒ½ä¼šæ”¾åœ¨æ¡£æ¡ˆçš„å¼€å§‹åœ°æ–¹ã€‚å¦‚ï¼š /*! \\file myfile.h\\brief æ¡£æ¡ˆç®€æ˜“è¯´æ˜è¯¦ç»†è¯´æ˜.\\author ä½œè€…ä¿¡æ¯*/ å¦‚æ‰€è§ï¼Œæ¡£æ¡ˆæ‰¹æ³¨çº¦ç•¥æ ¼å¼å¦‚ä¸Šï¼Œè¯·åˆ«è¢« \\ æ‰€ææ··ã€‚å…¶å®ï¼Œ\\ ä¸â€@â€ éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å‘Šè¯‰ Doxygen åé¢æ˜¯ä¸€ä¸ªæŒ‡ä»¤ã€‚ä¸¤ç§åœ¨ Doxygen éƒ½å¯ä½¿ç”¨ã€‚ç¬”è€…è‡ªå·±æ¯”è¾ƒåå¥½ä½¿ç”¨â€@â€ã€‚ æ¥ç€æ¥é’ˆå¯¹ä¸€äº›å¸¸ç”¨çš„æŒ‡ä»¤åšè¯´æ˜ï¼š@file æ¡£æ¡ˆçš„æ‰¹æ³¨è¯´æ˜ã€‚Doxygen æ‰€æ”¯æŒçš„æŒ‡ä»¤å¾ˆå¤šï¼Œæœ‰äº›ç”šè‡³æ˜¯å…³äºè¾“å‡ºæ’ç‰ˆçš„æ§åˆ¶ã€‚å¯ä» Doxygen çš„ä½¿ç”¨è¯´æ˜ä¸­æ‰¾åˆ°è¯¦å°½çš„è¯´æ˜ã€‚ ä¸‹é¢å‡†å¤‡ä¸€ç»„ example.h åŠ example.cpp æ¥è¯´æ˜ Doxygen æ‰¹æ³¨çš„ä½¿ç”¨æ–¹å¼ï¼šexample.h: @author ä½œè€…çš„ä¿¡æ¯ @brief ç”¨äº class æˆ– function çš„æ‰¹æ³¨ä¸­ï¼Œåé¢ä¸º class æˆ– function çš„ç®€æ˜“è¯´æ˜ã€‚ @param æ ¼å¼ä¸º @param arg_name å‚æ•°è¯´æ˜,ä¸»è¦ç”¨äºå‡½å¼è¯´æ˜ä¸­ï¼Œåé¢æ¥å‚æ•°çš„åå­—ï¼Œç„¶åå†æ¥å…³äºè¯¥å‚æ•°çš„è¯´æ˜ã€‚ @return åé¢æ¥å‡½æ•°ä¼ å›å€¼çš„è¯´æ˜ã€‚ç”¨äº function çš„æ‰¹æ³¨ä¸­ã€‚è¯´æ˜è¯¥å‡½æ•°çš„ä¼ å›å€¼ã€‚ @retval æ ¼å¼ä¸º @retval value ä¼ å›å€¼è¯´æ˜,ä¸»è¦ç”¨äºå‡½å¼è¯´æ˜ä¸­ï¼Œè¯´æ˜ç‰¹å®šä¼ å›å€¼çš„æ„ä¹‰ã€‚æ‰€ä»¥åé¢è¦å…ˆæ¥ä¸€ä¸ªä¼ å›å€¼ã€‚ç„¶ååœ¨æ”¾è¯¥ä¼ å›å€¼çš„è¯´æ˜ã€‚ /*** @file æœ¬èŒƒä¾‹çš„ include æ¡£æ¡ˆã€‚** è¿™ä¸ªæ¡£æ¡ˆåªå®šä¹‰ example è¿™ä¸ª classã€‚** @author garylee@localhost*/#define EXAMPLE_OK 0 /// å®šä¹‰ EXAMPLE_OK çš„å®ä¸º 0ã€‚/*** @brief Example class çš„ç®€æ˜“è¯´æ˜** æœ¬èŒƒä¾‹è¯´æ˜ Example classã€‚* è¿™æ˜¯ä¸€ä¸ªæä¸ºç®€å•çš„èŒƒä¾‹ã€‚**/class Example private: int var1 ; /// è¿™æ˜¯ä¸€ä¸ª private çš„å˜æ•°\tpublic: int var2 ; /// è¿™æ˜¯ä¸€ä¸ª public çš„å˜æ•°æˆå‘˜ã€‚ int var3 ; /// è¿™æ˜¯å¦ä¸€ä¸ª public çš„å˜æ•°æˆå‘˜ã€‚ void ExFunc1(void); int ExFunc2(int a, char b); char *ExFunc3(char *c) ;; example.cpp: /*** @file æœ¬èŒƒä¾‹çš„ç¨‹åºä»£ç æ¡£æ¡ˆã€‚** è¿™ä¸ªæ¡£æ¡ˆç”¨æ¥å®šä¹‰ example è¿™ä¸ª class çš„* member functionã€‚** @author garylee@localhost*//*** @brief ExFunc1 çš„ç®€æ˜“è¯´æ˜** ExFunc1 æ²¡æœ‰ä»»ä½•å‚æ•°åŠä¼ å›å€¼ã€‚*/void Example::ExFunc1(void)\t// empty funcion./*** @brief ExFunc2 çš„ç®€æ˜“è¯´æ˜** ExFunc3()ä¼ å›ä¸¤ä¸ªå‚æ•°ç›¸åŠ çš„å€¼ã€‚** @param a ç”¨æ¥ç›¸åŠ çš„å‚æ•°ã€‚* @param b ç”¨æ¥ç›¸åŠ çš„å‚æ•°ã€‚* @return ä¼ å›ä¸¤ä¸ªå‚æ•°ç›¸åŠ çš„ç»“æœã€‚*/int ExFunc2(int a, char b)\treturn (a+b);/*** @brief ExFunc3 çš„ç®€æ˜“è¯´æ˜** ExFunc3()åªä¼ å›å‚æ•°è¾“å…¥çš„æŒ‡æ ‡ã€‚** @param c ä¼ è¿›çš„å­—ç¬¦æŒ‡é’ˆã€‚* @retval NULL ç©ºå­—ç¬¦ä¸²ã€‚* @retval !NULL éç©ºå­—ç¬¦ä¸²ã€‚*/char * ExFunc2(char * c)\treturn c;","categories":["6.å¼€å‘å·¥å…·","è°ƒè¯•"]},{"title":"ä½¿ç”¨Valgrindå‘ç°å†…å­˜æ³„éœ²","path":"/2024/01/10/6-å¼€å‘å·¥å…·-è°ƒè¯•-ä½¿ç”¨Valgrindå‘ç°å†…å­˜æ³„éœ²/","content":"Valgrind ç®€ä»‹Valgrind æ˜¯ä¸€æ¬¾å¼ºå¤§çš„å†…å­˜è°ƒè¯•å·¥å…·ï¼Œå¯åœ¨ Linux ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œå…¼å®¹å¤šç§æ¶æ„ï¼ŒåŒ…æ‹¬ x86ã€x86_64 å’Œ ppc32ã€‚å®ƒä¸“é—¨è®¾è®¡ç”¨äºå¯¹ç¼–è¯‘åçš„äºŒè¿›åˆ¶ç¨‹åºè¿›è¡Œå†…å­˜ç›‘æµ‹ï¼Œä¸»è¦å…³æ³¨ C å’Œ C++ ç¨‹åºä¸­çš„åŠ¨æ€å†…å­˜ç®¡ç†ï¼Œæ¯”å¦‚ C è¯­è¨€ä¸­çš„ malloc å’Œ freeï¼Œä»¥åŠ C++ ä¸­çš„ new å’Œ deleteã€‚è¿™æ¬¾å·¥å…·çš„æœ€å¤§ä¼˜åŠ¿åœ¨äºå®ƒèƒ½å¤Ÿæœ‰æ•ˆè¯†åˆ«å’Œå®šä½å†…å­˜æ³„æ¼é—®é¢˜ï¼Œè¿™ä¸€é—®é¢˜é€šå¸¸ä¼šå¯¼è‡´ç¨‹åºåœ¨è¿è¡Œæ—¶æ¶ˆè€—è¿‡å¤šå†…å­˜ï¼Œç”šè‡³å¼•å‘å´©æºƒã€‚ Valgrind æ˜¯ä¸€å¥—åœ¨ Linux ç¯å¢ƒä¸‹è¿è¡Œçš„å¼€æºä»¿çœŸè°ƒè¯•å·¥å…·çš„é›†åˆï¼Œé‡‡ç”¨ GPL V2 è®¸å¯è¯ã€‚å…¶æ ¸å¿ƒéƒ¨ä»¶ç§°ä¸º å†…æ ¸ï¼Œè¿™ä¸ªå†…æ ¸å……å½“äº†ä¸€ä¸ªæ¡†æ¶ï¼Œä¸ºå…¶ä»–åŸºäºå†…æ ¸çš„è°ƒè¯•å·¥å…·æä¾›æœåŠ¡å’Œæ”¯æŒã€‚åœ¨è¿™ä¸ªæ¡†æ¶ä¸­ï¼Œå†…æ ¸æ¨¡æ‹Ÿäº† CPU ç¯å¢ƒï¼Œä½¿å¾—ä¸åŒçš„å·¥å…·å¯ä»¥åœ¨è¿™ç§è™šæ‹Ÿç¯å¢ƒä¸­æ‰§è¡Œã€‚ æ­¤å¤–ï¼ŒValgrind çš„å…¶ä»–å·¥å…·ç±»ä¼¼äº æ’ä»¶ï¼Œå®ƒä»¬åˆ©ç”¨å†…æ ¸æä¾›çš„æœåŠ¡æ¥å®Œæˆç‰¹å®šçš„å†…å­˜è°ƒè¯•ä»»åŠ¡ã€‚è¿™äº›å·¥å…·å„æœ‰å…¶ç‹¬ç‰¹çš„åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…æé«˜ç¨‹åºçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªé‡è¦çš„å·¥å…·åŠå…¶è¯¦ç»†ä½œç”¨ï¼š Memcheckï¼šè¿™æ˜¯ Valgrind ä¸­æœ€ä¸ºå¸¸ç”¨çš„å·¥å…·ï¼Œè´Ÿè´£æ£€æµ‹ç¨‹åºä¸­çš„å†…å­˜æ³„æ¼ã€æœªåˆå§‹åŒ–å†…å­˜è¯»å–ä»¥åŠæ— æ•ˆçš„å†…å­˜è®¿é—®ç­‰é—®é¢˜ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå½“ä¸€ä¸ªç¨‹åºåœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é…äº†ä¸€å—å†…å­˜ä»¥å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œä½†åœ¨ç¨‹åºç»“æŸæ—¶æ²¡æœ‰æ­£ç¡®é‡Šæ”¾è¿™å—å†…å­˜ï¼Œå¯¼è‡´å†…å­˜æŒç»­è¢«å ç”¨ã€‚Memcheck å¯ä»¥é€šè¿‡æä¾›è¯¦ç»†çš„é”™è¯¯æŠ¥å‘Šï¼Œå¸®åŠ©å¼€å‘è€…å‡†ç¡®å®šä½è¿™äº›å†…å­˜æ³„æ¼ã€‚ä¾‹å¦‚ï¼Œå¼€å‘è€…å¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼äºâ€åœ¨å‡½æ•° foo() ä¸­ï¼Œåˆ†é…çš„å†…å­˜æœªè¢«é‡Šæ”¾â€çš„æŠ¥å‘Šï¼Œè¿™è®©ä»–ä»¬å¯ä»¥è¿½è¸ªé—®é¢˜æ‰€åœ¨å¹¶åŠæ—¶ä¿®å¤ï¼Œé¿å…ç¨‹åºé•¿æ—¶é—´è¿è¡Œå¯¼è‡´çš„æ€§èƒ½ä¸‹é™ã€‚ Cachegrindï¼šè¿™ä¸ªå·¥å…·ç”¨äºåˆ†æç¨‹åºçš„ç¼“å­˜ä½¿ç”¨æƒ…å†µï¼Œæä¾›ç¼“å­˜å‘½ä¸­ç‡å’Œè¸©è¸ç‡ç­‰ä¿¡æ¯ï¼Œå¸®åŠ©å¼€å‘è€…ä¼˜åŒ–ç¨‹åºçš„æ€§èƒ½ã€‚ç¼“å­˜å‘½ä¸­ç‡æŒ‡çš„æ˜¯ç¨‹åºå¯¹äºå·²ç»å­˜å‚¨åœ¨ç¼“å­˜ä¸­çš„æ•°æ®çš„è®¿é—®ï¼Œè‹¥ç¼“å­˜å‘½ä¸­ç‡è¾ƒé«˜ï¼Œç¨‹åºçš„è¿è¡Œå°†æ›´ä¸ºè¿…é€Ÿè€Œé«˜æ•ˆï¼›ç›¸åï¼Œé«˜è¸©è¸ç‡åˆ™æ˜¾ç¤ºç¨‹åºé¢‘ç¹åœ°è®¿é—®æœªç¼“å­˜çš„æ•°æ®ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚ä¾‹å¦‚ï¼Œè‹¥ Cachegrind åé¦ˆç¼“å­˜è¸©è¸ç‡è¿‡é«˜ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®åé¦ˆé‡æ–°è€ƒé‡æ•°æ®çš„è®¿é—®æ¨¡å¼ï¼Œæˆ–é‡æ„æ•°æ®ç»“æ„ï¼Œä»¥æå‡ç¼“å­˜æ•ˆç‡ã€‚è¿™ç§å¾®è°ƒå¸¸å¸¸èƒ½æ˜¾è‘—æé«˜ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ã€‚ Callgrindï¼šç”¨äºæ€§èƒ½åˆ†æï¼Œè®°å½•ç¨‹åºå‡½æ•°çš„è°ƒç”¨æ¬¡æ•°åŠè°ƒç”¨å…³ç³»ã€‚é€šè¿‡å¯¹å‡½æ•°è°ƒç”¨çš„è¯¦ç»†è®°å½•ï¼Œå¼€å‘è€…å¯ä»¥æ–¹ä¾¿åœ°å‘ç°è¿è¡Œä¸­çš„ç“¶é¢ˆã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŸä¸ªå‡½æ•°è¢«è°ƒç”¨çš„æ¬¡æ•°å¼‚å¸¸å¢å¤šï¼Œå®ƒå¾ˆå¯èƒ½æˆä¸ºç¨‹åºçš„æ€§èƒ½ç“¶é¢ˆï¼Œå¼€å‘è€…å°±å¯ä»¥é’ˆå¯¹è¿™ä¸€ç‚¹è¿›è¡Œæ·±å…¥çš„ä¼˜åŒ–ï¼Œä»è€Œæå‡æ•´ä½“æ€§èƒ½ã€‚è¿™ç§æ–¹å¼ç±»ä¼¼äºåœ¨äº¤é€šæµé‡ä¸­æ‰¾å‡ºæ‹¥å µè·¯æ®µï¼Œä¿®å¤è¿™äº›â€å µç‚¹â€å¯ä»¥å¤§å¹…æ”¹å–„æ•´ä½“æµç•…åº¦ã€‚ Helgrindï¼šä¸“é—¨æ£€æŸ¥å¤šçº¿ç¨‹ç¨‹åºä¸­çš„ç«äº‰é—®é¢˜ï¼Œå®ƒå¸®åŠ©å¼€å‘è€…è¯†åˆ«åœ¨è®¿é—®å…±äº«èµ„æºæ—¶å¯èƒ½å‘ç”Ÿçš„ç«äº‰æ¡ä»¶ã€‚å‡è®¾ä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åºä¸­å¤šä¸ªçº¿ç¨‹åŒæ—¶å°è¯•æ›´æ–°åŒä¸€æ•°æ®ï¼Œè‹¥æ²¡æœ‰æ­£ç¡®çš„åŒæ­¥æœºåˆ¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æˆ–é”™è¯¯çš„ç»“æœã€‚Helgrind èƒ½å¤Ÿç›‘æµ‹åˆ°è¿™äº›æ½œåœ¨çš„ç«äº‰æƒ…å†µï¼Œæé†’å¼€å‘è€…æ³¨æ„å¹¶é‡‡å–é€‚å½“çš„é”æœºåˆ¶æ¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€‚ Massifï¼šå®ƒä¸»è¦ç”¨äºåˆ†æç¨‹åºçš„å †æ ˆä½¿ç”¨æƒ…å†µï¼Œå¸®åŠ©å¼€å‘è€…è¯†åˆ«å†…å­˜ä½¿ç”¨çš„çƒ­ç‚¹ã€‚Massif é€šè¿‡å®šæœŸæ•è·ç¨‹åºçš„å †å†…å­˜ä½¿ç”¨æƒ…å†µç»˜åˆ¶å†…å­˜åˆ†é…å›¾ã€‚è¿™ä½¿å¾—å¼€å‘è€…å¯ä»¥è½»æ¾è¯†åˆ«å‡ºå“ªäº›éƒ¨åˆ†çš„å†…å­˜å ç”¨ç‡è¿‡é«˜ï¼Œä»è€Œé‡‡å–æªæ–½å‡å°‘å†…å­˜ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œè‹¥ Massif æŠ¥å‘ŠæŸä¸ªåŠŸèƒ½æ¨¡å—å†…å­˜å ç”¨æ¥è¿‘æé™ï¼Œå¼€å‘è€…å°±èƒ½å¤Ÿèšç„¦äºè¯¥æ¨¡å—è¿›è¡Œä¼˜åŒ–ï¼Œå¯èƒ½æ˜¯é€šè¿‡å‡å°‘ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»ºï¼Œæˆ–åˆ©ç”¨æ›´é«˜æ•ˆçš„æ•°æ®ç»“æ„ã€‚ Extensionsï¼šå¼€å‘è€…è¿˜å¯ä»¥åˆ©ç”¨ Valgrind çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œè‡ªè¡Œç¼–å†™ç‰¹å®šçš„å†…å­˜è°ƒè¯•å·¥å…·ã€‚è¿™å°±ç›¸å½“äºå¼€å‘è€…åœ¨ç°æœ‰å·¥å…·çš„åŸºç¡€ä¸Šï¼Œåˆ›é€ å‡ºä¸€æ¬¾ç¬¦åˆè‡ªå·±ç‹¬ç‰¹éœ€æ±‚çš„å®šåˆ¶åŒ–å·¥å…·ï¼Œè¿›ä¸€æ­¥æå‡ç¨‹åºçš„è°ƒè¯•èƒ½åŠ›ã€‚ Valgrind çš„ä½“ç³»ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼Œä½“ç°å‡ºå†…æ ¸ä¸å¤šç§è°ƒè¯•å·¥å…·ä¹‹é—´å¯†åˆ‡çš„åä½œå…³ç³»ã€‚é€šè¿‡è¿™ç§è®¾è®¡ï¼ŒValgrind ä¸ä»…èƒ½å¤Ÿå¢å¼ºå¯¹ç¨‹åºçš„è°ƒè¯•èƒ½åŠ›ï¼Œè¿˜èƒ½ä¸ºå¼€å‘äººå‘˜æä¾›æ›´ä¸ºè¯¦å°½çš„å†…å­˜ä¸æ€§èƒ½åˆ†æï¼Œç¡®ä¿ç¨‹åºåœ¨å„ç§æ“ä½œæ¡ä»¶ä¸‹çš„å¯é æ€§ã€‚ äº†è§£ Linux å†…å­˜åˆ†å¸ƒ å†…å­˜åˆ†å¸ƒ Memcheck å·¥å…·Valgrind çš„æ ¸å¿ƒç»„ä»¶æ˜¯ Memcheckï¼Œå®ƒèƒ½å¤Ÿæ£€æŸ¥å¤šç§å†…å­˜ä½¿ç”¨é”™è¯¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹å‡ ç§å¸¸è§é—®é¢˜ï¼š æœªåˆå§‹åŒ–çš„å†…å­˜ä½¿ç”¨ï¼šå½“ç¨‹åºè¯•å›¾ä½¿ç”¨ä¸€ä¸ªæœªåˆå§‹åŒ–çš„å˜é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œè¯»å–ä¸€ä¸ªæœ¬åº”ä¸ºé›¶çš„ç¼“å†²åŒºæ—¶ï¼Œå¦‚æœæ²¡æœ‰åˆå§‹åŒ–ï¼Œå¯èƒ½ä¼šå¾—åˆ°ä¸€äº›åƒåœ¾å€¼ã€‚ å·²é‡Šæ”¾å†…å­˜çš„è®¿é—®ï¼šè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„é”™è¯¯ï¼Œè¡¨ç¤ºç¨‹åºè¯•å›¾é€šè¿‡æŒ‡å‘å·²é‡Šæ”¾å†…å­˜çš„æŒ‡é’ˆè¯»å–æˆ–å†™å…¥æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“ free ä¸€ä¸ªæŒ‡é’ˆåï¼Œè‹¥ç»§ç»­ä½¿ç”¨è¯¥æŒ‡é’ˆï¼Œå¾ˆå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒã€‚ è¶…å‡ºåˆ†é…çš„å†…å­˜èŒƒå›´ï¼šå³å°è¯•åœ¨å·²åˆ†é…çš„å†…å­˜å—å¤–è¿›è¡Œè¯»å†™ï¼Œè¿™ä¸ä»…å¯èƒ½å¯¼è‡´æ•°æ®æŸåï¼Œè¿˜å¯èƒ½å¼•å‘å®‰å…¨éšæ‚£ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“åˆ†é…äº† 10 å­—èŠ‚çš„å†…å­˜å´è¯•å›¾å†™å…¥ 15 å­—èŠ‚æ•°æ®æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§é”™è¯¯ã€‚ éæ³•çš„å †æ ˆè®¿é—®ï¼šè®¿é—®æŸäº›ä¸åº”è®¿é—®çš„å †æ ˆåŒºåŸŸï¼Œé€šå¸¸ç”±äºæ•°ç»„è¶Šç•Œæˆ–é”™è¯¯çš„æŒ‡é’ˆè¿ç®—å¯¼è‡´ã€‚ å†…å­˜æ³„æ¼ï¼šæŒ‡ç¨‹åºåœ¨åŠ¨æ€åˆ†é…å†…å­˜åå¤±å»å¯¹è¯¥å†…å­˜å—çš„æ‰€æœ‰æŒ‡é’ˆï¼Œå¯¼è‡´è¿™äº›å†…å­˜æ— æ³•å†è¢«è®¿é—®æˆ–é‡Šæ”¾ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´ç¨‹åºçš„å¯ç”¨å†…å­˜é€æ¸è€—å°½ã€‚ å†…å­˜åˆ†é…ä¸é‡Šæ”¾çš„ä¸åŒ¹é…ï¼šæŒ‡åœ¨ä½¿ç”¨ malloc å’Œ freeã€new å’Œ delete æ—¶ä¸åŒ¹é…çš„æƒ…å†µã€‚æ¯”å¦‚ï¼Œå¦‚æœç”¨ malloc åˆ†é…äº†å†…å­˜ï¼Œä½†ç”¨ delete å»é‡Šæ”¾ï¼Œå°±ä¼šäº§ç”Ÿé”™è¯¯ã€‚ é‡å çš„å†…å­˜æ“ä½œï¼šåœ¨ä½¿ç”¨ memcpy() ç­‰å‡½æ•°æ—¶ï¼Œè‹¥æºåœ°å€å’Œç›®æ ‡åœ°å€é‡å ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„æ•°æ®è¦†ç›–ã€‚ é‡å¤çš„é‡Šæ”¾ï¼šæŒ‡å°è¯•å¯¹åŒä¸€å†…å­˜å—è¿›è¡Œå¤šæ¬¡é‡Šæ”¾ï¼Œå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚ Memcheck çš„å†…å­˜æ£€æµ‹åŸç†Memcheck æ˜¯ä¸€ç§å¼ºå¤§å·¥å…·ï¼Œå¯ä»¥æœ‰æ•ˆè¯†åˆ«ç¨‹åºä¸­çš„å†…å­˜é—®é¢˜ï¼Œå…¶æ ¸å¿ƒæœºåˆ¶åœ¨äºä¸¤ä¸ªå…¨å±€çš„è¡¨æ ¼ï¼šValid-Value è¡¨å’Œ Valid-Address è¡¨ã€‚è¿™ä¸¤ä¸ªè¡¨æ ¼é€šè¿‡æ¯”ç‰¹ä½ï¼ˆbitsï¼‰ç²¾ç¡®åœ°è¿½è¸ªè¿›ç¨‹çš„å†…å­˜çŠ¶æ€ï¼Œç¡®ä¿æ¯ä¸ªå­—èŠ‚çš„å¯ç”¨æ€§å’Œæœ‰æ•ˆæ€§ã€‚Memcheck æ£€æµ‹å†…å­˜é—®é¢˜çš„åŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ°å€ç©ºé—´ç®¡ç†å¯¹äºè¿›ç¨‹çš„æ¯ä¸€ä¸ªå­—èŠ‚ï¼ˆbyteï¼‰ï¼ŒMemcheck ä¼šä¸ºå…¶åˆ†é…å¯¹åº”çš„ 8 ä¸ª bitsï¼Œç”¨äºè®°å½•è¿™ä¸ªå­—èŠ‚æ˜¯å¦æ‹¥æœ‰æœ‰æ•ˆä¸”å·²åˆå§‹åŒ–çš„å€¼ã€‚è¿™æ„å‘³ç€æ¯å½“ç¨‹åºè¯•å›¾è®¿é—®æˆ–ä¿®æ”¹å†…å­˜æ—¶ï¼ŒMemcheck éƒ½ä¼šæŸ¥çœ‹ä¸è¯¥å­—èŠ‚ç›¸å…³è”çš„ bitsï¼Œä»¥ç¡®å®šè¯¥å†…å­˜ä½ç½®çš„æœ‰æ•ˆæ€§ã€‚ ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªç¨‹åºè¯•å›¾è¯»å–æ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚åœ¨è¿›è¡Œè¯»å–æ“ä½œä¹‹å‰ï¼ŒMemcheck é¦–å…ˆä¼šæ£€æŸ¥è¯¥å…ƒç´ å¯¹åº”çš„ 8 ä¸ª bitsã€‚å¦‚æœè¿™äº› bits ä¸­çš„ä»»æ„ä¸€ä¸ªæŒ‡ç¤ºè¯¥å…ƒç´ æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œç¨‹åºå°±ä¼šè¢«å‘ŠçŸ¥å°è¯•è®¿é—®æœªåˆå§‹åŒ–çš„å†…å­˜ï¼Œè¿™æ˜¯å› ä¸ºè¿™äº› bits ç¡®ä¿äº†è¯¥å†…å­˜çš„çŠ¶æ€è¢«æ­£ç¡®è¿½è¸ªã€‚ æœ‰æ•ˆæ€§è·Ÿè¸ªé™¤äº† Valid-Value è¡¨å¤–ï¼ŒMemcheck è¿˜ç»´æŠ¤äº†ä¸€ä¸ª 1 bit çš„ Valid-Address è¡¨ï¼Œä¸“é—¨ç”¨äºæ ‡è¯†å†…å­˜åœ°å€æ˜¯å¦å¯ä»¥è¢«è¯»å†™ã€‚æ¯å½“ç¨‹åºè¯•å›¾è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œè¯¥æ“ä½œéƒ½ä¼šç»è¿‡è¯¥è¡¨çš„éªŒè¯ã€‚ å‡è®¾ä¸€ä¸ªç¨‹åºä¼å›¾ä¿®æ”¹ä¸€ä¸ªæ— æ•ˆçš„å†…å­˜åœ°å€ï¼Œæ— è®ºæ˜¯å› ä¸ºåœ°å€å·²ç»é‡Šæ”¾è¿˜æ˜¯è¶…å‡ºäº†æœ‰æ•ˆèŒƒå›´ï¼ŒMemcheck ä¼šæå‰æ•è·è¿™ä¸ªé”™è¯¯ã€‚ä¸€æ—¦å‘ç°ç›¸å…³çš„ A bit æ˜¾ç¤ºè¯¥åœ°å€æ— æ•ˆï¼ŒMemcheck å°†ç«‹å³æŠ¥å‘Šä¸ºè¯»å†™é”™è¯¯ã€‚è¿™ç§å³æ—¶åé¦ˆæå¤§åœ°å¸®åŠ©å¼€å‘è€…å®šä½é—®é¢˜ï¼Œé¿å…æ½œåœ¨çš„ç¨‹åºå´©æºƒã€‚ æ ¸å¿ƒä¸è™šæ‹Ÿ CPU ç¯å¢ƒå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒMemcheck çš„å†…éƒ¨æ ¸ï¼ˆcoreï¼‰è¿è¡Œåœ¨ä¸€ä¸ªç±»ä¼¼äºè™šæ‹Ÿçš„ CPU ç¯å¢ƒä¸­ã€‚è¿™æ„å‘³ç€ï¼Œå½“è¿›ç¨‹ä¸­çš„ä¸€ä¸ªå­—èŠ‚è¢«åŠ è½½åˆ°å®é™…çš„ CPU æ—¶ï¼Œå…¶å¯¹åº”çš„ V bit ä¹Ÿä¼šä¸€åŒè¢«åŠ è½½åˆ°è™šæ‹Ÿç¯å¢ƒä¸­ã€‚è¿™ç§æœºåˆ¶ç¡®ä¿äº†å³ä¾¿æ˜¯åœ¨åº•å±‚ç¡¬ä»¶äº¤äº’çš„ç¬é—´ï¼Œå†…å­˜çš„æœ‰æ•ˆæ€§è®°å½•ä¾ç„¶å¾—åˆ°ç»´æŠ¤ã€‚ å½“ç¨‹åºçš„å¯„å­˜å™¨ä¸­çš„å€¼è¢«ç”¨äºç”Ÿæˆå†…å­˜åœ°å€ï¼Œæˆ–å½“è¯¥å€¼å¯ä»¥å½±å“ç¨‹åºçš„è¾“å‡ºæ—¶ï¼ŒMemcheck ä¼šè¿›è¡Œä¸€æ¬¡é¢å¤–çš„æ£€æŸ¥ï¼Œç¡®ä¿æ‰€æœ‰ç›¸å…³çš„ V bits å·²è¢«æ­£ç¡®è®¾ç½®ã€‚å¦‚æœå‘ç°è¿™äº› bits æŒ‡å‘ä¸€ä¸ªå°šæœªåˆå§‹åŒ–çš„å€¼ï¼ŒMemcheck å°†å‘å‡ºå…³äºä½¿ç”¨æœªåˆå§‹åŒ–å†…å­˜çš„é”™è¯¯è­¦å‘Šã€‚è¿™ç§è®¾è®¡è¿›ä¸€æ­¥å¢å¼ºäº†ç¨‹åºè¿è¡Œçš„å®‰å…¨æ€§å’Œæ­£ç¡®æ€§ã€‚ æ€»ä½“æ¥è¯´ï¼ŒMemcheck é€šè¿‡ä¸¥å¯†çš„å†…å­˜è¿½è¸ªæœºåˆ¶ï¼Œå¸®åŠ©å¼€å‘è€…æœ‰æ•ˆè¯†åˆ«å¹¶è§£å†³å†…å­˜ç›¸å…³çš„é—®é¢˜ï¼Œç¡®ä¿ç¨‹åºçš„ç¨³å®šå’Œé«˜æ•ˆã€‚ Memcheck å†…å­˜é—®é¢˜æ£€æµ‹æœºåˆ¶Memcheck æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œä¸“é—¨ç”¨äºæ£€æµ‹ç¨‹åºä¸­çš„å†…å­˜é—®é¢˜ã€‚å…¶æ ¸å¿ƒåœ¨äºæ„å»ºä¸¤ä¸ªå…¨å±€è¡¨ï¼Œè¿™ä½¿å¾—å®ƒèƒ½å¤Ÿé«˜æ•ˆã€å‡†ç¡®åœ°è¿è¡Œå†…å­˜æ£€æŸ¥ã€‚ å†…å­˜å’Œå¯„å­˜å™¨ç›‘æµ‹å¯¹äºè¿›ç¨‹ä¸­çš„æ¯ä¸€ä¸ªå­—èŠ‚ï¼ˆbyteï¼‰ï¼ŒMemcheck ä¼šå¯¹åº”åœ°åˆ›å»º 8 ä¸ª bitsã€‚è€Œæ¯ä¸ª CPU å¯„å­˜å™¨åŒæ ·ä¼šå¯¹åº”ä¸€ä¸ª bit å‘é‡ã€‚è¿™ä¸ª bit å‘é‡çš„ä½œç”¨æ˜¯è®°å½•æŸä¸ªå­—èŠ‚æˆ–å¯„å­˜å™¨çš„å€¼æ˜¯å¦æœ‰æ•ˆä¸”å·²åˆå§‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç¨‹åºè¯•å›¾è®¿é—®ä¸€ä¸ªæ•°ç»„çš„å…ƒç´ ï¼Œè€Œè¯¥å…ƒç´ ä¹‹å‰æœªè¢«åˆå§‹åŒ–ï¼ŒMemcheck çš„è®°å½•ç³»ç»Ÿä¼šæ ‡è®°è¿™ä¸ªå­—èŠ‚çš„å¯¹åº” bitï¼Œå¸®åŠ©å¼€å‘è€…è¿½è¸ªå¯¼è‡´é”™è¯¯çš„æƒ…å†µã€‚ åœ°å€æœ‰æ•ˆæ€§è·Ÿè¸ªæ­¤å¤–ï¼ŒMemcheck è¿˜ä¸ºè¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„æ¯ä¸€ä¸ªå­—èŠ‚åˆ›å»ºäº†ä¸€ä¸ªå•ç‹¬çš„ bitï¼Œç”¨ä»¥è®°å½•è¯¥åœ°å€æ˜¯å¦èƒ½è¢«æ­£ç¡®è¯»å†™ã€‚æ‰€è°“è¯»å†™ï¼Œæ˜¯æŒ‡ç¨‹åºå°è¯•ä»è¯¥å†…å­˜åœ°å€è¯»å–æ•°æ®æˆ–å°†æ•°æ®å†™å…¥è¯¥å†…å­˜åœ°å€ã€‚è¿™ä¸€æœºåˆ¶ç¡®ä¿ç³»ç»Ÿèƒ½å¿«é€Ÿè¯†åˆ«å‡ºæ— æ•ˆå†…å­˜è®¿é—®ï¼Œé¿å…ç¨‹åºå› ä½¿ç”¨éæ³•åœ°å€è€Œå´©æºƒã€‚ æ£€æµ‹åŸç†Memcheck çš„æ£€æµ‹æœºåˆ¶å¯æ€»ç»“ä¸ºä»¥ä¸‹ä¸¤ä¸ªè¡¨ï¼š Valid-Value è¡¨ï¼šç”¨äºè¿½è¸ªæ¯ä¸ªå†…å­˜å­—èŠ‚å’Œå¯„å­˜å™¨çš„å€¼æ˜¯å¦æœ‰æ•ˆã€‚ Valid-Address è¡¨ï¼šç”¨äºç›‘æ§æ¯ä¸ªå†…å­˜å­—èŠ‚çš„å¯è¯»å†™æ€§ã€‚ è¯»å–ä¸å†™å…¥å†…å­˜çš„è¿‡ç¨‹å½“ç¨‹åºå°è¯•è¯»å†™å†…å­˜ä¸­çš„æŸä¸ªå­—èŠ‚æ—¶ï¼ŒMemcheck é¦–å…ˆæ£€æŸ¥è¯¥å­—èŠ‚å¯¹åº”çš„æœ‰æ•ˆåœ°å€ bitï¼ˆA bitï¼‰ã€‚å¦‚æœ A bit è¡¨æ˜è¯¥ä½ç½®ä¸ºæ— æ•ˆï¼Œåˆ™ Memcheck ä¼šç«‹å³æŠ¥å‘Šä¸€ä¸ªè¯»å†™é”™è¯¯ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœç¨‹åºå°è¯•è®¿é—®ä¸€ä¸ªæŒ‡å‘æ¸…ç©ºæˆ–æœªåˆ†é…å†…å­˜çš„æŒ‡é’ˆï¼ŒMemcheck ä¼šæ•æ‰åˆ°æ­¤ç±»é”™è¯¯ï¼Œæç¤ºå¼€å‘è€…è¯¥æ“ä½œæ˜¯éæ³•çš„ã€‚ è™šæ‹Ÿ CPU ç¯å¢ƒå†…æ ¸ï¼ˆcoreï¼‰è¿ä½œåƒä¸€ä¸ªè™šæ‹Ÿ CPU ç¯å¢ƒã€‚è¿™æ ·ï¼Œå½“æŸä¸ªå­—èŠ‚è¢«åŠ è½½åˆ°çœŸå® CPU æ—¶ï¼Œå…¶å¯¹åº”çš„æœ‰æ•ˆå€¼ bitï¼ˆV bitï¼‰ä¹ŸåŒæ—¶åŠ è½½è¿›è™šæ‹Ÿ CPU ç¯å¢ƒã€‚ä¸€æ—¦å¯„å­˜å™¨çš„å€¼ç”¨äºç”Ÿæˆå†…å­˜åœ°å€ï¼Œæˆ–å¯èƒ½å½±å“ç¨‹åºçš„è¾“å‡ºï¼ŒMemcheck å°±ä¼šè¿›è¡Œåˆä¸€æ¬¡çš„æ£€æŸ¥ï¼Œç¡®ä¿ V bits è®°å½•çš„å€¼æ˜¯æœ‰æ•ˆä¸”å·²åˆå§‹åŒ–çš„ã€‚å¦‚æœå‘ç°è¯¥å†…å­˜åœ°å€çš„å€¼å°šæœªè¢«åˆç†åˆå§‹åŒ–ï¼ŒMemcheck å°†ä¼šæŠ¥å‘Šå‡ºé”™ï¼Œæç¤ºå¼€å‘è€…å­˜åœ¨æœªåˆå§‹åŒ–å†…å­˜çš„é£é™©ã€‚è¿™ç§è¯¦ç»†çš„æ£€æŸ¥æœºåˆ¶å¤§å¤§ç®€åŒ–äº†è°ƒè¯•è¿‡ç¨‹ï¼Œå‡å°‘äº†éš¾ä»¥æ’æŸ¥çš„é—®é¢˜ã€‚ é€šè¿‡è¿™ä¸€ç³»åˆ—çš„ç›‘æ§å’Œè®°å½•ï¼ŒMemcheck æœ‰æ•ˆåœ°å¸®åŠ©å¼€å‘è€…è¯†åˆ«å’Œä¿®å¤å†…å­˜ç›¸å…³çš„é”™è¯¯ï¼Œæå‡ä»£ç çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚ å®‰è£… Valgrindä»¥ä¸‹æ˜¯ Valgrind çš„å®‰è£…æ­¥éª¤ï¼Œç¡®ä¿æœ‰ wget å’Œ make ç­‰åŸºæœ¬å·¥å…·ï¼š wget http://valgrind.org/downloads/valgrind-3.4.1.tar.bz2tar xvf valgrind-3.4.1.tar.bz2cd valgrind-3.4.1/./configure --prefix=/usr/local/webserver/valgrindmakemake install ä½¿ç”¨ç¤ºä¾‹å‡†å¤‡å¥½ç¨‹åº#include stdlib.h // å¼•å…¥æ ‡å‡†åº“ï¼Œæä¾›mallocå’Œfreeå‡½æ•°çš„å£°æ˜void fun() // åˆ†é…å†…å­˜ï¼šä¸º10ä¸ªæ•´æ•°åˆ†é…è¶³å¤Ÿçš„ç©ºé—´ int *p = (int *)malloc(10 * sizeof(int)); // æ£€æŸ¥å†…å­˜æ˜¯å¦åˆ†é…æˆåŠŸ if (p == NULL) // å¦‚æœåˆ†é…å¤±è´¥ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶é€€å‡ºå‡½æ•° fprintf(stderr, Memory allocation failed ); return; // é”™è¯¯çš„å†…å­˜è®¿é—®ï¼šå°è¯•è®¿é—®æ•°ç»„çš„ç¬¬11ä¸ªå…ƒç´ ï¼ˆç´¢å¼•ä¸º10ï¼‰ // è¿™æ˜¯è¶Šç•Œè®¿é—®ï¼Œå¯èƒ½å¯¼è‡´æœªå®šä¹‰è¡Œä¸º p[10] = 0; // åœ¨ C/C++ ä¸­ï¼Œæ•°ç»„çš„æœ‰æ•ˆç´¢å¼•æ˜¯ 0 åˆ° 9ï¼Œè€Œè¿™é‡Œè¶Šç•Œäº† // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè®¿é—®è¶Šç•Œçš„å†…å­˜å¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒæˆ–æ•°æ®æŸåã€‚ // ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œç¡®ä¿è®¿é—®çš„ç´¢å¼•åœ¨åˆç†èŒƒå›´å†…éå¸¸é‡è¦ // æ­£ç¡®çš„è®¿é—®åº”è¯¥æ˜¯ p[0] åˆ° p[9] // è®°å¾—é‡Šæ”¾åˆ†é…çš„å†…å­˜ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ //free(p);int main() fun(); // è°ƒç”¨ fun å‡½æ•° return 0; // è¿”å› 0ï¼Œè¡¨ç¤ºç¨‹åºæˆåŠŸç»“æŸ ç»†èŠ‚è¯´æ˜ï¼š ä½¿ç”¨ malloc å‡½æ•°åˆ†é…çš„å†…å­˜ç­‰åŒäº 10 ä¸ª int ç±»å‹çš„ç©ºé—´ï¼Œæ¯ä¸ª int é€šå¸¸å ç”¨ 4 å­—èŠ‚ï¼Œå› æ­¤æ€»å…±åˆ†é…äº† 40 å­—èŠ‚çš„å†…å­˜ã€‚ åœ¨åˆ†é…å†…å­˜åï¼Œä½¿ç”¨æŒ‡é’ˆ p å­˜å–å†…å­˜ï¼Œä½†å¿…é¡»ç¡®ä¿è®¿é—®çš„æ•°ç»„ç´¢å¼•ä¸è¶…è¿‡åˆå§‹åŒ–çš„å¤§å°ã€‚é”™è¯¯çš„å†™æ³• p[10] å®é™…ä¸Šæ˜¯è®¿é—®äº†æœªåˆ†é…çš„å†…å­˜åŒºåŸŸï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºæ„å¤–å´©æºƒã€‚ åœ¨æˆåŠŸä½¿ç”¨ malloc ä¹‹åï¼Œåº”è¯¥ç«‹å³æ£€æŸ¥è¿”å›æŒ‡é’ˆæ˜¯å¦ä¸º NULLï¼Œä»¥ç¡®è®¤å†…å­˜æ˜¯å¦æˆåŠŸåˆ†é…ã€‚ æœ€åï¼Œä½¿ç”¨ free å‡½æ•°é‡Šæ”¾æ‰ä¹‹å‰åˆ†é…çš„å†…å­˜ï¼Œä»¥é¿å…å†…å­˜æ³„æ¼ã€‚è¿™æ˜¯å†…å­˜ç®¡ç†ä¸­çš„ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œç¡®ä¿ç¨‹åºè¿è¡Œé«˜æ•ˆã€ç¨³å®šã€‚ ä¸ºäº†ç¡®ä¿ Valgrind èƒ½å¤Ÿå‡†ç¡®å‘ç°å¹¶å®šä½æºä»£ç ä¸­çš„é”™è¯¯ï¼Œåœ¨ç¼–è¯‘ç¨‹åºæ—¶éœ€è¦åŠ å…¥ -g å‚æ•°ï¼Œå¼€å¯è°ƒè¯•ä¿¡æ¯ã€‚åŒæ—¶ï¼Œä¸ºäº†é¿å…ä¼˜åŒ–å½±å“è°ƒè¯•ï¼Œæ¨èä½¿ç”¨ -O0 é€‰é¡¹ï¼Œè¿™æ ·è™½ç„¶ä¼šé™ä½ç¨‹åºçš„è¿è¡Œæ•ˆç‡ï¼Œä½†èƒ½å¤Ÿä¿è¯è°ƒè¯•ä¿¡æ¯çš„å‡†ç¡®æ€§ã€‚è¿™ä¸€è¿‡ç¨‹æ‰€ä½¿ç”¨çš„ç¤ºä¾‹ç¨‹åºåä¸º sample.cï¼Œç¼–è¯‘å™¨é€‰æ‹© gccã€‚ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºçš„å‘½ä»¤å¦‚ä¸‹ï¼š gcc -g -O0 sample.c -o sample åœ¨æ­¤å‘½ä»¤ä¸­ï¼Œ-g é€‰é¡¹ä½¿å¾—ç¼–è¯‘å™¨åœ¨ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­åŒ…å«è°ƒè¯•ç¬¦å·ï¼Œä»è€Œå¸®åŠ© Valgrind å®šä½åˆ°å‡ºé”™çš„æºä»£ç è¡Œã€‚è€Œ -O0 é€‰é¡¹åˆ™ç¦æ­¢ä¼˜åŒ–ï¼Œç¡®ä¿æ¯æ¡ä»£ç éƒ½ä¸æºä»£ç ä¸€è‡´ã€‚ åœ¨ Valgrind ä¸‹ï¼Œè¿è¡Œå¯æ‰§è¡Œç¨‹åºValgrind ä¸»è¦ç”¨äºè°ƒè¯•å†…å­˜ç›¸å…³çš„é—®é¢˜ï¼Œè¿™æ„å‘³ç€å¯ä»¥ç›´æ¥å¯¹ç¼–è¯‘å¾—åˆ°çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œåˆ†æï¼Œæ— éœ€é‡æ–°ç¼–è¯‘æºä»£ç ã€‚è¿è¡Œ Valgrind å‘½ä»¤çš„é€šç”¨æ ¼å¼å¦‚ä¸‹ï¼š valgrind [valgrind-options] your-prog [your-prog-options] Valgrind çš„å‚æ•°åˆ†ä¸ºæ ¸å¿ƒå‚æ•°å’Œç‰¹å®šå·¥å…·çš„å‚æ•°ã€‚æ ¸å¿ƒå‚æ•°é€‚ç”¨äºæ‰€æœ‰çš„ Valgrind å·¥å…·ï¼Œè€Œç‰¹å®šå·¥å…·çš„å‚æ•°åˆ™ä¾èµ–äºé€‰æ‹©çš„å…·ä½“å·¥å…·ã€‚Valgrind é»˜è®¤ä¼šå¯åŠ¨ memcheck å·¥å…·ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨ --tool=tool name é€‰é¡¹æŒ‡å®šå…¶ä»–å·¥å…·ã€‚Valgrind æä¾›ä¸°å¯Œçš„å‚æ•°é›†ä»¥æ»¡è¶³ä¸åŒçš„è°ƒè¯•éœ€æ±‚ï¼Œè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒå…¶ç”¨æˆ·æ‰‹å†Œã€‚ åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œé€‰æ‹©ä½¿ç”¨ memcheck å·¥å…·ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿è¡Œç¨‹åºï¼š valgrind ./sample åˆ†æ Valgrind çš„è¾“å‡ºä¿¡æ¯å½“è¿è¡Œä¸Šé¢çš„å‘½ä»¤æ—¶ï¼ŒValgrind ä¼šäº§ç”Ÿä¸€ç³»åˆ—è¾“å‡ºä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å°†å¸®åŠ©å®šä½åˆ°ç¨‹åºä¸­çš„å†…å­˜é—®é¢˜ã€‚è¾“å‡ºä¸­åŒ…å«äº†å¤šä¸ªéƒ¨åˆ†ï¼š å·¦ä¾§æ˜¾ç¤ºçš„æ•°å­—ï¼ˆå¦‚ 32372ï¼‰æ ‡è¯†äº†è¿›ç¨‹ IDï¼Œå¸®åŠ©ç”¨æˆ·è·Ÿè¸ªæ­£åœ¨åˆ†æçš„ç¨‹åºã€‚ é¡¶éƒ¨çš„çº¢è‰²æ¡†æ˜¾ç¤º Valgrind çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¾‹å¦‚ â€œValgrind-3.16.1â€ã€‚ ä¸­é—´çš„çº¢è‰²æ¡†å±•ç¤ºäº† Valgrind åœ¨è¿è¡Œè¢«æµ‹è¯•ç¨‹åºæ—¶æ£€æµ‹åˆ°çš„å†…å­˜é”™è¯¯ã€‚è¿™äº›ä¿¡æ¯åŒ…æ‹¬ï¼š éæ³•å†™æ“ä½œçš„æè¿°ï¼Œä¾‹å¦‚â€Invalid write of size 4â€ã€‚ æŠ¥é”™æ—¶çš„å‡½æ•°å †æ ˆä¿¡æ¯ï¼ŒåŒ…æ‹¬å‡½æ•°çš„è°ƒç”¨é“¾ï¼ˆæ¯”å¦‚ fun() åˆ° main()ï¼‰ã€‚ æ¶‰åŠéæ³•å†™æ“ä½œçš„å…·ä½“åœ°å€ç©ºé—´ï¼Œé€šå¸¸æ˜¯ç±»ä¼¼äº â€œ0x4a3c4â€ çš„åœ°å€ã€‚ æœ€åº•éƒ¨çš„çº¢è‰²æ¡†ä¼šæ€»ç»“å‘ç°çš„å†…å­˜é—®é¢˜ï¼Œä»¥åŠå†…å­˜æ³„æ¼çš„ç»Ÿè®¡æŠ¥å‘Šã€‚ä¾‹å¦‚ï¼Œå¯èƒ½ä¼šæœ‰â€HEAP SUMMARYâ€éƒ¨åˆ†ï¼Œæ˜¾ç¤ºå†…å­˜æ³„æ¼çš„å¤§å°ï¼ˆå¦‚â€40 bytesâ€ï¼‰ã€‚ æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œå¯ä»¥ç¡®åˆ‡çŸ¥é“ç¤ºä¾‹ç¨‹åºå­˜åœ¨ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼š åœ¨ fun å‡½æ•°ä¸­åŠ¨æ€ç”³è¯·çš„å †å†…å­˜æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚ ä»£ç ä¸­å­˜åœ¨å¯¹å †å†…å­˜çš„è¶Šç•Œè®¿é—®é—®é¢˜ã€‚ è¿™ä¸¤ä¸ªé—®é¢˜å‡è¢« Valgrind æœ‰æ•ˆè¯†åˆ«å’Œæ ‡è®°ï¼Œä¸ºä¿®å¤ä»£ç æä¾›äº†ä¾æ®ã€‚é€šè¿‡ä»”ç»†åˆ†æè¿™äº›è¾“å‡ºä¿¡æ¯ï¼Œå¼€å‘è€…èƒ½å¤Ÿå‡†ç¡®å®šä½å¹¶ä¿®å¤æ½œåœ¨çš„é”™è¯¯ã€‚ Memcheck å·¥å…·è¿›è¡Œ CC++ çš„å†…å­˜æ³„æ¼æ£€æµ‹åœ¨ç³»ç»Ÿç¼–ç¨‹ä¸­ï¼Œæœ‰æ•ˆåœ°ç®¡ç†å†…å­˜æ˜¯è‡³å…³é‡è¦çš„ã€‚éšç€ç¨‹åºä¸ç³»ç»Ÿåº•å±‚çš„æ¥è§¦è¶Šæ·±ï¼Œé¢ä¸´çš„å†…å­˜é—®é¢˜ä¹Ÿè¶Šå¤šã€‚å¤„ç†è¿™äº›é—®é¢˜æ—¶ï¼Œå¸¸å¸¸ä¼šé‡åˆ°æ£˜æ‰‹çš„è°ƒè¯•æŒ‘æˆ˜ï¼Œæ‰€ä»¥ä½¿ç”¨åˆé€‚çš„å·¥å…·æ˜¯éå¸¸å…³é”®çš„ã€‚åœ¨ä¼—å¤šå¯ç”¨å·¥å…·ä¸­ï¼ŒValgrind å¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„åå­—ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¼€æºå†…å­˜ç®¡ç†æ¡†æ¶ã€‚ Valgrind æ˜¯ä¸€ä¸ªåŠ¨æ€åˆ†æå·¥å…·çš„æ¡†æ¶ï¼ŒåŒ…å«å¤šç§å·¥å…·ï¼Œå„è‡ªé’ˆå¯¹ä¸åŒç±»å‹çš„è°ƒè¯•å’Œåˆ†æä»»åŠ¡ï¼Œä»¥å¸®åŠ©æé«˜ç¨‹åºçš„è´¨é‡å’Œç¨³å®šæ€§ã€‚Valgrind çš„æ¨¡å—åŒ–æ¶æ„ä½¿å¾—å¼€å‘æ–°å·¥å…·å˜å¾—ç›¸å¯¹ç®€å•ï¼Œè€Œä¸ä¼šå¯¹ç°æœ‰åŠŸèƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚å¾ˆå¤šå®ç”¨çš„å·¥å…·éƒ½æ˜¯ä½œä¸ºæ ‡å‡†é…å¤‡ï¼Œè€Œä¸€äº›å·¥å…·åˆ™åªå¯¹ç‰¹å®šç”¨æˆ·ç¾¤ä½“æœ‰ç”¨ï¼Œæ¯”å¦‚ Lackey å’Œ Nulgrind ä¸»è¦ç”¨äºæ¼”ç¤ºå’Œæµ‹è¯•ç›®çš„ã€‚ åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œå°†é‡ç‚¹è®¨è®º Memcheck å·¥å…·ï¼Œå®ƒæ˜¯ Valgrind çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚ ä½¿ç”¨ Valgrind MemcheckMemcheck å·¥å…·çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š valgrind --tool=memcheck ./a.out åœ¨ä»¥ä¸Šå‘½ä»¤ä¸­ï¼Œvalgrind æ˜¯è°ƒç”¨å·¥å…·çš„ä¸»å‘½ä»¤ï¼Œè€Œ --tool é€‰é¡¹æŒ‡å®šè¦ä½¿ç”¨çš„å·¥å…·ä¸º memcheckã€‚a.out æ˜¯å¸Œæœ›é€šè¿‡ Memcheck è¿›è¡Œæµ‹è¯•çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ Memcheck å·¥å…·å¯ä»¥æ£€æµ‹å¤šç§ä¸å†…å­˜ç›¸å…³çš„é—®é¢˜ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ä¸»è¦çš„èƒ½åŠ›ï¼š æœªé‡Šæ”¾å†…å­˜çš„ä½¿ç”¨ å¯¹é‡Šæ”¾åå†…å­˜çš„è¯»å†™ å¯¹å·²åˆ†é…å†…å­˜å—å°¾éƒ¨çš„è¯»å†™ å†…å­˜æ³„æ¼ ä¸åŒ¹é…çš„ä½¿ç”¨ malloc/new/new[] å’Œ free/delete/delete[] é‡å¤é‡Šæ”¾å†…å­˜ å°†é€ä¸€æ¢è®¨è¿™äº›åœºæ™¯ï¼Œä½¿ç”¨ä»£ç ç¤ºä¾‹å’Œè¾“å‡ºç»“æœæ¥è¯´æ˜ã€‚ 1. ä½¿ç”¨æœªåˆå§‹åŒ–çš„æŒ‡é’ˆ#include stdio.h#include stdlib.hint main(void) char *p; char c = *p; // æœªåˆå§‹åŒ–çš„æŒ‡é’ˆ printf( [%c] ,c); return 0; å½“å°è¯•é€šè¿‡æœªåˆå§‹åŒ–çš„æŒ‡é’ˆ p è¯»å–å†…å­˜æ—¶ï¼Œè¿è¡Œ Memcheck å°†æ˜¾ç¤ºå¦‚ä¸‹è¾“å‡ºï¼š $ valgrind --tool=memcheck ./val==2862== Memcheck, a memory error detector==2862== Use of uninitialised value of size 8==2862== at 0x400530: main (valgrind.c:8)==2862== ...==2862== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 4 from 4) 2. åœ¨å†…å­˜é‡Šæ”¾åè¿›è¡Œè¯»å†™#include stdio.h#include stdlib.hint main(void) char *p = malloc(1); *p = a; free(p); // å…ˆé‡Šæ”¾å†…å­˜ char c = *p; // å†æ¬¡è®¿é—®å·²é‡Šæ”¾å†…å­˜ printf( [%c] ,c); return 0; è¿è¡Œä¸Šé¢çš„ä»£ç åï¼Œå¾—åˆ°äº†ä»¥ä¸‹ç»“æœï¼ŒMemcheck æŠ¥å‘Šäº†ä¸€ä¸ªæ— æ•ˆè¯»å–ï¼š $ valgrind --tool=memcheck ./val==2849== Invalid read of size 1==2849== at 0x400603: main (valgrind.c:30)==2849== Address 0x51b0040 is 0 bytes inside a block of size 1 freed 3. ä»å·²åˆ†é…å†…å­˜å—å°¾éƒ¨è¿›è¡Œè¯»å†™#include stdio.h#include stdlib.hint main(void) char *p = malloc(1); *p = a; char c = *(p + 1); // è®¿é—®è¶…å‡ºåˆ†é…çš„å†…å­˜ printf( [%c] ,c); free(p); return 0; è¯¥ä»£ç åŒæ ·ä¼šå¼•å‘å†…å­˜è¯»å–é—®é¢˜ï¼š $ valgrind --tool=memcheck ./val==2835== Invalid read of size 1==2835== at 0x4005D9: main (valgrind.c:25) 4. å†…å­˜æ³„æ¼#include stdio.h#include stdlib.hint main(void) char *p = malloc(1); *p = a; // è¿˜æœªé‡Šæ”¾ï¼Œå†…å­˜æ³„æ¼ return 0; è¿è¡Œæ­¤ä»£ç æ—¶ï¼ŒMemcheck ä¼šæŠ¥å‘Šæ£€æµ‹åˆ°å†…å­˜æ³„æ¼ï¼š $ valgrind --tool=memcheck --leak-check=full ./val==2888== LEAK SUMMARY:==2888== definitely lost: 1 bytes in 1 blocks 5. ä¸åŒ¹é…çš„ä½¿ç”¨ malloc/new/new[] å’Œ free/delete/delete[]#include stdio.h#include stdlib.h#include iostreamint main(void) char *p = (char*)malloc(1); delete p; // é”™è¯¯ï¼Œåº”è¯¥ä½¿ç”¨ free() return 0; è¿è¡Œä¸Šè¿°ä»£ç ï¼ŒMemcheck æä¾›äº†æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ï¼š $ valgrind --tool=memcheck --leak-check=full ./val==2972== Mismatched free() / delete / delete [] 6. é‡å¤é‡Šæ”¾å†…å­˜#include stdio.h#include stdlib.hint main(void) char *p = (char*)malloc(1); free(p); free(p); // é‡å¤é‡Šæ”¾ return 0; æ‰§è¡Œåä¼šè¿”å›ä»¥ä¸‹é”™è¯¯ä¿¡æ¯ï¼Œè¡¨æ˜å¯¹åŒä¸€æŒ‡é’ˆè°ƒç”¨äº†ä¸¤æ¬¡é‡Šæ”¾æ“ä½œï¼š $ valgrind --tool=memcheck --leak-check=full ./val==3167== Invalid free() / delete / delete[] åœ¨æœ¬æ–‡ä¸­ï¼Œè¯¦ç»†ä»‹ç»äº† Valgrind å†…å­˜ç®¡ç†æ¡†æ¶ï¼Œå¹¶é€šè¿‡ Memcheck å·¥å…·å±•ç¤ºäº†å®ƒå¦‚ä½•å¸®åŠ©å¼€å‘è€…ç®€åŒ–å†…å­˜ç®¡ç†ï¼Œé¿å…å¸¸è§çš„å†…å­˜é—®é¢˜ã€‚ Valgrind æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œèƒ½å¤Ÿæ£€æµ‹åˆ°è®¸å¤šæ‰‹åŠ¨æ£€æŸ¥ä¸æ˜“å‘ç°çš„å†…å­˜é”™è¯¯ã€‚ å¦‚æœæƒ³åœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ Valgrindï¼ŒQt Creator æä¾›äº†å¯¹ Valgrind çš„å‰ç«¯é›†æˆï¼Œå¯ä»¥è½»æ¾åˆ†æå’Œä¼˜åŒ–ä»£ç ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ KCacheGrind åˆ†æ Valgrind è¾“å‡ºçš„ä¿¡æ¯ï¼Œä»è€Œè¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½ã€‚ åˆ©ç”¨ valgrind å®šä½å†…å­˜æ³„æ¼é—®é¢˜é€šè¿‡å®ä¾‹æ¥çœ‹çœ‹å¦‚ä½•åˆ©ç”¨ Valgrind æ¥å®šä½å†…å­˜æ³„æ¼é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯è¦åˆ†æçš„ç¨‹åºç¤ºä¾‹ï¼š #include stdlib.h#include stdio.hchar* getMemory() char *p = (char *)malloc(30); return p;int main() char *p = getMemory(); p = NULL; return 0; å¯¹äºè¿™æ®µç¨‹åºï¼Œä»»ä½•å¯¹ CC++ æœ‰åŸºæœ¬äº†è§£çš„äººéƒ½èƒ½è½»æ˜“è¯†åˆ«å‡ºå…¶ä¸­çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚getMemory å‡½æ•°åˆ†é…äº† 30 å­—èŠ‚çš„å†…å­˜ï¼Œä½†åœ¨ main å‡½æ•°ä¸­ï¼Œä»…ä»…å°†æŒ‡é’ˆ p è®¾ç½®ä¸º NULLï¼Œå´æ²¡æœ‰é‡Šæ”¾é‚£æ®µå†…å­˜ã€‚æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ Valgrind å·¥å…·è¿›è¡Œæ£€æµ‹ï¼š [root@xxx ~/valgrind-3.8.1/bin]# ./valgrind --tool=memcheck --leak-check=yes --show-reachable=yes ./a.out==19226== Memcheck, a memory error detector==19226== Copyright (C) 2002-2012, and GNU GPLd, by Julian Seward et al.==19226== Using Valgrind-3.8.1 and LibVEX; rerun with -h for copyright info==19226== Command: ./a.out==19226====19226====19226== HEAP SUMMARY:==19226== in use at exit: 30 bytes in 1 blocks==19226== total heap usage: 1 allocs, 0 frees, 30 bytes allocated==19226====19226== 30 bytes in 1 blocks are definitely lost in loss record 1 of 1==19226== at 0x4C278FE: malloc (vg_replace_malloc.c:270)==19226== by 0x4005B5: getMemory() (in /root/valgrind-3.8.1/bin/a.out)==19226== by 0x4005CC: main (in /root/valgrind-3.8.1/bin/a.out)==19226====19226== LEAK SUMMARY:==19226== definitely lost: 30 bytes in 1 blocks==19226== indirectly lost: 0 bytes in 0 blocks==19226== possibly lost: 0 bytes in 0 blocks==19226== still reachable: 0 bytes in 0 blocks==19226== suppressed: 0 bytes in 0 blocks==19226====19226== For counts of detected and suppressed errors, rerun with: -v==19226== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 6 from 6)[root@xxx ~/valgrind-3.8.1/bin]# ä»ä¸Šé¢çš„è¾“å‡ºä¸­å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼ŒgetMemory å‡½æ•°ä¸­è°ƒç”¨ malloc çš„åœ°æ–¹å­˜åœ¨å†…å­˜æ³„æ¼ã€‚è¾“å‡ºä¸­æœ€å·¦è¾¹çš„ 19226 è¡¨ç¤ºè¿›ç¨‹å·ï¼Œè¿™å¯¹äºå¤šè¿›ç¨‹çš„è°ƒè¯•å°¤ä¸ºé‡è¦ã€‚ ç„¶è€Œï¼Œåœ¨ä»£ç é‡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œæ‰‹åŠ¨æŸ¥æ‰¾æ³„æ¼çš„åœ°æ–¹å¯èƒ½ä¼šæ¯”è¾ƒå›°éš¾ã€‚å¯ä»¥ä½¿ç”¨ Valgrind æä¾›çš„æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œæ¥æ ‡è¯†å‡ºå‘ç”Ÿå†…å­˜æ³„æ¼çš„ä»£ç è¡Œã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œéœ€è¦åœ¨ç¼–è¯‘æ—¶åŠ å…¥ -g å‚æ•°ï¼Œå¹¶ä¸”ç¡®ä¿ç¼–è¯‘åçš„ç¨‹åºæ²¡æœ‰è¢« strip å¤„ç†ã€‚å¯ä»¥è¿™æ ·åšï¼š [root@xxx ~/valgrind-3.8.1/bin]# g++ -g test.cpp[root@xxx ~/valgrind-3.8.1/bin]#[root@xxx ~/valgrind-3.8.1/bin]# ./valgrind --tool=memcheck --leak-check=yes --show-reachable=yes ./a.out==20448== Memcheck, a memory error detector==20448== Copyright (C) 2002-2012, and GNU GPLd, by Julian Seward et al.==20448== Using Valgrind-3.8.1 and LibVEX; rerun with -h for copyright info==20448== Command: ./a.out==20448====20448====20448== HEAP SUMMARY:==20448== in use at exit: 30 bytes in 1 blocks==20448== total heap usage: 1 allocs, 0 frees, 30 bytes allocated==20448====20448== 30 bytes in 1 blocks are definitely lost in loss record 1 of 1==20448== at 0x4C278FE: malloc (vg_replace_malloc.c:270)==20448== by 0x4005B5: getMemory() (test.cpp:5)==20448== by 0x4005CC: main (test.cpp:11)==20448====20448== LEAK SUMMARY:==20448== definitely lost: 30 bytes in 1 blocks==20448== indirectly lost: 0 bytes in 0 blocks==20448== possibly lost: 0 bytes in 0 blocks==20448== still reachable: 0 bytes in 0 blocks==20448== suppressed: 0 bytes in 0 blocks==20448====20448== For counts of detected and suppressed errors, rerun with: -v==20448== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 6 from 6)[root@xxx ~/valgrind-3.8.1/bin]# å¯ä»¥çœ‹åˆ°ï¼Œè¾“å‡ºä¸­å·²ç»æ˜¾ç¤ºäº†å…·ä½“çš„æ–‡ä»¶åå’Œè¡Œå·ã€‚ä¾‹å¦‚ï¼ŒgetMemory å‡½æ•°åœ¨ test.cpp çš„ç¬¬ 5 è¡Œï¼Œmain å‡½æ•°åœ¨ç¬¬ 11 è¡Œã€‚è¿™äº›ä¿¡æ¯æå¤§åœ°æ–¹ä¾¿äº†å¼€å‘è€…è¿…é€Ÿå®šä½é—®é¢˜ã€‚ ä¿®å¤å†…å­˜æ³„æ¼åï¼Œä»£ç åº”è¯¥æ”¹ä¸ºï¼š #include stdlib.h#include stdio.hchar* getMemory() char *p = (char *)malloc(30); return p;int main() char *p = getMemory(); if (p != NULL) free(p); p = NULL; return 0; åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œåœ¨ç¡®å®š p ä¸ä¸º NULL æ—¶ä½¿ç”¨ free å‡½æ•°é‡Šæ”¾äº†ä¹‹å‰åˆ†é…çš„å†…å­˜ã€‚ç°åœ¨å†æ¬¡ä½¿ç”¨ Valgrind æ£€æµ‹ä¸€ä¸‹ï¼š [root@xxx ~/valgrind-3.8.1/bin]# g++ -g test.cpp[root@xxx ~/valgrind-3.8.1/bin]#[root@xxx ~/valgrind-3.8.1/bin]# ./valgrind --tool=memcheck --leak-check=yes --show-reachable=yes ./a.out==21033== Memcheck, a memory error detector==21033== Copyright (C) 2002-2012, and GNU GPLd, by Julian Seward et al.==21033== Using Valgrind-3.8.1 and LibVEX; rerun with -h for copyright info==21033== Command: ./a.out==21033====21033====21033== HEAP SUMMARY:==21033== in use at exit: 0 bytes in 0 blocks==21033== total heap usage: 1 allocs, 1 frees, 30 bytes allocated==21033====21033== All heap blocks were freed -- no leaks are possible==21033====21033== For counts of detected and suppressed errors, rerun with: -v==21033== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 6 from 6)[root@xxx ~/valgrind-3.8.1/bin]# æ£€éªŒç»“æœæ˜¾ç¤ºæ²¡æœ‰å†…å­˜æ³„æ¼äº†ï¼Œæ‰€æœ‰åˆ†é…çš„å†…å­˜å—éƒ½æˆåŠŸé‡Šæ”¾ã€‚è¿™æ„å‘³ç€çš„ä»£ç ç°åœ¨æ›´åŠ å®‰å…¨å’Œé«˜æ•ˆï¼Œç¡®ä¿åœ¨å†æ¬¡æ‰§è¡Œæ—¶ä¸ä¼šå¯¼è‡´å†…å­˜çš„æµªè´¹æˆ–æ½œåœ¨çš„å´©æºƒé—®é¢˜ã€‚ ARM äº¤å‰ç¼–è¯‘1. ä¸‹è½½åŠç¼–è¯‘å‡†å¤‡é¦–å…ˆï¼Œéœ€è¦ä¸‹è½½ Valgrind çš„æºä»£ç å¹¶è¿›è¡Œè§£å‹ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š wget http://valgrind.org/downloads/valgrind-3.12.0.tar.bz2tar xvf valgrind-3.12.0.tar.bz2cd valgrind-3.12.0apt-get install automake./autogen.sh ä¸‹è½½æŒ‡ä»¤è¯´æ˜ï¼šwget ç”¨äºä»äº’è”ç½‘ä¸‹è½½æ–‡ä»¶ï¼Œtar ç”¨äºè§£å‹ç¼©æ‰“åŒ…æ–‡ä»¶ã€‚ ä¾èµ–å·¥å…·ï¼šautomake æ˜¯è‡ªåŠ¨åŒ–ç”Ÿæˆ Makefile çš„å·¥å…·ï¼Œç¡®ä¿çš„ç³»ç»Ÿä¸­å®‰è£…äº†å®ƒã€‚ åˆå§‹åŒ–è„šæœ¬ï¼š./autogen.sh ä¼šåˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œä½¿åç»­ç¼–è¯‘æ­¥éª¤é¡ºåˆ©è¿›è¡Œã€‚ 2. äº¤å‰ç¼–è¯‘åœ¨é…ç½®é˜¶æ®µï¼Œéœ€è¦å¯¹ configure æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥é€‚åº” ARM æ¶æ„ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š vi configure # ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ configure æ–‡ä»¶ æ‰¾åˆ°å¦‚ä¸‹è¡Œï¼š armv7*) å°†å…¶ä¿®æ”¹ä¸ºï¼š armv7*|arm) æ¥ä¸‹æ¥ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œé…ç½®å’Œç¼–è¯‘ï¼š ./configure --host=arm-linux CC=arm-none-linux-gnueabi-gcc CPP=arm-none-linux-gnueabi-cpp CXX=arm-none-linux-gnueabi-g++makemake install --prefix=/home/dcj/valgrind é…ç½®é€‰é¡¹è¯´æ˜ï¼š --host=arm-linuxï¼šæŒ‡å®šç›®æ ‡å¹³å°æ˜¯ ARMã€‚ CC=arm-none-linux-gnueabi-gccï¼šæŒ‡å®šäº¤å‰ç¼–è¯‘å™¨ã€‚ --prefix=/home/dcj/valgrindï¼šæŒ‡æ˜å®‰è£…è·¯å¾„ï¼Œç¡®ä¿ä¸å¼€å‘æ¿ä¸Šç›®å½•ä¸€è‡´ã€‚ æˆåŠŸåï¼Œåœ¨ /home/dcj/valgrind ç›®å½•ä¸‹ä¼šç”Ÿæˆå››ä¸ªé‡è¦çš„å­ç›®å½•ï¼šbinã€includeã€lib å’Œ shareã€‚ç¡®ä¿è¿™äº›æ–‡ä»¶èƒ½å¤Ÿåœ¨çš„å¼€å‘ç¯å¢ƒä¸­æ‰¾åˆ°ã€‚ å¦‚æœä¸æŒ‰é¢„æœŸè®¾ç½® --prefixï¼Œåœ¨è¿è¡Œ Valgrind æ—¶å¯èƒ½ä¼šå‡ºç°é”™è¯¯æç¤ºï¼š valgrind: failed to start tool â€˜memcheckâ€™ for platform â€˜arm-linuxâ€™: No such file or directory 3. è¿è¡Œå°†å®‰è£…å¥½çš„ Valgrind ç›®å½•é€šè¿‡ WinSCP å·¥å…·å¤åˆ¶åˆ°ç›®æ ‡æ¿çš„ /home/dcj/ ä¸‹ã€‚å®Œæˆåï¼Œéœ€è¦ä¸º bin ç›®å½•ä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶ç»™äºˆæ‰§è¡Œæƒé™ï¼š chmod -R +x /home/dcj/valgrind/bin/ æ­¤æ—¶ï¼Œå¦‚æœåœ¨å°è¯•è¿è¡Œ bin ç›®å½•ä¸‹çš„ valgrind æ—¶æ”¶åˆ°å¦‚ä¸‹é”™è¯¯ï¼š valgrind: failed to start tool memcheck for platform arm-linux: Permission denied è§£å†³æ–¹æ³•ï¼šè¿™æ˜¯å› ä¸º Valgrind çš„åº“æ–‡ä»¶æƒé™ä¸è¶³ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ä¿®å¤ï¼š export VALGRIND_LIB=/home/dcj/valgrind/lib/valgrind chmod -R +x /home/dcj/valgrind/lib/valgrind/ ç¯å¢ƒå˜é‡è®¾ç½®ï¼šé€šè¿‡ export å£°æ˜ç¯å¢ƒå˜é‡ï¼ŒValgrind èƒ½å¤Ÿæ‰¾åˆ°å…¶å¿…è¦çš„åº“æ–‡ä»¶ã€‚ æƒé™ä¿®æ”¹ï¼šç¡®ä¿æ‰€æœ‰æ–‡ä»¶éƒ½æœ‰é€‚å½“çš„æ‰§è¡Œä¸è®¿é—®æƒé™ï¼Œè¿™æ · Valgrind æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚ å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œä¾¿å¯ä»¥åœ¨ ARM ä¸Šè¿è¡Œ Valgrind è¿›è¡Œå†…å­˜æ³„æ¼ç­‰é—®é¢˜æ£€æŸ¥ã€‚ è¡¥å……Valgrind æ— æ³•å‘ç°çš„é—®é¢˜Valgrind æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å†…å­˜è°ƒè¯•å·¥å…·ï¼Œç„¶è€Œï¼Œå®ƒå­˜åœ¨ä¸€äº›æ˜¾è‘—çš„å±€é™æ€§ã€‚ä¸»è¦çš„é—®é¢˜ä¹‹ä¸€æ˜¯ï¼Œå®ƒæ— æ³•æ£€æŸ¥åœ¨æ ˆä¸Šåˆ†é…çš„é™æ€æ•°ç»„çš„è¾¹ç•Œã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹ä»£ç ï¼š int main() char x[10]; x[11] = a; // è¶Šç•Œå†™å…¥ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œx æ˜¯ä¸€ä¸ªå¤§å°ä¸º 10 çš„å­—ç¬¦æ•°ç»„ã€‚ç„¶è€Œï¼Œç¨‹åºå°è¯•è®¿é—® x[11]ï¼Œè¿™ä¼šå¯¼è‡´è¶Šç•Œå†™å…¥ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™ç§é”™è¯¯å¯èƒ½ä¼šå¯¼è‡´ä¸å¯é¢„æµ‹çš„è¡Œä¸ºï¼ŒåŒ…æ‹¬æ•°æ®æŸåæˆ–ç¨‹åºå´©æºƒã€‚ç„¶è€Œï¼ŒValgrind å¹¶ä¸ä¼šå‘å‡ºè­¦å‘Šã€‚è¿™æ˜¯å› ä¸ºé™æ€æ•°ç»„æ˜¯åœ¨æ ˆä¸Šåˆ†é…çš„ï¼ŒValgrind å¹¶ä¸è·Ÿè¸ªæ ˆå†…å­˜çš„è¾¹ç•Œã€‚ ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯å°†é™æ€æ•°ç»„è½¬æ¢ä¸ºåŠ¨æ€åˆ†é…çš„å†…å­˜ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ malloc æ¥åˆ†é…å†…å­˜ï¼Œä½†è¦æ³¨æ„åœ¨ä½¿ç”¨å®Œåè°ƒç”¨ free æ¥é˜²æ­¢å†…å­˜æ³„æ¼ã€‚æ¯”å¦‚ï¼š int main() char *x = (char *)malloc(10 * sizeof(char)); // åŠ¨æ€åˆ†é…å†…å­˜ if (x == NULL) return 1; // æ£€æŸ¥å†…å­˜åˆ†é…æ˜¯å¦æˆåŠŸ x[11] = a; // ä»ç„¶æ˜¯è¶Šç•Œå†™å…¥ï¼Œä½†Valgrindä¼šæ•æ‰åˆ° free(x); // é‡Šæ”¾å†…å­˜ å°½ç®¡è¿™æ ·å¯ä»¥è®© Valgrind èƒ½å¤Ÿæ£€æµ‹å‡ºé—®é¢˜ï¼Œä½†åŠ¨æ€åˆ†é…çš„å†…å­˜å¯èƒ½å¼•å…¥å…¶ä»–é—®é¢˜ï¼Œå¦‚æœªé‡Šæ”¾çš„å†…å­˜ï¼ˆunfreed memoryï¼‰ï¼Œä»è€Œå¢åŠ å†…å­˜ç®¡ç†çš„å¤æ‚æ€§ã€‚ é¢å¤–çš„è­¦å‘Šä¿¡æ¯Valgrind çš„ä¸€ä¸ªæ˜¾è‘—ç¼ºç‚¹æ˜¯å®ƒæ¶ˆè€—çš„å†…å­˜é‡ï¼Œé€šå¸¸æ˜¯æºç¨‹åºéœ€æ±‚çš„ä¸¤å€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœçš„ç¨‹åºéœ€è¦ 100MB çš„å†…å­˜ï¼ŒValgrind å¯èƒ½ä¼šä½¿å…¶æ¶ˆè€—é«˜è¾¾ 200MBã€‚è¿™åœ¨æ£€æµ‹å¤§å‹å†…å­˜é—®é¢˜æ—¶å¯èƒ½ä¼šå¼•å‘é—®é¢˜ã€‚ æ­¤å¤–ï¼ŒValgrind çš„è¿è¡Œæ—¶é—´æ¯”æ™®é€šæ‰§è¡Œç¨‹åºè¦é•¿ï¼Œé€šå¸¸æ˜¯å› ä¸ºå®ƒéœ€è¦è¿›è¡Œæ·±åº¦å†…å­˜æ£€æŸ¥ã€‚è¿™å¯¹äºé€šå¸¸è¿è¡Œè¾ƒå¿«çš„ç¨‹åºæ¥è¯´ï¼Œå¯èƒ½ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†å¯¹äºæœ¬èº«æ‰§è¡Œé€Ÿåº¦è¾ƒæ…¢çš„ç¨‹åºï¼Œè¿™å¯èƒ½ä¼šå¼•èµ·å¾ˆå¤§çš„å›°æ‰°ã€‚ä¾‹å¦‚ï¼Œä¸€æ®µåŸæœ¬åœ¨åç§’å†…å®Œæˆçš„ç¨‹åºï¼Œä½¿ç”¨ Valgrind åï¼Œå¯èƒ½éœ€è¦ååˆ†é’Ÿæˆ–æ›´é•¿æ—¶é—´ã€‚ è¿™ç§å†…å­˜æ¶ˆè€—å’Œè¿è¡Œæ—¶é—´çš„å¢åŠ ï¼Œå¯¹äºå¼€å‘äººå‘˜åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­æ¥è¯´ï¼Œå¯èƒ½éœ€è¦å¹³è¡¡ä¸¥è°¨çš„å†…å­˜æ£€æŸ¥ä¸å¼€å‘æ•ˆç‡ä¹‹é—´çš„å…³ç³»ã€‚æ‰€ä»¥ï¼Œå¯¹äºåœ¨è¾ƒå¤§é¡¹ç›®ä¸­é¢‘ç¹é‡åˆ°å†…å­˜é—®é¢˜çš„å¼€å‘è€…æ¥è¯´ï¼Œåˆç†é€‰æ‹©ä½¿ç”¨ Valgrind çš„æ—¶æœºï¼Œå°†æ˜¯æé«˜å·¥ä½œæ•ˆç‡çš„å…³é”®ã€‚","categories":["6.å¼€å‘å·¥å…·","è°ƒè¯•"]},{"title":"å†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·æ¯”è¾ƒ","path":"/2024/01/09/6-å¼€å‘å·¥å…·-è°ƒè¯•-å†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·æ¯”è¾ƒ/","content":"å†…å­˜æ³„éœ²æ£€æµ‹å·¥å…·æ¯”è¾ƒ å†…å­˜æ³„éœ²å’Œ malloc è°ƒè¯•åº“ åœ¨ Linux å’Œ Solaris ä¸‹ï¼Œé’ˆå¯¹ C å’Œ C++ ç¨‹åºçš„ç®€å•å†…å­˜æ³„éœ²æ£€æµ‹ã€‚é€šè¿‡ä½¿ç”¨è¿™ä¸€åº“ï¼Œå¼€å‘è€…å¯ä»¥æ–¹ä¾¿åœ°è·Ÿè¸ªå†…å­˜åˆ†é…å’Œé‡Šæ”¾ï¼Œä»¥è¯†åˆ«æ½œåœ¨çš„æ³„éœ²ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è¿½è¸ªæ¯æ¬¡ malloc() çš„è°ƒç”¨ï¼ŒæŸ¥æ‰¾æ²¡æœ‰ç›¸åº” free() çš„å†…å­˜å—ã€‚ Debug Malloc Library è¿™æ˜¯ä¸€ç§ä¸“ç”¨çš„è°ƒè¯•åº“ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½å†…å­˜é—®é¢˜ã€‚é€šè¿‡è®°å½•æ¯ä¸ªåˆ†é…çš„å†…å­˜å—å’Œå¯¹åº”çš„è°ƒç”¨æ ˆï¼Œå®ƒèƒ½æ˜¾ç¤ºä½•æ—¶åŠä¸ºä½•å‘ç”Ÿå†…å­˜æ³„éœ²ã€‚ Bruce Perens çš„ malloc() è°ƒè¯•åº“ ç‰¹åˆ«è®¾è®¡ç”¨äº Linux åˆ†å‘ç‰ˆï¼ŒBruce Perens å¼€å‘çš„æ­¤åº“æä¾›äº†å†…å­˜åˆ†é…çš„è°ƒè¯•åŠŸèƒ½ï¼Œå…è®¸ç¨‹åºå‘˜æ£€æµ‹åŠ¨æ€å†…å­˜åˆ†é…è¿‡ç¨‹ä¸­çš„é—®é¢˜ã€‚ Linux ä¸‹çš„å†…å­˜æ³„æ¼æ£€æµ‹ç¨‹åº æä¾›å¤šç§å·¥å…·ç”¨äºåˆ†æ Linux ç¯å¢ƒä¸­ç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡è¿™äº›å·¥å…·è½»æ¾æŸ¥æ‰¾æ— ç”¨çš„å†…å­˜å¼•ç”¨ï¼Œä»¥æé«˜æœ€ç»ˆäº§å“çš„ç¨³å®šæ€§ã€‚ è·¨å¹³å°çš„å†…å­˜æ³„æ¼åˆ†æå·¥å…· åœ¨ Linuxã€Solaris å’Œ HP-UX å¹³å°ä¸Šï¼Œèƒ½å¤Ÿæœ‰æ•ˆè¿½è¸ª C++ ç¨‹åºä¸­çš„å†…å­˜æ³„éœ²ã€‚è¿™ç±»å·¥å…·å¾€å¾€å…·æœ‰é«˜åº¦çš„å¯é…ç½®æ€§ï¼Œé€‚åº”ä¸åŒç¼–ç¨‹æ¨¡å‹å’Œç¼–è¯‘ç¯å¢ƒã€‚ Johan Lindh çš„å¼€æº C è¯­è¨€å†…å­˜é”™è¯¯æ£€æµ‹å·¥å…· åˆ©ç”¨ GCC çš„é¢„å¤„ç†å™¨ï¼ŒJohan Lindh å¼€å‘çš„è¿™ä¸€å·¥å…·ä¸“æ³¨äºæ£€æµ‹ C è¯­è¨€ä¸­çš„å†…å­˜é”™è¯¯ã€‚å®ƒä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§ä½å¼€é”€çš„è§£å†³æ–¹æ¡ˆä»¥æé«˜ä»£ç è´¨é‡ã€‚ è°ƒè¯•å’Œæ€§èƒ½åˆ†æå·¥å…· è¿™äº›å·¥å…·ä¸“æ³¨äº Linux ç¨‹åºçš„è°ƒè¯•å’Œæ€§èƒ½åˆ†æï¼Œç‰¹åˆ«æ˜¯ C å’Œ C++ è¯­è¨€çš„åº”ç”¨ç¨‹åºã€‚æ­¤ç±»å·¥å…·é€šå¸¸æä¾›å¯è§†åŒ–çš„æ€§èƒ½æŠ¥å‘Šï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç†è§£ç¨‹åºçš„è¿è¡Œæƒ…å†µã€‚ å¯è§†åŒ–å·¥å…· è¿™ç§å·¥å…·å°†æ€§èƒ½æ•°æ®ä»¥å›¾å½¢åŒ–æ–¹å¼å‘ˆç°ï¼Œå¸®åŠ©å¼€å‘è€…æ›´ç›´è§‚åœ°ç†è§£ç¨‹åºæ‰§è¡Œçš„å†…å­˜ä½¿ç”¨æ¨¡å¼å’Œæ€§èƒ½ç“¶é¢ˆã€‚ Firefox æ‰©å±• ä¸€ä¸ªä¸“é—¨ä¸º Firefox æµè§ˆå™¨è®¾è®¡çš„æ‰©å±•ï¼Œèƒ½å¤Ÿè¯†åˆ«ä¸æµè§ˆå™¨ç›¸å…³çš„å†…å­˜æ³„æ¼ã€‚è¿™å¯¹äºç½‘é¡µå¼€å‘è€…å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºæµè§ˆå™¨çš„å†…å­˜ç®¡ç†ç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒã€‚ Drip å’Œ IE Sieve å†…å­˜æ³„æ¼æ¢æµ‹å™¨ ä¸“ä¸ºç½‘é¡µå¼€å‘è€…è®¾è®¡ï¼Œå¸®åŠ©è¯†åˆ« Internet Explorer ä¸­çš„å†…å­˜æ³„éœ²ã€‚è¿™ä¸¤ç§å·¥å…·å¯ä»¥å±•ç¤ºç”±äº IE çš„é™åˆ¶è€Œå¯¼è‡´çš„å¯é¿å…çš„å†…å­˜æ³„æ¼ï¼Œä»è€Œæé«˜ç½‘é¡µæ€§èƒ½ã€‚ Win32 åº”ç”¨ç¨‹åºèµ„æºæ³„æ¼æ¢æµ‹å™¨ é€šè¿‡ç›‘æ§ Win API è°ƒç”¨ï¼Œè¿™æ¬¾å·¥å…·èƒ½å¤Ÿæ£€æŸ¥ä»»ä½• Win32 åº”ç”¨ç¨‹åºä¸­çš„èµ„æºæ³„æ¼ï¼ŒåŒ…æ‹¬å†…å­˜ã€å¥æŸ„ç­‰ï¼Œå¸®åŠ©å¼€å‘è€…å‘ç°å¹¶è§£å†³é—®é¢˜ã€‚ SAP çš„å†…å­˜åˆ†æè½¯ä»¶ ä½œä¸ºä¸€ç§å¼€æºå·¥å…·ï¼ŒSAP å¯ä»¥è¾…åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½ Java ç¨‹åºä¸­çš„å†…å­˜æ³„æ¼ã€‚å…¶åŸºäº Eclipse RCPï¼ˆRich Client Platformï¼‰ï¼Œæä¾›äº†å‹å¥½çš„ç”¨æˆ·ç•Œé¢ï¼Œç®€åŒ–äº†å†…å­˜ä½¿ç”¨æƒ…å†µçš„åˆ†æã€‚ åŠ¨æ€è·Ÿè¸ªï¼ˆDTraceï¼‰ è¿™æ˜¯ä¸€ä¸ªå¼€æºçš„åŠ¨æ€è·Ÿè¸ªå·¥å…·ï¼Œèƒ½å¤Ÿåœ¨ç±» Unix æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œã€‚é€šè¿‡è·Ÿè¸ªå†…æ ¸å’Œç”¨æˆ·è¿›ç¨‹ï¼Œå¼€å‘è€…èƒ½å¤Ÿå®æ—¶ç›‘æµ‹ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œå¹¶åŠæ—¶è¿›è¡Œè°ƒæ•´ä»¥ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ã€‚ IBM Rational PurifyPlus æ­¤å·¥å…·é›†æˆäº†å†…å­˜é”™è¯¯æ£€æµ‹ã€åº”ç”¨ç¨‹åºæ€§èƒ½æè¿°å’Œä»£ç è¦†ç›–åˆ†æç­‰å¤šç§åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘äººå‘˜å‘ç° CC++ã€.NETã€Java å’Œ VB6 ä»£ç ä¸­çš„æ½œåœ¨é”™è¯¯ï¼Œå¹¶æä¾›å…¨é¢çš„è§£å†³æ–¹æ¡ˆã€‚ Parasoft ä¸“ä¸º CC++ åº”ç”¨ç¨‹åºè®¾è®¡çš„è‡ªåŠ¨æ£€æµ‹å·¥å…·ï¼Œèƒ½å‘ç°ç¨‹åºä¸­çš„å†…å­˜ç ´åã€å†…å­˜æ³„æ¼ã€æŒ‡é’ˆé”™è¯¯å’Œ IO é—®é¢˜ã€‚åˆ©ç”¨ SCI æŠ€æœ¯å’Œå˜å¼‚æµ‹è¯•ç­‰æ–¹æ³•ï¼ŒParasoft æä¾›äº†è¯¦ç»†çš„é”™è¯¯ç—‡çŠ¶å’Œè§£å†³æ–¹æ¡ˆã€‚ Compuware çš„è¿è¡Œæ—¶é”™è¯¯æ£€æµ‹å·¥å…· ä¸º C++ å¼€å‘è€…è®¾è®¡ï¼Œä½œä¸º Microsoft Visual Studio å’Œ C++ 6.0 çš„æ’ä»¶ï¼Œå¸®åŠ©å¼€å‘è€…è¿…é€Ÿå®šä½ç¨‹åºä¸­çš„é”™è¯¯ã€‚ Electric Software è¿™ä¸ªå·¥å…·åŒ…é›†æˆäº†å†…å­˜æ³„æ¼æ£€æŸ¥ã€ä»£ç å‰–æå’Œå‡½æ•°è°ƒç”¨è·Ÿè¸ªç­‰å¤šç§åŠŸèƒ½ï¼Œé€‚ç”¨äº C++ å’Œ .NET å¼€å‘è€…ï¼Œæä¾›å…¨é¢çš„é”™è¯¯è¯Šæ–­å’Œæ€§èƒ½åˆ†æã€‚ Compuware Java åŠŸèƒ½æ¨¡å— åŒ…å« Java å†…å­˜æ£€æµ‹ã€ä»£ç è¦†ç›–ç‡æµ‹è¯•å’Œæ€§èƒ½åˆ†æç­‰å¤šç§åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘è€…å®ç°é«˜æ•ˆçš„ä»£ç ä¼˜åŒ–ä¸æ€§èƒ½æå‡ã€‚ Quest çš„ Java å†…å­˜æ³„æ¼åˆ†æå·¥å…· ä¸“æ³¨äº Java åº”ç”¨ç¨‹åºçš„å†…å­˜ä½¿ç”¨ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿè¯†åˆ«å’Œä¿®å¤å†…å­˜æ³„æ¼ï¼Œæé«˜åº”ç”¨çš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚ ej-technologies çš„ JProfiler ä¸€ä¸ªå…¨é¢çš„ Java æ€§èƒ½ä¸å†…å­˜åˆ†æå·¥å…·ï¼Œæ”¯æŒ J2SE å’Œ J2EE åº”ç”¨ç¨‹åºï¼Œæä¾›ä¸°å¯Œçš„ IDE å’Œåº”ç”¨æœåŠ¡å™¨æ•´åˆåŠŸèƒ½ï¼Œå…¶ç›´è§‚çš„ GUI å¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿè¯†åˆ«æ€§èƒ½ç“¶é¢ˆå’Œå†…å­˜æ³„æ¼ã€‚ BEA çš„å†…å­˜æ³„æ¼è¯Šæ–­å·¥å…· é’ˆå¯¹ Intel å¹³å°ä¼˜åŒ–ï¼Œä¸“æ³¨äº Java å†…å­˜æ³„æ¼çš„æ ¹æœ¬åŸå› ï¼Œæä¾›é«˜æ€§èƒ½çš„å†…å­˜ä½¿ç”¨åˆ†æã€‚ SciTech Software AB ä¸“æ³¨äº C# å’Œ VB.Net ç¨‹åºçš„å†…å­˜æ³„æ¼æ£€æµ‹å’Œä¼˜åŒ–ï¼Œå¸®åŠ©å¼€å‘è€…æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚ YourKit è¢«ä¸šç•Œå¹¿æ³›è®¤å¯çš„ Java å’Œ .NET æ€§èƒ½åˆ†æå·¥å…·ï¼Œèƒ½å¤Ÿæ·±å…¥åˆ†æåº”ç”¨ç¨‹åºæ€§èƒ½ï¼Œå¹¶å®šä½æ½œåœ¨çš„å†…å­˜é—®é¢˜ã€‚ AutomatedQA çš„æ€§èƒ½å‰–æå’Œå†…å­˜è°ƒè¯•å·¥å…· ä¸º .NET å’Œ Windows ç¨‹åºæä¾›è¯¦ç»†çš„æŠ¥å‘Šï¼Œå¸®åŠ©å¼€å‘è€…è¯†åˆ«å’Œè§£å†³æ€§èƒ½å’Œå†…å­˜æ³„æ¼é—®é¢˜ï¼Œå…¼å®¹å¤šç§ç¼–ç¨‹è¯­è¨€å’Œç¼–è¯‘å™¨ã€‚ å¾®è½¯ JavaScript å†…å­˜æ³„æ¼æ¢æµ‹å·¥å…· ç”±å¾®è½¯å…¨çƒäº§å“å¼€å‘å›¢é˜Ÿå‘å¸ƒï¼Œç”¨äºæ¢æµ‹ JavaScript ä»£ç ä¸­çš„å†…å­˜æ³„æ¼ï¼Œä½œä¸º IE æµè§ˆå™¨çš„æ’ä»¶è¿è¡Œï¼Œä¸“é—¨é’ˆå¯¹ web å¼€å‘ä¸­çš„å†…å­˜ç®¡ç†é—®é¢˜ã€‚ é™„å½•ï¼šå†…å­˜æ³„æ¼çš„å‘ç”Ÿæ–¹å¼ å¸¸å‘æ€§å†…å­˜æ³„æ¼å¸¸å‘æ€§å†…å­˜æ³„æ¼æŒ‡çš„æ˜¯æŸæ®µä»£ç åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è¢«åå¤è°ƒç”¨æ—¶ï¼Œæ¯æ¬¡æ‰§è¡Œéƒ½ä¼šå ç”¨é¢å¤–çš„å†…å­˜è€Œæœªèƒ½æ­£å¸¸é‡Šæ”¾ã€‚è¿™ç§æƒ…å†µå¸¸å¸¸å‘ç”Ÿåœ¨å¾ªç¯ç»“æ„æˆ–é€’å½’è°ƒç”¨ä¸­ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ªä¸åœåˆ›å»ºå¯¹è±¡çš„å¾ªç¯ä¸­ï¼Œè‹¥åˆ›å»ºçš„å¯¹è±¡æœªè¢«é”€æ¯ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜å ç”¨æŒç»­å¢åŠ ï¼Œä»è€Œé€ æˆæ³„æ¼ã€‚ å¶å‘æ€§å†…å­˜æ³„æ¼å¶å‘æ€§å†…å­˜æ³„æ¼åˆ™ä¸ç‰¹å®šçš„æ¡ä»¶ç›¸å…³ã€‚åªæœ‰åœ¨ç‰¹å®šçš„æ“ä½œæ¡ä»¶ä¸‹ï¼Œæ‰§è¡ŒæŸæ®µä»£ç æ—¶æ‰å¯èƒ½å‘ç”Ÿå†…å­˜æ³„æ¼ã€‚è¿™ç§æ³„æ¼åœ¨ä¸åŒçš„ç¯å¢ƒä¸­å¯èƒ½è¡¨ç°å¾—æˆªç„¶ä¸åŒã€‚ä¾‹å¦‚ï¼Œåœ¨ç‰¹å®šç‰ˆæœ¬çš„è½¯ä»¶ä¸­ï¼Œç”¨æˆ·æ“ä½œä¸€ç§ç‰¹å®šçš„åŠŸèƒ½å¯èƒ½è§¦å‘å†…å­˜æ³„æ¼ï¼Œè€Œåœ¨å…¶ä»–ç‰ˆæœ¬æˆ–æœªæ‰§è¡Œè¯¥åŠŸèƒ½æ—¶åˆ™ä¸ä¼šã€‚æµ‹è¯•ç¯å¢ƒä¸æµ‹è¯•æ–¹æ³•çš„é€‰æ‹©å¯¹å‘ç°è¿™ç§é—®é¢˜è‡³å…³é‡è¦ï¼Œå·¥ç¨‹å¸ˆé€šå¸¸éœ€è¦æ¨¡æ‹Ÿå„ç§åœºæ™¯ä»¥ç¡®ä¿æ¼æ³„é—®é¢˜è¢«å‘ç°ã€‚ ä¸€æ¬¡æ€§å†…å­˜æ³„æ¼ä¸€æ¬¡æ€§å†…å­˜æ³„æ¼å‘ç”Ÿåœ¨æŸæ®µä»£ç åªè¢«æ‰§è¡Œä¸€æ¬¡çš„æƒ…å†µä¸‹ï¼Œä½†ç”±äºç®—æ³•æˆ–é€»è¾‘ç¼ºé™·ï¼Œä¾ç„¶ä¼šç•™ä¸‹ä¸€å—å†…å­˜æœªè¢«é‡Šæ”¾ã€‚å…¸å‹çš„ä¾‹å­åŒ…æ‹¬ç”±äºæœªé‡Šæ”¾å¤§å¯¹è±¡æˆ–æœªæ¸…ç†å…¨å±€å¼•ç”¨ï¼Œå¯¼è‡´åœ¨ä¸€æ¬¡è¿è¡Œä¸­çš„å†…å­˜æŸå¤±ã€‚ä¾‹å¦‚ï¼Œå¼€å‘äººå‘˜å¯èƒ½åœ¨åˆå§‹åŒ–æ—¶åˆ†é…äº†ä¸€ä¸ªç¼“å†²åŒºï¼Œä½†æœªæ­£ç¡®è§£é™¤å¯¹è¯¥ç¼“å†²åŒºçš„å¼•ç”¨ã€‚ éšå¼å†…å­˜æ³„æ¼éšå¼å†…å­˜æ³„æ¼å¹¶ä¸è¡¨ç°ä¸ºä¼ ç»Ÿæ„ä¹‰ä¸Šçš„â€æ³„æ¼â€ï¼Œå› ä¸ºç¨‹åºåœ¨è¿è¡Œç»“æŸæ—¶ä¼šé‡Šæ”¾æ‰€æœ‰ç”³è¯·çš„å†…å­˜ã€‚ç„¶è€Œï¼Œè‹¥ç¨‹åºéœ€è¦é•¿æ—¶é—´è¿è¡Œï¼Œå¦‚å‡ å¤©æˆ–å‡ å‘¨è€Œä¸é‡Šæ”¾å†…å­˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿæ€»ä½“å†…å­˜è€—å°½ï¼Œä»è€Œäº§ç”Ÿâ€éšå¼â€æ•ˆæœã€‚è¿™åœ¨æœåŠ¡å™¨æˆ–é•¿æœŸè¿è¡Œçš„åº”ç”¨ä¸­å°¤ä¸ºæ£˜æ‰‹ï¼Œä¾‹å¦‚é•¿æ—¶é—´è¿è¡Œçš„æ•°æ®åº“æœåŠ¡ï¼Œè‹¥ä¸å®šæœŸæ¸…ç†å¼•ç”¨ï¼Œå¯èƒ½ä¼šä½¿ç³»ç»Ÿæœ€ç»ˆå´©æºƒã€‚ ä»€ä¹ˆæ˜¯ç³»ç»Ÿèµ„æºï¼Ÿåœ¨ Windows æ“ä½œç³»ç»Ÿä¸­ï¼Œæ¯å½“åº”ç”¨ç¨‹åºå¯åŠ¨å¹¶è¿è¡Œæ—¶ï¼Œç³»ç»Ÿä¸ä»…éœ€è¦æ‰§è¡Œä»£ç ï¼Œè¿˜éœ€è¦éšæ—¶â€è·Ÿè¸ªâ€è¯¥ç¨‹åºçš„çŠ¶æ€ã€‚è¿™åŒ…æ‹¬ç®¡ç†æŒ‰é’®ã€å…‰æ ‡ã€èœå•çš„ä½ç½®ï¼Œä»¥åŠçª—å£çŠ¶å†µç­‰ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯è¢«å­˜å‚¨åœ¨åä¸ºå †ï¼ˆHeapï¼‰çš„å†…å­˜å—ä¸­ã€‚å †æ˜¯ä¸€ç§ç‰¹æ®Šçš„å†…å­˜ç®¡ç†ç»“æ„ï¼Œæœ‰æ•ˆåœ°åˆ†é…å’Œå›æ”¶å†…å­˜èµ„æºã€‚ Windows å°†å †åˆ†ä¸ºä¸¤å¤§ç±»ï¼šç”¨æˆ·èµ„æºå †ï¼ˆUser Resource Heapï¼‰å’ŒGDI èµ„æºå †ï¼ˆGDI Resource Heapï¼‰ã€‚ç”¨æˆ·èµ„æºå †ç”±ç³»ç»Ÿå†…æ ¸ User.exe ç®¡ç†ï¼Œè€Œ GDI èµ„æºå †ç”±ç³»ç»Ÿå†…æ ¸ Gdi.exe ç®¡ç†ã€‚å®ƒä»¬å…±åŒæ„æˆç³»ç»Ÿèµ„æºå †ï¼ˆSystem Resource Heapï¼‰ï¼Œé€šå¸¸åˆç§°ä¸ºç³»ç»Ÿèµ„æºã€‚ èµ„æºå †çš„åˆ†ç±»å¾®è½¯å°† Windows çš„ç³»ç»Ÿèµ„æºåˆ’åˆ†ä¸ºäº”ä¸ªå †ï¼Œå…¶ä¸­ä¸‰ä¸ªå±äºç”¨æˆ·èµ„æºå †ï¼Œä¸¤ä¸ªå±äº GDI èµ„æºå †ï¼š ç”¨æˆ·èµ„æºå † 16 ä½ç”¨æˆ·å †ï¼ˆUser Heapï¼‰: æœ€å¤§ 64KB 32 ä½çª—å£å †ï¼ˆWindows Heapï¼‰: æœ€å¤§ 2MB 32 ä½ç”¨æˆ·èœå•å †ï¼ˆUser Menu Heapï¼‰: æœ€å¤§ 2MB GDI èµ„æºå † 16 ä½ GDI å †ï¼ˆGDI Heapï¼‰: æœ€å¤§ 64KB 32 ä½ GDI å †ï¼ˆGDIï¼‰: æœ€å¤§ 2MB è¿™æ ·çš„åˆ†ç±»å’Œå¤§å°è¯´æ˜äº†ä¸è®º CPU çš„ç§ç±»ï¼ˆå¦‚ P4 æˆ– 486ï¼‰æˆ–å†…å­˜å¤§å°ï¼ˆå¦‚ 8MB æˆ– 1GBï¼‰ï¼Œæ‰€æœ‰ Windows ç”¨æˆ·çš„ç³»ç»Ÿèµ„æºéƒ½ç›¸åŒã€‚ç”¨æˆ·æ— æ³•è‡ªä¸»å¢åŠ æˆ–å‡å°‘è¿™äº›èµ„æºçš„å¤§å°ï¼Œæ“ä½œç³»ç»Ÿå°†å…¶å›ºå®šï¼Œè€Œè¿™ä¸ç¡¬ä»¶çš„æ¡£æ¬¡æ¯«æ— å…³ç³»ã€‚ ä¸ºäº†å®æ—¶ç›‘æ§ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨æƒ…å†µï¼ŒWindows ä»¥ç™¾åˆ†æ¯”çš„å½¢å¼å±•ç¤ºå¯ç”¨ç”¨æˆ·èµ„æºï¼ˆFree User Resourceï¼‰å’Œå¯ç”¨ GDI èµ„æºï¼ˆFree GDI Resourceï¼‰ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡â€å¼€å§‹â€èœå•çš„â€é™„ä»¶â€ä¸­çš„â€ç³»ç»Ÿå·¥å…·â€æ‰¾åˆ°â€ç³»ç»Ÿä¿¡æ¯â€ï¼Œä»¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿèµ„æºçš„çŠ¶æ€ã€‚ åœ¨ Linux å¹³å°ä¸­è°ƒè¯• CC++ å†…å­˜æ³„æ¼æ–¹æ³•C å’Œ C++ ç¨‹åºçš„å†…å­˜ç®¡ç†å®Œå…¨ç”±ç¨‹åºå‘˜è´Ÿè´£ï¼Œä»ç”³è¯·åˆ°é‡Šæ”¾å†…å­˜ï¼Œç¨ä¸æ³¨æ„ä¾¿å¯èƒ½åœ¨ç³»ç»Ÿä¸­å¼•å…¥å†…å­˜é”™è¯¯ã€‚è¿™ç§é”™è¯¯å¾€å¾€åæœä¸¥é‡ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒæˆ–å†…å­˜è€—å°½ç­‰é—®é¢˜ã€‚æœ¬æ–‡å°†ä»‹ç»åœ¨ Linux ç¯å¢ƒä¸­æ£€æµ‹å†…å­˜æ³„æ¼çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬é™æ€åˆ†æå’ŒåŠ¨æ€æ£€æµ‹ä¸¤ä¸ªè§’åº¦ï¼Œé‡ç‚¹è®²è§£é™æ€åˆ†æå·¥å…· BEAMã€åŠ¨æ€æ£€æµ‹å·¥å…· Valgrind å’Œ Rational Purify çš„ä½¿ç”¨æ–¹æ³•ã€‚å¸Œæœ›æœ¬æ–‡èƒ½ä¸ºå¤„ç†å…¶ä»–äº§å“æˆ–é¡¹ç›®ä¸­ä¸å†…å­˜æ³„æ¼ç›¸å…³çš„é—®é¢˜æä¾›å€Ÿé‰´ã€‚ å†…å­˜é—®é¢˜çš„é‡è¦æ€§ç”±äº C å’Œ C++ ç¨‹åºéœ€æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼Œå› æ­¤å†…å­˜é”™è¯¯å¯èƒ½å¯¼è‡´ä¸¥é‡çš„é—®é¢˜ã€‚å†å²ä¸Šï¼Œä»è®¡ç®—æœºåº”æ€¥å“åº”å°ç»„å’Œä¾›åº”å•†å‘å¸ƒçš„å®‰å…¨å…¬å‘Šä¸­ï¼Œè®¸å¤šéƒ½æ˜¯å› å†…å­˜é”™è¯¯å¼•èµ·çš„ã€‚è‡ªä¸Šä¸–çºª 70 å¹´ä»£æœ«æœŸä»¥æ¥ï¼Œç¨‹åºå‘˜ä»¬ä¸€ç›´åœ¨è®¨è®ºè¿™äº›é—®é¢˜ï¼Œå¹¶ä¸”åˆ° 2007 å¹´æ—¶å…¶å½±å“ä¾æ—§æ˜¾è‘—ã€‚ä¸å…¶ä»–ç±»å‹çš„é”™è¯¯ä¸åŒï¼Œå†…å­˜é”™è¯¯é€šå¸¸éšè”½ä¸”éš¾ä»¥é‡ç°ï¼Œå…¶ç—‡çŠ¶å¸¸å¸¸ä¸æ˜“åœ¨æºä»£ç ä¸­è¯†åˆ«ã€‚ä¾‹å¦‚ï¼Œå†…å­˜æ³„æ¼å¯èƒ½å¯¼è‡´åº”ç”¨ç¨‹åºé€æ¸å˜å¾—å“åº”è¿Ÿç¼“ï¼Œæœ€ç»ˆä½¿ç¨‹åºå´©æºƒï¼Œè€Œå†…å­˜çš„æµªè´¹å¹¶ä¸æ€»æ˜¯ç«‹åˆ»æ˜¾è€Œæ˜“è§ã€‚ å†…å­˜é”™è¯¯çš„ C å’Œ C++ ç¨‹åºå¯èƒ½è¡¨ç°ä¸ºä¸åŒçš„é—®é¢˜ï¼šå†…å­˜æ³„æ¼å¯èƒ½å¯¼è‡´ç¨‹åºçš„è¿è¡Œæ—¶é—´è¶Šæ¥è¶Šé•¿ï¼Œè¿›è€Œå´©æºƒï¼›è€Œè¦†ç›–å†…å­˜çš„é—®é¢˜ä½¿å¾—ç¨‹åºå˜å¾—è„†å¼±ï¼Œå®¹æ˜“å—åˆ°æ¶æ„æ”»å‡»ã€‚è¿™äº›é—®é¢˜è¡¨æ˜äº†å¯¹ C å’Œ C++ ç¼–ç¨‹æ—¶å†…å­˜ç®¡ç†ï¼Œå°¤å…¶æ˜¯å†…å­˜æ³„æ¼çš„é‡è§†æ˜¯å¤šä¹ˆé‡è¦ã€‚ æœ¬æ–‡å°†æ¢è®¨å¦‚ä½•å‘ç°å†…å­˜æ³„æ¼ï¼Œæ¥ç€ä½¿ç”¨ä¸åŒå·¥å…·å®šä½è¿™äº›å†…å­˜æ³„æ¼ï¼Œæœ€åå¯¹è¿™äº›å·¥å…·è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶ç®€å•ä»‹ç»èµ„æºæ³„æ¼çš„å¤„ç†ï¼ˆä»¥å¥æŸ„æ³„æ¼ä¸ºä¾‹ï¼‰ã€‚æµ‹è¯•å¹³å°ä¸ºï¼šLinux (Redhat AS4)ï¼Œä½†æ‰€ä»‹ç»çš„æ–¹æ³•å’Œå·¥å…·å¹¶ä¸é™äº CC++ è¯­è¨€å’Œ Linux æ“ä½œç³»ç»Ÿã€‚ å†…å­˜æ³„æ¼çš„å®šä¹‰å†…å­˜æ³„æ¼é€šå¸¸æŒ‡çš„æ˜¯å †å†…å­˜çš„æ³„æ¼ã€‚å †å†…å­˜æ˜¯æŒ‡ç¨‹åºä»å †ä¸­åˆ†é…çš„å†…å­˜ï¼Œå¤§å°å¯ä»¥åœ¨ç¨‹åºè¿è¡ŒæœŸé—´åŠ¨æ€ç¡®å®šï¼Œä½¿ç”¨å®Œåå¿…é¡»æ˜¾å¼é‡Šæ”¾ã€‚è¿™é€šå¸¸é€šè¿‡ mallocã€reallocã€new ç­‰å‡½æ•°è¿›è¡Œå†…å­˜åˆ†é…ã€‚å¿˜è®°ä½¿ç”¨ free æˆ– delete é‡Šæ”¾å†…å­˜ä¼šå¯¼è‡´è¯¥å†…å­˜æ— æ³•å†è¢«åˆ©ç”¨ï¼Œè¿™å°±æ˜¯å…¸å‹çš„å†…å­˜æ³„æ¼ã€‚ 1. å¦‚ä½•å‘ç°å†…å­˜æ³„æ¼å†…å­˜æ³„æ¼åœ¨ä»£ç æ£€æŸ¥è¿‡ç¨‹ä¸­ï¼ŒæŸäº›ç®€å•çš„é—®é¢˜å®¹æ˜“è¢«è¯†åˆ«ã€‚è€Œä¸€äº›è¾ƒä¸ºä¸¥é‡çš„æ³„æ¼ï¼Œå¯èƒ½åœ¨çŸ­æ—¶é—´å†…å¯¼è‡´ç¨‹åºå´©æºƒï¼Œæˆ–åœ¨å†…å­˜ä¸è¶³æ—¶è¢«ç³»ç»ŸæŠ¥å‘Šï¼Œè¿™ä¹Ÿæ˜¯æ¯”è¾ƒå®¹æ˜“å‘ç°çš„ã€‚ç„¶è€Œï¼Œæœ€éš¾å‘ç°çš„æ˜¯é‚£äº›æ³„æ¼æ¯”è¾ƒæ…¢çš„é—®é¢˜ï¼Œéœ€è¦å¤šå¤©ã€å‡ å‘¨ç”šè‡³å‡ ä¸ªæœˆæ‰èƒ½æ˜¾éœ²å‡ºå¼‚å¸¸ç°è±¡ã€‚ è¦åœ¨è¾ƒçŸ­çš„æ—¶é—´å†…æ£€æµ‹æ½œåœ¨çš„å†…å­˜æ³„æ¼ï¼Œå¯ä»¥åˆ©ç”¨å†…å­˜ç›‘è§†å·¥å…·æ”¶é›†ä¸€æ®µæ—¶é—´å†…çš„å †æ ˆå†…å­˜ä¿¡æ¯ï¼Œè§‚å¯Ÿå®ƒçš„å¢é•¿è¶‹åŠ¿ã€‚åœ¨ Linux å¹³å°ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ ps å‘½ä»¤ç›‘è§†å†…å­˜çš„ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ps -aux 2. é™æ€åˆ†æé™æ€åˆ†ææ˜¯ä¸€ç§ä½æˆæœ¬çš„è°ƒè¯•æ–¹æ³•ï¼ŒåŒ…æ‹¬æ‰‹åŠ¨æ£€æµ‹å’Œä½¿ç”¨é™æ€åˆ†æå·¥å…·ã€‚ 2.1 æ‰‹åŠ¨æ£€æµ‹é‡‡ç”¨ä¸€è‡´çš„ç¼–ç¨‹è§„èŒƒæ˜¯é˜²æ­¢å†…å­˜é—®é¢˜çš„ç¬¬ä¸€é“é˜²çº¿ã€‚æ‰‹åŠ¨æ£€æµ‹å¯ä»¥ä½œä¸ºç¼–ç æ ‡å‡†çš„è¡¥å……ã€‚å³ä½¿æ˜¯ä¸“ä¸šçš„ CC++ ç¨‹åºå‘˜ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŸ¥çœ‹ä¸ç†Ÿæ‚‰çš„ä»£ç ï¼Œä»¥éå¸¸ä½çš„æˆæœ¬å¿«é€Ÿè¯†åˆ«å†…å­˜é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡æŸ¥æ‰¾ malloc() å’Œ free()ï¼Œæˆ–è€… new å’Œ delete çš„é…å¯¹ï¼Œå¯ä»¥å‘ç°åƒä»¥ä¸‹ç¤ºä¾‹ä¸­çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚ #include stdio.h#include string.h#include stdlib.hint LeakTest(char * Para) if (NULL == Para) return -1; // ç©ºå‚æ•°å¤„ç† char * Logmsg = new char[128]; // åŠ¨æ€åˆ†é…å†…å­˜ if (NULL == Logmsg) return -2; // å†…å­˜åˆ†é…å¤±è´¥ sprintf(Logmsg,LeakTest routine exit: %s. , Para); // æ­¤å¤„æ¼æ‰äº†é‡Šæ”¾ Logmsg çš„ä»£ç  return 0;int main(int argc, char **argv) char szInit [] = testcase1; LeakTest(szInit); return 0; åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒLogmsg åˆ†é…çš„å†…å­˜æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œå°±é€ æˆäº†å†…å­˜æ³„æ¼ã€‚ 2.2 é™æ€ä»£ç åˆ†æå·¥å…·æœ‰å¤šç§ä»£ç é™æ€åˆ†æå·¥å…·å¯ç”¨ï¼Œä¾‹å¦‚ Splintã€PC-LINT å’Œ BEAMã€‚ç”±äº BEAM æ”¯æŒå¤šç§å¹³å°ï¼Œè¿™é‡Œå°†ä»¥å®ƒä¸ºä¾‹è¿›è¡Œç®€å•ä»‹ç»ã€‚ BEAM èƒ½å¤Ÿæ£€æµ‹å››ç±»é—®é¢˜ï¼šæœªåˆå§‹åŒ–çš„å˜é‡ã€åºŸå¼ƒçš„ç©ºæŒ‡é’ˆã€å†…å­˜æ³„æ¼å’Œå†—ä½™è®¡ç®—ï¼Œä¸”æ”¯æŒå¤šç§å¹³å°ï¼ˆå¦‚ Linux x86ã€s390s390xã€PowerPCã€AIXã€Windows 2000 ä»¥ä¸Šç­‰ï¼‰ã€‚ ä»¥ä¸‹æ˜¯ç”¨äº BEAM åˆ†æçš„ä»£ç ç¤ºä¾‹ï¼š #include stdio.h#include string.h#include stdlib.hint *p;void foo(int a) int b, c; b = 0; if (!p) c = 1; if (c a) c += p[1]; // è¿™å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯int LeakTest(char * Para) char * Logmsg = new char[128]; if ((Para == NULL) || (Logmsg == NULL)) return -1; sprintf(Logmsg, LeakTest routine exit: %s. , Para); // æ¼æ‰äº† Logmsg çš„é‡Šæ”¾ return 0;int main(int argc, char **argv) char szInit [] = testcase1; LeakTest(szInit); return 0; åœ¨ Linux x86 ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ BEAM è¿›è¡Œåˆ†æçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š ./beam-3.4.2/bin/beam_configure --c gcc./beam-3.4.2/bin/beam_configure --cpp g++./beam-3.4.2/bin/beam_compile --beam::compiler=compiler_cpp_config.tcl -cpp code2.cpp ä»ç¼–è¯‘æŠ¥å‘Šä¸­ï¼ŒBEAM ä¼šæç¤ºå‡ ä¸ªé”™è¯¯ï¼Œä¾‹å¦‚å†…å­˜æ³„æ¼å’Œå˜é‡æœªåˆå§‹åŒ–çš„é—®é¢˜ã€‚ 2.3 å†…åµŒç¨‹åºå¯ä»¥é‡è½½å†…å­˜åˆ†é…å’Œé‡Šæ”¾å‡½æ•° new å’Œ deleteï¼Œç¼–å†™ç¨‹åºå®šæœŸç»Ÿè®¡å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾ï¼Œè¿›ä¸€æ­¥æ‰¾å‡ºå†…å­˜æ³„æ¼ã€‚è¿™ç§æ–¹æ³•è¾ƒä¸ºå¤æ‚ï¼Œè¯¦ç»†ç¤ºä¾‹ä¸å†èµ˜è¿°ã€‚ 3. åŠ¨æ€è¿è¡Œæ£€æµ‹ç”¨äºå®æ—¶æ£€æµ‹çš„å·¥å…·ä¸»è¦æœ‰ Valgrind å’Œ Rational Purifyã€‚ 3.1 ValgrindValgrind æä¾›äº†ä¸€ç»„å·¥å…·æ¥å¸®åŠ©ç¨‹åºå‘˜å¯»æ‰¾ç¨‹åºä¸­çš„ bug å¹¶æé«˜æ€§èƒ½ã€‚å…¶ä¸­ï¼ŒMemcheck ä¸»è¦ç”¨äºæ£€æŸ¥ CC++ ç¨‹åºä¸­çš„å†…å­˜ç®¡ç†é”™è¯¯ã€‚Valgrind èƒ½è¯†åˆ«ä»¥ä¸‹å‡ ç§å¸¸è§é”™è¯¯ï¼š è¯»å†™å·²é‡Šæ”¾çš„å†…å­˜ è¯»å†™è¶…å‡ºåˆ†é…èŒƒå›´çš„å†…å­˜ ä½¿ç”¨æœªåˆå§‹åŒ–çš„å˜é‡ å‘ç³»ç»Ÿè°ƒç”¨ä¼ é€’æ— æ•ˆçš„å‚æ•° å†…å­˜æ³„æ¼ 3.2 Rational PurifyRational Purify æ˜¯ä¸€ç§é’ˆå¯¹éš¾ä»¥å‘ç°çš„å†…å­˜é”™è¯¯å’Œè¿è¡Œæ—¶é”™è¯¯çš„å·¥å…·ã€‚å®ƒèƒ½è‡ªåŠ¨è¯†åˆ«é”™è¯¯å¹¶å®šä½ï¼Œä»è€Œå‡å°‘è°ƒè¯•æ—¶é—´ã€‚Purify æ”¯æŒå¤šç§å¹³å°ï¼Œå¹¶å¯å’Œå…¶ä»–ä¸»æµå¼€å‘å·¥å…·é›†æˆã€‚å®ƒå¯ä»¥æ£€æŸ¥æ¯ä¸€ä¸ªæ¨¡å—ï¼Œç”šè‡³èƒ½å‘ç°å¤æ‚å¤šè¿›ç¨‹åº”ç”¨ä¸­çš„é”™è¯¯ã€‚ åœ¨ Linux ä¸Šä½¿ç”¨ Purify æ—¶ï¼Œéœ€é‡æ–°ç¼–è¯‘ç¨‹åºã€‚é€šå¸¸é€šè¿‡ä¿®æ”¹ Makefile ä¸­çš„ç¼–è¯‘å™¨å˜é‡æ¥å®ç°ã€‚ä»¥ä¸‹æ˜¯ç¼–è¯‘ç¤ºä¾‹ Makefileï¼š CC=purify gcc è¿è¡Œ Purify çš„è®¾ç½®è„šæœ¬å¹¶é‡æ–°ç¼–è¯‘ï¼š ./purifyplus_setup.shmake ä¸‹é¢æ˜¯ä½¿ç”¨ Purify å’Œ g++ ç¼–è¯‘ä»£ç æ–‡ä»¶çš„ç¤ºä¾‹å‘½ä»¤ï¼Œä½¿ç”¨ -g é€‰é¡¹æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼š purify g++ -g test3.cpp -o test è¿è¡Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ ./testï¼Œå°±å¯ä»¥å®šä½å‡ºå†…å­˜æ³„æ¼çš„å…·ä½“ä½ç½®ã€‚ #include unistd.hchar * Logmsg;int LeakTest(char * Para) if (NULL == Para) return -1; // ç©ºå‚æ•°å¤„ç† Logmsg = new char[128]; for (int i = 0; i 128; i++) Logmsg[i] = i % 64; // æ•°æ®å¡«å…… if (NULL == Logmsg) return -2; // å†…å­˜åˆ†é…å¤±è´¥ sprintf(Logmsg, LeakTest routine exit: %s. , Para); // å¿½ç•¥é‡Šæ”¾ Logmsg çš„ä»£ç  return 0;int main(int argc, char **argv) char szInit [] = testcase1; LeakTest(szInit); for (int i = 0; i 2; i++) if (i % 200 == 0) LeakTest(szInit); sleep(1); return 0; è®°ä½ï¼Œç¨‹åºå¿…é¡»ä»¥è°ƒè¯•ç‰ˆæœ¬ç¼–è¯‘ï¼Œæ‰èƒ½å‡†ç¡®å®šä½åˆ°å†…å­˜æ³„æ¼å‘ç”Ÿçš„å…·ä½“ä»£ç è¡Œã€‚ä½¿ç”¨ -g é€‰é¡¹è¿›è¡Œç¼–è¯‘æ˜¯å¿…è¦çš„ã€‚","categories":["6.å¼€å‘å·¥å…·","è°ƒè¯•"]},{"title":"å¸¸è§çš„å†…å­˜é—®é¢˜","path":"/2024/01/08/6-å¼€å‘å·¥å…·-è°ƒè¯•-å¸¸è§çš„å†…å­˜é—®é¢˜/","content":"åˆ©ç”¨ Memcheck å‘ç°å¸¸è§çš„å†…å­˜é—®é¢˜åœ¨ Linux å¹³å°å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œå¼€å‘è€…ç»å¸¸ä¼šé‡åˆ°å†…å­˜ä½¿ç”¨ä¸å½“çš„é—®é¢˜ã€‚æ€»ç»“äº†ä¸€äº›å¸¸è§çš„å†…å­˜é”™è¯¯ï¼Œå¹¶è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨ Valgrind çš„ Memcheck å·¥å…·æ¥æ£€æµ‹è¿™äº›é”™è¯¯ã€‚ ä½¿ç”¨æœªåˆå§‹åŒ–çš„å†…å­˜åœ¨ç¨‹åºçš„ä¸åŒä¸Šä¸‹æ–‡ä¸­ï¼Œå˜é‡çš„åˆå§‹å€¼å­˜åœ¨å·®å¼‚ã€‚å…¨å±€å˜é‡å’Œé™æ€å˜é‡çš„åˆå§‹å€¼ä¸º 0ï¼Œè€Œå±€éƒ¨å˜é‡å’ŒåŠ¨æ€åˆ†é…çš„å˜é‡åˆ™å…·æœ‰ä¸ç¡®å®šçš„éšæœºå€¼ã€‚å¦‚æœç¨‹åºæ„å¤–åœ°ä½¿ç”¨äº†è¿™äº›éšæœºå€¼ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºè¡Œä¸ºä¸å¯é¢„æµ‹ã€‚ ç¤ºä¾‹è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ä»£ç ï¼š #include stdio.hvoid example() int a[5]; // a æ˜¯å±€éƒ¨å˜é‡ï¼Œå…¶æ‰€æœ‰åˆå§‹å€¼ä¸ºéšæœºå€¼ printf(%d , a[0]); // ä½¿ç”¨æœªåˆå§‹åŒ–çš„å˜é‡ a[0] åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ•°ç»„ a æ˜¯ä¸€ä¸ªå…·æœ‰éšæœºåˆå§‹å€¼çš„å±€éƒ¨å˜é‡ï¼Œè‹¥åœ¨æœªå¯¹å…¶è¿›è¡Œåˆå§‹åŒ–çš„æƒ…å†µä¸‹ç›´æ¥ä½¿ç”¨ï¼Œå°†ä¼šå¸¦æ¥ä¸å¯é¢„æµ‹çš„è¾“å‡ºã€‚å‡è®¾è¿™ä¸ªæ–‡ä»¶åä¸º badloop.cï¼Œç”Ÿæˆçš„å¯æ‰§è¡Œç¨‹åºåä¸º badloopã€‚ç”¨ Memcheck å¯¹å…¶æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š ==12345== Use of uninitialized value of size 4==12345== at 0x4005A1: example (badloop.c:5) è¾“å‡ºç»“æœæ˜¾ç¤ºï¼Œåœ¨ç¨‹åºçš„ç¬¬ 5 è¡Œä¸­ï¼Œç¨‹åºçš„è·³è½¬ä¾èµ–äºä¸€ä¸ªæœªåˆå§‹åŒ–çš„å˜é‡ã€‚è¿™å‡†ç¡®åœ°å¸®åŠ©å‘ç°äº†é—®é¢˜ã€‚ å†…å­˜è¯»å†™è¶Šç•Œé—®é¢˜åˆ†æå†…å­˜è¯»å†™è¶Šç•Œæ˜¯æŒ‡å¯¹ä¸è¯¥è®¿é—®çš„å†…å­˜åœ°å€è¿›è¡Œè¯»å†™æ“ä½œï¼Œä¾‹å¦‚æ•°ç»„è¶Šç•Œæˆ–å¯¹åŠ¨æ€åˆ†é…çš„å†…å­˜è¶…å‡ºèŒƒå›´çš„è®¿é—®ã€‚è¿™æ ·çš„æ“ä½œå¯èƒ½å¯¼è‡´å¯¹ç¨‹åºçŠ¶æ€çš„ä¸¥é‡å½±å“ã€‚ ç¤ºä¾‹å…¸å‹çš„æ•°ç»„è¶Šç•Œä»£ç å¦‚ä¸‹ï¼š #include iostreamvoid example() int pt[4]; int *p = pt; // pæŒ‡å‘ptæ•°ç»„çš„èµ·å§‹åœ°å€ for (int i = 0; i 5; i++) p[i] = i; // è¶…å‡ºptæ•°ç»„çš„èŒƒå›´ å½“è¿è¡Œè¿™ä¸ªæ–‡ä»¶ badacc.cpp å¹¶ç”¨ Memcheck æµ‹è¯•æ—¶ï¼Œç»“æœå¦‚ä¸‹ï¼š ==12345== Invalid write of size 4==12345== at 0x4005A1: example (badacc.cpp:6)==12345== Address 0x602010 is 4 bytes after a block of size 16 allocd è¾“å‡ºç»“æœè¡¨æ˜ï¼Œåœ¨è¯¥ç¨‹åºçš„ç¬¬ 6 è¡Œï¼Œè¿›è¡Œäº†éæ³•çš„å†™æ“ä½œï¼Œè¿™å¸®åŠ©å‡†ç¡®åœ°å‘ç°äº†è¯¥é—®é¢˜ã€‚ å†…å­˜è¦†ç›–é—®é¢˜åˆ†æC è¯­è¨€å…è®¸ç›´æ¥æ“ä½œå†…å­˜ï¼Œè¿™ç§ç‰¹æ€§è™½ç„¶å¼ºå¤§ï¼Œä½†ä¹Ÿå¯èƒ½å¯¼è‡´å†…å­˜è¦†ç›–é”™è¯¯ã€‚å½“æºåœ°å€å’Œç›®æ ‡åœ°å€é‡å æ—¶ï¼Œæ“ä½œçš„ç»“æœå¯èƒ½ä¸å¦‚é¢„æœŸã€‚ ç¤ºä¾‹çœ‹çœ‹ä¸‹åˆ—ä»£ç ï¼š #include cstringvoid example(char* x) strcpy(x + 10, x); // src å’Œ dst å‘ç”Ÿé‡å  åœ¨è¿™é‡Œï¼Œsrc å’Œ dst æŒ‡å‘ç›¸äº’é‡å çš„å†…å­˜åŒºåŸŸï¼Œè°ƒç”¨ strcpy æ—¶å¯èƒ½è¦†ç›–ä¹‹å‰çš„å€¼ã€‚å‡è®¾è¿™ä¸ªæ–‡ä»¶åä¸º badlap.cppï¼Œæµ‹è¯•è¾“å‡ºå¦‚ä¸‹ï¼š ==12345== Invalid write of size 1==12345== at 0x4005A1: example (badlap.cpp:4) è¾“å‡ºè¡¨æ˜åœ¨ç¬¬ 4 è¡Œæœ‰éæ³•å†™æ“ä½œï¼Œå¯ä»¥æœ‰æ•ˆè¯†åˆ«è¯¥å†…å­˜è¦†ç›–é—®é¢˜ã€‚ åŠ¨æ€å†…å­˜ç®¡ç†é”™è¯¯é—®é¢˜åˆ†æåŠ¨æ€å†…å­˜ç®¡ç†ä¸ä»…æä¾›äº†çµæ´»çš„å†…å­˜æ§åˆ¶èƒ½åŠ›ï¼Œä¹Ÿå®¹æ˜“å¼•å‘é”™è¯¯ã€‚C å’Œ C++ å¯¹åŠ¨æ€å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾æœ‰ä¸åŒçš„æ–¹å¼ï¼Œåº”ä¿æŒä¸€è‡´æ€§ã€‚ ç¤ºä¾‹è€ƒè™‘ä»¥ä¸‹ä»£ç ï¼š void example() int* p = (int*)malloc(sizeof(int)); // ä½¿ç”¨ malloc ç”³è¯·å†…å­˜ delete p; // é”™è¯¯ä½¿ç”¨ delete é‡Šæ”¾å†…å­˜ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”¨ malloc ç”³è¯·çš„å†…å­˜ï¼Œä½¿ç”¨ delete é‡Šæ”¾ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚æµ‹è¯•è¾“å‡ºå¦‚ä¸‹ï¼š ==12345== Invalid free() / delete / delete[] / realloc()==12345== at 0x4005A1: example (badmac.cpp:5) è¾“å‡ºç»“æœæ˜¾ç¤ºåœ¨ç¬¬ 5 è¡Œï¼Œåˆ†é…å’Œé‡Šæ”¾å‡½æ•°ä¸ä¸€è‡´ï¼ŒæˆåŠŸè¯†åˆ«äº†ä»£ç é—®é¢˜ã€‚ å†…å­˜æ³„éœ²é—®é¢˜æè¿°å†…å­˜æ³„éœ²æŒ‡åœ¨åŠ¨æ€ç”³è¯·å†…å­˜åæœªé‡Šæ”¾ï¼Œå¯¼è‡´è¯¥å†…å­˜ç©ºé—´æ— æ³•è¢«è®¿é—®ã€‚å†…å­˜æ³„éœ²å¸¸åœ¨å¤§å‹é¡¹ç›®ä¸­å‡ºç°ï¼Œå¼€å‘è€…éœ€åŸ¹å…»è‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œä»¥é˜²æ­¢æ­¤ç±»é—®é¢˜ã€‚ ç¤ºä¾‹è€ƒè™‘å¦‚ä¸‹ä»£ç ç¤ºä¾‹ï¼š struct Node int data; Node* left; Node* right;;void mk(Node** root) *root = new Node; // åŠ¨æ€ç”³è¯·å†…å­˜int main() Node* root; mk(root); // æ²¡æœ‰é‡Šæ”¾å†…å­˜ï¼Œé€ æˆå†…å­˜æ³„éœ² æµ‹è¯•è¿™ä¸ªæ–‡ä»¶ badleak.cpp çš„è¾“å‡ºå¦‚ä¸‹ï¼š ==12345== 8 bytes in 1 blocks are definitely lost in loss record 1 of 1 Memcheck æˆåŠŸæ£€æµ‹åˆ°äº†å†…å­˜æ³„éœ²çš„æƒ…å†µï¼Œè¾“å‡ºå¸®åŠ©å‘ç°äº†æœªé‡Šæ”¾çš„å†…å­˜ã€‚ å°ç»“é€šè¿‡ä¸Šè¿°ç¤ºä¾‹å’Œåˆ†æï¼Œå¯ä»¥çœ‹å‡ºåˆ©ç”¨ Memcheck è¯†åˆ«å’Œä¿®å¤å†…å­˜é—®é¢˜çš„å¼ºå¤§åŠŸèƒ½ã€‚å®šæœŸä½¿ç”¨è¿™ä¸€å·¥å…·ï¼Œèƒ½æœ‰æ•ˆæé«˜ç¨‹åºçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚","categories":["6.å¼€å‘å·¥å…·","è°ƒè¯•"]},{"title":"æ®µé”™è¯¯","path":"/2024/01/05/6-å¼€å‘å·¥å…·-è°ƒè¯•-æ®µé”™è¯¯/","content":"æ®µé”™è¯¯æ˜¯ä»€ä¹ˆæ®µé”™è¯¯ï¼Œä¹Ÿç§°ä¸ºâ€åˆ†æ®µé”™è¯¯â€ï¼Œæ˜¯æŒ‡åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè½¯ä»¶è¯•å›¾è®¿é—®çš„å†…å­˜åœ°å€è¶…å‡ºäº†æ“ä½œç³»ç»Ÿä¸ºè¯¥ç¨‹åºæ‰€è®¾å®šçš„æœ‰æ•ˆå†…å­˜ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œè¿™ç§æƒ…å†µå¯èƒ½å‘ç”Ÿåœ¨ç¨‹åºè¯•å›¾è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„å†…å­˜åœ°å€ï¼Œæˆ–è€…éæ³•è®¿é—®ç³»ç»Ÿä¿æŠ¤çš„å†…å­˜åŒºåŸŸï¼Œä»¥åŠå°è¯•å†™å…¥ä¸€ä¸ªåªè¯»å†…å­˜åœ°å€ç­‰ã€‚å¯¹äºâ€æ®µé”™è¯¯â€ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹å‡†ç¡®çš„å®šä¹‰ï¼š â€œåˆ†æ®µé”™è¯¯æ˜¯ä¸€ç§ç‰¹å®šçš„é”™è¯¯çŠ¶æ€ï¼Œä¼šåœ¨è®¡ç®—æœºè½¯ä»¶è¿è¡Œæ—¶å‘ç”Ÿã€‚ç®€è€Œè¨€ä¹‹ï¼Œå½“ç¨‹åºå°è¯•è®¿é—®ä¸€ä¸ªå®ƒæ²¡æœ‰æƒé™è®¿é—®çš„å†…å­˜ä½ç½®ï¼Œæˆ–ä»¥ä¸å…è®¸çš„æ–¹å¼è¿›è¡Œå†…å­˜æ“ä½œï¼ˆå¦‚å†™å…¥åªè¯»ä½ç½®æˆ–é‡å†™æ“ä½œç³»ç»Ÿéƒ¨åˆ†ï¼‰æ—¶ï¼Œå°±ä¼šäº§ç”Ÿæ®µé”™è¯¯ã€‚â€ æ®µé”™è¯¯äº§ç”Ÿçš„åŸå›  è®¿é—®ä¸å­˜åœ¨çš„å†…å­˜åœ°å€ï¼šç¨‹åºå¯èƒ½æŒ‡å‘ä¸€ä¸ªæœªåˆ†é…æˆ–å·²é‡Šæ”¾çš„åœ°å€ï¼Œä¾‹å¦‚ä¸€ä¸ªæœªåˆå§‹åŒ–çš„æŒ‡é’ˆã€‚ int *ptr = NULL;*ptr = 0; // å°è¯•å†™å…¥NULLåœ°å€ è®¿é—®ç³»ç»Ÿä¿æŠ¤çš„å†…å­˜åœ°å€ï¼šå½“ç¨‹åºè¯•å›¾ä¿®æ”¹æˆ–è¯»å–ä¿ç•™ç»™æ“ä½œç³»ç»Ÿçš„æ•°æ®æ—¶ï¼Œä¼šå¯¼è‡´æ®µé”™è¯¯ã€‚ è®¿é—®åªè¯»çš„å†…å­˜åœ°å€ï¼šä¾‹å¦‚ï¼Œç¨‹åºè¯•å›¾å¯¹ä¸€ä¸ªå¸¸é‡å­—ç¬¦ä¸²è¿›è¡Œä¿®æ”¹ï¼Œä¼šäº§ç”Ÿé”™è¯¯ã€‚ char *ptr = test;strcpy(ptr, TEST); // å°è¯•å†™å…¥åªè¯»å†…å­˜ æ ˆæº¢å‡ºï¼šåå¤è°ƒç”¨è‡ªèº«ï¼ˆå¦‚é€’å½’ï¼‰è€Œä¸è®¾ç½®é€‚å½“çš„ç»ˆæ­¢æ¡ä»¶ï¼Œä¼šå¯¼è‡´æ ˆç©ºé—´è€—å°½ã€‚ å…¶ä»–åŸå› ï¼šå¦‚ä½¿ç”¨äº†å·²é‡Šæ”¾çš„å†…å­˜ã€æ•°æ®ç±»å‹è½¬æ¢é”™è¯¯ç­‰ã€‚ æ®µé”™è¯¯ä¿¡æ¯çš„è·å–æ®µé”™è¯¯å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿæ‰€æä¾›çš„é”™è¯¯ä¿¡æ¯é€šå¸¸è¾ƒå°‘ï¼Œä¸ºäº†å‡†ç¡®è¯Šæ–­é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å·¥å…·è·å–è¯¦ç»†ä¿¡æ¯ã€‚ 1. dmesgä½¿ç”¨ dmesg å‘½ä»¤å¯ä»¥æŸ¥çœ‹æœ€è¿‘å‘ç”Ÿçš„ç³»ç»Ÿæ—¥å¿—ï¼ŒåŒ…æ‹¬æ®µé”™è¯¯çš„å…·ä½“ä¿¡æ¯ï¼Œä¾‹å¦‚ç¨‹åºåç§°ã€å†…å­˜åœ°å€ã€æŒ‡ä»¤æŒ‡é’ˆåœ°å€åŠå †æ ˆæŒ‡é’ˆåœ°å€ç­‰ã€‚ $ dmesg[ 2329.479037] segfault3[2700]: segfault at 80484e0 ip 00d2906a sp bfbbec3c error 7 in libc-2.10.1.so[cb4000+13e000] 2. -g å‚æ•°åœ¨ä½¿ç”¨ gcc ç¼–è¯‘ç¨‹åºæ—¶æ·»åŠ  -g å‚æ•°ï¼Œå¯ä»¥åœ¨ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­åŒ…å«ç¬¦å·ä¿¡æ¯ï¼Œæ–¹ä¾¿åç»­è°ƒè¯•ã€‚ $ gcc -g -o segfault3 segfault3.c 3. nmä½¿ç”¨ nm å‘½ä»¤å¯ä»¥åˆ—å‡ºäºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨ï¼ŒåŒ…æ‹¬ç¬¦å·åœ°å€ã€ç±»å‹åŠåç§°ç­‰ï¼Œæœ‰åŠ©äºç¡®å®šå‘ç”Ÿæ®µé”™è¯¯çš„ä½ç½®ã€‚ $ nm segfault308049f20 d _DYNAMIC08049ff4 d _GLOBAL_OFFSET_TABLE_...080483e4 T main 4. lddä½¿ç”¨ ldd å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç¨‹åºä¾èµ–çš„ libã€‚é€šè¿‡å¯è§†åŒ–åº“çš„ä¿¡æ¯ï¼Œå¸®åŠ©ç¡®å®šæ®µé”™è¯¯æ˜¯ç¨‹åºæœ¬èº«å¯¼è‡´ï¼Œè¿˜æ˜¯ä¾èµ–åº“çš„é—®é¢˜ã€‚ $ ldd ./segfault3linux-gate.so.1 = (0x00e08000)libc.so.6 = /lib/tls/i686/cmov/libc.so.6 (0x00675000) æ®µé”™è¯¯çš„è°ƒè¯•æ–¹æ³•1. ä½¿ç”¨ printf è¾“å‡ºä¿¡æ¯åœ¨ç¨‹åºçš„å…³é”®ä»£ç é™„è¿‘åŠ å…¥ printf è¾“å‡ºï¼Œå¯ä»¥å¸®åŠ©è¿½è¸ªç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„çŠ¶æ€ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿå®šä½æ®µé”™è¯¯å‘ç”Ÿçš„ä½ç½®ã€‚ ä¸ºäº†ä¾¿äºä½¿ç”¨ printfï¼Œå¯ä»¥åˆ©ç”¨æ¡ä»¶ç¼–è¯‘ï¼Œåœ¨ç¼–è¯‘æ—¶å†³å®šæ˜¯å¦è¾“å‡ºè°ƒè¯•ä¿¡æ¯ï¼š #ifdef DEBUGprintf(Debug info: ...);#endif 2. ä½¿ç”¨ gcc å’Œ gdb ç¡®ä¿ç¨‹åºåœ¨ç¼–è¯‘æ—¶åŠ ä¸Š -g å‚æ•°ä»¥å¯ç”¨è°ƒè¯•ä¿¡æ¯ã€‚ ä½¿ç”¨ gdb å‘½ä»¤å¯åŠ¨è°ƒè¯•ï¼š $ gdb ./segfault3 è¿è¡Œç¨‹åºåï¼Œè‹¥å‡ºç°æ®µé”™è¯¯ï¼Œgdb ä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼ŒæŒ‡æ˜å‘ç”Ÿé”™è¯¯çš„ä½ç½®ã€‚ Program received signal SIGSEGV, Segmentation fault.0x001a306ain memcpy() from /lib/tls/i686/cmov/libc.so.6 é€šè¿‡ quit å‘½ä»¤ç»“æŸè°ƒè¯•ä¼šè¯ã€‚ 3. ä½¿ç”¨ core æ–‡ä»¶å’Œ gdbåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå½“ç¨‹åºå› æ®µé”™è¯¯è€Œå¼‚å¸¸é€€å‡ºæ—¶ï¼Œè‹¥é…ç½®æ­£ç¡®ï¼Œä¼šç”Ÿæˆä¸€ä¸ª core æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åŒ…å«ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ä¿¡æ¯ï¼Œå¯ä»¥ç”¨ gdb å¯¹å…¶è¿›è¡Œåˆ†æã€‚ æ£€æŸ¥å¹¶å¯èƒ½ä¿®æ”¹ core æ–‡ä»¶ç”Ÿæˆçš„é™åˆ¶ï¼š $ ulimit -c$ ulimit -c unlimited è¿è¡Œç¨‹åºç”Ÿæˆ core æ–‡ä»¶ï¼š $ ./segfault3Segment fault (core dumped) ä½¿ç”¨ gdb åŠ è½½ core æ–‡ä»¶è¿›è¡Œè°ƒè¯•ï¼š $ gdb ./segfault3 core 4. ä½¿ç”¨ objdumpobjdump å¯ä»¥æä¾›ç¨‹åºçš„æ±‡ç¼–ä»£ç ï¼Œä»è€Œè¿›ä¸€æ­¥åˆ†ææ®µé”™è¯¯å‘ç”Ÿçš„æŒ‡ä»¤ã€‚ æŸ¥æ‰¾æœ€è¿‘çš„æ®µé”™è¯¯ä¿¡æ¯ï¼Œå¦‚åœ°å€ã€æŒ‡é’ˆç­‰ã€‚ ä½¿ç”¨ objdump æ¥æŸ¥çœ‹æ±‡ç¼–ç»†èŠ‚ï¼Œå¹¶æ‰¾åˆ°æŒ‡å‘çš„æ±‡ç¼–æŒ‡ä»¤ã€‚ 5. ä½¿ç”¨ catchsegvcatchsegv å‘½ä»¤æ˜¯ä¸“é—¨æ•è·æ®µé”™è¯¯çš„å·¥å…·ï¼Œé€šè¿‡åŠ¨æ€åŠ è½½åº“å®ç°æ•è·å¹¶è¾“å‡ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚ ä¸€äº›æ³¨æ„äº‹é¡¹ è€ƒè™‘é”™è¯¯åŸå› ï¼šåœ¨é¢å¯¹æ®µé”™è¯¯æ—¶ï¼Œé¦–å…ˆæ˜ç¡®æ®µé”™è¯¯çš„å®šä¹‰å¹¶è¿½è¸ªå¼•å‘åŸå› ã€‚ æŒ‡é’ˆåˆå§‹åŒ–ï¼šåœ¨å®šä¹‰æŒ‡é’ˆåï¼Œè¦ç«‹å³åˆå§‹åŒ–ï¼Œä½¿ç”¨å‰ç¡®ä¿å…¶ä¸ä¸º NULLã€‚ æ•°ç»„å®‰å…¨ï¼šç¡®ä¿æ•°ç»„è¢«åˆå§‹åŒ–ï¼Œè®¿é—®æ—¶é¿å…è¶Šç•Œã€‚ å†…å­˜ç®¡ç†ï¼šæ³¨æ„å˜é‡çš„ç”Ÿå­˜å‘¨æœŸï¼Œä¸è¦ä½¿ç”¨å·²é‡Šæ”¾çš„å†…å­˜ã€‚ åˆç†æ§åˆ¶æ ¼å¼ï¼šåœ¨å¤„ç†å˜é‡æ—¶ï¼Œæ§åˆ¶æ ¼å¼åº”å½“åˆç†ï¼Œé¿å…ç±»å‹é”™è¯¯ã€‚","categories":["6.å¼€å‘å·¥å…·","è°ƒè¯•"]},{"title":"CANOpen ç¬”è®°","path":"/2024/01/04/4-é€šè®¯åè®®-CAN-CANOpen-ç¬”è®°/","content":"é¡¹ç›®åœ°å€ CANopenNode https://github.com/CANopenNode/CANopenNode CANopenLinux https://github.com/CANopenNode/CANopenLinux CANopenDemo https://github.com/CANopenNode/CANopenDemo CANopenEditor https://github.com/CANopenNode/CANopenEditor å¸®åŠ©æ–‡æ¡£ CANopenLinux https://canopennode.github.io/CANopenLinux CANopenDemo https://canopennode.github.io/index.html CANopenCANopen æ˜¯ä¸€ç§åŸºäº CANï¼ˆController Area Networkï¼‰ é€šä¿¡åè®®çš„é«˜å±‚åè®®å’Œè®¾å¤‡åè®®ï¼Œå®šä¹‰äº†ç½‘ç»œç®¡ç†ã€è®¾å¤‡é…ç½®ã€é€šä¿¡å¯¹è±¡å’Œåº”ç”¨å¯¹è±¡ç­‰æ–¹é¢çš„æ ‡å‡†ï¼Œä»¥ç¡®ä¿ä¸åŒè®¾å¤‡ä¹‹é—´çš„äº’æ“ä½œæ€§å’Œé€šä¿¡çš„ä¸€è‡´æ€§ã€‚ åè®®CiA é€šè¿‡ä¸€ç³»åˆ—æ–‡ä»¶ç»´æŠ¤ä¿æŒ CANopen è®¾å¤‡å’Œé€šè®¯åè®®è§„å®šã€‚åŸºæœ¬é…ç½®ç”± CiA 301 CANopen åº”ç”¨å±‚å’Œé€šä¿¡é…ç½®è§„èŒƒå®šä¹‰ã€‚è§„èŒƒåŒ…æ‹¬ï¼š CANopen å¯¹è±¡å­—å…¸ä¸­çš„æ•°æ®ç±»å‹ã€ç¼–ç è§„åˆ™å’Œå¯¹è±¡ CANopen é€šä¿¡æœåŠ¡å’Œåè®® CANopen ç½‘ç»œç®¡ç†æœåŠ¡å’Œåè®® CANopen é€šè®¯é…ç½® â€“ ç‰©ç†å±‚ é¢„å®šä¹‰çš„é€šä¿¡å¯¹è±¡æ ‡è¯†ç¬¦è¿æ¥æ•°é›†ã€ä¸ç´§æ€¥äº‹ä»¶ç›¸å…³çš„å¯¹è±¡ã€æ—¶é—´æ ‡è¯†å’ŒåŒæ­¥é€šä¿¡å¯¹è±¡ æ­¤åŸºæœ¬ CiA 301 é…ç½®è§„å®šç”±å…¶ä»– CiA æ–‡ä»¶è¿›è¡Œäº†è¡¥å……å’Œæ‰©å±•ï¼Œä¸ºä¸€äº›å…·ä½“é¢†åŸŸçš„è®¾å¤‡å’ŒåŠŸèƒ½è§„å®šäº†è®¾å¤‡ã€åº”ç”¨ç¨‹åºå’Œæ¥å£é…ç½®ã€‚å…·ä½“æœ‰ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼ŒæŒ‰ç…§è‡ªèº«åº”ç”¨ç¨‹åºçš„å®é™…æƒ…å†µå¼•å…¥ã€‚ CiA 302 â€“ CANopen é™„åŠ åº”ç”¨å±‚åŠŸèƒ½ CiA 303-1 â€“ å¸ƒçº¿å’Œæ¥å¤´ç®¡è„šåˆ†é… CiA 303-3 â€“ æŒ‡ç¤ºå™¨è§„èŒƒ CiA 306 â€“ CANopen ç”µå­æ•°æ®è¡¨è§„èŒƒ CiA 309 â€“ ä»å…¶ä»–ç½‘ç»œæ¥å…¥ CANopen CiA 315 â€“ CANopen é€šç”¨æ¡†æ¶ CiA 401 â€“ é€šç”¨ IO æ¨¡å—çš„ CANopen è®¾å¤‡é…ç½® CiA 402 â€“ é©±åŠ¨å’Œè¿åŠ¨æ§åˆ¶çš„ CANopen è®¾å¤‡é…ç½® OSI æ¨¡å‹CANopen çš„ OSI æ¨¡å‹ï¼ŒData link å’Œ Physical æ˜¯ç”± CAN è¿›è¡Œå®ç°çš„ï¼ŒPresentation å’Œ Session æ˜¯ç”± CANopen è¿›è¡Œå®ç°çš„ã€‚ ç‰©ç†å±‚ï¼ˆPhysical Layerï¼‰å®šä¹‰äº†ç‰©ç†ä»‹è´¨ã€ç”µæ°”ç‰¹æ€§ã€ä¼ è¾“é€Ÿç‡å’Œç¼–ç è§„èŒƒç­‰ã€‚ æ•°æ®é“¾è·¯å±‚ï¼ˆData Link Layerï¼‰åˆ’åˆ†æ•°æ®å¸§ã€é”™è¯¯æ£€æµ‹ä¸çº æ­£ã€æµé‡æ§åˆ¶ã€‚ ç½‘ç»œå±‚ï¼ˆNetwork Layerï¼‰æä¾›è·¯å¾„é€‰æ‹©ã€é€»è¾‘å¯»å€ã€è·¯ç”±é€‰æ‹©ç­‰åŠŸèƒ½ã€‚ ä¼ è¾“å±‚ï¼ˆTransport Layerï¼‰æä¾›ç«¯åˆ°ç«¯çš„ä¼ è¾“æ§åˆ¶å’Œé”™è¯¯æ¢å¤ã€‚ ä¼šè¯å±‚ï¼ˆSession Layerï¼‰å»ºç«‹ã€ç»´æŠ¤ã€åŒæ­¥å’Œæ¢å¤ä¼šè¯ã€‚ è¡¨ç¤ºå±‚ï¼ˆPresentation Layerï¼‰æ•°æ®çš„åŠ å¯†ã€å‹ç¼©ã€æ ¼å¼è½¬æ¢ç­‰ã€‚ åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰ç”¨æˆ·æ•°æ®äº¤äº’å’Œåº”ç”¨æ”¯æŒã€‚ è®¾å¤‡æ¨¡å‹æ¯ä¸ª CANopen è®¾å¤‡éƒ½éµå¾ªä¸€ä¸ªé€šç”¨çš„è®¾å¤‡æ¨¡å‹ï¼Œå› æ­¤ä¸åŒçš„è®¾å¤‡èƒ½ä¾æ®åŒæ ·çš„ CANopen æ ‡å‡†ã€‚CANopen è®¾å¤‡æ¨¡å‹çš„ä¸‰ä¸ªç»„æˆéƒ¨åˆ†æ˜¯ï¼š é€šè®¯æ¥å£ å¯¹è±¡å­—å…¸ åº”ç”¨ç¨‹åºä¸€ä¸ª CANopen è®¾å¤‡å¿…é¡»æ”¯æŒä¸€å®šæ•°é‡çš„ç½‘ç»œç®¡ç†æœåŠ¡ NMTï¼Œéœ€è¦è‡³å°‘ä¸€ä¸ª SDOã€‚æ¯ä¸ªç”Ÿäº§æˆ–æ¶ˆè´¹è¿‡ç¨‹æ•°æ®çš„è®¾å¤‡éœ€è¦è‡³å°‘ä¸€ä¸ª PDOã€‚æ‰€æœ‰å…¶å®ƒçš„é€šè®¯å¯¹è±¡æ˜¯å¯é€‰çš„ã€‚ æ ¸å¿ƒæ¦‚å¿µé€šè®¯æ¨¡å¼ è®¾å¤‡èŠ‚ç‚¹é€šä¿¡æœ‰ 3 ç§æ¨¡å‹ï¼šä¸»è®¾å¤‡ä»è®¾å¤‡ã€å®¢æˆ·ç«¯æœåŠ¡å™¨å’Œç”Ÿäº§è€…æ¶ˆè´¹è€… é€šè®¯åè®® åè®®ç”¨äºé€šä¿¡ï¼Œä¾‹å¦‚é…ç½®èŠ‚ç‚¹ï¼ˆSDOï¼‰æˆ–ä¼ è¾“å®æ—¶æ•°æ®ï¼ˆPDOï¼‰ å®šä¹‰äº†è®¾å¤‡ä¹‹é—´é€šä¿¡çš„æœºåˆ¶å’Œæ–¹å¼ï¼ŒåŒ…æ‹¬å¯¹è±¡å­—å…¸ã€æœåŠ¡æ•°æ®å¯¹è±¡ï¼ˆSDOï¼‰ã€è¿‡ç¨‹æ•°æ®å¯¹è±¡ï¼ˆPDOï¼‰ã€ç½‘ç»œç®¡ç†ï¼ˆNMTï¼‰ç­‰ã€‚ è®¾å¤‡çŠ¶æ€ è®¾å¤‡æ”¯æŒä¸åŒçš„çŠ¶æ€ã€‚â€ä¸»â€èŠ‚ç‚¹å¯ä»¥æ›´æ”¹â€ä»â€èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œä¾‹å¦‚å°†å…¶é‡ç½®ã€‚ å¯¹è±¡å­—å…¸ï¼ˆObject Dictionaryï¼ŒODï¼‰ æ¯ä¸ª CANopen è®¾å¤‡éƒ½æœ‰ä¸€ä¸ªå¯¹è±¡å­—å…¸ï¼ŒOD å¸¦æœ‰æŒ‡å®šè®¾å¤‡é…ç½®çš„æ¡ç›®ï¼Œç±»ä¼¼äºä¸€ä¸ªæŸ¥æ‰¾è¡¨ï¼Œåˆ—å‡ºäº†è®¾å¤‡ä¸­çš„æ‰€æœ‰å‚æ•°å’Œæ•°æ®ã€‚å¯¹è±¡å­—å…¸åŒ…æ‹¬é€šä¿¡å¯¹è±¡å’Œåº”ç”¨å¯¹è±¡ï¼Œä½¿ç”¨ 16 ä½ç´¢å¼•å’Œ 8 ä½å­ç´¢å¼•è¿›è¡Œæ ‡è¯†ã€‚å¯ä»¥é€šè¿‡ SDO è®¿é—®ã€‚ EDSï¼ˆElectronic Data Sheetï¼‰ EDS æ˜¯ç”¨äº OD çš„æ ‡å‡†æ–‡ä»¶æ ¼å¼ï¼Œå…è®¸æ›´æ–°è®¾å¤‡çš„æœåŠ¡ é€šè®¯æ¨¡å¼CANopen é€šè¿‡ä¸åŒçš„é€šè®¯æ¨¡å¼åœ¨èŠ‚ç‚¹ä¹‹é—´ä¼ è¾“æŠ¥æ–‡: ç”Ÿäº§æ¶ˆè´¹æ¨¡å¼:Â å®ƒæ˜¯ä¸€ä¸ªå¹¿æ’­è¿æ¥ï¼Œä»¥æ¨é€æ¨¡å¼å·¥ä½œï¼ˆä¿¡å·ç”Ÿäº§èŠ‚ç‚¹å‘æ¶ˆè´¹èŠ‚ç‚¹å‘é€æ— ä»»ä½•ç‰¹å®šè¦æ±‚çš„ä¿¡æ¯ï¼‰å’Œå¼•å…¥æ¨¡å¼ï¼ˆæ¶ˆè´¹èŠ‚ç‚¹å‘ä¿¡å·ç”Ÿäº§èŠ‚ç‚¹è¦æ±‚ç‰¹å®šä¿¡æ¯ï¼‰ã€‚ ç”¨æˆ·æœºæœåŠ¡å™¨æ¨¡å¼:Â é€šè¿‡ SDO åè®®ï¼Œç”¨æˆ·èŠ‚ç‚¹å‘æœåŠ¡å™¨èŠ‚ç‚¹è¦æ±‚æ•°æ®ï¼ˆå¯¹è±¡å­—å…¸ç´¢å¼•ï¼‰ï¼Œç„¶åæœåŠ¡å™¨èŠ‚ç‚¹é€šè¿‡å‘é€åœ¨æŒ‡å®šç´¢å¼•å¤„çš„å¯¹è±¡å†…å®¹æ¥å“åº”ã€‚ ä¸»æœºä»æœºæ¨¡å¼:Â ä¸»æœºèŠ‚ç‚¹å¯åœ¨ä»»ä½•æ—¶å€™å‘ä»æœºèŠ‚ç‚¹å‘é€æˆ–è¦æ±‚æ•°æ®ã€‚ä¾‹å¦‚ï¼šNMT åè®®é€šä¿¡ã€‚ æ•°æ®å¸§æ•°æ®å¸§ç”±å¸§å¤´ + æ•°æ®åŒºç»„æˆï¼Œå¸§å¤´ç”±åŠŸèƒ½ ID+NodeID+RTR(è¿œç¨‹ä¼ è¾“è¯·æ±‚)æ„æˆã€‚ 11 ä½çš„ CAN ID ç§°ä¸ºé€šä¿¡å¯¹è±¡æ ‡è¯†ç¬¦ï¼ˆCOB-IDï¼‰ï¼Œåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š å‰ 4 ä½ç­‰äºåŠŸèƒ½ä»£ç  Function Codeï¼ˆä»£è¡¨ä¸€ä¸ª CANopen é€šä¿¡å¯¹è±¡ï¼‰ å 7 ä½åŒ…å«èŠ‚ç‚¹ IDNode ID CANopen ç½‘ç»œä¸­ä½¿ç”¨çš„ COB-ID æ ‡è¯†ç¬¦çš„é¢„å®šä¹‰åˆ†é… æ•°æ®åŒºéƒ¨åˆ†çš„å®šä¹‰å°±è¦é€šè¿‡ CANopen ä¸­çš„é‡è¦æ¦‚å¿µï¼Œå¯¹è±¡å­—å…¸ OD æ¥å®ç°ã€‚ å¯¹è±¡å­—å…¸ ODå¯¹è±¡å­—å…¸ï¼ˆODï¼‰æ˜¯ CANopen åè®®çš„æ ¸å¿ƒæ¦‚å¿µã€‚å®ƒæ˜¯ä¸€ç»„é¢„å®šä¹‰çš„ CANopen å¯¹è±¡ï¼Œä½¿ç”¨ç´¢å¼•å’Œå­ç´¢å¼•è®¿é—®å¯¹è±¡ã€‚å¯¹è±¡å­—å…¸æä¾›äº†åº”ç”¨ç¨‹åºå’Œè®¾å¤‡ä¹‹é—´çš„æ²Ÿé€šæ–¹å¼ï¼Œæä¾›äº†é…ç½®è¯¥è®¾å¤‡çš„é€”å¾„ï¼Œå’Œä¸è®¾å¤‡é€šä¿¡çš„æ–¹æ³•ã€‚ æ‰€æœ‰ CANopen èŠ‚ç‚¹å¿…é¡»å…·æœ‰å¯¹è±¡å­—å…¸ï¼ˆODï¼‰ï¼Œå¯¹è±¡å­—å…¸æ˜¯æŒ‡å«æœ‰æè¿°çš„ CANopen èŠ‚ç‚¹çš„ è¡Œä¸º çš„æ‰€æœ‰ å‚æ•° çš„ æ ‡å‡†åŒ–ç»“æ„ã€‚ è®¾å¤‡ï¼ˆä¾‹å¦‚ä»è®¾å¤‡ï¼‰çš„ OD æ¡ç›®å¯ä»¥ç”±å…¶ä»–è®¾å¤‡ï¼ˆä¾‹å¦‚ä¸»æœºï¼‰ä½¿ç”¨ SDO é€šè¿‡ CAN è¿›è¡Œè®¿é—®ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ SDO å¯ä»¥ä½¿åº”ç”¨ç¨‹åºä¸»æœºæ›´æ”¹ä»å±å‘é€å¿ƒè·³çš„é¢‘ç‡ã€‚ ä½œä¸ºå¯¹è±¡ç´¢å¼•å­˜å‚¨åœ¨å¯¹è±¡å­—å…¸ä¸­çš„ä¿¡æ¯åŒ…æ‹¬ï¼š é€šä¿¡å’Œåº”ç”¨ç¨‹åºé…ç½®å‚æ•° æ ‡å‡†åŒ–è®¾å¤‡é…ç½®å‚æ•° åˆ¶é€ å•†ç‰¹å®šè®¾å¤‡é…ç½®æ–‡ä»¶å‚æ•° è®¾å¤‡é…ç½®é™æ€æ•°æ®ç±»å‹ è®¾å¤‡é…ç½®å¤æ‚æ•°æ®ç±»å‹ å¤æ‚å’Œé™æ€æ•°æ®ç±»å‹ åˆ¶é€ å•†ç‰¹å®šæ•°æ®ç±»å‹ å…¶ä»– å¯ä»¥æŒ‰ç…§ CANopen æ ‡å‡†çš„æŒ‡å¯¼ï¼Œä»¥é¢„å®šä¹‰çš„æ–¹å¼æ·»åŠ è‡ªå·±ç‰¹å®šçš„åˆ¶é€ å•†é…ç½®å’Œæ•°æ®ç±»å‹ã€‚åˆ¶é€ å•†è¿˜å¯ä»¥é€šè¿‡æ‰©å±•ç”±æ ‡å‡†è®¾å¤‡é…ç½®å’Œæ•°æ®ç±»å‹è§„èŒƒè¦æ±‚çš„æ ‡å‡†è®¾å¤‡åŠŸèƒ½ï¼Œæ¥å¢å¼ºå…¶è®¾å¤‡çš„åŠŸèƒ½ã€‚ ä¸»ç´¢å¼•ç´¢å¼•å€¼ä½äº 0x0FFF çš„æ˜¯ä¸€äº›æ•°æ®ç±»å‹å®šä¹‰ã€‚ä¸€ä¸ªèŠ‚ç‚¹çš„å¯¹è±¡å­—å…¸çš„æœ‰å…³èŒƒå›´åœ¨ 0x1000 åˆ° 0x9FFF ä¹‹é—´ï¼Œè¯¥èŒƒå›´å†…å®šä¹‰äº†ä¸€ç³»åˆ—ç§°ä¸ºå­åè®®çš„æ–‡æ¡£ï¼Œç”¨äºå®šä¹‰èŠ‚ç‚¹çš„é€šè®¯è¡Œä¸ºã€‚ é€šè®¯å­åè®®åŒºåŸŸè¯¦ç»†åˆ’åˆ† é€šç”¨é€šè®¯å¯¹è±¡ OD ç¤ºä¾‹é…ç½®ä¸‹å›¾æ˜¯ä¸€ä¸ª TPDO çš„å®šä¹‰ç¤ºä¾‹ï¼Œè¯¥ TPDO åœ¨ä¸»ç´¢å¼• 0x1800 çš„å­ç´¢å¼•ä¸­å®šä¹‰è¯¥ TPDO ç›¸å…³çš„é€šä¿¡å‚æ•°ï¼Œä¸»è¦æ˜¯ TPDO çš„å‘é€ç±»å‹å’Œè§¦å‘äº‹ä»¶ç­‰è®¾ç½®ï¼ŒåŒæ—¶åœ¨å’Œ 0x1800 åœ°å€å¯¹åº”çš„ 0x1A00 ä¸­å®šä¹‰äº†æ˜ å°„å‚æ•°ï¼Œåœ¨è¯¥å‚æ•°çš„å­ç´¢å¼•ä¸­ï¼Œå®šä¹‰äº†å…·ä½“çš„æ˜ å°„åœ°å€å’Œå¯¹è±¡ã€‚å¹¶ç»™å‡ºäº†è¯¥ TPDO æ¶ˆæ¯åœ¨å‘é€æ—¶æ•°æ®åŒºå†…å®¹ã€‚ ç”µå­æ•°æ®è¡¨ï¼ˆEDSï¼‰ä¸€ä¸ªèŠ‚ç‚¹çš„å¯¹è±¡å­—å…¸æ˜¯åœ¨ç”µå­æ•°æ®æ–‡æ¡£ï¼ˆEDSï¼šElectronic Data Sheetï¼‰ä¸­æè¿°ã€‚ å®é™…ä¸Šï¼Œå°†ä½¿ç”¨é€‚å½“çš„è½¯ä»¶å·¥å…·æ¥é…ç½®ç®¡ç†å¤æ‚çš„ CANopen ç½‘ç»œã€‚ ä¸€ä¸ªç”µå­æ•°æ®è¡¨ï¼ˆEDSï¼‰æ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–çš„ç”µå­æ–‡ä»¶ï¼Œæè¿°ä¸º CANopen è®¾å¤‡å®šä¹‰çš„é€šä¿¡åŠŸèƒ½å’Œå¯¹è±¡ã€‚æ­¤ä¾›åº”æ–¹ç”Ÿæˆçš„æ–‡ä»¶æœ‰ 3 ä¸ªåŒºåŸŸï¼š å…³äº EDS æ–‡ä»¶çš„ä¿¡æ¯ ä¸€èˆ¬è®¾å¤‡ä¿¡æ¯ å…·æœ‰é»˜è®¤å˜é‡çš„å¯¹è±¡å­—å…¸ EDS æ–‡ä»¶å¯ç”¨ä½œ CANopen è®¾å¤‡çš„é…ç½®å’Œç½‘ç»œè®¾ç½®å·¥å…·ã€‚ é€šè®¯åè®®é€šä¿¡å¯¹è±¡CANopen é€šä¿¡å•å…ƒç”±å¿…è¦çš„é€šä¿¡æ¥å£å’Œåè®®è½¯ä»¶ç»„æˆï¼Œé€šè¿‡æ€»çº¿åœ¨èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œé€šä¿¡å¯¹è±¡çš„å‘é€å’Œæ¥æ”¶ã€‚å„ç§ CANopen é€šä¿¡å¯¹è±¡ç”¨äºå®ç°å„ç§ç±»å‹çš„é€šä¿¡ï¼ŒCANopen åè®®å®šä¹‰äº†å‡ ç§ä¸åŒç±»å‹çš„é€šä¿¡å¯¹è±¡ï¼Œæ¯ç§å¯¹è±¡éƒ½ç”¨äºç‰¹å®šçš„é€šä¿¡ç›®çš„ï¼š è¿‡ç¨‹æ•°æ®å¯¹è±¡ï¼ˆPDOï¼‰ï¼šç”¨äºå®æ—¶æ•°æ®ä¼ è¾“ï¼Œå…·æœ‰é«˜ä¼˜å…ˆçº§å’Œä½å»¶è¿Ÿã€‚PDO ä¼ è¾“çš„æ•°æ®é‡å°ï¼Œä½†ä¼ è¾“é€Ÿåº¦å¿«ï¼Œé€‚ç”¨äºä¼ æ„Ÿå™¨æ•°æ®å’Œæ§åˆ¶å‘½ä»¤ç­‰å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ã€‚ æœåŠ¡æ•°æ®å¯¹è±¡ï¼ˆSDOï¼‰ï¼šç”¨äºéå®æ—¶æ•°æ®ä¼ è¾“ï¼Œå¦‚é…ç½®å‚æ•°å’Œå¤§æ•°æ®å—çš„ä¼ è¾“ã€‚SDO ä¼ è¾“çš„çµæ´»æ€§æ›´å¤§ï¼Œä½†ä¼˜å…ˆçº§è¾ƒä½ï¼Œé€‚ç”¨äºè®¾å¤‡é…ç½®å’Œè¯Šæ–­ç­‰åœºæ™¯ã€‚ ç½‘ç»œç®¡ç†å¯¹è±¡ï¼ˆNMTï¼‰ï¼šç”¨äºæ§åˆ¶è®¾å¤‡çŠ¶æ€å’Œç½‘ç»œæ“ä½œæ¨¡å¼ï¼Œå¦‚å¯åŠ¨ã€åœæ­¢å’Œå¤ä½è®¾å¤‡ã€‚ åŒæ­¥å¯¹è±¡ï¼ˆSYNCï¼‰ï¼šç”¨äºç½‘ç»œåŒæ­¥ï¼Œç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´ç‚¹è¿›è¡Œæ“ä½œã€‚ æ—¶é—´æˆ³å¯¹è±¡ï¼ˆTIMEï¼‰ï¼šæä¾›æ—¶é—´å‚è€ƒï¼Œç”¨äºæ—¶é—´ç›¸å…³çš„æ“ä½œã€‚ ç´§æ€¥æƒ…å†µå¯¹è±¡ (EMCY) ï¼š æŒ‡å®šçŠ¶æ€ä¸‹å¯ç”¨çš„é€šè®¯å¯¹è±¡åŠçŠ¶æ€è½¬æ¢è¯´æ˜ï¼š ä¸­æ‹¬å·å†…çš„å­—æ¯è¡¨ç¤ºå¤„äºä¸åŒçŠ¶æ€é‚£äº›é€šè®¯å¯¹è±¡å¯ä»¥ä½¿ç”¨ã€‚ a. NMTb. Node Guard c. SDO d. Emergencye. PDO f. Boot-up ç½‘ç»œç®¡ç†ï¼ˆNMTï¼‰æ‰€æœ‰çš„ CANopen èŠ‚ç‚¹éƒ½æœ‰è‡ªå·±ä¸“å±çš„ NMT çŠ¶æ€ï¼Œè€Œä¸»ç«™å¯ä»¥é€šè¿‡ NMT å»æ§åˆ¶ä»ç«™çš„çŠ¶æ€ã€‚CANopen çš„ç½‘ç»œç®¡ç†é‡‡å–ä¸»æœºä»æœºé€šä¿¡æ¨¡å¼ã€‚æ•´ä¸ªç½‘ç»œè¢«è®¾ç½®ä¸ºä¸€ä¸ªâ€çŠ¶æ€æœºâ€ï¼Œå…¶ä¸­ä¸€ä¸ªè®¾å¤‡è¢«æŒ‡å®šä¸º NMT ä¸»æœºï¼Œå…¶ä½™è®¾å¤‡è¢«æŒ‡å®šä¸º NMT ä»æœºã€‚NMT ä¸»æœºæ§åˆ¶å’Œç›‘æ§ NMT ä»æœºçš„çŠ¶æ€ã€‚é€šè¿‡ NMT ä¸»æœºè§¦å‘ï¼ŒNMT ä»æœºè¿›è¡ŒçŠ¶æ€è½¬æ¢ï¼Œå®ç° CANopen ç½‘ç»œçš„å„ä¸ªé˜¶æ®µã€‚ NMT æœåŠ¡ç”¨äºé€šè¿‡ NMT å‘½ä»¤æ¥æ§åˆ¶ CANopen è®¾å¤‡çš„çŠ¶æ€ã€‚åªæœ‰ NMT-Master èŠ‚ç‚¹èƒ½å¤Ÿä¼ é€ NMT Module Control æŠ¥æ–‡ã€‚æ‰€æœ‰ä»è®¾å¤‡å¿…é¡»æ”¯æŒ NMT æ¨¡å—æ§åˆ¶æœåŠ¡ã€‚NMT Module Control æ¶ˆæ¯ä¸éœ€è¦åº”ç­”ã€‚ä¸ºäº†æ›´æ”¹çŠ¶æ€ï¼ŒNMT ä¸»è®¾å¤‡å‘é€ COBID+2 å­—èŠ‚çš„æ¶ˆæ¯ã€‚ COB-ID ä¸º 0ï¼ˆfunction code0 å’Œ node ID0ï¼‰ï¼Œä¼˜å…ˆçº§ä¸ºæœ€é«˜ã€‚ ç¬¬ä¸€ä¸ª CAN æ•°æ®å­—èŠ‚ Requested State åŒ…å«è¯·æ±‚çš„çŠ¶æ€ ç¬¬äºŒä¸ª CAN æ•°æ®å­—èŠ‚åŒ…å«ç›®æ ‡èŠ‚ç‚¹çš„èŠ‚ç‚¹ IDã€‚èŠ‚ç‚¹ ID 0 è¡¨ç¤ºå¹¿æ’­å‘½ä»¤ã€‚æ‰€æœ‰ä»èŠ‚ç‚¹éƒ½å¤„ç†æ­¤æ¶ˆæ¯ã€‚ é€šè¿‡å…·ä½“çš„ NMT åè®®ï¼Œå¦‚å¯åŠ¨åè®®ã€æ¨¡å—æ§åˆ¶åè®®ã€å¿ƒè·³åè®®ï¼ˆHeartbeat Protocolï¼‰å’ŒèŠ‚ç‚¹ç›‘æµ‹ï¼Œä¸»æœºå‘ä»æœºå‘å‡ºçŠ¶æ€æ›´æ”¹å‘½ä»¤ï¼Œè¿›è¡Œè¿™äº›çŠ¶æ€è½¬æ¢ã€‚NMT ä¸»æœºå‘ç‰¹å®šèŠ‚ç‚¹æˆ–æ‰€æœ‰èŠ‚ç‚¹å‘é€ NMT å‘½ä»¤ä»£ç ä»¥æ”¹å˜çŠ¶æ€ã€‚ åœ¨é¢„è¿è¡ŒçŠ¶æ€ä¸‹ï¼Œåº”ç”¨ç¨‹åºé…ç½®å·¥å…·å¯ä»¥ä½¿ç”¨SDO é€šä¿¡ï¼Œé…ç½® NMT ä»æœºå’Œè®¾ç½®å‚æ•°ã€‚ç”±äºè®¾å¤‡å°šæœªå¼€å§‹è¿è¡Œï¼Œå› æ­¤åœ¨æ­¤çŠ¶æ€ä¸‹ä¸èƒ½ä½¿ç”¨ PDO é€šä¿¡ã€‚ ä¸€æ—¦çŠ¶æ€ä»é¢„è¿è¡Œå˜ä¸ºè¿è¡ŒçŠ¶æ€ï¼ŒèŠ‚ç‚¹ä¸­çš„æ‰€æœ‰é€šä¿¡å¯¹è±¡éƒ½å°†å˜ä¸ºæ´»è·ƒçŠ¶æ€ï¼Œå¹¶ä¸”è¿è¡ŒèŠ‚ç‚¹ä¹‹é—´å‡å¯è¿›è¡Œ PDO å’Œ SDO é€šä¿¡ã€‚åœ¨æ­¤é˜¶æ®µï¼Œä¹Ÿå¯ä»¥é€šè¿‡ SDO è®¿é—®å¯¹è±¡å­—å…¸ã€‚å½“èŠ‚ç‚¹çŠ¶æ€æ›´æ”¹ä¸ºåœæ­¢æ—¶ï¼ŒPDO å’Œ SDO é€šä¿¡éƒ½å°†åœæ­¢ã€‚ å®é™…çŠ¶æ€å–å€¼ æ­¥éª¤ Byte 0 å–å€¼ï¼ˆå‘½ä»¤ï¼‰ çŠ¶æ€ ï¼ˆ2ï¼‰ 01 operation ï¼ˆ3ï¼‰ 02 stop ï¼ˆ4ï¼‰ 80 pre-operation ï¼ˆ5ï¼‰ 81 reset app ï¼ˆ6ï¼‰ 82 reset communication ç¤ºä¾‹# node 0x6 è¿›å…¥ `operational` æ¨¡å¼000 01 06# æ‰€æœ‰èŠ‚ç‚¹è¿›å…¥ `pre-operational` æ¨¡å¼000 80 00 æœåŠ¡æ•°æ®å¯¹è±¡ï¼ˆSDOï¼‰SDO æä¾›äº†ç›´æ¥è®¿é—® CANopen è®¾å¤‡å¯¹è±¡å­—å…¸çš„å…¥å£ï¼Œå…¥å£æ¡ä»¶åŒ…æ‹¬æ•°æ®ç±»å‹åŠå¤§å°ã€‚ è®¿é—®è€…è¢«ç§°ä½œå®¢æˆ·ç«¯(client)ï¼Œå¯¹è±¡å­—å…¸è¢«è®¿é—®ä¸”æä¾›æ‰€è¯·æ±‚æœåŠ¡çš„ CANopen è®¾å¤‡åˆ«ç§°ä½œæœåŠ¡å™¨(server)ã€‚ä»»ä½•ç±»å‹çš„ SDO ä¼ è¾“éƒ½ç”±å®¢æˆ·ç«¯å‘èµ·ï¼Œæ•°æ®å­—å…¸ OD æŒæœ‰è€…æ˜¯æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¯ä»¥ä¸»åŠ¨ä¸­æ­¢ä¼ è¾“ã€‚é€šå¸¸æƒ…å†µä¸‹ CAN æ€»çº¿ç½‘ç»œä¸­åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ã€‚ å®¢æˆ·çš„ CAN æŠ¥æ–‡å’ŒæœåŠ¡å™¨çš„åº”ç­” CAN æŠ¥æ–‡æ€»æ˜¯åŒ…å« 8 å­—èŠ‚æ•°æ®ï¼ˆå°½ç®¡ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®å­—èŠ‚éƒ½ä¸€å®šæœ‰æ„ä¹‰ï¼‰ã€‚ä¸€ä¸ªå®¢æˆ·çš„è¯·æ±‚ä¸€å®šæœ‰æ¥è‡ªæœåŠ¡å™¨çš„åº”ç­”ã€‚å¦‚æœè¶…æ—¶æ²¡æœ‰ç¡®è®¤ï¼Œåˆ™å®¢æˆ·ç«¯èŠ‚ç‚¹å°†ä¼šé‡æ–°å‘é€åŸæŠ¥æ–‡ã€‚ SDO æœåŠ¡ç”¨äºè®¿é—®æ›´æ”¹ CANopen è®¾å¤‡çš„å¯¹è±¡å­—å…¸ä¸­çš„å€¼ã€‚å…è®¸ CANopen èŠ‚ç‚¹é€šè¿‡ CAN ç½‘ç»œè¯»å–å¦ä¸€ä¸ªèŠ‚ç‚¹çš„å¯¹è±¡å­—å…¸ç¼–è¾‘å€¼ã€‚ä¸‹è½½ï¼ˆDownloadï¼‰æ˜¯æŒ‡å¯¹å¯¹è±¡å­—å…¸è¿›è¡Œå†™æ“ä½œï¼Œä¸Šä¼ ï¼ˆUploadï¼‰æŒ‡å¯¹å¯¹è±¡å­—å…¸è¿›è¡Œè¯»æ“ä½œã€‚ å®¢æˆ·ç«¯èŠ‚ç‚¹å¯ä»¥é€šè¿‡ä»¥ä¸‹ CAN å¸§å¹¿æ’­æ¥å¯åŠ¨ SDO ä¸‹è½½åˆ°èŠ‚ç‚¹ 5ï¼Œè¿™å°†è§¦å‘èŠ‚ç‚¹ 5ï¼ˆå¹¶è¢«å…¶ä»–èŠ‚ç‚¹å¿½ç•¥ï¼‰ã€‚SDO å®¢æˆ·ç«¯çš„â€æ¥æ”¶â€ï¼ˆå³è¯·æ±‚ï¼‰CAN å¸§å¦‚ä¸‹æ‰€ç¤ºï¼š SDO æ¶ˆæ¯å˜é‡æ•°æ®åŒº Byte è¯´æ˜ï¼š Byte0 å‘½ä»¤å­—èŠ‚ï¼Œä¸»è¦å®šä¹‰äº†ä»¥ä¸‹å†…å®¹ï¼š CCSï¼ˆå®¢æˆ·ç«¯å‘½ä»¤è¯´æ˜ç¬¦ï¼ŒClient Command Specifierï¼‰æè¿°ä¼ è¾“ç±»å‹ï¼ˆä¸‹è½½ downloadä¸Šè½½ uploadï¼‰ n æ˜¯æ•°æ®å­—èŠ‚ 4-7 ä¸­ä¸åŒ…å«æ•°æ®çš„ bytes ï¼ˆå¦‚æœè®¾ç½®äº† eï¼†s åˆ™æœ‰æ•ˆï¼‰ å¦‚æœè®¾ç½®ï¼Œe è¡¨ç¤º å¿«é€Ÿä¼ è¾“(æ‰€æœ‰æ•°æ®åœ¨å•ä¸ª CAN å¸§ä¸­)åˆ†æ®µä¼ è¾“ å¦‚æœè®¾ç½®ï¼Œs è¡¨ç¤ºæ•°æ®å¤§å°æ˜¾ç¤ºåœ¨ n ä¸­ Byte1+Byte2 ä¸»ç´¢å¼•å­—èŠ‚ï¼ˆ16 ä½ï¼‰ç¡®è®¤ OD ä¸»ç´¢å¼• Byte3 å­ç´¢å¼•å­—èŠ‚ï¼ˆ8 ä½ï¼‰ç¡®è®¤ OD å­ç´¢å¼• Byte4-7 åŒ…å«å®é™…çš„æ•°æ®å†…å®¹ ä¸€æ—¦èŠ‚ç‚¹ï¼ˆå®¢æˆ·ç«¯ï¼‰å‘é€äº† CAN å¸§ï¼Œä»èŠ‚ç‚¹ 5ï¼ˆæœåŠ¡ç«¯ï¼‰ä¾¿ä¼šé€šè¿‡ RSDO è¿›è¡Œå“åº”ï¼Œå¹¶å¸¦æœ‰ COB-ID585ã€‚è¯¥å“åº”åŒ…å«ç´¢å¼•å­ç´¢å¼•å’Œ 4 ä¸ªç©ºæ•°æ®å­—èŠ‚ã€‚è‡ªç„¶åœ°ï¼Œå¦‚æœå®¢æˆ·ç«¯èŠ‚ç‚¹è¯·æ±‚ä¸Šä¼ ï¼ˆå³ä»èŠ‚ç‚¹ 5 OD è¯»å–æ•°æ®ï¼‰ï¼Œåˆ™èŠ‚ç‚¹ 5 å°†ä»¥å­—èŠ‚ 4-7 ä¸­åŒ…å«çš„ç›¸å…³æ•°æ®è¿›è¡Œå“åº”ã€‚ SDO çµæ´»ï¼Œä½†ä¼šå¸¦æ¥å¤§é‡è¾“å‡ºï¼Œä½¿å…¶ä¸é€‚ç”¨äºå®æ—¶æ“ä½œæ•°æ®ã€‚åŒæ—¶æ•°æ®åªèƒ½åŒ…å«åœ¨åç»­ 4 ä¸ªå­—èŠ‚ä¸­ï¼Œå¯¹äºè¾ƒå¤§çš„æ•°æ®æ–¹æ¡ˆï¼Œæ— æ³•ä¸€æ¬¡ä¼ è¾“å®Œæ¯•ã€‚å› æ­¤ SDO ä¸­å®ç°äº† 2 ç§ä¼ é€æœºåˆ¶ï¼Œä¸¤ç§ä¼ é€æœºåˆ¶å®é™…åŒ…å« 4 ä¸ªè¯·æ±‚åº”ç­”åè®®ï¼Œå…±æœ‰ 5 ä¸ªåè®®å¦‚ä¸‹ï¼š å¿«é€Ÿä¼ é€ï¼ˆExpedited transferï¼‰ ï¼š æœ€å¤šä¼ è¾“ 4 å­—èŠ‚æ•°æ® å¯åŠ¨åŸŸä¸‹è½½ ï¼ˆInitiate Domain Downloadï¼‰ å¯åŠ¨åŸŸä¸Šä¼  ï¼ˆInitiate Domain Uploadï¼‰ åˆ†æ®µä¼ é€ï¼ˆSegmented transferï¼‰ ï¼š ä¼ è¾“æ•°æ®é•¿åº¦å¤§äº 4 å­—èŠ‚ åŸŸåˆ†æ®µä¸‹è½½ï¼ˆDownload Domain Segmentï¼‰ åŸŸåˆ†æ®µä¸Šä¼  ï¼ˆUpload Domain Segmentï¼‰ åŸŸä¼ é€ä¸­æ­¢ï¼ˆAbort Domain Transferï¼‰ã€‚ å¿«é€Ÿ SDOCommand specifier(CS)å‘½ä»¤ç¬¦: 0x40 è¯»å–å‘½ä»¤ 0x2F å†™ä¸€ä¸ªå­—èŠ‚ 0x4F è¿”å›å€¼å“åº”ä¸€ä¸ªå­—èŠ‚ 0x2B å†™ä¸¤ä¸ªå­—èŠ‚ 0x4B è¿”å›å€¼å“åº”ä¸¤ä¸ªå­—èŠ‚ 0x27 å†™ä¸‰ä¸ªå­—èŠ‚ 0x47 è¿”å›å€¼å“åº”ä¸‰ä¸ªå­—èŠ‚ 0x23 å†™å››ä¸ªå­—èŠ‚ 0x43 è¿”å›å€¼å“åº”å››ä¸ªå­—èŠ‚ 0x60 å†™æˆåŠŸåº”ç­” 0x80 å¼‚å¸¸å“åº” å¯åŠ¨åŸŸä¸‹è½½ï¼ˆInitiate Domain Downloadï¼‰ Bit 7 6 5 4 3 2 1 0 å®¢æˆ·ç«¯ 0 0 1 - n n e s æœåŠ¡å™¨ 0 1 1 - - - - n ï¼š å¦‚æœ e=1 ä¸” s=1ï¼Œåˆ™æœ‰æ•ˆï¼Œå¦åˆ™ä¸º 0ï¼›è¡¨ç¤ºæ•°æ®éƒ¨åˆ†ä¸­æ— æ„ä¹‰æ•°æ®çš„å­—èŠ‚æ•°ï¼ˆå­—èŠ‚ 8ï¼n åˆ° 7 æ•°æ®æ— æ„ä¹‰ï¼‰ã€‚ e ï¼š 0 æ­£å¸¸ä¼ é€ï¼Œ1 åŠ é€Ÿä¼ é€ï¼ˆæ•°æ®åœ¨ä¸€ä¸ªå¸§ä¸­ï¼‰ã€‚ s ï¼š æ˜¯å¦æŒ‡æ˜æ•°æ®é•¿åº¦ï¼Œ0 æ•°æ®é•¿åº¦æœªæŒ‡æ˜ï¼Œ1 æ•°æ®é•¿åº¦æŒ‡æ˜ã€‚ e 0ï¼Œ s 0ï¼š ç”± CiA ä¿ç•™ã€‚ e 0ï¼Œ s 1 ï¼š æ•°æ®å­—èŠ‚ä¸ºå­—èŠ‚è®¡æ•°å™¨ï¼Œbyte 4 æ˜¯æ•°æ®ä½ä½éƒ¨åˆ†ï¼ˆLSBï¼‰ï¼Œbyte 7 æ˜¯æ•°æ®é«˜ä½éƒ¨åˆ†ï¼ˆMSBï¼‰ã€‚ e 1 ï¼š æ•°æ®å­—èŠ‚ä¸ºå°†è¦ä¸‹è½½ï¼ˆdownloadï¼‰çš„æ•°æ®ã€‚ å¯åŠ¨åŸŸä¸Šä¼ ï¼ˆInitiate Domain Uploadï¼‰ Bit 7 6 5 4 3 2 1 0 å®¢æˆ·ç«¯ 0 1 0 - - - - - æœåŠ¡å™¨ 0 1 0 - n n e s nï¼Œeï¼Œsï¼š ä¸å¯åŠ¨åŸŸä¸‹è½½ç›¸åŒã€‚ åˆ†æ®µ SDOåŸŸåˆ†æ®µä¸‹è½½ï¼ˆDownload Domain Segmentï¼‰ Bit 7 6 5 4 3 2 1 0 å®¢æˆ·ç«¯ 0 0 0 t n n n c æœåŠ¡å™¨ 0 0 1 t - - - - n ï¼šæ— æ„ä¹‰çš„æ•°æ®å­—èŠ‚æ•°ã€‚å¦‚æœæ²¡æœ‰æŒ‡æ˜æ®µé•¿åº¦ï¼Œåˆ™ä¸º 0ã€‚ c ï¼š 0 æœ‰åç»­åˆ†æ®µéœ€è¦ downloadï¼Œ1 æœ€åä¸€ä¸ªæ®µã€‚ t ï¼š è§¦å‘ä½ï¼Œåç»­æ¯ä¸ªåˆ†æ®µäº¤æ›¿æ¸…é›¶å’Œç½®ä½ï¼ˆç¬¬ä¸€æ¬¡ä¼ é€ä¸º 0ï¼Œç­‰æ•ˆäº requestresponseï¼‰ã€‚ åŸŸåˆ†æ®µä¸Šä¼ ï¼ˆUpload Domain Segmentï¼‰ Bit 7 6 5 4 3 2 1 0 å®¢æˆ·ç«¯ 0 1 1 t - - - - æœåŠ¡å™¨ 0 0 0 t n n n c nï¼Œcï¼Œt ï¼š ä¸åŸŸåˆ†æ®µä¸‹è½½ç›¸åŒã€‚ ç¤ºä¾‹é€šè®¯ç¤ºä¾‹ -upload æ•°æ® 0xFE ï¼Œå¯¹è±¡å­—å…¸èŠ‚ç‚¹ 5 , ç´¢å¼• index 0x1400, å­ç´¢å¼• subindex 2 å®¢æˆ·ç«¯è¯·æ±‚ ï¼š 605 40Â 00 14Â 02 00 00 00 00 è‹¥æˆåŠŸï¼Œåº”ç­”ï¼šÂ 585 4FÂ 00 14Â 02Â FEÂ 00 00 00 æ•°æ®Â 0x60120208Â ï¼Œå¯¹è±¡å­—å…¸èŠ‚ç‚¹ 5 , ç´¢å¼• index 0x1802, å­ç´¢å¼• subindex 1 å®¢æˆ·ç«¯è¯·æ±‚ ï¼š605 40Â 02 18Â 01Â 00 00 00 00 è‹¥æˆåŠŸï¼Œåº”ç­”ï¼š585 60Â 02 18Â 01Â 08 02 12 60 é€šè®¯ç¤ºä¾‹ -downloadæ•°æ® 0xFE ï¼Œå¯¹è±¡å­—å…¸èŠ‚ç‚¹ 5 , ç´¢å¼• index 0x1400, å­ç´¢å¼• subindex 2 å®¢æˆ·ç«¯è¯·æ±‚ ï¼šÂ 605 2FÂ 00 14Â 02 FE 00 00 00 è‹¥æˆåŠŸï¼Œåº”ç­”ï¼šÂ 585 60Â 00 14Â 02 00 00 00 00 æ•°æ®Â 0x60120208Â ï¼Œå¯¹è±¡å­—å…¸èŠ‚ç‚¹ 5 , ç´¢å¼• index 0x1802, å­ç´¢å¼• subindex 1 å®¢æˆ·ç«¯è¯·æ±‚ ï¼š605 23Â 02 18Â 01Â 08 02 12 60 è‹¥æˆåŠŸï¼Œåº”ç­”ï¼š585 60Â 02 18Â 01 00 00 00 00 è¿‡ç¨‹æ•°æ®å¯¹è±¡ï¼ˆPDOï¼‰PDO å±äºè¿‡ç¨‹æ•°æ®ï¼Œå³å•å‘ä¼ è¾“ï¼Œæ— éœ€æ¥æ”¶èŠ‚ç‚¹å›åº” CAN æŠ¥æ–‡æ¥ç¡®è®¤ï¼Œä»é€šè®¯æœ¯è¯­ä¸Šæ¥è¯´æ˜¯å±äºâ€ç”Ÿäº§æ¶ˆè´¹â€æ¨¡å‹ã€‚ã€ç”Ÿäº§è€…â€ç”Ÿäº§æ•°æ®â€ï¼Œå¹¶ä½¿ç”¨ Transmit PDOï¼ˆTPDOï¼‰å°†å…¶ä¼ è¾“åˆ°â€æ¶ˆè´¹è€…â€ï¼ˆä¸»ç”¨æˆ·ï¼‰ã€‚ç›¸åï¼Œå®ƒå¯ä»¥é€šè¿‡ Receive PDOï¼ˆRPDOï¼‰ä»ä½¿ç”¨è€…æ¥æ”¶æ•°æ®ã€‚ PDO æœåŠ¡ç”¨äºåœ¨è®¾å¤‡ä¹‹é—´ä¼ è¾“å®æ—¶æ•°æ®ï¼Œä¾‹å¦‚æ¥è‡ªæ¸©åº¦ä¼ æ„Ÿå™¨çš„æ¸©åº¦æ•°æ®ã€‚PDO æ‰¿è½½å¤§é‡ä¿¡æ¯ï¼Œè¢«è§†ä¸ºæœ€é‡è¦çš„ CANopen åè®®ã€‚PDO æ¶ˆæ¯å¯ä»¥åŒ…å« 8 ä¸ªå®Œæ•´å­—èŠ‚çš„æ•°æ®ï¼Œå¹¶ä¸”å®ƒå¯ä»¥åœ¨å•ä¸ªå¸§ä¸­åŒ…å«å¤šä¸ªå¯¹è±¡å‚æ•°å€¼ã€‚å› æ­¤åœ¨ PDO æœåŠ¡ä¸­ç”¨ 1 å¸§å®Œæˆ SDO è‡³å°‘éœ€è¦ 4 å¸§çš„æ“ä½œã€‚ å¸¦æœ‰ç‰¹å®š 11 ä½ CAN æ ‡è¯†ç¬¦çš„ TPDO ç”±ä¸€ä¸ªè®¾å¤‡å‘é€ï¼Œå¹¶ä½œä¸º RPDO ç”±é›¶ä¸ªæˆ–å¤šä¸ªè®¾å¤‡æ¥æ”¶ã€‚æ¯ä¸ª PDO åœ¨å¯¹è±¡å­—å…¸ä¸­ç”¨ 2 ä¸ªå¯¹è±¡æè¿°ï¼š PDO é€šè®¯å‚æ•°ï¼šåŒ…å«å“ªä¸ª COB-ID å°†è¢« PDO ä½¿ç”¨ï¼Œä¼ è¾“ç±»å‹ï¼Œç¦æ­¢æ—¶é—´å’Œå®šæ—¶å™¨å‘¨æœŸã€‚åœ¨ç´¢å¼• 0x1400+ å’Œ 0x1800+ çš„å¯¹è±¡å­—å…¸ä¸­ã€‚ PDO æ˜ å°„å‚æ•°ï¼šåŒ…å«ä¸€ä¸ªå¯¹è±¡å­—å…¸ä¸­å¯¹è±¡çš„åˆ—è¡¨ï¼Œè¿™äº›å¯¹è±¡æ˜ å°„åˆ° PDO é‡Œï¼ŒåŒ…æ‹¬å®ƒä»¬çš„æ•°æ®é•¿åº¦ï¼ˆin bitsï¼‰ã€‚ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¿…é¡»çŸ¥é“è¿™ä¸ªæ˜ å°„ï¼Œä»¥è§£é‡Š PDO å†…å®¹ã€‚åœ¨ç´¢å¼• 0x1600+ å’Œ 0x1A00+ çš„å¯¹è±¡å­—å…¸ä¸­ã€‚ ç”Ÿäº§è€…èŠ‚ç‚¹å¯ä»¥è¢«é…ç½®ä¸ºæ¯ 100ms å“åº”æ¶ˆè´¹è€…æ‰€å¹¿æ’­çš„ SYNC è§¦å‘ã€‚ç„¶åï¼ŒèŠ‚ç‚¹ 5 å¯ä»¥ä¾‹å¦‚åœ¨ä¸‹é¢å¹¿æ’­ï¼Œä»¥ COB-ID 185 çš„ TPDOï¼š æ³¨æ„æ•°æ®åŒºéƒ¨åˆ† 3 ä¸ªå‚æ•°å€¼çš„æ‰“åŒ…æ–¹å¼ï¼Œè¿™äº›å€¼æ˜¯ç”±æ•°æ®å­—å…¸ä¸­å¯¹åº”çš„æ˜ å°„ç»“æ„å†³å®šäº†ä¸€ä¸ª PDO çš„æ•°æ®ç±»å‹å’Œæ˜ å°„å…³ç³»ã€‚ é€šä¿¡å‚æ•°å®šä¹‰äº†è¯¥è®¾å¤‡æ‰€ä½¿ç”¨çš„ COB-IDã€ä¼ è¾“ç±»å‹ã€å®šæ—¶å‘¨æœŸç­‰ã€‚RPDO é€šè®¯å‚æ•°ä½äºå¯¹è±¡å­—å…¸ç´¢å¼•çš„ 0x1400 to 0x15FFï¼ŒTPDO é€šè®¯å‚æ•°ä½äºå¯¹è±¡å­—å…¸ç´¢å¼•çš„ 0x1800 to 0x19FFã€‚æ¯æ¡ç´¢å¼•ä»£è¡¨ä¸€ä¸ª PDO çš„é€šä¿¡å‚æ•°é›†ï¼Œå…¶ä¸­çš„å­ç´¢å¼•åˆ†åˆ«æŒ‡å‘å…·ä½“çš„å„ç§å‚æ•°ã€‚PDO æ¶ˆæ¯çš„å†…å®¹æ˜¯é¢„å®šä¹‰çš„ï¼ˆæˆ–è€…åœ¨ç½‘ç»œå¯åŠ¨æ—¶é…ç½®çš„ï¼‰ã€‚ Number of entries å‚æ•°æ¡ç›®æ•°é‡ï¼šå³æœ¬ç´¢å¼•ä¸­æœ‰å‡ æ¡å‚æ•°ï¼› COB-IDï¼šå³è¿™ä¸ª PDO å‘å‡ºæˆ–è€…æ¥æ”¶çš„å¯¹åº” CAN å¸§ IDï¼› å‘é€ç±»å‹ï¼šå³è¿™ä¸ª PDO å‘é€æˆ–è€…æ¥æ”¶çš„ä¼ è¾“å½¢å¼ï¼Œé€šå¸¸ä½¿ç”¨å¾ªç¯åŒæ­¥å’Œå¼‚æ­¥åˆ¶é€ å•†ç‰¹å®šäº‹ä»¶è¾ƒå¤šï¼› Inhibit time ç”Ÿäº§ç¦æ­¢çº¦æŸæ—¶é—´(110ms)ï¼šçº¦æŸ PDO å‘é€çš„æœ€å°é—´éš”ï¼Œé¿å…å¯¼è‡´æ€»çº¿è´Ÿè½½å‰§çƒˆå¢åŠ ï¼Œæ¯”å¦‚æ•°å­—é‡è¾“å…¥è¿‡å¿«ï¼Œå¯¼è‡´çŠ¶æ€æ”¹å˜å‘é€çš„ TPDO é¢‘ç¹å‘é€ï¼Œæ€»çº¿è´Ÿè½½åŠ å¤§ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªçº¦æŸæ—¶é—´æ¥è¿›è¡Œâ€æ»¤æ³¢â€ï¼Œè¿™ä¸ªæ—¶é—´å•ä½ä¸º 0.1msï¼› Event timer äº‹ä»¶å®šæ—¶å™¨è§¦å‘çš„æ—¶é—´(å•ä½ ms)ï¼šå®šæ—¶å‘é€çš„ PDOï¼Œå®ƒçš„å®šæ—¶æ—¶é—´ï¼Œå¦‚æœè¿™ä¸ªæ—¶é—´ä¸º 0ï¼Œåˆ™è¿™ä¸ª PDO ä¸ºäº‹ä»¶æ”¹å˜å‘é€ã€‚ SYNC start value åŒæ­¥èµ·å§‹å€¼ï¼šåŒæ­¥ä¼ è¾“çš„ PDOï¼Œæ”¶åˆ°è¯ºå¹²ä¸ªåŒæ­¥åŒ…åï¼Œæ‰è¿›è¡Œå‘é€ï¼Œè¿™ä¸ªåŒæ­¥èµ·å§‹å€¼å°±æ˜¯åŒæ­¥åŒ…æ•°é‡ã€‚æ¯”å¦‚è®¾ç½®ä¸º 2ï¼Œå³æ”¶åˆ° 2 ä¸ªåŒæ­¥åŒ…åæ‰è¿›è¡Œå‘é€ã€‚ å‘é€ç±»å‹PDO å¯ä»¥æœ‰å¤šç§å‘é€ç±»å‹ï¼š åŒæ­¥ï¼ˆé€šè¿‡æ¥æ”¶ SYNC å¯¹è±¡å®ç°åŒæ­¥ï¼‰ éå‘¨æœŸï¼šè¿œç¨‹å¸§é¢„è§¦å‘ä¼ é€æˆ–è®¾å¤‡å­åè®®ä¸­è§„å®šçš„å¯¹è±¡ç‰¹å®šäº‹ä»¶é¢„è§¦å‘ä¼ é€ã€‚ å‘¨æœŸï¼šä¼ é€åœ¨æ¯ 1 åˆ° 240 ä¸ª SYNC æ¶ˆæ¯åè§¦å‘ã€‚ å¼‚æ­¥ è¿œç¨‹å¸§è§¦å‘ä¼ é€ã€‚é€šè¿‡å‘é€ä¸ PDO çš„ COB-ID ç›¸åŒçš„è¿œç¨‹å¸§æ¥è§¦å‘ PDO å‘é€ ç”±è®¾å¤‡å­åè®®ä¸­è§„å®šçš„å¯¹è±¡ç‰¹å®šäº‹ä»¶è§¦å‘ä¼ é€ã€‚ï¼ˆåŸºæœ¬é‡‡ç”¨è¿™ç§ï¼Œä¾‹å¦‚å®šæ—¶ä¼ è¾“ï¼Œæ•°æ®å˜åŒ–ä¼ è¾“ç­‰ï¼‰ ç”±ä¼ è¾“ç±»å‹å®šä¹‰çš„ä¸åŒ PDO ä¼ è¾“æ¨¡å¼ï¼Œä¼ è¾“ç±»å‹ä¸º PDO é€šè®¯å‚æ•°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œç”± 8 ä½æ— ç¬¦å·æ•´æ•°å®šä¹‰ã€‚ é—´éš”æ—¶é—´ä¸€ä¸ª PDO å¯ä»¥æŒ‡å®šä¸€ä¸ªç¦æ­¢æ—¶é—´ï¼Œå³å®šä¹‰ä¸¤ä¸ªè¿ç»­ PDO ä¼ è¾“çš„æœ€å°é—´éš”æ—¶é—´ï¼Œé¿å…ç”±äºé«˜ä¼˜å…ˆçº§ä¿¡æ¯çš„æ•°æ®é‡å¤ªå¤§ï¼Œå§‹ç»ˆå æ®æ€»çº¿ï¼Œè€Œä½¿å…¶å®ƒä¼˜å…ˆçº§è¾ƒä½çš„æ•°æ®æ— åŠ›ç«äº‰æ€»çº¿çš„é—®é¢˜ã€‚ç¦æ­¢æ—¶é—´ç”± 16 ä½æ— ç¬¦å·æ•´æ•°å®šä¹‰ï¼Œå•ä½ 100usã€‚ å®šæ—¶å‘¨æœŸä¸€ä¸ª PDO å¯ä»¥æŒ‡å®šä¸€ä¸ªäº‹ä»¶å®šæ—¶å‘¨æœŸï¼Œå½“è¶…è¿‡å®šæ—¶æ—¶é—´åï¼Œä¸€ä¸ª PDO ä¼ è¾“å¯ä»¥è¢«è§¦å‘ï¼ˆä¸éœ€è¦è§¦å‘ä½ï¼‰ã€‚äº‹ä»¶å®šæ—¶å‘¨æœŸç”± 16 ä½æ— ç¬¦å·æ•´æ•°å®šä¹‰ï¼Œå•ä½ 1msã€‚ æ˜ å°„å‚æ•°RPDO é€šè®¯å‚æ•° 1400h to 15FFhï¼Œæ˜ å°„å‚æ•° 1600h to 17FFhï¼Œæ•°æ®å­˜æ”¾ä¸º 2000h ä¹‹åå‚å•†è‡ªå®šä¹‰åŒºåŸŸï¼› TPDO é€šè®¯å‚æ•° 1800h to 19FFhï¼Œæ˜ å°„å‚æ•° 1A00h to 1BFFhï¼Œæ•°æ®å­˜æ”¾ä¸º 2000h ä¹‹åå‚å•†è‡ªå®šä¹‰åŒºåŸŸã€‚ åŒ…å«äº†ä¸€ä¸ªå¯¹è±¡å­—å…¸ä¸­çš„å¯¹è±¡åˆ—è¡¨ï¼Œè¿™äº›å¯¹è±¡æ˜ å°„åˆ°ç›¸åº”çš„ PDOï¼Œå…¶ä¸­åŒ…æ‹¬æ•°æ®çš„é•¿åº¦ï¼ˆå•ä½ï¼Œä½ï¼‰ï¼Œå¯¹äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½å¿…é¡»è¦çŸ¥é“è¿™ä¸ªæ˜ å°„å‚æ•°ï¼Œæ‰èƒ½å¤Ÿæ­£ç¡®çš„è§£é‡Š PDO å†…å®¹ã€‚å°±æ˜¯å°†é€šä¿¡å‚æ•°ã€åº”ç”¨æ•°æ®å’Œå…·ä½“ CAN æŠ¥æ–‡ä¸­æ•°æ®è”ç³»èµ·æ¥ã€‚ å­ç´¢å¼• 0ï¼šPDO ä¸­æ˜ å°„åº”ç”¨ç¨‹åºå¯¹è±¡çš„æ•°é‡ï¼š å€¼ 0ï¼šæ˜ å°„è¢«ç¦ç”¨ã€‚ å€¼ 1ï¼šå­ç´¢å¼• 0x01 æœ‰æ•ˆã€‚ å€¼ 2-8: å­ç´¢å¼• 0x01 è‡³ (0x02 è‡³ 0x08) æœ‰æ•ˆã€‚ å­ç´¢å¼• 1-8ï¼š åº”ç”¨å¯¹è±¡ 1-8ï¼š ä½ 16-31ï¼šç´¢å¼• ä½ 8-15ï¼šå­ç´¢å¼• ä½ 0-7ï¼šæ•°æ®é•¿åº¦ï¼ˆä½ï¼‰ ç¤ºä¾‹ç¤ºä¾‹è®¾å¤‡é…ç½® èŠ‚ç‚¹ ID: 0x01 ç¬¬äºŒä¸ª Transmit PDO (TPDO2): TPDO2 çš„ COB-ID: 0x280 + Node_ID 0x281 å¯¹è±¡å­—å…¸ï¼ˆObject Dictionaryï¼‰å®šä¹‰ï¼š 0x1801: TPDO2 é€šä¿¡å‚æ•° å­ç´¢å¼• 0x00: 0x02 (è¡¨ç¤ºæœ‰ 2 ä¸ªå­ç´¢å¼•) å­ç´¢å¼• 0x01: 0x00000281 (TPDO2 çš„ COB-ID, ä½¿èƒ½) å­ç´¢å¼• 0x02: 0x00 (ä¼ è¾“ç±»å‹ï¼Œå‡è®¾ä¸º 0x00 è¡¨ç¤ºåŒæ­¥ä¼ è¾“) 0x1A01: TPDO2 æ˜ å°„å‚æ•° å­ç´¢å¼• 0x00: 0x02 (æ˜ å°„å¯¹è±¡æ•°é‡ï¼Œè¡¨ç¤ºæœ‰ä¸¤ä¸ªå¯¹è±¡æ˜ å°„åˆ°è¿™ä¸ª TPDO) å­ç´¢å¼• 0x01: 0x60000208 (æ˜ å°„å¯¹è±¡ 0x6000ï¼Œå­ç´¢å¼• 0x02ï¼Œ8 ä½) å­ç´¢å¼• 0x02: 0x64010110 (æ˜ å°„å¯¹è±¡ 0x6401ï¼Œå­ç´¢å¼• 0x01ï¼Œ16 ä½) å‡è®¾å½“å‰è®¾å¤‡ä¸­çš„æ•°æ®å¦‚ä¸‹ï¼š å¯¹è±¡ 0x6000ï¼Œå­ç´¢å¼• 0x02: 0xAB å¯¹è±¡ 0x6401ï¼Œå­ç´¢å¼• 0x01: 0x1234 TPDO2 å®é™…å‘é€çš„ CANopen æ•°æ®å¸§æŠ¥æ–‡ç”±ä»¥ä¸‹ 3 ä¸ªå­—èŠ‚ç»„æˆï¼š Byte 0: 0xAB Byte 1: 0x34 (ä½ 8 ä½) Byte 2: 0x12 (é«˜ 8 ä½) å®é™…çš„ CANopen æ•°æ®å¸§ï¼šCAN ID: 0x281 Data: [0xAB, 0x34, 0x12] è®¾ç½®ä¸€ä¸ª TPDO Index 1800 + nï¼Œsubindex 01 ï¼ŒCOB_IDï¼ˆé€šè®¯å¯¹è±¡çš„æ ‡è¯†ç¬¦ï¼‰ï¼šåŒ…å« CAN-ID å’Œé™„åŠ æ§åˆ¶ä½çš„æ ‡è¯†ç¬¦ Index 1800 + nï¼Œsubindex 02ï¼Œ å†™ä¼ è¾“ç±»å‹ tï¼Œ t 1 â€“ 0xF0ï¼šåŒæ­¥ï¼Œæ—¶é—´è§¦å‘æ¨¡å¼ ï¼Œæ¯ t ä¸€å‘¨æœŸ t FD ï¼šæ”¶åˆ° PDO è¯·æ±‚å t FE ï¼šäº‹ä»¶é©±åŠ¨ï¼ˆåˆ¶é€ å•†æŒ‡å®šï¼‰ t FF ï¼šäº‹ä»¶ä¼ è¾“ï¼ŒèŠ‚ç‚¹è‡ªå‘ä¼ è¾“ PDO Index 1800 + nï¼Œ subindex 03ï¼ŒæŠ‘åˆ¶æ—¶é—´ã€‚ å¦‚æœä¼ è¾“ç±»å‹è®¾ç½®ä¸º FE å’Œ FFï¼Œå®ƒæ˜¯æœ€å°çš„ PDO ä¼ è¾“é—´éš”ï¼Œå•ä½ 100usï¼Œå€¼ä¸º 0 ç¦ç”¨æŠ‘åˆ¶æ—¶é—´ã€‚PDO æŠ¥æ–‡éœ€è¦å»¶æ—¶ t Ã— 100us çš„æ—¶é—´æ‰å‘å‡ºï¼Œä»¥æ­¤é¿å…åœ¨å¤š PDO æŠ¥æ–‡åŒæ—¶å‘å‡ºæ—¶ï¼Œå¼•èµ·çš„æ—¶é—´å†²çª ã€‚ Index 1800 + nï¼Œ subindex 05ï¼Œæ—¶é—´å®šæ—¶å™¨ã€‚ å¦‚æœä¼ è¾“ç±»å‹è®¾ç½®ä¸º FE å’Œ FFï¼Œå®ƒæ˜¯ PDO ä¼ è¾“é—´éš”ï¼Œå•ä½ msï¼Œå€¼ä¸º 0 ç¦ç”¨ã€‚t 0xC8ï¼Œ200msã€‚ Index 1A00 + nï¼Œå®šä¹‰æ˜ å°„ subindex 0 ï¼šå®šä¹‰æ˜ å°„æ•°é‡ï¼ˆ1 byteï¼‰ã€‚ å€¼ 0ï¼Œæ˜ å°„ç¦ç”¨ï¼›å€¼ 01ï¼Œå­ç´¢å¼• 01 æœ‰æ•ˆï¼›å€¼ 02ï¼Œå­ç´¢å¼• 01â€“02 æœ‰æ•ˆâ€¦â€¦ subindex 1 ï¼šæ˜ å°„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ æ ¼å¼ï¼Œindex (2 bytes) â€“ subindex (1 byte) â€“ size (1 byte) subindex 2 ï¼šæ˜ å°„ç¬¬äºŒä¸ªå‚æ•°ã€‚ æ ¼å¼ï¼Œindex (2 bytes) â€“ subindex (1 byte) â€“ size (1 byte) 605 2F 00 18 02 FF 00 00 00 è®¾ç½®ç´¢å¼• Index 1800ï¼Œäº‹ä»¶ä¼ è¾“ 605 2F 00 18 05 C8 00 00 00 è®¾ç½®ç´¢å¼• Index 1800ï¼Œæ—¶é—´é—´éš” 200ms 605 2F 00 1A 00 00 00 00 00 è®¾ç½®å­ç´¢å¼•ç¦ç”¨ 605 23 00 1A 01 10 00 30 400x40300010ï¼Œè®¾ç½®æ˜ å°„ç´¢å¼• 0x4030ï¼Œå­ç´¢å¼• 00ï¼Œå¤§å° 0x10ï¼ˆ16 ä½ï¼‰ 605 23 00 1A 02 20 00 10 200x20100020ï¼Œè®¾ç½®æ˜ å°„ç´¢å¼• 0x2010ï¼Œå­ç´¢å¼• 00ï¼Œå¤§å° 0x20ï¼ˆ32 ä½ï¼‰ 605 2F 00 1A 00 02 00 00 00 è®¾ç½®æ˜ å°„æ•°é‡ï¼Œç”¨å¤šå°‘è®¾å¤šå°‘ï¼Œè¿™é‡Œç”¨äº† 2 ä¸ª è®¾ç½®ä¸€ä¸ª RPDO Index 1400 + n, subindex 01 ï¼ŒCOB_IDï¼ˆé€šè®¯å¯¹è±¡çš„æ ‡è¯†ç¬¦ï¼‰ Index 1400 + n, subindex 02ï¼Œå†™ä¼ è¾“ç±»å‹ tï¼Œ t 1 â€“ 0xF0ï¼šåŒæ­¥ï¼Œæ—¶é—´è§¦å‘æ¨¡å¼ ï¼Œæ¯ t ä¸€å‘¨æœŸ t FD ï¼šæ”¶åˆ° PDO è¯·æ±‚å t FE ï¼šäº‹ä»¶é©±åŠ¨ï¼ˆåˆ¶é€ å•†æŒ‡å®šï¼‰ t FF ï¼šäº‹ä»¶ä¼ è¾“ï¼ŒèŠ‚ç‚¹è‡ªå‘ä¼ è¾“ PDO Index 1600 + nï¼Œå®šä¹‰æ˜ å°„ subindex 0 ï¼šå®šä¹‰æ˜ å°„æ•°é‡ï¼ˆ1 byteï¼‰ã€‚ å€¼ 0ï¼Œæ˜ å°„ç¦ç”¨ï¼›å€¼ 01ï¼Œå­ç´¢å¼• 01 æœ‰æ•ˆï¼›å€¼ 02ï¼Œå­ç´¢å¼• 01â€“02 æœ‰æ•ˆâ€¦â€¦ subindex 1 ï¼šæ˜ å°„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ æ ¼å¼ï¼Œindex (2 bytes) â€“ subindex (1 byte) â€“ size (1 byte) subindex 2 ï¼šæ˜ å°„ç¬¬äºŒä¸ªå‚æ•°ã€‚ æ ¼å¼ï¼Œindex (2 bytes) â€“ subindex (1 byte) â€“ size (1 byte) 605 2F 00 14 02 FF 00 00 00 è®¾ç½®ç´¢å¼• Index 1400ï¼Œäº‹ä»¶ä¼ è¾“ 605 2F 00 16 00 00 00 00 00 è®¾ç½®å­ç´¢å¼•ç¦ç”¨ 605 23 00 16 01 10 00 30 40 è®¾ç½®æ˜ å°„ç´¢å¼• 0x4030ï¼Œå­ç´¢å¼• 00ï¼Œå¤§å° 0x10ï¼ˆ16 ä½ï¼‰ 605 2F 00 16 00 01 00 00 00 è®¾ç½®æ˜ å°„æ•°é‡ï¼Œç”¨å¤šå°‘è®¾å¤šå°‘ï¼Œè¿™é‡Œç”¨äº† 01 å®šä¹‰æ˜ å°„æ—¶ï¼Œå…ˆè®¾ç½®å­ç´¢å¼•ç¦ç”¨ï¼›å†è®¾ç½®ç›¸åº”æ˜ å°„ï¼›ç„¶åè®¾ç½®æ˜ å°„æ•°é‡å¯¹äº TPDO æ¥è¯´ï¼Œå…¶é€šä¿¡å‚æ•°ä¸­çš„ COB-ID æ˜¯è‡ªèº«çš„ COB-IDï¼Œå½“å‘é€ TPDO æ—¶ç”¨æ¥è¡¨æ˜è¿™ä¸ª TPDO æ˜¯è°å‘å‡ºçš„ã€‚å¯¹äº RPDO æ¥è¯´ï¼Œå…¶é€šä¿¡å‚æ•°çš„ COB-ID æ˜¯å‘é€æ–¹çš„ COB-IDï¼Œç”¨æ¥è¡¨ç¤ºè‡ªå·±åªæ¥å—æŸä¸ª CAN èŠ‚ç‚¹å‘è¿‡æ¥çš„ TPDOã€‚ åŒæ­¥ï¼ˆSYNCï¼‰SYNC æ¶ˆæ¯é€šå¸¸ç”±åº”ç”¨ç¨‹åºä¸»æœºè§¦å‘ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½ä»¥è¯¥åŒæ­¥æŠ¥æ–‡ä½œä¸º PDO è§¦å‘å‚æ•°ï¼Œå› æ­¤è¯¥åŒæ­¥æŠ¥æ–‡çš„ COB-ID å…·æœ‰æ¯”è¾ƒé«˜çš„ä¼˜å…ˆçº§ä»¥åŠæœ€çŸ­çš„ä¼ è¾“æ—¶é—´ã€‚ä¸€èˆ¬é€‰ç”¨ 0x80 ä½œä¸ºåŒæ­¥æŠ¥æ–‡çš„ CAN-IDï¼Œå°† SYNC æ¶ˆæ¯ï¼ˆCOB-ID 080ï¼‰å‘é€åˆ° CANopen ç½‘ç»œã€‚ åœ¨ç½‘ç»œèŒƒå›´å†…åŒæ­¥ï¼ˆå°¤å…¶åœ¨é©±åŠ¨åº”ç”¨ä¸­ï¼‰ï¼šåœ¨æ•´ä¸ªç½‘ç»œèŒƒå›´å†…å½“å‰è¾“å…¥å€¼å‡†åŒæ—¶ä¿å­˜ï¼Œéšåä¼ é€ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼Œæ ¹æ®å‰ä¸€ä¸ª SYNC åæ¥æ”¶åˆ°çš„æŠ¥æ–‡æ›´æ–°è¾“å‡ºå€¼ã€‚ ä¸»ä»æ¨¡å¼ï¼šSYNC ä¸»èŠ‚ç‚¹å®šæ—¶å‘é€ SYNC å¯¹è±¡ï¼ŒSYNC ä»èŠ‚ç‚¹æ”¶åˆ°ååŒæ­¥æ‰§è¡Œä»»åŠ¡ã€‚ åœ¨ SYNC æŠ¥æ–‡ä¼ é€åï¼Œåœ¨ç»™å®šçš„æ—¶é—´çª—å£å†…ä¼ é€ä¸€ä¸ªåŒæ­¥ PDOã€‚ ç”¨ CAL ä¸­åŸºæœ¬å˜é‡ç±»å‹çš„ CMS å¯¹è±¡å®ç°ã€‚ CANopen å»ºè®®ç”¨ä¸€ä¸ªæœ€é«˜ä¼˜å…ˆçº§çš„ COB-ID ä»¥ä¿è¯åŒæ­¥ä¿¡å·æ­£å¸¸ä¼ é€ã€‚SYNC æŠ¥æ–‡å¯ä»¥ä¸ä¼ é€æ•°æ®ä»¥ä½¿æŠ¥æ–‡å°½å¯èƒ½çŸ­ã€‚ ä¸€èˆ¬åŒæ­¥æŠ¥æ–‡ç”± NMT ä¸»æœºå‘å‡ºï¼ŒCAN æŠ¥æ–‡çš„æ•°æ®ä¸º 0 å­—èŠ‚ã€‚ä½†å¦‚æœä¸€ä¸ªç½‘ç»œå†…æœ‰ 2 ä¸ªåŒæ­¥æœºåˆ¶ï¼Œå°±éœ€è¦è®¾ç½®ä¸åŒçš„åŒæ­¥èŠ‚æ‹ï¼Œæ¯”å¦‚æŸäº›èŠ‚ç‚¹æŒ‰ 1 ä¸ªåŒæ­¥å¸§å‘é€ 1 æ¬¡ PDOï¼Œå…¶ä»–çš„èŠ‚ç‚¹æ”¶åˆ° 2 ä¸ªåŒæ­¥å¸§æ‰å‘é€ 1 æ¬¡ PDOï¼Œæ‰€ä»¥è¿™é‡Œ PDO å‚æ•°ä¸­çš„åŒæ­¥èµ·å§‹å€¼å°±èµ·äº†ä½œç”¨ã€‚ åœ¨åŒæ­¥åè®®ä¸­ï¼Œæœ‰ 3 ä¸ªçº¦æŸæ¡ä»¶ï¼š åŒæ­¥å‘½ä»¤ï¼š0x1005 ä¸­è§„å®šäº†åŒæ­¥å¸§çš„å‘½ä»¤ä¸º 0x80ï¼› é€šè®¯å¾ªç¯å‘¨æœŸï¼šç´¢å¼• 0x1006 è§„å®šäº†åŒæ­¥å¸§çš„å¾ªç¯å‘¨æœŸï¼› åŒæ­¥çª—å£æ—¶é—´ï¼šç´¢å¼• 0x1007 çº¦æŸäº†åŒæ­¥å¸§å‘é€åï¼Œä»èŠ‚ç‚¹å‘é€ PDO çš„æ—¶æ•ˆï¼Œå³åœ¨è¿™ä¸ªæ—¶é—´å†…å‘é€çš„ PDO æ‰æœ‰æ•ˆï¼Œè¶…è¿‡æ—¶é—´çš„ PDO å°†è¢«ä¸¢å¼ƒã€‚ ç¤ºä¾‹é…ç½® 1005 ä¿¡æ¯ï¼Œè®¾ SYNC çš„ COB-ID ä¸º 0x80ï¼ˆé»˜è®¤å€¼ï¼‰ 23 05 10 00 80 00 00 00 è¯»å– 1006 ä¿¡æ¯ 40 06 10 00 00 00 00 00 å†™å…¥ 1006 ä¿¡æ¯ï¼Œå°† SYNC çš„é€šä¿¡å‘¨æœŸè®¾ç½®ä¸º 100msï¼Œé‚£ä¹ˆéœ€è¦å†™å…¥åˆ° 0x1006 çš„å€¼ä¸º 100000ï¼ˆ100ms 100000usï¼‰ 23 06 10 00 A0 86 01 00 æ—¶é—´æˆ³ï¼ˆTIME-stampï¼‰æ—¶é—´æ ‡è®°å¯¹è±¡ï¼ˆTime Stampï¼‰ï¼ŒNMT ä¸»æœºå‘é€è‡ªèº«çš„æ—¶é’Ÿï¼Œä¸ºç½‘ç»œå„ä¸ªèŠ‚ç‚¹æä¾›å…¬å…±çš„æ—¶é—´å‚è€ƒï¼Œå³ç½‘ç»œå¯¹æ—¶ï¼Œè¿™åœ¨æ•…éšœè¯Šæ–­ä¸­éå¸¸éœ€è¦ã€‚ æ—¶é—´æˆ³åè®®é‡‡ç”¨å¹¿æ’­æ–¹å¼ï¼Œæ— éœ€èŠ‚ç‚¹åº”ç­”ï¼ŒCAN-ID ä¸º 0x100ï¼Œæ•°æ®é•¿åº¦ä¸º 6ï¼Œæ•°æ®ä¸ºå½“å‰æ—¶åˆ»ä¸ 1984 å¹´ 1 æœˆ 1 æ—¥ 0 æ—¶çš„æ—¶é—´å·®ã€‚èŠ‚ç‚¹å°†æ­¤æ—¶é—´å­˜å‚¨åœ¨å¯¹è±¡å­—å…¸ 1012h çš„ç´¢å¼•ä¸­ã€‚ ä¸»æœºå‘å‡ºå¸¦æœ‰ CAN ID 100 çš„ TIME æ¶ˆæ¯ï¼ŒTIME æœåŠ¡åŒ…å«ä¸€ä¸ª 6 å­—èŠ‚çš„æ—¥æœŸå’Œæ—¶é—´ä¿¡æ¯ã€‚å…¶ä¸­æœ€åˆçš„ 4 ä¸ªæ•°æ®å­—èŠ‚åŒ…å«åˆå¤œä¹‹åçš„æ¯«ç§’æ•°ï¼Œéšåçš„ 2 ä¸ªå­—èŠ‚åŒ…å«è‡ª 1984 å¹´ 1 æœˆ 1 æ—¥ä»¥æ¥çš„å¤©æ•°ã€‚ ç´§æ€¥æƒ…å†µï¼ˆEMCYï¼‰ç´§æ€¥æŠ¥æ–‡åè®®ï¼ˆEmergency protocolï¼‰ç”¨äºè®¾å¤‡å‘ç”Ÿè‡´å‘½é”™è¯¯ï¼ˆä¾‹å¦‚ä¼ æ„Ÿå™¨æ•…éšœï¼‰çš„æƒ…å†µï¼Œä»è€Œä½¿å…¶å¯ä»¥å‘ç½‘ç»œçš„å…¶ä½™éƒ¨åˆ†æŒ‡ç¤ºæ­¤é”™è¯¯ã€‚ å—å½±å“çš„èŠ‚ç‚¹ä»¥é«˜ä¼˜å…ˆçº§å‘ç½‘ç»œå‘é€å‘é€è®¾å¤‡å†…éƒ¨é”™è¯¯ä»£ç ï¼Œæç¤º NMT ä¸»ç«™ã€‚ç´§æ€¥æŠ¥æ–‡å±äºè¯Šæ–­æ€§æŠ¥æ–‡ï¼Œä¸€èˆ¬ä¸ä¼šå½±å“ CANopen é€šè®¯ï¼Œå…¶ CAN-ID å­˜å‚¨åœ¨ 0x1014 çš„ç´¢å¼•ä¸­ï¼Œä¸€èˆ¬ä¼šå®šä¹‰ä¸º 0x080 + node-IDï¼Œæ•°æ®åŒ…å« 8 ä¸ªå­—èŠ‚ï¼Œä¾‹å¦‚ï¼ŒèŠ‚ç‚¹ 5 å…·æœ‰ COB-ID 085 + æ•°æ®å­—èŠ‚ï¼Œæ•°æ®å­—èŠ‚åŒ…å«æœ‰å…³é”™è¯¯çš„ä¿¡æ¯ï¼Œå¯ä»¥æŸ¥æ‰¾å‚å•†å®šä¹‰çš„é”™è¯¯ä»£ç ã€‚ ç´§æ€¥ä¿¡æ¯çš„å†…å®¹å¦‚ä¸‹ Bytes 0â€¦1ï¼š CO_EM_errorCode_tï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º 0x5000ï¼ˆè®¾å¤‡ç¡¬ä»¶ï¼‰ Bytes 2ï¼šCO_errorRegister_tï¼Œæœ¬ä¾‹ä¸­ä¸º 0x01ï¼ˆé€šç”¨é”™è¯¯ï¼‰ Bytes 3ï¼šCO_EM_errorStatusBits_t ä¸­çš„é”™è¯¯æ¡ä»¶ç´¢å¼•ï¼Œæœ¬ä¾‹ä¸­ä¸º 0x2Fï¼ˆCO_EM_NON_VOLATILE_MEMORY - è®¿é—®éæ˜“å¤±æ€§è®¾å¤‡å†…å­˜æ—¶å‡ºé”™ï¼‰ Bytes 4â€¦7ï¼šé™„åŠ ä¿¡æ¯å‚æ•°ï¼Œæœ¬ä¾‹ä¸­ä¸º 0x00000014 æˆ– 0x00000074 ç´§æ€¥ä¿¡æ¯ç”± CO_errorReport() å‡½æ•°å†…éƒ¨è§¦å‘ã€‚å¯ä»¥åœ¨ CO_EM_NON_VOLATILE_MEMORY çš„æºä»£ç ä¸­æŸ¥æ‰¾ç´§æ€¥ä¿¡æ¯çš„æ¥æºã€‚ CO_EM_NON_VOLATILE_MEMORY æ˜¯ä¸€èˆ¬çš„ä¸¥é‡é”™è¯¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šè®¾ç½® CANopen é”™è¯¯å¯„å­˜å™¨ã€‚å¦‚æœé”™è¯¯å¯„å­˜å™¨çš„å€¼ä¸ç­‰äºé›¶ï¼Œåˆ™ç¦æ­¢èŠ‚ç‚¹è¿›å…¥ NMT è¿è¡ŒçŠ¶æ€ï¼Œå¹¶ä¸”ä¸èƒ½ä¸å…¶äº¤æ¢ PDOã€‚ èŠ‚ç‚¹ç›‘æµ‹NMT ä¸»æœºå®šæœŸä½¿ç”¨è¿œç¨‹å¸§è¯¢é—®ä»æœºçš„å½“å‰çŠ¶æ€ï¼Œå¹¶å°†å…¶ä¸ç½‘ç»œæ•°æ®åº“ä¸­è®°å½•çš„æ—©æœŸçŠ¶æ€ç›¸æ¯”è¾ƒã€‚ä»»ä½•ä¸åŒ¹é…å’Œç¼ºå°‘ PDO ä¼ è¾“çš„çŠ¶æ€éƒ½ä¼šä»¥é€‚å½“çš„é”™è¯¯ä»£ç è¡¨ç¤ºï¼Œç„¶ååº”ç”¨ç¨‹åºå°†é‡‡å–é€‚å½“çš„æ“ä½œï¼Œå¦‚è®¾å¤‡é‡ç½®æˆ–é”™è¯¯æ ‡è¯†ã€‚è¿™ç§°ä¸ºèŠ‚ç‚¹ç›‘æµ‹ï¼Œæ˜¯é€šè¿‡ä½¿ç”¨èŠ‚ç‚¹ç›‘æµ‹åè®®å¾—ä»¥å®ç°ã€‚ NMT ä»æœºä½¿ç”¨ä¸€ç§ç§°ä¸ºç”Ÿå‘½ç›‘æµ‹çš„æŠ€æœ¯ï¼Œé€šè¿‡åœ¨é¢„å®šä¹‰çš„æ—¶é—´é—´éš”é‡Œï¼Œå†…éƒ¨æ£€æŸ¥èŠ‚ç‚¹ç›‘æµ‹å¸§çš„æ¥æ”¶ï¼Œæ¥æ£€æµ‹ NMT ä¸»æœºçš„ç¼ºå¤±ã€‚ ç°ä»£è®¾å¤‡è®¾è®¡ä½¿ç”¨ Heartbeat åè®®è¿›è¡ŒèŠ‚ç‚¹ç›‘è§†ï¼Œå…¶ä¸­ NMT ä»è®¾å¤‡ï¼ˆHeartbeat Producer å¿ƒè·³å‘å‡ºè€…ï¼‰å°†å‘¨æœŸæ€§åœ°å‘ NMT ä¸»è®¾å¤‡ï¼ˆHeartbeat Consumer å¿ƒè·³ä½¿ç”¨è€…ï¼‰å‘é€ Heartbeat æŠ¥æ–‡ã€‚ è¿™äº›æŠ¥æ–‡ä¹‹é—´çš„é—´éš”æ˜¯å¯é…ç½®çš„ï¼Œå¹¶åœ¨ä¸»ã€ä»ä¸¤ä¸ªè®¾å¤‡çš„å¯¹è±¡å­—å…¸ä¸­ Heartbeat producer timeï¼ˆå¿ƒè·³äº§ç”Ÿæ—¶é—´ï¼‰å¯¹è±¡ä¸Šéƒ½è¿›è¡Œè®¾ç½®ã€‚å¦‚æœå¿ƒè·³æŠ¥æ–‡åœ¨æ­¤æ—¶é—´é™åˆ¶å†…æœªåˆ°è¾¾ï¼Œåˆ™å‘å‡ºè€…å°†è¢«è§†ä¸ºå…³æœºï¼Œä½¿ç”¨è€…å°†é‡‡å–è¡¥æ•‘æªæ–½ï¼Œå¦‚è®¾å¤‡é‡ç½®æˆ–é”™è¯¯æ˜¾ç¤ºã€‚ å½“ä¸€ä¸ª Heartbeat èŠ‚ç‚¹å¯åŠ¨åå®ƒçš„ Boot-up æŠ¥æ–‡æ˜¯å…¶ç¬¬ä¸€ä¸ª Heartbeat æŠ¥æ–‡ã€‚Heartbeat æ¶ˆè´¹è€…é€šå¸¸æ˜¯ NMT-Master èŠ‚ç‚¹ï¼Œå®ƒä¸ºæ¯ä¸ª Heartbeat èŠ‚ç‚¹è®¾å®šä¸€ä¸ªè¶…æ—¶å€¼ï¼Œå½“è¶…æ—¶å‘ç”Ÿæ—¶é‡‡å–ç›¸åº”åŠ¨ä½œã€‚ ç¤ºä¾‹è¯»å–å¿ƒè·³æ—¶é—´è®¾ç½® 40 17 10 00 00 00 00 00 é€šè¿‡é…ç½® 0x1017 çš„ heartbeat æ—¶é—´ï¼Œè‡ªåŠ¨ä¸ŠæŠ¥è®¾å¤‡çŠ¶æ€ã€‚ 2B 17 10 00 E8 03 00 00 Master èŠ‚ç‚¹å‘é€è¿œç¨‹å¸§ï¼ˆæ— æ•°æ®ï¼‰NMT-Master - NMT-Slave COB-ID 0x700 + Node_ID NMT-Slave èŠ‚ç‚¹å‘é€å¦‚ä¸‹æŠ¥æ–‡åº”ç­” NMT-Master - NMT-Slave COB-ID 0x700 + Node_ID Byte0 Bit 7-0 : çŠ¶æ€ LSSLSSï¼ˆLayer Setting Servicesï¼‰æ˜¯ä¸€ä¸ªç”¨äºé…ç½®å’Œç®¡ç† CANopen è®¾å¤‡çš„ä¸€ç§æœåŠ¡ã€‚å®ƒæä¾›äº†ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½ï¼Œä¸»è¦ç”¨äºè®¾å¤‡çš„åˆå§‹åŒ–å’Œé…ç½®ï¼Œä¾‹å¦‚è®¾ç½®èŠ‚ç‚¹ ID å’Œæ³¢ç‰¹ç‡ã€‚LSS å¯¹äºåœ¨ç”Ÿäº§ã€è°ƒè¯•å’Œè¿è¡Œè¿‡ç¨‹ä¸­é…ç½® CANopen è®¾å¤‡éå¸¸æœ‰ç”¨ã€‚ LSS çš„ä¸»è¦åŠŸèƒ½ è®¾ç½®èŠ‚ç‚¹ IDï¼š åœ¨ CANopen ç½‘ç»œä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„èŠ‚ç‚¹ IDï¼ŒèŒƒå›´ä¸º 1 åˆ° 127ã€‚LSS å…è®¸åŠ¨æ€è®¾ç½®æˆ–ä¿®æ”¹èŠ‚ç‚¹ IDï¼Œè€Œä¸éœ€è¦ç‰©ç†è®¿é—®è®¾å¤‡ã€‚è¿™åœ¨è®¾å¤‡åˆå§‹å®‰è£…å’Œæ›¿æ¢æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚ è®¾ç½®æ³¢ç‰¹ç‡ï¼š CANopen ç½‘ç»œä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å¿…é¡»ä½¿ç”¨ç›¸åŒçš„æ³¢ç‰¹ç‡è¿›è¡Œé€šä¿¡ã€‚LSS å…è®¸åŠ¨æ€ä¿®æ”¹è®¾å¤‡çš„æ³¢ç‰¹ç‡ï¼Œä»¥ä¾¿åœ¨ä¸åŒçš„ç½‘ç»œæ¡ä»¶ä¸‹è¿›è¡Œé€‚åº”å’Œä¼˜åŒ–ã€‚ è®¾å¤‡è¯†åˆ«ï¼š LSS å¯ä»¥ç”¨äºè¯†åˆ«ç½‘ç»œä¸­çš„è®¾å¤‡ã€‚é€šè¿‡ LSS æœåŠ¡ï¼Œå¯ä»¥æŸ¥è¯¢è®¾å¤‡çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆä¾‹å¦‚åˆ¶é€ å•†ä»£ç ã€äº§å“ä»£ç ã€åºåˆ—å·ç­‰ï¼‰ï¼Œä»è€Œå®ç°è®¾å¤‡çš„è¯†åˆ«å’Œç®¡ç†ã€‚ LSS æœåŠ¡çš„ä¸»è¦æ“ä½œ Switch Mode Globalï¼š åˆ‡æ¢æ‰€æœ‰èŠ‚ç‚¹åˆ°é…ç½®æ¨¡å¼æˆ–æ“ä½œæ¨¡å¼ã€‚ Switch Mode Selectiveï¼š é€‰æ‹©æ€§åœ°åˆ‡æ¢ç‰¹å®šèŠ‚ç‚¹åˆ°é…ç½®æ¨¡å¼æˆ–æ“ä½œæ¨¡å¼ã€‚ Configure Node-IDï¼š è®¾ç½®èŠ‚ç‚¹ IDã€‚ Configure Bit Timing Parametersï¼š è®¾ç½® CAN æ€»çº¿çš„æ³¢ç‰¹ç‡å‚æ•°ã€‚ Identify Remote Slaveï¼š è¯†åˆ«ç½‘ç»œä¸­çš„è®¾å¤‡ï¼Œè¯»å–å…¶å”¯ä¸€æ ‡è¯†ç¬¦ã€‚ LSS åè®®çš„ç¤ºä¾‹å‡è®¾ä»¬éœ€è¦å°†ä¸€ä¸ªè®¾å¤‡çš„èŠ‚ç‚¹ ID è®¾ç½®ä¸º 0x02ï¼Œå¹¶å°†æ³¢ç‰¹ç‡è®¾ç½®ä¸º 250 kbpsã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ LSS çš„æ­¥éª¤ï¼š åˆ‡æ¢åˆ°é…ç½®æ¨¡å¼ï¼š å‘é€ LSS Switch Mode Selective å‘½ä»¤ï¼Œå°†ç›®æ ‡è®¾å¤‡åˆ‡æ¢åˆ°é…ç½®æ¨¡å¼ã€‚ è®¾ç½®èŠ‚ç‚¹ IDï¼š ä½¿ç”¨ LSS Configure Node-ID å‘½ä»¤ï¼Œè®¾ç½®è®¾å¤‡çš„èŠ‚ç‚¹ IDã€‚ è®¾ç½®æ³¢ç‰¹ç‡ï¼š ä½¿ç”¨ LSS Configure Bit Timing Parameters å‘½ä»¤ï¼Œè®¾ç½®è®¾å¤‡çš„æ³¢ç‰¹ç‡ã€‚ åˆ‡æ¢åˆ°æ“ä½œæ¨¡å¼ï¼š å‘é€ LSS Switch Mode Global å‘½ä»¤ï¼Œå°†æ‰€æœ‰è®¾å¤‡åˆ‡æ¢åˆ°æ“ä½œæ¨¡å¼ã€‚ LSS æ¶ˆæ¯æ ¼å¼LSS æ¶ˆæ¯ä½¿ç”¨ç‰¹å®šçš„ CAN æ ‡è¯†ç¬¦å’Œæ•°æ®æ ¼å¼ã€‚ä»¥ä¸‹æ˜¯ LSS Switch Mode Selective å‘½ä»¤çš„ç¤ºä¾‹ï¼š CAN IDï¼š0x7E5ï¼ˆLSS ä¸»ç«™åˆ°ä»ç«™ï¼‰ æ•°æ®ï¼š0x04 0x00 0x00 0x00 0x00 0x00 0x00 0x00ï¼ˆåˆ‡æ¢åˆ°é…ç½®æ¨¡å¼ï¼‰ è®¾ç½®èŠ‚ç‚¹ ID çš„å‘½ä»¤ï¼š CAN IDï¼š0x7E5 æ•°æ®ï¼š0x11 0x02 0x00 0x00 0x00 0x00 0x00 0x00ï¼ˆè®¾ç½®èŠ‚ç‚¹ ID ä¸º 0x02ï¼‰ è®¾ç½®æ³¢ç‰¹ç‡çš„å‘½ä»¤ï¼š CAN IDï¼š0x7E5 æ•°æ®ï¼š0x13 0x03 0x00 0x00 0x00 0x00 0x00 0x00ï¼ˆè®¾ç½®æ³¢ç‰¹ç‡ä¸º 250 kbpsï¼Œå‡è®¾ 0x03 è¡¨ç¤º 250 kbpsï¼‰","categories":["4.é€šè®¯åè®®","CAN"]},{"title":"CANOpen è°ƒè¯•","path":"/2024/01/03/4-é€šè®¯åè®®-CAN-CANOpen-è°ƒè¯•/","content":"ä½œä¸º CAN Open æ€»çº¿ä¸Šçš„æ•°æ®æŠ“å–è®¾å¤‡ï¼Œè¦æ±‚ç¨‹åºå…·æœ‰ä»¥ä¸‹åŠŸèƒ½ èƒ½å¤Ÿä½œä¸ºæ€»çº¿ä¸Šçš„ä»æœºè®¾å¤‡ï¼Œè¦æ±‚å…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š HeartBeat æœ¬è®¾å¤‡ SDO é…ç½®é¡¹ PDO æ•°æ®é…ç½® å¦‚ä½•é€šè¿‡ä¸»æœº ASK æŸä¸€è®¾å¤‡çš„æ•°æ® èƒ½å¤Ÿä½œä¸ºæ€»çº¿ä¸Šçš„ä¸»æœºè®¾å¤‡ï¼Œè¦æ±‚å…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š ä»æœºè®¾å¤‡çš„çŠ¶æ€ç®¡ç† PDO æ•°æ®é‡‡é›† ä¾‹å¦‚ï¼Œé¢„é…ç½®çš„è¿‡ç¨‹æ•°æ®å¯¹è±¡ (PDO) ç”±ç”Ÿäº§è€…ä¼ è¾“ã€‚æ¯ä¸ª PDO å¯èƒ½ç”±å¤šä¸ªèŠ‚ç‚¹ä½¿ç”¨ã€‚æ¯ä¸ª CANopen è®¾å¤‡çš„å…¶ä»–æœ‰ç”¨çš„ CANopen åŠŸèƒ½è¿˜åŒ…æ‹¬ï¼šå¿ƒè·³ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€ç´§æ€¥ç”Ÿäº§è€…ã€åŒæ­¥ç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ã€æ—¶é—´ç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ã€SDO æœåŠ¡å™¨ï¼ˆæœåŠ¡æ•°æ®å¯¹è±¡ - ä»å¯¹è±¡å­—å…¸ä¸­æä¾›å˜é‡ï¼‰ã€NMT ä»å±ï¼ˆç½‘ç»œç®¡ç† - å¯åŠ¨æˆ–åœæ­¢é€šä¿¡éƒ¨åˆ†ï¼‰ã€LSS ä»å±ï¼ˆèŠ‚ç‚¹ ID å’Œæ¯”ç‰¹ç‡çš„é…ç½®ï¼‰ã€‚ CANopen ç½‘ç»œé€šå¸¸æœ‰ä¸€ä¸ªå…·æœ‰å‘½ä»¤åŠŸèƒ½çš„è®¾å¤‡ç”¨äºç½‘ç»œé…ç½®ï¼Œä¾‹å¦‚ï¼šNMT ä¸»ç«™ã€LSS ä¸»ç«™ã€SDO å®¢æˆ·ç«¯ã€ç´§æ€¥æ¶ˆè´¹è€…ã€‚CANopenNode ä¸­çš„å‘½ä»¤åŠŸèƒ½æ ¹æ®æ ‡å‡† CiA309-3 ä½¿ç”¨ Ascii å‘½ä»¤è¡Œæ¥å£å®ç°ã€‚ ä½¿èƒ½ CAN æ¥å£Linux ä¸‹ è™šæ‹Ÿ CAN è®¾å¤‡modprobe æ˜¯ Linux ç³»ç»Ÿä¸­çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç®¡ç†å†…æ ¸æ¨¡å—ã€‚å†…æ ¸æ¨¡å—æ˜¯å¯ä»¥åŠ¨æ€åŠ è½½æˆ–å¸è½½çš„å¯æ‰©å±•ç»„ä»¶ï¼Œå…è®¸ Linux å†…æ ¸åœ¨è¿è¡Œæ—¶æ·»åŠ æˆ–åˆ é™¤åŠŸèƒ½è€Œä¸éœ€è¦é‡å¯ç³»ç»Ÿã€‚å¸¸è§çš„å†…æ ¸æ¨¡å—åŒ…æ‹¬è®¾å¤‡é©±åŠ¨ç¨‹åºã€æ–‡ä»¶ç³»ç»Ÿæ”¯æŒä»¥åŠç½‘ç»œåè®®ç­‰ã€‚ åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿ CAN è®¾å¤‡ï¼Œå¹¶å¯ç”¨ sudo modprobe vcansudo ip link add dev can0 type vcansudo ip link set up can0 å®‰è£… CAN ç›‘æµ‹è°ƒè¯•å·¥å…·ï¼Œcan-utils é¡¹ç›®åœ°å€ https://github.com/linux-can/can-utils sudo apt-get install can-utilscandump -td can0 #æ˜¾ç¤ºcanæ¶ˆæ¯ rk3568 çš„ can ä½¿ç”¨æ—¶ ip link set can0 up å¯ç”¨å¤±è´¥æŠ¥é”™ï¼š can0: incorrect missing data bit-timing é©±åŠ¨é—®é¢˜ï¼Œè®¾å¤‡æ ‘ä¸­çš„èŠ‚ç‚¹é…ç½®ï¼Œéœ€è¦å°† kernel/arch/arm64/boot/dts/rockchip/rk3568.dtsi ä¸­çš„ can0 èŠ‚ç‚¹ä¸­çš„ compatible = rockchip,canfd-1.0 ä¿®æ”¹ä¸º compatible = rockchip,can-1.0ï¼Œé‡æ–°ç¼–è¯‘åä¸‹è½½ å¼€å‘æ¿ 3568 çš„ CANifconfig can0 downip link set can0 up type can bitrate 500000ifconfig can0 upifconfig can1 downip link set can1 up type can bitrate 500000ifconfig can1 upip link set can0 downip link set can1 downip link set can0 up type can bitrate 1000000 sample-point 0.75 dbitrate 4000000 dsample-point 0.8 fd onip link set can1 up type can bitrate 1000000 sample-point 0.75 dbitrate 4000000 dsample-point 0.8 fd on#æŸ¥è¯¢å½“å‰ç½‘ç»œè®¾å¤‡:ifconfig -a#å…³é—­CAN:ip link set can0 down#è®¾ç½®æ¯”ç‰¹ç‡500KHz:ip link set can0 type can bitrate 500000#æ‰“å°can0ä¿¡æ¯:ip -details -statistics link show can0#å¯åŠ¨CAN:ip link set can0 up#å‘é€ï¼ˆæ ‡å‡†å¸§,æ•°æ®å¸§,ID:123,date:DEADBEEFï¼‰:cansend can0 123#DEADBEEF#å‘é€ï¼ˆæ ‡å‡†å¸§,è¿œç¨‹å¸§,ID:123ï¼‰:cansend can0 123#R#å‘é€ï¼ˆæ‰©å±•å¸§,æ•°æ®å¸§,ID:00000123,date:DEADBEEFï¼‰:cansend can0 00000123#12345678#å‘é€ï¼ˆæ‰©å±•å¸§,è¿œç¨‹å¸§,ID:00000123ï¼‰:cansend can0 00000123#R#å¼€å¯æ‰“å°ï¼Œç­‰å¾…æ¥æ”¶:candump can0###########################################è®¾ç½®can fd#è®¾ç½®ä»²è£æ®µ1Mæ³¢ç‰¹ç‡ï¼Œæ•°æ®æ®µ3Mæ³¢ç‰¹ç‡:ip link set can0 type can bitrate 1000000 dbitrate 3000000 fd on#å‘é€ï¼ˆæ ‡å‡†å¸§,æ•°æ®å¸§,ID:123,date:DEADBEEFï¼‰:cansend can0 123##1DEADBEEF#å‘é€ï¼ˆæ‰©å±•å¸§,æ•°æ®å¸§,ID:00000123,date:DEADBEEFï¼‰:cansend can0 00000123##1DEADBEEFifconfig -aip link set can0 type can bitrate 500000ip link set can0 upip link set can1 type can bitrate 500000ip link set can1 upcandump can0 cansend can1 123#DEADBEEFcansend can1 123#DEADBEEF è¿™ä¸ªå‘½ä»¤æ˜¯ç”¨äºé…ç½® CANï¼ˆController Area Networkï¼Œæ§åˆ¶å™¨å±€åŸŸç½‘ç»œï¼‰æ¥å£çš„ Linux å‘½ä»¤è¡ŒæŒ‡ä»¤ã€‚CAN æ˜¯ä¸€ç§ç”¨äºå®æ—¶åº”ç”¨çš„è½¦è¾†ã€å·¥ä¸šæ§åˆ¶åŠè‡ªåŠ¨åŒ–é¢†åŸŸçš„ä¸²è¡Œé€šä¿¡åè®®ã€‚ä¸‹é¢æ˜¯å¯¹è¯¥å‘½ä»¤å„éƒ¨åˆ†å«ä¹‰çš„è¯¦ç»†è§£æï¼š ip link set can0 up è¿™éƒ¨åˆ†å‘½ä»¤æ˜¯ç”¨æ¥è®¾ç½®æŒ‡å®šçš„ç½‘ç»œæ¥å£ï¼ˆ%s æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œé€šå¸¸åœ¨è„šæœ¬ä¸­ä½¿ç”¨ï¼Œè¿è¡Œæ—¶ä¼šè¢«å®é™…çš„æ¥å£åç§°æ›¿æ¢ï¼‰ä¸ºæ´»åŠ¨çŠ¶æ€ï¼ˆupï¼‰ã€‚è¿™æ„å‘³ç€å®ƒå°†å¯åŠ¨æŒ‡å®šçš„ CAN æ¥å£ï¼Œä½¿å…¶å‡†å¤‡å¥½è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚ type can æŒ‡å®šæ¥å£ç±»å‹ä¸º CAN æ€»çº¿ã€‚è¿™æ˜¯å‘Šè¯‰ç³»ç»Ÿè¯¥æ¥å£åº”è¯¥è¢«é…ç½®å’Œå¤„ç†ä¸º CAN æ€»çº¿æ¥å£ï¼Œè€Œä¸æ˜¯ä»¥å¤ªç½‘æˆ–å…¶ä»–ç±»å‹çš„ç½‘ç»œæ¥å£ã€‚ bitrate 500000 è®¾ç½® CAN æ€»çº¿çš„æ¯”ç‰¹ç‡ï¼ˆé€šä¿¡é€Ÿåº¦ï¼‰ã€‚500000 ä»£è¡¨å…·ä½“çš„æ¯”ç‰¹ç‡å€¼ï¼Œä¾‹å¦‚ 125000 è¡¨ç¤º 125Kbpsã€‚æ¯”ç‰¹ç‡æ˜¯æŒ‡æ¯ç§’é’Ÿä¼ è¾“çš„ä½æ•°ï¼Œæ˜¯ CAN æ€»çº¿é…ç½®ä¸­çš„ä¸€ä¸ªå…³é”®å‚æ•°ï¼Œéœ€è¦æ‰€æœ‰è¿æ¥åˆ°åŒä¸€æ€»çº¿ä¸Šçš„è®¾å¤‡åŒ¹é…ã€‚ sample-point 0.75 é…ç½® CAN ä½é‡‡æ ·ç‚¹çš„ä½ç½®ã€‚é‡‡æ ·ç‚¹æ˜¯åœ¨æ¯ä¸ª CAN ä½çš„å“ªä¸ªæ—¶é—´ç‚¹è¿›è¡Œä¿¡å·é‡‡æ ·ä»¥ç¡®å®šä½çš„é€»è¾‘ç”µå¹³ï¼ˆ0 æˆ– 1ï¼‰ã€‚å€¼èŒƒå›´ä» 0 åˆ° 1ï¼Œå…¶ä¸­ 1 ä»£è¡¨ä½æ—¶é—´å‘¨æœŸçš„ç»“æŸã€‚è¿™é‡Œè®¾ç½®ä¸º 0.75 æ„å‘³ç€åœ¨æ¯ä½çš„ 75%æ—¶é—´ç‚¹è¿›è¡Œé‡‡æ ·ã€‚ dbitrate 4000000 åˆ†å¸ƒå¼æ¯”ç‰¹ç‡ï¼ˆData Bit Rateï¼‰è®¾ç½®ã€‚è¿™é€šå¸¸ç”¨äº FlexCANï¼ˆFlexible Data-Rate CANï¼‰ç­‰é«˜çº§ CAN åè®®å˜ä½“ä¸­ï¼Œå…è®¸æ•°æ®æ®µçš„æ¯”ç‰¹ç‡ä¸ä»²è£æ®µä¸åŒã€‚è¿™é‡Œè®¾ç½®ä¸º 4000000 è¡¨ç¤ºæ•°æ®æ®µçš„æ¯”ç‰¹ç‡ä¸º 4Mbpsã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ ‡å‡† CAN åè®®å¹¶ä¸æ”¯æŒä¸åŒçš„æ•°æ®å’Œä»²è£æ¯”ç‰¹ç‡ï¼Œè¿™ä¸€é€‰é¡¹å¯èƒ½ç‰¹å®šäºæŸäº›é«˜çº§ CAN æ§åˆ¶å™¨æˆ–å®ç°ã€‚ dsample-point 0.8 æ•°æ®æ®µçš„é‡‡æ ·ç‚¹ä½ç½®ï¼Œç±»ä¼¼äºä¸Šè¿°çš„ sample-pointï¼Œä½†ç‰¹æŒ‡æ•°æ®æ®µï¼ˆå¦‚æœé€‚ç”¨ï¼‰ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ•°æ®æ®µçš„é‡‡æ ·ç‚¹è¢«è®¾ç½®åœ¨æ¯ä½çš„ 80%æ—¶é—´ç‚¹ã€‚ fd on å¯ç”¨ CAN FDï¼ˆFlexible Data-rate CANï¼‰æ¨¡å¼ã€‚CAN FD æ˜¯ CAN æ€»çº¿åè®®çš„ä¸€ä¸ªæ‰©å±•ï¼Œå…è®¸æ›´çµæ´»çš„æ•°æ®é•¿åº¦å’Œæ›´é«˜çš„æ•°æ®ä¼ è¾“é€Ÿç‡ï¼Œæ—¨åœ¨æé«˜ CAN ç½‘ç»œçš„æ•°æ®ååé‡ã€‚ CAN é€šä¿¡æµ‹è¯•å·¥å…·canutils æ˜¯å¸¸ç”¨çš„ CAN é€šä¿¡æµ‹è¯•å·¥å…·åŒ…ï¼Œå†…å« 5 ä¸ªç‹¬ç«‹çš„ç¨‹åºï¼šcanconfigã€candumpã€canechoã€cansendã€cansequenceã€‚ è¿™å‡ ä¸ªç¨‹åºçš„åŠŸèƒ½ç®€è¿°å¦‚ä¸‹ï¼š canconfig ç”¨äºé…ç½® CAN æ€»çº¿æ¥å£çš„å‚æ•°ï¼Œä¸»è¦æ˜¯æ³¢ç‰¹ç‡å’Œæ¨¡å¼ã€‚ candump ä» CAN æ€»çº¿æ¥å£æ¥æ”¶æ•°æ®å¹¶ä»¥åå…­è¿›åˆ¶å½¢å¼æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼Œä¹Ÿå¯ä»¥è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ã€‚ canecho æŠŠä» CAN æ€»çº¿æ¥å£æ¥æ”¶åˆ°çš„æ‰€æœ‰æ•°æ®é‡æ–°å‘é€åˆ° CAN æ€»çº¿æ¥å£ã€‚ cansend å¾€æŒ‡å®šçš„ CAN æ€»çº¿æ¥å£å‘é€æŒ‡å®šçš„æ•°æ®ã€‚ cansequence å¾€æŒ‡å®šçš„ CAN æ€»çº¿æ¥å£è‡ªåŠ¨é‡å¤é€’å¢æ•°å­—ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ¥æ”¶æ¨¡å¼å¹¶æ ¡éªŒæ£€æŸ¥æ¥æ”¶çš„é€’å¢æ•°å­—ã€‚ ip CAN æ³¢ç‰¹ç‡ã€åŠŸèƒ½ç­‰é…ç½®ã€‚ æ³¨æ„ï¼šbusybox é‡Œä¹Ÿæœ‰é›†æˆäº† ip å·¥å…·ï¼Œä½† busybox é‡Œçš„æ˜¯é˜‰å‰²ç‰ˆæœ¬ã€‚ä¸æ”¯æŒ CAN çš„æ“ä½œã€‚æ•…ä½¿ç”¨å‰è¯·å…ˆç¡®å®š ip å‘½ä»¤çš„ç‰ˆæœ¬ï¼ˆiproute2ï¼‰ã€‚ä¸Šé¢å·¥å…·åŒ…ï¼Œç½‘ç»œä¸Šéƒ½æœ‰è¯¦ç»†çš„ç¼–è¯‘è¯´æ˜ã€‚å¦‚æœæ˜¯è‡ªå·±ç¼–è¯‘ buildrootï¼Œç›´æ¥å¼€å¯å®å°±å¯ä»¥æ”¯æŒä¸Šè¿°å·¥å…·åŒ…ã€‚ BR2_PACKAGE_CAN_UTILS=yBR2_PACKAGE_IPROUTE2=y CAN æ¯”ç‰¹ç‡å’Œé‡‡æ ·ç‚¹è®¡ç®—ç›®å‰ CAN æ¶æ„æ ¹æ®è¾“å…¥é¢‘ç‡å’Œæ¯”ç‰¹ç‡è‡ªåŠ¨è®¡ç®—ã€‚é‡‡æ ·ç‚¹çš„è§„åˆ™æŒ‰ç…§ CIA æ ‡å‡†åè®®ï¼š /* Use CiA recommended sample points */if (bt-sample_point) sample_point_nominal = bt-sample_point; else if (bt-bitrate 800000) sample_point_nominal = 750;\telse if (bt-bitrate 500000) sample_point_nominal = 800;\telse sample_point_nominal = 875; æ¯”ç‰¹ç‡è®¡ç®—å…¬å¼ï¼ˆè¯¦ç»†åŸç†å¯ä»¥ç™¾åº¦ï¼Œè¿™é‡Œåªä»‹ç»èŠ¯ç‰‡é…ç½®ç›¸å…³ï¼‰ï¼š BitRate = clk_can / (2 *(brq + 1) / ((tseg2 + 1) + (tseg1 + 1) + 1)Sample = (1 + (tseg1 + 1)) / (1 + (tseg1 + 1) + (tseg2 + 1)) brqã€tseg1ã€tseg2 è§ CAN çš„ TRM ä¸­ BITTIMING å¯„å­˜å™¨ã€‚ CAN Open ç”¨ä¾‹åˆ†æSDO å‘½ä»¤-çŠ¶æ€æ¢å¤å’Œå­˜å‚¨ç´§æ€¥ä¿¡æ¯ã€é”™è¯¯å¯„å­˜å™¨å’Œ NMT è¿è¡Œå‰çŠ¶æ€åœ¨æœªåˆå§‹åŒ–çš„éæ˜“å¤±æ€§å­˜å‚¨å™¨ä¸­éƒ½æœ‰æ•°æ®æºã€‚å¯¹è±¡ 0x1010 å’Œ 0x1011 ç”¨äºå­˜å‚¨å’Œæ¢å¤æ•°æ®ï¼Œé€šå¸¸æ¥è‡ª CANopen å¯¹è±¡å­—å…¸ã€‚ CO_EM_NON_VOLATILE_MEMORY æ˜¯ä¸€èˆ¬çš„ä¸¥é‡é”™è¯¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šè®¾ç½® CANopen é”™è¯¯å¯„å­˜å™¨ã€‚å¦‚æœé”™è¯¯å¯„å­˜å™¨çš„å€¼ä¸ä¸ºé›¶ï¼Œåˆ™å¯èƒ½ç¦æ­¢èŠ‚ç‚¹è¿›å…¥ NMT æ“ä½œçŠ¶æ€ï¼Œå¹¶ä¸”æ— æ³•ä¸å…¶äº¤æ¢ PDOã€‚ æ¢å¤æ‰€æœ‰éæ˜“å¤±æ€§å­˜å‚¨å™¨ï¼š CAN IDï¼š0x600 + èŠ‚ç‚¹ IDï¼ˆè¡¨ç¤ºä»ä¸»æœºåˆ°ä»èŠ‚ç‚¹çš„ SDO è¯·æ±‚ï¼‰ã€‚0x600 + 4 0x604ã€‚ å‘½ä»¤å­—èŠ‚ï¼šè¡¨ç¤ºå†™å…¥å‘½ä»¤å’Œæ•°æ®é•¿åº¦ã€‚0x23 è¡¨ç¤ºå†™å…¥ 4 å­—èŠ‚æ•°æ®ï¼ˆvisible stringï¼‰ã€‚ ç´¢å¼•ï¼šå¯¹è±¡å­—å…¸ç´¢å¼•ã€‚0x1011ï¼ˆå­—èŠ‚é¡ºåºä¸ºä½å­—èŠ‚åœ¨å‰ï¼‰ã€‚ å­ç´¢å¼•ï¼šå¯¹è±¡å­—å…¸å­ç´¢å¼•ã€‚0x01 æ•°æ®ï¼šloadï¼šASCII ç  lã€oã€aã€d åˆ†åˆ«ä¸º 0x6Cã€0x6Fã€0x61ã€0x64ã€‚ æ„å»ºæ•°æ®æ¢å¤ CAN å¸§ CAN IDï¼š0x604ã€‚ æ•°æ®ï¼šå‘½ä»¤å­—èŠ‚ï¼ˆ0x23ï¼‰ï¼Œç´¢å¼•ï¼ˆ0x11 0x10ï¼‰ï¼Œå­ç´¢å¼•ï¼ˆ0x01ï¼‰ï¼Œæ•°æ®ï¼ˆ0x6C 0x6F 0x61 0x64ï¼‰ã€‚ can0 604 [8] 23 11 10 01 6C 6F 61 64 saveï¼šASCII ç  sã€aã€vã€e åˆ†åˆ«ä¸º 0x73ã€0x61ã€0x76ã€0x65ã€‚ æ„å»ºæ•°æ®å­˜å‚¨ CAN å¸§ CAN IDï¼š0x604ã€‚ æ•°æ®ï¼šå‘½ä»¤å­—èŠ‚ï¼ˆ0x23ï¼‰ï¼Œç´¢å¼•ï¼ˆ0x10 0x10ï¼‰ï¼Œå­ç´¢å¼•ï¼ˆ0x01ï¼‰ï¼Œæ•°æ®ï¼ˆ0x73 0x61 0x76 0x65ï¼‰ã€‚ can0 604 [8] 23 10 10 01 73 61 76 65 NMT å‘½ä»¤-è®¾ç½® NMT çŠ¶æ€æŠ¥æ–‡å¯ä»¥å‘é€ç»™ç‰¹å®šèŠ‚ç‚¹æˆ–æ‰€æœ‰èŠ‚ç‚¹ã€‚å®ƒä»¬å¯ä»¥é‡ç½®è®¾å¤‡ã€é€šä¿¡æˆ–å°†è¿œç¨‹è®¾å¤‡çš„å†…éƒ¨çŠ¶æ€è®¾ç½®ä¸ºè¿è¡Œã€é¢„è¿è¡Œï¼ˆç¦ç”¨ PDOï¼‰æˆ–åœæ­¢ï¼ˆä»…å¯ç”¨å¿ƒè·³ç”Ÿäº§è€…å’Œ NMT æ¶ˆè´¹è€…ï¼‰ã€‚ å½“å‡ºç°äº†è®¾ç½®é”™è¯¯å¯„å­˜å™¨çš„ç´§æ€¥çŠ¶å†µæ—¶ï¼Œstart ä¸èµ·ä½œç”¨ã€‚ è®¾ç½® Node ID ä¸º 4 çš„è®¾å¤‡çŠ¶æ€ä¸º resetã€‚ 000 82 04 Byte 0 å–å€¼ï¼ˆå‘½ä»¤ï¼‰ çŠ¶æ€ 01 start_remote_node 02 stop_remote_node 80 enter_pre-operational 81 reset_node 82 reset_communication SDO å‘½ä»¤-è®¾ç½®å¿ƒè·³åŒ…è¯»å–å¿ƒè·³æ—¶é—´è®¾ç½®CAN0 604 [8] 40 17 10 00 00 00 00 00 å†™å…¥å¿ƒè·³æ—¶é—´è®¾ç½® CAN IDï¼š0x600 + èŠ‚ç‚¹ IDï¼ˆ4ï¼‰ 0x604ã€‚ å‘½ä»¤å­—èŠ‚ï¼š0x2B è¡¨ç¤ºå†™å…¥ 2 å­—èŠ‚ï¼ˆu16ï¼‰ã€‚ ç´¢å¼•ï¼š0x1017ï¼ˆå­—èŠ‚é¡ºåºä¸º 17 10ï¼‰ã€‚ å­ç´¢å¼•ï¼š0x00ã€‚ æ•°æ®ï¼š1000ms0x03E8ï¼Œå­—èŠ‚é¡ºåºä¸º E8 03ã€‚10000ms0x2710 can0 604 [8] 2B 17 10 00 E8 03 00 00 PDO é…ç½®æŒ‰ä»¥ä¸‹æ­¥éª¤é€šè¿‡å†™å…¥ OD å˜é‡é…ç½® PDOï¼š å°† PDO é€šä¿¡å‚æ•° COB-ID ä¸­çš„ç¬¬ 31 ä½è®¾ç½®ä¸º 1ï¼Œç¦ç”¨ PDOã€‚ åªæœ‰ç¦ç”¨ PDO æ—¶æ‰èƒ½é…ç½® Node-Idã€‚ å°† PDO æ˜ å°„å‚æ•°ï¼Œå­ç´¢å¼• 0 è®¾ç½®ä¸º 0ï¼Œç¦ç”¨æ˜ å°„ã€‚ é…ç½®æ˜ å°„ é€šè¿‡è®¾ç½® PDO æ˜ å°„å‚æ•°ï¼Œå­ç´¢å¼• 0 è‡³æ˜ å°„å¯¹è±¡æ•°å¯ç”¨æ˜ å°„ é€šè¿‡å°† PDO é€šä¿¡å‚æ•° COB-ID ä¸­çš„ç¬¬ 31 ä½è®¾ç½®ä¸º 0 æ¥å¯ç”¨ PDO å…¶ä»–é…ç½®åŒæ­¥ä¼ è¾“ä¿¡å·é…ç½®å…¨å±€åŒæ­¥å‘¨æœŸ SYNC è®¾ç½®å€¼ä¿å­˜åœ¨å¯¹è±¡ 1006h ä¸­ã€‚ å¿ƒè·³CANopen ä¸»ç«™çš„å¯¹è±¡ 1016h çš„å€¼(æ¥æ”¶å™¨å¿ƒè·³æ—¶é—´)å˜ä¸ºè‡ªåŠ¨ä¼˜åŒ–åçš„å€¼ã€‚ å¯¹è±¡ 1017h çš„å€¼(å‘ç”Ÿå™¨å¿ƒè·³æ—¶é—´)è¢«æ­¤å¤„è®¾ç½®çš„å€¼é‡å†™ã€‚é€‚ç”¨äºæ‰€æœ‰ä»ç«™å¯¹è±¡çš„å¯¹è±¡ 1017h(å‘ç”Ÿå™¨å¿ƒè·³æ—¶é—´)çš„å€¼è¢«æ­¤å¤„è®¾ç½®çš„å€¼é‡å†™ï¼Œå¯¹è±¡ 1016h çš„å€¼(æ¥æ”¶å™¨å¿ƒè·³æ—¶é—´)å˜ä¸ºè‡ªåŠ¨ä¼˜åŒ–åçš„å€¼ã€‚ CAN Open æ€»çº¿å»ºè®¾å‡å®šåœ¨ä¸€ä¸ª can open ç½‘ç»œä¸­ï¼Œnode1 ä¸ºä¸»èŠ‚ç‚¹ï¼Œnode2 å’Œ node3 ä¸ºä»èŠ‚ç‚¹ï¼Œéœ€è¦é…ç½® node2ï¼Œè®© node2 æ¥æ”¶ node3 çš„ TPDO æ¶ˆæ¯ã€‚ è®¾å¤‡é…ç½® è®¾å¤‡å èŠ‚ç‚¹åœ°å€ ç±»å‹ Node 1 0x01 ä¸»èŠ‚ç‚¹ï¼ˆNMT Masterï¼‰ Node 2 0x02 ä»èŠ‚ç‚¹ï¼ˆNMT Slaveï¼‰ Node 3 0x03 ä»èŠ‚ç‚¹ï¼ˆNMT Slaveï¼‰ å…¶ä¸­ Node3 ä½œä¸º TPDO æ¶ˆæ¯å‘å‡ºï¼ˆç”Ÿäº§è€…ï¼‰ï¼ŒæœŸæœ› Node2 æ¥æ”¶ Node3 æ¶ˆæ¯ã€‚ PDO å‚æ•°é…ç½®é…ç½®æ‰€éœ€ä¿¡æ¯é…ç½® Node 3 çš„ TPDOï¼š ç¡®å®š Node 3 çš„ TPDO æ¶ˆæ¯çš„ COB-ID å’Œæ˜ å°„å¯¹è±¡ã€‚ åœ¨ Node 3 çš„å¯¹è±¡å­—å…¸ä¸­è®¾ç½® TPDO é€šä¿¡å‚æ•°å’Œæ˜ å°„å‚æ•°ã€‚ é…ç½® Node 2 çš„ RPDOï¼š è®¾ç½® Node 2 çš„ RPDO é€šä¿¡å‚æ•°ï¼Œä½¿å…¶æ¥æ”¶ Node 3 çš„ TPDO æ¶ˆæ¯ã€‚ é…ç½® Node 2 çš„ RPDO æ˜ å°„å‚æ•°ï¼Œä»¥å¤„ç†ä» Node 3 æ¥æ”¶åˆ°çš„æ•°æ®ã€‚ é€šè®¯å‚æ•°å’Œæ˜ å°„å‚æ•°ï¼ˆODï¼‰Node 3 çš„é…ç½®ï¼š TPDO é€šä¿¡å‚æ•°ï¼ˆ0x1802ï¼‰ï¼š å­ç´¢å¼• 0x01: COB-ID 0x183 å­ç´¢å¼• 0x02: ä¼ è¾“ç±»å‹ï¼ˆä¾‹å¦‚ 0xFFï¼Œäº‹ä»¶è§¦å‘ï¼‰ TPDO æ˜ å°„å‚æ•°ï¼ˆ0x1A02ï¼‰ï¼š å­ç´¢å¼• 0x00: æ˜ å°„å¯¹è±¡æ•°é‡ 2 å­ç´¢å¼• 0x01: 0x60000208ï¼ˆå¯¹è±¡ 0x6000ï¼Œå­ç´¢å¼• 0x02ï¼Œ8 ä½ï¼‰ å­ç´¢å¼• 0x02: 0x64010110ï¼ˆå¯¹è±¡ 0x6401ï¼Œå­ç´¢å¼• 0x01ï¼Œ16 ä½ï¼‰ Node 2 çš„é…ç½®ï¼š RPDO é€šä¿¡å‚æ•°ï¼ˆ0x1400ï¼‰ï¼š å­ç´¢å¼• 0x01: COB-ID 0x183ï¼ˆä¸ Node 3 çš„ TPDO COB-ID ä¸€è‡´ï¼‰ å­ç´¢å¼• 0x02: ä¼ è¾“ç±»å‹ï¼ˆä¾‹å¦‚ 0xFFï¼Œäº‹ä»¶è§¦å‘ï¼‰ RPDO æ˜ å°„å‚æ•°ï¼ˆ0x1600ï¼‰ï¼š å­ç´¢å¼• 0x00: æ˜ å°„å¯¹è±¡æ•°é‡ 2 å­ç´¢å¼• 0x01: 0x60000208ï¼ˆä¸ Node 3 çš„ TPDO æ˜ å°„ä¸€è‡´ï¼‰ å­ç´¢å¼• 0x02: 0x64010110ï¼ˆä¸ Node 3 çš„ TPDO æ˜ å°„ä¸€è‡´ï¼‰ é…ç½®è¿‡ç¨‹è®¾ç½® Node 3 çš„ TPDO é€šä¿¡å‚æ•°ï¼š CAN ID: 0x601 (SDO è¯·æ±‚)Data: [2B 00 18 02 83 01 00 00] # è®¾ç½® COB-ID ä¸º 0x183ï¼ˆå¯ç”¨ï¼‰CAN ID: 0x601 (SDO è¯·æ±‚)Data: [2B 00 18 02 FF 00 00 00] # è®¾ç½®ä¼ è¾“ç±»å‹ä¸º 0xFFï¼ˆäº‹ä»¶è§¦å‘ï¼‰ è®¾ç½® Node 3 çš„ TPDO æ˜ å°„å‚æ•°ï¼š CAN ID: 0x601 (SDO è¯·æ±‚)Data: [2F 00 1A 02 00 00 00 00] # ç¦ç”¨ TPDO æ˜ å°„CAN ID: 0x601 (SDO è¯·æ±‚)Data: [23 00 1A 02 01 08 02 60] # æ˜ å°„å¯¹è±¡ 0x6000ï¼Œå­ç´¢å¼• 0x02ï¼Œ8 ä½CAN ID: 0x601 (SDO è¯·æ±‚)Data: [23 00 1A 02 02 10 01 64] # æ˜ å°„å¯¹è±¡ 0x6401ï¼Œå­ç´¢å¼• 0x01ï¼Œ16 ä½CAN ID: 0x601 (SDO è¯·æ±‚)Data: [2F 00 1A 02 02 00 00 00] # å¯ç”¨ TPDO æ˜ å°„ è®¾ç½® Node 2 çš„ RPDO é€šä¿¡å‚æ•°ï¼š CAN ID: 0x602 (SDO è¯·æ±‚)Data: [2B 00 14 00 83 01 00 00] # è®¾ç½® COB-ID ä¸º 0x183CAN ID: 0x602 (SDO è¯·æ±‚)Data: [2B 00 14 02 FF 00 00 00] # è®¾ç½®ä¼ è¾“ç±»å‹ä¸º 0xFFï¼ˆäº‹ä»¶è§¦å‘ï¼‰ è®¾ç½® Node 2 çš„ RPDO æ˜ å°„å‚æ•°ï¼š CAN ID: 0x602 (SDO è¯·æ±‚)Data: [2F 00 16 00 00 00 00 00] # ç¦ç”¨ RPDO æ˜ å°„CAN ID: 0x602 (SDO è¯·æ±‚)Data: [23 00 16 01 08 02 60] # æ˜ å°„å¯¹è±¡ 0x6000ï¼Œå­ç´¢å¼• 0x02ï¼Œ8 ä½CAN ID: 0x602 (SDO è¯·æ±‚)Data: [23 00 16 02 10 01 64] # æ˜ å°„å¯¹è±¡ 0x6401ï¼Œå­ç´¢å¼• 0x01ï¼Œ16 ä½CAN ID: 0x602 (SDO è¯·æ±‚)Data: [2F 00 16 00 02 00 00 00] # å¯ç”¨ RPDO æ˜ å°„ é€šè¿‡ä¸Šè¿°æ­¥éª¤é…ç½® Node 2 çš„ RPDO é€šä¿¡å‚æ•°å’Œæ˜ å°„å‚æ•°ï¼Œä½¿å…¶èƒ½å¤Ÿæ¥æ”¶å’Œå¤„ç†æ¥è‡ª Node 3 çš„ TPDO æ¶ˆæ¯ã€‚è¿™ç§é…ç½®ç¡®ä¿äº† Node 2 èƒ½å¤Ÿæ­£ç¡®æ¥æ”¶å’Œè§£æ Node 3 å‘é€çš„ TPDO æ•°æ®ï¼Œå®Œæˆæ•°æ®çš„æœ‰æ•ˆä¼ è¾“å’Œå¤„ç†ã€‚ è°ƒè¯•å‘½ä»¤æ§åˆ¶ NMT çŠ¶æ€ CAN0 000 [2] 01 04CAN0 000 [2] 02 04 æ§åˆ¶èŠ‚ç‚¹ 4 CAN0 000 [2] 01 00CAN0 000 [2] 02 00 æ§åˆ¶æ‰€æœ‰èŠ‚ç‚¹ å‘é€ SYNC ä¿¡å· CAN0 080 [0] å‘é€ ERROR ä¿¡å· CAN0 084 [8] æ•°æ®åŒºæ ¹æ®å®é™…é”™è¯¯å®šä¹‰ æ¢å¤å‚æ•°ï¼Œåœ¨ 1011 çš„ 01 å†™å…¥ load CAN0 604 [8] 2F 11 10 01 6C 6F 61 64 è¯»å– 1005 ä¿¡æ¯ï¼ˆSYNC çš„ COB-IDï¼‰ CAN0 604 [8] 40 05 10 00 00 00 00 00 é…ç½® 1005 ä¿¡æ¯ï¼Œè®¾ SYNC çš„ COB-ID ä¸º 0x80ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚ CAN0 604 [8] 23 05 10 00 80 00 00 00 è¯»å– 1006 ä¿¡æ¯(SYNC é€šä¿¡å‘¨æœŸ) CAN0 604 [8] 40 06 10 00 00 00 00 00 å†™å…¥ 1006 ä¿¡æ¯ï¼Œå°† SYNC çš„é€šä¿¡å‘¨æœŸè®¾ç½®ä¸º 100msï¼Œé‚£ä¹ˆéœ€è¦å†™å…¥åˆ° 0x1006 çš„å€¼ä¸º 100000ï¼ˆ100ms 100000usï¼‰ã€‚ CAN0 604 [8] 23 06 10 00 A0 86 01 00 è¯»å–å¿ƒè·³æ—¶é—´è®¾ç½® CAN0 604 [8] 40 17 10 00 00 00 00 00 é€šè¿‡é…ç½® 0x1017 çš„ heartbeat æ—¶é—´ï¼Œè‡ªåŠ¨ä¸ŠæŠ¥è®¾å¤‡çŠ¶æ€ã€‚ CAN0 604 [8] 2B 17 10 00 E8 03 00 00 è®¾ç½®ä¸€ä¸ª TPDOé…ç½® 1800 çš„ä¸ŠæŠ¥æ–¹å¼ä¸ºå¼‚æ­¥ï¼Œè¯»å–çš„è¯æ”¹ 2F ä¸º 40 CAN0 604 [8] 2F 00 18 02 FF 00 00 00 é…ç½® 1800 çš„ä¸ŠæŠ¥äº‹ä»¶ä¸º 100msï¼ˆå­ç´¢å¼• 05ï¼‰ï¼ˆæ•°æ®ç±»å‹ uint16ï¼‰ CAN0 604 [8] 2B 00 18 05 64 00 00 00ï¼ˆå•ä½ä¸º msï¼‰ è®¾ç½®å­ç´¢å¼•ç¦ç”¨ CAN0 604 [8] 2F 00 1A 00 00 00 00 00 0x40300010ï¼Œè®¾ç½®æ˜ å°„ç´¢å¼• 0x4030ï¼Œå­ç´¢å¼• 00ï¼Œå¤§å° 0x10ï¼ˆ16 ä½ï¼‰ CAN0 604 [8] 23 00 1A 01 10 00 30 40 0x20100020ï¼Œè®¾ç½®æ˜ å°„ç´¢å¼• 0x2010ï¼Œå­ç´¢å¼• 00ï¼Œå¤§å° 0x20ï¼ˆ32 ä½ï¼‰ CAN0 604 [8] 23 00 1A 02 20 00 10 20 è®¾ç½®æ˜ å°„æ•°é‡ï¼Œç”¨å¤šå°‘è®¾å¤šå°‘ï¼Œè¿™é‡Œç”¨äº† 2 ä¸ª CAN0 604 [8] 2F 00 1A 00 02 00 00 00 è®¾ç½® RPDOé…ç½® 1400 æ¥æ”¶æ¥è‡ª 181 çš„æ•°æ® CAN0 601 [8] 23 00 14 01 81 01 00 00 é…ç½® 1400 çš„ä¸ŠæŠ¥æ–¹å¼ä¸ºå¼‚æ­¥ï¼Œè¯»å–çš„è¯æ”¹ 2F ä¸º 40 CAN0 601 [8] 2F 00 14 02 FF 00 00 00 é…ç½® 1400 çš„ä¸ŠæŠ¥äº‹ä»¶ä¸º 100msï¼ˆå­ç´¢å¼• 05ï¼‰ï¼ˆæ•°æ®ç±»å‹ uint16ï¼‰ CAN0 601 [8] 2B 00 14 05 64 00 00 00ï¼ˆå•ä½ä¸º msï¼‰ è®¾ç½®å­ç´¢å¼•ç¦ç”¨ CAN0 601 [8] 2F 00 1A 00 00 00 00 00 0x40300010ï¼Œè®¾ç½®æ˜ å°„ç´¢å¼• 0x4030ï¼Œå­ç´¢å¼• 00ï¼Œå¤§å° 0x10ï¼ˆ16 ä½ï¼‰ CAN0 601 [8] 23 00 1A 01 10 00 30 40 0x20100020ï¼Œè®¾ç½®æ˜ å°„ç´¢å¼• 0x2010ï¼Œå­ç´¢å¼• 00ï¼Œå¤§å° 0x20ï¼ˆ32 ä½ï¼‰ CAN0 601 [8] 23 00 1A 02 20 00 10 20 è®¾ç½®æ˜ å°„æ•°é‡ï¼Œç”¨å¤šå°‘è®¾å¤šå°‘ï¼Œè¿™é‡Œç”¨äº† 2 ä¸ª CAN0 601 [8] 2F 00 1A 00 02 00 00 00","categories":["4.é€šè®¯åè®®","CAN"]},{"title":"CANOpenNode ä»£ç åˆ†æ","path":"/2024/01/02/4-é€šè®¯åè®®-CAN-CANOpenNode-ä»£ç åˆ†æ/","content":"ä¸»æ–‡ä»¶ CO_main_basic.cè¿›å…¥ Main å‡½æ•°ä¸­è¿è¡Œï¼Œæœ€å¼€å§‹éƒ½æ˜¯ä¸€äº›å…³äºå­˜å‚¨å¤šçº¿ç¨‹åŠŸèƒ½å¯ç”¨éƒ¨åˆ†çš„é…ç½®ä»£ç ï¼Œåé¢ä»¬ä¼šæ ¹æ®å®å®šä¹‰æ¥è®²è§£ã€‚å®é™…çš„ç¬¬ä¸€è¡Œåˆå§‹åŒ–ä»£ç ä»ä»¥ä¸‹å¼€å§‹ã€‚ uint32_t heapMemoryUsed = 0;CO_config_t *config_ptr = NULL;CO = CO_new(config_ptr, heapMemoryUsed); è¯¥å‡½æ•°çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ª CAN open å¯¹è±¡ï¼Œåœ¨å•ä¸ª OD çš„æƒ…å†µä¸‹ï¼Œconfig åº”ä¸º NULLï¼Œå‚æ•°ä»é»˜è®¤çš„ â€œOD.h â€œæ–‡ä»¶ä¸­è·å–ã€‚å¦‚æœå®šä¹‰äº† CO_USE_GLOBALSï¼Œé‚£ä¹ˆå‡½æ•°å°†ä¸ºæ‰€æœ‰ CANopenNode å¯¹è±¡ä½¿ç”¨å…¨å±€é™æ€å˜é‡ã€‚å¦åˆ™ï¼Œå®ƒå°†ä»å †ä¸­åˆ†é…æ‰€æœ‰å¯¹è±¡ã€‚ CO_epoll_t epMain;err = CO_epoll_create(epMain, MAIN_THREAD_INTERVAL_US); è¯¥å‡½æ•°åˆ›å»º Linux epoll ç›‘æ§ timerfd å’Œ eventfdã€‚åˆ›å»ºå¹¶é…ç½®å¤šä¸ª Linux é€šçŸ¥ï¼Œä»¥è§¦å‘ä»»åŠ¡çš„æ‰§è¡Œã€‚CO_epoll_create ä¸­å®ç°äº† epoll æ‹¦æˆªå¹¶ç›‘æ§å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå…¶ä¸­ timerfd ä»¥æ’å®šçš„å®šæ—¶å™¨é—´éš”è§¦å‘ï¼Œeventfd åˆ™æ ¹æ®å¤–éƒ¨ä¿¡å·è§¦å‘ã€‚ CO_CANptrSocketCan_t CANptr = 0;CANptr.can_ifindex = if_nametoindex(can0);CANptr.epoll_fd = epMain.epoll_fd; è®¾ç½®ç”¨äº CO_CANinit çš„æŒ‡é’ˆå‚æ•°ï¼Œä¸»è¦ä¼ å…¥ CAN è®¾å¤‡åå’Œç›‘æ§çš„ epoll æè¿°ç¬¦ã€‚ ä¹‹åè¿›å…¥ CAN open é€šè®¯åˆå§‹åŒ–é˜¶æ®µï¼Œæ³¨æ„è¯¥é˜¶æ®µæ˜¯å¯ä»¥é€šè¿‡ 0x82 å‘½ä»¤ï¼Œå³ CANopen communication reset é‡ç½®çš„ã€‚ CO_CANsetConfigurationMode((void *)CANptr);CO_CANmodule_disable(CO-CANmodule); è¿›å…¥ CAN é…ç½®ï¼Œä¸»è¦è¿˜æ˜¯åœ¨é€šè¿‡ 0x82 å‘½ä»¤é‡å¯åï¼Œç¦ç”¨ CANmodule æ¨¡å—ã€‚ err = CO_CANinit(CO, (void *)CANptr, 0 /* bit rate not used */); åˆå§‹åŒ– CAN é©±åŠ¨ï¼Œå¦‚æœæ˜¯é€šè¿‡ 0x82 å‘½ä»¤é‡å¯çš„é€šè®¯ï¼Œä¹Ÿå¿…é¡»é‡æ–°åˆå§‹åŒ–ã€‚å…¶ä¸­çš„æ³¢ç‰¹ç‡å‚æ•°åœ¨ Linux éƒ¨åˆ†ä¸­è¿˜ä¸è¢«æ”¯æŒã€‚ä¹‹åæ˜¯ LSS éƒ¨åˆ†çš„åˆå§‹åŒ–ï¼Œè¯¥éƒ¨åˆ†å†…å®¹å±äº CiA 305ï¼Œå…ˆç•¥è¿‡ï¼Œä¹‹åæœ‰æ—¶é—´åœ¨åˆ†æå®ç°ã€‚ #define NMT_CONTROL \\ CO_NMT_STARTUP_TO_OPERATIONAL \\ | CO_NMT_ERR_ON_ERR_REG \\ | CO_ERR_REG_GENERIC_ERR \\ | CO_ERR_REG_COMMUNICATION err = CO_CANopenInit(CO, /* CANopen object */ NULL, /* alternate NMT */ NULL, /* alternate em */ OD, /* Object dictionary */ NULL, /* Optional OD_statusBits */ NMT_CONTROL, /* CO_NMT_control_t */ 500, /* firstHBTime_ms */ 1000, /* SDOserverTimeoutTime_ms */ 500, /* SDOclientTimeoutTime_ms */ false, /* SDOclientBlockTransfer */ CO_activeNodeId, //Node ID errInfo); åˆå§‹åŒ–é™¤ PDO å¯¹è±¡å¤–çš„ CAN open é€šè®¯åè®®ï¼ˆåŒæ ·ä¹Ÿå¿…é¡»åœ¨ 0x82 å‘½ä»¤åè°ƒç”¨ï¼‰ã€‚ CO CANopen å¯¹è±¡ã€‚ em ç´§æ€¥å¯¹è±¡ï¼Œç”¨äºä¸åŒçš„ CANopen å¯¹è±¡å†…éƒ¨ï¼Œé€šå¸¸ç”¨äºé”™è¯¯æŠ¥å‘Šã€‚å¦‚æœä¸ºç©ºï¼Œåˆ™ä½¿ç”¨ co-emã€‚å¦‚æœä¸ºç©ºï¼Œä¸” co-CNT_EM ä¸º 0ï¼Œåˆ™å‡½æ•°é”™è¯¯è¿”å›ã€‚ NMT å¦‚æœ co-CNT_NMT ä¸º 0ï¼Œåˆ™å¿…é¡»æŒ‡å®šè¯¥å¯¹è±¡ï¼›å¦‚æœ co-CNT_NMT ä¸º 1ï¼Œåˆ™è¯¥å¯¹è±¡å°†è¢«å¿½ç•¥ï¼Œå¯ä»¥ä¸º NULLã€‚NMT å¯¹è±¡ç”¨äº NMT å¯¹è±¡ç”¨äºåœ¨ CO_process()å†…éƒ¨æ£€ç´¢ NMT å†…éƒ¨çŠ¶æ€ã€‚ od CANopen å¯¹è±¡å­—å…¸ã€‚ä¹‹å‰æœ‰æåˆ°çš„ ODxyz.h ä¸­å®šä¹‰ã€‚ OD_statusBits ä¼ é€’ç»™ CO_EM_init() çš„å‚æ•°ã€‚å¯ä»¥ä¸ºç©ºã€‚ NMTcontrol ä¼ é€’ç»™ CO_NMT_init() çš„å‚æ•°ã€‚ firstHBTime_ms ä¼ é€’ç»™ CO_NMT_init() çš„å‚æ•°ã€‚ SDOserverTimeoutTime_ms ä¼ é€’ç»™ CO_SDOserver_init() çš„å‚æ•°ã€‚ SDOclientTimeoutTime_ms SDO å®¢æˆ·ç«¯çš„é»˜è®¤è¶…æ—¶æ—¶é—´æ¯«ç§’ï¼Œä¸€èˆ¬ä¸º 500ã€‚ SDOclientBlockTransfer å¦‚æœä¸º â€œtrueâ€ï¼Œåˆ™é»˜è®¤åœ¨ SDO å®¢æˆ·ç«¯è®¾ç½®å—ä¼ è¾“ã€‚ nodeId CANopen èŠ‚ç‚¹ IDï¼ˆ1 â€¦ 127ï¼‰æˆ– 0xFFï¼ˆæœªé…ç½®ï¼‰ã€‚åœ¨ CANopen åˆå§‹åŒ–ä¸­ï¼Œå®ƒä¸ CO_LSSinit() ä¸­çš„ pendingBitRate ç›¸åŒã€‚å¦‚æœä¸ºæœªé…ç½®ï¼Œåˆ™æŸäº› CANopen å¯¹è±¡å°†ä¸ä¼šè¢«åˆå§‹åŒ–æˆ–å¤„ç†ã€‚ errInfo ä¹Ÿå¯ä»¥åœ¨å‡½æ•°è¿”å› CO_ERROR_NO çš„éå…³é”®é”™è¯¯ä¸­è®¾ç½®ã€‚ æˆåŠŸæ—¶è¿”å› CO_ERROR_NOã€‚ CO_epoll_initCANopenMain(epMain, CO); è¯¥å‡½æ•°ç”¨äºé…ç½® CAN æ¥æ”¶åçš„è‡ªå®šä¹‰å›è°ƒã€‚è‡ªå®šä¹‰å›è°ƒå‡½æ•°å¯ç”±åº”ç”¨ç¨‹åºé€‰æ‹©æ€§æ³¨å†Œï¼Œå¹¶åœ¨æ“ä½œç³»ç»Ÿä¸­é…ç½®çº¿ç¨‹ã€‚å›è°ƒå‡½æ•°ä¼šåœ¨é«˜ä¼˜å…ˆçº§çº¿ç¨‹é¢„å¤„ç†å®ŒæŸäº›å†…å®¹åè°ƒç”¨ï¼Œå¹¶ä¸”å¿…é¡»ç”±ä½ä¼˜å…ˆçº§çº¿ç¨‹è¿›ä¸€æ­¥å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå½“æ¥æ”¶åˆ° CAN æŠ¥æ–‡å¹¶è¿›è¡Œé¢„å¤„ç†åï¼Œå›è°ƒåº”å”¤é†’ä¸»çº¿ç¨‹å¤„ç†å‡½æ•°ã€‚ CO_EM_initCallbackRx(CO-em, EmergencyRxCallback);CO_NMT_initCallbackChanged(CO-NMT, NmtChangedCallback);CO_HBconsumer_initCallbackNmtChanged(CO-HBcons, 0, NULL, HeartbeatNmtChangedCallback); CO_EM_initCallbackRxï¼Œåˆå§‹åŒ– Emergency æ¥æ”¶å›è°ƒå‡½æ•°ã€‚è¯¥å‡½æ•°åœ¨æ”¶åˆ°é”™è¯¯æ¡ä»¶åæ‰§è¡Œã€‚ CO_NMT_initCallbackChangedï¼Œåˆå§‹åŒ– NMT çŠ¶æ€å˜åŒ–å›è°ƒå‡½æ•°ã€‚è¯¥å‡½æ•°åœ¨ NMT çŠ¶æ€å‘ç”Ÿå˜åŒ–åè¢«è°ƒç”¨ã€‚è¯¥å‡½æ•°å¯èƒ½ä¼šå”¤é†’å¤„ç† NMT äº‹ä»¶çš„å¤–éƒ¨ä»»åŠ¡ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨ä¼šç«‹å³å‘æ¶ˆè´¹è€…æä¾› å½“å‰çš„ NMT çŠ¶æ€ã€‚ CO_HBconsumer_initCallbackNmtChangedï¼Œåˆå§‹åŒ–å¿ƒè·³æ¶ˆè´¹è€… NMT æ›´æ”¹å›è°ƒå‡½æ•°ï¼Œå½“ NMT çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚ CO_TIME_set(CO-TIME, time_ms, time_days, TIME_STAMP_INTERVAL_MS); è®¾ç½®å½“å‰æ—¶é—´ï¼Œå¹¶è®¾ç½®ç”Ÿäº§è€…çš„é—´éš”æ—¶é—´ä¸º TIME_STAMP_INTERVAL_MSï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œæ­¤å¤„è®¾ç½®ä¸º 10000msã€‚ err = CO_CANopenInitPDO(CO, /* CANopen object */ CO-em, /* emergency object */ OD, /* Object dictionary */ CO_activeNodeId, errInfo); å¿…é¡»åœ¨é€šä¿¡é‡ç½® 0x82 éƒ¨åˆ†çš„æœ«å°¾è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¦åˆ™æŸäº› OD å˜é‡å°†æ— æ³•æ­£ç¡®æ˜ å°„åˆ° PDO ä¸­ã€‚å‡½æ•°å‚æ•°å°±æ˜¯ CAN Open å¯¹è±¡ï¼ŒEM å¯¹è±¡ï¼ŒOD å¯¹è±¡ï¼ŒNodeID ä»¥åŠé”™è¯¯ä¿¡æ¯è¿™äº›ã€‚ CO_CANsetNormalMode(CO-CANmodule); å·²å®Œæˆæ‰€æœ‰å¯¹è±¡åˆå§‹åŒ–ï¼Œè®¾ç½®çŠ¶æ€ï¼Œå‡†å¤‡è¿›å…¥ä¸»å¾ªç¯å‡½æ•°ã€‚åœ¨ä¸»å¾ªç¯å‡½æ•°ä¸­ï¼Œé€šè¿‡ epoll ç›‘æ§å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚ CO_epoll_wait(epMain);CO_epoll_processRT(epMain, CO, false);CO_epoll_processMain(epMain, CO, GATEWAY_ENABLE, reset);CO_epoll_processLast(epMain); CO_epoll_wait å‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ° epoll ä¸Šæ³¨å†Œäº†ä»¥ä¸‹äº‹ä»¶ï¼štimerfdã€eventfd æˆ–åº”ç”¨ç¨‹åºæŒ‡å®šçš„äº‹ä»¶ã€‚å‡½æ•°è¿˜ä¼šè®¡ç®—è‡ªä¸Šæ¬¡è°ƒç”¨ä»¥æ¥çš„ timeDifference_us å¹¶å‡†å¤‡ timerNext_usã€‚ CO_epoll_processLastï¼Œepoll äº‹ä»¶çš„å…³é—­å‡½æ•°ï¼Œæ­¤å‡½æ•°å¿…é¡»åœ¨ CO_epoll_wait() ä¹‹åè°ƒç”¨ã€‚åœ¨å®ƒä»¬ä¹‹é—´æ˜¯åº”ç”¨ç¨‹åºæŒ‡å®šçš„å¤„ç†å‡½æ•°ï¼Œå¯ä»¥æ£€æŸ¥è‡ªå·±çš„äº‹ä»¶å¹¶è¿›è¡Œå¤„ç†ã€‚åº”ç”¨ç¨‹åºè¿˜å¯ä»¥é™ä½ timerNext_us å˜é‡çš„å€¼ã€‚å¦‚æœå°† timerNext_us å˜é‡è°ƒä½ï¼Œåˆ™å°†é‡æ–°é…ç½®é—´éš”å®šæ—¶å™¨ï¼Œå¹¶æå‰è§¦å‘ CO_epoll_wait()ã€‚ CO_epoll_processRT å’Œ CO_epoll_processMain æŒ‡å®šäº†å¤„ç†å‡½æ•°ï¼Œæ¥ä¸‹æ¥å…ˆè¯´æ˜ CO_epoll_processRT å¤„ç†å‡½æ•°ã€‚ //CO_CANrxFromEpoll å¦‚æœ epoll äº‹ä»¶ä¸ä»»ä½• CAN æ¥å£åŒ¹é…ï¼Œåˆ™è¿”å› Trueã€‚CO_CANrxFromEpoll(co-CANmodule, ep-ev, NULL, NULL);syncWas = CO_process_SYNC(co, ep-timeDifference_us,pTimerNext_us);CO_process_RPDO(co, syncWas, ep-timeDifference_us,pTimerNext_us);CO_process_TPDO(co, syncWas, ep-timeDifference_us,pTimerNext_us); åœ¨ CO_epoll_processRT ä¸­å¤„ç†ä»¥ä¸Šçš„ SYNCTPDORPDO åè®®ã€‚ CO_CANmodule_process(co-CANmodule);CO_EM_process(co-em, NMTisPreOrOperational, timeDifference_us, timerNext_us);CO_NMT_process(co-NMT,NMTstate,timeDifference_us,timerNext_us);CO_SDOserver_process(co-SDOserver[i], NMTisPreOrOperational, timeDifference_us,timerNext_us);CO_HBconsumer_process(co-HBcons, NMTisPreOrOperational, timeDifference_us, timerNext_us);CO_TIME_process(co-TIME, NMTisPreOrOperational, timeDifference_us); åœ¨ CO_epoll_processMain ä¸­å¤„ç†äº†ä»¥ä¸Šçš„ EMNMTSDOServerHBTIME åè®®ã€‚ CO_SINGLE_THREADè¯¥å‚æ•°åœ¨ Makefile ä¸­é€šè¿‡-D å‚æ•°æŒ‡å®šï¼Œä½œç”¨æ˜¯é…ç½®ç¨‹åºåœ¨å•çº¿ç¨‹ä¸­è¿è¡Œã€‚å•çº¿ç¨‹è¿è¡Œæ—¶ä¸åŒçš„äº‹ä»¶ï¼ˆä¾‹å¦‚ CAN æ¥æ”¶æˆ–è®¡æ—¶å™¨åˆ°æœŸï¼‰ä¼šè§¦å‘å¾ªç¯é€šè¿‡å †æ ˆï¼ˆæ‰€æœ‰ä»£ç éƒ½æ˜¯éé˜»å¡çš„ï¼‰ã€‚å®ƒéœ€è¦è¾ƒå°‘çš„ç³»ç»Ÿèµ„æºã€‚ åœ¨å¤šçº¿ç¨‹æ“ä½œä¸­ï¼Œé™¤äº†ä¸»çº¿çº¿ç¨‹å¤–ï¼Œè¿˜å»ºç«‹äº†ä¸€ä¸ªå®æ—¶çº¿ç¨‹ã€‚RT çº¿ç¨‹æ¯æ¯«ç§’è¿è¡Œä¸€æ¬¡ï¼Œå¹¶ä½¿ç”¨å¤–å›´è®¾å¤‡è¯»å†™ã€æ§åˆ¶ç¨‹åºæˆ–ç±»ä¼¼ç¨‹åºå¤„ç† PDO å’Œå¯é€‰åº”ç”¨ç¨‹åºä»£ç ã€‚ä½¿ç”¨æ­¤é…ç½®å¿…é¡»è€ƒè™‘ç«äº‰æ¡ä»¶ï¼Œä¾‹å¦‚ï¼Œä»ä¸»çº¿çº¿ç¨‹è¿è¡Œçš„åº”ç”¨ç¨‹åºä»£ç åœ¨è®¿é—® OD å˜é‡æ—¶å¿…é¡»ä½¿ç”¨ CO_(UN)LOCK_OD å®ã€‚ CO_CONFIG_STORAGEè¯¥å‚æ•°ç”± CO_CONFIG_STORAGE_ENABLE åœ¨ CO_config.h ä¸­ä½¿èƒ½ï¼Œä¸»è¦ä½œç”¨æ˜¯ä¾æ® CiA 301 æ ‡å‡†å¯¹æ§åˆ¶æ•°æ®è¿›è¡Œå­˜å‚¨å’Œæ¢å¤ã€‚æ•°æ®æºé€šå¸¸æ˜¯å¯¹è±¡å­—å…¸ä¸­çš„ä¸€ç»„å˜é‡ï¼Œä½†å¹¶ä¸å±€é™äº ODã€‚åœ¨ç”Ÿæˆå¯¹è±¡å­—å…¸ï¼ˆOD.h å’Œ OD.c æ–‡ä»¶ï¼‰æ—¶ï¼Œä¼šæ ¹æ® â€œå­˜å‚¨ç»„ â€œå‚æ•°å°† OD å˜é‡åˆ†ç»„ä¸ºç»“æ„ã€‚ OD å¯¹è±¡ 0x1010 - å­˜å‚¨å‚æ•°OD å¯¹è±¡ 0x1010 - å­˜å‚¨å‚æ•°ï¼š å­ç´¢å¼• 0ï¼šæ”¯æŒçš„æœ€é«˜å­ç´¢å¼• å­ç´¢å¼• 1ï¼šä¿å­˜æ‰€æœ‰å‚æ•°ï¼ŒUNSIGNED32 å­ç´¢å¼• 2ï¼šä¿å­˜é€šä¿¡å‚æ•°ï¼ŒUNSIGNED32 å­ç´¢å¼• 3ï¼šä¿å­˜åº”ç”¨å‚æ•°ï¼ŒUNSIGNED32 å­ç´¢å¼• 4 - 127ï¼šç‰¹å®šäºåˆ¶é€ å•†ï¼ŒUNSIGNED32 å­ç´¢å¼• 1 åŠä»¥ä¸Šï¼š è¯»å–æä¾›æœ‰å…³å…¶å­˜å‚¨åŠŸèƒ½çš„ä¿¡æ¯ï¼š ä½ 0ï¼šå¦‚æœè®¾ç½®ï¼ŒCANopen è®¾å¤‡æ ¹æ®å‘½ä»¤ä¿å­˜å‚æ•° ä½ 1ï¼šå¦‚æœè®¾ç½®ï¼ŒCANopen è®¾å¤‡è‡ªä¸»ä¿å­˜å‚æ•° å†™å…¥å€¼ 0x65766173ï¼ˆâ€™sâ€™ã€â€™aâ€™ã€â€™vâ€™ã€â€™eâ€™ï¼Œä» LSB åˆ° MSBï¼‰å¯å­˜å‚¨ç›¸åº”æ•°æ®ã€‚ç›¸åº”æ•°æ®ã€‚ OD å¯¹è±¡ 0x1011 - æ¢å¤é»˜è®¤å‚æ•° å­ç´¢å¼• 0ï¼šæ”¯æŒçš„æœ€é«˜å­ç´¢å¼• å­ç´¢å¼• 1ï¼šæ¢å¤æ‰€æœ‰é»˜è®¤å‚æ•°ï¼ŒUNSIGNED32 å­ç´¢å¼• 2ï¼šæ¢å¤é€šä¿¡é»˜è®¤å‚æ•°ï¼ŒUNSIGNED32 å­ç´¢å¼• 3ï¼šæ¢å¤åº”ç”¨ç¨‹åºé»˜è®¤å‚æ•°ï¼ŒUNSIGNED32 å­ç´¢å¼• 4 - 127ï¼šç‰¹å®šäºåˆ¶é€ å•†ï¼ŒUNSIGNED32 å­ç´¢å¼• 1 åŠä»¥ä¸Šï¼š è¯»å–æä¾›æœ‰å…³å…¶æ¢å¤èƒ½åŠ›çš„ä¿¡æ¯ï¼š ä½ 0ï¼šå¦‚æœè®¾ç½®ï¼ŒCANopen è®¾å¤‡æ¢å¤å‚æ•° å†™å…¥å€¼ 0x64616F6Cï¼ˆâ€™lâ€™ã€â€™oâ€™ã€â€™aâ€™ã€â€™dâ€™ä» LSB åˆ° MSBï¼‰å¯æ¢å¤ç›¸åº”æ•°æ®ã€‚ç›¸åº”æ•°æ®ã€‚ CO_CONFIG_GTWç½‘å…³å¯¹è±¡ç”±æ ‡å‡† CiA 309 - CANopen ä»å…¶ä»–ç½‘ç»œè®¿é—®æ¶µç›–ã€‚å®ƒå¯ä»¥å°† NMT ä¸»ç«™ã€SDO å®¢æˆ·ç«¯å’Œ LSS ä¸»ç«™ç”¨ä½œç½‘å…³è®¾å¤‡ã€‚ æœ¬æ¬¡ä½¿ç”¨ä¸­ä¸æ”¯æŒè¯¥å½¢å¼ï¼Œç›´æ¥åœ¨ CO_config.h ä¸­æ³¨é‡Šæ‰è¯¥æ¨¡å—å³å¯ã€‚ æ•°æ®å­—å…¸ OD æ“çºµCANopen æ•°æ®å­—å…¸ OD åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ª XML æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å« CANopen è®¾å¤‡çš„æ‰€æœ‰ä¿¡æ¯ã€‚æ–‡ä»¶çš„å¤§éƒ¨åˆ†æ˜¯æ‰€æœ‰å¯¹è±¡å­—å…¸å˜é‡çš„åˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰å¿…è¦çš„å±æ€§å’Œæ–‡æ¡£ã€‚è¯¥æ–‡ä»¶å¯ä½¿ç”¨ OD ç¼–è¾‘å™¨åº”ç”¨ç¨‹åºè¿›è¡Œç¼–è¾‘ï¼Œå¹¶å¯ç”¨ä½œæ•°æ®æºï¼Œä»ä¸­ç”Ÿæˆ CANopenNode çš„å¯¹è±¡å­—å…¸ã€‚è¯¥æ–‡ä»¶è¿˜å¯ç”¨äº CANopen é…ç½®å·¥å…·ï¼Œåœ¨è¿è¡Œçš„ CANopen ç½‘ç»œä¸Šä¸ CANopen è®¾å¤‡è¿›è¡Œäº¤äº’ã€‚ CANopen è¿˜ä¸º CANopen è®¾å¤‡æè¿°æŒ‡å®šäº†å¦ä¸€ç§ç±»å‹çš„æ–‡ä»¶ã€‚å®ƒä»¬æ˜¯ INI æ ¼å¼çš„ EDS æ–‡ä»¶ã€‚å¯ä»¥åœ¨è¿™ä¸¤ç§æ ¼å¼ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚è®¾å¤‡æè¿°æ–‡ä»¶çš„æ‰©å±•åä¸º â€œXDDâ€ã€‚è¯¥æ–‡ä»¶çš„åç§°åº”åŒ…å« CANopen è®¾å¤‡çš„ä¾›åº”å•† IDï¼Œä»¥ 8 ä½åå…­è¿›åˆ¶æ•°å­—çš„å½¢å¼å‡ºç°åœ¨åç§°çš„ä»»æ„ä½ç½®ï¼Œå¹¶ç”¨ä¸‹åˆ’çº¿åˆ†éš”ã€‚ä¾‹å¦‚ â€œname1_12345678_name2.XDDâ€ã€‚CANopenNode åŒ…å«å¤šä¸ªé…ç½®æ–‡ä»¶å®šä¹‰æ–‡ä»¶ï¼Œæ¯ä¸ª CANopen å¯¹è±¡ä¸€ä¸ªã€‚è¿™äº›æ–‡ä»¶çš„æ‰©å±•åä¸º â€œXPDâ€ã€‚å®ƒä»¬é‡‡ç”¨ä¸ XDD æ–‡ä»¶ç›¸åŒçš„ XML æ ¼å¼ã€‚XML ç¼–è¾‘å·¥å…·å¯ä»¥ä½¿ç”¨ XPD æ–‡ä»¶å°†å‡†å¤‡å¥½çš„æ•°æ®æ’å…¥æ­£åœ¨ç¼–è¾‘çš„è®¾å¤‡æè¿°æ–‡ä»¶ (XDD)ã€‚è¿˜æœ‰æ‰©å±•åä¸º â€œXDC â€œçš„è®¾å¤‡é…ç½®æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶æè¿°äº†å·²é…ç½®çš„ CANopen è®¾å¤‡ï¼Œå¹¶åŒ…å«å…¶ä»–å…ƒç´ ï¼Œå¦‚é»˜è®¤å€¼ã€åˆ†æ¯å’Œè®¾å¤‡è°ƒè¯•å…ƒç´ ã€‚ç±»ä¼¼äº INI æ ¼å¼çš„ â€œdcf â€œæ–‡ä»¶ã€‚ ä½¿ç”¨OD objectæ˜¯æŒ‡å¯¹è±¡å­—å…¸ä¸­ä½äºç‰¹å®š 16 ä½ç´¢å¼•çš„å¯¹è±¡ã€‚CANopen ä¸­æœ‰ä¸åŒç±»å‹çš„ OD å¯¹è±¡ï¼šå˜é‡ã€æ•°ç»„å’Œè®°å½•ï¼ˆç»“æ„ï¼‰ã€‚æ¯ä¸ª OD å¯¹è±¡éƒ½åŒ…å«æŒ‡å‘å®é™…æ•°æ®ã€æ•°æ®é•¿åº¦å’Œå±æ€§çš„æŒ‡é’ˆã€‚åœ¨ OD_objectTypes_t ä¸­è¢«å®šä¹‰ã€‚ OD variable æ˜¯æŒ‡å®šç±»å‹çš„åŸºæœ¬å˜é‡ã€‚ä¾‹å¦‚ï¼šint8_tã€uint32_tã€float64_tâ€¦â€¦æˆ–æ•°æ®é•¿åº¦å·²çŸ¥æˆ–æœªçŸ¥çš„äºŒè¿›åˆ¶æ•°æ®åºåˆ—ã€‚æ¯ä¸ª OD å˜é‡éƒ½ä»¥æŒ‡å®šçš„ 16 ä½ç´¢å¼•å’Œ 8 ä½å­ç´¢å¼•å­˜åœ¨äºå¯¹è±¡å­—å…¸ä¸­ã€‚ OD entryæŒ‡çš„æ˜¯ç»“æ„å…ƒç´ ï¼Œå…¶ä¸­åŒ…å« OD å¯¹è±¡çš„ä¸€äº›åŸºæœ¬å±æ€§ã€OD å¯¹è±¡çš„ç±»å‹æŒ‡ç¤ºä»¥åŠæŒ‡å‘ OD å¯¹è±¡æ‰€æœ‰å¿…è¦æ•°æ®çš„æŒ‡é’ˆã€‚OD æ¡ç›®æ•°ç»„ä»¥åŠ OD æ¡ç›®æ€»æ•°ä¿¡æ¯ä»£è¡¨ CANopenNode å†…éƒ¨å®šä¹‰çš„å¯¹è±¡å­—å…¸ã€‚å‚è§ OD_entry_t å’Œ OD_tã€‚ åº”ç”¨ç¨‹åºå’Œå †æ ˆå¯é€šè¿‡é€šç”¨çš„ OD_t å¯¹è±¡å’Œ OD_find() å‡½æ•°è®¿é—® OD å¯¹è±¡ã€‚æ— éœ€ç›´æ¥è®¿é—®å®šä¹‰å¯¹è±¡å­—å…¸çš„è‡ªå®šä¹‰ç»“æ„ã€‚ç‰¹å®š OD å˜é‡çš„å±æ€§å¯é€šè¿‡ OD_getSub()å‡½æ•°è·å–ã€‚é€šè¿‡ read å’Œ write å‡½æ•°è®¿é—®å®é™…å˜é‡ã€‚ OD_getSub() å¯ä»¥è·å–è¿™ä¸¤ä¸ªå‡½æ•°çš„æŒ‡é’ˆã€‚å‚è§ OD_stream_tã€‚å¦è¯·å‚è§å¿«æ·æ–¹å¼ï¼š CO_ODgetSetters ç”¨äºè®¿é—®ä¸åŒç±»å‹çš„æ•°æ®ã€‚ å¯ä»¥ä»ä¸åŒçš„çº¿ç¨‹è®¿é—® OD å˜é‡ã€‚CANopenNode åŸºæœ¬ä¸Šåœ¨ä¸¤ä¸ªçº¿ç¨‹ä¸­è¿è¡Œï¼šå¿«é€Ÿå®æ—¶çº¿ç¨‹ï¼ˆPDO å¤„ç†ç­‰ï¼‰å’Œéå…³é”®æ—¶é—´ä¸»çº¿ç¨‹ï¼ˆSDO ç­‰ï¼‰ã€‚ä¸¤ä¸ªçº¿ç¨‹éƒ½å¯ä»¥è®¿é—® OD å˜é‡ï¼Œå› æ­¤å¿…é¡»å°å¿ƒè°¨æ…ã€‚CANopenNode ä½¿ç”¨é”å®šæœºåˆ¶ï¼ŒSDO æœåŠ¡å™¨åœ¨è¯»å–æˆ–å†™å…¥ OD å˜é‡æ—¶ä¼šé˜»æ­¢å®æ—¶çº¿ç¨‹çš„æ‰§è¡Œã€‚åœ¨ CO_storage ä¸­ä¹Ÿéœ€è¦å¯¹ OD å˜é‡è¿›è¡ŒåŒæ ·çš„ä¿æŠ¤ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ CO_driver.h ä¸­çš„ CO_critical_sectionsã€‚ OD æ–‡ä»¶-ODxyz.c.hä¸€ä¸ª CANopen è®¾å¤‡çš„å®é™…å¯¹è±¡å­—å…¸ç”±ä¸€å¯¹ OD_xyz.h å’Œ ODxyz.c æ–‡ä»¶å®šä¹‰ã€‚ åç¼€ â€œxyz â€œæ˜¯å¯¹è±¡å­—å…¸çš„å”¯ä¸€åç§°ã€‚å¦‚æœä½¿ç”¨å•ä¸ªé»˜è®¤å¯¹è±¡å­—å…¸ï¼Œåˆ™çœç•¥åç¼€ã€‚è¿™æ ·å°±å¯ä»¥é…ç½®å¤šä¸ªå¯¹è±¡å­—å…¸ã€‚ ç”¨äºå®šä¹‰ OD çš„æ•°æ®å®‰æ’åœ¨å¤šä¸ªç»“æ„ä¸­ã€‚ä¸åŒçš„ OD é…ç½®æœ‰ä¸åŒçš„ç»“æ„ã€‚ç”¨è¿™äº›ç»“æ„åˆ›å»ºçš„æ•°æ®å¯¹è±¡å¯ä»¥æ˜¯å¸¸é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯å˜é‡ã€‚ å®é™…çš„ OD å˜é‡ä½äºå¤šä¸ªç»“æ„ï¼ˆå³å­˜å‚¨ç»„ï¼‰ä¸­ã€‚é€‰å®šçš„ç»„å¯ä»¥é€‰æ‹©å­˜å‚¨åˆ°éæ˜“å¤±æ€§å­˜å‚¨å™¨ä¸­ã€‚ æ‰‹åŠ¨ç¼–è¾‘ ODxyz.h.c æ–‡ä»¶éå¸¸å®¹æ˜“å‡ºé”™ã€‚ OD ç¼–è¾‘å·¥å…·å¯ç”Ÿæˆæˆå¯¹çš„ ODxyz.h.c æ–‡ä»¶ã€‚è¯¥å·¥å…·å¯ä»¥ç¼–è¾‘ xml æ ¼å¼çš„æ ‡å‡† CANopen è®¾å¤‡æè¿°æ–‡ä»¶ã€‚Xml æ–‡ä»¶å¯èƒ½è¿˜åŒ…æ‹¬ä¸€äº› CANopenNode ç‰¹æœ‰çš„éæ ‡å‡†å…ƒç´ ã€‚ç„¶åï¼ŒXml æ–‡ä»¶å°†ç”¨äºè‡ªåŠ¨ç”Ÿæˆ ODxyz.h.c æ–‡ä»¶ã€‚ /* OD data declaration of all groups ******************************************/typedef struct uint32_t x1000_deviceType; struct uint8_t maxSubIndex; uint32_t vendorID; uint32_t productCode; uint32_t revisionNumber; uint32_t serialNumber; x1018_identity; ODxyz_PERSIST_COMM_t;typedef struct uint8_t x1001_errorRegister; uint8_t x1003_preDefinedErrorField_sub0; uint32_t x1003_preDefinedErrorField[8]; ODxyz_RAM_t;extern ODxyz_PERSIST_COMM_t ODxyz_PERSIST_COMM;extern ODxyz_RAM_t ODxyz_RAM;extern OD_t *ODxyz;/* Object dictionary entries - shortcuts **************************************/#define ODxyz_ENTRY_H1000 ODxyz-list[0]#define ODxyz_ENTRY_H1001 ODxyz-list[1]#define ODxyz_ENTRY_H1003 ODxyz-list[2]#define ODxyz_ENTRY_H1018 ODxyz-list[3]#define ODxyz_ENTRY_H1000_deviceType ODxyz-list[0]#define ODxyz_ENTRY_H1001_errorRegister ODxyz-list[1]#define ODxyz_ENTRY_H1003_preDefinedErrorField ODxyz-list[2]#define ODxyz_ENTRY_H1018_identity ODxyz-list[3] #define OD_DEFINITION#include 301/CO_ODinterface.h#include ODxyz.h/* OD data initialization of all groups ***************************************/ODxyz_PERSIST_COMM_t ODxyz_PERSIST_COMM = .x1000_deviceType = 0, .x1018_identity = .maxSubIndex = 4, .vendorID = 0, .productCode = 0, .revisionNumber = 0, .serialNumber = 0 ;ODxyz_RAM_t ODxyz_RAM = .x1001_errorRegister = 0, .x1003_preDefinedErrorField_sub0 = 0, .x1003_preDefinedErrorField = 0, 0, 0, 0, 0, 0, 0, 0;/* All OD objects (constant) **************************************************/typedef struct OD_obj_var_t o_1000_deviceType; OD_obj_var_t o_1001_errorRegister; OD_obj_array_t o_1003_preDefinedErrorField; OD_obj_record_t o_1018_identity[5]; ODxyzObjs_t;static CO_PROGMEM ODxyzObjs_t ODxyzObjs = .o_1000_deviceType = .dataOrig = ODxyz_PERSIST_COMM.x1000_deviceType, .attribute = ODA_SDO_R | ODA_MB, .dataLength = 4 , .o_1001_errorRegister = .dataOrig = ODxyz_RAM.x1001_errorRegister, .attribute = ODA_SDO_R, .dataLength = 1 , .o_1003_preDefinedErrorField = .dataOrig0 = ODxyz_RAM.x1003_preDefinedErrorField_sub0, .dataOrig = ODxyz_RAM.x1003_preDefinedErrorField[0], .attribute0 = ODA_SDO_RW, .attribute = ODA_SDO_R | ODA_MB, .dataElementLength = 4, .dataElementSizeof = sizeof(uint32_t) , .o_1018_identity = .data = ODxyz_PERSIST_COMM.x1018_identity.maxSubIndex, .subIndex = 0, .attribute = ODA_SDO_R, .dataLength = 1 , .data = ODxyz_PERSIST_COMM.x1018_identity.vendorID, .subIndex = 1, .attribute = ODA_SDO_R | ODA_MB, .dataLength = 4 , .data = ODxyz_PERSIST_COMM.x1018_identity.productCode, .subIndex = 2, .attribute = ODA_SDO_R | ODA_MB, .dataLength = 4 , .data = ODxyz_PERSIST_COMM.x1018_identity.revisionNumber, .subIndex = 3, .attribute = ODA_SDO_R | ODA_MB, .dataLength = 4 , .data = ODxyz_PERSIST_COMM.x1018_identity.serialNumber, .subIndex = 4, .attribute = ODA_SDO_R | ODA_MB, .dataLength = 4 ;/* Object dictionary **********************************************************/static OD_entry_t ODxyzList[] = 0x1000, 0x01, ODT_VAR, ODxyzObjs.o_1000_deviceType, NULL, 0x1001, 0x01, ODT_VAR, ODxyzObjs.o_1001_errorRegister, NULL, 0x1003, 0x09, ODT_VAR, ODxyzObjs.o_1003_preDefinedErrorField, NULL, 0x1018, 0x05, ODT_REC, ODxyzObjs.o_1018_identity, NULL, 0x0000, 0x00, 0, NULL, NULL;OD_t _ODxyz = (sizeof(ODxyzList) / sizeof(ODxyzList[0])) - 1, ODxyzList[0];OD_t *ODxyz = _ODxyz; OD_find æŸ¥æ‰¾æŒ‡å®šå¯¹è±¡extern OD_t *ODxyz;void myFunc(OD_t *od) ODR_t odRet;//ä¿å­˜å¯¹è±¡å­—å…¸æ“ä½œçš„è¿”å›å€¼ã€‚ OD_entry_t *entry;//æŒ‡å‘å¯¹è±¡å­—å…¸æ¡ç›®çš„æŒ‡é’ˆã€‚ OD_IO_t io1008;//ç”¨äºå¯¹è±¡å­—å…¸I/Oæ“ä½œçš„ç»“æ„ä½“ã€‚ char buf[50]; OD_size_t bytesRd;//å­˜å‚¨è¯»å–çš„å­—èŠ‚æ•°ã€‚ int error = 0; // æŸ¥æ‰¾å¹¶åˆå§‹åŒ–0x1008æ¡ç›®å’Œå…¶å­ç´¢å¼•0x00çš„IOç»“æ„ä½“ entry = OD_find(od, 0x1008);//æŸ¥æ‰¾å¯¹è±¡å­—å…¸ä¸­çš„æ¡ç›®ã€‚ odRet = OD_getSub(entry, 0x00, io1008, false);//è·å–å¯¹è±¡å­—å…¸æ¡ç›®çš„å­ç´¢å¼•ã€‚ // è¯»å–åˆ¶é€ å•†è®¾å¤‡åç§° if (odRet == ODR_OK) /* Locking is necessary from mainline thread, but must not be used from * timer interval (real-time) thread. Locking is not necessary in the * CANoopen initialization section. Locking is also not necessary, if * OD variable is not mappable to PDO and not accessed from RT thread.*/ CO_LOCK_OD(CANmodule); odRet = io1008.read(io1008.stream, buf[0], sizeof(buf), bytesRd);//è¯»å–å­ç´¢å¼•çš„æ•°æ®ã€‚ CO_UNLOCK_OD(CANmodule); if (odRet != ODR_OK) error++; /* Use helper and set Producer heartbeat time at index 0x1017, sub 0x00 */ // è®¾ç½®ç”Ÿäº§è€…å¿ƒè·³æ—¶é—´ CO_LOCK_OD(CANmodule); /* may not be necessary, see comment above */ odRet = OD_set_u16(OD_find(od, 0x1017), 0x00, 500, false);//è®¾ç½®å¯¹è±¡å­—å…¸æ¡ç›®çš„å­ç´¢å¼•å€¼ã€‚ CO_UNLOCK_OD(CANmodule); if (odRet != ODR_OK) error++; ç›´æ¥æ ¹æ®ç»“æ„ä½“æŸ¥æ‰¾ OD å¯¹è±¡å¦‚ä½•ç›´æ¥è®¿é—®å’Œæ“ä½œ CANopen å¯¹è±¡å­—å…¸ï¼ˆObject Dictionaryï¼‰ä¸­çš„æ¡ç›®ï¼Œè€Œä¸æ˜¯é€šè¿‡æŸ¥æ‰¾å‡½æ•° OD_find æ¥é—´æ¥è®¿é—®ã€‚ç›´æ¥è®¿é—®å¯¹è±¡å­—å…¸æ¡ç›®å’Œå˜é‡æ¯”é€šè¿‡å‡½æ•°æŸ¥æ‰¾è¦å¿«ï¼Œå› ä¸ºå®ƒé¿å…äº†å‡½æ•°è°ƒç”¨å’ŒæŸ¥æ‰¾è¿‡ç¨‹ã€‚ å¯¹è±¡å­—å…¸çš„å¤´æ–‡ä»¶ ODxyz.hï¼Œå…¶ä¸­å®šä¹‰äº†å¯¹è±¡å­—å…¸çš„æ‰€æœ‰æ¡ç›®å’Œç›¸å…³ç»“æ„ã€‚ #include ODxyz.hvoid myFuncGlob(void) // Direct address instead of OD_find() OD_entry_t *entry_errReg = ODxyz_1001_errorRegister; // Direct access to OD variable uint32_t devType = ODxyz_0.x1000_deviceType; ODxyz_0.x1018_identity.serialNumber = 0x12345678; OD_entry_t *entry_errReg = ODxyz_1001_errorRegister; ç›´æ¥è·å–å¯¹è±¡å­—å…¸ä¸­ 0x1001 ç´¢å¼•ï¼ˆé”™è¯¯å¯„å­˜å™¨ï¼‰çš„æ¡ç›®æŒ‡é’ˆ entry_errRegã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯ç›´æ¥å£°æ˜çš„æŒ‡é’ˆ ODxyz_1001_errorRegisterï¼Œè€Œä¸æ˜¯é€šè¿‡ OD_find å‡½æ•°æŸ¥æ‰¾ã€‚ uint32_t devType = ODxyz_0.x1000_deviceType; ç›´æ¥è¯»å–å¯¹è±¡å­—å…¸ä¸­ 0x1000 ç´¢å¼•ï¼ˆè®¾å¤‡ç±»å‹ï¼‰çš„å˜é‡ ODxyz_0.x1000_deviceTypeï¼Œå¹¶å°†å…¶å­˜å‚¨åˆ°æœ¬åœ°å˜é‡ devType ä¸­ã€‚ODxyz_0.x1018_identity.serialNumber = 0x12345678; ç›´æ¥ä¿®æ”¹å¯¹è±¡å­—å…¸ä¸­ 0x1018 ç´¢å¼•ï¼ˆè®¾å¤‡æ ‡è¯†ï¼‰çš„ serialNumber å­—æ®µï¼Œå°†å…¶è®¾ç½®ä¸º 0x12345678ã€‚ å¦‚æœ OD å¯¹è±¡å·²å¯ç”¨ OD æ‰©å±•ï¼Œåˆ™ä¸å¾—ç›´æ¥è®¿é—®å…¶ OD å˜é‡ã€‚åªæœ‰é€šè¿‡è¯»ã€å†™æˆ–è¾…åŠ©å‡½æ•°è®¿é—®æ‰æœ‰æ•ˆã€‚ ä¿®æ”¹ PDO å›ºå®šé•¿åº¦åœ¨ PDO åè®®ä¸­ï¼Œæ•°æ®çš„æ¥æ”¶æ˜¯ä¸¥æ ¼æŒ‰ç…§ PDO ä¸­æ˜ å°„çš„æ•°æ®é•¿åº¦æ¥è¯»å–çš„ï¼Œå½“æ•°æ®ä¸è¶³æ—¶ï¼Œè¯¥æ•°æ®å¸§ä¼šè¢«ä¸¢å¼ƒï¼Œå½“æ•°æ®è¿‡é•¿æ—¶ï¼Œè¯¥æ•°æ®å¸§ä¼šè¢«æˆªæ–­ã€‚ åœ¨æ­¤æ¬¡çš„åº”ç”¨ç¨‹åºä¸­ï¼Œç”±äºè¯¥è®¾å¤‡é…ç½®çš„ PDO å­˜åœ¨ä¸¤ç§é•¿åº¦æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦å°† PDO çš„æ•°æ®é•¿åº¦æ›´æ”¹ä¸ºå…¼å®¹è‡ªå®šä¹‰çš„ä¸¤ç§æ•°æ®é•¿åº¦ã€‚ åœ¨ CO_PDO.c æ–‡ä»¶ä¸­ï¼Œæœ‰ RPDO å¤„ç†å‡½æ•° CO_RPDO_processï¼Œå…¶ä¸­çš„ for å¾ªç¯ï¼Œå½“å°äº PDO-mappedObjectsCount æ•°é‡æ—¶ï¼Œæ‰§è¡Œ 1byte çš„æ‹·è´ï¼Œæ‰€ä»¥æ­¤å¤„ä»¬éœ€è¦ä¿®æ”¹ä¸ºå½“ iCO_PDO_MAX_SIZE æ—¶æ‰§è¡Œæ‹·è´ï¼Œå³å¯¹ PDO ä¸­æ‰€æœ‰çš„æ•°æ®è¿›è¡Œæ‹·è´ï¼Œä¸ç®¡è¯¥å­—èŠ‚æ˜¯å¦æœ‰æ•°æ®ã€‚","categories":["4.é€šè®¯åè®®","CAN"]},{"title":"CANå’ŒCANFD","path":"/2024/01/01/4-é€šè®¯åè®®-CAN-CANå’ŒCANFD/","content":"CAN å’Œ CANFDå¯¹äº CAN-FD è€Œè¨€ï¼Œæ•°æ®æ¯”ç‰¹ç‡è¦å¤§äºç­‰äºä»¶è£æ¯”ç‰¹ç‡ï¼Œç”¨ ip link set can0 type can bitrate 500000 è¿™ä¸ªå‘½ä»¤æ“ä½œ CAN-FD æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ¢æˆ ip link set can0 type can bitrate 500000 dbitrate 500000 fd onï¼Œè€Œåå°±å¯ä»¥åˆ©ç”¨ CAN-FD è¿›è¡Œæ•°æ®çš„æ”¶å‘ æŒ‰ç…§é…ç½® CAN çš„æ–¹å¼å»é…ç½® CAN-FDï¼Œå¯¼è‡´å°‘é…ç½®äº† CAN-FD çš„æ•°æ®æ¯”ç‰¹ç‡ï¼Œå¯¼è‡´å‡ºé”™ã€‚ä¹‹å‰é…ç½® CAN çš„æŒ‡ä»¤ä¸º ip link set can0 type canbitrate 500000ï¼Œå®é™…é€šè¿‡åˆ†æ CAN-FD çš„é©±åŠ¨ä»£ç ä»¥åŠ CAN-FD é€šä¿¡åè®®çš„æŠ¥æ–‡æ ¼å¼å‘ç°ï¼Œå¯¹äº CAN-FDï¼Œæ•°æ®æ¯”ç‰¹ç‡æ˜¯è¦å¤§äºä»²è£æ¯”ç‰¹ç‡çš„ã€‚æ¢ç”¨ ip link set can0 type can bitrate 500000 dbitrate 500000 fd on é…ç½®æ•°æ®æ¯”ç‰¹ç‡ä¹‹åï¼ŒCAN-FD å°±å¯ä»¥æ­£å¸¸æ”¶å‘æ•°æ®äº†, åˆ†æ:CAN-FD é‡‡ç”¨äº†ä¸¤ç§æ–¹å¼æ¥æé«˜é€šä¿¡çš„æ•ˆç‡ï¼Œå…¶ä¸­ä¸€ç§å«å¯å˜åŠæ›´é«˜çš„æ•°æ®ä¼ è¾“é€Ÿç‡:ä»æ§åˆ¶åœºä¸­çš„ BRS ä½åˆ° ACK åœºä¹‹å‰(å« CRC ä½†ä¸ºäº†ä¿è¯æ€»çº¿çš„å¥å£®å¯é ï¼Œä»²è£æ®µ(ID å’Œ ACK)ä¿æŒä¸å˜ï¼Œé‡‡ç”¨åŸåˆ†ç•Œç¬¦)ä¸ºå¯å˜é€Ÿç‡ï¼ŒCAN-FD æ•°æ®æ®µçš„ä¼ è¾“é€Ÿç‡æœ€å¤§å¯è¾¾ 5MbitsCAN æ€»çº¿ç”¨çš„é€Ÿç‡(æœ€é«˜ 1Mbits)ã€‚ æ³¨æ„:ä¸¤ç§é€Ÿç‡å„æœ‰ä¸€å¥—ä½æ—¶é—´å®šä¹‰å¯„å­˜å™¨ï¼Œå¯¹äº CAN-FD æ¥è¯´å‡è¦é…ç½®ã€‚ CAN å’Œ CANFDCAN ä¸ CAN-FD ä¸»è¦åŒºåˆ«ï¼š ä¼ è¾“é€Ÿç‡ä¸åŒ CANï¼šæœ€å¤§ä¼ è¾“é€Ÿç‡ 1Mbpsã€‚ CAN-FDï¼šé€Ÿç‡å¯å˜ï¼Œä»²è£æ¯”ç‰¹ç‡æœ€é«˜ 1Mbpsï¼ˆä¸ CAN ç›¸åŒï¼‰ï¼Œæ•°æ®æ¯”ç‰¹ç‡æœ€é«˜ 8Mbpsã€‚ æ•°æ®é•¿åº¦ä¸åŒ CANï¼šä¸€å¸§æ•°æ®æœ€é•¿ 8 å­—èŠ‚ CAN-FDï¼šä¸€å¸§æ•°æ®æœ€é•¿ 64 å­—èŠ‚ã€‚ å¸§æ ¼å¼ä¸åŒå’Œ ID é•¿åº¦ä¸åŒã€‚ CANFD ä¸å­˜åœ¨è¿œç¨‹å¸§ï¼ŒCAN æŠ¥æ–‡ä¸­çš„ RTRï¼ˆç”¨äºåŒºåˆ«æ ‡å‡†å¸§ä¸è¿œç¨‹å¸§ï¼‰è¢«æ›¿æ¢ä¸º RRSï¼ˆè¿œç¨‹è¯·æ±‚æ›¿ä»£ä½ï¼Œé»˜è®¤å€¼ä¸º 0ï¼‰ CANFD æŠ¥æ–‡çš„æ ‡å‡†å¸§å’Œæ‰©å±•å¸§â€”IDE ä¸º 1 è¡¨ç¤ºä¸ºæ‰©å±•å¸§ã€ä¸º 0 è¡¨ç¤ºæ ‡å‡†å¸§ FDF ç”¨äºä¼ ç»Ÿ CAN æŠ¥æ–‡å’Œ CANFD æŠ¥æ–‡ï¼ŒFDF ä½ä¸º 0 æ—¶ä¸ºä¼ ç»ŸæŠ¥æ–‡ï¼ŒFDF ä¸º 1 æ—¶ä¸º CANFD æŠ¥æ–‡ BRS ä½é€Ÿç‡åˆ‡æ¢ä½ï¼ŒBRS ä½ä¸º 0 æ—¶ CANFD é€Ÿç‡ä¿æŒæ’å®šé€Ÿç‡ã€BRS ä½ä¸º 1 æ—¶ CANFD çš„æ•°æ®æ®µä¼šè¢«åˆ‡æ¢åˆ°é«˜é€Ÿç‡ã€‚ ESI é”™è¯¯çŠ¶æ€æŒ‡ç¤ºä½ï¼šCAN æŠ¥æ–‡ä¸­å‘é€èŠ‚ç‚¹çš„é”™è¯¯çŠ¶æ€åªæœ‰è¯¥èŠ‚ç‚¹è‡ªå·±çŸ¥é“ï¼ŒCANFD æŠ¥æ–‡ä¸­å¯ä»¥é€šè¿‡ ESI æ ‡å¿—ä½æ¥å‘Šè¯‰å…¶ä»–èŠ‚ç‚¹è¯¥èŠ‚ç‚¹çš„é”™è¯¯çŠ¶æ€ï¼Œå½“ ESI ä¸º 1 æ—¶è¡¨ç¤ºå‘é€èŠ‚ç‚¹å¤„äºè¢«åŠ¨é”™è¯¯çŠ¶æ€ã€å½“ ESI ä¸º 0 æ—¶è¡¨ç¤ºå‘é€èŠ‚ç‚¹å¤„äºä¸»åŠ¨é”™è¯¯çŠ¶æ€ CRCï¼šéšç€æ•°æ®åœºçš„æ‰©å¤§ï¼Œä¸ºäº†ä¿è¯ä¿¡æ¯å‘é€çš„è´¨é‡ï¼ŒCAN FD çš„ CRC è®¡ç®—ä¸ä»…è¦åŒ…æ‹¬æ•°æ®æ®µçš„ä½ï¼Œè¿˜åŒ…æ‹¬æ¥è‡ª SOF çš„ Stuff Count å’Œå¡«å……ä½ã€‚é€šè¿‡æ¯”è¾ƒ CRC çš„è®¡ç®—ç»“æœï¼Œå¯ä»¥åˆ¤æ–­æ¥æ”¶èŠ‚ç‚¹æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸æ¥æ”¶ã€‚ åœ¨ CAN ä¸­ï¼ŒCRC çš„ä½æ•°æ˜¯ 15 ä½ï¼Œè€Œåœ¨ CAN FD ä¸­ï¼ŒCRC åœºæ‰©å±•åˆ°äº† 21 ä½ã€‚ å½“ä¼ è¾“æŠ¥æ–‡ä¸º 15 å­—èŠ‚æ—¶ï¼šCRC 15 ä½ å½“ä¼ è¾“æ•°æ®ä¸º 16 å­—èŠ‚æˆ–æ›´å°‘æ—¶ï¼šCRC 17 ä½ å½“ä¼ è¾“æ•°æ®è¶…è¿‡ 16 å­—èŠ‚æ—¶ï¼šCRC 21 ä½ CAN FD DLCDLC å’Œ æ•°æ®é•¿åº¦çš„å…³ç³»åœ¨ Linux çš„ SocketCAN ä¸­ï¼Œstruct canfd_frame ä¸­çš„ len å­—æ®µè¡¨ç¤ºå®é™…çš„æœ‰æ•ˆè´Ÿè½½é•¿åº¦ï¼ˆå³æ•°æ®é•¿åº¦ï¼‰ï¼Œè€Œ CAN FD åè®®ä½¿ç”¨çš„æ˜¯ 4-bit çš„ DLCï¼ˆData Length Codeï¼‰æ¥è¡¨ç¤ºå¸§ä¸­æ•°æ®çš„é•¿åº¦ã€‚è¿™ä¸¤è€…ä¹‹é—´çš„å…³ç³»æ˜¯é€šè¿‡ä¸€ç»„æ˜ å°„è§„åˆ™æ¥è½¬æ¢çš„ã€‚ åœ¨ CAN FD åè®®ä¸­ï¼ŒDLC æ˜¯ä¸€ä¸ª 4 ä½çš„å­—æ®µï¼Œå…è®¸çš„å–å€¼èŒƒå›´ä¸º 0 åˆ° 15ã€‚è¿™äº› DLC å€¼å¹¶ä¸æ˜¯ç›´æ¥è¡¨ç¤ºå­—èŠ‚é•¿åº¦ï¼Œè€Œæ˜¯ä¸æœ‰æ•ˆè´Ÿè½½é•¿åº¦ä¹‹é—´æœ‰ä¸€ä¸ªå›ºå®šçš„æ˜ å°„å…³ç³»ã€‚å…·ä½“æ˜ å°„å¦‚ä¸‹ï¼š DLC æ•°æ®å­—èŠ‚æ•° (Payload Length) 0-8 0-8 9 12 10 16 11 20 12 24 13 32 14 48 15 64 struct canfd_frame ä¸­ len å’Œ DLC çš„è½¬æ¢åœ¨ SocketCAN ä¸­ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡ struct canfd_frame æ¥å‘é€ CAN FD å¸§ã€‚struct canfd_frame ä¸­çš„ len å­—æ®µè¡¨ç¤ºå®é™…çš„æœ‰æ•ˆè´Ÿè½½é•¿åº¦ï¼Œè€Œå†…æ ¸ä¼šæ ¹æ®è¿™ä¸ª len å€¼æ¥ç¡®å®šå¯¹åº”çš„ DLC å€¼ã€‚è½¬æ¢è§„åˆ™å¦‚ä¸‹ï¼š å¦‚æœ len çš„å€¼åœ¨ 0 åˆ° 8 ï¼ŒDLC çš„å€¼ä¸ len ç›´æ¥ç›¸ç­‰ã€‚ä¾‹å¦‚ï¼Œlen 5ï¼Œåˆ™ DLC 5ã€‚ å¦‚æœ len çš„å€¼å¤§äº 8ï¼Œç³»ç»Ÿä¼šæ ¹æ® DLC ä¸æœ‰æ•ˆè´Ÿè½½é•¿åº¦çš„å›ºå®šæ˜ å°„æ¥é€‰æ‹©æœ€å°çš„ DLCï¼Œä½¿å¾—èƒ½ä¼ è¾“æŒ‡å®šçš„å­—èŠ‚æ•°ã€‚ä¾‹å¦‚ï¼š len 9 åˆ° len 12ï¼ŒDLC 9ï¼Œå¯¹åº” 12 å­—èŠ‚çš„è´Ÿè½½ã€‚ len 13 åˆ° len 16ï¼ŒDLC 10ï¼Œå¯¹åº” 16 å­—èŠ‚çš„è´Ÿè½½ã€‚ len 17 åˆ° len 20ï¼ŒDLC 11ï¼Œå¯¹åº” 20 å­—èŠ‚çš„è´Ÿè½½ã€‚ len 21 åˆ° len 24ï¼ŒDLC 12ï¼Œå¯¹åº” 24 å­—èŠ‚çš„è´Ÿè½½ã€‚ len 25 åˆ° len 32ï¼ŒDLC 13ï¼Œå¯¹åº” 32 å­—èŠ‚çš„è´Ÿè½½ã€‚ len 33 åˆ° len 48ï¼ŒDLC 14ï¼Œå¯¹åº” 48 å­—èŠ‚çš„è´Ÿè½½ã€‚ len 49 åˆ° len 64ï¼ŒDLC 15ï¼Œå¯¹åº” 64 å­—èŠ‚çš„è´Ÿè½½ã€‚ å®é™…å‘é€æ—¶çš„ DLC è®¡ç®—å½“åœ¨ SocketCAN ä¸­ä½¿ç”¨ canfd_frame ç»“æ„ä½“å‘é€æ•°æ®æ—¶ï¼š åœ¨ len å­—æ®µä¸­æŒ‡å®šå®é™…çš„æ•°æ®é•¿åº¦ã€‚ å†…æ ¸ä¼šæ ¹æ®ä¸Šè¿°è§„åˆ™ï¼Œè‡ªåŠ¨è®¡ç®—å¹¶è®¾ç½®ç›¸åº”çš„ DLC å€¼ï¼Œç¡®ä¿æ•°æ®å¯ä»¥æ­£ç¡®ä¼ è¾“ã€‚ å¦‚æœ len çš„å€¼ä¸ç›´æ¥å¯¹åº”æŸä¸ª DLCï¼ˆå¦‚ len 33ï¼‰ï¼Œå†…æ ¸ä¼šè‡ªåŠ¨é€‰æ‹©èƒ½å®¹çº³è¯¥æ•°æ®é•¿åº¦çš„æœ€å° DLCï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒDLC ä¼šè¢«è®¾ç½®ä¸º 14ï¼Œå¯¹åº” 48 å­—èŠ‚ï¼‰ã€‚ ç¤ºä¾‹å‡è®¾è¦å‘é€ 33 ä¸ªå­—èŠ‚çš„æ•°æ®ï¼š struct canfd_frame çš„ len è®¾ç½®ä¸º 33ã€‚å†…æ ¸æ ¹æ® len å€¼é€‰æ‹©å¯¹åº”çš„ DLC ä¸º 14ï¼ˆå› ä¸º DLC14 å¯¹åº” 48 å­—èŠ‚çš„æœ‰æ•ˆè´Ÿè½½é•¿åº¦ï¼Œå¯ä»¥å®¹çº³ 33 ä¸ªå­—èŠ‚ï¼‰ã€‚ å®é™…å‘é€æ—¶ï¼ŒCAN FD å¸§ä¼šåŒ…å« 33 å­—èŠ‚çš„æ•°æ®ï¼ŒDLC ä¼šæ ‡è®°ä¸º 14ï¼Œè¡¨ç¤ºè¯¥å¸§å…è®¸çš„æœ€å¤§æœ‰æ•ˆè´Ÿè½½æ˜¯ 48 å­—èŠ‚ï¼Œå°½ç®¡åªä½¿ç”¨äº† 33 å­—èŠ‚ã€‚","categories":["4.é€šè®¯åè®®","CAN"]},{"title":"CANå­¦ä¹ ç¬”è®°","path":"/2023/12/29/4-é€šè®¯åè®®-CAN-CANå­¦ä¹ ç¬”è®°/","content":"CAN StandardsThere are many standards to choose from. Hereâ€™s but a few: The CAN standard: ISO 11898-1 â€“ the CAN protocol ISO 11898-2 â€“ high-speed physical layer for CAN ISO 11898-3 â€“ low-speed fault-tolerant physical layer for CAN ISO 11898-4 â€“ Time-Triggered CAN ISO 11898-5 â€“ â€œHigh-speed medium access unit with low-power modeâ€ â€“ currently in the Working Draft stage. ISO 11519-2 â€“ obsolete and superseded by 11898-3. ISO 14230 â€“ â€œKeyword Protocol 2000â€ â€“ several parts that define diagnostics on a serial line which is not CAN. ISO 15765 â€“ this is a standard that defines diagnostics on a CAN bus â€“ essentially Keyword 2000 on a CAN bus. J1939Â â€“ the dominating CAN-based higher-layer protocol for trucks and busses, defined byÂ SAE. J1939 is divided into several parts describing the physical layer, data link layer, network management, and a large number of predefined messages. ISO 11783Â â€“ a J1939 flavor for agricultural (tractors!) use ISO 11992 â€“ defines an interface between trucks and trailers NMEA 2000Â®Â â€“ protocol based on J1939 for marine use. Defined by theÂ NMEAÂ committee. When people talk about â€œCANâ€ without further detailing what standards they are talking about, they usually mean the protocol defined by 11898-1 and the physical layer defined by 11898-2. The ISO standards are maintained byÂ ISO. You canâ€™t download them for free, but you can purchase them online. If you go to your national standardizations organization you might find a translated edition. Other related protocols and standardsThere are a number of protocols and standards closely related to CAN. Read about some of them below. LIN J1587 J1708 J2534 RP1210A, RP1210B CCPXCP æ¦‚è¿°ä»‹ç»CAN æ€»çº¿æ˜¯ä¸€ç§ä¸²è¡Œé€šä¿¡åè®®ï¼Œä½¿ç”¨çš„æ˜¯ä¸¤æ¡å·®åˆ†ä¿¡å·çº¿ï¼Œåªèƒ½è¡¨è¾¾ä¸€ä¸ªä¿¡å·ã€‚ç®€æ´çš„ç‰©ç†å±‚å†³å®šäº† CAN å¿…ç„¶è¦é…ä¸Šä¸€å¥—å¤æ‚çš„åè®®ã€‚æ ¹æ®ä¸åŒçš„è·ç¦»ã€ä¸åŒçš„ç½‘ç»œï¼Œå¯é…ç½®ä¸åŒçš„é€Ÿåº¦ï¼Œæœ€é«˜é€Ÿåº¦ä¸º 1MBitsã€‚ CAN 2.0A ä¸ºæ ‡å‡†æ ¼å¼ï¼ŒCAN 2.0B ä¸ºæ‰©å±•æ ¼å¼ã€‚ å¯ä»¥å¤šä¸»æ–¹å¼å·¥ä½œï¼Œç½‘ç»œä¸Šçš„ä»»æ„èŠ‚ç‚¹å‡å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»ä¸»åŠ¨åœ°å‘ç½‘ç»œä¸Šçš„å…¶ä»–èŠ‚ç‚¹å‘é€ä¿¡æ¯ï¼Œè€Œä¸åˆ†ä¸»ä»ï¼Œé€šä¿¡æ–¹å¼çµæ´»ã€‚ ç½‘ç»œä¸Šçš„èŠ‚ç‚¹ (ä¿¡æ¯) å¯åˆ†æˆä¸åŒçš„ä¼˜å…ˆçº§ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒçš„å®æ—¶è¦æ±‚ã€‚ é‡‡ç”¨éç ´åæ€§ä½ä»²è£æ€»çº¿ç»“æ„æœºåˆ¶ï¼Œå½“ä¸¤ä¸ªèŠ‚ç‚¹åŒæ—¶å‘ç½‘ç»œä¸Šä¼ é€ä¿¡æ¯æ—¶ï¼Œä¼˜å…ˆçº§ä½çš„èŠ‚ç‚¹ä¸»åŠ¨åœæ­¢æ•°æ®å‘é€ï¼Œè€Œä¼˜å…ˆçº§é«˜çš„èŠ‚ç‚¹å¯ä¸å—å½±å“åœ°ç»§ç»­ä¼ è¾“æ•°æ®ã€‚ CAN å±æ€§ å±æ€§ è¯´æ˜ æŠ¥æ–‡ï¼ˆMessagesï¼‰ CAN åè®®å¯¹æ•°æ®ã€æ“ä½œå‘½ä»¤ (å¦‚è¯»å†™) ä»¥åŠåŒæ­¥ä¿¡å·è¿›è¡Œæ‰“åŒ…ï¼Œæ‰“åŒ…åçš„è¿™äº›å†…å®¹ç§°ä¸ºæŠ¥æ–‡ï¼Œç®€å•æ¥è¯´å°±æ˜¯å…·æœ‰å›ºå®šæ ¼å¼çš„æ•°æ®åŒ…ã€‚ ä¿¡æ¯è·¯ç”±ï¼ˆInformation Routingï¼‰ æŠ¥æ–‡å¯»æ‰¾ç»“ç‚¹çš„æ–¹å¼ã€‚ ä½é€Ÿç‡ï¼ˆBit rateï¼‰ æ•°æ®ä½çš„ä¼ è¾“é€Ÿåº¦ã€‚ ä¼˜å…ˆæƒï¼ˆPrioritiesï¼‰ æŠ¥æ–‡å‘é€çš„ä¼˜å…ˆæƒã€‚ è¿œç¨‹æ•°æ®è¯·æ±‚ï¼ˆRemote Data Requestï¼‰ é€šè¿‡å‘é€è¿œç¨‹å¸§ï¼Œéœ€è¦æ•°æ®çš„èŠ‚ç‚¹å¯ä»¥è¯·æ±‚å¦ä¸€èŠ‚ç‚¹å‘é€ç›¸åº”çš„æ•°æ®å¸§ã€‚ å¤šä¸»æœºï¼ˆMultimasterï¼‰ æ€»çº¿ç©ºé—²æ—¶ï¼Œä»»ä½•ç»“ç‚¹éƒ½å¯ä»¥å¼€å§‹ä¼ é€æŠ¥æ–‡ã€‚ ä»²è£ï¼ˆArbitrationï¼‰ å½“ 2 ä¸ªåŠä»¥ä¸Šçš„å•å…ƒåŒæ—¶å¼€å§‹ä¼ é€æŠ¥æ–‡ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰æ€»çº¿è®¿é—®å†²çªã€‚ä»²è£æ˜¯ç¡®å®šå“ªä¸ªå•å…ƒçš„å…·æœ‰å‘é€ä¼˜å…ˆæƒã€‚ å®‰å…¨æ€§ï¼ˆSafetyï¼‰ CAN çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹å‡é‡‡å–äº†å¼ºæœ‰åŠ›çš„æªæ–½ä»¥è¿›è¡Œé”™è¯¯æ£€æµ‹ã€é”™è¯¯æ ‡å®šåŠé”™è¯¯è‡ªæ£€ã€‚ é”™è¯¯æ£€æµ‹ï¼ˆError Detectionï¼‰ åŒ…æ‹¬ç›‘è§†ã€å¾ªç¯å†—ä½™æ£€æŸ¥ã€ä½å¡«å……ã€æŠ¥æ–‡æ ¼å¼æ£€æŸ¥ã€‚ é”™è¯¯æ£€æµ‹çš„æ‰§è¡Œï¼ˆPerformance of Error Detectionï¼‰ é”™è¯¯æ ‡å®šå’Œæ¢å¤æ—¶é—´ï¼ˆError Sinalling and Recovery Timeï¼‰ ä»»ä½•æ£€æµ‹åˆ°é”™è¯¯çš„ç»“ç‚¹ä¼šæ ‡å¿—å‡ºå·²æŸåçš„æŠ¥æ–‡ã€‚æ­¤æŠ¥æ–‡ä¼šå¤±æ•ˆå¹¶å°†è‡ªåŠ¨åœ°å¼€å§‹é‡æ–°ä¼ é€ã€‚å¦‚æœä¸å†å‡ºç°æ–°çš„é”™è¯¯ï¼Œä»æ£€æµ‹åˆ°é”™è¯¯åˆ°ä¸‹ä¸€æŠ¥æ–‡çš„ä¼ é€å¼€å§‹ä¸ºæ­¢ï¼Œæ¢å¤æ—¶é—´æœ€å¤šä¸º 29 ä¸ªä½çš„æ—¶é—´ã€‚ æ•…éšœç•Œå®šï¼ˆFault Confinementï¼‰ CAN ç»“ç‚¹èƒ½å¤ŸæŠŠæ°¸ä¹…æ•…éšœå’ŒçŸ­æš‚æ‰°åŠ¨åŒºåˆ†å¼€æ¥ã€‚æ°¸ä¹…æ•…éšœçš„ç»“ç‚¹ä¼šè¢«å…³é—­ã€‚ è¿æ¥ï¼ˆConnectionsï¼‰ CAN ä¸²è¡Œé€šè®¯é“¾è·¯æ˜¯å¯ä»¥è¿æ¥è®¸å¤šç»“ç‚¹çš„æ€»çº¿ã€‚ç†è®ºä¸Šï¼Œå¯è¿æ¥æ— æ•°å¤šçš„ç»“ç‚¹ã€‚ä½†ç”±äºå®é™…ä¸Šå—å»¶è¿Ÿæ—¶é—´æˆ–è€…æ€»çº¿çº¿è·¯ä¸Šç”µæ°”è´Ÿè½½çš„å½±å“ï¼Œè¿æ¥ç»“ç‚¹çš„æ•°é‡æ˜¯æœ‰é™çš„ã€‚ å•é€šé“ï¼ˆSingle Channelï¼‰ æ€»çº¿æ˜¯ç”±å•ä¸€è¿›è¡ŒåŒå‘ä½ä¿¡å·ä¼ é€çš„é€šé“ç»„æˆã€‚ æ€»çº¿å€¼ï¼ˆBus valueï¼‰ æ€»çº¿å¯ä»¥å…·æœ‰ä¸¤ç§äº’è¡¥çš„é€»è¾‘å€¼ä¹‹ä¸€ï¼šâ€æ˜¾æ€§â€ï¼ˆå¯è¡¨ç¤ºä¸ºé€»è¾‘ 0ï¼‰æˆ–â€éšæ€§â€ï¼ˆå¯è¡¨ç¤ºä¸ºé€»è¾‘ 1ï¼‰ã€‚ åº”ç­”ï¼ˆAcknowledgmentï¼‰ æ‰€æœ‰çš„æ¥æ”¶å™¨æ£€æŸ¥æŠ¥æ–‡çš„è¿è´¯æ€§ã€‚å¯¹äºè¿è´¯çš„æŠ¥æ–‡ï¼Œæ¥æ”¶å™¨åº”ç­”ï¼›å¯¹äºä¸è¿è´¯çš„æŠ¥æ–‡ï¼Œæ¥æ”¶å™¨ä½œå‡ºæ ‡å¿—ã€‚ ç¡çœ æ¨¡å¼ï¼å”¤é†’ï¼ˆSleep Mode Wake-upï¼‰ ä¸ºäº†å‡å°‘ç³»ç»Ÿç”µæºçš„åŠŸç‡æ¶ˆè€—ï¼Œå¯ä»¥å°† CAN å™¨ä»¶è®¾ä¸ºç¡çœ æ¨¡å¼ä»¥ä¾¿åœæ­¢å†…éƒ¨æ´»åŠ¨åŠæ–­å¼€ä¸æ€»çº¿é©±åŠ¨å™¨çš„è¿æ¥ã€‚CAN å™¨ä»¶å¯ç”±æ€»çº¿æ¿€æ´»ï¼Œæˆ–ç³»ç»Ÿå†…éƒ¨çŠ¶æ€è€Œè¢«å”¤é†’ã€‚ å·¥ä½œåŸç†å½“ CAN æ€»çº¿ä¸Šçš„èŠ‚ç‚¹å‘é€æ•°æ®æ—¶ï¼Œä»¥æŠ¥æ–‡å½¢å¼å¹¿æ’­ç»™ç½‘ç»œä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ€»çº¿ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸ä½¿ç”¨èŠ‚ç‚¹åœ°å€ç­‰ç³»ç»Ÿé…ç½®ä¿¡æ¯ï¼Œåªæ ¹æ®æ¯ç»„æŠ¥æ–‡å¼€å¤´çš„ 11 ä½æ ‡è¯†ç¬¦è§£é‡Šæ•°æ®çš„å«ä¹‰æ¥å†³å®šæ˜¯å¦æ¥æ”¶ã€‚è¿™ç§æ•°æ®æ”¶å‘æ–¹å¼ç§°ä¸ºé¢å‘å†…å®¹çš„ç¼–å€æ–¹æ¡ˆã€‚ å½“æŸä¸ªèŠ‚ç‚¹è¦å‘å…¶ä»–èŠ‚ç‚¹å‘é€æ•°æ®æ—¶ï¼Œè¿™ä¸ªèŠ‚ç‚¹çš„å¤„ç†å™¨å°†è¦å‘é€çš„æ•°æ®å’Œè‡ªå·±çš„æ ‡è¯†ç¬¦ä¼ é€ç»™è¯¥èŠ‚ç‚¹çš„ CAN æ€»çº¿æ¥å£æ§åˆ¶å™¨ï¼Œå¹¶å¤„äºå‡†å¤‡çŠ¶æ€ï¼›å½“æ”¶åˆ°æ€»çº¿åˆ†é…æ—¶ï¼Œè½¬ä¸ºå‘é€æŠ¥æ–‡çŠ¶æ€ã€‚æ•°æ®æ ¹æ®åè®®ç»„ç»‡æˆä¸€å®šçš„æŠ¥æ–‡æ ¼å¼åå‘å‡ºï¼Œæ­¤æ—¶ç½‘ç»œä¸Šçš„å…¶ä»–èŠ‚ç‚¹å¤„äºæ¥æ”¶çŠ¶æ€ã€‚å¤„äºæ¥æ”¶çŠ¶æ€çš„æ¯ä¸ªèŠ‚ç‚¹å¯¹æ¥æ”¶åˆ°çš„æŠ¥æ–‡è¿›è¡Œæ£€æµ‹ï¼Œåˆ¤æ–­è¿™äº›æŠ¥æ–‡æ˜¯å¦æ˜¯å‘ç»™è‡ªå·±çš„ä»¥ç¡®å®šæ˜¯å¦æ¥æ”¶ã€‚ å±‚æ¬¡ç»“æ„CAN è¢«ç»†åˆ†ä¸ºä¸‰ä¸ªå±‚æ¬¡ï¼Œå…¶ä¸­çš„å¯¹è±¡å±‚å’Œä¼ è¾“å±‚åŒ…æ‹¬æ‰€æœ‰ç”± ISOOSI æ¨¡å‹å®šä¹‰çš„æ•°æ®é“¾è·¯å±‚çš„æœåŠ¡å’ŒåŠŸèƒ½ã€‚ å¯¹è±¡å±‚ï¼ˆthe object layerï¼‰çš„ä½œç”¨èŒƒå›´åŒ…æ‹¬ï¼š æŸ¥æ‰¾è¢«å‘é€çš„æŠ¥æ–‡ã€‚ ç¡®å®šç”±å®é™…è¦ä½¿ç”¨çš„ä¼ è¾“å±‚æ¥æ”¶å“ªä¸€ä¸ªæŠ¥æ–‡ã€‚ ä¸ºåº”ç”¨å±‚ç›¸å…³ç¡¬ä»¶æä¾›æ¥å£ã€‚ ä¼ è¾“å±‚ï¼ˆthe transfer layerï¼‰çš„ä½œç”¨ä¸»è¦ï¼š ä¼ é€è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯æ§åˆ¶å¸§ç»“æ„ã€æ‰§è¡Œä»²è£ã€é”™è¯¯æ£€æµ‹ã€å‡ºé”™æ ‡å®šã€æ•…éšœç•Œå®šã€‚ æ€»çº¿ä¸Šä»€ä¹ˆæ—¶å€™å¼€å§‹å‘é€æ–°æŠ¥æ–‡åŠä»€ä¹ˆæ—¶å€™å¼€å§‹æ¥æ”¶æŠ¥æ–‡ï¼Œåœ¨ä¼ è¾“å±‚é‡Œç¡®å®šã€‚ ä½å®šæ—¶çš„ä¸€äº›æ™®é€šåŠŸèƒ½ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ä¼ è¾“å±‚çš„ä¸€éƒ¨åˆ†ã€‚ ä¼ è¾“å±‚çš„ä¿®æ”¹æ˜¯å—åˆ°é™åˆ¶çš„ã€‚ ç‰©ç†å±‚ï¼ˆthe phyical layerï¼‰çš„ä½œç”¨ï¼š åœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´æ ¹æ®æ‰€æœ‰çš„ç”µæ°”å±æ€§è¿›è¡Œä½ä¿¡æ¯çš„å®é™…ä¼ è¾“ã€‚å½“ç„¶ï¼ŒåŒä¸€ç½‘ç»œå†…ï¼Œç‰©ç†å±‚å¯¹äºæ‰€æœ‰çš„èŠ‚ç‚¹å¿…é¡»æ˜¯ç›¸åŒçš„ã€‚ ç¼–ç¨‹åœ¨å¯¹è±¡å±‚è¿›è¡Œï¼Œè¿™ä¸€å±‚ç›´æ¥ä¸åº”ç”¨å±‚äº¤äº’ï¼Œå¹¶ä¸”æä¾›äº†ç®¡ç†å’Œå¤„ç† CAN æ¶ˆæ¯çš„æ¥å£ã€‚é€šè¿‡å¯¹è±¡å±‚ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å‘é€å’Œæ¥æ”¶ CAN çš„æ‰“åŒ…æ¶ˆæ¯ã€‚æ‰“åŒ…çš„è¿‡ç¨‹å°±æ˜¯åœ¨åŸå§‹æ•°æ®çš„åŸºç¡€ä¸Šå†åŠ ä¸Šå¸§èµ·å§‹æ®µã€ä»²è£æ®µã€æ§åˆ¶æ®µã€CRC æ ¡éªŒã€åº”ç­”å’Œå¸§ç»“æŸï¼ŒæŠŠè¿™äº›å†…å®¹æŒ‰ç‰¹å®šçš„æ ¼å¼æ‰“åŒ…å¥½ï¼Œå°±å¯ä»¥ç”¨ä¸€ä¸ªé€šé“è¡¨è¾¾å„ç§ä¿¡å·äº†ï¼Œå½“æ•°æ®åŒ…è¢«å‘é€æ—¶ï¼Œåªè¦æ¥æ”¶æ–¹æŒ‰çº¦å®šæ ¼å¼å»è§£è¯»ï¼Œå°±èƒ½è¿˜åŸå‡ºåŸå§‹æ•°æ®ã€‚ ä¼ è¾“å±‚çš„åŠŸèƒ½ä¸»è¦ç”± CAN æ§åˆ¶å™¨ç¡¬ä»¶å’Œé©±åŠ¨ç¨‹åºå®ç°ã€‚é€šå¸¸ï¼Œç¨‹åºå‘˜ä¸ç›´æ¥æ“ä½œä¼ è¾“å±‚ï¼Œè€Œæ˜¯é€šè¿‡å¯¹è±¡å±‚çš„ API é—´æ¥åˆ©ç”¨ä¼ è¾“å±‚çš„åŠŸèƒ½ã€‚ä¼ è¾“å±‚è´Ÿè´£å¤„ç† CAN åè®®çš„ä½çº§ç»†èŠ‚ï¼Œå¦‚ä½çº§ä¼ è¾“ã€é”™è¯¯å¤„ç†å’Œä»²è£ã€‚ ä½å¡«å……æ˜¯ä¸ºäº†é˜²æ­¢çªå‘é”™è¯¯è€Œè®¾å®šçš„åŠŸèƒ½ã€‚ä½å¡«å……çš„è§„åˆ™å¦‚ä¸‹ï¼š 5 ä½è¿ç»­ç›¸åŒç”µå¹³ä¹‹åï¼Œå¿…é¡»å¡«å……ä¸€ä½åå‘ä½ï¼Œå³ä¸å…è®¸æœ‰ 6 ä¸ªè¿ç»­ç›¸åŒä½ï¼› SOF ä¹‹å‰ä¸ºæ€»çº¿ç©ºé—²çŠ¶æ€ï¼Œä¸éœ€è¦åŒæ­¥ï¼Œå› æ­¤ä¸éœ€è¦ä½å¡«å……ï¼› CRC ä¹‹åä¸ºå›ºå®šæ ¼å¼ï¼Œä¸å…è®¸å¡«å……ï¼› ç”± CAN æ§åˆ¶å™¨è‡ªåŠ¨å®ç°ï¼› ç‰©ç†å±‚é€šå¸¸ç”± CAN æ”¶å‘å™¨ç¡¬ä»¶å’Œç›¸å…³ç”µæ°”æ¥å£ç»„æˆã€‚ ä»²è£æ–¹å¼åœ¨æ€»çº¿ç©ºé—²æ€ï¼Œæœ€å…ˆå¼€å§‹å‘é€æ¶ˆæ¯çš„å•å…ƒè·å¾—å‘é€æƒã€‚å¤šä¸ªå•å…ƒåŒæ—¶å¼€å§‹å‘é€æ—¶ï¼Œå„å‘é€å•å…ƒä»ä»²è£æ®µçš„ç¬¬ä¸€ä½å¼€å§‹è¿›è¡Œä»²è£ã€‚è¿ç»­è¾“å‡ºæ˜¾æ€§ç”µå¹³æœ€å¤šçš„å•å…ƒç»§ç»­å‘é€ã€‚å³é€ä½åœ°å¯¹æ¯” å„ä¸ªç»“ç‚¹å‘å‡ºçš„æŠ¥æ–‡ IDã€‚ ç”±äºçº¿ä¸çš„å…³ç³»ï¼Œæ˜¾ç¤ºä½â€0â€å¯ä»¥è¦†ç›–éšæ€§ä½â€1â€ï¼Œå› æ­¤ ID æœ€å°çš„èŠ‚ç‚¹èµ¢å¾—ä»²è£ï¼Œæ€»çº¿ä¸Šè¡¨ç°ä¸ºè¯¥ç»“ç‚¹çš„æŠ¥æ–‡ï¼Œå…¶ä»–ç»“ç‚¹å¤±å»ä»²è£ï¼Œé€€å‡ºå‘é€ï¼Œè½¬ä¸ºæ¥æ”¶çŠ¶æ€ã€‚ æ ‡å‡†æ ¼å¼ ID ä¸å…·æœ‰ç›¸åŒ ID çš„è¿œç¨‹å¸§æˆ–è€…æ‰©å±•æ ¼å¼çš„æ•°æ®å¸§åœ¨æ€»çº¿ä¸Šç«äº‰æ—¶ï¼Œæ ‡å‡†æ ¼å¼çš„ RTR ä½ä¸ºæ˜¾æ€§ä½çš„å…·æœ‰ä¼˜å…ˆæƒï¼Œå¯ç»§ç»­å‘é€ã€‚ ä½æ—¶åºCAN åè®®çš„é€šä¿¡æ–¹æ³•ä½ NRZ(non-return to zero)æ–¹å¼ã€‚å„ä¸ªä½çš„å¼€å¤´æˆ–ç»“å°¾éƒ½æ²¡æœ‰é™„åŠ åŒæ­¥ä¿¡å·ã€‚ å‘é€å•å…ƒä»¥ä¸ä½æ—¶åºåŒæ­¥çš„æ–¹å¼å¼€å§‹å‘é€æ•°æ®ã€‚ æ¥æ”¶å•å…ƒæ ¹æ®æ€»çº¿ä¸Šç”µå¹³çš„å˜åŒ–è¿›è¡ŒåŒæ­¥å¹¶è¿›è¡Œæ¥æ”¶å·¥ä½œã€‚ ç”±å‘é€å•å…ƒåœ¨éåŒæ­¥çš„æƒ…å†µä¸‹å‘é€çš„æ¯ç§’é’Ÿçš„ä½æ•°ç§°ä¸ºä½é€Ÿç‡ã€‚ä¸€ä¸ªä½å¯åˆ†ä¸º 4 æ®µã€‚ åŒæ­¥æ®µï¼ˆSSï¼‰ ä¼ æ’­æ—¶é—´æ®µï¼ˆPTSï¼‰ ç›¸ä½ç¼“å†²æ®µ 1ï¼ˆPBS1ï¼‰ ç›¸ä½ç¼“å†²æ®µ 2ï¼ˆPBS2ï¼‰ è¿™äº›æ®µåˆç”±å¯ç§°ä¸º Time Quantumï¼ˆä»¥ä¸‹ç§°ä¸º Tqï¼‰çš„æœ€å°æ—¶é—´å•ä½æ„æˆã€‚ 1 ä½åˆ†ä¸º 4 ä¸ªæ®µï¼Œæ¯ä¸ªæ®µåˆç”±è‹¥å¹²ä¸ª Tq æ„æˆï¼Œè¿™ç§°ä¸ºä½æ—¶åºã€‚ 1 ä½ç”±å¤šå°‘ä¸ª Tq æ„æˆã€æ¯ä¸ªæ®µåˆç”±å¤šå°‘ä¸ª Tq æ„æˆç­‰ï¼Œå¯ä»¥ä»»æ„è®¾å®šä½æ—¶åºã€‚é€šè¿‡è®¾å®šä½æ—¶åºï¼Œå¤šä¸ªå•å…ƒå¯åŒæ—¶é‡‡æ ·ï¼Œä¹Ÿå¯ä»»æ„è®¾å®šé‡‡æ ·ç‚¹ã€‚ é‡‡æ ·ç‚¹ï¼šæ˜¯è¯»å–æ€»çº¿ç”µå¹³ï¼Œå¹¶å°†è¯»åˆ°çš„ç”µå¹³ä½œä¸ºä½å€¼çš„ç‚¹ï¼Œä½ç½®åœ¨ PBS1 ç»“æŸå¤„ã€‚ è®¾ç½®ä½æ—¶åºå’Œè®¡ç®—ä½é€Ÿç‡ip link set can0 type cantq 125 prop-seg 6 phase-seg1 7 phase-seg2 2 sjw 1 åŒæ­¥æ®µï¼ˆSync Segmentï¼‰: å›ºå®šä¸º 1 TQï¼Œç”¨äºåŒæ­¥ä½å®šæ—¶å™¨ã€‚ ä¼ æ’­æ—¶é—´æ®µï¼ˆPropagation Segment, prop-segï¼‰: ç”¨äºè¡¥å¿ä¿¡å·åœ¨æ€»çº¿ä¸Šä¼ æ’­çš„æ—¶é—´å»¶è¿Ÿ ç›¸ä½ç¼“å†²æ®µ 1ï¼ˆPhase Buffer Segment 1, phase-seg1ï¼‰: ç”¨äºæé«˜æŠ—å¹²æ‰°èƒ½åŠ›ï¼Œå…è®¸æ—¶é—´è°ƒæ•´ã€‚ ç›¸ä½ç¼“å†²æ®µ 2ï¼ˆPhase Buffer Segment 2, phase-seg2ï¼‰: ä¹Ÿç”¨äºæé«˜æŠ—å¹²æ‰°èƒ½åŠ›ï¼Œå…è®¸æ—¶é—´è°ƒæ•´ã€‚ ip link set can0 type can: è®¾ç½®åä¸º can0 çš„ç½‘ç»œæ¥å£çš„ç±»å‹ä¸º CANã€‚ tq 125: è®¾ç½®æ—¶é—´é‡åŒ–ï¼ˆTime Quantumï¼ŒTQï¼‰ä¸º 125 nsã€‚TQ æ˜¯ CAN æ§åˆ¶å™¨å†…éƒ¨çš„åŸºæœ¬æ—¶é—´å•ä½ï¼Œç”¨äºåˆ’åˆ†æ•´ä¸ªä½æ—¶é—´ã€‚ prop-seg 6: è®¾ç½®ä¼ æ’­æ—¶é—´æ®µï¼ˆPropagation Segmentï¼‰ä¸º 6 TQã€‚ä¼ æ’­æ—¶é—´æ®µç”¨äºè¡¥å¿ä¿¡å·åœ¨ CAN æ€»çº¿ä¸Šä¼ æ’­çš„å»¶è¿Ÿã€‚ä¸º 6 ä¸ªæ—¶é—´é‡åŒ–ï¼Œ6 * 125 ns 750 nsã€‚ phase-seg1 7: è®¾ç½®ç›¸ä½ç¼“å†²æ®µ 1ï¼ˆPhase Buffer Segment 1ï¼‰ä¸º 7 TQã€‚è¿™ä¸ªæ—¶é—´æ®µç”¨äºè°ƒæ•´è¾¹æ²¿ç›¸ä½ï¼Œé€šå¸¸åŒ…æ‹¬é‡‡æ ·ç‚¹ä¹‹å‰çš„æ—¶é—´ã€‚ä¸º 7 ä¸ªæ—¶é—´é‡åŒ–ï¼Œ875 nsã€‚ phase-seg2 2: è®¾ç½®ç›¸ä½ç¼“å†²æ®µ 2ï¼ˆPhase Buffer Segment 2ï¼‰ä¸º 2 TQã€‚è¿™ä¸ªæ—¶é—´æ®µç”¨äºè°ƒæ•´è¾¹æ²¿ç›¸ä½ï¼Œé€šå¸¸åŒ…æ‹¬é‡‡æ ·ç‚¹ä¹‹åçš„æ—¶é—´ã€‚ä¸º 2 ä¸ªæ—¶é—´é‡åŒ–ï¼Œ250 nsã€‚ sjw 1: è®¾ç½®åŒæ­¥è·³è·ƒå®½åº¦ï¼ˆSynchronization Jump Widthï¼ŒSJWï¼‰ä¸º 1 TQã€‚SJW ç”¨äºé‡æ–°åŒæ­¥æ—¶å¯ä»¥è·³è·ƒçš„æœ€å¤§æ—¶é—´é‡ã€‚ä¸º 1 ä¸ªæ—¶é—´é‡åŒ–ï¼Œ1 * 125 ns 125 nsã€‚ è®¡ç®—ä½æ—¶é—´å’Œä½é€Ÿç‡ æ€»ä½æ—¶é—´æ˜¯æ‰€æœ‰æ®µçš„æ—¶é—´æ€»å’Œï¼š Sync Segment: 1 TQ Propagation Segment: 6 TQ Phase Buffer Segment 1: 7 TQ Phase Buffer Segment 2: 2 TQ æ€»æ—¶é—´é‡åŒ–æ•° 1 + 6 + 7 + 2 16 TQ æ€»ä½æ—¶é—´ 16 * 125 ns 2000 ns 2 Î¼s ä½é€Ÿç‡ï¼ˆBit Rateï¼‰ 1 æ€»ä½æ—¶é—´ 1 2 Î¼s 500 kbps åŒæ­¥æ–¹å¼ç¡¬ä»¶åŒæ­¥æ¥æ”¶å•å…ƒåœ¨æ€»çº¿ç©ºé—²çŠ¶æ€æ£€æµ‹å‡ºå¸§èµ·å§‹æ—¶è¿›è¡Œçš„åŒæ­¥è°ƒæ•´ã€‚ åœ¨æ£€æµ‹å‡ºè¾¹æ²¿çš„åœ°æ–¹ä¸è€ƒè™‘ SJW çš„å€¼è€Œè®¤ä¸ºæ˜¯ SS æ®µ åœ¨åŒæ­¥åœ¨æ¥æ”¶è¿‡ç¨‹ä¸­æ£€æµ‹å‡ºæ€»çº¿ä¸Šçš„ç”µå¹³å˜åŒ–æ—¶è¿›è¡Œå¤§çš„åŒæ­¥è°ƒæ•´ã€‚ å½“æ£€æµ‹å‡ºè¾¹æ²¿æ—¶ï¼Œæ ¹æ® SJW çš„å€¼é€šè¿‡åŠ é•¿ PBS1 æˆ–ç¼©çŸ­ PBS2ï¼ˆé‡‡æ ·ç‚¹ä½ç½®åœ¨ PBS1 ç»“æŸå¤„ï¼‰ï¼Œä»¥è°ƒæ•´åŒæ­¥ï¼Œæœ€å¤§è°ƒæ•´é‡ä¸è¶…è¿‡ SJW çš„å€¼ã€‚ è¾¹æ²¿å‡ºç°åœ¨ PTS å’Œ PBS1 ä¹‹é—´æ—¶ï¼Œé€šè¿‡åŠ é•¿ PBS1 è¾¹æ²¿å‡ºç°åœ¨ PBS2 æ—¶ï¼Œé€šè¿‡ç¼©çŸ­ PBS2 ä½å¡«å……ä½å¡«å……æ—¶ä¸ºé˜²æ­¢çªå‘é”™è¯¯è€Œè®¾å®šçš„åŠŸèƒ½ã€‚åœ¨åŒæ ·çš„ç”µå¹³æŒç»­ 5 ä½æ—¶æ·»åŠ ä¸€ä¸ªä½çš„åå‹æ•°æ®ã€‚ å‘é€å•å…ƒ å‘é€æ•°æ®å¸§å’Œé¥æ§å¸§æ—¶ï¼ŒSOF~CRC æ®µçš„æ•°æ®ï¼Œç›¸åŒç”µå¹³æŒç»­ 5bitsï¼Œä¸‹ä¸€ä½æ’å…¥åå‹æ•°æ®ã€‚ æ¥æ”¶å•å…ƒ æ¥æ”¶æ•°æ®å¸§å’Œé¥æ§å¸§æ—¶ï¼ŒSOF~CRC æ®µçš„æ•°æ®ï¼Œç›¸åŒç”µå¹³æŒç»­ 5bitsï¼Œéœ€è¦åˆ é™¤ä¸‹ä¸€ä¸ªä½å†æ¥æ”¶ã€‚å¦‚æœæ•°æ®ä»ç„¶å’Œå‰ 5bits ç›¸åŒï¼Œåˆ™è¢«è§†ä¸ºé”™è¯¯å¹¶å‘é€é”™è¯¯å¸§ã€‚ æ•°æ®å¸§å¸§ç±»å‹ä¸ºäº†æ›´æœ‰æ•ˆåœ°æ§åˆ¶é€šè®¯ï¼ŒCAN ä¸€å…±è§„å®šäº† 5 ç§ç±»å‹çš„å¸§ æ•°æ®å¸§ï¼šå‘é€å•å…ƒå‘æ¥æ”¶å•å…ƒä¼ é€æ•°æ®çš„å¸§ã€‚ è¿œç¨‹å¸§ï¼šæ¥æ”¶å•å…ƒå‘å‘é€å•å…ƒè¯·æ±‚æ•°æ®çš„å¸§ã€‚ é”™è¯¯å¸§ï¼šæ£€æµ‹å‡ºé”™è¯¯æ—¶å‘å…¶å®ƒå•å…ƒé€šçŸ¥é”™è¯¯çš„å¸§ã€‚ è¿‡è½½å¸§ï¼šæ¥æ”¶å•å…ƒé€šçŸ¥å…¶å°šæœªå°±ç»ªçš„å¸§ã€‚ é—´éš”å¸§ï¼šå°†æ•°æ®å¸§åŠé¥æ§å¸§ä¸å‰é¢çš„å¸§åˆ†ç¦»å¼€æ¥çš„å¸§ã€‚ CAN å¸§å®šä¹‰æ•°æ®å¸§ç”±å¸§èµ·å§‹ã€ä»²è£æ®µã€æ§åˆ¶æ®µã€æ•°æ®æ®µã€CRCã€ACKã€å¸§ç»“æŸå…± 7 ä¸ªæ®µæ„æˆã€‚æ•°æ®å¸§å’Œé¥æ§å¸§æœ‰æ ‡å‡†å¸§å’Œæ‰©å±•å¸§ä¸¤ç§å¸§ï¼Œæ ‡å‡†å¸§æœ‰ 11 ä¸ªä½çš„æ ‡è¯†ç¬¦ IDï¼Œæ‰©å±•å¸§æœ‰ 29 ä¸ªä½çš„ IDã€‚ å¸§èµ·å§‹ (Start Of Frame,SOF)ï¼Œ1bit è¡¨ç¤ºå¸§å¼€å§‹çš„æ®µï¼Œè®¾ç½®ä¸º 0ã€‚ ä»²è£æ®µï¼ˆIdentifierï¼ŒIDï¼‰ï¼Œ11bits29bits è¡¨ç¤ºæ•°æ®å¸§ä¼˜å…ˆçº§çš„æ®µ æ ‡å‡†å¸§ä¸æ‰©å±•å¸§çš„æ„æˆæœ‰æ‰€ä¸åŒï¼Œå‡ç¦æ­¢é«˜ 7 ä½ä¸ºéšæ€§ (ID1111111XXXXâ€¦) ä»²è£æ®µçš„å†…å®¹ä¸»è¦ä¸ºæœ¬æ•°æ®å¸§çš„ IDï¼Œæ ‡å‡†å¸§çš„ ID æœ‰ 11 ä¸ªä½ï¼Œæ‰©å±•å¸§çš„ ID æœ‰ 29 ä¸ªä½ï¼Œåœ¨ CAN åè®®ä¸­ï¼ŒID å†³å®šç€æ•°æ®å¸§å‘é€çš„ä¼˜å…ˆçº§ï¼Œä¹Ÿå†³å®šç€å…¶å®ƒèŠ‚ç‚¹æ˜¯å¦ä¼šæ¥æ”¶è¿™ä¸ªæ•°æ®å¸§ã€‚CAN æ€»çº¿ä¸å¯¹æŒ‚è½½åœ¨å®ƒä¹‹ä¸Šçš„èŠ‚ç‚¹åˆ†é…ä¼˜å…ˆçº§å’Œåœ°å€ï¼Œå¯¹æ€»çº¿çš„å æœ‰æƒæ˜¯ç”±ä¿¡æ¯çš„ ID å†³å®šçš„ï¼Œå³å¯¹äºé‡è¦çš„ä¿¡æ¯ï¼Œä¼˜å…ˆçº§é«˜çš„ IDï¼Œèƒ½å¤Ÿä¼˜å…ˆå‘é€å‡ºå» RTR ä½ (Remote Transmission Request Bit) è¿œç¨‹ä¼ è¾“è¯·æ±‚ä½ï¼Œç”¨äºåŒºåˆ†æ•°æ®å¸§å’Œé¥æ§å¸§çš„ï¼Œä¸º 0 è¡¨ç¤ºæ•°æ®å¸§ï¼Œ1 è¡¨ç¤ºé¥æ§å¸§ã€‚ æ§åˆ¶æ®µ æ§åˆ¶æ®µç”± 6 ä¸ªä½æ„æˆï¼Œè¡¨ç¤ºæ•°æ®æ®µçš„å­—èŠ‚æ•° IDE ä½ (Identifier Extension Bit) æ ‡è¯†ç¬¦æ‰©å±•ä½ï¼Œç”¨äºåŒºåˆ†æ ‡å‡†å¸§ä¸æ‰©å±•å¸§ï¼Œä¸º 0 è¡¨ç¤ºæ ‡å‡†å¸§ï¼Œ1 è¡¨ç¤ºæ‰©å±•å¸§ SRR ä½ (Substitute Remote Request Bit) åªå­˜åœ¨äºæ‰©å±•å¸§ï¼Œå®ƒç”¨äºæ›¿ä»£æ ‡å‡†å¸§ä¸­çš„ RTR ä½ï¼Œæ‰©å±•å¸§ä¸­çš„ SRR ä½å›ºå®šä¸º 1ï¼ŒRTR åœ¨æ•°æ®å¸§ä¸­ä¸º 0ï¼Œæ‰€ä»¥ä¸¤ä¸ª ID ç›¸åŒçš„æ ‡å‡†å¸§ä¸æ‰©å±•å¸§ï¼Œæ ‡å‡†å¸§çš„ä¼˜å…ˆçº§è¾ƒé«˜ DLC æ•°æ®é•¿åº¦ç ï¼ˆData Length Codeï¼‰ æ•°æ®çš„å­—èŠ‚æ•°å¿…é¡»ä¸º 0ï½8 å­—èŠ‚ æ•°æ®æ®µï¼ˆData Fieldï¼‰ æ•°æ®æ®µå¯åŒ…å« 0ï½8 ä¸ªå­—èŠ‚çš„æ•°æ® CRC æ®µ CRC æ®µæ˜¯æ£€æŸ¥å¸§ä¼ è¾“é”™è¯¯çš„æ®µï¼Œç”± 15 ä¸ªä½çš„ CRC å€¼å’Œ 1 ä¸ªä½çš„ CRC ç•Œå®šç¬¦ (éšæ€§åˆ†éš”ä½) æ„æˆ CRC æ˜¯æ ¹æ®å¤šé¡¹å¼ç”Ÿæˆçš„ CRC å€¼ï¼ŒCRC çš„è®¡ç®—èŒƒå›´åŒ…æ‹¬å¸§èµ·å§‹ã€ä»²è£æ®µã€æ§åˆ¶æ®µã€æ•°æ®æ®µ æ¥æ”¶æ–¹ä»¥åŒæ ·çš„æ–¹å¼è®¡ç®— CRC å€¼å¹¶è¿›è¡Œæ¯”è¾ƒï¼Œä¸ä¸€è‡´æ—¶åˆ©ç”¨é”™è¯¯å¸§è¯·æ±‚é‡æ–°å‘é€ ACK æ®µ ACK æ®µåŒ…æ‹¬ ACK æ§½ä½ã€ACK ç•Œå®šç¬¦ä½ 2 ä¸ªä½ å‘é€å•å…ƒçš„ ACK æ®µï¼šå‘é€å•å…ƒåœ¨ ACK æ®µå‘é€ 2 ä¸ªä½çš„éšæ€§ä½ æ¥æ”¶å•å…ƒçš„ ACK æ®µï¼šæ¥æ”¶åˆ°æ­£ç¡®æ¶ˆæ¯çš„å•å…ƒåœ¨ ACK æ§½å‘é€æ˜¾æ€§ä½ï¼Œé€šçŸ¥å‘é€å•å…ƒæ­£å¸¸æ¥æ”¶ç»“æŸï¼Œè¿™ç§°ä½œâ€å‘é€ ACKâ€æˆ–è€…â€è¿”å› ACKâ€ å¸§ç»“æŸ (End Of Frameï¼ŒEOF) å¸§ç»“æŸæ˜¯è¡¨ç¤ºè¯¥å¸§ç»“æŸçš„æ®µï¼Œç”±å‘é€èŠ‚ç‚¹å‘é€ 7 ä¸ªä½çš„éšæ€§ä½æ„æˆ CAN æ•°æ®å¸§çš„ç»“æŸç¬¦é•¿åº¦å¹¶ä¸æ˜¯å®Œå…¨ä¸å®šçš„ï¼Œè€Œæ˜¯æ ¹æ®æ•°æ®ä½é€Ÿç‡ï¼ˆData Bit Rateï¼ŒDBRï¼‰è€Œå®šã€‚CAN æ€»çº¿åè®®è§„å®šï¼Œå¯¹äºæ•°æ®ä½é€Ÿç‡ä½äºç­‰äº 125kbps çš„ç½‘ç»œï¼ŒCAN æ•°æ®å¸§çš„ç»“æŸç¬¦é•¿åº¦ä¸º 7 ä¸ªä½ï¼›å¯¹äºæ•°æ®ä½é€Ÿç‡å¤§äº 125kbps çš„ç½‘ç»œï¼ŒCAN æ•°æ®å¸§çš„ç»“æŸç¬¦é•¿åº¦ä¸º 3 ä¸ªä½ã€‚è¿™æ˜¯å› ä¸ºåœ¨é«˜é€Ÿç½‘ç»œä¸­ï¼Œç”±äºæ•°æ®ä¼ è¾“é€Ÿç‡æ›´å¿«ï¼Œæ‰€ä»¥ CAN æ§åˆ¶å™¨å¯ä»¥æ›´å¿«åœ°æ£€æµ‹åˆ°ç»“æŸä½ï¼Œå› æ­¤å¯ä»¥å‡å°‘ç»“æŸç¬¦çš„é•¿åº¦ï¼Œä»è€Œæé«˜ç½‘ç»œçš„ä¼ è¾“æ•ˆç‡ã€‚è€Œåœ¨ä½é€Ÿç½‘ç»œä¸­ï¼Œç”±äºæ•°æ®ä¼ è¾“é€Ÿç‡è¾ƒæ…¢ï¼Œæ‰€ä»¥ CAN æ§åˆ¶å™¨éœ€è¦æ›´é•¿çš„æ—¶é—´æ¥æ£€æµ‹ç»“æŸä½ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªæ›´é•¿çš„ç»“æŸç¬¦æ¥ç¡®ä¿æ•°æ®å¸§ä¼ è¾“çš„æ­£ç¡®æ€§å’Œå®Œæ•´æ€§ã€‚å› æ­¤ï¼ŒCAN æ•°æ®å¸§çš„ç»“æŸç¬¦é•¿åº¦æ˜¯æ ¹æ®æ•°æ®ä½é€Ÿç‡è€Œå®šçš„ï¼Œå¹¶ä¸æ˜¯å®Œå…¨ä¸å®šçš„ã€‚ Socket CAN å¸§ç»“æ„ä½“ å¸§å¤´ï¼Œcanid_t å®šä¹‰äº†ä¸€ä¸ªæ— ç¬¦å·çš„ 32 ä½æ•´å½¢æ•°ï¼ŒæŒ‰ä½ç¡®å®šåŠŸèƒ½ 0-28 ä½ä¸ºæ ‡è¯†ç¬¦ï¼Œå¦‚æœæ˜¯æ‰©å±•å¸§ï¼Œåˆ™é«˜ 11 ä½ä¸ºæ ‡å‡† ID 29 ä½æ ‡è¯†æ˜¯æ•°æ®å¸§è¿˜æ˜¯é”™è¯¯æ¶ˆæ¯ 30 ä½è¯´æ˜æ˜¯å¦æ˜¯è¿œç¨‹å¸§ 31 ä½è¯´æ˜æ˜¯æ ‡å‡†å¸§è¿˜æ˜¯æ‰©å±•å¸§ã€‚ å¸§é•¿ï¼Œ8 ä½æ— ç¬¦å·è¡¨ç¤ºæ•°æ®åŒºé•¿åº¦ æ•°æ®åŒºï¼Œå®šä¹‰ CAN_MAX_DLEN ä¸ª 8 ä½æ— ç¬¦å·æ•°ï¼ŒæŒ‰ç…§æ•°ç»„çš„å½¢å¼ç”³è¯· *__attribute__((aligned(8))) å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå°†å˜é‡ data æ”¾åœ¨ä¸€ä¸ªåœ°å€æ˜¯ 8 çš„å€æ•°çš„å†…å­˜ä½ç½®ä¸Šã€‚ /* CAN payload length and DLC definitions according to ISO 11898-1 */#define CAN_MAX_DLC 8#define CAN_MAX_DLEN 8struct can_frame canid_t can_id; /* 32 bit CAN_ID + EFF/RTR/ERR flags */ __u8 can_dlc; /* frame payload length in byte */ __u8 data[CAN_MAX_DLEN] __attribute__((aligned(8)));;/** Controller Area Network Identifier structure** bit 0-28 : CAN identifier (11/29 bit)* bit 29 : error message frame flag (0 = data frame, 1 = error message)* bit 30 : remote transmission request flag (1 = rtr frame)* bit 31 : frame format flag (0 = standard 11 bit, 1 = extended 29 bit)*/typedef __u32 canid_t;typedef unsigned char __u8; å¸§ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼š /* special address description flags for the CAN_ID */#define CAN_EFF_FLAG\t0x80000000U /* EFF/SFF is set in the MSB */#define CAN_RTR_FLAG\t0x40000000U /* è¿œç¨‹å¸§ */#define CAN_ERR_FLAG\t0x20000000U /* error frame *//* valid bits in CAN ID for frame formats */#define CAN_SFF_MASK\t0x000007FFU /* æ ‡å‡†å¸§ (SFF) */#define CAN_EFF_MASK\t0x1FFFFFFFU /* æ‰©å±•å¸§ (EFF) */#define CAN_ERR_MASK\t0x1FFFFFFFU /* omit EFF, RTR, ERR flags */ å®é™…å¯¹ can_frame å‘é€çš„å¤„ç†æ˜¯åœ¨ mcp251x_hw_tx ä¸­è¿›è¡Œ static void mcp251x_hw_tx(struct spi_device *spi, struct can_frame *frame, int tx_buf_idx)\tstruct mcp251x_priv *priv = spi_get_drvdata(spi);\tu32 sid, eid, exide, rtr;\tu8 buf[SPI_TRANSFER_BUF_LEN];\t//å–can_idçš„31ä½ï¼Œåˆ¤æ–­æ˜¯æ ‡å‡†å¸§è¿˜æ˜¯æ‰©å±•å¸§\texide = (frame-can_id CAN_EFF_FLAG) ? 1 : 0; if (exide)//å¦‚æœæ˜¯æ‰©å±•å¸§ï¼Œcan_idçš„0-28ä½ä¸ºIDï¼Œå…¶ä¸­é«˜11ä½ä¸ºæ ‡å‡†ID sid = (frame-can_id CAN_EFF_MASK) 18;\telse sid = frame-can_id CAN_SFF_MASK; /* Standard ID */\teid = frame-can_id CAN_EFF_MASK; /* Extended ID */\trtr = (frame-can_id CAN_RTR_FLAG) ? 1 : 0; /* æ˜¯å¦æ˜¯è¿œç¨‹å¸§*/\tbuf[TXBCTRL_OFF] = INSTRUCTION_LOAD_TXB(tx_buf_idx); //å‘é€ç¼“å†²å™¨æ§åˆ¶å¯„å­˜å™¨åœ°å€\tbuf[TXBSIDH_OFF] = sid SIDH_SHIFT; //å‘é€ç¼“å†²å™¨æ ‡å‡†IDé«˜8ä½\t//5-7ä½å­˜æ”¾å‘é€ç¼“å†²å™¨ä½3ä½,3ä½å­˜æ”¾å¸§æ ¼å¼ï¼Œ0-1ä½å­˜æ”¾æ‰©å±•æ ‡è¯†ç¬¦ä½18ä½çš„é«˜ä¸¤ä½ï¼ˆ16-17ï¼‰\tbuf[TXBSIDL_OFF] = ((sid SIDL_SID_MASK) SIDL_SID_SHIFT) | (exide SIDL_EXIDE_SHIFT) | ((eid SIDL_EID_SHIFT) SIDL_EID_MASK);\tbuf[TXBEID8_OFF] = GET_BYTE(eid, 1); //å­˜æ”¾æ‰©å±•æ ‡è¯†ç¬¦ä½18ä½çš„8-15ä½\tbuf[TXBEID0_OFF] = GET_BYTE(eid, 0); //æ‰©å±•æ ‡è¯†ç¬¦ä½18ä½çš„ä½8ä½ï¼ˆ0-7ï¼‰\tbuf[TXBDLC_OFF] = (rtr DLC_RTR_SHIFT) | frame-can_dlc; //6ä½å­˜æ”¾è¿œç¨‹å¸§æ ‡è¯†ç¬¦ï¼Œ0-3å­˜æ”¾æ•°æ®é•¿åº¦ç \tmemcpy(buf + TXBDAT_OFF, frame-data, frame-can_dlc);//æ‹·è´è¦å‘é€çš„æ•°æ®\tmcp251x_hw_tx_frame(spi, buf, frame-can_dlc, tx_buf_idx);\t/* use INSTRUCTION_RTS, to avoid repeated frame problem */\tpriv-spi_tx_buf[0] = INSTRUCTION_RTS(1 tx_buf_idx);\tmcp251x_spi_trans(priv-spi, 1); å¸§é•¿åº¦ä½å¡«å…… 3bits Classic CAN Standard Frameæ ‡å‡†å¸§ï¼ˆä¸è€ƒè™‘ä½å¡«å……ï¼‰å…±ï¼š108Bit å¸§èµ·å§‹ï¼ˆ1bitï¼‰ã€ä»²è£æ®µï¼ˆ12bitï¼‰ã€æ§åˆ¶æ®µï¼ˆ6bitï¼‰ã€æ•°æ®æ®µï¼ˆ8Ã—8bitï¼‰ã€å¾ªç¯å†—ä½™ç æ®µï¼ˆ16bitï¼‰ã€åº”ç­”æ®µï¼ˆ2bitï¼‰å’Œå¸§ç»“æŸï¼ˆ7bitï¼‰ Classic CAN Extended Frameæ‰©å±•å¸§ï¼ˆä¸è€ƒè™‘ä½å¡«å……ï¼‰å…±ï¼š128Bit å¸§èµ·å§‹ï¼ˆ1bitï¼‰ã€ä»²è£æ®µï¼ˆ32bitï¼‰ã€æ§åˆ¶æ®µï¼ˆ6bitï¼‰ã€æ•°æ®æ®µï¼ˆ8Ã—8bitï¼‰ã€å¾ªç¯å†—ä½™ç æ®µï¼ˆ16bitï¼‰ã€åº”ç­”æ®µï¼ˆ2bitï¼‰å’Œå¸§ç»“æŸï¼ˆ7bitï¼‰ CANFD Standard Frameæ ‡å‡†å¸§ï¼ˆä¸è€ƒè™‘ä½å¡«å……ï¼›DLC 8ï¼‰å…±ï¼š117Bit å¸§èµ·å§‹ï¼ˆ1bitï¼‰ã€ä»²è£æ®µï¼ˆ12bitï¼‰ã€æ§åˆ¶æ®µï¼ˆ9bitï¼‰ã€æ•°æ®æ®µï¼ˆ8Ã—8bitï¼‰ã€å¾ªç¯å†—ä½™ç æ®µï¼ˆ22bitï¼‰ã€åº”ç­”æ®µï¼ˆ2bitï¼‰å’Œå¸§ç»“æŸï¼ˆ7bitï¼‰ CANFD Standard Frameæ ‡å‡†å¸§ï¼ˆä¸è€ƒè™‘ä½å¡«å……ï¼›DLC 64ï¼‰å…±ï¼š569Bit å¸§èµ·å§‹ï¼ˆ1bitï¼‰ã€ä»²è£æ®µï¼ˆ12bitï¼‰ã€æ§åˆ¶æ®µï¼ˆ9bitï¼‰ã€æ•°æ®æ®µï¼ˆ64Ã—8bitï¼‰ã€å¾ªç¯å†—ä½™ç æ®µï¼ˆ26bitï¼‰ã€åº”ç­”æ®µï¼ˆ2bitï¼‰å’Œå¸§ç»“æŸï¼ˆ7bitï¼‰ CANFD CAN Extended Frameæ‰©å±•å¸§ï¼ˆä¸è€ƒè™‘ä½å¡«å……ï¼›DLC 8ï¼‰å…±ï¼š136Bit å¸§èµ·å§‹ï¼ˆ1bitï¼‰ã€ä»²è£æ®µï¼ˆ32bitï¼‰ã€æ§åˆ¶æ®µï¼ˆ8bitï¼‰ã€æ•°æ®æ®µï¼ˆ8Ã—8bitï¼‰ã€å¾ªç¯å†—ä½™ç æ®µï¼ˆ22bitï¼‰ã€åº”ç­”æ®µï¼ˆ2bitï¼‰å’Œå¸§ç»“æŸï¼ˆ7bitï¼‰ CANFD CAN Extended Frameæ‰©å±•å¸§ï¼ˆä¸è€ƒè™‘ä½å¡«å……ï¼›DLC 64ï¼‰å…±ï¼š588Bit å¸§èµ·å§‹ï¼ˆ1bitï¼‰ã€ä»²è£æ®µï¼ˆ32bitï¼‰ã€æ§åˆ¶æ®µï¼ˆ8bitï¼‰ã€æ•°æ®æ®µï¼ˆ64Ã—8bitï¼‰ã€å¾ªç¯å†—ä½™ç æ®µï¼ˆ26bitï¼‰ã€åº”ç­”æ®µï¼ˆ2bitï¼‰å’Œå¸§ç»“æŸï¼ˆ7bitï¼‰ SocketCAN å®ä¾‹CAN åŠŸèƒ½åˆ†æä¸€ä¸ªæ ‡å‡†çš„ CAN åŠŸèƒ½åŒ…æ‹¬ï¼š CAN æ¥å£å·æŒ‡å®š CAN æ¥å£å· can0 æŒ‡å®š CAN é€šè®¯æ³¢ç‰¹ç‡æˆ– TQï¼Œå•ä½ Kbpsï¼Œé»˜è®¤ä¸º 500 Kbps æŒ‡å®š CAN å‘é€å¸§ ID æŒ‡å®š CAN å‘é€å¸§æ•°æ® éœ€è¦åŒ…å«æ•°æ®çš„å¤§å°ç«¯æ¨¡å¼è½¬æ¢ æŒ‡å®š CAN å¸§å‘é€é—´éš”ï¼Œå•ä½ msï¼Œ é»˜è®¤ä¸º 250ms, æœ€å°å€¼ä¸º 1ms æŒ‡å®š CAN å¸§å‘é€æ¬¡æ•° æŒ‡å®š CAN å‘é€å¸§ä¸ºæ ‡å‡†å¸§æ‰©å±•å¸§ å‘é€æ•°æ®æ—¶é”™è¯¯åˆ¤æ–­ï¼Œæœ¬åœ°ç¯å›åŠŸèƒ½åŸºäº LINUX SOCKET æœºåˆ¶å®ç°çš„ CAN æ¥å£ï¼Œå…¶åŸºæœ¬çš„æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š è®¾ç½®å¥—æ¥å­— socket æŒ‡å®š CAN è®¾å¤‡ ioctl ç»‘å®šå¥—æ¥å­—ä¸è®¾å¤‡ bind è®¾ç½®è¿‡æ»¤è§„åˆ™ setsockopt å‘é€æ¥å—æŠ¥æ–‡ read/write å…³é—­å¥—æ¥å­— close ç¤ºä¾‹ä»£ç #include stdio.h#include stdlib.h#include string.h#include unistd.h#include sys/socket.h#include sys/types.h#include linux/can.h#include linux/can/raw.hint main() int sock; struct sockaddr_can addr; struct ifreq ifr; struct can_frame frames[10]; // ä¸€æ¬¡æœ€å¤šè¯»å–10ä¸ªCANæ•°æ®åŒ… struct msghdr msg; struct iovec iov; char ctrlmsg[CMSG_SPACE(sizeof(struct timeval) + 3 * sizeof(struct timespec) + sizeof(__u32))]; int nbytes; sock = socket(PF_CAN, SOCK_RAW, CAN_RAW); strcpy(ifr.ifr_name, can0); ioctl(sock, SIOCGIFINDEX, amp;ifr); memset(amp;addr, 0, sizeof(addr)); addr.can_family = AF_CAN; addr.can_ifindex = ifr.ifr_ifindex; bind(sock, (struct sockaddr *)amp;addr, sizeof(addr)); memset(amp;msg, 0, sizeof(msg)); memset(amp;iov, 0, sizeof(iov)); iov.iov_base = frames; iov.iov_len = sizeof(frames); msg.msg_name = amp;addr; msg.msg_namelen = sizeof(addr); msg.msg_iov = amp;iov; msg.msg_iovlen = 1; msg.msg_control = amp;ctrlmsg; msg.msg_controllen = sizeof(ctrlmsg); while (1) nbytes = recvmsg(sock, amp;msg, MSG_DONTWAIT); if (nbytes 0) int num_frames = nbytes / sizeof(struct can_frame); printf(Received %d CAN frames: , num_frames); for (int i = 0; i num_frames; i++) printf( ID: 0x%X, DLC: %d, Data: , frames[i].can_id, frames[i].can_dlc); for (int j = 0; j frames[i].can_dlc; j++) printf(%02X , frames[i].data[j]); printf( ); usleep(1000); close(sock); return 0; åˆå§‹åŒ–SocketCAN ä¸­å¤§éƒ¨åˆ†çš„æ•°æ®ç»“æ„å’Œå‡½æ•°åœ¨å¤´æ–‡ä»¶ linuxcan.h ä¸­è¿›è¡Œäº†å®šä¹‰ã€‚ CAN æ€»çº¿å¥—æ¥å­—çš„åˆ›å»ºé‡‡ç”¨æ ‡å‡†çš„ç½‘ç»œå¥—æ¥å­—æ“ä½œæ¥å®Œæˆã€‚ç½‘ç»œå¥—æ¥å­—åœ¨å¤´æ–‡ä»¶ syssocket.h ä¸­å®šä¹‰ã€‚ å¥—æ¥å­—çš„åˆå§‹åŒ–æ–¹æ³•å¦‚ä¸‹ï¼š int s;struct sockaddr_can addr;struct ifreq ifr;s = socket(PF_CAN, SOCK_RAW, CAN_RAW);//åˆ›å»ºSocketCAN å¥—æ¥å­—strcpy(ifr.ifr_name, can0);ioctl(s, SIOCGIFINDEX, ifr);//æŒ‡å®š can0 è®¾å¤‡addr.can_family = AF_CAN;addr.can_ifindex = ifr.ifr_ifindex;bind(s, (structsockaddr *)addr,sizeof(addr)); //å°†å¥—æ¥å­—ä¸ can0 ç»‘å®š å‚æ•°é…ç½®#include stdio.h#include stdlib.h#include string.h#include unistd.h#include fcntl.h#include linux/can.h#include linux/can/raw.h#include linux/can/error.h#include linux/can/netlink.h#include linux/sockios.h#include sys/ioctl.h#include sys/socket.h#include net/if.h#define CAN_INTERFACE can0#define BITRATE 500000#define DBITRATE 4000000int set_bitrate(const char *ifname, int bitrate, int dbitrate) struct ifreq ifr; struct can_bittiming bt; struct can_bittiming dbt; // Open socket int s = socket(PF_INET, SOCK_DGRAM, 0); if (s 0) perror(socket); return -1; // Specify the interface name strncpy(ifr.ifr_name, ifname, IFNAMSIZ); // Bring the interface down if (ioctl(s, SIOCGIFFLAGS, ifr) 0) perror(SIOCGIFFLAGS); close(s); return -1; ifr.ifr_flags = ~IFF_UP; if (ioctl(s, SIOCSIFFLAGS, ifr) 0) perror(SIOCSIFFLAGS); close(s); return -1; // Set bitrate for classical CAN memset(bt, 0, sizeof(bt)); bt.bitrate = bitrate; ifr.ifr_data = (void *)bt; if (ioctl(s, SIOCSCANBT, ifr) 0) perror(SIOCSCANBT); close(s); return -1; // Set data bitrate for CAN FD memset(dbt, 0, sizeof(dbt)); dbt.bitrate = dbitrate; ifr.ifr_data = (void *)dbt; if (ioctl(s, SIOCSCANDBT, ifr) 0) perror(SIOCSCANDBT); close(s); return -1; // Bring the interface up if (ioctl(s, SIOCGIFFLAGS, ifr) 0) perror(SIOCGIFFLAGS); close(s); return -1; ifr.ifr_flags |= IFF_UP; if (ioctl(s, SIOCSIFFLAGS, ifr) 0) perror(SIOCSIFFLAGS); close(s); return -1; // Close socket close(s); return 0;int main() const char *ifname = CAN_INTERFACE; int bitrate = BITRATE; int dbitrate = DBITRATE; if (set_bitrate(ifname, bitrate, dbitrate) 0) fprintf(stderr, Failed to set CAN interface settings ); return 1; printf(CAN interface %s configured with bitrate %d and dbitrate %d , ifname, bitrate, dbitrate); return 0; å‚æ•°æŸ¥çœ‹ip -details -statistics link show can0 canconfig can0 æ•°æ®å‘é€åœ¨æ•°æ®æ”¶å‘çš„å†…å®¹æ–¹é¢ï¼Œ CAN æ€»çº¿ä¸æ ‡å‡†å¥—æ¥å­—é€šä¿¡ç¨æœ‰ä¸åŒï¼Œæ¯ä¸€æ¬¡é€šä¿¡éƒ½é‡‡ç”¨ can_ frame ç»“æ„ä½“å°†æ•°æ®å°è£…æˆå¸§ã€‚ ç»“æ„ä½“å®šä¹‰å¦‚ Socket CAN å¸§ç»“æ„ä½“ æ•°æ®å‘é€ä½¿ç”¨ write å‡½æ•°æ¥å®ç°ã€‚ å¦‚æœå‘é€çš„æ•°æ®å¸§ (æ ‡è¯†ç¬¦ä¸º 0x123) åŒ…å«å•ä¸ªå­—èŠ‚ (0xAB) çš„æ•°æ®ï¼Œå¯é‡‡ç”¨å¦‚ä¸‹æ–¹æ³•è¿›è¡Œå‘é€ï¼š struct sockaddr_can addr;struct can_frame frame;struct ifreq ifr;//å¦‚æœä¸ºæ‰©å±•å¸§ï¼Œé‚£ä¹ˆframe.can_id = CAN_EFF_FLAG | 0x123;frame.can_id = 0x123;frame.can_dlc = 1; //æ•°æ®é•¿åº¦ä¸º 1frame.data[0] = 0xAB; //æ•°æ®å†…å®¹ä¸º 0xABint nbytes = write(s, frame, sizeof(frame));//å‘é€æ•°æ®nbytes = send(s, frame, sizeof(frame), 0);nbytes = sendto(s, frame, sizeof(frame), 0, (struct sockaddr *)addr, sizeof(addr));//sendmsg struct msghdr msg;struct iovec iov;memset(msg, 0, sizeof(msg));msg.msg_name = addr;msg.msg_namelen = sizeof(addr);iov.iov_base = frame;iov.iov_len = sizeof(frame);msg.msg_iov = iov;msg.msg_iovlen = 1;nbytes = sendmsg(s, msg, 0); å¦‚æœè¦å‘é€è¿œç¨‹å¸§ (æ ‡è¯†ç¬¦ä¸º 0x123)ï¼Œå¯é‡‡ç”¨å¦‚ä¸‹æ–¹æ³•è¿›è¡Œå‘é€ï¼š struct can_frame frame;frame.can_id = CAN_RTR_FLAG | 0x123;write(s, frame, sizeof(frame)); æ•°æ®æ¥æ”¶æ•°æ®æ¥æ”¶ä½¿ç”¨ read å‡½æ•°æ¥å®Œæˆï¼Œå®ç°å¦‚ä¸‹ï¼š struct can_frame frame;int nbytes = read(s, frame, sizeof(frame));nbytes = recv(s, frame, sizeof(frame), /*0*/MSG_DONTWAIT);nbytes = recvfrom(s, frame, sizeof(frame), 0, (struct sockaddr *)addr, sizeof(addr));struct msghdr msg;struct iovec iov;memset(msg, 0, sizeof(msg));memset(iov, 0, sizeof(iov));iov.iov_base = frame;iov.iov_len = sizeof(frame);msg.msg_iov = iov;msg.msg_iovlen = 1;nbytes = recvmsg(s, msg, 0); é”™è¯¯å¤„ç†å½“å¸§æ¥æ”¶åï¼Œå¯ä»¥é€šè¿‡åˆ¤æ–­ can_id ä¸­çš„ CAN_ERR_FLAG ä½æ¥åˆ¤æ–­æ¥æ”¶çš„å¸§æ˜¯å¦ä¸ºé”™è¯¯å¸§ã€‚ å¦‚æœä¸ºé”™è¯¯å¸§ï¼Œå¯ä»¥é€šè¿‡ can_id çš„å…¶ä»–ç¬¦å·ä½æ¥åˆ¤æ–­é”™è¯¯çš„å…·ä½“åŸå› ã€‚ é”™è¯¯å¸§çš„ç¬¦å·ä½åœ¨å¤´æ–‡ä»¶ linux/can/error.h ä¸­å®šä¹‰ã€‚ ä¾‹å¦‚ä»¥ä¸‹ä»£ç ç”¨äºè®¾ç½® CAN æ¥å£çš„é”™è¯¯è¿‡æ»¤å™¨ can_err_mask_t err_mask;err_mask = CAN_ERR_ACK | CAN_ERR_CRTL | CAN_ERR_BUSOFF | CAN_ERR_BUSERROR;ret = setsockopt(interface-fd, SOL_CAN_RAW, CAN_RAW_ERR_FILTER, err_mask, sizeof(err_mask));if(ret 0)\tlog_printf(LOG_ERR, CAN_ERROR_FILTER_FAILED, interface-ifName);\tlog_printf(LOG_DEBUG, DBG_ERRNO, setsockopt(can err));\treturn CO_ERROR_SYSCALL; CAN_ERR_ACK, CAN_ERR_CRTL, CAN_ERR_BUSOFF, CAN_ERR_BUSERROR æ˜¯ CAN é”™è¯¯çš„ä¸åŒç±»å‹ã€‚è¿™äº›æ ‡å¿—ä½åˆ†åˆ«è¡¨ç¤ºæ”¶åˆ°é”™è¯¯åº”ç­”ã€æ§åˆ¶å™¨é”™è¯¯ã€æ€»çº¿å…³é—­ã€æ€»çº¿é”™è¯¯ã€‚ SOL_CAN_RAW è¡¨ç¤ºæ“ä½œçš„æ˜¯åŸå§‹ CAN å¥—æ¥å­—ã€‚ CAN_RAW_ERR_FILTER æ˜¯è®¾ç½®åŸå§‹ CAN å¥—æ¥å­—çš„é”™è¯¯è¿‡æ»¤å™¨é€‰é¡¹ã€‚ è¿‡æ»¤è§„åˆ™è®¾ç½®åœ¨æ•°æ®æ¥æ”¶æ—¶ï¼Œç³»ç»Ÿå¯ä»¥æ ¹æ®é¢„å…ˆè®¾ç½®çš„è¿‡æ»¤è§„åˆ™ï¼Œå®ç°å¯¹æŠ¥æ–‡çš„è¿‡æ»¤ã€‚è¿‡æ»¤è§„åˆ™ä½¿ç”¨ can_filter ç»“æ„ä½“æ¥å®ç°ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š struct can_filter canid_t can_id;\tcanid_t can_mask;; è¿‡æ»¤å™¨å·¥ä½œåŸç†ï¼šCAN è¿‡æ»¤å™¨ä½¿ç”¨æŒ‰ä½ä¸ï¼ˆï¼‰æ“ä½œæ¥å†³å®šæ˜¯å¦æ¥æ”¶ä¸€ä¸ªå¸§ã€‚ if ((received_can_id filter.mask) == (filter.can_id filter.mask)) // æ¥æ”¶æ­¤å¸§else // ä¸¢å¼ƒæ­¤å¸§ é€šè¿‡è¿™æ¡è§„åˆ™å¯ä»¥åœ¨ç³»ç»Ÿä¸­è¿‡æ»¤æ‰æ‰€æœ‰ä¸ç¬¦åˆè§„åˆ™çš„æŠ¥æ–‡ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºä¸éœ€è¦å¯¹æ— å…³çš„æŠ¥æ–‡è¿›è¡Œå¤„ç†ã€‚åœ¨ can_filter ç»“æ„çš„ can_id ä¸­ï¼Œç¬¦å·ä½ CAN_INV_FILTER åœ¨ç½®ä½æ—¶å¯ä»¥å®ç° can_id åœ¨æ‰§è¡Œè¿‡æ»¤å‰çš„ä½åè½¬ã€‚ ç”¨æˆ·å¯ä»¥ä¸ºæ¯ä¸ªæ‰“å¼€çš„å¥—æ¥å­—è®¾ç½®å¤šæ¡ç‹¬ç«‹çš„è¿‡æ»¤è§„åˆ™ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š structcan_filter rfilter[2];rfilter[0].can_id = 0x123;rfilter[0].can_mask = CAN_SFF_MASK;//#define CAN_SFF_MASK 0x000007FFUrfilter[1].can_id = 0x200;rfilter[1].can_mask = 0x700;//è®¾ç½®è§„åˆ™setsockopt(s, SOL_CAN_RAW, CAN_RAW_FILTER,rfilter, sizeof(rfilter)); ç¬¬ä¸€ä¸ªè¿‡æ»¤å™¨ (rfilter): can_id: 0x123mask: 0x7FF (CAN_SFF_MASK)è¿™ä¸ªè¿‡æ»¤å™¨å°†åªæ¥æ”¶ ID ä¸º 0x123 çš„æ ‡å‡†å¸§ã€‚å› ä¸ºæ©ç æ˜¯ 0x7FFï¼Œæ‰€ä»¥ ID å¿…é¡»å®Œå…¨åŒ¹é…ã€‚ ç¬¬äºŒä¸ªè¿‡æ»¤å™¨ (rfilter): can_id: 0x200mask: 0x700 è¿™ä¸ªè¿‡æ»¤å™¨å°†æ¥æ”¶ ID èŒƒå›´ä» 0x200 åˆ° 0x2FF çš„å¸§ã€‚å› ä¸ºï¼š 0x200 0x700 = 0x200 ä»»ä½• 0x2XX çš„ ID ä¸ 0x700 è¿›è¡ŒæŒ‰ä½ä¸æ“ä½œåéƒ½ç­‰äº 0x200 è¿‡æ»¤è§„åˆ™ç¦ç”¨ã€‚åŸå§‹å¥—æ¥å­—å°±ä¼šå¿½ç•¥æ‰€æœ‰æ¥æ”¶åˆ°çš„æŠ¥æ–‡ã€‚åœ¨ä»…éœ€è¦å‘é€æ•°æ®çš„åº”ç”¨ä¸­ï¼Œå¯ä»¥åœ¨å†…æ ¸ä¸­çœç•¥æ¥æ”¶é˜Ÿåˆ—ï¼Œä»¥æ­¤å‡å°‘ CPU èµ„æºçš„æ¶ˆè€—ã€‚ç¦ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š //ç¦ç”¨è¿‡æ»¤è§„åˆ™setsockopt(s, SOL_CAN_RAW, CAN_RAW_FILTER, NULL, 0); é€šè¿‡é”™è¯¯æ©ç å¯ä»¥å®ç°å¯¹é”™è¯¯å¸§çš„è¿‡æ»¤ï¼Œ ä¾‹å¦‚ï¼š can_err_mask_t err_mask = (CAN_ERR_TX_TIMEOUT | CAN_ERR_BUSOFF );setsockopt(s, SOL_CAN_RAW,CAN_RAW_ERR_FILTER,err_mask,sizeof(err_mask)); ç¼“å†²åŒºå¤§å°è®¾ç½®ä»¥ä¸‹ä»£ç ç”¨äºè®¾ç½®ç¼“å†²åŒºå¤§å°ä¸º 512KBï¼Œå¹¶æŸ¥è¯¢è®¾ç½®ä¹‹åçš„ç¼“å†²åŒºå¤§å° //todo - modify rx buffer size? first one needs rootbytes = 512*1024;sLen = sizeof(bytes);ret = setsockopt(fd, SOL_SOCKET, SO_RCVBUFFORCE, (void *)bytes, sLen);ret = setsockopt(fd, SOL_SOCKET, SO_RCVBUF, (void *)bytes, sLen);/* print socket rx buffer size in bytes (In my experience, the kernel reserves * around 450 bytes for each CAN message) */sLen = sizeof(bytes);getsockopt(interface-fd, SOL_SOCKET, SO_RCVBUF, (void *)bytes, sLen);if (sLen == sizeof(bytes)) log_printf(LOG_INFO, CAN_SOCKET_BUF_SIZE, interface-ifName, bytes / 446, bytes); root ç”¨æˆ·ä½¿ç”¨ SO_RCVBUFFORCE è®¾ç½®ç¼“å†²åŒºå¤§å°ã€‚ æ™®é€šç”¨æˆ·ä½¿ç”¨ SO_RCVBUF è®¾ç½®ç¼“å†²åŒºå¤§å° å›ç¯åŠŸèƒ½è®¾ç½®åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ æœ¬åœ°å›ç¯åŠŸèƒ½æ˜¯å¼€å¯çš„ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•å…³é—­å›ç¯å¼€å¯åŠŸèƒ½ï¼š int loopback = 0; // 0 è¡¨ç¤ºå…³é—­, 1 è¡¨ç¤ºå¼€å¯( é»˜è®¤)setsockopt(s, SOL_CAN_RAW, CAN_RAW_LOOPBACK,loopback, sizeof(loopback)); åœ¨æœ¬åœ°å›ç¯åŠŸèƒ½å¼€å¯çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„å‘é€å¸§éƒ½ä¼šè¢«å›ç¯åˆ°ä¸ CAN æ€»çº¿æ¥å£å¯¹åº”çš„å¥—æ¥å­—ä¸Šã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘é€ CAN æŠ¥æ–‡çš„å¥—æ¥å­—ä¸æƒ³æ¥æ”¶è‡ªå·±å‘é€çš„æŠ¥æ–‡ï¼Œå› æ­¤å‘é€å¥—æ¥å­—ä¸Šçš„å›ç¯åŠŸèƒ½æ˜¯å…³é—­çš„ã€‚ å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™æ”¹å˜è¿™ä¸€é»˜è®¤è¡Œä¸ºï¼š int ro = 1; // 0 è¡¨ç¤ºå…³é—­( é»˜è®¤), 1 è¡¨ç¤ºå¼€å¯setsockopt(s, SOL_CAN_RAW, CAN_RAW_RECV_OWN_MSGS, ro, sizeof(ro)); å¥—æ¥å­—çŠ¶æ€åˆ©ç”¨ ioctl() æ£€æŸ¥å¥—æ¥å­—çŠ¶æ€ ä½¿ç”¨ ioctl() å‡½æ•°ç»“åˆ FIONREAD å‘½ä»¤å¯ä»¥æŸ¥è¯¢å½“å‰å¥—æ¥å­—æ¥æ”¶ç¼“å†²åŒºä¸­ç­‰å¾…è¯»å–çš„å­—èŠ‚æ•°ã€‚å¦‚æœè¿”å›çš„å­—èŠ‚æ•°å¤§äº 0ï¼Œåˆ™è¡¨ç¤ºæœ‰æ•°æ®å¯ä¾›æ¥æ”¶ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š int bytes_available;ioctl(sock, FIONREAD, bytes_available);if (bytes_available 0) printf(å¥—æ¥å­—ä¸­æœ‰ %d å­—èŠ‚çš„CANæ•°æ®å¯æ¥æ”¶ , bytes_available); // ç°åœ¨å¯ä»¥è¯»å–æ•°æ® // ... else printf(å¥—æ¥å­—ä¸­æ²¡æœ‰å¯æ¥æ”¶çš„CANæ•°æ® ); ioctl() å‡½æ•°å’Œ SIOCSIFFLAGS ioctl() å‡½æ•°ï¼šè¿™æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œç”¨äºåœ¨ç”¨æˆ·ç©ºé—´ç¨‹åºä¸­å‘å†…æ ¸å‘å‡ºç‰¹å®šçš„æ§åˆ¶å‘½ä»¤ï¼Œä»¥å®ç°å¯¹è®¾å¤‡ã€æ¥å£ç­‰çš„é…ç½®å’Œç®¡ç†ã€‚ SIOCSIFFLAGSï¼šè¿™æ˜¯ ioctl() å‡½æ•°ä½¿ç”¨çš„ä¸€ä¸ªå¸¸é‡ï¼Œç”¨äºè®¾ç½®ç½‘ç»œæ¥å£çš„æ ‡å¿—ã€‚é€šè¿‡ ioctl() å’Œ SIOCSIFFLAGSï¼Œå¯ä»¥å¯ç”¨æˆ–ç¦ç”¨ä¸€ä¸ªç½‘ç»œæ¥å£ï¼Œè®¾ç½®æ¥å£çš„å·¥ä½œæ¨¡å¼å’Œå…¶ä»–æ ‡å¿—ä½ã€‚ CAN é€šè®¯è®¾è®¡ç¡¬ä»¶ARM éœ€è¦æœ‰ CAN æ§åˆ¶å™¨å’Œ CAN æ”¶å‘å™¨ CAN æ§åˆ¶å™¨ï¼ˆCAN Controllerï¼‰æ˜¯è´Ÿè´£å®ç° CAN åè®®çš„é€»è¾‘éƒ¨åˆ†çš„ç»„ä»¶ CAN æ”¶å‘å™¨ï¼ˆCAN Transceiverï¼‰æ˜¯è´Ÿè´£ CAN æ€»çº¿ç”µå¹³ä¿¡å·å’Œ CAN æ§åˆ¶å™¨ä¹‹é—´çš„ç”µä¿¡å·è½¬æ¢çš„ç»„ä»¶ CAN æ§åˆ¶å™¨ç¤ºä¾‹ï¼š å†…ç½®äºå¾®æ§åˆ¶å™¨ä¸­çš„ CAN æ¨¡å—ï¼ˆä¾‹å¦‚ STM32 ç³»åˆ—å¾®æ§åˆ¶å™¨çš„å†…ç½® CAN æ§åˆ¶å™¨ï¼‰ã€‚ ç‹¬ç«‹çš„ CAN æ§åˆ¶å™¨èŠ¯ç‰‡ï¼ˆä¾‹å¦‚ MCP2515ï¼‰ã€‚ CAN æ”¶å‘å™¨ç¤ºä¾‹ï¼š å¸¸è§çš„ç‹¬ç«‹ CAN æ”¶å‘å™¨èŠ¯ç‰‡ï¼ˆä¾‹å¦‚ MCP2551ã€TJA1050 ç­‰ï¼‰ã€‚ å…ˆé€‰æ‹© CAN æ§åˆ¶å™¨èŠ¯ç‰‡ï¼Œä¸€èˆ¬çš„ PC å’Œ ARM éƒ½æ²¡æœ‰ CAN æ§åˆ¶å™¨ï¼Œä¸€èˆ¬æ˜¯ MCP2515 å’Œ SJA1000ï¼Œä¸»è¦åŒºåˆ«æ˜¯ MCP2515 æ˜¯ SPI æ¥å£ï¼ŒSJA1000 æ˜¯ IO æ¥å£ã€‚æ‰€ä»¥ MCP2515 å ç”¨èµ„æºå°‘ï¼Œ5-6 ä¸ªç®¡è„šå°±å¯ä»¥æ§åˆ¶ï¼ŒSJA1000 å ç”¨çš„ç®¡è„šå°±å¤šã€‚ å†…æ ¸Linux ä¸­æœ‰å¯¹ CANï¼ˆController Area Networkï¼‰æ€»çº¿çš„æ”¯æŒï¼Œä¸»è¦é€šè¿‡ SocketCAN å­ç³»ç»Ÿå®ç°ã€‚å†…æ ¸ç¼–è¯‘æ—¶é€‰æ‹©å“åº”çš„æ”¯æŒèŠ¯ç‰‡ã€‚ $ make linux-menuconfigNetworking support ---\tCAN bus subsystem support ---\t--- CAN bus subsystem support Raw CAN Protocol (raw access with CAN-ID filtering) Broadcast Manager CAN Protocol (with content filtering) CAN Device Drivers --- Virtual Local CAN Interface (vcan) Platform CAN drivers with Netlink support [*] CAN bit-timing calculation Microchip 251x series SPI CAN Controller SocketCAN æ”¯æŒå¤šç§ CAN æ§åˆ¶å™¨ç¡¬ä»¶ï¼Œé€šè¿‡ä¸åŒçš„å†…æ ¸é©±åŠ¨ç¨‹åºå®ç°å¯¹å…·ä½“ç¡¬ä»¶çš„æ”¯æŒã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ CAN æ§åˆ¶å™¨é©±åŠ¨ç¨‹åºï¼š sja1000ï¼šPhilipsNXP SJA1000 CAN æ§åˆ¶å™¨ mcp251xï¼šMicrochip MCP251x SPI CAN æ§åˆ¶å™¨ç³»åˆ—ï¼ˆå¦‚ MCP2515ï¼‰ flexcanï¼šFreescaleNXP FlexCAN æ¨¡å— è¿™äº›é©±åŠ¨ç¨‹åºé€šå¸¸ä½äºå†…æ ¸æºä»£ç æ ‘çš„ drivers/net/can ç›®å½•ä¸‹ã€‚ é©±åŠ¨éœ€è¦æ”¯æŒ CAN æ§åˆ¶å™¨é©±åŠ¨ï¼Œæ§åˆ¶ CAN æ§åˆ¶å™¨å‘é€ CAN å¸§ã€‚å¯¹äºä¸€èˆ¬çš„ CAN æ§åˆ¶å™¨ï¼Œè¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œæœ€å…³é”®çš„æ˜¯ä»¥ä¸‹ä¸¤æ­¥ï¼š é…ç½® CAN çš„ä½æ—¶åºï¼› é…ç½® CAN çš„æ¶ˆæ¯æŠ¥æ–‡ï¼› åº”ç”¨ç¨‹åºCAN æ•°æ®å‘é€è·Ÿè¸ªå½“ä»¬åœ¨ç”¨æˆ·å±‚é€šè¿‡ socket è¿›è¡Œ CAN æ•°æ®çš„å‘é€æ—¶ï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š åˆ›å»ºä¸€ä¸ªå¥—æ¥å­— socketï¼Œé‡‡ç”¨ AF_CAN åè®®ã€‚ å°†åˆ›å»ºçš„å¥—æ¥å­—è¿”å›æè¿°ç¬¦ sockfdï¼Œç»‘å®šåˆ°æœ¬åœ°çš„åœ°å€ã€‚ é€šè¿‡ sendto ç³»ç»Ÿè°ƒç”¨å‡½æ•°è¿›è¡Œå‘é€ï¼Œsendto çš„ç³»ç»Ÿè°ƒç”¨ä¼šå‘é€ä¸€å¸§æ•°æ®æŠ¥åˆ°æŒ‡å®šçš„åœ°å€ï¼Œåœ¨ CAN åè®®è°ƒç”¨ä¹‹å‰æŠŠè¯¥åœ°å€ç§»åˆ°å†…æ ¸ç©ºé—´å’Œæ£€æŸ¥ç”¨æˆ·ç©ºé—´æ•°æ®åŸŸæ˜¯å¦å¯è¯»ã€‚ åœ¨ net/socket.c æºæ–‡ä»¶ä¸­ï¼Œåœ¨ sendto çš„ç³»ç»Ÿè°ƒç”¨ ï¼ˆsys_sendtoï¼‰ é‡Œï¼Œä¼šè°ƒç”¨åˆ° sock_sendmsg() å‡½æ•°ï¼Œæ¥ä¸‹æ¥è°ƒç”¨ __sock_sendmsg() å‡½æ•°ã€‚ å†å¾€ä¸‹ä¸€æ­¥å°±æ˜¯ __sock_sendmsg_nosec å‡½æ•°ã€‚åœ¨ __sock_sendmsg_nosec() å‡½æ•°ä¸­ä¼šè¿”å›ä¸€ä¸ª sendmsg å‡½æ•°æŒ‡é’ˆã€‚ åœ¨ /net/can/raw.c æºæ–‡ä»¶ä¸­ï¼Œå°† raw_sendmsg å‡½æ•°åœ°å€èµ‹ç»™ sendmsg å‡½æ•°æŒ‡é’ˆï¼Œå³åœ¨å‡½æ•° __sock_sendmsg_nosec() ä¸­ return sock-ops-sendmsg(iocb,sock, msg, size)ï¼Œè¿”å›çš„å‡½æ•°æŒ‡é’ˆå°†æŒ‡å‘ raw_sendmsg() å‡½æ•°ã€‚ åœ¨ net/can/af_can.c æºæ–‡ä»¶ä¸­ï¼Œcan_send å‡½æ•°è´Ÿè´£ CAN åè®®å±‚çš„æ•°æ®ä¼ è¾“ï¼Œå³ä¼ è¾“ä¸€å¸§ CAN æŠ¥æ–‡ï¼ˆå¯é€‰æœ¬åœ°å›ç¯ï¼‰ã€‚å‚æ•° skb æŒ‡é’ˆæŒ‡å‘å¥—æ¥å­—ç¼“å†²åŒºå’Œåœ¨æ•°æ®æ®µçš„ CAN å¸§ã€‚loop å‚æ•°æ˜¯åœ¨æœ¬åœ° CAN å¥—æ¥å­—ä¸Šä¸ºç›‘å¬è€…æä¾›å›ç¯ã€‚ ä»¥ä¸‹å¼€å§‹è¿›è¡Œåˆ° CAN çš„åº•å±‚é©±åŠ¨ä»£ç äº†ï¼Œç”±äº CAN é©±åŠ¨æ˜¯ç¼–è¯‘è¿›å†…æ ¸ä¸­ï¼Œæ‰€ä»¥åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šæ³¨å†Œ CAN é©±åŠ¨ã€‚ æ³¨å†Œ CAN é©±åŠ¨è¿‡ç¨‹ä¸­ä¼šåˆå§‹åŒ– d_can_netdev_ops ç»“æ„ä½“å˜é‡ã€‚ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œd_can_netdev_ops ç»“æ„ä½“å˜é‡å®šä¹‰äº† 3 ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå…¶ä¸­ (*ndo_start_xmit) å‡½æ•°æŒ‡é’ˆæŒ‡å‘ d_can_start_xmit å‡½æ•°çš„å…¥å£åœ°å€ã€‚ åœ¨ d_can_start_xmit() å‡½æ•°ä¸­ï¼Œä¼šè°ƒç”¨ d_can_write_msg_object() å‡½æ•°å‡†å¤‡æ¶ˆæ¯æŠ¥æ–‡è¿›è¡Œä¼ è¾“ã€‚ CAN æ•°æ®æ¥æ”¶è·Ÿè¸ªå¯¹äºç½‘ç»œè®¾å¤‡ï¼Œæ•°æ®æ¥æ”¶å¤§ä½“ä¸Šé‡‡ç”¨ä¸­æ–­ +NAPI æœºåˆ¶è¿›è¡Œæ•°æ®çš„æ¥æ”¶ã€‚åŒæ ·ï¼Œä»¬ç°åœ¨çš„ CAN æ¨¡å—ä¹Ÿæ˜¯é‡‡ç”¨åŒæ ·çš„æ–¹å¼è¿›è¡Œæ•°æ®çš„æ¥æ”¶ã€‚ç”±äºä»¬åªé’ˆå¯¹ CAN æ€»çº¿æ¥æ”¶æ•°æ®è¿™æ¡ä¸»çº¿è¿›è¡Œåˆ†æã€‚å› äº›ï¼Œä¼šå¿½ç•¥ä¸€äº›é’ˆå¯¹ CAN åè®®çš„è®¾ç½®åŠåˆå§‹åŒ–ç­‰ç›¸å…³ä»£ç ã€‚ NAPIï¼ˆNew APIï¼‰æ˜¯ä¸€ç§æ”¹è¿›çš„ç½‘ç»œæ•°æ®æ¥æ”¶æœºåˆ¶ï¼Œå®ƒé€šè¿‡å‡å°‘ä¸­æ–­å¤„ç†çš„æ¬¡æ•°æ¥æé«˜æ€§èƒ½ã€‚NAPI çš„åŸºæœ¬æ€æƒ³æ˜¯å»¶è¿Ÿæ•°æ®åŒ…çš„å¤„ç†ï¼Œä½¿å¾—å¤šä¸ªæ•°æ®åŒ…å¯ä»¥ä¸€æ¬¡æ€§åœ°åœ¨ä¸­æ–­å¤„ç†ç¨‹åºä¸­è¿›è¡Œå¤„ç†ï¼Œä»è€Œå‡å°‘äº†ä¸­æ–­çš„æ•°é‡ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¤„ç†æ•ˆç‡ã€‚ ä¸­æ–­ +NAPI æœºåˆ¶çš„å·¥ä½œåŸç†å¤§è‡´å¦‚ä¸‹ï¼š å½“ç½‘ç»œæ•°æ®åŒ…åˆ°è¾¾æ—¶ï¼Œç½‘ç»œæ¥å£å¡ä¼šç”Ÿæˆä¸€ä¸ªä¸­æ–­é€šçŸ¥æ“ä½œç³»ç»Ÿã€‚ ä¸­æ–­æœåŠ¡ç¨‹åºä¼šæ‰§è¡Œä¸€äº›å¿…è¦çš„å¤„ç†ï¼Œç„¶åè°ƒç”¨ NAPI æœºåˆ¶ã€‚ NAPI æœºåˆ¶ä¼šæ£€æŸ¥ç½‘ç»œæ¥å£ç¼“å†²åŒºä¸­æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ•°æ®éœ€è¦å¤„ç†ã€‚ å¦‚æœæœ‰è¶³å¤Ÿçš„æ•°æ®ï¼ŒNAPI ä¼šç«‹å³å¼€å§‹å¤„ç†è¿™äº›æ•°æ®ï¼Œè€Œä¸ä¼šå†æ¬¡è§¦å‘ä¸­æ–­ã€‚å¦‚æœæ•°æ®é‡ä¸è¶³ï¼ŒNAPI ä¼šé€€å‡ºï¼Œå¹¶è¦æ±‚åœ¨å°†æ¥çš„æŸä¸ªæ—¶å€™å†æ¬¡è°ƒç”¨ã€‚ å¤„ç†å®Œæ•°æ®åï¼Œç³»ç»Ÿå¯ä»¥é€‰æ‹©æ€§åœ°å†³å®šæ˜¯å¦é‡æ–°å¯ç”¨ä¸­æ–­æœåŠ¡ç¨‹åºã€‚ é€šè¿‡å°†æ•°æ®åŒ…çš„å¤„ç†å»¶è¿Ÿåˆ°ä¸€ç»„æ•°æ®åŒ…åˆ°è¾¾æ—¶å†è¿›è¡Œï¼Œä¸­æ–­ +NAPI æœºåˆ¶èƒ½å¤Ÿå¤§å¤§å‡å°‘ä¸­æ–­çš„æ•°é‡ï¼Œæé«˜ç³»ç»Ÿçš„å¤„ç†æ•ˆç‡ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹ã€‚ åœ¨åˆå§‹åŒ– CAN è®¾å¤‡æ—¶ï¼Œä»¬éœ€è¦ç»™ CAN è®¾å¤‡åˆ†é… NAPI åŠŸèƒ½ã€‚ä»¬é€šè¿‡ netif_napi_add() å‡½æ•°å°† CAN è®¾å¤‡æ·»åŠ åˆ° NAPI æœºåˆ¶åˆ—è¡¨ä¸­ã€‚ å°† CAN è®¾å¤‡æ·»åŠ åˆ° NAPI æœºåˆ¶åˆ—è¡¨ä¸­åï¼Œåœ¨ä¸­æ–­å¤„ç†å‡½æ•° d_can_isr ä¸­ï¼Œä»¬é€šè¿‡ napi_schedule() å‡½æ•°è°ƒåº¦å·²ç»åœ¨ NAPI æœºåˆ¶åˆ—è¡¨ä¸­çš„ d_can_poll() å‡½æ•°ã€‚è¯¥å‡½æ•°ä¼šé€šè¿‡è½®è¯¢çš„æ–¹å¼æ¥æ”¶æ•°æ®ã€‚è€Œæ ¹æ® NAPI æœºåˆ¶ï¼Œå½“ä¸­æ–­äº§ç”Ÿåï¼Œä¼šè°ƒåº¦è½®è¯¢æœºåˆ¶åŒæ—¶å…³é—­æ‰€æœ‰çš„ä¸­æ–­ã€‚ å½“ä¸­æ–­äº§ç”Ÿæ—¶ï¼Œä¼šè°ƒç”¨å‡½æ•° d_can_poll()ï¼Œè¯¥å‡½æ•°å³é‡‡ç”¨è½®è¯¢çš„æ–¹å¼è¿›è¡Œæ•°æ®çš„æ¥æ”¶ã€‚ç”±äº CAN æ€»çº¿çŠ¶æ€ä¸­æ–­å…·æœ‰æœ€é«˜ä¼˜å…ˆæƒï¼Œåœ¨æ¥æ”¶æ•°æ®ä¹‹å‰ï¼Œéœ€è¦å¯¹ CAN æ€»çº¿çš„çŠ¶æ€è¿›è¡Œåˆ¤æ–­ã€‚è€Œå¯¹äº CAN æ€»çº¿é”™è¯¯çŠ¶æ€æœ‰ä¸‰ç§ï¼šä¸»åŠ¨è¢«åŠ¨å…³é—­ã€‚ å½“æ€»çº¿çŠ¶æ€æ•°æ®çŠ¶æ€æ­£å¸¸æ—¶ï¼Œä» CAN æ¨¡å—çš„æ¥æ”¶å¯„å­˜å™¨ä¸­æ¥æ”¶æ•°æ®ã€‚ æµ‹è¯•è¦åœ¨ linux ä¸‹é¢é…ç½®å’Œæµ‹è¯• CANï¼Œéœ€è¦å®‰è£…ä»¥ä¸‹ä¸‰ä¸ªç»„ä»¶ã€‚ iproute2 ï¼ˆé…ç½® CAN æ¥å£æ—¶éœ€è¦ï¼‰ libsocketcanï¼ˆä½¿ç”¨ CAN å¿…é¡»ï¼‰ CAN çš„æµ‹è¯•å°å·¥å…· can-utils https://github.com/linux-can/can-utils å¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤è¡Œå½¢å¼æ§åˆ¶ CAN # é…ç½®CANæ¥å£ï¼ˆå‡è®¾è®¾å¤‡åä¸º`can0`ï¼‰ï¼šip link set can0 up type can bitrate 500000# å¯åŠ¨CANæ¥å£ip link set up can0# æŸ¥çœ‹CANæ¥å£çŠ¶æ€ip -details link show can0# CAN 2.0 linkupip link set can0 up type can bitrate 100000# CAN 2.0 FD linkupip link set can0 up type can bitrate 500000 dbitrate 2000000 fd on# å‘½ä»¤æ¥é…ç½® CAN æ€»çº¿çš„ä½é€Ÿç‡ï¼šip link set can0 type cantq 125 prop-seg 6 phase-seg1 7 phase-seg2 2 sjw 1# å¯ä»¥ä½¿ç”¨ ip å‘½ä»¤ç›´æ¥è®¾å®šä½é€Ÿç‡500kbpsï¼šip link set can0 type can bitrate 500000# å½“è®¾ç½®å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æŸ¥è¯¢ can0 è®¾å¤‡çš„å‚æ•°è®¾ç½®ï¼šip -details link show can0# å½“è®¾ç½®å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ä½¿èƒ½ can0 è®¾å¤‡ï¼šifconfig can0 up# ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å–æ¶ˆ can0 è®¾å¤‡ä½¿èƒ½ï¼šifconfig can0 down# åœ¨è®¾å¤‡å·¥ä½œä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥è¯¢å·¥ä½œçŠ¶æ€ï¼šip -details -statistics link show can0 è´Ÿè½½è®¡ç®—åœ¨ CAN æ€»çº¿ä¸Šï¼Œå‘é€ä¸€å¸§æ•°æ®æ‰€éœ€çš„æ—¶é—´å¯ä»¥é€šè¿‡å¸§çš„æ€»ä½æ•°å’Œæ³¢ç‰¹ç‡æ¥è®¡ç®—ã€‚ å‘é€æ—¶é—´è®¡ç®— å‘é€æ—¶é—´ = æ€»ä½æ•° / æ³¢ç‰¹ç‡= 111 ä½ / 500000 ä½/ç§’= 222 * 10^-6 ç§’ æ€»çº¿è´Ÿè½½è®¡ç®—ï¼Œæ˜¯æ€»çº¿å®é™…ä½¿ç”¨çš„å¸¦å®½ä¸æ€»å¸¦å®½çš„æ¯”å€¼ï¼Œé€šå¸¸è¡¨ç¤ºä¸ºç™¾åˆ†æ¯”ã€‚ æ€»çº¿è´Ÿè½½ = ((æ€»å¸§æ—¶é—´ç§’Ã—æ¯ç§’å‘é€çš„å¸§æ•°)/æ€»å¯ç”¨æ—¶é—´ç§’)Ã—100%æ€»å¸§æ—¶é—´ï¼šä¸€å¸§æ•°æ®çš„å‘é€æ—¶é—´æ¯ç§’å‘é€çš„å¸§æ•°ï¼šä¸€ç§’é’Ÿå†…å‘é€çš„å¸§æ•°æ€»å¯ç”¨æ—¶é—´ï¼šæ¯ç§’å¯ç”¨çš„æ—¶é—´ï¼Œå³ 1 ç§’ å‡è®¾æ¯ç§’å‘é€ 1000 å¸§æ•°æ®ï¼Œåˆ™ 1 ç§’å†…è¯¥æ€»çº¿ä¸Šçš„è´Ÿè½½ä¸ºï¼š æ€»å¸§æ—¶é—´ï¼š222 å¾®ç§’ = 222 * 10^-6 ç§’æ¯ç§’å‘é€çš„å¸§æ•°ï¼š1000 å¸§/ç§’æ€»å¯ç”¨æ—¶é—´ï¼š1 ç§’æ€»çº¿è´Ÿè½½=((222*10^âˆ’6 * 1000) / 1)Ã—100%æ€»çº¿è´Ÿè½½=22.2% Qt ä¸­çš„ CAN æ’ä»¶éœ€è¦ç¼–è¯‘å®‰è£… socketCAN æ’ä»¶ï¼Œ https://doc.qt.io/qt-5/qtserialbus-socketcan-overview.html ï¼Œå…³é”®å­—ã€Using SocketCAN Pluginã€‘ pro æ–‡ä»¶ä¸­æ·»åŠ  QT += serialbus QString errorString;const QListQCanBusDeviceInfo devices = QCanBus::instance()-availableDevices(QStringLiteral(socketcan), errorString);if (!errorString.isEmpty())\tqDebug() errorString; å¤šçº¿ç¨‹ä¸‹åˆ©ç”¨çº¿ç¨‹æƒé™è¿›è¡Œé«˜é€Ÿçš„ CAN é€šä¿¡ç”¨ PC é‡Œèƒ½è¾¾åˆ°çš„ CAN é€šä¿¡ï¼ˆä½¿ç”¨ USBCAN-IIï¼‰é€Ÿåº¦æ˜¯ 1ms ä½¿ç”¨ 3 ä¸ªçº¿ç¨‹ç±»ï¼š1 ä¸ªç”¨æ¥æ¥æ”¶ï¼Œ1 ä¸ªç”¨æ¥å‘é€ï¼Œ1 ä¸ªç”¨æ¥è§£æ æ¥æ”¶çº¿ç¨‹ä½¿ç”¨æœ€é«˜çº¿ç¨‹æƒé™ï¼šQThread::HighestPriorityï¼Œå…¶ä½™çº¿ç¨‹ç”¨ QThread::HighPriority å¦‚ä½•å¾ªç¯å‘é€æŠ¥æ–‡ï¼šåœ¨å‘é€çº¿ç¨‹é‡Œå†å¤šåŠ ä¸€ä¸ªå®šæ—¶å™¨ï¼Œtimeout æ—¶é—´ä¸ºéœ€è¦å¾ªç¯å‘é€çš„æ—¶é—´ï¼ˆå¯è¾¾åˆ° 1msï¼‰ï¼› ç”¨æˆ·åœ¨ä¸»ç•Œé¢è®¾ç½®éœ€è¦å‘é€çš„æŠ¥æ–‡ä¸º OBJ ç»“æ„ä½“æ•°ç»„ï¼Œç„¶åé€šè¿‡æ„é€ å‡½æ•°çš„æ–¹å¼ä¼ åˆ°å‘é€çº¿ç¨‹ï¼Œæœ€åå‘é€å°±è¡Œäº†ã€‚ è§£æè¿‡ç¨‹ï¼šæ¥æ”¶å‡½æ•°å¾ªç¯æ¥æ”¶æŠ¥æ–‡ï¼Œæ¯æ¥æ”¶åˆ° n å¸§å°±å‘é€åˆ°è§£æçº¿ç¨‹ï¼Œç„¶åæ ¹æ® ID è§£æï¼Œå°†è§£ææ•°æ®å‘é€ä¸»ç•Œé¢æ˜¾ç¤ºï¼ˆä¸è¦ appendï¼‰ é—®é¢˜è®°å½•RK3568 åœ¨é«˜é€Ÿæ¥æ”¶ CAN å¸§æ¶ˆæ¯æ—¶ï¼Œå‡ºç° RCU å‘Šè­¦ rcu INFO: rcu_sched self-detected stall on CPUï¼ŒCPU å ç”¨è·‘æ»¡ï¼Œè¯¥é—®é¢˜åŸå› æ˜¯é”™è¯¯å¸§ä¸­æ–­è¿‡å¤šå¯¼è‡´çš„ç³»ç»Ÿå¡é¡¿é—®é¢˜ã€‚ åŸå› ä¸º RK3568 é»˜è®¤çš„ CAN é©±åŠ¨ä½ CANFDï¼Œè°ƒæ•´è®¾å¤‡æ ‘ä¸­çš„é©±åŠ¨ä¸º CAN åæ­£å¸¸æ¥æ”¶ã€‚ ã€ŠRockchipÂ RK3568RK3568B2RK3568JÂ ApplicationÂ Notice-RKAN18055ã€‹ä¸­æåˆ°å­˜åœ¨ä»¥ä¸‹è®¾è®¡ç¼ºé™·ï¼šRK3568 ä½œä¸ºå‘é€æ–¹ï¼Œæ‰©å±•å¸§æ¦‚ç‡æ€§å˜æˆæ ‡å‡†å¸§ï¼Œå¯¼è‡´æ¥æ”¶æ–¹å­˜åœ¨ä¸¢å¸§æƒ…å†µï¼Œè¿›è€Œå½±å“è®¾å¤‡çš„æ­£å¸¸é€šè®¯æˆ–è€…æ§åˆ¶ã€‚äº§ç”ŸåŸå› æ˜¯åœ¨å‘é€æ‰©å±•å¸§æ—¶å€™ï¼Œå†…éƒ¨å¯„å­˜å™¨çŠ¶æ€å€¼åœ¨ç‰¹å®šç»„åˆæ¡ä»¶ä¸‹ï¼Œè§¦å‘ load å¤±è´¥ï¼Œä»è€Œæœ€åæŒ‰æ ‡å‡†å¸§è€Œéæ‰©å±•å¸§çš„æ ¼å¼æ¥å‘é€ ID å’Œ DLC æ®µã€‚RK3568 ä½œä¸º æ¥æ”¶æ–¹ æ¦‚ç‡æ€§å‡ºç° CRC æ ¡éªŒé”™è¯¯å’Œ ID æ®µå¡«å……ä½é”™è¯¯ ï¼Œå¯¼è‡´æ¥æ”¶æ–¹ä¼šå¾€æ€»çº¿å‘é€é”™è¯¯å¸§ï¼Œç”±å‘é€æ–¹è¿›è¡Œé‡å‘ã€‚ 3568 åŸç”Ÿ CAN é©±åŠ¨ä½¿ç”¨è‡ªæ”¶æ–¹æ¡ˆä¿®æ”¹ kernelarcharm64bootdtsrockchiprk3568.dtsi æ–‡ä»¶ï¼Œæ³¨é‡Šæ‰ä¸‹å›¾éƒ¨åˆ†ï¼Œå–æ¶ˆ workround å¸§çš„é…ç½®ï¼Œä¿®æ”¹åä¼šè‡ªåŠ¨æ‰“å¼€ CAN çš„ TXtoRXï¼ŒåŸç”Ÿ CAN å‘é€æ‰©å±•å¸§æ•°æ®æ—¶ï¼Œä¼šæ”¶å›è‡ªå·±å‘å‡ºçš„æ•°æ®åšæ ¡éªŒï¼Œè‹¥æ ¡éªŒä¸æ˜¯æ‰©å±•å¸§å°†é‡æ–°å‘é€ä¸€å¸§ã€‚ æ³¨æ„ï¼šæ­¤æ–¹æ¡ˆåœ¨æ‰©å±•å‡ºæ¥çš„ ID éƒ¨åˆ† ID ä¸º 0 æ—¶ï¼Œä¼šè§¦å‘æ— é™é‡å‘æœºåˆ¶ï¼Œæ…ç”¨ã€‚","categories":["4.é€šè®¯åè®®","CAN"]},{"title":"CANæ€»çº¿çš„ç½‘ç»œæ‹“æ‰‘ç»“æ„","path":"/2023/12/28/4-é€šè®¯åè®®-CAN-CANæ€»çº¿çš„ç½‘ç»œæ‹“æ‰‘ç»“æ„/","content":"çº¿æ€§ç»“æ„çº¿æ€§æ‹“æ‰‘ç»“æ„é€šå¸¸æŒ‡çš„æ˜¯ä¸€ç§åŸºäºå¤šç‚¹è¿æ¥çš„æ‹“æ‰‘ç»“æ„ï¼Œä¿¡å·çº¿ä¸º CAN-é«˜ç”µå¹³å’Œ CAN-ä½ç”µå¹³ï¼Œä¸¤ç«¯ç«¯æ¥ä¸€ä¸ª 120 æ¬§å§†ç»ˆç«¯ç”µé˜»ï¼Œè¯¥çº¿è·¯ç§°ä¸ºä¸»å¹²çº¿ï¼Œä¹Ÿç§°ä¸ºæ€»çº¿ã€‚æ‰€æœ‰çš„è®¾å¤‡è¿æ¥åˆ°å…±åŒçš„ä¼ è¾“ä»‹è´¨ä¸Šï¼Œæ€»çº¿ä¸Šä»»æ„èŠ‚ç‚¹å‘é€ä¿¡æ¯ï¼Œå…¶å®ƒèŠ‚ç‚¹éƒ½èƒ½æ”¶åˆ°ï¼Œè¿™ç§ä»ä¸»å¹²çº¿åˆ†å‡ºçš„çŸ­åˆ†æ”¯çº¿ï¼ˆä¹Ÿç§°ä¸º stubï¼‰ã€‚Stub lengthï¼ˆåˆ†æ”¯çº¿é•¿åº¦ï¼‰æ˜¯æŒ‡ä»ä¸»å¹²çº¿åˆ°ç»ˆç«¯èŠ‚ç‚¹çš„çŸ­åˆ†æ”¯çº¿çš„é•¿åº¦ã€‚ æ ¹æ® CAN è§„èŒƒå’Œå®é™…å·¥ç¨‹ç»éªŒï¼Œstub length çš„é•¿åº¦åº”å°½é‡ä¿æŒçŸ­ï¼Œä»¥å‡å°‘ä¿¡å·åå°„å’Œå¤±çœŸã€‚è¿‡é•¿çš„ stub ä¼šå¯¼è‡´ä¿¡å·çš„åå°„ï¼Œå¢åŠ ç½‘ç»œä¸­çš„å™ªå£°å’Œè¯¯ç ç‡ã€‚ISO 11898 CAN æ ‡å‡†ï¼šå»ºè®® stub length åº”ä¿æŒåœ¨ 0.3 ç±³ï¼ˆ30 å˜ç±³ï¼‰ ä»¥ä¸‹ã€‚ä¸åŒçš„é€Ÿåº¦å¯¹åˆ†æ”¯çº¿é•¿åº¦çš„è¦æ±‚å¯èƒ½ä¸åŒï¼šåœ¨ 1 Mbps çš„é€Ÿç‡ä¸‹ï¼Œstub length é€šå¸¸è¢«å»ºè®®å°äº 30 å˜ç±³ã€‚åœ¨è¾ƒä½é€Ÿç‡ä¸‹ï¼Œå…è®¸çš„ stub length å¯ä»¥ç¨é•¿ï¼Œä½†ä¸€èˆ¬ä¸è¶…è¿‡ 3 ç±³ã€‚ æ˜Ÿå‹ç»“æ„åœ¨ CAN ç½‘ç»œä¸­ï¼Œå¤šä¸ªèŠ‚ç‚¹é€šè¿‡å„è‡ªçš„åˆ†æ”¯çº¿è¿æ¥åˆ°ä¸€ä¸ªä¸­å¿ƒèŠ‚ç‚¹æˆ–é›†çº¿å™¨ä¸Šï¼Œç”±ä¸­å¤®èŠ‚ç‚¹å‘ç›®çš„èŠ‚ç‚¹ä¼ é€ä¿¡æ¯ï¼Œä¸­å¤®èŠ‚ç‚¹æ‰§è¡Œé›†ä¸­å¼é€šä¿¡æ§åˆ¶ç­–ç•¥ã€‚ æ ‘å‹ç»“æ„ ç¯å‹ç»“æ„ç¯å½¢æ‹“æ‰‘æ˜¯å°† CAN æ€»çº¿é¦–å°¾ç›¸æ¥ï¼Œå½¢æˆç¯çŠ¶ï¼Œä¿è¯çº¿ç¼†çš„ä»»æ„ä½ç½®æ–­å¼€ä¾ç„¶å¯ä»¥ä¿è¯é€šè®¯ã€‚ç¯å½¢æ‹“æ‰‘çš„ç»ˆç«¯ç”µé˜»åŒ¹é…é‡‡ç”¨åˆ†å¸ƒå¼åŒ¹é…æ–¹æ³•ï¼Œä¿è¯æ€»ä½“é˜»æŠ—ä¸º 60 æ¬§å§†ã€‚ CAN ç½‘ç»œåœ¨CAN æ€»çº¿ï¼ˆController Area Networkï¼‰ç³»ç»Ÿä¸­ï¼ŒCAN ç½‘æ¡¥å’ŒCAN ç½‘å…³æ˜¯ä¸¤ç§ç”¨äºè¿æ¥å¤šä¸ª CAN ç½‘ç»œçš„è®¾å¤‡ï¼Œç½‘æ¡¥å’Œç½‘å…³éƒ½æ˜¯ä¸ºäº†æ‰©å±•ç³»ç»Ÿçš„åŠŸèƒ½å’Œçµæ´»æ€§ï¼Œä½†ç½‘æ¡¥æ›´å…³æ³¨ç‰©ç†å±‚é¢çš„è¿æ¥å’Œæ‰©å±•ï¼Œè€Œç½‘å…³åˆ™åœ¨ç½‘ç»œå±‚é¢ç®¡ç†å’Œä¼˜åŒ–æ•°æ®ä¼ è¾“ã€‚ CAN ç½‘æ¡¥ï¼šç”¨äºç‰©ç†è¿æ¥ä¸åŒçš„ CAN ç½‘ç»œï¼Œç®€å•åœ°è½¬å‘æŠ¥æ–‡ï¼Œé€‚ç”¨äºåŒåè®®çš„ç½‘ç»œäº’è¿ï¼Œèƒ½å¤Ÿè§£å†³æ³¢ç‰¹ç‡ä¸åŒæˆ–ç‰©ç†è·ç¦»å—é™çš„é—®é¢˜ã€‚ CAN ç½‘å…³ï¼šåŠŸèƒ½æ›´å¼ºå¤§ï¼Œæ”¯æŒæŠ¥æ–‡è¿‡æ»¤ã€æ•°æ®å¤„ç†å’Œåè®®è½¬æ¢ï¼Œé€‚ç”¨äºè¿æ¥ä¸åŒåè®®çš„ç½‘ç»œæˆ–éœ€è¦æ™ºèƒ½æ•°æ®ç®¡ç†çš„åœºæ™¯ã€‚ ç‰¹æ€§ CAN ç½‘æ¡¥ CAN ç½‘å…³ åŠŸèƒ½ è½¬å‘ CAN æŠ¥æ–‡ è½¬å‘ã€è¿‡æ»¤ã€å¤„ç†æŠ¥æ–‡ï¼Œåè®®è½¬æ¢ ç½‘ç»œè¿æ¥ è¿æ¥åŒåè®®çš„ CAN ç½‘ç»œ è¿æ¥ä¸åŒåè®®æˆ–ä¸åŒæ³¢ç‰¹ç‡çš„ç½‘ç»œ æŠ¥æ–‡å¤„ç† ä¸ä¿®æ”¹æŠ¥æ–‡ï¼Œç›´æ¥è½¬å‘ å¯ä»¥ä¿®æ”¹ã€è¿‡æ»¤æˆ–ç»„åˆæŠ¥æ–‡ åº”ç”¨åœºæ™¯ è¿æ¥å¤šä¸ª CAN ç½‘ç»œï¼Œå»¶é•¿ç‰©ç†è·ç¦» è¿æ¥ä¸åŒåè®®ç½‘ç»œï¼Œè¿‡æ»¤æ•°æ®æµ CAN ç½‘æ¡¥ï¼ˆCAN Bridgeï¼‰CAN ç½‘æ¡¥æ˜¯ä¸€ç§ç”¨äºè¿æ¥ä¸¤ä¸ªæˆ–å¤šä¸ª CAN ç½‘ç»œçš„è®¾å¤‡ï¼Œä½¿å®ƒä»¬å¯ä»¥åœ¨ç›¸åŒæˆ–ä¸åŒçš„æ³¢ç‰¹ç‡ä¸‹è¿›è¡Œé€šä¿¡ã€‚ç½‘æ¡¥çš„ä¸»è¦ç›®çš„æ˜¯ç‰©ç†ä¸Šè¿æ¥è¿™äº›ç½‘ç»œï¼Œé€æ˜åœ°è½¬å‘ CAN æŠ¥æ–‡ï¼Œè€Œä¸åšåè®®è½¬æ¢æˆ–å¤„ç†ã€‚ è¿æ¥ä¸åŒæ³¢ç‰¹ç‡çš„ CAN ç½‘ç»œï¼šCAN ç½‘æ¡¥å…è®¸å°†è¿è¡Œåœ¨ä¸åŒæ³¢ç‰¹ç‡çš„ CAN ç½‘ç»œè¿æ¥èµ·æ¥ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª CAN ç½‘ç»œå¯èƒ½è¿è¡Œåœ¨ 1 Mbpsï¼Œè€Œå¦ä¸€ä¸ª CAN ç½‘ç»œå¯èƒ½è¿è¡Œåœ¨ 500 kbpsã€‚CAN ç½‘æ¡¥ä¼šåœ¨è¿™äº›ç½‘ç»œä¹‹é—´è½¬å‘æŠ¥æ–‡ã€‚ é€æ˜ä¼ è¾“ï¼šCAN ç½‘æ¡¥é€šå¸¸ä¸æ”¹å˜æŠ¥æ–‡çš„å†…å®¹ï¼Œå®ƒåªæ˜¯å°†æ¥æ”¶åˆ°çš„æŠ¥æ–‡ä»ä¸€ä¸ª CAN ç½‘ç»œè½¬å‘åˆ°å¦ä¸€ä¸ªç½‘ç»œã€‚ å»¶é•¿ CAN ç½‘ç»œçš„ç‰©ç†è·ç¦»ï¼šç”±äº CAN æ€»çº¿çš„ç‰©ç†é•¿åº¦ä¸æ³¢ç‰¹ç‡æˆåæ¯”ï¼Œç½‘æ¡¥å¯ä»¥é€šè¿‡å°†å¤šä¸ªçŸ­çš„ CAN ç½‘ç»œè¿æ¥åœ¨ä¸€èµ·ï¼Œé—´æ¥å¢åŠ ç½‘ç»œçš„è¦†ç›–èŒƒå›´ï¼Œè€Œä¸ä¼šè¶…å‡ºå•ä¸ª CAN ç½‘ç»œçš„è·ç¦»é™åˆ¶ã€‚ CAN ç½‘å…³ï¼ˆCAN Gatewayï¼‰CAN ç½‘å…³æ˜¯ä¸€ç§æ™ºèƒ½è®¾å¤‡ï¼Œä¸ä»…å¯ä»¥è¿æ¥å¤šä¸ª CAN ç½‘ç»œï¼Œè¿˜èƒ½æ‰§è¡ŒæŠ¥æ–‡è¿‡æ»¤ã€åè®®è½¬æ¢ã€æ•°æ®å¤„ç†ç­‰åŠŸèƒ½ã€‚ç›¸æ¯” CAN ç½‘æ¡¥ï¼ŒCAN ç½‘å…³çš„åŠŸèƒ½æ›´åŠ çµæ´»ä¸”å¤æ‚ï¼Œå®ƒä¸ä»…ä»…æ˜¯ç®€å•åœ°è½¬å‘æ•°æ®ï¼Œè¿˜èƒ½å¤Ÿæ ¹æ®è®¾å®šçš„è§„åˆ™å¯¹æ•°æ®è¿›è¡Œè½¬æ¢æˆ–è¿‡æ»¤ã€‚ åè®®è½¬æ¢ï¼šCAN ç½‘å…³å¯ä»¥è¿æ¥ä¸åŒçš„ç½‘ç»œåè®®ï¼Œå¦‚å°† CAN æŠ¥æ–‡è½¬æ¢ä¸º LINã€FlexRayã€Ethernet ç­‰æŠ¥æ–‡æ ¼å¼ï¼Œå¹¶åœ¨ä¸åŒç½‘ç»œä¹‹é—´è¿›è¡Œæ•°æ®äº¤æ¢ã€‚ æŠ¥æ–‡è¿‡æ»¤å’Œè·¯ç”±ï¼šç½‘å…³å¯ä»¥æ ¹æ®é¢„è®¾çš„è§„åˆ™å¯¹æŠ¥æ–‡è¿›è¡Œè¿‡æ»¤ã€è·¯ç”±ï¼Œå³åªè½¬å‘éƒ¨åˆ†ç¬¦åˆæ¡ä»¶çš„æŠ¥æ–‡ï¼Œæˆ–ä¿®æ”¹æŠ¥æ–‡å†…å®¹åå†è½¬å‘ã€‚è¿™å¯ä»¥æœ‰æ•ˆåœ°é™ä½ç½‘ç»œè´Ÿè½½ï¼Œå¹¶å¢åŠ æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚ æ•°æ®å¤„ç†ï¼šCAN ç½‘å…³å¯ä»¥æ‰§è¡Œç‰¹å®šçš„åº”ç”¨é€»è¾‘ï¼Œå¦‚æ ¹æ®æ”¶åˆ°çš„ CAN æ¶ˆæ¯æ‰§è¡ŒæŸäº›æ“ä½œï¼Œç”šè‡³å¯ä»¥å°†å¤šæ¡æ¶ˆæ¯ç»„åˆä¸ºä¸€æ¡æ¶ˆæ¯å†è½¬å‘ã€‚ ç½‘ç»œéš”ç¦»å’Œä¿æŠ¤ï¼šCAN ç½‘å…³åœ¨è¿æ¥ä¸åŒç½‘ç»œæ—¶ï¼Œå¯ä»¥éš”ç¦»è¿™äº›ç½‘ç»œï¼Œé˜²æ­¢æ•…éšœæˆ–æ”»å‡»åœ¨ä¸åŒç½‘ç»œä¹‹é—´ä¼ æ’­ã€‚","categories":["4.é€šè®¯åè®®","CAN"]},{"title":"CANé©±åŠ¨ä¸­çš„NAPI","path":"/2023/12/27/4-é€šè®¯åè®®-CAN-CANé©±åŠ¨ä¸­çš„NAPI/","content":"NAPI æ˜¯åœ¨ Linux ä¸Šå®ç°çš„ä¸€é¡¹æŠ€æœ¯ï¼Œæ—¨åœ¨æé«˜ç½‘ç»œæ•°æ®å¤„ç†çš„æ•ˆç‡ã€‚å®ƒçš„æ ¸å¿ƒç†å¿µæ˜¯æ”¾å¼ƒä¼ ç»Ÿçš„ä¸­æ–­æ–¹å¼æ¥è¯»å–æ•°æ®ï¼Œè€Œæ˜¯é¦–å…ˆé€šè¿‡ä¸­æ–­æ¿€æ´»ä¸€ä¸ªæœåŠ¡ç¨‹åºæ¥å¤„ç†æ•°æ®æ¥æ”¶ã€‚ä¹‹åï¼ŒæœåŠ¡ç¨‹åºåˆ©ç”¨è½®è¯¢çš„æ–¹å¼ï¼ˆpollï¼‰æ¥æ£€æŸ¥æ•°æ®ã€‚è¿™ä¸€æ–¹æ³•æœ‰æ•ˆæé«˜äº†çŸ­å°æ•°æ®åŒ…çš„æ¥æ”¶æ•ˆç‡ï¼Œæ˜¾è‘—å‡å°‘äº†å› é¢‘ç¹ä¸­æ–­å¯¼è‡´çš„ CPU èµ„æºæ¶ˆè€—ã€‚ ç†è§£ NAPI çš„å¿…è¦æ€§åœ¨ NAPI æœºåˆ¶å¼•å…¥ä¹‹å‰ï¼Œç½‘ç»œè®¾å¤‡å¤„ç†æ¥æ”¶æ•°æ®åŒ…çš„æ–¹å¼å®Œå…¨ä¾èµ–ä¸­æ–­ã€‚ä»¥ä¸€ä¸ªå®é™…ä¾‹å­æ¥çœ‹ï¼Œå‡è®¾æ¥æ”¶åˆ°çš„æ•°æ®åŒ…æ¯ä¸ªé•¿åº¦ä»…ä¸ºå‡ ä¸ªå­—èŠ‚ã€‚åœ¨ä¸€ç§’é’Ÿå†…ï¼Œå¦‚æœç³»ç»Ÿæ¥æ”¶åˆ° 5000 ä¸ªè¿™æ ·çš„æ•°æ®åŒ…ï¼Œä¼šåˆ›é€ å‡º 5000 æ¬¡ä¸­æ–­ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¤„ç†æ¯ä¸€æ¬¡ä¸­æ–­éƒ½è¦æ¶ˆè€— CPU èµ„æºï¼Œå¯¼è‡´ç³»ç»Ÿæ— æ³•é«˜æ•ˆè¿ä½œã€‚ NAPI çš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚é€šè¿‡å°†ä¸­æ–­å’Œè½®è¯¢ç»“åˆï¼Œç³»ç»Ÿå¯ä»¥åœ¨å¤„ç†æ•°æ®çš„åŒæ—¶ï¼Œå‡å°‘ç”±äºä¸æ–­ä¸­æ–­è€Œæµªè´¹çš„èµ„æºï¼Œä»è€Œæé«˜æ•´ä½“ç½‘ç»œæ€§èƒ½ã€‚ æºç è§£ææ¥ä¸‹æ¥ï¼Œè®©ä»¬æ·±å…¥è§‚å¯Ÿ NAPI çš„å®ç°ç»†èŠ‚ã€‚é¦–å…ˆï¼Œåœ¨åˆ†é… CAN è®¾å¤‡æ—¶ï¼Œä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº† netif_napi_add å‡½æ•°æ³¨å†Œè½®è¯¢å‡½æ•° d_can_poll()ã€‚ struct net_device *alloc_d_can_dev(int num_objs) struct net_device *dev; struct d_can_priv *priv; dev = alloc_candev(sizeof(struct d_can_priv), num_objs / 2); if (!dev) return NULL; priv = netdev_priv(dev); netif_napi_add(dev, priv-napi, d_can_poll, num_objs / 2); priv-dev = dev; priv-can.bittiming_const = d_can_bittiming_const; priv-can.do_set_mode = d_can_set_mode; priv-can.do_get_berr_counter = d_can_get_berr_counter; priv-can.ctrlmode_supported = (CAN_CTRLMODE_LOOPBACK | CAN_CTRLMODE_LISTENONLY | CAN_CTRLMODE_BERR_REPORTING | CAN_CTRLMODE_3_SAMPLES); return dev; åœ¨è¿™æ®µä»£ç ä¸­ï¼Œä»¬é¦–å…ˆåˆ†é…ä¸€ä¸ª CAN è®¾å¤‡ï¼Œå¹¶é€šè¿‡è°ƒç”¨ netif_napi_add å‡½æ•°å°†è½®è¯¢å‡½æ•° d_can_poll æ³¨å†Œåˆ° NAPI ä¸­ã€‚è¿™ä¸ªå‡½æ•°è¿˜è®¾ç½®äº†ä¸ç½‘ç»œæ¥å£è®¾å¤‡ç›¸å…³çš„å„ç§å±æ€§ã€‚ netif_napi_add() å‡½æ•°çš„åŸå‹å¦‚ä¸‹ï¼š void netif_napi_add(struct net_device *dev, struct napi_struct *napi, int (*poll)(struct napi_struct *, int), int weight) INIT_LIST_HEAD(napi-poll_list); napi-gro_count = 0; napi-gro_list = NULL; napi-skb = NULL; napi-poll = poll; napi-weight = weight; list_add(napi-dev_list, dev-napi_list); napi-dev = dev; #ifdef CONFIG_NETPOLL spin_lock_init(napi-poll_lock); napi-poll_owner = -1; #endif set_bit(NAPI_STATE_SCHED, napi-state); åœ¨ netif_napi_add å‡½æ•°ä¸­ï¼Œå®ƒåˆå§‹åŒ–äº† NAPI ç»“æ„ä½“ä¸­çš„å„ä¸ªå­—æ®µï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°è®¾å¤‡çš„ NAPI åˆ—è¡¨ä¸­ã€‚è¿™ç¡®ä¿äº†å½“ NAPI è¢«æ¿€æ´»æ—¶ï¼Œèƒ½å¤Ÿæ­£ç¡®å¤„ç†è½®è¯¢ã€‚ è½®è¯¢å‡½æ•° d_can_poll çš„å®ç°è½®è¯¢å‡½æ•° d_can_poll çš„ä»£ç å¦‚ä¸‹ï¼š static int d_can_poll(struct napi_struct *napi, int quota) int lec_type = 0; int work_done = 0; struct net_device *dev = napi-dev; struct d_can_priv *priv = netdev_priv(dev); if (!priv-irqstatus) goto end; /* status events have the highest priority */ if (priv-irqstatus == STATUS_INTERRUPT) priv-current_status = d_can_read(priv, D_CAN_ES); /* handle Tx/Rx events */ if (priv-current_status D_CAN_ES_TXOK) d_can_write(priv, D_CAN_ES, priv-current_status ~D_CAN_ES_TXOK); if (priv-current_status D_CAN_ES_RXOK) d_can_write(priv, D_CAN_ES, priv-current_status ~D_CAN_ES_RXOK); /* handle state changes */ if ((priv-current_status D_CAN_ES_EWARN) (!(priv-last_status D_CAN_ES_EWARN))) netdev_dbg(dev, entered error warning state ); work_done += d_can_handle_state_change(dev, D_CAN_ERROR_WARNING); if ((priv-current_status D_CAN_ES_EPASS) (!(priv-last_status D_CAN_ES_EPASS))) netdev_dbg(dev, entered error passive state ); work_done += d_can_handle_state_change(dev, D_CAN_ERROR_PASSIVE); if ((priv-current_status D_CAN_ES_BOFF) (!(priv-last_status D_CAN_ES_BOFF))) netdev_dbg(dev, entered bus off state ); work_done += d_can_handle_state_change(dev, D_CAN_BUS_OFF); /* handle bus recovery events */ if ((!(priv-current_status D_CAN_ES_BOFF)) (priv-last_status D_CAN_ES_BOFF)) netdev_dbg(dev, left bus off state ); priv-can.state = CAN_STATE_ERROR_ACTIVE; if ((!(priv-current_status D_CAN_ES_EPASS)) (priv-last_status D_CAN_ES_EPASS)) netdev_dbg(dev, left error passive state ); priv-can.state = CAN_STATE_ERROR_ACTIVE; priv-last_status = priv-current_status; /* handle lec errors on the bus */ lec_type = d_can_has_handle_berr(priv); if (lec_type) work_done += d_can_handle_bus_err(dev, lec_type); else if ((priv-irqstatus = D_CAN_MSG_OBJ_RX_FIRST) (priv-irqstatus = D_CAN_MSG_OBJ_RX_LAST)) /* handle events corresponding to receive message objects */ work_done += d_can_do_rx_poll(dev, (quota - work_done)); else if ((priv-irqstatus = D_CAN_MSG_OBJ_TX_FIRST) (priv-irqstatus = D_CAN_MSG_OBJ_TX_LAST)) /* handle events corresponding to transmit message objects */ d_can_do_tx(dev); end: if (work_done quota) napi_complete(napi); /* enable all IRQs */ d_can_interrupts(priv, ENABLE_ALL_INTERRUPTS); return work_done; åœ¨è¿™ä¸ªè½®è¯¢å‡½æ•°ä¸­ï¼Œä»¬å¤„ç†äº†å¤šç§çŠ¶æ€äº‹ä»¶å’Œé”™è¯¯å¤„ç†ï¼Œç¡®ä¿ç½‘ç»œè®¾å¤‡èƒ½å¤Ÿåœ¨æ¥æ”¶æ¶ˆæ¯æ—¶å¯¹çŠ¶æ€è¿›è¡Œå“åº”å¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚å½“å·¥ä½œå®Œæˆçš„æ•°é‡å°äºæŒ‡å®šçš„é™é¢æ—¶ï¼Œå‡½æ•°ä¼šè°ƒç”¨ napi_completeã€‚ ä¸­æ–­å¤„ç†è¿‡ç¨‹åœ¨ä¸­æ–­å¤„ç†å‡½æ•°ä¸­ï¼Œä»¬ç¦æ­¢è®¾å¤‡æ¥æ”¶ä¸­æ–­ï¼Œç„¶åé€šçŸ¥ç½‘ç»œå­ç³»ç»Ÿä»¥è½®è¯¢æ¨¡å¼å¿«é€Ÿæ¥æ”¶æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹é€šè¿‡ napi_schedule() å‡½æ•°å®Œæˆã€‚ static irqreturn_t d_can_isr(int irq, void *dev_id) struct net_device *dev = (struct net_device *)dev_id; struct d_can_priv *priv = netdev_priv(dev); priv-irqstatus = d_can_read(priv, D_CAN_INT); if (!priv-irqstatus) return IRQ_NONE; /* disable all interrupts and schedule the NAPI */ d_can_interrupts(priv, DISABLE_ALL_INTERRUPTS); napi_schedule(priv-napi); return IRQ_HANDLED; åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œé¦–å…ˆè¯»å–ä¸­æ–­çŠ¶æ€ï¼Œç„¶åæ ¹æ®çŠ¶æ€é€‰æ‹©ç¦ç”¨æ‰€æœ‰ä¸­æ–­ï¼Œå¹¶å®‰æ’ NAPI è¿›è¡Œè½®è¯¢å¤„ç†ã€‚ NAPI çš„å¯ç”¨ä¸ç¦ç”¨ç”±äºå¯èƒ½å­˜åœ¨å¤šä¸ª NAPI ç»“æ„å®ä¾‹ï¼Œå¼€å‘äººå‘˜éœ€è¦æ§åˆ¶æ¯ä¸ªå®ä¾‹çš„ä½¿èƒ½ä¸ç¦ç”¨ï¼Œä»¥ç¡®ä¿ç½‘ç»œæ¥å£çš„æ­£å¸¸æ“ä½œã€‚åœ¨ d_can_open() å‡½æ•°ä¸­ä½¿ç”¨ napi_enable()ï¼Œåœ¨ d_can_close() å‡½æ•°ä¸­ä½¿ç”¨ napi_disable() æ–¹æ³•è¿›è¡Œç®¡ç†ã€‚ napi_enable(priv-napi);napi_disable(priv-napi); é€šè¿‡ä»¥ä¸Šçš„å®ç°ï¼Œä¸ä»…ç¡®ä¿äº†ç½‘ç»œæ¥æ”¶çš„é«˜æ•ˆæ€§ï¼Œè¿˜ä¿è¯äº†åœ¨ç½‘ç»œè´Ÿè½½æ—¶èƒ½æ›´å¹³ç¨³åœ°ç»´æŠ¤è®¾å¤‡çŠ¶æ€ã€‚è¿™ä¸€æ•´å¥—æœºåˆ¶çš„å»ºç«‹ï¼Œä½¿å¾—ç½‘ç»œå¤„ç†åœ¨é«˜å¹¶å‘ä¸‹ä»èƒ½ä¿æŒé«˜æ•ˆï¼Œæå¤§åœ°æå‡äº†ç³»ç»Ÿçš„æ•´ä½“è¡¨ç°ã€‚","categories":["4.é€šè®¯åè®®","CAN"]},{"title":"RK3568å†…æ ¸CANä¿®æ”¹éªŒè¯ç¬”è®°","path":"/2023/12/26/4-é€šè®¯åè®®-CAN-RK3568å†…æ ¸CANä¿®æ”¹éªŒè¯ç¬”è®°/","content":"ä¿®æ”¹æ–¹æ¡ˆè¯´æ˜ è®¾å¤‡æ ‘ä¸­åŸèŠ‚ç‚¹é…ç½®ä¸º CANFDï¼Œä¿®æ”¹ä¸º CAN è®¾å¤‡æ ‘ä¸­ä¿®æ”¹èŠ‚ç‚¹æ¥æ”¶ç¼“å†²åŒºï¼Œç”±åŸæ¥çš„ 6 æ”¹ä¸º 32 ä¿®æ”¹é©±åŠ¨ä¸­çš„ä¸­æ–­å¤„ç†æœºåˆ¶ï¼ŒåŸæ¥æ˜¯è¿›ä¸­æ–­ç›´æ¥å¤„ç†ï¼Œä¿®æ”¹ä¸º NAPI çš„æ–¹å¼è¿›å…¥ä¸­æ–­è¿›è¡Œè½®è¯¢å¤„ç† CAN æ§åˆ¶å™¨å·¥ä½œåŸç†Rockchip çš„ CAN æ§åˆ¶å™¨åŒ…å«ä»¥ä¸‹ä¸»è¦æ¨¡å—: æ¥å£ç®¡ç†é€»è¾‘ï¼šè¿æ¥å¤–éƒ¨ä¸»æ§åˆ¶å™¨ï¼Œè§£é‡Šå‘½ä»¤ï¼Œæ§åˆ¶å¯„å­˜å™¨å¯»å€ã€‚ CAN æ ¸å¿ƒæ¨¡å—ï¼šè´Ÿè´£ CAN å¸§çš„ä¸²å¹¶è½¬æ¢ã€‚ å‘é€ç¼“å†²å™¨ï¼šå­˜å‚¨å¾…å‘é€çš„å®Œæ•´æŠ¥æ–‡ã€‚ éªŒæ”¶æ»¤æ³¢å™¨ï¼šè¿‡æ»¤ä¸éœ€è¦æ¥æ”¶çš„æŠ¥æ–‡ã€‚ æ¥æ”¶ FIFOï¼šå­˜å‚¨ä» CAN æ€»çº¿æ¥æ”¶çš„æŠ¥æ–‡ã€‚ èŠ‚ç‚¹ä¿¡æ¯è¾“å…¥ ip -details link show can0 æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ CANFD èŠ‚ç‚¹ä¿¡æ¯ï¼ŒèŠ‚ç‚¹ä¸­å¸¦æœ‰ FD å­—æ · CAN èŠ‚ç‚¹ä¿¡æ¯ è®¾å¤‡æ ‘é…ç½®Rockchip çš„ CAN æ§åˆ¶å™¨åœ¨è®¾å¤‡æ ‘ä¸­è¿›è¡Œé…ç½®ã€‚å®šä¹‰äº† CAN æ§åˆ¶å™¨çš„å…¼å®¹æ€§ã€å¯„å­˜å™¨åœ°å€ã€ä¸­æ–­ã€æ—¶é’Ÿã€å¤ä½ã€å¼•è„šé…ç½®ç­‰ä¿¡æ¯ã€‚è®¾å¤‡æ ‘åœ°å€ kernel/arch/arm64/boot/dts/rockchip/OK3568-C-common.dtsi can0 compatible = rockchip,can-1.0;\tassigned-clocks = cru CLK_CAN0;\tassigned-clock-rates = 300000000;\tpinctrl-names = default;\tpinctrl-0 = can0m0_pins;\trx-fifo-depth = 32;\tstatus = okay;; kernel/arch/arm64/boot/dts/rockchip/rk3568.dtsi can0: can@fe570000 compatible = rockchip,rk3568-can-2.0;\treg = 0x0 0xfe570000 0x0 0x1000;\tinterrupts = GIC_SPI 1 IRQ_TYPE_LEVEL_HIGH;\tclocks = cru CLK_CAN0, cru PCLK_CAN0;\tclock-names = baudclk, apb_pclk;\tresets = cru SRST_CAN0, cru SRST_P_CAN0;\treset-names = can, can-apb;\ttx-fifo-depth = 1;\trx-fifo-depth = 6;\tstatus = disabled;; compatible ç”¨æ¥é…ç½® CAN æ§åˆ¶å™¨çš„é©±åŠ¨ï¼Œé»˜è®¤å¯ç”¨çš„ CANFD # rockchip,can-1.0ç”¨æ¥åŒ¹é…canæ§åˆ¶å™¨é©±åŠ¨compatible=rockchip,can-1.0# rockchip,can-2.0ç”¨æ¥åŒ¹é…canfdæ§åˆ¶å™¨é©±åŠ¨ã€‚compatible=rockchip,can-2.0rockchip,can-1.0rockchip,canfd-1.0 assigned-clock-rates ç”¨æ¥é…ç½® can çš„æ—¶é’Ÿé¢‘ç‡ï¼Œå¦‚æœ CAN çš„æ¯”ç‰¹ç‡ä½äº 1M å»ºè®®ä¿®æ”¹ CAN æ—¶é’Ÿåˆ° 200Mï¼Œä¿¡å·æ›´ç¨³å®šã€‚é«˜äº 1M æ¯”ç‰¹ç‡çš„ï¼Œæ—¶é’Ÿè®¾ç½® 300M å°±å¯ä»¥ã€‚ pinctrl æ ¹æ®å®é™…è¿æ¥æƒ…å†µé…ç½® can h å’Œ can l çš„ iomux ä½œä¸º can åŠŸèƒ½ä½¿ç”¨ã€‚ IOMUX æ˜¯ InputOutput Multiplexer çš„ç¼©å†™ï¼Œæ„æ€æ˜¯è¾“å…¥è¾“å‡ºå¤šè·¯å¤ç”¨å™¨ã€‚åœ¨åµŒå…¥å¼ç³»ç»Ÿå’Œå¾®æ§åˆ¶å™¨ä¸­ï¼ŒIOMUX æ˜¯ä¸€ç§ç¡¬ä»¶æœºåˆ¶ï¼Œç”¨äºé…ç½®èŠ¯ç‰‡çš„å¼•è„šåŠŸèƒ½ã€‚ rx-fifo-depth: å†³å®šæ¥æ”¶ FIFO ç¼“å†²åŒºå¯ä»¥å­˜å‚¨çš„ CAN æ¶ˆæ¯æ•°é‡ã€‚é»˜è®¤è¯¥å€¼è®¾ç½®ä¸º 6ï¼Œè¿™æ„å‘³ç€æ¥æ”¶ FIFO å¯ä»¥å®¹çº³å¤šè¾¾ 6 æ¡ CAN æ¶ˆæ¯ï¼Œç„¶åç”±è½¯ä»¶å¤„ç†ï¼Œä»è€Œæœ‰åŠ©äºç¡®ä¿æ¶ˆæ¯æ¥æ”¶çš„å¯é æ€§è€Œä¸ä¼šä¸¢å¤±ã€‚éœ€è¦åœ¨ç¼“å†²å®¹é‡å’Œèµ„æºä½¿ç”¨é—´çš„æƒè¡¡ rx-fifo-depth çš„å½±å“ ç¼“å†²å®¹é‡: æ›´æ·±çš„ FIFO ç¼“å†²åŒºå¯ä»¥å­˜å‚¨æ›´å¤šçš„æ¶ˆæ¯ï¼Œè¿™åœ¨ CAN æ§åˆ¶å™¨ä»¥é«˜é¢‘ç‡æ¥æ”¶æ¶ˆæ¯ä¸”è½¯ä»¶æ— æ³•ç«‹å³å¤„ç†æ—¶éå¸¸æœ‰ç”¨ï¼Œè¿™æœ‰åŠ©äºé˜²æ­¢æ¶ˆæ¯ä¸¢å¤±ã€‚å»¶è¿Ÿ: æ›´å¤§çš„ FIFO å¯èƒ½ä¼šå¼•å…¥è½»å¾®çš„å»¶è¿Ÿï¼Œå› ä¸ºæ¶ˆæ¯å¯èƒ½ä¼šåœ¨ç¼“å†²åŒºä¸­ç­‰å¾…æ›´é•¿æ—¶é—´æ‰è¢«å¤„ç†ã€‚ç„¶è€Œï¼Œä¸é¿å…æ¶ˆæ¯ä¸¢å¤±çš„å¥½å¤„ç›¸æ¯”ï¼Œè¿™ç§å»¶è¿Ÿé€šå¸¸æ˜¯æœ€å°çš„ã€‚èµ„æºä½¿ç”¨: å¢åŠ  FIFO æ·±åº¦å¯èƒ½ä¼šä½¿ç”¨æ›´å¤šçš„ç¡¬ä»¶èµ„æºï¼ˆä¾‹å¦‚å†…å­˜ï¼‰ï¼Œä½†å¯¹äºåˆç†çš„å€¼æ¥è¯´ï¼Œè¿™é€šå¸¸å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ç³»ç»Ÿå“åº”æ€§: å¦‚æœè¯»å– FIFO æ¶ˆæ¯çš„è½¯ä»¶ä¸å¤Ÿå¿«ï¼Œæ‹¥æœ‰æ›´æ·±çš„ FIFO å¯ä»¥å¸®åŠ©å¸æ”¶çªå‘çš„è¾“å…¥æ¶ˆæ¯ï¼Œä»è€Œä½¿ç³»ç»Ÿæ›´å…·å“åº”æ€§å¹¶é¿å…ä¸¢å¤±æ¶ˆæ¯ã€‚ å†…æ ¸é…ç½®è¦ä½¿ç”¨ CAN åŠŸèƒ½ï¼Œéœ€è¦åœ¨å†…æ ¸é…ç½®ä¸­å¯ç”¨ç›¸å…³é€‰é¡¹ï¼Œå†…æ ¸é…ç½®æ–‡ä»¶åœ°å€ kernel/arch/arm64/configs/OK3568-C-linux_defconfig #yç¼–è¯‘è¿›å†…æ ¸#nä¸ç¼–è¯‘#mæ¨¡å—æ–¹å¼åŠ è½½CONFIG_CAN=yCONFIG_CAN_ROCKCHIP=yCONFIG_CANFD_ROCKCHIP=y ä¿®æ”¹å†…æ ¸ä¸­çš„ CAN FD èŠ‚ç‚¹ä¸º CAN èŠ‚ç‚¹å¹¶å…³é—­å†…æ ¸ä¸­çš„ CANFD åŠŸèƒ½ã€‚ä¿®æ”¹ vi ./kernel/arch/arm64/configs/OK3568-C-linux_defconfig ä¸­çš„ CONFIG_CANFD_ROCKCHIP=nï¼Œå…³é—­ CANFD é©±åŠ¨æ–‡ä»¶Rockchip çš„ CAN é©±åŠ¨æ–‡ä»¶é€šå¸¸ä½äºå†…æ ¸æºç çš„ drivers/net/can/rockchip/ ç›®å½•ä¸‹ã€‚ ç½‘ç»œè®¾å¤‡é©±åŠ¨çš„ä¸­æ–­å¤„ç† ä¸­è¯´æ˜äº†å…³äºç½‘ç»œè®¾å¤‡ä¸­æ–­çš„å¤„ç† å°†ç»™å®šçš„ CAN é©±åŠ¨ä»£ç æ”¹ä¸ºä½¿ç”¨ NAPI(New API)è¿›è¡Œå¼€å‘ï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹ä¸»è¦ä¿®æ”¹ï¼š //åœ¨ struct rockchip_can ä¸­æ·»åŠ  NAPI ç»“æ„ï¼šstruct rockchip_can struct can_priv can; struct napi_struct napi; // ... å…¶ä»–æˆå‘˜ ...;//å®ç° NAPI è½®è¯¢å‡½æ•°ï¼šstatic int rockchip_can_poll(struct napi_struct *napi, int budget)//budget æ¯æ¬¡è°ƒç”¨ NAPI è½®è¯¢å‡½æ•°æ—¶æœ€å¤šå¤„ç†çš„åŒ…æ•°é‡ã€‚ struct rockchip_can *rcan = container_of(napi, struct rockchip_can, napi); struct net_device *ndev = rcan-can.dev; int work_done = 0; while (work_done budget) if (!(readl(rcan-base + CAN_STATE) RX_BUF_FULL)) break; rockchip_can_rx(ndev); work_done++; if (work_done budget) napi_complete_done(napi, work_done); // é‡æ–°å¯ç”¨ä¸­æ–­ writel(readl(rcan-base + CAN_INT_MASK) ~RX_FINISH, rcan-base + CAN_INT_MASK); return work_done;//ä¿®æ”¹ä¸­æ–­å¤„ç†å‡½æ•°ï¼šstatic irqreturn_t rockchip_can_interrupt(int irq, void *dev_id) struct net_device *ndev = dev_id; struct rockchip_can *rcan = netdev_priv(ndev); u32 isr; isr = readl(rcan-base + CAN_INT); if (!isr) return IRQ_NONE; // å¤„ç†æ¥æ”¶ä¸­æ–­ if (isr RX_FINISH) // ç¦ç”¨æ¥æ”¶ä¸­æ–­ writel(readl(rcan-base + CAN_INT_MASK) | RX_FINISH, rcan-base + CAN_INT_MASK); napi_schedule(rcan-napi); // å¤„ç†å…¶ä»–ä¸­æ–­... return IRQ_HANDLED;//åœ¨é©±åŠ¨åˆå§‹åŒ–å‡½æ•°ä¸­è®¾ç½® NAPIï¼šstatic int rockchip_can_probe(struct platform_device *pdev) // ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ... netif_napi_add(ndev, rcan-napi, rockchip_can_poll, 64); // ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ...//åœ¨ rockchip_can_open å‡½æ•°ä¸­å¯ç”¨ NAPIï¼šstatic int rockchip_can_open(struct net_device *ndev) // ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ... napi_enable(rcan-napi); // ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ...//åœ¨ rockchip_can_stop å‡½æ•°ä¸­ç¦ç”¨ NAPIï¼šstatic int rockchip_can_stop(struct net_device *ndev) struct rockchip_can *rcan = netdev_priv(ndev); // ... å…¶ä»–æ¸…ç†ä»£ç  ... napi_disable(rcan-napi); // ... å…¶ä»–æ¸…ç†ä»£ç  ...//åœ¨é©±åŠ¨å¸è½½å‡½æ•°ä¸­åˆ é™¤ NAPIï¼šstatic int rockchip_can_remove(struct platform_device *pdev) struct net_device *ndev = platform_get_drvdata(pdev); struct rockchip_can *rcan = netdev_priv(ndev); // ... å…¶ä»–æ¸…ç†ä»£ç  ... netif_napi_del(rcan-napi); // ... å…¶ä»–æ¸…ç†ä»£ç  ... ä½¿ç”¨ NAPI æ¥å¤„ç†æ¥æ”¶æ•°æ®èƒ½å¤Ÿæé«˜æ€§èƒ½å¹¶å‡å°‘ä¸­æ–­è´Ÿè½½ã€‚NAPI å…è®¸é©±åŠ¨åœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹è½®è¯¢æ¥æ”¶æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªæ¥æ”¶çš„å¸§ç”Ÿæˆä¸­æ–­ã€‚è¿™å¯ä»¥æ˜¾è‘—æé«˜ç³»ç»Ÿçš„æ•ˆç‡ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜æ•°æ®ç‡çš„æƒ…å†µä¸‹ã€‚ LED çŠ¶æ€æŒ‡ç¤ºå¯ä»¥é€šè¿‡ä¿®æ”¹å†…æ ¸é©±åŠ¨ï¼Œå®ç° LED çŠ¶æ€ç¯æ ¹æ® CAN æ”¶å‘æ•°æ®æƒ…å†µå˜åŒ–ï¼Œä»¥æ˜¾ç¤º CAN æ´»åŠ¨çŠ¶æ€ã€‚ æµ‹è¯•å’Œä½¿ç”¨ can-utils å·¥å…·åŒ…è¿›è¡Œ CAN æ¥å£çš„æµ‹è¯•å’Œä½¿ç”¨ candump ç”¨äºæ¥æ”¶æ•°æ® cansend ç”¨äºå‘é€æ•°æ®CANOpen è°ƒè¯• ä¸­è¯´æ˜äº†ç›¸å…³å‘½ä»¤çš„ä½¿ç”¨ OK3568 çš„ UART8 å¤ç”¨ä¸º CAN2è®¾å¤‡æ ‘ä¸­ä½¿èƒ½ CAN åŠŸèƒ½ è®¾å¤‡æ ‘kernel/arch/arm64/boot/dts/rockchip/OK3568-C-common.dtsièŠ‚ç‚¹can2å±æ€§status = okay å…³é—­ UART8 åŠŸèƒ½ è®¾å¤‡æ ‘kernel/arch/arm64/boot/dts/rockchip/OK3568-C-common.dtsièŠ‚ç‚¹uart8å±æ€§status=disabled ä¿®æ”¹å®Œæˆåå›åˆ° OK3568-linux-source ç›®å½•æ‰§è¡Œ.build.sh kernel ç¼–è¯‘å®Œæˆåå•ç‹¬çƒ§å†™ OK3568-linux-sourcekernelboot.img é•œåƒæ–‡ä»¶å³å¯ã€‚","categories":["4.é€šè®¯åè®®","CAN"]},{"title":"Rockchip CANé©±åŠ¨NAPI","path":"/2023/12/25/4-é€šè®¯åè®®-CAN-Rockchip-CANé©±åŠ¨NAPI/","content":"Rockchip ç³»åˆ—èŠ¯ç‰‡çš„ CAN é©±åŠ¨Rockchip ç³»åˆ—èŠ¯ç‰‡çš„ CAN é©±åŠ¨æ¶‰åŠå¤šä¸ªå…³é”®æ–¹é¢ï¼Œè¿™äº›ç»„æˆéƒ¨åˆ†å…±åŒç¡®ä¿äº† CAN åŠŸèƒ½çš„æ­£å¸¸è¿ä½œã€‚å…·ä½“å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯¦ç»†é˜è¿°ï¼š è®¾å¤‡æ ‘é…ç½®åœ¨ Rockchip èŠ¯ç‰‡ä¸­ï¼ŒCAN æ§åˆ¶å™¨çš„è®¾å¤‡æ ‘é…ç½®æ˜¯è‡³å…³é‡è¦çš„ã€‚ä»¥ RK3588 ä¸ºä¾‹ï¼Œå…¶ CAN æ§åˆ¶å™¨åœ¨è®¾å¤‡æ ‘ä¸­çš„é…ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼š can0: can@fea50000 compatible = rockchip,can-2.0; reg = 0x0 0xfea50000 0x0 0x1000; interrupts = GIC_SPI 341 IRQ_TYPE_LEVEL_HIGH; clocks = cru CLK_CAN0, cru PCLK_CAN0; clock-names = baudclk, apb_pclk; resets = cru SRST_CAN0, cru SRST_P_CAN0; reset-names = can, can-apb; pinctrl-names = default; pinctrl-0 = can0m0_pins; tx-fifo-depth = 1; rx-fifo-depth = 6; status = disabled;; åœ¨è¿™æ®µé…ç½®ä¸­ï¼Œå®šä¹‰äº†å¤šä¸ªå…³é”®å…ƒç´ ï¼š å…¼å®¹æ€§ï¼šæŒ‡å®šæ§åˆ¶å™¨çš„ç±»å‹ï¼Œé€šè¿‡ compatible å­—æ®µä½¿å¾—ç³»ç»ŸçŸ¥é“è¦ä½¿ç”¨å“ªä¸ªé©±åŠ¨ã€‚ å¯„å­˜å™¨åœ°å€ï¼šreg å­—æ®µå®šä¹‰äº†æ§åˆ¶å™¨çš„å¯„å­˜å™¨åœ°å€èŒƒå›´ï¼Œç³»ç»Ÿé€šè¿‡è¿™ä¸ªåœ°å€ä¸ç¡¬ä»¶è¿›è¡Œäº¤äº’ã€‚ ä¸­æ–­è®¾ç½®ï¼šé€šè¿‡ interrupts å­—æ®µè®¾ç½®ç›¸åº”çš„ä¸­æ–­ç±»å‹ï¼Œç¡®ä¿èƒ½åŠæ—¶å“åº” CAN é€šè®¯è¯·æ±‚ã€‚ æ—¶é’Ÿå’Œå¤ä½ï¼šè¿™äº›è®¾ç½®ç¡®ä¿æ§åˆ¶å™¨åœ¨æ­£ç¡®çš„æ—¶é’Ÿé¢‘ç‡ä¸‹å·¥ä½œï¼Œclocks å’Œ resets å­—æ®µåˆ†åˆ«é…ç½®äº†ä¸æ§åˆ¶å™¨å·¥ä½œç›¸å…³çš„æ—¶é’Ÿä¿¡å·å’Œå¤ä½ä¿¡å·ã€‚ å¼•è„šé…ç½®ï¼špinctrl-names å’Œ pinctrl-0 å­—æ®µæŒ‡å®šäº†ä½¿ç”¨çš„å¼•è„šé…ç½®ï¼Œæ¥å£çš„ç‰©ç†è¿æ¥åœ¨æ­¤å¤„è¢«å®šä¹‰ã€‚ FIFO æ·±åº¦ï¼štx-fifo-depth å’Œ rx-fifo-depth å®šä¹‰äº†å‘é€å’Œæ¥æ”¶ç¼“å†²åŒºçš„æ·±åº¦ï¼Œå½±å“æ•°æ®å¤„ç†èƒ½åŠ›ã€‚ é©±åŠ¨æ–‡ä»¶Rockchip çš„ CAN é©±åŠ¨æ–‡ä»¶é€šå¸¸ä½äºå†…æ ¸æºç çš„ drivers/net/can/rockchip/ ç›®å½•ä¸‹ã€‚è¿™ä¸ªè·¯å¾„ä¸‹çš„æ–‡ä»¶ç»è¿‡ç¼–è¯‘åï¼Œå½¢æˆå†…æ ¸æ¨¡å—ï¼Œæä¾›ä¸ç¡¬ä»¶äº¤äº’çš„æ“ä½œã€‚ å†…æ ¸é…ç½®ä¸ºäº†é¡ºåˆ©å¯ç”¨ CAN åŠŸèƒ½ï¼Œéœ€è¦åœ¨å†…æ ¸é…ç½®ä¸­å¯ç”¨ç›¸å…³é€‰é¡¹ã€‚å…·ä½“æ¥è¯´ï¼Œç”¨æˆ·éœ€è¦ç¡®ä¿ CONFIG_CAN å’Œ CONFIG_CAN_ROCKCHIP è¿™ä¸¤ä¸ªé€‰é¡¹è¢«å¼€å¯ã€‚è¿™é€šå¸¸é€šè¿‡ä¿®æ”¹ .config æ–‡ä»¶æˆ–è€…ä½¿ç”¨ make menuconfig å‘½ä»¤å®Œæˆã€‚ CAN æ§åˆ¶å™¨å·¥ä½œåŸç†Rockchip çš„ CAN æ§åˆ¶å™¨åŒ…æ‹¬ä»¥ä¸‹ä¸»è¦æ¨¡å—ï¼š æ¥å£ç®¡ç†é€»è¾‘ï¼šå®ƒè´Ÿè´£ä¸å¤–éƒ¨ä¸»æ§åˆ¶å™¨çš„è¿æ¥ï¼Œç†è§£æ¥è‡ªä¸»æ§åˆ¶å™¨çš„å‘½ä»¤ï¼Œå¹¶æ§åˆ¶å¯„å­˜å™¨çš„å¯»å€ã€‚ CAN æ ¸å¿ƒæ¨¡å—ï¼šè´Ÿè´£å°†æ•°æ®å¸§è¿›è¡Œä¸²å¹¶è½¬æ¢ï¼Œæ˜¯æ•°æ®é€šä¿¡çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ å‘é€ç¼“å†²å™¨ï¼šåœ¨ CAN æ€»çº¿ä¸Šå‘é€å‰ï¼Œå®Œæ•´çš„æŠ¥æ–‡ä¼šå­˜å‚¨åœ¨è¿™ä¸ªç¼“å†²å™¨ä¸­ï¼Œç¡®ä¿æ•°æ®çš„é¡ºåˆ©ä¼ è¾“ã€‚ éªŒæ”¶æ»¤æ³¢å™¨ï¼šç”¨äºç­›é€‰ä¸å¿…è¦çš„æŠ¥æ–‡ï¼Œå‡è½»ç³»ç»Ÿè´Ÿæ‹…ï¼Œç¡®ä¿æ¥æ”¶åˆ°çš„æ˜¯æœ‰æ•ˆæ•°æ®ã€‚ æ¥æ”¶ FIFOï¼šä» CAN æ€»çº¿æ¥æ”¶çš„æŠ¥æ–‡é¦–å…ˆå­˜å‚¨åœ¨æ­¤å¤„ï¼Œä»¥å¤‡åç»­å¤„ç†ã€‚ å·¥ä½œæ¨¡å¼Rockchip çš„ CAN æ§åˆ¶å™¨æ”¯æŒä¸¤ç§å·¥ä½œæ¨¡å¼ï¼š BasicCANï¼šè¿™ç§æ¨¡å¼ä»…æ”¯æŒæ ‡å‡† CAN åè®®ã€‚å®ƒé€‚ç”¨äºå¤§å¤šæ•°ç®€å•çš„åº”ç”¨åœºæ™¯ã€‚ PeliCANï¼šè¯¥æ¨¡å¼æ”¯æŒ CAN 2.0B åè®®ï¼Œæ—¢å¯ä»¥å¤„ç†æ ‡å‡†å¸§åˆå¯ä»¥å¤„ç†æ‰©å±•å¸§ï¼Œé€‚åº”æ€§æ›´å¼ºï¼Œé€‚åˆå¤æ‚çš„ç½‘ç»œæ“ä½œï¼Œä¾‹å¦‚å¤šèŠ‚ç‚¹ç³»ç»Ÿã€‚ æµ‹è¯•å’Œä½¿ç”¨å¯ä»¥ä½¿ç”¨ can-utils å·¥å…·åŒ…è¿›è¡Œ CAN æ¥å£çš„æµ‹è¯•å’Œä½¿ç”¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨å‘½ä»¤ï¼š **candump**ï¼šç”¨äºæ¥æ”¶å’Œæ˜¾ç¤ºç»è¿‡ CAN ç½‘ç»œçš„æ•°æ®ï¼Œæ–¹ä¾¿è¿›è¡Œå®æ—¶ç›‘æ§ã€‚ **cansend**ï¼šç”¨äºå‘é€æ•°æ®åˆ° CAN ç½‘ç»œï¼Œæ£€éªŒç½‘ç»œçš„é€šè®¯èƒ½åŠ›ä»¥åŠæ•…éšœæ’é™¤ã€‚ LED çŠ¶æ€æŒ‡ç¤ºé€šè¿‡ä¿®æ”¹å†…æ ¸é©±åŠ¨ï¼Œæœ‰å¯èƒ½å®ç° LED æŒ‡ç¤ºç¯æ ¹æ® CAN æ•°æ®çš„æ”¶å‘æƒ…å†µå˜åŒ–ã€‚è¿™ç§å¯è§†åŒ–çš„çŠ¶æ€æŒ‡ç¤ºï¼Œä¸ä»…å¢å¼ºäº†ç³»ç»Ÿçš„ç”¨æˆ·ä½“éªŒï¼Œè¿˜èƒ½ä¸ºæ•…éšœæ’æŸ¥æä¾›ä¾¿åˆ©ã€‚ å¦‚ä½•åœ¨ Rockchip å¹³å°ä¸Šé…ç½® CAN é©±åŠ¨åœ¨ Rockchip å¹³å°ä¸Šé…ç½® CAN é©±åŠ¨æ¶‰åŠä¸€ç³»åˆ—æ­¥éª¤ï¼Œéœ€ä»”ç»†æ‰§è¡Œä»¥ç¡®ä¿ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„æ“ä½œæ­¥éª¤å’Œå¿…è¦çš„æ³¨æ„äº‹é¡¹ã€‚ 1. è®¾å¤‡æ ‘é…ç½®é¦–å…ˆï¼Œåœ¨è®¾å¤‡æ ‘æ–‡ä»¶ä¸­é…ç½® CAN æ§åˆ¶å™¨ã€‚ä»¥ RK3588 ä¸ºä¾‹ï¼Œå¯åœ¨ç›¸åº”çš„ dtsi æ–‡ä»¶ä¸­æ‰¾åˆ°æˆ–æ·»åŠ  CAN æ§åˆ¶å™¨çš„åŸºæœ¬é…ç½®ã€‚ä¸‹é¢çš„ä»£ç ç¤ºä¾‹è¯´æ˜äº†å¦‚ä½•å®šä¹‰ CAN æ§åˆ¶å™¨ï¼š can0: can@fea50000 compatible = rockchip,can-2.0; reg = 0x0 0xfea50000 0x0 0x1000; interrupts = GIC_SPI 341 IRQ_TYPE_LEVEL_HIGH; clocks = cru CLK_CAN0, cru PCLK_CAN0; clock-names = baudclk, apb_pclk; resets = cru SRST_CAN0, cru SRST_P_CAN0; reset-names = can, can-apb; pinctrl-names = default; pinctrl-0 = can0m0_pins; tx-fifo-depth = 1; rx-fifo-depth = 6; status = disabled; // åˆå§‹çŠ¶æ€ä¸ºç¦ç”¨; å…·ä½“è¯´æ˜ compatible å­—æ®µæŒ‡å®šäº†è¯¥è®¾å¤‡çš„å…¼å®¹æ€§ã€‚ reg è¡¨ç¤ºè¯¥è®¾å¤‡çš„å¯„å­˜å™¨åœ°å€èŒƒå›´ã€‚ interrupts å®šä¹‰äº†ä½¿ç”¨çš„ä¸­æ–­ç±»å‹åŠå…¶ç¼–å·ã€‚ clocks å’Œ clock-names å£°æ˜äº†æ‰€éœ€çš„æ—¶é’Ÿã€‚ resets å’Œ reset-names è¡¨ç¤ºé‡ç½®æ§åˆ¶ä¿¡å·ã€‚ 2. å¯ç”¨ CAN æ§åˆ¶å™¨æ¥ä¸‹æ¥ï¼Œåœ¨ç‰¹å®šæ¿çº§çš„ DTS æ–‡ä»¶ä¸­ï¼Œå°† CAN æ§åˆ¶å™¨çš„çŠ¶æ€ status ä¿®æ”¹ä¸º okayï¼Œä»¥å¯ç”¨è¯¥æ§åˆ¶å™¨ã€‚ä¿®æ”¹åçš„ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š status = okay; // ç¡®ä¿æ§åˆ¶å™¨è¢«å¯ç”¨ 3. å†…æ ¸é…ç½®ä¸ºäº†ä½¿å†…æ ¸è¯†åˆ«å¹¶æ”¯æŒ CAN åŠŸèƒ½ï¼Œéœ€è¦åœ¨å†…æ ¸é…ç½®ä¸­å¯ç”¨ç›¸å…³é€‰é¡¹ã€‚ç¡®ä¿åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹è¡Œï¼š CONFIG_CAN=yCONFIG_CAN_DEV=yCONFIG_CAN_ROCKCHIP=y è¯´æ˜ CONFIG_CAN å¯ç”¨æ•´ä¸ª CAN åŠŸèƒ½æ”¯æŒã€‚ CONFIG_CAN_DEV ä½¿èƒ½ CAN è®¾å¤‡çš„æ”¯æŒã€‚ CONFIG_CAN_ROCKCHIP ç‰¹åˆ«ä¸º Rockchip å¹³å°å¯ç”¨ CAN é©±åŠ¨ã€‚ 4. ç¼–è¯‘é©±åŠ¨Rockchip çš„ CAN é©±åŠ¨æºæ–‡ä»¶é€šå¸¸ä½äºå†…æ ¸æºç çš„ drivers/net/can/rockchip/ ç›®å½•ä¸‹ã€‚ç¡®ä¿è¿™äº›æ–‡ä»¶è¢«æ­£ç¡®ç¼–è¯‘å¹¶åŒ…å«åœ¨å†…æ ¸æ˜ åƒä¸­ã€‚è¿è¡Œå†…æ ¸ç¼–è¯‘åï¼Œæ£€æŸ¥ç”Ÿæˆçš„æ¨¡å—æ˜¯å¦å·²åŒ…å« CAN é©±åŠ¨ã€‚ 5. æµ‹è¯•å’Œä½¿ç”¨ç¼–è¯‘å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ can-utils å·¥å…·åŒ…å¯¹ CAN æ¥å£è¿›è¡Œæµ‹è¯•ã€‚æ­¤å·¥å…·åŒ…æä¾›äº†ä¸€ç³»åˆ—å‘½ä»¤æ¥æ“ä½œ CAN ç½‘ç»œï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ç¤ºä¾‹ï¼š ç¤ºä¾‹å‘½ä»¤ æ¥æ”¶æ•°æ®ï¼š candump can0 å‘é€æ•°æ®ï¼š cansend can0 123#DEADBEEF è¯´æ˜ candump å‘½ä»¤ç”¨äºç›‘å¬å¹¶æ‰“å°ä» can0 æ¥å£æ¥æ”¶åˆ°çš„æ•°æ®ã€‚ cansend å‘½ä»¤åˆ™å¯ç”¨æ¥å‘é€ç‰¹å®šçš„ CAN æ¶ˆæ¯ï¼Œæ ¼å¼ä¸º æ ‡è¯†ç¬¦#æ•°æ®ã€‚ 6. å¯é€‰ï¼šLED çŠ¶æ€æŒ‡ç¤ºå¯ä»¥é€šè¿‡ä¿®æ”¹å†…æ ¸é©±åŠ¨ï¼Œä½¿ LED æŒ‡ç¤ºç¯æ ¹æ® CAN çš„æ”¶å‘çŠ¶æ€å˜æ¢ï¼Œä»è€ŒæŒ‡ç¤º CAN æ´»åŠ¨çš„çŠ¶æ€ã€‚è¿™éœ€è¦åœ¨é©±åŠ¨ä¸­å¢åŠ å¯¹ LED æ§åˆ¶çš„æ”¯æŒã€‚ åœ¨ Rockchip å¹³å°ä¸Šä¼˜åŒ– CAN é©±åŠ¨æ€§èƒ½çš„ä¸­æ–­å¤„ç†ï¼Œå¯ä»¥é€šè¿‡å®ç° NAPI æœºåˆ¶å’Œè°ƒæ•´ NAPI é¢„ç®—å€¼æ¥æ˜¾è‘—æé«˜æ•ˆç‡ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„å®ç°æ­¥éª¤å’Œç¤ºä¾‹ä»£ç ã€‚ ä½¿ç”¨ NAPI æœºåˆ¶å¤„ç†ä¸­æ–­ å®šä¹‰ NAPI ç»“æ„åœ¨é©±åŠ¨ç¨‹åºä¸­ï¼Œéœ€è¦é¦–å…ˆå®šä¹‰ä¸€ä¸ª napi_struct ç»“æ„ä½“ã€‚è¿™ä¸€ç»“æ„ä½“å°†æ‰¿è½½ä¸ NAPI ç›¸å…³çš„æ•°æ®å’ŒçŠ¶æ€ä¿¡æ¯ã€‚ struct napi_struct napi; åœ¨é©±åŠ¨åˆå§‹åŒ–æ—¶æ³¨å†Œ NAPIå½“é©±åŠ¨åˆå§‹åŒ–æ—¶ï¼Œé€šè¿‡ netif_napi_add å°† NAPI ç»“æ„æ·»åŠ åˆ°ç½‘ç»œè®¾å¤‡ä¸­ã€‚è¿™é‡Œï¼Œrockchip_can_poll æ˜¯å¤„ç†æ•°æ®åŒ…çš„è½®è¯¢å‡½æ•°ï¼ŒNAPI_POLL_WEIGHT æ˜¯åˆå§‹çš„é¢„ç®—å€¼ã€‚ netif_napi_add(dev, napi, rockchip_can_poll, NAPI_POLL_WEIGHT); ä¿®æ”¹ä¸­æ–­å¤„ç†å‡½æ•°æ¥ä¸‹æ¥ï¼Œéœ€ä¿®æ”¹ä¸­æ–­å¤„ç†å‡½æ•°ï¼Œç¡®ä¿åœ¨æ¥æ”¶åˆ°ä¸­æ–­åç¦ç”¨è®¾å¤‡ä¸­æ–­ï¼Œå¹¶è°ƒåº¦ NAPIã€‚ static irqreturn_t rockchip_can_interrupt(int irq, void *dev_id) struct net_device *dev = (struct net_device *)dev_id; struct rockchip_can *priv = netdev_priv(dev); // ç¦ç”¨è®¾å¤‡ä¸­æ–­ rockchip_can_disable_interrupts(priv); // è°ƒåº¦ NAPI if (napi_schedule_prep(priv-napi)) __napi_schedule(priv-napi); return IRQ_HANDLED; å®ç° NAPI è½®è¯¢å‡½æ•°åœ¨è½®è¯¢å‡½æ•°ä¸­ï¼Œå¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ã€‚å¦‚æœå¤„ç†çš„åŒ…æ•°é‡å°‘äºé¢„ç®—å€¼ï¼Œåˆ™å®Œæˆ NAPI è°ƒç”¨ï¼Œå¹¶é‡æ–°å¯ç”¨ä¸­æ–­ã€‚ static int rockchip_can_poll(struct napi_struct *napi, int budget) struct rockchip_can *priv = container_of(napi, struct rockchip_can, napi); int work_done = 0; // å¤„ç†æ¥æ”¶çš„æ•°æ®åŒ… work_done = rockchip_can_rx(priv, budget); // å¦‚æœå¤„ç†çš„åŒ…æ•°é‡å°äºé¢„ç®—ï¼Œå®Œæˆ NAPI if (work_done budget) napi_complete_done(napi, work_done); rockchip_can_enable_interrupts(priv); return work_done; è°ƒæ•´ NAPI é¢„ç®—å€¼ é€šè¿‡ sysfs æ¥å£åŠ¨æ€è°ƒæ•´ NAPI é¢„ç®—ä½¿ç”¨ sysfs æ¥å£å…è®¸ç”¨æˆ·åœ¨è¿è¡Œæ—¶è°ƒæ•´ NAPI çš„é¢„ç®—å€¼ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å†™å…¥æ–°å€¼æ¥åŠ¨æ€æ›´æ–°é¢„ç®—ã€‚ static ssize_t napi_budget_store(struct device *dev, struct device_attribute *attr, const char *buf, size_t count) struct net_device *ndev = to_net_dev(dev); struct rockchip_can *priv = netdev_priv(ndev); unsigned int budget; if (kstrtouint(buf, 0, budget)) return -EINVAL; priv-napi.weight = budget; // æ›´æ–° NAPI é¢„ç®— return count;static DEVICE_ATTR_WO(napi_budget);// åœ¨é©±åŠ¨åˆå§‹åŒ–æ—¶åˆ›å»º sysfs æ¥å£device_create_file(ndev-dev, dev_attr_napi_budget); æ ¹æ®å®é™…æ€§èƒ½æµ‹è¯•ç»“æœè°ƒæ•´é¢„ç®—å€¼æ ¹æ®å®é™…æµ‹è¯•ç»“æœé€æ­¥è°ƒæ•´é¢„ç®—ï¼Œåˆå§‹å€¼å¯ä»¥ä¸º 16 æˆ– 32 ç„¶åæ ¹æ®æ€§èƒ½åé¦ˆè¿›è¡Œå˜åŒ–ï¼Œç›´åˆ°æ‰¾åˆ°æœ€ä½³é…ç½®ã€‚ åŠ¨æ€è°ƒæ•´é¢„ç®—éšç€å¯¹è´Ÿè½½æƒ…å†µçš„ç›‘æ§ï¼Œå¯å®ç°åŠ¨æ€è°ƒæ•´ NAPI é¢„ç®—ã€‚æ¯”å¦‚å½“æ¥æ”¶æº¢å‡ºæ¬¡æ•°è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå¢åŠ é¢„ç®—ï¼›å½“æ²¡æœ‰æº¢å‡ºæ—¶ï¼Œå‡å°é¢„ç®—ã€‚ static void rockchip_can_adjust_napi_budget(struct rockchip_can *priv) if (priv-rx_overflow_count THRESHOLD) priv-napi.weight = min(priv-napi.weight * 2, MAX_NAPI_WEIGHT); else if (priv-rx_overflow_count == 0) priv-napi.weight = max(priv-napi.weight / 2, MIN_NAPI_WEIGHT); é€šè¿‡ä»¥ä¸Šä¼˜åŒ–æªæ–½ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘ä¸­æ–­çš„è§¦å‘é¢‘ç‡ï¼Œä»è€Œæå‡æ•´ä½“ç³»ç»Ÿæ€§èƒ½ã€‚åŒæ—¶ï¼Œåˆ©ç”¨çµæ´»çš„ NAPI é¢„ç®—è°ƒæ•´ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°å¹³è¡¡ä¸­æ–­å»¶è¿Ÿä¸æ•°æ®åŒ…ååé‡ï¼Œè¿™å¯¹ä¿éšœæ•°æ®é€šè®¯çš„é«˜æ•ˆæ€§è‡³å…³é‡è¦ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå»ºè®®è¿›è¡Œå……åˆ†çš„æµ‹è¯•å’Œè°ƒä¼˜ï¼Œä»¥ç¡®å®šæœ€é€‚åˆ Rockchip å¹³å°çš„ CAN é©±åŠ¨é…ç½®ã€‚ å¦‚ä½•åœ¨ Rockchip å¹³å°ä¸Šé…ç½® NAPI æ¥ä¼˜åŒ– CAN é©±åŠ¨æ€§èƒ½åœ¨ Rockchip å¹³å°ä¸Šé…ç½® NAPIï¼ˆNew APIï¼‰æ¥ä¼˜åŒ– CAN é©±åŠ¨æ€§èƒ½ï¼Œæ˜¯ä¸ºäº†æé«˜æ•°æ®å¤„ç†æ•ˆç‡å’Œé™ä½ä¸­æ–­å¼€é”€ã€‚é€šè¿‡ä»¥ä¸‹è¯¦ç»†æ­¥éª¤ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å®æ–½è¿™ä¸€é…ç½®ã€‚ 1. åœ¨é©±åŠ¨ç»“æ„ä½“ä¸­æ·»åŠ  NAPI ç»“æ„é¦–å…ˆï¼Œéœ€è¦åœ¨çš„é©±åŠ¨ç»“æ„ä½“ä¸­å¢åŠ  NAPI ç»“æ„ä½“ï¼Œä»¥ä¾¿ä¸º NAPI æä¾›æ‰€éœ€çš„çŠ¶æ€å’Œä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ struct rockchip_can // å…¶ä»–æˆå‘˜ï¼Œå¦‚è®¾å¤‡çŠ¶æ€ã€é…ç½®å‚æ•°ç­‰ struct napi_struct napi;; ä¾‹å­ï¼š* å‡è®¾å…¶ä»–æˆå‘˜åŒ…æ‹¬æ¥æ”¶ç¼“å†²åŒºæŒ‡é’ˆå’Œå‘é€ç¼“å†²åŒºæŒ‡é’ˆï¼Œé€šè¿‡ NAPIï¼Œå¯ä»¥é«˜æ•ˆåœ°å¤„ç†æ¥æ”¶å’Œå‘é€æ•°æ®åŒ…ã€‚ 2. åœ¨é©±åŠ¨åˆå§‹åŒ–å‡½æ•°ä¸­æ³¨å†Œ NAPIæ¥ä¸‹æ¥ï¼Œåœ¨é©±åŠ¨çš„åˆå§‹åŒ–å‡½æ•°ä¸­è¿›è¡Œ NAPI çš„æ³¨å†Œã€‚è¿™æ ·å¯ä»¥å°†çš„ NAPI å¤„ç†é€»è¾‘ä¸ç½‘ç»œè®¾å¤‡è”ç³»èµ·æ¥ã€‚ static int rockchip_can_probe(struct platform_device *pdev) // å…¶ä»–åˆå§‹åŒ–ä»£ç  struct net_device *ndev = platform_get_drvdata(pdev); struct rockchip_can *priv = netdev_priv(ndev); netif_napi_add(ndev, priv-napi, rockchip_can_poll, NAPI_POLL_WEIGHT); // NAPI_POLL_WEIGHT å¯ä»¥è®¾ç½®ä¸º 16 æˆ– 32 ä½œä¸ºåˆå§‹å€¼ æ³¨ï¼šNAPI_POLL_WEIGHT å®šä¹‰äº†å¤„ç†è½®è¯¢çš„æƒé‡ï¼Œæƒé‡è¶Šå¤§ï¼Œå¤„ç†èƒ½åŠ›è¶Šå¼ºï¼Œä½†ä¼šå¢åŠ  CPU ä½¿ç”¨ç‡ï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©åˆé€‚çš„å€¼ã€‚ 3. ä¿®æ”¹ä¸­æ–­å¤„ç†å‡½æ•°çš„ä¸­æ–­å¤„ç†å‡½æ•°éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œä»¥ä¾¿ç¦ç”¨å½“å‰è®¾å¤‡ä¸­æ–­å¹¶è°ƒåº¦ NAPIã€‚è¿™æ ·å¯ä»¥å°†ä¸­æ–­äº‹ä»¶è½¬åŒ–ä¸ºè½¯ä¸­æ–­å¤„ç†ï¼Œé™ä½ CPU çš„ä¸­æ–­å¤„ç†è´Ÿæ‹…ã€‚ static irqreturn_t rockchip_can_interrupt(int irq, void *dev_id) struct net_device *ndev = dev_id; struct rockchip_can *priv = netdev_priv(ndev); // ç¦ç”¨è®¾å¤‡ä¸­æ–­ rockchip_can_disable_interrupts(priv); // è°ƒåº¦NAPI napi_schedule(priv-napi); return IRQ_HANDLED; ä¾‹å­ï¼š* é€šè¿‡è°ƒç”¨ rockchip_can_disable_interrupts() å‡½æ•°ï¼Œå¯ä»¥ç¡®ä¿åœ¨å¤„ç†ä¸­æ–­æ—¶ä¸ä¼šè°ƒåº¦æ›´å¤šä¸­æ–­ï¼Œæœ‰åŠ©äºé›†ä¸­å¤„ç†å·²ç»æ¥æ”¶çš„æ•°æ®ã€‚ 4. å®ç° NAPI è½®è¯¢å‡½æ•°æ¥ç€ï¼Œéœ€è¦å®ç°å®é™…çš„ NAPI è½®è¯¢å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å°†å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ï¼Œå¹¶åœ¨éœ€è¦çš„æƒ…å†µä¸‹é‡æ–°å¯ç”¨ä¸­æ–­ã€‚ static int rockchip_can_poll(struct napi_struct *napi, int budget) struct rockchip_can *priv = container_of(napi, struct rockchip_can, napi); int work_done = 0; // å¤„ç†æ¥æ”¶çš„æ•°æ®åŒ… work_done = rockchip_can_rx(priv, budget); if (work_done budget) napi_complete(napi); rockchip_can_enable_interrupts(priv); return work_done; æ³¨ï¼š* é€šè¿‡æ¯”è¾ƒ work_done å’Œ budget çš„å€¼ï¼Œæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦åœæ­¢è½®è¯¢å¹¶é‡æ–°å¯ç”¨ä¸­æ–­ã€‚ 5. æ·»åŠ åŠ¨æ€è°ƒæ•´ NAPI é¢„ç®—çš„åŠŸèƒ½ä¸ºè¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼Œæ·»åŠ åŠ¨æ€è°ƒæ•´ NAPI é¢„ç®—çš„èƒ½åŠ›ã€‚ä¾èµ–äºæ¥æ”¶æº¢å‡ºè®¡æ•°çš„æƒ…å†µæ¥è°ƒæ•´ NAPI çš„æƒé‡ï¼Œèƒ½å¤Ÿåœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹ä¼˜åŒ–æ€§èƒ½ã€‚ static void rockchip_can_adjust_napi_budget(struct rockchip_can *priv) if (priv-rx_overflow_count THRESHOLD) priv-napi.weight = min(priv-napi.weight * 2, MAX_NAPI_WEIGHT); else if (priv-rx_overflow_count == 0) priv-napi.weight = max(priv-napi.weight / 2, MIN_NAPI_WEIGHT); ä¾‹å­ï¼š* å¦‚æœè®¾ç½®çš„é˜ˆå€¼ä¸º 100ï¼Œå½“ rx_overflow_count è¶…è¿‡è¿™ä¸ªå€¼æ—¶ï¼ŒNAPI çš„æƒé‡ä¼šå¢å¤§ï¼Œä»¥åº”å¯¹æµé‡å¢åŠ ã€‚ 6. åœ¨é©±åŠ¨çš„æ¥æ”¶å‡½æ•°ä¸­è°ƒç”¨åŠ¨æ€è°ƒæ•´å‡½æ•°æœ€åï¼Œç¡®ä¿åœ¨æ¥æ”¶æ•°æ®åŒ…çš„å‡½æ•°ä¸­è°ƒç”¨åŠ¨æ€è°ƒæ•´å‡½æ•°ï¼Œä»¥ä¾¿è‡ªé€‚åº”å½“å‰çš„ç½‘ç»œè´Ÿè½½æƒ…å†µã€‚ static int rockchip_can_rx(struct rockchip_can *priv, int limit) // æ¥æ”¶å¤„ç†é€»è¾‘ // ... rockchip_can_adjust_napi_budget(priv); return processed; æ³¨ï¼š* åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œä¸ä»…è¦å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ï¼Œè¿˜è¦å®æ—¶è°ƒæ•´ NAPI çš„é¢„ç®—ä»¥åº”å¯¹å˜åŒ–ã€‚ é€šè¿‡ä»¥ä¸Šé…ç½®ï¼ŒNAPI æœºåˆ¶å¯ä»¥æœ‰æ•ˆå‡å°‘ä¸­æ–­é¢‘ç‡ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚åŠ¨æ€è°ƒæ•´ NAPI é¢„ç®—çš„èƒ½åŠ›ä½¿å¾—åœ¨ä¸åŒè´Ÿè½½æƒ…å†µä¸‹éƒ½èƒ½ä¿æŒè‰¯å¥½çš„æ€§èƒ½ã€‚ åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒåŠ¡å¿…æ ¹æ®å…·ä½“çš„ Rockchip å¹³å°å’Œ CAN æ§åˆ¶å™¨çš„ç‰¹æ€§è¿›è¡Œæ·±å…¥è°ƒè¯•å’Œä¼˜åŒ–ã€‚åŒæ—¶ï¼Œè¿›è¡Œå…¨é¢çš„æ€§èƒ½æµ‹è¯•æ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™æ ·å¯ä»¥æ‰¾åˆ°æœ€ä½³çš„ NAPI é…ç½®å‚æ•°ï¼Œä¸ºæœ€ç»ˆç”¨æˆ·æä¾›ç¨³å®šå’Œé«˜æ•ˆçš„ç½‘ç»œæœåŠ¡ã€‚ CAN é©±åŠ¨åœ¨ Rockchip å¹³å°ä¸Šçš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³•åœ¨ Rockchip å¹³å°ä¸Šä¼˜åŒ– CAN é©±åŠ¨æ€§èƒ½æ˜¯ä¸€ä¸ªå¤šæ–¹é¢çš„å·¥ä½œï¼Œå¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªå…³é”®é¢†åŸŸç€æ‰‹ï¼š ä¸­æ–­å¤„ç†ä¼˜åŒ– åº”ç”¨ NAPI æœºåˆ¶NAPIï¼ˆNew APIï¼‰æœºåˆ¶å¯ä»¥æœ‰æ•ˆåœ°å¤„ç†ä¸­æ–­ï¼Œå‡å°‘ç³»ç»Ÿä¸­çš„ä¸­æ–­é¢‘ç‡ã€‚ä¾‹å¦‚ï¼Œé‡‡ç”¨ NAPI å¯å°†ä¸­æ–­å¤„ç†ä¸­æ–­åçš„æ•°æ®åŒ…å¤„ç†è½¬ç§»åˆ°åº•åŠéƒ¨ï¼Œè¿™æ ·æœ‰åŠ©äºé™ä½ CPU è´Ÿæ‹…ï¼Œæå‡ç³»ç»Ÿçš„æ€»ä½“æ€§èƒ½ã€‚ è°ƒæ•´ NAPI é¢„ç®—å€¼åœ¨ NAPI å·¥ä½œä¸­ï¼Œé¢„ç®—å€¼çš„è®¾ç½®å¯¹æ€§èƒ½æœ‰é‡è¦å½±å“ã€‚åˆç†åœ°è°ƒæ•´è¿™ä¸ªå€¼ï¼Œå¯ä»¥åœ¨ä¿æŒä½å»¶è¿Ÿçš„åŒæ—¶ï¼Œå¢åŠ ä¸šåŠ¡ååé‡ã€‚ä¾‹å¦‚ï¼Œå°†é¢„ç®—å€¼è®¾å®šä¸ºè¾ƒé«˜çš„æ•°å­—ï¼Œä»¥ä¾¿åœ¨æµé‡é«˜å³°æ—¶è¿›è¡Œæ‰¹é‡å¤„ç†ï¼Œä»è€Œå‡å°‘ä¸­æ–­çš„è§¦å‘é¢‘ç‡ã€‚ DMA ä¼ è¾“ å¯ç”¨ DMA æ¨¡å¼ä½¿ç”¨ DMAï¼ˆç›´æ¥å†…å­˜è®¿é—®ï¼‰ä¼ è¾“æ¨¡å¼ï¼Œå¯ä»¥è®©æ•°æ®åœ¨å¤–è®¾ä¸å†…å­˜ä¹‹é—´è¿›è¡Œé«˜æ•ˆä¼ é€ï¼Œæ˜¾è‘—å‡å°‘ CPU çš„å¹²é¢„ã€‚é‡‡ç”¨ DMA åï¼ŒCPU å¯ä¸“æ³¨äºå…¶ä»–ä»»åŠ¡ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ•°æ®ä¼ è¾“éƒ½è¦ä»‹å…¥ã€‚ ä¼˜åŒ– DMA ç¼“å†²åŒºè®¾ç½®æ ¹æ®åº”ç”¨ç±»å‹ï¼Œåˆç†è®¾ç½® DMA çš„ç¼“å†²åŒºå¤§å°å’Œæ•°é‡ä¹Ÿè‡³å…³é‡è¦ã€‚ä¾‹å¦‚ï¼Œåœ¨é«˜é¢‘ç‡æ•°æ®ä¼ è¾“åœºæ™¯ä¸­ï¼Œå¯ä»¥å¢å¤§ç¼“å†²åŒºæ¥é€‚åº”æ•°æ®æµï¼Œåä¹‹ï¼Œåœ¨è¾ƒä½é¢‘ç‡åœºæ™¯ä¸­ï¼Œé€‚åº¦å‡å°ç¼“å†²åŒºåˆ™æœ‰åŠ©äºæé«˜å“åº”é€Ÿåº¦ã€‚ ç¡¬ä»¶è¿‡æ»¤å™¨é…ç½® åˆç†é…ç½®ç¡¬ä»¶è¿‡æ»¤å™¨åˆç†ä½¿ç”¨ CAN æ§åˆ¶å™¨çš„ç¡¬ä»¶è¿‡æ»¤å™¨ï¼Œå¯ä»¥å‡å°‘æ— å…³æ•°æ®åŒ…çš„å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è®¾ç½®è¿‡æ»¤è§„åˆ™ï¼Œä»…æ¥æ”¶ç‰¹å®š ID çš„æ•°æ®åŒ…ï¼Œä»è€Œé¿å…ç³»ç»Ÿå¤„ç†å¤§é‡æ— å…³ä¿¡æ¯ï¼Œæå‡æ•´ä½“æ¥æ”¶æ•ˆç‡ã€‚ ç¼“å†²åŒºä¼˜åŒ– è°ƒæ•´ FIFO æ·±åº¦FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ç¼“å†²åŒºçš„æ·±åº¦è®¾ç½®ç›´æ¥å½±å“æ•°æ®å¤„ç†èƒ½åŠ›ã€‚åœ¨è®¾å¤‡æ ‘é…ç½®ä¸­ï¼Œç”¨æˆ·å¯ä»¥è®¾å®š: tx-fifo-depth = 1;rx-fifo-depth = 6; æ ¹æ®å…·ä½“åº”ç”¨éœ€æ±‚ï¼Œå¯ä»¥é€‚å½“å¢åŠ è¿™äº›å€¼ã€‚ä¾‹å¦‚ï¼Œåœ¨éœ€è¦é«˜æ•°æ®ååé‡çš„åœºæ™¯ä¸­ï¼Œå°†å‘é€ FIFO æ·±åº¦æé«˜åˆ° 8 æˆ– 12 å¯èƒ½æœ‰åˆ©äºæå‡æ€§èƒ½ã€‚ æ—¶é’Ÿå’Œæ³¢ç‰¹ç‡ä¼˜åŒ– é€‰æ‹©åˆé€‚çš„æ—¶é’Ÿæºé€‰æ‹©é€‚åˆçš„æ—¶é’Ÿæºå’Œåˆ†é¢‘æ¯”éå¸¸é‡è¦ï¼Œä»¥ç¡®ä¿ CAN æ€»çº¿çš„æ³¢ç‰¹ç‡ç²¾å‡†ã€‚å¦‚åœ¨æŸäº›åº”ç”¨ä¸­ï¼Œé«˜è¾¾ 1Mbps çš„æ³¢ç‰¹ç‡èƒ½å¤Ÿåœ¨æ•°æ®ä¼ è¾“çš„åŠæ—¶æ€§å’Œå¯é æ€§ä¹‹é—´å–å¾—è¾ƒå¥½çš„å¹³è¡¡ã€‚ é©±åŠ¨ä»£ç ä¼˜åŒ– ä½¿ç”¨å†…è”å‡½æ•°é€šè¿‡ä½¿ç”¨å†…è”å‡½æ•°ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€ï¼Œä½¿æ€§èƒ½æå‡æ›´åŠ æ˜æ˜¾ã€‚ç‰¹åˆ«æ˜¯åœ¨é«˜é¢‘è°ƒç”¨çš„åœºæ™¯ä¸‹ï¼Œè¿™ç§æ–¹æ³•èƒ½æœ‰æ•ˆé™ä½å»¶è¿Ÿã€‚ ä¼˜åŒ–æ•°æ®ç»“æ„å’Œç®—æ³•åœ¨é©±åŠ¨çš„å…³é”®è·¯å¾„ä¸­ï¼Œæ”¹å–„æ•°æ®ç»“æ„å’Œç®—æ³•æœ‰åŠ©äºæé«˜æ•°æ®å¤„ç†é€Ÿåº¦ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡é‡‡ç”¨æ›´é€‚åˆçš„å“ˆå¸Œè¡¨ç»“æ„ï¼Œå¯ä»¥æé«˜æ£€ç´¢æ•ˆç‡ï¼Œå‡å°‘è®¡ç®—å¼€é”€ã€‚ å†…æ ¸å‚æ•°è°ƒä¼˜ è°ƒæ•´å†…æ ¸è°ƒåº¦å™¨å‚æ•°é€‚å½“è°ƒæ•´å†…æ ¸çš„è°ƒåº¦å™¨å‚æ•°ï¼Œå¦‚ä¼˜å…ˆçº§å’Œæ—¶é—´ç‰‡ï¼Œå¯ä»¥ä¼˜åŒ– CAN é©±åŠ¨çš„å“åº”æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œå°† CAN ä»»åŠ¡çš„ä¼˜å…ˆçº§è®¾ç½®ä¸ºæ¯”å…¶ä»–éå®æ—¶ä»»åŠ¡æ›´é«˜ï¼Œä»¥ç¡®ä¿æ•°æ®å¤„ç†çš„åŠæ—¶æ€§ã€‚ è€ƒè™‘å®æ—¶å†…æ ¸è¡¥ä¸å¼•å…¥ PREEMPT_RT å®æ—¶å†…æ ¸è¡¥ä¸èƒ½å¢åŠ ç³»ç»Ÿçš„å®æ—¶æ€§ï¼Œä½¿ CAN é©±åŠ¨åœ¨æ•°æ®äº¤äº’æ—¶æ›´åŠ è¿…é€Ÿã€ç¨³å®šã€‚ ç¡¬ä»¶åŠ é€Ÿ å¯ç”¨ç¡¬ä»¶ CRC æ ¡éªŒåŠŸèƒ½å¦‚æœ Rockchip å¹³å°æ”¯æŒç¡¬ä»¶ CRC æ ¡éªŒï¼Œå¯ä»¥å°†è¿™ä¸€åŠŸèƒ½å¯ç”¨ï¼Œä»è€Œå‡è½» CPU çš„è´Ÿæ‹…ã€‚ç¡¬ä»¶ CRC æ ¡éªŒèƒ½å¿«é€Ÿã€é«˜æ•ˆåœ°éªŒè¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œæå‡é€šä¿¡çš„å¯é æ€§ã€‚ å¤šè·¯ CAN ä¼˜åŒ– ä½¿ç”¨ä¸­æ–­äº²å’Œæ€§å¯¹äºå¤šè·¯ CAN æ¥å£ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ä¸­æ–­äº²å’Œæ€§ï¼ˆIRQ affinityï¼‰å°†å„ä¸ª CAN æ§åˆ¶å™¨çš„ä¸­æ–­åˆ†åˆ«åˆ†é…ç»™ä¸åŒçš„ CPU æ ¸å¿ƒã€‚è¿™ç§æ–¹å¼èƒ½æœ‰æ•ˆåˆ†æ•£å¤„ç†è´Ÿæ‹…ï¼Œæå‡æ•´ä½“ç³»ç»Ÿçš„å¹¶è¡Œå¤„ç†èƒ½åŠ›ã€‚ æ€§èƒ½ç›‘æ§å’Œè°ƒè¯• ä½¿ç”¨å†…æ ¸è·Ÿè¸ªå·¥å…·åº”ç”¨å†…æ ¸è·Ÿè¸ªå·¥å…·å¦‚ ftraceï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…æ·±å…¥åˆ†æé©±åŠ¨æ€§èƒ½çš„ç“¶é¢ˆæ‰€åœ¨ã€‚é€šè¿‡è¿™äº›å·¥å…·ï¼Œå¼€å‘è€…å¯ä»¥è¯†åˆ«å‡ºä½•æ—¶ã€ä½•åœ°å‘ç”Ÿäº†æ€§èƒ½ä¸‹é™ï¼Œä»è€Œè¿…é€Ÿåšå‡ºè°ƒæ•´ã€‚ ç›‘æ§ CAN é”™è¯¯è®¡æ•°å™¨å®šæœŸç›‘æ§ CAN é”™è¯¯è®¡æ•°å™¨ï¼Œæœ‰åŠ©äºåŠæ—¶å‘ç°å’Œå¤„ç†é€šä¿¡é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œè‹¥å‘ç°é”™è¯¯åŒ…é¢‘ç‡æ€¥å‰§ä¸Šå‡ï¼Œè¡¨æ˜å¯èƒ½å­˜åœ¨ç¡¬ä»¶æ•…éšœæˆ–é…ç½®é—®é¢˜ï¼Œéœ€åŠæ—¶æ£€æŸ¥ã€‚ é€šè¿‡ä»¥ä¸Šå›Šæ‹¬ä¸­æ–­å¤„ç†ã€DMA ä¼ è¾“ã€ç¡¬ä»¶é…ç½®ç­‰å¤šæ–¹é¢çš„ä¼˜åŒ–æ–¹æ³•ï¼Œç”¨æˆ·å¯ä»¥æ˜¾è‘—æå‡ Rockchip å¹³å°ä¸Š CAN é©±åŠ¨çš„æ€§èƒ½ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…·ä½“çš„ä¼˜åŒ–æ•ˆæœå¯èƒ½ä¼šå› ä¸åŒçš„ç¡¬ä»¶é…ç½®å’Œåº”ç”¨åœºæ™¯è€Œå¼‚ã€‚å› æ­¤ï¼Œå»ºè®®ç”¨æˆ·åœ¨çœŸå®ç¯å¢ƒä¸­è¿›è¡Œè¯¦ç»†çš„æµ‹è¯•å’Œç›®æ ‡è°ƒä¼˜ï¼Œä»¥ä¾¿è·å¾—æœ€ä½³æ€§èƒ½ã€‚","categories":["4.é€šè®¯åè®®","CAN"]},{"title":"Rockchip CANé©±åŠ¨åŠé…ç½®","path":"/2023/12/22/4-é€šè®¯åè®®-CAN-Rockchip-CANé©±åŠ¨åŠé…ç½®/","content":"è®¾å¤‡æ ‘è§£æcan1: can@fe580000 compatible = rockchip,canfd-1.0;\treg = 0x0 0xfe580000 0x0 0x1000;\tinterrupts = GIC_SPI 2 IRQ_TYPE_LEVEL_HIGH;\tclocks = cru CLK_CAN1, cru PCLK_CAN1;\tclock-names = baudclk, apb_pclk;\tresets = cru SRST_CAN1, cru SRST_P_CAN1;\treset-names = can, can-apb;\ttx-fifo-depth = 1;\trx-fifo-depth = 6;\tstatus = disabled;;can1 /omit-if-no-ref/\tcan1m0_pins: can1m0-pins rockchip,pins = /* can1_rxm0 */ 1 RK_PA0 3 pcfg_pull_none, /* can1_txm0 */ 1 RK_PA1 3 pcfg_pull_none;\t;\t/omit-if-no-ref/\tcan1m1_pins: can1m1-pins rockchip,pins = /* can1_rxm1 */ 4 RK_PC2 3 pcfg_pull_none, /* can1_txm1 */ 4 RK_PC3 3 pcfg_pull_none;\t;;can1 assigned-clocks = cru CLK_CAN1;\tassigned-clock-rates = 150000000;\tpinctrl-names = default;\tpinctrl-0 = can1m1_pins;\tstatus = okay;; æ­¤è®¾å¤‡æ ‘ç‰‡æ®µæä¾›äº† Rockchip CAN1 æ¥å£çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶åŸºå€ã€ä¸­æ–­è®¾ç½®ã€æ—¶é’Ÿæºã€å¼•è„šé…ç½®å’ŒçŠ¶æ€ã€‚åœ¨è®¾å¤‡åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼ŒLinux å†…æ ¸å°†ä½¿ç”¨æ­¤è®¾å¤‡æ ‘ç‰‡æ®µæ¥è®¾ç½®å’Œç®¡ç† CAN1 æ¥å£ã€‚ è®¾å¤‡èŠ‚ç‚¹å®šä¹‰can1: can@fe580000 æè¿°ï¼šè¿™æ˜¯ä¸€ä¸ªåä¸º can1 çš„è®¾å¤‡èŠ‚ç‚¹ï¼Œæ ‡è¯†ä¸ºåœ°å€ 0xfe580000ã€‚è¯¥èŠ‚ç‚¹è´Ÿè´£æè¿° CAN1 æ§åˆ¶å™¨çš„ç¡¬ä»¶ç‰¹æ€§ã€‚è¿™æ˜¯è®¾å¤‡æ ‘ä¸­çš„é‡è¦éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒæ ‡è¯†äº†ä¸€ä¸ªç‰¹å®šçš„ç¡¬ä»¶èµ„æºã€‚ ä¸»è¦å±æ€§è§£æ compatible å®šä¹‰ï¼šcompatible = rockchip,canfd-1.0; ä½œç”¨ï¼šæŒ‡å®šæ”¯æŒè¯¥è®¾å¤‡èŠ‚ç‚¹çš„é©±åŠ¨ç¨‹åºã€‚è¿™é‡Œçš„å­—ç¬¦ä¸²â€rockchip,canfd-1.0â€è¡¨æ˜è¯¥è®¾å¤‡ç¬¦åˆ Rockchip æä¾›çš„ CAN FD ç‰ˆæœ¬ 1.0 çš„é©±åŠ¨è¦æ±‚ã€‚è¿™æœ‰åŠ©äºæ“ä½œç³»ç»Ÿé€‰æ‹©åˆé€‚çš„é©±åŠ¨ç¨‹åºè¿›è¡Œè®¾å¤‡åˆå§‹åŒ–å’Œç®¡ç†ã€‚ reg å®šä¹‰ï¼šreg = 0x0 0xfe580000 0x0 0x1000; ä½œç”¨ï¼šæ˜ç¡®äº†è®¾å¤‡å¯„å­˜å™¨çš„å†…å­˜åœ°å€å’Œå¤§å°ã€‚å¯„å­˜å™¨è¢«æ˜ å°„è‡³åœ°å€ 0xfe580000ï¼Œå¹¶å ç”¨ 0x1000 å­—èŠ‚ï¼Œç¡®ä¿ CPU èƒ½å¤Ÿä¸è¯¥ç¡¬ä»¶è®¾å¤‡é€šä¿¡ã€‚ interrupts å®šä¹‰ï¼šinterrupts = GIC_SPI 2 IRQ_TYPE_LEVEL_HIGH; ä½œç”¨ï¼šé…ç½®ä¸­æ–­ä¿¡æ¯ï¼Œè¡¨æ˜è¯¥è®¾å¤‡å…³è”åˆ°é€šç”¨ä¸­æ–­æ§åˆ¶å™¨ï¼ˆGICï¼‰ï¼Œä½¿ç”¨ SPIï¼ˆå…±äº«å¤–è®¾ä¸­æ–­ï¼‰ç¼–å·ä¸º 2ï¼Œå¹¶ä¸”ä¸­æ–­ç±»å‹ä¸ºç”µå¹³è§¦å‘ï¼Œå…·æœ‰é«˜ç”µå¹³æœ‰æ•ˆç‰¹æ€§ã€‚è¿™ç§é…ç½®ç¡®ä¿è®¾å¤‡èƒ½åœ¨å‘ç”Ÿé‡è¦äº‹ä»¶æ—¶åŠæ—¶å“åº”ç³»ç»Ÿã€‚ clocks å’Œ clock-names å®šä¹‰ï¼šclocks = cru CLK_CAN1, cru PCLK_CAN1; ä½œç”¨ï¼šå®šä¹‰æ­¤è®¾å¤‡æ‰€éœ€çš„æ—¶é’Ÿä¿¡å·ã€‚CLK_CAN1 ç”¨äºæ³¢ç‰¹ç‡ç”Ÿæˆï¼ˆâ€baudclkâ€ï¼‰ï¼Œè€Œ PCLK_CAN1 æ˜¯ APBï¼ˆå¤–è®¾æ€»çº¿ï¼‰çš„æ—¶é’Ÿä¿¡å·ã€‚è¿™æœ‰åŠ©äºæ§åˆ¶ CAN1 çš„è¿è¡Œé¢‘ç‡ã€‚ resets å’Œ reset-names å®šä¹‰ï¼šresets = cru SRST_CAN1, cru SRST_P_CAN1; ä½œç”¨ï¼šæŒ‡å®šç”¨äºå¤ä½è¯¥è®¾å¤‡çš„æ§åˆ¶çº¿ï¼Œå…¶ä¸­ SRST_CAN1 æ§åˆ¶ CAN1ï¼ŒSRST_P_CAN1 æ§åˆ¶ APB æ¥å£ã€‚è¿™ç¡®ä¿è®¾å¤‡èƒ½å¤Ÿåœ¨ç³»ç»Ÿå¯åŠ¨æˆ–æ•…éšœæƒ…å†µä¸‹å¤ä½ã€‚ tx-fifo-depth å’Œ rx-fifo-depth å®šä¹‰ï¼štx-fifo-depth = 1; å’Œ rx-fifo-depth = 6; ä½œç”¨ï¼šè®¾å®šå‘é€å’Œæ¥æ”¶ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ç¼“å†²åŒºçš„æ·±åº¦ã€‚å‘é€ç¼“å†²åŒºæ·±åº¦ä¸º 1ï¼Œæ„å‘³ç€å‘é€æ—¶æœ€å¤šä»…å¯å­˜æ”¾ä¸€ä¸ªæ•°æ®åŒ…ï¼›è€Œæ¥æ”¶ç¼“å†²åŒºæ·±åº¦ä¸º 6ï¼Œå…è®¸æ¥æ”¶å¤šè¾¾å…­ä¸ªæ•°æ®åŒ…ï¼Œæœ‰åŠ©äºæå‡æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚ status å®šä¹‰ï¼šstatus = disabled; ä½œç”¨ï¼šåˆå§‹çŠ¶æ€è®¾ä¸ºâ€ç¦ç”¨â€ï¼ŒæŒ‡ç¤ºè®¾å¤‡åœ¨å¯åŠ¨æ—¶ä¸å¤„äºæ´»è·ƒçŠ¶æ€ï¼Œè¿™å¯¹äºç³»ç»Ÿèµ„æºçš„æœ‰æ•ˆç®¡ç†è‡³å…³é‡è¦ã€‚ å¼•è„šé…ç½®can1ï¼ˆè®¾å¤‡èŠ‚ç‚¹å†…éƒ¨ï¼‰ æè¿°ï¼šå®šä¹‰æ­¤ CAN1 æ¥å£çš„å…·ä½“å¼•è„šé…ç½®ã€‚è¿™éƒ¨åˆ†ç¡®ä¿æŒ‡å®šæ­£ç¡®çš„å¼•è„šä»¥ä¾›è®¾å¤‡æ­£å¸¸é€šä¿¡ã€‚ can1m0_pins å®šä¹‰ï¼šcan1m0_pins: can1m0-pins ...; å†…å®¹ï¼š å¼•è„šå®šä¹‰ï¼š 1 RK_PA0 3 pcfg_pull_none, /* can1_rxm0 */1 RK_PA1 3 pcfg_pull_none; /* can1_txm0 */ æè¿°ï¼šé…ç½®äº† can1_rxm0 å’Œ can1_txm0 çš„å¼•è„šï¼Œåˆ†åˆ«å¯¹åº” RK_PA0 å’Œ RK_PA1ï¼Œå¹¶ä¸”ç¦æ­¢ä½¿ç”¨ä¸Šæ‹‰æˆ–ä¸‹æ‹‰ç”µé˜»ï¼Œè¿™ç§æ–¹å¼ç¡®ä¿ä¿¡å·çš„å‡†ç¡®æ€§ã€‚ can1m1_pins å®šä¹‰ï¼šcan1m1_pins: can1m1-pins ...; å†…å®¹ï¼š å¼•è„šå®šä¹‰ï¼š 4 RK_PC2 3 pcfg_pull_none, /* can1_rxm1 */4 RK_PC3 3 pcfg_pull_none; /* can1_txm1 */ æè¿°ï¼šé…ç½®äº† can1_rxm1 å’Œ can1_txm1 çš„å¼•è„šï¼Œåˆ†åˆ«ä¸ RK_PC2 å’Œ RK_PC3 å…³è”ï¼ŒåŒæ ·é€‰æ‹©ä¸å¯ç”¨æ‹‰ç”µé˜»ï¼Œä»¥ç¡®ä¿æ•°æ®ä¼ è¾“çš„ç¨³å®šæ€§ã€‚ è®¾å¤‡èŠ‚ç‚¹çš„é™„åŠ å±æ€§can1 æè¿°ï¼šå¼•ç”¨ä¹‹å‰å®šä¹‰çš„ can1 è®¾å¤‡èŠ‚ç‚¹ï¼Œæä¾›é¢å¤–çš„è®¾å¤‡é…ç½®ã€‚ assigned-clocks å®šä¹‰ï¼šassigned-clocks = cru CLK_CAN1; ä½œç”¨ï¼šå°†æ—¶é’Ÿä¿¡å· CLK_CAN1 åˆ†é…äºˆæ­¤è®¾å¤‡èŠ‚ç‚¹ï¼Œä»¥ç¡®ä¿æ—¶é’Ÿæºæ­£ç¡®é…ç½®ã€‚ assigned-clock-rates å®šä¹‰ï¼šassigned-clock-rates = 150000000; ä½œç”¨ï¼šæŒ‡å®šè®¾å¤‡çš„æ—¶é’Ÿé€Ÿç‡ä¸º 150,000,000 Hzã€‚ç¡®ä¿ CAN1 åœ¨é«˜é€Ÿæ¨¡å¼ä¸‹è¿ä½œï¼Œæœ‰åŠ©äºå¤„ç†é«˜é€Ÿæ•°æ®æµã€‚ pinctrl-names å’Œ pinctrl-0 å®šä¹‰ï¼š pinctrl-names = default; pinctrl-0 = can1m1_pins; ä½œç”¨ï¼šè®¾ç½®å¼•è„šæ§åˆ¶çš„åç§°ä¸ºâ€defaultâ€ï¼Œå°†å¼•è„šé…ç½®å¼•ç”¨è‡³ can1m1_pinsï¼Œç¡®ä¿åœ¨åˆå§‹åŒ–æ—¶é€‰ç”¨æ­£ç¡®çš„å¼•è„šé…ç½®ã€‚ status å®šä¹‰ï¼šstatus = okay; ä½œç”¨ï¼šæ ‡è¯† CAN1 æ¥å£çš„çŠ¶æ€ä¸ºâ€æ­£å¸¸â€ï¼Œè¡¨æ˜è®¾å¤‡å·²å‡†å¤‡å¥½æŠ•å…¥ä½¿ç”¨ã€‚ è¿™ä¸ªè®¾å¤‡æ ‘ç‰‡æ®µæä¾›äº†è¯¦å°½çš„é…ç½®å’ŒåŠŸèƒ½è¯´æ˜ï¼Œä¸º Rockchip CAN1 æ¥å£çš„åˆå§‹åŒ–å’Œä½¿ç”¨æä¾›äº†å¿…è¦åŸºç¡€ï¼Œç¡®ä¿é©±åŠ¨èƒ½å¤Ÿæ­£ç¡®è¯†åˆ«å’Œæ“ä½œç›¸å…³ç¡¬ä»¶è®¾å¤‡ã€‚ é©±åŠ¨ç¨‹åºè¯¥é©±åŠ¨ç¨‹åºä¸»è¦é€‚ç”¨äº Linux å†…æ ¸ç‰ˆæœ¬ 5.10.110ï¼Œä»£ç æ–‡ä»¶ä½äºè·¯å¾„ linux-5.10/drivers/net/can/rockchip/rockchip_canfd.cã€‚è¯¥é©±åŠ¨ç¨‹åºæ”¯æŒé€šè¿‡ Controller Area Network (CAN) è¿›è¡Œé«˜æ•ˆçš„é€šä¿¡ï¼Œå°¤å…¶æ˜¯åœ¨åµŒå…¥å¼å’Œæ±½è½¦ç”µå­é¢†åŸŸã€‚ æ³¨å†Œéƒ¨åˆ†åœ¨æ³¨å†Œéƒ¨åˆ†ï¼Œå®šä¹‰äº†ä¸€ä¸ªè®¾å¤‡æ ‘åŒ¹é…è¡¨ rockchip_canfd_of_matchï¼Œè¿™ä¸ªè¡¨åŒ…å«äº†å¤šä¸ªä¸ç‰¹å®šè®¾å¤‡å…¼å®¹çš„æ¡ç›®ã€‚ä»¥ä¸‹æ˜¯å…·ä½“çš„ä»£ç ç¤ºä¾‹ï¼š static const struct of_device_id rockchip_canfd_of_match[] = .compatible = rockchip,canfd-1.0, .data = (void *)ROCKCHIP_CANFD_MODE\t, .compatible = rockchip,can-2.0, .data = (void *)ROCKCHIP_CAN_MODE\t, .compatible = rockchip,rk3568-can-2.0, .data = (void *)ROCKCHIP_RK3568_CAN_MODE\t,\t, // ç»“æŸæ ‡è®°ï¼Œè¡¨æ˜è¿™ä¸ªæ•°ç»„æ²¡æœ‰æ›´å¤šçš„æ¡ç›®; è®¾å¤‡å…¼å®¹æ€§ rockchip,canfd-1.0ï¼šä»£è¡¨æ”¯æŒæ–°ä¸€ä»£ CAN-FD åè®®ï¼Œèƒ½å¤Ÿå¤„ç†æ›´é«˜æ•°æ®é€Ÿç‡å’Œæ›´å¤§çš„æ•°æ®å¸§ã€‚ rockchip,can-2.0ï¼šä»£è¡¨æ›´åŠ ä¼ ç»Ÿçš„ CAN 2.0 åè®®ï¼Œå¹¿æ³›åº”ç”¨äºè½¦è¾†å’Œå·¥ä¸šæ§åˆ¶ä¸­ã€‚ rockchip,rk3568-can-2.0ï¼šä»£è¡¨ Rockchip RK3568 èŠ¯ç‰‡çš„ç‰¹å®šå…¼å®¹æ€§ï¼Œé€‚ç”¨äºä¸­é«˜ç«¯è®¡ç®—å¹³å°å’Œè‡ªåŠ¨åŒ–ç³»ç»Ÿã€‚ é©±åŠ¨ç¨‹åºç»“æ„å®šä¹‰static struct platform_driver rockchip_canfd_driver = .driver = .name = DRV_NAME, // æ ‡è¯†é©±åŠ¨ç¨‹åºçš„åç§° .pm = rockchip_canfd_dev_pm_ops, // ç”µæºç®¡ç†æ“ä½œ .of_match_table = rockchip_canfd_of_match, // è®¾å¤‡åŒ¹é…è¡¨\t,\t.probe = rockchip_canfd_probe, // æ¢æµ‹å‡½æ•°\t.remove = rockchip_canfd_remove, // ç§»é™¤å‡½æ•°; ç»“æ„å­—æ®µè¯´æ˜ .driverï¼šåŒ…å«ä¸é©±åŠ¨ç¨‹åºç›¸å…³çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶åç§°ã€åŠŸè€—ç®¡ç†å’Œå…¼å®¹æ€§æ£€æµ‹ã€‚ .nameï¼šé€šè¿‡ DRV_NAME æŒ‡å®šé©±åŠ¨ç¨‹åºçš„åç§°ã€‚è¿™ä¸ªåå­—é€šå¸¸åœ¨å…¶ä»–ä»£ç ä¸­è¢«å®šä¹‰ã€‚ .pmï¼šæŒ‡å‘ç”µæºç®¡ç†ç›¸å…³æ“ä½œå‡½æ•°çš„æŒ‡é’ˆï¼Œé€šå¸¸ç”¨äºç®¡ç†è®¾å¤‡çš„ç”µæºçŠ¶æ€ï¼Œä¾‹å¦‚è¿›å…¥ä½åŠŸè€—æ¨¡å¼æ—¶çš„æ“ä½œã€‚ .of_match_tableï¼šæŒ‡å‘è®¾å¤‡æ ‘åŒ¹é…è¡¨çš„æŒ‡é’ˆï¼Œç”¨æ¥ç¡®å®šå“ªäº›è®¾å¤‡å¯ä»¥ç”±è¯¥é©±åŠ¨ç¨‹åºç®¡ç†ã€‚ .probeï¼šæŒ‡å‘å®é™…è¿›è¡Œè®¾å¤‡åˆå§‹åŒ–çš„å‡½æ•° rockchip_canfd_probeã€‚è¯¥å‡½æ•°å°†è¢«è°ƒç”¨ä»¥è®¾ç½®è®¾å¤‡å¹¶æ³¨å†Œå®ƒåˆ°ç³»ç»Ÿä¸­ã€‚ .removeï¼šæŒ‡å‘æ¸…ç†è®¾å¤‡çš„å‡½æ•° rockchip_canfd_removeï¼Œç”¨äºç®¡ç†è®¾å¤‡çš„å¸è½½è¿‡ç¨‹ï¼Œç¡®ä¿èµ„æºå¾—åˆ°é€‚å½“å›æ”¶ã€‚ é©±åŠ¨ç¨‹åºæ¨¡å—æ³¨å†Œmodule_platform_driver(rockchip_canfd_driver); è¿™ä¸ªå®çš„ä½œç”¨æ˜¯å°†å®šä¹‰å¥½çš„ rockchip_canfd_driver æ³¨å†Œåˆ°å†…æ ¸ä¸­ã€‚ä¸€æ—¦è¿™ä¸ªæ¨¡å—è¢«åŠ è½½ï¼Œå†…æ ¸ä¼šè‡ªåŠ¨è°ƒç”¨å®šä¹‰çš„ probe å‡½æ•°æ¥åˆå§‹åŒ–ç›¸åº”çš„è®¾å¤‡ã€‚è¿™ä¸€è¿‡ç¨‹è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒç¡®ä¿é©±åŠ¨ç¨‹åºèƒ½å¤Ÿæ­£ç¡®åœ°ä¸ç¡¬ä»¶è¿›è¡Œäº¤äº’ï¼Œå¹¶ä¸ºç”¨æˆ·æä¾›ç¨³å®šçš„æ“ä½œç•Œé¢ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œé©±åŠ¨ç¨‹åºå¯ä»¥æœ‰æ•ˆåœ°ä¸ç³»ç»Ÿé€šä¿¡ï¼Œç¡®ä¿è®¾å¤‡æ­£å¸¸è¿è¡Œï¼Œå¹¶åˆ©ç”¨ CAN æ€»çº¿è¿›è¡Œé«˜æ•ˆæ•°æ®ä¼ è¾“ã€‚ æ¢æµ‹è®¾å¤‡çš„è¿‡ç¨‹è®¾å¤‡çš„åç§°ä¸º rockchip,canfd-1.0ã€‚å½“è®¾å¤‡æ ‘åŠ è½½æ—¶ï¼Œå¯ä»¥æ‰¾åˆ°ä¸å…¶ç›¸åŒ¹é…çš„é©±åŠ¨ç¨‹åºï¼Œå¹¶è¿›ä¸€æ­¥è°ƒç”¨ rockchip_canfd_probe å‡½æ•°ã€‚æ­¤å‡½æ•°çš„ä¸»è¦ç›®çš„æ˜¯è®¾ç½®å¹¶æ³¨å†Œè®¾å¤‡ï¼Œä»¥ä¾¿ Linux å†…æ ¸èƒ½å¤Ÿä¸ Rockchip CANFD æ§åˆ¶å™¨è¿›è¡Œæœ‰æ•ˆçš„é€šä¿¡ã€‚ static int rockchip_canfd_probe(struct platform_device *pdev) ... IRQ è·å–å’Œå†…å­˜æ˜ å°„ IRQ çš„è·å– irq = platform_get_irq(pdev, 0); æ­¤æ­¥éª¤è·å– Rockchip CANFD æ§åˆ¶å™¨çš„ä¸­æ–­å·ã€‚ä¸­æ–­æ˜¯ç”¨æ¥å‘ CPU é€šçŸ¥å‘ç”Ÿäº†éœ€è¦å¤„ç†çš„é‡è¦äº‹ä»¶çš„ä¿¡å·ã€‚å¦‚æœæ— æ³•æ­£ç¡®è·å–ä¸­æ–­å·ï¼Œå°†ä¼šæ‰“å°é”™è¯¯æ¶ˆæ¯ï¼Œè¿”å›é”™è¯¯ä»£ç ã€‚ èµ„æºä¿¡æ¯å’Œè™šæ‹Ÿåœ°å€æ˜ å°„ res = platform_get_resource(pdev, IORESOURCE_MEM, 0); é€šè¿‡è¯¥è°ƒç”¨ï¼Œè®¾å¤‡è·å–å…¶ç›¸å…³çš„å†…å­˜èµ„æºä¿¡æ¯ï¼Œé€šå¸¸åŒ…æ‹¬è®¾å¤‡çš„ç‰©ç†åœ°å€èŒƒå›´ã€‚ addr = devm_ioremap_resource(pdev-dev, res);if (IS_ERR(addr)) return -EBUSY; devm_ioremap_resource å‡½æ•°ä¼šå°†è®¾å¤‡çš„ç‰©ç†åœ°å€æ˜ å°„åˆ°å†…æ ¸çš„è™šæ‹Ÿåœ°å€ä¸­ã€‚å¦‚æœæ­¤æ˜ å°„å¤±è´¥ï¼Œå°±è¿”å›é”™è¯¯ä»£ç ã€‚ CAN è®¾å¤‡çš„å†…å­˜åˆ†é…ndev = alloc_candev(sizeof(struct rockchip_canfd), 1);if (!ndev) dev_err(pdev-dev, could not allocate memory for CANFD device ); return -ENOMEM; ä½¿ç”¨ alloc_candev å‡½æ•°ä¸º CAN è®¾å¤‡åˆ†é…å†…å­˜ã€‚åœ¨è¿™æ¡è¯­å¥ä¸­ï¼Œåˆ†é…äº†ä¸€ä¸ªå¤§å°ä¸º sizeof(struct rockchip_canfd) çš„å†…å­˜å—ï¼Œç”¨äºå­˜å‚¨è®¾å¤‡çš„ä¿¡æ¯ã€‚å¦‚æœåˆ†é…å¤±è´¥ï¼Œåˆ™è¿”å›å†…å­˜ä¸è¶³çš„é”™è¯¯ã€‚ ä¸­æ–­å¤„ç†å’Œå¤ä½æ§åˆ¶ ä¸­æ–­å¤„ç†å‡½æ•°çš„æ³¨å†Œ err = devm_request_irq(pdev-dev, irq, rockchip_canfd_interrupt, 0, ndev-name, ndev); è¿™è¡Œä»£ç é€šè¿‡ devm_request_irq å‡½æ•°æ³¨å†Œäº†ä¸€ä¸ªä¸­æ–­å¤„ç†å‡½æ•° rockchip_canfd_interrupt ä»¥å¤„ç†ç›¸åº”çš„ä¸­æ–­äº‹ä»¶ã€‚å¦‚æœæ³¨å†Œå¤±è´¥ï¼Œç³»ç»Ÿä¼šæ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œå¹¶è¿”å›é”™è¯¯ä»£ç ã€‚ å¤ä½æ§åˆ¶çº¿çš„è·å– rcan-reset = devm_reset_control_array_get(pdev-dev, false, false);if (IS_ERR(rcan-reset)) if (PTR_ERR(rcan-reset) != -EPROBE_DEFER) dev_err(pdev-dev, failed to get canfd reset lines ); return PTR_ERR(rcan-reset); æ­¤ä»£ç ç”¨äºè·å– CAN æ§åˆ¶å™¨çš„å¤ä½çº¿ã€‚å¦‚æœè·å–å¤±è´¥ï¼Œå°†ä¼šæ‰“å°ç›¸åº”çš„é”™è¯¯ä¿¡æ¯å¹¶è¿”å›ã€‚ æ—¶é’Ÿä¿¡æ¯çš„è·å–ä¸é¢‘ç‡çš„è®¾ç½®rcan-num_clks = devm_clk_bulk_get_all(pdev-dev, rcan-clks);if (rcan-num_clks 1) return -ENODEV; æ­¤å¤„ä»è®¾å¤‡ä¸­è·å–ä¸ CAN æ§åˆ¶å™¨ç›¸å…³çš„æ‰€æœ‰æ—¶é’Ÿä¿¡æ¯ã€‚å¦‚æœè·å–å¤±è´¥ï¼Œåˆ™è¿”å›ä¸€ä¸ªè®¾å¤‡æ— æ•ˆçš„é”™è¯¯ã€‚ åˆå§‹åŒ– CAN é…ç½®rcan-mode = (unsigned long)of_device_get_match_data(pdev-dev); é€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œä»è®¾å¤‡æ ‘ä¸­è·å–äº†æœ‰æ•ˆçš„åŒ¹é…æ•°æ®ï¼Œä»¥ç¡®å®šæ§åˆ¶å™¨çš„å·¥ä½œæ¨¡å¼ã€‚åˆå§‹åŒ– rcan ç»“æ„ä½“çš„å„ä¸ªå­—æ®µä¹‹åï¼ŒåŸºç¡€è®¾å¤‡ä¿¡æ¯è¢«å­˜å…¥ã€‚ æ ¹æ®ä¸åŒçš„å·¥ä½œæ¨¡å¼ï¼ˆä¾‹å¦‚ ROCKCHIP_CANFD_MODE å’Œ ROCKCHIP_CAN_MODEï¼‰ï¼Œè®¾ç½®ä¸åŒçš„æ§åˆ¶å™¨å‚æ•°ï¼Œå†³å®š CAN æ§åˆ¶çš„å·¥ä½œæ¨¡å¼ã€æ•°æ®ä½é€Ÿç‡é…ç½®ç­‰ã€‚ switch (rcan-mode) case ROCKCHIP_CANFD_MODE: // è®¾ç½® FD æ¨¡å¼çš„å‚æ•° break; case ROCKCHIP_CAN_MODE: // è®¾ç½®å¸¸è§„ CAN æ¨¡å¼çš„å‚æ•° break; default: return -EINVAL; ç½‘ç»œè®¾å¤‡æ“ä½œ ä¸ºè®¾å¤‡è®¾ç½®ç½‘ç»œæ“ä½œï¼Œä¾‹å¦‚æŒ‡å®šçš„ç½‘ç»œè®¾å¤‡æ“ä½œ ndev-netdev_ops = rockchip_canfd_netdev_ops;ï¼Œå¹¶ä¸ºè®¾å¤‡è¿›è¡Œå„ç§ç½‘ç»œè®¾å¤‡ç›¸å…³çš„åˆå§‹åŒ–æ“ä½œã€‚ è®¾å¤‡æ³¨å†Œå’Œè¿è¡Œæ—¶ç®¡ç†è®¾å¤‡çš„è¿è¡Œæ—¶ç®¡ç†è¢«å¯ç”¨ï¼Œéšåå°è¯•åŒæ­¥è·å–ç”µæºã€‚æ³¨å†Œ CAN è®¾å¤‡ä¹Ÿæ˜¯éå¸¸å…³é”®çš„ä¸€æ­¥ã€‚ err = register_candev(ndev);if (err) dev_err(pdev-dev, registering %s failed (err=%d) , DRV_NAME, err); goto err_disableclks; è¿™æ®µä»£ç æ‰§è¡Œè®¾å¤‡æ³¨å†Œï¼Œç¡®ä¿ CAN è®¾å¤‡èƒ½ä½œä¸ºç½‘ç»œè®¾å¤‡æ­£å¸¸è¿è¥ã€‚å¦‚æœæ³¨å†Œå¤±è´¥ï¼Œå³ä½¿æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œä¹Ÿè¦ç¡®ä¿è®¾å¤‡çš„ç”µæºç®¡ç†å¾—åˆ°å¦¥å–„å¤„ç†ï¼Œæœ€ç»ˆç¡®ä¿èµ„æºçš„åˆç†é‡Šæ”¾ã€‚","categories":["4.é€šè®¯åè®®","CAN"]},{"title":"FreeModbus åè®®","path":"/2023/12/21/4-é€šè®¯åè®®-Modbus-FreeModbus-åè®®/","content":"FreeMODBUS æä¾›äº† RTUASCII ä¼ è¾“æ¨¡å¼åŠ TCP åè®®æ”¯æŒã€‚FreeModbus éµå¾ª BSD è®¸å¯è¯ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·å¯ä»¥å°† FreeModbus åº”ç”¨äºå•†ä¸šç¯å¢ƒä¸­ã€‚ æ–‡ä»¶ç»“æ„V1.6 ç‰ˆæœ¬æ”¯æŒä¸»æœºä¸ä»æœºåœ¨åŒä¸€åè®®æ ˆä¸­å¹¶è¡Œè¿è¡Œã€‚å®ƒè¿˜æ”¯æŒåœ¨å®æ—¶æ“ä½œç³»ç»Ÿå’Œè£¸æœºç¯å¢ƒä¸‹çš„ç§»æ¤ï¼Œä»¥åŠå¤šç§è¯·æ±‚æ¨¡å¼ä¾›ç”¨æˆ·é€‰æ‹©ï¼Œæ¯”å¦‚é˜»å¡ä¸éé˜»å¡æ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰è¶…æ—¶æ—¶é—´ï¼Œè¿™åœ¨æŸç§ç¨‹åº¦ä¸Šä¸ºåº”ç”¨å±‚æä¾›äº†çµæ´»çš„è°ƒç”¨æ–¹å¼ã€‚åŒæ—¶ï¼Œè¯¥åè®®æ ˆæ”¯æŒæ‰€æœ‰å¸¸ç”¨çš„ Modbus æ–¹æ³•ã€‚ ä»¥ä¸‹æ˜¯æºæ–‡ä»¶ä¸€è§ˆåŠå…¶æè¿°ï¼š æºæ–‡ä»¶ æè¿° FreeModbus\\modbus\\mb.c æä¾› Modbus ä»æœºè®¾ç½®åŠè½®è¯¢ç›¸å…³æ¥å£ FreeModbus\\modbus\\ascii\\mbascii.c ASCII æ¨¡å¼è®¾ç½®åŠçŠ¶æ€æœº FreeModbus\\modbus\\functions\\mbfunccoils.c ä»æœºçº¿åœˆç›¸å…³åŠŸèƒ½ FreeModbus\\modbus\\functions\\mbfuncdisc.c ä»æœºç¦»æ•£è¾“å…¥ç›¸å…³åŠŸèƒ½ FreeModbus\\modbus\\functions\\mbfuncholding.c ä»æœºä¿æŒå¯„å­˜å™¨ç›¸å…³åŠŸèƒ½ FreeModbus\\modbus\\functions\\mbfuncinput.c ä»æœºè¾“å…¥å¯„å­˜å™¨ç›¸å…³åŠŸèƒ½ FreeModbus\\modbus\\functions\\mbfuncother.c å…¶ä½™ Modbus åŠŸèƒ½ FreeModbus\\modbus\\functions\\mbutils.c ä¸€äº›åè®®æ ˆä¸­éœ€è¦çš„å°å·¥å…· FreeModbus\\modbus\\rtu\\mbcrc.c CRC æ ¡éªŒåŠŸèƒ½ FreeModbus\\modbus\\rtu\\mbrtu.c ä»æœº RTU æ¨¡å¼è®¾ç½®åŠçŠ¶æ€æœº FreeModbus\\modbus\\tcp\\mbtcp.c TCP æ¨¡å¼è®¾ç½®åŠçŠ¶æ€æœº FreeModbus\\port\\port.c å®ç°ç¡¬ä»¶ç§»æ¤çš„æ¥å£ FreeModbus\\port\\portevent.c å®ç°ä»æœºäº‹ä»¶çš„ç§»æ¤æ¥å£ FreeModbus\\port\\portserial.c ä»æœºä¸²å£ç§»æ¤ FreeModbus\\port\\porttimer.c ä»æœºå®šæ—¶å™¨ç§»æ¤ FreeModbus\\port\\user_mb_app.c å®šä¹‰ä»æœºæ•°æ®ç¼“å†²åŒºï¼ŒåŒ…å«ä»æœº Modbus åŠŸèƒ½çš„å›è°ƒæ¥å£ æ³¨ï¼šæ‰€æœ‰å¸¦æœ‰ _m åç¼€çš„æ–‡ä»¶ä¸ºä¸»æœºæ¨¡å¼å¿…éœ€ä½¿ç”¨çš„æ–‡ä»¶ï¼Œè‹¥ä½¿ç”¨ä»æœºæ¨¡å¼ï¼Œåˆ™æ— éœ€è€ƒè™‘è¿™äº›æ–‡ä»¶ã€‚ ä¸»æœºæµç¨‹æ‰€æœ‰çš„é…ç½®å‚æ•°å­˜æ”¾åœ¨ FreeModbus\\modbus\\include\\mbconfig.h æ–‡ä»¶ä¸­ã€‚å½“å‰åè®®æ ˆæ”¯æŒä¸»æœºå’Œä»æœºä¸¤ç§æ¨¡å¼ï¼Œå¹¶å…è®¸åŒæ—¶å¯ç”¨è¿™ä¸¤ç§æ¨¡å¼ã€‚ä»æœºæ”¯æŒ Modbus RTU Modbus ASCII å’Œ Modbus TCPï¼Œè€Œä¸»æœºç›®å‰ä»…æ”¯æŒå¸¸è§çš„ Modbus RTU æ¨¡å¼ã€‚åœ¨è®¾ç½®è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å…³æ³¨å¹¿æ’­çš„è½¬æ¢å»¶æ—¶æ—¶é—´ å‘½ä»¤å“åº”çš„è¶…æ—¶æ—¶é—´ä»¥åŠä»æœºçš„æ•°é‡ã€‚è¯·æ³¨æ„ï¼Œç°åœ¨åè®®æ ˆåªæ”¯æŒè¿ç»­çš„ä»æœºåœ°å€ï¼Œä¸”ä»æœºåœ°å€çš„èµ·å§‹å€¼ä¸º 1ã€‚ ä½¿ç”¨ä¸»æœºå‰ï¼Œéœ€å°†åè®®æ ˆæ•´åˆè‡³é¡¹ç›®ä¸­ï¼ŒåŒ…æ‹¬ç›¸å…³è½¯ä»¶å’Œç¡¬ä»¶éƒ¨åˆ†ã€‚ç§»æ¤å®Œæˆåçš„æµç¨‹å¦‚ä¸‹ï¼š è°ƒç”¨ eMBMasterInit æ–¹æ³•åˆå§‹åŒ– Modbus ä¸»æœºåè®®æ ˆï¼ŒåŒæ—¶è¿›è¡Œç›¸å…³ç¡¬ä»¶çš„åˆå§‹åŒ–ã€‚ è°ƒç”¨ eMBMasterEnable æ–¹æ³•å¯åŠ¨ Modbus ä¸»æœºã€‚ åœ¨ä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹æˆ–å®šæ—¶å™¨ä¸­ï¼Œä»¥ä¸€å®šçš„è½®è¯¢å‘¨æœŸå‘¨æœŸæ€§è°ƒç”¨ eMBMasterPoll æ–¹æ³•ï¼Œå†³å®šå‘½ä»¤çš„å“åº”æ—¶é—´ã€‚ åˆ©ç”¨ä¸»æœºè¯·æ±‚ API æ–¹æ³•å¹¶è®¾å®šè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ã€‚è¯¥æ–¹æ³•åœ¨å¾—åˆ°ç»“æœä¹‹å‰ä¸ä¼šè¿”å›ã€‚å¦‚æœæ–¹æ³•æ‰§è¡ŒæˆåŠŸï¼Œä¸”ä¸ºè¯»å–å‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡ Modbus ä¸»æœºçš„æ•°æ®ç¼“å†²åŒºè·å–æ›´æ–°åçš„ä»æœºæ•°æ®ã€‚ å¼‚å¸¸å¤„ç†ä¸»è¦åœ¨ä¸»æœºæ­£å¸¸ä½¿ç”¨æ—¶å‡ºç°ã€‚é’ˆå¯¹é”™è¯¯ç ï¼Œç”¨æˆ·éœ€ç»“åˆäº§å“ç‰¹æ€§é‡‡å–ç›¸åº”çš„å¤„ç†æªæ–½ã€‚å»ºè®®ç”¨æˆ·å®ç°ä¸»æœºè¯·æ±‚æ–¹æ³•çš„é‡å‘æœºåˆ¶ï¼Œä»¥å¢å¤§å“åº”æˆåŠŸçš„å‡ ç‡ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œåœ¨æ”¶åˆ°å¸§æ•°æ®é”™è¯¯æˆ–å‘½ä»¤å“åº”è¶…æ—¶çš„æƒ…å†µä¸‹ï¼Œéœ€è¦è¿›è¡Œé‡å‘ã€‚é‡å‘æ¬¡æ•°åº”è‡ªå¢ï¼Œè‹¥è¶…è¿‡è®¾å®šé˜ˆå€¼ï¼Œåˆ™æ ‡è®°è¯¥ä»æœºæ‰çº¿ï¼Œæœªæ¥çš„æ‰€æœ‰è¯·æ±‚å°†ä¼šè¢«æ‹¦æˆªã€‚è€Œè‹¥åœ¨ç¬¬äºŒæ¬¡é‡å‘å‘½ä»¤æ—¶æ”¶åˆ°æœ‰æ•ˆå“åº”ï¼Œåˆ™é‡å‘æ¬¡æ•°å°†è¢«é‡ç½®ä¸ºé›¶ã€‚ç”¨æˆ·ä¹Ÿå¯é€‰æ‹©è°ƒç”¨ä¸»æœºè¯·æ±‚æ–¹æ³•æˆ– FreeModbus\\port\\portevent_m.c ä¸­çš„å›è°ƒæ¥å£ï¼Œçµæ´»å®ç°åŠŸèƒ½ã€‚ ä»æœºæµç¨‹FreeModbus æ˜¯åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„åè®®ã€‚åè®®é€šè¿‡æ£€æµ‹ç›¸åº”çš„æ¶ˆæ¯æ¥å®Œæˆå¯¹åº”åŠŸèƒ½ã€‚åè®®æ ˆçš„åˆå§‹åŒ–åŠè¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆï¼Œè°ƒç”¨ eMBInit(eMBMode eMode, UCHAR ucSlaveAddress, UCHAR ucPort, ULONG ulBaudRate, eMBParity eParity) å®Œæˆç‰©ç†å±‚è®¾å¤‡çš„åˆå§‹åŒ–ã€‚è¿™ä¸€è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š BOOL xMBPortSerialInit(UCHAR ucPORT, ULONG ulBaudRate, UCHAR ucDataBits, eMBParity eParity)ï¼šè¿›è¡Œä¸²å£åˆå§‹åŒ–ï¼Œè®¾å®šæ³¢ç‰¹ç‡ã€æ•°æ®ä½æ•°åŠæ ¡éªŒæ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†æ³¢ç‰¹ç‡è®¾ç½®ä¸º 9600ï¼Œæ•°æ®ä½æ•°è®¾ä¸º 8 ä½ï¼Œæ— æ ¡éªŒä½ã€‚ BOOL xMBPortTimersInit(USHORT usTim1Timerout50us)ï¼šè¿›è¡Œå®šæ—¶å™¨åˆå§‹åŒ–ï¼Œè®¾å®š T35 å®šæ—¶æ‰€éœ€çš„å®šæ—¶å™¨å¸¸æ•°ã€‚ è°ƒç”¨å‡½æ•°ï¼ˆæ­¤æ­¥éª¤éå¿…éœ€ï¼‰ï¼š eMBSetSlaveID(UCHAR ucSlaveID, BOOL xIsRunning, UCHAR const *pucAdditional, USHORT usAdditionalLen)ï¼šç”¨ä»¥æŒ‡å®šè®¾å¤‡ IDï¼Œç¡®ä¿åœ¨æ€»çº¿ä¸Šçš„æ¯ä¸ªä»æœºéƒ½æœ‰å”¯ä¸€æ ‡è¯†ã€‚ æ¥ä¸‹æ¥ï¼Œè°ƒç”¨ eMBEnable(void) ä»¥ä½¿èƒ½åè®®æ ˆï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªé‡è¦æ­¥éª¤ï¼š static pvMBFrameStart pvMBFrameStartCurï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼šåè®®æ ˆåˆå§‹åŒ–ï¼Œå°† eRcvState è®¾ä¸º STATE_RX_INIT çŠ¶æ€ã€‚ è°ƒç”¨ void vMBPortSerialEnable(BOOL xRxEnable, BOOL xTxEnable)ï¼šè¿™ä¸€æ­¥ä½¿èƒ½æ¥æ”¶å’Œå‘é€åŠŸèƒ½ã€‚ é€šè¿‡ void vMBPortTimersEnable(void)ï¼šä½¿èƒ½è¶…æ—¶å®šæ—¶å™¨ä»¥ä¾¿æ£€æµ‹æ•°æ®æ¥æ”¶çŠ¶æ€ã€‚ ä¸€æ—¦è¶…æ—¶å®šæ—¶å™¨è¢«ä½¿èƒ½ï¼Œç»è¿‡ T35 æ—¶é—´åï¼Œå°†å‘ç”Ÿç¬¬ä¸€æ¬¡è¶…æ—¶ä¸­æ–­ã€‚åœ¨ä¸­æ–­è¿‡ç¨‹ä¸­ï¼Œå‘åè®®æ ˆå‘é€æ¶ˆæ¯ EV_READYï¼ˆStartup finishedï¼‰ã€‚åŒæ—¶ï¼Œé€šè¿‡è°ƒç”¨ void vMBPortTimersDisable(void) å…³é—­è¶…æ—¶å®šæ—¶å™¨ï¼Œå¹¶å°† eRcvState è®¾ä¸º STATE_RX_IDLEï¼Œæ­¤æ—¶åè®®æ ˆå·²å‡†å¤‡æ¥æ”¶ä¸²å£æ•°æ®ã€‚ æ³¨æ„ï¼šä¹‹æ‰€ä»¥é¦–å…ˆå¯ç”¨è¶…æ—¶å®šæ—¶å™¨ï¼Œæ˜¯å› ä¸ºåœ¨åˆå§‹åŒ–å®Œæˆæ—¶ï¼Œä¸²å£å¯èƒ½å·²ç»æœ‰å¾…æ¥æ”¶çš„æ•°æ®ã€‚ä¸ºäº†é¿å…è¯¯åˆ¤ç¬¬ä¸€ä¸ªæ•°æ®ä¸ºè¯·æ±‚çš„å¼€å§‹ï¼Œåè®®æ ˆè®¾ç½®ç­‰å¾… T35 æ—¶é—´ï¼Œä»¥ä¾¿æ˜ç¡®æ¥æ”¶ä¸‹ä¸€å¸§è¯·æ±‚ã€‚ ä¸»å‡½æ•°è°ƒç”¨ eMBPoll(void) æ¥æ£€æµ‹äº‹ä»¶ã€‚å¦‚æœå‘ç”Ÿä¸²å£æ¥æ”¶ä¸­æ–­ä¸” eRcvState ä¸º STATE_RX_IDLEï¼ˆåœ¨ç¬¬ 4 æ­¥ä¸­å·²è®¾å®šä¸ºè¯¥çŠ¶æ€ï¼‰ï¼Œåˆ™æ¥æ”¶åˆ°çš„å­—ç¬¦å°†å­˜å…¥æ¥æ”¶ç¼“å­˜ä¸­ï¼Œå¹¶å°† eRcvState çŠ¶æ€æ›´æ–°ä¸º STATE_RX_RCVï¼ŒåŒæ—¶æ¸…é›¶è¶…æ—¶å®šæ—¶å™¨ã€‚åœ¨éšåçš„æ•°æ®åˆ°è¾¾æ—¶ï¼Œä¼šç»§ç»­å°†æ•°æ®å­˜å…¥æ¥æ”¶ç¼“å­˜å¹¶é‡ç½®è¶…æ—¶å®šæ—¶å™¨ã€‚ å¦‚æœæœªæ¥æ”¶åˆ°å®Œæ•´æ•°æ®ï¼Œåˆ™ä¸ä¼šè§¦å‘è¶…æ—¶ä¸­æ–­ã€‚è¶…æ—¶ä¸­æ–­çš„å‘ç”ŸæŒ‡ç¤º T35 æ—¶é—´å†…æœªæ”¶åˆ°æ–°çš„ä¸²å£æ•°æ®ï¼Œæ ¹æ® Modbus åè®®çš„è§„å®šï¼Œè¿™è¡¨ç¤ºä¸€å¸§è¯·æ±‚æ•°æ®çš„æ¥æ”¶å·²å®Œæˆã€‚åœ¨æ­¤ä¸­æ–­ä¸­ï¼Œåè®®æ ˆæ¥æ”¶åˆ°æ¶ˆæ¯ EV_FRAME_RECEIVEDï¼ˆFrame receivedï¼‰ï¼Œç„¶åç­‰å¾…åè®®æ ˆå¤„ç†æ­¤æ¶ˆæ¯ã€‚ ä¸»å‡½æ•°éšåå†æ¬¡è°ƒç”¨ eMBPoll(void)ï¼Œå¦‚æœæ£€æµ‹åˆ°äº‹ä»¶ EV_FRAME_RECEIVEDï¼Œå°†è°ƒç”¨ static peMBFrameReceive peMBFrameReceiveCur ä»¥ç®€å•åˆ¤æ–­è¯·æ±‚å¸§æ•°æ®ï¼Œå¹¶å‘åè®®æ ˆå‘é€æ¶ˆæ¯ EV_EXECUTEï¼ˆExecute functionï¼‰ã€‚ å½“ä¸»å‡½æ•°è°ƒç”¨ eMBPoll(void) è¿›ä¸€æ­¥æ£€æµ‹åˆ°äº‹ä»¶ EV_EXECUTEï¼Œæ ¹æ®ç›¸åº”çš„è¯·æ±‚ä»£ç æŸ¥æ‰¾å¤„ç†è¯¥åŠŸèƒ½çš„å‡½æ•°æŒ‡é’ˆå¹¶æ‰§è¡Œå¤„ç†ã€‚è‹¥è¯·æ±‚ä¸æ˜¯å¹¿æ’­æ¶ˆæ¯ï¼Œåˆ™ä¼šè°ƒç”¨ static peMBFrameSend peMBFrameSendCur æ¥å‘é€å›å¤æ¶ˆæ¯ã€‚åœ¨è¿™ä¸€å‡½æ•°ä¸­ï¼Œä»…å°†éœ€å›å¤çš„æ•°æ®å¤åˆ¶åˆ°ä¸²å£ç¼“å­˜ï¼Œå¹¶å°† eSndState è®¾ä¸º STATE_TX_XMITï¼ˆTransmitter is in transfer stateï¼‰ã€‚æ¥ç€ï¼Œè°ƒç”¨ void vMBPortSerialEnable(BOOL xRxEnable, BOOL xTxEnable) ä½¿èƒ½å‘é€ä¸­æ–­ã€‚å‘é€ä¸­æ–­ä½¿èƒ½åï¼Œç”±äºä¸²å£å‘é€å¯„å­˜å™¨é€šå¸¸ä¸ºç©ºï¼Œå› æ­¤ä½¿èƒ½ä¹‹åå°†ç›´æ¥è¿›å…¥å‘é€ä¸­æ–­å¤„ç†ã€‚ åœ¨å‘é€ä¸­æ–­ä¸­ï¼Œå¦‚æœ eSndState ä¸º STATE_TX_XMITï¼ˆåœ¨ç¬¬ 7 æ­¥ä¸­å·²è®¾ç½®ä¸ºæ­¤çŠ¶æ€ï¼‰ï¼Œåˆ™å°†ä¸²å£ç¼“å­˜ä¸­çš„æ•°æ®å‘é€å‡ºå»ï¼Œå¹¶æŒç»­ç»Ÿè®¡å‘é€å­—ç¬¦çš„æ•°é‡ã€‚å½“å‘é€å®Œæˆåï¼Œåè®®æ ˆä¼šæ¥æ”¶åˆ°æ¶ˆæ¯ EV_FRAME_SENTï¼ˆFrame sentï¼‰ã€‚ ä¸»å‡½æ•°å†æ¬¡è°ƒç”¨ eMBPoll(void) ä»¥æ£€æµ‹åˆ°äº‹ä»¶ EV_FRAME_SENT åï¼Œä¸å¯¹è¯¥æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚ å½“ä¸²å£å†æ¬¡æ¥æ”¶åˆ°æ•°æ®åï¼Œåè®®æ ˆå°†é‡å¤æ­¥éª¤ 6 è‡³ 9 ä»¥å¤„ç†æ¶ˆæ¯ã€‚ ç§»æ¤åè®®æ ˆç§»æ¤ä¸»è¦åŒ…æ‹¬ç¡¬ä»¶å’Œè½¯ä»¶ä¸¤ä¸ªæ–¹é¢ã€‚ä»¥ä¸‹æ‰€æœ‰è¯´æ˜ä¸»è¦é’ˆå¯¹ Modbus ä¸»æœºæ¨¡å¼ã€‚è½¯ä»¶æ–¹é¢ï¼Œæ”¯æŒåœ¨è£¸æœºå’Œå®æ—¶æ“ä½œç³»ç»Ÿä¸­ç§»æ¤ã€‚è¯¥åè®®æ ˆå…è®¸å•ä¸ªä¸»æœºä¸å•ä¸ªä»æœºç‹¬ç«‹è¿è¡Œã€‚æ­¤å¤–ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹åè®®æ ˆçš„äº‹ä»¶å›è°ƒæ¥å£ï¼Œé€‰æ‹©é˜»å¡æˆ–éé˜»å¡æ¨¡å¼ï¼Œè®¾ç½®ä¸»æœºèµ„æºçš„ç­‰å¾…æ—¶é™ç­‰ã€‚ è½¯ä»¶åœ¨æ“ä½œç³»ç»Ÿç§»æ¤è¿‡ç¨‹ä¸­ï¼Œéœ€å…³æ³¨ä»¥ä¸‹æ–‡ä»¶ï¼šFreeModbus\\port\\portevent_m.cã€‚æ­¤æ–‡ä»¶åŒ…å«éœ€è¦ç”¨æˆ·ç§»æ¤çš„æ¥å£ã€‚åŸºäºæ“ä½œç³»ç»Ÿçš„ç§»æ¤ä¸»è¦éœ€è¦åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹åŒæ­¥æŠ€æœ¯ï¼ŒModbus åè®®æ ˆå¯å€ŸåŠ©æ“ä½œç³»ç»Ÿè‡ªå¸¦çš„äº‹ä»¶æœºåˆ¶å®ç°äº‹ä»¶çš„å‘é€ é€šçŸ¥ä¸ç­‰å¾…ã€‚ä¸»æœºè¯·æ±‚çš„çº¿ç¨‹ä¸ Modbus åè®®æ ˆçº¿ç¨‹ï¼ˆModbus Poll çº¿ç¨‹ï¼‰éœ€é€šè¿‡äº‹ä»¶æœºåˆ¶å®ŒæˆåŒæ­¥ã€‚æ­¤å¤–ï¼Œä¸»æœºçš„èµ„æºå ç”¨éœ€å¼•å…¥ä¿¡å·é‡æœºåˆ¶ï¼Œé»˜è®¤å€¼ä¸º 1ï¼Œä¿¡å·é‡ç¡®ä¿å¤šçº¿ç¨‹åŒæ—¶å‘é€è¯·æ±‚æ—¶ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä½¿ç”¨ä¸»æœºã€‚ åœ¨è£¸æœºç§»æ¤ç¯å¢ƒä¸‹ï¼Œäº‹ä»¶é€šçŸ¥æœºåˆ¶éœ€é€šè¿‡è½¯ä»¶æ¨¡æ‹Ÿæ¥å®ç°ï¼Œå› æ­¤äº‹ä»¶ç­‰å¾…å’Œèµ„æºç­‰å¾…éƒ½å¿…é¡»ä¾èµ–ç”¨æˆ·è‡ªå®šä¹‰çš„å»¶æ—¶ä¸æ ‡å¿—å˜é‡ï¼Œå…¶å¤æ‚ç¨‹åº¦é€šå¸¸é«˜äºæ“ä½œç³»ç»Ÿæ¨¡å¼ä¸‹çš„çº¿ç¨‹åŒæ­¥ã€‚ RT-Thread æ¥å£ åŠŸèƒ½æè¿° xMBMasterPortEventInit ä¸»æœºäº‹ä»¶åˆå§‹åŒ– xMBMasterPortEventPost ä¸»æœºå‘é€äº‹ä»¶ xMBMasterPortEventGet ä¸»æœºè·å–äº‹ä»¶ vMBMasterOsResInit ä¸»æœºæ“ä½œç³»ç»Ÿèµ„æºåˆå§‹åŒ– xMBMasterRunResTake ä¸»æœºèµ„æºè·å– vMBMasterRunResRelease ä¸»æœºèµ„æºé‡Šæ”¾ vMBMasterErrorCBRespondTimeout ä¸»æœºå“åº”è¶…æ—¶å›è°ƒæ¥å£ vMBMasterErrorCBReceiveData ä¸»æœºæ¥æ”¶æ•°æ®é”™è¯¯å›è°ƒæ¥å£ vMBMasterErrorCBExecuteFunction ä¸»æœºæ‰§è¡Œ Modbus æ–¹æ³•æ—¶å‡ºé”™å›è°ƒæ¥å£ vMBMasterCBRequestSuccess ä¸»æœºè¯·æ±‚æ‰§è¡ŒæˆåŠŸå›è°ƒæ¥å£ eMBMasterWaitRequestFinish ä¸»æœºç­‰å¾…è¯·æ±‚å®Œæˆå¤„ç†çš„å›è°ƒæ¥å£ æ•°æ®ç¼“å†²åŒºæ•°æ®ç¼“å†²åŒºçš„å®šä¹‰ä½äº FreeModbus\\port\\user_mb_app_m.c æ–‡ä»¶é¡¶éƒ¨ï¼Œæ”¯æŒå››ç§æ•°æ®ç±»å‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒFreeModbus ä»æœºé‡‡ç”¨ä¸€ç»´æ•°ç»„ä½œä¸ºç¼“å­˜ç»“æ„ï¼Œè€Œä¸»æœºåˆ™ä½¿ç”¨äºŒç»´æ•°ç»„å­˜å‚¨ç½‘ç»œå†…æ‰€æœ‰ä»æœºçš„æ•°æ®ã€‚äºŒç»´æ•°ç»„çš„åˆ—å·è¡¨ç¤ºå¯„å­˜å™¨ çº¿åœˆåŠç¦»æ•£é‡åœ°å€ï¼Œè¡Œå·è¡¨ç¤ºä»æœºèŠ‚ç‚¹ IDï¼Œä½†éœ€æ³¨æ„ï¼šè¡Œå·éœ€å‡å» 1ã€‚ä¾‹å¦‚ï¼ŒusMRegHoldBuf[2][1] ä»£è¡¨ä»æœº ID ä¸º 3 ä¿æŒå¯„å­˜å™¨åœ°å€ä¸º 1 çš„ä»æœºæ•°æ®ã€‚ æ•°æ®å¤„ç†å›è°ƒæ¥å£Modbus åè®®å®šä¹‰äº†å››ç§ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œæ‰€æœ‰çš„åŠŸèƒ½æ“ä½œéƒ½å›´ç»•è¿™äº›æ•°æ®ç±»å‹è¿›è¡Œã€‚ç”±äºä¸åŒç”¨æˆ·çš„æ•°æ®ç¼“å†²åŒºç»“æ„å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œå› æ­¤æ¯ç§æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„å¤„ç†æ–¹å¼ä¹Ÿéœ€æ ¹æ®ç”¨æˆ·ç‰¹å®šçš„æ•°æ®ç»“æ„è¿›è¡Œå®šåˆ¶å®ç°ã€‚Modbus æ•°æ®å¤„ç†å›è°ƒæ¥å£ï¼š æ¥å£ åŠŸèƒ½æè¿° eMBMasterRegInputCB è¾“å…¥å¯„å­˜å™¨å›è°ƒæ¥å£ eMBMasterRegHoldingCB ä¿æŒå¯„å­˜å™¨å›è°ƒæ¥å£ eMBMasterRegCoilsCB çº¿åœˆå›è°ƒæ¥å£ eMBMasterRegDiscreteCB ç¦»æ•£è¾“å…¥å›è°ƒæ¥å£ ç¡¬ä»¶åœ¨ç§»æ¤ FreeModbus åè®®æ ˆçš„ä¸»æœºéƒ¨åˆ†æ—¶ï¼Œéœ€è¦å¯¹ä¸²å£å’Œå®šæ—¶å™¨é…ç½®è¿›è¡Œå¿…è¦çš„ä¿®æ”¹ã€‚è¿™äº›é…ç½®æ–‡ä»¶ä½äº port ç›®å½•ä¸‹ï¼Œç”¨æˆ·å¿…é¡»æ ¹æ®è‡ªèº« CPU çš„ç‰¹æ€§è¿›è¡Œç›¸åº”çš„è°ƒæ•´ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåè®®æ ˆé»˜è®¤åŒ…å«äº† STM32F103X çš„ç§»æ¤æ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥å°†å…¶ä½œä¸ºå‚è€ƒï¼Œä»¥ä¾¿æ›´æœ‰æ•ˆåœ°è¿›è¡Œç§»æ¤ã€‚ ä¸²å£ä¸²å£çš„ç§»æ¤æ–‡ä»¶ä¸º FreeModbus\\port\\portserial_m.cï¼Œç”¨æˆ·éœ€è¦ä¿®æ”¹ä»¥ä¸‹æ¥å£æ–¹æ³•ï¼Œä»¥ç¡®ä¿ä¸²å£çš„æ­£ç¡®æ“ä½œå’Œé€šä¿¡åŠŸèƒ½ï¼š æ¥å£æ–¹æ³• åŠŸèƒ½æè¿° vMBMasterPortSerialEnable ä½¿èƒ½æˆ–å¤±èƒ½ä¸²å£çš„å‘é€åŠæ¥æ”¶åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ RS-485 æ€»çº¿æ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„æ”¶å‘æ¨¡å¼çš„åˆ‡æ¢ï¼Œä»¥ä¿è¯æ•°æ®çš„æ­£ç¡®ä¼ è¾“ã€‚ vMBMasterPortClose æ­¤æ–¹æ³•ç”¨äºå…³é—­ä¸²å£ï¼Œç¡®ä¿èµ„æºçš„é‡Šæ”¾å’Œåç»­æ“ä½œçš„ç¨³å®šæ€§ã€‚ xMBMasterPortSerialInit è¿›è¡Œä¸²å£åˆå§‹åŒ–ï¼ŒåŒ…æ‹¬å¦‚æœä½¿ç”¨ RS-485ï¼Œæ€»çº¿éœ€è¦åœ¨æ­¤æ–¹æ³•ä¸­åˆå§‹åŒ–æ”¶å‘æ¨¡å¼åˆ‡æ¢çš„å¼•è„šï¼Œä»¥ä¿è¯åœ¨é€šä¿¡æ—¶èƒ½å¤Ÿæ­£ç¡®åˆ‡æ¢ã€‚ xMBMasterPortSerialPutByte å‘é€å•å­—èŠ‚æ•°æ®è‡³ä¸²å£ï¼Œç¡®ä¿æ•°æ®èƒ½å¤Ÿè¢«å¦ä¸€æ–¹æ¥æ”¶ã€‚ xMBMasterPortSerialGetByte ä»ä¸²å£æ¥æ”¶å•å­—èŠ‚æ•°æ®ï¼Œä¾¿äºåè®®æ ˆæ¥æ”¶æŒ‡ä»¤æˆ–æ•°æ®ã€‚ prvvUARTTxReadyISR ä¸²å£å‘é€å®Œæˆä¸­æ–­æœåŠ¡ç¨‹åºæ¥å£ï¼Œé€šå¸¸é€šè¿‡å¼•ç”¨é»˜è®¤æ–¹æ³• pxMBMasterFrameCBTransmitterEmpty æ¥å¤„ç†å‘é€å®Œæˆäº‹ä»¶ã€‚ prvvUARTRxISR ä¸²å£æ¥æ”¶ä¸­æ–­æœåŠ¡ç¨‹åºæ¥å£ï¼Œä¸€èˆ¬ç›´æ¥å¼•ç”¨ pxMBMasterFrameCBByteReceived æ–¹æ³•ï¼Œä»¥å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®ã€‚ æ­¤å¤–ï¼Œåœ¨æ–‡ä»¶çš„æœ«å°¾å¿…é¡»æ·»åŠ  CPU è‡ªå¸¦çš„ä¸²å£æœåŠ¡ç¨‹åºï¼Œå°†å‘é€åŠæ¥æ”¶ä¸­æ–­ç¨‹åºæ¥å£æ’å…¥åˆ°ç›¸åº”çš„ä¸­æ–­æœåŠ¡ç¨‹åºä¸­ï¼Œä»¥å¢å¼ºç³»ç»Ÿçš„å“åº”èƒ½åŠ›ã€‚ å®šæ—¶å™¨å®šæ—¶å™¨çš„ç§»æ¤æ–‡ä»¶ä¸º FreeModbus\\port\\porttimer_m.cï¼Œç”¨æˆ·éœ€è¦å¯¹ä»¥ä¸‹æ¥å£æ–¹æ³•è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ï¼Œç¡®ä¿å®šæ—¶å™¨èƒ½å¤Ÿæ­£ç¡®è¿è¡Œï¼š æ¥å£æ–¹æ³• åŠŸèƒ½æè¿° xMBMasterPortTimersInit åˆå§‹åŒ–å®šæ—¶å™¨ï¼Œå°†å®šæ—¶å™¨çš„é¢„åˆ†é¢‘æ•°å’Œ T3.5 æ—¶é—´è®¡æ•°å€¼åˆ†åˆ«å¤‡ä»½åˆ° usPrescalerValue å’Œ usT35TimeOut50us ä¸­ï¼Œä¸ºåç»­è®¡æ—¶æ“ä½œæä¾›åŸºå‡†ã€‚ vMBMasterPortTimersT35Enable è®¾ç½®å®šæ—¶å™¨æŒ‰ç…§ T3.5 æ—¶é—´å¼€å§‹è®¡æ•°ï¼Œä»¥ç¡®ä¿æ—¶é—´æµ‹é‡çš„å‡†ç¡®æ€§ã€‚ vMBMasterPortTimersConvertDelayEnable æ¿€æ´»å®šæ—¶å™¨ä»¥è¿›è¡Œå¹¿æ’­å¸§çš„è½¬æ¢å»¶æ—¶æ—¶é—´è®¡æ•°ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿé€‚åº”ä¸åŒç±»å‹çš„æ•°æ®ä¼ è¾“å»¶æ—¶ã€‚ vMBMasterPortTimersRespondTimeoutEnable è®¾å®šå®šæ—¶å™¨å¼€å§‹è®¡æ•°ï¼Œæ ¹æ®å“åº”è¶…æ—¶æ—¶é—´ï¼Œé˜²æ­¢é€šä¿¡è¿‡ç¨‹ä¸­å‡ºç°æ— é™ç­‰å¾…çš„çŠ¶å†µã€‚ vMBMasterPortTimersDisable ç¦ç”¨å®šæ—¶å™¨ï¼Œç»ˆæ­¢è®¡æ•°ï¼Œä»¥é‡Šæ”¾èµ„æºå’Œé¿å…èµ„æºæµªè´¹ã€‚ prvvTIMERExpiredISR å®šæ—¶å™¨ä¸­æ–­æœåŠ¡ç¨‹åºæ¥å£ï¼ŒæŒ‰ç…§é»˜è®¤æ–¹å¼ï¼Œç›´æ¥å¼•ç”¨ pxMBMasterPortCBTimerExpired æ–¹æ³•å¤„ç†å®šæ—¶å™¨åˆ°æœŸäº‹ä»¶ã€‚ æ³¨ï¼š usPrescalerValue å’Œ usT35TimeOut50us å·²åœ¨æ–‡ä»¶é¡¶éƒ¨è¿›è¡Œå®šä¹‰ï¼Œç¡®ä¿ç”¨æˆ·åœ¨äº†è§£æ–‡ä»¶ç»“æ„çš„æƒ…å†µä¸‹è¿›è¡Œä¿®æ”¹ã€‚ è½¬æ¢å»¶æ—¶æ—¶é—´å’Œå“åº”è¶…æ—¶æ—¶é—´çš„é…ç½®å‚æ•°å¯ä»¥åœ¨ FreeModbus\\modbus\\include\\mbconfig.h æ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œç”¨æˆ·åº”æ ¹æ®ç³»ç»Ÿçš„ç‰¹æ€§è¿›è¡Œå¿…è¦çš„è°ƒæ•´ï¼Œä»¥ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ã€‚ é™¤äº†ä¸Šè¿°çš„æ¥å£æ–¹æ³•å¤–ï¼Œç”¨æˆ·è¿˜éœ€è¦åœ¨æ–‡ä»¶çš„æœ«å°¾å¢åŠ  CPU è‡ªå¸¦çš„å®šæ—¶å™¨ä¸­æ–­æœåŠ¡ç¨‹åºï¼Œå¹¶å°†ç›¸å…³æ¥å£æ’å…¥åˆ°ç°æœ‰çš„ä¸­æ–­æœåŠ¡ç¨‹åºä¸­ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿç¨³å®šã€é«˜æ•ˆåœ°è¿è¡Œã€‚ APIåœ¨ä½¿ç”¨ Modbus åè®®æ—¶ï¼Œä¸»æœºä¸ä»æœºçš„é€šä¿¡æ¨¡å¼æœ‰ç€æ˜¾è‘—çš„å·®å¼‚ã€‚ä»æœºä»¥è¢«åŠ¨çš„æ–¹å¼ç­‰å¾…ä¸»æœºå‘å‡ºçš„è¯·æ±‚ï¼Œè€Œä¸»æœºåˆ™ç§¯æå‘ä»æœºå‘èµ·è¯·æ±‚ï¼Œå¹¶å¤„ç†ä»æœºåé¦ˆçš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œåœ¨éœ€è¦æ§åˆ¶è®¾å¤‡æ—¶ï¼Œä¸»æœºå‘ä»æœºå‘é€çš„æŒ‡ä»¤å°†ç›´æ¥æ”¹å˜æ“ä½œçŠ¶æ€ï¼Œè€Œä»æœºä»…åœ¨æŒ‡ä»¤æœ‰å…³çš„æƒ…å†µä¸‹è¿”å›å“åº”ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“ä¸»æœºå‘é€å¹¿æ’­è¯·æ±‚æ—¶ï¼Œä»æœºæ— éœ€è¿”å›ä»»ä½•åé¦ˆï¼›å› æ­¤ï¼Œå¹¿æ’­è¯·æ±‚éå¸¸é€‚åˆç”¨äºå†™å…¥ä»æœºæ•°æ®è€Œä¸é€‚ç”¨äºè¯»å–ä»æœºæ•°æ®ã€‚ åœ¨ä¸»æœºè¯·æ±‚ API ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½å…·æœ‰ç›¸åŒçš„è¿”å›å€¼æ ¼å¼ã€‚ä»¥ä¸‹æ˜¯ä¸»è¦è¿”å›å€¼çš„æ„ä¹‰ï¼š MB_MRE_NO_ERR: æ“ä½œæ­£å¸¸ï¼Œæ²¡æœ‰æ£€æµ‹åˆ°é”™è¯¯ã€‚ MB_MRE_NO_REG: å¯„å­˜å™¨ çº¿åœˆæˆ–ç¦»æ•£è¾“å…¥åœ°å€ä¸æ­£ç¡®ã€‚ MB_MRE_ILL_ARG: è¾“å…¥å‚æ•°æ ¼å¼ä¸ç¬¦åˆè¦æ±‚ã€‚ MB_MRE_REV_DATA: æ¥æ”¶åˆ°çš„æ•°æ®æœ‰è¯¯ã€‚ MB_MRE_TIMEDOUT: å“åº”è¶…æ—¶ï¼Œä¸»æœºåœ¨è®¾å®šæ—¶é—´å†…æœªæ”¶åˆ°ä»æœºå“åº”ã€‚ MB_MRE_MASTER_BUSY: ä¸»æœºå¿™ï¼Œåœ¨è®¾å®šæ—¶é—´å†…æœªå‘é€è¯·æ±‚ã€‚ MB_MRE_EXE_FUN: ä¸»æœºæ”¶åˆ°å“åº”åï¼Œæ‰§è¡Œ Modbus æ–¹æ³•æ—¶å‘ç”Ÿé”™è¯¯ã€‚ æ‰€æœ‰ä¸»æœºè¯·æ±‚æ–¹æ³•å‡ä¸ºçº¿ç¨‹å®‰å…¨å¹¶é‡‡ç”¨é˜»å¡æ¨¡å¼ã€‚å¦‚æœåœ¨è®¾å®šçš„è¶…æ—¶æ—¶é—´å†…æœªèƒ½è·å¾—ä¸»æœºèµ„æºï¼Œå°†è¿”å›â€œä¸»æœºå¿™â€çš„çŠ¶æ€ï¼›æˆåŠŸè·å¾—èµ„æºåï¼Œç³»ç»Ÿä¼šç­‰å¾…è¯·æ±‚çš„ç»“æœå†è¿”å›ã€‚ å†™å•ä¸ªä¿æŒå¯„å­˜å™¨è¯¥æ¥å£çš„ç›®çš„åœ¨äºå°†æ•°æ®å†™å…¥æŒ‡å®šä»æœºçš„æŸä¸ªä¿æŒå¯„å­˜å™¨ã€‚è¿™æ„å‘³ç€ï¼Œé€šè¿‡é€‚å½“çš„å‚æ•°é…ç½®ï¼Œå¯ä»¥æœ‰æ•ˆåœ°åœ¨ä¸»è®¾å¤‡ä¸ä»è®¾å¤‡ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œä»¥æ»¡è¶³ç‰¹å®šçš„æ§åˆ¶éœ€æ±‚ã€‚ åŠŸèƒ½æ¥å£: eMBMasterReqErrCode eMBMasterReqWriteHoldingRegister(UCHAR ucSndAddr, USHORT usRegAddr, USHORT usRegData, LONG lTimeOut); ucSndAddrï¼šè¯·æ±‚çš„ä»æœºåœ°å€ï¼Œå€¼ä¸º 0 ä»£è¡¨å¹¿æ’­ï¼Œè¡¨ç¤ºå°†è¯·æ±‚å‘ç»™æ‰€æœ‰å¯èƒ½çš„ä»æœºè®¾å¤‡ã€‚è¿™åœ¨éœ€è¦åŒæ­¥å¤šä¸ªè®¾å¤‡çŠ¶æ€æ—¶å°¤ä¸ºé‡è¦ã€‚ usRegAddrï¼šç›®æ ‡ä¿æŒå¯„å­˜å™¨çš„åœ°å€ï¼Œæ¯ä¸ªå¯„å­˜å™¨éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åœ°å€ï¼Œç”¨äºæ ‡è¯†å’Œå®šä½ã€‚ usRegDataï¼šå°†è¦å†™å…¥åˆ°ä¿æŒå¯„å­˜å™¨ä¸­çš„æ•°æ®å€¼ï¼Œè¯¥å€¼é€šå¸¸æ¥è‡ªä¸»è®¾å¤‡çš„æŸä¸ªä¼ æ„Ÿå™¨æˆ–æ§åˆ¶é€»è¾‘ã€‚ lTimeOutï¼šè¯·æ±‚çš„è¶…æ—¶æ—¶é•¿ï¼Œè€ƒè™‘åˆ°é€šä¿¡çš„ä¸ç¨³å®šï¼Œæ”¯æŒæ°¸ä¹…ç­‰å¾…ï¼Œå¯ä»¥é€šè¿‡æ“ä½œç³»ç»Ÿçš„æ°¸ä¹…ç­‰å¾…å‚æ•°è¿›è¡Œè®¾ç½®ã€‚ å†™å¤šä¸ªä¿æŒå¯„å­˜å™¨æ­¤æ¥å£å…è®¸åŒæ—¶å‘å¤šä¸ªä¿æŒå¯„å­˜å™¨å†™å…¥æ•°æ®ï¼Œæé«˜äº†æ•°æ®å¤„ç†æ•ˆç‡ï¼Œé€‚ç”¨äºæ‰¹é‡æ›´æ–°è®¾å¤‡çŠ¶æ€çš„åœºæ™¯ã€‚ åŠŸèƒ½æ¥å£: eMBMasterReqErrCode eMBMasterReqWriteMultipleHoldingRegister(UCHAR ucSndAddr, USHORT usRegAddr, USHORT usNRegs, USHORT *pusDataBuffer, LONG lTimeOut); ucSndAddrï¼šè¯·æ±‚çš„ä»æœºåœ°å€ï¼Œå€¼ä¸º 0 è¡¨ç¤ºé‡‡ç”¨å¹¿æ’­çš„æ–¹å¼ã€‚ usRegAddrï¼šç¬¬ä¸€ä¸ªå†™å…¥å¯„å­˜å™¨çš„èµ·å§‹åœ°å€ï¼Œåç»­çš„å¯„å­˜å™¨åœ°å€å°†æ ¹æ®æ­¤åœ°å€é¡ºåºé€’å¢ã€‚ usNRegsï¼šè¡¨æ˜å°†è¦å†™å…¥çš„å¯„å­˜å™¨æ•°é‡ï¼Œç¡®ä¿ä¸€æ¬¡è¯·æ±‚å¯ä»¥è¦†ç›–å¤šä¸ªå¯„å­˜å™¨ï¼Œä¼˜åŒ–äº†é€šä¿¡æ—¶é—´ã€‚ pusDataBufferï¼šä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘åŒ…å«å¾…å†™å…¥æ•°æ®çš„æ•°ç»„ï¼Œè¿™é‡Œå­˜å‚¨äº†å°†å†™å…¥å„ä¸ªå¯„å­˜å™¨çš„å…·ä½“æ•°æ®ã€‚ lTimeOutï¼šè¯·æ±‚è¶…æ—¶æ—¶é•¿ï¼Œæ”¯æŒæ°¸ä¹…ç­‰å¾…ï¼Œé…ç½®ä¸ºé€‚åº”å…·ä½“åº”ç”¨çš„éœ€æ±‚ã€‚ è¯»å¤šä¸ªä¿æŒå¯„å­˜å™¨é€šè¿‡è¯¥æ¥å£ï¼Œå¯ä»¥å¿«é€Ÿè¯»å–å¤šä¸ªä¿æŒå¯„å­˜å™¨çš„å€¼ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦è·å–å¤šä¸ªçŠ¶æ€ä¿¡æ¯çš„åº”ç”¨åœºæ™¯ã€‚ åŠŸèƒ½æ¥å£: eMBMasterReqErrCode eMBMasterReqReadHoldingRegister(UCHAR ucSndAddr, USHORT usRegAddr, USHORT usNRegs, LONG lTimeOut); ucSndAddrï¼šè¯·æ±‚çš„ä»æœºåœ°å€ï¼Œ0 ä»£è¡¨å¹¿æ’­ã€‚ usRegAddrï¼šè¦æ±‚è¯»å–çš„ç¬¬ä¸€ä¸ªå¯„å­˜å™¨çš„åœ°å€ï¼Œç”¨äºæ ‡è¯†è¯»å–å¼€å§‹çš„ä½ç½®ã€‚ usNRegsï¼šéœ€è¦è¯»å–çš„å¯„å­˜å™¨æ•°é‡ï¼Œå¯ä»¥æ ¹æ®åº”ç”¨éœ€æ±‚è®¾ç½®ä¸åŒçš„æ•°é‡ã€‚ lTimeOutï¼šè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œæ”¯æŒæ°¸ä¹…ç­‰å¾…ï¼Œç¡®ä¿åœ¨é€šä¿¡ç¯èŠ‚ä¸­ä¸æ”¾è¿‡ä»»ä½•æ•°æ®ã€‚ è¯»å†™å¤šä¸ªä¿æŒå¯„å­˜å™¨æ­¤æ¥å£æä¾›äº†ä¸€ä¸ªå¤åˆæ“ä½œï¼Œé¦–å…ˆè¯»å–æŒ‡å®šå¯„å­˜å™¨çš„æ•°æ®ï¼Œç„¶åå†å‘å¦å¤–çš„å¯„å­˜å™¨å†™å…¥æ–°æ•°æ®ï¼Œé€‚åˆäºéœ€è¦å…ˆè·å–çŠ¶æ€å†è¿›è¡Œæ§åˆ¶çš„æƒ…å†µã€‚ åŠŸèƒ½æ¥å£: eMBMasterReqErrCode eMBMasterReqReadWriteMultipleHoldingRegister(UCHAR ucSndAddr, USHORT usReadRegAddr, USHORT usNReadRegs, USHORT *pusDataBuffer, USHORT usWriteRegAddr, USHORT usNWriteRegs, LONG lTimeOut); ucSndAddrï¼šè¯·æ±‚çš„ä»æœºåœ°å€ï¼Œå€¼ä¸º 0 è¡¨ç¤ºä½¿ç”¨å¹¿æ’­æ¨¡å¼ã€‚ usReadRegAddrï¼šè¯»å–æ“ä½œçš„ç¬¬ä¸€ä¸ªå¯„å­˜å™¨çš„åœ°å€ï¼Œç¡®å®šè¯»å–çš„èµ·å§‹ç‚¹ã€‚ usNReadRegsï¼šéœ€è¯»å–çš„å¯„å­˜å™¨æ•°é‡ï¼Œèƒ½å¤Ÿé«˜æ•ˆè·å–å¤šä¸ªå¯„å­˜å™¨æ•°æ®ã€‚ pusDataBufferï¼šæŒ‡å‘å­˜æ”¾è¯»å–æ•°æ®çš„æ•°ç»„ï¼Œä¾¿äºåç»­æ“ä½œä½¿ç”¨ã€‚ usWriteRegAddrï¼šå†™å…¥æ“ä½œçš„ç¬¬ä¸€ä¸ªå¯„å­˜å™¨çš„åœ°å€ï¼Œæ¥æ”¶è¯»å–åçš„å¤„ç†ç»“æœã€‚ usNWriteRegsï¼šéœ€è¦å†™å…¥çš„å¯„å­˜å™¨æ•°é‡ï¼Œç¡®ä¿æ•°æ®è¦†ç›–å¤šä¸ªå¯„å­˜å™¨ã€‚ lTimeOutï¼šè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œæ”¯æŒæ°¸ä¹…ç­‰å¾…ï¼Œæå‡ç¨³å®šæ€§ã€‚ è¯»å¤šä¸ªè¾“å…¥å¯„å­˜å™¨æ­¤æ¥å£æä¾›ä»å¤šä¸ªè¾“å…¥å¯„å­˜å™¨è¯»å–æ•°æ®çš„åŠŸèƒ½ï¼Œé«˜æ•ˆè·å–å¤–éƒ¨è®¾å¤‡çš„è¾“å…¥ä¿¡æ¯ï¼Œé€‚åˆå®æ—¶ç›‘æµ‹ä¸æ§åˆ¶ç³»ç»Ÿã€‚ åŠŸèƒ½æ¥å£: eMBMasterReqErrCode eMBMasterReqReadInputRegister(UCHAR ucSndAddr, USHORT usRegAddr, USHORT usNRegs, LONG lTimeOut); ucSndAddrï¼šè¯·æ±‚çš„ä»æœºåœ°å€ï¼Œ0 ä»£è¡¨å¹¿æ’­ï¼Œç¡®ä¿æ‰€æœ‰è®¾å¤‡éƒ½èƒ½å¤Ÿè¢«è®¿é—®ã€‚ usRegAddrï¼šè¦è¯»å–çš„è¾“å…¥å¯„å­˜å™¨çš„èµ·å§‹åœ°å€ï¼Œè¡¨ç¤ºæ•°æ®è¯»å–çš„èµ·ç‚¹ã€‚ usNRegsï¼šè¦è¯»å–çš„å¯„å­˜å™¨æ•°é‡ï¼Œæ”¯æŒä¸€æ¬¡æ€§è¯»å–å¤šä¸ªå¯„å­˜å™¨çš„å€¼ã€‚ lTimeOutï¼šè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œæ”¯æŒæ°¸ä¹…ç­‰å¾…ï¼Œä»¥ä¿è¯æ•°æ®åœ¨é€šä¿¡ä¸­çš„å¯é è·å–ã€‚ å†™å•ä¸ªçº¿åœˆè¯¥æ¥å£ç”¨äºå‘æŒ‡å®šä»æœºçš„çº¿åœˆå†™å…¥æ•°æ®ï¼Œå¸¸ç”¨äºæ§åˆ¶çŠ¶æ€çš„åˆ‡æ¢ï¼Œä¾‹å¦‚å¼€å¯æˆ–å…³é—­è®¾å¤‡çš„æŸä¸ªåŠŸèƒ½ã€‚ åŠŸèƒ½æ¥å£: eMBMasterReqErrCode eMBMasterReqWriteCoil(UCHAR ucSndAddr, USHORT usCoilAddr, USHORT usCoilData, LONG lTimeOut); ucSndAddrï¼šè¯·æ±‚çš„ä»æœºåœ°å€ï¼Œå€¼ä¸º 0 å¯é€‰æ‹©å¹¿æ’­ã€‚ usCoilAddrï¼šç›®æ ‡çº¿åœˆçš„åœ°å€ï¼Œæ¯ä¸ªçº¿åœˆéƒ½æœ‰ç‹¬ç‰¹çš„ä½ç½®æ ‡è¯†ï¼Œè¿™æ˜¯è¿›è¡Œæ§åˆ¶çš„å…³é”®ã€‚ usCoilDataï¼šå†™å…¥åˆ°çº¿åœˆçš„ç›®æ ‡æ•°æ®ï¼Œé€šå¸¸ä¸ºå¼€ï¼ˆ1ï¼‰æˆ–å…³ï¼ˆ0ï¼‰çš„çŠ¶æ€å€¼ã€‚ lTimeOutï¼šè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œæ”¯æŒæ°¸ä¹…ç­‰å¾…ï¼Œç¡®ä¿å†™æ“ä½œèƒ½å¤Ÿé¡ºåˆ©å®Œæˆã€‚ å†™å¤šä¸ªçº¿åœˆæ­¤æ¥å£å¯å‘å¤šä¸ªçº¿åœˆæ‰¹é‡å†™å…¥æ•°æ®ï¼Œæé«˜äº†çŠ¶æ€æ§åˆ¶çš„æ•ˆç‡ï¼Œé€‚åˆéœ€è¦åŒæ—¶æ”¹å˜å¤šä¸ªè®¾å¤‡å‚æ•°çš„åœºåˆã€‚ åŠŸèƒ½æ¥å£: eMBMasterReqErrCode eMBMasterReqWriteMultipleCoils(UCHAR ucSndAddr, USHORT usCoilAddr, USHORT usNCoils, UCHAR *pucDataBuffer, LONG lTimeOut); ucSndAddrï¼šè¯·æ±‚çš„ä»æœºåœ°å€ï¼Œ0 ä¸ºå¹¿æ’­ã€‚ usCoilAddrï¼šç¬¬ä¸€ä¸ªå†™å…¥çº¿åœˆçš„èµ·å§‹åœ°å€ï¼Œä¾¿äºå¤šçº¿åœˆçš„æ“ä½œã€‚ usNCoilsï¼šå†™å…¥çš„çº¿åœˆæ€»æ•°ï¼Œæ”¯æŒåŒæ—¶æ›´æ–°å¤šä¸ªçº¿åœˆçš„å€¼ã€‚ pucDataBufferï¼šæŒ‡å‘å¾…å†™å…¥æ•°æ®çš„æ•°ç»„ï¼Œæ¯ä¸ªä½ä»£è¡¨ä¸€ä¸ªçº¿åœˆçš„çŠ¶æ€ã€‚ lTimeOutï¼šè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œæ”¯æŒæ°¸ä¹…ç­‰å¾…ï¼Œæœ‰åŠ©äºæå‡æ“ä½œçš„æˆåŠŸç‡ã€‚ è¯»å¤šä¸ªçº¿åœˆæ­¤æ¥å£çš„åŠŸèƒ½æ˜¯è¯»å–å¤šä¸ªçº¿åœˆçš„çŠ¶æ€ï¼Œé€‚ç”¨äºç›‘æµ‹è®¾å¤‡è¿è¡Œæƒ…å†µå’ŒçŠ¶æ€å˜åŒ–ã€‚ åŠŸèƒ½æ¥å£: eMBMasterReqErrCode eMBMasterReqReadCoils(UCHAR ucSndAddr, USHORT usCoilAddr, USHORT usNCoils, LONG lTimeOut); ucSndAddrï¼šè¯·æ±‚çš„ä»æœºåœ°å€ï¼Œ0 ä»£è¡¨å¹¿æ’­ã€‚ usCoilAddrï¼šè¯»å–æ“ä½œçš„èµ·å§‹çº¿åœˆåœ°å€ï¼Œæ ‡è¯†ä»å“ªä¸€å¤„å¼€å§‹è·å–ä¿¡æ¯ã€‚ usNCoilsï¼šè¦æ±‚è¯»å–çš„çº¿åœˆæ•°é‡ï¼Œä¾¿äºä¸€æ¬¡æ€§è·å–å¤šä¸ªçŠ¶æ€çš„æœ€æ–°æ•°æ®ã€‚ lTimeOutï¼šè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œæ”¯æŒæ°¸ä¹…ç­‰å¾…ï¼Œå¢å¼ºé˜…è¯»æ“ä½œçš„ç¨³å®šæ€§ã€‚ è¯»å¤šä¸ªç¦»æ•£è¾“å…¥æ­¤æ¥å£æä¾›æ–¹æ³•è¯»å–å¤šä¸ªç¦»æ•£è¾“å…¥çš„å®æ—¶æ•°æ®ï¼Œé€‚ç”¨äºä¼ æ„Ÿå™¨ä¸å¼€å…³çŠ¶æ€çš„ç›‘æµ‹ã€‚ åŠŸèƒ½æ¥å£: eMBMasterReqErrCode eMBMasterReqReadDiscreteInputs(UCHAR ucSndAddr, USHORT usDiscreteAddr, USHORT usNDiscreteIn, LONG lTimeOut); ucSndAddrï¼šè¯·æ±‚çš„ä»æœºåœ°å€ï¼Œ0 ä»£è¡¨å¹¿æ’­ã€‚ usDiscreteAddrï¼šè¯»å–ç¦»æ•£è¾“å…¥çš„èµ·å§‹åœ°å€ï¼Œç”¨äºæ ‡è¯†è¯»å–æ“ä½œçš„èµ·ç‚¹ã€‚ usNDiscreteInï¼šéœ€è¯»å–çš„ç¦»æ•£è¾“å…¥æ•°é‡ï¼Œçµæ´»é…ç½®ä»¥æ»¡è¶³ä¸åŒåº”ç”¨éœ€æ±‚ã€‚ lTimeOutï¼šè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œæ”¯æŒæ°¸ä¹…ç­‰å¾…ï¼Œä¼˜åŒ–æ•°æ®è¯»å…¥çš„å¯é æ€§ã€‚","categories":["4.é€šè®¯åè®®","Modbus"]},{"title":"FreeModbus è§£æ","path":"/2023/12/20/4-é€šè®¯åè®®-Modbus-FreeModbus-è§£æ/","content":"RTU æµç¨‹åˆ†ææ‰§è¡Œ main() ä¸­çš„ eStatus = eMBInit(MB_RTU, 0x0A, 0, 9600, MB_PAR_NONE);ï¼Œè¿›å…¥åˆå§‹åŒ–è¿‡ç¨‹ã€‚å…¶ä¸­ï¼Œåˆå§‹åŒ–çš„ä»è®¾å¤‡åœ°å€ä¸º 0x0Aï¼Œè¿™æ˜¯ Modbus åè®®æ”¯æŒçš„èŒƒå›´å†…çš„æœ‰æ•ˆåœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ä½¿ç”¨ 1 åˆ° 247 ä¹‹é—´çš„ä»»æ„åœ°å€ã€‚å› ä¸ºè®¾ç½®ä¸º RTU æ¨¡å¼ï¼Œæ‰€ä»¥éœ€è¦ä¸º RTU çš„ä¸€äº›å‚æ•°èµ‹å€¼ï¼Œè¿™äº›å‚æ•°é€šè¿‡ä»¥ä¸‹åˆå§‹åŒ–å‡½æ•°é…ç½®ï¼š pvMBFrameStartCur = eMBRTUStart;pvMBFrameStopCur = eMBRTUStop;peMBFrameSendCur = eMBRTUSend;peMBFrameReceiveCur = eMBRTUReceive;pvMBFrameCloseCur = MB_PORT_HAS_CLOSE ? vMBPortClose : NULL;pxMBFrameCBByteReceived = xMBRTUReceiveFSM;pxMBFrameCBTransmitterEmpty = xMBRTUTransmitFSM;pxMBPortCBTimerExpired = xMBRTUTimerT35Expired; è¿™äº›é…ç½®ä¸­ï¼Œç‰¹åˆ«é‡è¦çš„æ˜¯ xMBRTUReceiveFSM å’Œ xMBRTUTransmitFSM è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå®ƒä»¬å®šä¹‰äº† Modbus çŠ¶æ€æœºçš„æ¥æ”¶å’Œå‘é€çŠ¶æ€ã€‚ä»¥ä¸‹æ˜¯æ¥æ”¶çŠ¶æ€æœºçš„å›¾ç¤ºï¼š xMBRTUReceiveFSM å®ç°äº† Modbus æ¥æ”¶çŠ¶æ€æœºçš„è½¬å˜é€»è¾‘ï¼ŒçŠ¶æ€æµç¨‹å¯ä»¥å¦‚ä¸‹æè¿°ï¼š ä¸Šç”µå¯åŠ¨æˆ–å¤ä½ï¼šè®¾å¤‡è¿›å…¥ STATE_RX_INIT çŠ¶æ€ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œä¸ºäº†é¿å…åè®®æ ˆåœ¨åˆå§‹åŒ–é˜¶æ®µæ¥æ”¶åˆ°æ— æ•ˆçš„ä¸²å£æ•°æ®ï¼Œè®¾å¤‡éœ€è¦ç­‰å¾…ä¸€ä¸ªå®šæ—¶æœŸï¼Œæ—¶é•¿ä¸º T35ã€‚è‹¥ T35 æ—¶é—´å†…æ— æ•°æ®æ¥æ”¶ï¼Œæ‰ä¼šè¿›å…¥ STATE_RX_IDLE çŠ¶æ€ï¼Œå¼€å§‹æ¥æ”¶æœ‰æ•ˆæ•°æ®ã€‚ è¿›å…¥æ¥æ”¶çŠ¶æ€ï¼šåœ¨ STATE_RX_IDLE çŠ¶æ€ä¸‹ï¼Œä¸€æ¥æ”¶åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå®šæ—¶å™¨å¯åŠ¨å¹¶è½¬æ¢çŠ¶æ€è‡³ STATE_RX_RCVã€‚æ¯æ¥æ”¶ä¸€ä¸ªå­—èŠ‚ï¼Œå®šæ—¶å™¨è¢«å¤ä½ï¼ŒæŒç»­ç›´åˆ° T35 è¶…æ—¶ã€‚å¦‚æœæ¥æ”¶åˆ°çš„æ•°æ®æ ¼å¼ç¬¦åˆè¦æ±‚ï¼Œå®Œæ•´æ•°æ®å¸§æ¥æ”¶ç»“æŸï¼Œé‡æ–°è¿›å…¥ STATE_RX_IDLE çŠ¶æ€ï¼›è‹¥æ•°æ®è¿‡é•¿ï¼Œç³»ç»Ÿè½¬å…¥ STATE_RX_ERROR çŠ¶æ€ï¼Œç­‰å¾…æ¥æ”¶å®Œæˆåæ”¾å¼ƒå½“å‰å¸§ï¼Œé‡æ–°å›åˆ° STATE_RX_IDLE çŠ¶æ€ã€‚å½“ç„¶ï¼Œæ‰€æœ‰çŠ¶æ€çš„è½¬æ¢éœ€è¦ BOOL xMBRTUTimerT35Expired(void) å‡½æ•°çš„æ”¯æŒã€‚ æ¥ä¸‹æ¥æ˜¯å‘é€çŠ¶æ€æœºçš„å›¾ç¤ºï¼š å‘é€çŠ¶æ€æœº ç®€å•è®¸å¤šã€‚å…¶åœ¨ STATE_TX_IDLE çŠ¶æ€ä¸‹ï¼Œè¡¨ç¤ºæ²¡æœ‰å‘é€éœ€æ±‚ã€‚å½“éœ€è¦å‘é€æ•°æ®æ—¶ï¼Œåˆ™è¿›å…¥ STATE_TX_XMIT çŠ¶æ€ã€‚ å…³äº xMBRTUTimerT35Expired å‡½æ•°ï¼Œè‹¥å®šæ—¶å™¨çš„åˆå§‹åŒ–è®¾å®šæ—¶åŸºä¸º 50 å¾®ç§’è§¦å‘ä¸€æ¬¡ä¸­æ–­ï¼ŒModbus å¦‚ä½•åœ¨ä¸åŒæ³¢ç‰¹ç‡ä¸‹åˆ¤æ–­ 3.5 ä¸ªå­—ç¬¦çš„è¶…æ—¶å‘¢ï¼Ÿåœ¨å®šæ—¶å™¨ä¸­æ–­æ—¶ï¼Œè°ƒç”¨ pxMBPortCBTimerExpired å‡½æ•°ã€‚å®é™…ä¸Šï¼ŒT35 è¶…æ—¶çš„å‡½æ•°åˆ™æ˜¯ xMBRTUTimerT35Expiredï¼Œä¸¤è€…å­˜åœ¨ä½•ç§å…³ç³»å‘¢ï¼Ÿåœ¨ eMBRTUInit ä¸­ï¼ŒxMBPortTimersInit((USHORT) usTimerT35_50us) è¿›è¡Œäº†é‡æ–°åˆå§‹åŒ–ã€‚å¦‚æœæ³¢ç‰¹ç‡å¤§äº 19200ï¼Œè®¾ç½®å›ºå®šçš„ 1800 å¾®ç§’ï¼Œå¦åˆ™åˆ™ä½¿ç”¨ 3.5 ä¸ªå­—ç¬¦çš„æ—¶é—´é—´éš”ã€‚å¤§æ³¢ç‰¹ç‡é‡‡ç”¨å›ºå®šæ—¶é—´æˆ–è®¸æ˜¯ä¸ºäº†é¿å…å› åˆ¤æ–­æ—¶é—´è¿‡å°è€Œè¯¯åˆ¤æ­£å¸¸çš„çº¿è·¯å»¶è¿Ÿã€‚ è¿è¡Œåˆ° eStatus = eMBEnable(); è¿™ä¸ªæ­¥éª¤ç›¸å¯¹ç®€å•ï¼Œæ‰§è¡Œæ­¤å‡½æ•°åæ¿€æ´»åè®®æ ˆã€ä¸²å£å’Œå®šæ—¶å™¨ã€‚ **è¿›å…¥ void eMBPoll();**ï¼Œåœ¨è¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®çš„æ£€æŸ¥ï¼Œif (xMBPortEventGet(eEvent) == TRUE) æ§åˆ¶ç€äº‹ä»¶å¤„ç†çŠ¶æ€æœºã€‚è¿™ä¸ªäº‹ä»¶å¤„ç†å®é™…ä¸Šæ˜¯å…³äºä¸€ä¸ªäº‹ä»¶é˜Ÿåˆ—çš„é—®é¢˜ï¼Œäº‹ä»¶é€šè¿‡ eQueuedEvent è¢«åé¦ˆåˆ°å¤šä¸ªçŠ¶æ€æœºå’Œè¶…æ—¶å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œä¸€æ¬¡äº‹ä»¶å¯èƒ½ä¼šé€šè¿‡ xMBPortEventPost(EV_FRAME_SENT); è¢«å‘é€ä¾›åç»­è°ƒåº¦ã€‚ ç¡®è®¤ RTU æ¨¡å¼çš„è¿è¡Œæµç¨‹åï¼Œå¯ä»¥è¿›ä¸€æ­¥åˆ†ææ¥æ”¶å’Œå‘é€çš„ç»†èŠ‚ã€‚ æ¥æ”¶ Buffer çš„ä½¿ç”¨åŠæœ‰æ•ˆçŠ¶æ€ï¼šæ¥æ”¶æ•°æ®æ—¶ï¼ŒçŠ¶æ€ä¸º STATE_RX_IDLEï¼Œæ­¤æ—¶å¯èƒ½è¡¨æ˜ä¸€å¸§æ•°æ®çš„ä¼ è¾“å·²å®Œæˆã€‚ä» mbrtu.c ä¸­çš„ eMBInit çœ‹ï¼Œæ˜¾ç„¶è¿›å…¥ STATE_RX_IDLE çŠ¶æ€åï¼Œæ¥æ”¶çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ä¼šä»¤çŠ¶æ€å˜è‡³ STATE_RX_RCVï¼Œå¹¶å°†å‰©ä½™å­—èŠ‚æ”¾ç½®äº ucRTUBuf ä¸­ã€‚æ¥æ”¶å­—èŠ‚çš„æ•°æ®é•¿åº¦é€šè¿‡ usRcvBufferPos è¿›è¡Œç®¡ç†ï¼Œè¿™ä¸€è¿‡ç¨‹éœ€è¦ç»è¿‡ T35 æ—¶é—´æ¥éªŒè¯æ˜¯å¦ç»“æŸæ¥æ”¶ã€‚åœ¨ xMBRTUTimerT35Expired å‡½æ•°ä¸­ï¼ŒçŠ¶æ€ä¸º STATE_RX_RCV æ—¶è§¦å‘äº† xNeedPoll = xMBPortEventPost(EV_FRAME_RECEIVED);ï¼Œè¿™è¡¨æ˜è¯¥çŠ¶æ€ä¼šå‘ eMBPoll å‘é€ä¸€æ¡æ¶ˆæ¯ä»¥å¤„ç†æ–°æ¥æ”¶çš„æ•°æ®å¸§ã€‚ æ¶ˆæ¯çš„æå–ä¸ä½¿ç”¨ï¼šå½“ eMBPoll ä¸­çš„ if (xMBPortEventGet(eEvent) == TRUE) æ£€æµ‹åˆ° EV_FRAME_RECEIVED äº‹ä»¶åï¼Œå°†è°ƒç”¨ peMBFrameReceiveCur ä»¥è·å–æ¶ˆæ¯å¸§ã€‚æ­¤æ—¶è°ƒç”¨çš„æ­£æ˜¯ eMBRTUReceive æ–¹æ³•ã€‚æ‰“å¼€è¯¥å‡½æ•°ï¼Œå¯ä»¥æ¸…æ¥šçœ‹åˆ°å®ƒå¦‚ä½•ä» ucRTUBuf ä¸­æå–æ•°æ®å¹¶èµ‹å€¼äºä»æœºåœ°å€ ucRcvAddressã€å¸§å†…å®¹åœ°å€ ucMBFrame åŠæ•°æ®é•¿åº¦ usLengthï¼ˆä¸åŒ…æ‹¬åœ°å€ä½å’Œ CRC æ ¡éªŒä½ï¼‰ã€‚ æ•°æ®å¤„ç†ä¸åé¦ˆï¼šæ¶ˆæ¯å–å‡ºåï¼Œæ¥ä¸‹æ¥æ˜¯åœ¨ eMBPoll çš„ case EV_FRAME_RECEIVED ä¸­ï¼Œæ£€æŸ¥æ‰€æ¥æ¶ˆæ¯æ˜¯å¦ç¬¦åˆè®¾å®šçš„ç›®çš„åœ°å€ã€‚å¦‚æœè¯¥æ¶ˆæ¯ä¸æ˜¯å¹¿æ’­ä¸”æœªå‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™è¿›å…¥ case EV_EXECUTE: å¤„ç†æ­¥éª¤ï¼Œæ¥ä¸‹æ¥é€šè¿‡åŠŸèƒ½ç åˆ¤æ–­æ•°æ®å¸§çš„ç›®çš„ã€‚å¦‚æœæµ‹å¾—å¸§æ•°æ®ä¸ºåè®®æ ˆæ”¯æŒçš„åŠŸèƒ½ç ï¼Œå°†è°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå¯¹äºè¯»å–è¾“å…¥å¯„å­˜å™¨çš„è¯·æ±‚ï¼Œä¼šè°ƒç”¨ mb.c ä¸­å®šä¹‰çš„ eMBFuncReadInputRegisterï¼Œè¯¥å‡½æ•°æœ¬è´¨ä¸Šä¼šè°ƒç”¨ eMBRegInputCB. ç»“æœçš„åé¦ˆï¼šå¤„ç†å‡½æ•°æ‰§è¡Œåï¼Œå¯„å­˜å™¨çš„å€¼è¢«æå–ï¼Œå¸§æ ¼å¼å·²å‡†å¤‡å¥½ï¼Œæ•°æ®å‘é€çš„å…·ä½“å®ç°å‘ç”Ÿåœ¨ä¸²å£å‘é€å®Œæˆçš„ä¸­æ–­ä¸­ã€‚æ­¤æ—¶ï¼ŒprvvUARTTxReadyISR è¢«è°ƒç”¨ï¼Œæ¥ç€æ˜¯ pxMBFrameCBTransmitterEmptyï¼Œè¿™ä¼šå°†å‘é€çŠ¶æ€æœºè½¬å…¥ STATE_TX_XMIT å¹¶è§¦å‘ xMBPortSerialPutByte ä»¥å‘é€æ•°æ®ã€‚ RTU æºç åˆ†æeMBInitint main(void) eMBErrorCode eStatus; eStatus = eMBInit(MB_RTU, 0x0A, 0, 38400, MB_PAR_EVEN); /* Enable the Modbus Protocol Stack. */ eStatus = eMBEnable(); for(;;) (void)eMBPoll(); /* Here we simply count the number of poll cycles. */ usRegInputBuf[0]++; é¦–å…ˆï¼Œåˆ©ç”¨ eMBInit å‡½æ•°æ¥åˆå§‹åŒ– Modbus åè®®æ ˆï¼Œæ‰€ä½¿ç”¨çš„å‚æ•°åŒ…æ‹¬åè®®æ¨¡å¼ MB_RTUã€è®¾å¤‡åœ°å€ 0x0Aã€ç«¯å£å· 0ã€æ³¢ç‰¹ç‡ 38400 å’Œå¥‡å¶æ ¡éªŒä½ MB_PAR_EVENã€‚åœ¨ eMBInit çš„å†…éƒ¨ï¼Œç¨‹åºæ ¹æ®é…ç½®çš„æ¨¡å¼é€‰æ‹©é€‚å½“çš„å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ï¼š #if MB_RTU_ENABLED 0case MB_RTU: pvMBFrameStartCur = eMBRTUStart; pvMBFrameStopCur = eMBRTUStop; peMBFrameSendCur = eMBRTUSend; peMBFrameReceiveCur = eMBRTUReceive; pvMBFrameCloseCur = MB_PORT_HAS_CLOSE ? vMBPortClose : NULL; pxMBFrameCBByteReceived = xMBRTUReceiveFSM; pxMBFrameCBTransmitterEmpty = xMBRTUTransmitFSM; pxMBPortCBTimerExpired = xMBRTUTimerT35Expired; eStatus = eMBRTUInit(ucMBAddress, ucPort, ulBaudRate, eParity); break;#endif åœ¨è¿™æ®µä»£ç ä¸­ï¼ŒpvMBFrameStartCurã€pvMBFrameStopCur ç­‰å˜é‡åˆ†åˆ«æŒ‡ä»£ä¸åŒçš„åè®®æ ˆå‡½æ•°æ¥å£ã€‚é€šè¿‡è¿™æ ·çš„æœºåˆ¶ï¼Œå¯ä»¥ä¸ºä¸åŒçš„é€šä¿¡æ¨¡å¼èµ‹å€¼åŠåˆå§‹åŒ–å¯¹åº”çš„æ“ä½œå‡½æ•°ã€‚è¿™ç§ç¼–å†™æ¨¡å¼æä¸ºç»å…¸ä¸”å€¼å¾—å€Ÿé‰´ã€‚å½“ eMBRTUInit æˆåŠŸæ‰§è¡Œåï¼Œåº•å±‚çš„ä¸²å£å’Œå®šæ—¶å™¨ä¹Ÿå°†è¿›è¡Œç›¸åº”çš„åˆå§‹åŒ–ã€‚åˆå§‹åŒ–å®Œæˆåï¼Œå…¨å±€å˜é‡ eMBState ä¼šè¢«è®¾ç½®ä¸º STATE_DISABLEDï¼Œè¿™æ ‡å¿—ç€åè®®æ ˆè¿˜æœªå¯ç”¨ã€‚ åˆå§‹åŒ–å‚æ•°åŒ…æ‹¬ä»è®¾å¤‡åœ°å€ã€ç«¯å£å·ã€æ³¢ç‰¹ç‡å’Œå¥‡å¶æ ¡éªŒä½ï¼ŒåŒæ—¶è¿˜ä¼šåˆå§‹åŒ–è®¡æ—¶å™¨ä»¥ä¾¿åç»­çš„æ•°æ®æ¥æ”¶è¿‡ç¨‹ã€‚ eMBEnableeMBErrorCode eMBEnable(void) eMBErrorCode eStatus = MB_ENOERR; if (eMBState == STATE_DISABLED) /* Activate the protocol stack. */ pvMBFrameStartCur(); eMBState = STATE_ENABLED; else eStatus = MB_EILLSTATE; return eStatus; åœ¨è°ƒç”¨ eMBEnable å‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°ä¼šé¦–å…ˆç¡®è®¤åè®®æ ˆçš„çŠ¶æ€æ˜¯å¦ä¸º STATE_DISABLEDã€‚è‹¥æ¡ä»¶æ»¡è¶³ï¼Œä¾¿ä¼šè°ƒç”¨ä¹‹å‰åˆå§‹åŒ–çš„ pvMBFrameStartCurï¼ˆå³ eMBRTUStartï¼‰æ¥æ¿€æ´»åè®®æ ˆã€‚éšåï¼Œå…¨å±€å˜é‡ eRcvState å°†è¢«è®¾å®šä¸º STATE_RX_INITï¼Œä¸²å£å’Œå®šæ—¶å™¨åŠŸèƒ½ä¹Ÿå°†è¢«å¯ç”¨ï¼Œæ ‡å¿—ç€æ•°æ®ä¼ è¾“å‡†å¤‡å°±ç»ªã€‚ eMBPollåœ¨ä¸€ä¸ªæ— é™å¾ªç¯ä¸­ï¼ŒeMBPoll å‡½æ•°ä¼šä¸æ–­æ‰§è¡Œã€‚é¦–å…ˆï¼Œé€šè¿‡ xMBPortEventGet(eEvent) æ¥æ£€æŸ¥æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿã€‚å¦‚æœæ²¡æœ‰äº‹ä»¶ï¼Œåˆ™ä¸è¿›å…¥çŠ¶æ€æœºï¼›è¿™ä¿è¯äº†åœ¨æœªæ¥æ”¶åˆ°æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæ§åˆ¶æµç¨‹ä¸ä¼šè¢«æ— è°“çš„æ“ä½œè€—è´¹ã€‚ å½“å®šæ—¶å™¨åˆ°æœŸåï¼Œæ”¶åˆ°äº†è¶…æ—¶äº‹ä»¶ï¼Œè¿™ä¼šè°ƒç”¨ pxMBPortCBTimerExpired å‡½æ•°ã€‚æ ¹æ®å½“å‰çš„æ¥æ”¶çŠ¶æ€ eRcvStateï¼Œä¼šè§¦å‘ä¸åŒçš„äº‹ä»¶ï¼Œä¾‹å¦‚åœ¨ STATE_RX_INIT çŠ¶æ€ä¸‹ï¼Œå‘é€ EV_READY äº‹ä»¶ï¼Œè¡¨æ˜å°±ç»ªçŠ¶æ€ï¼›åœ¨ STATE_RX_RCV çŠ¶æ€ä¸‹ï¼Œå‘é€ EV_FRAME_RECEIVED äº‹ä»¶ï¼Œè¡¨æ˜æ¥æ”¶åˆ°æ•°æ®å¸§ã€‚ switch (eRcvState) case STATE_RX_INIT: xNeedPoll = xMBPortEventPost(EV_READY); break; case STATE_RX_RCV: xNeedPoll = xMBPortEventPost(EV_FRAME_RECEIVED); break; case STATE_RX_ERROR: break; default: assert((eRcvState == STATE_RX_INIT) || (eRcvState == STATE_RX_RCV) || (eRcvState == STATE_RX_ERROR)); æ­¤æ—¶ï¼ŒeMBPoll å°†åŸºäºå‘é€çš„äº‹ä»¶æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œåè®®æ ˆä¾¿å¼€å§‹è¿è¡Œã€‚ æ¥æ”¶æ•°æ®åœ¨ eMBPoll å¾ªç¯ä¸­ï¼Œä¸²å£ä¸­æ–­è¢«æ¿€æ´»ï¼Œæ•°æ®æ¥æ”¶æ—¶é¦–å…ˆè§¦å‘ä¸²å£ä¸­æ–­ç¨‹åºï¼Œè°ƒç”¨æ¥æ”¶çŠ¶æ€æœºï¼š BOOL xMBRTUReceiveFSM(void) BOOL xTaskNeedSwitch = FALSE; UCHAR ucByte; assert(eSndState == STATE_TX_IDLE); /* Always read the character. */ (void)xMBPortSerialGetByte((CHAR*)ucByte); switch (eRcvState) case STATE_RX_INIT: vMBPortTimersEnable(); break; case STATE_RX_ERROR: vMBPortTimersEnable(); break; case STATE_RX_IDLE: usRcvBufferPos = 0; ucRTUBuf[usRcvBufferPos++] = ucByte; eRcvState = STATE_RX_RCV; /* Enable t3.5 timers. */ vMBPortTimersEnable(); break; case STATE_RX_RCV: if (usRcvBufferPos MB_SER_PDU_SIZE_MAX) ucRTUBuf[usRcvBufferPos++] = ucByte; else eRcvState = STATE_RX_ERROR; vMBPortTimersEnable(); break; return xTaskNeedSwitch; å½“å‰å…¨å±€å˜é‡ eRcvState ä¸º STATE_RX_IDLE æ—¶ï¼Œæ¥æ”¶çŠ¶æ€æœºé¦–å…ˆè¯»å–å…¥é˜Ÿçš„å­—èŠ‚ã€‚åŒæ—¶ï¼Œå¯åŠ¨äº†ç›¸åº”çš„å®šæ—¶å™¨ã€‚å½“è¿›å…¥åˆ° STATE_RX_RCV çŠ¶æ€åï¼Œç»§ç»­æ¥æ”¶å­—èŠ‚ï¼Œç›´åˆ°è¿›å…¥è¶…æ—¶çŠ¶æ€ã€‚è¶…æ—¶å‘ç”Ÿåï¼Œåè®®æ ˆå°†é€šè¿‡å‘é€ EV_FRAME_RECEIVED äº‹ä»¶ï¼Œå‘ŠçŸ¥æ¥æ”¶çŠ¶æ€å·²å®Œæˆã€‚ æ•°æ®çš„å¤„ç†æ•°æ®æ¥æ”¶ä¹‹åï¼Œåè®®æ ˆçš„ eMBRTUReceive å‡½æ•°å°†è¿›è¡Œ CRC æ ¡éªŒï¼Œå¹¶è´Ÿè´£æå–æ•°æ®å¸§åœ°å€ã€é•¿åº¦æˆ–è¿›è¡Œå…¶ä»–ä¸€è‡´æ€§æ£€æŸ¥ã€‚ eMBErrorCode eMBRTUReceive(UCHAR* pucRcvAddress, UCHAR** pucFrame, USHORT* pusLength) BOOL xFrameReceived = FALSE; eMBErrorCode eStatus = MB_ENOERR; ENTER_CRITICAL_SECTION(); assert(usRcvBufferPos MB_SER_PDU_SIZE_MAX); /* Length and CRC check */ if ((usRcvBufferPos = MB_SER_PDU_SIZE_MIN) (usMBCRC16((UCHAR*)ucRTUBuf, usRcvBufferPos) == 0)) *pucRcvAddress = ucRTUBuf[MB_SER_PDU_ADDR_OFF]; *pusLength = (USHORT)(usRcvBufferPos - MB_SER_PDU_PDU_OFF - MB_SER_PDU_SIZE_CRC); *pucFrame = (UCHAR*)ucRTUBuf[MB_SER_PDU_PDU_OFF]; xFrameReceived = TRUE; else eStatus = MB_EIO; EXIT_CRITICAL_SECTION(); return eStatus; è¯¥å‡½æ•°ä¼šéªŒè¯æ¥æ”¶åˆ°çš„æ•°æ®æœ‰æ•ˆæ€§ï¼Œå¹¶åœ¨æœ‰æ•ˆçš„æƒ…å†µä¸‹å°†æ•°æ®è½¬å‘è‡³ä¸Šå±‚å¤„ç†ã€‚å½“æ•°æ®å¸§æˆåŠŸæå–åï¼Œå‘é€ EV_EXECUTE äº‹ä»¶ï¼Œè¡¨ç¤ºå¯ä»¥è¿›è¡Œåç»­çš„å¤„ç†ã€‚ åœ¨å¤„ç†æ•°æ®çš„é˜¶æ®µï¼Œç³»ç»Ÿä¼šæ ¹æ®æ¥æ”¶åˆ°çš„åŠŸèƒ½ç åœ¨ xFuncHandlers æ•°ç»„ä¸­æŸ¥æ‰¾å¯¹åº”çš„å¤„ç†å‡½æ•°å¹¶æ‰§è¡Œã€‚ case EV_EXECUTE: ucFunctionCode = ucMBFrame[MB_PDU_FUNC_OFF]; eException = MB_EX_ILLEGAL_FUNCTION; for (i = 0; i MB_FUNC_HANDLERS_MAX; i++) if (xFuncHandlers[i].ucFunctionCode == 0) break; else if (xFuncHandlers[i].ucFunctionCode == ucFunctionCode) eException = xFuncHandlers[i].pxHandler(ucMBFrame, usLength); break; if (ucRcvAddress != MB_ADDRESS_BROADCAST) if (eException != MB_EX_NONE) usLength = 0; ucMBFrame[usLength++] = (UCHAR)(ucFunctionCode | MB_FUNC_ERROR); ucMBFrame[usLength++] = eException; if ((eMBCurrentMode == MB_ASCII) MB_ASCII_TIMEOUT_WAIT_BEFORE_SEND_MS) vMBPortTimersDelay(MB_ASCII_TIMEOUT_WAIT_BEFORE_SEND_MS); eStatus = peMBFrameSendCur(ucMBAddress, ucMBFrame, usLength); break; ç»¼ä¸Šæ‰€è¿°ï¼Œæ•´ä¸ªæµç¨‹åŒ…å«äº†åè®®æ ˆçš„åˆå§‹åŒ–ã€å¯åŠ¨ã€è½®è¯¢ã€æ•°æ®çš„æ¥æ”¶åŠå¤„ç†ï¼Œå¾—ä»¥å½¢æˆä¸€ä¸ªå®Œæ•´çš„ä»æœºæ“ä½œå¾ªç¯ã€‚é€šè¿‡æœ‰æ•ˆçš„çŠ¶æ€ç®¡ç†ä¸äº‹ä»¶æœºåˆ¶ï¼Œç¡®ä¿äº†æ•°æ®ä¼ è¾“çš„å¯é ä¸å‡†ç¡®ã€‚ RTU å‡½æ•°è§£æeMBInit è®¾ç½®è®¾å¤‡ç«™å·å®šä¹‰è®¾å¤‡åœ¨ Modbus ç½‘ç»œä¸­çš„å”¯ä¸€æ ‡è¯†ï¼Œè¿™ä¸ªç«™å·é€šå¸¸ç”¨æ¥åŒºåˆ†ä¸åŒçš„ä»è®¾å¤‡ã€‚èŒƒå›´é€šå¸¸ä¸º 1 åˆ° 247ï¼Œä½¿å¾—ç½‘ç»œä¸­çš„æ¯ä¸ªè®¾å¤‡èƒ½å¤Ÿè¢«æ˜ç¡®è¯†åˆ«ã€‚ è®¾ç½®å‡½æ•°æ¥å£å‡†å¤‡å’Œé…ç½®åº”ç”¨ç¨‹åºå°†è¦ä½¿ç”¨çš„å‡½æ•°æ¥å£ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿæœ‰æ•ˆåœ°ä¸è®¾å¤‡é€šä¿¡ã€‚ eMBRTUInitè¯¥å‡½æ•°è´Ÿè´£åˆå§‹åŒ– RTUï¼ˆRemote Terminal Unitï¼‰æ¨¡å¼ä¸‹çš„ Modbus åè®®é€šä¿¡ã€‚ xMBPortSerialInitåˆå§‹åŒ–ä¸²å£è®¾ç½®ï¼Œä»¥ç¡®ä¿èƒ½å¤Ÿé€šè¿‡ä¸²è¡Œæ¥å£è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚ è®¾ç½®æ‰“å¼€ä¸²å£çš„åç§°æŒ‡å®šç”¨äºä¸è®¾å¤‡é€šä¿¡çš„ä¸²å£ï¼Œä¾‹å¦‚ â€œCOM3â€ã€‚ serialInitåŒ…å«ä¸€ç³»åˆ—æ‰“å¼€ä¸²å£å’Œé…ç½®å…¶å±æ€§çš„æ­¥éª¤ã€‚ æ‰“å¼€ä¸²å£é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¿€æ´»æŒ‡å®šçš„ä¸²å£ï¼Œå‡†å¤‡å¼€å§‹æ•°æ®ä¼ è¾“ã€‚ è®¾ç½®ä¸²å£å±æ€§é…ç½®ä¸²å£çš„åŸºæœ¬é€šä¿¡å‚æ•°ï¼ŒåŒ…æ‹¬ï¼š æ³¢ç‰¹ç‡ï¼šä¾‹å¦‚ 9600 æˆ– 19200ï¼ˆå•ä½ï¼šbitsï¼‰ï¼Œå†³å®šæ•°æ®ä¼ è¾“çš„é€Ÿåº¦ã€‚ æ•°æ®ä½ï¼šé€šå¸¸è®¾ç½®ä¸º 8 ä½ï¼Œè¿™æ˜¯ä¼ è¾“æ•°æ®çš„åŸºæœ¬å•ä½ã€‚ å¥‡å¶æ ¡éªŒä½ï¼šè®¾ç½®ä¸ºæ— ã€å¥‡æˆ–å¶ï¼Œä»¥ä¾¿äºé”™è¯¯æ£€æµ‹ã€‚ è®¡ç®—è®¡æ—¶å™¨è®¡æ—¶æ—¶é—´ç¡®å®š Modbus æŠ¥æ–‡çš„è¶…æ—¶æ—¶é—´ï¼Œä»¥ç¡®ä¿åŠæ—¶å“åº”ã€‚ xMBPortTimersInitåˆå§‹åŒ–å®šæ—¶å™¨ä»¥å¤„ç†æ—¶é—´äº‹ä»¶ã€‚ TimersInité…ç½®å®šæ—¶å™¨ä»¥å•æ¬¡è§¦å‘æ¨¡å¼ï¼Œå•ä½è®¾ä¸ºæ¯«ç§’ï¼ˆmsï¼‰ï¼Œä»¥ä¾¿å®æ—¶ç›‘æ§ Modbus äº‹ä»¶ã€‚ è®¾ç½®ä¸º RTU æ¨¡å¼å°†é€šä¿¡æ¨¡å¼é…ç½®ä¸º RTUï¼Œä»¥ä¾¿æŒ‰ç…§ Modbus RTU åè®®æ ¼å¼è¿›è¡Œæ¶ˆæ¯ä¼ è¾“ã€‚ eMBState STATE_DISABLEDå°†å½“å‰çŠ¶æ€è®¾ä¸ºç¦ç”¨ï¼Œä»¥ä¾¿åç»­æ“ä½œå‡†å¤‡å°±ç»ªã€‚ eMBEnable pvMBFrameStartCurï¼ˆå‡½æ•°æŒ‡é’ˆæŒ‡å‘ eMBRTUStartï¼‰å¼€å¯ Modbus é€šä¿¡å¸§å¹¶è¿›å…¥æ¥æ”¶æ¨¡å¼ã€‚ eRcvState STATE_RX_INITè®¾ç½®æ¥æ”¶çŠ¶æ€ä¸ºåˆå§‹åŒ–ï¼Œä»¥æ£€æµ‹æ¥æ”¶çš„ Modbus å¸§ã€‚ vMBPortSerialEnable( TRUE, FALSE );ä¿®æ”¹ä¸²å£çŠ¶æ€ä¸ºæ¥æ”¶æ¨¡å¼ï¼Œå‡†å¤‡æ¥æ”¶æ•°æ®ï¼ŒåŒæ—¶ç¦ç”¨å‘é€æ¨¡å¼ã€‚ vMBPortTimersEnableå¯åŠ¨è¶…æ—¶è®¡æ—¶å™¨ï¼Œå¼€å§‹ç›‘æ§æ¥æ”¶çŠ¶æ€ã€‚ å®šæ—¶å™¨ä¸­æ–­äº‹ä»¶ï¼ˆåˆ¤æ–­ eRcvStateï¼‰å®šä¹‰ä¸åŒæ¥æ”¶åˆ°çŠ¶æ€æ—¶çš„è¡Œä¸ºã€‚ STATE_RX_INITå°†äº‹ä»¶æ ‡å¿—è®¾ç½®ä¸º EV_READYï¼Œè¡¨ç¤ºå‡†å¤‡æ¥æ”¶æ•°æ®ã€‚ STATE_RX_RCVå°†äº‹ä»¶æ ‡å¿—è®¾ç½®ä¸º EV_FRAME_RECEIVEDï¼Œè¡¨ç¤ºæ¥æ”¶åˆ°å®Œæ•´çš„ Modbus å¸§ã€‚ STATE_RX_ERRORæˆ–è€…å¤„ç†æ¥æ”¶è¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯æƒ…å†µã€‚ æ‰§è¡Œå®Œä¸­æ–­äº‹ä»¶ï¼Œå®šæ—¶å™¨å…³é—­ä¸­æ–­å¤„ç†å®Œåï¼Œå¦‚æ— æ–°çš„æ¥æ”¶äº‹ä»¶ï¼Œåˆ™åœæ­¢å®šæ—¶å™¨ã€‚ eRcvState STATE_RX_IDLEè®¾ç½®æ¥æ”¶çŠ¶æ€ä¸ºç©ºé—²ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªå¸§çš„åˆ°æ¥ã€‚ eMBState STATE_ENABLEDçŠ¶æ€æ›´æ–°ä¸ºå¯ç”¨ï¼Œè¡¨ç¤ºè®¾å¤‡å·²å‡†å¤‡å¥½æ¥æ”¶å’Œå‘é€ Modbus æ¶ˆæ¯ã€‚ eMBPollxMBPortEventGetï¼ˆåˆ¤æ–­äº‹ä»¶ï¼‰ç›‘æ§å’Œå¤„ç†äº‹ä»¶ï¼Œç¡®å®šä¸‹ä¸€æ­¥æ“ä½œã€‚ EV_READYå½“è®¾å¤‡å‡†å¤‡å¥½æ¥æ”¶æ•°æ®æ—¶è§¦å‘ç›¸å…³äº‹ä»¶ã€‚ EV_FRAME_RECEIVEDå½“å®Œæ•´çš„ Modbus å¸§è¢«æ¥æ”¶æ—¶è§¦å‘ã€‚ peMBFrameReceiveCurï¼ˆå‡½æ•°æŒ‡é’ˆæŒ‡å‘ eMBRTUReceiveï¼‰å¼€å§‹å¤„ç†æ¥æ”¶åˆ°çš„å¸§ã€‚ æ ¡éªŒæ•°æ®é•¿åº¦å’Œ CRCç¡®è®¤æ•°æ®çš„å®Œæ•´æ€§å’Œæœ‰æ•ˆæ€§ï¼Œé˜²æ­¢å› æ•°æ®æŸåè€Œå¯¼è‡´çš„é”™è¯¯å“åº”ã€‚ ä¿å­˜è®¾å¤‡ç«™å·å­˜å‚¨æ¥è‡ª Modbus å¸§ä¸­çš„è®¾å¤‡ç«™å·ï¼Œä»¥ä¾¿åç»­å‚è€ƒã€‚ ä¿å­˜å¾…æ ¡éªŒæ•°æ®é¦–åœ°å€å’Œé•¿åº¦è®°å½•æ•°æ®çš„èµ·å§‹ä½ç½®å’Œé•¿åº¦ï¼Œä»¥ä¾¿è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†å’Œæ“ä½œã€‚ æ£€æŸ¥è®¾å¤‡ç«™å·æ˜¯å¦ç›¸åŒç¡®è®¤æ¥æ”¶çš„ç«™å·æ˜¯å¦ä¸é¢„æœŸçš„ç«™å·ä¸€è‡´ï¼Œä»¥ä¿è¯æ•°æ®çš„æ­£ç¡®æ€§ã€‚ xMBPortEventPostå°†äº‹ä»¶é˜Ÿåˆ—ä¸­çš„äº‹ä»¶è®¾ä¸º EV_EXECUTEï¼Œå‡†å¤‡æ‰§è¡Œç›¸åº”æ“ä½œã€‚ EV_EXECUTEä¸€æ—¦æ¥æ”¶åˆ°äº‹ä»¶ï¼Œæ‰§è¡Œç›¸å…³æ“ä½œå¹¶è¿”å›å¤„ç†ç»“æœã€‚ EV_FRAME_SENTæ ‡å¿—è¡¨ç¤ºæ•°æ®å¸§å·²æˆåŠŸå‘é€ï¼Œç¡®è®¤æ•°æ®ä¼ è¾“çš„å®Œæˆã€‚","categories":["4.é€šè®¯åè®®","Modbus"]},{"title":"libmodbus æ‰‹å†Œ","path":"/2023/12/19/4-é€šè®¯åè®®-Modbus-libmodbus-æ‰‹å†Œ/","content":"#include modbus.hcc files `pkg-config --cflags --libs libmodbus` DESCRIPTIONlibmodbus æ˜¯ä¸€ä¸ªç”¨äºé€šè¿‡éµå¾ª Modbus åè®®çš„è®¾å¤‡è¿›è¡Œæ•°æ®ä¼ è¾“å’Œæ¥æ”¶çš„åº“ã€‚è¯¥åº“æ”¯æŒå¤šç§åç«¯å®ç°ï¼Œèƒ½å¤Ÿé€šè¿‡ä¸åŒçš„ç½‘ç»œè¿›è¡Œé€šä¿¡ï¼Œä¾‹å¦‚é‡‡ç”¨ä¸²è¡Œé€šä¿¡çš„ RTU æ¨¡å¼æˆ–é€šè¿‡ Ethernet çš„ TCPIPv6ã€‚æœ‰å…³ Modbus åè®®çš„è¯¦ç»†æ–‡æ¡£å¯è®¿é—® Modbus å®˜æ–¹ç½‘ç«™ã€‚ libmodbus ä¸ºåº•å±‚é€šä¿¡å±‚æä¾›äº†æŠ½è±¡ï¼Œå¹¶åœ¨æ‰€æœ‰å—æ”¯æŒçš„å¹³å°ä¸Šæä¾›ç»Ÿä¸€çš„ APIã€‚ è¿™ä»½æ–‡æ¡£æ¦‚è¿°äº† libmodbus çš„åŸºæœ¬æ¦‚å¿µï¼Œè¯´æ˜äº†è¯¥åº“å¦‚ä½•åœ¨ä¸åŒçš„ç¡¬ä»¶å’Œå¹³å°é—´æŠ½è±¡ Modbus é€šä¿¡ï¼Œå¹¶æä¾›äº†ä½œä¸º libmodbus åº“å‚è€ƒçš„å‡½æ•°æ‰‹å†Œã€‚ ContextsModbus åè®®åŒ…å«å¤šç§å˜ä½“ï¼ˆä¾‹å¦‚ï¼Œä¸²è¡Œ RTU æˆ– Ethernet TCPï¼‰ï¼Œä¸ºæ–¹ä¾¿å®ç°ç‰¹å®šå˜ä½“ï¼Œæœ¬åº“è®¾è®¡äº†é’ˆå¯¹æ¯ç§å˜ä½“çš„åç«¯ã€‚åç«¯è¿˜å¯ä»¥çµæ´»æ»¡è¶³å…¶ä»–éœ€æ±‚ï¼ˆä¾‹å¦‚å®æ—¶æ“ä½œï¼‰ã€‚æ¯ä¸ªåç«¯éƒ½æä¾›äº†ç”¨äºåˆ›å»ºæ–°çš„ modbus_t ä¸Šä¸‹æ–‡çš„ç‰¹å®šå‡½æ•°ã€‚modbus_t ä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªä¸é€æ˜ç»“æ„ï¼ŒåŒ…å«ä¸å…¶ä»– Modbus è®¾å¤‡å»ºç«‹è¿æ¥æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå…·ä½“å–å†³äºæ‰€é€‰å˜ä½“ã€‚ RTU ContextRTU åç«¯ï¼ˆè¿œç¨‹ç»ˆç«¯å•å…ƒï¼‰ç”¨äºä¸²è¡Œé€šä¿¡ï¼Œé‡‡ç”¨ç´§å‡‘çš„äºŒè¿›åˆ¶æ•°æ®è¡¨ç¤ºæ–¹å¼è¿›è¡Œåè®®é€šä¿¡ã€‚RTU æ ¼å¼åœ¨å‘½ä»¤æ•°æ®åé™„åŠ ä¸€ä¸ªå¾ªç¯å†—ä½™æ ¡éªŒï¼ˆCRCï¼‰ä½œä¸ºé”™è¯¯æ£€æŸ¥æœºåˆ¶ï¼Œä»¥ç¡®ä¿æ•°æ®çš„å¯é æ€§ã€‚Modbus RTU æ˜¯ Modbus æœ€æ™®éçš„å®ç°æ–¹å¼ã€‚æ ¹æ®ç»´åŸºç™¾ç§‘çš„ä¿¡æ¯ï¼ŒModbus RTU æ¶ˆæ¯å¿…é¡»è¿ç»­å‘é€ï¼Œä¸èƒ½åœ¨å­—ç¬¦é—´åœé¡¿ã€‚ RTU å¸§å®šä¹‰äº†ä»å±è®¾å¤‡ï¼ˆslaveï¼‰å’Œä¸»è®¾å¤‡ï¼ˆmasterï¼‰çš„è§’è‰²ï¼Œå…¶ä¸­ä»å±è®¾å¤‡å¤„ç† Modbus è¯·æ±‚ï¼Œè€Œä¸»è®¾å¤‡å‘é€è¯·æ±‚ã€‚é€šä¿¡æ€»æ˜¯ç”±ä¸»è®¾å¤‡å‘èµ·ã€‚ å¤šä¸ª Modbus è®¾å¤‡å¯ä»¥è¿æ¥åœ¨åŒä¸€ç‰©ç†é“¾è·¯ä¸Šï¼Œå› æ­¤åœ¨å‘é€æ¶ˆæ¯ä¹‹å‰ï¼Œå¿…é¡»ä½¿ç”¨ modbus_set_slave(3) è®¾ç½®ä»å±è®¾å¤‡ï¼ˆæ¥æ”¶æ–¹ï¼‰ã€‚è‹¥è¿è¡Œçš„æ˜¯ä»å±è®¾å¤‡ï¼Œåˆ™å…¶ä»å±ç¼–å·å°†ç”¨äºè¿‡æ»¤æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚ libmodbus å®ç°çš„ RTU ä¸åŸºäºæ—¶é—´ï¼Œå¦‚åŸå§‹ Modbus è§„èŒƒä¸­æ‰€è¿°ï¼Œè€Œæ˜¯å°½å¯èƒ½å¿«åœ°å‘é€æ‰€æœ‰å­—èŠ‚ã€‚å½“æ‰€æœ‰é¢„æœŸçš„å­—ç¬¦éƒ½è¢«æ¥æ”¶æ—¶ï¼Œåˆ™å“åº”è§†ä¸ºå®Œæˆã€‚è¿™ç§å®ç°æä¾›äº†éå¸¸å¿«é€Ÿçš„é€šä¿¡ï¼Œä½†éœ€è¦æ³¨æ„ä»è®¾å¤‡çš„å“åº”è¶…æ—¶å¿…é¡»è®¾ç½®ä¸ºå°äºä¸»è®¾å¤‡çš„å“åº”è¶…æ—¶ï¼ˆå¦åˆ™ï¼Œå½“æŸä¸ªä»è®¾å¤‡ä¸å“åº”æ—¶ï¼Œå…¶ä»–ä»è®¾å¤‡å¯èƒ½ä¼šå¿½ç•¥ä¸»è®¾å¤‡çš„è¯·æ±‚ï¼‰ã€‚ Create a Modbus RTU context modbus_new_rtu(3) Set the serial mode è·å–ä¸²è¡Œæ¨¡å¼: modbus_rtu_get_serial_mode(3) è®¾ç½®ä¸²è¡Œæ¨¡å¼: modbus_rtu_set_serial_mode(3) è·å– RTS: modbus_rtu_get_rts(3) è®¾ç½® RTS: modbus_rtu_set_rts(3) è®¾ç½®è‡ªå®šä¹‰ RTS: modbus_rtu_set_custom_rts(3) è·å– RTS å»¶è¿Ÿ: modbus_rtu_get_rts_delay(3) è®¾ç½® RTS å»¶è¿Ÿ: modbus_rtu_set_rts_delay(3) TCP (IPv4) ContextTCP åç«¯å®ç°äº†ç”¨äº TCPIPv4 ç½‘ç»œé€šä¿¡çš„ Modbus å˜ä½“ã€‚ç”±äºåº•å±‚å¤„ç†äº†æ ¡éªŒå’Œçš„è®¡ç®—ï¼Œå› æ­¤ä¸éœ€è¦åœ¨åº”ç”¨å±‚è¿›è¡Œæ­¤æ“ä½œã€‚ Create a Modbus TCP context modbus_new_tcp(3) TCP PI (IPv4 and IPv6) ContextTCP PIï¼ˆåè®®æ— å…³ï¼‰åç«¯å®ç°äº†ç”¨äº TCP IPv4 å’Œ IPv6 ç½‘ç»œé€šä¿¡çš„ Modbus å˜ä½“ã€‚åŒæ ·ï¼Œåº•å±‚å¤„ç†äº†æ ¡éªŒå’Œçš„è®¡ç®—ï¼Œå› æ­¤æ­¤å˜ä½“ä¹Ÿä¸éœ€è¦è¿›è¡Œæ­¤æ“ä½œã€‚ ä¸ä»…æ”¯æŒ TCP IPv4 çš„åç«¯ä¸åŒï¼ŒTCP PI åç«¯æä¾›äº†ä¸»æœºåè§£æï¼Œä½†é¢å¤–æ¶ˆè€—çº¦ 1KB çš„å†…å­˜ã€‚ Create a Modbus TCP context modbus_new_tcp_pi(3) Commonåœ¨ä½¿ç”¨ä»»ä½• libmodbus å‡½æ•°ä¹‹å‰ï¼Œè°ƒç”¨è€…å¿…é¡»ä½¿ç”¨ä¸Šè¿°å‡½æ•°åˆ†é…å¹¶åˆå§‹åŒ– modbus_t ä¸Šä¸‹æ–‡ï¼Œç„¶åä»¥ä¸‹å‡½æ•°ç”¨äºä¿®æ”¹å’Œé‡Šæ”¾è¯¥ä¸Šä¸‹æ–‡ï¼š é‡Šæ”¾ libmodbus ä¸Šä¸‹æ–‡: modbus_free(3) è®¾ç½®ä»å± ID: modbus_set_slave(3) å¯ç”¨è°ƒè¯•æ¨¡å¼: modbus_set_debug(3) Timeout settings è·å–å­—èŠ‚è¶…æ—¶: modbus_get_byte_timeout(3) è®¾ç½®å­—èŠ‚è¶…æ—¶: modbus_set_byte_timeout(3) è·å–å“åº”è¶…æ—¶: modbus_get_response_timeout(3) è®¾ç½®å“åº”è¶…æ—¶: modbus_set_response_timeout(3) Error recovery mode è®¾ç½®é”™è¯¯æ¢å¤: modbus_set_error_recovery(3) Settergetter of internal socket è®¾ç½®å¥—æ¥å­—: modbus_set_socket(3) è·å–å¥—æ¥å­—: modbus_get_socket(3) Information about header è·å–å¤´é•¿åº¦: modbus_get_header_length(3) Macros for data manipulation MODBUS_GET_HIGH_BYTE(data) - ä»å­—èŠ‚ä¸­æå–é«˜å­—èŠ‚ MODBUS_GET_LOW_BYTE(data) - ä»å­—èŠ‚ä¸­æå–ä½å­—èŠ‚ MODBUS_GET_INT64_FROM_INT16(tab_int16, index) - ä» tab_int16 ä¸­èµ·å§‹äº index çš„å››ä¸ª int16 æ„å»ºä¸€ä¸ª int64 MODBUS_GET_INT32_FROM_INT16(tab_int16, index) - ä» tab_int16 ä¸­èµ·å§‹äº index çš„ä¸¤ä¸ª int16 æ„å»ºä¸€ä¸ª int32 MODBUS_GET_INT16_FROM_INT8(tab_int8, index) - ä» tab_int8 ä¸­èµ·å§‹äº index çš„ä¸¤ä¸ª int8 æ„å»ºä¸€ä¸ª int16 MODBUS_SET_INT16_TO_INT8(tab_int8, index, value) - å°† int16 å€¼è®¾ç½®åˆ° tab_int8[index] å¼€å§‹çš„ä¸¤ä¸ªå­—èŠ‚ MODBUS_SET_INT32_TO_INT16(tab_int16, index, value) - å°† int32 å€¼è®¾ç½®åˆ° tab_int16[index] å¼€å§‹çš„ä¸¤ä¸ª int16 MODBUS_SET_INT64_TO_INT16(tab_int16, index, value) - å°† int64 å€¼è®¾ç½®åˆ° tab_int16[index] å¼€å§‹çš„å››ä¸ª int16 Handling of bits and bytes modbus_set_bits_from_byte(3) modbus_set_bits_from_bytes(3) modbus_get_byte_from_bits(3) Set or get float numbers modbus_get_float_abcd(3) modbus_set_float_abcd(3) modbus_get_float_badc(3) modbus_set_float_badc(3) modbus_get_float_cdab(3) modbus_set_float_cdab(3) modbus_get_float_dcba(3) modbus_set_float_dcba(3) modbus_get_float(3) (å·²å¼ƒç”¨) modbus_set_float(3) (å·²å¼ƒç”¨) Connectionæä¾›äº†ä¸€äº›å‡½æ•°ç”¨äºä¸ Modbus è®¾å¤‡å»ºç«‹å’Œå…³é—­è¿æ¥ï¼š å»ºç«‹è¿æ¥: modbus_connect(3) å…³é—­è¿æ¥: modbus_close(3) åˆ·æ–°è¿æ¥: modbus_flush(3) ClientModbus åè®®å®šä¹‰äº†ä¸åŒçš„æ•°æ®ç±»å‹ä»¥åŠä»è¿œç¨‹è®¾å¤‡è¯»å–å’Œå†™å…¥å®ƒä»¬çš„å‡½æ•°ã€‚å®¢æˆ·ç«¯ä½¿ç”¨ä»¥ä¸‹å‡½æ•°å‘é€ Modbus è¯·æ±‚ï¼š Read data modbus_read_bits(3) modbus_read_input_bits(3) modbus_read_registers(3) modbus_read_input_registers(3) modbus_report_slave_id(3) Write data modbus_write_bit(3) modbus_write_register(3) modbus_write_bits(3) modbus_write_registers(3) Write and read data modbus_write_and_read_registers(3) Raw requests modbus_send_raw_request(3) modbus_receive_confirmation(3) Reply an exception modbus_reply_exception(3) ServeræœåŠ¡å™¨ç­‰å¾…å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¹¶åœ¨æ¶‰åŠè¯·æ±‚æ—¶ç»™äºˆå›åº”ã€‚libmodbus æä¾›ä»¥ä¸‹å‡½æ•°ä»¥å¤„ç†è¯·æ±‚ï¼š Data mapping modbus_mapping_new(3) modbus_mapping_free(3) Receive modbus_receive(3) Reply modbus_reply(3) modbus_reply_exception(3) ERROR HANDLINGlibmodbus å‡½æ•°ä½¿ç”¨ä¸ POSIX ç³»ç»Ÿä¸­å¸¸è§çš„æ ‡å‡†çº¦å®šæ¥å¤„ç†é”™è¯¯ã€‚é€šå¸¸ï¼Œè¿™æ„å‘³ç€åœ¨å‘ç”Ÿå¤±è´¥æ—¶ï¼Œlibmodbus å‡½æ•°å°†è¿”å› NULL å€¼ï¼ˆå¦‚æœæ˜¯æŒ‡é’ˆï¼‰æˆ–è´Ÿå€¼ï¼ˆå¦‚æœæ˜¯æ•´æ•°ï¼‰ï¼Œå®é™…é”™è¯¯ä»£ç å°†å­˜å‚¨åœ¨ errno å˜é‡ä¸­ã€‚ æä¾›äº† modbus_strerror() å‡½æ•°ï¼Œç”¨äºå°† libmodbus ç‰¹å®šçš„é”™è¯¯ä»£ç è½¬æ¢ä¸ºé”™è¯¯æ¶ˆæ¯å­—ç¬¦ä¸²ï¼›æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒ modbus_strerror(3)ã€‚ MISCELLANEOUSLIBMODBUS_VERSION_STRING å¸¸é‡æŒ‡ç¤ºç¨‹åºç¼–è¯‘æ—¶ä¸å“ªä¸ª libmodbus ç‰ˆæœ¬ç›¸å…³è”ã€‚å˜é‡ libmodbus_version_majorã€libmodbus_version_minor å’Œ libmodbus_version_micro ç»™å‡ºäº†ç¨‹åºé“¾æ¥çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚","tags":["clippings"],"categories":["4.é€šè®¯åè®®","Modbus"]},{"title":"libmodbusç¼–è¯‘","path":"/2023/12/18/4-é€šè®¯åè®®-Modbus-libmodbusç¼–è¯‘/","content":"è®¿é—® GitHub é¡µé¢ libmodbusï¼Œç‚¹å‡»ç»¿è‰²çš„â€œCodeâ€æŒ‰é’®ï¼Œç„¶åé€‰æ‹©â€œDownload ZIPâ€è¿›è¡Œä¸‹è½½ã€‚è§£å‹åå³å¯è·å¾—æºä»£ç ã€‚ äº¤å‰ç¼–è¯‘åœ¨è¿›è¡Œäº¤å‰ç¼–è¯‘æ—¶ï¼Œå»ºè®®æ·» åŠ  --prefix å‚æ•°ï¼Œä»¥ä¾¿å°†ç›¸å…³åº“é›†ä¸­ç®¡ç†ï¼Œä¾¿äºä¹‹åå°†å…¶å¤åˆ¶åˆ°å¼€å‘æ¿çš„ç›¸åº”ç›®å½•ä¸­ã€‚å› æ­¤ï¼Œæ­£ç¡®çš„é…ç½®å‘½ä»¤åº”å¦‚ä¸‹æ‰€ç¤ºï¼š ./configure --build=i686 --host=arm-none-linux-gnueabi --enable-static --prefix=/root/libmodbus-3.1.1/install/ make install åœ¨ PC ä¸Šç¼–è¯‘å’Œå®‰è£…çš„å‘½ä»¤ç›¸å¯¹ç®€å•ï¼š ./configure make install åœ¨å¼€å‘æ¿ä¸Šè¿è¡Œè¯¸å¦‚ unit-test-xxx çš„ç¨‹åºæ—¶ï¼Œå¿…é¡»é¦–å…ˆç¡®è®¤ç½‘ç»œå’Œä¸²å£è®¾ç½®ã€‚å¦‚æœéœ€è¦æµ‹ è¯• TCP è¿æ¥ï¼Œéœ€è¦ä¿®æ”¹æºä»£ç ä¸­ çš„ IP åœ°å€ï¼Œå› ä¸ºé»˜è®¤è®¾ç½®çš„æ˜¯å›ç¯åœ°å€ã€‚å¯¹äºæƒ³è¦æµ‹ è¯• RTU çš„æƒ…å†µï¼Œåˆ™éœ€è¦å°†ä¸²å£è®¾å¤‡æ–‡ä»¶åä¿®æ”¹ä¸ºç›¸åº”çš„åç§°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒåµŒå…¥å¼å¼€å‘æ¿ä½¿ç”¨çš„è®¾å¤‡æ–‡ä»¶ æ˜¯ /dev/ttySxï¼Œå…·ä½“æ˜¯å“ªä¸€ä¸ªåˆ™ä¾èµ–äºå¼€å‘æ¿çš„é…ç½®ã€‚åŒæ—¶ï¼Œåœ¨ä¸ªäººç”µè„‘ä¸Šï¼Œä¸²å£é€šå¸¸ æ˜¯ /dev/ttyUSB0ã€‚å¯¹äºè¿è¡Œåœ¨è™šæ‹Ÿæœºä¸Šçš„æƒ…å†µï¼Œç¡®ä¿ä¸²å£è®¾ç½®æ˜¯åœ¨è™šæ‹Ÿæœºå´è€Œéæœ¬åœ°ä¸»æœºä¸Šã€‚ ä¿®æ”¹ç¤ºä¾‹ åœ¨ unit-test-server.c æ–‡ä»¶ä¸­çš„ç›¸åº”ä»£ç å—ï¼š if (use_backend == TCP) ctx = modbus_new_tcp(192.168.169.209, 1502); query = malloc(MODBUS_TCP_MAX_ADU_LENGTH); else if (use_backend == TCP_PI) ctx = modbus_new_tcp_pi(::0, 1502); query = malloc(MODBUS_TCP_MAX_ADU_LENGTH); else ctx = modbus_new_rtu(/dev/ttyS1, 115200, N, 8, 1); modbus_set_slave(ctx, SERVER_ID); query = malloc(MODBUS_RTU_MAX_ADU_LENGTH); åœ¨ unit-test-client.c æ–‡ä»¶ä¸­çš„ä»£ç å—ï¼š if (use_backend == TCP) ctx = modbus_new_tcp(192.168.169.209, 1502); else if (use_backend == TCP_PI) ctx = modbus_new_tcp_pi(::1, 1502); else ctx = modbus_new_rtu(/dev/ttyUSB0, 115200, N, 8, 1); æµ‹è¯• åœ¨ test ç›®å½• ä¸‹ï¼Œç±» ä¼¼ unit-test-server çš„æ–‡ä»¶å®é™…ä¸Šä¸æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œæ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œå®ƒä¼šè°ƒç”¨åŒä¸€ç›®å½• ä¸‹ .lib/ ç›®å½•ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ åœ¨ P C ä¸Šï¼Œéœ€è¦æ‰§è¡Œç›¸åº”çš„è„šæœ¬æ–‡ä»¶ï¼Œè€Œåœ¨åµŒå…¥å¼å¹³å°ä¸Šï¼Œåˆ™éœ€è¦ç›´æ¥è¿è¡Œå¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿™ä¸€ç‚¹å¯¹äºæ­£ç¡®æ‰§è¡Œæµ‹è¯•ç¨‹åºè‡³å…³é‡è¦ï¼Œåº”ç¡®ä¿åœ¨è¿ç§»æˆ–éƒ¨ç½²æ—¶æ³¨æ„æ–‡ä»¶ç±»å‹å’Œæ‰§è¡Œæ–¹å¼çš„ç›¸åº”å·®å¼‚ã€‚ Win å¹³å°åˆ©ç”¨ Qt ç¼–è¯‘å‡†å¤‡æºæ–‡ä»¶ è¿›å…¥ src ç›®å½•ï¼Œé€‰æ‹©æ‰€æœ‰ .cpp å’Œ .h æ–‡ä»¶ï¼ŒåŒ…æ‹¬ win32 æ–‡ä»¶å¤¹ä¸­çš„ config.hã€‚å°†è¿™äº›æ–‡ä»¶å¤åˆ¶åˆ°é¡¹ç›®ä¸­çš„ modbus æ–‡ä»¶å¤¹ä¸­ã€‚ åœ¨ Qt å®¢æˆ·ç«¯ä¸­æ·»åŠ æ–‡ä»¶ æ‰“å¼€ Qt Creatorï¼Œé€‰æ‹©é¡¹ç›®ï¼Œåœ¨å·¦ä¾§çš„é¡¹ç›®æ–‡ä»¶ç®¡ç†å™¨ä¸­å³é”®ç‚¹å‡»é¡¹ç›®åç§°ï¼Œé€‰æ‹©â€œæ·»åŠ ç°æœ‰æ–‡ä»¶â€ï¼Œæ‰¾åˆ°å…ˆå‰å¤åˆ¶çš„æ‰€æœ‰ .cpp å’Œ .h æ–‡ä»¶å¹¶æ·»åŠ åˆ°å·¥ç¨‹ä¸­ã€‚ é…ç½®é¡¹ç›®æ–‡ä»¶ åœ¨é¡¹ç›®æ–‡ä»¶ï¼ˆ.pro æ–‡ä»¶ï¼‰ä¸­ï¼Œæ·»åŠ  LIBS += -lws2_32ã€‚æ­¤é“¾æ¥æŒ‡ä»¤ç”¨äºé“¾æ¥ Windows Socket åº“ï¼Œç¡®ä¿ç½‘ç»œåŠŸèƒ½æ­£å¸¸ã€‚ æ‰§è¡Œæ„å»º æ‰§è¡Œæ„å»ºæ“ä½œå¹¶åœ¨ä»£ç ä¸­åŒ…å« #include config.hã€‚è¿™å°†ç¡®ä¿é…ç½®æ–‡ä»¶è¢«æ­£ç¡®å¼•ç”¨ã€‚ æ³¨æ„ï¼šåœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹é”™è¯¯æ¶ˆæ¯ï¼šerror: undefined reference to qMainã€‚æ­¤é”™è¯¯è¡¨æ˜ç¼–è¯‘çš„å·¥ç¨‹ç¼ºå°‘ç¨‹åºçš„ main å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•° æ˜¯ C++ç¨‹åºæ‰§è¡Œçš„èµ·ç‚¹ã€‚éœ€è¦ç¡®è®¤å­˜åœ¨åŒ…å« main å‡½æ•°çš„æºä»£ç æ–‡ä»¶ã€‚ å¸¸ç”¨ API é‡Šæ”¾ä¸Šä¸‹æ–‡ ä½¿ç”¨ modbus_free (); æ¥ é‡Šæ”¾ä¹‹å‰åˆ†é…çš„ Modbus ä¸Šä¸‹æ–‡ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚ è®¾ç½®ä»è®¾ å¤‡ ID ä½¿ç”¨ modbus_set _slave (); æ¥è®¾ç½®å½“å‰ Modbus ä»è®¾å¤‡çš„ IDã€‚ å¯åŠ¨è°ƒè¯•æ¨¡å¼ ä½¿ç”¨ modbus_set_debug(); å¯ç”¨è°ƒè¯•ä¿¡æ¯ï¼Œæœ‰åŠ©äºæ’æŸ¥é—®é¢˜ã€‚ è¶…æ—¶è®¾ç½® modbus_get_byte_timeout(); modbus_set_byte_timeout(); modbus_get_response_timeout(); modbus_set_response_timeout(); modbus_get_indication_timeout(); modbus_set_indication_timeout(); é”™è¯¯æ¢å¤æ¨¡å¼ ä½¿ç”¨ modbus_set_error_recovery();ï¼Œå¯è®¾ç½®é”™è¯¯å‘ç”Ÿæ—¶çš„æ¢å¤ç­–ç•¥ã€‚ è®¾ç½®æˆ–è·å–å†… éƒ¨ socket ä½¿ç”¨ modbu s_set_socket(); è®¾ç½®ä½¿ç”¨çš„ socketï¼Œå’Œ modbu s_get_ socket(); è·å–å½“å‰çš„ socket ä¿¡æ¯ã€‚ è·å–å¤´éƒ¨ä¿¡æ¯é•¿åº¦ ä½¿ç”¨ modbus_get_head er_len gth(); è·å– Modbus æ¶ˆæ¯å¤´çš„é•¿åº¦ã€‚ æ•°æ®æ“ä½œå® MODBUS_GET_HIGH_BYTE(data); // è·å–æ•°æ®çš„é«˜å­—èŠ‚MODBUS_GET_LOW_BYTE(data); // è·å–æ•°æ®çš„ä½å­—èŠ‚MODBUS_GET_INT64_FROM_INT16(tab_int16, index); // ä»tab_int16[index]èµ·å§‹çš„å››ä¸ªint16æ„å»ºä¸€ä¸ªint64MODBUS_GET_INT32_FROM_INT16(tab_int16, index); // ä»tab_int16[index]èµ·å§‹çš„ä¸¤ä¸ªint16æ„å»ºä¸€ä¸ªint32MODBUS_GET_INT16_FROM_INT8(tab_int8, index); // ä»tab_int8[index]èµ·å§‹çš„ä¸¤ä¸ªint8æ„å»ºä¸€ä¸ªint16MODBUS_SET_INT16_TO_INT8(tab_int8, index, value); // å°†ä¸€ä¸ªint16å€¼è®¾ç½®åˆ°tab_int8[index]èµ·å§‹çš„ä¸¤ä¸ªå­—èŠ‚MODBUS_SET_INT32_TO_INT16(tab_int16, index, value); // å°†ä¸€ä¸ªint32å€¼è®¾ç½®åˆ°tab_int16[index]èµ·å§‹çš„ä¸¤ä¸ªint16MODBUS_SET_INT64_TO_INT16(tab_int16, index, value); // å°†ä¸€ä¸ªint64å€¼è®¾ç½®åˆ°tab_int16[index]èµ·å§‹çš„å››ä¸ªint16 å¤„ ç† bit s å’Œ bytes ä½¿ç”¨ modbus_set_bits_from_byte(); ä½¿ç”¨ modbus_set_bits_from_bytes(); ä½¿ç”¨ modbus_get_byte_from_bits(); è®¾ç½®æˆ–è·å–æµ®ç‚¹æ•° ä½¿ç”¨ä»¥ä¸‹å‡½æ•°è®¾ç½®æˆ–è·å–æµ®ç‚¹æ•°ï¼š modbus_get_float_abcd(); modbus_set_float_abcd(); modbus_get_float_badc(); modbus_set_float_badc(); modbus_get_float_cdab(); modbus_set_float_cdab(); modbus_get_float_dcba(); modbus_set_float_dcba(); è¿æ¥ç®¡ç† å»ºç«‹è¿æ¥ï¼šä½¿ç”¨ modbus_connect(); å…³é—­è¿æ¥ï¼šä½¿ç”¨ modbus_close(); åˆ·æ–°è¿æ¥ï¼šä½¿ç”¨ modbus_flush(); *å®¢æˆ·ç«¯æ“ä½œ * Modbus åè®®å®šä¹‰äº†ä¸åŒçš„æ•°æ®ç±»å‹å’Œå‡½æ•°ï¼Œå®¢æˆ·ç«¯å¯ ä»¥ä½¿ç”¨ä»¥ä¸‹å‡½ æ•°å‘è¿œç¨‹è®¾å¤‡å‘é€ Modbus è¯·æ±‚ï¼š è¯»æ•°æ®ï¼š modbus_read_bits(); modbus_read_input_bits(); modbus_read_registers(); modbus_read_input_registers(); modbus_report_slave_id(); å†™æ•°æ®ï¼š modbus_write_bit(); modbus_write_registers(); modbus_write_bits(); modbus_write_registers(); è¯»å†™æ•°æ®ï¼š mo dbus_write_and_read_registers(); Raw è¯·æ±‚ï¼š modbus_send_raw_request(); modbus_receive_confirmation(); å“åº”å¼‚å¸¸ï¼š modbus_reply_exception(); æœåŠ¡å™¨æ“ä½œ æœåŠ¡å™¨ç­‰å¾…å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¹¶åœ¨éœ€è¦æ—¶ç»™äºˆå“åº”ã€‚ å¯åŠ¨ç›‘å¬ï¼š modbus_tcp_listen(); modbus_tcp_accept(); modbus_tcp_pi_listen(); modbus_tcp_pi_accept(); æ¥æ”¶è¯·æ±‚ï¼šä½¿ç”¨ modbus_receive(); å‘é€å“åº”ï¼š modbus_reply(); modbus_reply_exception(); é”™è¯¯å¤„ç† ä½¿ç”¨ modbus_strerror(); å¯ä»¥è·å–é”™è¯¯ä¿¡æ¯çš„å­—ç¬¦ä¸²æè¿°ã€‚ RTU ä¸Šä¸‹æ–‡æ“ä½œ ä½¿ç”¨ modbu s_n ew_rtu(); åˆ›å»ºä¸€ä¸ª RTU ä¸Šä¸‹æ–‡ è®¾ç½®ä¸²å£æ¨¡å¼åŠå±æ€§ï¼š modbus_rtu_get_serial_mode(); modbus_rtu_set_serial_mode(); modbus_rtu_get_rts(); modbus_rtu_set_rts(); modbus_rtu_set_custom_rts(); modbus_rtu_get_rts_delay(); modbus_rtu_set_rts_delay(); TCP ( IPv4) ä¸Šä¸‹æ–‡ åˆ›å»º TCP ä¸Šä¸‹æ–‡ï¼šä½¿ç”¨ modbus_new_tcp(); TCP PI ( IPv4 å’Œ IPv6) ä¸Šä¸‹æ–‡ åˆ›å»º TCP PI ä¸Šä¸‹æ–‡ï¼šä½¿ç”¨ modbus_new_tcp_pi();","categories":["4.é€šè®¯åè®®","Modbus"]},{"title":"Modbus","path":"/2023/12/15/4-é€šè®¯åè®®-Modbus-Modbus/","content":"Modbus æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„é€šä¿¡åè®®ï¼Œæ—¨åœ¨è¿æ¥ç”µå­è®¾å¤‡å¹¶åœ¨å®ƒä»¬ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚è¿™ä¸ªåè®®äº 1979 å¹´ç”± Modicon å¼€å‘ï¼Œç°å·²æˆä¸ºæ–½è€å¾·ç”µæ°”ï¼ˆSchneider Electricï¼‰çš„ä¸€éƒ¨åˆ†ã€‚Modbus å·²æˆä¸ºå·¥ä¸šç¯å¢ƒä¸­çš„æ ‡å‡†åè®®ï¼Œç‰¹åˆ«æ˜¯ä¸ºç›‘æ§æ§åˆ¶å’Œæ•°æ®é‡‡é›†ï¼ˆSCADAï¼‰ç³»ç»Ÿè€Œè®¾è®¡ã€‚å®ƒæœ‰æ•ˆåœ°å®ç°äº†è‡ªåŠ¨åŒ–ç³»ç»Ÿä¸å„ç§è¿æ¥è®¾å¤‡ä¹‹é—´çš„é€šä¿¡ï¼Œè¿™äº›è®¾å¤‡åŒ…æ‹¬ä¼ æ„Ÿå™¨ã€æ‰§è¡Œå™¨å’Œæ§åˆ¶å™¨ã€‚ ä¸»è¦ç‰¹ç‚¹ å¼€æ”¾ä¸”ç®€å•ï¼šä½œä¸ºä¸€ç§å¼€æ”¾æ ‡å‡†ï¼ŒModbus çš„å®ç°ç›¸å¯¹ç®€å•ï¼Œæ˜¾è‘—ä¿ƒè¿›äº†å…¶åœ¨å·¥ä¸šè‡ªåŠ¨åŒ–è®¾ç½®ä¸­çš„æ™®åŠã€‚è¿™ç§æ˜“äºå®æ–½çš„æ€§è´¨é¼“åŠ±å¼€å‘è€…å’Œç»„ç»‡å°† Modbus æ•´åˆåˆ°å…¶ç³»ç»Ÿä¸­ï¼Œæ— éœ€è¿›è¡Œå¤æ‚çš„å®šåˆ¶ã€‚ è®¾å¤‡äº’æ“ä½œæ€§ï¼šModbus çš„ä¸€å¤§ä¼˜åŠ¿åœ¨äºå®ƒèƒ½å¤Ÿå®ç°ä¸åŒåˆ¶é€ å•†è®¾å¤‡ä¹‹é—´çš„é€šä¿¡ã€‚è¿™ç§ç‰¹æ€§æ”¯æŒå¤šæ ·åŒ–çš„è®¾å¤‡ï¼Œå¢å¼ºäº†å·¥ä¸šè‡ªåŠ¨åŒ–é¡¹ç›®çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚ å®æ—¶é€šä¿¡ï¼šModbus æ—¨åœ¨å¤„ç†éœ€è¦åŠæ—¶ä¸”ç¡®å®šæ€§é€šä¿¡çš„åº”ç”¨ã€‚è¿™ä¸€ç‰¹æ€§åœ¨å»¶è¿Ÿä¼šå½±å“æ“ä½œå®‰å…¨æˆ–æ•ˆç‡çš„åœºæ™¯ä¸‹è‡³å…³é‡è¦ï¼Œä¾‹å¦‚åˆ¶é€ è¿‡ç¨‹æˆ–ç›‘æ§ç³»ç»Ÿä¸­ã€‚ ä½å¼€é”€ï¼šModbus çš„é€šä¿¡è¿‡ç¨‹å¯¹å¸¦å®½å’Œå¤„ç†èƒ½åŠ›çš„éœ€æ±‚è¾ƒä½ã€‚è¿™ç§é«˜æ•ˆæ€§ä½¿å¾— Modbus å¯ä»¥é›†æˆåˆ°ä½èƒ½è€—ç¯å¢ƒå’Œå…·æœ‰æˆæœ¬æ•ˆç›Šã€ç»´æŠ¤æˆæœ¬ä½çš„ç³»ç»Ÿä¸­ï¼Œä»è€Œä½¿å…¶åœ¨å°å‹æ“ä½œå’Œå¤§å‹å¤æ‚å®‰è£…ä¸­åŒæ ·é€‚ç”¨ã€‚ é€šä¿¡æ¨¡å¼ Modbus TCP: é€‚ç”¨äºç°ä»£åŒ–å·¥ä¸šæ§åˆ¶ç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯éœ€è¦è¿œç¨‹é€šä¿¡ã€å¤§é‡è®¾å¤‡ã€æˆ–è€…é«˜é€Ÿä¼ è¾“çš„åœºæ™¯ã€‚ æ˜“äºé›†æˆåˆ°ç°æœ‰çš„ä»¥å¤ªç½‘ç½‘ç»œä¸­ã€‚ Modbus ASCII: ç”¨äºå°å‹ç³»ç»Ÿæˆ–éœ€è¦è°ƒè¯•çš„åœºæ™¯ã€‚ é€‚åˆä½é€Ÿé€šä¿¡ä¸”å¯¹å¸¦å®½è¦æ±‚ä¸é«˜çš„ç¯å¢ƒã€‚ Modbus RTU: æœ€å¸¸ç”¨çš„æ¨¡å¼ï¼Œé€‚åˆèµ„æºå—é™ã€å¯é æ€§è¦æ±‚é«˜çš„åµŒå…¥å¼ç³»ç»Ÿå’Œä¸­å°å‹å·¥ä¸šç³»ç»Ÿã€‚ Modbus Plus: é€‚ç”¨äºå¤§å‹åˆ†å¸ƒå¼å·¥ä¸šæ§åˆ¶ç³»ç»Ÿï¼Œéœ€è¦å¤šä¸»ç«™é€šä¿¡ã€é«˜é€Ÿä¼ è¾“å’Œå¯é æ€§çš„åœºæ™¯ã€‚ éœ€è¦ä¸“ç”¨ç¡¬ä»¶æ”¯æŒï¼Œé€šå¸¸ä»…åœ¨ Schneider Electric ç³»ç»Ÿä¸­è§åˆ°ã€‚ Modbus RTUModbus RTU æ˜¯æœ€å¸¸ç”¨çš„ Modbus æ¨¡å¼ï¼ŒåŸºäºä¸²å£é€šä¿¡ï¼Œä½¿ç”¨äºŒè¿›åˆ¶ç¼–ç æ•°æ®ã€‚ é€šä¿¡æ–¹å¼: åŸºäºä¸²è¡Œæ¥å£ï¼ˆå¦‚ RS-232 æˆ– RS-485ï¼‰ã€‚ æ•°æ®ç¼–ç : æ•°æ®ä»¥ç´§å‡‘çš„äºŒè¿›åˆ¶æ ¼å¼ä¼ è¾“ï¼Œé€šä¿¡æ•ˆç‡é«˜ã€‚ æ•°æ®æ ¡éªŒ: ä½¿ç”¨å¾ªç¯å†—ä½™æ ¡éªŒ (CRC) æé«˜æ•°æ®å¯é æ€§ã€‚ æ•ˆç‡è¾ƒé«˜: å¸§çš„å¼€é”€æ¯” ASCII å°‘ï¼Œé€‚åˆèµ„æºå—é™çš„ç³»ç»Ÿã€‚ åº”ç”¨åœºæ™¯: å°å‹å’Œä¸­å‹å·¥ä¸šç³»ç»Ÿï¼Œå¦‚ä¼ æ„Ÿå™¨ã€æ‰§è¡Œå™¨å’Œ PLC é€šä¿¡ã€‚ | Address (1 byte) | Function Code (1 byte) | Data (n bytes) | CRC (2 bytes) | åœ°å€: æ ‡è¯†è®¾å¤‡ï¼ŒèŒƒå›´ä¸º 1-247ã€‚ åŠŸèƒ½ç : å®šä¹‰æ“ä½œç±»å‹ï¼ˆå¦‚è¯»å†™å¯„å­˜å™¨ï¼‰ã€‚ æ•°æ®: åŒ…å«å…·ä½“æ“ä½œçš„æ•°æ®ã€‚ CRC æ ¡éªŒ: æ£€æµ‹é€šä¿¡é”™è¯¯ã€‚ Modbus ASCIIModbus ASCII æ˜¯ä¸€ç§åŸºäºä¸²å£é€šä¿¡çš„ Modbus åè®®ï¼Œä½¿ç”¨ ASCII ç¼–ç ä¼ è¾“æ•°æ®ã€‚ é€šä¿¡æ–¹å¼: åŸºäºä¸²è¡Œæ¥å£ï¼ˆå¦‚ RS-232 æˆ– RS-485ï¼‰ã€‚ æ•°æ®ç¼–ç : æ•°æ®ä»¥ ASCII æ ¼å¼ï¼ˆæ¯å­—èŠ‚è½¬åŒ–ä¸ºä¸¤ä¸ªå¯æ‰“å°å­—ç¬¦ï¼‰è¿›è¡Œä¼ è¾“ã€‚ è°ƒè¯•å®¹æ˜“: å› ä¸ºæ•°æ®æ˜¯å¯è¯»çš„ ASCII å­—ç¬¦ï¼Œæ˜“äºäººå·¥è°ƒè¯•å’Œè¯Šæ–­ã€‚ æ•ˆç‡è¾ƒä½: ASCII ç¼–ç æ¯” RTU æ¨¡å¼å¤šå ç”¨ä¼ è¾“å¸¦å®½ã€‚ åº”ç”¨åœºæ™¯: å°å‹ç³»ç»Ÿæˆ–éœ€è¦ç®€å•è°ƒè¯•çš„ç¯å¢ƒã€‚ | Start (:) | Address (2 chars) | Function Code (2 chars) | Data (n chars) | LRC (2 chars) | End (CRLF) | èµ·å§‹ç¬¦ : æ•°æ®å¸§ä¸­æ¯ä¸ªå­—èŠ‚ç”¨ 2 ä¸ª ASCII å­—ç¬¦è¡¨ç¤ºã€‚ ä½¿ç”¨çºµå‘å†—ä½™æ ¡éªŒ (LRC) æ£€æµ‹æ•°æ®é”™è¯¯ã€‚ Modbus TCPModbus TCP æ˜¯åŸºäºä»¥å¤ªç½‘çš„ Modbus åè®®ï¼Œä½¿ç”¨ TCPIP åè®®æ ˆè¿›è¡Œæ•°æ®ä¼ è¾“ã€‚ é€šä¿¡æ–¹å¼: ä½¿ç”¨ä»¥å¤ªç½‘ä¼ è¾“æ•°æ®ï¼Œæ•°æ®é€šè¿‡ TCPIP ç½‘ç»œè¿›è¡Œä¼ è¾“ã€‚ æ•°æ®å¸§æ ¼å¼: ä¸ä½¿ç”¨æ ¡éªŒç  (å¦‚ CRC)ï¼Œè€Œæ˜¯ä¾èµ– TCPIP åè®®çš„å†…ç½®æ ¡éªŒæœºåˆ¶ã€‚ é€Ÿåº¦: é«˜é€Ÿä¼ è¾“ï¼Œé€‚åˆå¤§è§„æ¨¡ç³»ç»Ÿå’Œç°ä»£å·¥ä¸šç¯å¢ƒã€‚ å¯»å€: ä½¿ç”¨ IP åœ°å€æ¥æ ‡è¯†è®¾å¤‡ï¼Œä¸ä¾èµ–ä¼ ç»Ÿçš„ Modbus åœ°å€èŒƒå›´ï¼ˆ1-247ï¼‰ã€‚ åº”ç”¨åœºæ™¯: å¤§å‹å·¥ä¸šè‡ªåŠ¨åŒ–ç³»ç»Ÿã€åˆ†å¸ƒå¼æ§åˆ¶ç³»ç»Ÿ (DCS)ã€SCADA ç³»ç»Ÿã€‚ | Transaction ID (2 bytes) | Protocol ID (2 bytes) | Length (2 bytes) | Unit ID (1 byte) | Function Code (1 byte) | Data (n bytes) | Modbus PlusModbus Plus çš„æ•°æ®å¸§å’Œå…¶ä»– Modbus åè®®ä¸åŒï¼Œè®¾è®¡æ›´åŠ å¤æ‚ï¼Œä½†å°è£…äº†ä¼ ç»Ÿ Modbus çš„åŠŸèƒ½ç å’Œæ•°æ®ç»“æ„ã€‚ é€šä¿¡æ–¹å¼: ä¸“æœ‰çš„ä»¤ç‰Œç¯ï¼ˆToken Passingï¼‰ç½‘ç»œæ¶æ„ï¼Œæ”¯æŒå¤šä¸»ç«™è®¾å¤‡ã€‚ ä¼ è¾“ä»‹è´¨: ä½¿ç”¨ä¸“ç”¨çš„åŒç»çº¿è¿›è¡Œé€šä¿¡ã€‚ æ•°æ®é€Ÿç‡: å›ºå®šä¸º 1 Mbpsï¼Œæ¯” Modbus RTU å’Œ Modbus ASCII å¿«å¾—å¤šã€‚ åœ°å€èŒƒå›´: æ”¯æŒ 64 ä¸ªè®¾å¤‡ï¼Œé‡‡ç”¨èŠ‚ç‚¹å·å¯»å€ã€‚ åè®®ç‰¹æ€§: å…¨åŒå·¥é€šä¿¡ï¼Œå¯åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚å’Œå“åº”ã€‚ åº”ç”¨åœºæ™¯: å¤§å‹å·¥ä¸šæ§åˆ¶ç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯åˆ†å¸ƒå¼æ§åˆ¶ç³»ç»Ÿï¼ˆDCSï¼‰å’Œå¤šä¸»è®¾å¤‡çš„åœºæ™¯ã€‚ å¸§æ ¼å¼æ˜¯ä¸ºä»¤ç‰Œç¯é€šä¿¡ä¼˜åŒ–çš„ï¼ŒåŒ…å«èŠ‚ç‚¹å¯»å€ã€ä»¤ç‰Œç®¡ç†å’Œæ•°æ®æ®µã€‚ å¯¹æ¯” ç‰¹æ€§ Modbus TCP Modbus ASCII Modbus RTU Modbus Plus é€šä¿¡æ–¹å¼ TCPIP ç½‘ç»œ ä¸²å£ï¼ˆRS-232485ï¼‰ ä¸²å£ï¼ˆRS-232485ï¼‰ ä¸“ç”¨åŒç»çº¿ æ•°æ®ç¼–ç  äºŒè¿›åˆ¶ ASCII äºŒè¿›åˆ¶ ä¸“ç”¨æ ¼å¼ æ•ˆç‡ é«˜ ä½ é«˜ æé«˜ æ ¡éªŒæ–¹å¼ TCPIP å†…ç½®æ ¡éªŒ LRC CRC å†…ç½®å¸§æ ¡éªŒæœºåˆ¶ æ‹“æ‰‘ç»“æ„ æ˜Ÿå‹ï¼ˆä»¥å¤ªç½‘ï¼‰ ç‚¹å¯¹ç‚¹æˆ–æ€»çº¿ ç‚¹å¯¹ç‚¹æˆ–æ€»çº¿ ä»¤ç‰Œç¯ æœ€å¤§è®¾å¤‡æ•° åŸºäº IP åœ°å€ 247 247 64 ä¼ è¾“é€Ÿç‡ å–å†³äºç½‘ç»œï¼ˆ1 Gbps ç­‰ï¼‰ ä½ï¼ˆ 115.2 kbpsï¼‰ é«˜ï¼ˆæœ€å¤§ 1 Mbpsï¼‰ å›ºå®š 1 Mbps æ”¯æŒå¤šä¸»è®¾å¤‡ æ˜¯ å¦ å¦ æ˜¯ ç¡¬ä»¶è¦æ±‚ ä»¥å¤ªç½‘å¡ æ— éœ€é¢å¤–ç¡¬ä»¶ æ— éœ€é¢å¤–ç¡¬ä»¶ ä¸“ç”¨ Modbus Plus ç¡¬ä»¶ é€‚ç”¨åœºæ™¯ ç°ä»£åŒ–å·¥ä¸šæ§åˆ¶ç³»ç»Ÿ å°å‹è°ƒè¯•ç¯å¢ƒ å°å‹å’Œä¸­å‹å·¥ä¸šç³»ç»Ÿ å¤šä¸»ç«™é«˜é€Ÿåˆ†å¸ƒå¼ç³»ç»Ÿ æ•°æ®æ¨¡å‹ å¯„å­˜å™¨å’Œä½ï¼š çº¿åœˆï¼ˆCoilsï¼‰ï¼šè¿™äº›æ˜¯å¯ä»¥è¯»å†™çš„å•æ¯”ç‰¹å€¼ï¼Œé€šå¸¸è¡¨ç¤ºè®¾å¤‡çš„å¼€å…³çŠ¶æ€ã€‚ ç¦»æ•£è¾“å…¥ï¼ˆDiscrete Inputsï¼‰ï¼šç±»ä¼¼äºçº¿åœˆï¼Œä½†è¿™äº›å•æ¯”ç‰¹å€¼ä¸ºåªè¯»ï¼Œå¸¸ç”¨äºç›‘æµ‹ä¼ æ„Ÿå™¨ç­‰è¾“å…¥çŠ¶æ€ã€‚ è¾“å…¥å¯„å­˜å™¨ï¼ˆInput Registersï¼‰ï¼šç”± 16 ä½å€¼ç»„æˆï¼Œé€šå¸¸ä¸ºåªè¯»ï¼Œä¸»è¦ç”¨äºè¾“å…¥è®¾å¤‡çš„æ•°æ®ï¼Œä¾‹å¦‚æ¸©åº¦è¯»æ•°ã€‚ ä¿æŒå¯„å­˜å™¨ï¼ˆHolding Registersï¼‰ï¼šåŒæ ·ç”± 16 ä½å€¼ç»„æˆï¼Œå¯ä»¥è¯»å†™ï¼Œé€šå¸¸å­˜å‚¨è®¾å¤‡çš„é…ç½®å‚æ•°æˆ–è®¾å®šå€¼ã€‚ å¯»å€ï¼š Modbus è®¾å¤‡é€šè¿‡ç‰¹å®šåœ°å€è¿›è¡Œè¯†åˆ«ï¼ŒRTU å’Œ ASCII é€šä¿¡çš„åœ°å€èŒƒå›´ä¸º 1 è‡³ 247ã€‚å¯¹äº Modbus TCPIP è¿æ¥ï¼Œè®¾å¤‡ä½¿ç”¨å…¶ IP åœ°å€è¿›è¡Œè¯†åˆ«ï¼Œä½¿å¾—åœ¨æ ‡å‡†ç½‘ç»œä¸Šæ˜“äºè®¿é—®ã€‚ åŠŸèƒ½ä»£ç åŠŸèƒ½ä»£ç æŒ‡ç¤ºåœ¨ç‰¹å®šå¯„å­˜å™¨æˆ–è¾“å…¥ä¸Šæ‰§è¡Œçš„æ“ä½œç±»å‹ï¼š è¯»å–çº¿åœˆï¼ˆ0x01ï¼‰ï¼šæ£€ç´¢å•æ¯”ç‰¹è¾“å‡ºçš„çŠ¶æ€ã€‚ è¯»å–ç¦»æ•£è¾“å…¥ï¼ˆ0x02ï¼‰ï¼šè®¿é—®ç›‘æµ‹åˆ°çš„å•æ¯”ç‰¹è¾“å…¥çŠ¶æ€ã€‚ è¯»å–ä¿æŒå¯„å­˜å™¨ï¼ˆ0x03ï¼‰ï¼šè¯»å–å­˜å‚¨åœ¨ 16 ä½è¾“å‡ºå¯„å­˜å™¨ä¸­çš„å€¼ï¼Œæä¾›çŠ¶æ€å’Œæ§åˆ¶ä¿¡æ¯ã€‚ è¯»å–è¾“å…¥å¯„å­˜å™¨ï¼ˆ0x04ï¼‰ï¼šä» 16 ä½è¾“å…¥å¯„å­˜å™¨è·å–å€¼ï¼Œè¿™äº›å¯„å­˜å™¨æä¾›æ¥è‡ªä¼ æ„Ÿå™¨çš„æ•°æ®ã€‚ å†™å…¥å•ä¸ªçº¿åœˆï¼ˆ0x05ï¼‰ï¼šå‘½ä»¤å•ä¸ªè¾“å‡ºæ¯”ç‰¹æ›´æ”¹å…¶çŠ¶æ€ï¼Œä»¥ä¾¿å®ç°å³æ—¶æ§åˆ¶æ“ä½œã€‚ å†™å…¥å•ä¸ªå¯„å­˜å™¨ï¼ˆ0x06ï¼‰ï¼šåœ¨ 16 ä½è¾“å‡ºå¯„å­˜å™¨ä¸­è®¾ç½®ç‰¹å®šå€¼ï¼Œç”¨äºæ§åˆ¶åº”ç”¨ã€‚ å†™å…¥å¤šä¸ªçº¿åœˆï¼ˆ0x0Fï¼‰ï¼šåœ¨ä¸€æ¬¡æ“ä½œä¸­æ›´æ”¹å¤šä¸ªè¾“å‡ºæ¯”ç‰¹çš„çŠ¶æ€ï¼Œæé«˜äº†å¯¹å¤šä¸ªè®¾å¤‡æ§åˆ¶çš„æ•ˆç‡ã€‚ å†™å…¥å¤šä¸ªå¯„å­˜å™¨ï¼ˆ0x10ï¼‰ï¼šåœ¨ä¸€æ¬¡æ“ä½œä¸­æ›´æ–°å¤šä¸ª 16 ä½å¯„å­˜å™¨ï¼Œä»è€Œç®€åŒ–é€šä¿¡å’Œå¤„ç†ã€‚ æ•°æ®ä½è®¡ç®—æœºå¤„ç†çš„è¯­è¨€æ˜¯â€0â€å’Œâ€1â€ç»„åˆè€Œæˆçš„ä¿¡æ¯ï¼Œå³æœºå™¨è¯­è¨€ 01000001 ï¼Œ01000010 ï¼Œ01000011 ï¼Œ01000100 ï¼Œ01000101ï¼Œ01000110 A B C D E F ä¸Šé¢ä¸€ç»„æœºå™¨ç åˆ†åˆ«ä»£è¡¨çš„å­—ç¬¦æ˜¯ Aï¼ŒBï¼ŒCï¼ŒDï¼ŒEï¼ŒFï¼›å¦‚ A: æ˜¯ç”¨ 01000001 è¡¨ç¤ºï¼Œå…±å…«ä¸ªâ€0â€æˆ–â€1â€ï¼Œå³æ•°æ®ä½ä¸ºå…«ä½. æ•°æ®ä½çš„å«ä¹‰ï¼šæ˜¯ä¸€ä¸ªå­—ç¬¦å¯ä»¥ç”¨å¤šå°‘ä¸ªä½çš„ç»„åˆæ¥è¡¨ç¤ºï¼›è®¾ç½®æ•°æ®ä½åï¼Œä»¬å°±çŸ¥é“äº†æ•°æ®é•¿åº¦ï¼Œç„¶åå¯ä»¥æ ¹æ®æ³¢ç‰¹ç‡(9600)è®¡ç®—å‡ºä¼ è¾“ä¸€ä¸ªå­—ç¬¦ A éœ€è¦å¤šå°‘æ—¶é—´ã€‚ åœæ­¢ä½çŸ¥é“ä¸€ä¸ªå­—ç¬¦ä½•æ—¶ä¼ è¾“ç»“æŸã€‚ç›®å‰å¸¸ç”¨çš„åœæ­¢ä½æ˜¯ä¸€ä½ä¸äºŒä½ã€‚ åœæ­¢ä½æ˜¯ä¸€ä¸ªé«˜ç”µå¹³(1)ï¼Œå½“æ¥æ”¶æ–¹æ¥æ”¶åˆ°è¿ç»­çš„é«˜ç”µå¹³æ—¶ï¼Œè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¼ è¾“ç»“æŸã€‚ èµ·å§‹ä½æ˜¯ä¸€ä¸ªä½ç”µå¹³(0),å½“æ¥æ”¶æ–¹æ¥æ”¶è¿ç»­çš„ä½ç”µå¹³æ—¶ï¼Œè¡¨ç¤ºä¸‹ä¸€ä¸ªå­—ç¬¦çš„ä¼ è¾“å¼€å§‹ã€‚ å¦‚æœåœæ­¢ä½å¯é (1 ä½æˆ–æ˜¯ 2 ä½)ï¼Œé‚£ä¹ˆå¹²æ‰°é€ æˆä½ç”µå¹³èµ·å§‹ä½å‡è±¡çš„å¯èƒ½æ€§å°±ä¸å¤§ï¼Œæ‰€ä»¥ä¸ç”¨è®¾ç½®èµ·å§‹ä½ã€‚ æ ¡éªŒæ–¹å¼åœ¨ä¼ è¾“çš„æ•°æ®ä¸­å†åŠ ä¸Šä¸€ä¸ªæ ¡éªŒä½é˜²æ­¢å¹²æ‰°ã€‚ç›®å‰æ‰€ç”¨çš„æ ¡éªŒæ–¹å¼ä¸ºï¼š å¶æ ¡éªŒ(even):ç®€å•è¡¨ç¤ºä¸ºâ€eâ€ ï¼Œä¿è¯æ€»çš„ 1 çš„ä¸ªæ•°æ˜¯å¶æ•°ï¼› å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸­â€1â€çš„ä¸ªæ•°æ˜¯å¥‡æ•°é‚£ä¹ˆæ ¡éªŒä½å°±ç½®ä¸ºâ€1â€ï¼› å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸­â€1â€çš„ä¸ªæ•°æ˜¯å¶æ•°ï¼Œé‚£ä¹ˆæ ¡éªŒä½å°±ç½®ä¸º 0ï¼› å¥‡æ ¡éªŒ(odd):ç®€å•è¡¨ç¤ºä¸ºâ€oâ€ ï¼Œä¿è¯æ€»çš„â€1â€çš„ä¸ªæ•°æ˜¯å¥‡æ•°ï¼› å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸­â€1â€çš„ä¸ªæ•°æ˜¯å¶æ•°ï¼Œé‚£ä¹ˆæ ¡éªŒä½å°±ç½®ä¸º 1ï¼› å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸­â€1â€çš„ä¸ªæ•°æ˜¯å¥‡æ•°ï¼Œé‚£ä¹ˆæ ¡éªŒä½å°±ç½®ä¸º 0ï¼› æ— æ ¡éªŒ(none):ç®€å•è¡¨ç¤ºä¸ºâ€nâ€ ï¼Œæ²¡æœ‰æ ¡éªŒä½ï¼› å¥‡å¶æ ¡éªŒæ–¹å¼ä¸å¯èƒ½å®Œå…¨æ ¡éªŒä¸€ä¸ªå­—ç¬¦å‘é€æ˜¯å¦æ­£ç¡®ã€‚å½“åªæ˜¯â€1â€çš„ä½ç½®æ”¹å˜äº†ï¼Œâ€1â€çš„ä¸ªæ•°è¿˜æ˜¯å¥‡æ•°ï¼Œè™½ç„¶å‘é€çš„æ˜¯ Aï¼Œæ¥æ”¶åˆ°çš„æ˜¯ Bï¼Œä½†æ˜¯å¥‡æ ¡éªŒè¿˜è®¤ä¸ºæ˜¯æ­£ç¡®çš„å­—ç¬¦ï¼› ä¸ºäº†è§£å†³å¥‡å¶æ ¡éªŒæ–¹å¼çš„ä¸Šè¿°ç¼ºé™·ï¼Œæ¯ç§æ ‡å‡†åè®®éƒ½ä¼šè¦æ±‚æ ¡éªŒå’Œè®¡ç®—ï¼Œæ¯”å¦‚ MODBUS é€šè®¯åè®®çš„ RTU æ–¹å¼æ˜¯ CRC æ ¡éªŒè®¡ç®—ï¼›MODBUS é€šè®¯åè®®çš„ ASCII æ–¹å¼æ˜¯ LRC æ ¡éªŒè®¡ç®—ï¼› å¥‡å¶æ ¡éªŒï¼šåˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¼ è¾“çš„æ˜¯å¦æ­£ç¡®ï¼› æ ¡éªŒå’Œï¼š åˆ¤æ–­ä¸€ç»„å­—ç¬¦ä¼ è¾“çš„æ˜¯å¦æ­£ç¡®ï¼› ç»ˆç«¯ç”µé˜»å…‰ä»ç©ºæ°”è¿›å…¥æ°´é¢æ—¶ï¼Œæ°´é¢ä»åå°„å›ä¸€äº›å…‰çº¿ï¼Œè¿™æ˜¯å› ä¸ºç©ºæ°”ä¸æ°´çš„åª’è´¨ä¸åŒã€‚å…‰è¿›å…¥ä¸åŒçš„åª’è´¨æ—¶ï¼Œä¼šåœ¨ä¸´ç•Œç‚¹åå°„ã€‚ ç”µä¿¡å·ä¼ è¾“ä¹Ÿä¸€æ ·ï¼Œåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¦‚æœä¼ è¾“æœ«ç«¯é˜»æŠ—çªç„¶å‡å°ç”šè‡³æ²¡æœ‰ï¼Œä¿¡å·å°±ä¼šåœ¨æ­¤äº§ç”Ÿåå°„ï¼Œè¿™ç§åå°„ä¼šé€ æˆä¼ è¾“çº¿è·¯æ•°æ®æ··ä¹±ï¼Œæ‰€ä»¥åŠ ä¸€ä¸ªåç½®ç”µé˜»ï¼Œäººä¸ºåœ°ä¿æŒé˜»æŠ—å¹³è¡¡ï¼Œå‡å¼±ä¿¡å·åå°„å¯¹çº¿è·¯çš„å½±å“ Modbus å¼€å‘å’Œè°ƒè¯•å·¥å…· Modbus Pollï¼šä¸€ä¸ªå®ç”¨å·¥å…·ï¼Œå¯ä»¥æ¨¡æ‹Ÿ Modbus ä¸»è®¾å¤‡ï¼Œå…è®¸ç”¨æˆ·å‘é€è¯·æ±‚å¹¶è§‚å¯Ÿå“åº”ï¼Œä»¥è¿›è¡Œæµ‹è¯•å’ŒéªŒè¯ã€‚ Modbus Slaveï¼šæ¨¡æ‹Ÿä»è®¾å¤‡ï¼Œæä¾›ä¸€ä¸ªå—æ§ç¯å¢ƒæ¥æµ‹è¯•ä¸»ä»ä¹‹é—´çš„äº¤äº’ã€‚ Wiresharkï¼šå¿…å¤‡çš„ç½‘ç»œåè®®åˆ†æå·¥å…·ï¼Œæ•è·å’Œåˆ†æ Modbus TCP æ•°æ®åŒ…ï¼Œå¯¹äºæ•…éšœæ’é™¤å’Œæ€§èƒ½ç›‘æµ‹éå¸¸æœ‰ä»·å€¼ã€‚ libmodbusï¼šå¹¿æ³›ä½¿ç”¨çš„ C åº“ï¼Œç®€åŒ–äº†åœ¨è‡ªå®šä¹‰åº”ç”¨ä¸­å®æ–½ Modbus åè®®ï¼Œä¿ƒè¿›äº†å¼€å‘å¹¶æä¾›äº†å¼ºå¤§æ”¯æŒã€‚","categories":["4.é€šè®¯åè®®","Modbus"]},{"title":"MQTT","path":"/2023/12/14/4-é€šè®¯åè®®-MQTT-MQTT/","content":"åè®®å†…å®¹ MQTTï¼ˆæ¶ˆæ¯é˜Ÿåˆ—é¥æµ‹ä¼ è¾“åè®®ï¼ŒMessage Queuing Telemetry Transportï¼‰MQTTï¼ˆMessage Queuing Telemetry Transportï¼Œæ¶ˆæ¯é˜Ÿåˆ—é¥æµ‹ä¼ è¾“åè®®ï¼‰æ˜¯ä¸€ç§åŸºäºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„æ¶ˆæ¯å‘å¸ƒè®¢é˜…æ¨¡å¼çš„â€œè½»é‡çº§â€é€šè®¯åè®®ï¼Œæ„å»ºäº TCPIP åè®®åŸºç¡€ä¹‹ä¸Šã€‚MQTT åè®®ç‰¹åˆ«é’ˆå¯¹ä½å¸¦å®½å’Œä¸å¯é ç½‘ç»œç¯å¢ƒä¸‹çš„è¿œç¨‹ä¼ æ„Ÿå™¨ä¸æ§åˆ¶è®¾å¤‡çš„é€šä¿¡è®¾è®¡ï¼Œå…·æœ‰ä»¥ä¸‹ä¸»è¦ç‰¹æ€§ï¼š å‘å¸ƒè®¢é˜…æ¶ˆæ¯æ¨¡å¼ï¼šè¿™ç§æ¨¡å¼å…è®¸ä¸€å¯¹å¤šçš„æ¶ˆæ¯å‘å¸ƒï¼Œæ˜¾è‘—å‡å°‘äº†åº”ç”¨ç¨‹åºä¹‹é—´çš„è€¦åˆï¼Œä½¿å¾—ç³»ç»Ÿè®¾è®¡æ›´åŠ çµæ´»ã€‚ è´Ÿè½½å†…å®¹å±è”½ï¼šæ¶ˆæ¯ä¼ è¾“è¿‡ç¨‹ä¸­ï¼ŒMQTT å¯ä»¥å¯¹è´Ÿè½½å†…å®¹è¿›è¡Œå¤„ç†ï¼Œç¡®ä¿ä¿¡æ¯çš„æœ‰æ•ˆæ€§ä¸å®‰å…¨æ€§ã€‚ TCPIP ç½‘ç»œè¿æ¥ï¼šåè®®é»˜è®¤ä½¿ç”¨ TCPIP æä¾›ç¨³å®šçš„ç½‘ç»œè¿æ¥ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®Œæ•´æ€§ä¸å¯é æ€§ã€‚ æ¶ˆæ¯æœåŠ¡è´¨é‡ï¼ˆQoSï¼‰ï¼šMQTT æä¾›ä¸‰ç§ä¸åŒçº§åˆ«çš„è´¨é‡æœåŠ¡ï¼Œä»¥æ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚ å°å‹ä¼ è¾“å’Œä½å¼€é”€ï¼šMQTT æ¶ˆæ¯å¤´çš„å¤§å°å›ºå®šä¸º 2 å­—èŠ‚ï¼Œè¿™ä½¿å¾—åè®®å…·æœ‰æœ€å°åŒ–åè®®äº¤æ¢çš„èƒ½åŠ›ï¼Œä»è€Œé™ä½ç½‘ç»œæµé‡çš„æ¶ˆè€—ã€‚ Last Will å’Œ Testament ç‰¹æ€§ï¼šæ­¤ç‰¹æ€§å…è®¸å®¢æˆ·ç«¯åœ¨å¼‚å¸¸æ–­å¼€è¿æ¥æ—¶ï¼Œå‘å…¶ä»–è®¢é˜…è€…å‘é€ä¸€æ¡æœ€åçš„æ¶ˆæ¯ï¼Œè¿™åœ¨è®¸å¤šå…³é”®åº”ç”¨åœºæ™¯ä¸­æå…·ä»·å€¼ï¼Œä¾‹å¦‚ç‰©è”ç½‘è®¾å¤‡çš„å®æ—¶çŠ¶æ€ç›‘æ§ã€‚ åè®®åŸç†åœ¨å®ç° MQTT åè®®æ—¶ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ¶‰åŠä¸‰ç§èº«ä»½è§’è‰²ï¼šå‘å¸ƒè€…ï¼ˆPublisherï¼‰ã€ä»£ç†ï¼ˆBrokerï¼Œå³æœåŠ¡å™¨ï¼‰å’Œè®¢é˜…è€…ï¼ˆSubscriberï¼‰ã€‚ä»¥ä¸‹æ˜¯å…³äºæ¯ç§è§’è‰²çš„ç®€è¦è¯´æ˜ï¼š å‘å¸ƒè€…ï¼šè´Ÿè´£å‘é€æ¶ˆæ¯ï¼Œå¹¶å¯ä»¥åŒæ—¶å……å½“è®¢é˜…è€…ã€‚ ä»£ç†ï¼šä½œä¸ºæ¶ˆæ¯çš„ä¸­ä»‹ï¼Œæ¥å—æ¥è‡ªå‘å¸ƒè€…çš„ä¿¡æ¯å¹¶è½¬å‘ç»™ç›¸åº”çš„è®¢é˜…è€…ã€‚ è®¢é˜…è€…ï¼šæ¥æ”¶æ¥è‡ªä¸»é¢˜çš„æ¶ˆæ¯ï¼Œè®¢é˜…ç›¸å…³ä¸»é¢˜åå°†è‡ªåŠ¨è·å–æ¶ˆæ¯å†…å®¹ã€‚ MQTT æ¶ˆæ¯çš„ç»“æ„ç”±ä¸»é¢˜ï¼ˆTopicï¼‰å’Œè´Ÿè½½ï¼ˆPayloadï¼‰ç»„æˆï¼š Topicï¼šç†è§£ä¸ºæ¶ˆæ¯çš„ç±»å‹ã€‚è®¢é˜…è€…è®¢é˜…ç‰¹å®šçš„ä¸»é¢˜åï¼Œå°†ä¼šæ¥æ”¶åˆ°ä¸è¯¥ä¸»é¢˜ç›¸å…³çš„æ‰€æœ‰æ¶ˆæ¯å†…å®¹ã€‚ Payloadï¼šæ”¶åˆ°çš„å…·ä½“æ¶ˆæ¯å†…å®¹ï¼Œè®¢é˜…è€…åœ¨å¤„ç†ä¿¡æ¯æ—¶æ‰€ä½¿ç”¨çš„å®é™…å†…å®¹ã€‚ MQTT åè®®å»ºç«‹äº†å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„è¿æ¥ï¼Œç¡®ä¿æœ‰åºã€æ— æŸçš„ã€åŸºäºå­—èŠ‚æµçš„åŒå‘ä¼ è¾“ã€‚å½“åº”ç”¨æ•°æ®é€šè¿‡ MQTT ç½‘ç»œå‘é€æ—¶ï¼ŒæœåŠ¡è´¨é‡ï¼ˆQoSï¼‰ä¸ä¸»é¢˜åï¼ˆTopicï¼‰ç›´æ¥ç›¸å…³è”ã€‚ æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯æœåŠ¡å™¨ï¼ˆBrokerï¼‰MQTT æœåŠ¡å™¨ï¼Œå³â€œæ¶ˆæ¯ä»£ç†â€ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åº”ç”¨ç¨‹åºæˆ–ä¸€å°è®¾å¤‡ã€‚å®ƒä½äºå‘å¸ƒè€…ä¸è®¢é˜…è€…ä¹‹é—´ï¼Œæ‰§è¡Œä»¥ä¸‹åŠŸèƒ½ï¼š æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„ç½‘ç»œè¿æ¥è¯·æ±‚ã€‚ å¤„ç†å®¢æˆ·ç«¯å‘å¸ƒçš„åº”ç”¨ä¿¡æ¯ï¼Œç¡®ä¿å…¶èƒ½å¤Ÿè¢«æœ‰æ•ˆè½¬å‘ã€‚ å¤„ç†è®¢é˜…ä¸é€€è®¢è¯·æ±‚ï¼Œç»´æŠ¤å®¢æˆ·ç«¯çš„è®¢é˜…çŠ¶æ€ã€‚ å°†åº”ç”¨ç¨‹åºçš„æ¶ˆæ¯å¹¿æ’­ç»™è®¢é˜…çš„å®¢æˆ·ç«¯ï¼Œç¡®ä¿ä¿¡æ¯ä¼ é€’çš„åŠæ—¶æ€§ä¸å‡†ç¡®æ€§ã€‚ å®¢æˆ·ç«¯é€šè¿‡ MQTT åè®®è¿›è¡Œé€šä¿¡çš„åº”ç”¨ç¨‹åºæˆ–è®¾å¤‡ï¼Œå§‹ç»ˆä¸æœåŠ¡å™¨ä¿æŒç½‘ç»œè¿æ¥ã€‚å®¢æˆ·ç«¯å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š å‘å¸ƒå…¶ä»–å®¢æˆ·ç«¯å¯èƒ½ä¼šè®¢é˜…çš„ä¿¡æ¯ã€‚ è®¢é˜…å…¶ä»–å®¢æˆ·ç«¯å‘å¸ƒçš„æ¶ˆæ¯ï¼Œè·å–å®æ—¶æ•°æ®ã€‚ é€€è®¢æˆ–åˆ é™¤ä¹‹å‰çš„è®¢é˜…æ¶ˆæ¯ï¼Œä¿æŒä¿¡æ¯æµçš„æœ‰æ•ˆæ€§ã€‚ æ–­å¼€ä¸æœåŠ¡å™¨çš„è¿æ¥ï¼Œç»“æŸé€šä¿¡ä¼šè¯ã€‚ å®ç°ç»†èŠ‚è®¢é˜…ï¼ˆSubscriptionï¼‰åœ¨è®¢é˜…è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯éœ€è¦æä¾›ä¸»é¢˜ç­›é€‰å™¨ï¼ˆTopic Filterï¼‰å’Œæœ€å¤§æœåŠ¡è´¨é‡ï¼ˆQoSï¼‰ï¼Œè¿™å°†ä¸å®¢æˆ·ç«¯çš„ä¼šè¯ï¼ˆSessionï¼‰å…³è”ã€‚ä¼šè¯å¯ä»¥åŒ…æ‹¬å¤šä¸ªè®¢é˜…ï¼Œæ¯ä¸€ä¸ªè®¢é˜…éƒ½å…·æœ‰ä¸åŒçš„ä¸»é¢˜ç­›é€‰å™¨ã€‚ ä¼šè¯ï¼ˆSessionï¼‰æ¯ä¸ªå®¢æˆ·ç«¯åœ¨ä¸æœåŠ¡å™¨è¿æ¥ååˆ›å»ºä¸€ä¸ªä¼šè¯ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ä¼šè¿›è¡ŒçŠ¶æ€äº¤äº’ã€‚è¿™æ ·çš„ä¼šè¯èƒ½å¤Ÿè·¨è¶Šå¤šä¸ªç½‘ç»œè¿æ¥ï¼Œä¿æŒçŠ¶æ€ä¸€è‡´æ€§ã€‚ ä¸»é¢˜åï¼ˆTopic Nameï¼‰ä¸»é¢˜åæ˜¯è¿æ¥åˆ°ç‰¹å®šåº”ç”¨ç¨‹åºæ¶ˆæ¯çš„æ ‡ç­¾ï¼ŒæœåŠ¡å™¨æ ¹æ®è®¢é˜…çš„ä¸»é¢˜åŒ¹é…ï¼Œå°†æ¶ˆæ¯å‘é€ç»™æ‰€æœ‰å…³è”çš„å®¢æˆ·ç«¯ã€‚ ä¸»é¢˜ç­›é€‰å™¨ï¼ˆTopic Filterï¼‰ä¸»é¢˜ç­›é€‰å™¨ä½¿ç”¨é€šé…ç¬¦è¿›è¡Œç­›é€‰ï¼Œå…è®¸è®¢é˜…è€…é€šè¿‡æ›´çµæ´»çš„è¡¨è¾¾å¼åŒ¹é…å¤šä¸ªä¸»é¢˜ã€‚ è´Ÿè½½ï¼ˆPayloadï¼‰è´Ÿè½½æ˜¯å…³é”®çš„æ¶ˆæ¯ä½“ï¼ŒåŒ…å«äº†ä¸‹åˆ—ç±»å‹çš„æ¶ˆæ¯ï¼š CONNECTï¼ˆè¿æ¥ï¼‰ï¼šæ¶ˆæ¯ä½“å†…å®¹åŒ…æ‹¬å®¢æˆ·ç«¯çš„ ClientIDã€è®¢é˜…çš„ Topicã€æ¶ˆæ¯å†…å®¹åŠç”¨æˆ·åå’Œå¯†ç ç­‰ä¿¡æ¯ã€‚ SUBSCRIBEï¼ˆè®¢é˜…ï¼‰ï¼šæ¶ˆæ¯ä½“åˆ—ä¸¾å‡ºä¸€ç³»åˆ—è¦è®¢é˜…çš„ä¸»é¢˜åŠå…¶å¯¹åº”çš„ QoSã€‚ SUBACKï¼ˆè®¢é˜…å›æ‰§ï¼‰ï¼šæ¶ˆæ¯ä½“ç”¨äºç¡®è®¤æœåŠ¡å™¨å¯¹ SUBSCRIBE ç”³è¯·çš„ä¸»é¢˜åŠ QoS çš„å›å¤ã€‚ UNSUBSCRIBEï¼ˆå–æ¶ˆè®¢é˜…ï¼‰ï¼šæ¶ˆæ¯ä½“è¯´æ˜éœ€è¦å–æ¶ˆè®¢é˜…çš„ä¸»é¢˜ã€‚ PUBLISHï¼ˆæ¨é€ï¼‰ï¼šæ•°æ®éƒ¨åˆ†åŒ…å«å®é™…å‘é€çš„æ¶ˆæ¯å†…å®¹ã€‚ é€šè¿‡ä¸Šè¿°ç»“æ„ä¸åŠŸèƒ½ï¼ŒMQTT åè®®èƒ½å¤Ÿåœ¨ä¼—å¤šç‰©è”ç½‘åº”ç”¨å’Œè¿œç¨‹è®¾å¤‡ä¹‹é—´å®ç°é«˜æ•ˆã€çµæ´»çš„æ¶ˆæ¯ä¼ é€’å’Œç®¡ç†ã€‚","categories":["4.é€šè®¯åè®®","MQTT"]},{"title":"libusbçš„äº¤å‰ç¼–è¯‘","path":"/2023/12/13/4-é€šè®¯åè®®-USB-libusbçš„äº¤å‰ç¼–è¯‘/","content":"ä¸‹è½½è½¯ä»¶åŒ…å‰å¾€ SourceForge ç½‘ç«™ï¼Œé€‰æ‹©æœ€æ–°ç‰ˆæœ¬çš„ libusb-1.0.21 å’Œ libusb-compat-0.1.5ã€‚è¯·æ³¨æ„ï¼Œlibusb-1.0 å’Œ libusb-compat-0.1 çš„å‡½æ•°å‘½åå’Œç¼–è¯‘æ—¶é“¾æ¥æ–¹å¼å­˜åœ¨æ˜¾è‘—ä¸åŒã€‚ç¡®ä¿ä¸‹è½½è¿™ä¸¤ä¸ªåŒ…ï¼Œå› ä¸ºè¿™æ˜¯ç¼–è¯‘å’Œå¼€å‘ USB è®¾å¤‡æ—¶å¿…ä¸å¯å°‘çš„åŸºç¡€åº“ã€‚ è§£å‹å’Œé…ç½®è§£å‹ä¸‹è½½çš„æ–‡ä»¶ã€‚åœ¨ç»ˆç«¯ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥é…ç½®ç¼–è¯‘ç¯å¢ƒï¼š ./configure --host=arm-none-linux-gnueabi æ­¤å‘½ä»¤æŒ‡å®šäº†äº¤å‰ç¼–è¯‘å·¥å…·é“¾ä»¥æ”¯æŒ ARM æ¶æ„ã€‚æ‰§è¡Œæ—¶ï¼Œæœ‰å¯èƒ½å‡ºç°å¦‚ä¸‹é”™è¯¯æç¤ºï¼š configure: error: udev support requested but libudev not installed å¦‚æœé‡åˆ°æ­¤é”™è¯¯ï¼Œè§£å†³æ–¹å¼æ˜¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä»¥ç¦ç”¨ udev æ”¯æŒï¼š ./configure --disable-udev ç¼–è¯‘å’Œå®‰è£…æ¥ä¸‹æ¥ï¼Œæ‰§è¡Œ make å‘½ä»¤ä»¥è¿›è¡Œç¼–è¯‘ã€‚è‹¥æ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨ sudo make install å®‰è£…ï¼Œä½†å¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹æŠ¥é”™ï¼š ../libtool: line 1085: arm-none-linux-gnueabi-ranlib: command not foundmake[2]: *** [install-libLTLIBRARIES] Error 127 è§£å†³æ­¤é—®é¢˜éœ€è¦è¿›å…¥ root æƒé™ã€‚åœ¨ç»ˆç«¯ä¸­è¾“å…¥ï¼š sudo -i åˆ‡æ¢è‡³ root æƒé™åï¼Œå†æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š make install è‹¥æˆåŠŸï¼Œç³»ç»Ÿå°†ç”Ÿæˆæ‰€éœ€çš„åº“æ–‡ä»¶ï¼Œä»è€Œå®Œæˆå®‰è£…è¿‡ç¨‹ã€‚ ç¼–è¯‘æ—¶é“¾æ¥åº“æ–‡ä»¶åœ¨ç¨‹åºç¼–è¯‘æ—¶ï¼Œéœ€ç¡®ä¿é“¾æ¥åº“æ–‡ä»¶ã€‚é¦–å…ˆï¼Œé€šè¿‡ -L å‚æ•°æŒ‡å®šåŠ¨æ€åº“çš„è·¯å¾„ã€‚æ¥ç€ï¼Œé€‰æ‹©åˆé€‚çš„é“¾æ¥åº“ï¼Œä½¿ç”¨ä¸‹åˆ—é€‰é¡¹ï¼š -lusb -lusb-1.0 ä¸ºäº†ç¡®è®¤ä½¿ç”¨çš„å‡½æ•°æ‰€åœ¨çš„åº“ï¼Œå¯ä»¥ä½¿ç”¨ nm å‘½ä»¤æŸ¥çœ‹åŠ¨æ€åº“å†…çš„å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å¯æŸ¥çœ‹æŸä¸ªåŠ¨æ€åº“ä¸­çš„æ‰€æœ‰å‡½æ•°ï¼š nm åŠ¨æ€åº“å è‹¥é“¾æ¥åº“ä¸æ­£ç¡®ï¼Œç¼–è¯‘æ—¶ä¼šå‡ºç°å¤§é‡ undefined reference é”™è¯¯ã€‚å¦‚æœåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æç¤º cannot find -lusbï¼Œåˆ™è¯´æ˜ç³»ç»Ÿä»…å®‰è£…äº† libusb-1.0ï¼Œä½†ç¼ºå°‘ libusb-compat-0.1ã€‚ç¡®ä¿ä¸¤è€…å‡å·²å®‰è£…ï¼Œä»¥é¿å…äº§ç”Ÿé”™è¯¯ã€‚","categories":["4.é€šè®¯åè®®","USB"]},{"title":"USBæŒ‚è½½ç›‘æµ‹","path":"/2023/12/12/4-é€šè®¯åè®®-USB-USBæŒ‚è½½ç›‘æµ‹/","content":"åŠŸèƒ½ç¨‹åºç›‘æµ‹åˆ°æ’å…¥Uç›˜åï¼Œè‡ªåŠ¨æ‰§è¡Œæ‰§è¡ŒUç›˜å†…å’Œæœ¬åœ°æŒ‡å®šæ–‡ä»¶å¤¹åŒå‘åŒæ­¥åŠŸèƒ½ è¦ç‚¹ Linux ä¸‹å¦‚ä½•ç”¨ QT æ£€æµ‹åˆ° U ç›˜å·²ç»æ’å…¥ï¼Œå¹¶å®ç° mount ä¸ umount å®ç°æ–¹å¼ä½¿ç”¨ qt è‡ªå¸¦çš„ QDBus å¯ä»¥å®ç°ï¼Œä¸‹é¢ä¸ºè¿æ¥ä»£ç ï¼Œå½“ç³»ç»Ÿæœ‰è®¾å¤‡æ’å…¥æ—¶ï¼Œå¯ä»¥è°ƒç”¨ slotDeviceAdded(QString udi) å‡½æ•°ã€‚ åœ¨ pro æ–‡ä»¶ä¸­åº”è¯¥åŠ å…¥ QT +=dbus #include QtDBus/QDBusConnection#include QDbusInterface//ä»¥ä¸‹ä¸ºæ£€æµ‹è®¾å¤‡çš„æ’å…¥ QDBusConnection::systemBus().connect( org.freedesktop.Hal, /org/freedesktop/Hal/Manager, org.freedesktop.Hal.Manager, DeviceAdded, this, SLOT(slotDeviceAdded(QString )));//ä»¥ä¸‹ä¸ºæ£€æŸ¥è®¾å¤‡çš„æ‹¨å‡º QDBusConnection::systemBus().connect( org.freedesktop.Hal, /org/freedesktop/Hal/Manager, org.freedesktop.Hal.Manager, DeviceRemoved, this, SLOT(slotDeviceRemoved(QString ))); åœ¨ slotDeviceAdded(QString udi) å‡½æ•°ä¸­ï¼Œè¦ä½¿ç”¨åˆ° QDBusInterface device(org.freedesktop.Hal, udi, org.freedesktop.Hal.Device , QDBusConnection::systemBus()); é€šè¿‡ HAL å¯ä»¥æŸ¥è¯¢åˆ°è®¾å¤‡ä¸º volume çš„è®¾å¤‡ï¼Œç„¶åé€šè¿‡åˆ¤æ–­æ˜¯å¦ä¸ºdevsd çš„è®¾å¤‡ï¼Œå°±å¯ä»¥åˆ¤æ–­å‡ºæ˜¯å¦ä¸º U ç›˜ï¼Œç„¶åè°ƒç”¨ mount å°±å¯ä»¥äº†ã€‚ è¿™æ—¶è®°å½•ä¸‹ U ç›˜çš„ UDIï¼Œåœ¨æ£€æµ‹åˆ°è®¾å¤‡æ‹¨å‡ºæ—¶ï¼Œå†æŸ¥è¯¢ä¸€ä¸‹ U ç›˜çš„ UDI æ˜¯å¦è¿˜åœ¨ï¼Œå°±çŸ¥é“ U ç›˜æ˜¯å¦è¢«æ‹¨å‡ºäº†ã€‚","categories":["4.é€šè®¯åè®®","USB"]},{"title":"USBæƒé™è®¾ç½®","path":"/2023/12/11/4-é€šè®¯åè®®-USB-USBæƒé™è®¾ç½®/","content":"å›  Linux ç³»ç»Ÿä¸‹å°†æ¶‰åŠåˆ° usb åº•å±‚é©±åŠ¨çš„è°ƒç”¨ï¼Œè¿è¡Œæ—¶ï¼Œä¸€å®šè¦åŠ  sudo è·å–æƒé™è¿è¡Œï¼Œå¦åˆ™ USB è®¾å¤‡æ²¡æœ‰æƒé™æ“ä½œã€‚ ç°é€šè¿‡åˆ›å»º UDEV è§„åˆ™ï¼Œé…ç½® USB æƒé™åï¼Œå¯ä»¥è°ƒç”¨æŒ‡å®šè®¾å¤‡ä¸åŠ æƒé™è¿è¡Œã€‚ è¾“å…¥ lsusbï¼ŒæŸ¥çœ‹å½“å‰çš„ USB è®¾å¤‡çš„ IDï¼Œç¡®å®šéœ€è¦é…ç½®çš„ USBã€‚ åˆ›å»ºä¸€ä¸ªæ–°çš„ udev è§„åˆ™ã€‚åç§°å–ä¸ºï¼š99-myusb.rules sudo vi /etc/udev/rules.d/99-myusb.rules åœ¨ 99-myusb.rules æ–‡ä»¶ä¸­ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ ##ACTION==add,SUBSYSTEMS==usb, ATTRSidVendor==04d8, ATTRSidProduct==0053, GROUP=users, MODE=0777 è¿™æ¡ udev è§„åˆ™çš„ä½œç”¨æ˜¯ï¼Œå½“ä¾›åº”å•† ID ä¸º 04d8 ä¸”äº§å“ ID ä¸º 0053 çš„ USB è®¾å¤‡æ’å…¥ç³»ç»Ÿæ—¶ï¼Œå°†è¯¥è®¾å¤‡çš„ç”¨æˆ·ç»„è®¾ç½®ä¸º usersï¼Œå¹¶èµ‹äºˆæ‰€æœ‰ç”¨æˆ·è¯»ã€å†™ã€æ‰§è¡Œçš„å…¨éƒ¨æƒé™ã€‚ æ’æ‹”ä¸€ä¸‹ USBCAN è®¾å¤‡æˆ–é‡å¯ä¸€ä¸‹ç”µè„‘åï¼Œå³å¯ä¸åŠ  sudo æƒé™è¿è¡Œç¨‹åºäº† å¯¹æŸä¸ªç‰¹å®š USB è®¾å¤‡è®¾ç½®æƒé™ã€‚æ¯å½“è¿™ä¸ªè®¾å¤‡æ’å…¥ç³»ç»Ÿæ—¶ï¼Œè§„åˆ™ä¼šè‡ªåŠ¨åº”ç”¨ã€‚ ACTION==addï¼šè¿™è¡¨ç¤ºè§„åˆ™åœ¨è®¾å¤‡æ·»åŠ ï¼ˆæ’å…¥ï¼‰æ—¶ç”Ÿæ•ˆã€‚udev å¯ä»¥æ ¹æ®ä¸åŒçš„åŠ¨ä½œï¼ˆå¦‚æ·»åŠ ã€ç§»é™¤ç­‰ï¼‰è§¦å‘è§„åˆ™ï¼Œadd åŠ¨ä½œæŒ‡è®¾å¤‡æ’å…¥æ—¶ã€‚ SUBSYSTEMS==usbï¼šè¡¨ç¤ºè§„åˆ™é€‚ç”¨äº USB å­ç³»ç»Ÿçš„è®¾å¤‡ã€‚udev ç®¡ç†ç³»ç»Ÿä¸­çš„è®¾å¤‡ï¼Œå­ç³»ç»Ÿç”¨äºåˆ†ç±»ï¼ŒUSB æ˜¯å…¶ä¸­ä¸€ç§ã€‚ ATTRSidVendor==04d8ï¼šè¡¨ç¤ºè®¾å¤‡çš„ä¾›åº”å•† IDï¼ˆVendor IDï¼‰ä¸º 04d8ã€‚æ¯ä¸ª USB è®¾å¤‡éƒ½æœ‰å”¯ä¸€çš„ä¾›åº”å•† IDï¼Œç”¨äºæ ‡è¯†è®¾å¤‡çš„åˆ¶é€ å•†ã€‚ ATTRSidProduct==0053ï¼šè¡¨ç¤ºè®¾å¤‡çš„äº§å“ IDï¼ˆProduct IDï¼‰ä¸º 0053ã€‚æ¯ä¸ªä¾›åº”å•†çš„ä¸åŒäº§å“æœ‰ä¸åŒçš„äº§å“ IDï¼Œç”¨äºåŒºåˆ†ä¾›åº”å•†çš„å„ä¸ªè®¾å¤‡ã€‚ GROUP=usersï¼šè¡¨ç¤ºè®¾å¤‡çš„ç”¨æˆ·ç»„è¢«è®¾ç½®ä¸º usersã€‚è¿™å†³å®šäº†å“ªäº›ç”¨æˆ·ç»„çš„æˆå‘˜æœ‰æƒè®¿é—®è¯¥è®¾å¤‡ã€‚ MODE=0777ï¼šè¡¨ç¤ºè®¾å¤‡çš„æƒé™æ¨¡å¼è¢«è®¾ç½®ä¸º 0777ï¼Œå³æ‰€æœ‰ç”¨æˆ·å¯¹è¯¥è®¾å¤‡éƒ½æœ‰è¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€‚","categories":["4.é€šè®¯åè®®","USB"]},{"title":"USBçš„æƒé™è®¾ç½®æœ€é«˜","path":"/2023/12/08/4-é€šè®¯åè®®-USB-USBçš„æƒé™è®¾ç½®æœ€é«˜/","content":"ä½¿ç”¨ lsusb -vvv å‘½ä»¤æ‰¾å‡º USB è®¾å¤‡çš„ vendorID å’Œ productID åˆ›å»ºä¸€ä¸ªæ–°çš„ udev è§„åˆ™çº¢è‰²æ¡†ä¸­çš„ä¸ºæ–°å»ºçš„ udev è§„åˆ™ æ–°å»ºæ–‡ä»¶å†…å®¹ï¼š $ sudo vi/etc/udev/rules.d/50-myusb.rulesSUBSYSTEMS==usb, ATTRSidVendor==067b, ATTRSidProduct==2303, GROUP=users, MODE=0666 ç”¨è‡ªå·±çš„â€idVendorâ€å’Œâ€idProductâ€æ¥æ›¿æ¢ã€‚MODEâ€0666â€è¡¨ç¤º USB è®¾å¤‡çš„æƒé™ã€‚å»ºç«‹æ–°æ–‡ä»¶å†…å®¹ å»ºç«‹å¥½æ–‡ä»¶ä¹‹åé‡å¯å³å¯","categories":["4.é€šè®¯åè®®","USB"]},{"title":"USBè®¾å¤‡èŠ‚ç‚¹åä¸å›ºå®š","path":"/2023/12/07/4-é€šè®¯åè®®-USB-USBè®¾å¤‡èŠ‚ç‚¹åä¸å›ºå®š/","content":"æ–¹æ¡ˆä¸€Linux ä¸‹ USB è®¾å¤‡èŠ‚ç‚¹åä¸å›ºå®šä»¥ USB è½¬ä¸²å£è®¾å¤‡ä¸ºä¾‹ï¼Œè¿™ç±»è®¾å¤‡åœ¨ Linux ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹åé€šå¸¸æ˜¯ ttyUSBxï¼Œå…¶ä¸­ x æ˜¯ä¸€ä¸ªæ•°å­—ï¼ŒèŒƒå›´ä» 0 åˆ° nã€‚Linux å†…æ ¸ä¼šä¾æ®è®¾å¤‡æ’å…¥çš„é¡ºåºä¸ºè¿™äº›è®¾å¤‡åˆ†é…ç¼–å·ã€‚ä¾‹å¦‚ï¼Œå½“é¦–å…ˆæ’å…¥ä¸€ä¸ª USB è½¬ä¸²å£è®¾å¤‡ï¼Œå®ƒä¼šè¢«è¯†åˆ«ä¸º ttyUSB0ï¼Œæ¥ä¸‹æ¥æ’å…¥çš„è®¾å¤‡ä¼šä¾æ¬¡è¢«å‘½åä¸º ttyUSB1ã€ttyUSB2 ç­‰ã€‚ è¿™ç§åŸºäºæ’å…¥é¡ºåºçš„å‘½åæ–¹å¼æœ‰ä¸€ä¸ªæ˜æ˜¾çš„é—®é¢˜ï¼šå¦‚æœä»…å‡­è®¾å¤‡èŠ‚ç‚¹å ttyUSBx æ¥åŒºåˆ†è¿™äº›è®¾å¤‡ï¼Œé‚£ä¹ˆæœ«å°¾çš„æ•°å­—ä¼šéšç€è®¾å¤‡çš„æ’å…¥å’Œæ‹”å‡ºè€Œå˜åŒ–ï¼Œè¿™å°±å¯¼è‡´è®¾å¤‡çš„é¡ºåºå¯èƒ½ä¼šæ—¶å¸¸å˜åŠ¨ï¼Œä»è€Œå¼•å‘æ··æ·†ã€‚æ¯”å¦‚ï¼Œè®¾å¤‡ A å¯èƒ½åœ¨æŸæ¬¡å¯åŠ¨æ—¶æˆä¸º ttyUSB0ï¼Œè€Œåœ¨ä¸‹æ¬¡é‡å¯æˆ–é‡æ–°æ’å…¥æ—¶å´å˜æˆ ttyUSB1ã€‚ç”±äºåœ¨ dev ç›®å½•ä¸‹æ²¡æœ‰æä¾›å›ºå®šæ˜¾ç¤º ttyUSB çš„æ–¹æ³•ï¼Œå› æ­¤å¿…é¡»å¯»æ±‚å…¶ä»–çš„æ ‡è¯†æ–¹å¼ã€‚ æ¯ä¸ª USB ç«¯å£éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œæ¯”å¦‚ 3-1.1ã€3-1.2ï¼Œè¿™å°±ç±»ä¼¼äºæ¯ä¸ªå•†åº—éƒ½æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„é—¨ç‰Œå·ã€‚ä¾é è¿™äº›ç«¯å£å·æ¥åŒºåˆ†è®¾å¤‡ï¼Œå°±èƒ½æœ‰æ•ˆè§£å†³é—®é¢˜ã€‚æ­¥éª¤éå¸¸ç®€å•ï¼Œå°±æ˜¯å…ˆæ‰¾åˆ°è®¾å¤‡çš„ç«¯å£å·ï¼Œç„¶åæ ¹æ®è¿™ä¸ªç«¯å£å·æ¥è¯†åˆ«æŒ‚è½½åœ¨è¯¥ç«¯å£ä¸Šçš„ USB è®¾å¤‡ï¼Œä»è€Œæ¸…æ¥šçŸ¥é“å®ƒå¯¹åº”çš„èŠ‚ç‚¹åæ˜¯ ttyUSB0 è¿˜æ˜¯ ttyUSB1ã€‚ å…³äºç«¯å£å·çš„æŸ¥çœ‹æ–¹æ³•è¿æ¥å¥½ä¸¤ä¸ª USB è½¬ä¸²å£è®¾å¤‡åï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰è¿æ¥çš„è®¾å¤‡ä¿¡æ¯ï¼š ls -l /sys/class/tty/ttyUSB* å‡è®¾å¾—åˆ°çš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š lrwxrwxrwx root root 2017-08-01 13:40 ttyUSB0 - ../../devices/ff540000.usb/usb3/3-1/3-1.1/3-1.1:1.0/ttyUSB0/tty/ttyUSB0lrwxrwxrwx root root 2017-08-01 13:43 ttyUSB1 - ../../devices/ff540000.usb/usb3/3-1/3-1.2/3-1.2:1.0/ttyUSB1/tty/ttyUSB1 ä»è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°ï¼ŒttyUSB0 æ‰€åœ¨çš„ç«¯å£å·æ˜¯ 3-1.1ï¼Œè€Œ ttyUSB1 åˆ™æ˜¯åœ¨ 3-1.2ã€‚è¿™è¡¨æ˜ï¼Œ3-1.1 ç«¯å£çš„è®¾å¤‡å…ˆæ’å…¥ï¼Œå› æ­¤å®ƒè¢«å‘½åä¸º ttyUSB0ã€‚å¦‚æœåå‘æ’å…¥è¿™ä¸¤ä¸ªè®¾å¤‡ï¼Œ3-1.1 ä¸Šçš„è®¾å¤‡å°†ä¼šæˆä¸º ttyUSB1ï¼Œè€Œ 3-1.2 ä¸Šçš„è®¾å¤‡å°†æˆä¸º ttyUSB0ã€‚å› æ­¤ï¼Œè®¾å¤‡èŠ‚ç‚¹ ttyUSBx çš„ä¸ç¡®å®šæ€§å¯¹çš„æ“ä½œå¸¦æ¥äº†éš¾é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨ä¸Šå±‚è½¯ä»¶éœ€è¦é€šè¿‡ä¸²å£èŠ‚ç‚¹ devttyUSBx è¿›è¡Œæ•°æ®è¯»å–æ—¶ã€‚ è§£å†³æ–¹æ¡ˆå½“å‰çš„é—®é¢˜æ˜¯ï¼Œåœ¨çš„ç¡¬ä»¶æ¶æ„ä¸Šï¼Œä¸¤å° USB è½¬ä¸²å£è®¾å¤‡åœ¨é€šç”µåå‡ ä¹åŒä¸€æ—¶é—´å¯åŠ¨ã€‚è¿™å°±æ„å‘³ç€ï¼Œæ¯æ¬¡å¯åŠ¨åï¼ŒttyUSB0 å’Œ ttyUSB1 çš„æŒ‡å‘å¯èƒ½ä¼šå˜åŠ¨ï¼Œæ— æ³•ä¿è¯å®ƒä»¬æ€»æ˜¯å¯¹åº”åˆ°ä¸Šä¸€æ¬¡çš„å›ºå®šç«¯å£ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ bash å’Œ Python çš„æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œç»„åˆï¼Œä»¥ç¡®ä¿å§‹ç»ˆèƒ½å¤Ÿè·å–åˆ°æ­£ç¡®æ•°æ®çš„ç«¯å£ã€‚ ä»¥ä¸‹æ˜¯å…·ä½“çš„æ­¥éª¤ï¼š åœ¨ç¬¬ä¸€æ¬¡é€šç”µæ—¶ï¼Œé€šè¿‡å‘½ä»¤ ls -l /sys/class/tty/ttyUSB* ç¡®å®šå“ªä¸ªç«¯å£ï¼ˆå¦‚ 3-1.1ï¼‰æ˜¯æ‰€éœ€è¦çš„æ•°æ®ç«¯å£ã€‚ åœ¨åç»­çš„æ¯æ¬¡é€šç”µä¸­ï¼Œéœ€è¦é‡æ–°è·å–æŒ‚è½½åœ¨æ­¤ç«¯å£ä¸Šçš„ ttyUSB è®¾å¤‡ã€‚å¦‚æœå°†è¿™ä¸ªè®¾å¤‡åˆ›å»ºä¸€ä¸ªå›ºå®šåç§°çš„è½¯é“¾æ¥ï¼ˆå¦‚ ttydataï¼‰ï¼Œé‚£ä¹ˆä»¥åæ¯æ¬¡æ‰“å¼€ devttydata å°±èƒ½å§‹ç»ˆæ‰¾åˆ°ä¸ 3-1.1 å¯¹åº”çš„è®¾å¤‡ï¼Œæ— è®ºå®ƒæ˜¯ ttyUSB0 è¿˜æ˜¯ ttyUSB1ã€‚ åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ getUSBï¼Œå…¶ä¸­åŒ…å«ï¼š cmd.shï¼šä½¿ç”¨ bash è„šæœ¬è·å– /sys/class/tty/ttyUSB* çš„ç›¸å…³ä¿¡æ¯ï¼Œå¹¶ä¿å­˜åœ¨ device_usb.txt ä¸­ã€‚ getUSB.pyï¼šè¯»å– device_usb.txt çš„ä¿¡æ¯ï¼Œä»¥åˆ¤æ–­å½“å‰æŒ‚è½½åœ¨ç«¯å£ 3-1.1 ä¸Šçš„æ˜¯ ttyUSB0 è¿˜æ˜¯ ttyUSB1ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨ usbdev ä¸­ã€‚ cmd.sh#!/bin/bashdeclare -i a=0declare -i b=0#ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè‹¥æœªæ£€æµ‹åˆ° ttyUSB0 è®¾å¤‡åˆ™è‡ªåŠ¨è·³å‡ºå¾ªç¯while [[ ! -e /sys/class/tty/ttyUSB0 ]]do sudo sleep 0.01s a=a+1 if [ $a -eq 300 ];then break fidone# å¦‚æœttyUSB0è¢«æ£€æµ‹åˆ°ï¼Œåˆ™ä¹Ÿè·³å‡ºå¾ªç¯while [[ ! -e /sys/class/tty/ttyUSB1 ]]do sudo sleep 0.01s b=b+1 if [[ $b -eq 300 || $a -ne 0 ]];then break fidone# æ£€æŸ¥æ˜¯å¦æ²¡æœ‰ ttyUSB è®¾å¤‡# å¦‚æœæˆåŠŸæ£€æµ‹åˆ°ä¸¤ä¸ª ttyUSB è®¾å¤‡ï¼Œåˆ™è®°å½•ä¿¡æ¯åˆ° device_usb.txtif [[ ! -e /sys/class/tty/ttyUSB0 ! -e /sys/class/tty/ttyUSB1 ]]; then echo æœªæ£€æµ‹åˆ° ttyUSB0 æˆ– ttyUSB1else tty1=$(ls -l /sys/class/tty/ttyUSB0) tty2=$(ls -l /sys/class/tty/ttyUSB1) sudo ls -l /sys/class/tty/ttyUSB0 /sys/class/tty/ttyUSB1 ./device_usb.txtfi# éç©ºæ£€æµ‹if [ ! -n $tty1 ]; then echo tty1 ä¸ºç©ºfi# å»¶è¿Ÿ 0.01s ç¡®ä¿ device_usb.txt å®Œæˆå†™å…¥sudo sleep 0.01s# åˆ é™¤æ—§çš„ USB è®¾å¤‡è½¯é“¾æ¥if [ ! -e /dev/ttydata ]; then echo -------------/dev/ttydata æœªæ‰¾åˆ°else echo /dev/ttydata å·²å­˜åœ¨ sudo rm /dev/ttydatafi# è°ƒç”¨ Python è„šæœ¬è·å–æ­£ç¡®çš„ USB æ¥å£./getUSB.py usbdev=$(cat ./usbdev) echo å½“å‰è®¾å¤‡ä¸º: echo $usbdev# å°†è®¾å¤‡è½¯é“¾æ¥åˆ° /dev/ttydata ä¹‹åæ¯æ¬¡æ‰“å¼€è¿™ä¸ª ttydata å³å¯sudo ln -s /dev/$usbdev /dev/ttydata getUSB.py#!/usr/bin/python# coding:utf-8import re # å¼•å…¥æ­£åˆ™è¡¨è¾¾å¼æ¨¡å—# æ‰“å¼€ device_usb.txt æ–‡ä»¶ä»¥è¯»å–è®¾å¤‡ä¿¡æ¯with open(./device_usb.txt, rb) as sss: # åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ usbdev æ¥å­˜å‚¨è¾“å‡ºç»“æœ with open(./usbdev, wb) as www: s_read = sss.read() # æ­£åˆ™è¡¨è¾¾å¼æ ¹æ®ç‰¹å®šæ¨¡å¼åŒ¹é… r = rusb3/3-1/3-1\\.1.+(ttyUSB[0-9]) # åˆ©ç”¨æ­£åˆ™æ‰¾åˆ°ä¸ç«¯å£ 3-1.1 ç›¸å…³çš„ ttyUSB è®¾å¤‡ output = re.findall(r, s_read) # å°†ç»“æœå†™å…¥ usbdev æ–‡ä»¶ www.write(output[0]) å®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œè®¾ç½®å¼€æœºé¡¹ç›®ï¼Œå°† getUSB æ–‡ä»¶å¤¹æ”¾åˆ°ä¸€ä¸ªå›ºå®šä½ç½®ï¼Œç„¶ååœ¨ /etc/rc.local ä¸­å¢åŠ  cmd.sh çš„å¯åŠ¨é¡¹ã€‚è¿™æ ·ï¼Œæ¯æ¬¡å¼€æœºåï¼Œéƒ½ä¼šä» /dev/ttydata è·å–åˆ°ä¸å›ºå®šç«¯å£å¯¹åº”çš„æ•°æ®ï¼Œä»è€Œç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ï¼Œé¿å…äº†å› è®¾å¤‡èŠ‚ç‚¹ä¸ç¡®å®šæ€§å¸¦æ¥çš„éº»çƒ¦ã€‚ æ–¹æ¡ˆäºŒæ¥å…¥ USB è®¾å¤‡é¦–å…ˆï¼Œç¡®ä¿å°† USB è®¾å¤‡è¿æ¥åˆ°è®¡ç®—æœºï¼Œæ¥ä¸‹æ¥éœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š devlabel add -d /dev/sda1 -s /dev/usbdevice è¿™é‡Œï¼Œ/dev/sda1 æ˜¯ USB è®¾å¤‡çš„åç§°ã€‚è¦ç¡®è®¤ USB è®¾å¤‡çš„ç¡®åˆ‡åç§°ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š fdisk -l å¦‚æœ fdisk å‘½ä»¤æ²¡æœ‰æ˜¾ç¤ºå‡ºè®¾å¤‡ä¿¡æ¯ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨å¦ä¸€ç§æ–¹æ³•ã€‚åœ¨ç»ˆç«¯ä¸­ï¼Œæ£€æŸ¥ä»¥ä¸‹ç›®å½•æ˜¯å¦å­˜åœ¨ï¼š /proc/scsi/usb-storage-# å…¶ä¸­ï¼Œ# ä»£è¡¨æ•°å­—ï¼ˆå¦‚ 0ã€1ã€2ã€3 ç­‰ï¼‰ã€‚å¦‚æœ /proc/scsi/usb-storage-# å­˜åœ¨ï¼Œç»§ç»­æ£€æŸ¥ï¼š /proc/scsi/usb-storage-#/# åœ¨è¿™ä¸ªç›®å½•ä¸­ï¼ŒæŸ¥çœ‹æœ€åä¸€è¡Œæ˜¯å¦åŒ…å«ï¼š Attach: YES å¦‚æœæ˜¯ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®å®šè®¾å¤‡çš„åç§°å¦‚ä¸‹ï¼š /dev/sda ä»£è¡¨ 0 /dev/sdb ä»£è¡¨ 1 /dev/sdc ä»£è¡¨ 2 æ¥ä¸‹æ¥ï¼Œ/dev/usbdevice æ˜¯å®šä¹‰çš„ç”¨æˆ·è®¾å¤‡åç§°ï¼Œå¯ä»¥éšæ„é€‰æ‹©ä¸€ä¸ªç›®å½•å¹¶å‘½åã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¯ä»¥å‘½åä¸º /dev/myusbã€‚ æ³¨æ„ï¼šautomount é€‰é¡¹å¯ä»¥é€‰æ‹©æ€§åœ°å»æ‰ã€‚å¦‚æœåœ¨ devlabel é‡æ–°å¯åŠ¨æ—¶ï¼Œ/etc/fstab ä¸­æœ‰è¿™ä¸ªè®¾å¤‡é¡¹ç›®ä¸”è¯¥è®¾å¤‡å­˜åœ¨ï¼ˆå…·å¤‡ç›¸åŒçš„ UUIDï¼‰ï¼Œåˆ™ç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‚è½½è¯¥é¡¹ç›®ã€‚ åˆ›å»ºæŒ‚è½½ç›®å½•åˆ›å»ºä¸€ä¸ªæŒ‚è½½ç‚¹ç›®å½•ï¼Œä½¿ç³»ç»Ÿèƒ½å¤Ÿå°† USB è®¾å¤‡æ­£ç¡®è¿æ¥ï¼š mkdir /mnt/usb ä¿®æ”¹ etcfstab æ–‡ä»¶æ‰“å¼€ /etc/fstab æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä¸€è¡Œï¼š /dev/usbdevice /mnt/usb auto noauto,owner 0 0 è¿™æ¡è®°å½•çš„æ„ä¹‰åœ¨äºï¼Œç³»ç»Ÿæ¯æ¬¡æ’å…¥ USB å­˜å‚¨è®¾å¤‡æ—¶ï¼Œéƒ½ä¼šè‡ªåŠ¨å°†å…¶æŒ‚è½½åˆ° /mnt/usb ç›®å½•ä¸‹ã€‚è¿™ä¸€æ“ä½œçš„å‰ææ˜¯è¯¥ç›®å½•å¿…é¡»å­˜åœ¨ã€‚ è§£å†³æ–¹æ¡ˆæ€è·¯å½“ä»»ä½• USB è®¾å¤‡æ’å…¥æ—¶ï¼Œhotplug ç¨‹åºä¼šè‡ªåŠ¨è¿è¡Œ updfstab ç¨‹åºã€‚å¦‚æœæ–°çš„ USB å­˜å‚¨è®¾å¤‡è¢«æ£€æµ‹åˆ°ï¼Œè¯¥ç¨‹åºä¼šåœ¨ /etc/fstab ä¸­ä¸ºå®ƒæ·»åŠ ä¸€æ¡è®°å½•ã€‚è¿™æ¡åŒ…å«äº†å®é™…è®¾å¤‡åç§°ï¼ˆå¦‚ /dev/sda1ï¼‰å’Œ kudzu é€‰é¡¹ã€‚kudzu é€‰é¡¹çš„ä½œç”¨æ˜¯ï¼Œå¦‚æœè®¾å¤‡ä¸å­˜åœ¨ï¼Œå°±ä¼šåˆ é™¤è¿™ä¸€è¡Œè®°å½•ã€‚ ä¸ºäº†ç¡®ä¿è¿™ä¸€è¡Œèƒ½å¤Ÿä¿ç•™åœ¨æ–‡ä»¶ä¸­ï¼Œéœ€è¦åˆ é™¤ kudzu é€‰é¡¹ï¼ŒåŒæ—¶å°†è®¾å¤‡åç§°æ”¹ä¸º devlabel è®¾å¤‡åç§°ã€‚ä¾‹å¦‚ï¼Œå°† /dev/sda1 æ”¹ä¸º /dev/usbdeviceã€‚è®°å¾—åŒæ—¶åˆ›å»ºæŒ‚è½½ç‚¹ï¼ˆå¦‚ /mnt/usbï¼‰ã€‚è¿™æ ·ï¼Œä¿®æ”¹åçš„å†…å®¹å°±ç¬¦åˆä¸Šè¿°çš„ç¬¬ä¸‰æ­¥ã€‚ ä½¿ç”¨æ›´ç®€å•çš„æ–¹æ³•æœ€åï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œå¯¹æ¥è¯´ï¼Œè¿™æ˜¯å½“å‰æœ€ç®€å•çš„åšæ³•ã€‚å¯ä»¥ç›´æ¥ç¼–è¾‘ /etc/hotplug/usb.agent æ–‡ä»¶ï¼Œæ‰¾åˆ°ä»¥ä¸‹æ®µè½ï¼š add)if [ -x /sbin/devlabel ]; then /sbin/devlabel restartfi åœ¨ä¸Šè¿°ä»£ç åé¢æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š [ -x /usr/sbin/udisk ] /usr/sbin/udisk æ­¤å¤„ï¼Œudisk æ˜¯ä¸€ä¸ªç®€å•çš„æŒ‚è½½è„šæœ¬ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š #! /bin/shmount | grep /mnt/usbif [ $? = 0 ]; then umount /mnt/usb rmdir /mnt/usbelse mkdir /mnt/usb mount /dev/sda1 /mnt/usbfi è¿™æ ·åšçš„ç›®çš„åœ¨äºï¼Œæ¯å½“ USB è®¾å¤‡è¿æ¥æ—¶ï¼Œhotplug ç¨‹åºä¼šè‡ªåŠ¨è¿è¡Œã€‚åœ¨è„šæœ¬ä¸­åŠ å…¥æŒ‚è½½åŠŸèƒ½åï¼ŒUSB è®¾å¤‡çš„è‡ªåŠ¨æŒ‚è½½å°†å˜å¾—éå¸¸æ–¹ä¾¿ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå¯¹äºè®¾å¤‡çš„å¸è½½æ“ä½œï¼Œç”¨æˆ·è¿˜æ˜¯éœ€è¦ä½¿ç”¨ umount å‘½ä»¤ï¼ˆæˆ–è€…ç›´æ¥è¿è¡Œ udiskï¼Œå¦‚æœä½¿ç”¨ç¬¬ä¸‰ç§åŠæ³•ï¼‰ã€‚è¿™å’Œ Windows ç³»ç»Ÿçš„å¤„ç†æ–¹å¼ç›¸ä¼¼ã€‚","categories":["4.é€šè®¯åè®®","USB"]},{"title":"è‡ªåŠ¨æŒ‚è½½Uç›˜","path":"/2023/12/06/4-é€šè®¯åè®®-USB-è‡ªåŠ¨æŒ‚è½½Uç›˜/","content":"æŸäº›åœºæ™¯ä¸‹ï¼ŒæœåŠ¡å™¨å¯èƒ½æ²¡æœ‰å¿…è¦çš„é”®ç›˜ç­‰è¾“å…¥è®¾å¤‡ã€å±å¹•ç­‰è¾“å‡ºè®¾å¤‡ã€‚æ­¤æ—¶éœ€è¦åœ¨æ²¡æœ‰äººä¸ºå¹²é¢„çš„æƒ…å†µä¸‹å®ç°å½“æ’å…¥ U ç›˜æˆ–è€…ç¡¬ç›˜åè‡ªåŠ¨æŒ‚è½½ï¼Œå¹¶æ‰§è¡ŒæŸäº›è„šæœ¬åŠ¨ä½œã€‚ å¿…è¦ç»„ä»¶udev udisks busybox (éœ€è¦ç”¨åˆ° blkid)å¯ä»¥ç›´æ¥è·å–åˆ°è®¾å¤‡çš„å·æ ‡ï¼Œè¿™æ ·å°±å¯ä»¥æŒ‡å®šæŒ‚è½½è·¯å¾„åç§°äº†ã€‚ å®ç°è§„åˆ™ç¼–å†™ç¼–å†™ udev è§„åˆ™å®ç° U ç›˜æ’å…¥æ—¶å€™çš„åŠ¨ä½œã€‚è§„åˆ™æ–‡ä»¶å†™åœ¨ /etc/udev/rules.d ä¸‹ã€‚ å¦‚ä¸Šï¼Œ é€šè¿‡è§„åˆ™å®šä¹‰ U ç›˜æ’å…¥ä¸æ‹”å‡ºçš„åŠ¨ä½œå³å¯ï¼ŒåŠ¨ä½œçš„å…·ä½“å®ç°å¯ä»¥åœ¨è§„åˆ™ä¸­ç¼–å†™ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šæ‰§è¡Œè„šæœ¬æ¥å®ç°ã€‚æœ¬æ–‡çš„è§„åˆ™ä¸­ä»…æŒ‡å®šæ‰§è¡Œè„šæœ¬ã€‚ è§„åˆ™å¦‚ä¸‹ï¼š ENVDEVTYPE=partition,RUN+=/lib/udev/automount.sh,ENVREMOVE_CMD=/lib/udev/autounmount.sh è„šæœ¬ç¼–å†™å°†è„šæœ¬æ–‡ä»¶å†™åœ¨ /lib/udev ä¸‹ï¼Œæ ¹æ®ä¸Šæ–‡è§„åˆ™ï¼Œåº”è¯¥åˆ†åˆ«å®ç°æ’å…¥çš„åŠ¨ä½œè„šæœ¬å’Œæ‹”å‡ºçš„åŠ¨ä½œè„šæœ¬ã€‚ æ’å…¥åŠ¨ä½œè„šæœ¬ä¸»è¦åœ¨äºéœ€è¦è·å–åˆ°è®¾å¤‡çš„å·æ ‡ï¼Œæ¥ç¡®å®šæŒ‚è½½çš„è·¯å¾„(å³ $ID_FS_LABEL) #!/bin/shmount_point=$ID_FS_LABELif [ -z $mount_point ];thenmount_point=$DEVNAME##*/fiif [ -n $mount_point ];thenmkdir -p /media/$mount_pointmount -t $ID_FS_TYPE -o gid=100,dmask=000,fmask=111,utf8,flush,rw,noatime,users$DEVNAME /media/$mount_pointfi æ‹”å‡ºåŠ¨ä½œè„šæœ¬åœ¨ U ç›˜æ‹”å‡ºæ—¶å€™ï¼ŒåŠæ—¶åˆ æ‰æŒ‚è½½çš„è·¯å¾„ mount_point=$ID_FS_LABELif [ -z $mount_point ];thenmount_point=$DEVNAME##*/fiif [ -n $mount_point ];thenumount -l /media/$mount_point rm -r /media/$mount_pointfi è‡ªåŠ¨æ‰§è¡ŒåŠ¨ä½œè„šæœ¬è¿™æ ·ï¼Œå½“ U ç›˜æ’å…¥æ—¶ï¼Œ/media/ ä¸‹å°±ä¼šå‡ºç°äºå·æ ‡ç›¸åŒçš„æ–‡ä»¶å¤¹ï¼Œå¹¶æŒ‚è½½ä¸Šäº† U ç›˜ã€‚å› æ­¤ï¼Œéœ€è¦å®ç° U ç›˜æ’å…¥è‡ªåŠ¨æ‰§è¡Œçš„è¯ï¼Œé€šè¿‡è½®è¯¢æ¢æµ‹ /media/ ä¸‹ç›¸åº”ç›®å½•æ˜¯å¦å­˜åœ¨å³å¯ã€‚å¦‚: UDISK=$1# ---------------main control area ---------------while (true)do\t# probe mounted disk\tif [ -e$UDISK ];\tthen echoMounted device [$UDISK] found !\telse echoDevice not found [$UDISK] !\tfi\techoSleep for sometime...\tsleep 3sdone éœ€è¦æ³¨æ„çš„é—®é¢˜æ–°ç‰ˆæœ¬çš„ udev å¯èƒ½ä¼šé‡åˆ° mount å¤±æ•ˆçš„é—®é¢˜ï¼Œé€šè¿‡æŸ¥è¯¢èµ„æ–™å¯çŸ¥ï¼Œudev çš„ rules è¿è¡Œäºç‹¬ç«‹çš„æ–‡ä»¶ç©ºé—´ä¸Šï¼Œä¸ç”¨æˆ·çš„æ–‡ä»¶ç©ºé—´ä¸åŒï¼Œå› æ­¤åŠæ—¶æŒ‚è½½ä¸Šäº†ï¼Œç”¨æˆ·ä¹Ÿæ— æ³•è®¿é—®ã€‚å› æ­¤éœ€è¦å°† udev çš„è¿è¡Œæ–¹å¼æ”¹ä¸ºå…±äº«ã€‚ ä¿®æ”¹æ–¹å¼å¦‚ä¸‹ï¼š æ‹·è´ä¸€ä»½ /usr/lib/systemd/system/systemd-udevd.service åˆ° /etc/systemd/system/ ï¼ˆæ¨èï¼‰ ç¼–è¾‘ /etc/systemd/system/ å°† MountFlags æ”¹ä¸º shared é‡å¯å³å¯ã€‚","categories":["4.é€šè®¯åè®®","USB"]},{"title":"ZeroMQç¬”è®°","path":"/2023/12/05/4-é€šè®¯åè®®-ZeroMQ-ZeroMQç¬”è®°/","content":"æ¦‚è¿°ZeroMQ æ˜¯ä¸€ç§é«˜æ•ˆçš„åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„å¤šçº¿ç¨‹ç½‘ç»œåº“ï¼Œæ—¨åœ¨ç®€åŒ–ç½‘ç»œé€šä¿¡çš„å¤æ‚æ€§ã€‚å®ƒå¯¹åº•å±‚å¥—æ¥å­—ç±»å‹ã€è¿æ¥å¤„ç†ã€æ•°æ®å¸§ï¼Œç”šè‡³è·¯ç”±çš„ç»†èŠ‚è¿›è¡Œäº†æå¤§çš„æŠ½è±¡ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨è·¨è¶Šå¤šç§ä¼ è¾“åè®®çš„å¥—æ¥å­—ã€‚å¯ä»¥è®¤ä¸ºï¼ŒZeroMQ åœ¨ç½‘ç»œé€šä¿¡ä¸­å¢åŠ äº†ä¸€å±‚æ–°çš„æŠ½è±¡ï¼Œä½äºåº”ç”¨å±‚å’Œä¼ è¾“å±‚ä¹‹é—´ï¼ˆæŒ‰ç…§ TCPIP çš„åˆ’åˆ†ï¼‰ã€‚è¿™å±‚æŠ½è±¡èƒ½å¤Ÿå®ç°å¯ä¼¸ç¼©çš„é€šä¿¡ï¼Œæ”¯æŒåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¹¶è¡Œå·¥ä½œã€‚ æ€»ä½“æ¶æ„ZeroMQ çš„è®¾è®¡ä½¿å¾—å‡ ä¹æ‰€æœ‰çš„ IO æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä»è€Œç¡®ä¿ä¸»çº¿ç¨‹ä¸ä¼šè¢«é˜»å¡ã€‚å½“ç”¨æˆ·è°ƒç”¨ zmq_init å‡½æ•°æ—¶ï¼Œå¯ä»¥æ ¹æ®ä¼ å…¥çš„å‚æ•°åˆ›å»ºå¯¹åº”æ•°é‡çš„ IO çº¿ç¨‹ã€‚æ¯ä¸ª IO çº¿ç¨‹éƒ½é…å¤‡ä¸€ä¸ªç»‘å®šçš„ Pollerï¼ŒPoller é‡‡ç”¨ç»å…¸çš„ Reactor æ¨¡å¼å®ç°ï¼Œæ ¹æ®ä¸åŒæ“ä½œç³»ç»Ÿå¹³å°ï¼Œä½¿ç”¨ä¸åŒçš„ç½‘ç»œ IO æ¨¡å‹ï¼Œå¦‚ selectã€pollã€epollã€devpoll ä»¥åŠ kequeue ç­‰ã€‚ ä¸»çº¿ç¨‹å’Œ IO çº¿ç¨‹ä¹‹é—´é€šè¿‡ Mail Box è¿›è¡Œæ¶ˆæ¯ä¼ é€’ã€‚å½“æœåŠ¡å™¨å¼€å§‹ç›‘å¬æˆ–è€…å®¢æˆ·ç«¯å‘èµ·è¿æ¥æ—¶ï¼Œä¸»çº¿ç¨‹ä¼šç›¸åº”åœ°åˆ›å»º zmq_connecter æˆ– zmq_listenerï¼Œå¹¶é€šè¿‡ Mail Box å°†å…¶ç»‘å®šåˆ° IO çº¿ç¨‹ã€‚ç´§æ¥ç€ï¼ŒIO çº¿ç¨‹å°† zmq_connecter æˆ– zmq_listener æ·»åŠ åˆ° Poller ä¸­ï¼Œä»¥ä¾¦å¬è¯»å†™äº‹ä»¶ã€‚åœ¨ Server å’Œ Client ç¬¬ä¸€æ¬¡é€šä¿¡æ—¶ï¼Œä¼šä½¿ç”¨ zmq_init å‘é€èº«ä»½æ ‡è¯†è¿›è¡Œè®¤è¯ã€‚è®¤è¯å®Œæˆåï¼ŒåŒæ–¹ä¸ºæ­¤æ¬¡è¿æ¥åˆ›å»ºä¸€ä¸ª Sessionï¼Œä»¥ååŒæ–¹é€šè¿‡ Session è¿›è¡Œé€šä¿¡ã€‚æ¯ä¸ª Session éƒ½å°†å…³è”åˆ°ç›¸åº”çš„è¯»å†™ç®¡é“ã€‚ä¸»çº¿ç¨‹åœ¨è¿›è¡Œæ¶ˆæ¯çš„æ”¶å‘æ—¶ï¼Œåªéœ€é€šè¿‡ç®¡é“è¯»å–å’Œå†™å…¥æ•°æ®ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒSession å¹¶ä¸ç›´æ¥ä¸å†…æ ¸äº¤æ¢ IO æ•°æ®ï¼Œè€Œæ˜¯é€šè¿‡è¿æ¥åˆ° Session çš„ Engine æ¥ä¸å†…æ ¸äº¤äº’ã€‚ ç¼–ç¨‹æ¨¡å¼åœ¨æ•°æ®éœ€è¦å¹¶è¡ŒåŒ–å¤„ç†çš„åœºåˆï¼Œé‡‡ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œé€šä¿¡çš„æ–¹å¼å¾€å¾€ä¼˜äºä¼ ç»Ÿçš„å…±äº«çŠ¶æ€æ–¹æ³•ã€‚ZeroMQ å¯¹æ¶ˆæ¯é€šä¿¡çš„æ¨¡å¼è¿›è¡Œäº†æ€»ç»“ï¼Œæä¾›äº†å¤šç§æ¨¡å¼é€‰æ‹©ã€‚ ZeroMQ ä¸æ˜¯å¯¹å¥—æ¥å­—çš„ç®€å•å°è£…ï¼Œä¸é€‚åˆç”¨æ¥å®ç°å·²å­˜åœ¨çš„ç½‘ç»œåè®®ã€‚å®ƒæœ‰ç‹¬ç‰¹çš„é€šä¿¡æ¨¡å¼ï¼Œè¿™äº›æ¨¡å¼å¹¶ä¸å±€é™äºåº•å±‚çš„ç‚¹å¯¹ç‚¹é€šä¿¡æ–¹å¼ã€‚ä¸ TCP åè®®ç›¸æ¯”ï¼ŒZeroMQ æä¾›äº†ä¸€ç§æ›´é«˜å±‚çº§çš„åè®®é€‰æ‹©ï¼ˆå¹¶ä¸” ZeroMQ ä¹Ÿä¸ä»…ä»…åŸºäº TCPï¼Œå®ƒåŒæ ·é€‚ç”¨äºè¿›ç¨‹é—´å’Œè¿›ç¨‹å†…é€šä¿¡ï¼‰ã€‚ ZeroMQ å°†é€šä¿¡éœ€æ±‚åˆ†ä¸ºå››ç±»ï¼Œå…¶ä¸­ä¸€ç±»æ˜¯ä¸€å¯¹ä¸€å³å¯¹ç§°é€šä¿¡ï¼Œè™½ç„¶æ”¯æŒä¼ ç»Ÿçš„ TCP socket æ¨¡å‹ï¼Œä½†å¹¶ä¸æ¨èä½¿ç”¨ã€‚å…¶ä½™ä¸‰ç±»æ¨¡å‹æ›´ä¸ºå¸¸ç”¨ã€‚ è¯·æ±‚-å›åº”æ¨¡å‹ï¼šåœ¨æ­¤æ¨¡å‹ä¸­ï¼Œè¯·æ±‚ç«¯ä¸»åŠ¨å‘é€è¯·æ±‚å¹¶ç­‰å¾…å›åº”ã€‚åœ¨è¯·æ±‚ç«¯çš„è§’åº¦çœ‹ï¼Œæ”¶å‘æ˜¯é…å¯¹çš„ï¼Œè€Œåœ¨å›åº”ç«¯åˆ™æ˜¯å‘é€å’Œæ¥æ”¶çš„å¯¹åº”å…³ç³»ã€‚è¯·æ±‚ç«¯å’Œå›åº”ç«¯å¯ä»¥ä¸º 1:N æ¨¡å¼ã€‚é€šå¸¸å°† 1 ç†è§£ä¸º Serverï¼Œå°† N ç†è§£ä¸º Clientã€‚ZeroMQ å®Œç¾åœ°æ”¯æŒè·¯ç”±åŠŸèƒ½ï¼ˆä½¿ç”¨ç»„ä»¶ Device å®ç°ï¼‰ï¼Œå°† 1:N æ‰©å±•ä¸º N:M æ¨¡å¼ã€‚åœ¨è¿™ä¸€æ¨¡å‹ä¸­ï¼Œåº•å±‚çš„ç«¯ç‚¹åœ°å€å¯¹äºä¸Šå±‚æ˜¯éšè—çš„ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½éšå«äº†å›åº”åœ°å€ï¼Œåº”ç”¨ç¨‹åºå¯¹æ­¤å¹¶ä¸éœ€è¦å…³æ³¨ã€‚ å‘å¸ƒ-è®¢é˜…æ¨¡å‹ï¼šåœ¨è¯¥æ¨¡å‹ä¸­ï¼Œå‘å¸ƒç«¯åªè´Ÿè´£å•å‘å‘é€æ¶ˆæ¯ï¼ŒåŒæ—¶ä¸å…³å¿ƒæ•°æ®æ˜¯å¦å…¨éƒ¨æˆåŠŸå‘é€åˆ°è®¢é˜…ç«¯ã€‚å¦‚æœå‘å¸ƒç«¯å¼€å§‹ä¼ é€ä¿¡æ¯æ—¶ï¼Œè®¢é˜…ç«¯å°šæœªè¿æ¥ï¼Œæ¶ˆæ¯å°†è¢«ä¸¢å¼ƒã€‚ä½†ä¸€æ—¦è®¢é˜…ç«¯è¿æ¥æˆåŠŸï¼Œå°†ç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚åŒæ ·ï¼Œè®¢é˜…ç«¯åªæ˜¯æ¥æ”¶æ•°æ®ï¼Œä¸èƒ½å‘é€åé¦ˆã€‚å¦‚æœå‘å¸ƒç«¯å’Œè®¢é˜…ç«¯ä¹‹é—´éœ€è¦äº¤äº’ï¼ˆä¾‹å¦‚ç¡®è®¤è®¢é˜…è€…çš„è¿æ¥çŠ¶æ€ï¼‰ï¼Œå¯ä½¿ç”¨é¢å¤–çš„å¥—æ¥å­—ï¼Œé€šè¿‡è¯·æ±‚-å›åº”æ¨¡å‹æ¥æ»¡è¶³ã€‚ ç®¡é“æ¨¡å‹ï¼šåœ¨æ­¤æ¨¡å‹ä¸­ï¼Œæ•°æ®æµå•å‘æ¨è¿›ï¼Œä» PUSH ç«¯å‘ PULL ç«¯è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚è¿™ä¸ªæ¨¡å‹å¯é€šè¿‡å¤šç§ç»„åˆè§£å†³ä»»ä½•åˆ†å¸ƒå¼å’Œå¹¶è¡Œå¤„ç†çš„éœ€æ±‚ã€‚ZeroMQ ä¸“æ³¨äºè§£å†³æ¶ˆæ¯é€šè®¯è¿™ä¸€æ ¸å¿ƒé—®é¢˜ï¼Œè¡¨ç°å¾—æä¸ºå‡ºè‰²ã€‚ åŸºäºè¿™äº›å®šä¹‰æ¸…æ™°çš„æ¨¡å‹ï¼ŒZeroMQ çš„ API æ˜¾å¾—ç®€å•æ˜“ç”¨ã€‚å¼€å‘è€…æ— éœ€ä½¿ç”¨ bind/listen/accept æ¥å»ºç«‹æœåŠ¡å™¨ï¼Œå› ä¸ºæ¨¡å‹æœ¬èº«æ˜¯ 1:N ç±»å‹çš„ï¼Œä¸éœ€è¦ä¸ºæ¯ä¸ªé€šé“ä¿å­˜å¥æŸ„ã€‚æ­¤å¤–ï¼ŒServer çš„å¯åŠ¨é¡ºåºä¹Ÿä¸å†æ˜¯é—®é¢˜ï¼ŒClient åœ¨ Server å¯åŠ¨ä¹‹å‰å°±å¯ä»¥å·¥ä½œã€‚ ZeroMQ ä¸­çš„ Transientï¼ˆçŸ­æš‚ï¼‰å’Œ Durableï¼ˆæŒä¹…ï¼‰å¥—æ¥å­—å¹¶ä¸æ˜¯åº•å±‚å®ç°ä½¿ç”¨çŸ­è¿æ¥æˆ–é•¿è¿æ¥çš„åŒºåˆ«ï¼Œè€Œæ˜¯æ¦‚å¿µä¸Šçš„ä¸åŒã€‚Durable å¥—æ¥å­—çš„ç”Ÿå‘½å‘¨æœŸå¯å¤§äºä¸€ä¸ªè¿›ç¨‹ï¼Œå³ä½¿è¿›ç¨‹é€€å‡ºï¼Œé‡æ–°å¯åŠ¨åä¾æ—§èƒ½å¤Ÿç»´æŒè¿æ¥ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™å¹¶ä¸æ„å‘³ç€å®ƒèƒ½å¤Ÿæ‹¯æ•‘å› é”™è¯¯å´©æºƒçš„ç¨‹åºã€‚å¯¹äº ZeroMQï¼Œè‹¥å†…å­˜æœ‰é™ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å°†æ•°æ®ä¼ è¾“ç¼“å†²åŒºå­˜å‚¨åœ¨ç£ç›˜ä¸­ã€‚ åœ¨ç½‘ç»œæ¸¸æˆçš„æ¶æ„ä¸­ï¼ŒåŸºäº ZeroMQ çš„æœåŠ¡å™¨è®¾è®¡éå¸¸åˆé€‚ã€‚å¯¹äºç©å®¶çš„ Client-Server éƒ¨åˆ†ï¼Œå¯ä»¥è€ƒè™‘ç¼–å†™ä¸€ä¸ªå‰ç«¯ç¨‹åºè¿›è¡Œè¿æ¥ï¼Œè€ŒæœåŠ¡å™¨å†…çš„æœåŠ¡é›†ç¾¤åˆ™å¯ä»¥åˆ©ç”¨ ZeroMQ çš„åè®®è¿›è¡Œé€šä¿¡ã€‚ é€šä¿¡åè®®ZeroMQ æä¾›äº†å››ç§é€šä¿¡åè®®ï¼Œåˆ†åˆ«ç”¨äºè¿›ç¨‹å†…ã€è¿›ç¨‹é—´ã€æœºå™¨é—´å’Œå¹¿æ’­ç­‰åœºæ™¯ã€‚é€šä¿¡åè®®çš„é…ç½®éå¸¸ç®€å•ï¼Œåªéœ€ä½¿ç”¨ç±»ä¼¼äº URL çš„å­—ç¬¦ä¸²æ¥æŒ‡å®šï¼Œæ ¼å¼åŒ…æ‹¬ inproc://ã€ipc://ã€tcp:// å’Œ pgm://ã€‚ZeroMQ ä¼šè‡ªåŠ¨æ ¹æ®è¿™äº›å­—ç¬¦ä¸²è§£æå‡ºåè®®ã€åœ°å€å’Œç«¯å£å·ç­‰ä¿¡æ¯ã€‚ å·¥ä½œæµç¨‹ å®‰è£…åœ¨ UNIX ç±»ç³»ç»Ÿä¸Šæ„å»º ç¡®ä¿å®‰è£…äº† libtoolã€pkg-configã€build-essentialã€autoconf å’Œ automakeã€‚ æ£€æŸ¥ uuid-dev åŒ…æˆ–ç­‰æ•ˆçš„ RPM æ˜¯å¦å·²å®‰è£…ã€‚ è§£å‹ .tar.gz æºä»£ç å½’æ¡£ã€‚ è¿è¡Œ ./configureï¼Œç„¶åæ‰§è¡Œ makeã€‚ å¦‚è¦ç³»ç»Ÿçº§å®‰è£… ZeroMQï¼Œè¿è¡Œ sudo make installã€‚ åœ¨ Linux ç³»ç»Ÿä¸Šï¼Œå®‰è£… ZeroMQ åï¼Œè¿è¡Œ sudo ldconfigã€‚ åœ¨ Windows ä¸Šæ„å»º éœ€è¦ Visual Studio 2008 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ è§£å‹ .zip æºä»£ç å½’æ¡£ã€‚ åœ¨ Visual C++ ä¸­æ‰“å¼€è§£å†³æ–¹æ¡ˆæ–‡ä»¶ builds\\msvc\\msvc.slnã€‚ ç¼–è¯‘è¯¥è§£å†³æ–¹æ¡ˆã€‚ ZeroMQ çš„åº“æ–‡ä»¶å°†ä½äº lib å­ç›®å½•ä¸‹ã€‚","categories":["4.é€šè®¯åè®®","ZeroMQ"]},{"title":"Linuxä¸‹çš„CH34xä¸²å£é©±åŠ¨","path":"/2023/12/04/4-é€šè®¯åè®®-ä¸²å£-Linuxä¸‹çš„CH34xä¸²å£é©±åŠ¨/","content":"ch341.ko æ˜¯ä¸€ä¸ª Linux å†…æ ¸æ¨¡å—ï¼Œç”¨äºæ”¯æŒ CH341 USB è½¬ä¸²å£èŠ¯ç‰‡ã€‚è¦åœ¨å†…æ ¸ä¸­ç¼–è¯‘è¯¥æ¨¡å—ï¼Œéœ€è¦æ‰¾åˆ°å…¶é…ç½®é€‰é¡¹ã€‚è¿™ä¸ªé…ç½®é€‰é¡¹é€šå¸¸åœ¨ Linux å†…æ ¸çš„é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡é…ç½®å†…æ ¸é€‰é¡¹æ¥å¯ç”¨ã€‚ åˆ¤æ–­æ˜¯å¦è¯†åˆ«ä½¿ç”¨ lsusb å‘½ä»¤å¯ä»¥çœ‹åˆ°æœ‰ Bus 001 Device 005: ID 1a86:7523 QinHeng Electronics CH340 serial converter æ˜¯èƒ½è¯†åˆ«å‡º ch34x è®¾å¤‡ æ£€æŸ¥ä¸²å£æ˜¯å¦è¢«é©±åŠ¨åŠ è½½è¾“å…¥æŒ‡ä»¤ ls /dev/ttyUSB* å°†ä¼šåˆ—å‡º USB çš„åŠ è½½æƒ…å†µã€‚å¦‚æœæç¤º No such file or directory åˆ™æ˜¯æ²¡æœ‰è¢«é©±åŠ¨åŠ è½½ã€‚ å ç”¨æƒ…å†µå› æŠ¥æ–‡ä»¶ä¸å­˜åœ¨é”™è¯¯ï¼Œé‡‡ç”¨ dmesg|grep tty å‘½ä»¤æ£€æŸ¥å‘ç°ï¼Œè¢« brltty è¿›ç¨‹å ç”¨ã€‚ brltty æ˜¯ä¸€ä¸ªåå°è¿›ç¨‹ï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼Œä¸ºç›²äººæä¾›å¯¹ LinuxUnix æ§åˆ¶å°çš„è®¿é—®ï¼ˆå½“å¤„äºæ–‡æœ¬æ¨¡å¼æ—¶ï¼‰ï¼Œä½¿ç”¨å¯åˆ·æ–°ç›²æ–‡æ˜¾ç¤ºã€‚ ç§»é™¤è¯¥ apt remove brlttyã€‚ æƒé™chmod a+rw /dev/ttyUSB0 å³å¯ é‡è£…é©±åŠ¨-å•ç‹¬ç¼–è¯‘ä¸‹è½½æœ€æ–°çš„é©±åŠ¨ CH341SER_LINUX https://github.com/WCHSoftGroup/ch341ser_linux è§£å‹åè¿›å…¥ â€œdriverâ€ ç›®å½•ä¸‹ è¾“å…¥ make å‘½ä»¤ç¼–è¯‘é©±åŠ¨ï¼Œæ­£å¸¸ç¼–è¯‘å®Œæˆåï¼Œå°†ä¼šçœ‹åˆ°ç”Ÿæˆäº† ch341.ko æ¨¡å— è¾“å…¥ sudo make load æˆ–è€… sudo insmod ch341.ko åŠ¨æ€åŠ è½½é©±åŠ¨ï¼ˆé‡å¯éœ€è¦å†æ¬¡åŠ è½½ï¼‰ï¼Œæˆ–è€…è¾“å…¥ sudo make install å®‰è£…é©±åŠ¨ï¼ˆé‡å¯ä¸ä¸¢å¤±ï¼‰ è¾“å…¥ sudo make unload æˆ–è€… sudo rmmod ch341.ko æˆ–è€… sudo make uninstall å¸è½½é©±åŠ¨ å¦‚æœç¼–è¯‘å¤±è´¥ï¼Œå¯èƒ½æ˜¯ ch34x.c å’Œå®é™…å†…æ ¸ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œuname -r å¯æŸ¥çœ‹æ“ä½œç³»ç»Ÿçš„å‘è¡Œç‰ˆå·ï¼Œä¹‹ååœ¨ https://elixir.bootlin.com/linux/latest/source ä¸­æŸ¥æ‰¾å¯¹åº”å†…æ ¸ç‰ˆæœ¬çš„æºä»£ç æ–‡ä»¶ï¼Œä¸€èˆ¬ä½äº /drivers/usb/serial/ch341.cï¼Œæ›¿æ¢åé‡æ–°ç¼–è¯‘ å¦‚æœ insmod å¤±è´¥ï¼ŒæŸ¥çœ‹ /lib/modules/$(uname -r)/kernel/drivers/usb/serial ç›®å½•ä¸‹æ˜¯å¦å·²ç»æœ‰äº† ko æ¨¡å—ï¼Œå°†ç›®å½•ä¸­ç”Ÿæˆ ko æ–‡ä»¶å¤åˆ¶åˆ°æ­¤å¤„ï¼Œä½¿ç”¨ lsmod æŸ¥çœ‹æ¨¡å— é‡è£…é©±åŠ¨-äº¤å‰ç¼–è¯‘ç¼–è¯‘ä¸€ä¸ª ARM64 çš„ ch341 çš„ ko æ–‡ä»¶ï¼Œç”¨äº 4.19.206 å†…æ ¸çš„ Linuxï¼Œch341.ko æ¨¡å—çš„å®šä¹‰ä½äº drivers/usb/serial/Kconfig æ–‡ä»¶ä¸­ï¼Œé€šè¿‡é…ç½® USB_SERIAL_CH341 é€‰é¡¹å¯ä»¥åœ¨å†…æ ¸ä¸­å¯ç”¨è¯¥æ¨¡å—ã€‚ç¼–è¯‘å†…æ ¸æ—¶æ ¹æ®é…ç½®ç”Ÿæˆç›¸åº”çš„æ¨¡å—æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ modprobe åŠ è½½å³å¯ä½¿ç”¨è¯¥æ¨¡å—ã€‚ åœ¨ drivers ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¸­ï¼Œåœ¨æ–‡ä»¶çš„å†…å®¹ä¸­æŸ¥æ‰¾å­—ç¬¦ä¸² CH341grep -r CH341 drivers/ ç¡®è®¤ä¸²å£ç±»å‹ï¼Œæ˜¯ CH341 è¿˜æ˜¯ PLX2303 ch341.c æ–‡ä»¶ä¸­çš„ usb_device_id æ˜¯å¦åŒ…å«è¦ä½¿ç”¨çš„ VIDï¼ŒPIDï¼ˆlsusb å‘½ä»¤æŸ¥çœ‹ï¼‰ æŸ¥æ‰¾é…ç½®é€‰é¡¹ï¼Œåœ¨ Linux å†…æ ¸æºä»£ç ç›®å½•ä¸­ï¼Œé©±åŠ¨ç¨‹åºçš„é…ç½®é€‰é¡¹é€šå¸¸å®šä¹‰åœ¨ Kconfig æ–‡ä»¶ä¸­ã€‚è¦æŸ¥æ‰¾ ch341 é©±åŠ¨çš„é…ç½®é€‰é¡¹ï¼Œå¯ä»¥åœ¨å†…æ ¸æºä»£ç ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šgrep -r CH341 drivers/ è¿™å°†æœç´¢åŒ…å« CH341 å­—ç¬¦ä¸²çš„æ‰€æœ‰æ–‡ä»¶ï¼Œé€šå¸¸ä¼šæ‰¾åˆ°ç±»ä¼¼ä»¥ä¸‹çš„æ¡ç›®ï¼š drivers/usb/serial/Kconfig:config USB_SERIAL_CH341drivers/usb/serial/Kconfig:\ttristate USB CH341 single port serial driver é…ç½®å†…æ ¸ï¼ŒçŸ¥é“é…ç½®é€‰é¡¹åï¼Œå¯ä»¥ä½¿ç”¨ make menuconfig æˆ– make nconfig ç­‰å·¥å…·æ¥é…ç½®å†…æ ¸ã€‚åœ¨ USB Serial Converter support èœå•ä¸‹ï¼Œæ‰¾åˆ°å¹¶å¯ç”¨ USB CH341 single port serial driver é€‰é¡¹ã€‚æˆ–è€…é…ç½® USB_SERIAL_CH341=mï¼Œå°†å…¶è®¾ç½®ä¸ºæ¨¡å—ï¼ˆMï¼‰æˆ–å†…è”ï¼ˆ*ï¼‰ï¼Œå¦‚æœå¸Œæœ›ç¼–è¯‘ä¸ºæ¨¡å—ï¼Œé€‰æ‹© Mã€‚ Device Drivers --- [*] USB support --- * USB Serial Converter support --- * USB CH341 single port serial driver ç¼–è¯‘å†…æ ¸å’Œæ¨¡å—ï¼Œé…ç½®å®Œæˆåï¼Œç¼–è¯‘å†…æ ¸å’Œæ¨¡å—ï¼š makemake modulesmake modules_install åŠ è½½æ¨¡å—ï¼Œç¼–è¯‘å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ modprobe åŠ è½½æ¨¡å—ï¼šmodprobe ch341 éªŒè¯æ¨¡å—åŠ è½½ï¼Œä½¿ç”¨ lsmod éªŒè¯æ¨¡å—æ˜¯å¦æˆåŠŸåŠ è½½ï¼Œå¦‚æœæ˜¾ç¤º ch341 æ¨¡å—ï¼Œåˆ™è¯´æ˜åŠ è½½æˆåŠŸã€‚lsmod | grep ch341 é‡è£…é©±åŠ¨-aptåŒ…æä¾›äº†ä¸€äº›å¯èƒ½é»˜è®¤æ²¡æœ‰åŒ…å«çš„é¢å¤–å†…æ ¸æ¨¡å—ã€‚ sudo apt install linux-modules-extra-$(uname -r) æ‰‹åŠ¨åŠ è½½ ch341 é©±åŠ¨ç¨‹åºï¼š sudo modprobe ch341 æ£€æŸ¥é©±åŠ¨ç¨‹åºæ˜¯å¦å·²åŠ è½½ï¼š lsmod | grep ch341 æ£€æŸ¥è®¾å¤‡æ˜¯å¦è¢«è¯†åˆ«ï¼š dmesg | grep ch341 KO æ–‡ä»¶å¼€æœºè‡ªåŠ¨åŠ è½½/etc/modules æ–‡ä»¶ä¸­æ·»åŠ æ¨¡å—æ‰“å¼€ /etc/modules æ–‡ä»¶ï¼š sudo vi /etc/modules åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ æƒ³è¦åŠ è½½çš„ KO æ–‡ä»¶çš„åå­—ï¼ˆä¸éœ€è¦è·¯å¾„ï¼Œåªéœ€è¦æ¨¡å—åï¼‰ï¼Œæ¯”å¦‚ï¼š my_module ä½¿ç”¨ modprobe é…ç½®æ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶åœ¨ /etc/modprobe.d/ ç›®å½•ï¼Œä¾‹å¦‚ custom.confï¼š sudo vi /etc/modprobe.d/custom.conf æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼ŒæŒ‡å®šæ¨¡å—åç§°ï¼š install your_module_name /sbin/insmod /path/to/your/module.ko ä½¿ç”¨ rc.local æ–‡ä»¶æ‰“å¼€ /etc/rc.local æ–‡ä»¶ï¼š sudo vi /etc/rc.local åœ¨ exit 0 ä¹‹å‰æ·»åŠ  insmod å‘½ä»¤ï¼ŒæŒ‡å®šæ¨¡å—çš„å®Œæ•´è·¯å¾„ï¼š sudo insmod /path/to/your/module.koexit 0 åˆ›å»º systemd æœåŠ¡åˆ›å»ºä¸€ä¸ªæ–°çš„æœåŠ¡æ–‡ä»¶ï¼Œä¾‹å¦‚ load-module.serviceï¼š sudo vi /etc/systemd/system/load-module.service åœ¨æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ŒæŒ‡å®šæ¨¡å—è·¯å¾„ï¼š [Unit]Description=Load custom kernel module[Service]Type=oneshotExecStart=/sbin/insmod /path/to/your/module.koExecStop=/sbin/rmmod your_module_nameRemainAfterExit=true[Install]WantedBy=multi-user.target","categories":["4.é€šè®¯åè®®","ä¸²å£"]},{"title":"Qtä¸²å£å®ç°","path":"/2023/12/01/4-é€šè®¯åè®®-ä¸²å£-Qtä¸²å£å®ç°/","content":"åŸºäº QextSerialPortåœ¨ Qt4 ä¸­ï¼Œä¸²å£çš„è¯»å†™æ“ä½œå¯ä»¥é€šè¿‡ä½¿ç”¨ QextSerialPort è¿™ä¸ªå¤–éƒ¨ç±»æ¥å®ç°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒæ“ä½œç³»ç»Ÿå¯¹è¯¥ç±»çš„æ”¯æŒç¨‹åº¦æœ‰æ˜æ˜¾å·®å¼‚ï¼š Linuxï¼šåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œä»…æ”¯æŒè½®è¯¢æ–¹å¼æ¥è¯»å–ä¸²å£æ•°æ®ã€‚è¿™æ„å‘³ç€ç¨‹åºå°†é€šè¿‡ä¸æ–­æ£€æŸ¥ä¸²å£æ˜¯å¦æœ‰æ•°æ®å¯ä¾›è¯»å–ï¼Œæ¥å®ç°æ•°æ®æ¥æ”¶ã€‚ Windowsï¼šåœ¨ Windows ç³»ç»Ÿä¸­ï¼Œæ”¯æŒä¸¤ç§ä¸²å£æ•°æ®è¯»å–æ–¹å¼ï¼šè½®è¯¢æ–¹å¼å’Œäº‹ä»¶é©±åŠ¨æ–¹å¼ã€‚è¿™ç§çµæ´»æ€§ä½¿å¾—å¼€å‘è€…å¯ä»¥ based on éœ€æ±‚æ¥é€‰æ‹©å®ç°çš„æ–¹å¼ã€‚ QextSerialBase ä½œä¸ºä¸€ä¸ªåŸºç¡€ç±»ï¼Œç»§æ‰¿è‡ª QIODevice ç±»ï¼Œä¸»è¦è´Ÿè´£æä¾›æ“ä½œä¸²å£æ‰€éœ€çš„ä¸€ç³»åˆ—å˜é‡å’Œå‡½æ•°ã€‚è€Œ Win_QextSerialPort å’Œ Posix_QextSerialPort åˆ™åˆ†åˆ«æ˜¯é’ˆå¯¹ Windows å’Œ Linux çš„å…·ä½“å®ç°ï¼Œå‡ç»§æ‰¿è‡ª QextSerialBaseã€‚ Win_QextSerialPort ç±»ä¸“ä¸º Windows å¹³å°è®¾è®¡ï¼Œå¢å¼ºäº†åœ¨è¯¥å¹³å°ä¸‹è¿›è¡Œä¸²å£æ“ä½œæ—¶çš„ä¸€äº›åŠŸèƒ½ï¼Œå¦‚é€šè¿‡ä¸²å£é€šä¿¡èšåˆä¸åŒçº¿ç¨‹çš„ä¿¡å·ï¼Œç¡®ä¿æ›´é«˜æ•ˆçš„æ•°æ®ä¼ è¾“ã€‚ Posix_QextSerialPort ç±»åˆ™ä¸º Linux å¹³å°è€Œç”Ÿï¼Œéµå¾ª POSIX æ ‡å‡†ï¼Œé€‚ç”¨äº Linux ä¸‹çš„ä¸²å£æ•°æ®å¤„ç†ã€‚ åœ¨ QextSerialBase ç±»ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„æšä¸¾å˜é‡ QueryModeï¼Œå®ƒå¯å–ä¸¤ä¸ªå€¼ï¼šPolling å’Œ EventDrivenã€‚æ­¤æšä¸¾å®šä¹‰äº†è¯»å–ä¸²å£çš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºæŸ¥è¯¢æ¨¡å¼ã€‚å…·ä½“è€Œè¨€ï¼š æŸ¥è¯¢æ–¹å¼ Pollingï¼šè¿™ç§æ–¹å¼ä¸­ï¼Œè¯»å†™å‡½æ•°çš„æ‰§è¡Œæ˜¯åŒæ­¥çš„ï¼Œæ„å‘³ç€ç¨‹åºåœ¨æ‰§è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚ä¿¡å·åœ¨è¿™ç§æ¨¡å¼ä¸‹æ— æ³•ä½¿ç”¨ï¼Œå› æ­¤æ— æ³•å“åº”æ•°æ®åˆ°è¾¾çš„äº‹ä»¶ã€‚å¼€å‘è€…éœ€è¦è‡ªå·±åˆ›å»ºå®šæ—¶å™¨ä»¥å®šæœŸæ£€æŸ¥ä¸²å£æ˜¯å¦æœ‰æ–°æ•°æ®å¯ä¾›è¯»å–ã€‚è¿™ç§æ–¹æ³•çš„å¥½å¤„åœ¨äºå…¶å¼€é”€è¾ƒå°ï¼Œé€‚åˆä¸€äº›å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜çš„åº”ç”¨åœºæ™¯ã€‚ äº‹ä»¶é©±åŠ¨æ–¹å¼ EventDrivenï¼šä¸ Polling å®Œå…¨ä¸åŒçš„æ˜¯ï¼Œæ­¤æ–¹å¼ä½¿ç”¨äº‹ä»¶æœºåˆ¶æ¥å¤„ç†ä¸²å£çš„è¯»å–ã€‚å½“æ•°æ®åˆ°è¾¾æ—¶ï¼Œç³»ç»Ÿä¼šå‘å‡º readyRead() ä¿¡å·ï¼Œå¼€å‘è€…å¯ä»¥å°†è¯¥ä¿¡å·ä¸è‡ªå®šä¹‰çš„æ§½å‡½æ•°å…³è”ï¼Œä»¥å¼‚æ­¥ï¼ˆéé˜»å¡ï¼‰çš„æ–¹å¼è¯»å–ä¸²å£çš„æ•°æ®ã€‚è¿™ç§æ–¹å¼èƒ½æœ‰æ•ˆæé«˜ç¨‹åºçš„å“åº”æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒï¼Œé€‚åˆå¯¹å®æ—¶æ€§æœ‰è¾ƒé«˜è¦æ±‚çš„åº”ç”¨ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒWindows ä¸‹åŒæ—¶æ”¯æŒä¸Šè¿°ä¸¤ç§æ¨¡å¼ï¼Œè€Œ Linux åªæ”¯æŒ Polling æ¨¡å¼ã€‚ åœ¨ä½¿ç”¨ Qt ç¼–å†™ä¸²å£ç¨‹åºæ—¶ï¼Œæ ¹æ®ç›®æ ‡å¹³å°çš„ä¸åŒï¼Œéœ€è¦å¼•ç”¨ä¸åŒçš„æ–‡ä»¶ã€‚åœ¨ Windows å¹³å°ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–‡ä»¶ï¼š qextserialbase.cpp å’Œ qextserialbase.h win_qextserialport.cpp å’Œ win_qextserialport.h è€Œåœ¨ Linux ç¯å¢ƒä¸‹ï¼Œåˆ™éœ€å¼•å…¥ï¼š qextserialbase.cpp å’Œ qextserialbase.h posix_qextserialport.cpp å’Œ posix_qextserialport.h è¿™ç§æ–‡ä»¶æ¶æ„çš„è®¾è®¡ï¼Œä½¿å¾—ç¨‹åºåœ¨è·¨å¹³å°æ—¶ï¼Œå¯ä»¥æ ¹æ®æ“ä½œç³»ç»Ÿçš„ç‰¹æ€§è¿›è¡Œç›¸åº”çš„é€‚é…ï¼Œç¡®ä¿è‰¯å¥½çš„æ€§èƒ½å’Œå…¼å®¹æ€§ã€‚ è½®è¯¢æ–¹å¼åœ¨è½®è¯¢æ¨¡å¼ä¸‹ï¼Œè¯»å†™å‡½æ•°å¯ä»¥å¼‚æ­¥åœ°åŒæ—¶æ‰§è¡Œã€‚ç„¶è€Œï¼Œç”±äºæ­¤æ¨¡å¼çš„ç‰¹æ€§ï¼Œä¿¡å·ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚ä¸ºäº†æ£€æµ‹ä¸²å£æ˜¯å¦æœ‰æ•°æ®ï¼Œå¯ä»¥å¯ç”¨ä¸€ä¸ªå®šæ—¶å™¨ã€‚å®šæ—¶å™¨ä¼šå®šæœŸæ£€æŸ¥ä¸²å£ç¼“å†²åŒºçš„æ•°æ®å¯ç”¨æ€§ï¼Œå…·ä½“å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š ä½¿ç”¨ bytesAvailable() å‡½æ•°æ¥æŸ¥è¯¢å·²è·å¾—çš„å­—èŠ‚æ•°ã€‚ ä¸€æ—¦å­—èŠ‚æ•°è¾¾åˆ°é¢„è®¾çš„ç›®æ ‡æ•°é‡ï¼Œå°±å¯ä»¥åˆ©ç”¨ readAll() å‡½æ•°å°†æ•°æ®è¯»å–åˆ°ä¸€ä¸ª QByteArray ç±»å‹çš„å˜é‡ä¸­ã€‚ è¯»å–æ“ä½œçš„ç‰¹ç‚¹ï¼š ä¸²å£æ¯æ¬¡è¯»å– 8 å­—èŠ‚çš„æ•°æ®ï¼Œå¦‚æœç¼“å†²åŒºä¸­å‰©ä½™çš„æ•°æ®å°‘äº 8 å­—èŠ‚ï¼Œåˆ™è¯»å–çš„å°äº 8 å­—èŠ‚çš„æ•°æ®ã€‚ äº‹ä»¶é©±åŠ¨æ–¹å¼åœ¨äº‹ä»¶é©±åŠ¨æ¨¡å¼ä¸‹ï¼Œå½“ä¸²å£æ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œä¸²å£çš„å®ä¾‹åŒ–å¯¹è±¡ä¼šå‘å‡º readyRead ä¿¡å·ã€‚å¯ä»¥å…³è”æ­¤ä¿¡å·åˆ°ç›¸åº”çš„æ•°æ®è¯»å–æ§½å‡½æ•°ï¼Œä»¥ä¾¿åœ¨æ•°æ®è¾¾åˆ°æ—¶ç«‹åˆ»è¿›è¡Œå¤„ç†ã€‚ä½¿ç”¨è¿™ä¸€æ¨¡å¼æ—¶ï¼Œè°ƒç”¨è¯»å†™å‡½æ•°ä¼šå¿«é€Ÿè¿”å›ã€‚ å…·ä½“ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š myCom-write(xxxxxx.toAscii()); åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒbytesToWrite å¯ä»¥ç”¨æ¥è·å–å°†è¦å‘é€çš„å­—èŠ‚æ•°ã€‚ä½†éœ€æ³¨æ„ï¼Œæ­¤å‡½æ•°ä¸é€‚ç”¨äºè½®è¯¢æ¨¡å¼ã€‚ ä¸²å£æ“ä½œæ­¥éª¤ä»¥ä¸‹æ˜¯æ‰“å¼€ä¸²å£å¹¶è®¾ç½®ç›¸å…³å‚æ•°çš„åŸºæœ¬æ­¥éª¤ï¼š å®šä¹‰ä¸²å£å¯¹è±¡ï¼šæŒ‡å®šä¸²å£ååŠæŸ¥è¯¢æ¨¡å¼ã€‚ æ‰“å¼€ä¸²å£ï¼šå¯ä»¥é€‰æ‹©åªè¯»ï¼ˆQIODevice::ReadOnlyï¼‰ã€åªå†™ï¼ˆQIODevice::WriteOnlyï¼‰æˆ–è¯»å†™ï¼ˆQIODevice::ReadWriteï¼‰ã€‚ è®¾ç½®ä¸²å£å‚æ•°ï¼š æ³¢ç‰¹ç‡ï¼šå¯ä»¥è®¾ç½®ä¸º 9600 ç­‰å…¶ä»–å€¼ã€‚ æ•°æ®ä½ï¼šé€šå¸¸è®¾ç½®ä¸º 8 ä½ï¼ŒQt5 ä¸­é»˜è®¤ä¸º 8 ä½ã€‚ å¥‡å¶æ ¡éªŒï¼šå¯ä»¥è®¾ç½®ä¸ºæ— ï¼ˆPAR_NONEï¼‰ï¼ŒQt5 ä¸­é»˜è®¤ä¸ºæ— æ ¡éªŒã€‚ åœæ­¢ä½ï¼šä¸€èˆ¬è®¾ç½®ä¸º 1 ä½ï¼ˆSTOP_1ï¼‰ï¼ŒQt5 ä¸­é»˜è®¤ä¸º 1 ä½åœæ­¢ä½ã€‚ æ•°æ®æµæ§åˆ¶ï¼šå¦‚ä¸éœ€è¦ï¼Œåˆ™è®¾ç½®ä¸ºæ— ï¼ˆFLOW_OFFï¼‰ï¼ŒQt5 ä¸­é»˜è®¤ä¸ºæ— æ•°æ®æµæ§åˆ¶ã€‚ è®¾ç½®å»¶æ—¶ï¼šæ§åˆ¶ä¸²å£çš„è¯»å†™æ—¶é—´ï¼Œä¸è¿‡åœ¨ä½¿ç”¨ readyRead ä¿¡å·æ—¶ï¼Œè¿™ä¸ªæ—¶é—´è®¾ç½®ä¸ä¼šç”Ÿæ•ˆã€‚ ä»¥ä¸‹æ˜¯å®é™…çš„ä»£ç ç¤ºä¾‹ï¼š myCom - open(QIODevice::ReadWrite);// ä»¥è¯»å†™æ–¹å¼æ‰“å¼€ä¸²å£myCom - setBaudRate(BAUD9600);// è®¾ç½®æ³¢ç‰¹ç‡ä¸º9600myCom - setDataBits(DATA_8);// è®¾ç½®æ•°æ®ä½ä¸º8ä½myCom - setParity(PAR_NONE);// è®¾ç½®å¥‡å¶æ ¡éªŒä¸ºæ— myCom - setStopBits(STOP_1);// è®¾ç½®åœæ­¢ä½ä¸º1ä½myCom - setFlowControl(FLOW_OFF);// è®¾ç½®æ•°æ®æµæ§åˆ¶ä¸ºæ—  æ³¨æ„äº‹é¡¹ï¼šåœ¨ Qt4 ä¸­ï¼Œä¸²å£å‚æ•°çš„è®¾ç½®æ˜¯åœ¨æ‰“å¼€ä¸²å£ä¹‹åè¿›è¡Œçš„ï¼Œè€Œåœ¨ Qt5 ä¸­ï¼Œè®¾ç½®å‚æ•°åº”åœ¨æ‰“å¼€ä¸²å£ä¹‹å‰è¿›è¡Œã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ä¸²å£çš„é…ç½®åœ¨å®é™…ä½¿ç”¨å‰æ˜¯æ­£ç¡®çš„ã€‚ åŸºäº Qt5 è‡ªå¸¦ä¸²å£ç±»åœ¨ Qt å·¥ç¨‹æ–‡ä»¶ pro ä¸­æ·»åŠ  QT += serialport åŒæ­¥è¯»å– å®ä¾‹åŒ–å’Œé…ç½®ä¸²å£é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª QSerialPort å¯¹è±¡ï¼Œå¹¶é€šè¿‡ setPortName å‡½æ•°æŒ‡å®šè¦æ‰“å¼€çš„ä¸²å£åç§°ã€‚æ¥ç€ï¼Œé€šè¿‡ setBaudRate å‡½æ•°è®¾ç½®ä¸²å£çš„æ³¢ç‰¹ç‡ï¼Œæ¯”å¦‚ 9600 æ³¢ç‰¹ã€‚æœ€åï¼Œé€šè¿‡ open å‡½æ•°æ‰“å¼€ä¸²å£ï¼Œè¿™é‡Œå¯ä»¥é€‰æ‹©åªè¯»æˆ–è¯»å†™æ–¹å¼ã€‚ä»£ç å¦‚ä¸‹ï¼š QSerialPort serialPort;QString serialPortName = COM6; // æŒ‡å®šä¸²å£åç§°int serialPortBaudRate = QSerialPort::Baud9600; // è®¾ç½®æ³¢ç‰¹ç‡ä¸º9600serialPort.setPortName(serialPortName);serialPort.setBaudRate(serialPortBaudRate);if (!serialPort.open(QIODevice::ReadOnly)) return 1; // å¦‚æœæ‰“å¼€å¤±è´¥ï¼Œè¿”å›é”™è¯¯ä»£ç  æ•°æ®è¯»å–æ“ä½œæ‰“å¼€æˆåŠŸåï¼Œå¯ä»¥ä½¿ç”¨ readAll() å’Œ waitForReadyRead() å‡½æ•°è¿›è¡Œæ•°æ®è¯»å–ã€‚é¦–å…ˆï¼Œä»ä¸²å£è¯»å–æ‰€æœ‰å¯ç”¨çš„æ•°æ®ï¼Œç„¶ååˆ©ç”¨ waitForReadyRead(5000) ç­‰å¾…æœ€å¤š 5 ç§’ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ–°æ•°æ®åˆ°è¾¾ã€‚å¦‚æœæ•°æ®åˆ°è¾¾ï¼Œå°†å…¶è¿½åŠ åˆ°è¯»å–ç¼“å†²åŒºã€‚éœ€è¦æ³¨æ„ï¼ŒreadAll() ç»“æŸæ—¶å¹¶ä¸èƒ½åŒºåˆ†è¯»å–å¤±è´¥æˆ–è¶…æ—¶ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ error() å‡½æ•°åˆ¤æ–­å…·ä½“é”™è¯¯ç±»å‹ã€‚ QByteArray readData = serialPort.readAll();while (serialPort.waitForReadyRead(5000)) // ç­‰å¾…æ–°æ•°æ®åˆ°è¾¾ readData.append(serialPort.readAll());// ä½¿ç”¨error()åˆ¤æ–­é”™è¯¯ç±»å‹if (serialPort.error() == QSerialPort::ReadError) standardOutput QObject::tr(Failed to read from port %1, error: %2) .arg(serialPortName) .arg(serialPort.errorString()) endl; else if (serialPort.error() == QSerialPort::TimeoutError readData.isEmpty()) standardOutput QObject::tr(No data was currently available for reading from port %1) .arg(serialPortName) endl; else standardOutput QObject::tr(Data successfully received from port %1) .arg(serialPortName) endl; standardOutput readData endl; // æ‰“å°æ¥æ”¶åˆ°çš„æ•°æ® å¼‚æ­¥è¯»å–ä¸ Qt4 çš„ Qextserialport ç±»ä¸åŒï¼ŒQt5 çš„ QSerialPort æä¾›ä¿¡å·æœºåˆ¶ï¼Œå½“ä¸²å£æ¥æ”¶åˆ°æ•°æ®æ—¶ä¼šå‘å‡º readyRead ä¿¡å·ï¼Œå‘ç”Ÿé”™è¯¯æ—¶ä¼šå‘é€ error ä¿¡å·ã€‚é¦–å…ˆï¼Œå®ä¾‹åŒ–å¹¶æ‰“å¼€ä¸²å£ï¼Œæ¥ç€å¯åŠ¨å®šæ—¶å™¨è¿›è¡Œç›‘æµ‹ï¼Œæˆ–è€…ç›´æ¥æ‰“å°æ¥æ”¶åˆ°çš„æ•°æ®ã€‚è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª SerialPortReader ç±»ï¼Œå…¶æ„é€ å‡½æ•°æ¥æ”¶ QSerialPort å‚æ•°ã€‚ connect(m_serialPort, SIGNAL(readyRead()), SLOT(handleReadyRead()));connect(m_serialPort, SIGNAL(error(QSerialPort::SerialPortError)), SLOT(handleError(QSerialPort::SerialPortError)));connect(m_timer, SIGNAL(timeout()), SLOT(handleTimeout())); å¤„ç†æ•°æ®æ¥æ”¶å½“æ¥æ”¶åˆ° readyRead ä¿¡å·æ—¶ï¼Œæ‰§è¡Œ handleReadyRead å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†è¯»å–ç¼“å†²åŒºçš„æ•°æ®å­˜å‚¨åœ¨ m_readData ä¸­ã€‚å¦‚æœå®šæ—¶å™¨æœªæ¿€æ´»ï¼Œåˆ™å¯åŠ¨å®šæ—¶å™¨ã€‚ void SerialPortReader::handleReadyRead() m_readData.append(m_serialPort-readAll()); if (!m_timer.isActive()) m_timer.start(5000); // å¯åŠ¨å®šæ—¶å™¨ æ‰“å°æ•°æ®å¦‚æœå®šæ—¶å™¨è¶…æ—¶ï¼Œè°ƒç”¨ handleTimeout å‡½æ•°ã€‚å¦‚æœ m_readData ä¸ºç©ºï¼Œè¡¨æ˜æ²¡æœ‰å¯è¯»æ•°æ®ï¼›å¦åˆ™ï¼Œæ‰“å°æˆåŠŸæ¥æ”¶åˆ°çš„æ•°æ®ã€‚ void SerialPortReader::handleTimeout() if (m_readData.isEmpty()) m_standardOutput QObject::tr(No data was currently available for reading from port %1) .arg(m_serialPort-portName()) endl; else m_standardOutput QObject::tr(Data successfully received from port %1) .arg(m_serialPort-portName()) endl; m_standardOutput m_readData endl; // æ‰“å°æ¥æ”¶åˆ°çš„æ•°æ® m_readData.clear(); // æ¸…ç©ºè¯»å–æ•°æ®ç¼“å†²åŒº å¤„ç†é”™è¯¯å¦‚æœä¸²å£å‘å‡ºäº† error ä¿¡å·ï¼Œè¡¨ç¤ºå‘ç”Ÿé”™è¯¯ï¼Œæ‰§è¡Œ handleError å‡½æ•°ä»¥æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚ void SerialPortReader::handleError(QSerialPort::SerialPortError serialPortError) if (serialPortError == QSerialPort::ReadError) m_standardOutput QObject::tr(An I/O error occurred while reading the data from port %1, error: %2) .arg(m_serialPort-portName()) .arg(m_serialPort-errorString()) endl; QCoreApplication::exit(1); // é€€å‡ºç¨‹åº åŒæ­¥å‘é€åœ¨å°†ä¸²å£ä»¥åªå†™æ–¹å¼æ‰“å¼€åï¼Œåˆ›å»ºè¦å‘é€çš„æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º QByteArray ç±»å‹ã€‚ QByteArray writeData = QString(hello).toLatin1(); // å‡†å¤‡è¦å‘é€çš„æ•°æ® åœ¨å‘é€æ•°æ®ä¹‹å‰ï¼Œåˆ¤æ–­æ•°æ®æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸ºç©ºï¼Œåˆ™ä¸è¿›è¡Œå‘é€å¹¶è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼š if (writeData.isEmpty()) standardOutput QObject::tr(Either no data was currently available on the standard input for reading, or an error occurred for port %1, error: %2) .arg(serialPortName) .arg(serialPort.errorString()) endl; return 1; // è¿”å›é”™è¯¯ä»£ç  å¦‚æœä¸ä¸ºç©ºï¼Œä½¿ç”¨ write å‡½æ•°è¿›è¡Œå‘é€å¹¶æ£€æŸ¥æ˜¯å¦æˆåŠŸå‘é€ã€‚ qint64 bytesWritten = serialPort.write(writeData); // å‘é€æ•°æ®if (bytesWritten == -1) standardOutput QObject::tr(Failed to write the data to port %1, error: %2) .arg(serialPortName) .arg(serialPort.errorString()) endl; return 1; // è¿”å›é”™è¯¯ä»£ç  else if (bytesWritten != writeData.size()) standardOutput QObject::tr(Failed to write all the data to port %1, error: %2) .arg(serialPortName) .arg(serialPort.errorString()) endl; return 1; // è¿”å›é”™è¯¯ä»£ç  else if (!serialPort.waitForBytesWritten(5000)) standardOutput QObject::tr(Operation timed out or an error occurred for port %1, error: %2) .arg(serialPortName) .arg(serialPort.errorString()) endl; return 1; // è¿”å›é”™è¯¯ä»£ç standardOutput QObject::tr(Data successfully sent to port %1).arg(serialPortName) endl; å¼‚æ­¥å‘é€é¦–å…ˆï¼Œå®ä¾‹åŒ–å¹¶æ‰“å¼€è¦ä½¿ç”¨çš„ä¸²å£ï¼Œä¹‹åå¯åŠ¨ä¸€ä¸ªå•æ¬¡è§¦å‘çš„å®šæ—¶å™¨ï¼Œè¶…æ—¶åå°†æ•°æ®å‘é€å‡ºå»ã€‚è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª SerialPortWriter ç±»ï¼Œæ„é€ å‡½æ•°å¸¦æœ‰ QSerialPort å‚æ•°ï¼Œå¹¶æä¾›å…¬å…±æ–¹æ³•ç»™ SerialPortWriter å¯¹è±¡è°ƒç”¨ï¼Œå‚æ•°ä¸ºè¦å‘é€çš„ QByteArray ç±»å‹æ•°æ®ã€‚ SerialPortWriter::SerialPortWriter(QSerialPort *serialPort, QObject *parent) : QObject(parent), m_serialPort(serialPort), m_standardOutput(stdout), m_bytesWritten(0) m_timer.setSingleShot(true); connect(m_serialPort, SIGNAL(bytesWritten(qint64)), SLOT(handleBytesWritten(qint64))); connect(m_serialPort, SIGNAL(error(QSerialPort::SerialPortError)), SLOT(handleError(QSerialPort::SerialPortError))); connect(m_timer, SIGNAL(timeout()), SLOT(handleTimeout())); å¤„ç†å‘é€ç»“æœåœ¨ handleBytesWritten å‡½æ•°ä¸­ï¼Œåˆ¤æ–­å®é™…å‘é€çš„å­—èŠ‚æ•°ä¸åŸå§‹å­—èŠ‚æ•°æ˜¯å¦ä¸€è‡´ã€‚å¦‚æœä¸€è‡´ï¼Œåˆ™æ‰“å°å‘é€æˆåŠŸçš„ä¿¡æ¯å¹¶é€€å‡ºç¨‹åºã€‚ void SerialPortWriter::handleBytesWritten(qint64 bytes) m_bytesWritten += bytes; if (m_bytesWritten == m_writeData.size()) m_bytesWritten = 0; m_standardOutput QObject::tr(Data successfully sent to port %1).arg(m_serialPort-portName()) endl; QCoreApplication::quit(); // é€€å‡ºç¨‹åº å¤„ç†è¶…æ—¶å’Œé”™è¯¯å¦‚æœåœ¨ 5 ç§’å†…æœªæ”¶åˆ° bytesWritten ä¿¡å·ï¼Œåˆ™è®¤ä¸ºå‘é€è¶…æ—¶ï¼Œè°ƒç”¨ handleTimeout å‡½æ•°è¾“å‡ºè¶…æ—¶ä¿¡æ¯å¹¶é€€å‡ºç¨‹åºã€‚ void SerialPortWriter::handleTimeout() m_standardOutput QObject::tr(Operation timed out for port %1, error: %2) .arg(m_serialPort-portName()) .arg(m_serialPort-errorString()) endl; QCoreApplication::exit(1); // é€€å‡ºç¨‹åº å¤„ç†å‘é€è¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯ä¿¡æ¯ã€‚ void SerialPortWriter::handleError(QSerialPort::SerialPortError serialPortError) if (serialPortError == QSerialPort::WriteError) m_standardOutput QObject::tr(An I/O error occurred while writing the data to port %1, error: %2) .arg(m_serialPort-portName()) .arg(m_serialPort-errorString()) endl; QCoreApplication::exit(1); // é€€å‡ºç¨‹åº å‘é€æ•°æ®å°†æ•°æ®å‘é€å¹¶åˆ¤æ–­å‘é€çš„å­—èŠ‚æ•°é‡ï¼Œå¹¶åœ¨æ¥ä¸‹æ¥çš„ 5 ç§’å†…å¯åŠ¨å®šæ—¶å™¨ï¼Œæ£€æµ‹æ•°æ®å‘é€åçš„ bytesWritten ä¿¡å·ã€‚ void SerialPortWriter::write(const QByteArray writeData) m_writeData = writeData; qint64 bytesWritten = m_serialPort-write(writeData); if (bytesWritten == -1) m_standardOutput QObject::tr(Failed to write the data to port %1, error: %2) .arg(m_serialPort-portName()) .arg(m_serialPort-errorString()) endl; QCoreApplication::exit(1); // é€€å‡ºç¨‹åº else if (bytesWritten != m_writeData.size()) m_standardOutput QObject::tr(Failed to write all the data to port %1, error: %2) .arg(m_serialPort-portName()) .arg(m_serialPort-errorString()) endl; QCoreApplication::exit(1); // é€€å‡ºç¨‹åº m_timer.start(5000); // å¯åŠ¨å®šæ—¶å™¨","categories":["4.é€šè®¯åè®®","ä¸²å£"]},{"title":"RS232","path":"/2023/11/30/4-é€šè®¯åè®®-ä¸²å£-RS232/","content":"RS232 ä¸ RS485 ä¿¡å·ç±»å‹ RS232 æ˜¯ä¸€ç§ä½¿ç”¨å…±æ¨¡ä¿¡å·çš„ä¸²è¡Œé€šä¿¡æ ‡å‡†ï¼Œé€‚ç”¨äºçŸ­è·ç¦»æ•°æ®ä¼ è¾“ï¼Œå¸¸è§äºä¸ªäººç”µè„‘ä¸è°ƒåˆ¶è§£è°ƒå™¨ä¹‹é—´çš„è¿æ¥ã€‚ RS485 åˆ™é‡‡ç”¨å·®æ¨¡ä¿¡å·ï¼Œé€‚åˆé•¿è·ç¦»é€šä¿¡ï¼Œå¸¸ç”¨äºå·¥ä¸šè‡ªåŠ¨åŒ–ç³»ç»Ÿä¸­çš„è®¾å¤‡é—´é€šä¿¡ï¼Œå…·æœ‰æ›´å¼ºçš„æŠ—å¹²æ‰°èƒ½åŠ›ã€‚ DB9 å’Œ DB25 å¼•è„šå®šä¹‰ æµç¨‹æ‰“å¼€è®¾å¤‡èŠ‚ç‚¹æ‰“å¼€ç‰¹å®šçš„è®¾å¤‡èŠ‚ç‚¹æ˜¯è¿›è¡Œä¸²å£é€šä¿¡çš„ç¬¬ä¸€æ­¥ï¼Œå¯ä»¥ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ open æ¥å®ç°ã€‚ä¾‹å¦‚ï¼š int iFd = open(DEV_NAME, O_RDWR | O_NOCTTY); O_RDWR è¡¨ç¤ºä»¥è¯»å†™æ¨¡å¼æ‰“å¼€è®¾å¤‡ã€‚ O_NOCTTY è¡¨ç¤ºæ‰“å¼€è¯¥è®¾å¤‡æ—¶ä¸æŠŠå®ƒä½œä¸ºæ§åˆ¶ç»ˆç«¯ã€‚ é‡åˆ°æ‰“å¼€å¤±è´¥çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ perror æ¥æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚ è®¾ç½®ä¸²å£é…ç½®å±æ€§ä¸²å£è®¾å¤‡çš„é…ç½®åŒ…æ‹¬æ³¢ç‰¹ç‡ã€æ•°æ®ä½ã€æ ¡éªŒæ–¹å¼ç­‰ï¼Œå¯ä»¥é€šè¿‡ struct termios æ¥ç®¡ç†è¿™äº›è®¾ç½®ã€‚é…ç½®æ“ä½œé€šå¸¸åŒ…æ‹¬ï¼š è·å–å½“å‰å±æ€§ä½¿ç”¨ tcgetattr è·å–å½“å‰ä¸²å£çš„é…ç½®ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚ è®¾ç½®æ³¢ç‰¹ç‡æ³¢ç‰¹ç‡å†³å®šäº†æ•°æ®ä¼ è¾“é€Ÿç‡ï¼Œé€šè¿‡ cfsetispeed å’Œ cfsetospeed è®¾ç½®è¾“å…¥å’Œè¾“å‡ºçš„æ³¢ç‰¹ç‡ï¼Œä¾‹å¦‚ï¼š cfsetispeed(opt, B115200);cfsetospeed(opt, B115200); è¿™é‡Œè®¾ç½®ä¸º 115200 æ³¢ç‰¹ç‡ï¼Œé€‚åˆå¤§å¤šæ•°é«˜é€Ÿè®¾å¤‡ã€‚ è®¾ç½®æ•°æ®ä½æ•°æ®ä½é€šå¸¸è®¾ç½®ä¸º 8 ä½ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹é…ç½®å®ç°ï¼š opt.c_cflag |= CS8; è®¾ç½®å¥‡å¶æ ¡éªŒä½å°†æ ¡éªŒä½è®¾ç½®ä¸ºæ— ï¼Œä»¥ç¡®ä¿æ•°æ®ä¼ è¾“çš„ç®€å•æ€§ã€‚é€šè¿‡ä½æ“ä½œå¯ä»¥æ–¹ä¾¿åœ°ä¿®æ”¹ç›¸åº”æ ‡å¿—ä½ã€‚ è®¾ç½®æ§åˆ¶æ ‡å¿— **æœ¬åœ°æ ‡å¿— c_lflag**ï¼šé€šè¿‡æŒ‰ä½ä¸æ“ä½œç§»é™¤æŸäº›æ ‡å¿—ï¼Œä¾‹å¦‚ç¦æ­¢å›æ˜¾ã€‚ **è¾“å…¥æ ‡å¿— c_iflag**ï¼šé€šè¿‡æŒ‰ä½ä¸æ“ä½œç§»é™¤ä¸€äº›è¾“å…¥å¤„ç†è®¾ç½®ã€‚ **è¾“å‡ºæ ‡å¿— c_oflag**ï¼šåŒæ ·é€šè¿‡æŒ‰ä½ä¸æ“ä½œæ¥æ¸…é™¤ä¸å¿…è¦çš„è¾“å‡ºå¤„ç†ã€‚ æ§åˆ¶å­—ç¬¦ç»„ c_ccè®¾ç½®æœ€å°å¯è¯»å­—ç¬¦æ•°å’Œè¶…æ—¶æ—¶é—´ï¼Œä¾‹å¦‚ï¼š opt.c_cc[VMIN] = 255; // æ¯æ¬¡è¯»å–è‡³å°‘ 255 ä¸ªå­—ç¬¦opt.c_cc[VTIME] = 150; // è¶…æ—¶è®¾ç½® æ›´æ–°å’Œåˆ·æ–°ä¸²å£è®¾ç½®åœ¨å®Œæˆé…ç½®åï¼Œå¯ä½¿ç”¨ tcsetattr æ›´æ–°è®¾ç½®ï¼Œè¡¨ç¤ºå½“å‰çš„é…ç½®ç«‹å³ç”Ÿæ•ˆï¼š if (tcsetattr(iFd, TCSANOW, opt) 0) return -1; è°ƒç”¨ tcflush å¯æ¸…ç©ºä¸²å£ç¼“å†²åŒºï¼Œç¡®ä¿å‘é€å’Œæ¥æ”¶æ•°æ®ä¸å—å¹²æ‰°ã€‚ æ•°æ®æ”¶å‘çš„ç¤ºä¾‹ä»£ç ä¸‹é¢çš„å®ä¾‹æ¼”ç¤ºäº†å¦‚ä½•å‘é€å’Œæ¥æ”¶æ•°æ®ï¼š unsigned char ucBuf[1000];for (int i = 0; i 1000; i++) ucBuf[i] = 0xff - i; // å¡«å……æ•°æ®write(iFd, ucBuf, 0xff); // å‘é€æ•°æ®int len = read(iFd, ucBuf, 0xff); // æ¥æ”¶æ•°æ®printf(get data: %d , len);for (int i = 0; i len; i++) printf( %x, ucBuf[i]); // ä»¥åå…­è¿›åˆ¶æ–¹å¼æ‰“å°æ¥æ”¶åˆ°çš„æ•°æ® é€šè¿‡ write å‡½æ•°å‘ä¸²å£å‘é€æ•°æ®ï¼Œä½¿ç”¨ read å‡½æ•°æ¥æ”¶è¿”å›çš„æ•°æ®ï¼Œéšåæ‰“å°å‡ºæ•°æ®çš„å­—èŠ‚æ•°å’Œå…·ä½“å†…å®¹ã€‚ å…³é—­è®¾å¤‡åœ¨å®Œæˆæ•°æ®æ”¶å‘åï¼Œåº”ä½¿ç”¨ close å…³é—­å·²æ‰“å¼€çš„ä¸²å£è®¾å¤‡ä»¥é‡Šæ”¾èµ„æºï¼š close(iFd); é€šè¿‡è¿™äº›æ­¥éª¤ï¼Œå¯åœ¨æ“ä½œç³»ç»Ÿä¸­æœ‰æ•ˆåœ°ç®¡ç†ä¸²å£é€šä¿¡ï¼Œè¿›è¡Œæ•°æ®çš„å‘é€å’Œæ¥æ”¶ã€‚ ä»£ç #include stdio.h#include stdlib.h#include unistd.h#include sys/types.h#include sys/stat.h#include fcntl.h#include termios.h#include errno.h#include limits.h#define DEV_NAME /dev/ttyO1int main(void)\tint iFd, i;\tint len;\tunsigned char ucBuf[1000];\tstruct termios opt; iFd = open(DEV_NAME, O_RDWR | O_NOCTTY);\tif(iFd 0) perror(DEV_NAME); return -1; if (tcgetattr(iFd, opt)0) return -1; opt.c_lflag = ~(ECHO | ICANON | IEXTEN | ISIG);\topt.c_iflag = ~(BRKINT | ICRNL | INPCK | ISTRIP | IXON);\topt.c_oflag = ~(OPOST);\topt.c_cflag = ~(CSIZE | PARENB);\topt.c_cflag |= CS8;\topt.c_cc[VMIN] = 255;\topt.c_cc[VTIME] = 150;\tcfsetispeed(opt, B115200);\tcfsetospeed(opt, B115200); if (tcsetattr(iFd, TCSANOW, opt)0) return -1; tcflush(iFd,TCIOFLUSH);\tfor (i = 0; i 1000; i++) ucBuf[i] = 0xff - i; write(iFd, ucBuf, 0xff);\tlen = read(iFd, ucBuf, 0xff);\tprintf(get date: %d , len);\tfor (i = 0; i len; i++) printf( %x, ucBuf[i]); printf( );\tclose(iFd);\treturn 0;","categories":["4.é€šè®¯åè®®","ä¸²å£"]},{"title":"UART","path":"/2023/11/29/4-é€šè®¯åè®®-ä¸²å£-UART/","content":"UART åè®®æ¦‚è¿°UARTï¼ˆé€šç”¨å¼‚æ­¥æ”¶å‘å™¨ï¼‰æ˜¯ä¸€ç§å¹¿æ³›åº”ç”¨äºè®¾å¤‡é—´é€šä¿¡çš„å¼‚æ­¥ä¸²è¡Œé€šä¿¡åè®®ã€‚å®ƒé€šè¿‡ä¸²è¡Œæ–¹å¼é€ä½ä¼ è¾“æ•°æ®ï¼Œé€šå¸¸ç”¨äºè¿æ¥è®¡ç®—æœºä¸å„ç§å¤–éƒ¨è®¾å¤‡ï¼Œå¦‚è°ƒåˆ¶è§£è°ƒå™¨ã€ä¼ æ„Ÿå™¨å’Œå¾®æ§åˆ¶å™¨ç­‰ã€‚UART å…·æœ‰å…¨åŒå·¥é€šä¿¡èƒ½åŠ›ï¼Œæ„å‘³ç€æ•°æ®å¯ä»¥åŒæ—¶åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šä¼ è¾“ã€‚ åŒæ­¥ä¸²å£ USRTåŒæ­¥ä¸²å£é€šè¿‡ä¸“é—¨çš„æ—¶é’Ÿä¿¡å·çº¿æ¥å®ç°æ•°æ®ä¼ è¾“çš„åŒæ­¥ã€‚å‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¾èµ–äºæ—¶é’Ÿä¿¡å·å°†æ•°æ®æµè½¬æ¢ä¸ºç”µå¹³ä¿¡å·ã€‚è¿™ç§æ–¹å¼é€‚åˆéœ€è¦é«˜æ•°æ®ä¼ è¾“é€Ÿç‡å’Œç²¾ç¡®æ—¶åºçš„åº”ç”¨åœºæ™¯ã€‚ å¼‚æ­¥ä¸²å£ UARTå¼‚æ­¥ä¸²å£åˆ™ä¸ä½¿ç”¨å…±äº«æ—¶é’Ÿä¿¡å·ã€‚å®šä½ä¿¡æ¯åŒ…å«åœ¨ç”µå¹³åºåˆ—ä¸­ï¼Œé€šä¿¡åŒæ–¹éœ€äº‹å…ˆçº¦å®šæ•°æ®å¸§çš„æ ¼å¼ï¼ŒåŒ…æ‹¬æ³¢ç‰¹ç‡ã€æ•°æ®ä½ã€åœæ­¢ä½å’Œå¥‡å¶æ ¡éªŒç­‰ã€‚çº¿è·¯ç©ºé—²æ—¶ï¼Œç”µå¹³ä¸ºé«˜ï¼Œä¸€æ—¦æ£€æµ‹åˆ°ä¸‹é™æ²¿ï¼Œåˆ™è§†ä¸ºèµ·å§‹ä½ã€‚æ¥æ”¶æ–¹æ ¹æ®çº¦å®šæ ¼å¼æ¥æ”¶æ•°æ®å¸§ï¼Œå¹¶ç»§ç»­æ£€æµ‹ä¸‹ä¸€ä¸ªèµ·å§‹ä½ã€‚å¼‚æ­¥ä¸²å£çš„åŒæ­¥æ˜¯ä»¥å¸§ä¸ºå•ä½çš„ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ä½é€Ÿé€šä¿¡åœºæ™¯ã€‚ UART çš„å·¥ä½œç‰¹ç‚¹æ•°æ®é‡‡æ ·UART åè®®æ˜¯ä¸€ç§ä½é€Ÿæ•°æ®é€šä¿¡æ ‡å‡†ï¼Œå…¸å‹æ³¢ç‰¹ç‡ä¸º 115200 æˆ– 9600ã€‚UART å­—ç¬¦æ ¼å¼é€šå¸¸åŒ…å« 1 ä¸ªèµ·å§‹ä½ã€5~8 ä¸ªæ•°æ®ä½ã€1 ä¸ªå¯é€‰çš„å¥‡å¶ä½å’Œ 1 ä¸ªåœæ­¢ä½ã€‚ç”±äºæ¥æ”¶å™¨å’Œå‘é€å™¨å¼‚æ­¥å·¥ä½œï¼Œæ¥æ”¶å™¨é€šå¸¸é‡‡ç”¨å¯¹è¾“å…¥æ•°æ®æµçš„é«˜åº¦é‡‡æ ·æ–¹å¼ï¼Œé€šå¸¸ä¸º 16 æ¬¡é‡‡æ ·ï¼Œä»¥ç¡®ä¿æ•°æ®çš„å‡†ç¡®æ€§ã€‚ UART å¸§åŒºåˆ†åœ¨ UART ä¸­ï¼ŒMAX-IDL å‚æ•°ç”¨äºè®¾ç½®ç©ºé—²å­—ç¬¦çš„æ•°é‡ã€‚UART æ§åˆ¶å™¨ä¼šå¼€å§‹è®¡æ•°æ¥æ”¶åˆ°çš„ç©ºé—²å­—ç¬¦ã€‚å¦‚æœåœ¨æ¥æ”¶ä¸‹ä¸€æ•°æ®å­—ç¬¦ä¹‹å‰ï¼Œæ¥æ”¶åˆ°çš„ç©ºé—²å­—ç¬¦æ•°é‡è¶…è¿‡ MAX-IDLï¼Œåˆ™ä¼šäº§ç”Ÿç©ºé—²æ—¶é—´ï¼Œç¼“å†²åŒºè¢«å…³é—­ï¼Œå¹¶å‘ CPU å‘å‡ºä¸­æ–­è¯·æ±‚ã€‚è¿™ç§æœºåˆ¶æœ‰åŠ©äºåŒºåˆ†ä¸åŒçš„æ•°æ®å¸§ã€‚ ç©ºé—²å­—ç¬¦çš„ä½æ•°è®¡ç®—å…¬å¼ä¸ºï¼š1ï¼ˆèµ·å§‹ä½ï¼‰+ æ•°æ®é•¿åº¦ï¼ˆ5ã€6ã€7ã€8ï¼‰+ 1ï¼ˆè‹¥ä½¿ç”¨å¥‡å¶æ ¡éªŒï¼‰+ åœæ­¢ä½ï¼ˆ1ï¼‰ã€‚ä¾‹å¦‚ï¼Œ1 ä¸ªèµ·å§‹ä½ï¼Œ8 ä½æ•°æ®ï¼Œæ— æ ¡éªŒï¼Œ1 ä¸ªåœæ­¢ä½ï¼Œåˆ™ç©ºé—²å­—ç¬¦ MAX-IDL ä¸º 10 ä½ã€‚ UART åœ°å€è¯†åˆ«åœ¨å¤šç«™ç³»ç»Ÿä¸­ï¼Œå¯èƒ½å­˜åœ¨å¤šä¸ªè®¾å¤‡ï¼Œæ¯ä¸ªè®¾å¤‡éƒ½æœ‰ç‰¹å®šçš„åœ°å€ã€‚UART å¸§å¯ä»¥æ‰©å±•ä¸€ä½ï¼Œä»¥åŒºåˆ«åœ°å€å­—ç¬¦å’Œæ­£å¸¸æ•°æ®å­—ç¬¦ã€‚UART æ”¯æŒä¸¤ç§æ“ä½œæ¨¡å¼ï¼š è‡ªåŠ¨å¤šç«™æ¨¡å¼ï¼šå½“åœ°å€ä¸é¢„ç½®å€¼åŒ¹é…æ—¶ï¼ŒUART æ§åˆ¶å™¨è‡ªåŠ¨æ¥æ”¶éšåçš„æ•°æ®ã€‚ éè‡ªåŠ¨å¤šç«™æ¨¡å¼ï¼šUART æ§åˆ¶å™¨æ¥æ”¶æ‰€æœ‰æ•°æ®ï¼Œåœ°å€å­—ç¬¦è¢«å†™å…¥æ–°çš„ç¼“å†²åŒºã€‚ ç»¼ä¸Šæ‰€è¿°ï¼ŒUART åè®®é€šè¿‡æ•°æ®é‡‡æ ·æ¥ç¡®å®šä½å€¼ï¼Œå…·æœ‰ç®€å•å‡†ç¡®çš„å®šå¸§æ¨¡å¼ï¼Œå¹¶å¹¿æ³›ç”¨äºå¤šç«™ç³»ç»Ÿä¸­ï¼Œæ”¯æŒè‡ªåŠ¨å¤šç«™å’Œéè‡ªåŠ¨å¤šç«™ä¸¤ç§æ¨¡å¼ï¼Œä»¥åŒºåˆ†åœ°å€å’Œæ•°æ®ã€‚ å‡ ç§é‡è¦å¯„å­˜å™¨åœ¨ UART çš„å·¥ä½œä¸­ï¼Œå¯¹å¯„å­˜å™¨çš„ç†è§£å’Œæ­£ç¡®é…ç½®è‡³å…³é‡è¦ã€‚ä»¥ä¸‹æ˜¯ MPC860 çš„ä¸€äº›é‡è¦å¯„å­˜å™¨ï¼š ç®¡è„šé…ç½®å¯„å­˜å™¨ï¼šç”¨äºè®¾ç½®æ”¶å‘ç®¡è„šçš„åŠŸèƒ½ã€‚ æ³¢ç‰¹ç‡é…ç½®å¯„å­˜å™¨ï¼šè´Ÿè´£é…ç½®æ³¢ç‰¹ç‡ã€‚ é€šä¿¡å¤„ç†å‘½ä»¤å¯„å­˜å™¨ï¼šç”¨äºå‘å‡ºå’Œé˜»æ­¢å‘½ä»¤çš„åˆ¤æ–­ã€‚ SCC é€šç”¨æ¨¡å¼å¯„å­˜å™¨ï¼šç”¨äºé€‰æ‹©åè®®å’Œé…ç½®ä¼ è¾“æ ¼å¼ã€‚ å‘é€å’Œæ¥æ”¶ç¼“å†²åŒºæè¿°å™¨ï¼šç”¨äºæ•°æ®çš„æ”¶å‘å’Œé”™è¯¯åˆ¤æ–­ã€‚ UART çš„ç‰¹å®šå‚æ•°ï¼šç”¨äºåˆå§‹åŒ– UARTã€‚ SCC åè®®ä¸“ç”¨æ¨¡å¼å¯„å­˜å™¨ï¼šç”¨äºè®¾ç½® UART çš„å¤šç«™æ¨¡å¼ã€‚ äº‹ä»¶å¯„å­˜å™¨ï¼šç”¨äºåˆ¤æ–­ä¸­æ–­ç±»å‹ã€‚ å±è”½å¯„å­˜å™¨ï¼šç”¨äºæ”¶å‘ä½¿èƒ½ã€‚ UART ä¸ RS-232 å’Œ COM å£UART æ˜¯å¼‚æ­¥ä¸²è¡Œé€šä¿¡çš„æ€»ç§°ï¼ŒåŒ…æ‹¬ RS-232ã€RS-499ã€RS-423ã€RS-422 å’Œ RS-485 ç­‰æ¥å£æ ‡å‡†ã€‚UART ä¸»è¦å®šä¹‰äº†é€šä¿¡å£çš„ç”µæ°”ç‰¹æ€§ã€ä¼ è¾“é€Ÿç‡ã€è¿æ¥ç‰¹æ€§å’Œæœºæ¢°ç‰¹æ€§ã€‚COM å£æ˜¯ PC ä¸Šçš„å¼‚æ­¥ä¸²è¡Œé€šä¿¡å£çš„ç®€ç§°ï¼Œé€šå¸¸åŸºäº RS-232 æ ‡å‡†ã€‚ åµŒå…¥å¼å¼€å‘ä¸­çš„ UART åº”ç”¨UART åè®®å¹¿æ³›åº”ç”¨äºåµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œæ”¯æŒ RS-232ã€RS-422ã€RS-485 ä¸²å£é€šä¿¡å’Œçº¢å¤–ï¼ˆIrDAï¼‰ç­‰ã€‚UART çš„å·¥ä½œåŸç†æ˜¯é€ä½ä¼ è¾“æ•°æ®ï¼ŒåŒ…å«ä»¥ä¸‹å‡ ä¸ªå…³é”®éƒ¨åˆ†ï¼š èµ·å§‹ä½ï¼šå‘é€é€»è¾‘â€0â€ä¿¡å·ï¼Œè¡¨ç¤ºæ•°æ®ä¼ è¾“å¼€å§‹ã€‚ æ•°æ®ä½ï¼šæ„æˆä¸€ä¸ªå­—ç¬¦çš„æ•°æ®ä½ï¼Œé€šå¸¸ä¸º 5 è‡³ 8 ä½ã€‚ å¥‡å¶æ ¡éªŒä½ï¼šç”¨äºæ ¡éªŒæ•°æ®ä¼ è¾“çš„æ­£ç¡®æ€§ã€‚ åœæ­¢ä½ï¼šè¡¨ç¤ºå­—ç¬¦æ•°æ®çš„ç»“æŸï¼Œå¯ä»¥æ˜¯ 1 ä½ã€1.5 ä½æˆ– 2 ä½çš„é«˜ç”µå¹³ã€‚ ç©ºé—²ä½ï¼šè¡¨ç¤ºçº¿è·¯ä¸Šæ²¡æœ‰æ•°æ®ä¼ é€ï¼Œå¤„äºé€»è¾‘â€1â€çŠ¶æ€ã€‚ æ³¢ç‰¹ç‡ï¼šè¡¡é‡æ•°æ®ä¼ é€é€Ÿç‡çš„æŒ‡æ ‡ï¼Œé€šå¸¸ä»¥æ¯ç§’ä¼ é€çš„ä½æ•°è¡¨ç¤ºã€‚ åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒUART é€šè¿‡ SCIï¼ˆä¸²è¡Œé€šä¿¡æ¥å£ï¼‰æ¨¡å—è¿›è¡Œæ§åˆ¶ï¼Œå¹¿æ³›åº”ç”¨äºå·¥æ§ã€æ‰‹æœºã€PC ç­‰è®¾å¤‡ä¸­ã€‚é€šè¿‡åˆç†é…ç½® UARTï¼Œå¯ä»¥å®ç°é«˜æ•ˆçš„æ•°æ®ä¼ è¾“å’Œè®¾å¤‡é—´çš„é€šä¿¡ã€‚ å®ä¾‹UARTï¼ˆUniversal Asynchronous Receiver and Transmitterï¼‰å…±æœ‰ 256 bytesin Ch0 64 bytesin Ch1 and Ch4 16 bytesin Ch2 and Ch3 å…¶ä¸­ ch0 å’Œ ch4 æœ‰å…¶ä»–ç‰¹æ®Šä½œç”¨ Thissection includes UART operationssuch as: Data transmission Data reception Interrupt generation Baud-rate generation Loop-back mode Infrared modes AFC The data frame for transmission is programmable. Itconsists of these bitsthat are specified bythe line control register(ULCONn): A Start bit Five to eight data bits An optional parity bitï¼ˆæ ¡éªŒä½ï¼‰ One to two stop bits UART çš„å®ç°ä¸ä»£ç ç¤ºä¾‹åœ¨å®ç° UART æ—¶ï¼Œé€šå¸¸éœ€è¦é…ç½®æ³¢ç‰¹ç‡ã€æ•°æ®æ ¼å¼å’Œå·¥ä½œæ¨¡å¼ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ UART åˆå§‹åŒ–å’Œæ•°æ®å‘é€æ¥æ”¶çš„ç¤ºä¾‹ä»£ç ï¼š //è®¾ç½®é€šé“å·¥ä½œæ¨¡å¼ï¼ˆä¸­æ–­æ¨¡å¼/æŸ¥è¯¢æ¨¡å¼ï¼‰//è®¾ç½®æ•°æ®ä¼ è¾“æ ¼å¼//å‘é€æ•°æ®/æ¥æ”¶æ•°æ®ï¼ˆTXDn-----å‘é€/RXDn-----æ¥å—ï¼‰void serial_init() GPA1.GPA1CON = (GPA1.GPA1CON ~0xFF) | (0x22); // GPA1_0: RX; GPA1_1: TX UART2.ULCON2 = 0x3; // Normal mode, No parity, One stop bit, 8 data bits UART2.UCON2 = 0x5; // Interrupt request or polling mode /* Baud-rate 115200: src_clock: 100MHz * DIV_VAL = (100*10^6 / (115200*16) - 1) = (54.3 - 1) = 53.3 * UBRDIV2 = (Integer part of 53.3) = 53 = 0x35 * UFRACVAL2 = 0.3*16 = 0x5 */ UART2.UBRDIV2 = 0x35; UART2.UFRACVAL2 = 0x5;unsigned char getchar() unsigned char c; while (!(UART2.UTRSTAT2 0X1)); // ç­‰å¾…æ¥æ”¶æ•°æ® c = UART2.URXH2; // è¯»å–æ¥æ”¶åˆ°çš„æ•°æ® return c;void putc(const char data) while (!(UART2.UTRSTAT2 0X2)); // ç­‰å¾…å‘é€ç¼“å†²åŒºç©º UART2.UTXH2 = data; // å‘é€æ•°æ® if (data == ) // å¦‚æœå‘é€çš„æ˜¯æ¢è¡Œç¬¦ï¼Œåˆ™å‘é€å›è½¦ç¬¦ putc(\\r);","categories":["4.é€šè®¯åè®®","ä¸²å£"]},{"title":"åŸºäºQSerialPortçš„ä¸²å£é€šä¿¡","path":"/2023/11/28/4-é€šè®¯åè®®-ä¸²å£-åŸºäºQSerialPortçš„ä¸²å£é€šä¿¡/","content":"åˆå§‹åŒ–å®šä¹‰ä¸€ä¸ª QSerialPort ç±»ï¼Œä¸²å£å‚æ•°çš„è®¾ç½®åº”åœ¨æ‰“å¼€ä¸²å£ä¹‹å‰å®Œæˆ QSerialPort *ComNodeIns;ComNodeIns = new QSerialPort;ComNodeIns-setBaudRate(/*QSerialPort::Baud115200*/230400);ComNodeIns-setParity(QSerialPort::NoParity);ComNodeIns-setDataBits(QSerialPort::Data8);ComNodeIns-setStopBits(QSerialPort::OneStop);ComNodeIns-setFlowControl(QSerialPort::NoFlowControl);//è½®è¯¢å¯ç”¨çš„ä¸²å£foreach(const QSerialPortInfo info, QSerialPortInfo::availablePorts())\tQString comName = info.portName(); ComNodeIns-setPortName(comName);//è®¾ç½®ç¼“å†²åŒºå¤§å°// ComNodeIns-setReadBufferSize(6000);//ä»¥åªè¯»æ–¹å¼æ‰“å¼€ä¸²å£if (ComNodeIns-open(QIODevice::ReadOnly))// ComNodeIns-readAll();//\tconnect(ComNodeIns, SIGNAL(readyRead()), this, SLOT(SlotDataReady()));\t// static QTimer getTimer;\t// connect(getTimer, SIGNAL(timeout()), this, SLOT(SlotDataReady()));\t// getTimer.start(5);//åˆ¤æ–­ä¸²å£æ˜¯å¦æ‰“å¼€if (!ComNodeIns-isOpen())//2.1 open failed\tprintf(%s open Failed ,comName.toLocal8Bit().data());\temit sendNoEquipment();else //2.2 open success\tprintf(%s open OK ,comName.toLocal8Bit().data()); æ•°æ®å‘é€-ç¼“å†²æ± å‘é€åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°æ˜¾ç¤ºå‘é€æˆåŠŸï¼Œè¿”å›å€¼æ­£å¸¸ï¼Œä½†æ˜¯æ¥æ”¶ç«¯æ²¡æœ‰æ¥æ”¶åˆ°æ•°æ®çš„æƒ…å†µï¼Œè¯¥æƒ…å†µçš„åŸå› æ˜¯å¦‚æœçº¿ç¨‹ä¹‹ä¸­å¦‚æœä½¿ç”¨ while(1) å¾ªç¯ï¼Œå¾ªç¯è¿‡å¿«ï¼Œå¯¼è‡´ connect æ¥ä¸åŠå¤„ç†æ•°æ®ï¼Œæ‰€ä»¥ä½¿ç”¨ waitForBytesWrittenwaitForReadyRead å°†å¾ªç¯è¿›è¡Œé˜»å¡ï¼Œå½“æœ‰æ•°æ®è¯»å…¥æ—¶å–æ¶ˆé˜»å¡ï¼Œè¿›å…¥ä¸‹ä¸€è½®å¾ªç¯ã€‚ static int sendIndex = 0;static int sendFailed = 0;//éœ€å®Œæ•´è½®è¯¢æ‰€æœ‰ç¼“å†²åŒºï¼Œä¿è¯æ²¡æœ‰è¢«é—æ¼çš„éœ€è¦å‘é€çš„æ•°æ®for(int i=0; iINDEX_OF_BUFF; i++)\tif(sendMsg[i].nodeMutex.tryLock()) if(sendMsg[i].nodeStatus == 1) int Tr = ComNodeIns-write(sendMsg[i].nodeData); ComNodeIns-waitForBytesWritten(5); if(Tr=0) sendFailed++; //æ€»å‘é€å¤±è´¥æ¬¡æ•° recvMsg[i].nodeIndex += 1;//å­˜å…¥å‘é€å¤±è´¥æ¬¡æ•° else sendIndex++; sendMsg[i].nodeStatus = 0; recvMsg[i].nodeIndex = 0; recvMsg[i].nodeMutex.unlock(); æ•°æ®æ¥æ”¶-ç¼“å†²æ± æ¥æ”¶static int recvIndex = 0;ComNodeIns-waitForReadyRead(1);int Tr = ComNodeIns-bytesAvailable();if(Tr0)\tfor(int i=0; iINDEX_OF_BUFF; i++) if(recvMsg[i].nodeMutex.tryLock()) if(recvMsg[i].nodeStatus == 0) recvMsg[i].nodeStatus = 1; recvMsg[i].nodeData = ComNodeIns-readAll(); recvMsg[i].nodeIndex = recvIndex++; recvMsg[i].nodeMutex.unlock(); return;//å°†æ‰€æœ‰æ•°æ®å­˜å…¥ç¼“å†²åŒºåç›´æ¥è·³å‡ºå¾ªç¯ recvMsg[i].nodeMutex.unlock(); æ•°æ®å¤„ç†æ–¹å¼-å¸§å¤´æ ¡éªŒ/** * @brief SerialPortDriver::SlotDataReady * receive Serial Buffer Content */void SerialPortDriver::SlotDataReady() quint8 *getData_p; quint64 unSize; //unRead bytes in serial buffer bool bCountinue = false; QByteArray baPacket; do //1.detect frame head if (m_bNewCmd)//new msg received while (1) if (ComNodeIns-bytesAvailable() FRAME_HEAD_SIZE)//msg length longer than head // printf(no msg %d ,ComNodeIns-bytesAvailable()); break;// else // printf(=====================get msg %s ,qPrintable(QDateTime::currentDateTime().toString(HH:mm:ss zzz))); m_readData = ComNodeIns-read(FRAME_HEAD_SIZE);//read msg head getData_p = (quint8 *)(m_readData.data()); if (getData_p[0] == MSG_HEAD getData_p[6] == MSG_HEAD_END)//compare msg head end m_unNeedReadNu = getData_p[4]-FRAME_HEAD_SIZE; m_bNewCmd = false; break; else//drop error msg printf(ERROR: MSG RECEIVE HEADEND FAILED!!! ); // ComNodeIns-read(NULL,1); //2.read full frame unSize = ComNodeIns-bytesAvailable(); if (m_unNeedReadNu0 m_unNeedReadNu = unSize) m_readData.append(ComNodeIns-read(m_unNeedReadNu)); else m_readData.append(ComNodeIns-read(unSize)); m_unNeedReadNu = m_unNeedReadNu - unSize; break; //3.send to message deal module baPacket = m_readData; slotDealFrame(baPacket); m_bNewCmd = true; m_unNeedReadNu = 0; //4.continue read if (ComNodeIns-bytesAvailable() FRAME_HEAD_SIZE) bCountinue = true; while (bCountinue);","categories":["4.é€šè®¯åè®®","ä¸²å£"]},{"title":"åŸºäºQSerialPortçš„ä¸²å£é€šä¿¡","path":"/2023/11/28/3-å¼€å‘æ¡†æ¶-Qt-Standby-åŸºäºQSerialPortçš„ä¸²å£é€šä¿¡/","content":"æœ¬æ–‡æ¡£å…¨é¢æ¢³ç†äº† Qt æ¡†æ¶ä¸‹çš„ä¸²å£é€šä¿¡å®ç°æ–¹æ¡ˆï¼Œé‡ç‚¹ä»‹ç»åŸºäº Qt56 æ ‡å‡†åº“ QSerialPort çš„æœ€ä½³å®è·µï¼Œå¹¶é’ˆå¯¹å¤æ‚é€šä¿¡åœºæ™¯æä¾›äº†å¯é çš„è§£å†³æ–¹æ¡ˆã€‚ 1. æ¦‚è¿°QtSerialPort æ˜¯ Qt å®˜æ–¹æä¾›çš„ä¸²å£é€šä¿¡æ¨¡å—ï¼Œè‡ª Qt 5.1 èµ·æˆä¸ºæ ‡å‡†æ¨¡å—ã€‚å®ƒå°è£…äº†ä¸åŒæ“ä½œç³»ç»Ÿçš„åº•å±‚ä¸²å£æ¥å£ï¼ˆWindowsLinuxmacOSï¼‰ï¼Œæä¾›äº†ç»Ÿä¸€çš„ APIã€‚ æ¨èåœºæ™¯ï¼šæ‰€æœ‰åŸºäº Qt5 æˆ– Qt6 çš„æ–°é¡¹ç›®ã€‚ æ ¸å¿ƒä¼˜åŠ¿ï¼šæ”¯æŒå¼‚æ­¥äº‹ä»¶é©±åŠ¨ï¼ˆä¿¡å·æ§½ï¼‰ï¼Œå®Œç¾å¥‘åˆ Qt çš„äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œé¿å… UI å¡é¡¿ã€‚ 2. ç¯å¢ƒæ­å»ºåœ¨ä½¿ç”¨ QSerialPort ä¹‹å‰ï¼Œéœ€è¦åœ¨å·¥ç¨‹é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ¨¡å—ä¾èµ–ã€‚ 2.1 å·¥ç¨‹é…ç½® (.pro)åœ¨ .pro æ–‡ä»¶ä¸­æ·»åŠ  serialport æ¨¡å—ï¼š QT += serialport å¦‚æœæ˜¯ CMake é¡¹ç›® (CMakeLists.txt)ï¼š find_package(Qt6 REQUIRED COMPONENTS SerialPort)target_link_libraries(mytarget PRIVATE Qt6::SerialPort) 2.2 å¤´æ–‡ä»¶å¼•å…¥åœ¨éœ€è¦ä½¿ç”¨ä¸²å£çš„ç±»ä¸­å¼•å…¥å¤´æ–‡ä»¶ï¼š #include QSerialPort#include QSerialPortInfo 3. åŸºç¡€æµç¨‹ä¸²å£é€šä¿¡çš„åŸºç¡€ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼šæŸ¥æ‰¾è®¾å¤‡ã€é…ç½®å‚æ•°ã€æ‰“å¼€è¿æ¥ã€è¯»å†™æ•°æ®ã€å…³é—­è¿æ¥ã€‚ 3.1 è®¾å¤‡æšä¸¾ä¸åˆå§‹åŒ–ä½¿ç”¨ QSerialPortInfo ç±»å¯ä»¥è·å–ç³»ç»Ÿä¸­å¯ç”¨çš„ä¸²å£åˆ—è¡¨ã€‚ // 1. éå†å¹¶æ‰“å°å¯ç”¨ä¸²å£ä¿¡æ¯foreach(const QSerialPortInfo info, QSerialPortInfo::availablePorts()) qDebug() Port: info.portName(); qDebug() Desc: info.description(); qDebug() Manu: info.manufacturer();// 2. å®ä¾‹åŒ–å¹¶é…ç½®å‚æ•°QSerialPort *serial = new QSerialPort;// å»ºè®®é…ç½®å‚æ•°ï¼š// ç«¯å£åï¼šCOM1 / ttyUSB0// æ³¢ç‰¹ç‡ï¼š115200// æ•°æ®ä½ï¼š8// æ ¡éªŒä½ï¼šæ—  (NoParity)// åœæ­¢ä½ï¼š1 (OneStop)// æµæ§ï¼šæ—  (NoFlowControl)serial-setPortName(COM1); serial-setBaudRate(QSerialPort::Baud115200);serial-setDataBits(QSerialPort::Data8);serial-setParity(QSerialPort::NoParity);serial-setStopBits(QSerialPort::OneStop);serial-setFlowControl(QSerialPort::NoFlowControl); 3.2 æ‰“å¼€ä¸å…³é—­æ‰“å¼€ä¸²å£æ—¶å»ºè®®åˆ¤æ–­è¿”å›å€¼ï¼Œä»¥å¤„ç†ç«¯å£è¢«å ç”¨æˆ–ä¸å­˜åœ¨çš„æƒ…å†µã€‚ // æ‰“å¼€ä¸²å£ (è¯»å†™æ¨¡å¼)if (serial-open(QIODevice::ReadWrite)) qDebug() Serial opened successfully; else // å¸¸è§é”™è¯¯ï¼šPermissionDenied (è¢«å ç”¨/æ— æƒé™), DeviceNotFoundError qDebug() Failed to open serial port: serial-errorString();// å…³é—­ä¸²å£if (serial-isOpen()) serial-close(); [!TIP]åœ¨ Qt5+ ä¸­ï¼Œå‚æ•°è®¾ç½®ï¼ˆæ³¢ç‰¹ç‡ç­‰ï¼‰æ¨èåœ¨ open() ä¹‹å‰ å®Œæˆï¼Œè™½ç„¶åæœŸä¿®æ”¹é€šå¸¸ä¹Ÿæœ‰æ•ˆï¼Œä½†æå‰è®¾ç½®èƒ½ç¡®ä¿æ‰“å¼€ç¬é—´çš„çŠ¶æ€æ˜¯ç¡®å®šçš„ã€‚ 4. é€šä¿¡æ¨¡å¼è¯¦è§£Qt æä¾›äº†ä¸¤ç§æˆªç„¶ä¸åŒçš„ API é£æ ¼ï¼Œé€‚ç”¨äºä¸åŒçš„åº”ç”¨æ¶æ„ã€‚ 4.1 æ–¹æ¡ˆ Aï¼šå¼‚æ­¥äº‹ä»¶é©±åŠ¨ï¼ˆæ¨èï¼‰è¿™æ˜¯ Qt çš„ç²¾é«“æ‰€åœ¨ã€‚åˆ©ç”¨ä¿¡å·æ§½æœºåˆ¶ï¼Œæ•°æ®çš„æ¥æ”¶å’Œå‘é€éƒ½åœ¨äº‹ä»¶å¾ªç¯ä¸­å¼‚æ­¥å¤„ç†ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œéå¸¸é€‚åˆ GUI åº”ç”¨ç¨‹åºã€‚ è¯»å–æ•°æ®ï¼šè¿æ¥ readyRead ä¿¡å·ã€‚æ³¨æ„ï¼Œä¸²å£æ•°æ®åˆ°è¾¾æ˜¯åˆ†ç‰‡çš„ï¼Œè§¦å‘ä¸€æ¬¡ readyRead ä¸ç­‰äºæ”¶åˆ°ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åŒ…ã€‚ // è¿æ¥ä¿¡å·æ§½connect(serial, QSerialPort::readyRead, this, MyClass::handleReadyRead);// æ§½å‡½æ•°å®ç°void MyClass::handleReadyRead() // è¯»å–å½“å‰ç¼“å†²åŒºæ‰€æœ‰å¯ç”¨æ•°æ® QByteArray data = serial-readAll(); qDebug() Received chunk: data.toHex(); // æ³¨æ„ï¼šæ­¤å¤„é€šå¸¸éœ€è¦é…åˆç¼“å†²æœºåˆ¶å¤„ç†ç²˜åŒ…ï¼ˆè¯¦è§ç¬¬5ç« ï¼‰ å‘é€æ•°æ®ï¼šè°ƒç”¨ write() æ˜¯éé˜»å¡çš„ï¼Œæ•°æ®ä¼šè¢«å†™å…¥å†…éƒ¨ç¼“å†²åŒºï¼Œéšåç”±åº•å±‚çš„äº‹ä»¶å¾ªç¯å‘é€ã€‚ serial-write(Hello Device);// å¦‚æœéœ€è¦ç¡®åˆ‡çŸ¥é“å·²å‘é€å¤šå°‘å­—èŠ‚ï¼Œå¯è¿æ¥ bytesWritten ä¿¡å· 4.2 æ–¹æ¡ˆ Bï¼šåŒæ­¥é˜»å¡ï¼ˆè½®è¯¢ï¼‰é€‚ç”¨äºé GUI çº¿ç¨‹ï¼ˆå¦‚å•ç‹¬çš„å·¥ä½œçº¿ç¨‹ï¼‰æˆ–ç®€å•çš„æ§åˆ¶å°è„šæœ¬ã€‚æ­¤æ¨¡å¼ä¸‹ï¼Œå‡½æ•°ä¼šæŒ‚èµ·å½“å‰çº¿ç¨‹ç›´åˆ°æ“ä½œå®Œæˆæˆ–è¶…æ—¶ã€‚ [!WARNING]ç»å¯¹ä¸è¦åœ¨ GUI çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ä¸­ä½¿ç”¨æ­¤æ¨¡å¼ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç•Œé¢â€œå‡æ­»â€æ— å“åº”ã€‚ è¯»å–æ•°æ®ï¼š // é˜»å¡ç­‰å¾…æ•°æ®åˆ°è¾¾ï¼Œè¶…æ—¶æ—¶é—´ 5000msif (serial-waitForReadyRead(5000)) QByteArray data = serial-readAll(); // å¾ªç¯è¯»å–ç›´åˆ°æ²¡æœ‰æ›´å¤šæ•°æ®ï¼ˆç®€æ˜“é€»è¾‘ï¼‰ while (serial-waitForReadyRead(10)) data.append(serial-readAll()); qDebug() Received: data; else qDebug() Timeout or Error; å‘é€æ•°æ®ï¼š serial-write(Data);// é˜»å¡ç›´åˆ°æ•°æ®å®Œå…¨å†™å…¥ç¡¬ä»¶ç¼“å†²åŒºif (serial-waitForBytesWritten(5000)) qDebug() Sent successfully; 5. è¿›é˜¶åœºæ™¯å¤„ç†åœ¨å·¥ä¸šæ§åˆ¶ç­‰å¤æ‚åœºæ™¯ä¸­ï¼Œç®€å•çš„ readAll æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚å¿…é¡»å¤„ç†æ•°æ®å¸§è§£æå’Œé«˜é¢‘å‘é€å¸¦æ¥çš„é—®é¢˜ã€‚ 5.1 æ•°æ®å¸§è§£æï¼ˆè§£å†³ç²˜åŒ…æ–­åŒ…ï¼‰ä¸²å£ä¼ è¾“æ˜¯æµå¼ä¼ è¾“ï¼Œæ¥æ”¶ç«¯çœ‹åˆ°çš„åªæ˜¯å­—èŠ‚æµï¼Œæ²¡æœ‰â€œåŒ…â€çš„æ¦‚å¿µã€‚ ç²˜åŒ…ï¼šå‘é€äº†ä¸¤æ¡æŒ‡ä»¤ï¼Œæ¥æ”¶ç«¯ä¸€æ¬¡æ€§æ”¶åˆ°äº†ä¸¤æ¡è¿åœ¨ä¸€èµ·çš„æ•°æ®ã€‚ æ–­åŒ…ï¼šå‘é€äº†ä¸€æ¡é•¿æŒ‡ä»¤ï¼Œæ¥æ”¶ç«¯åˆ†ä¸¤æ¬¡æ‰æ”¶å…¨ã€‚ è§£å†³æ–¹æ¡ˆï¼šå¼•å…¥åº”ç”¨å±‚åè®®ï¼ˆå¦‚ï¼šå¸§å¤´+é•¿åº¦+è½½è·+æ ¡éªŒ+å¸§å°¾ï¼‰ã€‚ æµç¨‹å›¾è§£ï¼ˆç¼“å†²åŒºå¤„ç†æœºåˆ¶ï¼‰flowchart TD A[æ–°æ•°æ®åˆ°è¾¾ readyRead] -- B[è¿½åŠ åˆ°æˆå‘˜å˜é‡ Buffer] B -- CBufferé•¿åº¦ = æœ€å°å¸§é•¿? C -- No -- D[ç­‰å¾…ä¸‹ä¸€æ¬¡æ•°æ®] C -- Yes -- Eæ£€æŸ¥å¸§å¤´? E -- No -- F[ç§»é™¤é¦–å­—èŠ‚ (æ»‘åŠ¨çª—å£)] F -- C E -- Yes -- GBufferé•¿åº¦ = å®Œæ•´å¸§é•¿? G -- No -- D G -- Yes -- H[æˆªå–å®Œæ•´å¸§] H -- I[ç§»é™¤å·²å¤„ç†æ•°æ®] I -- J[åˆ†å‘/å¤„ç†ä¸šåŠ¡] J -- C ä»£ç å®ç° (å¸¦å¸§å¤´æ£€æµ‹)å‡è®¾åè®®ï¼šå¸§å¤´ 0xAA 0x55ï¼ŒåŒ…é•¿å›ºå®š 10 å­—èŠ‚ã€‚ // å¤´æ–‡ä»¶æˆå‘˜å˜é‡QByteArray m_buffer; void SerialPortDriver::handleReadyRead() // 1. è¿½åŠ æ–°æ•°æ® m_buffer.append(serial-readAll()); // 2. å¾ªç¯å¤„ç†ç¼“å†²åŒº while (m_buffer.size() = 10) // å‡è®¾æœ€å°/å›ºå®šåŒ…é•¿ä¸º10 // æ£€æŸ¥å¸§å¤´ (0xAA 0x55) if ((quint8)m_buffer.at(0) == 0xAA (quint8)m_buffer.at(1) == 0x55) // 3. æå–å®Œæ•´å¸§ QByteArray frame = m_buffer.left(10); m_buffer.remove(0, 10); // ä»ç¼“å†²åŒºç§»é™¤ // 4. å¤„ç†ä¸šåŠ¡ processValidFrame(frame); else // å¸§å¤´ä¸å¯¹ï¼Œæ»‘åŠ¨çª—å£ï¼Œä¸¢å¼ƒç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œç»§ç»­æ‰¾ m_buffer.remove(0, 1); 5.2 é«˜é¢‘å‘é€æµæ§å½“å‘é€é¢‘ç‡æé«˜ï¼ˆä¾‹å¦‚ 1ms å‘é€ä¸€æ¬¡ï¼‰ï¼Œè€Œæ³¢ç‰¹ç‡è¾ƒä½æ—¶ï¼ŒQt çš„å†…éƒ¨å‘é€ç¼“å†²åŒºï¼ˆSoftware Output Bufferï¼‰ä¼šè¿…é€Ÿå †ç§¯ï¼Œå¯¼è‡´å†…å­˜å ç”¨é£™å‡ï¼Œä¸”å‘é€å»¶è¿Ÿè¶Šæ¥è¶Šå¤§ã€‚ ç­–ç•¥ï¼š æ£€æŸ¥ç¼“å†²åŒºå †ç§¯ï¼šæ— éœ€å®æ—¶å‘é€ï¼Œåªæœ‰å½“ç¼“å†²åŒºè¾ƒç©ºæ—¶æ‰å†™å…¥æ–°æ•°æ®ã€‚ åŒæ­¥åˆ·æ–°ï¼šåœ¨å¿…é¡»ç«‹å³å‘é€çš„åœºæ™¯ï¼Œé…åˆ waitForBytesWrittenã€‚ // ç¤ºä¾‹ï¼šé«˜é¢‘å‘é€æ—¶çš„ä¿æŠ¤é€»è¾‘void safeWrite(const QByteArray data) // æ£€æŸ¥æ˜¯å¦æœ‰è¿‡å¤šå¾…å‘é€æ•°æ®å †ç§¯ // bytesToWrite() è¿”å› Qt å†…éƒ¨ç¼“å†²åŒºå°šæœªå†™å…¥ç¡¬ä»¶çš„å­—èŠ‚æ•° if (serial-bytesToWrite() 10240) qWarning() Output buffer overflow, dropping packet!; return; serial-write(data); // å¯é€‰ï¼šå¦‚æœæ˜¯å…³é”®æŒ‡ä»¤ï¼Œå¼ºåˆ¶åˆ·æ–°ï¼ˆä¼šäº§ç”Ÿå¾®å°é˜»å¡ï¼‰ // serial-waitForBytesWritten(10); 6. é™„å½•ï¼šæ—§ç‰ˆæ–¹æ¡ˆ (Qt4 QextSerialPort)å¯¹äºä»éœ€ç»´æŠ¤ Qt4 è€æ—§é¡¹ç›®çš„åœºæ™¯ï¼Œé€šå¸¸ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ QextSerialPortã€‚ å…¼å®¹æ€§ï¼šæ”¯æŒ WindowsLinuxmacOSã€‚ æ¨¡å¼ï¼š EventDriven: ç±»ä¼¼ Qt5 çš„å¼‚æ­¥æ¨¡å¼ã€‚ Polling: è½®è¯¢æ¨¡å¼ï¼Œéœ€é…åˆå®šæ—¶å™¨ä½¿ç”¨ bytesAvailable() æŸ¥è¯¢æ•°æ®ã€‚ å·®å¼‚ï¼šéœ€è¦æ‰‹åŠ¨åŒ…å«å¹³å°ç‰¹å®šçš„å®ç°æ–‡ä»¶ (win_qextserialport.cpp ç­‰)ï¼Œä¸” API å‘½åä¸æ ‡å‡†åº“ç•¥æœ‰ä¸åŒã€‚ è¿ç§»å»ºè®®ï¼šå¦‚æ— ç‰¹æ®Šç¡¬ä»¶é™åˆ¶ï¼Œå¼ºçƒˆå»ºè®®é€æ­¥è¿ç§»åˆ° Qt5+ å¹¶ä½¿ç”¨åŸç”Ÿçš„ QSerialPort æ¨¡å—ã€‚ 7. å‚è€ƒæ¥æº Qt Serial Port C++ Classes - Qt Documentation Terminal Example - Qt Serial Port","tags":["Qt","SerialPort"],"categories":["3.å¼€å‘æ¡†æ¶","Qt"]},{"title":"IICæ€»çº¿","path":"/2023/11/27/4-é€šè®¯åè®®-å…¶ä»–-IICæ€»çº¿/","content":"ä¸‰è½´é™€èºä»ªçš„èŠ¯ç‰‡ MPU-6050 èŠ¯ç‰‡é©±åŠ¨æ˜¯é‡‡ç”¨ IIC æ€»çº¿åè®®å’Œå¤„ç†å™¨è¿›è¡Œé€šä¿¡ã€‚å­¦ä¹ ä¸€ä¸‹ IIC æ€»çº¿çš„åè®®å¹¶æ€»ç»“åœ¨æ­¤ï¼š å¤„ç†å™¨å’ŒèŠ¯ç‰‡é—´çš„é€šä¿¡å¯ä»¥å½¢è±¡çš„æ¯”å–»æˆä¸¤ä¸ªäººè®²è¯ï¼š è¯´çš„åˆ«äººå¾—èƒ½å¬æ‡‚ï¼šåŒæ–¹çº¦å®šä¿¡å·çš„åè®®ã€‚ çš„è¯­é€Ÿåˆ«äººå¾—èƒ½æ¥å—ï¼šåŒæ–¹æ»¡è¶³æ—¶åºè¦æ±‚ã€‚ IIC åè®®ï¼ˆä¼ è¾“æ•°æ®çš„é€šé“ï¼‰ï¼šä¸¤æ¡çº¿å¯ä»¥æŒ‚å¤šä¸ªè®¾å¤‡ã€‚ï¼ˆåªæœ‰ä¸»è®¾å¤‡å…·æœ‰æ§åˆ¶ SCLï¼‰ åŒºåˆ†è®¾å¤‡ï¼šIIC è®¾å¤‡é‡Œæœ‰ä¸ªå›ºåŒ–çš„åœ°å€ã€‚åªæœ‰åœ¨ä¸¤æ¡çº¿ä¸Šä¼ è¾“çš„å€¼ç­‰äº IIC è®¾å¤‡çš„åœ°å€æ—¶ï¼Œæ‰ä½œå‡ºå“åº”ã€‚ å¼€å§‹ä¿¡å·ï¼šå¤„ç†å™¨è®© SCL æ—¶é’Ÿä¿æŒé«˜ç”µå¹³ï¼Œç„¶åè®© SDA æ•°æ®ä¿¡å·ç”±é«˜å˜ä½å°±è¡¨ç¤ºä¸€ä¸ªå¼€å§‹ä¿¡å·ã€‚åŒæ—¶ IIC æ€»çº¿ä¸Šçš„è®¾å¤‡æ£€æµ‹åˆ°è¿™ä¸ªå¼€å§‹ä¿¡å·å®ƒå°±çŸ¥é“å¤„ç†å™¨è¦å‘é€æ•°æ®äº†ã€‚ åœæ­¢ä¿¡å·ï¼šå¤„ç†å™¨è®© SCL æ—¶é’Ÿä¿æŒé«˜ç”µå¹³ï¼Œç„¶åè®© SDA æ•°æ®ä¿¡å·ç”±ä½å˜é«˜å°±è¡¨ç¤ºä¸€ä¸ªåœæ­¢ä¿¡å·ã€‚åŒæ—¶ IIC æ€»çº¿ä¸Šçš„è®¾å¤‡æ£€æµ‹åˆ°è¿™ä¸ªåœæ­¢ä¿¡å·å®ƒå°±çŸ¥é“å¤„ç†å™¨å·²ç»ç»“æŸäº†æ•°æ®ä¼ è¾“ã€‚ å†çœ‹æ•°æ®æ€ä¹ˆä¼ ï¼šSDA ä¸Šä¼ è¾“çš„æ•°æ®å¿…é¡»åœ¨ SCL ä¸ºé«˜ç”µå¹³æœŸé—´ä¿æŒç¨³å®šï¼šå› ä¸ºå¤–æ¥ IIC è®¾å¤‡åœ¨ SCL ä¸ºé«˜ç”µå¹³çš„æœŸé—´é‡‡é›†æ•°æ®æ–¹çŸ¥ SDA æ˜¯é«˜æˆ–ä½ç”µå¹³ã€‚SDA ä¸Šçš„æ•°æ®åªèƒ½åœ¨ SCL ä¸ºä½ç”µå¹³æœŸé—´ç¿»è½¬å˜åŒ–ã€‚ å“åº”ä¿¡å·ï¼ˆACKï¼‰ï¼šå¤„ç†å™¨æŠŠæ•°æ®å‘ç»™å¤–æ¥ IIC è®¾å¤‡ï¼Œå¦‚ä½•çŸ¥é“ IIC è®¾å¤‡æ•°æ®å·²ç»æ”¶åˆ°å‘¢ï¼Ÿå°±éœ€è¦å¤–æ¥ IIC è®¾å¤‡å›åº”ä¸€ä¸ªä¿¡å·ç»™å¤„ç†å™¨ã€‚å¤„ç†å™¨å‘å®Œ 8bit æ•°æ®åå°±ä¸å†é©±åŠ¨æ€»çº¿äº†ï¼ˆSDA å¼•è„šå˜è¾“å…¥ï¼‰ï¼Œè€Œ SDA å’Œ SCL ç¡¬ä»¶è®¾è®¡æ—¶éƒ½æœ‰ä¸Šæ‹‰ç”µé˜»ï¼Œæ‰€ä»¥è¿™æ—¶å€™ SDA å˜æˆé«˜ç”µå¹³ã€‚é‚£ä¹ˆåœ¨ç¬¬ 8 ä¸ªæ•°æ®ä½ï¼Œå¦‚æœå¤–æ¥ IIC è®¾å¤‡èƒ½æ”¶åˆ°ä¿¡å·çš„è¯æ¥ç€åœ¨ç¬¬ 9 ä¸ªå‘¨æœŸæŠŠ SDA æ‹‰ä½ï¼Œé‚£ä¹ˆå¤„ç†å™¨æ£€æµ‹åˆ° SDA æ‹‰ä½å°±èƒ½çŸ¥é“å¤–æ¥ IIC è®¾å¤‡æ•°æ®å·²ç»æ”¶åˆ°ã€‚ IIC æ•°æ®ä»æœ€é«˜ä½å¼€å§‹ä¼ è¾“ã€‚ å¤šä¸ªè®¾å¤‡æŒ‚è½½æƒ…å†µä¸‹å¦‚ä½•è®¿é—®å…¶ä¸­ä¸€ä¸ªè®¾å¤‡è€Œä¸å½±å“å…¶ä»–è®¾å¤‡ ç”¨ 7bit è¡¨ç¤ºä»åœ°å€ï¼Œé‚£ä¹ˆå¯ä»¥æŒ‚è½½çš„ä»è®¾å¤‡æ•°æ˜¯ 2 çš„ 7 æ¬¡æ–¹ 128 ä¸ªã€‚å¤„ç†å™¨æƒ³å†™çš„è¯ï¼šå…ˆå‘é€èµ·å§‹ä½ï¼Œå†å‘ä¸€ä¸ª 8bit æ•°æ®ï¼šå‰ 7bit è¡¨ç¤ºä»åœ°å€ï¼Œç¬¬ 8bit è¡¨ç¤ºè¯»æˆ–è€…å†™ã€‚0write æ˜¯å¤„ç†å™¨å¾€ IIC ä»è®¾å¤‡å‘ï¼Œ1read æ˜¯ IIC ä»è®¾å¤‡å¾€å¤„ç†å™¨å‘ã€‚ç¬¬ 9 ä¸ªæ—¶é’Ÿå‘¨æœŸå›å¤å“åº”ä¿¡å·ã€‚ä¸‹é¢å°±ä»¥ AT24Cxx ä¸ºä¾‹è¯¦ç»†è¯´æ˜ä¸€ä¸‹ï¼š é¦–å…ˆå‘å‡ºä¸€ä¸ª start ä¿¡å·ï¼Œä»è®¾å¤‡åœ°å€ï¼ŒRWï¼ˆ0ï¼Œå†™ï¼‰ï¼Œå›åº” ACK è¡¨ç¤ºæœ‰è¿™ä¸ªä»è®¾å¤‡å­˜åœ¨ã€‚è¿™æ—¶å€™æ˜¯å¤„ç†å™¨ä»æŒ‡å®šçš„ä»è®¾å¤‡è¯»æ•°æ®çš„ä»è®¾å¤‡é‡Œ 8bit å­˜å‚¨åœ°å€çš„æŒ‡å®šã€‚æ‰€ä»¥è¿™é‡Œ RW æ˜¯ 0 ä¸ºå†™ã€‚ACK å›åº”æœ‰è¿™ä¸ªè®¾å¤‡çš„è¯ï¼Œå¤„ç†å™¨æŠŠè¦è®¿é—®çš„ä»è®¾å¤‡é‡Œçš„ 8bit å­˜å‚¨åœ°å€å†™å¥½ã€‚ACK å¯¹æ–¹å›åº”ã€‚ç»§ç»­ä¸€ä¸ª start ä¿¡å·+ä»è®¾å¤‡åœ°å€ï¼Œæœ€ä½ä½æ˜¯é«˜ç”µå¹³è¡¨ç¤ºè¯»æ•°æ®ï¼Œå›åº” ACK è¡¨ç¤ºæœ‰è¿™ä¸ªä»è®¾å¤‡å­˜åœ¨ã€‚åœ¨è¯»æ•°æ®çš„æ—¶å€™ï¼Œæ¯å‘å‡ºä¸€ä¸ªæ—¶é’Ÿï¼Œå¤„ç†å™¨ä¼šå°† SDA ä¸Šçš„æ•°æ®å­˜èµ·æ¥ã€‚é‚£ä¹ˆå‘å‡º 8 ä¸ªæ—¶é’Ÿåå¤„ç†å™¨å°±èƒ½å¾—åˆ° 8 ä½çš„æ•°æ®ã€‚è¿™æ—¶å€™è‹¥æƒ³è¿ç»­è¯»å°±ä¸æ–­å›åº” ACK ä¿¡å·å¦åˆ™å°±å‘å‡ºåœæ­¢ä¿¡å·ã€‚ è¯»çš„è¿‡ç¨‹ï¼š start ä¿¡å·ï¼Œä»è®¾å¤‡åœ°å€ï¼Œã€Šå†™ï¼ˆackï¼‰ï¼Œå¾…è¯»å–å­˜å‚¨åœ°å€ï¼ˆackï¼‰ã€‹ start ä¿¡å·ï¼Œä»è®¾å¤‡åœ°å€ï¼Œã€Šè¯»ï¼ˆackï¼‰ï¼Œ8 ä¸ªæ—¶é’Ÿï¼ˆno ackï¼‰ã€‹ ä»è®¾å¤‡å°±æŠŠå¯¹åº”çš„æ•°æ®åé¦ˆç»™å¤„ç†å™¨ã€‚ start ä¿¡å·ï¼Œä»è®¾å¤‡åœ°å€ï¼Œå†™ï¼Œç´§è·Ÿè¿ç»­ä¸¤ä¸ªå­—èŠ‚çš„æ•°æ®ï¼šè¦å†™çš„åœ°å€ï¼Œå¯¹æ–¹æ”¶åˆ° 8bit åœ°å€åå›åº” ACKï¼Œå† 8bit æ•°æ®å‘ç»™ä»è®¾å¤‡ï¼Œå¯¹æ–¹æ”¶åˆ° 8bit æ•°æ®åå›åº” ACKï¼Œå¤„ç†å™¨å†™å®Œåå‘é€åœæ­¢ä¿¡å·ã€‚","categories":["4.é€šè®¯åè®®","å…¶ä»–"]},{"title":"é€šè®¯å¤‡æ³¨","path":"/2023/11/24/4-é€šè®¯åè®®-å…¶ä»–-é€šè®¯å¤‡æ³¨/","content":"ä¼ è¾“æ–¹å¼éœ€è¦æ³¨æ„ä¼ è¾“æ–¹å¼ä¸é€šè®¯åè®®ä¸¤ä¸ªæ¦‚å¿µ 485 é€šè®¯ï¼Œ232 é€šè®¯ï¼Œè¿™è®²çš„æ˜¯é‡‡ç”¨ä½•ç§ä¼ è¾“æ–¹å¼ã€‚æ—¢ç„¶æ˜¯ä¼ è¾“æ–¹å¼ï¼Œé‡è¦å°±æ˜¯â€ä¼ è¾“â€ä¸¤å­—ï¼Œä¸ç®¡æ˜¯ 232 è¿˜æ˜¯ 485ï¼Œåªæ˜¯èµ·åˆ°ä¼ è¾“ä½œç”¨ï¼Œå¯ä»¥ä¼ è¾“ MODBUS é€šè®¯åè®®ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä¼ è¾“å…¶ä»–é€šè®¯åè®®ä¿¡æ¯ MODBUS é€šä¿¡æ ‡å‡†åè®®å¯ä»¥é€šè¿‡å„ç§ä¼ è¾“æ–¹å¼ä¼ æ’­ï¼Œå¦‚ 232ã€485 ç­‰ã€‚å·¥ä¸šé€šè®¯åè®®æœ‰ modbus,interbus,canbus ç­‰ï¼Œmodbus åˆ† RTU å’Œ ASCIIï¼Œinterbus æ˜¯ä¸²è¡Œé€šè®¯ï¼Œæ˜¯ä¼ æ„Ÿå™¨è°ƒèŠ‚å™¨æ€»çº¿ç³»ç»Ÿã€‚canbus æ˜¯ real-time æ•°æ®æ€»çº¿ã€‚ ç»ˆç«¯ç”µé˜»å…‰ä»ç©ºæ°”è¿›å…¥æ°´é¢æ—¶ï¼Œæ°´é¢ä»åå°„å›ä¸€äº›å…‰çº¿ï¼Œè¿™æ˜¯å› ä¸ºç©ºæ°”ä¸æ°´çš„åª’è´¨ä¸åŒã€‚å…‰è¿›å…¥ä¸åŒçš„åª’è´¨æ—¶ï¼Œä¼šåœ¨ä¸´ç•Œç‚¹åå°„ã€‚ ç”µä¿¡å·ä¼ è¾“ä¹Ÿä¸€æ ·ï¼Œåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¦‚æœä¼ è¾“æœ«ç«¯é˜»æŠ—çªç„¶å‡å°ç”šè‡³æ²¡æœ‰ï¼Œä¿¡å·å°±ä¼šåœ¨æ­¤äº§ç”Ÿåå°„ï¼Œè¿™ç§åå°„ä¼šé€ æˆä¼ è¾“çº¿è·¯æ•°æ®æ··ä¹±ï¼Œæ‰€ä»¥åŠ ä¸€ä¸ªåç½®ç”µé˜»ï¼Œäººä¸ºåœ°ä¿æŒé˜»æŠ—å¹³è¡¡ï¼Œå‡å¼±ä¿¡å·åå°„å¯¹çº¿è·¯çš„å½±å“ã€‚ æ³¢ç‰¹ç‡æ³¢ç‰¹ç‡æ˜¯æ¯ç§’é’Ÿä¼ è¾“çš„æ•°æ®ä½æ•°ï¼›ä»€ä¹ˆæ˜¯ä½æ•°å‘¢ï¼Ÿè®¡ç®—æœºå¤„ç†çš„è¯­è¨€æ˜¯â€0â€å’Œâ€1â€ç»„åˆè€Œæˆçš„ä¿¡æ¯ï¼Œå³æœºå™¨è¯­è¨€ã€‚ä¸€ä¸ªâ€0â€æˆ–æ˜¯ä¸€ä¸ªâ€1â€å°±æ˜¯ä¸€ä¸ªä½ï¼› å¦‚æœæŠŠæ³¢ç‰¹ç‡è®¾ä¸º 9600ï¼Œå³ä¸€ç§’é’Ÿä¹‹å†…èƒ½å¤Ÿä¼ è¾“ 9600 ä¸ªâ€0â€æˆ–æ˜¯â€1â€ï¼Œå®ƒå†³å®šäº†é€šè®¯çš„æ•°æ®ä¼ è¾“é€Ÿåº¦ã€‚ å¸¸ç”¨çš„æ³¢ç‰¹ç‡æ•°å€¼æœ‰ï¼š2400ã€4800ã€9600ã€19200ã€38400ã€57600ã€115200ï¼›å…¶å€¼è¶Šå¤§ï¼Œé€šè®¯ä¼ è¾“é€Ÿåº¦è¶Šé«˜ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯æŠŠæ³¢ç‰¹ç‡çš„æ•°å€¼è®¾ç½®çš„è¶Šå¤§è¶Šå¥½å‘¢ï¼Ÿå½“ç„¶ä¸æ˜¯ï¼Œå®ƒè¦æ ¹æ®ç°åœºä¼ è¾“æ¡ä»¶æ¥å†³å®šï¼Œæ³¢ç‰¹ç‡è®¾ç½®çš„è¶Šå¤§ï¼Œè¦æ‰¿æ‹…çš„é€šè®¯å¤±è´¥é£é™©è¶Šå¤§ã€‚ æ•°æ®ä½å‰é¢è¯´è¿‡ï¼Œè®¡ç®—æœºå¤„ç†çš„è¯­è¨€æ˜¯â€0â€å’Œâ€1â€ç»„åˆè€Œæˆçš„ä¿¡æ¯ï¼Œå³æœºå™¨è¯­è¨€ã€‚01000001 ï¼Œ01000010 ï¼Œ01000011 ï¼Œ01000100 ï¼Œ01000101ï¼Œ01000110 ã€‚ä¸Šé¢ä¸€ç»„æœºå™¨ç åˆ†åˆ«ä»£è¡¨çš„å­—ç¬¦æ˜¯ Aï¼ŒBï¼ŒCï¼ŒDï¼ŒEï¼ŒFï¼›å¦‚ A: æ˜¯ç”¨ 01000001 è¡¨ç¤ºï¼Œå…±å…«ä¸ªâ€0â€æˆ–â€1â€ï¼Œå³æ•°æ®ä½ä¸ºå…«ä½ï¼›æ•°æ®ä½çš„å«ä¹‰ï¼šæ˜¯ä¸€ä¸ªå­—ç¬¦å¯ä»¥ç”¨å¤šå°‘ä¸ªä½çš„ç»„åˆæ¥è¡¨ç¤ºã€‚ è®¾ç½®æ•°æ®ä½åï¼Œä»¬å°±çŸ¥é“äº†æ•°æ®é•¿åº¦ï¼Œç„¶åå¯ä»¥æ ¹æ®æ³¢ç‰¹ç‡(9600)è®¡ç®—å‡ºä¼ è¾“ä¸€ä¸ªå­—ç¬¦ A éœ€è¦å¤šå°‘æ—¶é—´ã€‚å¦‚æœæ•°æ®ä½è®¾ä¸º 8,åˆ™ï¼š896000.00083 ç§’å³ä¼ è¾“ä¸€ä¸ªå­—ç¬¦â€Aâ€éœ€è¦ 0.83 æ¯«ç§’çš„æ—¶é—´ï¼ˆè¿™ä¸æ˜¯æ­£ç¡®çš„è®¡ç®—ï¼ŒåŸå› åœ¨åœæ­¢ä½çš„è§£é‡Šä¸­å†è®ºè¿°ã€‚ï¼‰ å®šä¹‰ä¸€ä¸ªæ ‡å‡†ï¼Œæ–¹ä¾¿é€šè®¯åŒæ–¹åˆ†æã€‚ åˆæ³•çš„æ•°æ®ä½å€¼ï¼š4ã€5ã€6ã€7ã€8ï¼Œç›®å‰å¸¸ç”¨çš„æ•°æ®ä½æ˜¯ 8 ä½ä¸ 7 ä½ã€‚ åœæ­¢ä½ è®¾ç½®äº†æ•°æ®ä½ï¼Œå°±å¯ä»¥æ­£å¸¸é€šè®¯äº†å—ï¼Ÿä¸æ˜¯ã€‚æ¥æ”¶æ–¹ä½•æ—¶æ‰çŸ¥é“ä¸€ä¸ªå­—ç¬¦ä¼ è¾“ç»“æŸäº†ï¼Œè¿™å°±éœ€è¦ä¸€ä¸ªåœæ­¢ä½ï¼Œæœ‰åœæ­¢ä½å½“ç„¶è¿˜éœ€è¦ä¸€ä¸ªèµ·å§‹ä½æ¥å‘Šè¯‰æ¥æ”¶æ–¹ä¸€ä¸ªå­—ç¬¦çš„ä¼ è¾“å¼€å§‹ã€‚ç›®å‰å¸¸ç”¨çš„åœæ­¢ä½æ˜¯ä¸€ä½ä¸äºŒä½ã€‚ è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆåœ¨é€šè®¯æ ¼å¼ä¸­ä¸ç”¨è®¾ç½®èµ·å§‹ä½ï¼Ÿåœæ­¢ä½æ˜¯ä¸€ä¸ªé«˜ç”µå¹³(1)ï¼Œå½“æ¥æ”¶æ–¹æ¥æ”¶åˆ°è¿ç»­çš„é«˜ç”µå¹³æ—¶ï¼Œè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¼ è¾“ç»“æŸã€‚ èµ·å§‹ä½æ˜¯ä¸€ä¸ªä½ç”µå¹³(0),å½“æ¥æ”¶æ–¹æ¥æ”¶è¿ç»­çš„ä½ç”µå¹³æ—¶ï¼Œè¡¨ç¤ºä¸‹ä¸€ä¸ªå­—ç¬¦çš„ä¼ è¾“å¼€å§‹ã€‚å¦‚æœåœæ­¢ä½å¯é (1 ä½æˆ–æ˜¯ 2 ä½)ï¼Œé‚£ä¹ˆå¹²æ‰°é€ æˆä½ç”µå¹³èµ·å§‹ä½å‡è±¡çš„å¯èƒ½æ€§å°±ä¸å¤§ï¼Œæ‰€ä»¥ä¸ç”¨è®¾ç½®èµ·å§‹ä½ã€‚ å‡å¦‚è®¾ç½®åœæ­¢ä½ä¸º 2ï¼Œåˆ™ä¸€ä¸ªèµ·å§‹ä½ï¼Œä¸¤ä¸ªåœæ­¢ä½ï¼Œ8 ä¸ªæ•°æ®ä½ï¼Œæ€»ä½æ•°ä¸º 11ã€‚1196000.0011 ç§’ï¼Œå³ä¼ è¾“ä¸€ä¸ªå­—ç¬¦â€Aâ€éœ€è¦ 1.1 æ¯«ç§’çš„æ—¶é—´ï¼ˆè¿™è¿˜ä¸æ˜¯æ­£ç¡®çš„è®¡ç®—ï¼ŒåŸå› åœ¨æ ¡éªŒæ–¹å¼çš„è§£é‡Šä¸­å†è®ºè¿°ã€‚ï¼‰ æ ¡éªŒæ–¹å¼å¦‚æœæŠ—å¹²æ‰°å¤„ç†çš„ä¸ç†æƒ³ï¼Œåœ¨é€šè®¯ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œâ€0â€å¯èƒ½ä¼šå˜æˆâ€1â€ï¼Œæˆ–æ˜¯å°†â€1â€å¹²æ‰°æˆâ€0â€ï¼Œé€ æˆä¼ è¾“é”™è¯¯ã€‚å¹²æ‰°æ˜¯æ¶ˆé™¤ä¸äº†çš„ï¼Œæé«˜æŠ—å¹²æ‰°èƒ½åŠ›ä¹Ÿåªæ˜¯æé«˜è€Œå·²ï¼Œå¹¶ä¸èƒ½å®Œå…¨é˜²æ­¢å¹²æ‰°ã€‚æ‰€ä»¥å› ä¸ºå¹²æ‰°é€ æˆçš„ä¼ è¾“é”™è¯¯ä¸€å®šä¼šå‘ç”Ÿã€‚æ¥æ”¶æ–¹å¦‚ä½•çŸ¥é“æ¥æ”¶åˆ°å­—ç¬¦æ˜¯å¦æ­£ç¡®å‘¢ï¼Ÿè§£å†³æ–¹å¼å°±æ˜¯åŠ ä¸Šä¸€ä¸ªæ ¡éªŒï¼Œå³åœ¨ä¼ è¾“çš„æ•°æ®ä¸­å†åŠ ä¸Šä¸€ä¸ªæ ¡éªŒä½ã€‚ ç›®å‰æ‰€ç”¨çš„æ ¡éªŒæ–¹å¼ä¸ºï¼š å¶æ ¡éªŒ(even):ç®€å•è¡¨ç¤ºä¸ºâ€eâ€ ï¼› å¶æ ¡éªŒï¼šå¦‚æœä¸€ä¸ªå­—ç¬¦ä¸­â€1â€çš„ä¸ªæ•°æ˜¯å¥‡æ•°é‚£ä¹ˆæ ¡éªŒä½å°±ç½®ä¸ºâ€1â€ï¼›å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸­â€1â€çš„ä¸ªæ•°æ˜¯å¶æ•°ï¼Œé‚£ä¹ˆæ ¡éªŒä½å°±ç½®ä¸ºâ€0â€ï¼›ä»è€Œä¿è¯æ€»çš„ 1 çš„ä¸ªæ•°æ˜¯å¶æ•°ï¼›æ¯”å¦‚è®¾ç½®æ•°æ®ä½ä¸º 8 ä½ï¼Œå­—ç¬¦â€Aâ€æ˜¯ï¼š0100 0001 å…¶â€1â€çš„ä¸ªæ•°æ˜¯ 2 ä¸ªï¼Œä¸ºå¶æ•°ã€‚é‚£ä¹ˆæ ¡éªŒä½åˆ™ä¸ºâ€0â€ çœŸæ­£å‘é€çš„ä¿¡æ¯ä¸ºï¼š0100 0001 0 å¥‡æ ¡éªŒ(odd):ç®€å•è¡¨ç¤ºä¸ºâ€oâ€ ï¼› å¥‡æ ¡éªŒï¼šå¦‚æœä¸€ä¸ªå­—ç¬¦ä¸­â€1â€çš„ä¸ªæ•°æ˜¯å¶æ•°ï¼Œé‚£ä¹ˆæ ¡éªŒä½å°±ç½®ä¸º 1ï¼›å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸­â€1â€çš„ä¸ªæ•°æ˜¯å¥‡æ•°ï¼Œé‚£ä¹ˆæ ¡éªŒä½å°±ç½®ä¸º 0ï¼›ä»è€Œä¿è¯æ€»çš„â€1â€çš„ä¸ªæ•°æ˜¯å¥‡æ•°ï¼›æ¯”å¦‚è®¾ç½®æ•°æ®ä½ä¸º 8 ä½ï¼Œå­—ç¬¦â€Aâ€æ˜¯ï¼š0100 0001 å…¶â€1â€çš„ä¸ªæ•°æ˜¯ 2 ä¸ªï¼Œä¸ºå¶æ•°ã€‚é‚£ä¹ˆæ ¡éªŒä½åˆ™ä¸ºâ€1â€ çœŸæ­£å‘é€çš„ä¿¡æ¯ä¸ºï¼š0100 0001 1 æ— æ ¡éªŒ(none):ç®€å•è¡¨ç¤ºä¸ºâ€nâ€ ï¼› æ— æ ¡éªŒï¼šæ²¡æœ‰æ ¡éªŒä½ï¼› æ ¡éªŒä½çš„ä½œç”¨ï¼š å¦‚æœåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œç”±äºå¹²æ‰°å°†æŸä¸ªâ€0â€å˜æˆäº†â€1â€ï¼Œå¶æ ¡éªŒæ—¶ï¼Œâ€1â€ çš„ä¸ªæ•°å› ä¸ºå¹²æ‰°å˜æˆå¥‡æ•°ï¼Œå¥‡æ ¡éªŒæ—¶ï¼Œâ€1â€ çš„ä¸ªæ•°å› ä¸ºå¹²æ‰°å˜æˆå¶æ•°ï¼Œæ¥æ”¶æ–¹ä¼šè¿”å›ä¸€ä¸ªå¥‡å¶æ ¡éªŒé”™è¯¯ä¿¡æ¯ç»™å‘é€æ–¹ã€‚æ¯”å¦‚ï¼šå½“é‡‡ç”¨å¥‡æ ¡éªŒæ—¶ï¼Œå‘é€â€Aâ€å­—ç¬¦çš„ 0100 0001 1ã€‚å½“ä¼ è¾“åˆ°æ¥æ”¶æ–¹ï¼Œç”±äºå¹²æ‰°å˜æˆäº† 0100 0011 1ã€‚æ¥æ”¶æ–¹æ¥æ”¶åˆ°å››ä¸ªâ€1â€ï¼Œæ˜¯å¶æ•°ï¼Œä¸ç¬¦åˆå¥‡æ ¡éªŒçš„â€1â€çš„ä¸ªæ•°ä¸ºå¥‡æ•°çš„è§„å®šï¼Œæ‰€ä»¥è¿”å›ä¸€ä¸ªå¥‡å¶æ ¡éªŒé”™è¯¯ä¿¡æ¯ç»™å‘é€æ–¹ã€‚ æ³¨æ„ï¼šå¥‡å¶æ ¡éªŒæ–¹å¼ä¸å¯èƒ½å®Œå…¨æ ¡éªŒä¸€ä¸ªå­—ç¬¦å‘é€æ˜¯å¦æ­£ç¡®ã€‚æ¯”å¦‚é‡‡ç”¨å¥‡æ ¡éªŒæ–¹å¼æ—¶ï¼Œå‘é€â€Aâ€å­—ç¬¦æ—¶ 0100 0001 1ã€‚ç”±äºå¹²æ‰°æ¥æ”¶æ–¹æ¥æ”¶åˆ°çš„æ˜¯ 0100 0010 1 (æ˜¯â€Bâ€)ã€‚ç”±äºåªæ˜¯â€1â€çš„ä½ç½®æ”¹å˜äº†ï¼Œâ€1â€çš„ä¸ªæ•°è¿˜æ˜¯å¥‡æ•°ï¼Œè™½ç„¶å‘é€çš„æ˜¯ Aï¼Œæ¥æ”¶åˆ°çš„æ˜¯ Bï¼Œä½†æ˜¯å¥‡æ ¡éªŒè¿˜è®¤ä¸ºæ˜¯æ­£ç¡®çš„å­—ç¬¦ï¼›ä¸ºäº†è§£å†³å¥‡å¶æ ¡éªŒæ–¹å¼çš„ä¸Šè¿°ç¼ºé™·ï¼Œæ¯ç§æ ‡å‡†åè®®éƒ½ä¼šè¦æ±‚æ ¡éªŒå’Œè®¡ç®—ï¼Œæ¯”å¦‚ MODBUS é€šè®¯åè®®çš„ RTU æ–¹å¼æ˜¯ CRC æ ¡éªŒè®¡ç®—ï¼› MODBUS é€šè®¯åè®®çš„ ASCII æ–¹å¼æ˜¯ LRC æ ¡éªŒè®¡ç®—ï¼› æœ‰äº›æœ‹å‹å¯¹äºå¥‡å¶æ ¡éªŒ ä¸ æ ¡éªŒå’Œè®¡ç®— è¿™ä¸¤ä¸ªæ¦‚å¿µåˆ†ä¸æ¸…æ¥šã€‚ å¥‡å¶æ ¡éªŒï¼šåˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¼ è¾“çš„æ˜¯å¦æ­£ç¡®ï¼› æ ¡éªŒå’Œï¼š åˆ¤æ–­ä¸€ç»„å­—ç¬¦ä¼ è¾“çš„æ˜¯å¦æ­£ç¡®ï¼› é€šè®¯æ ¼å¼ä¸ºï¼š9600ï¼Œoï¼Œ8ï¼Œ2ã€‚ä¸€ä¸ªèµ·å§‹ä½ï¼Œå…«ä¸ªæ•°æ®ä½ï¼Œä¸€ä¸ªæ ¡éªŒä½ï¼Œä¸¤ä¸ªåœæ­¢ä½ï¼Œæ€»ä½æ•°ä¸º 12ã€‚1296000.00125 ç§’ï¼Œä¼ è¾“ä¸€ä¸ªå­—ç¬¦â€Aâ€éœ€è¦ 1.25 æ¯«ç§’çš„æ—¶é—´ï¼›è¿™ä¸ªè®¡ç®—å€¼æ‰æ˜¯æœ€åçš„ç†è®ºè®¡ç®—å€¼ã€‚å¯ä»¥å¤§è‡´è¯„ä¼°ä¼ è¾“ä¸€ç»„å­—ç¬¦éœ€è¦çš„æ—¶é—´ã€‚å½“ç„¶ï¼Œé€‰ç”¨æ— æ ¡éªŒæ–¹å¼ï¼Œè®¡ç®—ä¼ è¾“æ–¹å¼ä¸éœ€è¦åŠ ä¸Šæ ¡éªŒä½ã€‚","categories":["4.é€šè®¯åè®®","å…¶ä»–"]},{"title":"Qtçš„socketé€šä¿¡","path":"/2023/11/23/4-é€šè®¯åè®®-ç½‘ç»œ-Qtçš„socketé€šä¿¡/","content":"åœ¨ Qt ä¸­æ‰§è¡Œæ”¶å‘å·¥ä½œè¾ƒä¸ºè€—æ—¶æˆ–äº¤äº’é¢‘ç‡è¾ƒé«˜çš„æ—¶å€™ï¼Œä¸ºäº†ä½¿å¾—é€šä¿¡è¿‡ç¨‹ä¸é€ æˆ UI çš„å¡é¡¿ç°è±¡ï¼Œä¸€èˆ¬è¦æ±‚é€šä¿¡å·¥ä½œåœ¨æ¬¡çº¿ç¨‹ï¼ˆå­çº¿ç¨‹ï¼‰ä¸­å®Œæˆã€‚ å°† Qt å¥—æ¥å­—å¯¹è±¡ç§»åŠ¨åˆ°æ¬¡çº¿ç¨‹ï¼Œå¹¶åœ¨ä¸»çº¿ç¨‹ä¸­ç›´æ¥è°ƒç”¨å¥—æ¥å­—æ¥å£ï¼Œæ­¤æ—¶å­˜åœ¨ â€œä»¥å…¶ä»–çº¿ç¨‹å¯¹è±¡ä¸ºçˆ¶å¯¹è±¡ï¼Œåœ¨æœ¬çº¿ç¨‹åˆ›å»ºå­å¯¹è±¡â€ çš„å‘Šè­¦ã€‚ å®šä¹‰ä¸€ä¸ª workker ç±»å¯¹è±¡ï¼Œå°†å…¶ç§»åŠ¨åˆ°æ¬¡çº¿ç¨‹ä¸­ï¼Œç”±å…¶è´Ÿè´£å¯¹ m_socket å¥—æ¥å­—å¯¹è±¡çš„æ“ä½œï¼ŒåŒ…æ‹¬ä½¿ç”¨å¥—æ¥å­—è¿›è¡Œè¿æ¥ã€æ–­å¼€ã€æ•°æ®å‘é€ç­‰æ“ä½œã€‚å¥—æ¥å­—å¯¹è±¡æ²¡æœ‰è¿›è¡Œè¿‡ moveToThread æ“ä½œï¼Œå…¶è¿˜æ˜¯å½’å±äºåˆ›å»ºå®ƒçš„ä¸»çº¿ç¨‹ï¼Œä½†ç›¸å…³å‡½æ•°è°ƒç”¨çº¿ç¨‹å´ä¸ºæ‰€åœ¨çš„æ¬¡çº¿ç¨‹ã€‚ åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹éœ€è¦æ³¨æ„ï¼Œçº¿ç¨‹çš„æ„é€ å‡½æ•°å’Œ run å‡½æ•°æ‰€éš¶å±çš„çº¿ç¨‹æ˜¯ä¸ä¸€è‡´çš„ï¼Œå¦‚æœåœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–èŠ‚ç‚¹æ—¶ï¼Œä¼šå‡ºç°è­¦å‘Š QSocketNotifier: socket notifiers cannot be enabled from another thread å¥—æ¥å­—çš„ç›¸å…³æ¥å£åªèƒ½åœ¨å¥—æ¥å­—å¯¹è±¡æ‰€å±çš„çº¿ç¨‹å†…è°ƒç”¨ï¼ˆå¦‚æœå¥—æ¥å­—å¯¹è±¡æ²¡æœ‰æ‰§è¡Œè¿‡ moveToThread æ“ä½œï¼Œé‚£ä¹ˆå¥—æ¥å­—å¯¹è±¡çš„æ‰€å±çº¿ç¨‹å°±æ˜¯åˆ›å»ºå®ƒçš„çº¿ç¨‹ï¼‰ã€‚å› æ­¤ï¼Œå¦‚æœæƒ³æ”¯æŒåœ¨æ¬¡çº¿ç¨‹ä¸­æ‰§è¡Œè¿æ¥æ–­å¼€æœåŠ¡ã€æ•°æ®æ”¶å‘è¿‡ç¨‹ï¼Œåˆ™å¿…é¡»çš„è¦å°†å¥—æ¥å­—å¯¹è±¡æœ¬èº«è¿›è¡Œ moveToThread æ“ä½œï¼Œä¸”è¦å°†å…¶ä»–çº¿ç¨‹å¯¹è¯¥å¯¹è±¡çš„æ“ä½œè½¬æ¢åˆ° moveToThread åçš„çº¿ç¨‹å†…ã€‚ //.h#pragma once#include QTcpSocket//è¯¥å¯¹è±¡æœ€ç»ˆè¿è¡Œåœ¨æ¬¡çº¿ç¨‹ä¸­class TcpClient : public QTcpSocket Q_OBJECTpublic: TcpClient(QObject *parent = NULL); ~TcpClient();public: // void ClientConnectToHost(const QString address, quint16 port); // void ClientSendingData(const QByteArray c_btaData); // bool IsOnline();signals: //è½¬æ¢æ¥è‡ªä¸»çº¿ç¨‹çš„é“¾æ¥æ“ä½œ void SignalConnectToHost(const QString address, quint16 port);signals: //è½¬æ¢æ¥è‡ªä¸»çº¿ç¨‹çš„å‘é€æ“ä½œ void SignalSendingData(const QByteArray c_btaData);signals: //åœ¨æ¬¡çº¿ç¨‹ä¸­ç¼“å†²å¹¶æ»‘åŠ¨è§£æTCPæµå/æŒ‰çº¦å®šæ ¼å¼å†å‘å¸ƒ void SignalPublishFormatRecvData(const QString c_btaData);private: //æ ‡è®°è¿æ¥æƒ…å†µ bool m_bOnLine = false; //ç¼“å†²æ”¶åˆ°çš„æµæ•°æ® QByteArray m_btaReceiveFromService;; //.cpp#include QThread#include QDebug#include QHostAddress#include tcp_client.hTcpClient::TcpClient(QObject *parent) : QTcpSocket(parent) //è‡ªåŠ¨è¿æ¥åœ¨ä¿¡å·å‘å°„æ—¶è¢«è¯†åˆ«ä¸ºé˜Ÿåˆ—è¿æ¥/ä¿¡å·åœ¨ä¸»çº¿ç¨‹å‘å°„ connect(this, TcpClient::SignalConnectToHost, this, [](const QString address, quint16 port) //test record# in child thread id 20588 qDebug(SlotConnectToHost ThreadID:%d, QThread::currentThreadId()); // connectToHost(QHostAddress(address), port, QIODevice::ReadWrite); , Qt::AutoConnection); //è¿æ¥äº†TCPæœåŠ¡ç«¯ connect(this, QAbstractSocket::connected, this, []() //test record# in child thread id 20588 qDebug(SlotHasConnected ThreadID:%d, QThread::currentThreadId()); // m_bOnLine = true; , Qt::DirectConnection); //æ–­å¼€äº†TCPæœåŠ¡ç«¯ connect(this, QAbstractSocket::disconnected, this, []() //test record# in child thread id 20588 qDebug(SlotHasDisconnected ThreadID:%d, QThread::currentThreadId()); // m_bOnLine = false; , Qt::DirectConnection); //æ”¶åˆ°äº†TCPæœåŠ¡çš„æ•°æ® connect(this, QIODevice::readyRead, this, []() //test record# in child thread id 20588 qDebug(SlotIODeviceReadyRead ThreadID:%d, QThread::currentThreadId()); //è¯»å–å…¨éƒ¨æ•°æ® m_btaReceiveFromService.append(this-readAll()); // int iFindPos = m_btaReceiveFromService.indexOf(\\r ); //æ£€æŸ¥åˆ†éš”ç¬¦ while (-1 != iFindPos) //åˆ†å‰²æ•°æ®æµ QString strPublish = m_btaReceiveFromService.left(iFindPos); //å‘å¸ƒè§£æåçš„æ ¼å¼æ•°æ® emit SignalPublishFormatRecvData(strPublish); // m_btaReceiveFromService.remove(0, iFindPos + strlen(\\r )); // iFindPos = m_btaReceiveFromService.indexOf(\\r ); , Qt::DirectConnection); //æ‰§è¡Œæ•°æ®å‘é€è¿‡ç¨‹ connect(this, TcpClient::SignalSendingData, this, [](const QByteArray c_btaData) //test record# in child thread id 20588 qDebug(SlotSendingData ThreadID:%d, QThread::currentThreadId()); // this-write(c_btaData); , Qt::AutoConnection);//TcpClient::~TcpClient()//è·¨çº¿ç¨‹è½¬æ¢void TcpClient::ClientConnectToHost(const QString address, quint16 port) emit SignalConnectToHost(address, port);//è·¨çº¿ç¨‹è½¬æ¢void TcpClient::ClientSendingData(const QByteArray c_btaData) emit SignalSendingData(c_btaData);//æ˜¯å¦åœ¨çº¿bool TcpClient::IsOnline() return m_bOnLine; //main /using of my tcp clientUpdateCamera::UpdateCamera(QWidget *parent) : QMainWindow(parent) //åˆ›å»ºTCPå®¢æˆ·ç«¯ m_pmyTcpSocket = new TcpClient(); // m_pThreadSending = new QThread(); // m_pmyTcpSocket-moveToThread(m_pThreadSending); // m_pThreadSending-start(); //è¿æ¥åˆ°ç›¸æœºçš„TCPæœåŠ¡ connect(ui.pushButton_connect, QPushButton::clicked, []() ... m_pmyTcpSocket-ClientConnectToHost(strIPUsing, SER_PORT); ); //æ–‡ä»¶å‘é€ connect(ui.pushButton_file_sending, QPushButton::clicked, []() ... //æ‰§è¡Œå®¢æˆ·ç«¯æ–‡ä»¶å‘é€è¿‡ç¨‹ m_pmyTcpSocket-ClientSendingData(DataOfBin); ); //æ¥æ”¶æœåŠ¡ç«¯å‘é€çš„æ•°æ® /ä»å­çº¿ç¨‹åˆ°ä¸»çº¿ç¨‹çš„é˜Ÿåˆ—è¿æ¥ connect(m_pTcpClient, TcpClient::SignalPublishFormatRecvData, this, [](const QString c_btaData) ui.textEdit-append(c_btaData); ui.textEdit-moveCursor(QTextCursor::End); if (ui.textEdit-toPlainText().size() 2 * 1024 * 1024) ui.textEdit-clear(); , Qt::AutoConnection); QIODevice::readyRead ä¿¡å·çš„ DirectConnection è¿æ¥çš„ lambda æ§½å‡½æ•°æ‰§è¡Œç»“æœï¼Œå¯å¾—å‡ºï¼šå¦‚æœä¸€ä¸ª Tcp å¯¹è±¡è¢«å½’å±åˆ°äº†å­çº¿ç¨‹ X ä¸­ï¼Œé‚£ä¹ˆ readyRead ä¿¡å·æœ€ç»ˆå°†ä»æ­¤å­çº¿ç¨‹ X å‘å‡ºã€‚connected ä¿¡å·ã€disconnected ä¿¡å·ç­‰å…¶å‘å°„çº¿ç¨‹ï¼Œéƒ½æ˜¯å¥—æ¥å­—å¯¹è±¡çš„æ‰€åœ¨çº¿ç¨‹ã€‚ å½“ connect å†…éƒ¨ä½¿ç”¨ lambda è¡¨è¾¾å¼åšæ§½å‡½æ•°æ—¶ï¼Œæ³¨æ„é€‰æ‹©æœ‰ Qt::ConnectionType å‚æ•°çš„é‚£ä¸ªå‡½æ•°ç‰ˆæœ¬ï¼Œå¦åˆ™å°†é»˜è®¤ä¸ºç›´æ¥è¿æ¥ã€‚ //é»˜è®¤ä¸ºç›´æ¥è¿æ¥connect(const QObject *sender, PointerToMemberFunction signal, Functor functor)//å¯ä»¥é…ç½®è¿æ¥æ–¹å¼ //Qt::UniqueConnections do not work for lambdasconnect(const QObject *sender, PointerToMemberFunction signal, const QObject *context, Functor functor, Qt::ConnectionType type) é»˜è®¤çš„è¿æ¥æ–¹å¼ Qt::AutoConnection åœ¨ connect åç”Ÿæ•ˆçš„æ—¶åˆ»æ˜¯ emit å‘å°„çš„æ—¶å€™ï¼Œè€Œä¸æ˜¯æ‰§è¡Œ connect è¯­å¥çš„æ—¶å€™ã€‚å› æ­¤å…ˆæ‰§è¡Œ moveToThread è¿˜æ˜¯å…ˆæ‰§è¡Œ connect è¿‡ç¨‹æ˜¯æ— å…³ç´§è¦çš„ã€‚å…·ä½“å¯å‚è§å¸®åŠ©æ–‡æ¡£ä¸­æåŠçš„ï¼šIf the receiver lives in the thread that emits the signal, Qt::DirectConnection is used. Otherwise, Qt::QueuedConnection is used. The connection type is determined when the signal is emitted.","categories":["4.é€šè®¯åè®®","ç½‘ç»œ"]},{"title":"Socketå¥—æ¥å­—","path":"/2023/11/22/4-é€šè®¯åè®®-ç½‘ç»œ-Socketå¥—æ¥å­—/","content":"Socket æœ€åˆæ˜¯ä½œä¸ºç½‘ç»œä¸Šä¸åŒä¸»æœºä¹‹é—´è¿›ç¨‹çš„é€šä¿¡æ¥å£ï¼Œåæ¥åº”ç”¨è¶Šæ¥è¶Šå¹¿ï¼Œåœ¨åŒä¸€ä¸»æœºä¸Šçš„ä¸åŒè¿›ç¨‹ä¹‹é—´é€šä¿¡ä¹Ÿå¯ä»¥ç”¨ Socketã€‚ ç®€å•æ¥è¯´ï¼Œå½“ç½‘ç»œä¸Šä¸åŒä¸»æœºä¹‹é—´çš„ä¸¤ä¸ªè¿›ç¨‹ï¼ˆAã€Bï¼‰é‡‡ç”¨ Socket è¿›è¡Œé€šä¿¡æ—¶ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´éœ€è¦å»ºç«‹ä¸€ä¸ªé€šä¿¡ç«¯ç‚¹ï¼Œå³åˆ›å»º Socketï¼Œåˆ›å»º Socket æ—¶å°±åˆ†é…ç«¯å£å·å’Œç½‘ç»œåœ°å€ã€‚å½“è¿›ç¨‹ A å‘è¿›ç¨‹ B å‘é€æ•°æ®æ—¶ï¼Œè¿›ç¨‹ A å¿…é¡»è¦çŸ¥é“è¿›ç¨‹ B çš„ç½‘ç»œåœ°å€åŠç«¯å£å·ã€‚ Socket é‡‡ç”¨ CS æ¨¡å‹è¿›è¡Œè®¾è®¡çš„ï¼Œå³ ClientServerï¼Œé¢å‘å®¢æˆ·ç«¯â€”æœåŠ¡å™¨æ¨¡å‹ã€‚ æ¯ä¸€ä¸ª Socket éƒ½ç”¨ä¸€ä¸ªåŠç›¸å…³æè¿°ï¼š {åè®®ï¼Œæœ¬åœ°åœ°å€ï¼Œæœ¬åœ°ç«¯å£} ä¸€ä¸ªå®Œæ•´çš„ Socket åˆ™ç”¨ä¸€ä¸ªç›¸å…³æè¿°: {åè®®ï¼Œæœ¬åœ°åœ°å€ï¼Œæœ¬åœ°ç«¯å£ï¼Œè¿œç¨‹åœ°å€ï¼Œè¿œç¨‹ç«¯å£} å¥—æ¥å­—å¥—æ¥å­—ï¼Œå¦å¤–ä¸€ç§è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼ã€‚ä¹‹å‰çš„ IPC æœºåˆ¶åªèƒ½é™å®šåœ¨ä¸€å°è®¡ç®—æœºç³»ç»Ÿä¸Šè¿›è¡Œèµ„æºå…±äº«ã€‚è€Œå¥—æ¥å­—æ¥å£å¯ä»¥ä½¿ï¼Œä¸€å°æœºå™¨ä¸Šçš„è¿›ç¨‹å’Œå¦å¤–ä¸€ä¸ªæœºå™¨ä¸Šçš„è¿›ç¨‹é€šä¿¡ã€‚ ä»€ä¹ˆæ˜¯å¥—æ¥å­—å¥—æ¥å­—æ˜¯ä¸€ç§é€šä¿¡æœºåˆ¶ï¼Œå‡­å€Ÿè¿™ç§æœºåˆ¶ï¼Œå®¢æˆ·æœåŠ¡å™¨ç³»ç»Ÿçš„å·¥ä½œå³å¯ä»¥åœ¨æœ¬åœ°å•æœºä¸Šå·¥ä½œï¼Œä¹Ÿå¯ä»¥è·¨ç½‘ç»œè¿›è¡Œã€‚ å¥—æ¥å­—å’Œç®¡é“ç±»å‹ï¼ŒåŒæ ·æ˜¯è¯»å†™ç±»æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œã€‚ä¸åŒçš„æ˜¯ï¼Œå¥—æ¥å­—æ˜ç¡®çš„å°†å®¢æˆ·å’ŒæœåŠ¡å™¨åˆ†å¼€æ¥ã€‚å¥—æ¥å­—æœºåˆ¶å¯ä»¥å®ç°å¤šä¸ªå®¢æˆ·è¿æ¥ä¸€ä¸ªæœåŠ¡å™¨ã€‚ å¥—æ¥å­—è¿æ¥é¦–å…ˆï¼ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºä½¿ç”¨ socket æ¥åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼Œå®ƒæ˜¯ç³»ç»Ÿåˆ†é…ç»™è¯¥æœåŠ¡å™¨è¿›ç¨‹çš„ç±»ä¼¼æ–‡ä»¶æ ‡è¯†ç¬¦çš„èµ„æºï¼Œå®ƒä¸èƒ½ä¸å…¶å®ƒè¿›ç¨‹å…±äº«ã€‚psï¼šçº¿ç¨‹è²Œä¼¼ä¹Ÿä¸è¡Œã€‚ æ¥ä¸‹æ¥ï¼ŒæœåŠ¡å™¨è¿›ç¨‹ä¼šç»™å¥—æ¥å­—èµ·ä¸ªåå­—ã€‚æœ¬åœ°å¥—æ¥å­—çš„åå­—æ˜¯ Linux æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶åã€‚å¯¹äºç½‘ç»œå¥—æ¥å­—ï¼Œå®ƒçš„åå­—æ˜¯ä¸å®¢æˆ·è¿æ¥çš„ç‰¹å®šç½‘ç»œæœ‰å…³çš„æœåŠ¡æ ‡è¯†ç¬¦ï¼ˆç«¯å£å·æˆ–è®¿é—®ç‚¹ï¼‰ã€‚è¿™ä¸ªæ ‡è¯†ç¬¦å°†å…è®¸ Linux å°†è¿›å…¥é’ˆå¯¹ç‰¹å®šç«¯å£å·çš„è¿æ¥è½¬æ¥åˆ°æ­£ç¡®çš„æœåŠ¡å™¨è¿›ç¨‹ã€‚ä¾‹å¦‚ï¼šWeb æœåŠ¡å™¨ä¸€èˆ¬åœ¨ 80 ç«¯å£ä¸Šåˆ›å»ºæœ‰å…³å¥—æ¥å­—ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸“ç”¨äºæ­¤ç›®çš„çš„æ ‡è¯†ç¬¦ã€‚Web æµè§ˆå™¨çŸ¥é“å¯¹äºç”¨æˆ·æƒ³è®¿é—®çš„ Web èŠ‚ç‚¹ï¼Œåº”è¯¥ä½¿ç”¨ç«¯å£ 80 æ¥å»ºç«‹ HTTP è¿æ¥ã€‚ ç”¨ç³»ç»Ÿè°ƒç”¨ bind æ¥ç»™å¥—æ¥å­—å‘½å(å…³è”äºæœ¬åœ°æŸä¸ªæ–‡ä»¶)ç„¶åæœåŠ¡å™¨è¿›ç¨‹å°±å¼€å§‹ç­‰å¾…å®¢æˆ·è¿æ¥è¿™ä¸ªå‘½åå¥—æ¥å­—ã€‚ç³»ç»Ÿè°ƒç”¨ listen çš„ä½œç”¨æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—å¹¶å°†å…¶ç”¨äºå­˜æ”¾æ¥è‡ªå®¢æˆ·çš„è¯·æ±‚è¿æ¥ã€‚æœåŠ¡å™¨é€šè¿‡ç³»ç»Ÿè°ƒç”¨ accept æ¥æ¥å—å®¢æˆ·çš„è¿æ¥ã€‚æœåŠ¡å™¨è°ƒç”¨ accept æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªä¸åŸæ¥çš„å‘½åå¥—æ¥å­—ä¸åŒçš„æ–°å¥—æ¥å­—ã€‚è¿™ä¸ªå¥—æ¥å­—åªç”¨æ¥ä¸è¿™ä¸ªç‰¹å®šå®¢æˆ·è¿›è¡Œé€šä¿¡ï¼Œè€Œå‘½åå¥—æ¥å­—åˆ™è¢«ä¿ç•™ä¸‹æ¥ç»§ç»­å¤„ç†æ¥è‡ªå…¶å®ƒå®¢æˆ·çš„è¿æ¥ã€‚ åŸºäºå¥—æ¥å­—ç³»ç»Ÿçš„å®¢æˆ·ç«¯æ›´åŠ ç®€å•ã€‚å®¢æˆ·é¦–å…ˆè°ƒç”¨ socket åˆ›å»ºä¸€ä¸ªæœªå‘½åå¥—æ¥å­—ï¼Œç„¶åå°†æœåŠ¡å™¨çš„å‘½åå¥—æ¥å­—ä½œä¸ºä¸€ä¸ªåœ°å€ï¼ˆæˆ–æ ‡è¯†ç¬¦ï¼‰æ¥è°ƒç”¨ connect ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚ ä¸€æ—¦è¿æ¥å»ºç«‹ï¼Œå°±å¯ä»¥æƒ³ä½¿ç”¨åº•å±‚çš„æ–‡ä»¶æè¿°ç¬¦é‚£æ ·ç”¨å¥—æ¥å­—æ¥å®ç°åŒå‘çš„æ•°æ®é€šä¿¡ã€‚ å¥—æ¥å­—å±æ€§å¥—æ¥å­—çš„ç‰¹æ€§æœ‰ 3 ä¸ªå±æ€§ç¡®å®šï¼Œå®ƒä»¬æ˜¯ï¼šåŸŸï¼ˆdomainï¼‰ã€ç±»å‹ï¼ˆtypeï¼‰å’Œåè®®ï¼ˆprotocolï¼‰ å¥—æ¥å­—çš„åŸŸåŸŸæŒ‡å®šå¥—æ¥å­—é€šä¿¡ä¸­ä½¿ç”¨çš„ç½‘ç»œä»‹è´¨ã€‚ æœ€å¸¸è§çš„å¥—æ¥å­—åŸŸæ˜¯ AF_INET,å®ƒæŒ‡çš„æ˜¯ Internet ç½‘ç»œã€‚è®¸å¤š Linux å±€åŸŸç½‘ä½¿ç”¨çš„éƒ½æ˜¯æ­¤ç½‘ç»œã€‚ è¿˜æœ‰ä¸€ä¸ªåŸŸæ˜¯ UNIX æ–‡ä»¶ç³»ç»ŸåŸŸ AF_UNIX,å³ä½¿ä¸€å°è¿˜æœªè”ç½‘çš„è®¡ç®—æœºä¸Šçš„å¥—æ¥å­—ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªåŸŸã€‚è¿™ä¸ªåŸŸçš„åº•å±‚åè®®å°±æ˜¯æ–‡ä»¶è¾“å…¥è¾“å‡ºï¼Œè€Œå®ƒçš„åœ°å€å°±æ˜¯æ–‡ä»¶åã€‚å½“è¿è¡Œè¿™ä¸ªç¨‹åºæ—¶ï¼Œå°±å¯ä»¥åœ¨å½“å‰ç›®å½•ä¸‹çœ‹åˆ°è¿™ä¸ªåœ°å€ã€‚ æœåŠ¡å™¨è®¡ç®—æœºä¸Šå¯èƒ½æœ‰å¤šä¸ªæœåŠ¡å™¨æ­£åœ¨è¿è¡Œã€‚å®¢æˆ·å¯ä»¥é€šè¿‡ IP ç«¯å£æ¥æŒ‡å®šä¸€å°æœºå™¨ä¸ŠæŸä¸ªç‰¹å®šæœåŠ¡ã€‚åœ¨ç³»ç»Ÿå†…éƒ¨ï¼Œç«¯å£é€šè¿‡åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ 16 ä½çš„æ•´æ•°æ¥æ ‡è¯†ï¼Œåœ¨ç³»ç»Ÿå¤–éƒ¨ï¼Œåˆ™éœ€è¦é€šè¿‡ IP åœ°å€å’Œç«¯å£å·çš„ç»„åˆæ¥ç¡®å®šã€‚å¥—æ¥å­—ä½œä¸ºé€šä¿¡çš„ç»ˆç‚¹ï¼Œå®ƒå¿…é¡»åœ¨å¼€å§‹é€šä¿¡ä¹‹å‰ç»‘å®šä¸€ä¸ªç«¯å£ã€‚çŸ¥åçš„æœåŠ¡é€šå¸¸ä¹Ÿæœ‰ä¸€äº›ç«¯å£ï¼Œæ¯”å¦‚ ftpï¼ˆ21ï¼‰å’Œ httpdï¼ˆ80ï¼‰ç­‰ã€‚åœ¨é€‰æ‹©ç«¯å£æ—¶ä¸è¦éšæ„é€‰æ‹©ä»¥é¿å…ç«¯å£è¢«å ç”¨çš„æƒ…å†µã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå°äº 1024 çš„ç«¯å£å·éƒ½æ˜¯ä¸ºç³»ç»ŸæœåŠ¡ä¿ç•™çš„ã€‚ å¥—æ¥å­—ç±»å‹ä¸€ä¸ªå¥—æ¥å­—åŸŸå¯èƒ½æœ‰å¤šç§ä¸åŒçš„é€šä¿¡æ–¹å¼ï¼Œè€Œæ¯ç§é€šä¿¡æ–¹å¼åˆæœ‰å…¶ä¸åŒçš„ç‰¹æ€§ã€‚ä½† AF_UNIX åŸŸçš„å¥—æ¥å­—æ²¡æœ‰è¿™æ ·çš„é—®é¢˜ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå¯é çš„åŒå‘é€šä¿¡è·¯å¾„ã€‚åœ¨ç½‘ç»œåŸŸä¸­ï¼Œå°±éœ€è¦æ³¨æ„åº•å±‚ç½‘ç»œçš„ç‰¹æ€§ï¼Œä»¥åŠä¸åŒçš„é€šä¿¡æœºåˆ¶æ˜¯å¦‚ä½•å—åˆ°å®ƒä»¬çš„å½±å“ã€‚ å› ç‰¹ç½‘æä¾›äº†ä¸¤ç§é€šä¿¡æœºåˆ¶ï¼šæµï¼ˆstreamï¼‰å’Œæ•°æ®åŒ…ï¼ˆdatagramï¼‰ã€‚ä»–ä»¬æœ‰ç€æˆªç„¶ä¸åŒçš„æœåŠ¡å±‚æ¬¡ã€‚ æµå¥—æ¥å­— æµå¥—æ¥å­—ï¼ˆåœ¨æŸäº›æ–¹é¢ç±»ä¼¼äºæ ‡å‡†è¾“å…¥è¾“å‡ºæµï¼‰æä¾›çš„æ˜¯ä¸€ä¸ªæœ‰åºã€å¯é ã€åŒå‘å­—èŠ‚æµçš„è¿æ¥ã€‚psï¼šä½¿ç”¨ TCP ä¸­çš„åºå·æœºåˆ¶ä¿è¯å¤§çš„æ¶ˆæ¯å°†è¢«åˆ†ç‰‡ã€ä¼ è¾“ã€å†é‡ç»„ã€‚è¿™å¾ˆåƒä¸€ä¸ªæ–‡ä»¶æµï¼Œå®ƒæ¥å—å¤§é‡çš„æ•°æ®ï¼Œç„¶åä»¥å°æ•°æ®å—çš„å½¢å¼å°†å®ƒä»¬å†™å…¥åº•å±‚ç£ç›˜ã€‚ æµå¥—æ¥å­—ç”±åº•å±‚ SOCK_STREAM æŒ‡å®šï¼Œå®ƒä»¬æ˜¯åœ¨ AF_INET åŸŸä¸­é€šè¿‡ TCPIP è¿æ¥å®ç°ã€‚ TCPIP ä»£è¡¨çš„æ˜¯ä¼ è¾“æ§åˆ¶åè®®ï¼ˆTransmission Control Protocolï¼‰ç½‘é™…åè®®ï¼ˆInternet Protocolï¼‰ã€‚IP åè®®æ˜¯é’ˆå¯¹æ•°æ®åŒ…çš„åº•å±‚åè®®ï¼Œå®ƒæä¾›ä¸€å°è®¡ç®—æœºé€šè¿‡ç½‘ç»œåˆ°è¾¾å¦ä¸€å°è®¡ç®—æœºçš„è·¯ç”±ã€‚TCP åè®®æä¾›æ’åºã€æµæ§å’Œé‡ä¼ ï¼Œä»¥ä¿è¯å¤§æ•°æ®çš„ä¼ è¾“å¯ä»¥å®Œæ•´åœ°åˆ°è¾¾ç›®çš„åœ°æˆ–æŠ¥å‘Šä¸€ä¸ªé€‚å½“çš„é”™è¯¯æ¡ä»¶ã€‚ æ•°æ®æŠ¥å¥—æ¥å­— ä¸æµå¥—æ¥å­—ç›¸åï¼Œç”±ç±»å‹ SOCK_DGRAM æŒ‡å®šçš„æ•°æ®æŠ¥å¥—æ¥å­—ä¸å»ºç«‹å’Œç»´æŒä¸€ä¸ªè¿æ¥ã€‚å®ƒå¯¹å¯ä»¥å‘é€çš„æ•°æ®æŠ¥çš„é•¿åº¦æœ‰é™åˆ¶ã€‚æ•°æ®æŠ¥ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ç½‘ç»œæ¶ˆæ¯è¢«ä¼ è¾“ï¼Œå®ƒå¯èƒ½ä¸¢å¤±ã€å¤åˆ¶æˆ–æ— åºåˆ°è¾¾ã€‚ æ•°æ®æŠ¥å¥—æ¥å­—åœ¨ AF_INET åŸŸä¸­é€šè¿‡ UDPIP è¿æ¥å®ç°ï¼Œå®ƒæä¾›çš„æ˜¯ä¸€ç§æ— åºçš„ä¸å¯é æœåŠ¡ã€‚ä½†ä»èµ„æºçš„è§’åº¦æ¥çœ‹ï¼Œç›¸å¯¹æ¥è¯´å®ƒä»¬å¼€é”€æ¯”è¾ƒå°ï¼Œå› æ­¤ä¸éœ€è¦ç»´æŠ¤ç½‘ç»œè¿æ¥ã€‚è€Œä¸”ä¸éœ€è¦èŠ±è´¹æ—¶é—´æ¥å»ºç«‹è¿æ¥ï¼Œæ‰€ä»¥å®ƒä»¬çš„é€Ÿåº¦ä¹Ÿå¾ˆå¿«ã€‚ æ•°æ®åŒ…é€‚ç”¨äºä¿¡æ¯æœåŠ¡ä¸­çš„â€å•æ¬¡ï¼ˆsingle-shotï¼‰â€æŸ¥è¯¢ï¼Œå®ƒä¸»è¦ç”¨æ¥æä¾›æ—¥å¸¸çŠ¶æ€ä¿¡æ¯æˆ–æ‰§è¡Œä½ä¼˜å…ˆçº§çš„æ—¥å¿—è®°å½•ã€‚æœåŠ¡å™¨çš„å¥”æºƒä¸ä¼šç»™å®¢æˆ·é€ æˆä¸ä¾¿ï¼Œä¹Ÿä¸ä¼šè¦æ±‚å®¢æˆ·é‡å¯ã€‚ å­—èŠ‚æµå¥—æ¥å­—ï¼ˆSOCK_STREAMï¼‰å­—èŠ‚æµçš„å¥—æ¥å­—å¯ä»¥æä¾›å¯é çš„æ•°æ®ä¼ è¾“ã€é¢å‘è¿æ¥çš„é€šè®¯æµã€‚æ•°æ®æŒ‰ä½•ç§é¡ºåºå‘é€ï¼Œå°±æŒ‰ä½•ç§é¡ºåºæ¥æ”¶ã€‚ä¾‹å¦‚ï¼Œå½“æŒ‰é¡ºåºå‘é€ A-B-Cï¼Œé‚£ä¹ˆåœ¨æ•°æ®åˆ°è¾¾æ¥æ”¶ç«¯æ—¶ï¼Œå®ƒçš„é¡ºåºä¹Ÿæ˜¯ A-B-Cã€‚å­—èŠ‚æµå¥—æ¥å­—é‡‡ç”¨çš„æ˜¯ TCPï¼ˆTransmission Control Protocolï¼‰åè®®ã€‚ä¿è¯äº†æ•°æ®ä¼ è¾“çš„å¯é æ€§ã€‚ æ•°æ®æŠ¥å¥—æ¥å­—ï¼ˆSOCK_DGRAMï¼‰æ•°æ®æŠ¥å¥—æ¥å­—å®šä¹‰äº†ä¸€ç§æ— è¿æ¥çš„æœåŠ¡ã€‚æ‰€è°“æ— è¿æ¥æœåŠ¡ï¼Œç®€å•æ¥è¯´ï¼Œå³åœ¨å‘é€æ•°æ®æ—¶ï¼Œæ— éœ€åœ¨æ”¶å‘ä¸¤ç«¯å»ºç«‹ç±»ä¼¼ TCP é‚£æ ·çš„æ¡æ‰‹è¿æ¥ï¼Œåœ¨å‘é€æ—¶ï¼Œå°†æ•°æ®æ‰“åŒ…ï¼Œç„¶ååŠ ä¸Šè¿œç¨‹ IP åœ°å€ï¼Œå³å¯æŠŠè¯¥æ•°æ®åŒ…å‘é€å‡ºå»ã€‚ æ•°æ®é€šè¿‡ç›¸äº’ç‹¬ç«‹çš„æŠ¥æ–‡è¿›è¡Œä¼ è¾“ã€‚å¹¶ä¸”æ˜¯æ— åºçš„ã€ä¸å¯é çš„ä¼ è¾“ã€‚ åŸå§‹å¥—æ¥å­—ï¼ˆSOCK_ROWï¼‰å…ˆå¯åŠ¨æœåŠ¡å™¨ï¼Œé€šè¿‡è°ƒç”¨ socket() å‡½æ•°å»ºç«‹ä¸€ä¸ªå¥—æ¥å­—ï¼Œç„¶åè°ƒç”¨ bind() å‡½æ•°å°†è¯¥å¥—æ¥å­—å’Œæœ¬åœ°ç½‘ç»œåœ°å€è”ç³»åœ¨ä¸€èµ·ï¼Œå†è°ƒç”¨ listen() å‡½æ•°ä½¿å¥—æ¥å­—åšå¥½ä¾¦å¬çš„å‡†å¤‡ï¼Œå¹¶è§„å®šå®ƒçš„è¯·æ±‚é˜Ÿåˆ—çš„é•¿åº¦ï¼Œä¹‹åå°±è°ƒç”¨ accept() å‡½æ•°æ¥æ¥æ”¶è¿æ¥ã€‚ å®¢æˆ·ç«¯åœ¨å»ºç«‹å¥—æ¥å­—ä¹‹åå°±å¯è°ƒç”¨ connect() å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚ è¿æ¥ä¸€æ—¦å»ºç«‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å°±å¯ä»¥é€šè¿‡è°ƒç”¨ recv()recvfrom() å‡½æ•°å’Œ send()sendto å‡½æ•°æ¥è¿›è¡Œå‘æ”¶æ•°æ®ã€‚ æœ€åï¼Œå¾…æ•°æ®ä¼ é€ç»“æŸåï¼ŒåŒæ–¹è°ƒç”¨ close() å‡½æ•°å…³é—­å¥—æ¥å­—ã€‚ å¥—æ¥å­—åè®®æš‚æ—¶ä½¿ç”¨é»˜è®¤å€¼ã€‚ åˆ›å»ºå¥—æ¥å­—socket ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—å¹¶è¿”å›ä¸€ä¸ªæè¿°ç¬¦ï¼Œè¯¥æè¿°ç¬¦å¯ä»¥ç”¨æ¥è®¿é—®è¯¥å¥—æ¥å­—ã€‚ int socket(int domain, int type, int protocol); åˆ›å»ºçš„å¥—æ¥å­—æ˜¯ä¸€æ¡é€šä¿¡çº¿è·¯çš„ä¸€ä¸ªç«¯ç‚¹ã€‚domin æŒ‡å®šåè®®æ—ï¼Œtype æŒ‡å®šè¿™ä¸ªå¥—æ¥å­—çš„é€šä¿¡ç±»å‹ï¼Œprotocol æŒ‡å®šä½¿ç”¨çš„åè®®ã€‚ å‚æ•° domain çš„å–å€¼åŒ…æ‹¬ï¼šAF_UNIX å’Œ AF_INET å‰è€…ç”¨äº UNIX å’Œ Linux æ–‡ä»¶ç³»ç»Ÿå®ç°æœ¬åœ°å¥—æ¥å­—ï¼Œåè€…ç”¨äº UNIX ç½‘ç»œå¥—æ¥å­—ï¼Œé€šè¿‡åŒ…æ‹¬å› ç‰¹ç½‘åœ¨å†…çš„ TCPIP ç½‘ç»œè¿›è¡Œé€šä¿¡çš„ç¨‹åºã€‚ å‚æ•° type å–å€¼åŒ…æ‹¬ï¼šSOCK_STREAM å’Œ SOCK_DGRAM protocolï¼šé€šå¸¸ä¸éœ€è¦é€‰æ‹©ï¼Œå°†è¯¥å‚æ•°è®¾ä¸º 0 è¡¨ç¤ºä½¿ç”¨é»˜è®¤åè®®ã€‚ å¥—æ¥å­—åœ°å€æ¯ä¸ªå¥—æ¥å­—åŸŸéƒ½æœ‰å…¶ä¹‹é—´çš„åœ°å€æ ¼å¼ã€‚ åœ¨ AF_UNIX åŸŸä¸­ï¼Œå¥—æ¥å­—çš„åœ°å€ç”±ç»“æ„ sockaddr_un æ¥è¡¨ç¤ºï¼Œè¯¥ç»“æ„å®šä¹‰åœ¨å¤´æ–‡ä»¶ sysun.h ä¸­ã€‚ struct sockaddr_un sa_family_t sun_family; /*AF_INET*/ char sun_path[]; /*pathname*/; åœ¨ AF_UNIX åŸŸä¸­ï¼Œå¥—æ¥å­—çš„åœ°å€ç”± char sun_path[]æŒ‡å®šã€‚ åœ¨ AF_INET åŸŸä¸­ï¼Œå¥—æ¥å­—çš„åœ°å€ç”± sockadd_in æ¥æŒ‡å®šã€‚è¯¥ç»“æ„å®šä¹‰åœ¨ netinetin.h ä¸­ï¼Œå®ƒè‡³å°‘åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæˆå‘˜ï¼š struct sockaddr_in short int sin_family; /*AF_INET*/ unsigned short int sin_prot; /*Port number*/ struct in_addr sin_addr; /*Internet address*/;struct in_addr unsigned long int s_addrï¼›ï¼› å‘½åå¥—æ¥å­—è¦æƒ³è®© socket åˆ›å»ºçš„å¥—æ¥å­—å¯ä»¥è¢«å…¶å®ƒè¿›ç¨‹ä½¿ç”¨ï¼ŒæœåŠ¡å™¨ç¨‹åºå°±å¿…é¡»ç»™è¯¥å¥—æ¥å­—å‘½åï¼Œå³å°†å¥—æ¥å­—å…³è”åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„è·¯å¾„åã€‚ int bind(int sockfd,const struct sockaddr * address,siz_t address_len); bind ç³»ç»Ÿè°ƒç”¨ address çš„åœ°å€å€¼ä¸æ–‡ä»¶æè¿°ç¬¦ socket çš„æœªå‘½åå¥—æ¥å­—ç›¸å…³è”ã€‚åœ°å€ç»“æ„ä½“çš„é•¿åº¦ç”± address_len ä¼ é€’ã€‚ ä¼ å…¥å‚æ•°æ—¶éœ€è¦å°†ä¸€ä¸ªç‰¹å®šçš„åœ°å€ç»“æ„ä½“æŒ‡é’ˆï¼ˆstruct sockaddr_inunï¼‰è½¬æ¢ä¸ºæ‰§è¡Œé€šç”¨åœ°å€ç±»å‹(struct sockaddr)ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›-1 å¹¶è®¾ç½® errno åˆ›å»ºå¥—æ¥å­—é˜Ÿåˆ—ä¸ºäº†æ¥å—å¤šä¸ªå¥—æ¥å­—ï¼ˆå®¢æˆ·ç«¯ï¼‰çš„è¿æ¥ï¼ŒæœåŠ¡å™¨ç¨‹åºå¿…é¡»åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—æ¥ä¿å­˜æœªå¤„ç†çš„è¯·æ±‚ã€‚å®ƒç”¨ listen ç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆè¿™ä¸€æ“ä½œã€‚ int listen(int socket,int backlog); arg1ï¼šå‘½åå¥—æ¥å­—ï¼Œarg2ï¼šé˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ï¼Œå³ç­‰å¾…å¤„ç†è¿›å…¥çš„å®¢æˆ·ç«¯ä¸ªæ•°ï¼Œè¶…è¿‡åˆ™å¯¼è‡´å®¢æˆ·ç«¯è¯·æ±‚å¤±è´¥ã€‚ä¸ bind è¿”å›ç›¸åŒï¼ŒæˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›-1 å¹¶è®¾ç½® errno æ¥å—è¿æ¥accept ç³»ç»Ÿè°ƒç”¨æ¥ç­‰å¾…å®¢æˆ·å»ºç«‹å¯¹è¯¥å¥—æ¥å­—çš„è¿æ¥ã€‚ int accept(int socket, struct sockaddr * address, size_t *address_len); accept ç³»ç»Ÿè°ƒç”¨åªæœ‰å½“å®¢æˆ·ç«¯è¯•å›¾è¿æ¥åˆ°ç”± socket å‚æ•°æŒ‡å®šçš„å¥—æ¥å­—ä¸Šæ—¶æ‰è¿”å›ã€‚è¿™é‡Œçš„å®¢æˆ·æŒ‡ï¼Œåœ¨å¥—æ¥å­—é˜Ÿåˆ—ä¸­æ’åœ¨ç¬¬ä¸€ä¸ªçš„æœªå¤„ç†è¿æ¥ã€‚ å¥—æ¥å­—å¿…é¡»å…ˆç”± bind è°ƒç”¨å…³è”ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„è·¯å¾„åï¼ˆå³ä¸ºå¥—æ¥å­—å‘½åï¼‰ï¼Œç„¶åç”± listen è°ƒç”¨ä¸ºå…¶åˆ†é…ä¸€ä¸ªè¿æ¥é˜Ÿåˆ—ã€‚ è¿æ¥å®¢æˆ·çš„åœ°å€å°†è¢«æ”¾åˆ° address å‚æ•°æŒ‡å‘çš„ sockaddr ç»“æ„ä¸­ã€‚å¦‚æœä¸å…³å¿ƒå®¢æˆ·ç«¯çš„åœ°å€ï¼Œåˆ™å°†å…¶å€¼è®¾ä¸º NULL å³å¯ã€‚ å‚æ•° address_len æŒ‡å®šå®¢æˆ·ç»“æ„çš„é•¿åº¦ã€‚å¦‚æœå®¢æˆ·åœ°å€çš„é•¿åº¦è¶…è¿‡è¿™ä¸ªå€¼ï¼Œå®ƒå°†è¢«æˆªæ–­ã€‚ å¦‚æœå¥—æ¥å­—é˜Ÿåˆ—ä¸­æ²¡æœ‰æœªå¤„ç†çš„è¿æ¥ã€‚accept å°†å µå¡ç›´åˆ°æœ‰å®¢æˆ·å»ºç«‹è¿æ¥ä¸ºæ­¢ã€‚å¯ä»¥é€šè¿‡å¯¹å¥—æ¥å­—æè¿°ç¬¦è®¾ç½® O_NONBLOCK æ ‡å¿—æ¥æ”¹å˜è¿™ä¸€è¡Œä¸ºï¼Œä½¿ç”¨å‡½æ•° fcntlã€‚ int flags = fcntl(socket,F_GETFL,0);fcntl(socket,F_SETFL,O_NONBLOCK | flags) å½“æœ‰æœªå¤„ç†çš„å®¢æˆ·è¿æ¥æ—¶ï¼Œaccept å‡½æ•°å°†è¿”å›ä¸€ä¸ªæ–°çš„å¥—æ¥å­—æè¿°ç¬¦ã€‚å‘é€é”™è¯¯æ—¶ï¼Œè¿”å›-1 å¹¶è®¾ç½® errno è¯·æ±‚è¿æ¥å®¢æˆ·ç¨‹åºé€šè¿‡ä¸€ä¸ªæœªå‘½åçš„å¥—æ¥å­—å’ŒæœåŠ¡å™¨ç›‘å¬å¥—æ¥å­—ä¹‹é—´å»ºç«‹è¿æ¥çš„æ–¹æ³•æ¥è¿æ¥åˆ°æœåŠ¡å™¨ã€‚ä½¿ç”¨ connect è°ƒç”¨ int connect(int sockfd, const struct sockaddr *address, size_t address_len); å‚æ•° socket æŒ‡å®šçš„å¥—æ¥å­—å°†è¿æ¥åˆ°å‚æ•° address æŒ‡å®šçš„æœåŠ¡å™¨å¥—æ¥å­—ï¼Œaddress æŒ‡å‘çš„ç»“æ„çš„é•¿åº¦æœ‰å‚æ•° address_len æŒ‡å®šã€‚ å‚æ•° sockfd æŒ‡å®šçš„å¥—æ¥å­—å¿…é¡»é€šè¿‡ socket è°ƒç”¨è·å¾—ä¸€ä¸ªæœ‰æ•ˆçš„æ–‡ä»¶æè¿°ç¬¦ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›-1ï¼Œè®¾ç½® errnoã€‚ å¦‚æœè¿æ¥ä¸èƒ½ç«‹åˆ»å»ºç«‹ï¼Œconnect è°ƒç”¨å°†è¢«å µå¡ä¸€æ®µä¸ç¡®å®šçš„è¶…æ—¶æ—¶é—´ã€‚ä¸€æ—¦è¶…æ—¶æ—¶é—´åˆ°è¾¾ï¼Œè¿æ¥å°†è¢«æ”¾å¼ƒï¼Œconnect è°ƒç”¨å¤±è´¥ã€‚ä½†å¦‚æœ connect è°ƒç”¨è¢«ä¸€ä¸ªä¿¡å·ä¸­æ–­ï¼Œè€Œè¯¥ä¿¡å·åˆå¾—åˆ°äº†å¤„ç†ï¼Œconnect è¿˜ä¼šå¤±è´¥ã€‚ å…³é—­å¥—æ¥å­—ä½¿ç”¨ close å‡½æ•°æ¥ç»ˆæ­¢æœåŠ¡å™¨å’Œå®¢æˆ·ä¸Šçš„å¥—æ¥å­—è¿æ¥ï¼Œå°±å¦‚åŒå¯¹åº•å±‚æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œå…³é—­ä¸€æ ·ã€‚åº”è¯¥æ€»æ˜¯åœ¨è¿æ¥çš„ä¸¤ç«¯éƒ½å…³é—­å¥—æ¥å­—ã€‚å¯¹äºæœåŠ¡å™¨æ¥è¯´ï¼Œåº”è¯¥åœ¨ read è°ƒç”¨è¿”å›ä¸º 0 å³æ²¡æœ‰æ•°æ®å¯è¯»çš„æƒ…å†µä¸‹å…³é—­å¥—æ¥å­—ï¼Œä½†å¦‚æœæœ‰ä¸€ä¸ªå¥—æ¥å­—æ˜¯ä¸€ä¸ªé¢å‘è¿æ¥ç±»å‹çš„ï¼Œå¹¶ä¸”è®¾ç½®äº† SOCK_LINGER é€‰é¡¹ï¼Œclose è°ƒç”¨ä¼šåœ¨è¯¥å¥—æ¥å­— è¿˜æœ‰æœªä¼ è¾“æ•°æ®æ—¶å µå¡ã€‚æ­¤ä¸¾ï¼Œéœ€è¦è®¾ç½®å¥—æ¥å­—é€‰é¡¹ã€‚ å¥—æ¥å­—é€šä¿¡æ–‡ä»¶ç³»ç»Ÿå¥—æ¥å­—çš„ç¼ºç‚¹æ˜¯ï¼Œé™¤éç¨‹åºå‘˜ä½¿ç”¨ä¸€ä¸ªç»å¯¹è·¯å¾„åï¼Œå¦åˆ™å¥—æ¥å­—å°†åˆ›å»ºåœ¨æœåŠ¡å™¨çš„å·¥ä½œç›®å½•ä¸‹ã€‚ ä¸ºäº†æ¥å—å®¢æˆ·çš„è¿æ¥ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨åŠå®¢æˆ·éƒ½å¯è®¿é—®çš„å…¨å±€ç›®å½•ï¼ˆå¦‚ï¼štmp ç›®å½•ï¼‰ã€‚ è€Œå¯¹ç½‘ç»œå¥—æ¥å­—æ¥è¯´ï¼Œåªéœ€è¦é€‰æ‹©ä¸€ä¸ªæœªè¢«ä½¿ç”¨çš„ç«¯å£å·å³å¯ã€‚ å…¶å®ƒç«¯å£å·åŠé€šè¿‡ä»–ä»¬æä¾›çš„æœåŠ¡é€šå¸¸éƒ½åˆ—åœ¨ç³»ç»Ÿæ–‡ä»¶etcservices ä¸­ï¼Œåœ¨é€‰æ‹©ç«¯å£å·ï¼Œæ³¨æ„ä¸å¥½é€‰æ‹©åœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£å·ã€‚ å…¶å®ä¹Ÿä¸ç”¨çœ‹ï¼Œæ²¡æœ‰é‚£ä¹ˆå¥½çš„è¿æ°”èƒ½ç¢°åˆ°ï¼Œåªè¦é€‰æ‹©ç«¯å£å·åœ¨ 3000 ä»¥ä¸Šï¼Œåº”è¯¥å°±æ²¡äº‹ã€‚ å‡ºäºæ¼”ç¤ºçš„ç›®çš„ï¼Œå°†ä½¿ç”¨è¿™ä¸ªå›è·¯ç½‘è·¯ï¼ˆä¸€ä¸ªåªåŒ…å«å®ƒè‡ªèº«çš„å›è·¯ï¼ˆloopbackï¼‰ç½‘è·¯ï¼‰ã€‚å›è·¯ç½‘ç»œå¯¹äºè°ƒè¯•ç½‘ç»œåº”ç”¨ç¨‹åºå¾ˆæœ‰ç”¨å¤„ï¼Œå› ä¸ºå®ƒæ’é™¤äº†ä»»ä½•å¤–éƒ¨ç½‘ç»œé—®é¢˜ã€‚å›è·¯ç½‘è·¯ä¸­åªåŒ…å«ä¸€å°è®¡ç®—æœºï¼Œä¼ ç»Ÿä¸Šå®ƒè¢«ç§°ä¸º localhostï¼Œæ ‡å‡†åœ°å€ï¼š127.0.0.1ã€‚ æ¯ä¸€ä¸ªä¸è®¡ç®—æœºè¿›è¡Œé€šä¿¡çš„ç½‘è·¯éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„ç¡¬ä»¶æ¥å£ã€‚ä¸€å°è®¡ç®—æœºå¯èƒ½åœ¨æ¯ä¸ªç½‘ç»œä¸­éƒ½æœ‰ä¸€ä¸ªä¸åŒçš„ç½‘è·¯åã€‚å½“ç„¶ä¹Ÿå°±ä¼šæœ‰å‡ ä¸ªä¸åŒçš„ IP åœ°å€ã€‚ ä¸»æœºå­—èŠ‚åºå’Œç½‘ç»œå­—èŠ‚åºåœ¨ Linux æœºå™¨ä¸Šè¿è¡Œæ–°ç‰ˆæœ¬çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ—¶ï¼Œå¯ä»¥ç”¨ netstat å‘½ä»¤æ¥æŸ¥çœ‹ç½‘è·¯è¿æ¥æƒ…å†µã€‚ $ netstat -A inetActive Internet connections (w/o servers)Proto Recv-Q Send-Q Local Address Foreign Address Statetcp 0 0 localhost:9741 localhost:51246 TIME_WAIT ç°åœ¨å¯ä»¥çœ‹åˆ°è¿™æ¡å¯¹åº”çš„æœåŠ¡å™¨å’Œå®¢æˆ·çš„ç«¯å£å·ã€‚ Local Address ä¸€æ æ˜¾ç¤ºçš„æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£å·ï¼ŒForeign Address ä¸€æ æ˜¾ç¤ºçš„è¿œç¨‹å®¢æˆ·çš„åœ°å€å’Œç«¯å£å·ã€‚ å¯æ˜¯ï¼Œå½“åœ¨ç¨‹åºä¸­é€‰æ‹©çš„ç«¯å£ä¸º 3366 æ—¶ï¼Œåœ¨å‘½ä»¤ä¸­è¾“å‡ºçš„å´æ˜¯ 9741.ä¸ºä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ï¼šé€šè¿‡å¥—æ¥å­—ä¼ é€’çš„ç«¯å£å·å’Œåœ°å€éƒ½æ˜¯äºŒè¿›åˆ¶æ•°å­—ã€‚ä¸åŒçš„è®¡ç®—æœºä½¿ç”¨ä¸åŒçš„å­—èŠ‚åºæ¥è¡¨ç¤ºæ•´æ•°ã€‚ æ¯”å¦‚ï¼šInter å¤„ç†å™¨é‡‡ç”¨å°ç«¯å­—èŠ‚åºå’Œç½‘ç»œä¼ è¾“é‡‡ç”¨çš„å¤§ç«¯å­—èŠ‚åºã€‚å¤§ç«¯å­—èŠ‚åºæ„æ€ä¸ºæ•°æ®çš„åœ°å€éšä¹‹å†…å­˜çš„åœ°å€å˜å¤§è€Œå˜å¤§ã€‚ ä¸ºäº†ä½¿ä¸åŒç±»å‹çš„è®¡ç®—æœºå¯ä»¥é€šè¿‡ç½‘ç»œä¼ è¾“çš„å¤šä¸ªå­—èŠ‚æ•´æ•°çš„å€¼è¾¾æˆä¸€è‡´ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªç½‘ç»œå­—èŠ‚åºã€‚å®¢æˆ·å’ŒæœåŠ¡å™¨ç¨‹åºå¿…é¡»åœ¨ä¼ è¾“å‰ï¼Œå°†å®ƒä»¬çš„å†…éƒ¨æ•´æ•°è¡¨ç¤ºæ–¹å¼è½¬åŒ–ä¸ºç½‘ç»œå­—èŠ‚åºã€‚é€šè¿‡ä»¥ä¸‹å‡½æ•°å®ç°ï¼š unsigned long int htonl(unsigned long int hostlong);unsigned short int htons(unsigned short int hostshort);unsigned long int ntohl(unsigned long int netlong);unsigned short int ntohs(unsigned short int netshort); è¿™äº›å‡½æ•°å°† 16 ä½å’Œ 32 ä½æ•´æ•°åœ¨ä¸»æœºå­—èŠ‚åºå’Œæ ‡å‡†çš„ç½‘ç»œå­—èŠ‚åºä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚å‡½æ•°åæ˜¯ä¸ä¹‹å¯¹åº”çš„è½¬æ¢æ“ä½œçš„ç®€å†™å½¢å¼ã€‚å¦‚æœè®¡ç®—æœºæœ¬èº«çš„ä¸»æœºå­—èŠ‚åºå’Œç½‘ç»œå­—èŠ‚åºç›¸åŒï¼Œè¿™äº›æ“ä½œçš„å®é™…ä¸Šå°±æ˜¯ç©ºæ“ä½œã€‚ è½¬æ¢ä¹‹åçš„ netstat æ“ä½œã€‚ $ netstat -A inetActive Internet connections (w/o servers)Proto Recv-Q Send-Q Local Address Foreign Address Statetcp 0 0 localhost:3366 localhost:34411 TIME_WAIT ä¸ºäº†è®©ä¸åŒä½“ç³»ç»“æ„çš„è®¡ç®—æœºä¸Šçš„å®¢æˆ·å’ŒæœåŠ¡å™¨å¯ä»¥æ­£ç¡®çš„æ“ä½œï¼Œæ€»æ˜¯åœ¨ç½‘ç»œç¨‹åºä¸­ä½¿ç”¨è¿™äº›è½¬æ¢å‡½æ•°æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ ç½‘ç»œä¿¡æ¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œçš„å®¢æˆ·å’ŒæœåŠ¡å™¨ç¨‹åºä¸€ç›´æ˜¯æŠŠåœ°å€å’Œç«¯å£å·ç¼–è¯‘åˆ°ç¨‹åºçš„å†…éƒ¨ã€‚å¯¹äºä¸€ä¸ªæ›´é€šç”¨çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç¨‹åºæ¥è¯´ï¼Œå¯ä»¥é€šè¿‡ç½‘ç»œä¿¡æ¯å‡½æ•°æ¥å†³å®šåº”è¯¥ä½¿ç”¨çš„åœ°å€å’Œç«¯å£ã€‚ å¦‚æœæœ‰è¶³å¤Ÿçš„æƒé™ï¼Œå¯ä»¥å°†è‡ªå·±çš„æœåŠ¡æ·»åŠ åˆ°etcservices æ–‡ä»¶ä¸­çš„å·²çŸ¥æœåŠ¡åˆ—è¡¨ä¸­ï¼Œå¹¶åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ä¸ºç«¯å£å·åˆ†é…ä¸€ä¸ªåå­—ï¼Œä½¿ç”¨æˆ·å¯ä»¥ä½¿ç”¨ç¬¦å·åŒ–çš„æœåŠ¡åè€Œä¸æ˜¯ç«¯å£å·çš„æ•°å­—ã€‚ ç±»ä¼¼çš„ï¼Œå¦‚æœç»™å®šä¸€ä¸ªè®¡ç®—æœºçš„åå­—ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨è§£æåœ°å€çš„ä¸»æœºæ•°æ®åº“å‡½æ•°æ¥ç¡®å®šå®ƒçš„ IP åœ°å€ã€‚è¿™äº›å‡½æ•°é€šè¿‡æŸ¥è¯¢ç½‘ç»œé…ç½®æ–‡ä»¶æ¥å®Œæˆè¿™ä¸€å·¥ä½œï¼Œå¦‚ecthosts æ–‡ä»¶æˆ–ç½‘ç»œä¿¡æ¯æœåŠ¡ã€‚å¸¸ç”¨çš„ç½‘ç»œä¿¡æ¯æœåŠ¡æœ‰ NISï¼ˆNetwork Information Serviceï¼Œç½‘ç»œä¿¡æ¯æœåŠ¡ï¼Œä»¥å‰å« Yellow Pagesï¼Œé»„é¡µæœåŠ¡ï¼‰å’Œ DNSï¼ˆDomain Name Serviceï¼ŒåŸŸåæœåŠ¡ï¼‰ ä¸»æœºæ•°æ®åº“å‡½æ•°åœ¨æ¥å£å¤´æ–‡ä»¶ netdb.h ä¸­å£°æ˜ã€‚ struct hostent *gethostbyaddr(const void *addr, size_t len, int type);struct hosten *gethostbyname(const char *name); è¿™äº›å‡½æ•°è¿”å›çš„æ•°æ®ç»“æ„ä¸­è‡³å°‘ä¼šåŒ…å«ä»¥ä¸‹å‡ ä¸ªæˆå‘˜ï¼š struct hostent char *h_name; /* official name of host */ char **h_aliases; /* alias list */ int h_addrtype; /* host address type */ int h_length; /* length of address */ char **h_addr_list; /* list of addresses */ å¦‚æœæ²¡æœ‰æŸ¥è¯¢çš„ä¸»æœºæˆ–åœ°å€æœ‰å…³çš„æ•°æ®é¡¹ï¼Œè¿™äº›ä¿¡æ¯å‡½æ•°å°†è¿”å›ä¸€ä¸ªç©ºæŒ‡é’ˆã€‚ ç±»ä¼¼çš„ï¼Œä¸æœåŠ¡åŠå…¶å…³è”ç«¯å£å·æœ‰å…³çš„ä¿¡æ¯ä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›æœåŠ¡ä¿¡æ¯å‡½æ•°æ¥è·å–ã€‚ struct servent *getservbyname(const char *name,const char *proto);struct servent *getservbyport(int port,const char *proto); proto å‚æ•°æŒ‡å®šç”¨äºè¿æ¥æœåŠ¡çš„åè®®ï¼Œå®ƒæœ‰ä¸¤ä¸ªå–å€¼ tcp å’Œ udpï¼Œå‰è€…ç”¨äº SOCK_STREAM ç±»å‹çš„ TCP è¿æ¥ï¼Œåè€…ç”¨äº SOCK_DGRAM ç±»å‹çš„ UDP æ•°æ®æŠ¥ã€‚ è¿”å›çš„æ•°æ®ç»“æ„ä¸­è‡³å°‘ä¼šåŒ…å«ä»¥ä¸‹å‡ ä¸ªæˆå‘˜ï¼š struct servent char * s_name; /* name of the service*/ char ** s_aliases; /* list of aliases*/ int s_port; /* The IP port number*/ char *s_proto; /* The service type, usually tcp or udp */; å¦‚æœæƒ³è·å¾—æŸå°è®¡ç®—æœºä¸Šçš„ä¸»æœºæ•°æ®åº“ä¿¡æ¯ï¼Œå¯ä»¥è°ƒç”¨é‚£ä¸ª gehostbyname å‡½æ•°å¹¶ä¸”å°†ç»“æœæ‰“å°å‡ºæ¥ã€‚æ³¨æ„ï¼Œè¦å°†è¿”å›çš„åœ°å€åˆ—è¡¨ä¿¡æ¯è½¬åŒ–ä¸ºæ­£ç¡®çš„ IP åœ°å€ç±»å‹ï¼Œéœ€ç”¨å‡½æ•° int_ntoa å°†å®ƒä»¬ä»ç½‘ç»œå­—èŠ‚åºè½¬æˆä¸»æœºå­—èŠ‚åºçš„å­—ç¬¦ä¸²åæ‰“å°å‡ºæ¥ã€‚ char *inet_ntoa(struct in_addr in); è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†æœ‰å…³å› ç‰¹ç½‘ä¸»æœºåœ°å€è½¬åŒ–ä¸ºä¸€ä¸ªç‚¹åˆ†å››å…ƒç»„æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚å¤±è´¥æ—¶è¿”å›-1ï¼Œä½† POSIX è§„èŒƒæœªå®šä¹‰é”™è¯¯ç±»å‹ã€‚ æœ€åä¸€ä¸ªå‡½æ•°ï¼šgethostnameï¼Œå¾—åˆ°ä¸»æœºçš„åç§° int gethostname(char *name, int legth); è¿™ä¸ªå‡½æ•°çš„ä½œç”¨ï¼Œå°†å½“å‰ä¸»æœºçš„ä¸»æœºçš„åå­—å†™å…¥ name æŒ‡å‘çš„å­—ç¬¦ä¸²ä¸­ã€‚ä¸»æœºåå°†ä»¥ NULL ç»“å°¾ã€‚å‚æ•° length æŒ‡å®šäº†å­—ç¬¦ä¸² name çš„é•¿åº¦ï¼Œå¦‚æœè¿”å›çš„ä¸»æœºåå¤ªé•¿ï¼Œå®ƒå°±ä¼šè¢«æˆªæ–­ã€‚è°ƒç”¨æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›-1ï¼Œé€‚å½“çš„è®¾ç½® errno ç¼–å†™ä¸€ä¸ªè¿æ¥åˆ°æ ‡å‡†æœåŠ¡çš„ç¨‹åºï¼šä½¿ç”¨ gethostbyname å¾—åˆ°ä¸»æœºçš„ IP åœ°å€ï¼Œgetservbyname å¾—åˆ°æœåŠ¡çš„ç«¯å£ï¼Œæœ€åä½¿ç”¨ connect è¯·æ±‚æœåŠ¡ã€‚ å¤šå®¢æˆ·ç›®æ ‡ï¼šå¦‚ä½•è®©å•ä¸ªæœåŠ¡å™¨è¿›ç¨‹åœ¨ä¸å µå¡ã€ä¸ç­‰å¾…å®¢æˆ·è¯·æ±‚åˆ°è¾¾çš„å‰æä¸‹å¤„ç†å¤šä¸ªå®¢æˆ·ã€‚ select ç³»ç»Ÿè°ƒç”¨åœ¨ç¼–å†™ Linux åº”ç”¨ç¨‹åºæ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°éœ€è¦æ£€æŸ¥å¥½å‡ ä¸ªè¾“å…¥çš„çŠ¶æ€æ‰èƒ½ç¡®å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨çš„æƒ…å†µã€‚å¦‚æœæ˜¯åœ¨ä¸€ä¸ªå•ç”¨æˆ·ç³»ç»Ÿä¸­ï¼Œè¿è¡Œä¸€ä¸ªâ€å¿™ç­‰å¾…â€å¾ªç¯è¿˜æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå®ƒä¸åœåœ°æ‰«æè¾“å…¥è®¾å¤‡çœ‹æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®åˆ°è¾¾å°±è¯»å–å®ƒã€‚ä½†è¿™ç§åšæ³•å¾ˆæ¶ˆè€— CPU çš„æ—¶é—´ã€‚ select ç³»ç»Ÿè°ƒç”¨å…è®¸ç¨‹åºåŒæ—¶åœ¨å¤šä¸ªåº•å±‚æ–‡ä»¶æè¿°ç¬¦ä¸Šç­‰å¾…è¾“å…¥çš„åˆ°è¾¾ï¼ˆæˆ–è¾“å‡ºçš„å®Œæˆï¼‰ã€‚è¿™æ„å‘³ç€ç¨‹åºå¯ä»¥ä¸€ç›´å µå¡åˆ°æœ‰äº‹æƒ…å¯åšä¸ºæ­¢ã€‚ç±»ä¼¼çš„ï¼ŒæœåŠ¡å™¨ä¹Ÿå¯ä»¥é€šè¿‡åŒæ—¶åœ¨å¤šä¸ªæ‰“å¼€çš„å¥—æ¥å­—ä¸Šç­‰å¾…è¯·æ±‚åˆ°æ¥çš„æ–¹æ³•æ¥å¤„ç†å¤šä¸ªå®¢æˆ·ã€‚ select å‡½æ•°å¯¹æ•°æ®ç»“æ„ fd_set è¿›è¡Œæ“ä½œï¼Œå®ƒæ˜¯ç”±æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦è€Œæ„æˆçš„é›†åˆã€‚ æœ‰ä¸€ç»„å®šä¹‰å¥½çš„å®æ¥æ§åˆ¶è¿™ä¸ªé›†åˆã€‚ void FD_ZERO(fd_set *fdset);void FD_CLR(int fd, fd_set *fdset);void FD_SET(int fd, fd_set *fdset);int FD_ISSET(int fd, fd_set *fdset); é¡¾åæ€ä¹‰ï¼ŒFD_ZERO ç”¨äºå°† fd_set åˆå§‹åŒ–ä¸ºç©ºé›†åˆï¼ŒFD_SETï¼ŒFD_CLR å°±æ˜¯æ·»åŠ å’Œåˆ é™¤ç”± fd ä¼ å…¥åˆ°é›†åˆä¸­æ–‡ä»¶æè¿°ç¬¦ã€‚ å¦‚æœ FD_ISSET å®ä¸­å‚æ•° fd å±äº fd_set ä¸­ä¸€ä¸ªå…ƒç´ ï¼ŒFD_ISSET å®å°†è¿”å›éé›¶å€¼ã€‚ fd_set ç»“æ„ä¸­å¯ä»¥å®¹çº³çš„æ–‡ä»¶æè¿°ç¬¦çš„æœ€å¤§æ•°ç›®æœ‰å¸¸é‡ FD_SETSIZE æŒ‡å®šã€‚ select å‡½æ•°é€šè¿‡ä¸€ä¸ªè¶…æ—¶å€¼æ¥é˜²æ­¢æ— é™æœŸçš„å µå¡ã€‚è¿™ä¸ªè¶…æ—¶å€¼ç”±ä¸€ä¸ª timeval ç»“æ„ç»™å‡ºã€‚è¿™ä¸ªç»“æ„å®šä¹‰åœ¨å¤´æ–‡ä»¶ systime.h ä¸­ï¼Œå®ƒç”±ä»¥ä¸‹å‡ ä¸ªæˆå‘˜ç»„æˆï¼š struct timeval time_t tv_sec; /* seconds */ long tv_usec; /* microseconds */; ç±»å‹ time_t åœ¨å¤´æ–‡ä»¶ systypes.h ä¸­è¢«å®šä¹‰ä¸€ä¸ªæ•´æ•°ç±»å‹ã€‚ select ç³»ç»Ÿè°ƒç”¨çš„åŸå‹ä¸ºï¼š int select(int nfds, fd_set *readfds, fd_set *writefds, fd_set *except, struct timeval *timeout); select è°ƒç”¨ç”¨äºæµ‹è¯•æ–‡ä»¶æè¿°ç¬¦é›†åˆä¸­ï¼Œæ˜¯å¦æœ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å·²å¤„äºå¯è¯»ï¼Œå¯å†™æˆ–å…¶å®ƒçŠ¶æ€ï¼Œä¹‹åå®ƒå°†å µå¡ä»¥ç­‰å¾…æŸä¸ªæ–‡ä»¶æè¿°ç¬¦è¿›å…¥ä¸Šè¿°çŠ¶æ€ã€‚ å‚æ•° nfds æŒ‡å®šéœ€è¦æµ‹è¯•çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°ç›®ï¼Œæµ‹è¯•çš„æè¿°ç¬¦èŒƒå›´ä» 0 åˆ° nfds-1ã€‚3 ä¸ªæ–‡ä»¶æè¿°ç¬¦éƒ½è®¾ä¸º NULLï¼Œè¡¨ç¤ºä¸æ‰§è¡Œå¯¹åº”æµ‹è¯•ã€‚ select å‡½æ•°ä¼šåœ¨å‘ç”Ÿä»¥ä¸‹æƒ…å†µæ—¶è¿”å›ï¼šreadfds å¯è¯»ï¼Œwritefds å¯å†™ï¼Œexceptfds ç›¸åº”ï¼ˆä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°ä»¥ä¸‹æƒ…å†µï¼Œæ—§ç‰ˆä¸­å®šä¹‰ä¸ºå‡ºé”™æ—¶ã€‚ï¼‰å¦‚æœè¿™ä¸‰ç§æƒ…å†µéƒ½æ²¡æœ‰å‘é€ï¼Œå‡½æ•°å°†åœ¨ timeval æŒ‡å®šçš„ä¸€æ®µè¶…æ—¶æ—¶é—´åè¿”å›ï¼Œå¦‚æœ timeval å‚æ•°æ˜¯ä¸€ä¸ªç©ºè€Œä¸”å¥—æ¥å­—ä¸Šä¹Ÿæ²¡æœ‰è¿›å…¥é‚£ä¸‰ç§çŠ¶æ€ï¼Œè°ƒç”¨å°†ä¸€ç›´å µå¡ä¸‹å»ã€‚ å½“ select è¿”å›æ—¶ï¼Œæè¿°ç¬¦é›†åˆå°†è¢«ä¿®æ”¹ä»¥æŒ‡ç¤ºå“ªäº›æè¿°ç¬¦æ­£å¤„äºå¯è¯»ã€å¯å†™æˆ–å…¶å®ƒçŠ¶æ€ã€‚ ç„¶åä½¿ç”¨ FD_ISSET å¯¹æè¿°ç¬¦è¿›è¡Œæµ‹è¯•ï¼Œæ¥æ‰¾å‡ºéœ€è¦å¤„ç†çš„æè¿°ç¬¦ã€‚å¦‚æœ select æ˜¯å› ä¸ºè¶…æ—¶è€Œè¿”å›çš„ï¼Œæ‰€æœ‰çš„æè¿°ç¬¦é›†åˆå°†è¢«æ¸…ç©ºã€‚ select è°ƒç”¨æˆåŠŸå°†è¿”å›å‘ç”Ÿå˜åŒ–çš„æè¿°ç¬¦æ€»æ•°ï¼Œå‡ºé”™è¿”å›-1 å¹¶è®¾ç½® errnoã€‚ å¤šå®¢æˆ·æœåŠ¡å™¨å¯ä»¥è®© select è°ƒç”¨åŒæ—¶æ£€æŸ¥ç›‘å¬å¥—æ¥å­—å’Œå®¢æˆ·çš„è¿æ¥å¥—æ¥å­—ã€‚ä¸€æ—¦ select è°ƒç”¨æŒ‡ç¤ºæœ‰æ´»åŠ¨å‘ç”Ÿï¼Œå°±å¯ä»¥ä½¿ç”¨ FD_ISSET æ¥éå†ï¼Œæ‰€æœ‰è¿æ¥çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»¥æ£€æŸ¥æ˜¯å“ªä¸ªå¥—æ¥å­—ä¸Šé¢æ´»åŠ¨å‘ç”Ÿã€‚ å¦‚æœæ˜¯å¥—æ¥å­—å¯è¯»çš„è¯ï¼Œè¿™è¯´æ˜æ­£æœ‰ä¸€ä¸ªå®¢æˆ·è¯·æ±‚è¿æ¥ï¼Œå³æœåŠ¡å™¨ä½¿ç”¨ socket å‡½æ•°åˆ›å»ºçš„å¥—æ¥å­—æè¿°ç¬¦æœ‰æ´»åŠ¨ï¼Œæ­¤æ—¶å°±å¯ä»¥è°ƒç”¨ accept å‡½æ•°æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå¦‚æœæ˜¯æŸä¸ªå®¢æˆ·å¥—æ¥å­—æè¿°ç¬¦æ´»è·ƒï¼Œä¸€ä¸ªå®¢æˆ·éœ€è¦æœåŠ¡ç«¯è¿›è¡Œè¯»å†™æ“ä½œã€‚å¦‚æœè¯»æ“ä½œè¿”å› 0 åˆ™è¡¨æ˜æœ‰ä¸€ä¸ªå®¢æˆ·è¿›ç¨‹å·²ç»ç»“æŸï¼Œå¯ä»¥å…³é—­å¥—æ¥å­—å¹¶æŠŠå®ƒä»æè¿°ç¬¦é›†åˆä¸­åˆ é™¤ã€‚ æ•°æ®åŒ…åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œåœ¨ç¨‹åºä¸­èŠ±è´¹æ—¶é—´æ¥å»ºç«‹å’Œç»´æŒä¸€ä¸ªå¥—æ¥å­—è¿æ¥æ˜¯ä¸å¿…é¡»è¦çš„ã€‚ å½“ç”¨æˆ·éœ€è¦ä¸€ä¸ªçŸ­å°çš„æ•°æ®æŸ¥è¯¢å¹¶æœŸæœ›æ¥å—åˆ°ä¸€ä¸ªçŸ­å°çš„ç›¸åº”æ—¶ï¼Œä¸€èˆ¬å°±ä½¿ç”¨ UDP æä¾›çš„æœåŠ¡ã€‚ä¾‹å¦‚ä¸»æœºä¸Šçš„ daytime æœåŠ¡ã€‚ å› ä¸º UDP æä¾›çš„æ˜¯ä¸å¯é æœåŠ¡ï¼Œæ‰€ä»¥å¯ä»¥ä¼šå‘ç°æ•°æ®åŒ…æˆ–å“åº”ä¼šä¸¢å¤±ã€‚å¦‚æœæ•°æ®åŒ…å¯¹äºæ¥è¯´éå¸¸é‡è¦ï¼Œå°±éœ€è¦å°å¿ƒç¼–å†™ UDP ç¨‹åºï¼Œä»¥æ£€æŸ¥é”™è¯¯å¹¶åœ¨å¿…è¦æ˜¯é‡ä¼ ã€‚ ä½¿ç”¨ UDP æ•°æ®åŒ…æ˜¯ï¼Œéœ€è¦ä½¿ç”¨ sendto å’Œ recvfrom æ¥ä»£æ›¿åŸæœ‰ä½¿ç”¨åœ¨å¥—æ¥å­—ä¸Šçš„ read å’Œ write è°ƒç”¨ã€‚ sendto ç³»ç»Ÿè°ƒç”¨ä» buffer ç¼“å†²åŒºä¸­ç»™ä½¿ç”¨æŒ‡å®šå¥—æ¥å­—åœ°å€çš„ç›®æ ‡æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ•°æ®åŒ…ã€‚ int sendto(int sockfd, void *buffer, size_t len, int flags, struct sockaddr *to, socklen tolen); åœ¨æ­£å¸¸è°ƒç”¨ä¸­ï¼Œflags å‚æ•°ä¸€èˆ¬è¢«è®¾ç½®ä¸º 0. recvfrom ç³»ç»Ÿè°ƒç”¨åœ¨å¥—æ¥å­—ä¸Šç­‰å¾…ä»ç‰¹å®šåœ°å€åˆ°æ¥çš„æ•°æ®åŒ…ï¼Œå¹¶å°†å®ƒæ”¾å…¥ buffer ç¼“å†²åŒºã€‚ int recvfrom(int sockfd, void *buffer, size_t len, int flag, struct sockaddr *to, socklen fromlen); åœ¨æ­£å¸¸è°ƒç”¨ä¸­ï¼Œflags å‚æ•°ä¸€èˆ¬è¢«è®¾ç½®ä¸º 0. ä¸¤ä¸ªå‡½æ•°çš„è°ƒç”¨ï¼ŒæˆåŠŸè¿”å›æ“ä½œçš„å­—ç¬¦æ•°ï¼Œé”™è¯¯è¿”å›-1ï¼Œå¹¶è®¾ç½® errno é€šè¿‡ä»¥ä¸Šå‡½æ•°å¯ä»¥åˆ›å»ºå‡ºä¸€ä¸ª UDP æœåŠ¡å™¨ï¼Œä¸€ä¸ªä½¿ç”¨ sendto å‡½æ•°å‘æ•°æ®ï¼Œä¸€ä¸ªä½¿ç”¨ recvfrom å‡½æ•°æ¥æ•°æ®ã€‚å¦å¤–é€šè¿‡ä½¿ç”¨ setsocketopt å‡½æ•°æ¥è®¾ç½®å¥—æ¥å­—æè¿°ç¬¦çš„è¶…æ—¶æƒ…å†µã€‚ä¹Ÿå¯ä»¥é‡‡ç”¨ä½¿ç”¨ sigaction ä¿¡å·è®¿é—®çš„æ–¹å¼æ¥å®ç°","categories":["4.é€šè®¯åè®®","ç½‘ç»œ"]},{"title":"TCPå’ŒUDP","path":"/2023/11/21/4-é€šè®¯åè®®-ç½‘ç»œ-TCPå’ŒUDP/","content":"æ¡æ‰‹åˆ†æClientSendï¼šSYN + seq100 ServerSendï¼šSYN + ACK + seq200 + ack101 ClientSendï¼šACK + ack201 TCP è¿æ¥å»ºç«‹åœ¨ TCPIP åè®®ä¸­ï¼ŒTCP åè®®æä¾›å¯é çš„è¿æ¥æœåŠ¡ï¼Œé‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹ä¸€ä¸ªè¿æ¥ã€‚ æœåŠ¡å™¨å¿…é¡»å‡†å¤‡å¥½æ¥å—å¤–æ¥çš„è¿æ¥ã€‚è¿™é€šè¿‡è°ƒç”¨ socketã€ bind å’Œ listen å‡½æ•°æ¥å®Œæˆï¼Œç§°ä¸ºè¢«åŠ¨æ‰“å¼€(passive open)ã€‚ ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·é€šè¿‡è°ƒç”¨ connect è¿›è¡Œä¸»åŠ¨æ‰“å¼€(active open)ã€‚è¿™å¼•èµ·å®¢æˆ· TCP å‘é€ä¸€ä¸ª SYNï¼ˆè¡¨ç¤ºåŒæ­¥ï¼‰åˆ†èŠ‚ï¼ˆSYNJï¼‰ï¼Œå®ƒå‘Šè¯‰æœåŠ¡å™¨å®¢æˆ·å°†åœ¨è¿æ¥ä¸­å‘é€åˆ°æ•°æ®çš„åˆå§‹åºåˆ—å·ã€‚å¹¶è¿›å…¥ SYN_SEND çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨çš„ç¡®è®¤ã€‚ ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨å¿…é¡»ç¡®è®¤å®¢æˆ·çš„ SYNï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿå¾—å‘é€ä¸€ä¸ª SYN åˆ†èŠ‚ï¼Œå®ƒå«æœ‰æœåŠ¡å™¨å°†åœ¨åŒä¸€è¿æ¥ä¸­å‘é€çš„æ•°æ®çš„åˆå§‹åºåˆ—å·ã€‚æœåŠ¡å™¨ä»¥å•ä¸ªå­—èŠ‚å‘å®¢æˆ·å‘é€ SYN å’Œå¯¹å®¢æˆ· SYN çš„ ACKï¼ˆè¡¨ç¤ºç¡®è®¤ï¼‰ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥ SYN_RECV çŠ¶æ€ã€‚ ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·æ”¶åˆ°æœåŠ¡å™¨çš„ SYN+ACKã€‚å‘æœåŠ¡å™¨å‘é€ç¡®è®¤åˆ†èŠ‚ï¼Œæ­¤åˆ†èŠ‚å‘é€å®Œæ¯•ï¼Œå®¢æˆ·æœåŠ¡å™¨è¿›å…¥ ESTABLISHED çŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ã€‚ åˆ†æ å®¢æˆ·ç«¯çš„åˆå§‹åºåˆ—å·ä¸º Jï¼Œè€ŒæœåŠ¡å™¨çš„åˆå§‹åºåˆ—å·ä¸º Kã€‚åœ¨ ACK é‡Œçš„ç¡®è®¤å·ä¸ºå‘é€è¿™ä¸ª ACK çš„ä¸€ç«¯æ‰€æœŸå¾…çš„ä¸‹ä¸€ä¸ªåºåˆ—å·ã€‚å› ä¸º SYN åªå ä¸€ä¸ªå­—èŠ‚çš„åºåˆ—å·ç©ºé—´ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ª SYN çš„ ACK ä¸­çš„ç¡®è®¤å·éƒ½æ˜¯ç›¸åº”çš„åˆå§‹åºåˆ—å·åŠ  1.ç±»ä¼¼åœ°ï¼Œæ¯ä¸€ä¸ª FINï¼ˆè¡¨ç¤ºç»“æŸï¼‰çš„ ACK ä¸­çš„ç¡®è®¤å·ä¸º FIN çš„åºåˆ—å·åŠ  1.å®Œæˆä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å¼€å§‹ä¼ é€æ•°æ®ï¼Œåœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­è¿˜æœ‰ä¸€äº›é‡è¦æ¦‚å¿µã€‚æœªè¿æ¥é˜Ÿåˆ—ï¼šåœ¨ä¸‰æ¬¡æ¡æ‰‹åè®®ä¸­ï¼ŒæœåŠ¡å™¨ç»´æŠ¤ä¸€ä¸ªæœªè¿æ¥é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯çš„ SYN åŒ…(synj)å¼€è®¾ä¸€ä¸ªæ¡ç›®ï¼Œè¯¥æ¡ç›®è¡¨æ˜æœåŠ¡å™¨å·²æ”¶åˆ° SYN åŒ…ï¼Œå¹¶å‘å®¢æˆ·å‘å‡ºç¡®è®¤ï¼Œæ­£åœ¨ç­‰å¾…å®¢æˆ·ç«¯ç¡®è®¤åŒ…ã€‚è¿™äº›æ¡ç›®æ‰€æ ‡è¯†çš„è¿æ¥åœ¨æœåŠ¡å™¨å¤„äº SYN_RECV çŠ¶æ€ï¼Œå½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯ç¡®è®¤åŒ…æ—¶ï¼Œåˆ é™¤è¯¥æ¡ç›®ï¼ŒæœåŠ¡å™¨è¿›å…¥ ESTABLISHED çŠ¶æ€ã€‚ TCP è¿æ¥ç»ˆæ­¢TCP è¿æ¥ç»ˆæ­¢éœ€å››ä¸ªåˆ†èŠ‚ã€‚ ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šæŸä¸ªåº”ç”¨è¿›ç¨‹é¦–å…ˆè°ƒç”¨ closeï¼Œç§°è¿™ä¸€ç«¯æ‰§è¡Œä¸»åŠ¨å…³é—­ã€‚è¿™ä¸€ç«¯çš„ TCP äºæ˜¯å‘é€ä¸€ä¸ª FIN åˆ†èŠ‚ï¼Œè¡¨ç¤ºæ•°æ®å‘é€å®Œæ¯•ã€‚ ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæ¥æ”¶åˆ° FIN çš„å¦ä¸€ç«¯æ‰§è¡Œè¢«åŠ¨å…³é—­ï¼ˆpassive closeï¼‰ã€‚è¿™ä¸ª FIN ç”± TCP ç¡®è®¤ã€‚å®ƒçš„æ¥æ”¶ä¹Ÿä½œä¸ºæ–‡ä»¶ç»“æŸç¬¦ä¼ é€’ç»™æ¥æ”¶ç«¯åº”ç”¨è¿›ç¨‹ï¼ˆæ”¾åœ¨å·²æ’é˜Ÿç­‰å€™åº”ç”¨è¿›ç¨‹æ¥æ”¶åˆ°ä»»ä½•å…¶ä»–æ•°æ®ä¹‹åï¼‰ ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šä¸€æ®µæ—¶é—´åï¼Œæ¥æ”¶åˆ°æ–‡ä»¶ç»“æŸç¬¦çš„åº”ç”¨è¿›ç¨‹å°†è°ƒç”¨ close å…³é—­å®ƒçš„å¥—æ¥å£ã€‚è¿™å¯¼è‡´å®ƒçš„ TCP ä¹Ÿå‘é€ä¸€ä¸ª FINã€‚ ç¬¬å››æ¬¡æ¡æ‰‹ï¼šæ¥æ”¶åˆ°è¿™ä¸ª FIN çš„åŸå‘é€ç«¯ TCP å¯¹å®ƒè¿›è¡Œç¡®è®¤ã€‚ é¢å‘å­—èŠ‚çš„æ•°æ®ä¼ é€æµï¼ˆå¦‚ TCP å­—èŠ‚æµã€Unix ç®¡é“ç­‰ï¼‰ä¹Ÿä½¿ç”¨ EOF è¡¨ç¤ºåœ¨æŸä¸ªæ–¹å‘ä¸Šä¸å†æœ‰æ•°æ®å¾…ä¼ é€ã€‚åœ¨ TCP å­—èŠ‚æµä¸­ï¼ŒEOF çš„è¯»æˆ–å†™é€šè¿‡æ”¶å‘ä¸€ä¸ªç‰¹æ®Šçš„ FIN åˆ†èŠ‚æ¥å®ç°ã€‚ TCP æœåŠ¡å™¨ Server åˆ›å»ºå¥—æ¥å­— socket ç»‘å®š IPï¼ŒPORTbind è®¾ç½®ç›‘å¬å¥—æ¥å­— listen ç­‰å¾…å»ºç«‹è¿æ¥ accept æ”¶å‘æ•°æ® read/write recv/send recvfrom/sendto å…³é—­è¿æ¥ close TCP å®¢æˆ·ç«¯ Client åˆ›å»ºå¥—æ¥å­— socket ç»‘å®š bind å»ºç«‹è¿æ¥ connect æ”¶å‘æ•°æ® read/write å…³é—­è¿æ¥ close UDP æœåŠ¡å™¨ Server åˆ›å»ºå¥—æ¥å­— socket ç»‘å®šåœ°å€ æ¥æ”¶æ•°æ® å‘é€æ•°æ® UDP å®¢æˆ·ç«¯ Client åˆ›å»ºå¥—æ¥å­— socket å‘é€æ•°æ® æ¥æ”¶æ•°æ®","categories":["4.é€šè®¯åè®®","ç½‘ç»œ"]},{"title":"å¥—æ¥å­—çš„è¶…æ—¶æ£€æµ‹","path":"/2023/11/20/4-é€šè®¯åè®®-ç½‘ç»œ-å¥—æ¥å­—çš„è¶…æ—¶æ£€æµ‹/","content":"ç½‘ç»œé€šä¿¡ä¸­ï¼Œå¾ˆå¤šæ“ä½œä¼šä½¿å¾—è¿›ç¨‹é˜»å¡ï¼Œè¿™æ—¶ä»¬è¦è®¾å®šæ—¶é—´ï¼Œåˆ°æ—¶é—´åå¼ºåˆ¶è¿”å›ï¼Œé¿å…è¿›ç¨‹åœ¨æ²¡æœ‰æ•°æ®çš„æƒ…å†µä¸‹æ— é™é˜»å¡ é€šè¿‡ setsockopt è®¾ç½®å¥—æ¥å­—å±æ€§ SO_RCVTIMEOstruct timeval t = 5, 0 if (setsockopt(listenfd, SOL_SOCKET, SO_RCVTIMEO, t, sizeof(t)) == -1) perror(setsockopt); return -1; memset(peeraddr, 0, sizeof(peeraddr)); len = sizeof(peeraddr); if ((connfd = accept(listenfd, (struct sockaddr *)peeraddr, len)) == -1) printf(errno=%d: %s , errno, strerror(errno)); if (errno == EAGAIN) printf(timeout ); return -1; è®¾å®š select å‡½æ•°çš„ä¸€ä¸ªå‚æ•°å®ç°è¶…æ—¶å¤„ç†struct timeval t= 3, 0; while (1) ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ t.tv_sec = 3; t.tv_usec = 0; if ((ret = select(maxfd+1, rdfs, NULL, NULL, t)) == -1) perror(select); return -1; ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ è®¾å®šä¸€ä¸ªå®šæ—¶å™¨æ•æ‰ SIGALRM ä¿¡å·åšè¶…æ—¶æ§åˆ¶struct sigaction act; sigaction(SIGALRM, NULL, act); //è·å–SIGALRMä¿¡å·çš„å±æ€§ act.sa_handler = handler; // è®¾ç½®SIGALRMä¿¡å·çš„å¤„ç†å‡½æ•° sigaction(SIGALRM, act, NULL); // è®¾ç½®SIGALRMä¿¡å·çš„å±æ€§ alarm(3); // å®šæ—¶å™¨è®¾ç½®3ç§’é’Ÿ while (1) if ((connfd = accept(listenfd, (struct sockaddr *)peeraddr, len)) == -1) if (errno == EINTR) printf(timeout ); return -1; å®šæ—¶å™¨ 3 ç§’é’Ÿå†…æ²¡æœ‰æ•°æ®åˆ°æ¥ï¼Œå†…æ ¸äº§ç”Ÿ SIGALRM ä¿¡å·ä¸­æ–­å½“å‰æ“ä½œã€‚ä»¬çŸ¥é“è®¾ç½®ä¿¡å·æ•æ‰å‡½æ•°å¯ä»¥ç”¨ signal å‡½æ•°æˆ–æ˜¯ sigaction å‡½æ•°ã€‚ä½†è¿™é‡Œåªèƒ½ä½¿ç”¨ sigaction å‡½æ•°ï¼Œå› ä¸º signal è®¾ç½®çš„ä¿¡å·å¤„ç†å‡½æ•°æ‰§è¡Œå®Œåä¼šé‡æ–°æ‰§è¡Œè¢«ä¸­æ–­çš„æ“ä½œ","categories":["4.é€šè®¯åè®®","ç½‘ç»œ"]},{"title":"4.æ‰“å°æ§åˆ¶å‘½ä»¤","path":"/2023/11/06/5-åµŒå…¥å¼å¼€å‘-ç¡¬ä»¶çŸ¥è¯†-3Dæ‰“å°-4-æ‰“å°æ§åˆ¶å‘½ä»¤/","content":"https://reprap.org/wiki/G-code G ä»£ç å‘½ä»¤Klipper æ”¯æŒä»¥ä¸‹æ ‡å‡†çš„ G-Code å‘½ä»¤ï¼š ç§»åŠ¨ (G0 or G1): G1 [Xpos] [Ypos] [Zpos] [Epos] [Fspeed]é©»ç•™ï¼šG4 Pæ¯«ç§’è¿”å›åŸç‚¹ï¼šG28 [X] [Y] [Z]å…³é—­æ­¥è¿›ç”µæœºï¼šM18æˆ–M84ç­‰å¾…å½“å‰ç§»åŠ¨å®Œæˆï¼š M400ä½¿ç”¨ç»å¯¹/ç›¸å¯¹æŒ¤å‡ºè·ç¦»ï¼šM82ï¼Œ M83ä½¿ç”¨ç»å¯¹/ç›¸å¯¹åæ ‡ï¼šG90, G91è®¾ç½®åæ ‡ï¼šG92 [Xåæ ‡] [Yåæ ‡] [Zåæ ‡] [Eåæ ‡]è®¾ç½®é€Ÿåº¦å› å­è¦†å†™ç™¾åˆ†æ¯”ï¼šM220 Sç™¾åˆ†æ¯”è®¾ç½®æŒ¤å‹å› å­è¦†ç›–ç™¾åˆ†æ¯”ï¼šM221 Spercentè®¾ç½®åŠ é€Ÿåº¦ï¼šM204 Svalue æˆ– M204 Pvalue Tvalueæ³¨æ„ï¼šå¦‚æœæ²¡æœ‰æŒ‡å®šSï¼ŒåŒæ—¶æŒ‡å®šäº†På’ŒTï¼Œé‚£ä¹ˆåŠ é€Ÿåº¦å°†è¢«è®¾ç½®ä¸ºPå’ŒTä¸­çš„æœ€å°å€¼ã€‚è·å–æŒ¤å‡ºæœºæ¸©åº¦ï¼šM105è®¾ç½®æŒ¤å‡ºæœºæ¸©åº¦ï¼šM104 [Tindex] [Stemperature]è®¾ç½®æŒ¤å‡ºæœºæ¸©åº¦å¹¶ç­‰å¾…ï¼šM109 [Tindex] Stemperatureã€‚æ³¨æ„ï¼šM109æ€»æ˜¯ç­‰å¾…æ¸©åº¦ç¨³å®šåœ¨è¯·æ±‚çš„æ•°å€¼ä¸Šã€‚è®¾ç½®çƒ­åºŠæ¸©åº¦ï¼šM140 [Stemperature]è®¾ç½®çƒ­åºŠæ¸©åº¦å¹¶ä¸”ç­‰å¾…ï¼šM190 Stemperatureæ³¨æ„ï¼šM190æ€»æ˜¯ç­‰å¾…æ¸©åº¦ç¨³å®šåœ¨è¯·æ±‚çš„æ•°å€¼ä¸Šã€‚è®¾ç½®é£æ‰‡é€Ÿåº¦ï¼šM106 Svalueåœæ­¢é£æ‰‡ï¼šM107ç´§æ€¥åœæ­¢ï¼šM112è·å–å½“å‰ä½ç½®ï¼šM114è·å–å›ºä»¶ç‰ˆæœ¬ï¼šM115 é™ä½å¼€å…³ç¡®ä¿ Xã€Y å’Œ Z è½´çš„é™ä½å¼€å…³éƒ½æ²¡æœ‰è¢«è§¦å‘ï¼Œç„¶åé€šè¿‡æ§åˆ¶å°å‘é€å‘½ä»¤ï¼š QUERY_ENDSTOPS è¿”å›å€¼æ˜¯ open æ‰“å¼€ï¼Œåˆ™é™ä½è§¦å‘ç”µå¹³ç±»å‹è®¾ç½®æ­£ç¡®ï¼Œå¦‚æœæ˜¯ triggeredï¼ˆè§¦å‘ï¼‰ï¼Œåˆ™éœ€è¦ä¿®æ”¹é™ä½çš„ç”µå¹³ç±»å‹ï¼ˆä»¥ X è½´ä¸ºä¾‹ï¼‰ [stepper_X]endstop_pin: ^PE5 #ä¿®æ”¹å‰endstop_pin: ^!PE5 #ä¿®æ”¹å çƒ­åºŠ PID æ ¡æ­£G28 å½’é›¶åï¼Œå°†å–·å˜´ç§»è‡³çƒ­åºŠä¸­å¿ƒï¼Œé«˜å‡ºåºŠé¢çº¦ 5-10mmï¼Œç„¶åå‘é€å‘½ä»¤ PID_CALIBRATE HEATER=heater_bed TARGET=100 å®ƒå°†æ‰§è¡Œä¸€ä¸ª PID æ ¡å‡†ç¨‹åºï¼Œå°†æŒç»­çº¦ 10 åˆ†é’Ÿï¼Œå®Œæˆåæ§åˆ¶å°å°†ä¼šè¿”å› PID æ•°å€¼ï¼Œå°†å…¶å¤åˆ¶åˆ°çƒ­åºŠçš„ PID è®¾ç½®å³å¯ã€‚ æŒ¤å‡ºå¤´ PID æ ¡æ­£å…ˆå°†æ¨¡å‹å†·å´é£æ‰‡è®¾ç½®ä¸º 25% çš„è½¬é€Ÿ M106 S64 ï¼Œç„¶åå‘é€å‘½ä»¤ PID_CALIBRATE HEATER=extruder TARGET=245 å®ƒå°†æ‰§è¡Œä¸€ä¸ª PID æ ¡å‡†ç¨‹åºï¼Œå°†æŒç»­çº¦ 5 åˆ†é’Ÿï¼Œå®Œæˆåæ§åˆ¶å°å°†è¿”å› PID æ•°å€¼ï¼Œå°†å…¶å¤åˆ¶åˆ°é…ç½®æ–‡ä»¶å³å¯ã€‚ GCode åè®®æŒ‡ä»¤Klipper G-Code åè®®æŒ‡ä»¤ https://www.klipper3d.org/G-Codes.html marlin G-Code åè®®æŒ‡ä»¤ https://marlinfw.org/meta/gcode/ éƒ¨åˆ†ä½¿ç”¨åˆ°çš„å‘½ä»¤ å‘½ä»¤ ç”¨é€” M112 ä½¿ Klipper è¿›å…¥ â€œshutdownâ€ï¼ˆå…³é—­ï¼‰çŠ¶æ€ FIRMWARE_RESTART é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶å¹¶é‡å¯ SAVE_CONFIG ä¿å­˜é…ç½®æ–‡ä»¶ GET_POSITION è·å–ä½ç½® ps -ef | grep klippy æŸ¥çœ‹ä½¿ç”¨çš„ printer.cfg æ–‡ä»¶ä½ç½® QUAD_GANTRY_LEVEL è°ƒå¹³","categories":["5.åµŒå…¥å¼å¼€å‘","ç¡¬ä»¶çŸ¥è¯†","3Dæ‰“å°"]},{"title":"3.ä¸Šä½æœºå¹³å°é…ç½®","path":"/2023/11/03/5-åµŒå…¥å¼å¼€å‘-ç¡¬ä»¶çŸ¥è¯†-3Dæ‰“å°-3-ä¸Šä½æœºå¹³å°é…ç½®/","content":"æœ¬æ–‡ç« ä¸­é’ˆå¯¹é’ˆå¯¹æŸæ¬¾åµŒå…¥å¼å¼€å‘æ¿æ­å»º 3D æ‰“å°æœºçš„ä¸Šä½æœºå¹³å°ç¯å¢ƒï¼Œè®°å½•ç›¸å…³çš„æ“ä½œä»¥å¤‡ç»†èŠ‚é—å¿˜ã€‚ é•œåƒçƒ§å½•é€‰ç”¨é•œåƒä¸º Ubuntu18.04ï¼Œæ³¨æ„ ARMV7 ç‰ˆæœ¬æ„å»ºéœ€è¦çš„å¾ˆå¤šåŒ…ä¸æ”¯æŒï¼Œä¸æ¨èæ„å»ºã€‚ åˆ†åŒºæ‰©å±•ç”±äº emmc ç»™å®šçš„åˆ†åŒºå¤ªå°ï¼Œéœ€è¦å¯¹æ–‡ä»¶ç³»ç»Ÿåˆ†åŒºçš„å¤§å°è¿›è¡Œæ‰©å®¹æ“ä½œ ext4 æ ¼å¼çš„æ–‡ä»¶ï¼Œ åˆ¶ä½œä¸€ä¸ªå¤§äº 6GB çš„ EXT4 ç©ºæ–‡ä»¶, ç”±äºå®‰è£…çš„è½¯ä»¶è¾ƒå¤šæ—¶ï¼Œæ–‡ä»¶ç³»ç»Ÿä¼šå¾ˆå¤§ï¼Œå¯ä»¥æ ¹æ®æƒ…å†µè‡ªè¡Œæ›´æ”¹ã€‚ sudo dd if=/dev/zero of=ubuntu18_rootfs.ext4 bs=1500M count=3 å°†æ–°å»ºçš„ ubuntu18_rootfs.ext4 æ–‡ä»¶æ ¼å¼åŒ–ä¸º ext4 æ ¼å¼ã€‚ sudo mkfs.ext4 ubuntu18_rootfs.ext4 æ–°å»ºä¸€ä¸ªä¸´æ—¶çš„æ–‡ä»¶å¤¹ rootfs_tmp,å°† ubuntu18_rootfs.ext4 æ–‡ä»¶æŒ‚è½½åˆ°ä¸´æ—¶ç›®å½• rootfs_tmp,å¹¶æ‹·è´æ–‡ä»¶ç³»ç»Ÿã€‚ mkdir -p rootfs_tmpsudo mount -o loop ubuntu18_rootfs.ext4 ./rootfs_tmpsudo cp -avrf ./ubuntu-rootfs/* ./ æ‹·è´å®Œåï¼Œå¸è½½æŒ‚è½½çš„ ubuntu18_rootfs.ext4 æ–‡ä»¶ï¼Œå³å®Œæˆäº†æ–‡ä»¶ç³»ç»Ÿçš„åˆ¶ä½œã€‚ sudo umount ./rootfs_tmp ubuntu18_rootfs.ext4 å°±æ˜¯å¯ä»¥ç”¨äºä¸‹è½½çš„ã€‚ SD å¡å¯åŠ¨ 101 EMMC å¯åŠ¨ 010 åˆ—å‡º USB è®¾å¤‡ ~/STMicroelectronics/STM32Cube/STM32CubeProgrammer/bin/STM32_Programmer_CLI -l usb çƒ§å½• ~/STMicroelectronics/STM32Cube/STM32CubeProgrammer/bin/STM32_Programmer_CLI -c port=usb1 -w ./flashlayout_myir-image-ubuntu18/trusted/FlashLayout_sdcard_stm32mp157c-ya157c-512d-v2-ubuntu18.tsv ç£ç›˜ç©ºé—´æ‰©å±•æ‰©å®¹ å®‰è£…ç›¸å…³å·¥å…·å¹¶æŸ¥çœ‹å½“å‰åˆ†åŒºæƒ…å†µï¼Œparted æ˜¯ç¡¬ç›˜åˆ†åŒºå·¥å…·ï¼Œè¿™é‡Œç”¨æ¥æŸ¥çœ‹ç£ç›˜åˆ†åŒºæƒ…å†µï¼ŒæŒ‰éœ€åˆ é™¤ä¸éœ€è¦çš„åˆ†åŒºï¼Œä»¥åŠæ‰©å±•åˆ†åŒºå®¹é‡ sudo apt update sudo apt intall -y parted resize2fssudo fdisk -l åˆ é™¤åˆ†åŒº # è¿›å…¥ parted å·¥å…·$ sudo parted /dev/mmcblk1# æŸ¥çœ‹åˆ†åŒºç¼–å·(parted) print# å¦‚æœè¯¥åˆ†åŒºåé¢æœ‰åˆ†åŒºçš„è¯ï¼Œåˆ é™¤è¯¥åˆ†åŒº(parted) rm 8# å†æ¬¡æŸ¥çœ‹åˆ†åŒº(parted) print# åˆ é™¤æ‰©å±•åˆ†åŒº(parted) rm 7# ä¿å­˜æ›´æ”¹å¹¶é€€å‡º(parted) quit å¢åŠ åˆ†åŒº # è¿›å…¥ parted å·¥å…·$ sudo parted /dev/mmcblk1# æŸ¥çœ‹ç£ç›˜ä¿¡æ¯(parted) print# ç›´æ¥æ‰©å±•åˆ†åŒº(parted)resizepart 6# è¿™é‡Œè¾“å…¥çš„æ•°å€¼ï¼Œå°±æ˜¯ä¸Šæ–¹è¾“å‡ºä¸­ End: åæ–¹çš„æ•°å€¼End? [9713MB]? 21.5GB# æ‰©å±•å®Œæˆä¹‹åé€€å‡º parted(parted) quit#æ­¤æ—¶åˆ†åŒºå®¹é‡å·²ç»æ‰©å±•å®Œæˆäº†ï¼Œä½†æ˜¯æ–‡ä»¶ç³»ç»Ÿè¿˜æœªè¯†åˆ«æ‰©å±•çš„å®¹é‡ï¼Œæ‰€ä»¥æ‰©å±•çš„å®¹é‡è¿˜æ²¡æ³•ä½¿ç”¨ã€‚ä¸‹é¢æ‰©å±•ä¸€ä¸‹å·²ç»é‡æ–°åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿ$ sudo resize2fs /dev/mmcblk1p6#æ­¤æ—¶ä¸å‡ºæ„å¤–çš„è¯åº”è¯¥æ‰©å®¹å®Œæˆäº†ï¼Œå¯ä»¥ä½¿ç”¨ df -h æ¥æŸ¥çœ‹å®¹é‡ã€‚ ç£ç›˜ç©ºé—´ç®¡ç† å½“å‰ç›®å½•æŒ‰ç…§ç©ºé—´ä½¿ç”¨å¤§å°æ’åº(-h å‚æ•°ï¼ŒæŒ‰ MB æ˜¾ç¤º)sudo du -s * | sort -nr ç£ç›˜æŒ‰ç…§ç©ºé—´ä½¿ç”¨å¤§å°æ’åº(-h å‚æ•°ï¼ŒæŒ‰ MB æ˜¾ç¤º)df -h ç£ç›˜ç©ºé—´æ•´ç†apt-get clean æŠŠå®‰è£…çš„è½¯ä»¶çš„å¤‡ä»½ä¹Ÿåˆ é™¤ï¼Œä¸ä¼šå½±å“è½¯ä»¶ä½¿ç”¨ã€‚ æŒ‚è½½ SD å¡åˆ°å¼€å‘æ¿ä¸Šï¼Œç”±äºç£ç›˜ç©ºé—´ä¸è¶³ï¼Œå®‰è£…ä½ç½®è®¾ç½®æŒ‚è½½ç›®å½•ä¸ºä¸»ç›®å½•ï¼ŒæŒ‡å®š HOME=/mntï¼Œæ‰“å° echo $HOME ç¡®è®¤å·²ç»æˆåŠŸè®¾ç½® ç£ç›˜æ ¼å¼åŒ–mkfs.ext4 /dev/mmcblk1 ç£ç›˜æ–°å»ºåˆ†åŒºfdisk /dev/mmcblk1 è¿›å…¥ç£ç›˜ç®¡ç†ï¼Œè¾“å…¥ F æŸ¥è¯¢å½“å‰ç£ç›˜å‰©ä½™æœªåˆ†åŒºå†…å®¹ SD å¡è‡ªåŠ¨æŒ‚è½½ç¼–è¯‘ /etc/fstab æ–‡ä»¶ /dev/mmcblk1p1 /mnt/sdcard vfat rw,relatime,fmask=0000,dmask=0000,codepage=437,iocharset=iso8859-1,shortname=mixed,errors=remount-ro 0 0 ç½‘ç»œè¿æ¥åˆ©ç”¨ Win32DiskImager-1.0.0-binary çƒ§å½• SD åå‘ç°æ²¡æœ‰æ— çº¿ç½‘å¡é©±åŠ¨ï¼Œko æ ¼å¼ä¸å…¼å®¹ï¼Œå¾…æµ‹è¯•éªŒè¯æ¢ä¸ªé•œåƒç”¨ stmcubeProgram çƒ§å½•åé—®é¢˜è§£å†³ WIFI å¯åŠ¨ wlan0sudo ifconfig wlan0 up å¯åŠ¨æ—¶æç¤º SIOCSIFFLAGS: Operation not possible due to RF-killï¼Œåˆ©ç”¨ rfkill listï¼ŒæŸ¥çœ‹ Wireless LAN æ˜¯å¦è¢«è½¯ä»¶é˜»æ­¢ Soft blocked: yesï¼Œç„¶åè¾“å…¥ sudo rfkill unblock wifi è§£å¼€ï¼Œå¹¶è¾“å…¥ rfkill list ç¡®è®¤çŠ¶æ€ã€‚ä¹‹ååœ¨æ‰§è¡Œä¸Šè¿°è¯­å¥ï¼Œå¯åŠ¨ wlan0ã€‚ æ‰«æ Wifiï¼Œéœ€è¦åœ¨ 2.4GHz é¢‘æ®µ sudo iw dev wlan0 scan | grep SSIDsudo iwlist wlan0 scanning | grep SSID è®¾ç½® Wifi é…ç½® #ç”Ÿæˆé…ç½®æ–‡ä»¶sudo wpa_passphrase lemonade 12245612 ./wifi.conf#å…³é—­wpa_supplicantsudo killall wpa_supplicant#åˆå§‹åŒ– wpa_supplicant# -D æŒ‡å®šé©±åŠ¨åç§°# -B åœ¨åå°è¿è¡Œå®ˆæŠ¤è¿›ç¨‹# -c é…ç½®ä¿¡æ¯çš„è·¯å¾„# -i ç›‘å¬çš„wifiæ¥å£sudo wpa_supplicant -B -Dnl80211 -c./wifi.conf -iwlan0 è®¾ç½® DHCP åˆ©ç”¨ udhcpc è‡ªåŠ¨è·å–udhcpc -i wlan0 ç¼–è¾‘é…ç½®æ–‡ä»¶è‡ªåŠ¨è·å– IPsudo vi /etc/systemd/network/wlan0.network [Match]Name=wlan0[Network]DHCP=yes ç¼–è¾‘å®Œæˆåé‡å¯æœåŠ¡ï¼Œsystemctl restart systemd-networkd åˆ©ç”¨ dhclient è‡ªåŠ¨è·å– #é‡Šæ”¾ç§Ÿçº¦sudo dhclient -r wlan0#é‡æ–°è·å–ç§Ÿçº¦sudo dhclient wlan0 éœ€è¦è®¾ç½® DNS æœåŠ¡echo nameserver 8.8.8.8 /etc/resolv.conf æŸ¥çœ‹ç½‘å¡ä¿¡æ¯ip addr show wlan0 æµ‹è¯•ç½‘ç»œè¿é€šæ€§ping 360.com æœ‰çº¿è®¾ç½®æœ‰çº¿ç½‘ç»œçš„ IP åœ°å€è‡ªåŠ¨è·å– è½¯ä»¶æºé…ç½®ç¼–è¾‘æºé…ç½®æ–‡ä»¶ sudo vi /etc/apt/sources.list ubuntu 18.04 for arm æ¸…åæºé…ç½®# é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Šdeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-updates main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-updates main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-backports main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-backports main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-security main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-security main restricted universe multiverse# é¢„å‘å¸ƒè½¯ä»¶æºï¼Œä¸å»ºè®®å¯ç”¨# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-proposed main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-proposed main restricted universe multiverse ubuntu 18.04 for arm ä¸­ç§‘å¤§æºé…ç½®deb http://mirrors.ustc.edu.cn/ubuntu-ports/ xenial main multiverse restricted universedeb http://mirrors.ustc.edu.cn/ubuntu-ports/ xenial-backports main multiverse restricted universedeb http://mirrors.ustc.edu.cn/ubuntu-ports/ xenial-proposed main multiverse restricted universedeb http://mirrors.ustc.edu.cn/ubuntu-ports/ xenial-security main multiverse restricted universedeb http://mirrors.ustc.edu.cn/ubuntu-ports/ xenial-updates main multiverse restricted universedeb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ xenial main multiverse restricted universedeb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ xenial-backports main multiverse restricted universedeb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ xenial-proposed main multiverse restricted universedeb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ xenial-security main multiverse restricted universedeb-src http://mirrors.ustc.edu.cn/ubuntu-ports/ xenial-updates main multiverse restricted universe æ›´æ–° python ç‰ˆæœ¬armv7 ä¸Šä½¿ç”¨ python3.8 å®‰è£…æ—¶ä¾èµ–åŒ…ç¼–è¯‘ä¸é€šè¿‡ï¼Œç‰ˆ å®‰è£… Python3.8ï¼Œå¹¶æŸ¥çœ‹å®‰è£…è·¯å¾„ sudo apt install python3.8which python3.8 ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå»ºè®®åˆ›å»ºè½¯è¿æ¥ï¼Œé¦–å…ˆæŠŠä¹‹å‰çš„è½¯è¿æ¥åˆ é™¤ï¼š sudo rm -rf /usr/bin/python3sudo rm -rf /usr/bin/pip3 åˆ›å»º python3 å’Œ pip3 çš„è½¯è¿æ¥ï¼š sudo ln -s Python3Path /usr/bin/python3sudo ln -s Python3Path /usr/bin/pip3 æ›´æ¢ pip åœ°å€pipä¸‹è½½ç½‘ç»œé—®é¢˜ ç½‘ç»œé—®é¢˜å¯¼è‡´æ— æ³• clone åœ¨ä¸»æœºçš„æµè§ˆå™¨ä¸Šç™»å½• github ä¸‹è½½ klipper å’Œ moonrarker çš„å‹ç¼©åŒ…ï¼Œåˆ°å¼€å‘æ¿ä¸Šè§£å‹ è§£å‹åï¼Œä¿®æ”¹ kiauh ä¸­çš„ klipper .sh å’Œ moonrarker.sh ä¸­æŒ‡å®šçš„ç›®å½•ä½ç½®ï¼Œæ–‡ä»¶å¤¹çš„åç§°åŠè·¯å¾„è®¾ç½®ä¸ºè„šæœ¬ä¸­çš„åç§°å’Œè·¯å¾„ WIFI é…ç½®è„šæœ¬Wifi è¿æ¥è„šæœ¬ï¼Œæ‰§è¡Œ ifup_wifi_sta.sh -ssid Lemonade -passwd 12345678 #!/usr/bin/env sh#File: /usr/bin/ifup_wifi_sta.shSSID=PASSWD=WLAN=wlan0WPA_FILE=/etc/wpa_supplicant.confDRIVER_NAME=nl80211usage()\techo Usage: ./ifup_wifi_sta [-ssid wifi_sta_name] [-passwd wifi_sta_passwd] [-driver nl80211 or wext]clean_stage()\tkillall udhcpc\tkillall wpa_supplicant\tkillall hostapd\tkillall udhcpd\tsleep 1enable_wifi()\tT_HCI=phy0\tRFKILL_SYS_PATH=/sys/class/rfkill/\tdir=`ls $RFKILL_SYS_PATH`\tfor i in$dir\tdo if [ $T_HCI == `cat $RFKILL_SYS_PATH$i/name` ];then echo 0 $RFKILL_SYS_PATH$i/state echo find$T_HCI enable it sleep 1 echo 1 $RFKILL_SYS_PATH$i/state fi\tdoneparse_input_info()\twhile [ $# -gt 0 ];do case $1 in -ssid) SSID=$2 shift ;; -passwd) PASSWD=$2 if [ $#PASSWD -lt 8 ];then echo passwd should be 8...64 exit fi shift ;; -driver) DRIVER_NAME=$2 shift ;; -h) usage exit ;; esac shift $(( $# 0? 1:0))\tdone\techo SSID:$SSID PASSWD:$PASSWDDRIVER:$DRIVER_NAMEconnect_wifi()\tif [ -n $SSID ];then head -n4 $WPA_FILE $WPA_FILE.tmp wpa_passphrase $SSID $PASSWD$WPA_FILE.tmp mv $WPA_FILE $WPA_FILE.bak mv $WPA_FILE.tmp $WPA_FILE\tfi\twpa_supplicant -B -i$WLAN -c$WPA_FILE -D$DRIVER_NAME /dev/null 21obtain_dns()\ttime=10\twhile [ $time -gt 0 ];do state=`wpa_cli -i$WLAN -p/var/run/wpa_supplicant status | grepwpa_state | awk -F[=] print $2` if [ $state=COMPLETED ];then udhcpc-i $WLAN exit fi let time -= 1 sleep 1\tdone\techo connectwifi errorparse_input_info $@clean_stageenable_wificonnect_wifiobtain_dns è‡ªå¯åŠ¨è„šæœ¬é…ç½®#!/bin/sh# å¯åŠ¨æœåŠ¡# root@ok3568:/home/forlinx# cat /etc/systemd/system/startfrp.service# [Unit]# Description=startfrp# Requires=network-online.target# After=network-online.target# [Install]# WantedBy=multi-user.target# [Service]# Type=simple# User=root# RemainAfterExit=yes# ExecStart=/home/forlinx/S99Startfrp.sh# Restart=always# RestartSec=10# ç›®æ ‡åœ°å€ç”¨äºæ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ Google çš„å…¬å…± DNS æœåŠ¡å™¨TARGET=8.8.8.8# æ£€æŸ¥ä»¥å¤ªç½‘æ¥å£check_ethernet() local interface=$1 if ethtool $interface | grep -q Link detected.*: yes; then echo Ethernet interface $interface is connected. #é‡Šæ”¾mlan0æ¥å£å½“å‰é€šè¿‡DHCPè·å¾—çš„IPåœ°å€ç§Ÿçº¦ã€‚-ré€‰é¡¹ä»£è¡¨releaseï¼Œå³é‡Šæ”¾å·²æœ‰ç§Ÿçº¦ã€‚ #è¯·æ±‚ä¸€ä¸ªæ–°çš„IPåœ°å€ç§Ÿçº¦ã€‚é€šè¿‡DHCPåè®®è·å–ä¸€ä¸ªæ–°çš„IPåœ°å€é…ç½®ï¼ŒåŒ…æ‹¬IPåœ°å€ã€å­ç½‘æ©ç ã€é»˜è®¤ç½‘å…³ä»¥åŠDNSæœåŠ¡å™¨åœ°å€ç­‰ä¿¡æ¯ã€‚ dhclient -r $interface dhclient $interface else echo Ethernet interface $interface is NOT connected. fi# æ£€æµ‹æ— çº¿ç½‘ç»œå¹¶è¿æ¥ï¼ˆæ³¨æ„ï¼šæ­¤éƒ¨åˆ†æ¶‰åŠå®‰å…¨ä¿¡æ¯ï¼Œè¯·è°¨æ…å¤„ç†ï¼‰connect_wireless() wpa_passphrase lemonade 12245612 ./wifi.conf\tkillall wpa_supplicant\twpa_supplicant -B -Dnl80211 -cwifi.conf -imlan0\trm ./wifi.conf\t#udhcpc -i mlan0\tdhclient -r mlan0\tdhclient mlan0# ç½‘ç»œæ£€æŸ¥å‡½æ•°ï¼Œping ç›®æ ‡åœ°å€ï¼Œå¦‚æœæˆåŠŸè¿”å› 0ï¼Œå¦åˆ™è¿”å› 1check_network() sleep 1\tping -c 1 $TARGET /dev/null 21\treturn $?# ä¸»ç¨‹åºå¼€å§‹echo Checking Ethernet interfaces...check_ethernet eth0check_ethernet eth1# è¿æ¥æ— çº¿ç½‘ç»œæŸ æª¬æ°´ï¼Œè¿™é‡Œä»…ä½œä¸ºç¤ºä¾‹ï¼Œè¯·å‹¿ç›´æ¥ä½¿ç”¨æ˜æ–‡å¯†ç echo Attempting to connect to wireless network lemonade...iwlist wlan0 scanning | grep SSIDconnect_wireless# æ£€æŸ¥ç½‘ç»œæ˜¯å¦è¿æ¥if check_network; then\techo Network is connected. Executing commands...\t# æ‰§è¡Œ insmod å‘½ä»¤\t/sbin/insmod /home/forlinx/ch341.ko\tif [ $? -ne 0 ]; then echo Failed to execute insmod command exit 1\tfi\t# æ‰§è¡Œ frpc å‘½ä»¤\t/home/forlinx/frp_0.58.1_linux_arm64/frpc -c /home/forlinx/frp_0.58.1_linux_arm64/frpc.toml if [ $? -ne 0 ]; then echo Failed to execute frpc command exit 1\tfi\techo Commands executed successfullyelse\techo Network is not connected. Exiting...\texit 1fi","categories":["5.åµŒå…¥å¼å¼€å‘","ç¡¬ä»¶çŸ¥è¯†","3Dæ‰“å°"]},{"title":"2.å›ºä»¶åŠæ§åˆ¶è½¯ä»¶é…ç½®","path":"/2023/11/02/5-åµŒå…¥å¼å¼€å‘-ç¡¬ä»¶çŸ¥è¯†-3Dæ‰“å°-2-å›ºä»¶åŠæ§åˆ¶è½¯ä»¶é…ç½®/","content":"æ§åˆ¶æ¶æ„ç›®å‰ 3D æ‰“å°æœºçš„ä¸»æµæ¶æ„ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š ä¸Šä½æœºï¼ˆè¿è¡Œ fluidd æ§åˆ¶è½¯ä»¶ï¼‰+ ä¸‹ä½æœºï¼ˆè¿è¡Œ kilpper å›ºä»¶ï¼‰+Web æ˜¾ç¤º ç”±äºæ‰‹å¤´ä¸Šæ­£å¥½æœ‰ä¸€å— Linux å¼€å‘æ¿ï¼Œæ‰€ä»¥å‡†å¤‡é‡‡ç”¨ä¸Šä½æœºæ–¹æ¡ˆï¼Œå±€åŸŸç½‘éƒ¨ç½²ï¼ˆOctoPrint å’Œ Fluidd äºŒé€‰ä¸€å®‰è£…é…ç½®å³å¯ã€‚ï¼‰ ä¸‹ä½æœºï¼ˆè¿è¡Œ marlin å›ºä»¶ï¼‰+ ä¸²å£å±æ˜¾ç¤º ä¼˜ç‚¹ï¼šåªéœ€è¦ä¸€å—æ§åˆ¶æ¿åŠ ä¸Šä¸²å£å±ï¼Œä¸éœ€è¦ä¸Šä½æœºæ§åˆ¶è½¯ä»¶ï¼ŒèŠ‚çº¦æˆæœ¬ ç¼ºç‚¹ï¼šå±å¹•å°ï¼Œæ˜¾ç¤ºçš„ä¿¡æ¯å°‘ å›ºä»¶åœ¨ 3D æ‰“å°æœºä¸­ï¼Œå›ºä»¶æ§åˆ¶ç€ 3D æ‰“å°æœºçš„è¿åŠ¨å’Œæ“ä½œã€‚3D æ‰“å°æœºçš„å›ºä»¶é€šå¸¸æ˜¯é¢„è£…åœ¨å•ç‰‡æœºä¸Šçš„ï¼Œä½†ç”¨æˆ·ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œæ›´æ–°å’Œä¿®æ”¹ï¼Œä»¥å®ç°æ›´å¥½çš„æ€§èƒ½å’ŒåŠŸèƒ½ã€‚ è´Ÿè´£å°† G ä»£ç è½¬æ¢ä¸ºå®é™…çš„è¿åŠ¨å’Œæ“ä½œï¼Œä¾‹å¦‚å°† G ä»£ç ä¸­çš„åæ ‡è½¬æ¢ä¸ºç”µæœºçš„è¿åŠ¨ï¼Œæ§åˆ¶åŠ çƒ­å™¨çš„æ¸©åº¦ç­‰ã€‚ è´Ÿè´£å¤„ç†ä¼ æ„Ÿå™¨çš„è¾“å…¥ï¼Œä¾‹å¦‚æ¸©åº¦ä¼ æ„Ÿå™¨ã€é™ä½å¼€å…³ç­‰ï¼Œå¹¶æ ¹æ®è¿™äº›è¾“å…¥æ§åˆ¶ 3D æ‰“å°æœºçš„è¿åŠ¨å’Œæ“ä½œã€‚ åœ¨ 3D æ‰“å°é¢†åŸŸï¼Œä¸»æµçš„å›ºä»¶æœ‰ä»¥ä¸‹å‡ ç§ï¼š Marlinï¼š3D æ‰“å°æœºé¢†åŸŸæœ€æµè¡Œçš„å›ºä»¶ä¹‹ä¸€ï¼Œå› ä¸ºå®ƒå…·æœ‰å¹¿æ³›çš„ç¡¬ä»¶æ”¯æŒå’Œå¼ºå¤§çš„åŠŸèƒ½ã€‚Marlin æ”¯æŒå¤šç§ä¼ æ„Ÿå™¨å’ŒåŠŸèƒ½ï¼Œå¦‚è‡ªåŠ¨åºŠå¹³è¡¡ã€æ–­ç”µç»­æ‰“ã€LCD å±å¹•ç­‰ã€‚Marlin è¿˜æä¾›äº†ä¸€å¥—æ˜“äºä½¿ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹è¿™äº›æ–‡ä»¶æ¥å¯¹ 3D æ‰“å°æœºè¿›è¡Œé«˜åº¦è‡ªå®šä¹‰ã€‚ç”±äº Marlin æ˜¯å¼€æºè½¯ä»¶ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œä¿®æ”¹å’Œå®šåˆ¶ï¼Œä»¥å®ç°æ›´å¥½çš„æ€§èƒ½å’ŒåŠŸèƒ½ã€‚ Klipperï¼šKlipper æ˜¯ä¸€æ¬¾æ¯”è¾ƒæ–°çš„å¼€æºå›ºä»¶ï¼Œå®ƒå…·æœ‰æ›´é«˜çš„è®¡ç®—èƒ½åŠ›ï¼Œå¯ä»¥å®ç°æ›´å¿«çš„è¿åŠ¨å’Œæ›´é«˜çš„ç²¾åº¦ã€‚ Repetierï¼šRepetier æ˜¯å¦ä¸€æ¬¾æµè¡Œçš„å¼€æºå›ºä»¶ï¼Œå®ƒå…·æœ‰ç±»ä¼¼äº Marlin çš„åŠŸèƒ½å’Œæ”¯æŒã€‚ Smoothieï¼šSmoothie æ˜¯ä¸€æ¬¾åŸºäº ARM å¤„ç†å™¨çš„å¼€æºå›ºä»¶ï¼Œå®ƒæ”¯æŒå¤šä¸ªç‹¬ç«‹çš„ç”µæœºå’Œä¼ æ„Ÿå™¨ï¼Œå¹¶å…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§ã€‚ æœ¬æ¬¡æœºå™¨ç»„è£…é€‰æ‹©çš„æ–¹æ¡ˆæ˜¯ klipperï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ç›´æ¥åœ¨ä¸Šä½æœºä¿®æ”¹æ‰“å°æœºå‚æ•°ï¼Œä¸éœ€è¦æ¯æ¬¡ä¿®æ”¹å‚æ•°åé‡æ–°çƒ§å†™å›ºä»¶ Klipper å›ºä»¶é…ç½®åŠçƒ§å†™Klipper å®˜æ–¹æ–‡æ¡£ https://www.klipper3d.org/zh/Overview.html ï¼Œå»ºè®®è¯¦ç»†é˜…è¯»ï¼Œå¾ˆå¤šå‚æ•°å’Œé—®é¢˜éƒ½æœ‰è¯´æ˜ï¼Œé¦–å…ˆè·å– klipper æºç  git clone https://github.com/Klipper3d/klipper.git æ‰§è¡Œè„šæœ¬å®‰è£…ä¸€äº›ç³»ç»Ÿä¾èµ–ã€è®¾ç½®ã€‚* å®‰è£…å¾ˆæ…¢æ—¶ï¼Œå¯ä»¥æ›´æ¢ä¸‹ pip çš„æº pipä¸‹è½½ç½‘ç»œé—®é¢˜ ./klipper/scripts/install-ubuntu-22.04.sh ç„¶åé…ç½®å’Œæ„å»º elf æ–‡ä»¶ cd ~/klipper/make menuconfigmake éœ€è¦ç¡®å®šè¿æ¥åˆ°å¾®æ§åˆ¶å™¨çš„ä¸²è¡Œç«¯å£ ls /dev/serial/by-id/*ls /dev/ttyUSB* å¯ä»¥ç”¨å‘½ä»¤è¡Œæˆ–è½¯ä»¶å·¥å…·æ¥åˆ·å†™å›ºä»¶ï¼Œåˆ·å†™æ—¶è¦ç¡®ä¿ç«¯å£æ²¡æœ‰è¢«å ç”¨ sudo service klipper stopmake flash FLASH_DEVICE=/dev/ttyUSB0sudo service klipper start æ§åˆ¶è½¯ä»¶ä¸Šä½æœºä¸»æ¿é‡‡ç”¨ä¸€å—æ‰‹å¤´ç©ºä½™çš„ Linux ä¸»æ¿ï¼Œè½¯ä»¶é‡‡ç”¨ FluiddMainsailï¼Œå¦‚æœæ˜¯ä¸Šä½æœºçš„å½¢å¼ï¼Œåˆ™ç”±è¿è¡Œåœ¨ä¸Šä½æœºçš„ 3D æ‰“å°æœºæ§åˆ¶è½¯ä»¶æ¥æ§åˆ¶ 3D æ‰“å°æœºï¼Œä¸»è¦è€ƒè™‘å› ç´ : ARM æ¶æ„ï¼ŒåŠŸè€—ä½ï¼ˆéœ€è¦é•¿æ—¶é—´å·¥ä½œï¼‰ USB æ¥å£ï¼Œè¿æ¥ä¸‹ä½æœº ç½‘å£ï¼Œå±€åŸŸç½‘ Web æ˜¾ç¤ºæ‰“å°æœºæ§åˆ¶ï¼ˆå¯é€‰ï¼‰ æ˜¾ç¤ºå±ï¼Œæœ¬åœ°æ˜¾ç¤ºæ‰“å°æœºæ§åˆ¶ï¼ˆå¯é€‰ï¼‰ WIFIï¼Œå¯ä»¥æ— çº¿æ‰“å°ï¼ˆå¯é€‰ï¼‰ ç›‘æ§æ¨¡å—ï¼Œå¯ä»¥è¿œç¨‹æŸ¥çœ‹æ‰“å°æƒ…å†µï¼ˆå¯é€‰ï¼‰ å…ˆåœ¨ WSL ç¯å¢ƒä¸‹æ­å»ºè°ƒè¯• Fluiddï¼Œ é€‚ç”¨äº 3D æ‰“å°æœºçš„ Klipper å›ºä»¶ï¼Œæä¾› WEB é¡µé¢å’Œæ§åˆ¶ã€‚ KIAUHKIAUH å…¨ç§° Klipper Installation And Update Helperï¼Œè¯¥è„šæœ¬å¯ä»¥ç›´æ¥å®Œæˆæ‰€æœ‰ç¯å¢ƒé…ç½®ã€‚ åœ¨é€šè¿‡è¯¥è„šæœ¬è¿›è¡Œå®‰è£…æ—¶ï¼Œéœ€è¦å®æ—¶ä» github å’Œ pip ä¸‹è½½æ–‡ä»¶ï¼Œç”±äºç½‘ç»œä¸ç¨³å®šçš„æƒ…å†µå¯¼è‡´å®‰è£…å¤±è´¥çš„ï¼Œå¯ä»¥ä¸‹è½½ klippermoorakerfluidd ç­‰æ–‡ä»¶åï¼Œç½®äº~ç›®å½•ä¸‹ï¼Œå¹¶ä¿®æ”¹ kiauh ä¸­çš„ scripts æ–‡ä»¶å¤¹ä¸‹çš„ç›¸å…³è„šæœ¬ï¼Œå°†è„šæœ¬ä¸­çš„ clone éƒ¨åˆ†æ³¨é‡Šï¼Œé¿å…ç½‘ç»œä¸ç¨³å®šå¯¼è‡´çš„é”™è¯¯ã€‚pip éƒ¨åˆ†å¯ä»¥ä¿®æ”¹ pip æºï¼Œç¨³å®šä¸‹è½½ã€‚ ç•Œé¢å¦‚ä¸‹æ‰€ç¤ºï¼š æ‰§è¡Œè„šæœ¬å‰éœ€è¦å®‰è£… git sudo apt-get update sudo apt-get install git -y ä¸‹è½½ KIAUH åˆ°æœ¬åœ°ï¼š git clone https://github.com/dw-0/kiauh.git æ‰§è¡Œè„šæœ¬ ./kiauh/kiauh.sh KIAUH çš„ä¸»èœå•ä¸­ã€‚å°†çœ‹åˆ°å¤šä¸ªæ“ä½œå¯ä¾›é€‰æ‹©ï¼Œå…·ä½“å–å†³äºæƒ³è¦æ‰§è¡Œçš„æ“ä½œã€‚è¦é€‰æ‹©æ“ä½œï¼Œåªéœ€åœ¨â€æ‰§è¡Œæ“ä½œâ€æç¤ºä¸­è¾“å…¥ç›¸åº”çš„æ•°å­—ï¼Œç„¶åæŒ‰ ENTER ç¡®è®¤å³å¯ã€‚ moonrakeré€‰æ‹© 1 Install,éœ€è¦è¾“å…¥å¯†ç ï¼Œä¹‹åé€‰æ‹© 2 moonrakerï¼Œå®‰è£…å®Œæˆåè¿›å…¥æµè§ˆå™¨è¾“å…¥ http://127.0.0.1:7125/server/info æµ‹è¯• moonraker æ˜¯å¦æ­£å¸¸å®‰è£…ã€‚ moonraker çš„ä½œç”¨ï¼š Moonraker is the API that fluidd communicates with, which in turn communicates with Klipper. All three components are required for a healthy printer. å¦‚æœå‡ºç° pip ä¸‹è½½é€Ÿåº¦å¤ªæ…¢å¯¼è‡´çš„å¤±è´¥ï¼Œå‚é˜… pipä¸‹è½½ç½‘ç»œé—®é¢˜ æ— æ³•æ„å»º pillow å’Œ streaming-form-data è¿™ä¸¤ä¸ªåŒ…çš„è½®å­ï¼ˆwheelsï¼‰ï¼Œæ£€æŸ¥å‘ç°æ˜¯å¤´æ–‡ä»¶æ²¡æœ‰å¯¼è‡´çš„é”™è¯¯ï¼Œå°† /usr/include/python3.6 ä¸‹çš„æ‰€æœ‰å¤´æ–‡ä»¶æ‹·è´è‡³ /usr/include fluiddé€‰æ‹© 1 Install ä¹‹åé€‰æ‹© 4 Fluidd è¿›è¡Œå®‰è£…ï¼Œå®‰è£…å®Œæˆåè®¿é—® http://127.0.0.1 æ­£å¸¸æ‰“å¼€ fluidd é¡µé¢ å®‰è£…ä¹‹å‰è¿›å…¥ kiauh/resources ä¸‹ï¼Œç¼–è¾‘ fluidd æ–‡ä»¶å¯ä»¥æ›´æ”¹ç«¯å£ã€‚ Mainsailä¿®æ”¹ /kiauh/resources/mainsail ä¸­çš„ 80 ç«¯å£ä¸º 9090ï¼Œå®‰è£… mainsail åˆ° 9090 ç«¯å£ é…ç½®æ‰“å°æœºé…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬åœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸­åä¸º printer.cfg çš„æ–‡ä»¶ é…ç½®æ–‡ä»¶ç¤ºä¾‹ /home/linux/printer.cfgã€‚ åˆ·å†™ Klipper åï¼Œåç§°å¯èƒ½ä¼šæ”¹å˜ï¼Œæ£€æŸ¥ USB èŠ‚ç‚¹åç§°ï¼š ls /dev/serial/by-id/*æˆ–è€…ls /dev/ttyUSB* ç¡®è®¤èŠ‚ç‚¹åç§°å¹¶å†™å…¥é…ç½®æ–‡ä»¶ä¸­å»ã€‚ /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0æˆ–è€…/dev/ttyUSB0 ç”¨è¿™ä¸ªå”¯ä¸€çš„åå­—æ›´æ–°é…ç½®æ–‡ä»¶ã€‚æ›´æ–° [mcu] éƒ¨åˆ†ï¼Œç±»ä¼¼äºï¼š [mcu]serial: /dev/ttyUSB0 åœ¨ç¼–è¾‘è¯¥æ–‡ä»¶åï¼Œå‘å‡º restart æˆ– FIREWARE_RESTART å‘½ä»¤ä»¥é‡æ–°åŠ è½½é…ç½®ï¼ˆå‘½ä»¤æ ¹æ®å®é™…ä¸Šä½æœºï¼‰ã€‚å¦‚æœ Klipper é…ç½®æ–‡ä»¶è¢«æˆåŠŸè¯»å–ï¼Œå¹¶ä¸”æˆåŠŸæ‰¾åˆ°å¹¶é…ç½®äº†å¾®æ§åˆ¶å™¨ï¼Œé‚£ä¹ˆ â€œstatusâ€ å‘½ä»¤å°†æŠ¥å‘Šæ‰“å°æœºå·²å‡†å¤‡å°±ç»ªã€‚ é»˜è®¤çš„ Klipper å¯åŠ¨è„šæœ¬åœ¨ /tmp/klippy.log ä¸­æ”¾ç½®æ—¥å¿—ï¼Œæä¾›æ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚ WSL é—®é¢˜è§£å†³ç”±äºæœ¬æ¬¡å®‰è£…æ˜¯åœ¨ WSL ä¸­çš„ Ubuntu è¿›è¡Œå®‰è£…çš„ï¼Œæ‰€ä»¥æœ‰ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜éœ€è¦è§£å†³ 1ï¼‰systemd ä¸­çš„æœåŠ¡æ— æ³•å¯åŠ¨å¯¼è‡´çš„ moonraker.service æ— æ³•è¿è¡Œ Windows ç‰ˆæœ¬è¦æ±‚ (å·²éªŒè¯ Win11 22H2) å¯åŠ¨ windows Power Shellï¼Œæ›´æ–° wsl wsl --update è¿›å…¥ Ubuntu wsl ~ ç¼–è¾‘é…ç½® sudo vi /etc/wsl.conf æ·»åŠ ä»¥ä¸‹å†…å®¹ [boot]systemd=true ä¿å­˜å¹¶é€€å‡º ubuntu exit åœ¨ windows power shell ä¸­å…³é—­ ubuntu wsl --shutdown ç„¶åé‡æ–°è¿›å…¥ ubuntu wsl ~ æŸ¥è¯¢ systemd æœåŠ¡ sudo systemctl status 2ï¼‰åœ¨ WSL ä¸­æ— æ³•æ‰“å¼€ Windows çš„ USB ç«¯å£ WSL2 å†…æ ¸è¦æ±‚ 5.10.60.1 è¿›å…¥ Ubuntu wsl ~ æŸ¥è¯¢å†…æ ¸ç‰ˆæœ¬ uname -a é€€å‡º Ubuntu exit å®‰è£… usbipd-win winget install usbipd è¿›å…¥ Ubuntuï¼Œå®‰è£…å®¢æˆ·ç«¯å·¥å…· sudo apt install linux-tools-virtual hwdatasudo update-alternatives --install /usr/local/bin/usbip usbip `ls /usr/lib/linux-tools/*/usbip | tail -n1` 20 é€€å‡º Ubuntuï¼Œæ·»åŠ  USB è®¾å¤‡åˆ° WSL ä¸­å» usbipd wsl list //åˆ—å‡ºæ‰€æœ‰è¿æ¥åˆ°Windowsçš„USBè®¾å¤‡ã€‚usbipd wsl attach --busid //æ·»åŠ USBè®¾å¤‡è¿›å…¥Ubuntuï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™usbipd wsl detach --busid //åœæ­¢USBè®¾å¤‡å…±äº«usbipd wsl attach -a --busid 2-7 // -a è‡ªåŠ¨ç»‘å®š è¿›å…¥ Ubuntuï¼ŒæŸ¥çœ‹å·²ç»è¿æ¥çš„ USB è®¾å¤‡ lsusb é…ç½® udevï¼Œå…è®¸é root ç”¨æˆ·è®¿é—® USB è®¾å¤‡,éœ€è¦åœ¨è®¾å¤‡è¿æ¥å‰å®Œæˆè¯¥æ“ä½œã€‚éœ€è¦å°†æ ¹æ®è‡ªå·± USB è®¾å¤‡ç¼–å†™çš„ 60-myusb.rules æ–‡ä»¶å¤åˆ¶åˆ° /etc/udev/rules.d åµŒå…¥å¼éƒ¨ç½²æ—¶ç›¸å…³é—®é¢˜éƒ¨ç½² 3d æ‰“å°æœºç¯å¢ƒåˆ°å¼€å‘æ¿ï¼Œæ‰€æœ‰ç¯å¢ƒå·²éƒ¨ç½²å®Œæ¯•ï¼Œç›®å‰éœ€è¦è§£å†³çš„é—®é¢˜ç‚¹æ˜¯éœ€è¦ç¼–è¯‘ ch341 åœ¨ linux ç¯å¢ƒä¸‹çš„é©±åŠ¨ï¼Œé©±åŠ¨å†…æ ¸ç‰ˆæœ¬ 4.19.204 è¯¦è§ Linuxä¸‹çš„CH34xä¸²å£é©±åŠ¨","categories":["5.åµŒå…¥å¼å¼€å‘","ç¡¬ä»¶çŸ¥è¯†","3Dæ‰“å°"]},{"title":"1.æ¶æ„åŠç¡¬è½¯ä»¶ä»‹ç»","path":"/2023/11/01/5-åµŒå…¥å¼å¼€å‘-ç¡¬ä»¶çŸ¥è¯†-3Dæ‰“å°-1-æ¶æ„åŠç¡¬è½¯ä»¶ä»‹ç»/","content":"3D æ‰“å°æœº3D æ‰“å°ï¼ˆ3D printingï¼‰æ˜¯ä¸€ç§å¿«é€Ÿæˆå‹æŠ€æœ¯ï¼Œä¹Ÿè¢«ç§°ä¸ºæ·»åŠ åˆ¶é€ ï¼ˆAdditive Manufacturingï¼ŒAMï¼‰ã€‚å®ƒæ˜¯ä¸€ç§é€šè¿‡å°†ææ–™é€å±‚å åŠ ä»¥æ„å»ºä¸‰ç»´å®ä½“ç‰©ä½“çš„è¿‡ç¨‹ã€‚ä¸ä¼ ç»Ÿçš„åˆ¶é€ æ–¹æ³•ä¸åŒï¼Œ3D æ‰“å°ä¸éœ€è¦æ¨¡å…·æˆ–åˆ‡å‰Šå·¥å…·ï¼Œè€Œæ˜¯é€šè¿‡ä»è®¡ç®—æœºè¾…åŠ©è®¾è®¡ï¼ˆCADï¼‰æ¨¡å‹ä¸­ç”Ÿæˆçš„æ•°å­—æ¨¡å‹ç›´æ¥åˆ›å»ºç‰©ä½“ã€‚ FDMï¼ˆç†”èæ²‰ç§¯æˆå‹ï¼‰ï¼šFDM æ˜¯ç›®å‰æœ€å¸¸è§çš„ 3D æ‰“å°æŠ€æœ¯ï¼Œå®ƒä½¿ç”¨çƒ­å¡‘æ€§ææ–™é€šè¿‡æ‰“å°å¤´å–·å‡ºçš„æ–¹å¼é€å±‚å †ç§¯ï¼Œæœ€ç»ˆå½¢æˆæ‰€éœ€çš„ç‰©ä½“ã€‚FDM æ‰“å°æœºçš„ç»“æ„å’Œæ§åˆ¶ç³»ç»Ÿæ¯”è¾ƒç®€å•ï¼Œä»·æ ¼ä¹Ÿæ¯”è¾ƒå®æƒ ï¼Œå› æ­¤å¹¿æ³›åº”ç”¨äºå®¶åº­ã€åŠå…¬å®¤å’Œæ•™è‚²ç­‰é¢†åŸŸã€‚ SLAï¼ˆå…‰å›ºåŒ–æˆå‹ï¼‰ï¼šSLA ä½¿ç”¨ç´«å¤–çº¿æ¿€å…‰å™¨æˆ– LED å…‰æºç…§å°„å…‰æ•æ ‘è„‚ï¼Œä½¿å…¶é€å±‚å›ºåŒ–æˆä¸ºæ‰€éœ€çš„ç‰©ä½“ã€‚SLA æ‰“å°æœºçš„ç²¾åº¦å’Œè¡¨é¢å…‰æ»‘åº¦æ¯” FDM æ›´é«˜ï¼Œä½†ä»·æ ¼ä¹Ÿæ›´è´µã€‚ SLSï¼ˆé€‰æ‹©æ€§æ¿€å…‰çƒ§ç»“ï¼‰ï¼šSLS ä½¿ç”¨æ¿€å…‰æŸå°†çƒ­å¡‘æ€§ç²‰æœ«çƒ§ç»“åœ¨ä¸€èµ·ï¼Œé€å±‚å †ç§¯å½¢æˆæ‰€éœ€çš„ç‰©ä½“ã€‚SLS æ‰“å°æœºå¯ä»¥ä½¿ç”¨å¤šç§ææ–™ï¼Œå¯ä»¥æ‰“å°å‡ºæ›´å¤æ‚çš„ç»“æ„ï¼Œä½†ä»·æ ¼ä¹Ÿæ›´æ˜‚è´µã€‚ DLPï¼ˆæ•°å­—å…‰å¤„ç†ï¼‰ï¼šDLP ä½¿ç”¨å…‰æ•æ ‘è„‚å’Œæ•°å­—æŠ•å½±ä»ªï¼Œé€šè¿‡æŠ•å½±ä»ªå°†å…‰å›ºåŒ–åœ¨æ¶‚å±‚çš„æ ‘è„‚ä¸Šï¼Œé€å±‚å †ç§¯å½¢æˆæ‰€éœ€çš„ç‰©ä½“ã€‚DLP æ‰“å°æœºçš„é€Ÿåº¦å’Œç²¾åº¦éƒ½æ¯”è¾ƒé«˜ï¼Œä½†ä»·æ ¼ä¹Ÿè¾ƒè´µã€‚ FDMé€šè¿‡å°†åŠ çƒ­çš„ææ–™æŒ¤å‡ºæ‰“å°å¤´ï¼Œé€å±‚å †ç§¯å½¢æˆæ‰“å°ä»¶ æ‰“å°å¤´ æ‰“å°åºŠçƒ­åºŠ æ§åˆ¶ç³»ç»Ÿï¼ˆä¸»æ¿ã€ç”µæœºã€ä¼ æ„Ÿå™¨å’Œç”¨æˆ·ç•Œé¢ï¼‰ æ‰“å°ææ–™ G-Code ä¸€ç§ç”¨äºæ§åˆ¶æ•°æ§æœºåºŠï¼ˆåŒ…æ‹¬ 3D æ‰“å°æœºã€æ•°æ§é“£åºŠã€æ•°æ§è½¦åºŠç­‰ï¼‰è¿åŠ¨å’Œæ“ä½œçš„ç¼–ç¨‹è¯­è¨€ã€‚ ç»“æ„ç»“æ„ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š ä¸€ä¸ªè´Ÿè´£ä¸‰ç»´ç©ºé—´çš„ç§»åŠ¨çš„ç»„ä»¶ (ä¸‰ç»´ç§»åŠ¨éƒ¨åˆ†) ä¸€ä¸ªè´Ÿè´£è¿›æ–™ã€èåŒ–ææ–™å’ŒæŒ¤å‡ºææ–™çš„ç»„ä»¶ï¼ˆæŒ¤å‡ºéƒ¨åˆ†ï¼‰ æ‰“å°æ—¶ææ–™ä¼šä¸€å±‚åˆä¸€å±‚åœ°å †ç§¯åœ¨ä¹‹å‰å·²ç»ã€ŒæŒ¤å‡ºæ¥ã€çš„ææ–™ä¸Šï¼Œæ‰€ä»¥åœ¨è¿™ä¸¤ä¸ªç»„ä»¶å…±åŒåä½œä¸‹å°±èƒ½æ‰“å°å‡ºä¸€ä¸ªå®Œæˆçš„ 3D ç‰©ä½“äº†ã€‚ ç»“æ„ - ä¸‰ç»´ç§»åŠ¨éƒ¨åˆ†æ‰“å°æœºåœ¨ 3D çš„ç©ºé—´è¿åŠ¨çš„ä¼ åŠ¨æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä¸€èˆ¬è¾ƒä¸ºä¾¿å®œçš„æ‰“å°æœºä¼šé€‰æ‹©ç¬›å¡å°”ç»“æ„ã€‚ç¬›å¡å°”ç»“æ„æŒ‡çš„æ˜¯ X Y Z æ–¹å‘ä¸Šçš„è¿åŠ¨æ˜¯ç‹¬ç«‹çš„ï¼Œè¿™ç§æ–¹å¼æ¯”è¾ƒç›´è§‚ï¼Œç»“æ„ä¹Ÿæ¯”è¾ƒç®€å•ã€‚å¸¸ç”¨çš„ 3D æ‰“å°æœºçš„ç»“æ„æœ‰ä»¥ä¸‹å‡ ç§ï¼š Prusa i3 å‹ï¼šæ§åˆ¶ XZ è½´ï¼ŒY è½´é€šè¿‡å·¥ä½œå°çš„ç§»åŠ¨æ¥å®ç°ã€‚CoreXY å‹ï¼šCoreXY æœ€å¤§çš„ç‰¹åˆ«ä¹‹å¤„åœ¨äºå…¶ Xã€Y ç”µæœºæ˜¯ååŒè¿ä½œçš„ï¼Œå¹¶ä¸”å®ƒçš„åŒæ­¥å¸¦åœ¨ä¸åŒåŒæ­¥è½®çš„æ‘†æ”¾ä¸‹èƒ½å¤Ÿå½¢æˆå¤šç§ä¸ä¸€æ ·çš„ç¼ ç»•æ–¹æ³•ã€‚ç”±äºä¸¤ä¸ªç”µæœºçš„ååŒè¿åŠ¨ï¼Œç”µæœºå¸¦åŠ¨çš„åŠ›æ¯”å•ä¸€ç”µæœºçš„åŠ›è¦å¤§ï¼Œä¸”ä¼šå‡å°‘åœ¨ XY æ–¹å‘é¢ä¸Šçš„ä¸€ä¸ªç”µæœºé‡é‡ï¼Œæé«˜ç²¾å‡†æ€§ã€‚**CoreXY ç»“æ„ï¼šCoreXY ç»“æ„é‡‡ç”¨çš„æ˜¯ä¸¤ä¸ªç”µæœºé€šè¿‡ä¼ åŠ¨å¸¦å’Œæ»‘å—æ¥å®ç°æ‰“å°å¤´çš„è¿åŠ¨ï¼Œå…¶ä¸­ X å’Œ Y è½´çš„ä¼ åŠ¨å¸¦äº¤å‰å¸ƒç½®ï¼Œä½¿å¾—æ‰“å°å¤´çš„è¿åŠ¨æ–¹å‘å¯ä»¥åœ¨ X å’Œ Y è½´ä¸Šç‹¬ç«‹æ§åˆ¶ã€‚CoreXY ç»“æ„çš„ä¼˜ç‚¹æ˜¯æ‰“å°é€Ÿåº¦å¿«ï¼ŒåŒæ—¶æ‰“å°å¤´çš„é‡é‡å¯¹å®šä½ç²¾åº¦çš„å½±å“è¾ƒå°ï¼ŒåŒæ—¶å¯ä»¥å®ç°è¾ƒå¤§çš„æ‰“å°èŒƒå›´ã€‚ç¼ºç‚¹æ˜¯ç»“æ„å¤æ‚ï¼Œéœ€è¦æ›´å¤šçš„é›¶ä»¶å’Œæ›´é«˜çš„åˆ¶é€ ç²¾åº¦ï¼ŒåŒæ—¶ç»´æŠ¤å’Œå‡çº§ä¹Ÿè¾ƒä¸ºå›°éš¾ã€‚ Um Ultimaker å‹ï¼šX è½´ã€Y è½´çš„ç”µæœºéƒ½åœ¨é™æ­¢çš„æ¡†æ¶ä¸Šï¼Œä½†æŒ¤å‡ºå¤´åœ¨ä¸¤ä¸ªäº’ç›¸å‚ç›´çš„å…‰è½´çš„äº¤å‰å¤„ã€‚**UM ç»“æ„ï¼ˆUltimaker ç»“æ„ï¼‰ï¼šUM ç»“æ„é‡‡ç”¨çš„æ˜¯ç›´çº¿è½´æ‰¿å’Œæ»‘å—æ¥å®ç°è¿åŠ¨ï¼Œå…¶ä¸­ X å’Œ Y è½´åˆ†åˆ«ç”±ä¸¤ä¸ªç”µæœºé©±åŠ¨ï¼Œé€šè¿‡ä¼ åŠ¨å¸¦å’Œæ»‘å—æ¥å®ç°æ‰“å°å¤´çš„è¿åŠ¨ã€‚UM ç»“æ„çš„ä¼˜ç‚¹æ˜¯å®šä½ç²¾åº¦é«˜ï¼Œé€Ÿåº¦å¿«ï¼ŒåŒæ—¶ç»“æ„ç®€å•ï¼Œæ˜“äºç»´æŠ¤å’Œå‡çº§ã€‚ç¼ºç‚¹æ˜¯æ‰“å°å¤´çš„è´¨é‡å’Œç¨³å®šæ€§å¯¹å®šä½ç²¾åº¦æœ‰è¾ƒå¤§å½±å“ï¼ŒåŒæ—¶æ‰“å°å¤´çš„é‡é‡ä¹Ÿä¼šå½±å“æ‰“å°é€Ÿåº¦ã€‚ MBï¼šä¸»è¦ä½“ç°åœ¨æŒ¤å‡ºç”µæœºä¸€èˆ¬éƒ½è£…åœ¨å–·å¤´æ—ï¼Œè¿‘ç¨‹è¿›ä¸ï¼ŒåŒå…‰è½´æ‰¿è½½æŒ¤å‡ºç»„ä»¶ï¼ŒX æ–¹å‘çš„è¿åŠ¨ä¸€èˆ¬æ˜¯é€šè¿‡ç”µæœºå¸¦åŠ¨åŒæ­¥å¸¦ï¼Œé€šè¿‡å¸¦ä¼ åŠ¨ä½¿ä¸¤è¾¹ä¸€èµ·è¿åŠ¨ã€‚ delta ä¸‰è§’æ´²ï¼ˆå¹¶è”è‡‚ï¼‰å‹ ç»“æ„ - æŒ¤å‡ºéƒ¨åˆ†æŒ¤å‡ºéƒ¨åˆ†åˆ†ä¸ºä»¥ä¸‹ï¼š æŒ¤å‡ºå¤´ é€æ–™æ­¥è¿›ç”µæœº é€æ–™æ­¥è¿›ç”µæœºé©±åŠ¨æ¿ FDM 3D æ‰“å°æœºé™¤äº†æ€ä¹ˆåŠ¨çš„å¾ˆå…³é”®ä»¥å¤–ï¼Œæ€ä¹ˆå–æ–™ã€èåŒ–ææ–™ã€æŒ¤å‡ºææ–™ä¹Ÿéå¸¸é‡è¦ã€‚ å…¶ä¸­å–æ–™å’ŒæŒ¤å‡ºææ–™æ˜¯ç”±æŒ¤å‡ºæœºå¤„ç†çš„ï¼ŒèåŒ–ææ–™åˆ™æ˜¯ç”±çƒ­ç«¯å¤„ç†çš„ã€‚ æŒ¤å‡ºæœºä»ææ–™ç›˜ä¸­å°†ææ–™æ‹‰å‡ºæ¥ï¼Œé€è¿›å»çƒ­ç«¯èåŒ–ã€‚ å¹¶æŒç»­å¾€çƒ­ç«¯é€æ›´å¤šçš„æ–™è®©èåŒ–çš„ææ–™ä»å–·å˜´ä¸­æŒ¤å‡ºæ¥ã€‚ å…¶ä¸­æŒ¤å‡ºæœºçš„ç²¾åº¦å’ŒæŒ¤å‡ºçš„é€Ÿåº¦å†³å®šäº†æ‰“å°è´¨é‡å’Œé€Ÿåº¦ã€‚ç²¾åº¦é«˜æ„å‘³ç€å¯ä»¥æ›´å¥½çš„æ§åˆ¶æŒ¤å‡ºçš„é‡ã€‚æŒ¤å‡ºçš„ææ–™å¤ªå¤šæˆ–è€…å¤ªå°‘å¯¹æ‰“å°çš„è´¨é‡å½±å“éƒ½éå¸¸å¤§ã€‚æŒ¤å‡ºçš„é€Ÿåº¦å¿«å°±å¾ˆç›´æ¥çš„å†³å®šäº†èƒ½æ‰“å°å¤šå¿«ã€‚ è€Œå½±å“æŒ¤å‡ºæœºçš„ç²¾åº¦å’Œé€Ÿåº¦çš„ä¸¤ä¸ªå…³é”®å› ç´ å°±æ˜¯ï¼š æŒ¤å‡ºæœºçš„ç±»å‹ æŒ¤å‡ºæœºçš„é½¿è½®æ•°é‡ FDM æŒ¤å‡ºæœºåˆ†ä¸ºä¸¤ä¸ªå¤§ç±»ï¼š è¿œç«¯æŒ¤å‡ºæœºï¼ˆé²ç™»æŒ¤å‡ºæœºï¼‰ ä¼˜ç‚¹ è½»é‡åŒ–å–·å¤´ï¼šç”±äºæŒ¤å‡ºæœºå’Œæ­¥è¿›ç”µæœºä½äºæœºå™¨å¤–å£³ï¼Œå–·å¤´çš„é‡é‡è¾ƒè½»ï¼Œæƒ¯æ€§å°ï¼Œèƒ½å¤Ÿå®ç°æ›´é«˜çš„ç§»åŠ¨é€Ÿåº¦ï¼ˆå¯è¾¾ 200~300mmsï¼‰ï¼Œå› æ­¤é€‚åˆé«˜é€Ÿæ‰“å°ã€‚ ç²¾å‡†å®šä½ï¼šè½»é‡çš„å–·å¤´ä½¿å¾—å®šä½æ›´ä¸ºç²¾å‡†ï¼Œé€‚åˆéœ€è¦é«˜ç²¾åº¦çš„æ‰“å°ä»»åŠ¡ã€‚ ç¼ºç‚¹ é€æ–™é˜»åŠ›å¤§ï¼šç”±äºé€æ–™è·ç¦»è¾ƒè¿œï¼Œææ–™åœ¨ç‰¹æ°Ÿé¾™ç®¡ä¸­çš„æ‘©æ“¦é˜»åŠ›è¾ƒå¤§ï¼Œè¦æ±‚æ­¥è¿›ç”µæœºå…·å¤‡æ›´å¤§çš„åŠ›çŸ©ï¼Œå¢åŠ äº†ç”µæœºçš„è´Ÿæ‹…ã€‚ å›æŠ½ä¸ç²¾å‡†ï¼šåœ¨é«˜é€Ÿæ‰“å°æ—¶ï¼Œè¿œç«¯æŒ¤å‡ºæœºçš„å›æŠ½è·ç¦»å’Œé€Ÿåº¦è¦æ±‚è¾ƒå¤§ï¼Œå¯¼è‡´åœ¨ä½¿ç”¨å¼¹æ€§ææ–™æ—¶å¯èƒ½å‡ºç°è¾“é€ä¸ç•…çš„æƒ…å†µã€‚ ç»´æŠ¤å¤æ‚ï¼šç”±äºæŒ¤å‡ºæœºä¸å–·å¤´åˆ†ç¦»ï¼Œè¿æ¥éƒ¨åˆ†ï¼ˆå¦‚ç‰¹æ°Ÿé¾™ç®¡å’Œæ°”åŠ¨æ¥å¤´ï¼‰å®¹æ˜“å‡ºç°æ•…éšœï¼Œç»´æŠ¤ç›¸å¯¹å¤æ‚ã€‚ è¿‘ç«¯æŒ¤å‡ºæœºï¼ˆç›´æ¥æŒ¤å‡ºæœºï¼‰ ä¼˜ç‚¹ ç²¾å‡†æ§åˆ¶ï¼šè¿‘ç«¯æŒ¤å‡ºæœºå¯¹é€æ–™é‡çš„æ§åˆ¶æ›´ä¸ºç²¾ç¡®ï¼Œå›æŠ½ä¹Ÿæ›´ä¸ºç²¾å‡†ï¼Œé€‚åˆé«˜é€Ÿæ‰“å°æ—¶çš„ç»†èŠ‚å¤„ç†ã€‚ ä½åŠ›çŸ©è¦æ±‚ï¼šå¯¹æ­¥è¿›ç”µæœºçš„åŠ›çŸ©è¦æ±‚ç›¸å¯¹è¾ƒä½ï¼Œèƒ½å¤Ÿåœ¨é«˜é€Ÿæƒ…å†µä¸‹ä¿æŒç¨³å®šçš„æŒ¤å‡ºæ€§èƒ½ã€‚ æ¢æ–™æ–¹ä¾¿ï¼šç”±äºç»“æ„ç´§å‡‘ï¼Œæ¢æ–™è¿‡ç¨‹ç›¸å¯¹ç®€å•ï¼Œé€‚åˆé¢‘ç¹æ›´æ¢ææ–™çš„åº”ç”¨åœºæ™¯ã€‚ ç¼ºç‚¹ é‡é‡é—®é¢˜ï¼šå–·å¤´è¾ƒé‡ï¼Œå°¤å…¶æ˜¯åœ¨åŒå–·å¤´æ‰“å°æœºä¸­ï¼Œå¢åŠ äº†è¿åŠ¨æ—¶çš„æƒ¯æ€§ï¼Œå¯èƒ½å¯¼è‡´åŠ é€Ÿå’Œå‡é€Ÿå›°éš¾ï¼Œä»è€Œå½±å“æ‰“å°ç²¾åº¦ã€‚ ç»´æŠ¤ä¸ä¾¿ï¼šå–·å¤´ã€æŒ¤å‡ºæœºå’Œæ­¥è¿›ç”µæœºé›†æˆåœ¨ä¸€èµ·ï¼Œæ‹†è£…å’Œç»´æŠ¤ç›¸å¯¹ä¸ä¾¿ã€‚ å‹åŠ›å½±å“ï¼šè¾ƒé‡çš„å–·å¤´å¯¹å…‰è½´æˆ–å¯¼è½¨çš„å‹åŠ›è¾ƒå¤§ï¼Œå¯èƒ½å¯¼è‡´é•¿æ—¶é—´ä½¿ç”¨åå‡ºç°çš„è°ƒå¹³å›°éš¾. å¦å¤–ä¸€ä¸ªå½±å“æŒ¤å‡ºæœºç²¾åº¦çš„å°±æ˜¯æŒ¤å‡ºæœºçš„é½¿è½®äº†ã€‚è¾ƒä½ç«¯çš„æœºå™¨ä¸€èˆ¬éƒ½æ˜¯é…å¤‡éƒ½æ˜¯å•é½¿è½®ï¼Œè™½ç„¶å¯¹æ¯”åŒé½¿è½®çš„æŒ¤å‡ºæœºï¼Œæ— è®ºæ˜¯å¯¹ææ–™çš„å’¬åˆèƒ½åŠ›è¿˜æ˜¯æŒ¤å‡ºç²¾åº¦éƒ½è¡¨ç°æ›´å·®ï¼Œä½†å®ƒä¾¿å®œè€Œä¸”å·¥ä½œï¼Œå¯¹äºé¢„ç®—ç›¸å¯¹æ¯”è¾ƒç´§å¼ çš„æœ‹å‹æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ ä¼ åŠ¨ç³»ç»Ÿä¼ åŠ¨ç³»ç»Ÿåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š Xyz æ­¥è¿›ç”µæœº é™ä½å¼€å…³ æ­¥è¿›ç”µæœºé©±åŠ¨æ¿ åŒæ­¥å¸¦ ä¼ åŠ¨ç³»ç»Ÿæ˜¯ 3D æ‰“å°æœºä¸­è´Ÿè´£ç§»åŠ¨æ‰“å°å¤´ï¼ˆæˆ–å–·å˜´ï¼‰å’Œæ‰“å°å¹³å°çš„æœºæ¢°ç»„ä»¶ã€‚å®ƒåœ¨ 3D æ‰“å°è¿‡ç¨‹ä¸­å‘æŒ¥ä»¥ä¸‹ä½œç”¨ï¼š æ§åˆ¶ä½ç½®ï¼šä¼ åŠ¨ç³»ç»Ÿé€šè¿‡ç²¾ç¡®çš„è¿åŠ¨æ§åˆ¶ï¼Œå°†æ‰“å°å¤´å®šä½åœ¨æ­£ç¡®çš„ä½ç½®ï¼Œä»¥ä¾¿åœ¨æ¯ä¸ªå±‚æ¬¡ä¸Šç²¾ç¡®åœ°æ·»åŠ ææ–™ã€‚ ä¸‰ç»´å®šä½ï¼šä¼ åŠ¨ç³»ç»Ÿçš„è¿åŠ¨æ§åˆ¶ä½¿å¾—æ‰“å°å¤´å¯ä»¥åœ¨ Xã€Yã€Z ä¸‰ä¸ªæ–¹å‘ä¸Šç²¾ç¡®ç§»åŠ¨ï¼Œä»è€Œå®ç°ä¸‰ç»´æ‰“å°ã€‚ æ‰“å°é€Ÿåº¦ï¼šä¼ åŠ¨ç³»ç»Ÿçš„è¿åŠ¨æ§åˆ¶è¿˜å½±å“åˆ°æ‰“å°é€Ÿåº¦ã€‚æ›´å¿«çš„ä¼ åŠ¨ç³»ç»Ÿèƒ½å¤ŸåŠ å¿«æ‰“å°é€Ÿåº¦ï¼Œä½†éœ€è¦ä¿æŒç²¾ç¡®æ€§å’Œç¨³å®šæ€§ï¼Œä»¥ç¡®ä¿æ‰“å°è´¨é‡ä¸å—å½±å“ã€‚ è‡ªåŠ¨æ ¡å‡†ï¼šä¸€äº›é«˜çº§çš„ä¼ åŠ¨ç³»ç»Ÿå…·å¤‡è‡ªåŠ¨æ ¡å‡†åŠŸèƒ½ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹æ‰“å°å¹³å°å’Œæ‰“å°å¤´çš„ä½ç½®ï¼Œä»è€Œä¿æŒæ‰“å°çš„å‡†ç¡®æ€§å’Œç¨³å®šæ€§ã€‚ åŠ çƒ­éƒ¨åˆ†åŠ çƒ­éƒ¨åˆ†åˆ†ä¸ºä»¥ä¸‹ï¼š çƒ­åºŠ MOS ç®¡ æ‰“å°æœºçš„çƒ­åºŠå°±æ˜¯ç”¨æ¥æ‰¿è½½æŒ¤å‡ºæœºæŒ¤å‡ºæ¥çš„ææ–™ã€‚æ˜¯ 3D æ‰“å°æœºä¸Šçš„ä¸€ä¸ªç§»åŠ¨å¹³å°ï¼Œç”¨äºæ”¯æ’‘æ­£åœ¨æ‰“å°çš„ç‰©ä½“ã€‚å…¶ä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š ç²˜é™„å’Œç¨³å®šï¼šæ‰“å°å¹³å°ä¸Šçš„ç‰¹æ®Šè¡¨é¢æˆ–æ¶‚å±‚ï¼ˆä¾‹å¦‚çƒ­åºŠã€èƒ¶æ°´ã€èƒ¶å¸¦ç­‰ï¼‰å¯ä»¥æä¾›ç²˜é™„æ€§ï¼Œç¡®ä¿æ‰“å°çš„ç¬¬ä¸€å±‚ææ–™ç‰¢å›ºåœ°é™„ç€åœ¨å¹³å°ä¸Šï¼Œå¹¶é˜²æ­¢å…¶åœ¨æ‰“å°è¿‡ç¨‹ä¸­å‘ç”Ÿä½ç§»æˆ–å˜å½¢ã€‚ - å¡‘æ–™åœ¨ä¸åŒçš„æ¸©åº¦ä¸‹ç²˜æ€§ä¸ä¸€æ ·ï¼Œæ§åˆ¶åºŠçš„æ¸©åº¦å¯ä»¥è®©ä¸åŒçš„å¡‘æ–™åœ¨ä¿æŒå½¢çŠ¶çš„åŒæ—¶è¾¾åˆ°æœ€å¤§çš„ç²˜æ€§ã€‚å¦‚æœæ¸©åº¦å¤ªé«˜åˆ™æœ‰å¯è®©æ‰“å°çš„å½¢çŠ¶å˜å½¢ï¼Œæ¸©åº¦å¤ªä½åˆ™æœ‰å¯èƒ½è®©æ‰“å°çš„ææ–™ä¸ç²˜åºŠã€‚åºŠçš„æ¸©åº¦å’Œçƒ­ç«¯çš„æ¸©åº¦å…±åŒå†³å®šäº†å¯ä»¥æ‰“å°ä»€ä¹ˆææ–™ã€‚å¦‚æœèƒ½é¡ºåˆ©èåŒ–ææ–™ï¼Œä½†æ˜¯ä»–å¹¶ä¸èƒ½ç¨³å®šçš„é»åœ¨åºŠä¸Šï¼Œæ‰“å°ä¹Ÿä¼šæœ‰éå¸¸å¤§å‡ ç‡å¤±è´¥ã€‚ å¹³æ•´åº¦ï¼šæ‰“å°å¹³å°çš„è°ƒå¹³æ€§ï¼ˆå¹³æ•´åº¦ï¼‰å¯¹äºæ‰“å°è´¨é‡è‡³å…³é‡è¦ã€‚å¦‚æœå¹³å°ä¸å¹³æ•´ï¼Œå¯èƒ½å¯¼è‡´æ‰“å°çš„ç‰©ä½“åº•éƒ¨å‡ºç°å˜å½¢æˆ–ä¸å¹³æ•´çš„è¡¨é¢ã€‚ é˜²æ­¢ç¿˜æ›²ï¼šç‰¹å®šç±»å‹çš„ 3D æ‰“å°ææ–™ï¼Œä¾‹å¦‚ ABSï¼ˆä¸™çƒ¯è…ˆ - ä¸äºŒçƒ¯ - è‹¯ä¹™çƒ¯ï¼‰ç­‰ï¼Œæœ‰æ—¶å®¹æ˜“åœ¨å†·å´è¿‡ç¨‹ä¸­äº§ç”Ÿç¿˜æ›²ã€‚çƒ­åºŠå¯ä»¥åœ¨æ‰“å°è¿‡ç¨‹ä¸­åŠ çƒ­ï¼Œæœ‰åŠ©äºå‡å°‘ææ–™ç¿˜æ›²ï¼Œæé«˜æ‰“å°çš„æˆåŠŸç‡ã€‚ ç”µæ°”ç³»ç»Ÿç”µæ°”ç³»ç»Ÿåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ¨¡å—ï¼š ç”µæº ä¸»æ¿ï¼ˆéœ€è¦çƒ§å½•å›ºä»¶ä»£ç å¦‚ Marlinï¼‰ æ˜¾ç¤ºå± ä¼ æ„Ÿå™¨åŠ çƒ­æ¨¡å—ç­‰ äº†è§£å„æ¨¡å—çš„æ‰€éœ€ç”µæºç”µå‹ï¼ŒåŠŸè€—ç­‰ä¿¡æ¯é€‰å–åˆé€‚ç”µæº äº†è§£æ‰“å°æœºçš„æ‰€éœ€åŠŸèƒ½ï¼Œè¿›è¡Œé’ˆå¯¹æ€§é€‰æ‹©ä¸»æ¿ æ‰©å±• Octoprint è¿œç¨‹ç›‘æ§æ¨¡å— 3d æ‰“å°çš„æˆåŠŸç‡å’Œæ¨¡å‹æ–‡ä»¶ã€ææ–™ã€åˆ‡ç‰‡ gcode ä»£ç ã€å¤©æ°”ã€æœºå™¨ç­‰å…³è”ï¼Œç„¶ååªæœ‰åœ¨æ‰“å°ä¸­æ‰èƒ½çŸ¥é“æ¨¡å‹æœ‰æ²¡æœ‰å‡ºé—®é¢˜ï¼Œoctoprint è¿æ¥ Wifiï¼Œé€šè¿‡ç½‘é¡µç«¯è¿œç¨‹æ‘„åƒå¤´ç›‘æ§è¿›åº¦ï¼ŒåŒæ—¶èƒ½å¤Ÿå¼€å§‹å’Œåœæ­¢æ‰“å°æœºçš„æ“ä½œã€‚ è‡ªåŠ¨è°ƒå¹³ é€šå¸¸æœºå™¨åœ¨å‡ å¤©å†…è°ƒå¹³è¿‡ä¸€æ¬¡ä¹‹åå¾ˆå¤§å‡ ç‡ä¸ç”¨é‡æ–°è°ƒå¹³ï¼Œä½†æ˜¯å¯¹æœºå™¨çš„ä¸€ä¸¾ä¸€åŠ¨åŒ…æ‹¬æœºå™¨è‡ªå·±çš„è€åŒ–éƒ½ä¼šå½±å“çƒ­åºŠçš„ä½ç½®ç§»åŠ¨å’Œå˜å½¢ï¼Œè‡ªåŠ¨è°ƒå¹³æ¨¡å— 3D touchï¼ˆä¹Ÿæœ‰åˆ«çš„ï¼‰èƒ½å¤Ÿè®©å®Œå…¨æ‰‹åŠ¨çš„è°ƒå¹³å˜æˆåŠè‡ªåŠ¨è°ƒå¹³ã€‚ åŒ Z ç»“æ„ é¡¾åæ€ä¹‰å°±æ˜¯æœ‰ä¸¤æ ¹ Z è½´ã€‚ å•ä¸€çš„ Z è½´ç”±äºåœ¨ä¸€è¾¹å®¹æ˜“å¯¼è‡´ Z è½´å˜å½¢é€ æˆæ¨¡å‹å‚ç›´æ–¹å‘å˜å½¢ã€‚åŒæ—¶ä¹Ÿå¯èƒ½ä¼šè®© XY å¹³é¢åœ¨å˜å½¢çš„ Z è½´è¿åŠ¨å—é˜»ã€‚ åŒ Z ç»“æ„ä¸ä»…èƒ½å¤Ÿå‡å°‘å˜å½¢ï¼ŒåŒæ—¶å¢å¼º Z è½´çš„ç¨³å®šæ€§ã€‚ ç¡¬ä»¶ç¡¬ä»¶é€‰å‹ç¡¬ä»¶é‡‡ç”¨ MKS Gen L v2.1ï¼Œå›ºä»¶é‡‡ç”¨ Klipper pin å£å›¾ ç¡¬ä»¶ç›¸å…³ä¸»è¦è€ƒè™‘å› ç´ : é©±åŠ¨ç”µæœºæ•°é‡ï¼ˆæ ¹æ® 3D æ‰“å°æœºçš„ç»“æ„æ–¹æ¡ˆç¡®å®šï¼‰ é™ä½å¼€å…³ é£æ‰‡æ§åˆ¶ æŒ¤å‡ºå¤´æ§åˆ¶ çƒ­æ•ç”µé˜»ï¼ˆçƒ­åºŠåŠ çƒ­æ£’æŒ¤å‡ºå¤´ï¼‰ å•ä¸‹ä½æœºæ–¹æ¡ˆéœ€è¦æ”¯æŒå±å¹•æ¥å£ ä¸Šä½æœºæ–¹æ¡ˆéœ€è¦æ”¯æŒ USB è¿æ¥ ç³»ç»Ÿå›ºä»¶KlipperKlipper æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€çµæ´»çš„ 3D æ‰“å°æœºå›ºä»¶ï¼Œå®ƒé€šè¿‡å°†ä¸€äº›è®¡ç®—å·¥ä½œè½¬ç§»åˆ°æ›´å¼ºå¤§çš„ä¸»æœºï¼ˆå¦‚ Raspberry Piï¼‰ä¸Šæ¥æé«˜æ‰“å°è´¨é‡å’Œé€Ÿåº¦ã€‚ MarlinMarlin æ˜¯ç›®å‰æœ€æµè¡Œçš„ 3D æ‰“å°æœºå›ºä»¶ä¹‹ä¸€ï¼Œæ”¯æŒå¹¿æ³›çš„ç¡¬ä»¶å¹³å°å’Œ 3D æ‰“å°æœºæ¨¡å‹ï¼Œå…·æœ‰ä¸°å¯Œçš„åŠŸèƒ½å’Œé«˜åº¦çš„å¯å®šåˆ¶æ€§ã€‚ æ§åˆ¶è½¯ä»¶fluiddFluidd æ˜¯ä¸€ä¸ªåŸºäºç½‘é¡µçš„æ§åˆ¶ç•Œé¢ï¼Œç”¨äºç®¡ç†å’Œç›‘æ§è¿è¡Œ Klipper å›ºä»¶çš„ 3D æ‰“å°æœºã€‚å®ƒæä¾›äº†ç”¨æˆ·å‹å¥½çš„ç•Œé¢å’Œå®æ—¶ç›‘æ§åŠŸèƒ½ã€‚GitHub åœ°å€: https://github.com/fluidd-core/fluiddå®‰è£…æ‰‹å†Œ: https://github.com/dw-0/kiauh Make-meMake-me æ˜¯ä¸€ä¸ªé€šè¿‡ WiFi æ§åˆ¶ Replicator 2 æ‰“å°æœºçš„å¼€æºé¡¹ç›®ï¼Œä½¿ç”¨ GitHub çš„èŠå¤©æœºå™¨äºº Hubot æ¥ç›‘æ§å’Œå®Œæˆæ‰“å°ä»»åŠ¡ã€‚ç›®å‰åªæ”¯æŒ Mac çš„ OS Xã€‚ Pepeteir-ServerPepeteir-Server æ˜¯ä¸€ä¸ªæ–°å‹çš„ Repeteir äº§å“ï¼Œå¯ä»¥åœ¨ Raspberry Pi ä¸Šè¿è¡Œï¼Œæ”¯æŒæ§åˆ¶å¤šå°æ‰“å°æœºï¼Œå†…å­˜æ¶ˆè€—æå°ã€‚å®ƒçš„ç½‘é¡µæ“ä½œç•Œé¢ç®€å•ï¼Œä½†ä¸æ”¯æŒ Mac å’Œ PCã€‚ OctoprintOctoprint æ˜¯ä¸€ä¸ªå®Œå…¨åŸºäºç½‘é¡µçš„ 3D æ‰“å°æœºæ§åˆ¶ç¨‹åºï¼Œå¯ä»¥è¿œç¨‹æ§åˆ¶æ‰“å°æœºï¼Œå¹¶é€šè¿‡ç½‘ç»œæ‘„åƒå¤´ç›‘æ§æ‰“å°è¿‡ç¨‹ã€‚æ”¯æŒ Raspberry Piã€‚ BotqueueBotqueue æ˜¯ä¸€ä¸ªå¼€æºçš„è¿œç¨‹æ‰“å°æœºæ§åˆ¶è½¯ä»¶ï¼Œå¯ä»¥æ§åˆ¶å¤šå°æ‰“å°æœºã€‚ç”¨æˆ·ä¸Šä¼  .stl æ–‡ä»¶åï¼Œè½¯ä»¶ä¼šå®Œæˆåˆ‡ç‰‡å’Œæ‰“å°å·¥ä½œã€‚å®ƒæ”¯æŒä¸ºæ¯å°æ‰“å°æœºè®¾ç½®ç‹¬ç«‹çš„åˆ‡ç‰‡ç‰¹æ€§ã€‚ åˆ‡ç‰‡è½¯ä»¶åˆ‡ç‰‡è½¯ä»¶ç”¨äºå°† 3D æ¨¡å‹æŒ‰å±‚åˆ‡ç‰‡ï¼Œå¹¶ç”Ÿæˆç”¨äºæ‰“å°çš„ G ä»£ç ã€‚ CuraCura ç”± Ultimaker å¼€å‘ï¼Œå…¼å®¹å¤šç§ 3D æ‰“å°æœºã€‚å®ƒä¸ä»…å¯ä»¥åˆ‡ç‰‡ï¼Œè¿˜æä¾› 3D æ‰“å°æœºæ§åˆ¶ç•Œé¢ï¼Œå°¤å…¶é€‚ç”¨äº Ultimaker çš„ 3D æ‰“å°æœºã€‚ Slic3rSlic3r æ˜¯å¼€æºä¸”å…è´¹çš„åˆ‡ç‰‡è½¯ä»¶ï¼Œå› å…¶å¿«æ·æ€§å’Œé«˜åº¦å¯å®šåˆ¶åŒ–è€Œå¹¿å—æ¬¢è¿ã€‚è®¸å¤š 3D æ‰“å°æœºåˆ¶é€ å•†æä¾›é»˜è®¤çš„ Slic3r é…ç½®æ–‡ä»¶ï¼ˆ.INI æ–‡ä»¶ï¼‰ï¼Œå¯ä»¥ç”¨ä½œåˆå§‹è®¾ç½®ã€‚ Skeinforgeå¦ä¸€æ¬¾éå¸¸æµè¡Œçš„åˆ‡ç‰‡è½¯ä»¶ã€‚åŒæ ·å¼€æºï¼Œå…è´¹ã€‚ kisslicerKISSlicer æ˜¯ä¸€æ¬¾è·¨å¹³å°çš„åˆ‡ç‰‡è½¯ä»¶ï¼Œåç§°æºè‡ª â€œKeep It Simpleâ€ï¼ˆä¿æŒç®€å•ï¼‰ï¼Œç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªç®€å•æ˜“ç”¨çš„ç•Œé¢ã€‚ PrintrunPrintrun æ—¢æ˜¯æ§åˆ¶è½¯ä»¶ï¼Œä¹Ÿæ˜¯åˆ‡ç‰‡è½¯ä»¶ï¼Œå¯ä»¥ç‹¬ç«‹å®Œæˆä»åˆ‡ç‰‡åˆ°æ‰“å°çš„æ•´ä¸ªè¿‡ç¨‹ã€‚æ”¯æŒ Macã€Linux å’Œ PC æ“ä½œå¹³å°ã€‚ Repetier-HostRepetier-Host ä¸ Printrun ç±»ä¼¼ï¼Œæ˜¯ä¸€æ¬¾ç»¼åˆæ€§è½¯ä»¶ï¼Œå…·æœ‰åˆ‡ç‰‡ã€é›¶ä»¶å®šä½å’Œæœºå™¨æ§åˆ¶åŠŸèƒ½ã€‚ç”¨æˆ·ç•Œé¢ç›¸å¯¹æ›´å¤æ‚ä½†æ›´ç›´è§‚ï¼ŒåŒæ ·æ”¯æŒ Macã€Linux å’Œ PC æ“ä½œå¹³å°ã€‚ 3D å»ºæ¨¡è½¯ä»¶BlenderBlender æ˜¯ä¸€æ¬¾å¼€æºçš„ 3D å»ºæ¨¡è½¯ä»¶ï¼ŒåŠŸèƒ½å¼ºå¤§ä¸”å®Œå…¨å…è´¹ã€‚å®ƒä¸ä»…å¯ä»¥ç”¨äº 3D å»ºæ¨¡ï¼Œè¿˜æ”¯æŒåŠ¨ç”»ã€æ¸²æŸ“ã€é›•åˆ»ç­‰å¤šç§åŠŸèƒ½ï¼Œé€‚ç”¨äºå„ç§å¤æ‚çš„ 3D è®¾è®¡å’Œåˆ¶ä½œã€‚ TinkercadTinkercad æ˜¯ä¸€ä¸ªç”± Autodesk å¼€å‘çš„åœ¨çº¿ 3D å»ºæ¨¡å·¥å…·ï¼Œé€‚åˆåˆå­¦è€…ä½¿ç”¨ã€‚å®ƒåŸºäºæµè§ˆå™¨ï¼Œæ— éœ€ä¸‹è½½è½¯ä»¶ï¼Œç•Œé¢å‹å¥½ä¸”æ˜“äºä½¿ç”¨ã€‚ Fusion 360Fusion 360 åŒæ ·ç”± Autodesk å¼€å‘ï¼Œæ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„äº‘ç«¯ 3D CADã€CAM å’Œ CAE å·¥å…·ã€‚å®ƒé€‚ç”¨äºä»åˆå­¦è€…åˆ°ä¸“ä¸šäººå£«çš„å„ä¸ªå±‚çº§ï¼Œæä¾›äº†å…¨é¢çš„å»ºæ¨¡ã€ä»¿çœŸå’Œåˆ¶é€ åŠŸèƒ½ã€‚ SketchUpSketchUp æ˜¯ä¸€æ¬¾å¹¿å—æ¬¢è¿çš„ 3D å»ºæ¨¡è½¯ä»¶ï¼Œä»¥å…¶ç›´è§‚çš„ç”¨æˆ·ç•Œé¢å’Œæ˜“ç”¨æ€§è‘—ç§°ã€‚å®ƒæœ‰å…è´¹ç‰ˆæœ¬ï¼ˆSketchUp Freeï¼‰å’Œä¸“ä¸šç‰ˆæœ¬ï¼ˆSketchUp Proï¼‰ï¼Œé€‚ç”¨äºå»ºç­‘ã€å·¥ç¨‹ã€æ¸¸æˆå¼€å‘ç­‰å¤šä¸ªé¢†åŸŸã€‚ FreeCADFreeCAD æ˜¯ä¸€æ¬¾å¼€æºçš„ 3D CAD å»ºæ¨¡è½¯ä»¶ï¼Œé€‚åˆäºäº§å“è®¾è®¡ã€æœºæ¢°å·¥ç¨‹ä»¥åŠå»ºç­‘è®¾è®¡ã€‚å®ƒå…·æœ‰æ¨¡å—åŒ–çš„æ¶æ„ï¼Œå¯ä»¥é€šè¿‡æ’ä»¶æ‰©å±•å…¶åŠŸèƒ½ã€‚ SolidWorksSolidWorks æ˜¯ä¸€æ¬¾ç”± Dassault SystÃ¨mes å¼€å‘çš„ä¸“ä¸š 3D CAD è½¯ä»¶ï¼Œå¹¿æ³›åº”ç”¨äºå·¥ç¨‹è®¾è®¡ã€äº§å“è®¾è®¡å’Œåˆ¶é€ ä¸šã€‚å®ƒåŠŸèƒ½å¼ºå¤§ï¼Œä½†ä»·æ ¼è¾ƒé«˜ï¼Œé€šå¸¸ç”¨äºå·¥ä¸šçº§åº”ç”¨ã€‚ OnshapeOnshape æ˜¯ä¸€ä¸ªåŸºäºäº‘çš„ 3D CAD å»ºæ¨¡è½¯ä»¶ï¼Œé€‚ç”¨äºå›¢é˜Ÿåä½œå’Œè®¾è®¡é¡¹ç›®ã€‚å®ƒæ— éœ€å®‰è£…ï¼Œç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œæ”¯æŒå®æ—¶åä½œå’Œç‰ˆæœ¬æ§åˆ¶ã€‚ OpenSCADOpenSCAD æ˜¯ä¸€æ¬¾å¼€æºçš„ 3D CAD å»ºæ¨¡è½¯ä»¶ï¼Œé€‚ç”¨äºåˆ›å»ºç²¾ç¡®çš„ 3D æ¨¡å‹ã€‚å®ƒä½¿ç”¨ç¼–ç¨‹è¯­è¨€æ¥å®šä¹‰æ¨¡å‹ï¼Œé€‚åˆé‚£äº›æœ‰ç¼–ç¨‹ç»éªŒçš„ç”¨æˆ·ã€‚ åˆ‡ç‰‡è½¯ä»¶-Cura çš„ä½¿ç”¨è®¾ç½®æ‰“å°æœºé•¿å®½é«˜200*200*200mm æ‰“å°å¤´å­”å¾„ 0.4mm ææ–™ç›´å¾„ 1.75mm é…ç½® Cura è®¾ç½®å¯è§æ€§å¯ä»¥æ ¹æ®è‡ªå·±åœ¨åˆ‡ç‰‡æ—¶å®é™…éœ€è¦è°ƒæ•´çš„ç›¸å…³å‚æ•°è¿›è¡Œæ˜¾ç¤º ç§»åŠ¨å’Œç¼©æ”¾æ¨¡å‹é•¿æŒ‰é¼ æ ‡æ»šè½®ä¸­é”®ï¼Œå¯å¹³ç§»è§†è§’ é•¿æŒ‰é¼ æ ‡å³é”®ï¼Œå¯æ—‹è½¬è§†è§’ æ»šåŠ¨é¼ æ ‡æ»šè½®ï¼Œå¯æ”¾å¤§ç¼©å°è§†è§’ é€‰ä¸­æ¨¡å‹åï¼Œåœ¨ Cura çš„å·¦ä¾§ï¼Œä¾æ¬¡åŠŸèƒ½ä¸º ç§»åŠ¨ ç¼©æ”¾ æ—‹è½¬ é•œåƒ å•ä¸€æ¨¡å‹è®¾ç½® æ”¯æ’‘æ‹¦æˆªå™¨ åœ¨ç›¸åº”ä½ç½®æ·»åŠ æ–¹å—å‡å°‘æ”¯æ’‘åº”ç”¨å³å‡»æ¨¡å‹ï¼Œå¯è¿›è¡Œâ€å¤åˆ¶â€ã€â€æ¸…ç©ºå¹³å°â€ã€â€å±…ä¸­æ¨¡å‹ç­‰è®¾ç½® è®¾ç½®æ‰“å°å‚æ•°ç‚¹å‡»å³ä¾§çš„æ‰“å°å‚æ•°è®¾ç½®æ ï¼Œé€‰æ‹©å¤šç§æ¨¡å¼ è´¨é‡å³å±‚é«˜ï¼šæ•°å€¼è¶Šå°ï¼Œæ‰“å°ç‰©ä½“è¡¨é¢æ•ˆæœè¶Šå¥½ï¼Œæ‰“å°æ—¶é—´è¶Šé•¿ã€‚é»˜è®¤é€‰æ‹© 0.15mm å¡«å……æ‰“å°æ¨¡å‹å†…éƒ¨çš„æ¨¡å‹å¯†åº¦ï¼Œé»˜è®¤ä»¥ç½‘æ ¼çŠ¶çš„å½¢å¼å¡«å……ã€‚é»˜è®¤é€‰æ‹© 20% å¦‚æœå¡«å……ç‡è¿‡ä½ï¼Œä¹Ÿä¼šæœ‰ä¸€å®šç¨‹åº¦å¯¼è‡´ç¿˜è¾¹ï¼Œä¸åŒçš„å†…éƒ¨å¡«å……å›¾æ¡ˆä¹Ÿå¯ä»¥æœ‰æ•ˆå‡å°‘ç¿˜è¾¹ã€‚ ææ–™ä¸»è¦è®¾ç½®æ‰“å°æ—¶å–·å˜´å’Œçƒ­åºŠçš„æ¸©åº¦ã€‚ä¸€èˆ¬è€—æä¸Šä¼šå†™æœ‰æ‰“å°æ¸©åº¦ã€‚ä¹Ÿå¯é€šè¿‡æ‰“å°æ¸©åº¦å¡”æµ‹è¯•å‡ºæ¯ç§æœ€è€—æå“ç‰Œæœ€ä½³çš„æ‰“å°æ¸©åº¦ã€‚å»ºè®®é¦–å±‚æ¸©åº¦ç”¨ 230Â°Cï¼Œå®¹æ˜“ç²˜åºŠã€‚ æ‰“å° PLAï¼Œçƒ­åºŠçš„æ¸©åº¦å»ºè®®åœ¨ 50-60Â°Cã€‚ é€Ÿåº¦PLA å»ºè®®æ‰“å°é€Ÿåº¦ä¸º 60mmsï¼ŒÂ±20 ä¹Ÿåœ¨å¸¸ç”¨é€Ÿåº¦ã€‚ è¿‡å¿«æ­¥è¿›ç”µæœºä¼šä¸¢æ­¥ï¼ŒæŒ‰å®é™…æƒ…å†µè®¾ç½® ç§»åŠ¨å½“å–·å˜´ç§»åŠ¨åˆ°éæ‰“å°åŒºåŸŸä¸Šæ–¹æ—¶å›æŠ½è€—æ å½“æ‰“å°å‡ºç°æ‹‰ä¸æƒ…å†µï¼Œå¯è°ƒæ•´å›æŠ½è®¾ç½®ã€‚å»ºè®®å›æŠ½è·ç¦»ç”¨ 2.0mmï¼Œå›æŠ½é€Ÿåº¦ç”¨ 50mmsï¼ŒåŠ å¤§æ•°å€¼å¯å‡å°‘æ‹‰ä¸æƒ…å†µã€‚å¦‚æœæ‰“å°è¿‡ç¨‹ä¸­å–·å˜´æœ‰ç¢°åˆ°æ‰“å°ç‰©çš„æƒ…å†µï¼Œå¯å‹¾é€‰ Z è½´æŠ¬å‡ã€‚ é™„ç€åŠ å¤§æ¨¡å‹ç¬¬ä¸€å±‚ä¸æ‰“å°å¹³å°çš„æ¥è§¦é¢ç§¯ï¼Œå¢åŠ é™„ç€åŠ›ï¼Œè®©æ¨¡å‹åœ¨æ‰“å°è¿‡ç¨‹ä¸­æ›´ç¨³å›ºã€‚å½“æ‰“å°æ¨¡å‹çš„é«˜åº¦è¾ƒé«˜ï¼Œæ¥è§¦é¢ç§¯è¾ƒå°æ—¶ä½¿ç”¨ã€‚ skirt è£™è¾¹ åœ¨æ‰“å°æ¨¡å‹å‰ï¼Œåœ¨æ¨¡å‹å¤–å›´æ‰“å°ä¸€åœˆï¼Œè®©å–·å¤´é‡Œé¢çš„å‡ºä¸æ¯”è¾ƒé¡ºæ»‘,ä¸»è¦ç”¨äºæ“¦å‡€å–·å¤´ brim åœ¨æ¨¡å‹çš„è¾¹ç¼˜å¤„åŠ ä¸Šè–„è–„çš„ä¸€å±‚ï¼Œé˜²æ­¢ç¿˜è¾¹ï¼Œé€‚ç”¨äºæ‰“å°è¾ƒé«˜çš„ç‰©ä½“ä¸”æ¥è§¦é¢è¾ƒå°ï¼Œå®¹æ˜“å€’å¡Œçš„æ—¶å€™ raft åº•åº§ï¼Œåœ¨åº•åº§ä¸Šåœ¨æ‰“å°æ¨¡å‹ï¼Œé€‚ç”¨äºæ¥è§¦é¢å¤šä¸”å¤æ‚çš„æƒ…å†µ æ”¯æ’‘åœ¨æ¨¡å‹çš„æ‚¬å‚éƒ¨åˆ†ç”Ÿæˆæ”¯æ’‘ç»“æ„ï¼Œé˜²æ­¢æ¨¡å‹å€’å¡Œã€‚ä½œä¸ºå…¥é—¨æœ€éš¾çš„ä¸€ä¸ªè®¾ç½®ã€‚é€šå¸¸è§’åº¦è¿‡å¤§ï¼Œæ‰“å°è¿‡ç¨‹ä¸­æ‚¬ç©ºéƒ¨ä½åˆ™éœ€è¦æ·»åŠ æ”¯æ’‘ï¼Œå¦åˆ™å®¹æ˜“ä¸‹å‚ã€‚æ”¯æ’‘ä¸æ¨¡å‹æ¥è§¦é¢å¾€å¾€å¾ˆç²—ç³™ï¼Œå½±å“æ¨¡å‹è´¨é‡ã€‚ æ”¯æ’‘æ‚¬å‚è§’åº¦è¶Šå¤§ï¼Œéœ€è¦æ”¯æ’‘éƒ¨ä½ï¼ˆçº¢è‰²éƒ¨åˆ†ï¼‰åˆ™è¶Šå°ã€‚å»ºè®® 45-50 é—´ã€‚ æ·»åŠ æ”¯æ’‘çš„æœ€å°æ‚¬å‚è§’åº¦ï¼Œå½“è§’åº¦ä¸º 0 æ—¶ï¼Œå°†æ”¯æ’‘æ‰€æœ‰æ‚¬å‚ï¼Œå½“è§’åº¦ä¸º 90 åº¦æ—¶ï¼Œä¸æä¾›ä»»ä½•æ”¯æŒ Cura æä¾›æ™®é€šæ”¯æ’‘å’Œæ ‘å‹æ”¯æ’‘ä¸¤ç§é€‰æ‹©ã€‚ æ ‘å‹æ”¯æ’‘å¯¹æ¨¡å‹å½±å“æ›´å°ï¼Œä¹ŸèŠ‚çœææ–™ã€‚æ³¨æ„ï¼Œå®ƒåªé€‚åˆäºéå¹³é¢çš„æ‚¬ç©ºï¼Œå¦‚é¼»å°–ï¼ŒæŒ‡å°–æˆ–æ‹±å½¢ã€‚å¯¹äºå¹³é¢çš„æ‚¬ç©ºï¼Œæ ‘å½¢æ”¯æ’‘æ— æ³•æä¾›è¶³å¤Ÿçš„ç¨³å®šæ€§ã€‚ æ­£å¸¸æ”¯æ’‘å»ºè®®å‚æ•°æ”¯æ’‘å›¾æ¡ˆï¼šé”¯é½¿å½¢æ”¯æ’‘å¯†åº¦ï¼š15-20æ”¯æ’‘å¢™è¡Œæ•°ï¼š0æ”¯æ’‘ Z è·ç¦»ï¼šæ¨èæ¯”å±‚é«˜ç•¥å°ï¼ˆå¦‚ï¼š0.2 å±‚é«˜ï¼Œè®¾ç½®ä¸º 0.15ï¼‰ä¸€èˆ¬æ­¤å‚æ•°ä¸º 0.6~1.5 å€å±‚é«˜ã€‚å½“æ¨¡å‹åº•é¢è¾ƒä¸ºå¹³ç¼“æ—¶ï¼Œå¯è®¾ç½®è¾ƒå¤§çš„é—´éš™ï¼Œå‡å°‘æ‹†æ”¯æ’‘éš¾åº¦ã€‚å½“æ¨¡å‹åº•é¢å˜åŒ–å¤§æ—¶ï¼Œåº”è®¾ç½®è¾ƒå°çš„é—´éš™ã€‚åŒæ—¶ï¼Œæ”¯æ’‘é—´éš™ä¸æ”¯æ’‘å¯†åº¦ä¹Ÿæœ‰å…³è”ï¼Œæ”¯æ’‘å¯†åº¦è¾ƒé«˜æ—¶ï¼Œå¯é€‚å½“æ‹‰å¤§é—´éš™ã€‚æ”¯æ’‘ XY è·ç¦»ï¼š1-1.5mm æ ‘å½¢æ”¯æ’‘å»ºè®®å‚æ•°æ”¯æ’‘å›¾æ¡ˆï¼šé”¯é½¿å½¢æ”¯æ’‘å¯†åº¦ï¼š15-20æ”¯æ’‘å¢™è¡Œæ•°ï¼š1è¿æ¥æ”¯æ’‘é”¯é½¿å½¢: å‹¾é€‰æ”¯æ’‘ Z è·ç¦»ï¼šæ¨èæ¯”å±‚é«˜ç•¥å°ï¼ˆå¦‚ï¼š0.2 å±‚é«˜ï¼Œè®¾ç½®ä¸º 0.15ï¼‰ä¸€èˆ¬æ­¤å‚æ•°ä¸º 0.6~1.5 å€å±‚é«˜ã€‚æ”¯æ’‘ XY è·ç¦»ï¼š1-1.5 ä¿å­˜å’Œé¢„è§ˆç‚¹å‡»å³ä¸‹è§’çš„åˆ‡ç‰‡ï¼Œç­‰å¾…åˆ‡ç‰‡å®Œæ¯•åï¼Œå¯åœ¨é¢„è§ˆç•Œé¢é¢„è§ˆæ‰“å°æ•ˆæœã€è€—æç”¨é‡åŠé¢„è®¡ç”¨æ—¶ã€‚æ‹‰åŠ¨æœ€å³è¾¹è¿›åº¦æ¡ï¼Œå¯æŸ¥çœ‹æ¯å±‚æ‰“å°æƒ…å†µã€‚ç‚¹å‡»å³ä¸‹è§’ä¿å­˜ gcode æ–‡ä»¶å‡†å¤‡æ‰“å°ã€‚ ç‰¹æ®Šæ“ä½œ åå¥½è®¾ç½®â€â€”â€œåŸºæœ¬â€â€”â€œè‡ªåŠ¨ä¸‹é™æ¨¡å‹åˆ°æ‰“å°å¹³å°â€ å‡å¦‚åªæƒ³æ‰“å°ä¸€åŠæ¨¡å‹ï¼Œå¯è§£é™¤ Z è½´é™åˆ¶ï¼Œå¯ä½¿æ¨¡å‹ä¸‹é™è‡³è´Ÿæ•°ã€‚åˆ‡ç‰‡ååªä¼šæ‰“å°å¹³å°ä¸Šæ–¹éƒ¨åˆ†ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","ç¡¬ä»¶çŸ¥è¯†","3Dæ‰“å°"]},{"title":"Field-Oriented Control (FOC) çŸ¢é‡æ§åˆ¶ ç£åœºå®šå‘æ§åˆ¶_sensorless field oriented control of a pmsmä¸­æ–‡-CSDNåšå®¢","path":"/2023/10/20/5-åµŒå…¥å¼å¼€å‘-ç¡¬ä»¶çŸ¥è¯†-Field-Oriented-Control-FOC-çŸ¢é‡æ§åˆ¶-ç£åœºå®šå‘æ§åˆ¶-sensorless-field-oriented-control-of-a-pmsmä¸­æ–‡-CSDNåšå®¢/","content":"æ°¸ç£åŒæ­¥ç”µæœºï¼ˆPMSM, Permanent Magnet Synchronous Motorï¼‰ç”±äºå®ƒå™ªå£°å°ã€é«˜æ•ˆèŠ‚èƒ½çš„æ˜¾è‘—ä¼˜åŠ¿ï¼Œå¹¿æ³›è¢«ç”¨äºæ–°èƒ½æºæ±½è½¦ã€æœºå™¨äººä¼ºæœå’Œå®¶ç”µç­‰é¢†åŸŸã€‚ä¸Šå›¾æ˜¯ä¸€ä¸ª PMSM çš„ç¤ºæ„å›¾ï¼ŒABC ä¸ºä¸‰ç›¸äº¤æµç”µï¼Œå¤–åœˆä¸ºå®šå­ï¼Œå†…éƒ¨ä¸ºè½¬å­ã€‚è½¬å­ä¸ºæ°¸ç£ä½“ï¼ˆpermanent magnetï¼‰ã€‚å½“å®šå­çº¿åœˆé€šä¸Š ABC ä¸‰ç›¸äº¤æµç”µåï¼Œç”±äºç”µç£æ•ˆåº”å¸¦åŠ¨è½¬å­è½¬åŠ¨ï¼Œè€Œè½¬å­è½¬åŠ¨çš„é¢‘ç‡å’Œ ABC ä¸‰ç›¸äº¤æµç”µçš„é¢‘ç‡ç›¸åŒï¼Œæ‰€ä»¥å«åŒæ­¥ç”µæœºï¼ˆsynchronous motorï¼‰ã€‚ å’Œ PMSM éå¸¸ç›¸ä¼¼çš„ä¸€ç§ç”µæœºå«åš BLDC Motorï¼ˆç›´æµæ— åˆ·ç”µæœºï¼ŒBrushless DCï¼‰ã€‚å®ƒä»¬æ˜¾è‘—çš„åŒºåˆ«åœ¨äºåç”µåŠ¨åŠ¿ï¼ˆback EMFï¼‰çš„æ³¢å½¢ã€‚BLDC çš„åç”µåŠ¨åŠ¿å‘ˆæ¢¯å½¢çŠ¶ï¼Œè€Œ PMSM çš„åç”µåŠ¨åŠ¿å‘ˆæ­£å¼¦æ³¢çŠ¶ã€‚è¿™ä¸¤è€…çš„å·®å¼‚çš„åŸå› æ˜¯ç”±äº PMSM çš„å®šå­ç»•ç»„çº¿åœˆç¼ ç»•å‘ˆæ­£å¼¦åˆ†å¸ƒï¼Œè€Œ BLDC çš„å®šå­ç»•ç»„çº¿åœˆç¼ ç»•ä¸ºé›†ä¸­å¼ã€‚ ä¸‹é¢çš„åŠ¨å›¾å±•ç°äº† BLDC å’Œ PMSM åœ¨æ§åˆ¶ä¸Šçš„å·®å¼‚ï¼š æµ…è“è‰²ç®­å¤´ä»£è¡¨è½¬å­çš„ç£åœºçŸ¢é‡æ–¹å‘ï¼Œå¯ä»¥çœ‹åˆ°æµ…è“è‰²ç®­å¤´åœ¨ BLDC å’Œ PMSM éƒ½æ˜¯åœ¨ä¸åœæ—‹è½¬ï¼Œå¹¶ä¸”è¿™ä¸ªæ—‹è½¬ä¼šäº§ç”ŸåŠ›çŸ©ï¼ˆtorqueï¼‰å¸¦åŠ¨æœºæ¢°è´Ÿè½½çš„è¿åŠ¨ã€‚BLDC çš„è½¬å­æ—‹è½¬æ˜¯ä¸€é¡¿ä¸€é¡¿çš„ï¼ŒPMSM çš„è½¬å­æ—‹è½¬æ˜¯éå¸¸è¿ç»­å¹³æ»‘ã€‚æ§åˆ¶ BLDC çš„æœ€ç»æµçš„æ–¹æ³•æ˜¯ 6 æ­¥æ¢å‘æ³•ã€‚é€šå¸¸é€šè¿‡æ£€æµ‹è½¬å­è§’åº¦ä½ç½®ï¼Œæ¥ä¾æ¬¡ç»™å®šå­æ¢å‘ï¼Œè¿™æ ·çš„æ¢å‘ï¼Œé€ æˆäº†è¾“å‡ºåŠ›çŸ©æœ‰æ³¢åŠ¨ã€‚è€Œ PMSM é€šè¿‡ FOC æ§åˆ¶ï¼Œä¸éœ€è¦æ¢å‘ï¼Œå¯ä»¥ä½¿å¾—è½¬å­ä¿æŒè¿ç»­ã€å¹³æ»‘çš„è½¬åŠ¨ã€‚è¿™æ ·çš„â€å¹³æ»‘â€æ•ˆåº”å°±æ˜¯ Field Oriented Controlï¼ˆFOCï¼‰çš„ç»“æœã€‚å®šå­ä¸‰ç›¸äº¤æµç”µæµç”Ÿæˆçš„ç©ºé—´ç£åœºå‘é‡ï¼Œé€šè¿‡æ§åˆ¶é©±åŠ¨è½¬å­ç£åœºæ—‹è½¬ï¼Œå½¢æˆåŠ›çŸ©â€“â€”â€” è¿™å°±æ˜¯ Field Oriented Controlï¼ˆç£åœºå®šå‘æ§åˆ¶ï¼‰ã€‚ MTPAï¼ˆæœ€å¤§åŠ›çŸ©ç”µæµæ¯”æ§åˆ¶ï¼ŒMaximum Torque Per Ampï¼‰ æ°¸ç£åŒæ­¥ç”µæœºä¸€èˆ¬åˆ†ä¸ºä¸¤ç§ï¼šSPMï¼ˆè¡¨è´´å¼ï¼‰å’Œ IPMï¼ˆå†…åµŒå¼ï¼‰ã€‚ä»æ§åˆ¶çš„è§’åº¦ SPM è¦æ¯” IPM ç®€å•å¾ˆå¤šï¼Œä»¬å…ˆä»¥ SPM ä¸ºä¾‹ï¼Œæš‚ä¸è€ƒè™‘å¼±ç£ï¼ˆä¸€ç§é«˜è½¬é€Ÿæƒ…å†µä¸‹çš„æ§åˆ¶æ–¹æ³•ï¼‰ã€‚å¦‚æœä»¬çš„ç›®æ ‡æ˜¯â€ç›¸åŒçš„ç”µæµè¾“å…¥ï¼Œè¾¾åˆ°æœ€å¤§çš„è¾“å‡ºåŠ›çŸ©â€ã€‚å‡è®¾ä¸‹å›¾ä¸­ä¸Šä¸‹ç«¯æ˜¯å®šå­ï¼Œä¸­é—´çš„æ˜¯è½¬å­ã€‚è®©ä»¬äººä¸ºæ”¹å˜å®šå­ç£åœºçŸ¢é‡å’Œè½¬å­ç£åœºçŸ¢é‡çš„å¤¹è§’ï¼Œå½“å¤¹è§’ä¸º 0 åº¦çš„æ—¶å€™ï¼Œæ²¡æœ‰è¾“å‡ºä»»ä½•åŠ›çŸ©ï¼Œå› ä¸ºç£æ€§çš„å—åŒ—æäº’ç›¸å¸å¼•ã€‚å†è®©ä»¬æ—‹è½¬è½¬å­ï¼Œæ”¹å˜ä¸€ä¸‹å¤¹è§’ï¼Œä¼šè§‰å¾—åŠ›çŸ©å¢å¤§ã€‚å½“å®šå­å’Œè½¬å­ç£åœºå‘é‡æˆ 90 åº¦çš„æ—¶å€™ï¼Œäº§ç”Ÿçš„åŠ›çŸ©æœ€å¤§ã€‚è¿™æ˜¯ä»¬æƒ³è¾¾åˆ°çš„æ•ˆæœ â€“ æœ€å¤§åŒ–ç”µæµçš„åˆ©ç”¨æ•ˆç‡ï¼Œä»¬ç§°ä¹‹ä¸ºï¼šMTPA(Maximum Torque Per Amp)ã€‚åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œè¾“å‡ºçš„åŠ›çŸ©å’Œè¾“å…¥çš„ç”µæµå¹…åº¦æˆæ­£ç›¸å…³ã€‚ä»¬åªéœ€è¦è°ƒæ•´ç”µæµçš„å¹…å€¼ï¼Œå°±å¯ä»¥æ§åˆ¶ç”µæœºè¾“å‡ºçš„åŠ›çŸ©ã€‚å¦‚æœä»¬éœ€è¦æ ¹æ®åé¦ˆæ¥è°ƒæ•´ç”µæœºçš„ç”µæµã€é€Ÿåº¦å’Œä½ç½®ï¼Œå¯ä»¥é€šè¿‡ä¸‰ä¸ª PI æ§åˆ¶å™¨çš„çº§è”çš„ç”µæµç¯ã€é€Ÿåº¦ç¯å’Œä½ç½®ç¯æ¥å®ç°ã€‚ä½†æœ€ç»ˆï¼Œè¿˜æ˜¯é€šè¿‡å¯¹ç”µæµçš„æ§åˆ¶æ¥å®ç°ã€‚ é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œä»¬å¯ä»¥æŠŠ ABC ä¸‰ç›¸äº¤æµç”µå½¢æˆçš„ç£åœºï¼Œçœ‹ç€ä¸€ä¸ªçŸ¢é‡ã€‚FOC æœ€é‡è¦çš„åŸåˆ™å°±æ˜¯ä½¿è¿™ä¸ªç”µæµçŸ¢é‡å’Œæ°¸ç£ä½“è½¬å­è½¬åŠ¨å½¢æˆçš„ç£åœºçŸ¢é‡ä¿æŒå‚ç›´ã€‚ç”±äºè½¬å­æ˜¯åœ¨ä¸åœçš„è½¬åŠ¨ï¼ŒFOC çš„ä»»åŠ¡å°±æ˜¯ï¼š1.ä¸åœçš„è§‚æµ‹è½¬å­çš„è§’åº¦2.å°†ç”µæµçŸ¢é‡çš„è§’åº¦ä¿æŒå’Œè½¬å­ç£åœºçŸ¢é‡å‚ç›´ï¼ˆMTPAï¼‰ä¸Šå›¾å³ä¾§æ˜¯ ABC ä¸‰ç›¸äº¤æµç”µçš„ç¤ºæ„å›¾ã€‚ä¸‰ç§é¢œè‰²ä»£è¡¨ä¸‰ç›¸äº¤æµç”µ ABCã€‚å®ƒä»¬çš„ç›¸ä½å·®ä¸º 120 åº¦ï¼Œä»¬å¯ä»¥æŠŠå®ƒä»¬è¡¨ç¤ºä¸ºä¸Šå›¾å·¦ä¾§çš„çŸ¢é‡å½¢å¼ï¼ˆabc çŸ¢é‡åæ ‡ç³»ï¼‰ã€‚å®ƒä»¬åˆæˆçš„æ€»çŸ¢é‡æ˜¯æ·¡è“è‰²ã€‚ ä¸ºäº†ç ”ç©¶æ–¹ä¾¿ï¼Œä»¬å°†é™æ­¢çš„ abc åæ ‡ç³»å˜ä¸ºé™æ­¢çš„ Î±Î² åæ ‡ç³»ï¼Œè¿™ä¸€æ­¥ä¹Ÿå« Clarke å˜æ¢ï¼š æ¥ç€ï¼Œä»¬å°†é™æ­¢çš„ Î±Î² åæ ‡ç³»å˜ä¸ºæ—‹è½¬çš„ dq åæ ‡ç³»ï¼Œè¿™ä¸€æ­¥ä¹Ÿå« Park å˜æ¢ï¼š åœ¨ç»å† Clarke-Park å˜æ¢åï¼Œä¸‰ç›¸äº¤æµç”µå˜æˆäº†â€ç›´æµç”µâ€ï¼šIdï¼ˆæ·±è“ï¼‰å’Œ Iqï¼ˆçº¢è‰²ï¼‰ï¼Œå®ƒä»¬å®é™…ä¸Šæ˜¯ç”µæµçŸ¢é‡åœ¨ dq åæ ‡ç³»çš„æŠ•å½±ã€‚d è¡¨ç¤º directï¼ˆç›´æ¥ï¼‰ï¼Œq ä»£è¡¨äº† quadratureï¼ˆæ­£äº¤ï¼‰ã€‚å¦‚æœæ˜¯ SPMï¼Œä¸ºäº†ä½¿å¾—ç”µæµæ•ˆç‡æœ€é«˜ï¼ˆMTPAï¼‰ï¼Œä»¬åªè¦ä½¿ Id 0ï¼Œå³æ‰€æœ‰çš„ç”µæµéƒ½ä½œç”¨äºæ­£äº¤ â€“ äº§ç”ŸåŠ›çŸ©ã€‚è¿™æ ·å¤§å¤§ç®€åŒ–äº†æ§åˆ¶ã€‚ ä»¬é€šè¿‡æ§åˆ¶ Idã€Iq å»äº§ç”Ÿç›¸åº”çš„ Vdã€Vqï¼Œç»è¿‡å ParkClarke å˜æ¢å’Œ SVPWMï¼ˆSpace Vector Pulse Width Modulationï¼‰è°ƒåˆ¶ç”µå‹ä¿¡å·ï¼Œç»è¿‡é—¨é©±åŠ¨ï¼ˆGate Driverï¼‰å’Œé€†å˜å™¨ï¼ˆInverterï¼‰äº§ç”Ÿä¸‰ç›¸ç”µå‹ Vaã€Vbã€Vcï¼Œæœ€åå°† Vaã€Vbã€Vc è¾“å…¥åˆ° PMSMï¼Œå®Œæˆäº† FOCã€‚ä¸Šå›¾æ˜¯ FOC çš„æ§åˆ¶ä¿¡å·ç¤ºæ„å›¾ï¼Œå…¶ä¸­è“è‰²çš„æ¨¡å—æ˜¯è½¯ä»¶å®ç°æ¨¡å—ï¼Œç°è‰²çš„ä¸ºç¡¬ä»¶éƒ¨åˆ†ã€‚ ä»¬ç»å¸¸å¬åˆ°ï¼Œç”µæµç¯çš„çš„æ§åˆ¶å‘¨æœŸä¸º 100usï¼ˆ10K Hzï¼‰ã€‚é€šå¸¸æ¥è¯´ï¼Œä¸Šé¢çš„è“è‰²éƒ¨åˆ†ä¸€èˆ¬åœ¨ DSP æˆ–è€… MCU çš„ ISRï¼ˆinterrupt service routineï¼Œä¸­æ–­æœåŠ¡ç¨‹åºï¼‰ä¸­å®ç°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯éš” 100usï¼ŒDSP æˆ–è€… MCU å°±æœ‰ä¸“é—¨çš„ ISR å‡½æ•°åšå¦‚ä¸‹å¤„ç†åŠ¨ä½œï¼š1.æµ‹é‡å‡ºè½¬å­çš„è§’åº¦ï¼ˆÎ¸ï¼‰ï¼Œå¾—å‡ºæ‰€éœ€çš„ Idã€Iq ç”µæµã€‚å°†æ‰€éœ€è¦çš„ Iq ç”µæµå‘é‡å’Œè¯¥è§’åº¦ä¿æŒå‚ç›´ã€‚åœ¨ MTPA æƒ…å†µä¸‹ï¼Œå¦‚æœæ˜¯ SPMï¼Œæ‰€éœ€ Id è®¾ä¸º 0ã€‚2.æµ‹é‡å‡ºå®é™…ç›¸ç”µæµï¼ˆIaã€Ibã€Icï¼‰ï¼Œé€šè¿‡ ClarkePark å˜æ¢äº§ç”Ÿå®é™… Idã€Iq ç”µæµã€‚3.åˆ©ç”¨ä¸Šè¿°çš„æ‰€éœ€ç”µæµå’Œå®é™…ç”µæµä¿¡å·å·®ï¼Œé€šè¿‡ PI æ§åˆ¶å™¨ï¼Œå¾—å‡º Vdã€Vqã€‚4.ç»è¿‡å ParkClarke å˜æ¢ã€SVPWM äº§ç”Ÿå ç©ºæ¯”ï¼Œäº¤ç»™é€†å˜å™¨ç”Ÿæˆ Vaã€Vbã€Vc é©±åŠ¨ç”µæœºã€‚ Field-Oriented Control (FOC)ç£åœºå®šå‘æ§åˆ¶ï¼ˆFOCï¼‰ï¼Œä¹Ÿç§°ä¸ºçŸ¢é‡æ§åˆ¶ï¼Œæ˜¯ä¸€ç§ç”¨äºæ§åˆ¶æ°¸ç£åŒæ­¥ç”µåŠ¨æœºï¼ˆPMSMï¼‰å’Œäº¤æµæ„Ÿåº”ç”µåŠ¨æœºï¼ˆACIMï¼‰çš„æŠ€æœ¯ã€‚ FOC åœ¨æ•´ä¸ªæ‰­çŸ©å’Œé€Ÿåº¦èŒƒå›´å†…éƒ½å…·æœ‰è‰¯å¥½çš„æ§åˆ¶èƒ½åŠ›ã€‚ FOC çš„å®ç°éœ€è¦å°†å®šå­ç”µæµä»å›ºå®šå‚è€ƒç³»è½¬æ¢ä¸ºè½¬å­ç£é€šå‚è€ƒç³»ï¼ˆä¹Ÿç§°ä¸º d-q å‚è€ƒç³»ï¼‰ã€‚ çŸ¢é‡æ§åˆ¶æ˜¯å»ºç«‹åœ¨è¢«æ§å¯¹è±¡å‡†ç¡®çš„æ•°å­¦ æ¨¡å‹ ä¸Šï¼Œä½¿äº¤æµç”µæœºæ§åˆ¶ç”±å¤–éƒ¨å®è§‚ç¨³æ€æ§åˆ¶æ·±å…¥åˆ°ç”µæœºå†…éƒ¨ç”µç£è¿‡ç¨‹çš„ç¬æ€æ§åˆ¶ã€‚çŸ¢é‡æ§åˆ¶é€šè¿‡åæ ‡å˜æ¢å°†äº¤æµç”µæœºå†…éƒ¨å¤æ‚è€¦åˆçš„éçº¿æ€§å˜é‡å˜æ¢ä¸ºç›¸å¯¹åæ ‡ç³»ä¸ºé™æ­¢çš„ç›´æµå˜é‡ï¼ˆç”µæµã€ç£é“¾ã€ç”µå‹ç­‰ï¼‰ï¼Œå®ç°è¿‘ä¼¼è§£è€¦æ§åˆ¶ï¼Œå¹¶ä»ä¸­æ‰¾åˆ°çº¦æŸæ¡ä»¶ï¼Œè·å¾—æŸä¸€ç›®æ ‡çš„æœ€ä½³æ§åˆ¶ç­–ç•¥ï¼Œid0 æ§åˆ¶æ˜¯çŸ¢é‡æ§åˆ¶çš„ä¸€ç§ç‰¹å®šçš„æ§åˆ¶ç­–ç•¥ï¼Œåœ¨è½¬å­åæ ‡ç³»å†…å®ç°æ°¸ç£åŒæ­¥ç”µæœºäº¤ç›´è½´ç”µæµè§£è€¦ï¼Œç”±äº idã€iq åŒç”µæµé—­ç¯çš„å­˜åœ¨ï¼Œä½¿ç”µæœº iq ç”µæµåŠ¨æ€è·Ÿéšç³»ç»ŸåŠ›çŸ©ç»™å®šï¼ˆtektiqï¼Œkt ä¸ºç”µæœºåŠ›çŸ©ç³»æ•°ï¼‰ï¼Œå®ç°ç”µæœºç”µç£åŠ›çŸ©æ§åˆ¶ã€‚ é€Ÿåº¦æ§åˆ¶å’Œè½¬çŸ©æ§åˆ¶æ˜¯ FOC æœ€å¸¸ç”¨çš„æ§åˆ¶æ¨¡å¼ã€‚ä½ç½®æ§åˆ¶æ¨¡å¼ä¸å¤ªå¸¸è§ã€‚å¤§å¤šæ•°ç‰µå¼•åº”ç”¨ä½¿ç”¨è½¬çŸ©æ§åˆ¶æ¨¡å¼ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œç”µåŠ¨æœºæ§åˆ¶ç³»ç»Ÿéµå¾ªå‚è€ƒè½¬çŸ©å€¼ã€‚åœ¨é€Ÿåº¦æ§åˆ¶æ¨¡å¼ä¸‹ï¼Œç”µæœºæ§åˆ¶å™¨éµå¾ªå‚è€ƒé€Ÿåº¦å€¼ï¼Œå¹¶ç”Ÿæˆç”¨äºå½¢æˆå†…éƒ¨å­ç³»ç»Ÿçš„è½¬çŸ©æ§åˆ¶çš„è½¬çŸ©å‚è€ƒã€‚åœ¨ä½ç½®æ§åˆ¶æ¨¡å¼ä¸‹ï¼Œé€Ÿåº¦æ§åˆ¶å™¨æ„æˆå†…éƒ¨å­ç³»ç»Ÿã€‚ FOCç®—æ³• çš„å®ç°éœ€è¦ç”µæµå’Œè½¬å­ä½ç½®çš„å®æ—¶åé¦ˆã€‚ä½¿ç”¨ä¼ æ„Ÿå™¨æµ‹é‡ç”µæµå’Œä½ç½®ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨æ— ä¼ æ„Ÿå™¨æŠ€æœ¯ï¼Œè¯¥æŠ€æœ¯ä½¿ç”¨ä¼°è®¡çš„åé¦ˆå€¼ä»£æ›¿å®é™…çš„åŸºäºä¼ æ„Ÿå™¨çš„æµ‹é‡ã€‚ Permanent Magnet Synchronous Motor (PMSM)ä¸‹å›¾ä¸ºæ°¸ç£åŒæ­¥ç”µæœºï¼ˆPMSMï¼‰çš„ FOC æ¶æ„ï¼š AC Induction Motor (ACIM)ä¸‹å›¾ä¸ºäº¤æµæ„Ÿåº”ç”µåŠ¨æœºï¼ˆACIMï¼‰çš„ FOC æ¶æ„ï¼š PMSMçš„æ•°å­¦æ¨¡å‹ï¼ˆMathematical Model of PMSMï¼‰ åŸç†è§£æ | Field Oriented Controlï¼ˆç£åœºå®šå‘æ§åˆ¶ï¼‰çš„ Simulink å®ç°","tags":["clippings"],"categories":["5.åµŒå…¥å¼å¼€å‘","ç¡¬ä»¶çŸ¥è¯†"]},{"title":"FOCï¼ˆç£åœºå®šå‘æ§åˆ¶ï¼‰åŠç”µæœºæ§åˆ¶æŠ€æœ¯ç®€ä»‹-RoboticsCV","path":"/2023/10/19/5-åµŒå…¥å¼å¼€å‘-ç¡¬ä»¶çŸ¥è¯†-FOCï¼ˆç£åœºå®šå‘æ§åˆ¶ï¼‰åŠç”µæœºæ§åˆ¶æŠ€æœ¯ç®€ä»‹-RoboticsCV/","content":"å‰è¨€ ç†è®ºåŸºç¡€ FOCé©±åŠ¨å™¨ä¸æ— åˆ·ç”µè°ƒçš„åŒºåˆ« æ— åˆ·ç”µæœºé©±åŠ¨åŸç† åŸºç¡€çŸ¥è¯† BLDCé©±åŠ¨åŸç† ç”µæœºæ¨¡å‹å’Œè¿åŠ¨åˆ†æ é©±åŠ¨ç”µè·¯ç®€è¿° FOCåŸç† FOCé¡¹ç›®ï¼ˆå¼€æºï¼‰ å‚è€ƒ å‰è¨€ç†è®ºåŸºç¡€ BLDCï¼ˆBrushless DC Motorï¼‰ï¼Œæ— åˆ·ç›´æµç”µæœºï¼Œä¸ä¼ ç»Ÿçš„æœ‰åˆ·ç›´æµç”µæœºï¼ˆBrushed DC Motorï¼‰ç›¸æ¯”å…·æœ‰æ›´é«˜æ•ˆç‡ã€æ›´é•¿å¯¿å‘½å’Œæ›´ä½çš„ç»´æŠ¤è¦æ±‚ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒBLDC è¿˜å…·æœ‰é«˜åŠŸç‡å¯†åº¦ï¼ˆä½“ç§¯å°ã€é‡é‡è½»ã€åŠŸç‡è¾“å‡ºå¤§ï¼‰å’Œé«˜è½¬é€Ÿçš„ä¼˜åŠ¿ã€‚ PMSMï¼ˆPermanent Magnet Synchronous Motorï¼‰ï¼Œæ°¸ç£åŒæ­¥ç”µæœºï¼Œäº¦ç§°æ— åˆ·äº¤æµç”µæœºï¼ˆBLAC, Brushed AC Motorï¼‰ã€‚PMSM å…·æœ‰å’Œ BLDC ç±»ä¼¼çš„ç»“æ„ç‰¹ç‚¹ã€‚ FOCï¼ˆField-Oriented Controlï¼‰ï¼Œç£åœºå®šå‘æ§åˆ¶æŠ€æœ¯ï¼Œä¹Ÿè¢«ç§°ä½œçŸ¢é‡æ§åˆ¶ï¼ˆVector Controlï¼‰ï¼Œæ˜¯ä¸€ç§ç”¨äºäº¤æµç”µæœºæ§åˆ¶çš„é«˜çº§æ§åˆ¶ç®—æ³•ã€‚å®ƒé€šè¿‡å‡†ç¡®æ§åˆ¶ç”µæœºçš„ç£åœºæ–¹å‘å’Œå¤§å°ï¼Œå®ç°å¯¹ç”µæœºé€Ÿåº¦å’Œè½¬çŸ©çš„ç²¾ç¡®æ§åˆ¶ã€‚ FOC é©±åŠ¨å™¨ä¸æ— åˆ·ç”µè°ƒçš„åŒºåˆ«ç”µè°ƒï¼ˆESCï¼‰çš„å…¨ç§°ä¸ºç”µå­è°ƒé€Ÿå™¨ï¼ˆElectronic Speed Controllerï¼‰ï¼Œæ˜¯ä¸€ç§ç¡¬ä»¶äº§å“ã€‚FOC åˆ™æ˜¯ä¸€ç§ç”µæœºé©±åŠ¨æ§åˆ¶æ–¹æ³•ã€‚ æ— åˆ·ç”µæœºé©±åŠ¨åŸç†ç”µæœºç”±ä¸¤ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†æ„æˆï¼šå›ºå®šçš„å®šå­ï¼ˆstatorï¼‰å’Œæ—‹è½¬çš„è½¬å­ï¼ˆrotorï¼‰ï¼Œæ— åˆ·ç”µæœºä¹Ÿä¸ä¾‹å¤–ã€‚è½¬å­åˆåˆ†ä¸ºå†…è½¬å­å’Œå¤–è½¬å­ä¸¤ç±»ã€‚æœ€ç†Ÿæ‚‰çš„ã€åœ¨èˆªæ¨¡å’Œæ— äººæœºä¸Šä½¿ç”¨çš„å°±æ˜¯å¤–è½¬å­ç»“æ„çš„æ— åˆ·ç”µæœºï¼Œè€Œå†…è½¬å­æ— åˆ·ç”µæœºåˆ™é€šå¸¸ç”¨äºå®¶ç”µã€å·¥ä¸šé©±åŠ¨å’Œæœºå™¨äººç­‰åº”ç”¨ã€‚ æ³¨ï¼šè‹¥çº¿åœˆæ˜¯è½¬å­åˆ™ç£ææ˜¯å®šå­ï¼Œè‹¥çº¿åœˆæ˜¯å®šå­åˆ™ç£ææ˜¯è½¬å­ã€‚ä¸‹å›¾æ‰€ç¤ºæ— åˆ·ç”µæœºå±äºå‰ä¸€ç§ç»“æ„ã€‚ å¦ä¸€ç»„å¸¸è§çš„æ¦‚å¿µæ˜¯ç›¸æ•°å’Œææ•°ã€‚ç”µæœºçš„ç›¸æ•°ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºç”µæœºå®šå­çº¿åœˆçš„ç»„æ•°ã€‚ç”µæœºçš„ææ•°åˆ™æ˜¯æŒ‡ç”µæœºè½¬å­ä¸Šç£æçš„æ•°é‡ï¼ˆä¸€å¯¹ç£æåŒ…æ‹¬ä¸€ä¸ª N æå’Œä¸€ä¸ª S æï¼‰ã€‚ä¸‹å›¾æ‰€ç¤ºä¸ºä¸€ä¸ªå…·æœ‰12ä¸ªç”µæœºç»•ç»„æ§½ï¼ˆslotï¼‰ã€16ä¸ªç£æï¼ˆmagnetï¼‰çš„ä¸‰ç›¸æ— åˆ·ç›´æµç”µæœºç¤ºæ„å›¾ã€‚ å¸¸è§ç”µæœºçš„ç›¸æ•°ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§ï¼š å•ç›¸ç”µæœºï¼ˆSingle-Phase Motorï¼‰ï¼šå•ç›¸ç”µæœºå…·æœ‰ä¸€ä¸ªç»•ç»„ï¼ˆç›¸ï¼‰ï¼Œé€šå¸¸ç”¨äºä½åŠŸç‡åº”ç”¨ï¼Œå¦‚å°å‹å®¶ç”¨ç”µå™¨ã€é£æ‰‡ã€æ³µç­‰ã€‚å•ç›¸ç”µæœºçš„è¿è¡Œèµ·åŠ¨ç›¸å¯¹ç®€å•ï¼Œä½†é€šå¸¸åŠŸç‡è¾ƒä½ã€‚ ä¸‰ç›¸ç”µæœºï¼ˆThree-Phase Motorï¼‰ï¼šä¸‰ç›¸ç”µæœºå…·æœ‰ä¸‰ä¸ªç»•ç»„ï¼ˆç›¸ï¼‰ï¼Œå¹¿æ³›åº”ç”¨äºå·¥ä¸šå’Œå•†ä¸šé¢†åŸŸï¼ŒåŒ…æ‹¬å¤§å‹é©¬è¾¾ã€åˆ¶é€ è®¾å¤‡ã€ç”µåŠ¨è½¦ã€ç©ºè°ƒç­‰ã€‚å®ƒä»¬é€šå¸¸æ¯”å•ç›¸ç”µæœºå…·æœ‰æ›´é«˜çš„åŠŸç‡å’Œæ•ˆç‡ï¼Œå› ä¸ºå®ƒä»¬çš„ç”µæµåˆ†å¸ƒæ›´å‡åŒ€ï¼Œèƒ½å¤Ÿæä¾›å¹³ç¨³çš„æ—‹è½¬åŠ›çŸ©ã€‚ æ­¥è¿›ç”µæœºï¼ˆStepper Motorï¼‰ï¼šæ­¥è¿›ç”µæœºé€šå¸¸å…·æœ‰å¤šä¸ªç›¸ï¼Œé€šå¸¸æ˜¯ä¸¤ç›¸ã€å››ç›¸æˆ–å…«ç›¸ã€‚å®ƒä»¬é€šè¿‡é€æ­¥æ¿€æ´»ä¸åŒçš„ç›¸æ¥å®ç°ç²¾ç¡®çš„è§’åº¦æ§åˆ¶ï¼Œå› æ­¤åœ¨éœ€è¦ç²¾ç¡®ä½ç½®æ§åˆ¶çš„åº”ç”¨ä¸­éå¸¸æœ‰ç”¨ï¼Œå¦‚æ‰“å°æœºã€CNC æœºåºŠå’Œ 3D æ‰“å°æœºã€‚ é€šè¿‡ç›¸æ•°å’Œææ•°å¯ç”¨ä»¥ä¸‹å…¬å¼è®¡ç®—è½¬é€Ÿï¼ˆå•ä½ï¼šè½¬æ¯åˆ†é’Ÿï¼ŒRPMï¼‰ï¼šè½¬é€Ÿ (60 * ç”µæºé¢‘ç‡) (æå¯¹æ•° * ç›¸æ•°) è¿™ä¸ªå…¬å¼ç§°ä¸ºåŒæ­¥è½¬é€Ÿå…¬å¼ï¼Œå®ƒæè¿°äº†ç”µæœºè½¬å­æ—‹è½¬çš„é€Ÿåº¦ä¸ç›¸æ•°å’Œæå¯¹æ•°ä¹‹é—´çš„å…³ç³»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå…¬å¼æ˜¯é’ˆå¯¹åŒæ­¥è¿è¡ŒçŠ¶æ€ä¸‹çš„ç”µæœºè½¬é€Ÿï¼Œå®é™…è¿è¡Œæ—¶å¯èƒ½å­˜åœ¨ä¸€å®šçš„æ»‘å·®ã€‚ åŸºç¡€çŸ¥è¯† å·¦æ‰‹å®šåˆ™ï¼ˆç”µåŠ¨æœºåŸç†ã€‚äº‹å®åé¢ä»‹ç»çš„å®‰å€å®šåˆ™ä¹Ÿé€‚ç”¨äºè§£é‡Šç”µæœºçš„è¿åŠ¨åŸç†ï¼‰ï¼šç”¨äºåˆ¤æ–­å¯¼çº¿åœ¨ç£åœºä¸­çš„å—åŠ›æ–¹å‘ã€‚æ‹‡æŒ‡ä¸å…¶ä»–å››æŒ‡æ–¹å‘å‚ç›´ä¸”åœ¨åŒä¸€å¹³é¢ï¼Œç£æ„Ÿçº¿ä»æ‰‹å¿ƒå‚ç›´ç©¿è¿‡ï¼Œå››æŒ‡æŒ‡å‘ç”µæµæ–¹å‘ï¼Œåˆ™å¤§æ‹‡æŒ‡æŒ‡å‘çš„å°±æ˜¯å®‰åŸ¹åŠ›æ–¹å‘ï¼ˆå³å¯¼ä½“å—åŠ›æ–¹å‘ï¼‰æˆ–æ´›ä¼¦å…¹åŠ›ã€‚ï¼ˆå½“ç”µæµæ–¹å‘ä¸ç£åœºå¹³è¡Œæ—¶ï¼Œç”µè·è¿åŠ¨æ–¹å‘ä¹Ÿä¸ç£åœºæ–¹å‘å¹³è¡Œï¼Œæ‰€å—æ´›ä¼¦å…¹åŠ›ä¸ºé›¶ï¼‰ å³æ‰‹èºæ—‹å®šåˆ™ï¼ˆå®‰åŸ¹å®šåˆ™ï¼‰ï¼šç”¨äºåˆ¤æ–­ç”µæµçš„æ„Ÿåº”ç£åœºæ–¹å‘ã€‚ä¸€èˆ¬æ¥è¯´æœ‰ä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«ä¸ºâ€å•æ ¹å¯¼çº¿çš„æ„Ÿåº”ç£åœºæ–¹å‘â€å’Œâ€é€šç”µèºçº¿ç®¡çš„ç£åœºæ–¹å‘â€ã€‚å·¦å›¾æ‰€ç¤ºï¼Œå³æ‰‹å¤§æ‹‡æŒ‡æŒ‡å‘ç”µæµæ–¹å‘ï¼Œåˆ™å››æŒ‡å¼¯æ›²æ–¹å‘å°±æ˜¯ç£åœºæ–¹å‘ã€‚å³å›¾æ‰€ç¤ºï¼Œå››æŒ‡èœ·æ¡å¹¶é¡ºç€ç”µæµæ–¹å‘ï¼Œåˆ™æ‹‡æŒ‡æŒ‡å‘çš„å°±æ˜¯ç£åœºæ–¹å‘ï¼Œå³ N æã€‚ å³æ‰‹å®šåˆ™ï¼ˆå‘ç”µæœºåŸç†ï¼‰ï¼šç”¨äºåˆ¤æ–­å¯¼çº¿åˆ‡å‰²ç£æ„Ÿçº¿æ—¶æ‰€äº§ç”Ÿçš„ç”µæµçš„æ–¹å‘ã€‚ä¼¸å¼€å³æ‰‹ï¼Œä½¿å¤§æ‹‡æŒ‡è·Ÿå…¶ä½™å››æŒ‡å‚ç›´å¹¶ä¸”éƒ½è·Ÿæ‰‹æŒåœ¨ä¸€ä¸ªå¹³é¢å†…ï¼Œè®©ç£æ„Ÿçº¿å‚ç›´ç©¿å…¥æ‰‹å¿ƒï¼Œå¤§æ‹‡æŒ‡æŒ‡å‘å¯¼ä½“è¿åŠ¨æ–¹å‘ï¼Œåˆ™å…¶ä½™å››æŒ‡æ‰€æŒ‡æ–¹å‘å³ä¸ºæ„Ÿç”Ÿç”µåŠ¨åŠ¿æ–¹å‘ã€‚ï¼ˆæ³¨ï¼šåˆ©ç”¨åç”µåŠ¨åŠ¿æµ‹é‡ç”µè·¯è·å–è½¬å­ä½ç½®ï¼Œæ˜¯æ— æ„Ÿç”µè°ƒå·¥ä½œåŸç†ä¹‹ä¸€ï¼‰ BLDC é©±åŠ¨åŸç†BLDC é©±åŠ¨åŸç†åŸºäºç”µå­æ¢å‘æŠ€æœ¯ï¼Œç›¸æ¯”ä¼ ç»Ÿæœ‰åˆ·ç›´æµç”µæœºï¼Œå®ƒæ²¡æœ‰ç¢³åˆ·å’Œæœºæ¢°æ¢å‘å™¨ã€‚BLDC çš„é©±åŠ¨ä¾é ç²¾ç¡®æ”¹å˜ç”µæœºä¸Šå¤šä¸ªå®šå­çº¿åœˆï¼ˆå‡è®¾çº¿åœˆç»•ç»„æ˜¯å®šå­å¦‚èˆªæ¨¡æ— åˆ·ç”µæœºï¼‰çš„ç”µæµäº¤å˜é¢‘ç‡å’Œå¹…å€¼ï¼ˆè¡¨ç°ä¸ºå¤šä¸ªæ³¢å½¢å˜åŒ–æ›²çº¿åŠå…¶ç›¸åºå…³ç³»ï¼‰ï¼Œåœ¨å®šå­å‘¨å›´å½¢æˆç£åœº, é©±åŠ¨è½¬å­æ°¸ç£ä½“è½¬åŠ¨ã€‚å› æ­¤å¯ä»¥å°†ç ”ç©¶çš„é‡ç‚¹æ”¾åœ¨å¦‚ä½•æ”¹å˜å¤šä¸ªå®šå­çº¿åœˆçš„ç›¸åºå’Œç”µæµï¼Œè€Œè¿™éœ€è¦äº¤ç»™é©±åŠ¨ç”µè·¯ã€æ§åˆ¶å™¨ã€ä¼ æ„Ÿå™¨ï¼ˆè‹¥æ˜¯é—­ç¯æ§åˆ¶ï¼‰è¿™äº›ç¡¬ä»¶ä»¥åŠæ§åˆ¶å™¨ä¸Šçš„ç®—æ³•è½¯ä»¶ï¼Œæ‰€ä»¥åˆ°äº†å…·ä½“å®ç°è¿™ä¸€æ­¥ï¼Œå°±å¾—é ç¡¬ä»¶å’Œè½¯ä»¶ï¼ ç”µæœºæ¨¡å‹å’Œè¿åŠ¨åˆ†æä¸ºäº†åˆ†ææ–¹ä¾¿ï¼Œä»¥ç®€åŒ–çš„ä¸‰ç›¸äºŒæå†…è½¬å­ç”µæœºä¸ºä¾‹ï¼ˆä¸”è½¬å­ä¸ºç£æã€å®šå­ä¸ºç»•ç»„ï¼‰ã€‚äº‹å®ä¸Šï¼Œå®šå­çš„ä¸‰ç›¸ç»•ç»„æœ‰æ˜Ÿå½¢è¿ç»“å’Œä¸‰è§’è¿ç»“ä¸¤ç§æ–¹å¼ï¼Œå…¶ä¸­æ˜Ÿå½¢è¿ç»“æ›´ä¸ºå¸¸ç”¨ï¼ˆè¿æ¥æ–¹å¼æ˜¯æ¯ä¸€ç›¸å¼•å‡ºå¯¼çº¿çš„ä¸€å¤´ï¼Œè€Œå¦ä¸€å¤´å’Œå…¶ä»–ç›¸ä¸¤ä¸¤ç›¸è¿ï¼‰ï¼Œè€Œåç»­å°±é‡‡ç”¨è¯¥æ¨¡å‹åšåˆ†æã€‚ å‡è®¾æ­¤æ—¶å¯¹ Aã€B æåˆ†åˆ«æ–½åŠ æ­£ã€è´Ÿç”µå‹ï¼Œé‚£ä¹ˆç”±å³æ‰‹èºæ—‹å®šåˆ™å¯ä»¥åˆ¤æ–­å‡ºçº¿åœˆç£æçš„æ–¹å‘å¦‚ä¸‹å›¾çº¢è‰²ç®­å¤´å’Œè“è‰²ç®­å¤´æ‰€ç¤ºï¼ˆç»¿è‰²ç®­å¤´å¯ä»¥ç†è§£ä¸ºä¸¤çº¿åœˆåˆæˆçš„ç£ææ–¹å‘ï¼‰ã€‚æ­¤æ—¶å½“è½¬å­å¤„äºä¸ C ç‚¹ä¸è½¬è½´ä¸­ç‚¹è¿çº¿é‡åˆçš„è§’åº¦æ—¶ï¼Œå—åˆ°çš„åŠ›çŸ©æœ€å¤§ï¼ˆä¸¤ä¸ªç£æä¸€æ¨ä¸€æ‹‰ï¼‰ï¼Œç›´åˆ°æ—‹è½¬åˆ°ä¸ AB è¿çº¿å¹³è¡Œçš„ä¸”ç£é“å†…éƒ¨ç£åŠ›çº¿æ–¹å‘å’Œ AB é—´ç£åŠ›çº¿æ–¹å‘ä¸€è‡´çš„æ—¶å€™ï¼Œæ‰æ˜¯ç¨³å®šçš„å¹³è¡¡ä½ç½®ã€‚æ¢å¥è¯è¯´ï¼ŒAB ç›¸é€šç”µä¼šè®©è½¬å­åŠªåŠ›è½¬åˆ°ä¸‹å›¾å³è¾¹çš„çŠ¶æ€ã€‚ ä»¥æ­¤ç±»æ¨ï¼Œå¯ä»¥å¾—åˆ°æ¯ä¸ªé€šç”µçŠ¶æ€çº¿åœˆç»•ç»„çš„ç£ææ–¹å‘ï¼Œè¿›è€Œè·å¾—è½¬å­çš„æ–¹å‘å’Œè§’åº¦ï¼ˆæ–¹å‘é‡å ã€è§’åº¦ç›¸åï¼‰ï¼Œå°±æ˜¯ä¸‹å›¾ä¸­çš„ 6 ä¸ªçŠ¶æ€ï¼Œæ¯ä¸ªçŠ¶æ€ç›¸éš” 60Â°ï¼Œå³å®Œæ•´çš„ä¸€å‘¨è½¬åŠ¨åŒ…æ‹¬ 6 ä¸ªçŠ¶æ€ï¼Œå…±è¿›è¡Œäº† 6 æ¬¡æ¢ç›¸ï¼š æ³¨ï¼šäº‹å®ä¸Šï¼Œæ¨ªåæ ‡ 1 å’Œ 2 çš„ä¸­é—´ä½ç½®ä¹Ÿæ˜¯ä¸€ä¸ªåŠ›å¹³è¡¡ç‚¹ã€‚ä½†æ­¤å¤„ä¸‰ç›¸å‡æ²¡æœ‰æ¢å‘ï¼Œå› æ­¤æœªè®¡å…¥çŠ¶æ€ä¹‹ä¸€ã€‚ æ¨èä¸€ç¯‡å‘ˆç°äº†è¿åŠ¨è§„å¾‹åŠ¨ç”»æ¼”ç¤ºçš„ åšæ–‡ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œç”µæœºä¸ºå¤–è½¬å­ç£æç»“æ„ï¼Œä¸”ææ•°ä¸º 12ã€‚è¯¥ç”µæœºæ—‹è½¬ä¸€å‘¨æ‰€éœ€çš„æ€»æ­¥æ•°ä¸º 12*336ï¼ˆææ•°ä¹˜ä»¥ç›¸æ•°å¾—åˆ°çš„ç»“æœï¼Œåæ˜ äº†ç”µæœºä¸­ç£åœºå˜åŒ–çš„æ¬¡æ•°ï¼Œå†³å®šäº†ç”µæœºæ—‹è½¬ä¸€å‘¨æ‰€éœ€çš„æ­¥æ•°ã€‚æ€»æå¯¹æ•°è¶Šé«˜ï¼Œç”µæœºé€šå¸¸ä¼šå…·æœ‰æ›´å¹³æ»‘çš„è¾“å‡ºç‰¹æ€§ã€‚è‡³äºç»•ç»„æ•°é‡å¦‚ä½•ç¡®å®šè¿˜æ²¡æœ‰æ·±ç©¶ï¼Œä½†ä¼¼ä¹å¯ä»¥ä½¿ç”¨å…¬å¼ çº¿åœˆç»•ç»„æ•°360(ç›¸é‚»ç£æå¤¹è§’ + 360(pole*3))) è®¡ç®—å‡ºæ­£ç¡®çš„å€¼ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªè¡Œç ”ç©¶ä¸‹ã€‚ é©±åŠ¨ç”µè·¯ç®€è¿°æ— åˆ·ç”µæœºçš„é©±åŠ¨ç”µè·¯ä¸»è¦ä½¿ç”¨ä¸‰ç›¸é€†å˜ç”µè·¯æ¥å®ç°ã€‚é€†å˜ç”µè·¯çš„ä¸»è¦åŠŸèƒ½æ˜¯å°†ç›´æµç”µè½¬æ¢ä¸ºäº¤æµç”µï¼ˆé€šè¿‡å‰ä¸€èŠ‚çš„åˆ†æå¯çŸ¥ï¼Œæ— åˆ·ç”µæœºé©±åŠ¨éœ€è¦åœ¨ä¸åŒæ—¶åˆ»æ–½åŠ ä¸åŒæ–¹å‘çš„ç”µå‹ï¼Œæ•…éœ€è¦é€†å˜ç”µè·¯ï¼‰ã€‚é€†å˜å™¨çš„å·¥ä½œåŸç†æ˜¯é€šè¿‡æ§åˆ¶å¼€å…³å™¨ä»¶ï¼ˆå¦‚æ™¶ä½“ç®¡æˆ– MOSFETï¼‰çš„å¯¼é€šå’Œæˆªæ­¢ï¼Œæ¥æ”¹å˜ç”µæµçš„æ–¹å‘å’Œå¹…å€¼ï¼Œä»è€Œäº§ç”Ÿæ‰€éœ€é¢‘ç‡å’Œå¹…å€¼çš„äº¤æµç”µã€‚ é€†å˜ç”µè·¯ä¸€èˆ¬æ˜¯é‡‡ç”¨åŠæ¡¥ MOS ç”µè·¯å®ç°ã€‚ä¸¤ä¸ªåŠŸç‡å¼€å…³å™¨ä»¶å³ MOS ç®¡ç»„æˆä¸Šã€ä¸‹æ¡¥è‡‚ï¼Œä»¥ä¸­é—´ç‚¹ä½œä¸ºè¾“å‡ºï¼Œæä¾›æ–¹æ³¢å‹å·ã€‚è¿™ç§ç»“æ„åœ¨ PWM ç”µæœºæ§åˆ¶ã€DC-AC é€†å˜ã€ç”µå­é•‡æµå™¨ç­‰åœºåˆæœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚ç”±äºå¼€å…³å»¶æ—¶çš„å­˜åœ¨ï¼Œå½“å…¶ä¸­çš„ä¸€ä¸ªç®¡å­æ …æä¿¡å·å˜ä¸ºä½æ—¶ï¼Œå®ƒå¹¶ä¸ä¼šç«‹åˆ»å…³æ–­ï¼Œå› æ­¤ä¸€ä¸ªç®¡å­å¿…é¡»åœ¨å¦ä¸€ä¸ªç®¡å­å…³æ–­åä¸€å®šæ—¶é—´æ–¹å¯å¼€å¯ï¼Œä»¥é˜²æ­¢åŒæ—¶å¼€å¯é€ æˆçš„ç”µæµç©¿é€šï¼Œè¿™ä¸ªæ—¶é—´ç§°ä¸ºæ­»åŒºæ—¶é—´ã€‚ ç”¨ 3 ä¸ªåŠæ¡¥ç”µè·¯å°±å¯ä»¥ç»„åˆæˆä¸‰ç›¸é€†å˜ç”µè·¯ï¼Œæ¯ä¸ªåŠæ¡¥å¼•å‡ºçš„ä¸€æ ¹è¾“å‡ºçº¿è·Ÿæ— åˆ·ç”µæœºçš„ä¸€æ ¹ç›¸çº¿ç›¸è¿ï¼Œå°±å®Œæˆäº†æœ€åŸºæœ¬çš„æ— åˆ·é©±åŠ¨ç”µè·¯ã€‚ FOC åŸç†FOC é¡¹ç›®ï¼ˆå¼€æºï¼‰SimpleFOC ODrive å‚è€ƒç¨šæ™–å› ã€è‡ªåˆ¶FOCé©±åŠ¨å™¨ã€‘æ·±å…¥æµ…å‡ºè®²è§£FOCç®—æ³•ä¸SVPWMæŠ€æœ¯ DengFOCÂ ä¸»é¡µæ–‡æ¡£ FOCæœ€åŸºæœ¬åŸç†ã€clarkå˜æ¢ ã€parkå˜æ¢ã€é™„ä»£ç  é‡ç« ç”µæœºåº”ç”¨å¼€å‘å®æˆ˜æŒ‡å—","tags":["clippings"],"categories":["5.åµŒå…¥å¼å¼€å‘","ç¡¬ä»¶çŸ¥è¯†"]},{"title":"1. Gitä»‹ç»å’ŒåŸºæœ¬å‘½ä»¤","path":"/2023/10/18/6-å¼€å‘å·¥å…·-Git-1-Gitä»‹ç»å’ŒåŸºæœ¬å‘½ä»¤/","content":"ç‰ˆæœ¬æ§åˆ¶ç‰ˆæœ¬æ§åˆ¶æ˜¯æŒ‡å¯¹è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­å„ç§ç¨‹åºä»£ç ã€é…ç½®æ–‡ä»¶åŠè¯´æ˜æ–‡æ¡£ç­‰æ–‡ä»¶å˜æ›´çš„ç®¡ç†ã€‚ Git æ˜¯å…è´¹ã€å¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚ é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿé›†ä¸­ç®¡ç†çš„ä¸­å¤®æœåŠ¡å™¨ï¼Œä¿å­˜ç€æ‰€æœ‰æ–‡ä»¶çš„ä¿®æ”¹å†å²ç‰ˆæœ¬ã€‚ ååŒå¼€å‘è€…é€šè¿‡å®¢æˆ·ç«¯è¿æ¥åˆ°è¿™å°æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨ä¸ŠåŒæ­¥æ›´æ–°æˆ–ä¸Šä¼ è‡ªå·±çš„ä¿®æ”¹ã€‚ åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè¿œç¨‹ä»“åº“åŒæ­¥æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯åˆ°æœ¬åœ°çš„æ¯ä¸ªç”¨æˆ· æœ¬åœ°å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„å†å²ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¶å°”è¿œç¨‹æ›´æ–°ï¼ŒæŸ¥çœ‹å…¶ä»–ç”¨æˆ·ä¿®æ”¹æäº¤åˆ°è¿œç¨‹ ç”¨æˆ·å³ä½¿ç¦»çº¿ä¹Ÿå¯ä»¥æœ¬åœ°æäº¤ï¼Œpush æ¨é€åˆ°è¿œç¨‹æœåŠ¡å™¨æ‰éœ€è¦è”ç½‘ æ¯ä¸ªç”¨æˆ·éƒ½ä¿å­˜äº†å†å²ç‰ˆæœ¬ å·¥ä½œåŒºåŸŸ Workspaceï¼šç”µè„‘æœ¬åœ°çœ‹åˆ°çš„æ–‡ä»¶å’Œç›®å½•ï¼Œåœ¨ Git çš„ç‰ˆæœ¬æ§åˆ¶ä¸‹ï¼Œæ„æˆäº†å·¥ä½œåŒºã€‚ IndexStageï¼šæš‚å­˜åŒºï¼Œä¸€èˆ¬å­˜æ”¾åœ¨.git ç›®å½•ä¸‹ï¼Œå³.gitindex,å®ƒåˆå«å¾…æäº¤æ›´æ–°åŒºï¼Œç”¨äºä¸´æ—¶å­˜æ”¾æœªæäº¤çš„æ”¹åŠ¨ã€‚æ‰§è¡Œ git addï¼Œè¿™äº›æ”¹åŠ¨å°±æ·»åŠ åˆ°è¿™ä¸ªåŒºåŸŸã€‚ Repositoryï¼šæœ¬åœ°ä»“åº“ï¼Œæ‰§è¡Œ git clone åœ°å€ï¼Œå°±æ˜¯æŠŠè¿œç¨‹ä»“åº“å…‹éš†åˆ°æœ¬åœ°ä»“åº“ã€‚å®ƒæ˜¯ä¸€ä¸ªå­˜æ”¾åœ¨æœ¬åœ°çš„ç‰ˆæœ¬åº“ï¼Œå…¶ä¸­ HEAD æŒ‡å‘æœ€æ–°æ”¾å…¥ä»“åº“çš„ç‰ˆæœ¬ã€‚å½“æ‰§è¡Œ git commitï¼Œæ–‡ä»¶æ”¹åŠ¨å°±åˆ°æœ¬åœ°ä»“åº“ã€‚ Remoteï¼šè¿œç¨‹ä»“åº“ï¼Œäº‘ç«¯ç‰ˆæœ¬åº“ æ–‡ä»¶çŠ¶æ€ Untracked: æ–‡ä»¶æœªåŠ å…¥åˆ° git åº“ï¼Œæœªå‚ä¸ç‰ˆæœ¬æ§åˆ¶ï¼Œå¤„äºæœªè·Ÿè¸ªçŠ¶æ€ã€‚é€šè¿‡ git addï¼Œå¯ä»¥å˜ä¸º Staged çŠ¶æ€ Unmodifiedï¼šæ–‡ä»¶å·²ç»åŠ å…¥ git åº“ï¼Œç‰ˆæœ¬åº“ä¸­çš„æ–‡ä»¶å¿«ç…§å†…å®¹ä¸æ–‡ä»¶å¤¹ä¸­è¿˜å®Œå…¨ä¸€è‡´ã€‚ Unmodified çš„æ–‡ä»¶å¦‚æœè¢«ä¿®æ”¹, å°±ä¼šå˜ä¸º Modifiedã€‚å¦‚æœä½¿ç”¨ git remove ç§»å‡ºç‰ˆæœ¬åº“ï¼Œåˆ™æˆä¸º Untracked æ–‡ä»¶ã€‚ Modifiedï¼šæ–‡ä»¶è¢«ä¿®æ”¹è¿›å…¥ modified çŠ¶æ€ï¼Œæ–‡ä»¶è¿™ä¸ªçŠ¶æ€é€šè¿‡ stage å‘½ä»¤å¯ä»¥è¿›å…¥ staged çŠ¶æ€ stagedï¼šæš‚å­˜çŠ¶æ€. æ‰§è¡Œ git commit åˆ™å°†ä¿®æ”¹åŒæ­¥åˆ°åº“ä¸­, è¿™æ—¶åº“ä¸­çš„æ–‡ä»¶å’Œæœ¬åœ°æ–‡ä»¶åˆå˜ä¸ºä¸€è‡´, æ–‡ä»¶ä¸º Unmodified çŠ¶æ€ã€‚ æ­£å‘å·¥ä½œæµ git çš„æ­£å‘å·¥ä½œæµç¨‹ä¸€èˆ¬å°±è¿™æ ·ï¼š ä»è¿œç¨‹ä»“åº“æ‹‰å–æ–‡ä»¶ä»£ç å›æ¥ï¼›git pull åœ¨å·¥ä½œç›®å½•ï¼Œå¢åˆ æ”¹æ–‡ä»¶ï¼› æŠŠæ”¹åŠ¨çš„æ–‡ä»¶æ”¾å…¥æš‚å­˜åŒºï¼›git add å°†æš‚å­˜åŒºçš„æ–‡ä»¶æäº¤æœ¬åœ°ä»“åº“ï¼›git commit å°†æœ¬åœ°ä»“åº“çš„æ–‡ä»¶æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼›git push å¸¸ç”¨å‘½ä»¤ git clone [url] #å…‹éš†è¿œç¨‹ä»“åº“git add [dir/file]#æ·»åŠ ç›®å½•/æ–‡ä»¶åˆ°æš‚å­˜åŒºgit commit [--amend] -m [msg] #æäº¤æš‚å­˜åŒºåˆ°ä»“åº“åŒº,msgä¸ºè¯´æ˜ä¿¡æ¯(amendç”¨æ–°çš„commitè¦†ç›–æäº¤)git log [--oneline] [-p [file]]#æŸ¥çœ‹æäº¤å†å²(onlineç²¾ç®€æ¨¡å¼)(pæŒ‡å®šæ–‡ä»¶)git blame #åˆ—è¡¨æ–¹å¼æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶çš„æäº¤å†å²git diff #æ˜¾ç¤ºæš‚å­˜åŒºå’Œå·¥ä½œåŒºçš„å·®å¼‚git diff #æ˜¾ç¤ºæš‚å­˜åŒºå’Œå·¥ä½œåŒºçš„å·®å¼‚git diff filepath #filepathè·¯å¾„æ–‡ä»¶ä¸­ï¼Œå·¥ä½œåŒºä¸æš‚å­˜åŒºçš„æ¯”è¾ƒå·®å¼‚git diff HEAD filepath #å·¥ä½œåŒºä¸HEAD ( å½“å‰å·¥ä½œåˆ†æ”¯)çš„æ¯”è¾ƒå·®å¼‚git diff branchName filepath #å½“å‰åˆ†æ”¯æ–‡ä»¶ä¸branchNameåˆ†æ”¯çš„æ–‡ä»¶çš„æ¯”è¾ƒå·®å¼‚git diff commitId filepath #ä¸æŸä¸€æ¬¡æäº¤çš„æ¯”è¾ƒå·®å¼‚git status [-s] [--show-stash] #æŸ¥çœ‹å½“å‰å·¥ä½œåŒºæš‚å­˜åŒºå˜åŠ¨(-sæ¦‚è¦ä¿¡æ¯)ï¼ˆshow-stashæ˜¾ç¤ºæš‚å­˜æ–‡ä»¶ï¼‰git pull/fetch #æ‹‰å–è¿œç«¯ä»£ç #git pull = git fetch+ git mergeã€‚pullçš„è¯ï¼Œæ‹‰å–è¿œç¨‹åˆ†æ”¯å¹¶ä¸æœ¬åœ°åˆ†æ”¯åˆå¹¶#fetchåªæ˜¯æ‹‰è¿œç¨‹åˆ†æ”¯ï¼Œæ€ä¹ˆåˆå¹¶ï¼Œå¯ä»¥è‡ªå·±å†åšé€‰æ‹©ã€‚git pull #æ‹‰å–è¿œç¨‹ä»“åº“æ‰€æœ‰åˆ†æ”¯æ›´æ–°å¹¶åˆå¹¶åˆ°æœ¬åœ°åˆ†æ”¯ã€‚git pull origin master #å°†è¿œç¨‹masteråˆ†æ”¯åˆå¹¶åˆ°å½“å‰æœ¬åœ°masteråˆ†æ”¯git pull origin master:master #å°†è¿œç¨‹masteråˆ†æ”¯åˆå¹¶åˆ°å½“å‰æœ¬åœ°masteråˆ†æ”¯ï¼Œå†’å·åé¢è¡¨ç¤ºæœ¬åœ°åˆ†æ”¯git fetch --all #æ‹‰å–æ‰€æœ‰è¿œç«¯çš„æœ€æ–°ä»£ç git fetch origin master #æ‹‰å–è¿œç¨‹æœ€æ–°masteråˆ†æ”¯ä»£ç git push #æ¨é€åˆ°è¿œç«¯git push origin master #å°†æœ¬åœ°åˆ†æ”¯çš„æ›´æ–°å…¨éƒ¨æ¨é€åˆ°è¿œç¨‹ä»“åº“masteråˆ†æ”¯ã€‚git push origin -d #åˆ é™¤è¿œç¨‹branchnameåˆ†æ”¯git push --tags #æ¨é€æ‰€æœ‰æ ‡ç­¾ # git rebase`rebase`åˆç§°ä¸ºè¡åˆï¼Œæ˜¯åˆå¹¶çš„å¦å¤–ä¸€ç§é€‰æ‹©ã€‚ `rebase`å¥½å¤„æ˜¯ï¼š è·å¾—æ›´ä¼˜é›…çš„æäº¤æ ‘ï¼Œå¯ä»¥çº¿æ€§çš„çœ‹åˆ°æ¯ä¸€æ¬¡æäº¤ï¼Œå¹¶ä¸”æ²¡æœ‰å¢åŠ æäº¤èŠ‚ç‚¹ã€‚æ‰€ä»¥å¾ˆå¤šæ—¶å€™ï¼Œçœ‹åˆ°æœ‰äº›ä¼™ä¼´éƒ½æ˜¯è¿™ä¸ªå‘½ä»¤æ‹‰ä»£ç ï¼š`git pull --rebase`# git stash`stash`å‘½ä»¤å¯ç”¨äºä¸´æ—¶ä¿å­˜å’Œæ¢å¤ä¿®æ”¹git stash æŠŠå½“å‰çš„å·¥ä½œéšè—èµ·æ¥ ç­‰ä»¥åæ¢å¤ç°åœºåç»§ç»­å·¥ä½œgit stash list æ˜¾ç¤ºä¿å­˜çš„å·¥ä½œè¿›åº¦åˆ—è¡¨git stash pop stash@num æ¢å¤å·¥ä½œè¿›åº¦åˆ°å·¥ä½œåŒºgit stash show ï¼šæ˜¾ç¤ºåšäº†å“ªäº›æ”¹åŠ¨git stash drop stash@num ï¼šåˆ é™¤ä¸€æ¡ä¿å­˜çš„å·¥ä½œè¿›åº¦git stash clear åˆ é™¤æ‰€æœ‰ç¼“å­˜çš„stashã€‚# git reflogæ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„æœ€è¿‘å‡ æ¬¡æäº¤# git blame`git blame filepath`è®°å½•äº†æŸä¸ªæ–‡ä»¶çš„æ›´æ”¹å†å²å’Œæ›´æ”¹äºº# git remotegit remote æŸ¥çœ‹å…³è”çš„è¿œç¨‹ä»“åº“çš„åç§°git remote add url æ·»åŠ ä¸€ä¸ªè¿œç¨‹ä»“åº“git remote show [remote] æ˜¾ç¤ºæŸä¸ªè¿œç¨‹ä»“åº“çš„ä¿¡æ¯","categories":["6.å¼€å‘å·¥å…·","Git"]},{"title":"2. GitæœåŠ¡å™¨ç¯å¢ƒæ­å»ºå’Œå®¢æˆ·ç«¯ä½¿ç”¨","path":"/2023/10/17/6-å¼€å‘å·¥å…·-Git-2-GitæœåŠ¡å™¨ç¯å¢ƒæ­å»ºå’Œå®¢æˆ·ç«¯ä½¿ç”¨/","content":"æœåŠ¡ç«¯ å®‰è£… git å’Œ ssh sudo apt-get install gitsudo apt-get install openssh-server openssh-client å¢åŠ  git ç”¨æˆ·å¹¶ç”Ÿæˆæ–‡ä»¶å¤¹ sudo adduser gitsudo mkdir /home/git åˆ›å»º ssh è¯ä¹¦è®¤è¯æ–‡ä»¶ sudo mkdir /home/git/.sshsudo touch /home/git/.ssh/authorized_keys ä¸´æ—¶ä¿®æ”¹æ–‡ä»¶çš„æƒé™ sudo chmod 777 /home/git/.ssh/authorized_keys æŠŠéœ€è¦è®¿é—® git æœåŠ¡å™¨çš„å®¢æˆ·ç«¯å…¬é’¥ id_rsa.pubçš„å†…å®¹å¤åˆ¶åˆ° authorized_keys æ–‡ä»¶ ä¿®æ”¹ authorized_keys æ–‡ä»¶çš„æƒé™ sudo chmod 700 /home/gitsudo chmod 700 /home/git/.sshsudo chmod 600 /home/git/authorized_keyssudo chown -R git:git /home/gitsudo chown -R git:git /home/git/.sshsudo chown -R git:git /home/git/.ssh/authorized_keys ä¸ºäº†å®‰å…¨è€ƒè™‘ç¦æ­¢ç™»å½• git æœåŠ¡å™¨çš„ shellï¼Œä¿®æ”¹ git çš„ shell ç”¨ /usr/bin/git-shell æŠŠ /etc/passwd çš„ git:x:1004:1004:,,,:/home/git:/bin/bash æ”¹æˆï¼š git:x:1004:1004:,,,:/home/git:/usr/bin/git-shell ä¿å­˜ å»ºä»£ç ä»“åº“ sudo mkdir /home/Repo #åˆ›å»ºä»“åº“çš„ç›®å½•sudo git init --bare /home/Repo/test.git #åˆ›å»ºä»“åº“sudo chown -R git:git /home/Repo/test.git #ä¿®æ”¹æƒé™ä¸ºgit ä»¥åæ¯åˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“ï¼Œè®°å¾—æœ€åä¸€æ­¥æ“ä½œ: ä¿®æ”¹ä»“åº“æ‰€å±ç”¨æˆ·ä¸º gitã€‚ å®¢æˆ·ç«¯ å®‰è£… git Linux ç¯å¢ƒä¸‹ sudo apt-get install git Windows ç¯å¢ƒä¸‹ç›´æ¥å®‰è£… Gitå®‰è£…åŒ… é…ç½®è¿æ¥ é€šè¿‡å¯†é’¥æ–¹å¼ ssh-keygen -t rsaÂ [-C çš„é‚®ç®±åœ°å€] ä¼šç”Ÿæˆ id_rsa.pub æ–‡ä»¶,æ·»åŠ è¯¥å…¬é’¥åˆ°åˆ°æœåŠ¡å™¨ Linux ç¯å¢ƒä¸‹ï¼Œå¯†é’¥é»˜è®¤ä½äº /home/ubuntu/.ssh/id\\_rsa Windows ç¯å¢ƒä¸‹å¯†é’¥ä½äº C:\\Users\\xxx.ssh\\id\\_rsa.pub é€šè¿‡ç”¨æˆ·åå¯†ç  git config â€“global user.name usernamegit config â€“global user.email username@gmail.com åœ¨è¿æ¥ git æ—¶ï¼Œä¼šéœ€è¦è¾“å…¥è´¦å·å¯†ç ï¼Œç›´æ¥è¾“å…¥å³å¯ é™„æ³¨ï¼šå¢é‡å¤‡ä»½ -Git æœåŠ¡å™¨å¤‡ä»½é€šè¿‡ rsync ä½¿ç”¨ crontab å»ºç«‹æ¯å¤©å‡Œæ™¨ 3 ç‚¹å®šæ—¶è§¦å‘çš„ä»»åŠ¡ crontab -e 0 3 * * * * rsync -av -e ssh -i /path/to/id_rsa /homt/git/ remote_user@X.X.X.X:~/backup","categories":["6.å¼€å‘å·¥å…·","Git"]},{"title":"3. Gitå¸¸ç”¨æ“ä½œ","path":"/2023/10/16/6-å¼€å‘å·¥å…·-Git-3-Gitå¸¸ç”¨æ“ä½œ/","content":"é¡¹ç›®åˆ›å»ºå¯¹äºç½‘ç»œé¡¹ç›®git clone [url] å°† GitHub ä¸­çš„ç½‘ç»œé¡¹ç›®å¤åˆ¶åˆ°æœ¬åœ°ï¼Œåªéœ€åœ¨ä¿®æ”¹å®Œä¹‹å commit å³å¯ï¼Œç„¶åæ›´æ–°ä»“åº“ä»£ç ï¼Œå°±å¯åŒæ­¥ä¿®æ”¹ã€‚ å¯¹äºæœ¬åœ°é¡¹ç›®é¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨ä»¥å­˜æ”¾æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ git init å¯¹è¿›è¡Œåˆå§‹åŒ–æ“ä½œ git status å¾—åˆ° git ä¸­æ–‡ä»¶çš„çŠ¶æ€ git add filename å°† filename æ–‡ä»¶åŠ å…¥åˆ° git æœ¬åœ°ä»“åº“ä¸­å»ï¼ˆgit rm -cached å¯ç§»é™¤ï¼‰ git commit -m â€˜statusâ€™ è¡¨ç¤ºæäº¤ä¿¡æ¯ï¼ˆstatus è¡¨ç¤ºé™„åŠ ä¿¡æ¯ï¼‰ ä¹‹åå¯¹æœ¬åœ°é¡¹ç›®è¿›è¡Œå…³è” git remote add origin [url] æ·»åŠ æœ¬åœ°åˆ°è¿œç¨‹ origin ä»“åº“ git remote -v æŸ¥çœ‹å½“å‰é¡¹ç›®æœ‰å“ªäº›è¿œç¨‹ä»“åº“ å…³è”ä¹‹åå¯ä»¥å‘è¿œç¨‹ä»“åº“æäº¤ä»£ç ï¼ˆæ›´æ–°ä»“åº“ä»£ç ï¼‰ æ—¥å¸¸ push`git status` #è·å–çŠ¶æ€`git add . `#æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº`git commit -m 20191121 push `#æäº¤æ–‡ä»¶`git push origin master `#æ¨é€ æ—¥å¸¸ pull git diff æ¯”è¾ƒå·¥ä½œç›®å½•å’Œ Index ä¸­çš„ä»£ç ã€‚ git fetch å½“äºä»è¿œç¨‹è·å–æœ€æ–°ç‰ˆæœ¬åˆ°æœ¬åœ°ï¼Œä¸ä¼šè‡ªåŠ¨ merge ï¼Œæ¯” Git pull æ›´å®‰å…¨äº› git checkout app/model/user.rb å°† user.rb æ–‡ä»¶ä»ä¸Šä¸€ä¸ªå·²æäº¤çš„ç‰ˆæœ¬ä¸­æ›´æ–°å›æ¥ï¼Œæœªæäº¤çš„å·¥ä½œç›®å½•ä¸­çš„å†…å®¹å…¨éƒ¨ä¼šè¢«è¦†ç›– é¦–æ¬¡ä½¿ç”¨é…ç½® ssh ssh-keygen -t rsa ssh -T git@github.com å°†.ssh ä¸‹çš„ pub å…¬é’¥å¤åˆ¶åˆ° github è´¦å·ä¸­çš„è®¾ç½®-SSHï¼Œæ·»åŠ å¯†é’¥å³å¯ é¦–æ¬¡ä½¿ç”¨è®¾ç½®ç”¨æˆ· git config (--global) user.name username git config (--global) user.email username@gmail.com git config --global user.name liuluhuagit config --global user.email 718050012@qq.com ä¸Šä¼ ä¸‹è½½å¸¸ç”¨å‘½ä»¤ git push originï¼ˆä»“åº“åï¼‰ masterï¼ˆåˆ†æ”¯ï¼‰ æ›´æ–°ä»“åº“ä»£ç ï¼ˆä¸Šä¼ ï¼‰ git pull originï¼ˆä»“åº“åï¼‰ masterï¼ˆåˆ†æ”¯ï¼‰ æ›´æ–°æœ¬åœ°ä»£ç ï¼ˆä¸‹è½½ï¼‰ å›é€€å†å²ç‰ˆæœ¬ git log git reset --hard \\[commit\\_id] git revert \\[commit\\_id] ç½‘ç»œé¡¹ç›® git clone \\[url] git remote add origin \\[url] æ·»åŠ æœ¬åœ°åˆ°è¿œç¨‹ origin ä»“åº“ git remote -v æŸ¥çœ‹å½“å‰é¡¹ç›®æœ‰å“ªäº›è¿œç¨‹ä»“åº“ ç‰ˆæœ¬æƒ…å†µ git tag æŸ¥çœ‹ç‰ˆæœ¬æƒ…å†µ git tag V1.0 æ–°å»ºç‰ˆæœ¬ git checkout V1.0 åˆ‡æ¢è‡³ç‰ˆæœ¬ V1.0 åˆ†æ”¯æƒ…å†µ git branch æŸ¥çœ‹å½“å‰åˆ†æ”¯æƒ…å†µ git checkout a åˆ‡æ¢åˆ°åˆ†æ”¯ a git checkout -b a æ–°å»ºåˆ†æ”¯ a å¹¶åˆ‡æ¢åˆ°åˆ†æ”¯ a git branch -d a åˆ é™¤ a åˆ†æ”¯ git merge a å°† a åˆ†æ”¯çš„ä»£ç åˆå¹¶åˆ° master åˆ†æ”¯ä¸Š","categories":["6.å¼€å‘å·¥å…·","Git"]},{"title":"4. Gitåˆ†æ”¯","path":"/2023/10/13/6-å¼€å‘å·¥å…·-Git-4-Gitåˆ†æ”¯/","content":"åˆ†æ”¯Git æ˜¯ä¸€ä¸ªæµè¡Œçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œä¸€èˆ¬éƒ½æ˜¯å­˜åœ¨å¤šä¸ªåˆ†æ”¯çš„ï¼Œå¼€å‘åˆ†æ”¯ï¼Œå›å½’æµ‹è¯•åˆ†æ”¯ä»¥åŠä¸»å¹²åˆ†æ”¯ç­‰ åœ¨ Git ä¸­ï¼Œåˆ†æ”¯æ˜¯æŒ‡æŒ‡å‘ Git æäº¤å†å²ä¸­æŸä¸ªç‰¹å®šæäº¤çš„æŒ‡é’ˆã€‚ æ¯ä¸ªåˆ†æ”¯éƒ½åŒ…å«åœ¨ Git æäº¤å†å²ä¸­çš„ä¸€ç³»åˆ—æäº¤ï¼Œè¿™äº›æäº¤æ„æˆäº†åˆ†æ”¯çš„å†å²è®°å½•ã€‚ åˆ†æ”¯åœ¨ Git ä¸­éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒä»¬å…è®¸å¤šä¸ªå¼€å‘äººå‘˜åŒæ—¶åœ¨åŒä¸€ä¸ªä»£ç åº“ä¸­å·¥ä½œï¼Œè€Œä¸ä¼šç›¸äº’å¹²æ‰°ã€‚ é€šè¿‡åˆ›å»ºåˆ†æ”¯ï¼Œæ¯ä¸ªå¼€å‘äººå‘˜éƒ½å¯ä»¥åœ¨è‡ªå·±çš„åˆ†æ”¯ä¸Šè¿›è¡Œå·¥ä½œï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–äººçš„å·¥ä½œã€‚ è¿™æ ·ï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨ä¸å¹²æ‰°å…¶ä»–äººçš„æƒ…å†µä¸‹ï¼Œç‹¬ç«‹åœ°å¼€å‘å’Œæµ‹è¯•æ–°åŠŸèƒ½ï¼Œæœ€ç»ˆå°†è¿™äº›æ›´æ”¹åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸­ã€‚ åœ¨ Git ä¸­ï¼Œåˆ†æ”¯æ“ä½œéå¸¸ç®€å•ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ Git åˆ†æ”¯æ“ä½œï¼š åˆ›å»ºåˆ†æ”¯è¦åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š git branch branch-name è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º branch-name çš„æ–°åˆ†æ”¯ã€‚ æ³¨æ„ï¼Œæ­¤æ—¶ä»ç„¶åœ¨å½“å‰åˆ†æ”¯ä¸Šå·¥ä½œã€‚ git checkout -b branch-name æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œå¹¶ä¸”åˆ‡æ¢åˆ°æ–°çš„åˆ†æ”¯ branch-name æŸ¥çœ‹åˆ†æ”¯è¦æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š git branch è¿™å°†åˆ—å‡ºæ‰€æœ‰åˆ†æ”¯ï¼Œå½“å‰åˆ†æ”¯å°†ç”¨ä¸€ä¸ªæ˜Ÿå·æ ‡è®°ã€‚ git branch -r æŸ¥çœ‹æ‰€æœ‰è¿œç¨‹çš„åˆ†æ”¯ git branch -a æŸ¥çœ‹æ‰€æœ‰è¿œç¨‹åˆ†æ”¯å’Œæœ¬åœ°åˆ†æ”¯ åˆ é™¤åˆ†æ”¯è¦åˆ é™¤ä¸€ä¸ªåˆ†æ”¯ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š git branch -d branch-name è¿™å°†åˆ é™¤åä¸ºçš„åˆ†æ”¯ã€‚ æ³¨æ„ï¼Œå¦‚æœè¯¥åˆ†æ”¯åŒ…å«æœªåˆå¹¶çš„æ›´æ”¹ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ -D é€‰é¡¹è€Œä¸æ˜¯ -d é€‰é¡¹æ¥å¼ºåˆ¶åˆ é™¤è¯¥åˆ†æ”¯ã€‚ åˆ‡æ¢åˆ†æ”¯è¦åˆ‡æ¢åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š git checkout branch-name è¿™å°†ä½¿ä»å½“å‰åˆ†æ”¯åˆ‡æ¢åˆ°åä¸º branch-name çš„åˆ†æ”¯ã€‚ æ³¨æ„ï¼Œéœ€è¦åœ¨åˆ‡æ¢åˆ†æ”¯ä¹‹å‰å°†æ‰€æœ‰æ›´æ”¹æäº¤æˆ–ä¿å­˜ã€‚ åˆå¹¶åˆ†æ”¯è¦å°†ä¸€ä¸ªåˆ†æ”¯åˆå¹¶åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š git merge branch-name å°†åä¸º branch-name çš„åˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ä¸­ã€‚ æ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªåˆ†æ”¯ä¸Šéƒ½æœ‰å¯¹åŒä¸€æ–‡ä»¶çš„æ›´æ”¹ï¼Œåˆ™å¯èƒ½ä¼šå‘ç”Ÿå†²çªã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦æ‰‹åŠ¨è§£å†³å†²çªå¹¶æäº¤æ›´æ”¹ã€‚ git merge â€“no-ff origindev åœ¨å½“å‰åˆ†æ”¯ä¸Šåˆå¹¶è¿œç¨‹åˆ†æ”¯ dev git merge â€“abort ç»ˆæ­¢æœ¬æ¬¡ mergeï¼Œå¹¶å›åˆ° merge å‰çš„çŠ¶æ€ ä»¥ä¸Šæ˜¯ä¸€äº›å¸¸ç”¨çš„ Git åˆ†æ”¯æ“ä½œã€‚ä½¿ç”¨è¿™äº›æ“ä½œï¼Œå¯ä»¥è½»æ¾åœ°åˆ›å»ºã€åˆ‡æ¢ã€åˆå¹¶å’Œåˆ é™¤åˆ†æ”¯ã€‚è¿™äº›æ“ä½œä½¿å¤šäººåä½œå˜å¾—æ›´åŠ å®¹æ˜“ï¼Œå› ä¸ºæ¯ä¸ªå¼€å‘äººå‘˜éƒ½å¯ä»¥åœ¨è‡ªå·±çš„åˆ†æ”¯ä¸Šè¿›è¡Œå·¥ä½œï¼Œå¹¶å°†æ›´æ”¹åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸­ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåˆ†æ”¯æ“ä½œæ˜¯éå¸¸é‡è¦çš„ï¼Œæœ€å¥½èƒ½å¤Ÿç†Ÿç»ƒæŒæ¡å¹¶è¿ç”¨è¿™äº›æ“ä½œ","categories":["6.å¼€å‘å·¥å…·","Git"]},{"title":"5. Gitæ’¤é”€æˆ–å›é€€","path":"/2023/10/12/6-å¼€å‘å·¥å…·-Git-5-Gitæ’¤é”€æˆ–å›é€€/","content":"æ’¤é”€æˆ–å›é€€åœ¨ Git ä¸­ï¼Œæ’¤é”€å’Œå›é€€æ˜¯æŒ‡æ’¤é”€æˆ–å›é€€å…ˆå‰çš„æäº¤æˆ–æ›´æ”¹ã€‚ ç®€å•ä»‹ç»ä¸‹ Git ä¸­çš„æ’¤é”€å’Œå›é€€æ“ä½œï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬æ¥ç®¡ç†ä»£ç åº“ã€‚ å¯ä»¥æŠŠç‰ˆæœ¬åº“ä¸Šçš„æäº¤å›é€€åˆ°æš‚å­˜åŒºï¼Œä¿®æ”¹è®°å½•ä¿ç•™ git reset â€“-soft [] å¯ä»¥æŠŠç‰ˆæœ¬åº“ä¸Šçš„æäº¤å›é€€åˆ°å·¥ä½œåŒºï¼Œä¿®æ”¹è®°å½•ä¿ç•™ git reset â€“-mixed [] å¯ä»¥æŠŠç‰ˆæœ¬åº“ä¸Šçš„æäº¤å½»åº•å›é€€ï¼Œä¿®æ”¹çš„è®°å½•å…¨éƒ¨ revertã€‚git reset â€“-hard reset å’Œ revert çš„åŒºåˆ«git reset å’Œ git revert çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬å¯¹å†å²è®°å½•çš„å¤„ç†æ–¹å¼ã€‚git reset ä¼šåˆ é™¤å†å²è®°å½•å¹¶æ°¸ä¹…åˆ é™¤æ›´æ”¹ï¼Œè€Œ git revert ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤æ¥æ’¤é”€æ›´æ”¹å¹¶ä¿ç•™å†å²è®°å½•ã€‚ git reset å‘½ä»¤ä¼šå°† HEAD æŒ‡é’ˆæŒ‡å‘æŒ‡å®šçš„ commitï¼Œå¹¶å°†æš‚å­˜åŒºå’Œå·¥ä½œç›®å½•æ¢å¤åˆ°è¯¥ commit çš„çŠ¶æ€ã€‚è¿™æ„å‘³ç€åœ¨æ‰§è¡Œ git reset åï¼Œä¹‹å‰çš„æ›´æ”¹å°†ä¸å†å­˜åœ¨äºå·¥ä½œç›®å½•å’Œæš‚å­˜åŒºä¸­ã€‚å¦‚æœå¸Œæœ›æ°¸ä¹…åˆ é™¤ä¸€äº›æ›´æ”¹å¹¶ä¸”ä¸å†éœ€è¦å®ƒä»¬ï¼Œå¯ä»¥ä½¿ç”¨ git resetã€‚ git revert å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤æ¥æ’¤é”€æŒ‡å®šçš„æäº¤ã€‚è¿™æ„å‘³ç€åœ¨æ‰§è¡Œ git revert åï¼Œä¹‹å‰çš„æ›´æ”¹ä»ç„¶å­˜åœ¨äºå·¥ä½œç›®å½•å’Œæš‚å­˜åŒºä¸­ï¼Œå¹¶ä¸”éœ€è¦æäº¤ä¸€ä¸ªæ–°çš„æ’¤é”€æäº¤ã€‚å¦‚æœæƒ³è¦ä¿ç•™æ›´æ”¹å†å²è®°å½•å¹¶ä¸”ä¸æƒ³æ°¸ä¹…åˆ é™¤æ›´æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ git revertã€‚ è·å– IDgit log è·å–åˆ°æƒ³è¦å›é€€çš„ commit_id æ’¤é”€å›é€€æœªæäº¤çš„æ›´æ”¹**(add ä¹‹åï¼Œcommit ä¹‹å‰)** è¦æ’¤é”€æœªæäº¤çš„æ›´æ”¹ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š git checkout file-name å°†åä¸º file-name çš„æ–‡ä»¶æ¢å¤åˆ°ä¸Šä¸€ä¸ªæäº¤çš„çŠ¶æ€ã€‚ æœ¬åœ°æœ¬æ¬¡çš„æ›´æ”¹ä¹Ÿä¸å†ä¿å­˜ï¼Œæ¢å¤åˆ°ä¸Šä¸€ä¸ªæäº¤ (commit) çš„çŠ¶æ€ git reset HEAD --file å›é€€æš‚å­˜åŒºé‡Œçš„æŸä¸ªæ–‡ä»¶ï¼Œå›é€€åˆ°å½“å‰ç‰ˆæœ¬å·¥ä½œåŒºçŠ¶æ€ ä¿å­˜å·¥ä½œåŒºçš„æ›´æ”¹ï¼Œåªæ˜¯æ’¤é”€ git add è¿™ä¸€æ­¥æ“ä½œ git checkout . å°†æ‰€æœ‰æ–‡ä»¶æ¢å¤åˆ°æœ€æ–°æäº¤çš„çŠ¶æ€ã€‚è¯·æ³¨æ„ï¼Œæ­¤æ“ä½œå°†åˆ é™¤æ‰€æœ‰æœªæäº¤çš„æ›´æ”¹ã€‚ æ’¤é”€å›é€€ä¸Šä¸€ä¸ªæäº¤**(commit ä¹‹åï¼Œpush ä¹‹å‰)** æ’¤é”€ä¸Šä¸€ä¸ªæäº¤ git reset HEAD~1 å°† HEAD æŒ‡é’ˆç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªæäº¤ã€‚ å·¥ä½œåŒºä¿ç•™å…ˆå‰çš„æ›´æ”¹ï¼Œéœ€è¦é‡æ–°æ·»åŠ åˆ°æš‚å­˜åŒº (git add) å›é€€åˆ°ä¸Šä¸€ä¸ªæäº¤ git reset --hard HEAD~1 å°† HEAD æŒ‡é’ˆå’Œå·¥ä½œæ ‘éƒ½é‡ç½®ä¸ºä¸Šä¸€ä¸ªæäº¤çš„çŠ¶æ€ã€‚ è¯·æ³¨æ„ï¼Œæ­¤æ“ä½œå°†åˆ é™¤æ‰€æœ‰æœªæäº¤ (commit) çš„æ›´æ”¹ã€‚ æ’¤é”€å›é€€åˆ°ç‰¹å®šçš„æäº¤**(push ä¹‹å)** æ’¤é”€åˆ°ç‰¹å®šç‰ˆæœ¬ git revert commit_id è¿™å°†åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤ï¼Œè¯¥æäº¤æ’¤é”€åä¸º commit-hash çš„æäº¤æ‰€åšçš„æ›´æ”¹ã€‚ æœ¬æ¬¡æ’¤é”€æ“ä½œä¹Ÿä¼šä½œä¸ºä¸€æ¬¡æäº¤ (push) è¿›è¡Œä¿å­˜ å›é€€åˆ°ç‰¹å®šç‰ˆæœ¬ git reset --hard commit_id å°† HEAD æŒ‡é’ˆå’Œå·¥ä½œæ ‘éƒ½é‡ç½®ä¸ºåä¸º commit-hash çš„æäº¤çš„çŠ¶æ€ã€‚ è¯·æ³¨æ„ï¼Œæ­¤æ“ä½œå°†åˆ é™¤æ‰€æœ‰æœªæäº¤çš„æ›´æ”¹ã€‚ å›é€€å®Œæˆåï¼Œgit push -f å¼ºåˆ¶æäº¤","categories":["6.å¼€å‘å·¥å…·","Git"]},{"title":"6. Gitæ ‡ç­¾","path":"/2023/10/11/6-å¼€å‘å·¥å…·-Git-6-Gitæ ‡ç­¾/","content":"æ ‡ç­¾åœ¨ Git ä¸­ï¼Œtag æ˜¯ç”¨äºæ ‡è®°æŸä¸ªç‰¹å®šæäº¤çš„åç§°ã€‚å®ƒç±»ä¼¼äºä¸€ä¸ªå¿«ç…§ï¼Œå¯ä»¥ç”¨äºæ ‡è®°ç‰ˆæœ¬ã€å‘å¸ƒæˆ–é‡è¦çš„é‡Œç¨‹ç¢‘ã€‚Git ä¸­æœ‰ä¸¤ç§ç±»å‹çš„ tagï¼šè½»é‡çº§æ ‡ç­¾å’Œé™„æ³¨æ ‡ç­¾ã€‚ è½»é‡çº§æ ‡ç­¾æ˜¯ä¸€ä¸ªç®€å•çš„æŒ‡å‘æŸä¸ªç‰¹å®šæäº¤çš„å¼•ç”¨ï¼Œç±»ä¼¼äºä¸€ä¸ªåˆ†æ”¯ï¼Œä½†ä¸ä¼šéšç€æ–°çš„æäº¤è€Œç§»åŠ¨ã€‚åˆ›å»ºè½»é‡çº§æ ‡ç­¾çš„æ–¹æ³•å¾ˆç®€å•ï¼Œåªéœ€åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ git tag tag-name å³å¯ã€‚ä¾‹å¦‚ï¼Œgit tag v1.0 å°†åˆ›å»ºä¸€ä¸ªåä¸º v1.0 çš„è½»é‡çº§æ ‡ç­¾ã€‚ é™„æ³¨æ ‡ç­¾æ˜¯ä¸€ä¸ªåŒ…å«æ ‡ç­¾åç§°ã€æ ‡ç­¾åˆ›å»ºè€…ã€æ ‡ç­¾åˆ›å»ºæ—¥æœŸå’Œæ ‡ç­¾è¯´æ˜çš„ Git å¯¹è±¡ã€‚å®ƒä»¬æ˜¯ Git ä¸­æœ€å¸¸ç”¨çš„æ ‡ç­¾ç±»å‹ï¼Œå¯ä»¥ç”¨äºå‘å¸ƒç‰ˆæœ¬ã€é‡è¦çš„é‡Œç¨‹ç¢‘å’Œå…¶ä»–é‡è¦çš„æäº¤ã€‚åˆ›å»ºé™„æ³¨æ ‡ç­¾çš„æ–¹æ³•æ˜¯ä½¿ç”¨ -a æ ‡å¿—å’Œæ ‡ç­¾åç§°ï¼Œç„¶åè¾“å…¥æ ‡ç­¾è¯´æ˜ã€‚ä¾‹å¦‚ï¼Œgit tag -a v1.0 -m Release version 1.0 å°†åˆ›å»ºä¸€ä¸ªåä¸º v1.0 çš„é™„æ³¨æ ‡ç­¾ï¼Œå¹¶å°†å…¶è¯´æ˜è®¾ç½®ä¸º â€œRelease version 1.0â€ã€‚ æ ‡ç­¾å¯ä»¥ä½¿ç”¨ git push å‘½ä»¤æ¨é€åˆ°è¿œç¨‹å­˜å‚¨åº“ä¸­ï¼Œä»¥ä¾¿åœ¨å…¶ä»–è®¡ç®—æœºä¸Šä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œè¦å°†åä¸º v1.0 çš„æ ‡ç­¾æ¨é€åˆ°è¿œç¨‹å­˜å‚¨åº“ï¼Œå¯ä»¥ä½¿ç”¨ git push origin v1.0 å‘½ä»¤ã€‚ git tag #åˆ—å‡ºæ‰€æœ‰taggit tag [tag] #æ–°å»ºä¸€ä¸ªtagåœ¨å½“å‰commitgit tag [tag] [commit] #æ–°å»ºä¸€ä¸ªtagåœ¨æŒ‡å®šcommitgit tag -d [tag] #åˆ é™¤æœ¬åœ°taggit push origin [tag] #æ¨é€tagåˆ°è¿œç¨‹git show [tag] #æŸ¥çœ‹ç‰¹å®štaggit checkout -b [branch] [tag] #æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼ŒæŒ‡å‘æŸä¸ªtag","categories":["6.å¼€å‘å·¥å…·","Git"]},{"title":"Git åŒæ­¥æ—¶æŠ¥é”™","path":"/2023/10/10/6-å¼€å‘å·¥å…·-Git-Git-åŒæ­¥æ—¶æŠ¥é”™/","content":"Git åŒæ­¥æ—¶æŠ¥é”™åœ¨ä½¿ç”¨ Git è¿›è¡ŒåŒæ­¥æ—¶ï¼Œæœ‰æ—¶ä¼šé‡åˆ°è¿™æ ·çš„é”™è¯¯ä¿¡æ¯ï¼šâ€error: RPC failed; curl 92 HTTP2 stream 7 was not closed cleanly: CANCEL (err 8)â€ã€‚è¿™ä¸€é”™è¯¯é€šå¸¸æ„å‘³ç€å­˜åœ¨ç½‘ç»œè¿æ¥é—®é¢˜ã€Git é…ç½®æœªä¼˜åŒ–ï¼Œæˆ–æ˜¯ HTTP2 åè®®æ”¯æŒä¸è¶³ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»¥ä¸‹æ˜¯è¯¦å°½çš„è§£å†³æ–¹æ¡ˆåŠæ­¥éª¤ã€‚ error: RPC failed; curl 56 Failure when receiving data from the peererror: 6920 bytes of body are still expectedfetch-pack: unexpected disconnect while reading sideband packetfatal: early EOFfatal: fetch-pack: invalid index-pack output 1. æ£€æŸ¥ç½‘ç»œç¯å¢ƒè¿™ä¸ªé”™è¯¯å¾€å¾€æºäºç½‘ç»œçš„ä¸ç¨³å®šæ€§ï¼Œå› æ­¤é¦–å…ˆåº”ç¡®ä¿ç½‘ç»œè¿æ¥ç•…é€šã€‚ ç¡®ä¿ç½‘ç»œç¨³å®šï¼šè§‚å¯Ÿè¿æ¥çŠ¶æ€ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ¶ˆå¤±çš„ç½‘ç»œä¿¡å·ï¼Œæ˜¯å¦å‡ºç°äº†é¢‘ç¹çš„æ–­çº¿é‡è¿ã€‚å¦‚æœåœ¨ä½¿ç”¨æ— çº¿ç½‘ç»œæ—¶ï¼Œå°è¯•é è¿‘è·¯ç”±å™¨æˆ–è€…åˆ‡æ¢åˆ°æœ‰çº¿è¿æ¥ã€‚ å…³é—­ä»£ç†ï¼šåœ¨ä¸€äº›ç½‘ç»œç¯å¢ƒä¸­ï¼Œå°¤å…¶æ˜¯å…¬å¸ç½‘ç»œæˆ–å…¬å…± Wi-Fiï¼Œå¯èƒ½ç”±äºé˜²ç«å¢™æˆ–å…¶ä»–é™åˆ¶å¯¼è‡´è¿æ¥é—®é¢˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å°è¯•é€šè¿‡ä»£ç†æ¥è¿›è¡Œè¿æ¥ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥é…ç½® HTTP æˆ– SOCKS ä»£ç†ï¼š git config --global http.proxy http://ä»£ç†åœ°å€:ç«¯å£git config --global https.proxy http://ä»£ç†åœ°å€:ç«¯å£ ä¾‹å¦‚ï¼Œå¦‚æœçš„ä»£ç†åœ°å€æ˜¯ proxy.comï¼Œç«¯å£æ˜¯ 8080ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·è®¾å®šï¼š git config --global http.proxy http://proxy.com:8080git config --global https.proxy http://proxy.com:8080 ä½¿ç”¨ VPNï¼šå¦‚æœåœ¨ä¸­å›½å¤§é™†è®¿é—® GitHub ç­‰å›½å¤–ç½‘ç«™æ—¶å¸¸é‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œè€ƒè™‘ä½¿ç”¨ VPN å·¥å…·æ¥æé«˜è¿æ¥ç¨³å®šæ€§ã€‚ 2. ç¦ç”¨ HTTP2 åè®®æŸäº›ç‰ˆæœ¬çš„ Git å¯¹ HTTP2 çš„æ”¯æŒå¯èƒ½å¹¶ä¸ç¨³å®šï¼Œå¯ä»¥å°è¯•å¼ºåˆ¶ä½¿ç”¨ HTTP1.1 çš„åè®®ï¼š git config --global http.version HTTP/1.1 è¿™ç§è®¾ç½®é€šå¸¸å¯ä»¥å¸®åŠ©è§£å†³å› ä¸ºåè®®ä¸å…¼å®¹å¼•èµ·çš„é”™è¯¯ã€‚ 3. è°ƒæ•´ Git ç¼“å­˜è®¾ç½®åœ¨ä¼ è¾“å¤§æ–‡ä»¶æ—¶ï¼Œç¼“å†²åŒºè¿‡å°å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ã€‚å¯ä»¥é€šè¿‡å¢åŠ  Git çš„ç¼“å†²åŒºè®¾ç½®æ¥è§£å†³ï¼š git config --global http.postBuffer 524288000 # è®¾ç½®ç¼“å†²åŒºä¸º500MBgit config --global http.maxRequestBuffer 524288000 # è®¾ç½®è¯·æ±‚ç¼“å†²åŒºgit config --global core.compression 0 # ç¦ç”¨å‹ç¼© ä¾‹å¦‚ï¼Œè®¾ç½® http.postBuffer ä¸º 500MB ä½¿å¾—å¤§å‹æ–‡ä»¶çš„ä¸Šä¼ æ›´ä¸ºé¡ºç•…ã€‚ 4. é™ä½å¹¶å‘è¯·æ±‚å¦‚æœè¯·æ±‚æ•°è¿‡å¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨æ— æ³•å¤„ç†ã€‚é€šè¿‡é™åˆ¶åŒæ—¶è¯·æ±‚çš„æ•°é‡ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨å‹åŠ›ï¼Œç¼“è§£é”™è¯¯ï¼š git config --global http.maxRequests 10 è¯¥å‘½ä»¤å°†æœ€å¤§è¯·æ±‚æ•°é™åˆ¶ä¸º 10ã€‚ 5. æ£€æŸ¥ Git å’Œ cURL ç‰ˆæœ¬ç¡®ä¿çš„ Git å’Œ cURL ç‰ˆæœ¬æ˜¯æœ€æ–°çš„ã€‚è€æ—§çš„ç‰ˆæœ¬å¯èƒ½å­˜åœ¨æœªä¿®å¤çš„ç¼ºé™·ï¼Œå¯¼è‡´è¿æ¥é—®é¢˜ã€‚ git --versioncurl --version è‹¥å‘ç°ç‰ˆæœ¬è¾ƒæ—§ï¼Œå»ºè®®é€šè¿‡å®˜æ–¹ç½‘ç«™æˆ–åŒ…ç®¡ç†å·¥å…·è¿›è¡Œå‡çº§ã€‚ä¾‹å¦‚ï¼Œåœ¨ Ubuntu ç³»ç»Ÿä¸Šï¼Œå¯ä»¥ä½¿ç”¨ï¼š sudo apt updatesudo apt install git curl 6. å…‹éš†å•ä¸ªåˆ†æ”¯åœ¨åŒæ­¥å¤§çš„ç‰ˆæœ¬åº“æ—¶ï¼Œä¸‹è½½æ‰€æœ‰å†…å®¹å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ã€‚ç›¸åï¼Œå°è¯•åªå…‹éš†éœ€è¦çš„åˆ†æ”¯ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä¼ è¾“é‡ï¼š git clone --single-branch --branch åˆ†æ”¯å ä»“åº“åœ°å€ åœ¨æ­¤å‘½ä»¤ä¸­ï¼Œåªéœ€æ›¿æ¢ åˆ†æ”¯å å’Œ ä»“åº“åœ°å€ ä¸ºç›®æ ‡åˆ†æ”¯åå’Œä»“åº“é“¾æ¥ã€‚ 7. éªŒè¯è¿œç¨‹ä»“åº“åœ°å€ç¡®ä¿é…ç½®çš„è¿œç¨‹ä»“åº“åœ°å€æ˜¯æ­£ç¡®ä¸”å¯è®¿é—®çš„ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰é…ç½®çš„è¿œç¨‹åœ°å€ï¼š git remote -v å¦‚æœå‘ç°åœ°å€é”™è¯¯ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ›´æ–°ï¼š git remote set-url origin æ­£ç¡®çš„åœ°å€ ç¡®ä¿ æ­£ç¡®çš„åœ°å€ æ˜¯è¦è®¿é—®çš„å®é™…ä»“åº“åœ°å€ã€‚ ç¼–è¾‘ .gitconfig æ‰¾åˆ° .gitconfig æ–‡ä»¶ä½ç½® ä¸åŒæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶è·¯å¾„å¦‚ä¸‹ï¼š Windows: C:\\Users\\YourUsername\\.gitconfig LinuxMacOS: ~/.gitconfig ç¡®ä¿æ›¿æ¢ YourUsername ä¸ºå®é™…çš„ç”¨æˆ·åç§°ï¼Œä»¥æ‰¾åˆ°æ­£ç¡®çš„æ–‡ä»¶ã€‚ æ‰“å¼€ .gitconfig æ–‡ä»¶ ä½¿ç”¨ä»»ä½•æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€æ­¤æ–‡ä»¶ï¼Œå…·ä½“ç¤ºä¾‹å¦‚ä¸‹ï¼š åœ¨ Windows ä¸Šï¼Œå¯ä»¥ä½¿ç”¨è®°äº‹æœ¬æ‰“å¼€ï¼š notepad C:\\Users\\YourUsername\\.gitconfig åœ¨ Linux ä¸Šï¼Œç”¨ nano ç¼–è¾‘ï¼š nano ~/.gitconfig ç¼–è¾‘æ–‡ä»¶å†…å®¹ åœ¨æ‰“å¼€çš„æ–‡ä»¶ä¸­ï¼Œæ·»åŠ æˆ–ä¿®æ”¹é…ç½®ä¿¡æ¯ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹é…ç½®ï¼š [user] name = Your Name email = your.email@example.com[http] postBuffer = 524288000 maxRequests = 10\tversion = HTTP/1.1[core] editor = vim è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒåŒ…æ‹¬ç”¨æˆ·åã€ç”µå­é‚®ä»¶ã€HTTP è¯·æ±‚çš„ç¼“å†²å¤§å°å’Œé»˜è®¤æ–‡æœ¬ç¼–è¾‘å™¨ã€‚è¿™æ ·çš„é…ç½®å¯ä»¥å¸®åŠ©ç”¨æˆ·åœ¨ä½¿ç”¨ Git æ—¶æ›´åŠ é¡ºç•…ã€‚ ä¿å­˜æ›´æ”¹ å®Œæˆç¼–è¾‘åï¼ŒåŠ¡å¿…ä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚ç¡®ä¿æ‰€åšçš„æ‰€æœ‰æ›´æ”¹éƒ½å·²ä¿å­˜ï¼Œä»¥ä¾¿åœ¨ä¸‹æ¬¡ä½¿ç”¨ Git æ—¶èƒ½æœ‰æ•ˆåº”ç”¨è¿™äº›æ–°çš„é…ç½®ã€‚","categories":["6.å¼€å‘å·¥å…·","Git"]},{"title":"GitHubåŠ é€Ÿè®¿é—®","path":"/2023/10/09/6-å¼€å‘å·¥å…·-Git-GitHubåŠ é€Ÿè®¿é—®/","content":"Git clonegitclone.com æ˜¯ä¸€ä¸ª github.com ç¼“å­˜åŠ é€Ÿç½‘ç«™ï¼Œé€šè¿‡ç¼“å­˜ç»å¸¸è®¿é—®çš„ github ä»“åº“ï¼ŒåŠ é€Ÿ git clone from github æ“ä½œã€‚å½“ä½¿ç”¨ clone ä»“åº“æ—¶ git clone https://gitclone.com/github.com/xxxxx/xxxxx ä¼šåˆ›å»ºä¸€ä¸ªé•œåƒï¼Œä»¥åå…¶ä»–å¼€å‘è€… clone æ—¶å°±å¯ä»¥ä½¿ç”¨é•œåƒç¼“å­˜è¿›è¡Œ cloneï¼Œé€Ÿåº¦å¾—åˆ°äº†å¾ˆå¤§çš„æå‡ï¼Œä¸€èˆ¬ git clone from github åªèƒ½è¾¾åˆ° 20ksï¼Œç»è¿‡ gitclone.com åŠ é€Ÿåå¯ä»¥è¾¾åˆ° 1.2Msã€‚ ç¬¬ä¸‰æ–¹åŠ é€Ÿé•œåƒç«™é€šè¿‡ç¬¬ä¸‰æ–¹ github é•œåƒç«™è¿›è¡ŒåŠ é€Ÿè®¿é—®ï¼Œç½‘ç«™çš„å†…å®¹è·Ÿ GitHub æ˜¯å®Œæ•´åŒæ­¥çš„é•œåƒï¼Œç„¶ååœ¨è¿™ä¸ªç½‘ç«™é‡Œé¢è¿›è¡Œä¸‹è½½å…‹éš†ç­‰æ“ä½œã€‚ é•œåƒç«™ https://github.com.cnpmjs.org git clone https://github.com/xxxxx/xxxxxæ›¿æ¢ä¸ºgit clone https://github.com.cnpmjs.org/xxxxx/xxxxx é•œåƒç«™ https://hub.fastgit.org git clone https://github.com/xxxxx/xxxxxæ›¿æ¢ä¸ºgit clone https://hub.fastgit.org/xxxx/xxxx GitHub æ–‡ä»¶åŠ é€Ÿåˆ©ç”¨ Cloudflare Workers å¯¹ github release ã€ archive ä»¥åŠé¡¹ç›®æ–‡ä»¶è¿›è¡ŒåŠ é€Ÿï¼Œéƒ¨ç½²æ— éœ€æœåŠ¡å™¨ä¸”è‡ªå¸¦ cdn. https://gh.api.99988866.xyz https://g.ioiox.com https://www.7ed.net/gitmirror/hub.html GitHub-Rawé€šè¿‡ GitHub raw åŸŸåå¹¶é github.com è€Œæ˜¯ raw.githubusercontent.comï¼Œä¸Šæ–¹çš„ GitHub åŠ é€Ÿå¦‚æœä¸èƒ½åŠ é€Ÿè¿™ä¸ªåŸŸåï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ Static CDN æä¾›çš„åä»£æœåŠ¡ã€‚ å°† raw.githubusercontent.com æ›¿æ¢ä¸º raw.staticdn.net å³å¯åŠ é€Ÿ https://github.com/xxxxx/xxxxxæ›¿æ¢ä¸ºhttps://raw.githubusercontent.com/xxxx/xxxxhttps://raw.staticdn.net/xxxx/xxxxhttps://raw.gitmirror.com/xxxx/xxxx jsdelivr åŠ é€Ÿé€šè¿‡ jsdelivr å”¯ä¸€ç¾ä¸­ä¸è¶³çš„å°±æ˜¯å®ƒä¸èƒ½è·å– exe æ–‡ä»¶ä»¥åŠ Release å¤„é™„åŠ çš„ exe å’Œ dmg æ–‡ä»¶ã€‚ https://github.com/xxxxx/xxxxxæ›¿æ¢ä¸ºä¸‹é¢ jsdelivr åœ°å€https://cdn.jsdelivr.net/gh/xxxxx/xxxxx/ éƒ¨ç½²å…è´¹ gh-proxyé€šè¿‡ Cloudflare Workers å’Œ gh-proxy å¼€æºé¡¹ç›®å¯¹ GitHub æ–‡ä»¶åŠ é€Ÿ,é€šè¿‡ Cloudflare Workers éƒ¨ç½²æ— éœ€æœåŠ¡å™¨ä¸”è‡ªå¸¦ CDNã€‚å¼€æºé¡¹ç›®: gh-proxy æ–‡ä»¶åŠ é€Ÿè‡ªè¡Œéƒ¨ç½²ã€‚ ä½¿ç”¨ Github é•œåƒç«™å¯ä»¥é€šè¿‡ä¿®æ”¹ Github çš„é“¾æ¥æ¥åŠ é€Ÿè®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç›´æ¥è®¿é—® https://github.com é€Ÿåº¦å¾ˆæ…¢ï¼Œå¯ä»¥å°è¯•å°†å…¶æ”¹ä¸º https://github.hscsec.cn ä»¥åŠ é€Ÿè®¿é—®ã€‚å½“ GitHub èµ„æºè®¿é—®ç¼“æ…¢æ—¶ä½¿ç”¨ä¸‹é¢ä»»æ„ç½‘å€ä»…æ›¿æ¢æ‰ https://github.com åŸŸåå³å¯ã€‚ æ¨èçš„é•œåƒç«™æœ‰ï¼š https://github.hscsec.cn https://521github.com https://mirror.ghproxy.com https://gh.api.99988866.xyz","categories":["6.å¼€å‘å·¥å…·","Git"]},{"title":"GitLabéƒ¨ç½²","path":"/2023/10/06/6-å¼€å‘å·¥å…·-Git-GitLabéƒ¨ç½²/","content":"æ‰‹åŠ¨éƒ¨ç½² GitLab ç¯å¢ƒ1. å®‰è£…ä¾èµ–åŒ…é¦–å…ˆï¼Œéœ€è¦å®‰è£…ä¸€äº›å¿…è¦çš„ä¾èµ–åŒ…ï¼Œä»¥ç¡®ä¿ç¯å¢ƒè¿è¡Œé¡ºç•…ã€‚è¿™äº›åŒ…åŒ…æ‹¬ï¼š curlï¼šç”¨äºè·å–æ–‡ä»¶å’Œæ•°æ®çš„å·¥å…·ã€‚ policycoreutils-pythonï¼šä¸º SELinux æä¾›ç®¡ç†å·¥å…·çš„ Python åŒ…ã€‚ openssh-serverï¼šSSH æœåŠ¡ï¼Œç”¨äºå®‰å…¨è¿œç¨‹è®¿é—®ã€‚ ä»¥ä¸‹å‘½ä»¤ç”¨äºå®‰è£…è¿™äº›ä¾èµ–åŒ…ï¼š sudo yum install -y curl policycoreutils-python openssh-server 2. é…ç½® SSH æœåŠ¡æ¥ä¸‹æ¥ï¼Œéœ€è¦é…ç½® SSH æœåŠ¡ï¼Œä»¥ä¾¿èƒ½å¤Ÿå®‰å…¨åœ°ç®¡ç† GitLab æœåŠ¡å™¨ã€‚ å¯åŠ¨ SSH æœåŠ¡ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å¯åŠ¨ SSH æœåŠ¡ï¼š sudo systemctl start sshd è®¾ç½® SSH æœåŠ¡ä¸ºå¼€æœºè‡ªå¯åŠ¨ç¡®ä¿ SSH æœåŠ¡åœ¨ç³»ç»Ÿé‡å¯åè‡ªåŠ¨å¯åŠ¨ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š sudo systemctl enable sshd 3. å®‰è£… Postfix ä»¥å‘é€é€šçŸ¥é‚®ä»¶éœ€è¦å®‰è£… Postfixï¼Œå®ƒæ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„é‚®ä»¶ä¼ è¾“ä»£ç†ï¼Œå¯ä»¥ç”¨æ¥å‘é€é‚®ä»¶é€šçŸ¥ã€‚ å®‰è£… Postfixè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä»¥å®‰è£… Postfixï¼š sudo yum install postfix è®¾ç½® Postfix ä¸ºå¼€æœºè‡ªå¯åŠ¨ç¡®ä¿ Postfix åœ¨é‡å¯æ—¶è‡ªåŠ¨å¯åŠ¨ï¼š sudo systemctl enable postfix å¯åŠ¨ Postfix æœåŠ¡ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ Postfix æœåŠ¡ï¼š sudo systemctl start postfix 4. é…ç½® Postfixéœ€è¦ç¼–è¾‘ Postfix çš„é…ç½®æ–‡ä»¶ï¼Œä½¿å…¶èƒ½å¤Ÿæ¥å—å¤–éƒ¨è¿æ¥ã€‚ ç¼–è¾‘ Postfix é…ç½®æ–‡ä»¶è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ‰“å¼€ Postfix ä¸»é…ç½®æ–‡ä»¶ï¼š vim /etc/postfix/main.cf æ‰¾åˆ°ä»¥ä¸‹è¡Œï¼š set_inet å°†å…¶ä¿®æ”¹ä¸ºï¼š inet_interfaces = all ä¿å­˜é…ç½®æ–‡ä»¶å¹¶é€€å‡ºæŒ‰ Esc é”®é€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œç„¶åè¾“å…¥ :wq å¹¶å›è½¦ï¼Œä»¥ä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚ 5. æ·»åŠ  GitLab è½¯ä»¶åŒ…ä»“åº“æ¥ä¸‹æ¥ï¼Œéœ€è¦æ·»åŠ  GitLab çš„å®˜æ–¹è½¯ä»¶åŒ…ä»“åº“ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash 6. å®‰è£… GitLabå®‰è£… GitLab çš„å‘½ä»¤å¦‚ä¸‹ï¼Œç”¨ GitLab æœåŠ¡å™¨çš„å…¬ç½‘ IP åœ°å€æ›¿æ¢å ä½ç¬¦ï¼š sudo EXTERNAL_URL=http://GitLabæœåŠ¡å™¨çš„å…¬ç½‘IPåœ°å€ yum install -y gitlab-ce è·å–å…¬ç½‘ IP åœ°å€å¯ä»¥åœ¨ ECS ç®¡ç†æ§åˆ¶å°çš„å®ä¾‹ä¸é•œåƒ å®ä¾‹é¡µé¢æ‰¾åˆ° GitLab æ‰€å± ECS å®ä¾‹çš„å…¬ç½‘ IP åœ°å€ã€‚ 7. ä½¿ç”¨æµè§ˆå™¨è®¿é—® GitLabåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ GitLab æœåŠ¡å™¨çš„å…¬ç½‘ IP åœ°å€ã€‚æˆåŠŸè®¿é—®åï¼Œå°†çœ‹åˆ°å¦‚ä¸‹é¡µé¢ï¼Œè¡¨ç¤ºç¯å¢ƒæ­å»ºæˆåŠŸï¼Œå¹¶ä¸”ç³»ç»Ÿä¼šæç¤ºè®¾ç½®æ–°å¯†ç ã€‚ 8. ç™»å½• GitLabè¾“å…¥ç™»å½•ä¿¡æ¯åœ¨æµè§ˆå™¨çš„åœ°å€æ ä¸­ï¼Œè¾“å…¥ ECS æœåŠ¡å™¨çš„å…¬ç½‘ IPï¼Œè¿›å…¥ GitLab çš„ç™»å½•ç•Œé¢ã€‚é¦–æ¬¡ç™»å½•æ—¶ï¼Œä½¿ç”¨ç”¨æˆ·å rootï¼Œå¯†ç ä¸ºé¦–æ¬¡è®¿é—® GitLab æ—¶è®¾ç½®çš„æ–°å¯†ç ã€‚ ç™»å½•æˆåŠŸåç•Œé¢æˆåŠŸç™»å½•åï¼Œå°†çœ‹åˆ°å¦‚ä¸‹ç•Œé¢ï¼š 9. åˆ›å»ºé¡¹ç›®åœ¨ GitLab ä¸­ï¼Œå¯ä»¥è½»æ¾åˆ›å»ºæ–°é¡¹ç›®ã€‚ å®‰è£… Git å·¥å…·é¦–å…ˆï¼Œç¡®ä¿å·²å®‰è£… Git å·¥å…·ï¼Œç”¨äºç‰ˆæœ¬æ§åˆ¶ã€‚å¯ä»¥ä½¿ç”¨ Linux è‡ªå¸¦çš„è½¯ä»¶æºå®‰è£… Gitï¼š yum install git ç”Ÿæˆå¯†é’¥æ–‡ä»¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆ SSH å¯†é’¥æ–‡ä»¶ï¼Œä»¥ä¾¿èƒ½å¤Ÿä¸ GitLab å®‰å…¨åœ°è¿›è¡Œäº¤äº’ï¼š ssh-keygen æŸ¥çœ‹å…¬é’¥æ–‡ä»¶è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥æŸ¥çœ‹ç”Ÿæˆçš„å…¬é’¥å†…å®¹ï¼Œå¹¶å°†å…¶ç”¨äº GitLab çš„é…ç½®ä¸­ï¼š cat .ssh/id_rsa.pub 10. åœ¨ GitLab ä¸­åˆ›å»ºé¡¹ç›®æ–°å»ºé¡¹ç›®åœ¨ GitLab çš„ä¸»é¡µä¸­ï¼Œå•å‡»â€New Projectâ€æŒ‰é’®ï¼Œæ–°å»ºä¸€ä¸ªé¡¹ç›®ã€‚ é…ç½®é¡¹ç›®è®¾ç½®ä¸é¡¹ç›®ç›¸å…³çš„å„é¡¹é…ç½®ï¼Œç„¶åå•å‡»â€Create projectâ€æŒ‰é’®å®Œæˆé¡¹ç›®åˆ›å»ºã€‚ æ·»åŠ  SSH Keyç‚¹å‡»â€Add an SSH keyâ€æŒ‰é’®ï¼Œå°†ç¬¬äºŒæ­¥ä¸­ç”Ÿæˆçš„å…¬é’¥ç²˜è´´åˆ°ç›¸åº”çš„é…ç½®æ¡†ä¸­ã€‚ å®Œæˆåï¼Œå°†çœ‹åˆ° SSH key å·²æˆåŠŸæ·»åŠ çš„æç¤ºä¿¡æ¯ã€‚ ä¿å­˜é¡¹ç›®åœ°å€é¡¹ç›®åœ°å€åœ¨è¿›è¡Œå…‹éš†æ“ä½œæ—¶éœ€è¦ç”¨åˆ°ï¼Œè¯·åŠ¡å¿…ä¿å­˜è¯¥åœ°å€ã€‚ 11. ç®€å•é…ç½® Git ç”¨æˆ·ä¿¡æ¯ä¸ºäº†åœ¨é¡¹ç›®ä¸­æ­£ç¡®è®°å½•æäº¤è€…ä¿¡æ¯ï¼Œéœ€è¦é…ç½® Git ç”¨æˆ·çš„å§“åå’Œç”µå­é‚®ä»¶åœ°å€ã€‚ git config --global user.name testname git config --global user.email abc@example.com 12. å…‹éš†é¡¹ç›®ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†åœ¨ GitLab ä¸Šåˆ›å»ºçš„é¡¹ç›®å…‹éš†åˆ°æœ¬åœ°ï¼š git clone git@iZ****3Z:root/test.git æ‰§è¡Œåï¼Œå°†åœ¨æœ¬åœ°ç”ŸæˆåŒåç›®å½•ï¼Œè¯¥ç›®å½•ä¸­ä¼šåŒ…å«é¡¹ç›®çš„æ‰€æœ‰æ–‡ä»¶ã€‚ 13. ä¸Šä¼ æ–‡ä»¶è¿›å…¥é¡¹ç›®ç›®å½•ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›å…¥åˆšå…‹éš†çš„é¡¹ç›®ç›®å½•ï¼š cd test/ åˆ›å»ºå¹¶ä¸Šä¼ æ–‡ä»¶åˆ›å»ºä¸€ä¸ªè¦ä¸Šä¼ åˆ° GitLab çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š echo test /root/test.sh å°†ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°é¡¹ç›®ç›®å½•ä¸‹ï¼š cp /root/test.sh ./ å°†æ–‡ä»¶åŠ å…¥ç‰ˆæœ¬æ§åˆ¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æ–°åˆ›å»ºçš„æ–‡ä»¶ test.sh æ·»åŠ åˆ° Git çš„æš‚å­˜åŒºï¼š git add test.sh æäº¤æ›´æ”¹æ‰§è¡Œæäº¤æ“ä½œï¼Œè®°å½•æ­¤æ¬¡æ›´æ”¹ï¼š git commit -m test.sh æ¨é€åˆ° GitLab æœåŠ¡å™¨å°†æœ¬åœ°æ›´æ”¹åŒæ­¥åˆ° GitLab æœåŠ¡å™¨ï¼š git push -u origin master 14. éªŒè¯æ–‡ä»¶åŒæ­¥åœ¨ç½‘é¡µä¸­æŸ¥çœ‹ï¼Œå°†çœ‹åˆ°ä¸Šä¼ çš„ test.sh æ–‡ä»¶å·²ç»æˆåŠŸåŒæ­¥åˆ° GitLab ä¸­ã€‚ç¡®è®¤åŒæ­¥æˆåŠŸçš„ç•Œé¢å¦‚ä¸‹ï¼š","categories":["6.å¼€å‘å·¥å…·","Git"]},{"title":"åœ¨ Git ä¸­å¿½ç•¥æ–‡ä»¶å’Œæ–‡ä»¶å¤¹","path":"/2023/10/05/6-å¼€å‘å·¥å…·-Git-åœ¨-Git-ä¸­å¿½ç•¥æ–‡ä»¶å’Œæ–‡ä»¶å¤¹/","content":"ä»€ä¹ˆæ˜¯ .gitignore æ–‡ä»¶.gitignore æ–‡ä»¶æ˜¯ä¸€ä¸ªç”¨äºå‘ŠçŸ¥ Git å“ªäº›æ–‡ä»¶å’Œç›®å½•ä¸åº”è¢«è¿½è¸ªçš„çº¯æ–‡æœ¬æ–‡ä»¶ã€‚å®ƒä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§ç®¡ç†å’Œç»´æŠ¤é¡¹ç›®ä¸­ä¸éœ€è¦ç‰ˆæœ¬æ§åˆ¶çš„æ–‡ä»¶çš„ç®€ä¾¿æ–¹æ³•ã€‚æ—¨åœ¨ä¼˜åŒ–ç‰ˆæœ¬æ§åˆ¶çš„æ•ˆç‡ï¼Œç¡®ä¿å…¶ä»–å¼€å‘è€…åœ¨ä½¿ç”¨ä»£ç åº“æ—¶ä¸å¿…å¤„ç†é‚£äº›ç‰¹å®šäºä¸ªäººç¯å¢ƒçš„æ–‡ä»¶ã€‚ Git æ–‡ä»¶çŠ¶æ€åœ¨ä»»ä½•å½“å‰å·¥ä½œçš„ Git ä»“åº“ä¸­ï¼Œæ–‡ä»¶çš„çŠ¶æ€å¯åˆ†ä¸ºä¸‰ç±»ï¼š è¿½è¸ªçš„ï¼ˆtrackedï¼‰: è¿™äº›æ˜¯ Git æ‰€çŸ¥é“çš„æ–‡ä»¶æˆ–ç›®å½•ï¼ŒåŒ…æ‹¬ç”¨ git add æ·»åŠ å’Œç”¨ git commit æäº¤åˆ°ä¸»ä»“åº“çš„æ–‡ä»¶ã€‚ æœªè¢«è¿½è¸ªçš„ï¼ˆuntrackedï¼‰: è¿™äº›æ–‡ä»¶æ˜¯åœ¨å·¥ä½œç›®å½•ä¸­åˆ›å»ºçš„ï¼Œä½†å°šæœªè¢« Git æš‚å­˜ï¼ˆæ²¡æœ‰ä½¿ç”¨ git add å‘½ä»¤ï¼‰ã€‚ è¢«å¿½ç•¥çš„ï¼ˆignoredï¼‰: è¿™äº›æ–‡ä»¶æ˜¯éœ€è¦ä» Git çš„å…³æ³¨ä¸­æ’é™¤çš„ï¼Œæ— è®ºå®ƒä»¬åœ¨å·¥ä½œç›®å½•ä¸­æ˜¯å¦å­˜åœ¨ã€‚ç®€å•æ¥è¯´ï¼Œè¢«å¿½ç•¥çš„æ–‡ä»¶ä¸ä¼šè¢«æäº¤åˆ°ç‰ˆæœ¬åº“ä¸­ã€‚ æ‰€æœ‰è¢«å¿½ç•¥çš„æ–‡ä»¶éƒ½ä¼šåˆ—åœ¨ .gitignore æ–‡ä»¶ä¸­ã€‚ å¦‚ä½•åˆ›å»ºä¸€ä¸ª .gitignore æ–‡ä»¶é€šå¸¸æƒ…å†µä¸‹ï¼Œ.gitignore æ–‡ä»¶ä½äºä»“åº“çš„æ ¹ç›®å½•ä¸‹ï¼Œä¹Ÿå°±æ˜¯åŒ…å«è¯¥é¡¹ç›®çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•çš„ä¸»ç›®å½•ã€‚å°½ç®¡æ¨èæ”¾åœ¨æ ¹ç›®å½•ï¼Œ.gitignore æ–‡ä»¶å¯ä»¥æ”¾åœ¨é¡¹ç›®ä¸­çš„ä»»ä½•å­æ–‡ä»¶å¤¹ä¸­ï¼Œç”šè‡³å¯ä»¥åœ¨åŒä¸€é¡¹ç›®ä¸­æœ‰å¤šä¸ª .gitignore æ–‡ä»¶ã€‚ åœ¨ç±» Unix ç³»ç»Ÿï¼ˆæ¯”å¦‚ macOS æˆ– Linuxï¼‰ä¸Šï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»º .gitignore æ–‡ä»¶ï¼š æ‰“å¼€ç»ˆç«¯ç¨‹åºã€‚ ä½¿ç”¨ cd å‘½ä»¤å¯¼èˆªåˆ°é¡¹ç›®çš„æ ¹ç›®å½•ã€‚ è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä»¥åˆ›å»º .gitignore æ–‡ä»¶ï¼š touch .gitignore æ³¨æ„ï¼Œä»»ä½•ä»¥ç‚¹ï¼ˆ.ï¼‰å¼€å¤´çš„æ–‡ä»¶åœ¨é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯éšè—çš„ã€‚åœ¨å‘½ä»¤è¡Œä¸­ï¼Œè¿è¡Œ ls å‘½ä»¤å°†çœ‹ä¸åˆ°è¿™äº›æ–‡ä»¶ã€‚è¦æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ï¼Œä½¿ç”¨ï¼š ls -a åœ¨ .gitignore æ–‡ä»¶ä¸­åº”è¯¥åŒ…æ‹¬ä»€ä¹ˆé€šè¿‡ .gitignore æ–‡ä»¶åº”å½“æ·»åŠ çš„æ–‡ä»¶ç±»å‹é€šå¸¸æ˜¯é‚£äº›ä¸éœ€è¦è¢«æäº¤çš„æ–‡ä»¶ï¼Œå…·ä½“åŒ…æ‹¬ä½†ä¸é™äºï¼š æ“ä½œç³»ç»Ÿç”Ÿæˆçš„æ–‡ä»¶: å„ç§æ“ä½œç³»ç»Ÿä¼šåˆ›å»ºç‰¹å®šçš„éšè—æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼ŒmacOS ä¸Šçš„ .DS_Store æ–‡ä»¶è®°å½•ç”¨æˆ·å¯¹æ–‡ä»¶å¤¹çš„å±•ç¤ºåå¥½ã€‚ IDE æˆ–ç¼–è¾‘å™¨ç”Ÿæˆçš„é…ç½®æ–‡ä»¶: è¿™äº›æ–‡ä»¶é€šå¸¸é€‚åº”ä¸ªäººç”¨æˆ·çš„é…ç½®ã€‚æ¯”å¦‚ï¼ŒVS Code ä¼šç”Ÿæˆ .vscode æ–‡ä»¶å¤¹ç”¨äºå­˜å‚¨ç”¨äºç‰¹å®šé¡¹ç›®çš„é…ç½®ä¿¡æ¯ã€‚ ç¼–ç¨‹è¯­è¨€æˆ–æ¡†æ¶ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶: å¦‚ .o æ–‡ä»¶ï¼Œé€šå¸¸æ˜¯ç¼–è¯‘ç”Ÿæˆçš„ï¼Œä¸éœ€è¢«ç‰ˆæœ¬æ§åˆ¶ã€‚ è½¯ä»¶åŒ…ç®¡ç†å™¨ç”Ÿæˆçš„æ–‡ä»¶å¤¹: ä¾‹å¦‚ï¼Œä½¿ç”¨ npm æ—¶ä¼šåœ¨é¡¹ç›®ä¸­åˆ›å»º node_modules æ–‡ä»¶å¤¹ï¼Œé‡Œé¢åŒ…å«æ‰€æœ‰ä¾èµ–çš„å°è£…åº“ã€‚ æ•æ„Ÿä¿¡æ¯çš„å­˜å‚¨æ–‡ä»¶: æœ¬åœ°é¡¹ç›®ä¸­å¯èƒ½å­˜åœ¨åŒ…å«å‡­è¯çš„æ–‡ä»¶ï¼Œå¦‚ .env æ–‡ä»¶ï¼Œå®ƒä»¬åŒ…å«éœ€è¦ä¿å¯†çš„ API å¯†é’¥å’Œç¯å¢ƒå˜é‡ã€‚ è¿è¡Œæ—¥å¿—æ–‡ä»¶: æ¯”å¦‚ .log æ–‡ä»¶ï¼Œèƒ½å¤Ÿæä¾›ç³»ç»Ÿæ“ä½œçš„å†å²åŠé”™è¯¯è®°å½•ï¼Œä½†å¯¹äºç‰ˆæœ¬æ§åˆ¶è€Œè¨€å¹¶æ— ä»·å€¼ã€‚ å¦‚ä½•åœ¨ Git ä¸­å¿½ç•¥æ–‡ä»¶å’Œæ–‡ä»¶å¤¹è¦åœ¨ .gitignore æ–‡ä»¶ä¸­å¿½ç•¥ç‰¹å®šæ–‡ä»¶ï¼Œåªéœ€æä¾›æ–‡ä»¶åœ¨é¡¹ç›®ä¸­çš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œè¦å¿½ç•¥æ ¹ç›®å½•ä¸‹çš„ text.txt æ–‡ä»¶ï¼Œå¯ä»¥åœ¨ .gitignore æ–‡ä»¶ä¸­å†™å…¥ï¼š /text.txt å¦‚æœè¦å¿½ç•¥æ ¹ç›®å½•ä¸‹çš„ test ç›®å½•ä¸­çš„ text.txt æ–‡ä»¶ï¼Œå¯ä»¥å†™æˆï¼š /test/text.txt æˆ–è€…ç®€åŒ–ä¸ºï¼š test/text.txt è‹¥è¦å¿½ç•¥é¡¹ç›®ä¸­çš„æ‰€æœ‰åŒåæ–‡ä»¶ï¼Œåªéœ€å†™å…¥æ–‡ä»¶åï¼š text.txt å¦‚æ­¤ï¼Œæ‰€æœ‰ä½ç½®çš„ text.txt æ–‡ä»¶éƒ½ä¼šè¢«å¿½ç•¥ã€‚ åœ¨è¦å¿½ç•¥æ•´ä¸ªç›®å½•åŠå…¶å†…å®¹æ—¶ï¼Œéœ€åœ¨ç›®å½•åç§°æœ«å°¾åŠ ä¸Šæ–œæ ï¼š test/ è¿™æ ·ï¼Œåä¸º test çš„ç›®å½•ä»¥åŠå…¶å†…éƒ¨çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•éƒ½ä¼šè¢«å¿½ç•¥ã€‚ ä½¿ç”¨é€šé…ç¬¦è¿›è¡Œå¿½ç•¥è®¾ç½®è‹¥éœ€å¿½ç•¥æ‰€æœ‰ä»¥ç‰¹å®šå­—è¯å¼€å¤´çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ *ã€‚ä¾‹å¦‚ï¼Œè¦å¿½ç•¥æ‰€æœ‰ä»¥ img å¼€å¤´çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œä½¿ç”¨ï¼š img* è¦å¿½ç•¥æ‰€æœ‰ä»¥ .md ç»“å°¾çš„ Markdown æ–‡ä»¶ï¼Œå¯ä»¥å†™ï¼š *.md è¿™ä¼šåŒ¹é…é¡¹ç›®ä¸­æ‰€æœ‰æ‰©å±•åä¸º .md çš„æ–‡ä»¶ã€‚ å¦‚ä½•å¿½ç•¥å…ˆå‰å·²æäº¤çš„æ–‡ä»¶ä¸€æ—¦æ–‡ä»¶è¢«æäº¤åˆ° Git ä»“åº“ä¸­ï¼Œå¦‚æœéœ€è¦å¿½ç•¥å®ƒï¼Œé¦–å…ˆéœ€è¦ç¡®ä¿è¯¥æ–‡ä»¶å·²è¢«æ·»åŠ åˆ° .gitignore æ–‡ä»¶ä¸­ã€‚ç¤ºä¾‹ï¼šå¦‚æœéœ€è¦å¿½ç•¥åä¸º .env çš„æ–‡ä»¶ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š å°† .env æ·»åŠ åˆ° .gitignore: echo .env .gitignore é€šè¿‡ä»¥ä¸‹å‘½ä»¤å‘ŠçŸ¥ Git ä¸å†è¿½è¸ª .env æ–‡ä»¶ï¼Œä¸”ä»ç´¢å¼•ä¸­å°†å…¶åˆ é™¤ï¼š git rm --cached .env æ­¤å‘½ä»¤ä¼šä½¿ .env æ–‡ä»¶ä» Git ç‰ˆæœ¬æ§åˆ¶ä¸­ç§»é™¤ï¼Œä½†ä¾ç„¶ä¿ç•™åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚ æœ€åï¼Œæ·»åŠ å¹¶æäº¤ .gitignore æ›´æ–°ï¼š git add .gitignoregit commit -m æ›´æ–°å¿½ç•¥çš„æ–‡ä»¶ é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼ŒåŸæœ¬å·²æäº¤çš„æ–‡ä»¶ä¾¿å¯ä»ç‰ˆæœ¬æ§åˆ¶ä¸­ç§»é™¤ï¼Œå¹¶è¢«é¡ºåˆ©å¿½ç•¥ã€‚","categories":["6.å¼€å‘å·¥å…·","Git"]},{"title":"ç‰ˆæœ¬æ§åˆ¶æ–¹æ¡ˆ","path":"/2023/10/04/6-å¼€å‘å·¥å…·-Git-ç‰ˆæœ¬æ§åˆ¶æ–¹æ¡ˆ/","content":"Git æ–¹æ¡ˆ1. ä»“åº“åˆ›å»º ä»“åº“åˆ›å»ºåŸºäºå½“å‰çš„é¡¹ç›®ï¼Œä¾‹å¦‚å¤‡ä»½ä»ªè¡¨é¡¹ç›®ä»“åº“ï¼ŒLSA é¡¹ç›®ç­‰ 2. åˆ†æ”¯åˆ›å»º é¡¹ç›®ä¸»åˆ†æ”¯ä¿å­˜é¡¹ç›®ä»£ç åŠæ–‡æ¡£ï¼Œè´Ÿè´£å‘å¸ƒä»£ç  é¡¹ç›®å¼€å‘åˆ†æ”¯ä¿å­˜é¡¹ç›®æºç ï¼Œåˆ†æ”¯ä»…ç®¡ç†å‘˜å¯è§ é¡¹ç›®è¿è¡Œåˆ†æ”¯ä¿å­˜é¡¹ç›®å¤´æ–‡ä»¶åŠåº“æ–‡ä»¶ä»£ç ï¼Œåˆ†æ”¯æ‰€æœ‰äººå¯è§ é¡¹ç›®äººå‘˜å¼€å‘åˆ†æ”¯åŸºäºè¿è¡Œåˆ†æ”¯åˆ›å»ºï¼Œä»…è¯¥äººå‘˜æœ‰æƒé™ï¼Œè¯¥äººå‘˜å¼€å‘ä»»åŠ¡åŸºäºè¯¥åˆ†æ”¯è¿›è¡Œä¿®æ”¹ä»£ç  3. ä»£ç æäº¤ å„äººå‘˜ä»£ç ä»…æäº¤åœ¨å•ç‹¬åˆ†æ”¯ï¼Œæäº¤å®Œæˆåï¼Œç”±ç®¡ç†å‘˜å®¡æ ¸åï¼ŒåŒæ­¥æºä»£ç è‡³å¼€å‘åˆ†æ”¯ 4. ç‰ˆæœ¬å›é€€ SVN æ–¹æ¡ˆ","categories":["6.å¼€å‘å·¥å…·","Git"]},{"title":"è§å…‰å®šé‡ PCRä¸­åŸºçº¿ã€é˜ˆå€¼ã€ Ct å€¼","path":"/2023/10/03/5-åµŒå…¥å¼å¼€å‘-ç¡¬ä»¶çŸ¥è¯†-è§å…‰å®šé‡-PCRä¸­åŸºçº¿ã€é˜ˆå€¼ã€-Ct-å€¼/","content":"åŸºçº¿ (Baseline)åŸºçº¿æŒ‡çš„æ˜¯åœ¨ PCRï¼ˆèšåˆé…¶é“¾å¼ååº”ï¼‰æ‰©å¢ååº”çš„åˆå§‹å‡ ä¸ªå¾ªç¯ä¸­ï¼Œè§å…‰ä¿¡å·çš„å˜åŒ–æå°ï¼ŒåŸºæœ¬ä¿æŒåœ¨ä¸€ä¸ªç¨³å®šçš„æ°´å¹³ã€‚è¿™ä¸€æ®µçš„è§å…‰ä¿¡å·è¡¨ç°ä¸ºæ¥è¿‘ä¸€æ¡ç›´çº¿ï¼Œè¿™æ ·çš„ç›´çº¿ç§°ä¸ºåŸºçº¿ã€‚é€šå¸¸ï¼Œè¿™ä¸ªåŸºçº¿åŒºåŸŸæ˜¾ç¤ºäº†èƒŒæ™¯è§å…‰ä¿¡å·ï¼Œå¯¹åç»­çš„æ•°æ®åˆ†æè‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒå¸®åŠ©ç¡®å®šçœŸå®çš„æ‰©å¢ä¿¡å·ä½•æ—¶å¼€å§‹è¶…å‡ºèƒŒæ™¯å™ªå£°çš„æ°´å¹³ã€‚ é˜ˆå€¼çº¿ (Threshold)åœ¨ PCR ååº”çš„å‰ 15 ä¸ªå¾ªç¯ä¸­æ‰€è·å¾—çš„è§å…‰ä¿¡å·é€šå¸¸è¢«è§†ä¸ºè§å…‰çš„æœ¬åº•ä¿¡å·ã€‚ä¸ºäº†ä¾¿äºåç»­åˆ†æï¼Œè®¸å¤šå®éªŒå®¤ä¼šå°†è§å…‰é˜ˆå€¼è®¾å®šä¸º PCR 3â€”15 ä¸ªå¾ªç¯è§å…‰ä¿¡å·æ ‡å‡†å·®çš„ 10 å€ã€‚è¿™ä¸ªé˜ˆå€¼çº¿é€šå¸¸æ˜¯åœ¨ PCR æ‰©å¢çš„æŒ‡æ•°æœŸå†…è®¾å®šçš„ã€‚ ä¸åŒå‚å®¶ä¼šé‡‡ç”¨ä¸åŒçš„ç®—æ³•è®¾å®šé˜ˆå€¼ï¼š ç½—æ°çš„ç®—æ³•ï¼šä¸€èˆ¬é€‰æ‹© 3-12 ä¸ªå¾ªç¯ï¼ˆå¯è°ƒï¼Œçµæ´»å˜åŒ–ï¼‰ï¼Œä»¥åŸºçº¿çš„ 10 å€æ ‡å‡†å·®ä¸ºä¾æ®ã€‚ å¤§å¤šæ•°å…¶ä»–å‚å®¶çš„åšæ³•ï¼šåŒæ ·é€‰æ‹© 3-12 ä¸ªå¾ªç¯ï¼Œè®¾å®šä¸ºåŸºçº¿å¹³å‡å€¼çš„ 1.05-1.1 å€ï¼Œæ—¨åœ¨æ›´å¥½åœ°åæ˜ å®æ—¶è§å…‰ä¿¡å·çš„å˜åŒ–ã€‚ CT å€¼CT å€¼ï¼Œå³å¾ªç¯é˜ˆå€¼ï¼Œåœ¨è§å…‰æ›²çº¿ä¸é˜ˆå€¼çº¿çš„äº¤ç‚¹ä½ç½®å¯¹åº”çš„å¾ªç¯æ•°ã€‚è¿™ä¸ªå€¼åæ˜ äº†æ¯ä¸ª PCR ååº”ç®¡å†…æ‰€éœ€çš„æ‰©å¢å¾ªç¯æ•°ï¼Œä»¥è¾¾åˆ°è®¾å®šçš„è§å…‰åŸŸå€¼ã€‚ç ”ç©¶æ˜¾ç¤ºï¼Œå„æ¨¡æ¿çš„ CT å€¼ä¸å…¶èµ·å§‹æ‹·è´æ•°çš„å¯¹æ•°ä¹‹é—´å­˜åœ¨çº¿æ€§å…³ç³»ï¼šèµ·å§‹æ‹·è´æ•°è¶Šé«˜ï¼ŒCT å€¼è¶Šå°ï¼Œåä¹‹äº¦ç„¶ã€‚é€šè¿‡ä½¿ç”¨å·²çŸ¥èµ·å§‹æ‹·è´æ•°çš„æ ‡å‡†å“ï¼Œå¯ä»¥ç»˜åˆ¶å‡ºä¸€æ¡æ ‡å‡†æ›²çº¿ã€‚åœ¨è¿™æ¡æ›²çº¿ä¸Šï¼Œæ¨ªåæ ‡æ˜¯èµ·å§‹æ‹·è´æ•°çš„å¯¹æ•°ï¼Œçºµåæ ‡æ˜¯ CT å€¼ã€‚åªéœ€è·å¾—æœªçŸ¥æ ·å“çš„ CT å€¼ï¼Œå°±å¯ä»¥ä»æ ‡å‡†æ›²çº¿ä¸Šå¾—åˆ°è¯¥æ ·å“çš„èµ·å§‹æ‹·è´æ•°ã€‚ å½’ä¸€æ•°æ®çš„å½’ä¸€åŒ–æ˜¯è¿‡ç¨‹ä¸­çš„å¦ä¸€é‡è¦æ­¥éª¤ï¼ŒåŒ…å«ä¸¤ä¸ªä¸»è¦æ–¹æ³•ï¼š è§å…‰æ›²çº¿å‡å»åŸºçº¿å¹³å‡å€¼ï¼šè¿™ä¸€æ“ä½œå¯ä»¥å»é™¤èƒŒæ™¯ä¿¡å·çš„å½±å“ï¼Œå¢å¼ºä¿¡å·çš„å¯¹æ¯”åº¦ã€‚ è§å…‰æ›²çº¿é™¤ä»¥æœ€å¤§å€¼ï¼ˆæˆ–å¹³å°æœŸçš„å¹³å‡å€¼ï¼‰ï¼šè¿™ä¸€æ–¹æ³•æœ‰åŠ©äºæ ‡å‡†åŒ–ä¿¡å·å¼ºåº¦ï¼Œä½¿å¾—ä¸åŒæ ·æœ¬æ•°æ®ä¹‹é—´å¯æ¯”è¾ƒã€‚ æ‰©å¢æ›²çº¿åœ¨ PCR è¿‡ç¨‹ä¸­ï¼Œä»¥å¾ªç¯æ•°ä¸ºæ¨ªåæ ‡ï¼Œå®æ—¶è§å…‰å¼ºåº¦ä¸ºçºµåæ ‡æ‰€ç»˜åˆ¶çš„æ›²çº¿ç§°ä¸ºæ‰©å¢æ›²çº¿ã€‚è¯„ä¼°æ‰©å¢æ›²çº¿æ˜¯å¦è‰¯å¥½çš„æŒ‡æ ‡ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š æ›²çº¿æ‹ç‚¹æ¸…æ¥šï¼šå°¤å…¶åœ¨ä½æµ“åº¦æ ·æœ¬çš„æŒ‡æ•°æœŸï¼Œåº”è¡¨ç°æ˜æ˜¾ã€‚è‰¯å¥½çš„æ‰©å¢æ›²çº¿åœ¨åŸºçº¿åŒºåŸŸå¹³å¦ï¼Œæ— æ˜æ˜¾ä¸Šæ‰¬ç°è±¡ï¼Œç¡®ä¿ä½æµ“åº¦æ ·æœ¬çš„æŒ‡æ•°æœŸå‡¸æ˜¾ã€‚ æ›²çº¿æŒ‡æ•°æœŸæ–œç‡ä¸æ‰©å¢æ•ˆç‡æˆæ­£æ¯”ï¼šæ–œç‡è¶Šå¤§ï¼Œæ‰©å¢æ•ˆç‡è¶Šé«˜ï¼Œæ„å‘³ç€æ ·æœ¬ä¸­çš„ç›®æ ‡åºåˆ—è¢«å¿«é€Ÿä¸”æœ‰æ•ˆåœ°äº§ç”Ÿã€‚ æ ‡å‡†çš„åŸºçº¿åº”ä¿æŒå¹³ç›´æˆ–ç•¥å¾®ä¸‹é™ï¼šæ— æ˜æ˜¾çš„ä¸Šæ‰¬è¶‹åŠ¿ï¼Œè¡¨ç¤ºååº”è¿‡ç¨‹ç¨³å®šä¸”æ²¡æœ‰å¹²æ‰°ã€‚ å„ç®¡çš„æ‰©å¢æ›²çº¿å¹³è¡Œæ€§å¥½ï¼šè¡¨æ˜å„ååº”ç®¡çš„æ‰©å¢æ•ˆç‡ç›¸è¿‘ï¼Œæœ‰åŠ©äºè·å¾—å¯é çš„ä¸€è‡´æ€§ç»“æœã€‚ ç†”è§£æ›²çº¿ (-RFUdT)ç†”è§£æ›²çº¿åˆ†ææ˜¯åœ¨å¯¹ PCR äº§ç‰©è¿›è¡ŒåŠ çƒ­æ—¶ï¼Œéšç€æ¸©åº¦å‡é«˜ï¼ŒåŒé“¾æ‰©å¢äº§ç‰©é€æ¸è§£é“¾ï¼Œä»è€Œå¯¼è‡´è§å…‰å¼ºåº¦ä¸‹é™çš„è¿‡ç¨‹ã€‚åœ¨è¾¾åˆ°æŸä¸€ç‰¹å®šæ¸©åº¦æ—¶ï¼Œå¤§é‡çš„äº§ç‰©ä¼šå¿«é€Ÿè§£é“¾ï¼Œè§å…‰ä¿¡å·å°†æ€¥å‰§ä¸‹é™ã€‚ä¸åŒ PCR äº§ç‰©çš„ Tmï¼ˆç†”åŒ–æ¸©åº¦ï¼‰ä¸åŒï¼Œå› æ­¤ä¸åŒäº§ç‰©çš„è§å…‰ä¿¡å·å‘ç”Ÿè¿…é€Ÿä¸‹é™çš„æ¸©åº¦ä¹Ÿä¼šæœ‰æ‰€ä¸åŒã€‚é€šè¿‡ç†”è§£æ›²çº¿ï¼Œå¯ä»¥æœ‰æ•ˆé‰´å®š PCR äº§å“çš„ç‰¹å¼‚æ€§ï¼Œç¡®è®¤æ‰©å¢çš„ç»“æœæ˜¯å¦å¯é ã€‚ æ‹·è´æ•°æ‹·è´æ•°ç”¨å•ä½ copiesml è¡¨ç¤ºï¼Œå¸¸ç”¨äºç”ŸåŒ–æ£€æµ‹ä¸­æ£€æŸ¥ DNA å¤åˆ¶çŠ¶å†µã€‚è¿™é‡Œï¼š copies æ˜¯ copy çš„å¤æ•°å½¢å¼ï¼Œè¡¨ç¤ºä»åŸå§‹ DNA å¤åˆ¶å‡ºæ–° DNA çš„ä¸ªä½“å‰¯æœ¬ã€‚ ml åˆ™æ˜¯æ¯æ¯«å‡çš„åº¦é‡ã€‚ ç»“åˆèµ·æ¥ï¼Œcopiesml è¡¨ç¤ºæ¯æ¯«å‡å¾…æµ‹æ ·æœ¬ä¸­ DNA çš„å¤åˆ¶æ•°é‡ï¼Œè¿™ä¸€å‚æ•°å¯¹äºè¯„ä¼°æ ·æœ¬ä¸­çš„ DNA å«é‡å’Œæ‰©å¢æ•ˆç‡è‡³å…³é‡è¦ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","ç¡¬ä»¶çŸ¥è¯†"]},{"title":"vimå®‰è£…","path":"/2023/10/02/6-å¼€å‘å·¥å…·-æ•ˆç‡å·¥å…·-VIM-vimå®‰è£…/","content":"é…ç½®æ–‡ä»¶ åœ°å€ 1. å®‰è£…ç¯å¢ƒsudo apt install git cscopewget -qO - https://raw.github.com/ma6174/vim/master/setup.sh | sh -x wget æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸“é—¨ç”¨äºä»äº’è”ç½‘ä¸‹è½½æ–‡ä»¶ã€‚å®ƒçš„çµæ´»æ€§å’Œå¯é…ç½®æ€§ä½¿å…¶æˆä¸ºå¼€å‘è€…å’Œç³»ç»Ÿç®¡ç†å‘˜çš„é¦–é€‰å·¥å…·ã€‚ å‚æ•° -q è¡¨ç¤ºä¸‹è½½æ—¶ä»¥é™é»˜æ¨¡å¼è¿è¡Œï¼Œè¿™æ ·æ—¢å¯ä»¥é¿å…æ˜¾ç¤ºè¿›åº¦æ¡ï¼Œä¹Ÿä¸ä¼šå¹²æ‰°æ ‡å‡†è¾“å‡ºï¼Œä¿æŒç»ˆç«¯çš„æ•´æ´ã€‚ -O - æŒ‡å®šå°†ä¸‹è½½çš„æ–‡ä»¶ç›´æ¥è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼ˆé€šå¸¸æ˜¯ç»ˆç«¯ï¼‰ï¼Œè¿™æ ·ç”¨æˆ·å¯ä»¥ç¬¬ä¸€æ—¶é—´çœ‹åˆ°è„šæœ¬çš„æ‰§è¡Œç»“æœï¼Œè€Œæ— éœ€åœ¨æœ¬åœ°ä¿å­˜è¯¥æ–‡ä»¶ã€‚ URL åœ°å€ https://raw.github.com/ma6174/vim/master/setup.sh æŒ‡å‘ä¸€ä¸ªåœ¨ GitHub ä¸Šæ‰˜ç®¡çš„ Shell è„šæœ¬ï¼Œå®ƒè´Ÿè´£è®¾ç½® Vim çš„å®‰è£…å’Œé…ç½®ã€‚ | æ˜¯ç®¡é“ç¬¦å·ï¼Œå®ƒå°†å‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºç›´æ¥ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå‘½ä»¤ï¼Œå…è®¸ç”¨æˆ·åœ¨ä¸€æ¡å‘½ä»¤ä¸­é“¾å¼è°ƒç”¨å¤šä¸ªæ“ä½œã€‚ sh ç”¨æ¥æ‰§è¡Œ Shell è„šæœ¬çš„å‘½ä»¤ï¼Œå°†ä¸‹è½½åçš„è„šæœ¬å†…å®¹æ‰§è¡Œã€‚ -x åˆ™åœ¨æ‰§è¡Œè„šæœ¬æ—¶æä¾›è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œè¿™å¯¹æ’æŸ¥æ½œåœ¨é—®é¢˜éå¸¸æœ‰å¸®åŠ©ã€‚ setup.sh å†…å®¹è§£æ#!/bin/bashecho å®‰è£…å°†èŠ±è´¹ä¸€å®šæ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…ç›´åˆ°å®‰è£…å®Œæˆ~~if which apt-get /dev/null; then sudo apt-get install -y vim vim-gnome ctags xclip astyle python-setuptools python-dev gitelif which yum /dev/null; then sudo yum install -y gcc vim git ctags xclip astyle python-setuptools python-develfi## Add HomeBrew support on Mac OSif which brew /dev/null;then echo You are using HomeBrew tool brew install vim ctags git astylefisudo easy_install -ZU autopep8sudo ln -s /usr/bin/ctags /usr/local/bin/ctagsmv -f ~/vim ~/vim oldcd ~/ git clone https://github.com/ma6174/vim.gitmv -f ~/.vim ~/.vim_old mv -f ~/vim ~/.vimmv -f ~/.vimrc ~/.vimrc_oldmv -f ~/.vim/.vimrc ~/ git clone https://github.com/gmarik/vundle.git ~/.vim/bundle/vundleecho ma6174æ­£åœ¨åŠªåŠ›ä¸ºå®‰è£…bundleç¨‹åº ma6174echo å®‰è£…å®Œæ¯•å°†è‡ªåŠ¨é€€å‡º ma6174echo è¯·è€å¿ƒç­‰å¾… ma6174vim ma6174 -c BundleInstall -c q -c qrm ma6174echo å®‰è£…å®Œæˆ è¿™æ®µè„šæœ¬çš„ç›®çš„æ˜¯æ–¹ä¾¿ç”¨æˆ·å¿«é€Ÿå®‰è£… Vim åŠå…¶ä¾èµ–ã€‚é¦–å…ˆï¼Œå®ƒé€šè¿‡æ£€æµ‹ç³»ç»ŸåŒ…ç®¡ç†å™¨ï¼ˆapt-get æˆ– yumï¼‰æ¥å®‰è£…å¿…è¦çš„è½¯ä»¶åŒ…ã€‚è¿™æ ·çš„è®¾è®¡ä¿è¯äº†åœ¨ä¸åŒ Linux å‘è¡Œç‰ˆä¸Šçš„å…¼å®¹æ€§ã€‚å®ƒè¿˜ä¸º Mac ç”¨æˆ·æä¾›é€šè¿‡ HomeBrew å®‰è£…çš„é€‰é¡¹ã€‚ å…·ä½“æ­¥éª¤ï¼š å®‰è£… Vim å’Œå…¶ä»–å·¥å…·ï¼šæ ¹æ®ç³»ç»Ÿç±»å‹ï¼Œè„šæœ¬ä¼šå®‰è£… Vimã€ctagsã€xclip ç­‰åŒ…ï¼Œä½¿ç”¨æˆ·å¯ä»¥ç¼–è¾‘ä»£ç ã€ç”Ÿæˆæ ‡ç­¾ç­‰ã€‚ **è‡ªåŠ¨å®‰è£… autopep8**ï¼šè¿™æ˜¯ä¸€ä¸ªæ ¼å¼åŒ– Python ä»£ç çš„å·¥å…·ï¼Œé€šè¿‡ç®€å•çš„å‘½ä»¤è¡Œå¯ä»¥ä¿æŒä»£ç é£æ ¼çš„ç»Ÿä¸€ã€‚ å…‹éš†é…ç½®åº“ï¼šä» GitHub å…‹éš†è‡ªå®šä¹‰çš„ Vim é…ç½®ï¼Œç¡®ä¿ç”¨æˆ·èƒ½æ”¶åˆ°æœ€æ–°çš„é…ç½®ä¸åŠŸèƒ½ã€‚ 2. é…ç½®cd /usr/includesudo ctags -Rcd -vim .vimrc åœ¨é…ç½® Vim çš„è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·é¦–å…ˆåˆ‡æ¢åˆ° /usr/include ç›®å½•ï¼Œæ‰§è¡Œ sudo ctags -R å‘½ä»¤ï¼Œç”Ÿæˆæ•´ä¸ªç›®å½•ä¸‹æ–‡ä»¶çš„æ ‡ç­¾ã€‚è¿™ä¸€æ“ä½œå°†å¸®åŠ© Vim å®ç°é«˜æ•ˆçš„ä»£ç è·³è½¬å’Œè‡ªåŠ¨è¡¥å…¨ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚ æ¥ä¸‹æ¥ï¼Œç”¨æˆ·éœ€è¦ç¼–è¾‘ .vimrc é…ç½®æ–‡ä»¶ï¼š set tags=/usr/include/tags æ­¤è¡Œé…ç½®æŒ‡æ˜äº† Vim ä½¿ç”¨ /usr/include ç›®å½•ä¸‹çš„æ ‡ç­¾æ–‡ä»¶ï¼Œä»¥åŠ é€Ÿä»£ç å¯¼èˆªã€‚ 3. å®‰è£… zshZshï¼ˆZ Shellï¼‰æ˜¯ä¸€ç§çµæ´»ä¸”åŠŸèƒ½ä¸°å¯Œçš„å‘½ä»¤è¡Œ Shellï¼Œç›¸å¯¹äºé»˜è®¤çš„ Bashï¼Œå®ƒæä¾›äº†è®¸å¤šä¾¿åˆ©çš„ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼ŒZsh æœ‰å‡ºè‰²çš„è‡ªåŠ¨è¡¥å…¨æœºåˆ¶ï¼Œå¯ä»¥æ ¹æ®è¾“å…¥çš„éƒ¨åˆ†å‘½ä»¤æ¨æµ‹ç”¨æˆ·çš„æ„å›¾ï¼›åŒæ—¶ï¼Œå®ƒçš„å†å²è®°å½•ç®¡ç†ä¹Ÿåšå¾—éå¸¸å‡ºè‰²ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°è¿‡å»æ‰§è¡Œçš„å‘½ä»¤ã€‚ å®‰è£…ä¸è®¾ç½® Zshç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£… Zshï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºé»˜è®¤ Shellï¼š sudo apt install zshchsh -s /bin/zsh sudo apt install zsh å®‰è£… Zsh å‘½ä»¤è¡Œå·¥å…·ã€‚ chsh -s /bin/zsh æ›´æ”¹å½“å‰ç”¨æˆ·çš„é»˜è®¤ Shell ä¸º Zshï¼Œä»æ­¤å¼€å§‹ä½¿ç”¨æ›´åŠ å¼ºå¤§çš„å‘½ä»¤è¡Œä½“éªŒã€‚ç”¨æˆ·åœ¨ä¸‹æ¬¡ç™»å½•åå°±ä¼šçœ‹åˆ° Zsh çš„ç•Œé¢ã€‚","categories":["6.å¼€å‘å·¥å…·","æ•ˆç‡å·¥å…·","VIM"]},{"title":"MySQLä½¿ç”¨","path":"/2023/09/19/6-å¼€å‘å·¥å…·-æ•°æ®åº“-MySQLä½¿ç”¨/","content":"MySQL ç®€ä»‹1. ä»€ä¹ˆæ˜¯æ•°æ®åº“ï¼Ÿæ•°æ®åº“ï¼ˆDatabaseï¼‰æ˜¯ä¸€ä¸ªæŒ‰ç…§æ•°æ®ç»“æ„æ¥ç»„ç»‡ã€å­˜å‚¨å’Œç®¡ç†æ•°æ®çš„ä»“åº“ã€‚è¿™ä¸ªæ¦‚å¿µé¦–æ¬¡å‡ºç°äºå…­åå¤šå¹´å‰ï¼Œéšç€ä¿¡æ¯æŠ€æœ¯å’Œå¸‚åœºçš„å‘å±•ï¼Œç‰¹åˆ«æ˜¯åœ¨äºŒåä¸–çºªä¹åå¹´ä»£åï¼Œæ•°æ®ç®¡ç†çš„éœ€æ±‚é€æ¸æ¼”å˜ï¼Œä¸å†ä»…ä»…æ˜¯å­˜å‚¨å’Œç®¡ç†æ•°æ®ï¼Œè€Œæ˜¯å½¢æˆäº†å¤šæ ·åŒ–çš„ç”¨æˆ·æ‰€éœ€çš„æ•°æ®ç®¡ç†æ–¹å¼ã€‚ç›®å‰ï¼Œæ•°æ®åº“ä¸ä»…åŒ…æ‹¬ç®€å•å­˜å‚¨æ•°æ®çš„è¡¨æ ¼ï¼Œè¿˜æ¶µç›–äº†èƒ½å¤Ÿè¿›è¡Œæµ·é‡æ•°æ®å­˜å‚¨åŠå¤„ç†çš„å¤§å‹æ•°æ®åº“ç³»ç»Ÿï¼Œå¹¿æ³›åº”ç”¨äºå„ä¸ªé¢†åŸŸã€‚ ä¸»æµçš„æ•°æ®åº“ç³»ç»ŸåŒ…æ‹¬ï¼šSQL Serverã€MySQLã€Oracleã€SQLiteã€Accessã€MS SQL Server ç­‰ã€‚æœ¬æ–‡å°†é‡ç‚¹è®¨è®º MySQLã€‚ 2. æ•°æ®åº“ç®¡ç†æ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿæ•°æ®åº“ç®¡ç†çš„åŠŸèƒ½ä¸»è¦åŒ…æ‹¬ï¼š å°†æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶æˆ–å†…å­˜ã€‚ æ¥æ”¶ç‰¹å®šçš„å‘½ä»¤ï¼Œå¹¶å¯¹æ–‡ä»¶è¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œä¾‹å¦‚å¢ã€åˆ ã€æ”¹ã€æŸ¥ï¼ˆCRUDï¼‰ã€‚ é€šè¿‡ä½¿ç”¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼ŒDatabase Management Systemï¼‰ï¼Œç”¨æˆ·æ— éœ€å†æ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œå¯ä»¥é€šè¿‡ç›´æ¥ä¼ é€’å‘½ä»¤ï¼Œè®©è½¯ä»¶ä»£ä¸ºè¿›è¡Œæ–‡ä»¶æ“ä½œã€‚ MySQL å®‰è£…MySQL æ˜¯å¼€æ”¾æºä»£ç çš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆRDBMSï¼‰ï¼Œä½¿ç”¨ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼ˆSQLï¼‰è¿›è¡Œæ•°æ®åº“ç®¡ç†ã€‚ä½œä¸º WEB åº”ç”¨ç¯å¢ƒä¸­å¸¸ç”¨çš„ RDBMS ä¹‹ä¸€ï¼ŒMySQL ä»¥å…¶é«˜æ•ˆã€çµæ´»è€Œè¢«å¹¿æ³›åº”ç”¨ã€‚ ä½¿ç”¨ MySQL çš„åŸºæœ¬æ¡ä»¶ å®‰è£… MySQL æœåŠ¡ç«¯ã€‚ å®‰è£… MySQL å®¢æˆ·ç«¯ã€‚ å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯ã€‚ å®¢æˆ·ç«¯å‘é€å‘½ä»¤ï¼ŒæœåŠ¡ç«¯æ¥æ”¶å¹¶æ‰§è¡Œç›¸åº”æ“ä½œï¼ˆå¦‚å¢ã€åˆ ã€æ”¹ã€æŸ¥ç­‰ï¼‰ã€‚ ä¸‹è½½åœ°å€ï¼šMySQL ä¸‹è½½é¡µé¢ å®‰è£…æŒ‡å—ï¼š Windows å®‰è£…è¯·å‚è€ƒï¼šåšå®¢ Linux å®‰è£…è¯·å‚è€ƒï¼šåšå®¢ ä¸Šè¿°é“¾æ¥ä¸­æä¾›äº†å®Œæ•´çš„å®‰è£…æ­¥éª¤ï¼Œå®‰è£…å®Œæˆåï¼Œå¯é€šè¿‡å‘½ä»¤ mysql.server start å¯åŠ¨ MySQL æœåŠ¡ã€‚ MySQL æ“ä½œä¸€ã€è¿æ¥æ•°æ®åº“é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿æ¥åˆ°æ•°æ®åº“ï¼š mysql -u ç”¨æˆ·å -p ä¾‹å¦‚ï¼š mysql -u root -p å¸¸è§é”™è¯¯ï¼š ERROR 2002 (HY000): Cant connect to local MySQL server through socket /tmp/mysql.sock (2) è¯¥é”™è¯¯è¡¨æ˜ MySQL æœåŠ¡å™¨å®ˆæŠ¤è¿›ç¨‹ï¼ˆUnixï¼‰æˆ–æœåŠ¡ï¼ˆWindowsï¼‰æœªè¿è¡Œã€‚ é€€å‡ºè¿æ¥ï¼šé€šè¿‡è¾“å…¥ QUIT æˆ–æŒ‰ Ctrl+D é€€å‡ºè¿æ¥ã€‚ äºŒã€æŸ¥çœ‹æ•°æ®åº“ã€åˆ›å»ºæ•°æ®åº“ã€ä½¿ç”¨æ•°æ®åº“ æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“ï¼š SHOW DATABASES; é»˜è®¤æ•°æ®åº“ï¼š mysqlï¼šå­˜å‚¨ç”¨æˆ·æƒé™ç›¸å…³æ•°æ®ã€‚ testï¼šç”¨äºç”¨æˆ·æµ‹è¯•ã€‚ information_schemaï¼šå­˜å‚¨ MySQL æœ¬èº«çš„æ¶æ„ç›¸å…³æ•°æ®ã€‚ åˆ›å»ºæ•°æ®åº“ï¼š CREATE DATABASE db1 DEFAULT CHARSET utf8 COLLATE utf8_general_ci; -- ä½¿ç”¨utf8ç¼–ç CREATE DATABASE db1 DEFAULT CHARACTER SET gbk COLLATE gbk_chinese_ci; -- ä½¿ç”¨gbkç¼–ç  ä½¿ç”¨æ•°æ®åº“ï¼š USE db1; æ˜¾ç¤ºå½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ï¼š SHOW TABLES; ä¸‰ã€ç”¨æˆ·ç®¡ç† åˆ›å»ºç”¨æˆ·ï¼š CREATE USER ç”¨æˆ·å@IPåœ°å€ IDENTIFIED BY å¯†ç ; åˆ é™¤ç”¨æˆ·ï¼š DROP USER ç”¨æˆ·å@IPåœ°å€; ä¿®æ”¹ç”¨æˆ·åï¼š RENAME USER ç”¨æˆ·å@IPåœ°å€ TO æ–°ç”¨æˆ·å@IPåœ°å€; ä¿®æ”¹å¯†ç ï¼š SET PASSWORD FOR ç”¨æˆ·å@IPåœ°å€ = PASSWORD(æ–°å¯†ç ); æ³¨ï¼šç”¨æˆ·æƒé™ç›¸å…³æ•°æ®ä¿å­˜åœ¨ mysql æ•°æ®åº“çš„ user è¡¨ä¸­ï¼Œå¯ä»¥ç›´æ¥å¯¹å…¶æ“ä½œï¼ˆä¸å»ºè®®ï¼‰ã€‚ å››ã€æƒé™ç®¡ç†æ•°æ®åº“åŠæƒé™ç®¡ç†ï¼š æ•°æ®åº“å.*ï¼šæ•°æ®åº“ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚ æ•°æ®åº“å.è¡¨ï¼šæŒ‡å®šæ•°æ®åº“ä¸­çš„æŸä¸€è¡¨ã€‚ æ•°æ®åº“å.å­˜å‚¨è¿‡ç¨‹ï¼šæŒ‡å®šæ•°æ®åº“ä¸­çš„å­˜å‚¨è¿‡ç¨‹ã€‚ *.*ï¼šæ‰€æœ‰æ•°æ®åº“ã€‚ ç”¨æˆ·åŠ IP æƒé™ï¼š ç”¨æˆ·å@IPåœ°å€ï¼šè¯¥ç”¨æˆ·ä»…èƒ½åœ¨ç‰¹å®š IP ä¸‹è®¿é—®ã€‚ ç”¨æˆ·å@192.168.1.%ï¼šè¯¥ç”¨æˆ·å¯ä»¥åœ¨ç‰¹å®š IP æ®µè®¿é—®ï¼ˆ% è¡¨ç¤ºä»»æ„ï¼‰ã€‚ ç”¨æˆ·å@%ï¼šå¯ä»¥åœ¨ä»»æ„ IP è®¿é—®ï¼ˆé»˜è®¤ IP åœ°å€ä¸º %ï¼‰ã€‚ æŸ¥çœ‹æƒé™ï¼š SHOW GRANTS FOR ç”¨æˆ·@IPåœ°å€; æˆæƒï¼š GRANT æƒé™ ON æ•°æ®åº“.è¡¨ TO ç”¨æˆ·@IPåœ°å€; å–æ¶ˆæˆæƒï¼š REVOKE æƒé™ ON æ•°æ®åº“.è¡¨ FROM ç”¨æˆ·@IPåœ°å€; æˆæƒå®ä¾‹ï¼š GRANT ALL PRIVILEGES ON db1.tb1 TO ç”¨æˆ·å@IP;GRANT SELECT ON db1.* TO ç”¨æˆ·å@IP;GRANT SELECT,INSERT ON *.* TO ç”¨æˆ·å@IP;REVOKE SELECT ON db1.tb1 FROM ç”¨æˆ·å@IP; MySQL è¡¨æ“ä½œ1. æŸ¥çœ‹è¡¨ æŸ¥çœ‹æ•°æ®åº“æ‰€æœ‰è¡¨ï¼š SHOW TABLES; æŸ¥çœ‹è¡¨æ‰€æœ‰å†…å®¹ï¼š SELECT * FROM è¡¨å; 2. åˆ›å»ºè¡¨CREATE TABLE è¡¨å ( åˆ—å ç±»å‹ æ˜¯å¦å¯ä»¥ä¸ºç©º, åˆ—å ç±»å‹ æ˜¯å¦å¯ä»¥ä¸ºç©º) ENGINE=InnoDB DEFAULT CHARSET=utf8; ç¤ºä¾‹ï¼š CREATE TABLE `tab1` ( `nid` INT(11) NOT NULL AUTO_INCREMENT, -- NOT NULL è¡¨ç¤ºä¸èƒ½ä¸ºç©º, AUTO_INCREMENT è¡¨ç¤ºè‡ªå¢ `name` VARCHAR(255) DEFAULT zhangyanlin, -- DEFAULT è¡¨ç¤ºé»˜è®¤å€¼ `email` VARCHAR(255), PRIMARY KEY (`nid`) -- æŠŠnidåˆ—è®¾ç½®ä¸ºä¸»é”®) ENGINE=InnoDB DEFAULT CHARSET=utf8; æ³¨é‡Šï¼š é»˜è®¤å€¼ï¼šåˆ›å»ºåˆ—æ—¶å¯ä»¥æŒ‡å®šï¼Œå¦‚æœæœªä¸»åŠ¨è®¾ç½®åˆ™è‡ªåŠ¨æ·»åŠ é»˜è®¤å€¼ã€‚ è‡ªå¢ï¼šä¸ºæŸåˆ—è®¾ç½®è‡ªå¢æ—¶ï¼Œæ’å…¥æ•°æ®æ—¶æ— éœ€è®¾ç½®æ­¤åˆ—ï¼Œè‡ªåŠ¨å¢åŠ ï¼ˆè¡¨ä¸­åªèƒ½æœ‰ä¸€ä¸ªè‡ªå¢åˆ—ï¼‰ã€‚ ä¸»é”®ï¼šä¸€ç§ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼Œä¸å…è®¸æœ‰ç©ºå€¼ã€‚ 3. åˆ é™¤è¡¨DROP TABLE è¡¨å; 4. æ¸…ç©ºè¡¨å†…å®¹DELETE FROM è¡¨å; -- åˆ é™¤è¡¨é‡Œå…¨éƒ¨æ•°æ®TRUNCATE TABLE è¡¨å; -- æ¸…ç©ºè¡¨ä½†ä¿ç•™ç»“æ„ 5. ä¿®æ”¹è¡¨ æ·»åŠ åˆ—ï¼š ALTER TABLE è¡¨å ADD åˆ—å ç±»å‹; åˆ é™¤åˆ—ï¼š ALTER TABLE è¡¨å DROP COLUMN åˆ—å; ä¿®æ”¹åˆ—ï¼š ALTER TABLE è¡¨å MODIFY COLUMN åˆ—å ç±»å‹; -- ä¿®æ”¹ç±»å‹ALTER TABLE è¡¨å CHANGE åŸåˆ—å æ–°åˆ—å ç±»å‹; -- ä¿®æ”¹åˆ—ååŠç±»å‹ æ·»åŠ ä¸»é”®ï¼š ALTER TABLE è¡¨å ADD PRIMARY KEY(åˆ—å); åˆ é™¤ä¸»é”®ï¼š ALTER TABLE è¡¨å DROP PRIMARY KEY; æ·»åŠ å¤–é”®ï¼š ALTER TABLE ä»è¡¨ ADD CONSTRAINT å¤–é”®åç§° FOREIGN KEY (å¤–é”®å­—æ®µ) REFERENCES ä¸»è¡¨ (ä¸»é”®å­—æ®µ); åˆ é™¤å¤–é”®ï¼š ALTER TABLE è¡¨å DROP FOREIGN KEY å¤–é”®åç§°; ä¿®æ”¹é»˜è®¤å€¼ï¼š ALTER TABLE è¡¨å ALTER åˆ—å SET DEFAULT å€¼; åˆ é™¤é»˜è®¤å€¼ï¼š ALTER TABLE è¡¨å ALTER åˆ—å DROP DEFAULT; 6. åŸºæœ¬æ•°æ®ç±»å‹MySQL çš„æ•°æ®ç±»å‹å¤§è‡´å¯ä»¥åˆ†ä¸ºæ•°å€¼ã€æ—¶é—´å’Œå­—ç¬¦ä¸²ï¼š æ•°å€¼ç±»å‹ï¼š BIT[(M)]ï¼šè¡¨ç¤ºäºŒè¿›åˆ¶ä½ï¼Œé•¿åº¦(m)èŒƒå›´æ˜¯ä» 1 åˆ° 64ã€‚ TINYINT[(M)] [UNSIGNED] [ZEROFILL]ï¼šå°æ•´æ•°ï¼ŒèŒƒå›´ä¸ºæœ‰ç¬¦å·çš„ -128 åˆ° 127 å’Œæ— ç¬¦å·çš„ 0 åˆ° 255ã€‚ INT[(M)][UNSIGNED][ZEROFILL]ï¼šæ•´æ•°ï¼ŒèŒƒå›´ä¸ºæœ‰ç¬¦å·çš„ -2147483648 åˆ° 2147483647 å’Œæ— ç¬¦å·çš„ 0 åˆ° 4294967295ã€‚ BIGINT[(M)][UNSIGNED][ZEROFILL]ï¼šå¤§æ•´æ•°ï¼ŒèŒƒå›´ä¸ºæœ‰ç¬¦å·çš„ -9223372036854775808 åˆ° 9223372036854775807 å’Œæ— ç¬¦å·çš„ 0 åˆ° 18446744073709551615ã€‚ DECIMAL[(M[,D])] [UNSIGNED] [ZEROFILL]ï¼šç”¨äºç²¾ç¡®çš„å°æ•°ï¼Œm æ˜¯æ•°å­—æ€»ä¸ªæ•°ï¼Œd æ˜¯å°æ•°ç‚¹åä¸ªæ•°ã€‚ å­—ç¬¦ä¸²ç±»å‹ï¼š CHAR(m)ï¼šè¡¨ç¤ºå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œæœ€å¤š 255 ä¸ªå­—ç¬¦ï¼Œå³ä½¿å†…å®¹å°äº mï¼Œä¹Ÿä¼šå ç”¨ m çš„é•¿åº¦ã€‚ VARCHAR(m)ï¼šè¡¨ç¤ºå˜é•¿çš„å­—ç¬¦ä¸²ï¼Œæœ€å¤š 255 ä¸ªå­—ç¬¦ï¼Œé•¿åº¦å°äºæœ€å¤§å€¼çš„å­—ç¬¦ä¸²å¯ä»¥å­˜å‚¨ã€‚ TEXTï¼šç”¨äºä¿å­˜å˜é•¿çš„å¤§å­—ç¬¦ä¸²ï¼Œæœ€å¤š 65535 ä¸ªå­—ç¬¦ã€‚ ENUMï¼šæšä¸¾ç±»å‹ï¼Œå¯ä»¥æœ‰æœ€å¤š 65535 ä¸ªä¸åŒå…ƒç´ ã€‚ æ—¶é—´æ—¥æœŸç±»å‹ï¼š DATEï¼šæ ¼å¼ä¸º YYYY-MM-DDã€‚ TIMEï¼šæ ¼å¼ä¸º HH:MM:SSã€‚ DATETIMEï¼šæ ¼å¼ä¸º YYYY-MM-DD HH:MM:SSã€‚ MySQL è¡¨å†…å®¹æ“ä½œè¡¨å†…å®¹çš„æ“ä½œä¸»è¦åŒ…æ‹¬å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹å’ŒæŸ¥è¯¢ï¼ˆå¢åˆ æ”¹æŸ¥â€”â€”CRUD)ã€‚ å¢ï¼š INSERT INTO è¡¨ (åˆ—å, åˆ—å...) VALUES (å€¼, å€¼,...);INSERT INTO è¡¨ (åˆ—å, åˆ—å...) VALUES (å€¼, å€¼,...),(å€¼, å€¼, å€¼...); ç¤ºä¾‹ï¼š INSERT INTO tab1(name, email) VALUES(zhangyanlin, zhangyanlin8851@163.com); åˆ ï¼š DELETE FROM è¡¨; -- åˆ é™¤è¡¨é‡Œå…¨éƒ¨æ•°æ®DELETE FROM è¡¨ WHERE id=1 AND name=zhangyanlin; -- åˆ é™¤ç‰¹å®šè¡Œæ•°æ® æ”¹ï¼š UPDATE è¡¨ SET name=zhangyanlin WHERE id1; æŸ¥ï¼š SELECT * FROM è¡¨;SELECT * FROM è¡¨ WHERE id 1;SELECT nid, name, gender AS gg FROM è¡¨ WHERE id 1; æŸ¥è¯¢æ¡ä»¶ç¤ºä¾‹ï¼š æ¡ä»¶åˆ¤æ–­ä½¿ç”¨ WHEREã€‚ é€šé…ç¬¦ä½¿ç”¨ LIKEã€‚ é™åˆ¶ç»“æœé›†ä½¿ç”¨ LIMITã€‚ æ’åºä½¿ç”¨ ORDER BYï¼Œå¦‚ ASCï¼ˆå‡åºï¼‰æˆ– DESCï¼ˆé™åºï¼‰ã€‚ åˆ†ç»„ä½¿ç”¨ GROUP BYã€‚","categories":["6.å¼€å‘å·¥å…·","æ•°æ®åº“"]},{"title":"MYSQLå®‰è£…","path":"/2023/09/18/6-å¼€å‘å·¥å…·-æ•°æ®åº“-MYSQLå®‰è£…/","content":"MySQL ç¯å¢ƒæ­å»ºæŒ‡å—å®‰è£… MySQLè¦åœ¨çš„ç³»ç»Ÿä¸Šå®‰è£… MySQL æœåŠ¡å™¨ï¼Œåªéœ€è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š sudo apt install mysql-server -y è¿™é‡Œçš„ -y é€‰é¡¹è®©å®‰è£…è¿‡ç¨‹è‡ªåŠ¨ç¡®è®¤ï¼Œé¿å…äº†æ¯ä¸€æ­¥æ‰‹åŠ¨è¾“å…¥ yes çš„éº»çƒ¦ã€‚ æŸ¥çœ‹å’Œç®¡ç† MySQL æœåŠ¡çŠ¶æ€å®‰è£…å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤æ¥æŸ¥çœ‹å’Œç®¡ç† MySQL æœåŠ¡ï¼š sudo service mysql status è¿™ä¸ªå‘½ä»¤ä¼šå‘Šè¯‰ MySQL æœåŠ¡å½“å‰çš„çŠ¶æ€ï¼Œæ˜¯æ­£åœ¨è¿è¡Œè¿˜æ˜¯å·²åœæ­¢ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½ä¼šçœ‹åˆ°æœåŠ¡çŠ¶æ€ä¸º active (running)ï¼Œè¿™æ„å‘³ç€ MySQL æ­£åœ¨æ­£å¸¸å·¥ä½œã€‚ å¯åŠ¨ MySQL æœåŠ¡ï¼š sudo service mysql start è¿™æ¡å‘½ä»¤å°†å¯åŠ¨ MySQL æœåŠ¡ã€‚ä¹‹åï¼Œå¯ä»¥å†æ¬¡è¿è¡ŒçŠ¶æ€æ£€æŸ¥å‘½ä»¤ï¼Œç¡®è®¤æœåŠ¡å·²æˆåŠŸå¯åŠ¨ã€‚ åœæ­¢ MySQL æœåŠ¡ï¼š sudo service mysql stop å¦‚æœéœ€è¦ç»´æŠ¤ç³»ç»Ÿæˆ–æ›´æ–°é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å‘½ä»¤å®‰å…¨åœ°åœæ­¢ MySQLã€‚ é‡å¯ MySQL æœåŠ¡ï¼š sudo service mysql restart è¿™æ¡å‘½ä»¤ä¼šå…ˆåœæ­¢æœåŠ¡å†é‡æ–°å¯åŠ¨ï¼Œå¯¹äºæ›´æ–°é…ç½®æ–‡ä»¶åçš„åº”ç”¨éå¸¸æœ‰ç”¨ã€‚ æŸ¥çœ‹å¹¶æ›´æ–° MySQL å¯†ç æŸ¥çœ‹ MySQL çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š sudo cat /etc/mysql/debian.cnf è¿™å°†æ˜¾ç¤ºåŒ…å« MySQL çš„ä¸€èˆ¬é…ç½®ï¼Œç‰¹åˆ«æ˜¯ä¸ Debian æ˜ åƒç›¸å…³çš„è®¾ç½®ï¼Œå…¶ä¸­å¯èƒ½åŒ…å«é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ ä½¿ç”¨é»˜è®¤ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œç™»å½•ï¼š mysql -u [your-username] -p åœ¨è¿™é‡Œï¼Œéœ€è¦æ›¿æ¢ [your-username] ä¸ºå®é™…çš„ç”¨æˆ·åï¼ˆå¦‚ rootï¼‰ã€‚ç³»ç»Ÿå°†åœ¨æç¤ºè¾“å…¥å¯†ç æ—¶ï¼Œå¯ä»¥ä½¿ç”¨åœ¨ä¸Šä¸€æ­¥ä¸­æ‰¾åˆ°çš„é»˜è®¤å¯†ç ã€‚ æ›´æ–° root ç”¨æˆ·å¯†ç ä¸€æ—¦æˆåŠŸç™»å½•åˆ° MySQLï¼Œå¯ä»¥æ›´æ–° root ç”¨æˆ·çš„å¯†ç ã€‚è¾“å…¥ä»¥ä¸‹ SQL å‘½ä»¤æ¥æ›´æ–°å¯†ç ï¼š ALTER USER root@localhost IDENTIFIED WITH mysql_native_password BY newpasswd; å°† newpasswd æ›¿æ¢ä¸ºæƒ³è¦è®¾ç½®çš„æ–°å¯†ç ã€‚mysql_native_password æ˜¯ MySQL ä¸­ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„èº«ä»½éªŒè¯æ–¹æ³•ã€‚ å˜åŒ–ç”Ÿæ•ˆåï¼Œå¯ä»¥é€€å‡º MySQLï¼š exit; ç„¶åï¼Œç”¨æ–°å¯†ç å†æ¬¡ç™»å½•ï¼Œç¡®ä¿ä¸€åˆ‡è®¾ç½®æ­£ç¡®ï¼š mysql -u root -p ç³»ç»Ÿä¼šæç¤ºè¾“å…¥æ–°è®¾ç½®çš„å¯†ç ã€‚è¾“å…¥åå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œå°†æˆåŠŸç™»å½•ã€‚ åˆ›å»º Qexo æ•°æ®åº“ä¸ºäº†æ»¡è¶³ Qexo åº”ç”¨ç¨‹åºçš„éœ€æ±‚ï¼Œç°åœ¨éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“ã€‚åœ¨ MySQL æç¤ºç¬¦ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š CREATE DATABASE qexo; æ­¤å‘½ä»¤åˆ›å»ºä¸€ä¸ªåä¸º qexo çš„æ–°æ•°æ®åº“ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›ä¸€æ­¥é…ç½®å’Œç®¡ç†è¿™ä¸ªæ•°æ®åº“ä»¥ç”¨äºåº”ç”¨ç¨‹åºæ•°æ®å­˜å‚¨ã€‚ ä¸€æ—¦åˆ›å»ºæˆåŠŸï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“ï¼Œç¡®è®¤ qexo æ•°æ®åº“çš„å­˜åœ¨ï¼š SHOW DATABASES; è¿™å°†åˆ—å‡ºæ‰€æœ‰ç°æœ‰çš„æ•°æ®åº“ï¼ŒåŒ…æ‹¬åˆšåˆšåˆ›å»ºçš„ qexoã€‚è¿™æ ·å°±å®Œæˆäº† MySQL ç¯å¢ƒçš„æ­å»ºï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨è¿™ä¸ªæ•°æ®åº“è¿›è¡Œæ›´å¤šçš„æ“ä½œäº†ã€‚","categories":["6.å¼€å‘å·¥å…·","æ•°æ®åº“"]},{"title":"Sqlieä½¿ç”¨","path":"/2023/09/15/6-å¼€å‘å·¥å…·-æ•°æ®åº“-Sqlieä½¿ç”¨/","content":"æ•°æ®åº“åŸºç¡€å®‰è£…æ•°æ®åº“ sudo apt-get install sqlite3 æ•°æ®åº“æŒ‡ä»¤æ“ä½œæ‰“å¼€ä¸€ä¸ªæ•°æ®åº“ sqlite3 my.db å¸¸ç”¨æŸ¥è¯¢: .table //æŸ¥çœ‹æ•°æ®åº“ä¸­çš„è¡¨.schema tablename //æŸ¥çœ‹ç›¸åº”è¡¨çš„ç»“æ„.database //æŸ¥çœ‹å½“å‰æ‰“å¼€çš„æ•°æ®åº“.quit //é€€å‡ºå½“å‰æ•°æ®åº“.help //åˆ—å‡ºå¸®åŠ©ä¿¡æ¯ åˆ›å»ºè¡¨: create table movies (id int, name text, time int, auth text); åˆ é™¤è¡¨: drop table tablename; æ·»åŠ ä¿¡æ¯: insert into movies values (.....);insert into movies values (.....); æŸ¥è¯¢ä¿¡æ¯: select * from movies ; åˆ é™¤ä¿¡æ¯: delete from movies where id=1; æ›´æ–°ä¿¡æ¯: update tablename set name= where id=2; æ·»åŠ å­—æ®µ: alter table tablename add column sex char ; //åˆ›å»ºåå­—ä¸ºtong.dbçš„æ•°æ®åº“sqlite3 tong.db//åˆ›å»ºä¸€ä¸ªå«userçš„table,é‡Œé¢æœ‰name, agecreate table user(name, age integer);//nameçš„é»˜è®¤ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œç”¨taotao//ageçš„ç±»å‹ç›¸å½“äºint//åˆ é™¤ä¸€ä¸ªtabledrop table user;//å‘userä¸­å­˜å‚¨æ•°æ®insert into user valuesï¼ˆtaotao, 18ï¼‰;//å¢åŠ ä¸€ä¸ªcolumnå«num,ç±»å‹æ˜¯ integeralter table user add column num integer;//æ›´æ–°æ•°æ®update user set name=taotao,age=18 where num=110;//æ‰“å°æ‰€æœ‰ä¿¡æ¯select * from user;//æ‰“å°æŸä¸€ä¸ªä¿¡æ¯select * from user where name=taotao;//åˆ é™¤ä¸€ä¸ªå«taotaoçš„äººdelete from user where name=taotao;//æŸ¥çœ‹æœ‰å“ªå‡ ä¸ªè¡¨.tables//æŸ¥çœ‹æŸä¸€ä¸ªè¡¨çš„å±æ€§.schema user//é€€å‡º.q ç¤ºä¾‹ä»£ç #include stdio.h#include stdlib.h#include sqlite3.h#include string.h#define SQL_NAME ./chen.db#define TAB_NAME tbint fun(void *buf, int num, char **val, char **name)\tint i;\tfor(i = 0; i num; ++i) printf(%s:%s , name[i], val[i]); printf(========%d=== , num);\treturn 0;int main(int argc, const char *argv[])\tchar buf[200] = \\0;\tsqlite3 *db = NULL;\tif(SQLITE_OK != sqlite3_open(SQL_NAME, db)) fprintf(stderr, OPEN SQLITE3 ERROR. ); exit(EXIT_FAILURE);\t#if 1\t/* #include stdio.hint main()\tchar a = A;\tchar buf[80];\tsprintf(buf, The ASCII code of a is %d. , a);\tprintf(%s, buf);\treturn 0;è¾“å‡ºASCII çš„å€¼*/\tsprintf(buf, create table if not exists %s (id, sex, score float);, TAB_NAME);\tif(SQLITE_OK != sqlite3_exec(db, buf, NULL, NULL, NULL)) fprintf(stderr, CREATE TABLE ERROR:%s , sqlite3_errmsg(db)); exit(EXIT_FAILURE);\t/*\tåŠŸ èƒ½: å°†sæ‰€æŒ‡å‘çš„æŸä¸€å—å†…å­˜ä¸­çš„æ¯ä¸ªå­—èŠ‚çš„å†…å®¹å…¨éƒ¨è®¾ç½®ä¸ºchæŒ‡å®šçš„ASCIIå€¼, *\tå—çš„å¤§å°ç”±ç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å®š,è¿™ä¸ªå‡½æ•°é€šå¸¸ä¸ºæ–°ç”³è¯·çš„å†…å­˜åšåˆå§‹åŒ–å·¥ä½œ */\tmemset(buf, 0 , sizeof(buf));\tsprintf(buf, insert into %s values(chen, B, 90);, TAB_NAME);\tif(SQLITE_OK != sqlite3_exec(db, buf, NULL, NULL, NULL)) fprintf(stderr, CREATE TABLE ERROR:%s , sqlite3_errmsg(db)); exit(EXIT_FAILURE); #endif\tmemset(buf, 0, sizeof(buf));\tsprintf(buf, select * from %s ;, TAB_NAME);\tif(SQLITE_OK != sqlite3_exec(db, buf, fun, NULL, NULL)) fprintf(stderr, CREATE TABLE ERROR:%s , sqlite3_errmsg(db)); exit(EXIT_FAILURE); sqlite3_close(db);\treturn 0;","categories":["6.å¼€å‘å·¥å…·","æ•°æ®åº“"]},{"title":"å°†MySQLæ•°æ®åº“æ‹·è´åˆ°å¦ä¸€å°æœºå™¨","path":"/2023/09/14/6-å¼€å‘å·¥å…·-æ•°æ®åº“-å°†MySQLæ•°æ®åº“æ‹·è´åˆ°å¦ä¸€å°æœºå™¨/","content":"ç›´æ¥å¤åˆ¶å¯ä»¥åœ¨æ”¯æŒç›¸åŒæµ®ç‚¹æ ¼å¼çš„ä¸åŒæ¶æ„ä¹‹é—´å¤åˆ¶ MyISAM è¡¨çš„ç»“æ„å’Œæ•°æ®æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶åŒ…æ‹¬ .frmã€.MYI å’Œ .MYDã€‚è¿™äº›æ–‡ä»¶åˆ†åˆ«ç”¨äºå­˜å‚¨è¡¨çš„å®šä¹‰ã€ç´¢å¼•å’Œæ•°æ®ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒMySQL ä¼šå¤„ç†æ‰€æœ‰å­—èŠ‚äº¤æ¢çš„é—®é¢˜ï¼Œå› æ­¤åœ¨ä¸åŒå¹³å°é—´ç§»åŠ¨è¿™äº›æ–‡ä»¶é€šå¸¸æ˜¯å¯è¡Œçš„ã€‚ å·¥å…· sqldumpå¦‚æœéœ€è¦åœ¨ä¸åŒæ¶æ„ä¹‹é—´è½¬ç§»æ•´ä¸ªæ•°æ®åº“ï¼Œæœ€æœ‰æ•ˆçš„æ–¹å¼æ˜¯ä½¿ç”¨ mysqldump å·¥å…·ã€‚è¯¥å·¥å…·å¯ä»¥ç”Ÿæˆä¸€ä¸ªåŒ…å« SQL è¯­å¥çš„æ–‡ä»¶ï¼Œè¿™äº›è¯­å¥å¯ä»¥ç”¨æ¥é‡å»ºæ•°æ®åº“ç»“æ„å’Œæ•°æ®ã€‚è½¬ç§»æ­¥éª¤å¦‚ä¸‹ï¼š ç”Ÿæˆè½¬å‚¨æ–‡ä»¶ï¼šå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºæ•°æ®åº“çš„è½¬å‚¨æ–‡ä»¶ã€‚ mysqldump db_name db_name_dump.sql è¿™ä¸ªå‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªåä¸º db_name_dump.sql çš„æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†é‡å»º db_name æ•°æ®åº“æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚ ä¼ è¾“æ–‡ä»¶ï¼šå°†ç”Ÿæˆçš„æ–‡ä»¶é€šè¿‡ç½‘ç»œæˆ– USB é©±åŠ¨å™¨ç§»åŠ¨åˆ°ç›®æ ‡æœºå™¨ã€‚ å¯¼å…¥æ•°æ®åº“ï¼šåœ¨ç›®æ ‡æœºå™¨ä¸Šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†è½¬å‚¨æ–‡ä»¶å¯¼å…¥åˆ° MySQL ä¸­ã€‚ mysql db_name db_name_dump.sql è¦æŸ¥çœ‹å¯ç”¨çš„é€‰é¡¹ï¼Œå¯ä»¥è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š mysqldump --help å¦‚æœè¦å°†æ•°æ®è¿ç§»åˆ°æ›´æ–°ç‰ˆæœ¬çš„ MySQLï¼Œæ¨èä½¿ç”¨ mysqldump --opt é€‰é¡¹ï¼Œå®ƒå¯ä»¥ä¼˜åŒ–ç”Ÿæˆçš„è½¬å‚¨æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶æ›´å°ä¸”å¤„ç†é€Ÿåº¦æ›´å¿«ã€‚ åœ¨åŒä¸€ç½‘ç»œä¸‹ï¼Œä¸¤å°æœºå™¨ä¹‹é—´ç§»åŠ¨æ•°æ®åº“çš„ä¾¿æ·æ–¹å¼æ˜¯å¦‚ä¸‹å‘½ä»¤çš„ç»„åˆï¼š mysqladmin -h other_hostname create db_namemysqldump --opt db_name | mysql -h other_hostname db_name ç¬¬ä¸€è¡Œå‘½ä»¤ä¼šåœ¨ç›®æ ‡æœºå™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“ï¼Œç¬¬äºŒè¡Œå°†åŸæœºå™¨çš„æ•°æ®åº“è½¬å‚¨å¹¶åŒæ—¶å¯¼å…¥åˆ°ç›®æ ‡æœºå™¨ã€‚ è‹¥éœ€åœ¨ä½é€Ÿç½‘ç»œä¸‹ä»è¿œç¨‹æœºå™¨å¤åˆ¶æ•°æ®åº“ï¼Œå¯ä»¥ä½¿ç”¨å‹ç¼©é€‰é¡¹æ¥å‡å°‘æ•°æ®é‡ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š mysqladmin create db_namemysqldump -h other_hostname --opt --compress db_name | mysql db_name å¦å¤–ï¼Œè¿˜å¯ä»¥å°†å¤‡ä»½ç»“æœä¿å­˜åˆ°å‹ç¼©æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚ä¾‹å¦‚ï¼š mysqldump --quick db_name | gzip db_name.contents.gz è¿™ä¸€å‘½ä»¤å°†æ•°æ®åº“ä»¥å‹ç¼©æ ¼å¼å¤‡ä»½åˆ°æ–‡ä»¶ db_name.contents.gz ä¸­ã€‚ç„¶ååœ¨ç›®æ ‡æœºå™¨ä¸Šï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è§£å‹å¹¶å¯¼å…¥æ•°æ®ï¼š mysqladmin create db_namegunzip db_name.contents.gz | mysql db_name é™¤äº† mysqldumpï¼Œè¿˜å¯ä»¥åˆ©ç”¨ mysqldump å’Œ mysqlimport å¿«é€Ÿè½¬ç§»æ•°æ®åº“ï¼Œå°¤å…¶å¯¹å¤§å‹è¡¨æ ¼æ›´ä¸ºé«˜æ•ˆã€‚è½¬ç§»æ­¥éª¤å¦‚ä¸‹ï¼š åˆ›å»ºè¾“å‡ºç›®å½•å¹¶å¤‡ä»½æ•°æ®åº“ï¼š mkdir DUMPDIRmysqldump --tab=DUMPDIR db_name ä¸Šè¿°å‘½ä»¤ä¼šåœ¨ DUMPDIR ç›®å½•ä¸­åˆ›å»ºå¤šä¸ªæ–‡ä»¶ï¼Œå«æœ‰æ•°æ®åº“ç»“æ„å’Œæ•°æ®ã€‚ å°† DUMPDIR ç›®å½•ä¸­çš„æ–‡ä»¶ä¼ è¾“åˆ°ç›®æ ‡æœºå™¨ä¸Šã€‚ å¯¼å…¥æ•°æ®åº“ï¼š mysqladmin create db_name # åˆ›å»ºæ•°æ®åº“cat DUMPDIR/*.sql | mysql db_name # åˆ›å»ºè¡¨mysqlimport db_name DUMPDIR/*.txt # åŠ è½½æ•°æ® è¯·åŠ¡å¿…å¤åˆ¶ MySQL æ•°æ®åº“ï¼Œå› ä¸ºæˆæƒè¡¨åŒæ ·å­˜å‚¨äºæ­¤ã€‚åœ¨æ–°çš„æœºå™¨ä¸Šå¯èƒ½éœ€è¦ä»¥ MySQL root ç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤ï¼Œç›´åˆ°ç”Ÿæˆæ‰€éœ€çš„ MySQL æ•°æ®åº“ã€‚ åœ¨æˆåŠŸå¯¼å…¥ mysql æ•°æ®åº“åï¼ŒåŠ¡å¿…æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä»¥ä½¿æœåŠ¡å™¨é‡æ–°åŠ è½½æˆæƒè¡¨ä¿¡æ¯ï¼š mysqladmin flush-privileges","categories":["6.å¼€å‘å·¥å…·","æ•°æ®åº“"]},{"title":"ARINC422","path":"/2023/09/12/5-åµŒå…¥å¼å¼€å‘-èˆªç”µç³»ç»Ÿ-ARINC422/","content":"ARINC 422 åè®®ARINC 422 åˆ™å› å…¶é«˜æ•ˆçš„ç‚¹å¯¹ç‚¹é€šä¿¡èƒ½åŠ›é€‚åˆäºå¿«é€Ÿæ•°æ®ä¼ è¾“ã€‚ ARINC 422 æ˜¯ä¸€ç§ç”¨äºèˆªç©ºç”µå­è®¾å¤‡é—´ä¸²è¡Œæ•°æ®é€šä¿¡çš„åè®®ï¼Œä¸»è¦ç”¨äºä¼ è¾“æ•°å­—ä¿¡å·ã€‚å®ƒæ˜¯ä¸€ç§å•å‘é€šä¿¡åè®®ï¼Œé€šå¸¸ç”¨äºä¼ è¾“æ•°æ®å’ŒæŒ‡ä»¤ã€‚ ARINC 422 åè®®å†…å®¹ æ•°æ®æ ¼å¼ï¼š ARINC 422 ä½¿ç”¨äºŒè¿›åˆ¶ç¼–ç ï¼Œæ•°æ®ä»¥ä¸²è¡Œå½¢å¼å‘é€ã€‚ æ³¢ç‰¹ç‡ï¼š å¸¸ç”¨çš„æ³¢ç‰¹ç‡ä¸º 100 kbpsï¼Œä¼ è¾“è·ç¦»å¯è¾¾ 1,200 ç±³ã€‚ ä¿¡å·ç”µå¹³ï¼š ä½¿ç”¨å·®åˆ†ä¿¡å·ï¼Œå…·æœ‰è¾ƒå¼ºçš„æŠ—å¹²æ‰°èƒ½åŠ›ã€‚é€»è¾‘â€1â€å’Œé€»è¾‘â€0â€é€šè¿‡ç”µå‹å·®æ¥è¡¨ç¤ºã€‚ æ•°æ®å¸§ç»“æ„ARINC 422 çš„ä¸€å¸§æ•°æ®é€šå¸¸åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š èµ·å§‹ä½ï¼ˆStart Bitï¼‰ï¼š é€šå¸¸ä¸º 1 ä½ï¼Œè¡¨ç¤ºæ•°æ®å¸§çš„å¼€å§‹ã€‚ æ•°æ®ä½ï¼ˆData Bitsï¼‰ï¼š é€šå¸¸ä¸º 8 ä½ï¼ˆå¯ä»¥æ ¹æ®å…·ä½“åº”ç”¨æœ‰æ‰€å˜åŒ–ï¼‰ï¼Œç”¨äºä¼ è¾“å®é™…çš„æ•°æ®å†…å®¹ã€‚ å¥‡å¶æ ¡éªŒä½ï¼ˆParity Bitï¼‰ï¼š å¯é€‰ï¼Œ1 ä½ï¼Œç”¨äºæ£€æµ‹ä¼ è¾“é”™è¯¯ã€‚å¯ä»¥è®¾ç½®ä¸ºå¶æ ¡éªŒæˆ–å¥‡æ ¡éªŒã€‚ åœæ­¢ä½ï¼ˆStop Bitsï¼‰ï¼š é€šå¸¸ä¸º 1 æˆ– 2 ä½ï¼Œè¡¨ç¤ºæ•°æ®å¸§çš„ç»“æŸã€‚ ä¸€å¸§æ•°æ®çš„å†…å®¹åˆ†å¸ƒç¤ºä¾‹å‡è®¾ä¸€å¸§æ•°æ®çš„ç»“æ„å¦‚ä¸‹ï¼š 1 ä½ï¼šèµ·å§‹ä½ 8 ä½ï¼šæ•°æ®ä½ 1 ä½ï¼šå¥‡å¶æ ¡éªŒä½ 1 ä½ï¼šåœæ­¢ä½ +---------+----------+-------------+-----------+| Start | Data | Parity | Stop || Bit | Bits | Bit | Bit |+---------+----------+-------------+-----------+| 1 | 8 | 1 | 1 |+---------+----------+-------------+-----------+","categories":["5.åµŒå…¥å¼å¼€å‘","èˆªç”µç³»ç»Ÿ"]},{"title":"ARINC429","path":"/2023/09/11/5-åµŒå…¥å¼å¼€å‘-èˆªç”µç³»ç»Ÿ-ARINC429/","content":"ARINC 429 åè®®ARINC 429 ä»¥å…¶å•å‘ã€å¹¿æ’­å¼çš„ç‰¹æ€§å’Œå¤æ‚çš„æ•°æ®å¸§ç»“æ„é€‚åˆäºå¤šè®¾å¤‡é—´çš„ä¿¡æ¯å…±äº« æ¦‚è¿°ARINC 429 æ˜¯ç”±ç¾å›½èˆªç©ºæ— çº¿ç”µå…¬å¸åˆ¶å®šçš„ä¸€ç§å•å‘ä¸²è¡Œé€šä¿¡åè®®ï¼Œå¹¿æ³›åº”ç”¨äºæ°‘ç”¨å’Œå†›ç”¨é£æœºçš„ç”µå­ç³»ç»Ÿä¸­ã€‚å…¶ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š å•å‘ä¼ è¾“ï¼šä¿¡æ¯åªèƒ½ä»å‘é€å™¨æµå‘æ¥æ”¶å™¨ã€‚ å·®åˆ†ä¿¡å·ï¼šé‡‡ç”¨åŒææ€§å½’é›¶ç è¿›è¡Œä¿¡å·ä¼ è¾“ï¼Œå…·æœ‰è‰¯å¥½çš„æŠ—å¹²æ‰°èƒ½åŠ›ã€‚ æ•°æ®å¸§ç»“æ„ARINC 429 çš„æ•°æ®å•å…ƒç”± 32 ä½ç»„æˆï¼Œå…·ä½“åˆ†å¸ƒå¦‚ä¸‹ï¼š Bit 1-8ï¼šLabelï¼ˆæ ‡ç­¾åŸŸï¼‰ï¼Œç”¨äºæ ‡è¯†æ•°æ®ç±»å‹ï¼ˆå…«è¿›åˆ¶è¡¨ç¤ºï¼‰ã€‚ Bit 9-10ï¼šSDIï¼ˆæºç›®çš„åœ°æ ‡è¯†ç¬¦ï¼‰ï¼ŒæŒ‡ç¤ºæ•°æ®æ¥æºæˆ–ç›®çš„åœ°ã€‚ Bit 11-28 æˆ– 29ï¼šData Fieldï¼ˆæ•°æ®åŸŸï¼‰ï¼ŒåŒ…å«å®é™…ä¼ è¾“çš„æ•°æ®ï¼Œé€šå¸¸ä½¿ç”¨ BCD æˆ–äºŒè¿›åˆ¶æ•°è¡¨ç¤ºã€‚ Bit 30-31ï¼šSSMï¼ˆä¿¡å·çŠ¶æ€çŸ©é˜µï¼‰ï¼Œæè¿°æ•°æ®çš„çŠ¶æ€æˆ–æ€§è´¨ã€‚ Bit 32ï¼šParity Bitï¼ˆæ ¡éªŒä½ï¼‰ï¼Œç”¨äºå¥‡å¶æ ¡éªŒä»¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€‚ MPIO429ï¼ˆMulti-Protocol IO 429ï¼‰æ˜¯ä¸€ç§åŸºäº ARINC 429 åè®®çš„å¤šåŠŸèƒ½è¾“å…¥è¾“å‡ºæ¨¡å—ï¼Œé€šå¸¸ç”¨äºèˆªç©ºç”µå­ç³»ç»Ÿä¸­ï¼Œæ”¯æŒå¯¹ä¸åŒç§ç±»çš„é£æœºæ•°æ®æ€»çº¿è¿›è¡Œé€šä¿¡ã€‚ARINC 429 åè®®å¹¿æ³›åº”ç”¨äºèˆªç©ºé¢†åŸŸï¼Œç‰¹åˆ«æ˜¯åœ¨é£è¡Œæ§åˆ¶ã€å¯¼èˆªã€å‘åŠ¨æœºç®¡ç†ã€æœºè½½ä¼ æ„Ÿå™¨æ•°æ®ä¼ è¾“ç­‰æ–¹é¢ã€‚ MPIO429 çš„åŠŸèƒ½ç‰¹ç‚¹æ•°æ®ä¼ è¾“é€Ÿåº¦ï¼šæ”¯æŒ ARINC 429 åè®®çš„æ ‡å‡†ä¼ è¾“é€Ÿç‡ï¼Œé€šå¸¸ä¸º 12.5 kbps æˆ– 100 kbpsï¼Œé€‚åˆä½é€Ÿæ•°æ®ä¼ è¾“ã€‚ å¤šé€šé“æ”¯æŒï¼šMPIO429 æ¨¡å—é€šå¸¸ä¼šæä¾›å¤šä¸ªé€šé“ï¼Œå…è®¸åŒæ—¶å¤„ç†å¤šä¸ª ARINC 429 ä¿¡å·ï¼Œå¯ä»¥è¿æ¥å¤šä¸ªè®¾å¤‡å¹¶å¤„ç†æ›´å¤šæ•°æ®ã€‚ ARINC 429 åè®®ä¸ MPIO429 æ•°æ®ä¼ è¾“æ–¹å¼ï¼šARINC 429 ä½¿ç”¨å•å‘æ•°æ®ä¼ è¾“ï¼Œä¸€èˆ¬åˆ†ä¸ºå‘å°„å™¨å’Œæ¥æ”¶å™¨ï¼Œæ¯ä¸ªè®¾å¤‡é€šè¿‡ä¸€ä¸ªç‹¬ç«‹çš„ä¿¡å·çº¿å‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚ æ•°æ®å¸§ç»“æ„ï¼šARINC 429 æ•°æ®å¸§åŒ…å«å¤šä¸ªå­—æ®µï¼ŒåŒ…æ‹¬èµ·å§‹ä½ã€æ•°æ®ä½ã€æ ‡ç­¾ï¼ˆlabelï¼‰ã€æ•°æ®å’Œå¥‡å¶æ ¡éªŒä½ç­‰ï¼Œä¼ è¾“çš„æ•°æ®ä¸€èˆ¬æ˜¯é£è¡Œæ•°æ®ã€ç¯å¢ƒç›‘æ§ã€ä¼ æ„Ÿå™¨æ•°æ®ç­‰ã€‚ åº”ç”¨åœºæ™¯ é£è¡Œæ§åˆ¶ç³»ç»Ÿï¼šç”¨äºé£è¡ŒçŠ¶æ€ã€æ§åˆ¶æŒ‡ä»¤ç­‰æ•°æ®çš„ä¼ è¾“ã€‚ èˆªç©ºç”µå­è®¾å¤‡ï¼šå¦‚é›·è¾¾ã€å¯¼èˆªã€ä»ªè¡¨ç­‰è®¾å¤‡çš„æ•°æ®é€šä¿¡ã€‚ å‘åŠ¨æœºæ§åˆ¶ç³»ç»Ÿï¼šç›‘æ§å‘åŠ¨æœºçŠ¶æ€ã€æ§åˆ¶æŒ‡ä»¤ç­‰ã€‚ åœ¨ ARINC 429 åè®®ä¸­ï¼Œä¸€ä¸ªæ¥å£é€šå¸¸æ˜¯å•å‘çš„ï¼Œå³æ¯ä¸ª ARINC 429 ä¿¡å·çº¿è·¯åªèƒ½ä½œä¸ºè¾“å…¥æˆ–è¾“å‡ºä¹‹ä¸€ã€‚è¿™æ˜¯å› ä¸º ARINC 429 æœ¬èº«è®¾è®¡ä¸ºç‚¹å¯¹ç‚¹çš„å•å‘æ•°æ®ä¼ è¾“åè®®ï¼Œæ¯æ¡çº¿è·¯åªæœ‰ä¸€ä¸ªå‘é€å™¨å’Œä¸€ä¸ªæ¥æ”¶å™¨ã€‚ ä¸ºä»€ä¹ˆ ARINC 429 æ˜¯å•å‘çš„ï¼Ÿ ç®€åŒ–è®¾è®¡å’Œå‡å°‘å¹²æ‰°ï¼šARINC 429 çš„å•å‘é€šä¿¡å‡å°‘äº†ä¿¡å·å†²çªçš„å¯èƒ½æ€§ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç¡¬ä»¶å’Œåè®®å±‚é¢ä¸Šç®€åŒ–ç”µæ°”è®¾è®¡ã€‚è¿™ä½¿å¾—é€šä¿¡æ›´åŠ å¯é ï¼Œå°¤å…¶åœ¨é£æœºè¿™ç§å¯¹æ•°æ®ä¼ è¾“å¯é æ€§è¦æ±‚æé«˜çš„ç¯å¢ƒä¸­ã€‚ é€Ÿåº¦å’Œæ—¶åºï¼šARINC 429 çš„ä¼ è¾“é€Ÿç‡æ¯”è¾ƒä½ï¼ˆé€šå¸¸ä¸º 12.5 kbps æˆ– 100 kbpsï¼‰ï¼Œå¹¶ä¸”é€šä¿¡æ˜¯åŸºäºæ—¶é—´åˆ†ç‰‡çš„ï¼Œå› æ­¤å•å‘ä¼ è¾“æ›´å®¹æ˜“ç®¡ç†ã€‚ åŒå‘é€šä¿¡çš„å®ç°å°½ç®¡ ARINC 429 æœ¬èº«æ˜¯å•å‘çš„ï¼Œä½†æŸäº›ç³»ç»Ÿå¯èƒ½ä¼šä½¿ç”¨å¤šä¸ª ARINC 429 é€šé“æ¥å®ç°åŒå‘é€šä¿¡ã€‚æ¯”å¦‚ï¼š åŒé€šé“è®¾è®¡ï¼šå¦‚æœä¸€ä¸ªè®¾å¤‡æ—¢éœ€è¦å‘é€æ•°æ®ï¼Œåˆéœ€è¦æ¥æ”¶æ•°æ®ï¼Œé€šå¸¸ä¼šä¸ºæ¯ä¸ªæ–¹å‘æä¾›ç‹¬ç«‹çš„é€šé“ï¼ˆè¾“å…¥å’Œè¾“å‡ºï¼‰ï¼Œæ¯ä¸ªé€šé“éƒ½è¿æ¥åˆ°ä¸åŒçš„ ARINC 429 æ€»çº¿æˆ–æ¥å£ã€‚ å…¶ä»–åè®®ç»„åˆï¼šæœ‰äº›è®¾å¤‡å¯èƒ½è¿˜ä¼šé‡‡ç”¨å…¶ä»–åè®®ï¼ˆå¦‚ MIL-STD-1553 æˆ– CANï¼‰æ¥å®ç°åŒå‘é€šä¿¡ï¼Œè¿™äº›åè®®æ”¯æŒå…¨åŒå·¥é€šä¿¡ï¼Œå³åŒä¸€æ¡çº¿è·¯å¯ä»¥åŒæ—¶è¿›è¡Œæ•°æ®è¾“å…¥å’Œè¾“å‡ºã€‚ åœ¨ ARINC 429 åè®®ä¸‹ï¼Œä¸€ä¸ªæ¥å£æœ¬èº«é€šå¸¸ä¸èƒ½åŒæ—¶è¿›è¡Œè¾“å…¥å’Œè¾“å‡ºï¼Œä½†å¯ä»¥é€šè¿‡å¢åŠ é€šé“æˆ–ä½¿ç”¨å…¶ä»–åè®®æ¥å®ç°åŒå‘é€šä¿¡ã€‚ ARINC-429 æ˜¯ä¸€ä¸ªå…³é”®çš„æ ‡å‡†ï¼Œç”¨äºå•†ç”¨é£æœºèˆªç©ºç”µå­ç³»ç»Ÿä¹‹é—´çš„æ•°å­—æ•°æ®ä¼ è¾“ã€‚è¿™ä¸ªåè®®æ—¨åœ¨ç¡®ä¿ä¸åŒè®¾å¤‡é—´çš„äº’æ¢æ€§ï¼Œä½¿å¾—ä¸åŒåˆ¶é€ å•†çš„èˆªç©ºç”µå­è®¾å¤‡å¯ä»¥æ— ç¼åä½œï¼Œæ˜¾è‘—æå‡äº†ç³»ç»Ÿçš„çµæ´»æ€§ä¸å®‰å…¨æ€§ã€‚ ARINC 429 é€šå¸¸è¢«ç§°ä¸º Mark 33 æ•°å­—ä¿¡æ¯ä¼ è¾“ç³»ç»Ÿï¼ˆDITSï¼‰æ€»çº¿ã€‚å°½ç®¡å®ƒä¸»è¦ç”¨äºèˆªç©ºç”µå­é¢†åŸŸï¼Œä½†è¿™ç§æ€»çº¿æŠ€æœ¯ä¹ŸæˆåŠŸåº”ç”¨äºåœ°é¢è½¦è¾†ã€æ­¦å™¨ç³»ç»Ÿä»¥åŠå…¶å®ƒå•†ä¸šå’Œå†›äº‹è®¾å¤‡ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ç°ä»£æˆ˜æ–—æœºä¸­ï¼ŒARINC 429 å¯ä»¥ç”¨äºé€šè®¯å¯¼èˆªè®¾å¤‡å’Œç«æ§ç³»ç»Ÿä¹‹é—´çš„æ•°æ®äº¤æ¢ï¼Œç¡®ä¿è®¾å¤‡é—´èƒ½å¤Ÿå‡†ç¡®åœ°å…±äº«å…³é”®ä¿¡æ¯ã€‚ ARINC-429 æ ‡å‡†çš„ç»„æˆéƒ¨åˆ† PART 1: æä¾›äº† ARINC 429 çš„åŠŸèƒ½åŸºæœ¬æè¿°ï¼ŒåŒ…æ‹¬æ”¯æŒçš„ç‰©ç†å’Œç”µæ°”æ¥å£ï¼Œæ•°æ®å­—æ ¼å¼ã€æ ‡å‡†æ ‡ç­¾å’Œåœ°å€åˆ†é…ä»¥åŠç›¸å…³ç¤ºä¾‹ã€‚è¿™éƒ¨åˆ†ç¡®ä¿è®¾å¤‡åˆ¶é€ å•†å¯ä»¥ç†è§£å’Œå®ç°ä¸è¯¥æ ‡å‡†ç›¸å…³çš„åŸºæœ¬è¦æ±‚ã€‚ PART 2: å®šä¹‰äº† ARINC 429 ç¦»æ•£é‡å­—åŠæŒ‰æ ‡ç­¾é¡ºåºçš„ä½åˆ†é…ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“çš„æ­£ç¡®æ€§å’Œå…¼å®¹æ€§ã€‚ PART 3: æè¿°äº† ARINC 429 çš„æ•°æ®ä¼ è¾“åè®®åŠå…¶é€šè¿‡å¤§å—æˆ–è€…æ–‡ä»¶æ ¼å¼è¿›è¡Œæ•°æ®ä¼ è¾“çš„æ¶ˆæ¯å®šä¹‰ï¼Œä¸ºåç»­çš„æ•°æ®äº¤äº’æä¾›æ¡†æ¶ã€‚ PART 4: åˆ—å‡ºäº†å¤šå¹´æ¥å‘è¡¨çš„ ARINC 429 ç¬¬ 1 éƒ¨åˆ†çš„è¡¥ç¼–æ¡£æ¡ˆï¼Œå¹¶ä½œä¸º ARINC 429 ç¬¬ 18 å·è¡¥ç¼–çš„ä¸€éƒ¨åˆ†è¿›è¡Œæ›´æ–°ï¼ˆ2012 å¹´ï¼‰ã€‚è¿™ä¸ºç ”ç©¶å’Œå¼€å‘äººå‘˜æä¾›äº†ä¸°å¯Œçš„å†å²èƒŒæ™¯å’ŒæŠ€æœ¯æ¼”å˜çš„ä¿¡æ¯ã€‚ æ•°æ®ä¼ è¾“ç‰¹ç‚¹ARINC 429 çš„æ•°æ®ä¼ è¾“ç‰¹ç‚¹åœ¨äºå…¶ç®€å•çš„å•å‘æ€»çº¿é€šä¿¡æ•°æ®æµè®¾è®¡ã€‚ä¸å…¸å‹çš„å¤šå‘æ•°æ®æ€»çº¿ä¸åŒï¼ŒARINC-429 çš„å•å‘è®¾è®¡èƒ½æ˜¾è‘—æå‡ç³»ç»Ÿçš„å¯é æ€§ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‘é€å™¨ï¼ˆSenderï¼‰å¯ä»¥åŒæ—¶æ”¯æŒæœ€é«˜ 20 ä¸ªæ¥æ”¶å™¨ï¼ˆReceiverï¼‰ï¼Œæ¯ä¸ªæ¥æ”¶å™¨å¯ä»¥ç‹¬ç«‹æ¥æ”¶æ¶ˆæ¯è€Œä¸äº§ç”Ÿä¿¡å·å†²çªã€‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚RECEIVER_1â”‚ â”‚ ... â”‚ â”‚ RECEIVER_N â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â–² â–² â–² â”‚ â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ SENDER â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ åŒå‘ä¼ è¾“: æ·»åŠ ä¸€æ ¹é¢å¤–çº¿ç¼†å³å¯å®ç°åŒå‘æ•°æ®ä¼ è¾“ï¼Œå…è®¸æ¥æ”¶å™¨åœ¨éœ€è¦æ—¶è½¬å˜ä¸ºå‘é€å™¨ã€‚ æ•°æ®å­—æ ¼å¼: æ¯ä¸ªæ•°æ®å­—ï¼ˆWORDï¼‰ä¸º 32 ä½ï¼Œä»£è¡¨ç‰¹å®šçš„å·¥ç¨‹å•ä½ï¼Œå¦‚é«˜åº¦ã€æ°”å‹ç­‰ï¼Œæ ‡å‡†çš„æ•°æ®ä¼ è¾“é€Ÿç‡åˆ†ä¸ºé«˜é€Ÿï¼ˆ100 kbsï¼‰å’Œä½é€Ÿï¼ˆ12.5 kbsï¼‰ã€‚ è®¾å¤‡æ ‡è¯†: å„ä¸ªè®¾å¤‡é€šè¿‡è®¾å¤‡ ID å·è¿›è¡Œç®¡ç†ï¼Œè¿åäº† ARINC 429 çš„åœ°å€åˆ†é…åŸåˆ™ï¼Œä»è€Œå…è®¸æ›´çµæ´»çš„æ•°æ®ç®¡ç†ã€‚ ä¿¡å·è‡ªé”: å¯¹äºæ•°æ®å­—ä¹‹é—´çš„è¿ç»­åŒºåˆ†ï¼Œä¸€ä¸ªè‡³å°‘ 4 ä½çš„ç©ºæˆ–é›¶ç”µå‹æ ‡è¯†å¯ä»¥è®©ç³»ç»Ÿåœ¨æ²¡æœ‰å•ç‹¬æ—¶é’Ÿä¿¡å·çš„æƒ…å†µä¸‹æ­£å¸¸å·¥ä½œï¼Œè¿™å°±æ˜¯ ARINC 429 çš„è‡ªé”ç‰¹æ€§ã€‚ æ•°æ®å­—ç»“æ„é€šè¿‡ ARINC-429 æ€»çº¿å‘é€çš„æ•°æ®ä»¥ 32 ä½å­—çš„å½¢å¼ä¼ è¾“ï¼Œæ¯ä¸ªå­—åŒ…å«å¤šç§ä¿¡æ¯ã€‚ç»“æ„ç¤ºä¾‹å¦‚ä¸‹ï¼š â”Œâ”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚P â”‚ SSM â”‚ DATA â”‚ SDI â”‚ LABEL â”‚â””â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ LABEL: 8 ä½æ ‡ç­¾ç”¨äºè§£é‡Šæ•°æ®å­—æ®µã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ ‡ç­¾ä¸º 372 çš„èˆªå‘å‚è€ƒç³»ç»Ÿæä¾›äº†é£å‘ä¿¡æ¯ï¼Œè€Œæ ‡ç­¾ä¸º 203 çš„ç©ºæ°”æ•°æ®è®¡ç®—æœºåˆ™æä¾›æ°”å‹é«˜åº¦ï¼Œ312 åˆ™è¡¨ç¤ºåœ°é¢é€Ÿåº¦ã€‚è¿™æ ·çš„æ ‡å‡†åŒ–æ ‡ç­¾ä½¿å¾—ä¸åŒå‚å•†çš„è®¾å¤‡èƒ½å¤Ÿä½¿ç”¨ç›¸åŒçš„å‚æ•°å®šä¹‰ã€‚ SDI: 2 ä½æºç›®çš„åœ°æ ‡è¯†ç¬¦ï¼Œå¸®åŠ©å‘é€å™¨è¯†åˆ«æ¶ˆæ¯åº”å‘é€ç»™å“ªä¸ªæ¥æ”¶å™¨ï¼Œè‹¥ä¸éœ€è¦è¯¥æ ‡è¯†ç¬¦ï¼Œè¿™éƒ¨åˆ†å¯ä»¥ç”¨ä½œé¢å¤–çš„æ•°æ®ä½ã€‚ DATA: 19 ä½æ•°æ®éƒ¨åˆ†ï¼Œæ‰¿è½½å…·ä½“çš„æ•°å€¼ä¿¡æ¯ã€‚ SSM: ç¬¦å·çŠ¶æ€çŸ©é˜µï¼Œæä¾›ä¿¡æ¯çš„çŠ¶æ€æŒ‡ç¤ºã€‚ P: å¥‡å¶æ ¡éªŒä½ç”¨äºé”™è¯¯æ£€æµ‹ï¼Œé‡‡ç”¨å¥‡æ•°å¥‡å¶æ ¡éªŒç¡®ä¿æ•°æ®æ¥æ”¶çš„å‡†ç¡®æ€§ã€‚ARINC 429 ä»…è§„å®šæ£€æµ‹é”™è¯¯çš„æ–¹æ³•ï¼Œè€Œä¸åŒ…æ‹¬çº é”™æœºåˆ¶ã€‚ SSM çš„çŠ¶æ€å¯æ ¹æ® LABEL çš„ä¸åŒè€Œæœ‰æ‰€ä¸åŒï¼Œå¦‚ä¸‹ï¼š 00 (0)ï¼šæ•…éšœï¼› 01 (1)ï¼šæ— è®¡ç®—æ•°æ®æˆ–è¾“å‡ºæ— æ•ˆï¼› 10 (2)ï¼šåŠŸèƒ½å®éªŒï¼› 11 (3)ï¼šæ­£å¸¸ã€‚ #include stdio.htypedef unsigned int uint32_t;// è·å–äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ä½1çš„ä¸ªæ•°int getBit1Count(uint32_t x) uint32_t i = 0, count = 0, temp = x; for (i = 0; i 32; i++) if (1 == (temp 0x00000001)) count++; // å¦‚æœæœ€ä½ä½ä¸º1ï¼Œè®¡æ•°å¢åŠ  temp = temp 1; // å³ç§»ä¸€ä½ï¼Œæ£€æŸ¥ä¸‹ä¸€ä½ return count; // è¿”å›1çš„æ€»æ•°// è®¾ç½®æ ¡éªŒä½uint32_t setCheckBit(uint32_t x) // å¦‚æœå½“å‰xä¸­1çš„ä¸ªæ•°ä¸ºå¶æ•°ï¼Œåˆ™è®¾ç½®æ ¡éªŒä½ if (getBit1Count(x) % 2 == 0) x = x ^ 0x80000000; // 0x80000000åœ¨äºŒè¿›åˆ¶ä¸­ä¸º1000...0000 else x = x ^ 0x00000000; // å¦‚æœå·²ç»æ˜¯å¥‡æ•°ä¸ª1ï¼Œä¸åšæ”¹å˜ return x; // è¿”å›æ–°çš„æ•°å€¼// æ‰“å°å‡ºæ¯ä¸€ä½çš„å€¼void print_bits(uint32_t x) uint32_t i = 0; for (i = 0; i 32; i++) printf(%d, (x 0x80000000) 31); // è¾“å‡ºæœ€é«˜ä½ x = x 1; // å·¦ç§»ï¼Œæ£€æŸ¥ä¸‹ä¸€ä¸ªä½ // æ£€æŸ¥æ ¡éªŒä½å¹¶è¿˜åŸåŸå§‹å€¼uint32_t checkAndRestore(uint32_t x) uint32_t bit1Count = getBit1Count(x); // è·å–1çš„ä¸ªæ•° if (bit1Count % 2 == 0) printf(é”™è¯¯! ); // è¾“å‡ºé”™è¯¯ä¿¡æ¯ return 0; // è¿”å›0ï¼Œè¡¨ç¤ºå‡ºé”™ else printf(æ­£ç¡®! ); // æ ¡éªŒæˆåŠŸçš„æç¤º // åˆ æ‰æœ€é«˜ä½çš„æ ¡éªŒä½ x = x 0x7FFFFFFF; // é€šè¿‡ä¸è¿ç®—æ¸…é™¤æœ€é«˜ä½ return x; // è¿”å›è¿˜åŸåçš„æ•°å€¼int main() uint32_t data[] = 0, 100, 101, 1001, 0x23456; // åˆå§‹åŒ–æµ‹è¯•æ•°æ® uint32_t i = 0, set; // éå†æ¯ä¸ªæ•°æ®å¹¶è¿›è¡Œå¤„ç† for (i = 0; i 5; i++) printf(è®¾ç½®æ ¡éªŒä½ä¹‹å‰: ); print_bits(data[i]); // æ‰“å°äºŒè¿›åˆ¶è¡¨ç¤º printf(,%dä¸ª1, 0x%x , getBit1Count(data[i]), data[i]); // æ‰“å°1çš„ä¸ªæ•°å’Œåå…­è¿›åˆ¶å€¼ set = setCheckBit(data[i]); // è®¾ç½®æ ¡éªŒä½ printf(è®¾ç½®æ ¡éªŒä½ä¹‹å: ); print_bits(set); printf(,%dä¸ª1, 0x%x , getBit1Count(set), set); // æ‰“å°è®¾ç½®åæ•°æ®çš„çŠ¶æ€ printf(æ ¡éªŒå’Œè¿˜åŸ:0x%x , checkAndRestore(set)); // æ ¡éªŒå¹¶è¿˜åŸ printf(------- ); // åˆ†éš”çº¿ return 0; è¾“å‡º è®¾ç½®æ ¡éªŒä½ä¹‹å‰: 00000000000000000000000000000000,0ä¸ª1, 0x0è®¾ç½®æ ¡éªŒä½ä¹‹å: 10000000000000000000000000000000,1ä¸ª1, 0x80000000æ­£ç¡®! æ ¡éªŒå’Œè¿˜åŸ:0x0-------è®¾ç½®æ ¡éªŒä½ä¹‹å‰: 00000000000000000000000001100100,3ä¸ª1, 0x64è®¾ç½®æ ¡éªŒä½ä¹‹å: 00000000000000000000000001100100,3ä¸ª1, 0x64æ­£ç¡®! æ ¡éªŒå’Œè¿˜åŸ:0x64-------è®¾ç½®æ ¡éªŒä½ä¹‹å‰: 00000000000000000000000001100101,4ä¸ª1, 0x65è®¾ç½®æ ¡éªŒä½ä¹‹å: 10000000000000000000000001100101,5ä¸ª1, 0x80000065æ­£ç¡®! æ ¡éªŒå’Œè¿˜åŸ:0x65-------è®¾ç½®æ ¡éªŒä½ä¹‹å‰: 00000000000000000000000001111101001,7ä¸ª1, 0x3e9è®¾ç½®æ ¡éªŒä½ä¹‹å: 00000000000000000000000001111101001,7ä¸ª1, 0x3e9æ­£ç¡®! æ ¡éªŒå’Œè¿˜åŸ:0x3e9-------è®¾ç½®æ ¡éªŒä½ä¹‹å‰: 00000000000000100011010001010110,8ä¸ª1, 0x23456è®¾ç½®æ ¡éªŒä½ä¹‹å: 10000000000000100011010001010110,9ä¸ª1, 0x80023456æ­£ç¡®! æ ¡éªŒå’Œè¿˜åŸ:0x23456------- â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ones â”‚ tens â”‚ hundreds â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”LSB â”‚ 8 â”‚ 7 â”‚ 6 â”‚ 5 â”‚ 4 â”‚ 3 â”‚ 2 â”‚ 1 â”‚ MSB â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜LSB: æœ€ä½æœ‰æ•ˆä½ MSB: æœ€é«˜æœ‰æ•ˆä½ æ³¨æ„åˆ°ï¼Œä¸Šè¿°è¡¨ä¸­çš„æœ€ä½æœ‰æ•ˆä½ï¼ˆLSBï¼‰å’Œæœ€é«˜æœ‰æ•ˆä½ï¼ˆMSBï¼‰æ¦‚å¿µç›¸å¯¹è¾ƒä¸ºç‰¹æ®Šï¼Œå’Œä»¬å¹³æ—¶ç†è§£çš„å¯èƒ½æ˜¯åç€çš„ã€‚ å¹¶ä¸”ï¼Œ8 ä½æ•°å­—è¢«åˆ’åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œå…¶ä¸­ç™¾ä½æ•°é€šå¸¸ç”¨äºŒè¿›åˆ¶ 11 è¡¨ç¤ºï¼Œå³ä¸ºæ•°å­— 3ï¼Œè€Œåä½æ•°å’Œä¸ªä½æ•°æœ€å¤šå¯ä»¥ç”¨äºŒè¿›åˆ¶ 111 è¡¨ç¤ºï¼Œä¹Ÿå°±æ˜¯æ•°å­— 7ã€‚å› æ­¤ï¼Œä¸Šè¿°å†…å®¹å®é™…ä¸Šæ˜¯åœ¨å°† 8 ä½æ•°å­—åˆ†æˆä¸‰æ®µï¼Œæ¯æ®µè¡¨ç¤ºä¸€ä¸ª 8 è¿›åˆ¶æ•°ï¼Œä¸”é«˜ä½ä½é¡ºåºç›¸åã€‚è¿™ç§è¡¨ç¤ºæ–¹å¼è¢«ç§°ä¸º åå‘å…«è¿›åˆ¶ã€‚ æœ€å¤§çš„ Label å€¼ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œæœ€å¤§çš„ Label å€¼ä¸º 377ï¼Œè¿™å¯¹åº”äº†å…«è¿›åˆ¶ä¸­çš„æœ€å¤§ä¸‰ä½æ•°ã€‚ å®é™…ç¤ºä¾‹ä»¥ 312 ä½œä¸ºé£æœºçš„ ground speed è¿›è¡Œç¼–ç çš„ç¤ºä¾‹ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š ç™¾ä½æ•°ï¼š å–å‡ºæ•° 3ï¼Œå®ƒç”¨äºŒè¿›åˆ¶ 11 è¡¨ç¤ºã€‚åœ¨åè½¬é«˜ä½ä½åï¼Œç»“æœä»ä¸º 11ã€‚ åä½æ•°ï¼š å–å‡ºæ•° 1ï¼Œå®ƒç”¨ä¸‰ä½äºŒè¿›åˆ¶è¡¨ç¤ºä¸º 001ã€‚åœ¨åè½¬é«˜ä½ä½åï¼Œå¾—åˆ° 100ã€‚ ä¸ªä½æ•°ï¼š å–å‡ºæ•° 2ï¼Œç”¨ä¸‰ä½äºŒè¿›åˆ¶è¡¨ç¤ºä¸º 010ï¼Œåè½¬åä¿æŒä¸º 010ã€‚ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä»¬çš„æ¯ä¸€ä½éƒ½è¢«å¤„ç†å¹¶æ­£ç¡®ç¼–ç ã€‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ ones â”‚ tens â”‚ hundreds â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ 2 â”‚ 1 â”‚ 3 â”‚ â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¤ MSB â”‚ 0 â”‚ 1 â”‚ 0 â”‚ 1 â”‚ 0 â”‚ 0 â”‚ 1 â”‚ 1 â”‚ LSB â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜ é€šè¿‡å¯¹ç…§ ARINC429P1 çš„ ATTACHMENT 6 ä¸­çš„å€¼ï¼Œå¯ä»¥ç¡®è®¤ä¸Šè¿°ç¼–ç è¿‡ç¨‹çš„æ­£ç¡®æ€§ã€‚ ç¤ºä¾‹ä»£ç ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•å®ç°è¿™ç§ç¼–ç åŠè§£ç ã€‚ #include stdio.htypedef unsigned int uint32_t;// æ‰“å°å‡ºæ¯ä¸€ä½void print_bits(uint32_t x) uint32_t i = 0; for (i = 0; i 32; i++) printf(%d, (x 0x80000000) 31); x = x 1; // ç¿»è½¬æŒ‡å®šæ•°çš„æ¯”ç‰¹ä½uint32_t reverse_bits(uint32_t x, uint32_t from, uint32_t to) uint32_t result = 0; for (uint32_t i = from; i = to; i++) result += (x i 1) (to - i); return result;// ç¼–ç å‡½æ•°uint32_t encodeLabel(uint32_t word, uint32_t x) if (x 377) printf(out of range); return 0; // æ¸…é›¶wordçš„å‰8ä½ word = 0xffffff00; // ç¼–ç ç™¾ä½æ•° uint32_t hundreds = (x % 1000) / 100; hundreds = reverse_bits(hundreds, 0, 1); word = word | hundreds; // ç¼–ç åä½æ•° uint32_t tens = (x % 100) / 10; tens = reverse_bits(tens, 0, 2); word = word | (tens 2); // ç¼–ç ä¸ªä½æ•° uint32_t ones = x % 10; ones = reverse_bits(ones, 0, 2); word = word | (ones 5); return word;int main() print_bits(reverse_bits(0x4, 0, 2)); // Outputs: 100 - 001 printf( ); print_bits(reverse_bits(0x1, 0, 2)); // Outputs: 001 - 100 printf( ); print_bits(reverse_bits(0x1, 0, 31)); // Outputs: 1 - 10000000000000000000000000000000 printf( ------------ ); uint32_t word = 0x22849800; print_bits(encodeLabel(word, 313)); printf( ); print_bits(encodeLabel(word, 323)); printf( ); return 0; è¾“å‡ºç»“æœè¿è¡Œåç¨‹åºçš„è¾“å‡ºç»“æœç¤ºä¾‹ï¼š 00000000000000000000000000000001 00000000000000000000000000000100 10000000000000000000000000000000 ------------ 00100010100001001001100011010011 00100010100001001001100011001011 è§£ç è¿‡ç¨‹ç†è§£äº†ç¼–ç ä¹‹åï¼Œè§£ç ä¾¿å˜å¾—ç®€å•ã€‚ä»¥ä¸‹æ˜¯è§£ç çš„å®ç°ï¼š uint32_t decodeLabel(uint32_t word) // è·å–ä½8ä½ word = 0xff; // å¾—åˆ°ç™¾ä½æ•° uint32_t hundreds = word 0x3; hundreds = reverse_bits(hundreds, 0, 1); // å¾—åˆ°åä½æ•° uint32_t tens = (word 2) 0x7; tens = reverse_bits(tens, 0, 2); // å¾—åˆ°ä¸ªä½æ•° uint32_t ones = (word 5) 0x7; ones = reverse_bits(ones, 0, 2); return hundreds * 100 + tens * 10 + ones; é™„åŠ ä¿¡æ¯åœ¨è®¡ç®—æœºç³»ç»Ÿå’Œæ•°æ®å¤„ç†é¢†åŸŸï¼Œè¿˜æœ‰ä¸€äº›é‡è¦çš„ç¼–ç æ ‡å‡†å’ŒæŠ€æœ¯ï¼Œä¾‹å¦‚ï¼š BNRï¼šäºŒè¿›åˆ¶è¡¥ç å°æ•° BCDï¼šäºŒè¿›åˆ¶ç¼–ç åè¿›åˆ¶ IOS5ï¼šIOS5 ç¼–ç çš„å­—æ¯ä¸æ•°å­— ç¦»æ•£é‡ï¼šç”¨äºå¤„ç†ä¸è¿ç»­çš„æ•°æ® å›¾å½¢è¡¨ç¤ºï¼šåœ¨åœ°å›¾å’Œæ˜¾ç¤ºå™¨ä¸Šæ˜¾ç¤ºçš„çº¿æ¡ã€åœ†å½¢ä»¥åŠæ–‡å­—æ•°å­—ï¼Œè¿™äº›é€šå¸¸ä½¿ç”¨ä¸ ISO 5 å­—æ¯æ•°å­—æ•°æ®ä¼ è¾“ç±»ä¼¼çš„æŠ€æœ¯ã€‚ARINC ç‰¹æ€§ 744A æä¾›äº†å…·å¤‡å›¾å½¢åŠŸèƒ½çš„å…¨æ ¼å¼æ‰“å°æœºï¼Œè¿™ä½¿å¾—é™„åŠ ä¿¡æ¯å’Œç¤ºä¾‹å›¾å½¢å­—ç¬¦çš„ä¼ è¾“æˆä¸ºå¯èƒ½ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","èˆªç”µç³»ç»Ÿ"]},{"title":"ARINC653","path":"/2023/09/08/5-åµŒå…¥å¼å¼€å‘-èˆªç”µç³»ç»Ÿ-ARINC653/","content":"ARINC653 ä»‹ç»ARINC653 ä½œä¸ºä¸€ä¸ªæ ‡å‡†ï¼Œä¸»è¦é˜è¿°äº†æ¨¡å—åŒ–ç»¼åˆèˆªç©ºç”µå­è®¾å¤‡ IMA(Integrated Modular Avionics)ä½¿ç”¨çš„åº”ç”¨è½¯ä»¶çš„åŸºçº¿æ“ä½œç¯å¢ƒã€‚å…¶å®šä¹‰äº†èˆªç©ºåº”ç”¨ä¸ä¸‹å±‚æ“ä½œç¯å¢ƒä¹‹é—´çš„æ¥å£å’Œæ•°æ®äº¤æ¢çš„æ¨¡å¼ä»¥åŠæœåŠ¡çš„è¡Œä¸ºï¼Œå¹¶æè¿°äº†åµŒå…¥å¼èˆªç©ºç”µå­è½¯ä»¶çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚ åœ¨å®é™…åº”ç”¨è¿‡ç¨‹ä¸­ï¼Œèˆªç©ºç”µå­ä¸­çš„æ ¸å¿ƒæ¨¡å—è½¯ä»¶åŒ…æ‹¬ä¸¤ç±»: åº”ç”¨è½¯ä»¶å’Œæ ¸å¿ƒè½¯ä»¶ã€‚ARINC653 å®šä¹‰çš„å°±æ˜¯ä½äºåº”ç”¨è½¯ä»¶å’Œæ“ä½œç³»ç»Ÿ OS ä¹‹é—´çš„ APEX(APplication EXecutive)æ¥å£ï¼ŒAPEX æ¥å£æ˜¯æ“ä½œç³»ç»Ÿä¸ºåº”ç”¨è½¯ä»¶æä¾›çš„ä¸€ä¸ªåŠŸèƒ½é›†åˆã€‚åˆ©ç”¨è¿™ä¸ªåŠŸèƒ½é›†åˆï¼Œåº”ç”¨è½¯ä»¶å¯ä»¥æ§åˆ¶ç³»ç»Ÿçš„è°ƒåº¦ï¼Œé€šä¿¡å’Œå†…éƒ¨çŠ¶æ€ä¿¡æ¯ã€‚ APEX æ¥å£ç›¸å½“äºä¸ºåº”ç”¨æä¾›çš„ä¸€ç§é«˜å±‚è¯­è¨€ã€‚ è€Œå¯¹äº OS æ¥è¯´ï¼Œæ˜¯å…³äºå‚æ•°å’Œå…¥å£æœºåˆ¶çš„å®šä¹‰ã€‚ ARINC653 æ ‡å‡†ä¸€ä¸ªé‡è¦çš„æ ‡å‡†å°±æ˜¯å°†èˆªç©ºç”µå­è½¯ä»¶è¿›è¡Œåˆ†æ—¶ï¼Œåˆ†åŒºç®¡ç†ã€‚é‡‡ç”¨äºŒçº§è°ƒåº¦ï¼Œåˆ†åŒºå†…åŸºäºä¼˜å…ˆçº§è¿›è¡Œè°ƒåº¦ï¼Œåˆ†åŒºé—´é€šè¿‡æ—¶é—´çª—å£è¿›è¡Œæ—¶é—´è½®è½¬è°ƒåº¦ã€‚åŒæ—¶å®šä¹‰äº†åˆ†åŒºå†…çš„è¿›ç¨‹æ¥å£ï¼Œè¿›ç¨‹é—´é€šä¿¡æ¥å£ï¼Œåˆ†åŒºé—´é€šä¿¡çš„ Port æ ‡å‡†æ¥å£ï¼Œå¹¶ä¸”ä¸ºäº†å¢å¼ºç³»ç»Ÿçš„å¯é æ€§å®šä¹‰äº†ç³»ç»Ÿçº§ï¼Œåˆ†åŒºçº§ï¼Œè¿›ç¨‹çº§åˆ«çš„å¥åº·ç›‘æ§ç®¡ç†æ¥å£ã€‚ åˆ†åŒºå’ŒåŒºé—´ç®¡ç†åˆ†åŒºï¼ˆPartitioningï¼‰æ˜¯ ARINC653 ä¸­ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚åœ¨ IMA(Integrated Modular Avionics)ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ä¼šåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªèˆªç©ºç”µå­åº”ç”¨ï¼Œå¹¶ä¸”è¿™äº›åº”ç”¨è¦èƒ½å¤Ÿç‹¬ç«‹è¿è¡Œã€‚åˆ†åŒºå°±æ˜¯èˆªç©ºç”µå­åº”ç”¨ä¸­çš„ä¸€ä¸ªåŠŸèƒ½åˆ’åˆ†ã€‚åˆ†åŒºçš„å•ä½ç§°ä¸ºåŒºé—´ï¼ŒåŒºé—´å†…çš„æ¯ä¸€ä¸ªæ‰§è¡Œå•å…ƒç§°ä¸ºè¿›ç¨‹ã€‚æ¯ä¸€ä¸ªåŒºé—´å…·æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®ã€ä¸Šä¸‹æ–‡å’Œè¿è¡Œç¯å¢ƒï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯èƒ½å¤Ÿé˜²æ­¢ä¸€ä¸ªåŒºé—´çš„é”™è¯¯å½±å“åˆ°å…¶ä»–åŒºé—´ã€‚å¦å¤–ï¼Œå®ƒèƒ½ä½¿å¾—æ•´ä¸ªç³»ç»Ÿå®¹æ˜“éªŒè¯ã€ç¡®è®¤å’Œè®¤è¯ã€‚ åŒºé—´åŒ–ä»¥åŠåŒºé—´çš„ç®¡ç†å’Œè°ƒåº¦æ˜¯ç”± OS æ¥å®ç°çš„ã€‚ARINC653 ä¸ºåŒºé—´çš„è°ƒåº¦è§„å®šäº†ä¸€ç§åŸºäºæ—¶é—´çª—çš„å¾ªç¯è°ƒåº¦ç®—æ³•ã€‚ ä¸ºäº†å®Œæˆå„åŒºé—´çš„å‘¨æœŸæ€§è°ƒåº¦ï¼Œç”± OS ç»´æŠ¤ä¸€ä¸ªå›ºå®šæ—¶é—´é•¿åº¦çš„ä¸»æ—¶é—´æ¡†æ¶ï¼Œè¯¥æ—¶é—´æ¡†æ¶åœ¨æ¨¡å—çš„è¿è¡ŒæœŸå†…å‘¨æœŸæ€§çš„é‡å¤ã€‚æ¯ä¸ªæ—¶é—´æ¡†æ¶å¯ä»¥åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ—¶é—´çª—å£ã€‚ç³»ç»Ÿåˆ©ç”¨ä¸€ä¸ªäº‹å…ˆç¡®å®šçš„é…ç½®è¡¨,åœ¨è§„å®šçš„æ—¶é—´çª—å£å†…æ¿€æ´»å¯¹åº”åŒºé—´çš„è¿è¡Œã€‚è¿™æ ·å°±èƒ½å¤Ÿä¿è¯æ¯ä¸ªåº”ç”¨åœ¨åˆ†é…ç»™å®ƒçš„æ—¶é—´å‘¨æœŸå†…è®¿é—®å…¬å…±èµ„æºä¸è¢«æ‰“æ–­ã€‚ ARINC supplement 1 å¯¹ä¸»æ—¶é—´æ¡†æ¶çš„æ—¶é—´å®šä¹‰åŸåˆ™è¿›è¡Œäº†è¡¥å……ã€‚å®ƒè§„å®šä¸»æ—¶é—´æ¡†æ¶çš„å¤§å°åº”è¯¥æ˜¯æ ¸å¿ƒæ¨¡å—ä¸­æ‰€æœ‰åŒºé—´å‘¨æœŸçš„æœ€å°å…¬å€æ•°çš„æ­£æ•´æ•°å€ï¼Œå¹¶åº”è€ƒè™‘åˆ°æ¯ä¸ªåŒºé—´æ¯æ¬¡æ‰§è¡Œçš„æ—¶é—´é•¿åº¦å’Œæ‰§è¡Œé¢‘ç‡ã€‚ åœ¨ ARINC653 Supplement 1 å‘å¸ƒæ—¶åˆå¢åŠ äº†ç³»ç»ŸåŒºé—´å±æ€§å’Œå¯åŠ¨æ¡ä»¶å±æ€§ã€‚åŒºé—´çš„å·¥ä½œæ¨¡å¼åŒ…æ‹¬ç©ºé—²ï¼Œå†·å¯åŠ¨ï¼Œçƒ­å¯åŠ¨å’Œæ­£å¸¸å››ç§ï¼Œå¦‚å›¾ 3 æ‰€ç¤ºã€‚æ¯ä¸ªåŒºé—´æ‰€éœ€èµ„æºåœ¨ç³»ç»Ÿæ„å»ºæ—¶æŒ‡å®šï¼Œåœ¨åŒºé—´åˆå§‹åŒ–å®Œæˆæ—¶åŒºé—´å¯¹è±¡åˆ›å»ºã€‚OS åœ¨è¿›å…¥è¿è¡Œæ¨¡å¼æ—¶å¯åŠ¨åº”ç”¨åŒºé—´ï¼Œç„¶ååŒºé—´è¿›å…¥æ­£å¸¸è¿è¡Œæ¨¡å¼ã€‚ç›‘æµ‹ç®¡ç†åŠŸèƒ½åœ¨å“åº”è‡´å‘½é”™è¯¯æ—¶å°†é‡å¯åŒºé—´æˆ–è€…åœæ­¢åŒºé—´çš„è¿è¡Œã€‚ æ ¹æ® ARINC653 æ ‡å‡†çš„è§„å®šï¼Œéœ€è¦æ¨¡å—æ“ä½œç³»ç»Ÿæä¾›æ—¶ç©ºéš”ç¦»æœºåˆ¶çš„æ”¯æŒï¼Œå› æ­¤å†…æ ¸å’Œåˆ†åŒºåº”ç”¨åœ¨ç©ºé—´ä¸Šå’Œæ—¶é—´ä¸Šåº”è¿›è¡Œéš”ç¦»ä¿æŠ¤ã€‚ ä¸‹é¢åˆ†ä¸¤éƒ¨åˆ†è®ºè¿°ç³»ç»Ÿç©ºé—´æ—¶é—´åˆ†é…ï¼Œé¦–å…ˆæ˜¯åŸºäºæ•´ä¸ªæ¨¡å—æ“ä½œç³»ç»Ÿçš„ç©ºé—´å’Œæ—¶é—´åˆ†é…æƒ…å†µï¼Œåé¢æ˜¯åŸºäº APEX æ¥å£çš„å®ç°ä¸Šçš„ç©ºé—´å’Œæ—¶é—´åˆ†é…ã€‚ â—ç©ºé—´éš”ç¦» åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œä»¥åˆ†åŒºä¸ºèµ„æºåˆ†é…å•ä½ã€‚é‡‡ç”¨å¤å¹³é¢ç©ºé—´çš„æ–¹å¼ï¼Œæ¯ä¸ªåº”ç”¨éƒ½æœ‰ç‹¬ç«‹çš„ 4G ç©ºé—´ï¼Œä»è€Œå®ç°ç”¨æˆ·ä¸æ“ä½œç³»ç»Ÿï¼Œç”¨æˆ·ä¸ç”¨æˆ·ä¹‹é—´åœ¨å­˜å‚¨ç©ºé—´ä¸Šè¿›è¡Œéš”ç¦»ï¼Œè¾¾åˆ°äº’ä¸å½±å“çš„ç›®çš„ã€‚ ä» APEX æ¥å£çš„è®¾è®¡å®ç°ä¸Šæ¥è®²ï¼Œç©ºé—´åˆ†é…åŒ…å«ä¸¤éƒ¨åˆ†çš„å†…å®¹ï¼š APEX åˆ†åŒºä¸Šçš„èµ„æºåˆ†é… å³ä½¿ç”¨çš„æ˜¯åº”ç”¨åˆ†åŒºä¸Šçš„ç©ºé—´èµ„æºï¼ŒåŒ…æ‹¬äº†å„ä¸ª APEX å¯¹è±¡ç®¡ç†æ§åˆ¶å—èµ„æºã€‚ åˆ†åŒºç®¡ç† è¿›ç¨‹ç®¡ç† åˆ†åŒºå¥åº·ç›‘æ§ ä¿¡å·é‡ äº‹ä»¶ é»‘æ¿ ç¼“å†² æ—¶é—´ç®¡ç† é‡‡æ ·ç«¯å£ é˜Ÿåˆ—ç«¯å£ å†…æ ¸ç©ºé—´çš„èµ„æºåˆ†é… ä¸»è¦æ˜¯ APEX æ¥å£è°ƒç”¨è¿‡ç¨‹ä¸­éœ€è¦åœ¨å†…æ ¸åˆ†é…çš„èµ„æºï¼Œåˆ—è¡¨å¦‚ä¸‹ï¼š å†…æ ¸çš„åŸŸç®¡ç† å†…æ ¸çš„ä»»åŠ¡ç®¡ç† å†…æ ¸çš„å‘¨æœŸå¯¹è±¡ç®¡ç† å†…æ ¸ä¿¡å·é‡ å†…æ ¸é»‘æ¿ å†…æ ¸æ¶ˆæ¯é˜Ÿåˆ—å¦å¤–ï¼Œåœ¨ APEX å†…æ ¸æ”¯æŒå±‚å°è£…çš„å¯¹åˆ†åŒºé—´é€šä¿¡çš„ç«¯å£çš„æ”¯æŒï¼Œä¹Ÿæ˜¯åœ¨å†…æ ¸ç©ºé—´åˆ†é…çš„ç«¯å£æ§åˆ¶ç®¡ç†èµ„æºï¼ŒåŒ…æ‹¬äº†ç«¯å£æ§åˆ¶é“¾å’Œé€šé“æ§åˆ¶é“¾ã€‚ â—æ—¶é—´éš”ç¦» ç›®å‰ OS ä¸ºåŸºäº APEX æ¥å£çš„åº”ç”¨åˆ†åŒºæä¾›äº†æ—¶é—´è°ƒåº¦è¡¨è°ƒåº¦ç­–ç•¥ã€‚é€šè¿‡é…ç½®æ—¶é—´è°ƒåº¦è¡¨ï¼Œå¯ä»¥æ§åˆ¶å„ä¸ªåˆ†åŒºåœ¨æ—¶é—´ç‚¹ä¸Šçš„è¿è¡Œåˆ†é…ã€‚ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ä¸€ä¸ªå›ºå®šæ—¶é—´é•¿åº¦çš„ä¸»æ—¶é—´æ¡†æ¶ï¼Œè¯¥æ—¶é—´æ¡†æ¶åœ¨æ¨¡å—çš„è¿è¡ŒæœŸå†…å‘¨æœŸæ€§çš„é‡å¤ã€‚æ¯ä¸ªæ—¶é—´æ¡†æ¶å¯ä»¥åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ—¶é—´çª—å£ã€‚ç³»ç»Ÿåˆ©ç”¨ä¸€ä¸ªäº‹å…ˆç¡®å®šçš„é…ç½®è¡¨ï¼Œåœ¨è§„å®šçš„æ—¶é—´çª—å£å†…æ¿€æ´»å¯¹åº”åŸŸçš„è¿è¡Œã€‚è¿™æ ·å°±èƒ½å¤Ÿä¿è¯æ¯ä¸ªåº”ç”¨åœ¨åˆ†é…ç»™å®ƒçš„æ—¶é—´å‘¨æœŸå†…è®¿é—®å…¬å…±èµ„æºä¸è¢«æ‰“æ–­ã€‚ æ¥å£æ¸…å• åˆ†åŒºç®¡ç†åˆ†åŒºæ˜¯ä¸€ä¸ªåº”ç”¨è¿è¡Œçš„èµ„æºå•ä½ã€‚ä¸€ä¸ªåˆ†åŒºæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åº”ç”¨ç¯å¢ƒï¼šå®ƒç”±æ•°æ®ã€è‡ªå·±çš„ä¸Šä¸‹æ–‡å…³ç³»ã€é…ç½®å±æ€§å’Œå…¶å®ƒé¡¹ç»„æˆã€‚åˆ†åŒºçš„è¿è¡Œè¦æ»¡è¶³æ—¶é—´å’Œç©ºé—´çš„è¦æ±‚ã€‚ é€šè¿‡åˆ†åŒºå¯ä»¥å®ç°åº”ç”¨é—´çš„éš”ç¦»å’Œä¿æŠ¤ï¼Œåˆ†åŒºä¹Ÿæ˜¯åº”ç”¨éš”ç¦»ä¿æŠ¤çš„å•ä½ï¼Œæ¯ä¸ªåˆ†åŒºæœ‰ç‹¬ç«‹çš„è¿è¡Œç©ºé—´å’Œå †ç©ºé—´ï¼Œä¸åŒåˆ†åŒºçš„è¿è¡Œç©ºé—´ä¸ä¼šé‡å ã€‚å½“ä¸€ä¸ªåº”ç”¨å‡ºç°è‡´å‘½é”™è¯¯ï¼Œå‡ºç°çš„æœ€åæƒ…å†µå°±æ˜¯åº”ç”¨è¢«ç³»ç»Ÿåˆ é™¤æˆ–è€…é‡å¯åŠ¨ã€‚è€Œè¿™ä¸ªåº”ç”¨çš„é”™è¯¯ä¸ä¼šå½±å“åˆ°å…¶ä»–åˆ†åŒºï¼Œæ›´ä¸ä¼šå½±å“åˆ°æ“ä½œç³»ç»Ÿå£ã€‚ åˆ†åŒºå…·æœ‰ç‹¬ç«‹çš„è°ƒåº¦ç­–ç•¥ï¼Œæ¯ä¸ªåˆ†åŒºåœ¨å±äºè‡ªå·±æ—¶é—´çª—å£å†…è¿è¡Œã€‚ ä¸€ä¸ªåˆ†åŒºåˆ™ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹ç»„æˆï¼Œåˆ†åŒºå†…çš„æ‰€æœ‰è¿›ç¨‹å°†å…±äº«åˆ†åŒºæ‰€å æœ‰çš„ç³»ç»Ÿèµ„æºã€‚åˆ†åŒºç®¡ç†è¦æ±‚ç³»ç»Ÿä¸­åŒæ—¶å¯ä»¥è¿è¡Œå¤šä¸ªä¸åŒç±»å‹çš„åº”ç”¨ï¼ŒåŒæ—¶åœ¨æ—¶é—´ä¸Šå’Œç©ºé—´ä¸Šäº’ä¸å½±å“ã€‚åˆ†åŒºç®¡ç†ä¸»è¦åŒ…æ‹¬ï¼šåˆ†åŒºçš„å±æ€§å®šä¹‰ã€åˆ†åŒºçš„å·¥ä½œçŠ¶æ€è½¬æ¢ã€åˆ†åŒºçš„æ§åˆ¶å’Œåˆ†åŒºçš„è°ƒåº¦ã€‚ å‡½æ•°åŠŸèƒ½ åˆ†åŒºçŠ¶æ€çš„è·å– è®¾ç½®åˆ†åŒºæ¨¡å¼ åˆ†åŒºé—´é€šä¿¡åˆ†åŒºé—´é€šä¿¡æ˜¯ ARINC 653 æ ‡å‡†ä¸­ä½¿ç”¨çš„ä¸€ç§é€šç”¨è¡¨è¾¾æ–¹å¼ï¼Œå…¶ä¸»è¦å®šä¹‰ä¸¤ä¸ªæˆ–å¤šä¸ªåˆ†åŒºé—´çš„é€šä¿¡ï¼Œæ ‡å‡†çš„åˆ†åŒºé—´é€šä¿¡æ˜¯ä¸€é¡¹åŸºæœ¬éœ€æ±‚ä»¥æ”¯æŒåº”ç”¨è½¯ä»¶çš„å¯é‡ç”¨æ€§å’Œå¯ç§»æ¤æ€§ã€‚æ‰€æœ‰çš„åˆ†åŒºé—´é€šä¿¡éƒ½é€šè¿‡æ¶ˆæ¯è¿›è¡Œã€‚æ¶ˆæ¯è¢«å®šä¹‰ä¸ºæœ‰é™é•¿åº¦çš„è¿ç»­æ•°æ®å—ã€‚ æ¶ˆæ¯ä»å•ä¸ªçš„æºå‘å‡ºï¼Œåˆ°ä¸€ä¸ªæˆ–å¤šä¸ªç›®æ ‡ã€‚æ¶ˆæ¯çš„ç›®æ ‡æ˜¯åˆ†åŒºè€Œä¸æ˜¯åˆ†åŒºå†…çš„è¿›ç¨‹ã€‚åˆ†åŒºé€šè¿‡å·²å®šä¹‰çš„è®¿é—®ç‚¹è®¿é—®é€šé“ï¼Œè®¿é—®ç‚¹ç§°ä¸ºç«¯å£(port)ã€‚é€šé“ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç«¯å£ä»¥åŠç›¸å…³çš„èµ„æºç»„æˆã€‚ç«¯å£æä¾›æ‰€éœ€çš„èµ„æºä»¥å…è®¸ç‰¹å®šçš„åˆ†åŒºåœ¨ç‰¹å®šçš„é€šé“ä¸­å‘é€æˆ–æ¥æ”¶æ¶ˆæ¯ã€‚åˆ†åŒºå¯ä»¥é€šè¿‡å„è‡ªçš„èµ„æºå’Œç›®çš„ç«¯å£ä½¿ç”¨å¤šä¸ªé€šé“äº¤æ¢æ¶ˆæ¯ã€‚é€šé“å°†ä¸€ä¸ªå‘é€ç«¯å£é€šè¿‡ä¸­é—´ç«¯å£å’Œä¸€ä¸ªæˆ–å¤šä¸ªæ¥æ”¶ç«¯å£è¿æ¥èµ·æ¥ã€‚æ¯ä¸ªå•ç‹¬çš„é€šé“éƒ½å¯ä»¥é…ç½®åœ¨ä¸“é—¨çš„æ¨¡å¼ä¸‹è¿è¡Œã€‚å¯ä»¥ä½¿ç”¨ä¸¤ç§ä¼ é€æ¨¡å¼ï¼Œé‡‡æ ·æ¨¡å¼(samplingmode)å’Œé˜Ÿåˆ—æ¨¡å¼(queuingmode)ã€‚å› æ­¤æä¾›äº†é‡‡æ ·ç«¯å£æœåŠ¡å’Œé˜Ÿåˆ—ç«¯å£æœåŠ¡ã€‚ åˆ†åŒºé—´é€šä¿¡éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š å‘é€æ–¹å’Œæ¥å—æ–¹å¹¶ä¸å…³å¿ƒå¯¹æ–¹çš„å…·ä½“åå­—å’Œç‰©ç†ä½ç½®ï¼Œä»¥é¿å…ç³»ç»Ÿçš„å…¶ä»–åœ°æ–¹ä¿®æ”¹ä¹‹åå¼•èµ·åˆ†åŒºçš„å˜åŒ–ã€‚ æ¶ˆæ¯åªèƒ½æœ‰ä¸€ä¸ªæºï¼Œä½†å¯ä»¥æœ‰è‹¥å¹²ä¸ªç›®çš„ï¼› æ¥è‡ªä¸åŒç«¯å£çš„æ¶ˆæ¯ä¸éœ€è¦æŒ‰ç…§å®ƒä»¬å‘é€çš„æ—¶é—´é¡ºåºåˆ°è¾¾å®ƒä»¬çš„ç›®çš„ã€‚ å‡½æ•°åŠŸèƒ½ é‡‡æ ·ç«¯å£æœåŠ¡ æ ¹æ®é‡‡æ ·ç«¯å£çš„å‘¨æœŸæ€§æ•°æ®ç‰¹ç‚¹ï¼Œé‡‡ç”¨å†…æ ¸æä¾›çš„é»‘æ¿æœºåˆ¶æ¥å®ç°ã€‚åœ¨åˆ†åŒºä¹‹ä¸Šçš„ APEX æ¥å£å°è£…å±‚æä¾›é…ç½®åˆå§‹åŒ–åŠŸèƒ½ï¼Œæä¾›æ ‡å‡†çš„ APEX è°ƒç”¨æ¥å£ã€‚åœ¨ APEX å†…æ ¸æ”¯æŒå±‚æ¥å®ç°å…·ä½“çš„é»‘æ¿å†™å’Œè¯»åŠŸèƒ½ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æºç«¯å£ä¸ç”¨åˆ›å»ºå¯¹åº”çš„é»‘æ¿ã€‚APEX å†…æ ¸æ”¯æŒå±‚åªä¸ºç›®çš„ç«¯å£åˆ›å»ºå¯¹åº”çš„é»‘æ¿ã€‚ ç”±äºé‡‡æ ·ç«¯å£çš„æ•°æ®å…·æœ‰å‘¨æœŸæ€§ç‰¹ç‚¹ï¼Œå› æ­¤å­˜åœ¨æ•°æ®æœ‰æ•ˆæ€§åˆ¤æ–­ã€‚å¯¹é‡‡æ ·ç«¯å£æ•°æ®æœ‰æ•ˆæ€§çš„å®šä¹‰å¦‚ä¸‹ï¼šæ•°æ®åœç•™åœ¨ç«¯å£çš„æ—¶é—´å°äºç”¨æˆ·è®¾ç½®çš„æ•°æ®åˆ·æ–°å‘¨æœŸæ—¶é—´ã€‚ æ•°æ®åœç•™æ—¶é—´ä»ç«¯å£è·å–æ•°æ®çš„ç³»ç»Ÿæ—¶é—´ä¸€å‘é€æ•°æ®åˆ°ç«¯å£çš„ç³»ç»Ÿæ—¶é—´ã€‚ é˜Ÿåˆ—ç«¯å£æœåŠ¡ æ ¹æ®é˜Ÿåˆ—ç«¯å£çš„æ¶ˆæ¯é˜Ÿåˆ—æ•°æ®ç‰¹ç‚¹ï¼Œé‡‡ç”¨å†…æ ¸æä¾›çš„æ¶ˆæ¯é˜Ÿåˆ—æœºåˆ¶æ¥å®ç°ã€‚åœ¨åˆ†åŒºä¹‹ä¸Šçš„ APEX æ¥å£å°è£…å±‚æä¾›é…ç½®åˆå§‹åŒ–åŠŸèƒ½ï¼Œæä¾›æ ‡å‡†çš„ APEX è°ƒç”¨æ¥å£ã€‚åœ¨ APEXå†…æ ¸æ”¯æŒå±‚æ¥å®ç°å…·ä½“çš„æ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶åŠŸèƒ½ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æºç«¯å£ä¸ç”¨åˆ›å»ºå¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚APEX å†…æ ¸æ”¯æŒå±‚åªä¸ºç›®çš„ç«¯å£åˆ›å»ºå¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ è¿›ç¨‹ç®¡ç†å®Œæˆåº”ç”¨è¿›ç¨‹çš„ç®¡ç†ï¼Œè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿è¡Œçš„åŸºæœ¬å•ä½ã€‚ åœ¨åˆ†åŒºå†…çš„æ‰§è¡Œä½“æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ç»„æˆï¼Œæ¯ä¸ªè¿›ç¨‹éš¶å±äºç‰¹å®šçš„åˆ†åŒºï¼Œåˆ†åŒºå†…çš„å„è¿›ç¨‹ä¹‹é—´å¹¶å‘æ‰§è¡Œã€‚è¿›ç¨‹ç®¡ç†ä¸»è¦è´Ÿè´£åˆ†åŒºå†…è¿›ç¨‹çš„åˆ›å»ºã€è°ƒåº¦å’Œåˆ é™¤ç­‰ç®¡ç†å·¥ä½œã€‚ è¿›ç¨‹åˆ†ä¸ºæŒ‰å›ºå®šé¢‘ç‡æ‰§è¡Œçš„å‘¨æœŸè¿›ç¨‹å’Œç”±äº‹ä»¶è§¦å‘çš„éå‘¨æœŸè¿›ç¨‹ä¸¤ç±»ï¼Œæ“ä½œç³»ç»Ÿåº”å…·å¤‡å¯¹è¿™ä¸¤ç±»è¿›ç¨‹çš„è°ƒåº¦èƒ½åŠ›ï¼›è¿›ç¨‹åœ¨å‡ºç°æ•…éšœæ—¶åº”å…è®¸é‡æ–°åˆå§‹åŒ–æˆ–è€…ç»ˆæ­¢ï¼›å¯¹äºè®¿é—®ä¸´ç•ŒåŒºçš„è¿›ç¨‹ï¼Œä¸ºä¿è¯å®‰å…¨æ€§ï¼Œåœ¨è®¿é—®æ—¶è¿›ç¨‹ç®¡ç†åº”ç¦æ­¢è°ƒåº¦ã€‚ å‡½æ•°åŠŸèƒ½ åˆ›å»ºè¿›ç¨‹ åœæ­¢è¿›ç¨‹ æŒ‚èµ·è¿›ç¨‹ è§£æŒ‚è¿›ç¨‹ è®¾ç½®è¿›ç¨‹ä¼˜å…ˆçº§ åˆ†åŒºå†…é€šä¿¡æ”¯æŒåˆ†åŒºå†…çš„è¿›ç¨‹ä¹‹é—´ç›¸äº’é€šä¿¡ã€‚æŒ‰é€šä¿¡æœºåˆ¶åˆ’åˆ†ï¼Œåˆ†åŒºå†…é€šä¿¡å…±æœ‰ä¸¤ç§ã€‚ä¸€ç§æ˜¯ç¼“å†²åŒºå’Œé»‘æ¿ï¼Œç”¨äºè¿›ç¨‹é—´é€šä¿¡ã€‚å¦ä¸€ç§æ˜¯ä¿¡å·é‡å’Œäº‹ä»¶ï¼Œç”¨äºè¿›ç¨‹é—´åŒæ­¥ã€‚ ç¼“å†²åŒºå’Œé»‘æ¿çš„å·®åˆ«æ˜¯ï¼šç¼“å†²åŒºå…è®¸æ¶ˆæ¯ä»¥é˜Ÿåˆ—çš„å½¢å¼å­˜å‚¨ï¼Œæ¶ˆæ¯ä¸å…è®¸è¦†ç›–ï¼Œè€Œé»‘æ¿åœ¨ä»»ä½•æ—¶åˆ»æœ€å¤šåªä¿ç•™ä¸€ä¸ªæ¶ˆæ¯ï¼Œæ¶ˆæ¯å…è®¸è¦†ç›–ï¼›ä¿¡å·é‡å’Œäº‹ä»¶çš„å·®åˆ«æ˜¯ï¼šä¿¡å·é‡ç”¨äºå¯¹ç³»ç»Ÿèµ„æºçš„è®¿é—®ï¼Œè€Œäº‹ä»¶ç”¨æ¥å®Œæˆè¿›ç¨‹ä¹‹é—´çš„åŒæ­¥ï¼å¼‚æ­¥æ“ä½œã€‚ æä¾›äº†ä¸¤ç§åˆ†åŒºå†…é€šä¿¡æœºåˆ¶ï¼š å‡½æ•°åŠŸèƒ½ å…è®¸åˆ†åŒºå†…è¿›ç¨‹é—´é€šè¿‡ç¼“å†²åŒºå’Œé»‘æ¿è¿›è¡Œé€šä¿¡ã€‚ é€šè¿‡è®¡æ•°ä¿¡å·é‡æˆ–äº‹ä»¶å®ç°è¿›ç¨‹é—´çš„åŒæ­¥ã€‚ ç¼“å†² Bufferæ¶ˆæ¯é˜Ÿåˆ— MessageQueueåœ¨ç¼“å†²åŒºä¸­ï¼Œæ¶ˆæ¯çš„æ¯ä¸ªæ–°å®ä¾‹éƒ½æºå¸¦å”¯ä¸€ä¸åŒçš„æ•°æ®ï¼Œå› æ­¤ä¼ é€æ—¶ä¸å…è®¸è¦†ç›–å‰ä¸€ä¸ªã€‚ç¼“å†²å…è®¸åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­å­˜å‚¨å¤šä¸ªæ¶ˆæ¯ã€‚å‘é€è¿›ç¨‹å‘é€çš„æ¶ˆæ¯ä»¥ FIFO é¡ºåºå­˜å‚¨åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚è¿™ç§æ’é˜Ÿæ¨¡å¼ä¸‹ä¸åº”è¯¥ä¸¢å¤±ä»»ä½•æ¶ˆæ¯ã€‚ç¼“å†²ä¸­èƒ½å¤Ÿå­˜å‚¨çš„æ¶ˆæ¯æ•°é‡æ˜¯ç”±ç¼“å†²å¤§å°ç¡®å®šå¹¶åœ¨åˆ›å»ºæ—¶æŒ‡å®šçš„ã€‚ç­‰å¾…åœ¨ç¼“å†²ä¸Šçš„è¿›ç¨‹ä»¥ FIFO æˆ–è€…ä¼˜å…ˆçº§æ’é˜Ÿã€‚ä¼˜å…ˆçº§æ’é˜Ÿçš„æƒ…å†µä¸‹ï¼Œç›¸åŒä¼˜å…ˆçº§çš„è¿›ç¨‹æŒ‰ç…§ FIFO é¡ºåºæ’é˜Ÿã€‚æ’é˜Ÿè§„åˆ™åœ¨åˆ›å»ºç¼“å†²æ—¶å®šä¹‰ã€‚å¦‚æœæœ‰è¿›ç¨‹ç­‰å¾…ç¼“å†²æ¶ˆæ¯å¹¶ä¸”ç¼“å†²(å˜å¾—)ä¸ä¸ºç©ºï¼Œåˆ™æŒ‰ç…§åº”ç”¨æ’é˜Ÿè§„åˆ™ç®—æ³•(FIFO æˆ–è€…ä¼˜å…ˆçº§)æ¥ç¡®å®šå“ªä¸ªæ’é˜Ÿçš„è¿›ç¨‹æ¥æ”¶æ­¤æ¶ˆæ¯ã€‚OS å°†æŠŠè¯¥è¿›ç¨‹ä»è¿›ç¨‹é˜Ÿåˆ—ä¸Šç§»å‡ºï¼Œå°†å…¶ç½®ä¸ºå°±ç»ªçŠ¶æ€ã€‚OS å°†æŠŠæ¶ˆæ¯ä»ç¼“å†²æ¶ˆæ¯é˜Ÿåˆ—ä¸­ç§»å‡ºã€‚ å½“è¿›ç¨‹è¯•å›¾ä»ç©ºç¼“å†²æ¥æ”¶æ¶ˆæ¯ï¼Œæˆ–è€…å‘é€æ¶ˆæ¯åˆ°æ»¡çš„ç¼“å†²ï¼Œå°†å‘ç”Ÿè¿›ç¨‹é‡è°ƒåº¦ã€‚è°ƒç”¨è¿›ç¨‹å°†è¢«æ”¾å…¥é˜Ÿåˆ—ä¸€æ®µæŒ‡å®šçš„æ—¶é—´ï¼Œå¦‚æœåœ¨è¯¥æ®µæ—¶é—´å†…æ²¡æœ‰æ¶ˆæ¯è¢«æ¥æ”¶æˆ–è€…å‘é€ï¼ŒOS å°†è‡ªåŠ¨ä»é˜Ÿåˆ—ä¸­ç§»å‡ºè¯¥è¿›ç¨‹ï¼Œå°†å…¶ç½®ä¸ºå°±ç»ªçŠ¶æ€ã€‚ é»‘æ¿ Blackboardé»‘æ¿æ˜¯åˆ†åŒºå†…è¿›ç¨‹é—´çš„ä¸€ç§é€šä¿¡æœºåˆ¶ã€‚å®ƒå’Œæ¶ˆæ¯é˜Ÿåˆ—ä¸€æ ·æ”¯æŒåœ¨å¤šä¸ªæºå’Œç›®çš„ä¹‹é—´çš„ä¼ è¾“ã€‚é»‘æ¿ä¸æ¶ˆæ¯é˜Ÿåˆ—æœ€å¤§çš„ä¸åŒç‚¹æ˜¯æ¶ˆæ¯é˜Ÿåˆ—å…è®¸æ¶ˆæ¯æ’é˜Ÿï¼Œè€Œé»‘æ¿ä¸å…è®¸æ¶ˆæ¯æ’é˜Ÿã€‚ åªè¦é¢„å…ˆåˆ†é…çš„å­˜å‚¨ç©ºé—´è¶³å¤Ÿå¤§ï¼Œé‚£ä¹ˆè¿›ç¨‹å¯ä»¥åˆ›å»ºå°½å¯èƒ½å¤šçš„é»‘æ¿ã€‚ å½“è¿›ç¨‹è¿›å…¥ä¸€ä¸ªç­‰å¾…çŠ¶æ€æ—¶ï¼Œåˆ†åŒºéœ€è¦é‡æ–°è¿›è¡Œè¿›ç¨‹è°ƒåº¦ã€‚è¶…æ—¶æœºåˆ¶é™åˆ¶æˆ–è€…é¿å…äº†ç­‰å¾…æ—¶é—´è¿‡é•¿çš„ç°è±¡å‡ºç°ã€‚ é»‘æ¿æ˜¯ä¸æ”¯æŒæ’é˜Ÿçš„ï¼Œå†™åˆ°é»‘æ¿ä¸Šçš„ä»»ä½•æ¶ˆæ¯å¯èƒ½è¢«æ“¦é™¤æˆ–è€…è¢«æ–°å†™å…¥çš„æ¶ˆæ¯è¦†ç›–æ‰ã€‚ä»»åŠ¡å¯ä»¥ä»é»‘æ¿ä¸Šè¯»å–ä¸€æ¡ä¿¡æ¯ã€æ˜¾ç¤ºä¸€æ¡ä¿¡æ¯æˆ–è€…æ“¦é™¤é»‘æ¿ã€‚ è¯•å›¾ä»ç©ºçš„é»‘æ¿ä¸Šè¯»å–ä¿¡æ¯çš„æ“ä½œå°†ä¼šå¯¼è‡´è¿›ç¨‹é‡æ–°è°ƒåº¦ï¼Œè¿›è¡Œè¯¥æ“ä½œçš„è¿›ç¨‹å°†ä¼šè¿›å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…ä¸€æ®µæŒ‡å®šæ—¶é—´ï¼Œå¦‚æœåœ¨è¯¥æ®µæ—¶é—´å†…æ²¡æœ‰æ¶ˆæ¯è¢«å†™åˆ°é»‘æ¿ä¸Šï¼ŒdOS å°†ä¼šå°†è¯¥è¿›ç¨‹ä»ç­‰å¾…é˜Ÿåˆ—ä¸Šç§»å‡ºå¹¶å°†å…¶çŠ¶æ€å˜ä¸ºå°±ç»ªã€‚ å½“æœ‰æ¶ˆæ¯è¢«å†™åˆ°é»‘æ¿ä¸Šæ—¶ï¼Œæ‰€æœ‰ç­‰å¾…åœ¨é»‘æ¿é˜Ÿåˆ—ä¸Šçš„è¿›ç¨‹å°†ä¼šä»é˜Ÿåˆ—ä¸Šè¢«ç§»å‡ºå¹¶è®¾ç½®ä¸ºå°±ç»ªçŠ¶æ€ï¼Œè¯¥æ¶ˆæ¯ä¼šè¢«ä¿æŒåœ¨é»‘æ¿ä¸Šã€‚å½“é»‘æ¿è¢«æ“¦é™¤æ—¶ï¼Œå®ƒä¼šå˜ç©ºã€‚ ä¿¡å·é‡ Semaphoreä¿¡å·é‡æœåŠ¡æä¾›äº†è®¡æ•°ä¿¡å·é‡ã€‚ è®¡æ•°ä¿¡å·é‡æ˜¯ä¸€ç§åŒæ­¥å¯¹è±¡ï¼Œå¸¸ç”¨äºå¯¹åˆ†åŒºå†…èµ„æºè®¿é—®çš„æ§åˆ¶ã€‚è®¡æ•°ä¿¡å·é‡çš„è®¡æ•°å€¼ä¸€èˆ¬ç”¨äºåæ˜ å½“å‰åˆæ³•èµ„æºçš„æ•°é‡ã€‚ ä¸ºäº†ä½¿ç”¨ä¿¡å·é‡ï¼Œå¿…é¡»åœ¨åˆå§‹åŒ–é˜¶æ®µä¸­å¯¹å…¶è¿›è¡Œåˆ›å»ºã€‚åˆ›å»ºä¿¡å·é‡æ—¶éœ€è¦æŒ‡å®šå¯¹è±¡åå­—ï¼Œè¿™ä¸ªåå­—ä»…å±€é™äºåˆ†åŒºå†…ã€‚æ­¤å¤–ï¼Œè¿™ä¸ªåå­—ä¹Ÿä¸æ˜¯åˆ†åŒºé…ç½®è¡¨çš„å±æ€§ã€‚ äº‹ä»¶ Eventäº‹ä»¶æ˜¯ä¸€ç§åŒæ­¥å¯¹è±¡ï¼Œç”¨äºé€šçŸ¥è¿›ç¨‹ç­‰å¾…æ¡ä»¶çš„å‡ºç°ã€‚åŒä¸€åˆ†åŒºå†…çš„è¿›ç¨‹å¯ä»¥è®¾ç½®å’Œæ¸…é™¤äº‹ä»¶ï¼Œè¿˜å¯ä»¥åœ¨æœ¬åˆ†åŒºå†…åˆ›å»ºçš„äº‹ä»¶ä¸Šç­‰å¾…ã€‚ åˆ†åŒºå†…åˆ›å»ºçš„äº‹ä»¶èƒ½å¤Ÿè¢«åˆ†åŒºå†…çš„æ‰€æœ‰è¿›ç¨‹ä½¿ç”¨ã€‚äº‹ä»¶åˆ›å»ºæ—¶ï¼Œè¢«è®¾ç½®ä¸º down çŠ¶æ€ã€‚ä¸ºäº†é€šçŸ¥äº‹ä»¶æ¡ä»¶çš„å‘ç”Ÿï¼Œå¯ä»¥è®¾ç½®æŒ‡å®šçš„äº‹ä»¶ä¸º up çŠ¶æ€ï¼Œæ‰€æœ‰ç­‰å¾…è¯¥äº‹ä»¶çš„è¿›ç¨‹çš„çŠ¶æ€å°†ä»ç­‰å¾…å˜ä¸ºå°±ç»ªï¼Œç„¶åè¿›è¡Œé‡è°ƒåº¦ã€‚ç­‰å¾…äº‹ä»¶çš„è¿›ç¨‹çš„æ‰§è¡Œé¡ºåºåº”è¯¥åªä¾èµ–äºåˆ†åŒºå†…è¿›ç¨‹è°ƒåº¦è§„åˆ™ã€‚ ä¸ºäº†ä½¿ç”¨äº‹ä»¶ï¼Œå¿…é¡»åœ¨åˆå§‹åŒ–é˜¶æ®µä¸­å¯¹å…¶è¿›è¡Œåˆ›å»ºã€‚åˆ›å»ºäº‹ä»¶æ—¶éœ€è¦æŒ‡å®šå¯¹è±¡åå­—ï¼Œè¿™ä¸ªåå­—ä»…å±€é™äºåˆ†åŒºå†…ã€‚æ­¤å¤–ï¼Œè¿™ä¸ªåå­—ä¹Ÿä¸æ˜¯åˆ†åŒºé…ç½®è¡¨çš„å±æ€§ã€‚ æ—¶é—´ç®¡ç†æ—¶é—´ç®¡ç†ä¸ºåˆ†åŒºæä¾›äº†åŠŸèƒ½æ¥å£æ¥æ§åˆ¶å‘¨æœŸå’Œéå‘¨æœŸè¿›ç¨‹ã€‚ å‘¨æœŸè¿›ç¨‹å°±æ˜¯ä»¥ç‰¹å®šé¢‘ç‡æ‰§è¡Œçš„è¿›ç¨‹ã€‚ç±»ä¼¼çš„ï¼Œåªåœ¨ç‰¹å®šäº‹ä»¶ä¹‹åæ‰§è¡Œçš„è¿›ç¨‹ä¸ºéå‘¨æœŸè¿›ç¨‹æˆ–äº‹ä»¶é©±åŠ¨è¿›ç¨‹ã€‚ å¯¹äºå‘¨æœŸè¿›ç¨‹ï¼Œåˆ†åŒºå†…æ¯ä¸ªè¿›ç¨‹éƒ½å¯ä»¥ç¡®å®šä¸€æ®µæ‰§è¡Œæ—¶é—´æ¥ä½œä¸ºè¿›ç¨‹å‘¨æœŸæ‰§è¡Œçš„æœ€å¤§æ—¶é—´é•¿åº¦ã€‚è¿™ä¸ªæ—¶é—´é•¿åº¦å¯ç”¨ä»¥è®¾å®šè¿›ç¨‹çš„ Deadline æ—¶é—´ã€‚æ“ä½œç³»ç»Ÿä¼šé€šè¿‡å‘¨æœŸæ€§åœ°è¯„ä¼° Deadline æ—¶é—´æ¥åˆ¤æ–­è¿›ç¨‹æ˜¯å¦åœ¨åˆ†é…çš„æ—¶é—´å†…å®Œæˆäº†æ‰§è¡Œã€‚åœ¨è¿›ç¨‹æ‰§è¡Œå‘¨æœŸçš„æœ€åï¼Œåº”è¯¥è°ƒç”¨ PERIODIC W èˆ­ T æœåŠ¡æ¥è·å–æ–°çš„ Deadlineã€‚æ–° Deadline çš„è®¡æ—¶å°†ä»è¿›ç¨‹çš„ä¸‹ä¸€ä¸ªå‘¨æœŸå¼€å§‹ã€‚ å¯¹äºæ‰€æœ‰è¿›ç¨‹ï¼ŒTIMEDâ€”WAIT æœåŠ¡å…è®¸è¿›ç¨‹æŒ‚èµ·è‡ªå·±ä¸€æ®µæ—¶é—´ã€‚å¾…æŒ‚èµ·æ—¶é—´åˆ°è¾¾ä»¥åï¼Œè¿›ç¨‹åˆå¯ä»¥è¢«é‡æ–°è°ƒåº¦ã€‚ å‡½æ•°åŠŸèƒ½ ä½¿è¿›ç¨‹æŒ‡å®šæ—¶é—´ç­‰å¾… ä½¿è¿›ç¨‹å‘¨æœŸæ€§ç­‰å¾… è·å–ç³»ç»Ÿæ—¶é—´ å¥åº·ç›‘æ§å¥åº·ç›‘æ§ç”¨äºç›‘è§†ç¡¬ä»¶ã€åº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿçš„çŠ¶æ€ï¼Œå½“å‘ç°æ•…éšœæ—¶ï¼Œè®°å½•æ•…éšœå¹¶è¿›è¡Œæ•…éšœéš”ç¦»ï¼Œé˜²æ­¢æ•…éšœçš„è”“å»¶ï¼ŒåŒæ—¶æŒ‰æ•…éšœçº§åˆ«(æ¨¡å—çº§ã€åˆ†åŒºçº§å’Œä»»åŠ¡çº§)è¿›è¡Œå¿…è¦çš„æ¢å¤ã€‚å¥åº·ç›‘è§†çš„å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯åœ¨ç³»ç»Ÿé…ç½®æ—¶ï¼Œç”¨äºæ£€æµ‹ç³»ç»Ÿé…ç½®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚ ARINC å¯¹å¥åº·ç›‘æ§å¤„ç†çš„é”™è¯¯è¿›è¡Œäº†åˆ†çº§ï¼Œé”™è¯¯æœ‰å¯èƒ½å‘ç”Ÿåœ¨æ¨¡å—çº§ã€åˆ†åŒºçº§å’Œè¿›ç¨‹çº§ã€‚æ¨¡å—çº§é”™è¯¯ä»…å½±å“æ¨¡å—å†…çš„æ‰€æœ‰åˆ†åŒºã€‚åˆ†åŒºçº§é”™è¯¯ä»…å½±å“è¯¥åˆ†åŒºã€‚è¿›ç¨‹çº§é”™è¯¯å½±å“åˆ†åŒºå†…çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿›ç¨‹ï¼Œæˆ–è€…æ˜¯æ•´ä¸ªåˆ†åŒºã€‚å¦‚ä¸‹ç»™å‡ºå„ä¸ªçº§åˆ«çš„é”™è¯¯ç±»å‹å®šä¹‰ã€‚ â—æ¨¡å—çº§é”™è¯¯ï¼š æ¨¡å—åˆå§‹åŒ–é˜¶æ®µå‡ºç°æ¨¡å—é…ç½®é”™è¯¯ï¼› æ¨¡å—åˆå§‹åŒ–é˜¶æ®µå‡ºç°å…¶å®ƒé”™è¯¯ï¼š ç³»ç»ŸåŠŸèƒ½æ‰§è¡ŒæœŸé—´çš„é”™è¯¯ï¼› åˆ†åŒºè½¬æ¢æ—¶å‘ç”Ÿçš„é”™è¯¯ï¼› åŠ ç”µæ•…éšœã€‚ â—åˆ†åŒºçº§é”™è¯¯ï¼š åˆ†åŒºåˆå§‹åŒ–é˜¶æ®µå‡ºç°åˆ†åŒºé…ç½®é”™è¯¯ï¼› åˆ†åŒºåˆå§‹åŒ–é”™è¯¯ï¼› è¿›ç¨‹ç®¡ç†ä¸­çš„é”™è¯¯ï¼› æ•…éšœå¤„ç†è¿‡ç¨‹çš„é”™è¯¯ã€‚ â—è¿›ç¨‹çº§é”™è¯¯ï¼š åº”ç”¨è¿›ç¨‹äº§ç”Ÿçš„åº”ç”¨é”™è¯¯ï¼› éæ³•çš„æ“ä½œç³»ç»Ÿè¯·æ±‚ï¼› è¿›ç¨‹æ‰§è¡Œé”™è¯¯(æº¢å‡ºã€å­˜å‚¨åŒºå†²çªâ€¦)ã€‚ é”™è¯¯çš„çº§åˆ«æ˜¯ç”±ç³»ç»Ÿäººå‘˜åœ¨çŠ¶æ€ç›‘æ§çš„é…ç½®è¡¨ä¸­å®šä¹‰çš„ï¼Œå¹¶ä¸”ä¸è¯Šæ–­çš„é”™è¯¯å’Œç³»ç»ŸçŠ¶æ€ç›¸ä¸€è‡´çš„ã€‚ä»»ä½•çº§åˆ«ä¸Šå‘ç”Ÿçš„é”™è¯¯ï¼Œæ ¹æ®å…¶é”™è¯¯ç‰¹æ€§ï¼Œå°†ä¼šæ‰©æ•£åˆ°å…¶è¢«å¤„ç†çš„æ›´é«˜çº§åˆ«ä¸Šã€‚ æ•…éšœå“åº”æœºåˆ¶ä¾èµ–äºé”™è¯¯çº§åˆ«ã€‚æ¨¡å—çº§å’Œåˆ†åŒºçº§çš„æ•…éšœå“åº”æ˜¯ç”±ä¸€å¼ æ¨¡å—çŠ¶æ€ç›‘æ§è¡¨å’Œæ¯ä¸ªåˆ†åŒºçš„å•ç‹¬åˆ†åŒºçŠ¶æ€ç›‘æ§è¡¨é©±åŠ¨çš„ã€‚è¿›ç¨‹çº§æ•…éšœå“åº”ç”±åº”ç”¨ç¨‹åºå‘˜ä½¿ç”¨åˆ†åŒºçš„ä¸“é—¨(æœ€é«˜ä¼˜å…ˆçº§)çš„è¿›ç¨‹ä¸€ä¸€é”™è¯¯å¤„ç†è¿›ç¨‹å†³å®šã€‚ç¨‹åºå‘˜å¯ä»¥é€šè¿‡çŠ¶æ€ç›‘æ§æœåŠ¡ç¡®å®šé”™è¯¯å’Œæ•…éšœè¿›ç¨‹ï¼Œç„¶ååœ¨è¿›ç¨‹çº§(ä¾‹å¦‚ï¼Œåœæ­¢ï¼Œå¯åŠ¨è¿›ç¨‹ï¼Œreplenish)æˆ–è€…åˆ†åŒºçº§(ä¾‹å¦‚ï¼Œè®¾ç½®åˆ†åŒºæ¨¡å¼ï¼šç©ºé—²ï¼Œå†·å¯åŠ¨ï¼Œçƒ­å¯åŠ¨)é‡‡å–æ¢å¤æªæ–½ã€‚é”™è¯¯å¤„ç†è¿›ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯è¢«è§†ä¸ºåˆ†åŒºçº§é”™è¯¯ã€‚ å‡½æ•°åŠŸèƒ½ æŠ¥å‘Šé”™è¯¯æ¶ˆæ¯ åˆ›å»ºé”™è¯¯å¤„ç†è¿›ç¨‹ æ¿€æ´»å¤„ç†è¿›ç¨‹ å¯åŠ¨åˆ†åŒº åˆ†åŒºå¯åŠ¨ï¼š åˆ†åŒºå¯åŠ¨åï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¼šä¸ºè¯¥åˆ†åŒºåˆ›å»ºä¸€ä¸ªåˆå§‹ä»»åŠ¡ã€‚ åˆå§‹ä»»åŠ¡çš„ä½œç”¨ï¼šä¸»è¦ç”¨äºåˆå§‹åŒ– APEX æ¥å£ï¼Œæ‰§è¡Œåˆ†åŒºé…ç½®è¡¨ä¸­çš„åˆå§‹åŒ–æ­¥éª¤ã€‚ åˆå§‹ä»»åŠ¡çš„å‚æ•°ï¼šä¾‹å¦‚ä¼˜å…ˆçº§å’Œä»»åŠ¡æ ˆå¤§å°ï¼Œè¿™äº›å‚æ•°é€šå¸¸ç”± APEX æ¥å£çš„å…·ä½“å®ç°å†³å®šï¼Œå¯¹äºä½¿ç”¨ APEX æ¥å£çš„ç”¨æˆ·æ¥è¯´ï¼Œè¿™äº›å‚æ•°æ˜¯é€æ˜çš„ï¼Œå³ç”¨æˆ·ä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®è¿™äº›å‚æ•°ã€‚ APEX é…ç½®ä¿¡æ¯çš„å…¥å£å‚æ•°çš„ç»“æ„ã€‚ typedef structvoid* processInfoï¼› /*è¿›ç¨‹æ•´ä½“é…ç½®ä¿¡æ¯*/void* bufferInfoï¼› /*ç¼“å†²åŒºæ•´ä½“é…ç½®ä¿¡æ¯*/void* bbInfoï¼› /*é»‘æ¿æ•´ä½“é…ç½®*/void* semInfoï¼› /*ä¿¡å·é‡æ•´ä½“é…ç½®ä¿¡æ¯*/void* eventInfoï¼› /*äº‹ä»¶æ•´ä½“é…ç½®ä¿¡æ¯*/void* queuingInfoï¼›/*é˜Ÿåˆ—ç«¯å£é…ç½®ä¿¡æ¯*/void* samplingInfoï¼› /*é‡‡æ ·ç«¯å£é…ç½®ä¿¡æ¯*/void* hmInfoï¼› /*åˆ†åŒºå¥åº·ç›‘æ§é…ç½®ä¿¡æ¯*/)T_APEX_CONFIG_INFOï¼› åˆå§‹åŒ– APEX æ¥å£ APEX INIT è°ƒç”¨ï¼š åˆå§‹ä»»åŠ¡ä¼šä»¥åˆ†åŒºé…ç½®è¡¨ä¸ºå‚æ•°ï¼Œè°ƒç”¨ APEX æ¥å£çš„åˆå§‹åŒ–å…¥å£å‡½æ•° APEX INITã€‚ ç³»ç»Ÿå¯¹è±¡çš„åˆå§‹åŒ–ï¼šAPEX æ¥å£æ ¹æ®åˆ†åŒºé…ç½®è¡¨ä¸­çš„å„é¡¹å‚æ•°ï¼Œåˆå§‹åŒ–ç³»ç»Ÿå¯¹è±¡ã€‚ç³»ç»Ÿå¯¹è±¡åŒ…æ‹¬å„ç§ç³»ç»Ÿèµ„æºï¼Œå¦‚é˜Ÿåˆ—ã€ç¼“å†²åŒºã€ä¿¡å·é‡ç­‰ã€‚ åˆ›å»ºç³»ç»Ÿè¿›ç¨‹ï¼šAPEX æ¥å£æ¥ç€ä¼šåˆ›å»ºä¸€äº›å…³é”®çš„ç³»ç»Ÿè¿›ç¨‹ï¼Œæ¯”å¦‚åˆå§‹è¿›ç¨‹å’Œ IDLE è¿›ç¨‹ã€‚è¿™äº›è¿›ç¨‹å¯¹äºåˆ†åŒºçš„åŸºæœ¬æ“ä½œå’Œç®¡ç†è‡³å…³é‡è¦ã€‚ åˆå§‹ä»»åŠ¡çš„ç»“æŸï¼šåœ¨å®Œæˆä¸Šè¿°åˆå§‹åŒ–æ­¥éª¤åï¼Œåˆå§‹ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸå°±ç»“æŸäº†ï¼Œç³»ç»Ÿè¿›ç¨‹å¼€å§‹æ¥ç®¡åˆ†åŒºçš„è¿è¡Œã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ APEX æ¥å£çš„åˆå§‹åŒ–æ˜¯ä¸€ä¸ªåˆ†ç•Œçº¿ï¼Œä»æ­¤ä¹‹ååˆ›å»ºçš„ä»»ä½•è¿›ç¨‹æˆ–å¯¹è±¡éƒ½å¿…é¡»åœ¨åˆ†åŒºé…ç½®è¡¨ä¸­æœ‰å¯¹åº”çš„é…ç½®ï¼Œå¦åˆ™åˆ›å»ºå°†ä¼šå¤±è´¥ï¼ŒIDLE ç­‰ç³»ç»Ÿè¿›ç¨‹ä¹Ÿä¸ä¾‹å¤–ã€‚è€Œåœ¨åˆå§‹åŒ– APEX æ¥å£ä¹‹å‰åˆ›å»ºçš„ç³»ç»Ÿå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå¿…é¡»åˆ°æ­¤ç»“æŸï¼Œä¸èƒ½å»¶ç»­åˆ° APEX æ¥å£åˆå§‹åŒ–ä¹‹åï¼Œä»¥åˆå§‹ä»»åŠ¡ä¸ºä¾‹ï¼Œåœ¨ APEX æ¥å£åˆå§‹åŒ–è¿‡ç¨‹å°±ä¼šè¢«ç»ˆæ­¢ã€‚ä»¥ä¿è¯ APEX æ¥å£ä¹‹ä¸Šåº”ç”¨ç¨‹åºçš„å¯ç§»æ¤æ€§ä¸å—å…·ä½“ OS çš„å½±å“ã€‚ è®¾ç½®åˆ†åŒºä¸º NORMAL æ¨¡å¼ USERMAIN çš„è°ƒç”¨ï¼š ç”±ç³»ç»Ÿè¿›ç¨‹ä¹‹ä¸€çš„åˆå§‹è¿›ç¨‹è°ƒç”¨ç”¨æˆ·ç¨‹åºçš„å…¥å£å‡½æ•° USERMAINã€‚ åˆ†åŒºåº”ç”¨ç¨‹åºçš„æ‰§è¡Œï¼šç”¨æˆ·å¯ä»¥åœ¨ USERMAIN å‡½æ•°ä¸­åˆ›å»ºè‡ªå·±çš„ç”¨æˆ·è¿›ç¨‹å’Œå…¶ä»–ç³»ç»Ÿå¯¹è±¡ï¼ˆä¾‹å¦‚ä¿¡å·é‡ã€äº‹ä»¶ã€ä»»åŠ¡ç­‰ï¼‰ã€‚ è®¾ç½®åˆ†åŒºæ¨¡å¼ä¸º NORMALï¼šåœ¨ç”¨æˆ·ç¨‹åºçš„åˆå§‹åŒ–æ­¥éª¤å®Œæˆåï¼Œç³»ç»Ÿå°†åˆ†åŒºçš„æ¨¡å¼è®¾ç½®ä¸º NORMALã€‚è¿™æ„å‘³ç€åˆ†åŒºå·²ç»å‡†å¤‡å¥½å¹¶å¼€å§‹æ‰§è¡Œç”¨æˆ·å®šä¹‰çš„è¿›ç¨‹ã€‚ åˆå§‹è¿›ç¨‹çš„ç»“æŸï¼šä¸€æ—¦æ‰€æœ‰ç”¨æˆ·è¿›ç¨‹åˆ›å»ºå®Œæˆå¹¶å¼€å§‹è¿è¡Œï¼Œåˆå§‹è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿç»“æŸã€‚ åˆ†åŒºé—´åˆ‡æ¢ åˆ†åŒºåˆ‡æ¢æ¦‚è¿°ï¼š åˆ†åŒºé—´åˆ‡æ¢æ˜¯æŒ‡åœ¨ä¸€ä¸ªå¤šåˆ†åŒºç³»ç»Ÿä¸­ï¼Œæ“ä½œç³»ç»Ÿä»ä¸€ä¸ªåˆ†åŒºåˆ‡æ¢åˆ°å¦ä¸€ä¸ªåˆ†åŒºã€‚åˆ‡æ¢é€šå¸¸æ˜¯ç”±ç³»ç»Ÿè°ƒåº¦å™¨åœ¨æ—¶é—´ç‰‡åˆ°æœŸæˆ–è€…æ ¹æ®ç‰¹å®šæ¡ä»¶è§¦å‘çš„ã€‚ æ—¶é—´åˆ†ç‰‡ï¼šç³»ç»Ÿé€šå¸¸ä¼šä»¥å›ºå®šçš„æ—¶é—´ç‰‡è¿›è¡Œåˆ†åŒºåˆ‡æ¢ï¼Œå³æ¯ä¸ªåˆ†åŒºåœ¨å…¶æ—¶é—´ç‰‡å†…ç‹¬å  CPU èµ„æºã€‚ åˆ‡æ¢è¿‡ç¨‹ï¼š æ—¶é—´ç‰‡åˆ°æœŸæˆ–åˆ‡æ¢è¯·æ±‚ï¼šå½“åˆ†é…ç»™å½“å‰åˆ†åŒºçš„æ—¶é—´ç‰‡åˆ°æœŸï¼Œæˆ–è€…æœ‰å…¶ä»–æ¡ä»¶è§¦å‘äº†åˆ†åŒºåˆ‡æ¢è¯·æ±‚ï¼Œç³»ç»Ÿè°ƒåº¦å™¨å°†ä¼šè¿›è¡Œåˆ†åŒºåˆ‡æ¢ã€‚ ä¿å­˜å½“å‰åˆ†åŒºçŠ¶æ€ï¼šåœ¨åˆ‡æ¢ä¹‹å‰ï¼Œæ“ä½œç³»ç»Ÿä¼šä¿å­˜å½“å‰åˆ†åŒºçš„çŠ¶æ€ï¼ŒåŒ…æ‹¬å¯„å­˜å™¨ã€ä»»åŠ¡æ ˆå’Œå…¶ä»–é‡è¦æ•°æ®ã€‚ åŠ è½½æ–°åˆ†åŒºçŠ¶æ€ï¼šç³»ç»Ÿè°ƒåº¦å™¨åŠ è½½ä¸‹ä¸€ä¸ªåˆ†åŒºçš„çŠ¶æ€ï¼Œå¹¶å°†å¤„ç†å™¨æ§åˆ¶æƒè½¬ç§»åˆ°æ–°åˆ†åŒºã€‚ åˆ‡æ¢å®Œæˆï¼šæ–°åˆ†åŒºå¼€å§‹æ‰§è¡Œå…¶ä»»åŠ¡ï¼Œå¹¶åœ¨å…¶æ—¶é—´ç‰‡å†…ç‹¬å  CPU èµ„æºã€‚ åˆ†åŒºé—´åˆ‡æ¢çš„å…³é”®ç‚¹ï¼š éš”ç¦»æ€§ï¼šç¡®ä¿ä¸åŒåˆ†åŒºçš„èµ„æºå’ŒçŠ¶æ€ç›¸äº’éš”ç¦»ï¼Œä»¥é˜²å¹²æ‰°ã€‚ å®æ—¶æ€§ï¼šéœ€è¦ä¿è¯åˆ†åŒºåˆ‡æ¢çš„å»¶è¿Ÿåœ¨å¯æ¥å—çš„èŒƒå›´å†…ï¼Œä»¥æ»¡è¶³ç³»ç»Ÿçš„å®æ—¶æ€§è¦æ±‚ã€‚ åˆ†åŒºå†…è¿›ç¨‹åˆ‡æ¢ è¿›ç¨‹åˆ‡æ¢æ¦‚è¿°ï¼š åˆ†åŒºå†…è¿›ç¨‹åˆ‡æ¢æ˜¯æŒ‡åœ¨åŒä¸€ä¸ªåˆ†åŒºå†…ï¼Œä»ä¸€ä¸ªè¿›ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ã€‚é€šå¸¸ç”±åˆ†åŒºå†…çš„è°ƒåº¦å™¨ç®¡ç†ã€‚ åˆ‡æ¢è¿‡ç¨‹ï¼š è¿›ç¨‹è°ƒåº¦ï¼šåˆ†åŒºå†…çš„è°ƒåº¦å™¨æ ¹æ®è°ƒåº¦ç®—æ³•ï¼ˆå¦‚ä¼˜å…ˆæƒè°ƒåº¦ï¼‰å†³å®šä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„è¿›ç¨‹ã€‚ ä¿å­˜å½“å‰è¿›ç¨‹çŠ¶æ€ï¼šä¿å­˜å½“å‰è¿›ç¨‹çš„å¯„å­˜å™¨å€¼ã€å †æ ˆæŒ‡é’ˆå’Œå…¶ä»–çŠ¶æ€ä¿¡æ¯ã€‚ æ¢å¤æ–°è¿›ç¨‹çŠ¶æ€ï¼šåŠ è½½æ–°è¿›ç¨‹çš„å¯„å­˜å™¨å€¼å’Œå †æ ˆæŒ‡é’ˆï¼Œæ¢å¤æ–°è¿›ç¨‹çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚ åˆ‡æ¢å®Œæˆï¼šæ–°è¿›ç¨‹å¼€å§‹æ‰§è¡Œã€‚ è¿›ç¨‹é—´åˆ‡æ¢çš„å…³é”®ç‚¹ï¼š ä¼˜å…ˆçº§ï¼šè¿›ç¨‹è°ƒåº¦é€šå¸¸ä¾èµ–äºä¼˜å…ˆçº§ï¼Œç¡®ä¿é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹èƒ½å¤Ÿå¾—åˆ°åŠæ—¶å¤„ç†ã€‚ ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šéœ€è¦æœ‰æ•ˆåœ°ç®¡ç†è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œä»¥æé«˜ç³»ç»Ÿæ€§èƒ½ã€‚ APEX æ—¶é—´è°ƒåº¦ï¼ˆApexTime Schedulingï¼‰ APEX æ—¶é—´è°ƒåº¦æ¦‚è¿°ï¼š ApexTime æ˜¯ ARINC 653 è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºç®¡ç†ç³»ç»Ÿä¸­çš„æ—¶é—´åˆ†ç‰‡å’Œæ—¶é—´èµ„æºã€‚å®ƒä¿è¯äº†ä»»åŠ¡åœ¨é¢„å®šçš„æ—¶é—´æ®µå†…èƒ½å¤Ÿå¾—åˆ°æ‰§è¡Œï¼Œæ»¡è¶³å®æ—¶ä»»åŠ¡çš„éœ€æ±‚ã€‚ æ—¶é—´è°ƒåº¦çš„å…³é”®åŠŸèƒ½ï¼š æ—¶é—´åˆ†ç‰‡ï¼šç³»ç»Ÿå°†æ—¶é—´åˆ’åˆ†ä¸ºå›ºå®šé•¿åº¦çš„æ—¶é—´ç‰‡ï¼Œåˆ†é…ç»™ä¸åŒçš„ä»»åŠ¡æˆ–åˆ†åŒºã€‚è¿™ç¡®ä¿äº†æ¯ä¸ªä»»åŠ¡éƒ½æœ‰å…¬å¹³çš„æ‰§è¡Œæœºä¼šã€‚ æ—¶é—´åˆ†åŒºï¼šAPEX æ¥å£é€šè¿‡æ—¶é—´åˆ†åŒºæœºåˆ¶ç®¡ç†ä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´ï¼Œç¡®ä¿ä»»åŠ¡åœ¨é¢„å®šçš„æ—¶é—´å†…è¿è¡Œï¼Œæ»¡è¶³å®æ—¶ç³»ç»Ÿçš„è¦æ±‚ã€‚ å®šæ—¶å™¨ç®¡ç†ï¼šAPEX æä¾›äº†å®šæ—¶å™¨æœåŠ¡ï¼Œç”¨äºç®¡ç†ä»»åŠ¡çš„è¶…æ—¶å’Œå‘¨æœŸæ€§è°ƒåº¦ï¼Œæ”¯æŒä»»åŠ¡åœ¨ç‰¹å®šæ—¶é—´ç‚¹æˆ–é—´éš”å†…æ‰§è¡Œã€‚ æ—¶é—´è°ƒåº¦çš„å®ç°ï¼š è°ƒåº¦ç®—æ³•ï¼šAPEX æ¥å£å¯èƒ½ä¼šä½¿ç”¨è½®è½¬æ³•ã€ä¼˜å…ˆçº§è°ƒåº¦æˆ–å…¶ä»–è°ƒåº¦ç®—æ³•æ¥ç®¡ç†ä»»åŠ¡çš„æ—¶é—´ç‰‡å’Œä¼˜å…ˆçº§ã€‚ ç³»ç»Ÿè°ƒç”¨ï¼šç”¨æˆ·ä»»åŠ¡å¯ä»¥é€šè¿‡ APEX æä¾›çš„ç³»ç»Ÿè°ƒç”¨æ¥è¯·æ±‚æ—¶é—´æœåŠ¡ï¼Œä¾‹å¦‚è®¾ç½®å®šæ—¶å™¨ã€è¯·æ±‚æ—¶é—´ç‰‡ç­‰ã€‚ å®æ—¶ä¿éšœï¼šé€šè¿‡ç²¾ç¡®çš„æ—¶é—´ç®¡ç†å’Œè°ƒåº¦ç®—æ³•ï¼ŒAPEX ç¡®ä¿äº†ç³»ç»Ÿèƒ½å¤Ÿæ»¡è¶³ä¸¥æ ¼çš„å®æ—¶æ€§è¦æ±‚ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","èˆªç”µç³»ç»Ÿ"]},{"title":"ARINC825","path":"/2023/09/07/5-åµŒå…¥å¼å¼€å‘-èˆªç”µç³»ç»Ÿ-ARINC825/","content":"ARINC825 åè®®æ ˆARINC825 è§„èŒƒå…¨ç§°ä¸ºæœºè½½ CAN ç½‘ç»œé€šç”¨æ ‡å‡†ï¼ˆThe General Standardization of CAN for Airborne Useï¼‰ã€‚é¡¾åæ€ä¹‰ï¼ŒARINC825 è§„èŒƒæ˜¯å»ºç«‹åœ¨ CAN ç‰©ç†ç½‘ç»œåŸºç¡€ä¸Šçš„é«˜å±‚è§„èŒƒã€‚ARINC825 åè®®ç‰©ç†å±‚å’Œæ•°æ®é“¾è·¯å±‚ä¸ CAN æ€»çº¿åŸºæœ¬ä¸€è‡´ï¼Œè€Œåœ¨ç½‘ç»œå±‚åˆ™å¢åŠ äº†ç‰¹æ®Šçš„è·¯ç”±å¯»å€ã€æ•°æ®åŒ…å°è£…å’Œæµé€Ÿæ§åˆ¶ç­‰åŠŸèƒ½ï¼›å¹¶åœ¨ä¼ è¾“å±‚å¼•å…¥äº†é€»è¾‘ä¿¡é“åˆ’åˆ†ä¸æ•°æ®åŒ…é‡å‘ç­‰åŠŸèƒ½ã€‚ ç‰©ç†å±‚æ¥å£ä¸ºäº†ç¡®ä¿å¯é çš„é€šä¿¡ï¼ŒARINC825 çš„ç”µæ°”ç‰¹æ€§ã€æ€»çº¿æ”¶å‘æ¡ä»¶ã€æ•°æ®ç‡ç­‰è§„å®šå‡ç¬¦åˆ ISO 11898 æ ‡å‡†ã€‚è§„èŒƒä¸­è¿˜ç‰¹åˆ«å¼ºè°ƒäº†æ¯ä¸€ä½çš„æ—¶åºè®¡ç®—åŠç”µç£å…¼å®¹æ€§ã€‚ARINC825 æ”¯æŒä»¥ä¸‹æ•°æ®ç‡ï¼š1Mbsã€500Kbsã€250Kbsã€125Kbs åŠ 83.333Kbsã€‚ å®šä¹‰äº†ä¸‰ç§é€šä¿¡æ¨¡å‹ ç”¨äºå¹¿æ’­æ¶ˆæ¯çš„ä¸€å¯¹å¤šæ ¼å¼ ç”¨äºå®šå‘èŠ‚ç‚¹ç‚¹å¯¹ç‚¹é€šä¿¡çš„å®šå‘æ¶ˆæ¯ä¼ é€’ï¼ˆä½¿ç”¨èŠ‚ç‚¹å¯»å€å’Œç«¯å£å®šä¹‰ï¼‰ ç”¨äºèŠ‚ç‚¹æœåŠ¡çš„ç‚¹å¯¹ç‚¹æ ¼å¼ï¼ˆç”¨äº CS ç±»å‹æœåŠ¡çš„ç‚¹å¯¹ç‚¹é€šä¿¡ï¼‰ æ¦‚è§ˆæ•°æ®å¸§ä¸€å¯¹å¤šæ ¼å¼å®šå‘æ¶ˆæ¯ç‚¹å¯¹ç‚¹å‘¨æœŸæ€§å¥åº·æ¶ˆæ¯èŠ‚ç‚¹æœåŠ¡æ•°æ®è½½è·å¥åº·æ¶ˆæ¯æ•°æ®è½½è·å¸¦å®½é«˜å®Œæ•´æ€§åè®®é«˜å¯ç”¨æ€§æ¶ˆæ¯æ€»çº¿æ‹“æ‰‘ç»“æ„é€šä¿¡ç½‘ç»œè®¾è®¡æŠ¥æ–‡ä¼ è¾“æ¨¡å¼å’Œ ID ç»“æ„ARINC825 è§„èŒƒå¯¹ CAN 2.0B æ‰©å±•å¸§çš„ 29 ä½æ ‡è¯†è¿›è¡Œäº†åˆ’åˆ†ã€‚å…¶ä¸­é«˜ 3 ä½è¢«ç”¨äºé€»è¾‘é€šä¿¡é€šé“ï¼ˆLogical Communication Channels, LCCï¼‰æ ‡è¯†ï¼ŒæŒ‰ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ä¾æ¬¡ä¸ºå¼‚å¸¸äº‹ä»¶é€šé“ï¼ˆEECï¼‰ã€æ­£å¸¸å·¥ä½œé€šé“ï¼ˆNOCï¼‰ã€èŠ‚ç‚¹æœåŠ¡é€šé“ï¼ˆNSCï¼‰ã€ç”¨æˆ·è‡ªå®šä¹‰é€šé“ï¼ˆUDCï¼‰ã€æµ‹è¯•ä¸ç»´æŠ¤é€šé“ï¼ˆTMCï¼‰åŠ CAN åŸºæœ¬å¸§å…¼å®¹é€šé“ï¼ˆFMCï¼‰ã€‚å…¶ä¸­ EEC å’Œ NOC é€šé“ç”¨äºå¤šæ’­ï¼ˆAny-to-Manyï¼‰é€šä¿¡ï¼ŒNSC å’Œ TMC é€šé“ç”¨äºç«¯åˆ°ç«¯ï¼ˆPeer-to-Peerï¼‰é€šä¿¡ã€‚ ARINC825 åè®®æ”¯æŒ ATMï¼ˆAnyone to Manyï¼‰å’Œ PTPï¼ˆPeer to Peerï¼‰ä¸¤ç§ä¼ è¾“æ¨¡å¼ï¼ŒæŠ¥æ–‡ä¸€èˆ¬é‡‡ç”¨ 29 ä½æ‰©å±• IDï¼Œå¹¶å®ç°äº†é€»è¾‘ä¿¡é“ï¼ˆLLCï¼‰çš„å®šä¹‰ä¸åˆ’åˆ†ï¼Œå…·ä½“å¦‚è¡¨ 4-1 æ‰€ç¤ºã€‚è€Œä¸”ï¼ŒARINC825 åè®®çš„æŠ¥æ–‡ç»“æ„åˆæŒ‰ç…§ä¼ è¾“æ¨¡å¼ä¸åŒè€Œæœ‰æ‰€åŒºåˆ«ã€‚ ATM æ¨¡å¼ATM æ¨¡å¼æ˜¯ä¼ ç»Ÿçš„ CAN æ€»çº¿æ”¶å‘æ¨¡å¼ï¼Œé€šä¿¡èŠ‚ç‚¹é—´ä¸ºå¯¹ç­‰å…³ç³»ï¼Œé‡‡ç”¨å¹¿æ’­æ–¹å¼å‘é€æ•°æ®ï¼Œå¹¶æŒ‰ç…§æŠ¥æ–‡ ID è¿›è¡Œé€ä½ä»²è£å’Œå±è”½æ¥æ”¶ï¼Œå…¶æŠ¥æ–‡ ID åŸŸç»“æ„å¦‚å›¾æ‰€ç¤ºï¼ŒåŒ…æ‹¬åŠŸèƒ½æ ‡è¯†ï¼ˆFunction ID, FIDï¼‰ã€åŒºåŸŸæ ‡è¯†ï¼ˆLocal, LCLï¼‰ã€åŠ å¯†æ ‡è¯†ï¼ˆPrivate, PVTï¼‰ã€æ•°æ®å¯¹è±¡ä»£ç ï¼ˆData Object Code, DOCï¼‰å’Œå†—ä½™æ ‡è¯†ï¼ˆRedundancy Channel Identifier, RCIï¼‰ã€‚ ATM é€šä¿¡çš„ä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿä¸ç½‘ç»œä¸­æ‰€æœ‰çš„èŠ‚ç‚¹å»ºç«‹æŒç»­çš„æ•°æ®é“¾æ¥ï¼Œä½†æ˜¯ ATM éœ€è¦å¤„ç†éè‡ªèº«çš„æ•°æ®åŒ…ï¼Œå¢åŠ äº†æ¥æ”¶èŠ‚ç‚¹çš„å·¥ä½œé‡ã€‚ PTP æ¨¡å¼PTP æ¨¡å¼åˆ™æ‰©å±•äº†æ˜¯ä¼ ç»Ÿçš„ CAN æ€»çº¿æ”¶å‘æ¨¡å¼ï¼Œå…è®¸ç½‘ç»œä¸­ä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹é—´é‡‡ç”¨åŸºäºå®¢æˆ·ç«¯æœåŠ¡å™¨ï¼ˆ ClientServer ï¼‰çš„é¢å‘è¿æ¥æˆ–æ— è¿æ¥ä¸¤ç§é€šä¿¡æ–¹å¼ï¼Œå…¶æŠ¥æ–‡ ID åŸŸç»“æ„å¦‚å›¾æ‰€ç¤ºï¼Œå¯æ”¯æŒ 512 ä¸ªä¸åŒçš„æœåŠ¡å™¨èŠ‚ç‚¹å’Œ 128 ç§ä¸åŒçš„æœåŠ¡ç±»å‹ã€‚ Server FID(Function ID) + SID(Server ID) +RCI éƒ¨åˆ†ç»Ÿç§°ä¸º NIDï¼ˆNode IDï¼‰ é«˜åº¦å®Œæ•´æ€§åè®®ARINC825 åè®®é’ˆå¯¹ç³»ç»Ÿæ§åˆ¶å™¨å—åˆ°å¹²æ‰°æ—¶å¯èƒ½äº§ç”Ÿçš„é”™è¯¯ï¼Œåœ¨ CAN2.0B æ•…éšœæ£€æµ‹æœºåˆ¶çš„åŸºç¡€ä¸Šï¼ŒåŠ å…¥äº†é«˜åº¦å®Œæ•´æ€§åè®®ï¼ˆHigh Integrity Protocolï¼‰ã€‚å¦‚å›¾ 4-4 æ‰€ç¤ºï¼Œè¯¥åè®®ä»¥å‡å°‘æ•°æ®è½½è·ä¸ºä»£ä»·ï¼Œå¼•å…¥ MIC æ ¡éªŒç ä¸ SN å·ï¼Œå¯¹æŠ¥æ–‡æ­£ç¡®æ€§åŠå®Œæ•´æ€§è¿›è¡ŒéªŒè¯ã€‚ æ•°æ®åŸŸæ¶ˆæ¯æ ¼å¼ï¼Œå…±åŒ…å« 8bytesï¼Œå‰ 5bytes ä¸ºæœ‰æ•ˆæ•°æ®è½½è·ï¼Œç¬¬ 6byte ä¸º SN ç ï¼Œå³æ¶ˆæ¯åºåˆ—å·ï¼Œç¬¬ 7-8bytes ä¸º MICï¼ŒåŠæ•°æ®å®Œæ•´æ€§æ ¡éªŒç»“æœ é«˜å®Œæ•´æ€§æ ¡éªŒèŒƒå›´ï¼Œå…±åŒ…å« 12bytesï¼Œå³ 29bits çš„å¸§ IDï¼Œ3bits çš„è¡¥å……ä½ï¼Œ8bytes çš„æ•°æ®åŸŸ å¤„ç†æ—¶ï¼Œå…ˆè®¾ç½®æ¯ä¸ªèŠ‚ç‚¹ç‹¬ç«‹çš„æ¶ˆæ¯åºåˆ—å· æŒ‰ç…§é«˜å®Œæ•´æ€§æ ¡éªŒèŒƒå›´ï¼Œä¾æ¬¡é€å­—èŠ‚è¿›è¡Œé«˜å®Œæ•´æ€§æ ¡éªŒè¿ç®—ï¼Œå¾—åˆ° 16bits çš„ CRC ç ä½œä¸ºæ•°æ®å®Œæ•´æ€§æ ¡éªŒç»“æœ å¸¦å®½ç®¡ç†ä¼ ç»Ÿçš„ CAN æ€»çº¿åè®®æ˜¯åŸºäºå¤šä¸»ç«äº‰ä¸‹çš„ä½ä»²è£æœºåˆ¶æ¥ç®¡ç†æ€»çº¿çš„è®¿é—®æƒå’Œå¸¦å®½ï¼Œä¼˜å…ˆçº§è¾ƒé«˜çš„æ•°æ®å¸§å¯ä»¥è¿ç»­ä¸å—åˆ¶çº¦åœ°è®¿é—®æ€»çº¿ï¼Œåœ¨æ€»çº¿è½½è·ç¹é‡æ—¶ä¼šé€ æˆä½ä¼˜å…ˆçº§æ•°æ®å¸§è¾ƒå¤§çš„ä¸ç¡®å®šå»¶æ—¶ã€‚ ARINC825 å¼•å…¥æ—¶é—´è§¦å‘æ€»çº¿è°ƒåº¦æŠ€æœ¯ï¼Œæ—¶é—´è§¦å‘æ€»çº¿è°ƒåº¦æ§åˆ¶åŸºäºä¸¤ä¸ªæ¦‚å¿µï¼ŒMajor Frameï¼ˆä¸»æ—¶é—´å¸§ï¼‰å’Œ Minor Frameï¼ˆåŸºæœ¬æ—¶é—´å¸§ï¼‰ã€‚æ•´ä¸ªç½‘ç»œçš„æ•°æ®ä¼ è¾“å‘¨æœŸï¼ˆåœ¨ä¸€ä¸ªå‘¨æœŸå†…ï¼Œæ¯ä¸ªæ•°æ®åŒ…è‡³å°‘èƒ½å¾—åˆ°ä¸€æ¬¡ä¼ è¾“æœºä¼šï¼‰ç§°ä¸ºä¸€ä¸ª ä¸»æ—¶é—´å¸§ï¼Œå®ƒåŒ…å«è‹¥å¹²ä¸ªåŸºæœ¬æ—¶é—´å¸§ ã€‚Minor Frame æ˜¯æ€»çº¿ä¸­ä¼ è¾“é¢‘ç‡æœ€ å¤§çš„å¸§çš„å‘¨æœŸï¼Œæ˜¯ ARINC825 è§„èŒƒä¸­è¿›è¡Œå¸¦å®½ç®¡ç†çš„æœ€å°æ—¶é—´å•ä½ã€‚ åŒä¸€æ—¶é—´å¸§å†…çš„æ•°æ®å¸§é‡‡ç”¨å¤šä¸»ç«äº‰å‘é€ï¼Œåªè¦æ§åˆ¶æ€»çº¿ä¸­å„ä¸ªèŠ‚ç‚¹åœ¨åŸºæœ¬æ—¶é—´å¸§å†…çš„å‘é€ï¼Œå°±å¯ä»¥ä¿è¯æ€»çº¿èŠ‚ç‚¹é—´é€šä¿¡çš„ç¡®å®šæ€§ã€‚ è®¡ç®—æ€»çº¿è´Ÿè½½æ—¶ï¼Œéœ€è¦é€‰å–ä¸€ä¸ªæ—¶é—´ç‰‡æ®µè¿›è¡Œåˆ†æï¼Œä½¿ç”¨æ—¶é—´é—´éš”æœ€å°çš„åŸºæœ¬æ—¶é—´å¸§ä½œä¸ºå‘é€é—´éš”ï¼ˆTransmission Intervalï¼‰ï¼Œå¯ä»¥è®¡ç®—å‡ºæœ€å¤§çš„æ€»çº¿è´Ÿè½½ã€‚ ARINC 825 ç½‘ç»œèŠ‚ç‚¹è®¾è®¡åˆ†ä¸ºå¤„ç†ç«¯ï¼Œæ§åˆ¶ç«¯å’Œæ”¶å‘ç«¯ å¤„ç†ç«¯æ¥æ”¶ç”±ä¼ æ„Ÿå™¨ç­‰è®¾å¤‡é‡‡é›†åˆ°å¹¶å‘é€è¿‡æ¥çš„æ¶ˆæ¯ï¼Œå¹¶å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œå¤„ç†åçš„æ¶ˆæ¯æ»¡è¶³ CAN å’Œ ARINC825 ç½‘ç»œçš„ç¡®å®šæ€§å’Œå®Œæ•´æ€§è¦æ±‚ æ—¶é—´ç‰‡ç®¡ç†æ¨¡å— è§„åˆ’æ—¶é—´ç‰‡é€šä¿¡è°ƒåº¦æœºåˆ¶ï¼šæ‰€æœ‰èŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„ä¸»æ—¶é—´ç‰‡å’Œæ¬¡æ—¶é—´ç‰‡ï¼Œä¸»æ—¶é—´ç‰‡åŒ…æ‹¬è‹¥å¹²æ¬¡æ—¶é—´ç‰‡å’Œç©ºé—²æ—¶é—´çª—(ä¹Ÿç§°ä¸ºä»²è£çª—)ï¼Œæ¯ä¸ªæ¬¡æ—¶é—´ç‰‡çš„æ—¶é—´é•¿åº¦ä¸å°äºç³»ç»Ÿå†…æ‰€æœ‰çš„èŠ‚ç‚¹ä¾æ¬¡è¿›è¡Œæ€»çº¿ç«äº‰çš„æ—¶é—´ï¼Œä¸»æ—¶é—´ç‰‡æ˜¯å½“å‰ç³»ç»Ÿå‘¨æœŸæ¶ˆæ¯çš„æœ€å¤§å‘¨æœŸå‘é€æ—¶é—´ï¼Œå³å‘¨æœŸæ¶ˆæ¯åˆ·æ–°æ—¶é—´ï¼Œä¸”æ¬¡æ—¶é—´ç‰‡æ˜¯ä¸»æ—¶é—´ç‰‡çš„å¶åˆ†æ•°ã€‚ æ¶ˆæ¯æ¥æ”¶å’Œå¤„ç†æ¨¡å— é€šè¿‡ç»™å®šçš„æ—¶é—´ç‰‡ï¼Œæ¥æ”¶ä¼ æ„Ÿå™¨ç­‰è®¾å¤‡çš„æ¶ˆæ¯å¹¶è¿›è¡Œæ ¼å¼åŒ–å¤„ç† é€šè¿‡ç»™å®šçš„æ—¶é—´ç‰‡ï¼Œæ¥æ”¶æ§åˆ¶ç«¯è¿”å›çš„æ¶ˆæ¯å¹¶è¿›è¡Œæ ¼å¼åŒ–å¤„ç† æ¶ˆæ¯å®Œæ•´æ€§æ ¡éªŒæ¨¡å— è¿›è¡Œé«˜åº¦å®Œæ•´æ€§æ ¡éªŒï¼Œæ­¥éª¤è§ é«˜åº¦å®Œæ•´æ€§åè®® ç‰‡å¤– SDRAM æ§åˆ¶æ¨¡å— å­˜å‚¨æ ¼å¼åŒ–å¤„ç†åçš„æ¶ˆæ¯å’Œå®Œæ•´æ€§æ ¡éªŒçš„æ ¡éªŒç»“æœï¼ŒæŒ‰ç…§æ ¼å¼åŒ–çš„æ¶ˆæ¯ï¼Œç‹¬ç«‹çš„å¸§ IDï¼Œå®Œæ•´æ€§æ ¡éªŒçš„æ ¡éªŒç»“æœè¿›è¡Œåˆ†åˆ«å­˜å‚¨ ä¸²å£é€šä¿¡æ¨¡å— å°†å¤„ç†å®Œæˆçš„æ¶ˆæ¯å‘é€ç»™æ§åˆ¶ç«¯ æ§åˆ¶ç«¯æ§åˆ¶ç«¯é€šè¿‡çƒ­å†—ä½™è¿›è¡Œæ•°æ®çš„æ”¶å‘ï¼Œä»¥æ»¡è¶³ ARINC825 çš„å¯ç”¨æ€§è¦æ±‚ åŒé“¾è·¯å†—ä½™æ¨¡å¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç¬¬ä¸€ä¸»èŠ‚ç‚¹çš„æ¶ˆæ¯å‡å‘é€åˆ°åŒä¸€ä¸ª ARINC825_A æ€»çº¿ä¸­ï¼Œç¬¬äºŒä¸»èŠ‚ç‚¹çš„æ¶ˆæ¯å‡å‘é€åˆ°åŒä¸€ä¸ª ARINC825_B æ€»çº¿ä¸­ ç³»ç»Ÿä¸­å­˜åœ¨ä¸¤æ¡ç‹¬ç«‹çš„é€šä¿¡é“¾è·¯ï¼Œç”¨äºä¼ è¾“ç›¸åŒçš„æ•°æ®æˆ–æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ã€‚è¿™ä¸¤æ¡é“¾è·¯åŒæ—¶å·¥ä½œï¼Œå½“å…¶ä¸­ä¸€æ¡é“¾è·¯å‡ºç°æ•…éšœæ—¶ï¼Œå¦ä¸€æ¡é“¾è·¯å¯ä»¥ç»§ç»­ä¼ è¾“æ•°æ®æˆ–æ‰§è¡Œä»»åŠ¡ï¼Œä»è€Œä¿è¯ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚ åŒé“¾è·¯èŠ‚ç‚¹æ··åˆå†—ä½™æ¨¡å¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç¬¬ä¸€ä¸»èŠ‚ç‚¹çš„æ¶ˆæ¯æ··åˆå‘é€åˆ°ä¸¤è·¯ ARINC825 æ€»çº¿ä¸­ ï¼Œè‹¥å¹²èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸»èŠ‚ç‚¹çš„æ¶ˆæ¯äº¤æ›¿å‘é€è‡³ ARINC825_A å’Œ ARINC825_B æ€»çº¿ä¸­ï¼ŒåŒæ—¶èŠ‚ç‚¹ä¸­çš„ç¬¬äºŒä¸»èŠ‚ç‚¹çš„æ¶ˆæ¯å‘é€è‡³å¦ä¸€è·¯ ARINC825 æ€»çº¿ä¸­ã€‚ ç³»ç»Ÿä¸­ä¸ä»…å­˜åœ¨ä¸¤æ¡ç‹¬ç«‹çš„é€šä¿¡é“¾è·¯ï¼Œè€Œä¸”æ¯ä¸ªé“¾è·¯ä¸­çš„èŠ‚ç‚¹ä¹Ÿå¯èƒ½å­˜åœ¨å†—ä½™é…ç½® å†—ä½™æ˜¯æŒ‡é‡å¤é…ç½®ç³»ç»Ÿçš„ä¸€äº›éƒ¨ä»¶ï¼Œå½“ç³»ç»Ÿå‘ç”Ÿæ•…éšœæ—¶ï¼Œå†—ä½™é…ç½®çš„éƒ¨ä»¶ä»‹å…¥å¹¶æ‰¿æ‹…æ•…éšœéƒ¨ä»¶çš„å·¥ä½œï¼Œç”±æ­¤å‡å°‘ç³»ç»Ÿçš„æ•…éšœæ—¶é—´ã€‚çƒ­å¤‡æ˜¯ä¸€ç§å¤‡ä»½æ–¹å¼ï¼Œå³ç³»ç»Ÿä¸­å­˜åœ¨ä¸€ä¸ªä¸»è®¾å¤‡å¤„äºè¿è¡ŒçŠ¶æ€ï¼ŒåŒæ—¶æœ‰ä¸€ä¸ªå¤‡ä»½è®¾å¤‡ä¹Ÿå¤„äºé€šç”µè¿è¡ŒçŠ¶æ€ï¼ˆä½†å¯èƒ½æœªæ‰¿æ‹…ä¸»è¦å·¥ä½œä»»åŠ¡ï¼‰ï¼Œéšæ—¶å‡†å¤‡åœ¨ä¸»è®¾å¤‡å‡ºç°æ•…éšœæ—¶ç«‹å³æ¥ç®¡å·¥ä½œã€‚ æ”¶å‘ç«¯ç›´æ¥å’Œæ€»çº¿è¿›è¡Œäº¤äº’ ç½‘å…³å¤„ç†åŒæ­¥ç½‘å…³å‘é€å‚è€ƒæ¶ˆæ¯ï¼Œæ€»çº¿ä¸Šå„èŠ‚ç‚¹æ¥æ”¶åˆ°å‚è€ƒæ¶ˆæ¯åï¼Œæ—¶é—´åŸºå‡†å½’é›¶ã€‚ä¿è¯æ€»çº¿ä¸Šæ‰€æœ‰èŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„ä¸»æ—¶é—´ç‰‡å’ŒåŸºæœ¬æ—¶é—´ç‰‡ï¼Œä¸»æ—¶é—´ç‰‡åŒ…å«è‹¥å¹²åŸºæœ¬æ—¶é—´ç‰‡å’Œç©ºé—²æ—¶é—´çª—å£ã€‚åŸºæœ¬æ—¶é—´ç‰‡çš„æ—¶é—´é•¿åº¦ä¸å°äºç³»ç»Ÿå†…æ‰€æœ‰èŠ‚ç‚¹åŒæ—¶è¿›è¡Œæ€»çº¿ç«äº‰æ‰€éœ€çš„æ€»æ—¶é—´ã€‚åŸºæœ¬äº‹ä»¶ç‰‡åˆ†ä¸ºåŒæ­¥ç›¸å’Œå¼‚æ­¥ç›¸ï¼ŒåŒæ­¥ç›¸ç”¨äºä¼ è¾“å‘¨æœŸæ€§æ¶ˆæ¯ï¼Œå¼‚æ­¥ç›¸ç”¨äºä¼ è¾“éå‘¨æœŸæ€§æ¶ˆæ¯ç«äº‰ï¼Œç©ºé—²æ—¶é—´çª—å£ç”¨äºä¼ è¾“éå‘¨æœŸæ€§æ¶ˆæ¯ã€‚ åœ¨ ARINC 825 è§„èŒƒä¸­ï¼Œä¸»æ¬¡æ—¶é—´å¸§çš„åŒæ­¥é€šå¸¸ç”± CAN ç½‘ç»œä¸­çš„ç½‘å…³æˆ–ä¸­å¤®æ§åˆ¶èŠ‚ç‚¹å‘å‡ºåŒæ­¥ä¿¡å·ï¼Œä»¥ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹çš„æ—¶é—´å¸§ä¿æŒä¸€è‡´ã€‚ç„¶è€Œï¼Œé™¤äº†ç”±ç½‘å…³å‘èµ·çš„åŒæ­¥ä¿¡å·å¤–ï¼Œè¿˜æœ‰å…¶ä»–å‡ ç§æ–¹å¼å¯ä»¥å®ç°ä¸»æ¬¡æ—¶é—´å¸§çš„åŒæ­¥æˆ–åè°ƒï¼Œå…·ä½“å¦‚ä¸‹ï¼š åˆ†å¸ƒå¼æ—¶é’ŸåŒæ­¥ ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡åˆ†å¸ƒå¼æ—¶é’ŸåŒæ­¥æœºåˆ¶ï¼Œè®©å„ä¸ªèŠ‚ç‚¹æ ¹æ®å…±åŒçš„å‚è€ƒæ—¶é’Ÿï¼ˆå¦‚ GPSã€PTPï¼‰æ¥åè°ƒå…¶æœ¬åœ°æ—¶é’Ÿã€‚æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å®šæœŸæ¥æ”¶æ—¶é’Ÿæ ¡å‡†ä¿¡å·ï¼Œä»è€Œè°ƒæ•´å…¶ä¸»æ¬¡æ—¶é—´å¸§ï¼Œä½¿å…¶ä¸ç½‘ç»œä¸­çš„å…¶ä»–èŠ‚ç‚¹ä¿æŒä¸€è‡´ã€‚è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºå¤§è§„æ¨¡ç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦ç²¾å‡†åŒæ­¥çš„åº”ç”¨ä¸­ã€‚ äº‹ä»¶é©±åŠ¨åŒæ­¥ å¦ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡ç‰¹å®šäº‹ä»¶æˆ–æ¶ˆæ¯çš„è§¦å‘æ¥å®ç°åŒæ­¥ã€‚æ¯”å¦‚ï¼Œå½“æŸä¸€ç‰¹å®šèŠ‚ç‚¹å‘é€ä¸€ä¸ªå…³é”®æ¶ˆæ¯æ—¶ï¼Œå…¶ä»–èŠ‚ç‚¹å¯ä»¥æ ¹æ®è¿™ä¸ªäº‹ä»¶ä½œä¸ºè§¦å‘ä¿¡å·æ¥è°ƒæ•´è‡ªèº«çš„ä¸»æ¬¡æ—¶é—´å¸§ã€‚è¿™ç§æ–¹å¼å¯ä»¥é€‚åº”ç³»ç»Ÿä¸­å…·æœ‰å¼‚æ­¥ç‰¹æ€§çš„æ“ä½œåœºæ™¯ã€‚ é™æ€è°ƒåº¦è¡¨ åœ¨æŸäº›ç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨é™æ€è°ƒåº¦è¡¨æ¥æå‰è§„åˆ’å¥½æ‰€æœ‰èŠ‚ç‚¹çš„æ—¶é—´å¸§ã€‚æ¯ä¸ªèŠ‚ç‚¹åœ¨è®¾è®¡æ—¶å°±è¢«èµ‹äºˆäº†å›ºå®šçš„æ—¶é—´å‘¨æœŸï¼Œç”¨äºå‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚è¿™ç§æ–¹æ³•é€šå¸¸ç”¨äºå…·æœ‰å›ºå®šé€šä¿¡æ¨¡å¼çš„å®æ—¶ç³»ç»Ÿã€‚æ‰€æœ‰èŠ‚ç‚¹æ ¹æ®é¢„å®šä¹‰çš„è°ƒåº¦è¡¨æ¥æ“ä½œï¼Œè€Œä¸ä¾èµ–åŠ¨æ€çš„åŒæ­¥ä¿¡å·ã€‚ åˆ†å±‚æ¶æ„åŒæ­¥ åœ¨å¤æ‚çš„ç³»ç»Ÿä¸­ï¼Œå¯èƒ½ä¼šä½¿ç”¨åˆ†å±‚æ¶æ„æ¥å®ç°æ—¶é—´åŒæ­¥ã€‚ä¸€ä¸ªé«˜çº§åˆ«çš„æ§åˆ¶èŠ‚ç‚¹å¯ä»¥ç®¡ç†ä¸»æ—¶é—´å¸§çš„åŒæ­¥ï¼Œè€Œæ¬¡æ—¶é—´å¸§å¯ä»¥ç”±å„ä¸ªå­ç½‘ç»œæˆ–æ¬¡èŠ‚ç‚¹è‡ªå·±ç®¡ç†ã€‚è¿™ç§æ¶æ„å¯ä»¥å‡å°‘ä¸­å¤®èŠ‚ç‚¹çš„åŒæ­¥è´Ÿæ‹…ï¼Œæä¾›ä¸€å®šçš„çµæ´»æ€§ã€‚ è‡ªä¸»åŒæ­¥çš„èŠ‚ç‚¹ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥è‡ªä¸»ç®¡ç†è‡ªå·±çš„ä¸»æ¬¡æ—¶é—´å¸§ï¼Œè€Œæ— éœ€ä¾èµ–ä¸­å¤®åŒæ­¥ã€‚æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æ ¹æ®è‡ªå·±å†…éƒ¨çš„è°ƒåº¦æœºåˆ¶æ¥åˆ’åˆ†ä¸»æ¬¡æ—¶é—´å¸§ï¼Œåªè¦ç¡®ä¿ä¸å…¶ä»–èŠ‚ç‚¹çš„é€šä¿¡åœ¨è§„å®šçš„çª—å£å†…è¿›è¡Œå³å¯ã€‚è¿™ç§æ–¹å¼é€‚åˆä¸€äº›åˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒèŠ‚ç‚¹é—´çš„æ—¶é—´ä¸éœ€è¦ä¸¥æ ¼åŒæ­¥ï¼Œè€Œåªéœ€è¦åœ¨æŸäº›æ—¶åˆ»è¿›è¡Œåè°ƒã€‚ å¤šç½‘å…³åŒæ­¥ å½“ç½‘ç»œè§„æ¨¡è¾ƒå¤§æˆ–å…·æœ‰ä¸åŒåŠŸèƒ½åŒºå—æ—¶ï¼Œå¯èƒ½ä¼šä½¿ç”¨å¤šä¸ªç½‘å…³æˆ–ä¸­å¤®æ§åˆ¶å•å…ƒã€‚è¿™äº›ç½‘å…³åˆ†åˆ«è´Ÿè´£è‡ªå·±åŒºåŸŸçš„åŒæ­¥ä»»åŠ¡ï¼Œè€Œé€šè¿‡è·¨ç½‘å…³çš„é€šä¿¡æ¥ç¡®ä¿æ•´ä¸ªç½‘ç»œçš„ä¸»æ¬¡æ—¶é—´å¸§åè°ƒã€‚è¿™ç§æ–¹å¼å¯ä»¥å¢åŠ ç³»ç»Ÿçš„å¯é æ€§å’Œæ‰©å±•æ€§ã€‚ è‡ªä¸»ä¸»æ¬¡æ—¶é—´å¸§çš„å®ç°ç†è®ºä¸Šï¼Œå¯ä»¥è®©å„ä¸ªèŠ‚ç‚¹è‡ªä¸»ä½¿ç”¨è‡ªå·±çš„ä¸»æ¬¡æ—¶é—´å¸§ï¼Œä½†è¿™å–å†³äºåº”ç”¨åœºæ™¯çš„å…·ä½“éœ€æ±‚ã€‚åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œè¿™ç§åˆ†å¸ƒå¼æ—¶é—´ç®¡ç†å¯ä»¥ç®€åŒ–ç³»ç»Ÿè®¾è®¡ï¼Œä½†ä¼šå¢åŠ èŠ‚ç‚¹ä¹‹é—´çš„åè°ƒéš¾åº¦ï¼Œå°¤å…¶æ˜¯åœ¨é«˜å®æ—¶æ€§è¦æ±‚çš„ç³»ç»Ÿä¸­ã€‚å¦‚æœå„ä¸ªèŠ‚ç‚¹çš„ä¸»æ¬¡æ—¶é—´å¸§ä¸ä¸¥æ ¼åŒæ­¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¼ è¾“å»¶è¿Ÿã€ä¸ä¸€è‡´æˆ–æ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚å› æ­¤ï¼ŒèŠ‚ç‚¹è‡ªä¸»æ—¶é—´å¸§çš„åº”ç”¨éœ€è¦è°¨æ…è€ƒè™‘ç½‘ç»œæ‹“æ‰‘ç»“æ„ã€æ¶ˆæ¯ä¼˜å…ˆçº§å’Œé€šä¿¡çª—å£çš„åˆç†åˆ†é…ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","èˆªç”µç³»ç»Ÿ"]},{"title":"IMAç³»ç»Ÿå¼€å‘æ–¹æ³•çš„ç ”ç©¶","path":"/2023/09/06/5-åµŒå…¥å¼å¼€å‘-èˆªç”µç³»ç»Ÿ-IMAç³»ç»Ÿå¼€å‘æ–¹æ³•çš„ç ”ç©¶/","content":"éšç€ IMA æ¶æ„çš„æ¨å¹¿åº”ç”¨ï¼ŒIMA æ¶æ„å·²æˆä¸ºå¤§å‹æ°‘ç”¨é£æœºç³»ç»Ÿçš„å…¸å‹æ¶æ„ï¼Œè€Œ IMA ç³»ç»Ÿçš„å¼€å‘æ¶‰åŠåˆ°ä¸é£æœºåˆ¶é€ å•†çš„äº¤äº’ã€ç°æœ‰æŠ€æœ¯çš„åº”ç”¨ã€å®‰è£…ä½ç½®çš„ç¯å¢ƒã€ç»´æŠ¤äººå‘˜çš„æ“ä½œç­‰å¤šæ–¹åˆ©ç›Šç›¸å…³è€…æå‡ºçš„çº¦æŸã€‚ æœ¬æ–‡ä¸»è¦ä»ä¸¤ä¸ªæ–¹é¢æ¢è®¨ IMA ç³»ç»Ÿçš„å¼€å‘æ–¹æ³•:ä¸€æ˜¯ä¸é£æœºåˆ¶é€ å•†çš„äº¤äº’ï¼Œé€šè¿‡é£æœºçº§ä»»åŠ¡çš„è¿è¡Œåœºæ™¯æ•è·åŠŸèƒ½ç³»ç»Ÿçš„éœ€æ±‚ï¼Œåå•† IMA å¯é©»ç•™çš„é£æœºç³»ç»Ÿï¼Œç¡®å®š IMA ç³»ç»Ÿçš„åŠŸèƒ½ã€æ€§èƒ½éœ€æ±‚;äºŒæ˜¯æŠ€æœ¯ã€ç¯å¢ƒã€åˆ©ç›Šç›¸å…³è€…ç­‰å¤šæ–¹æå‡ºçš„çº¦æŸï¼ŒåŒ…æ‹¬æˆç†ŸæŠ€æœ¯å¤ç”¨ã€é€‚èˆªè¦æ±‚ã€ç»´ä¿®æ€§è¦æ±‚ã€è£…æœºç¯å¢ƒè¦æ±‚ã€æ—¶é—´å’Œæˆæœ¬ã€äººä¸ºå› ç´ ã€å…¬å¸æˆ˜ç•¥ç­‰æ–¹é¢çš„çº¦æŸè¦æ±‚ã€‚ IMA ç³»ç»Ÿå¼€å‘æ–¹æ³•çš„ç ”ç©¶æ—¨åœ¨å¸®åŠ©å¼€å‘äººå‘˜æ·±å…¥äº†è§£è¿™äº›åˆ©ç›Šç›¸å…³è€…å¯¹ IMA çš„å½±å“ï¼Œä¸º IMA ç³»ç»Ÿè®¾è®¡å®è·µæä¾›å‚è€ƒã€‚ éšç€é£æœºå¯¹èˆªç”µç³»ç»Ÿéœ€æ±‚çš„ä¸æ–­å¢é•¿,æœºè½½ç³»ç»Ÿçš„åŠŸèƒ½å’Œæ€§èƒ½è¦æ±‚ä¸æ–­æé«˜,ç°ä»£èˆªç©ºç”µå­ç³»ç»Ÿè¶Šæ¥ è¶Šå‘ˆç°å¤æ‚ç³»ç»Ÿç‰¹å¾,è”åˆå¼æ¶æ„å·²è¿œä¸èƒ½æ»¡è¶³èˆªç”µç³»ç»Ÿçš„å‘å±•è¦æ±‚ã€‚ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜,20 ä¸–çºª 90 å¹´ä»£å›½å¤–å¼€å§‹äº†ç»¼åˆæ¨¡å—åŒ–èˆªç©ºç”µå­ç³»ç»Ÿçš„ç ”ç©¶å·¥ä½œ,å¹¶å¾ˆå¿«å–å¾—æŠ€æœ¯çªç ´;è€Œå¾®ç”µå­æŠ€æœ¯å’Œé›†æˆç”µè·¯çš„è¿…é€Ÿå‘å±•,å¼ºå¤§çš„å¾®å¤„ç†å™¨æŠ€æœ¯ã€é›†æˆç”µè·¯é›†æˆåº¦çš„ä¸æ–­å¢é•¿å’Œæˆæœ¬é™ä½,å¤§å¤§ä¿ƒè¿›äº†ç»¼åˆæ¨¡å—åŒ–èˆªç©ºç”µå­(Integrated Modular Avionics,IMA)æ¶æ„çš„æ¨å¹¿åº”ç”¨,IMA æ¶æ„æˆä¸ºå¤§å‹æ°‘ç”¨é£æœºç³»ç»Ÿçš„å…¸å‹æ¶æ„ã€‚ ç›®å‰ IMA æŠ€æœ¯çš„å‘å±•æ—¥è¶‹æˆç†Ÿ,å¼€æ”¾å¼ IMA ç³»ç»Ÿæ¶æ„èƒ½å¤Ÿæ»¡è¶³å¤§å‹å®¢æœºå¯¹èˆªç©ºç”µå­ç³»ç»Ÿé«˜çµæ´»æ€§ã€é«˜å¯é æ€§ä»¥åŠä¾¿äºå‡çº§æ¢ä»£çš„è¦æ±‚,ç»¼åˆåŒ–èˆªç”µç³»ç»Ÿå¾—åˆ°äº†å¹¿æ³›å…³æ³¨,å¹¶é€æ­¥æˆä¸ºæ°‘ç”¨å®¢æœºèˆªç©ºç”µå­ç³»ç»Ÿå‘å±•çš„ä¸»æµè¶‹åŠ¿ã€‚å…¸å‹ä»£è¡¨åŒ…æ‹¬ç¾å›½æ³¢éŸ³å…¬å¸ B787 é£æœºã€æ¬§æ´²ç©ºå®¢å…¬å¸çš„ A380 é£æœºå’Œ A350 é£æœºç­‰å…ˆè¿›å¹²çº¿é£æœºã€‚å›½çš„å¤§å‹å®¢æœº C919 ä¹Ÿé‡‡ç”¨ IMA ç³»ç»Ÿæ¶æ„ã€‚ IMA ç³»ç»Ÿç®€ä»‹ DO-297 ä¸­å¯¹ IMA çš„å®šä¹‰æ˜¯:â€IMA æ˜¯ä¸€ç»„çµæ´»çš„ã€å¯é‡ç”¨çš„ã€å¯äº’æ“ä½œçš„å…±äº«ç¡¬ä»¶å’Œè½¯ä»¶èµ„æº,å½“æŠŠè¿™äº›èµ„æºç»¼åˆåœ¨ä¸€èµ·æ—¶å¯ä»¥æ„å»ºä¸€ä¸ªå¹³å°,è¯¥å¹³å°æŒ‰ä¸€ç»„ç¡®å®šçš„å®‰å…¨å’Œæ€§èƒ½éœ€æ±‚è¿›è¡Œè®¾è®¡å’ŒéªŒè¯,èƒ½æ ä¾›å„ç§æœåŠ¡,å¹¶é©»ç•™æ‰§è¡Œé£æœºåŠŸèƒ½çš„åº”ç”¨â€ã€‚ ç”±æ­¤å¯è§,IMA ç³»ç»Ÿç”± IMA å¹³å°ä»¥åŠä¸€ç»„é©»ç•™åº”ç”¨ç»„æˆ,å…¶ä¸­ IMA å¹³å°é€šå¸¸åŒ…å« 1 ä¸ªæˆ–å¤šä¸ªæ¨¡å—ç»„ä»¶,é©»ç•™åº”ç”¨é€šå¸¸ä¹ŸåŒ…å« 1 ä¸ªæˆ–å¤šä¸ªç»„ä»¶ã€‚ è”åˆå¼æ¶æ„ä¸‹,æ¯ä¸ªèˆªç”µåŠŸèƒ½éƒ½æœ‰å„è‡ªç‰¹å®šçš„ç‹¬äº«çš„è®¡ç®—èµ„æº(å¤„ç†å™¨ã€æ•°æ®é€šä¿¡å’Œæ¥å£),è¿™äº›è®¡ç®—èµ„æºé©»ç•™åœ¨å„è‡ªç‹¬ç«‹çš„ç°åœºå¯æ›´æ¢å•å…ƒ(Line Replaceable Unit,LRU)ä¸­ã€‚ IMA ç³»ç»Ÿæ¶æ„ä¸ºé«˜åº¦é›†æˆçš„å®æ—¶ç³»ç»Ÿæä¾›æ‰€å¿…éœ€çš„æ ¸å¿ƒèµ„æºæ¡†æ¶,æä¾›å…¬å…±ç¡¬ä»¶è®¡ç®—æ¨¡å—çš„é›†ä¸­è®¡ç®—èµ„æº,ä¸ºèˆªç”µç³»ç»Ÿçš„é€šç”¨å¤„ç†åŠŸèƒ½æ„å»ºäº†ä¸€ä¸ªç‹¬ç«‹çš„é€šç”¨å¤„ç†å¹³å°,æä¾›å…¬å…±ç¡¬ä»¶è®¡ç®—æ¨¡å—çš„é›†ä¸­è®¡ç®—èµ„æºã€‚ IMA æ¶æ„ä¸ºå¤šä¸ªé£æœºåŠŸèƒ½çš„é©»ç•™æä¾›äº†å…¬å…±è®¡ç®—èµ„æº,å–ä»£äº†è”åˆå¼æ¶æ„ä¸­èˆªç”µåŠŸèƒ½é¢å‘ä»»åŠ¡çš„ä¸“ç”¨è®¡ç®—æœºã€‚ä»¥å‰è”åˆå¼èˆªç©ºç”µå­åº”ç”¨è½¯ä»¶åµŒå…¥åœ¨é¢å‘ä»»åŠ¡çš„ä¸“ç”¨è®¡ç®—æœºä¸­,ç°åœ¨åˆ™é©»ç•™åœ¨ IMA ç³»ç»Ÿçš„å…¬å…±æ ¸å¿ƒè®¡ç®—èµ„æºä¸Š,æé«˜äº†ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡å’Œå¯ç”¨æ€§ã€‚ IMA å¹³å°å±å¤æ‚æœºè½½è®¾å¤‡,ä¸ºé£æœºåŠŸèƒ½æä¾›æ”¯æŒé€šç”¨åŠŸèƒ½çš„å…¬å…±å¹³å°,å¦‚è®¡ç®—åŠŸèƒ½ã€ç½‘ç»œä¼ è¾“åŠŸèƒ½ã€æ•°æ®è½¬æ¢åŠŸèƒ½;è€Œä¸”,IMA å¹³å°ä¸æœºä¸Šå¤šä¸ªé©»ç•™åº”ç”¨è½¯ä»¶ã€æœºè½½è®¾å¤‡ç»„ä»¶(å¦‚ä¼ æ„Ÿå™¨ã€æ§åˆ¶å™¨ã€æ˜¾ç¤ºå™¨ã€ä½œåŠ¨å™¨ç­‰)è¿›è¡Œäº¤äº’,å¹¶ä¸ºé©»ç•™åº”ç”¨è½¯ä»¶æä¾›æ”¯æŒå…¶è¿è¡Œçš„æ‰§è¡Œç¯å¢ƒ,åŒ…æ‹¬ç¡¬ä»¶èµ„æºå’Œå¹³å°åŸºç¡€æœåŠ¡ã€‚è™½ç„¶ IMA å¹³å°å¯ä»¥é©»ç•™å¤šä¸ªé£æœºåŠŸèƒ½,ä½†æ˜¯ IMA å¹³å°æœ¬èº«å¹¶ä¸å…·å¤‡ä¸“ç”¨çš„é£æœºåŠŸèƒ½ã€‚å› æ­¤,å¼€å‘ IMA å¹³å°å¯ç‹¬ç«‹äºä¸“ç”¨é£æœºåŠŸèƒ½å’Œé©»ç•™åº”ç”¨è¿›è¡Œå®šä¹‰ä¸å¼€å‘ã€‚ IMAÂ ç³»ç»Ÿå¼€å‘æ–¹æ³• ç”±äº IMA ç³»ç»Ÿé©»ç•™å¤šä¸ªé£æœºåŠŸèƒ½,å› æ­¤ IMA ç³»ç»Ÿçš„ç»¼åˆåŒ–ç¨‹åº¦ã€ç³»ç»Ÿå†…å’Œç³»ç»Ÿé—´çš„ç›¸äº’å…³ç³»çš„å¤æ‚åº¦ç›¸å¯¹äºå•ä¸€åŠŸèƒ½å®ç°æ–¹å¼çš„è”åˆå¼æ¶æ„å‡æœ‰äº†å¾ˆå¤§çš„æå‡,è”åˆå¼æ¶æ„çš„å¼€å‘æ–¹æ³•å¾ˆéš¾é€‚ç”¨äº IMA æ¶æ„çš„å¼€å‘ã€‚ IMA ç³»ç»Ÿçš„å¼€å‘æ¶‰åŠä¸é£æœºåˆ¶é€ å•†çš„äº¤äº’ã€ç°æœ‰æŠ€æœ¯çš„åº”ç”¨ã€å®‰è£…ä½ç½®çš„ç¯å¢ƒã€ç»´æŠ¤äººå‘˜çš„æ“ä½œç­‰å¤šæ–¹ åˆ©ç›Šç›¸å…³è€…æå‡ºçš„çº¦æŸã€‚ å…¶ä¸»è¦å¯åˆ’åˆ†ä¸ºä¸¤ä¸ªæ–¹é¢: ä¸€æ˜¯ä¸é£æœºåˆ¶é€ å•†çš„äº¤äº’,IMA ç³»ç»Ÿä¾›åº”å•†å¯æ•è·é£æœºçº§ä»»åŠ¡çš„è¿è¡Œåœºæ™¯å’Œé£æœºåŠŸèƒ½éœ€æ±‚,å¹¶å‚ä¸é£æœºç³»ç»Ÿè”åˆè®¾è®¡å³é£æœºåŠŸèƒ½çš„åˆ’åˆ†å’Œåˆ†é…ã€è¿­ä»£,åå•†å¯é©»ç•™åœ¨ IMAÂ å¹³å°ä¸Šçš„é£æœºåŠŸèƒ½,ç¡®å®š IMA ç³»ç»Ÿçš„åŠŸèƒ½ã€æ€§èƒ½éœ€æ±‚; äºŒæ˜¯æŠ€æœ¯ã€ç¯å¢ƒã€åˆ©ç›Šç›¸å…³è€…ç­‰å¤šæ–¹æå‡ºçš„çº¦æŸ,åŒ…æ‹¬ IMA æˆç†ŸæŠ€æœ¯å¤ç”¨ã€é€‚èˆªæ¡æ¬¾ã€ç»´ä¿®æ€§è¦æ±‚ã€è£…æœºç¯å¢ƒè¦æ±‚ã€äººä¸ºå› ç´ ã€å…¬å¸æˆ˜ç•¥ç­‰æ–¹é¢çš„çº¦æŸè¦æ±‚ã€‚è¿™ä¸¤ä¸ªæ–¹é¢ä¸ IMA ç³» ç»Ÿ å¼€å‘çš„å…³ç³»å¦‚å›¾æ‰€ç¤ºã€‚ å›¾ä¸­,å‚ç›´æ–¹å‘ä»£è¡¨è‡ªé¡¶å‘ä¸‹åˆ†è§£çš„åŠŸèƒ½æ€§èƒ½ç»´åº¦,æ°´å¹³æ–¹å‘ä»£è¡¨ IMA ç³»ç»Ÿå¼€å‘çš„çº¦æŸé›†(å›¾ 1 é»‘æ–œçº¿å¤–ä¾§çš„åŒºåŸŸ),è¿™ä¸¤ä¸ªç»´åº¦çš„äº¤é›†(é»‘æ–œçº¿å†…ä¾§çš„åŒºåŸŸ)æ˜¯å¯æ¥å—çš„æ–¹æ¡ˆè®¾è®¡ã€‚æ˜¾è€Œæ˜“è§,åŠŸèƒ½æ€§èƒ½éœ€æ±‚å’Œå¼€å‘çº¦æŸé›†è¿™ä¸¤ä¸ªæ–¹é¢å†³å®šäº† IMA ç³»ç»Ÿçš„è§£å†³æ–¹æ¡ˆ,IMA ç³»ç»Ÿå¼€å‘ä¸ä½†è¦è€ƒè™‘é£æœºçº§è‡ªé¡¶å‘ä¸‹åˆ†è§£å‡º IMA ç³»ç»Ÿçš„åŠŸèƒ½æ€§èƒ½éœ€æ±‚,è¿˜è¦è€ƒè™‘è¿™äº›çº¦æŸé›†å¯¹æ–¹æ¡ˆè®¾è®¡çš„â€é™åˆ¶â€,æ‰èƒ½äº¤ä»˜å‡ºæ»¡è¶³è£…æœºè¦æ±‚çš„ IMA ç³»ç»Ÿã€‚ ä¸€ã€åŠŸèƒ½æ€§èƒ½éœ€æ±‚ éšç€é£æœºä»»åŠ¡å¤æ‚åº¦çš„æå‡,é£æœºåŠŸèƒ½å’Œç³»ç»ŸåŠŸèƒ½ä¹‹é—´å¹¶ä¸æ˜¯ç®€å•çš„ä¸€å¯¹ä¸€çš„åˆ†é…å…³ç³»,ä¸€ä¸ªé£æœºçº§åŠŸèƒ½å¯èƒ½ç”±å¤šä¸ªç³»ç»Ÿå®Œæˆ,ä¸€ä¸ªç³»ç»Ÿä¹Ÿå¯èƒ½å®Œæˆå¤šä¸ªé£æœºçº§åŠŸèƒ½ã€‚é£æœºçº§åŠŸèƒ½åˆ†é…çš„è¿‡ç¨‹ä¹Ÿæ˜¯ç¡®å®šé£æœºçº§ç³»ç»Ÿæ¶æ„çš„è¿‡ç¨‹,éœ€è¦å¯¹å¤šç§å› ç´ è¿›è¡Œè®¾è®¡æƒè¡¡ã€‚é£æœºçº§åŠŸèƒ½åˆ†é…é¦–å…ˆåº”ç¡®å®šåˆæ­¥é£æœºçº§ç³»ç»Ÿæ¶æ„,ç„¶å æ ¹æ®åˆæ­¥é£æœºçº§ç³»ç»Ÿæ¶æ„å°†é£æœºçº§åŠŸèƒ½åˆ†é…åˆ°ç›¸å…³ç³»ç»Ÿ,ç»è¿‡å¤šæ¬¡è¿­ä»£å®‰å…¨æ€§è¯„ä¼°ç»“æœä»¥åŠä¸ç³»ç»Ÿä¾›åº”å•†çš„åå•†ç»“æœ,ç¡®å®šæœ€ç»ˆçš„é£æœºçº§ç³»ç»Ÿæ¶æ„åŠåˆ†é…ç»™ç‰¹å®šç³»ç»Ÿçš„åŠŸèƒ½ã€‚ é£æœºåŠŸèƒ½åˆ†é…é˜¶æ®µ,é£æœºåˆ¶é€ å•†è‡ªé¡¶å‘ä¸‹åˆ†è§£æ¥è‡ªé£æœºç³»ç»Ÿçš„åŠŸèƒ½,ç¡®å®šé©»ç•™åœ¨ IMA å¹³å°ä¸Šçš„é£æœºåŠŸèƒ½,å½¢æˆ IMA ç³»ç»Ÿçš„é¡¶å±‚éœ€æ±‚ã€‚IMA ç³»ç»Ÿå¼€å‘å•†åº”ç§¯æè”ç³»é£æœºåˆ¶é€ å•†ã€å‚ä¸é£æœºç³»ç»Ÿè®¾è®¡è¿‡ç¨‹å³è”åˆè®¾è®¡é˜¶æ®µ,å‘é£æœºåˆ¶é€ å•†æä¾›æ¥è‡ª IMA çš„æŠ€æœ¯æ”¯æŒ(åŒ…æ‹¬ IMA æ¶æ„ã€æ¨¡å—è®¾è®¡ã€ç¡¬ä»¶è®¾è®¡ã€è½¯ä»¶è®¾è®¡ã€å®‰å…¨æ€§è¯„ä¼°ã€å¹³å°èµ„æºã€è¿è¡Œæ•ˆç‡ç­‰),ä»¥å®ç°èˆªç©ºç”µå­ç³»ç»Ÿé€»è¾‘æ¶æ„åˆ° IMA å…¬å…±å¤„ç†èµ„æºçš„æ˜ å°„,é€šè¿‡åŒæ–¹åå•†è”åˆè®¾è®¡ IMA ç³»ç»Ÿåˆæ­¥æ¶æ„ç¡®ä¿æ»¡è¶³é£æœºçº§ç³»ç»Ÿæ¶æ„çš„è¦æ±‚ã€‚ åŒæ—¶,è”åˆè®¾è®¡è¿˜æœ‰åŠ©äº IMA ç³»ç»Ÿå¼€å‘å•†æ›´å¥½åœ°äº†è§£é£æœºçº§é¡¶å±‚éœ€æ±‚ã€ç¡®å®š IMA ç³»ç»Ÿéœ€æ±‚å¹¶å‘ä¸‹åˆ†è§£ã€åˆ¶å®šå…¬å¸æˆ˜ç•¥ã€å°†ç³»ç»Ÿçº§éœ€æ±‚ä½œä¸ºå¼€å‘ä¸‹ä¸€ä»£å¯è®¤è¯ IMA å¹³å°çš„è¾“å…¥ç­‰å·¥ä½œ,ä¸º IMA ç³»ç»Ÿå¼€å‘å¥ å®šäº†åŸºç¡€ã€‚ IMA å¹³å°ä¸ºå¤šä¸ªé£æœºåŠŸèƒ½æä¾›å…¬å…±è®¡ç®—èµ„æºä»¥åŠé€šç”¨æ¥å£èµ„æº,æ”¯æŒåŒæ—¶é©»ç•™å¤šä¸ªé£æœºåŠŸèƒ½,å…¶å¼€å‘æ¶‰åŠå¤šä¸ªæœºè½½ç³»ç»Ÿçš„å‚ä¸ã€‚åŸºäº IMA æ¶æ„çš„é£æœºçº§åŠŸèƒ½åˆ†é…è¿‡ç¨‹ä¸­,é£æœºç³»ç»Ÿè¢«åˆ’åˆ†ä¸ºè®¡ç®—å¤„ç†åŠŸèƒ½å’Œç³»ç»Ÿä¸“ç”¨åŠŸèƒ½ä¸¤éƒ¨åˆ†,å…¶ä¸­é£æœºç³»ç»Ÿçš„è®¡ç®—å¤„ç†åŠŸèƒ½å¯è¢«åˆ†é…åˆ° IMA ç³»ç»Ÿä¸­å®ç°,ç³»ç»Ÿä¸“ç”¨åŠŸèƒ½åˆ™å¿…é¡»ä¿ç•™ç”±å…·æœ‰ç‰¹æ®Šæ¥å£çš„ä¸“ç”¨è®¾å¤‡å®Œæˆ; ç”±äº IMA ç³»ç»Ÿä¸»è¦æä¾›å…¬å…±è®¡ç®—èµ„æºä»¥åŠé€šç”¨æ¥å£èµ„æº,ä¸èƒ½æ»¡è¶³æ‰€æœ‰é©»ç•™åŠŸèƒ½çš„éœ€æ±‚,å¯¹äºä¸€äº›éœ€è¦ç‰¹æ®Šèµ„æºçš„ç³»ç»ŸåŠŸèƒ½, éœ€è¦ IMA ç³»ç»Ÿå’Œç³»ç»Ÿä¸“ç”¨è®¾å¤‡å…±åŒå®ç°ã€‚æ­¤å¤–,åŸºäº IMA æ¶æ„ä¸‹é™¤å®Œæˆè”åˆå¼æ¶æ„ä¸‹é£æœºçº§åŠŸèƒ½åˆ†é…å·¥ä½œå¤–,è¿˜éœ€è¦é€šè¿‡å¯¹å®‰å…¨æ€§ã€å¹³å°èµ„æºã€è¿è¡Œæ•ˆç‡ç­‰å¤šç§å› ç´ è¿›è¡Œæƒè¡¡,ç¡® å®šå¯é©»ç•™åœ¨ IMA å¹³å°ä¸­çš„ç³»ç»ŸåŠŸèƒ½ã€‚ é£æœºåŠŸèƒ½åˆ†é…åˆ° IMA ç³»ç»Ÿå,éœ€è¦å†å¤šæ¬¡é€çº§å‘ä¸‹è¿›è¡ŒåŠŸèƒ½åˆ†è§£,ä¸€ç›´åˆ†è§£åˆ°è½¯ç¡¬ä»¶å¯è¿›è¡Œè®¾è®¡å®ç°çš„ç¨‹åº¦ã€‚åŠŸèƒ½æ€§èƒ½çš„éœ€æ±‚åœ¨å±‚ä¸å±‚ä¹‹é—´çš„è¿½è¸ªå…³ç³»å¿…é¡»ä¸¥æ ¼å¾—åˆ°ä¿è¯,å³è®¾è®¡è¿‡ç¨‹ä¸­ä»»ä½•å±‚çº§çš„æè¿°å’Œè€ƒè™‘å§‹ç»ˆå¯¹æœ€é¡¶å±‚â€”â€”â€”ä»»åŠ¡å±‚è´Ÿè´£,è¿™æ ·æ‰èƒ½ç¡®ä¿æœ€ç»ˆçš„è®¾è®¡å®ç°ä¸é£æœºä»»åŠ¡éœ€æ±‚ã€‚ äºŒã€çº¦æŸé›† IMA ç³»ç»Ÿå¼€å‘ä¸ä½†è¦è€ƒè™‘é£æœºçº§è‡ªé¡¶å‘ä¸‹åˆ†è§£å‡º IMA ç³»ç»Ÿçš„åŠŸèƒ½æ€§èƒ½éœ€æ±‚,è¿˜è¦è€ƒè™‘è¿™äº›çº¦æŸé›†å¯¹æ–¹æ¡ˆè®¾è®¡çš„â€é™åˆ¶â€ã€‚â€çº¦æŸâ€ç»å¸¸ä»¥éœ€æ±‚çš„å½¢å¼å‡ºç°,ä¾‹å¦‚è®¤è¯éœ€æ±‚,åŒæ ·,æ¥è‡ªäºé¡¶å±‚é£æœºçº§ä»»åŠ¡çš„åŠŸèƒ½æ€§èƒ½éœ€æ±‚å°†é€çº§åˆ†è§£åˆ°åº•å±‚â€”â€”â€”å®ç°å±‚,ä»¥é©±åŠ¨åº•å±‚éœ€æ±‚ç”ŸæˆæŸç§å½¢å¼çš„è§£å†³æ–¹æ¡ˆã€‚å¯¹äº IMA å¼€å‘å•†,è¯†åˆ«é£æœºçº§ä»»åŠ¡çš„éœ€æ±‚ä¸çº¦æŸä¹‹é—´çš„å·®å¼‚æ€§éå¸¸é‡è¦,åœ¨ å¤šæ–¹åå•†ä»¥åŠè§£å†³æ–¹æ¡ˆçš„â€æƒè¡¡â€ä¸­èµ·åˆ°è‡³å…³é‡è¦çš„ä½œç”¨ã€‚ 1ã€é€‚èˆªè®¤è¯éœ€æ±‚ é€‚èˆªè®¤è¯éœ€æ±‚æºè‡ªé£æœºçº§çš„å®šä¹‰,æ˜¯é£æœºåˆ¶é€ å•†ä¸é€‚èˆªè®¤è¯çš„å±€æ–¹è¾¾æˆä¸€è‡´çš„ç»“æœ,ä¸­å›½æ°‘ç”¨èˆªç©ºå±€ å‘å¸ƒçš„é€‚èˆªè§„ç« (æˆ–è€…ç¾å›½è”é‚¦èˆªç©ºç®¡ç†å±€æˆ–æ¬§æ´²èˆªç©ºå®‰å…¨å±€ä½¿ç”¨ã€‚ä¾‹ å¦‚,ä¸­å›½æ°‘ ç”¨èˆªç©ºè§„ç« ç¬¬ 25 éƒ¨é€‚ç”¨äºèˆªç©ºè¿è¾“ç±»é£æœºçš„é€‚èˆªè®¤è¯ã€‚å›½å†…æ°‘ç”¨é£æœºä»¥ CCAR 25 éƒ¨ä¸ºå®¡å®šåŸºç¡€,ä½†è€ƒè™‘åˆ°å‹å·åç»­å‘å±•ä»¥å–å¾— FAA å’Œ EASA é¢å‘çš„å‹å·åˆæ ¼è¯çš„éœ€è¦,å› æ­¤åœ¨è®¾è®¡è¿‡ç¨‹ä¸­å¾€å¾€ä¼šåŒæ—¶è€ƒè™‘ FAA é¢å‘çš„é€‚èˆªè§„ç«  14CFR 25 å’Œ EASA é¢å‘çš„é€‚èˆªè®¤è¯è§„èŒƒ CS 25 çš„è¦æ±‚ã€‚ ä¸‹é¢ä»¥ CCAR 25 æ¡æ¬¾ä¸ºä¾‹è¯´æ˜é€‚èˆªè®¤è¯éœ€æ±‚åˆ°é£æœºç³»ç»Ÿå’Œèˆªç”µç³»ç»Ÿçš„åˆ†è§£ã€‚æ¡æ¬¾ Â§25.1301 è§„å®š, â€œ(a)æ‰€å®‰è£…çš„æ¯é¡¹è®¾å¤‡å¿…é¡»ç¬¦åˆä¸‹åˆ—è¦æ±‚:(1)å…¶ç§ç±»å’Œè®¾è®¡ä¸é¢„å®šåŠŸèƒ½ç›¸é€‚åº”ã€‚â€å…¶ä¸­è®¾å¤‡çš„è®¾è®¡ä¸å®‰è£…ç¬¦åˆâ€é¢„å®šåŠŸèƒ½â€æ˜¯æŒ‡åœ¨é£æœºçš„è¿è¡Œå’Œç¯å¢ƒæ¡ä»¶ä¸‹,è®¾ å¤‡åŠŸèƒ½æ­£å¸¸ã€‚åœ¨ç ”åˆ¶è¿‡ç¨‹ä¸­è®¾å¤‡çš„åŠŸèƒ½åŠæ€§èƒ½æŒ‡æ ‡é€šå¸¸åœ¨è®¾å¤‡è§„èŒƒä¸­æ˜ç¡®,ä½œä¸ºåç»­ç ”åˆ¶çš„ä¾æ®ã€‚æ­¤éœ€æ±‚æ˜¯é€šè¿‡ç¬¦åˆæŠ€æœ¯æ ‡å‡†è§„å®šæ¥æ»¡è¶³çš„,è€Œ TSO åˆä¼šè°ƒç”¨ä¸€ç³»åˆ—è¡Œä¸šæ ‡å‡†,ä¾‹å¦‚ç¾å›½èˆªç©ºæ— çº¿ç”µæŠ€æœ¯å§”å‘˜ä¼š å‘å¸ƒçš„ç›¸å…³æœ€ä½æ“ä½œæ€§èƒ½æ ‡å‡†,è¿™äº›éœ€æ±‚éƒ½éœ€è¦ä¸è®¤è¯æœºæ„è¿›è¡Œè®¨è®ºå¹¶è¾¾æˆä¸€è‡´ã€‚ æ­¤å¤–,åŠŸèƒ½æ€§èƒ½éœ€æ±‚å’Œé€‚èˆªéœ€æ±‚ç”Ÿæˆçš„çº¦æŸå‡å¯¹ç³»ç»Ÿå­ç³»ç»Ÿçš„å¯é æ€§éœ€æ±‚äº§ç”Ÿå½±å“ã€‚é€šå¸¸,é£æœºä»»åŠ¡æˆåŠŸç‡çš„ç›®æ ‡æ˜¯ç”µå­è®¾å¤‡å¯é æ€§è¦æ±‚çš„å…³é”®é©±åŠ¨å› ç´ ã€‚ä½†æ˜¯,é€‚èˆªè§„ç« çš„å®‰å…¨æ€§æ®µè½ä¹ŸåŒ…æ‹¬å¯é æ€§éœ€æ±‚ã€‚ä¾‹å¦‚,é€‚èˆªè§„ç«  CCAR 25 ä¸­å®‰å…¨æ€§ç›¸å…³æ¡æ¬¾Â§25.1309 ä»¥ç›¸åº”å¯æ¥å—çš„ç¬¦åˆæ€§æ–¹æ³• AC 25.13091A æè¿°å®‰å…¨æ€§éœ€æ±‚åŠå…¶ä¸å¯é æ€§éœ€æ±‚ä¹‹é—´çš„å…³ç³»ã€‚é£æœºå®‰å…¨æ€§ç›¸å…³çš„å¤±æ•ˆçŠ¶å†µå½±å“ä¸å¯é æ€§ä¹‹é—´çš„å…³ç³»å¦‚è¡¨ 1 æ‰€åˆ—ã€‚ è¡¨ 1 åŠŸèƒ½å±å®³æ€§å½±å“åˆ†ç±» ç”±äºé£æœºåŠŸèƒ½çš„å¤±æ•ˆå¯èƒ½ä¼šå¯¹é£æœºæ€§èƒ½äº§ç”Ÿä¸åˆ©å½±å“,æ‰€ä»¥å¿…é¡»è¯„ä¼°é£æœºåŠŸèƒ½çš„å¤±æ•ˆå½±å“ã€‚å¦‚æœå¤±æ•ˆå½±å“æ¶‰åŠåˆ°æœºç»„äººå‘˜å’Œæˆ–ä¹˜å®¢,é‚£ä¹ˆç›¸å…³é£æœºåŠŸèƒ½çš„å¤±æ•ˆæ¦‚ç‡å¿…é¡»æ˜¯è¿œä¸å¯èƒ½å‘ç”Ÿçš„ã€‚ä¾‹å¦‚:å¦‚æœæŸé£æœºåŠŸèƒ½å¤±æ•ˆå¯¹é£æœºä¹˜å‘˜çš„å½±å“åŒ…æ‹¬å¯¹å°‘æ•°ä¹˜å®¢æˆ–æœºç»„äººå‘˜é€ æˆä¸¥é‡çš„è‡´å‘½çš„ä¼¤å®³,é‚£ä¹ˆè¯¥é£æœºåŠŸèƒ½çš„å¤±æ•ˆæ¦‚ç‡ä¸èƒ½é«˜äº 1Ã—10-7é£è¡Œå°æ—¶ã€‚ç”±æ­¤å¯è§,é£æœºçº§çš„å®‰å…¨æ€§è¦æ±‚è¢«è½¬æ¢æˆåŠŸèƒ½å­åŠŸèƒ½çº§çš„å¯é æ€§éœ€æ±‚ã€‚ åœ¨åŠŸèƒ½å±‚åŠä»¥ä¸‹å±‚çº§ä¸å­˜åœ¨â€å®‰å…¨æ€§â€éœ€æ±‚,åªæœ‰å¯é æ€§éœ€æ±‚;è¿™äº›å¯é æ€§éœ€æ±‚å°†ä¼´éšç€åŠŸèƒ½ä¸€èµ·é€çº§å‘ä¸‹åˆ†è§£,ä»¥ç¡®ä¿æ»¡è¶³é¡¶å±‚åŠŸèƒ½çº§çš„åˆå§‹å¯é æ€§éœ€æ±‚ã€‚å› æ­¤,ç³»ç»Ÿå­ç³»ç»Ÿçš„å¯é æ€§æŒ‡æ ‡å¿…é¡»åŒæ—¶æ»¡è¶³é¡¶å±‚ä»»åŠ¡åˆ†è§£çš„å¯é æ€§éœ€æ±‚å’Œæ¥è‡ªé€‚èˆªå®‰å…¨æ€§çš„å¯é æ€§éœ€æ±‚ã€‚ 2ã€è¿è¥éœ€æ±‚ é£æœºè¿è¥å¿…é¡»è€ƒè™‘è¦æ±‚å¼ºåˆ¶æ‰§è¡Œçš„åŠŸèƒ½å’Œæ€§èƒ½éœ€æ±‚ã€‚å¦‚æ¬§æ´²é¢å‘è§„ç« ä½œä¸ºâ€å§”ä»»è§„ç«  No.9652012â€,æ ¹æ®æ¬§æ´²è®®ä¼šå’Œç†äº‹ä¼šçš„ No.2162008 è§„å®š,åˆ¶å®šèˆªç©ºè¿è¥ç›¸å…³çš„æŠ€æœ¯éœ€æ±‚å’Œè¡Œæ”¿ç¨‹åºã€‚é£æœºè¿è¥è¦æ±‚ç”±å±€æ–¹å‘å¸ƒè§„ç« åˆ¶å®šèˆªç©ºè¿è¥ç›¸å…³çš„æŠ€æœ¯éœ€æ±‚å’Œè¡Œæ”¿ç¨‹ åº,è¿™äº›è§„ç« åŒ…æ‹¬å¯¹è¿è¥ç»„ç»‡æ–¹çš„ä¸åŒç±»å‹çš„éœ€æ±‚ã€‚å¯¹äºé£æœºåŠŸèƒ½,ä¸ºäº†è¿›è¡Œç‰¹å®šç±»åˆ«çš„æ“ä½œé£æœºå¿…é¡»è£…å¤‡æœºè½½ç”µå­è®¾å¤‡,å¦‚â€å•†ç”¨èˆªç©ºè¿è¾“â€ã€‚ å¸¸è§çš„ç›¸å…³é£æœºåŠŸèƒ½åŒ…æ‹¬,é«˜åº¦å‘Šè­¦ç³»ç»Ÿã€åœ°å½¢è¯†åˆ«åŠå‘Šè­¦ç³»ç»Ÿã€é˜²ç¢°æ’ç³»ç»Ÿã€å¤©æ°”æ¢æµ‹è®¾å¤‡ã€é£è¡Œæœºç»„å¯¹è®²ç³»ç»Ÿã€åº§èˆ±è¯­éŸ³åŠé£è¡Œæ•°æ®è®°å½•ä»ªã€æœ€å°æ— çº¿ç”µå¯¼èˆªä¸é€šä¿¡åŠŸèƒ½ç­‰ã€‚è¿™äº›åŠŸèƒ½æ¥è‡ªé£æœºè¿è¥çš„éœ€æ±‚,è€Œä¸æ˜¯é€‚èˆª;è€Œä¸”,è¿™äº›è®¾å¤‡çš„è£…æœºå¿…é¡»æ»¡è¶³é€‚èˆªè®¤è¯çš„è¦æ±‚,å³æ»¡è¶³å®‰å…¨æ€§ã€å¯é æ€§çš„è¦æ±‚ã€‚ 3ã€è¡Œä¸šæ ‡å‡†å’Œæ¨èå®è·µ æ‰€æœ‰èˆªç”µè®¾å¤‡å’Œç›¸å…³åŠŸèƒ½çš„åˆ†é…å’Œå®ç°éƒ½åº”ä¸è¡Œä¸šæ ‡å‡†ã€è§„å®šä¿æŒä¸€è‡´,åˆ†åˆ«è§„å®šå¹¶é€é¡¹è¯¦ç»†è¯´æ˜,ä»¥è·å–è®¤å¯å’Œèˆªç©ºå¯æ‰¹å‡†çš„æ€§èƒ½(å³é€‚èˆªæ€§),è¡Œä¸šäº’æ¢æ€§ç¬¦åˆèˆªç©ºå®è·µ(å³è€ƒè™‘äººä¸ºå› ç´ ,ææ–™,è¡¨é¢å¤„ç†,åˆ¶é€ å·¥è‰º)ä»¥åŠä¸é€šç”¨èˆªç©ºé¢†åŸŸè§„å®šä¿æŒä¸€è‡´ã€‚å¸¸ç”¨è¡Œä¸šæ ‡å‡†å’Œæ¨èå®è·µåŒ…æ‹¬: (1) RTCA,ç¾å›½èˆªç©ºæ— çº¿ç”µæŠ€æœ¯å§”å‘˜ä¼š,åè°ƒ MOPS å’Œæœ€ä½èˆªç©ºç³»ç»Ÿæ€§èƒ½æ ‡å‡†å¹¶è¾¾æˆå…±è¯†ã€‚ç¬¦åˆ MOPS å’Œ MASPS çš„æ ‡å‡†é€šå¸¸ç”± TSO æå‡º,å› æ­¤ TSO æ˜¯è®¾å¤‡è·å¾— FAA è®¤å¯ã€è£…æœºä½¿ç”¨èµ„æ ¼çš„åŸºç¡€ã€‚ ï¼ˆ2ï¼‰EUROCAE ,æ¬§æ´²æ°‘èˆªè®¾å¤‡ç»„ç»‡,æ˜¯æ¬§æ´²ç›¸å½“äº RTCA çš„æœºæ„,è´Ÿè´£åˆ¶å®šæ¬§æ´²çš„èˆªç©ºæ ‡å‡†ã€‚EUROCAE æ ‡å‡†æ˜¯è®¾å¤‡è·å¾— EASA è®¤å¯ã€è£…æœºä½¿ç”¨èµ„æ ¼çš„åŸºç¡€ã€‚ ï¼ˆ3ï¼‰SAE ,æ±½è½¦å·¥ç¨‹å­¦ä¼š,è´Ÿè´£èˆªç©ºç”µå­ç›¸å…³åŠŸèƒ½å’Œæ€§èƒ½é¢†åŸŸçš„èˆªç©ºèˆªå¤©æ ‡å‡†å’Œèˆªç©ºèˆªå¤©æ¨èå®è·µçš„ç¼–å†™å’Œæ±‡æ€»,å¦‚é£è¡Œæ“çºµå’Œé£è¡Œæ§åˆ¶ã€é£è¡Œåº§èˆ±æ˜¾ç¤ºå’Œä¿¡å·ã€ç»´æŠ¤å®è·µã€åº”ç”¨äººä¸ºå› ç´ ã€‚ ï¼ˆ4ï¼‰ARINCï¼Œèˆªç©ºæ— çº¿ç”µå…¬å¸,ç”±èˆªç©ºå…¬å¸ç”µå­å·¥ç¨‹å§”å‘˜ä¼šç»„æˆ,æ ¹æ®ç”µå­è®¾å¤‡ç‰¹æ€§åˆ¶å®šç±»å‹ã€å°ºå¯¸å’ŒåŠŸèƒ½çº¦å®š,æ˜¯è®¾å¤‡ä¹‹é—´ç‹¬ ç«‹äºç³»ç»Ÿåˆ¶é€ å•†å®ç°äº’æ¢æ€§æ‰€å¿…éœ€çš„ã€‚è¯¥ç‰¹æ€§å®šä¹‰äº†è®¾å¤‡çš„åŠŸèƒ½æ€§èƒ½ã€ç³»ç»Ÿé—´å’Œæ§åˆ¶æ˜¾ç¤ºæ¥å£çš„è¿æ¥å™¨å¼•è„šå±‚ç­‰è§„å®šã€‚ 4ã€æ—¶é—´å’Œæˆæœ¬ç›®æ ‡ ä¸èˆªç”µåŠŸèƒ½ç›¸å…³çš„æ—¶é—´å’Œæˆæœ¬ç›®æ ‡å¿…é¡»åœ¨é£æœºçº§ çš„è®¾è®¡å’Œå¼€å‘è¿‡ç¨‹ä¸­è¢«è¯†åˆ«,å¹¶å‘ä¸‹åˆ†è§£åˆ°ç³»ç»Ÿçº§ä½œä¸ºç³»ç»Ÿä¾›åº”å•†çš„æˆæœ¬ç›®æ ‡æˆ–é¢„ç®—,IMA ç³»ç»Ÿå¼€å‘éœ€å…³æ³¨å¼€å‘å‘¨æœŸã€å¼€å‘æˆæœ¬ã€é£è¡Œå’Œç»´æŠ¤æœºç»„çš„åŸ¹è®­è´¹ç”¨ã€ç»´æŠ¤æˆæœ¬ç­‰å› ç´ ã€‚ 5ã€ä¼ä¸šæ ‡å‡† ä¼ä¸šæ ‡å‡†å¯èƒ½éœ€è¦åœ¨å¼€å‘è¿‡ç¨‹ä¸­è¿›è¡Œç‰¹å®šçš„è€ƒ è™‘,å¦‚é¦–é€‰å·¥å…·ã€é¦–é€‰å¼€å‘åŠŸèƒ½ã€ç‰¹æ®Šå¼€å‘è½¯ä»¶çš„ä½¿ç”¨ã€ç‰¹å®šçš„å‘½åã€å½’æ¡£ã€è®°å½•è§„å®šç­‰ã€‚è¿™äº›æ ‡å‡†å¯èƒ½ä¼šåç¦» æˆ–å¢åŠ ä»¥å…¶ä»–æ–¹å¼æˆ–ä»è¡Œä¸šé€šç”¨å®è·µä¸­è·å¾—çš„æ ‡å‡†, ç”±å…¶ä»–é¡¹ç›®åº”ç”¨æˆ–å› æˆæœ¬çš„è€ƒè™‘ç­‰å› ç´ äº§ç”Ÿçš„æ ‡å‡†ã€‚ 6ã€æœ€ä½æ€§èƒ½è¦æ±‚(MPS) èˆªç”µè®¾å¤‡åŒ…ç ”å‘è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªå…³é”®å‚æ•°æ˜¯å„åŠŸèƒ½ çš„æ€§èƒ½è¦æ±‚ã€‚æ€§èƒ½è¦æ±‚å°†é€‚ç”¨äºæ¯ä¸ªèˆªç”µè®¾å¤‡åŠŸèƒ½, å› æ­¤æ¯ä¸ªèˆªç”µè®¾å¤‡åŠŸèƒ½å¿…é¡»æ¯«æ— ä¾‹å¤–åœ°æ´¾ç”Ÿå‡ºæ‰€éœ€çš„ æ€§èƒ½ æŒ‡ æ ‡ å€¼,MPS æº äºè®¤è¯å’Œæ“ä½œæ‰¹å‡†éœ€æ±‚,ä¾‹ å¦‚ IMA æ¨¡å— MPS æ¥è‡ª TSO 153ã€‚ 7ã€å¤ç”¨éœ€æ±‚ å¤ç”¨éœ€æ±‚ä¸å…¬å¸æˆ˜ç•¥å’Œå…¬å¸æ ‡å‡†å¯†åˆ‡ç›¸å…³ã€‚æ ¹æ® å…¬å¸åˆ¶å®šçš„å•†ä¸šè®¡åˆ’å’ŒæŠ€æœ¯å‘å±•æˆ˜ç•¥,èˆªç©ºç”µå­è®¾å¤‡ç ”å‘é¡¹ç›®å¯èƒ½æ˜¯å…¬å¸å·²ç»å‚ä¸æˆ–è€…å¸Œæœ›åœ¨æœªæ¥å‚ä¸çš„å¤šä¸ªç±»ä¼¼é¡¹ç›®ä¹‹ä¸€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹,å¯åº”ç”¨åˆ°å¤šä¸ªé¡¹ç›®çš„æŠ€æœ¯å¤ç”¨ä¼šä¸ºå…¬å¸èŠ‚çº¦å¼€å‘æˆæœ¬,æé«˜åˆ©æ¶¦ã€‚ åè¿‡æ¥è¯´,æŠ€æœ¯å¤ç”¨ä¹Ÿå¯èƒ½ä¼šåœ¨è®¾è®¡æ–¹é¢è§„å®šçº¦æŸ,åŒ…æ‹¬æ–‡æ¡£ã€åŠŸèƒ½åˆ†åŒºã€ç³»ç»Ÿæ€§èƒ½ã€ç³»ç»Ÿæˆæœ¬,ç”šè‡³ç³»ç»ŸåŠŸèƒ½ã€‚å½“å‰é¡¹ç›®å¯èƒ½åªéœ€è¦è¿™äº›åŠŸèƒ½çš„ä¸€ä¸ªå­é›†,ä½†æ˜¯å°†æ¥çš„æŠ€æœ¯é‡ç”¨çš„éœ€æ±‚å¯èƒ½ä¼šæ›´ä¸ºå¹¿æ³›ã€‚ è€Œä¸”,å¤ç”¨éœ€æ±‚å¯èƒ½ä¼šè¿«ä½¿å…¬å¸ä½¿ç”¨ä¸“ç”¨çš„é¡¹ç›®ç®¡ç†å’Œè´¢åŠ¡åŠŸèƒ½,ç”±äºå…¬å¸é¡¹ç›®ç®¡ç†å’Œè´¢åŠ¡å·¥ä½œåªèƒ½ åœ¨å½“å‰é¡¹ç›®ä¸Šæ”¶å–éƒ¨åˆ†è´¹ç”¨,å…¶ä½™å·¥ä½œçš„æ”¶è´¹å°†åœ¨å¤ç”¨é¡¹ç›®ä¸­äº§ç”Ÿã€‚ 8ã€ç¯å¢ƒ ç›®æ ‡é£æœºä¸ºèˆªç”µè®¾å¤‡æä¾›è£…æœºç¯å¢ƒ,èˆªç”µåŠŸèƒ½å¿…é¡»åœ¨æœºä¸Šè¿è¡Œæ€§èƒ½å¿…éœ€çš„ç­‰çº§ã€‚ç¯å¢ƒç‰¹æ€§åŒ…æ‹¬:æ¸©åº¦ã€é«˜åº¦(æ°”å‹)ã€ç©ºæ°”è´¨é‡å’Œæ¹¿åº¦ã€æŒ¯åŠ¨å’Œå†²å‡»ã€æ°”å‹æ¢¯åº¦(çˆ†ç‚¸)ã€ç”µç£ç‰¹æ€§å’Œå¯¹å°„é¢‘ä¿¡å·çš„æ•æ„Ÿæ€§ã€é—ªç”µæ•ˆåº”çš„æ•æ„Ÿæ€§ç­‰ã€‚å®é™…çš„é£æœºç¯å¢ƒä¸ºæ¯ç§è¯•éªŒâ€ç±»å‹â€ç»™å‡ºä¸€ç»„ç‰¹å®šçš„å€¼å’Œå‚æ•°,å› æ­¤å¿…é¡»ä»æ ‡å‡† RTCA DO 160 ä¸­é€‰å‡ºé€‚ç”¨ç¯å¢ƒç‰¹æ€§çš„ç›¸å…³ç« èŠ‚ã€‚ ç¯å¢ƒé€‚åº”æ€§è®¾è®¡æ˜¯èˆªç”µè®¾å¤‡ç ”å‘å·¥ä½œä¸­éå¸¸é‡è¦å’Œç›¸å½“ä¸¥è‹›çš„ä¸€ä¸ªæ–¹é¢,å› ä¸ºè®¾å¤‡è£…æœºç¯å¢ƒéœ€æ±‚æ–¹é¢ å‡ºç°é”™è¯¯å°†ä¼šå¯¼è‡´å·²å®Œæˆç ”å‘çš„è®¾å¤‡æ— æ³•åº”ç”¨åˆ°é¢„æœŸçš„è£…æœºç¯å¢ƒä¸­,è€Œè®¾è®¡æ›´æ”¹åˆ°ä½å,ä»£ä»·é«˜æ˜‚çš„è¯•éªŒå’Œè¯„ä¼°åŠŸèƒ½çš„å·¥ä½œå¯èƒ½å¿…é¡»é‡æ–°å¼€å±•ã€‚ ä¾‹å¦‚,IMA ç³»ç»Ÿå¼€å‘è€…å¯¹è£…æœºç¯å¢ƒè¦æ±‚çš„ç†è§£å‡ºé”™,æ¸©åº¦èŒƒå›´æœªå®Œå…¨è¦†ç›–,é‚£ä¹ˆå…ƒå™¨ä»¶çš„é€‰å‹å°±ä¼šå‡ºé”™,è®¾å¤‡çš„æ•£çƒ­åŠ çƒ­è®¾è®¡ã€ç»“æ„è®¾è®¡å¯èƒ½ä¸æ»¡è¶³æ•£çƒ­è¦æ±‚ã€‚ 9ã€é‡é‡ é£æœºåˆ¶é€ å•†åœ¨é£æœºåˆæ­¥è®¾è®¡ä¸­ç¡®å®šäº†é£æœºçš„æ€»ä½“é‡é‡,ä»¥åŠåˆ†é…ç»™å„ç³»ç»Ÿå’Œèˆªç”µè®¾å¤‡åŒ…çš„é‡é‡â€é¢„ç®—â€,å¹¶å‘ä¸‹åˆ†è§£åˆ°å„å­åŠŸèƒ½ã€‚IMA æ¶æ„ä¸‹,å› ä¸º IMA ç¡¬ä»¶å¯èƒ½æ˜¯æ•´ä¸ªç³»ç»Ÿæ¶æ„ä¸­çš„é€šç”¨å…¬å…±è®¡ç®—èµ„æº,è€Œ IMA å¹³å°çš„é‡é‡å¯èƒ½ä¸é©»ç•™åº”ç”¨çš„æ•°é‡ä¸å­˜åœ¨çº¿æ€§å…³ç³», å› æ­¤é‡é‡è®¾è®¡å…·æœ‰ä¸€å®šçš„ä¼˜åŠ¿,è€Œâ€æ­£ç¡®çš„â€åˆæ­¥ç³»ç»Ÿæ¶æ„å®šä¹‰åˆ™å˜å¾—éå¸¸é‡è¦ã€‚ ä»é£æœºè®¾è®¡çš„è§†è§’æ¥çœ‹,è¶…è¿‡æˆ–ä½äºé‡é‡é¢„ç®—éƒ½å¯èƒ½æ˜¯ä¸åˆ©äºé£æœºè®¾è®¡çš„,å› æ­¤è®¾å¤‡é‡é‡è®¾è®¡å‡ºç°å å·®åº”è¯¥åŠæ—¶ä¸é£æœºåˆ¶é€ å•†è¿›è¡Œåå•†ã€‚ 10ã€åŠŸè€— ä¸é‡é‡é¢„ç®—ç±»ä¼¼,é£æœºåˆ¶é€ å•†åœ¨é£æœºåˆæ­¥è®¾è®¡ä¸­å°†åŠŸè€—é¢„ç®—åˆ†é…ç»™ç³»ç»Ÿå’Œèˆªç”µè®¾å¤‡åŒ…,è¿™äº›å°†ä½œä¸ºæ•´ä½“é£æœºåŠŸè€—ç»„æˆçš„ä¸€éƒ¨åˆ†ã€‚ åŠŸè€—ä¸è¶…å‡ºé¢„ç®—éå¸¸é‡è¦,å› æ­¤åœ¨èˆªç”µç³»ç»Ÿè®¾è®¡é˜¶æ®µåˆæœŸ,åˆ†é…ç»™å„ç³»ç»Ÿçš„åŠŸè€—é¢„ç®—å¿…é¡»è¢«å°½å¯èƒ½ç²¾ç¡®åœ°åˆ†é…,ä»¥ä¾¿é£æœºåŠŸèƒ½åˆæ­¥éªŒè¯æ¶æ„è®¾è®¡çš„å¯è¡Œæ€§ã€‚åœ¨ IMA æ¶æ„ä¸‹,é¢å‘è½¯ä»¶çš„é£æœºåº”ç”¨ä¸ç¡¬ä»¶éœ€æ±‚ä¸å­˜åœ¨çº¿æ€§å…³ç³»,è¿™æ˜¯ IMA æ¶æ„çš„ä¼˜ç‚¹,ä½†å®ƒä»¥æ›´å¤æ‚çš„è®¾è®¡è¿­ä»£å’Œç³»ç»Ÿå¤æ‚æ€§ä¸ºä»£ä»·ã€‚ 11ã€æ•£çƒ­ æ•£çƒ­é¢„ç®—ä¸åŠŸè€—é¢„ç®—ç›¸è¾…ç›¸æˆã€‚æ•£çƒ­éœ€è¦è®¾è®¡æœºæ¢°æ¥å£,æ ¹æ®è®¾å¤‡è£…æœºè¿è¡Œç¯å¢ƒçš„æ¸©åº¦å’Œæ¹¿åº¦,ä¸èˆªç”µç³»ç»Ÿè®¾è®¡å·¥ä½œè¿›è¡Œåè°ƒ,é€‰æ‹©æ­£ç¡®æ•£çƒ­æ–¹å¼(å¦‚è‡ªç„¶æ•£çƒ­ã€å¼ºè¿«é£å†·æ•£çƒ­ã€ä¼ å¯¼æ•£çƒ­ã€æ¶²ä½“å†·å´ç­‰)æ˜¯è‡³å…³é‡è¦çš„ã€‚ æ•£çƒ­åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå½±å“äº†èˆªç”µè®¾å¤‡çš„å¹³å‡æ•…éšœé—´éš”æ—¶é—´(MTBF),è€Œèˆªç”µè®¾å¤‡ç¡¬ä»¶çš„å†…éƒ¨çƒ­åˆ†å¸ƒéœ€è¦æ ¹æ®å®é™…ç¡¬ä»¶è®¾è®¡è¿›è¡Œä¸“ç”¨çš„ç‰¹æ®Šçš„çƒ­è®¾è®¡,é€šè¿‡åœ¨è®¾å¤‡å†…éƒ¨è®¾è®¡ä¸“ç”¨çš„çƒ­ä¼ é€’è·¯å¾„,åŒ…æ‹¬çƒ­å¸ƒå±€ã€æ•£çƒ­æ–¹å¼ã€æ•£çƒ­ä»‹è´¨ã€çƒ­ä¼ è¾“è·¯å¾„ã€é£é“ã€æ¶²å†·é€šé“ç­‰,ä»¥ä¾¿å°†è®¾å¤‡å†…éƒ¨çš„çƒ­é‡ä¼ å¯¼åˆ°æ•£çƒ­åŒºã€‚ ä»»ä½•æ•£çƒ­éœ€æ±‚éƒ½å¯èƒ½è§„å®šåç»­å…·ä½“çš„è¦æ±‚,ä¾‹å¦‚å¤§æ°”æ´å‡€åº¦ã€å¤§æ°”æ¸©åº¦ã€å‹åŠ›å’Œæ¹¿åº¦;è€Œä¸”è€ƒè™‘åˆ°é£æœº æœå½¹å¯¿å‘½å’Œè®¾å¤‡å°†æ¥æ½œåœ¨çš„åŠŸèƒ½å‡çº§æˆ–è®¾è®¡æ›´æ”¹,å¯èƒ½ä¼šæå‡ºæ›´é«˜çš„æ•£çƒ­éœ€æ±‚ã€‚ 12ã€ç»´æŠ¤å’Œä¿®ç†éœ€æ±‚ ç»´æŠ¤å’Œä¿®ç†éœ€æ±‚æ˜¯è€ƒè™‘ä»æœºåœºå¤–åœºç»´æŠ¤åˆ°è½¦é—´ç»´ä¿®ç­‰å„ç§ç»´ä¿®åœºæ™¯ã€ä¸åŒç»´æŠ¤çº§åˆ«çš„ç»´æŠ¤ã€ä¿®ç†éœ€æ±‚ã€‚ IMAÂ ç³»ç»Ÿå¼€å‘ç¤ºä¾‹ ç”±äº IMA ç³»ç»Ÿé©»ç•™å¤šä¸ªé£æœºåŠŸèƒ½,å› æ­¤ IMA ç³»ç»Ÿçš„ç»¼åˆåŒ–ç¨‹åº¦ã€ç³»ç»Ÿå†…å’Œç³»ç»Ÿé—´çš„ç›¸äº’å…³ç³»çš„å¤æ‚åº¦ç›¸å¯¹äºå•ä¸€åŠŸèƒ½å®ç°æ–¹å¼çš„è”åˆå¼æ¶æ„å‡æœ‰äº†å¾ˆå¤§çš„æå‡,IMA ç³»ç»Ÿå¼€å‘é™¤äº†å®Œæˆä¼ ç»Ÿçš„é£æœºçº§åŠŸèƒ½åˆ†é…å¤–,è¿˜éœ€è¦é€šè¿‡å®‰å…¨æ€§ã€å¹³å°èµ„æºã€è¿è¡Œæ•ˆç‡ç­‰å¤šç§å› ç´ æƒè¡¡ç¡®å®šå“ªäº›ç³»ç»Ÿé©»ç•™åœ¨ IMA å¹³å°ä¸­ä»¥åŠ IMA ç³»ç»Ÿä¸é©»ç•™ ATA ç³»ç»Ÿçš„å…³ç³»ç­‰ã€‚ ä¸ºäº†ä¾¿äºç†è§£æœ¬æ–‡ä»‹ç»çš„ IMA ç³»ç»Ÿå¼€å‘æ–¹æ³•,æœ¬å¤–åœºç»´æŠ¤éœ€è¦è®¾å¤‡å…·æœ‰ä¸€å®šçš„æ•…éšœæŠ¥å‘Šå’Œè¯Šæ–­çš„èƒ½åŠ›,æ—¢æœ‰ä¸é£æœºæ“ä½œäººå‘˜çš„æ•°æ®é“¾è·¯,ä¹Ÿæœ‰ä¸é£è¡Œæœºç»„äººå‘˜åˆ°è¾¾åçš„æ²Ÿé€šäº¤æµ,ä»¥ä¾¿èˆªçº¿ç»´æŠ¤äººå‘˜åœ¨è§„å®šçš„æ—¶é—´å†…åšå‡ºå“åº”ã€‚ å› æ­¤,é£æœºèˆªçº¿ç»´æŠ¤è§„å®šå†…éƒ¨èˆªç”µè®¾å¤‡å¤±æ•ˆçŠ¶æ€å’Œé£æœºçº§å®‰è£…é—®é¢˜(å¦‚çº¿ç¼†ã€è¿æ¥å™¨ã€ç³»ç»Ÿå†…éƒ¨é€šä¿¡æ•… éšœ)å¹¶æ±‡æ€»å½¢æˆé€šç”¨è¯­è¨€çš„æ•…éšœæŠ¥å‘Š,æ—¢å¯ä»¥é€šè¿‡ç»´æŠ¤ç”µè„‘çš„è¯Šæ–­åŠŸèƒ½è¾“å‡º,ä¹Ÿå¯ä»¥é€šè¿‡ä¸é£è¡Œæœºç»„äººæœº æ¥å£è¾“å‡º,ç”¨äºèˆªçº¿ç»´æŠ¤äººå‘˜æˆåŠŸå“åº”æ•…éšœå¹¶ä¿æŒä½æ¦‚ç‡æ— æ•…éšœå‘ç° (NFF)çŠ¶å†µã€‚ ä¸€æ—¦è®¾å¤‡ä»é£æœºä¸Šæ‹†é™¤,å‡å®šè®¾å¤‡å…·å¤‡è‰¯å¥½çš„æ•…èŠ‚ä»¥èµ·è½æ¶ç³»ç»Ÿã€åº§èˆ±æ˜¾ç¤ºç³»ç»Ÿã€é£è¡Œç®¡ç†ç³»ç»Ÿå’Œæœºä¸Šç»´æŠ¤ç³»ç»Ÿåˆ° IMA ç³»ç»Ÿçš„é©»ç•™ä¸ºä¾‹,é€šè¿‡é£æœºç³»ç»ŸåŠŸèƒ½ IMA å¹³å°é€šç”¨èµ„æºçš„åˆ†é…ä»¥åŠå¯¹çº¦æŸçš„æƒè¡¡æ¥è¿›ä¸€æ­¥è¯´æ˜ IMA ç³»ç»Ÿå¼€å‘æ–¹æ³•ã€‚LGS ç”±èµ·è½æ¶æ”¶æ”¾ç³»ç»Ÿã€åˆ¹è½¦æ§åˆ¶ç³»ç»Ÿã€è½¦è½®è½¬å‘æ§åˆ¶ç³»ç»Ÿã€èµ·Â è½Â æ¶Â ç›‘Â æ§Â ç³»Â ç»Ÿå››ä¸ªåŠŸèƒ½å­ç³»ç»Ÿä»¥åŠä¸‰ä¸ªç‹¬ç«‹çš„èµ·è½æ¶ç»„æˆã€‚ LGERS è´Ÿè´£èµ·è½æ¶çš„æ§åˆ¶ä»¥åŠç›‘æ§åŠŸèƒ½,ç”± LG-ERS å‘½ä»¤é€šé“å’Œè‡ªæ£€æµ‹é€šé“ç»„æˆ;BCS è´Ÿè´£é£æœºåˆ¹è½¦æ§åˆ¶ä»¥åŠç›‘æ§åŠŸèƒ½,ç”± BCS å‘½ä»¤é€šé“ã€ç›‘æ§é€šé“å’Œè‡ªæ£€æµ‹é€šé“ç»„æˆ;WSCS è´Ÿè´£èµ·è½æ¶å‰è½®è½¬å‘æ§åˆ¶æ¶²å‹ä¼ºæœé˜€çš„æ§åˆ¶å’Œç›‘æ§åŠŸèƒ½,ç”± WSCS å‘½ä»¤é€šé“å’Œç›‘æ§é€šé“ç»„æˆ;LGMS è´Ÿè´£åˆ¹è½¦æ¸©åº¦ç›‘æ§ä¸æŒ‡ç¤ºã€èƒå‹æ£€æµ‹ä¸æŒ‡ç¤ºã€åˆ¹è½¦æ•£çƒ­é£æ‰‡çš„æ§åˆ¶åŠŸèƒ½,ç”± LGMS æ§åˆ¶åŠŸèƒ½å’Œè‡ªæ£€æµ‹åŠŸèƒ½ç»„æˆ;ä»¥ä¸Šå„å­ç³»ç»Ÿå‘½ä»¤é€šé“çš„å¼€å‘ä¿è¯ç­‰çº§(DAL)å‡ä¸º A çº§,ç›‘æ§é€šé“çš„å¼€å‘ä¿è¯ç­‰çº§å‡ä¸º B çº§,ä¸”å¿…é¡»è€ƒè™‘å‘½ä»¤é€šé“ä¸ç›‘æ§é€šé“çš„éš”ç¦»æ€§ã€‚å…¶ä¸­ IMA å¹³å°é€šç”¨å¤„ç†èµ„æºå¯ä»¥æ»¡è¶³ LGS å„åº”ç”¨è½¯ä»¶çš„å¤„ç†éœ€æ±‚,å››ä¸ªåŠŸèƒ½å­ç³»ç»Ÿå¯ä»¥é©»ç•™åœ¨ IMA å¹³å°ä¸Š;ä½†æ˜¯èµ·è½æ¶éœ€è¦ç‰¹æ®Šçš„é£æœºæ¥å£æ¥å®ç°,å› æ­¤ä¸èƒ½é©»ç•™åœ¨ IMA å¹³å°ä¸Šã€‚ CDS ç”± 6 ä¸ªæ˜¾ç¤ºå•å…ƒå’Œ 2 ä¸ªé”®ç›˜æ§åˆ¶å•å…ƒç»„æˆ CDS è½¯ä»¶é©»ç•™åœ¨æ¯ä¸ªæ˜¾ç¤ºå•å…ƒä¸Š,IMA å¹³å°ä»…æä¾›é€šç”¨æ•°æ®ä¼ è¾“å’Œæ¥å£çš„é©»ç•™ã€‚ FMS åŒ…æ‹¬é£è¡Œè®¡åˆ’ã€é£è¡Œä¼˜åŒ–ä¸é¢„æµ‹ã€å¯¼èˆªå’Œé£è¡ŒæŒ‡å¼•å››éƒ¨åˆ†åŠŸèƒ½,å‡ç”±åº”ç”¨è½¯ä»¶å®ç°ã€‚å› æ­¤,FMS çš„åº”ç”¨è½¯ä»¶å‡é©»ç•™åœ¨ IMA ç³»ç»Ÿä¸­,é£è¡Œç®¡ç†åŠŸèƒ½ç”± IMA ç³»ç»Ÿå®ç°ã€‚ OMS åŒ…æ‹¬æ•°æ®åŠ è½½ä¸é…ç½®ç®¡ç†ã€ä¸­å¤®ç»´æŠ¤ç³»ç»Ÿã€é£æœºçŠ¶å†µç›‘æ§ç³»ç»Ÿä¸‰éƒ¨åˆ†åŠŸèƒ½ã€‚IMA å¹³å°çš„ç¡¬ä»¶èµ„æºå¯ä»¥æ»¡è¶³è¿™ä¸‰éƒ¨åˆ†çš„åŠŸèƒ½éœ€æ±‚,å› æ­¤ OMS æ‰€æœ‰åŠŸèƒ½éƒ½é©»ç•™åœ¨ IMA å¹³å°ä¸Šã€‚ åˆæ­¥é£æœºçº§åŠŸèƒ½åˆ° IMA çš„åˆ†é…ç¤ºæ„å¦‚å›¾ 2 æ‰€ç¤ºã€‚ å›¾ 2 IMA ç³»ç»Ÿä¸­é£æœºçº§åŠŸèƒ½åˆ†é…ç¤ºæ„å›¾ ä»å›¾ 2 å¯ä»¥çœ‹å‡º,FMSã€OMS è¿™ä¸¤ä¸ªç³»ç»Ÿå‡ç”±è½¯ä»¶å®ç°,å› æ­¤å‡é©»ç•™åœ¨ IMA ç³»ç»Ÿä¸Š,ä¸ IMA ç³»ç»Ÿä¸€èµ·å®ç°ç³»ç»ŸåŠŸèƒ½;LGS çš„åº”ç”¨è½¯ä»¶éƒ¨åˆ†å‡é©»ç•™åœ¨ IMA ç³»ç»Ÿä¸Š,ä¸å„è‡ªç³»ç»Ÿçš„ä¸“ç”¨è®¾å¤‡ä¸€èµ·å®ç°ç³»ç»ŸåŠŸèƒ½;CDS çš„é€šä¿¡åŠŸèƒ½å’Œæ¥å£æ•°æ®è½¬æ¢åŠŸèƒ½é©»ç•™åœ¨ IMA ç³»ç»Ÿä¸Š, ä¸ CDS ç³»ç»Ÿçš„ä¸“ç”¨è®¾å¤‡ã€æ˜¾ç¤ºå™¨ä¸é”®ç›˜æ§åˆ¶å•å…ƒ,ä¸€èµ·å®ç°æ˜¾ç¤ºç³»ç»Ÿçš„åŠŸèƒ½ã€‚ é£æœºçº§åŠŸèƒ½åˆ†é…é˜¶æ®µ,IMA å¹³å°ä¾›åº”å•†é¦–å…ˆéœ€è¦è€ƒè™‘ä½¿ç”¨èƒ½å¤Ÿæ»¡è¶³å„ç³»ç»Ÿåº”ç”¨è½¯ä»¶é©»ç•™çš„è¦æ±‚,å…¶æ¬¡ è¦åˆæ­¥è¯„ä¼°å¹³å°æ€§èƒ½ä»¥ç¡®ä¿æ»¡è¶³å„ç³»ç»Ÿé©»ç•™åº”ç”¨çš„è¿è¡Œéœ€æ±‚,è¿˜éœ€è¦è¯¦ç»†è€ƒè™‘ 2.2 èŠ‚æè¿°çš„å„é¡¹çº¦æŸ,é€æ­¥å®ç° IMAÂ ç³»ç»Ÿçš„å¼€å‘,ä¾‹å¦‚: **(1)é€‚èˆªè®¤è¯çº¦æŸ:**è¯†åˆ«é€‚èˆªè®¤è¯éœ€æ±‚,å³å¿…é¡»æ»¡è¶³çš„é€‚èˆªè§„ç« ,å¦‚å¤§å‹è¿è¾“ç±»é£æœºä»¥ CCAR 25 éƒ¨ä¸ºå®¡å®šåŸºç¡€ã€‚ **(2)é€‚èˆªç¬¦åˆæ€§çº¦æŸ:**ç¡®å®š IMA ç³»ç»Ÿé€‚èˆªæ–¹æ³•,å¦‚é‡‡ç”¨ DO 297 ä½œä¸º IMA ç³»ç»Ÿå¼€å‘å’Œè®¤è¯çš„å¯æ¥å—çš„ç¬¦åˆæ€§æ–¹æ³•,IMA ç³»ç»Ÿé€šè¿‡å¢é‡å¼è®¤å¯æ–¹æ³•è·å¾—å®‰è£…æ‰¹å‡†ã€‚ **(3)å®‰å…¨æ€§çº¦æŸ:**å¦‚é©»ç•™åº”ç”¨ DAL A çº§çš„å®‰å…¨æ€§è¦æ±‚ã€å‘½ä»¤é€šé“ä¸ç›‘æ§é€šé“çš„éš”ç¦»æ€§è¦æ±‚ç­‰ã€‚ **(4)ä¾›ç”µçº¦æŸ:**ä½™åº¦ä¾›ç”µçš„éš”ç¦»æ€§è¦æ±‚ä»¥åŠåº”æ€¥ä¾›ç”µçš„è¦æ±‚ç­‰ã€‚ **(5)ç¯å¢ƒçº¦æŸ:**æ ¹æ® LGS çš„éœ€æ±‚,ç¡®å®š IMA å¹³å°,å°¤å…¶å…³æ³¨æ‰§è¡Œ LGS æ¥å£æ•°æ®è½¬æ¢åŠŸèƒ½çš„è¿œç¨‹æ¥å£å•å…ƒçš„å®‰è£…ç¯å¢ƒã€å®‰è£…æ–¹å¼ã€åŠŸè€—åŠæ•£çƒ­æ¡ä»¶ç­‰ã€‚ **(6)MPS:**TSO æ˜¯å±€æ–¹é¢å¸ƒçš„æ°‘ç”¨èˆªç©ºå™¨ä¸Šæ‰€ç”¨çš„ç‰¹å®šé›¶éƒ¨ä»¶çš„æœ€ä½æ€§èƒ½æ ‡å‡†ã€‚IMA ç³»ç»Ÿç›¸å…³çš„ TSO åˆ†ä¸ºä¸¤å¤§ç±»: â‘  TSO-153,é€‚ç”¨äº IMA(ç¡¬ä»¶)æ¨¡å—å•å…ƒã€‚è¦†ç›–åˆ° IMA ç³»ç»Ÿç”¨åˆ°çš„ä¸¤ç±»ç¡¬ä»¶ç»„ä»¶â€”â€”é€šç”¨ç¡¬ä»¶æ¨¡å—å’Œé©»ç•™è¿™äº›ç¡¬ä»¶æ¨¡å—çš„æœºæŸœã€‚ â‘¡ åŠŸèƒ½ TSOs,é€‚ç”¨äºé£æœºåŠŸèƒ½å•å…ƒã€‚ (7) å¤ç”¨:Â è€ƒè™‘åˆ°å¼€å‘å‘¨æœŸã€è®¤è¯æˆæœ¬ã€ç ”åˆ¶é£é™©ç­‰å› ç´ ,IMA ç³»ç»Ÿå¼€å‘é¦–é€‰é‡‡çº³æˆç†ŸæŠ€æœ¯çš„å¤ç”¨,åŒ…æ‹¬é©»ç•™ç³»ç»Ÿä»¥åŠ IMA å¹³å°æŠ€æœ¯çš„å¤ç”¨ã€‚ (8) ç»´ä¿®ä¿éšœæ€§çº¦æŸ:Â ç¡®å®šå¹³å‡ä¿®å¤æ€§æ—¶é—´ã€ç»´ä¿®é—´éš”ç­‰ã€‚ é€šè¿‡è€ƒè™‘è¿™äº›çº¦æŸé›†å¯¹ IMA ç³»ç»Ÿæ–¹æ¡ˆè®¾è®¡çš„â€é™åˆ¶â€,ç³»ç»Ÿè®¾è®¡äººå‘˜å°†æ¥è‡ªäºé¡¶å±‚é£æœºçº§ä»»åŠ¡çš„åŠŸèƒ½æ€§èƒ½éœ€æ±‚é€çº§åˆ†è§£åˆ°åº•å±‚å®ç°å±‚,æœ€ç»ˆä»¥é©±åŠ¨åº•å±‚éœ€æ±‚ç”Ÿæˆå…·ä½“çš„è§£å†³æ–¹æ¡ˆã€‚ ä»¥é©»ç•™åœ¨ IMA ç³»ç»Ÿçš„é£è¡Œç®¡ç†ç³»ç»Ÿä¸ºä¾‹,å…¶é£æœºåŠŸèƒ½åˆ†é…åˆ° IMA ç³»ç»Ÿçš„åŠŸèƒ½æ€§èƒ½éœ€æ±‚å±‚æ¬¡ç»“æ„å¦‚å›¾ 3 æ·±è‰²å›¾æ¡†æ‰€ç¤ºã€‚æœ€é¡¶å±‚çš„ä»»åŠ¡æè¿°ä¸æœ€åº•å±‚çš„è®¾è®¡å®ç°ä»ä¸åŒçš„è§’åº¦æè¿°äº†åŒä¸€ä¸ªé£æœºåŠŸèƒ½,â€æœ€é¡¶å±‚â€æ˜¯ä»é£æœºçº§ä»»åŠ¡çš„è§’åº¦æŠ½è±¡åœ°æè¿°æ•´ä¸ªé£æœºçš„é¢„æœŸæ“ä½œ;â€æœ€åº•å±‚â€çš„è®¾è®¡å®ç°å±‚åˆ™æ˜¯ä»è½¯ç¡¬ä»¶è®¾è®¡å®ç°çš„è§’åº¦,æè¿°é£æœºçº§ä»»åŠ¡çš„æœ€ç»ˆå®ç°ã€‚â€è®¾è®¡å®ç°å±‚â€æè¿°çš„æ˜¯å…·ä½“çš„è®¾è®¡â€éœ€æ±‚â€,å¯ä»¥é€çº§å‘ä¸Šè¿½æº¯åˆ°æœ€é¡¶å±‚çš„â€ä»»åŠ¡â€æè¿°,å³æœ€åº•å±‚çš„éœ€æ±‚æ˜¯ä»æœ€é¡¶å±‚çš„ä»»åŠ¡åˆ†è§£è€Œæ•è·åˆ°çš„ã€‚ å›¾ 3 åŠŸèƒ½æ€§èƒ½éœ€æ±‚å±‚æ¬¡ç»“æ„ç¤ºæ„å›¾ ç”±å›¾ 3 å¯ä»¥çœ‹å‡º,è®¾è®¡å®ç°å±‚çš„è½¯ä»¶å’Œç¡¬ä»¶æ¨¡å—ç»„æˆäº†é£è¡ŒæŒ‡å¼•åŠŸèƒ½,é€çº§å‘ä¸Šçœ‹,é£è¡ŒæŒ‡å¼•åŠŸèƒ½æ˜¯é£è¡Œç®¡ç†åŠŸèƒ½çš„ç»„æˆéƒ¨åˆ†,é£è¡Œç®¡ç†åŠŸèƒ½æ˜¯èˆªç”µç³»ç»Ÿçš„ç»„æˆéƒ¨åˆ†,èˆªç”µç³»ç»Ÿæ˜¯é£æœºç³»ç»Ÿçš„ç»„æˆéƒ¨åˆ†ã€‚ä¸€èˆ¬æƒ…å†µä¸‹,ä»é£æœºå±‚åˆ°æœ€ç»ˆçš„è®¾è®¡å®ç°å±‚ä¹‹é—´ä¼šåŒ…æ‹¬ 7~10 å±‚çº§(æŸäº›å¤æ‚ç³»ç»Ÿå¯èƒ½ä¼šè¶…è¿‡ 10 å±‚),ç›¸é‚»å±‚ä¸å±‚ä¹‹é—´çš„åŠŸèƒ½æ€§èƒ½éœ€æ±‚å­˜åœ¨ä¸€ä¸€å¯¹åº”çš„å…³ç³»,éœ€æ±‚è‡ªé¡¶å‘ä¸‹é€å±‚åˆ†è§£,è€Œåº•å±‚è®¾è®¡å®ç°é€å±‚å‘ä¸Šé›†æˆ,æœ€ç»ˆæ”¯æŒé¡¶å±‚é£æœºçº§ä»»åŠ¡åŠŸèƒ½çš„å®ç°ã€‚ ç»“ è®º æ— è®ºæ˜¯åŸºäºä¼ ç»Ÿçš„è”åˆå¼æ¶æ„è¿˜æ˜¯å¤æ‚å¯å¤ç”¨çš„ IMA æ¶æ„çš„èˆªç”µè®¾å¤‡ç ”å‘,éƒ½ä¸é£æœºæ•´ä½“å®šä¹‰å¯†åˆ‡ç›¸å…³,éƒ½éœ€è¦æ»¡è¶³é£æœºçš„åŠŸèƒ½æ€§èƒ½è¦æ±‚ä»¥åŠå„ç§â€é™åˆ¶å› ç´ â€ã€‚æœ¬æ–‡é€šè¿‡ç ”ç©¶ IMA ç³»ç»Ÿå¼€å‘ä¸­ä¸é£æœºåˆ¶é€ å•†çš„äº¤äº’ã€ç°æœ‰æŠ€æœ¯çš„åº”ç”¨ã€å®‰è£…ä½ç½®çš„ç¯å¢ƒã€ç»´æŠ¤äººå‘˜çš„æ“ä½œç­‰å¤šæ–¹åˆ©ç›Šç›¸å…³è€…æå‡ºçš„çº¦æŸ,å¸®åŠ©å¼€å‘äººå‘˜æ·±å…¥äº†è§£è¿™äº›åˆ©ç›Šç›¸å…³è€…å¯¹ IMA çš„å½±å“,ä¸º IMA ç³»ç»Ÿå¼€å‘æä¾›å‚è€ƒã€‚ ï¼ˆä»¥ä¸Šæ–‡ç« æ¥æºäºä½œè€…ï¼šéŸ©å«šè‰ï¼Œé«˜æ¨ï¼Œé«˜ç‘å¤ï¼Œä½œè€…å•ä½ï¼šä¸­å›½èˆªç©ºå·¥ä¸šé›†å›¢ è¥¿å®‰èˆªç©ºè®¡ç®—æŠ€æœ¯ç ”ç©¶æ‰€ï¼‰","tags":["clippings"],"categories":["5.åµŒå…¥å¼å¼€å‘","èˆªç”µç³»ç»Ÿ"]},{"title":"æœ¯è¯­ç¼©å†™ABBR","path":"/2023/09/05/5-åµŒå…¥å¼å¼€å‘-èˆªç”µç³»ç»Ÿ-æœ¯è¯­ç¼©å†™ABBR/","content":"ç±»åˆ« æœ¯è¯­ å…¨ç§° å…³é”®åŠŸèƒ½ å¯¼èˆªç³»ç»Ÿ VOR VHF Omnidirectional Range æä¾›ç£æ–¹ä½å¼•å¯¼ DME Distance Measuring Equipment æµ‹é‡é£æœºåˆ°åœ°é¢å°çš„æ–œè· ç€é™†ç³»ç»Ÿ LOC Localizer æ°´å¹³æ ¡å‡†è·‘é“ä¸­å¿ƒçº¿ï¼ŒILS ç»„æˆéƒ¨åˆ† GS Glide Slope å‚ç›´æ ¡å‡†ä¸‹æ»‘è§’åº¦ï¼ŒILS ç»„æˆéƒ¨åˆ† é€šä¿¡ç³»ç»Ÿ HF High Frequency è¿œè·ç¦»è¯­éŸ³æ•°æ®é€šä¿¡ï¼ˆ3-30 MHzï¼‰ VHF Very High Frequency è§†è·å†…ç©ºä¸­äº¤é€šç®¡åˆ¶é€šä¿¡ï¼ˆ118-136 MHzï¼‰ æƒ¯æ€§å¯¼èˆª AHRS Attitude and Heading Reference System æä¾›é£æœºçš„å§¿æ€ï¼ˆä¿¯ä»°ã€æ»šè½¬ã€èˆªå‘ï¼‰ä¿¡æ¯ ADAHRS Air Data and Attitude Heading Reference System AHRS + ç©ºé€Ÿæ•°æ®ï¼Œå¢å¼ºå¯¼èˆªèƒ½åŠ› AHRRATE Attitude and Heading Reference System Rate AHRS æµ‹é‡çš„è§’é€Ÿç‡æ•°æ® ADCRATE Air Data Computer Rate ç©ºé€Ÿæ•°æ®è®¡ç®—æœºæ›´æ–°é¢‘ç‡ ç©ºé€Ÿæµ‹é‡ IAS Indicated Airspeed ç›´æ¥è¯»å–çš„æŒ‡ç¤ºç©ºé€Ÿï¼Œå—ä»ªè¡¨è¯¯å·®å½±å“ CAS Calibrated Airspeed æ ¡æ­£ä»ªè¡¨è¯¯å·®åçš„çœŸå®ç©ºé€Ÿ EAS Equivalent Airspeed è€ƒè™‘ç©ºæ°”å¯†åº¦å½±å“çš„å½“é‡ç©ºé€Ÿ TAS True Airspeed é£æœºç›¸å¯¹äºç©ºæ°”çš„çœŸå®é€Ÿåº¦ GS Ground Speed é£æœºç›¸å¯¹äºåœ°é¢çš„é€Ÿåº¦ 1. å¯¼èˆªç³»ç»Ÿï¼ˆNavigation Systemsï¼‰VORï¼ˆVHF Omnidirectional Rangeï¼Œç”šé«˜é¢‘å…¨å‘ä¿¡æ ‡ï¼‰ å«ä¹‰ï¼šä¸€ç§çŸ­ç¨‹æ— çº¿ç”µå¯¼èˆªç³»ç»Ÿï¼Œé€šè¿‡åœ°é¢å°å‘å°„å…¨å‘ä¿¡å·ï¼Œå¸®åŠ©é£æœºç¡®å®šç›¸å¯¹äºåœ°é¢å°çš„ç£æ–¹ä½è§’ã€‚ åŠŸèƒ½ï¼šæä¾›æ–¹ä½å¼•å¯¼ï¼Œç”¨äºèˆªè·¯å¯¼èˆªå’Œè¿›è¿‘ç¨‹åºï¼Œè¦†ç›–èŒƒå›´çº¦ 200 æµ·é‡Œã€‚ é¢‘æ®µï¼šVHF é¢‘æ®µï¼ˆ108.00â€“117.95 MHzï¼‰ã€‚ DMEï¼ˆDistance Measuring Equipmentï¼Œæµ‹è·ä»ªï¼‰ å«ä¹‰ï¼šé€šè¿‡è¯¢é—®-åº”ç­”æœºåˆ¶æµ‹é‡é£æœºä¸åœ°é¢å°ä¹‹é—´çš„æ–œè·ã€‚ åŠŸèƒ½ï¼šæä¾›ç²¾ç¡®çš„è·ç¦»ä¿¡æ¯ï¼ˆå•ä½ï¼šæµ·é‡Œï¼‰ï¼Œå¸¸ä¸ VOR æˆ– ILS å…±å€ï¼Œç”¨äºèˆªè·¯å¯¼èˆªå’Œè¿›è¿‘é˜¶æ®µã€‚ é¢‘æ®µï¼šUHF é¢‘æ®µï¼ˆ962â€“1213 MHzï¼‰ã€‚ 2. ç€é™†ç³»ç»Ÿï¼ˆLanding Systemsï¼‰LOCï¼ˆLocalizerï¼Œèˆªå‘ä¿¡æ ‡ï¼‰ å«ä¹‰ï¼šä»ªè¡¨ç€é™†ç³»ç»Ÿï¼ˆILSï¼‰çš„æ°´å¹³å¼•å¯¼ç»„ä»¶ï¼ŒæŒ‡ç¤ºé£æœºä¸è·‘é“ä¸­å¿ƒçº¿çš„å·¦å³åå·®ã€‚ åŠŸèƒ½ï¼šåœ¨è¿›è¿‘é˜¶æ®µæä¾›æ¨ªå‘å¼•å¯¼ï¼Œç¡®ä¿é£æœºå¯¹å‡†è·‘é“ä¸­è½´çº¿ã€‚ é¢‘æ®µï¼šVHF é¢‘æ®µï¼ˆ108.10â€“111.95 MHzï¼‰ã€‚ GSï¼ˆGlide Slopeï¼Œä¸‹æ»‘ä¿¡æ ‡ï¼‰ å«ä¹‰ï¼šILS çš„å‚ç›´å¼•å¯¼ç»„ä»¶ï¼ŒæŒ‡ç¤ºé£æœºæ˜¯å¦åç¦»æ ‡å‡†ä¸‹æ»‘é“ï¼ˆé€šå¸¸ä¸º 3Â°ï¼‰ã€‚ åŠŸèƒ½ï¼šæä¾›å‚ç›´è§’åº¦æ ¡å‡†ï¼Œç¡®ä¿é£æœºä»¥å®‰å…¨é«˜åº¦é™è½ã€‚ é¢‘æ®µï¼šUHF é¢‘æ®µï¼ˆ329.15â€“335 MHzï¼‰ã€‚ 3. é€šä¿¡ç³»ç»Ÿï¼ˆCommunication Systemsï¼‰HFï¼ˆHigh Frequencyï¼Œé«˜é¢‘é€šä¿¡ï¼‰ å«ä¹‰ï¼šåˆ©ç”¨ç”µç¦»å±‚åå°„å®ç°è¿œè·ç¦»é€šä¿¡çš„æ— çº¿ç”µç³»ç»Ÿã€‚ åŠŸèƒ½ï¼šé€‚ç”¨äºè·¨æ´‹æˆ–æåœ°ç­‰è¶…è§†è·åœºæ™¯ï¼Œæ”¯æŒè¯­éŸ³å’Œæ•°æ®ä¼ è¾“ã€‚ é¢‘æ®µï¼šHF é¢‘æ®µï¼ˆ3â€“30 MHzï¼‰ã€‚ VHFï¼ˆVery High Frequencyï¼Œç”šé«˜é¢‘é€šä¿¡ï¼‰ å«ä¹‰ï¼šåŸºäºè§†è·ä¼ æ’­çš„çŸ­ç¨‹é€šä¿¡ç³»ç»Ÿã€‚ åŠŸèƒ½ï¼šç”¨äºæœºåœºå¡”å°ã€èˆªè·¯ç®¡åˆ¶åŠé£æœºé—´é€šä¿¡ï¼Œè¦†ç›–èŒƒå›´çº¦ 200 æµ·é‡Œã€‚ é¢‘æ®µï¼šVHF é¢‘æ®µï¼ˆ118â€“136 MHzï¼‰ã€‚ 4. æƒ¯æ€§å¯¼èˆªä¸å§¿æ€æµ‹é‡ç³»ç»Ÿï¼ˆInertial Navigation and Attitude Reference Systemsï¼‰AHRSï¼ˆAttitude and Heading Reference Systemï¼Œå§¿æ€å’Œèˆªå‘å‚è€ƒç³»ç»Ÿï¼‰ ä½œç”¨ï¼šAHRS é‡‡ç”¨é™€èºä»ªã€åŠ é€Ÿåº¦è®¡å’Œç£åŠ›è®¡æµ‹é‡é£æœºçš„å§¿æ€å’Œèˆªå‘ï¼Œæä¾›æ»šè½¬è§’ã€ä¿¯ä»°è§’å’Œèˆªå‘è§’ä¿¡æ¯ã€‚ åŠŸèƒ½ï¼šæ¯”ä¼ ç»Ÿæœºæ¢°å¼é™€èºä»ªæ›´ç²¾å‡†ï¼Œå¹¿æ³›ç”¨äºèˆªç©ºç”µå­ç³»ç»Ÿï¼Œä¸ºé£è¡Œæ§åˆ¶ã€è‡ªåŠ¨é©¾é©¶ä»ªå’Œå¯¼èˆªç³»ç»Ÿæä¾›å§¿æ€å‚è€ƒã€‚ ADAHRSï¼ˆAir Data and Attitude Heading Reference Systemï¼Œç©ºé€Ÿæ•°æ®å’Œå§¿æ€èˆªå‘å‚è€ƒç³»ç»Ÿï¼‰ ä½œç”¨ï¼šADAHRS æ˜¯ AHRS çš„å¢å¼ºç‰ˆï¼Œé›†æˆäº†ç©ºé€Ÿæ•°æ®æµ‹é‡åŠŸèƒ½ï¼ŒåŒ…æ‹¬é™å‹ã€åŠ¨å‹ã€æ¸©åº¦å’Œ GPS æ•°æ®ã€‚ åŠŸèƒ½ï¼šæä¾›å†—ä½™çš„å§¿æ€ä¿¡æ¯ï¼Œå¹¶ç»“åˆç©ºé€Ÿæ•°æ®ä¼˜åŒ–é£è¡Œæ§åˆ¶å’Œå¯¼èˆªç²¾åº¦ï¼Œå¹¿æ³›ç”¨äºå•†ç”¨èˆªç©ºã€å†›ç”¨èˆªç©ºå’Œæ— äººæœºã€‚ AHRRATEï¼ˆAttitude and Heading Reference System Rateï¼Œå§¿æ€å’Œèˆªå‘å‚è€ƒç³»ç»Ÿè§’é€Ÿç‡ï¼‰ ä½œç”¨ï¼šAHRRATE è¡¨ç¤º AHRS æµ‹é‡çš„è§’é€Ÿç‡ï¼ˆæ»šè½¬è§’é€Ÿç‡ã€ä¿¯ä»°è§’é€Ÿç‡ã€åèˆªè§’é€Ÿç‡ï¼‰ã€‚ åŠŸèƒ½ï¼šç”¨äºè®¡ç®—é£æœºçš„å§¿æ€è§’ï¼Œæä¾›ç»™é£è¡Œæ§åˆ¶ç³»ç»Ÿï¼Œå¸®åŠ©æ£€æµ‹é£æœºçš„æ—‹è½¬è¿åŠ¨ï¼Œé˜²æ­¢å¤±é€Ÿã€‚ ADCRATEï¼ˆAir Data Computer Rateï¼Œç©ºé€Ÿæ•°æ®è®¡ç®—æœºæ›´æ–°ç‡ï¼‰ ä½œç”¨ï¼šADCRATE æŒ‡ç©ºé€Ÿæ•°æ®è®¡ç®—æœºï¼ˆADCï¼‰æ›´æ–°é™å‹ã€åŠ¨å‹å’Œæ¸©åº¦æ•°æ®çš„é¢‘ç‡ï¼Œå•ä½ä¸º Hzï¼ˆèµ«å…¹ï¼‰ã€‚ åŠŸèƒ½ï¼šè¾ƒé«˜çš„ ADCRATE æä¾›æ›´å¹³æ»‘å’Œå®æ—¶çš„ç©ºé€Ÿæ•°æ®ï¼Œæé«˜é£è¡Œæ§åˆ¶ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ã€‚ 5. ç©ºé€Ÿæµ‹é‡ï¼ˆAirspeed Measurementï¼‰IASï¼ˆIndicated Airspeedï¼ŒæŒ‡ç¤ºç©ºé€Ÿï¼‰ ä½œç”¨ï¼šIAS æ˜¯é£æœºç©ºé€Ÿè¡¨ç›´æ¥è¯»å–çš„é€Ÿåº¦å€¼ï¼Œä¸è€ƒè™‘ä»»ä½•è¯¯å·®ä¿®æ­£ã€‚ åŠŸèƒ½ï¼šç”¨äºåŸºæœ¬é£è¡Œæ“æ§ï¼Œä½†ä¼šå—åˆ°å®‰è£…è¯¯å·®å’Œæ°”æµå½±å“ã€‚ CASï¼ˆCalibrated Airspeedï¼Œæ ¡æ­£ç©ºé€Ÿï¼‰ ä½œç”¨ï¼šCAS æ˜¯å¯¹ IAS è¿›è¡Œæ ¡æ­£åçš„ç©ºé€Ÿï¼Œä¿®æ­£äº†ä»ªè¡¨è¯¯å·®å’Œå®‰è£…è¯¯å·®ã€‚ åŠŸèƒ½ï¼šæä¾›æ¯” IAS æ›´å‡†ç¡®çš„ç©ºé€Ÿæ•°æ®ï¼Œé€‚ç”¨äºç©ºé€Ÿé™åˆ¶è®¡ç®—ã€‚ EASï¼ˆEquivalent Airspeedï¼Œå½“é‡ç©ºé€Ÿï¼‰ ä½œç”¨ï¼šEAS æ˜¯åœ¨æ ‡å‡†æµ·å¹³é¢æ¡ä»¶ä¸‹ï¼Œå…·æœ‰ä¸å½“å‰é«˜åº¦ç›¸åŒåŠ¨å‹çš„ç©ºé€Ÿã€‚ åŠŸèƒ½ï¼šè€ƒè™‘äº†ç©ºæ°”å¯†åº¦å½±å“ï¼Œç”¨äºé«˜é€Ÿã€é«˜ç©ºé£è¡Œçš„æ€§èƒ½è®¡ç®—ã€‚ TASï¼ˆTrue Airspeedï¼ŒçœŸç©ºé€Ÿï¼‰ ä½œç”¨ï¼šTAS æ˜¯é£æœºç›¸å¯¹äºå‘¨å›´ç©ºæ°”çš„çœŸå®é£è¡Œé€Ÿåº¦ï¼Œè€ƒè™‘äº†ç©ºæ°”å¯†åº¦å˜åŒ–ã€‚ åŠŸèƒ½ï¼šç”¨äºé£è¡Œè®¡åˆ’å’Œæ€§èƒ½è®¡ç®—ï¼Œé€šå¸¸åœ¨é£è¡Œè®¡ç®—å™¨æˆ– FMSï¼ˆé£è¡Œç®¡ç†ç³»ç»Ÿï¼‰ä¸­è·å–ã€‚ GSï¼ˆGround Speedï¼Œåœ°é€Ÿï¼‰ ä½œç”¨ï¼šGS æ˜¯é£æœºç›¸å¯¹äºåœ°é¢çš„é£è¡Œé€Ÿåº¦ï¼Œç”± TAS ç»“åˆé£é€Ÿè®¡ç®—å¾—å‡ºã€‚ åŠŸèƒ½ï¼šç”¨äºèˆªè¡Œå’Œèˆªè·¯è§„åˆ’ï¼Œåœ¨æ— é£æƒ…å†µä¸‹ GS ç­‰äº TASã€‚ VOR å’Œ ILS çš„æ•°æ®æ˜¯å¦ç”± NAV æ¥æ”¶ï¼Ÿæ˜¯çš„ï¼ŒVORï¼ˆç”šé«˜é¢‘å…¨å‘ä¿¡æ ‡ï¼‰ å’Œ ILSï¼ˆä»ªè¡¨ç€é™†ç³»ç»Ÿï¼‰ çš„ä¿¡å·é€šå¸¸éƒ½æ˜¯ç”± NAV æ¥æ”¶æœºï¼ˆVHF NAV Receiverï¼‰æ¥æ”¶çš„ã€‚ 1. NAV æ¥æ”¶æœºçš„ä½œç”¨NAVï¼ˆNavigationï¼‰æ¥æ”¶æœº è´Ÿè´£æ¥æ”¶å’Œè§£ç  VHF é¢‘æ®µï¼ˆ108.00 â€“ 117.95 MHzï¼‰ä¸­çš„å¯¼èˆªä¿¡å·ï¼Œå¹¶å°†ä¿¡æ¯ä¼ è¾“ç»™èˆªç”µç³»ç»Ÿï¼Œå¦‚ä¸»é£è¡Œæ˜¾ç¤ºå™¨ï¼ˆPFDï¼‰ æˆ– è‡ªåŠ¨é©¾é©¶ä»ªï¼ˆAPï¼‰ã€‚ NAV è®¾å¤‡ä¸»è¦æ¥æ”¶ä»¥ä¸‹ä¿¡å·ï¼š VOR ä¿¡å·ï¼ˆæä¾›ç£æ–¹ä½ä¿¡æ¯ï¼‰ ILS ä¿¡å·ï¼ˆåŒ…æ‹¬ LOC å’Œ GSï¼‰ DME ä¿¡å·ï¼ˆå¦‚æœ NAV è®¾å¤‡æ”¯æŒï¼‰ 2. VOR å’Œ ILS å¦‚ä½•è¢« NAV æ¥æ”¶ï¼Ÿ ç³»ç»Ÿ é¢‘ç‡èŒƒå›´ åŠŸèƒ½ ç”± NAV æ¥æ”¶ï¼Ÿ VOR 108.00 â€“ 117.95 MHz æä¾›æ–¹ä½è§’ï¼ˆRadialï¼‰ä¿¡æ¯ âœ… æ˜¯ LOCï¼ˆILSï¼‰ 108.10 â€“ 111.95 MHz æä¾›æ°´å¹³æ–¹å‘çš„è·‘é“å¯¹å‡†ä¿¡æ¯ âœ… æ˜¯ GSï¼ˆILSï¼‰ 329.15 â€“ 335.00 MHz æä¾›å‚ç›´æ–¹å‘çš„ä¸‹æ»‘è§’ä¿¡æ¯ âœ… æ˜¯ï¼ˆéƒ¨åˆ† NAV è®¾å¤‡é›†æˆ GS æ¥æ”¶ï¼‰ DME 962 â€“ 1213 MHz æä¾›è·ç¦»æµ‹é‡ âœ… æ˜¯ï¼ˆä½†æœ‰äº›é£æœºçš„ DME ç‹¬ç«‹äº NAVï¼‰ 3. VOR ä¸ ILS çš„æ¥æ”¶æ–¹å¼â‘  VORï¼ˆVHF Omnidirectional Rangeï¼‰ VOR ç«™ç‚¹å‘å°„ä¸€ä¸ªåŸºå‡†ä¿¡å·å’Œä¸€ä¸ªå¯å˜ä¿¡å·ã€‚ NAV æ¥æ”¶æœºè§£ç  VOR ä¿¡å·ï¼Œè®¡ç®—é£æœºä¸ VOR ç«™çš„ç£æ–¹ä½è§’ï¼ˆRadialï¼‰ã€‚ æ˜¾ç¤ºåœ¨ HSIï¼ˆæ°´å¹³æƒ…å†µæŒ‡ç¤ºå™¨ï¼‰æˆ– CDIï¼ˆèˆªé“åç¦»æŒ‡ç¤ºå™¨ï¼‰ä¸Šã€‚ â‘¡ ILSï¼ˆInstrument Landing Systemï¼‰ILS ç”±ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ç»„æˆï¼š LOCï¼ˆLocalizerï¼Œæœ¬åœ° izerï¼‰ å‘é€æ°´å¹³æ–¹å‘ä¿¡å·ï¼ŒæŒ‡ç¤ºé£æœºæ˜¯å¦å¯¹å‡†è·‘é“ä¸­å¿ƒçº¿ã€‚ NAV æ¥æ”¶ LOC ä¿¡å·ï¼Œå¹¶åœ¨ HSICDI ä¸Šæ˜¾ç¤ºèˆªé“åç¦»ä¿¡æ¯ã€‚ GSï¼ˆGlide Slopeï¼Œä¸‹æ»‘é“ï¼‰ å‘é€å‚ç›´æ–¹å‘ä¿¡å·ï¼ŒæŒ‡ç¤ºé£æœºæ˜¯å¦åœ¨æ­£ç¡®çš„ä¸‹æ»‘è·¯å¾„ä¸Šã€‚ NAV æ¥æ”¶æœºï¼ˆå¦‚æœæ”¯æŒ GSï¼‰ä¼šè§£ç  GS ä¿¡å·ï¼Œå¹¶åœ¨ PFDCDI ä¸Šæ˜¾ç¤ºä¸‹æ»‘è§’ä¿¡æ¯ã€‚ 4. NAVã€DME å’Œ ILS çš„å…³ç³»æœ‰äº› NAV è®¾å¤‡åŒæ—¶é›†æˆ DME åŠŸèƒ½ï¼Œä½†åœ¨æŸäº›é£æœºä¸Šï¼ŒDME æ˜¯ç‹¬ç«‹çš„æ¥æ”¶è®¾å¤‡ï¼Œç”¨äºæµ‹é‡é£æœºä¸å¯¼èˆªå°çš„è·ç¦»ã€‚ä¾‹å¦‚ï¼š VORDME ç«™ç‚¹å¯ä»¥åŒæ—¶æä¾›æ–¹ä½ï¼ˆVORï¼‰å’Œè·ç¦»ï¼ˆDMEï¼‰ã€‚ ILSDME è¿›è¿‘ä½¿ç”¨ ILS æä¾›èˆªå‘+ä¸‹æ»‘è§’ï¼ŒDME æä¾›è·ç¦»ä¿¡æ¯ã€‚ 5. NAV1 å’Œ NAV2 å¦‚ä½•å½±å“ VORILSï¼Ÿ NAV1 å’Œ NAV2 å¯ä»¥åˆ†åˆ«è°ƒè°ä¸åŒçš„ VOR æˆ– ILS é¢‘ç‡ï¼Œç”¨äºäº¤å‰æ£€æŸ¥ä¿¡å·ã€‚ è¿›è¿‘æ—¶ï¼ŒNAV1 ä¸€èˆ¬ç”¨äº ILS ç€é™†ï¼ŒNAV2 å¯èƒ½ç”¨äºç›‘å¬å¤‡ç”¨ VOR å°ã€‚ æ€»ç»“âœ… VOR å’Œ ILS çš„ä¿¡å·éƒ½æ˜¯ç”± NAV æ¥æ”¶æœºæ¥æ”¶çš„ã€‚âœ… LOCï¼ˆè·‘é“å¯¹å‡†ï¼‰å’Œ GSï¼ˆä¸‹æ»‘é“ï¼‰å‡å±äº ILSï¼ŒLOC ç”± NAV ç›´æ¥æ¥æ”¶ï¼ŒGS å¯èƒ½ç”± NAV æˆ–ä¸“ç”¨ GS æ¥æ”¶æœºå¤„ç†ã€‚âœ… DME å¯èƒ½é›†æˆåœ¨ NAV ä¸­ï¼Œä½†æŸäº›é£æœºçš„ DME æ˜¯ç‹¬ç«‹è®¾å¤‡ã€‚ åœ¨èˆªç©ºç”µå­ç³»ç»Ÿä¸­ï¼ŒNAV Audioï¼ˆå¯¼èˆªéŸ³é¢‘ï¼‰çš„ Filterï¼ˆæ»¤æ³¢å™¨ï¼‰ å’Œ Volumeï¼ˆéŸ³é‡ï¼‰ æ˜¯ç”¨äºä¼˜åŒ–å¯¼èˆªä¿¡å·éŸ³é¢‘è¾“å‡ºçš„å…³é”®æ§åˆ¶åŠŸèƒ½ï¼Œä»¥ä¸‹æ˜¯å®ƒä»¬çš„è¯¦ç»†ä½œç”¨ï¼š 1. NAV Audio Filterï¼ˆå¯¼èˆªéŸ³é¢‘æ»¤æ³¢å™¨ï¼‰ åŠŸèƒ½ï¼šç”¨äºè¿‡æ»¤å¯¼èˆªéŸ³é¢‘ä¿¡å·ä¸­çš„å¹²æ‰°å™ªå£°ï¼ˆå¦‚å¼•æ“å™ªéŸ³ã€æ— çº¿ç”µæ‚æ³¢ï¼‰ï¼Œä»…ä¿ç•™å¯¼èˆªè®¾å¤‡ï¼ˆå¦‚ VORã€ILSã€ADFï¼‰å‘å‡ºçš„å…³é”®éŸ³é¢‘æ ‡è¯†ã€‚ å…¸å‹åº”ç”¨ï¼š å½“è°ƒè°åˆ° VOR å¯¼èˆªå°æ—¶ï¼Œå¯¼èˆªå°ä¼šå‘é€æ‘©å°”æ–¯ä»£ç ï¼ˆå¦‚â€œâ— â— â—â€”â€ä»£è¡¨æŸå°ç«™ï¼‰ï¼Œæ»¤æ³¢å™¨ä¼šæŠ‘åˆ¶èƒŒæ™¯å™ªéŸ³ï¼Œç¡®ä¿ä»£ç æ¸…æ™°å¯è¾¨ã€‚ åœ¨ ILS è¿›è¿‘æ—¶ï¼Œæ»¤é™¤é«˜é¢‘å¹²æ‰°ï¼Œç¡®ä¿èˆªå‘é“ï¼ˆLocalizerï¼‰çš„éŸ³é¢‘è°ƒåˆ¶ä¿¡å·çº¯å‡€ã€‚ æ»¤æ³¢å™¨ç±»å‹ï¼šé€šå¸¸ä¸ºå¸¦é€šæ»¤æ³¢å™¨ï¼ˆä»…å…è®¸ç‰¹å®šé¢‘ç‡é€šè¿‡ï¼‰æˆ–å™ªå£°æŠ‘åˆ¶æ»¤æ³¢å™¨ï¼ˆæ¶ˆé™¤ä½é¢‘é«˜é¢‘æ‚éŸ³ï¼‰ã€‚ 2. NAV Volumeï¼ˆå¯¼èˆªéŸ³é¢‘éŸ³é‡ï¼‰ åŠŸèƒ½ï¼šè°ƒèŠ‚å¯¼èˆªéŸ³é¢‘çš„è¾“å‡ºéŸ³é‡ï¼Œä½¿é£è¡Œå‘˜èƒ½åœ¨ä¸åŒç¯å¢ƒå™ªå£°ï¼ˆå¦‚å¼•æ“å£°ã€æ°”è±¡å¹²æ‰°ï¼‰ä¸‹æ¸…æ™°å¬åˆ°å¯¼èˆªæç¤ºã€‚ å…¸å‹åº”ç”¨ï¼š èµ·é£é™è½é˜¶æ®µï¼šè°ƒé«˜éŸ³é‡ä»¥å‹åˆ¶å¼•æ“å™ªéŸ³ï¼Œç¡®ä¿å…³é”®å¯¼èˆªä¿¡å·ï¼ˆå¦‚ ILS èˆªå‘åå·®æç¤ºï¼‰å¯é—»ã€‚ å·¡èˆªé˜¶æ®µï¼šè°ƒä½éŸ³é‡ä»¥é¿å…æŒç»­éŸ³é¢‘å¹²æ‰°ã€‚ æ“ä½œé€»è¾‘ï¼šé€šå¸¸ä¸é€šä¿¡éŸ³é¢‘ï¼ˆCOMï¼‰åˆ†å¼€æ§åˆ¶ï¼Œé¿å…å¯¼èˆªæç¤ºä¸ ATC é€šè¯äº’ç›¸å¹²æ‰°ã€‚ 3. å®é™…åº”ç”¨åœºæ™¯ VOR å¯¼èˆªï¼šé£è¡Œå‘˜é€šè¿‡æ»¤æ³¢å™¨æ¶ˆé™¤æ‚éŸ³åï¼Œæ¸…æ™°å¬åˆ° VOR å°çš„æ‘©å°”æ–¯ä»£ç ï¼Œç¡®è®¤æ­£ç¡®è°ƒè°ï¼›é€šè¿‡éŸ³é‡æ§åˆ¶è°ƒæ•´éŸ³é¢‘å¼ºåº¦ã€‚ ILS è¿›è¿‘ï¼šæ»¤æ³¢å™¨ç¡®ä¿èˆªå‘é“ï¼ˆLocalizerï¼‰çš„éŸ³é¢‘è°ƒåˆ¶ä¿¡å·ç¨³å®šï¼ŒéŸ³é‡è°ƒèŠ‚ä½¿åå·®æç¤ºï¼ˆå¦‚â€œæ»´æ»´â€å£°ï¼‰åœ¨å˜ˆæ‚ç¯å¢ƒä¸­å¯è¯†åˆ«ã€‚ ADFï¼ˆè‡ªåŠ¨å®šå‘ä»ªï¼‰ï¼šæ»¤é™¤ä¸­æ³¢å¹¿æ’­å¹²æ‰°ï¼ˆå¦‚ AM ç”µå°ï¼‰ï¼Œä¸“æ³¨æ¥æ”¶ NDBï¼ˆæ— æ–¹å‘ä¿¡æ ‡ï¼‰çš„éŸ³é¢‘ä¿¡å·ã€‚ 4. è®¾è®¡æ„ä¹‰ å®‰å…¨æ€§ï¼šæ¸…æ™°çš„å¯¼èˆªéŸ³é¢‘å¸®åŠ©é£è¡Œå‘˜å®æ—¶ç¡®è®¤è®¾å¤‡å·¥ä½œçŠ¶æ€ï¼ˆå¦‚æ˜¯å¦è°ƒè°æ­£ç¡®ï¼‰ï¼Œé¿å…è¯¯åˆ¤ã€‚ äººæœºäº¤äº’ï¼šç‹¬ç«‹çš„éŸ³é‡æ§åˆ¶ä½¿é£è¡Œå‘˜èƒ½æ ¹æ®ä»»åŠ¡ä¼˜å…ˆçº§ï¼ˆå¦‚è¿›è¿‘æ—¶ä¾§é‡å¯¼èˆªï¼Œå·¡èˆªæ—¶ä¾§é‡é€šä¿¡ï¼‰çµæ´»è°ƒæ•´éŸ³é¢‘å¹³è¡¡ã€‚ æ€»ç»“ NAV Audio Filterï¼šå‡€åŒ–ä¿¡å·ï¼Œç¡®ä¿å¯¼èˆªæ ‡è¯†ï¼ˆå¦‚æ‘©å°”æ–¯ä»£ç ã€è°ƒåˆ¶éŸ³ï¼‰æ¸…æ™°å¯è¾¨ã€‚ NAV Volumeï¼šåŠ¨æ€è°ƒèŠ‚éŸ³é‡ï¼Œé€‚åº”ä¸åŒé£è¡Œé˜¶æ®µçš„å™ªå£°ç¯å¢ƒã€‚ä¸¤è€…å…±åŒä¿éšœé£è¡Œå‘˜é«˜æ•ˆã€å‡†ç¡®åœ°æ¥æ”¶å¯¼èˆªä¿¡æ¯ï¼Œæ˜¯èˆªç”µç³»ç»Ÿäººæœºäº¤äº’çš„å…³é”®è®¾è®¡ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","èˆªç”µç³»ç»Ÿ"]},{"title":"èˆªç”µç³»ç»Ÿçš„å¹³å°è¯´æ˜","path":"/2023/09/04/5-åµŒå…¥å¼å¼€å‘-èˆªç”µç³»ç»Ÿ-èˆªç”µç³»ç»Ÿçš„å¹³å°è¯´æ˜/","content":"èˆªç”µç³»ç»Ÿèˆªç©ºç”µå­ç³»ç»Ÿæ˜¯å®Œæˆé£è¡Œä»»åŠ¡ç›¸å…³åŠŸèƒ½çš„å­ç³»ç»Ÿï¼Œç”±æ— çº¿ç”µé€šä¿¡ã€å¯¼èˆªã€è‡ªåŠ¨é©¾é©¶å’Œæ˜¾ç¤ºç®¡ç†ç­‰å¤šä¸ªç³»ç»Ÿæ„æˆï¼ŒåŒ…æ‹¬æœºè½½è®¡ç®—æœºåŠåœ¨å…¶ä¹‹ä¸Šè¿è¡Œçš„è½¯ä»¶ã€é€šè®¯ã€ä¼ æ„Ÿå™¨ã€æ§åˆ¶å™¨ç­‰ã€‚ èˆªç”µç³»ç»Ÿå…ˆåç»å†äº†åˆ†ç«‹å¼ï¼Œè”åˆå¼ï¼Œç»¼åˆå¼å’Œé«˜åº¦ç»¼åˆå¼å››ä¸ªé˜¶æ®µã€‚ ç»¼åˆæ¨¡å—åŒ–èˆªç©ºç”µå­ç³»ç»Ÿï¼ˆIntegrated Modular Avionicsï¼ŒIMAï¼‰æ˜¯ç›®å‰èˆªç”µç³»ç»Ÿä½“ç³»ä¸­çš„å…¸å‹ç»“æ„ã€‚ ç»¼åˆæ¨¡å—åŒ–èˆªç©ºç”µå­ç³»ç»Ÿå¼€å‘è¿‡ç¨‹çš„æŒ‡å—æ–‡ä»¶ DO-297 ä¸­å¯¹ IMA çš„å®šä¹‰æ˜¯:â€IMA æ˜¯ä¸€ç»„çµæ´»çš„ã€å¯é‡ç”¨çš„ã€å¯äº’æ“ä½œçš„å…±äº«ç¡¬ä»¶å’Œè½¯ä»¶èµ„æº,å½“æŠŠè¿™äº›èµ„æºç»¼åˆåœ¨ä¸€èµ·æ—¶å¯ä»¥æ„å»ºä¸€ä¸ªå¹³å°,è¯¥å¹³å°æŒ‰ä¸€ç»„ç¡®å®šçš„å®‰å…¨å’Œæ€§èƒ½éœ€æ±‚è¿›è¡Œè®¾è®¡å’ŒéªŒè¯,èƒ½æ ä¾›å„ç§æœåŠ¡,å¹¶é©»ç•™æ‰§è¡Œé£æœºåŠŸèƒ½çš„åº”ç”¨â€ï¼Œé€šä¿—çš„æ¥è¯´ï¼ŒIMA ç»“æ„çš„ä¸»è¦åŠŸèƒ½æ˜¯å°†å¤šä¸ªåŠŸèƒ½ç‹¬ç«‹çš„æœºè½½è®¾å¤‡ä½œä¸ºæ•´ä½“ç»Ÿä¸€è€ƒè™‘ï¼Œåœ¨æ¨¡å—çº§è¿›è¡Œç»¼åˆé›†æˆã€‚IMA å¹³å°é€‚èˆªå®¡å®šçš„å„é€‚èˆªæ ‡å‡†ä¹‹é—´çš„ç›¸äº’æ”¯æ’‘å…³ç³»å¦‚å›¾ã€‚ åœ¨ IMA ç»“æ„ä¸­ï¼Œä»¥é©»ç•™åœ¨ IMA ç³»ç»Ÿçš„é£è¡Œç®¡ç†ç³»ç»Ÿä¸ºä¾‹ï¼Œå…¶é£æœºåŠŸèƒ½åˆ†é…åˆ° IMA ç³»ç»Ÿçš„åŠŸèƒ½æ€§èƒ½éœ€æ±‚å±‚æ¬¡ç»“æ„å¦‚å›¾ã€‚æœ€é¡¶å±‚çš„ä»»åŠ¡æè¿°ä¸æœ€åº•å±‚çš„è®¾è®¡å®ç°ä»ä¸åŒçš„è§’åº¦æè¿°äº†åŒä¸€ä¸ªé£æœºåŠŸèƒ½ã€‚ é¡¶å±‚æ˜¯ä»é£æœºçº§ä»»åŠ¡çš„è§’åº¦æŠ½è±¡åœ°æè¿°æ•´ä¸ªé£æœºçš„é¢„æœŸæ“ä½œ åº•å±‚çš„è®¾è®¡å®ç°å±‚åˆ™æ˜¯ä»è½¯ç¡¬ä»¶è®¾è®¡å®ç°çš„è§’åº¦,æè¿°é£æœºçº§ä»»åŠ¡çš„æœ€ç»ˆå®ç° â€œè®¾è®¡å®ç°å±‚â€æè¿°çš„æ˜¯å…·ä½“çš„è®¾è®¡â€éœ€æ±‚â€,å¯ä»¥é€çº§å‘ä¸Šè¿½æº¯åˆ°æœ€é¡¶å±‚çš„â€ä»»åŠ¡â€æè¿°,å³æœ€åº•å±‚çš„éœ€æ±‚æ˜¯ä»æœ€é¡¶å±‚çš„ä»»åŠ¡åˆ†è§£è€Œæ•è·åˆ°çš„ è¡Œä¸šæ ‡å‡†é’ˆå¯¹ IMA ä½“ç³»ç»“æ„ï¼Œå¸¸ç”¨è¡Œä¸šæ ‡å‡†å’Œæ¨èå®è·µåŒ…æ‹¬: RTCA (Radio Technical Commission for Aeronautics) RTCA æ˜¯ç¾å›½çš„æ ‡å‡†ç»„ç»‡ï¼Œè´Ÿè´£åˆ¶å®šèˆªç©ºé¢†åŸŸçš„æœ€ä½æ“ä½œæ€§èƒ½æ ‡å‡†ï¼ˆMOPSï¼‰å’Œæœ€ä½èˆªç©ºç³»ç»Ÿæ€§èƒ½æ ‡å‡†ï¼ˆMASPSï¼‰ã€‚RTCA åˆ¶å®šçš„æ ‡å‡†ç”¨äº FAA çš„æŠ€æœ¯æ ‡å‡†å‘½ä»¤ï¼ˆTSOï¼‰ï¼Œä»è€Œä½¿è®¾å¤‡ç¬¦åˆ FAA è®¤è¯ã€‚ DO-178Cï¼šè½¯ä»¶è®¤è¯æ ‡å‡†ï¼Œè§„å®šäº†èˆªç©ºè½¯ä»¶çš„å¼€å‘å’ŒéªŒè¯è¿‡ç¨‹ï¼Œç¡®ä¿å…¶å®‰å…¨æ€§å’Œå¯é æ€§ã€‚ DO-254ï¼šç¡¬ä»¶è®¾è®¡å’Œå¼€å‘æ ‡å‡†ï¼Œç‰¹åˆ«é’ˆå¯¹èˆªç©ºç”µå­è®¾å¤‡ä¸­çš„å¤æ‚ç”µå­ç¡¬ä»¶ï¼ˆå¦‚ FPGA å’Œ ASICï¼‰ã€‚ DO-297ï¼šç”± RTCA æå‡ºçš„æŒ‡å—ï¼Œæä¾›äº† IMA ç³»ç»Ÿçš„å¼€å‘ã€é›†æˆå’Œè®¤è¯çš„æ¡†æ¶ã€‚è¯¥æ ‡å‡†é˜æ˜äº†æ¨¡å—åŒ–èˆªç©ºç”µå­ç³»ç»Ÿçš„å¼€å‘æµç¨‹å’Œè®¤è¯è¦æ±‚ã€‚ EUROCAE (European Organisation for Civil Aviation Equipment) EUROCAE æ˜¯æ¬§æ´²çš„æ ‡å‡†åˆ¶å®šç»„ç»‡ï¼Œç±»ä¼¼äº RTCAï¼Œä¸»è¦æœåŠ¡äºæ¬§æ´²æ°‘èˆªå±€ï¼ˆEASAï¼‰çš„è®¤è¯éœ€æ±‚ã€‚ ED-12Cï¼šä¸ RTCA DO-178C ç›¸åŒï¼Œæ˜¯èˆªç©ºè½¯ä»¶å¼€å‘çš„æ¬§æ´²æ ‡å‡†ã€‚ ED-80DO-254ï¼šèˆªç©ºç”µå­è®¾å¤‡ä¸­çš„ç¡¬ä»¶å¼€å‘æ ‡å‡†ã€‚ SAE (Society of Automotive Engineers) SAE æ˜¯æ±½è½¦å’Œèˆªç©ºé¢†åŸŸçš„æ ‡å‡†ç»„ç»‡ï¼Œè¦†ç›–ä»æ±½è½¦åˆ°èˆªç©ºèˆªå¤©ç­‰å¤šé¢†åŸŸçš„æŠ€æœ¯å’Œå®‰å…¨æ ‡å‡†ã€‚SAE çš„æ ‡å‡†åœ¨èˆªç©ºç”µå­ã€è‡ªåŠ¨é©¾é©¶æ±½è½¦ç­‰é¢†åŸŸæœ‰å¹¿æ³›åº”ç”¨ã€‚ ARP4754Aï¼šèˆªç©ºç³»ç»Ÿå¼€å‘æ ‡å‡†ï¼Œè§„å®šäº†å¤æ‚èˆªç©ºç³»ç»Ÿçš„å¼€å‘æµç¨‹ã€‚ ARP4761ï¼šèˆªç©ºç³»ç»Ÿå®‰å…¨æ€§è¯„ä¼°æ ‡å‡†ï¼Œç»“åˆå¤±æ•ˆæ¨¡å¼ä¸å½±å“åˆ†æï¼ˆFMEAï¼‰å’Œæ•…éšœæ ‘åˆ†æï¼ˆFTAï¼‰æ¥è¯„ä¼°ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚ ARINC (Aeronautical Radio, Inc.) ARINC æ˜¯ä¸€ä¸ªèˆªç©ºæ ‡å‡†ç»„ç»‡ï¼Œåˆ¶å®šèˆªç©ºç”µå­è®¾å¤‡çš„äº’è”äº’é€šå’Œè§„èŒƒæ ‡å‡†ï¼Œå¹¿æ³›ç”¨äºèˆªç©ºå…¬å¸å’Œèˆªç©ºåˆ¶é€ å•†ä¹‹é—´çš„è®¾å¤‡å…¼å®¹æ€§ã€‚ ARINC 429ï¼šèˆªç©ºç”µå­è®¾å¤‡ä¹‹é—´çš„æ•°å­—æ•°æ®é€šä¿¡åè®®ï¼Œå¹¿æ³›ç”¨äºå•†ä¸šèˆªç©ºç³»ç»Ÿä¸­çš„èˆªç”µé€šä¿¡ã€‚ ARINC 653ï¼šå®æ—¶æ“ä½œç³»ç»Ÿï¼ˆRTOSï¼‰çš„æ ‡å‡†æ¥å£ï¼Œå¹¿æ³›åº”ç”¨äºèˆªç©ºåµŒå…¥å¼ç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯åˆ†åŒºå¤šä»»åŠ¡æ“ä½œç³»ç»Ÿã€‚ ARINC 661ï¼šèˆªç©ºåº§èˆ±æ˜¾ç¤ºç³»ç»Ÿçš„æ ‡å‡†æ¥å£ï¼Œè§„å®šäº†ç”¨æˆ·ç•Œé¢å’Œåº§èˆ±æ˜¾ç¤ºå™¨çš„è®¾è®¡æ ‡å‡†ã€‚ ARINC 664ï¼šä¸ä»¥å¤ªç½‘å…¼å®¹çš„èˆªç©ºç½‘ç»œæ ‡å‡†ï¼Œé€‚ç”¨äºç°ä»£èˆªç©ºç½‘ç»œé€šä¿¡ï¼Œç‰¹åˆ«æ˜¯ AFDXï¼ˆAvionics Full-Duplex Switched Ethernetï¼‰ç½‘ç»œã€‚ ARINC 818ï¼šç”¨äºèˆªç©ºç³»ç»Ÿè§†é¢‘ä¼ è¾“çš„åè®®ã€‚ IMA ç³»ç»Ÿä½œä¸ºä½“ç³»ç»“æ„å®šä¹‰äº†åº”ç”¨åˆ†åŒºæ¦‚å¿µï¼ŒARINC 653 æ˜¯ä¸º IMA è®¾è®¡çš„ä¸€ä¸ªå…³é”®æ ‡å‡†ï¼Œå®šä¹‰äº†åˆ†åŒºæ“ä½œç³»ç»Ÿçš„æ¥å£æ ‡å‡†ã€‚è§„å®šäº†åœ¨èˆªç©ºç”µå­ç³»ç»Ÿä¸­å¦‚ä½•å®ç°æ—¶é—´å’Œç©ºé—´åˆ†åŒºï¼Œä»¥ç¡®ä¿ä¸åŒåº”ç”¨ç¨‹åºä¹‹é—´çš„éš”ç¦»ï¼Œé˜²æ­¢å®ƒä»¬ç›¸äº’å¹²æ‰°ã€‚ç¬¦åˆ ARINC653 è§„èŒƒçš„ IMA æ¶æ„ä»ä¸Šè€Œä¸‹åˆ’åˆ†ä¸ºåº”ç”¨è½¯ä»¶ã€å®æ—¶æ“ä½œç³»ç»Ÿ(Real-Time Operating Systems, RTOS)ã€ç¡¬ä»¶ä¸‰ä¸ªå±‚çº§ï¼Œå±‚çº§ä¹‹é—´é€šè¿‡è™šæ‹Ÿçš„æ¥å£å±‚è¿›è¡Œäº¤äº’ã€‚ ç©ºé—´åˆ†åŒºï¼šå½“æŸä¸€ä¸ªåˆ†åŒºçš„åº”ç”¨è½¯ä»¶å‘ç”Ÿé”™è¯¯æˆ–æ•…éšœæ—¶ä¸ä¼šå½±å“å…¶ä»–åˆ†åŒºå†…åº”ç”¨è½¯ä»¶çš„æ­£å¸¸è¿è¡Œ æ—¶é—´åˆ†åŒºï¼šç³»ç»Ÿä¼šæä¾›ç›¸å¯¹å®Œæ•´ç‹¬ç«‹çš„æ—¶é—´çª—å£ç»™ç³»ç»Ÿä¸­çš„å„ä¸ªåˆ†åŒºè¿›è¡Œè°ƒåº¦ï¼Œæ¯ä¸€ä¸ªåˆ†åŒºéƒ½æœ‰è‡ªå·±å¯¹åº”çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ—¶é—´ç‰‡ï¼Œåªæœ‰å½“è½®åˆ°è¯¥åˆ†åŒºçš„æ—¶é—´ç‰‡æ—¶ï¼Œæ‰ä¼šæ¿€æ´»å¹¶è¢«æ“ä½œç³»ç»Ÿè°ƒç”¨å¹¶è¿è¡Œï¼Œä»¥ç¡®ä¿æ—¶é—´ç»´åº¦ä¸Šçš„ç¡®å®šæ€§ åº”ç”¨è½¯ä»¶ æ“ä½œç³»ç»ŸARINC653 æ ‡å‡†èˆª ç”µ åº” ç”¨ è½¯ ä»¶ æ ‡ å‡† æ¥ å£ 653ï¼ˆAvionicsApplication Software Standard Interface 653ï¼ŒARINC653ï¼‰æ˜¯ä¸€ç§åµŒå…¥å¼æ“ä½œç³»ç»Ÿåº”ç”¨ç¨‹åºæ¥å£æ ‡å‡†ï¼Œç›®å‰æ˜¯å›½é™…ä¸Šåœ¨é£è¡Œå™¨è½¯ä»¶æ–¹é¢æ¯”è¾ƒé€šè¡Œçš„è½¯ä»¶è¿è¡Œæ ‡å‡†ã€‚ åœ¨ ARINC653 æ ‡å‡†ä¸­å®šä¹‰äº†ä¸€ä¸ªä¸»æ—¶é—´å¸§ï¼Œå†å°†ä¸»æ—¶é—´å¸§ä¸­åˆ†æˆå¤šä¸ªå°æ—¶é—´æ®µï¼Œæ¯ä¸ªæ—¶é—´æ®µåˆ†é…ç»™ä¸€ä¸ªåº”ç”¨ç¨‹åºè¿›ç¨‹æ‰§è¡Œã€‚éšç€èˆªç©ºè½¯ä»¶ç³»ç»Ÿçš„æ‰§è¡Œï¼Œä¸»æ—¶é—´å¸§å‘¨è€Œå¤å§‹è¿è¡Œï¼Œä½¿å„ä¸ªåº”ç”¨ç¨‹åºè¿›ç¨‹éƒ½èƒ½æœ‰æ•ˆè·å¾—ç¡¬ä»¶èµ„æºã€‚åŒæ—¶ï¼Œç”±äºæ¯ä¸ªè¿›ç¨‹åªä¼šåœ¨åˆ†é…çš„å°æ—¶é—´æ®µä¸­æ‰§è¡Œï¼Œä»è€Œé¿å…äº†åœ¨æ—¶é—´ä¸Šå¤šä¸ªè¿›ç¨‹åŒæ—¶æ‰§è¡Œé€ æˆçš„ç›¸äº’å½±å“ã€‚ä¸å°æ—¶é—´æ®µç›¸å¯¹åº”ï¼Œåˆ©ç”¨å¤„ç†å™¨å­˜å‚¨å™¨ç®¡ç†å•å…ƒï¼ˆMemory Management Unitï¼ŒMMUï¼‰ã€å­˜å‚¨å™¨æ§åˆ¶å™¨åˆ†åŒºï¼ˆbankï¼‰æ§åˆ¶ç­‰ç¡¬ä»¶æŠ€æœ¯ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºè¿›ç¨‹è¿è¡Œæ—¶ä½¿ç”¨ç›¸äº’ç‹¬ç«‹çš„ä¸€æ®µå­˜å‚¨å™¨ï¼Œä»è€Œé¿å…äº†åœ¨å­˜å‚¨å™¨ç©ºé—´ä¸Šå¤šä¸ªè¿›ç¨‹åŒæ—¶æ‰§è¡Œé€ æˆçš„ç›¸äº’å½±å“ã€‚ ARINC653 é€šè¿‡ä½¿åº”ç”¨è½¯ä»¶ä¸­çš„å„è¿›ç¨‹åœ¨æ—¶é—´å’Œç©ºé—´ä¸ŠåŒæ—¶åˆ†å¼€è·å¾—äº†è¾ƒé«˜çš„è½¯ä»¶è¿è¡Œå®‰å…¨æ€§ï¼Œæœ‰æ•ˆæ§åˆ¶äº†è¿›ç¨‹å‘ç”Ÿé”™è¯¯çš„å½±å“èŒƒå›´ï¼Œé¿å…äº†å› ä¸ºæŸä¸€è¿›ç¨‹å‘ç”Ÿé”™è¯¯æ—¶å¨èƒåˆ°æ•´ä¸ªèˆªç©ºè½¯ä»¶ç³»ç»Ÿè¿è¡Œï¼Œè¿›è€Œå¨èƒåˆ°é£è¡Œå™¨å®‰å…¨é£è¡Œçš„æƒ…å†µå‘ç”Ÿã€‚ ARINC653 çš„è¯¦ç»†æ¥å£å®ç°è§ ARINC653 FACE æ ‡å‡†æœªæ¥æœºè½½èƒ½åŠ›ç¯å¢ƒï¼ˆFuture Airborne Capability Environmentï¼ŒFACEï¼‰åœ¨ 2010 å¹´ç”±ç¾å›½æµ·å†›èˆªç©ºç³»ç»Ÿå¸ä»¤éƒ¨å‘èµ·ã€å¼€æºç»„ç»‡ï¼ˆOpenGroupï¼‰æå‡ºï¼Œå…¶ç­–ç•¥æ˜¯åœ¨å·±å®‰è£…å¥½ç¡¬ä»¶çš„å†›ç”¨èˆªç”µå¹³å°ä¸Šå»ºç«‹è½¯ä»¶é€šç”¨æ“ä½œç¯å¢ƒï¼Œä½¿ FACE ç»„ä»¶åº”ç”¨åœ¨ä¸åŒå¹³å°ä¸Šæ—¶å¯è¢«é‡æ–°éƒ¨ç½²ï¼Œä»è€Œå®ç°è·¨å¹³å°çš„å¯ç§»æ¤æ€§å’Œé‡ç”¨æ€§ã€‚ FACE é‡‡ç”¨â€åˆ†æ®µå¼â€æ¶æ„ï¼Œè‡ªé¡¶å‘ä¸‹åˆ†ä¸ºæ“ä½œç³»ç»Ÿæ®µã€IO æœåŠ¡æ®µã€å¹³å°ç‰¹å®šæœåŠ¡æ®µã€ä¼ è¾“æœåŠ¡æ®µå’Œå¯ç§»æ¤ç»„ä»¶æ®µï¼Œæ¯ä¸ªæ®µé—´çš„æ¥å£éƒ½è¿›è¡Œäº†æ ‡å‡†åŒ–å®šä¹‰ï¼Œä½¿å¾—åŸºäº FACE æ ‡å‡†çš„åº”ç”¨ç³»ç»Ÿå¯ä»¥ä»ä»»æ„ä¸€ä¸ªæ®µé—´æ¥å£å¼€å§‹è®¾è®¡å…·æœ‰è‡ªèº«ç‰¹è‰²åŠŸèƒ½æ®µã€‚ç›¸æ¯” ARINC653 ä¸­åªå®šä¹‰äº†åº”ç”¨ç¨‹åºåˆ†æ—¶åˆ†åŒºä½¿ç”¨ç¡¬ä»¶çš„è½¯ä»¶æ¥å£ï¼ŒFACE æ ‡å‡†åŒ…å«äº†åº”ç”¨ç¨‹åºä»é¡¶å±‚é€šç”¨æœåŠ¡åˆ°åº•å±‚ IO çš„å…¨éƒ¨å†…å®¹ï¼Œåˆ¶å®šäº†åº”ç”¨ç¨‹åºå„ç»„ä»¶çš„æ ‡å‡†åŒ–æ¥å£ï¼Œä¸ºåº”ç”¨ç¨‹åºèµ‹äºˆäº†å¯ç§»æ¤æ€§ã€å¼€æ”¾æ€§å’Œçµæ´»æ€§ï¼Œå¤§å¹…æé«˜äº†ç”µå­ç³»ç»Ÿè®¾è®¡çš„ä¾¿åˆ©æ€§ï¼Œä¸ºèˆªç”µè®¾å¤‡å³æ’å³ç”¨ç­‰åº”ç”¨åœºæ™¯æä¾›äº†æœ‰æ•ˆæŠ€æœ¯æ”¯æ’‘ã€‚ ç³»ç»Ÿæ¶æ„ç®€ä»‹åµŒå…¥å¼æ“ä½œç³»ç»Ÿï¼ˆEmbedded Operating Systemï¼‰æ˜¯ä¸€ç§è¿è¡Œåœ¨åµŒå…¥å¼ç³»ç»Ÿç¡¬ä»¶ä¸Šçš„åŸºç¡€è½¯ä»¶ï¼Œå…¶åŸºæœ¬åŠŸèƒ½æ˜¯å¯¹ç¡¬ä»¶è¿›è¡Œæœ‰æ•ˆç®¡ç†å¹¶å¯¹ç¡¬ä»¶è¿›è¡Œä¸€å®šç¨‹åº¦çš„æŠ½è±¡ä»¥ä¾¿åº”ç”¨è½¯ä»¶è°ƒç”¨ã€‚åœ¨å†›å·¥é¢†åŸŸï¼ŒåµŒå…¥å¼æ“ä½œç³»ç»Ÿåœ¨å…·å¤‡åŸºæœ¬åŠŸèƒ½çš„åŸºç¡€ä¸Šï¼Œè¿˜éœ€è¦å…·æœ‰å®æ—¶æ€§ï¼ˆReal-timeï¼‰ã€å®‰å…¨æ€§ï¼ˆSecurity Safetyï¼‰ç­‰ç‰¹ç‚¹ã€‚ ä¸»æµä½¿ç”¨çš„åµŒå…¥å¼æ“ä½œç³»ç»Ÿç¾å›½ æ¬§æ´² æ—¥æœ¬ å›½å†…è‡ªç ”ä¸”æœ‰å†›å·¥åº”ç”¨ å›½å†…è‡ªç ” ç¬¦åˆ ARINC653 çš„ OS å›½å†…å¤– OS å®‰å…¨è®¤è¯ æ“ä½œç³»ç»Ÿè°ƒåº¦å•æ ¸å¤„ç†å™¨è°ƒåº¦ç®—æ³•åœ¨å•æ ¸å¤„ç†å™¨ä¸­ï¼Œæ¯æ¬¡è°ƒåº¦åªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨è¿è¡Œï¼Œåªæœ‰ç­‰å¾…å½“å‰ä»»åŠ¡ç»“æŸæˆ–è¯¥ä»»åŠ¡çš„æ—¶é—´ç‰‡ç»“æŸåæ‰èƒ½åˆ‡æ¢åˆ°ä¸‹ä¸€ä»»åŠ¡è¿è¡Œï¼Œè¿½æ±‚ CPU åˆ©ç”¨ç‡å’Œååç‡çš„æœ€å¤§åŒ–ï¼Œå…³äº CPU åˆ©ç”¨ç‡ç­‰å‚æ•°è§ CPUå‚æ•°è¯´æ˜ å…ˆåˆ°å…ˆæœåŠ¡ï¼ˆFirst-Come, First-Servedï¼ŒFCFSï¼‰ FCFS æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨è€Œåˆç›¸å¯¹ç®€å•çš„è°ƒåº¦ç®—æ³•ï¼Œå…¶é‡‡ç”¨çš„æ˜¯å…ˆè¿›å…ˆå‡ºï¼ˆFirst-Input,First-Outputï¼ŒFIFOï¼‰é˜Ÿåˆ—ã€‚ä»»åŠ¡ä» FIFO é˜Ÿåˆ—å¤´éƒ¨å¼€å§‹é¡ºæ¬¡åˆ†é…ç»™å¤„ç†å™¨æ‰§è¡Œï¼Œä»»åŠ¡æ‰§è¡Œå®Œæˆåä¾¿ä»é˜Ÿé¦–åˆ é™¤ï¼Œå¹¶ä»é˜Ÿé¦–å–å‡ºæ–°çš„ä»»åŠ¡æ‰§è¡Œã€‚è€Œå½“æŸä¸€ä»»åŠ¡å‡†å¤‡å°±ç»ªåä¾¿å°†è¯¥ä»»åŠ¡é“¾æ¥åˆ° FIFO é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œå¦‚æ­¤å¾ªç¯å¾€å¤çš„æ‰§è¡Œã€‚FCFS æ˜¯ä¸€ç§éæŠ¢å å¼çš„ä»»åŠ¡è°ƒåº¦ç®—æ³•ï¼Œå…¶ä¼˜ç‚¹æ˜¯ç®€å•æ˜“æ‡‚ï¼Œç¼ºç‚¹åˆ™æ˜¯ç¼ºä¹çµæ´»æ€§ï¼Œä»»åŠ¡æ‰§è¡Œæ•ˆç‡ä½ä¸‹ã€‚ æœ€çŸ­ä½œä¸šæ—¶é—´ï¼ˆShortest-Job-Firstï¼ŒSJFï¼‰ SJF æ˜¯æŒ‡å¯¹å¤„ç†æ—¶é—´çŸ­çš„ä»»åŠ¡ä¼˜å…ˆè¿›è¡Œè°ƒåº¦è¿è¡Œï¼Œå…¶æ‹¥æœ‰å¯æŠ¢å ä¸éæŠ¢å ä¸¤ç§è°ƒåº¦æ¨¡å¼ã€‚è¿™æ˜¯ç§å¯ä»¥æå¤§ç¼©çŸ­è°ƒåº¦çš„å¹³å‡ç­‰å¾…æ—¶é—´çš„è°ƒåº¦æ–¹æ¡ˆï¼Œä½†é—æ†¾çš„æ˜¯è¿™ä»…ä»…åªæ˜¯ä¸€ç§ç†æƒ³çš„æ–¹æ¡ˆï¼Œå› ä¸ºè®¡ç®—æœºæ˜¯å¾ˆéš¾é¢„å…ˆçŸ¥é“éšæœºä»»åŠ¡è¿è¡Œæ‰€éœ€è¦å ç”¨å¤„ç†å™¨çš„æ—¶é—´ã€‚ ä¼˜å…ˆæƒè°ƒåº¦ï¼ˆPriorityï¼‰ ä¼˜å…ˆæƒè°ƒåº¦æŒ‡çš„æ˜¯ç³»ç»Ÿä¼šæŒ‰ç…§æŸç§æƒå€¼åˆ†é…ç­–ç•¥æ¥ç»™æ¯ä¸ªä»»åŠ¡åˆ†é…ä¸€ä¸ªå¯¹åº”çš„æƒå€¼ï¼Œä»¥æ­¤æ¥è¡¡é‡ä»»åŠ¡çš„ä¼˜å…ˆçº§åˆ«ï¼Œä¼˜å…ˆçº§åˆ«æœ€é«˜çš„ä»»åŠ¡æœ€å…ˆåˆ†é…ç»™å¤„ç†å™¨è¿›è¡Œæ‰§è¡Œï¼Œå¯¹äºå…·æœ‰ç›¸åŒä¼˜å…ˆçº§åˆ«çš„ä»»åŠ¡ï¼Œå°†å…¶æŒ‰ç…§ FCFS çš„é¡ºåºæ¥è¿›è¡Œæ‰§è¡Œã€‚ä»¥ä¸Šè®²åˆ°çš„ SJF è°ƒåº¦ç®—æ³•ä¾¿æ˜¯ä¼˜å…ˆæƒè°ƒåº¦çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå…¶æƒå€¼åˆ†é…ç­–ç•¥ä¸ºä»»åŠ¡è¿è¡Œæ—¶é—´çš„å€’æ•°ã€‚ è½®è½¬æ³•è°ƒåº¦ï¼ˆRound Robinï¼ŒRRï¼‰ RR ç®—æ³•æ˜¯åœ¨ FCFS ç®—æ³•ä¸­åŠ å…¥æ—¶é—´ç‰‡æŠ¢å ç­–ç•¥è€Œå½¢æˆçš„ï¼Œæ˜¯å¯¹ FCFS ç®—æ³•çš„ä¼˜åŒ–ã€‚åœ¨ä»»åŠ¡è°ƒåº¦è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä»»åŠ¡ A çš„è¿è¡Œæ—¶é—´å°äºè®¾å®šçš„æ—¶é—´ç‰‡ï¼Œåˆ™ä¼šè‡ªåŠ¨é‡Šæ”¾å¤„ç†å™¨ï¼›åä¹‹ï¼Œå¦‚æœä»»åŠ¡ A çš„è¿è¡Œæ—¶é—´å¤§äºæ—¶é—´ç‰‡ï¼Œåˆ™ç³»ç»Ÿä¼šäº§ç”Ÿå®šæ—¶å™¨ä¸­æ–­ï¼Œå…ˆä¿å­˜ä»»åŠ¡ A çš„æ‰§è¡ŒçŠ¶æ€æ–‡ä»¶ï¼Œç„¶åå°†å…¶æ·»åŠ åˆ° FIFO é˜Ÿåˆ—çš„å°¾éƒ¨ï¼›ä¸æ­¤åŒæ—¶ï¼Œç³»ç»Ÿä¼šä» FIFO é˜Ÿåˆ—çš„é˜Ÿé¦–è°ƒå‡ºä»»åŠ¡ B æ¥è¿›è¡Œæ‰§è¡Œã€‚RR è°ƒåº¦ç®—æ³•çš„æ€§èƒ½ä¸æ—¶é—´ç‰‡å¤§å°æœ‰ç€ç›´æ¥çš„å…³ç³»ï¼Œå½“æ—¶é—´ç‰‡é€‰å–è¿‡å°æ—¶ï¼Œå•ä½æ—¶é—´é‡Œè¿›è¡Œä»»åŠ¡åˆ‡æ¢çš„æ¬¡æ•°å°±ä¼šå˜å¤šï¼Œä»è€Œå¢åŠ ç³»ç»Ÿçš„å†…å­˜æ¶ˆè€—ï¼Œå½±å“ç³»ç»Ÿä»»åŠ¡è°ƒåº¦çš„æ•ˆç‡ï¼›ä¸ä¹‹ç›¸åï¼Œå½“æ—¶é—´ç‰‡é€‰å–æ— é™å¤§æ—¶ï¼Œå¯¹äºå¤§é‡ä½¿ç”¨ RR è°ƒåº¦ç®—æ³•çš„ä»»åŠ¡æ¥è¯´ï¼Œå…¶è°ƒåº¦æ•ˆç‡è¶‹åŒä¸ FCFS ç®—æ³•ï¼Œå®¹æ˜“é€ æˆä»»åŠ¡çš„é˜»å¡ã€‚å› æ­¤ä½¿ç”¨ RR ç®—æ³•è¿›è¡Œä»»åŠ¡è°ƒåº¦æ—¶ï¼Œé€‰æ‹©é€‚å½“é•¿åº¦çš„æ—¶é—´ç‰‡éå¸¸é‡è¦ã€‚ å¤šé˜Ÿåˆ—è°ƒåº¦ï¼ˆMultilevel Queueï¼‰ å¤šé˜Ÿåˆ—è°ƒåº¦æ˜¯ä¸€ç§ä¸¤å±‚çš„è°ƒåº¦æ¨¡å‹ï¼Œå…¶å°†æ‰€æœ‰çš„ä»»åŠ¡åˆ’åˆ†ä¸ºå¤šä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œå…ˆä»¥ä»»åŠ¡é˜Ÿåˆ—ä¸ºè°ƒåº¦å•å…ƒï¼Œé˜Ÿåˆ—ä¹‹é—´é‡‡ç”¨æŸç§åˆé€‚çš„è°ƒåº¦ç®—æ³•ã€‚å†ä»¥é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¸ºè°ƒåº¦å•å…ƒï¼Œåœ¨æ¯ä¸€ä¸ªé˜Ÿåˆ—å†…éƒ¨é‡‡ç”¨æŸç§åˆé€‚çš„è°ƒåº¦ç®—æ³•ã€‚ å¤šçº§åé¦ˆé˜Ÿåˆ—ï¼ˆMultilevel Feedback Queueï¼‰ å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨å´å¼‚å¸¸å¤æ‚çš„è°ƒåº¦ç®—æ³•ï¼Œå®ƒæ˜¯å¯¹å¤šé˜Ÿåˆ—è°ƒåº¦ç®—æ³•çš„ä¼˜åŒ–ã€‚åœ¨å¤šé˜Ÿåˆ—è°ƒåº¦ä¸­ï¼Œä»»åŠ¡åˆ†é…åˆ°æŸé˜Ÿåˆ—åä¾¿å›ºå®šä¸èƒ½è¿›è¡Œç§»åŠ¨ï¼Œå¯¼è‡´ä»»åŠ¡è°ƒåº¦è¿‡ç¨‹ç¼ºä¹çµæ´»æ€§ã€‚è€Œåœ¨å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ä¸­ï¼Œä¼˜åŒ–äº†è¿™ç§å›ºå®šçš„è®¾è®¡ï¼Œå…è®¸ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­è¿›è¡Œç§»åŠ¨ï¼Œæé«˜äº†è°ƒåº¦çš„çµæ´»æ€§ä¸é«˜æ•ˆæ€§ã€‚ ARINC653 è°ƒåº¦åœ¨ ARINC653 æ ‡å‡†çš„å®ç°ä¸­ï¼Œåˆ†ä¸ºåˆ†åŒºè°ƒåº¦å’Œåˆ†åŒºå†…çš„è¿›ç¨‹è°ƒåº¦ï¼š åˆ†åŒºé—´è°ƒåº¦ï¼š é‡‡ç”¨ è½®è½¬æ³•è°ƒåº¦ï¼ˆRound Robinï¼ŒRRï¼‰ï¼Œé€šè¿‡å›ºå®šé•¿åº¦çš„æ—¶é—´ç‰‡æŒ‰å¾ªç¯é¡ºåºåˆ†é…å¤„ç†å™¨æ—¶é—´ï¼Œå®ç°äº†å„åˆ†åŒºçš„å…¬å¹³å’Œéš”ç¦»ã€‚ åˆ†åŒºå†…è¿›ç¨‹è°ƒåº¦ï¼š é‡‡ç”¨ ä¼˜å…ˆæƒè°ƒåº¦ï¼ˆPriority Schedulingï¼‰ï¼Œæ ¹æ®è¿›ç¨‹çš„ä¼˜å…ˆçº§åˆ†é…æ‰§è¡Œé¡ºåºï¼Œç¡®ä¿å…³é”®ä»»åŠ¡çš„å®æ—¶æ€§å’Œå“åº”é€Ÿåº¦ã€‚ å…³äºåˆ†åŒºè°ƒåº¦çš„å®ç°å’Œæµç¨‹è§ è¿è¡Œæµç¨‹ å¤šæ ¸å¤„ç†å™¨è°ƒåº¦ç®—æ³•å¤šæ ¸ä»»åŠ¡è°ƒåº¦å…¸å‹åº”ç”¨æ¨¡å¼ï¼š å¯¹ç§°å¤šå¤„ç†ï¼ˆSymmetric Multi-Processingï¼ŒSMPï¼‰ SMP æ¨¡å¼æ˜¯æŒ‡åŒä¸€ä¸ªæ ¸å¿ƒæ“ä½œç³»ç»Ÿæ˜ åƒè´Ÿè´£åè°ƒæ‰€æœ‰å¤„ç†å™¨æ ¸ä¸Šçš„ä»»åŠ¡è°ƒåº¦å·¥ä½œï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰çš„åˆ†åŒºä»»åŠ¡å…è®¸åŠ¨æ€åˆ†é…åˆ°ä»»ä½•ç©ºé—²çš„å¤„ç†å™¨æ ¸ä¸Šè¿›è¡Œæ‰§è¡Œï¼Œå¯ä»¥æ›´å¥½çš„å®ç°è´Ÿè½½å‡è¡¡æ€§ã€‚ éå¯¹ç§°å¤šå¤„ç†ï¼ˆAsymmetric Multi-Processingï¼ŒAMPï¼‰ AMP æ¨¡å¼æ˜¯æŒ‡æŸä¸€ä»»åŠ¡ä¸æŸä¸ªå¤„ç†å™¨æ ¸ç»‘å®šä¹‹åï¼Œå°±ä¸å…è®¸åœ¨æ­¤å¤„ç†å™¨æ ¸ä¹‹å¤–çš„å…¶ä»–å¤„ç†å™¨æ ¸ä¸Šè¿è¡Œã€‚ç›¸æ¯”è¾ƒäº SMP æ¨¡å¼ä¸‹æ‰€æœ‰å¤„ç†å™¨æ ¸å…±äº«ä¸€ä¸ªå…¨å±€çš„æ ¸å¿ƒæ“ä½œç³»ç»Ÿæ˜ åƒï¼ŒAMP æ¨¡å¼ä¸‹å„ä¸ªå¤„ç†å™¨æ ¸éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿæ˜ åƒï¼Œä¸”æ¯ä¸ªå¤„ç†å™¨æ ¸éƒ½å¯ä»¥æ ¹æ®å®é™…è°ƒåº¦éœ€æ±‚é€‰æ‹©åŠ è½½åˆé€‚çš„æ“ä½œç³»ç»Ÿæ˜ åƒï¼Œå¦‚åŠ è½½ Windows æ˜ åƒã€Linux æ˜ åƒã€VxWorks æ˜ åƒç­‰ç­‰ï¼Œä»¥å½¢æˆè¯¥å¤„ç†å™¨æ ¸ç‹¬ç«‹çš„è°ƒåº¦åŸŸï¼Œå¯¹è°ƒåº¦åŸŸå†…çš„ä»»åŠ¡èµ„æºè¿›è¡Œç®¡ç†ã€‚ ç»‘å®šå¤šå¤„ç†ï¼ˆBound Multi-Processingï¼ŒBMPï¼‰ BMP æ¨¡å¼æ˜¯ä¸€ç§æ¯” SMP æ›´åŠ çµæ´»çš„å¤šæ ¸å¤„ç†å™¨è°ƒåº¦æ¨¡å¼ã€‚ç›¸æ¯”è¾ƒ SMP æ¨¡å¼ï¼ŒBMP æ¨¡å¼åœ¨ä¿è¯ SMP æ¨¡å¼ä¸‹ä»»åŠ¡å…¨å±€åŠ¨æ€è°ƒåº¦çš„åŒæ—¶ï¼Œå…è®¸å¯¹ä¸€äº›æœ‰ç‰¹æ®Šéœ€æ±‚çš„ä»»åŠ¡ç»‘å®šåˆ°æŒ‡å®šçš„å¤„ç†å™¨æ ¸ä¸Šè¿›è¡Œè°ƒåº¦ï¼Œå¢åŠ äº†çµæ´»æ€§ã€‚ å¤šæ ¸å¤„ç†å™¨çš„è´Ÿè½½å‡è¡¡ ç¡¬ä»¶å¹³å°èƒ½åŠ›æŒ‡æ ‡ç»¼åˆè®¡ç®—èƒ½åŠ›æŒ‡æ ‡ ç½‘ç»œäº’è”èƒ½åŠ›æŒ‡æ ‡ åµŒå…¥å¼å¹³å°çš„ä¼˜ç‚¹ å¹³å° CPU ä¸º AMD PPC440 GPU ä¸º ATI Tech M7500E æ“ä½œç³»ç»Ÿ LynxOS-178ï¼ŒPOSIXï¼Œå¤šå¤„ç†å™¨å¤šçº¿ç¨‹ï¼Œå®æ—¶ï¼Œåˆ†åŒº ARINC653 ç›®å‰å¹³å°çš„é™åˆ¶ç‚¹ åŠŸè€— å‘çƒ­ GPU é‡‡ç”¨çš„ RISC çš„æŒ‡ä»¤é›† PPC å¹³å° ARM å¹³å° RK NXP TI","categories":["5.åµŒå…¥å¼å¼€å‘","èˆªç”µç³»ç»Ÿ"]},{"title":"é¢å‘èˆªç©ºç”µå­ç³»ç»Ÿçš„åµŒå…¥å¼æ“ä½œç³»ç»Ÿ","path":"/2023/09/01/5-åµŒå…¥å¼å¼€å‘-èˆªç”µç³»ç»Ÿ-é¢å‘èˆªç©ºç”µå­ç³»ç»Ÿçš„åµŒå…¥å¼æ“ä½œç³»ç»Ÿ/","content":"èˆªç©ºç”µå­ç³»ç»Ÿå‘å±•å†ç¨‹èˆªç©ºç”µå­ç³»ç»Ÿæ˜¯ç°ä»£å†›äº‹èˆªç©ºå™¨çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œéšç€æŠ€æœ¯è¿›æ­¥ï¼Œå…¶å‘å±•ç»å†äº†å¤šä¸ªé˜¶æ®µï¼Œé€æ¸å‘åŠŸèƒ½æ›´å¼ºå¤§ã€é›†æˆåº¦æ›´é«˜çš„æ–¹å‘æ¼”è¿›ã€‚ä»ä¸Šä¸–çºª 70 å¹´ä»£è‡³ä»Šï¼Œèˆªç©ºç”µå­ç³»ç»Ÿçš„æ¼”åŒ–ä¸ä»…æå‡äº†é£è¡Œå™¨çš„æ€§èƒ½ï¼Œè¿˜å¢å¼ºäº†å…¶åœ¨å¤æ‚ä½œæˆ˜ç¯å¢ƒä¸­çš„é€‚åº”èƒ½åŠ›å’Œæˆ˜æ–—åŠ›ã€‚ ä¸»è¦å‘å±•é˜¶æ®µäºŒä»£æœºï¼ˆ1970 å¹´ä»£ï¼‰äºŒä»£æœºçš„èˆªç©ºç”µå­ç³»ç»Ÿå¤§å¤šé‡‡ç”¨äº† ç‹¬ç«‹å¼ æ¶æ„ã€‚è¿™ä¸€æ—¶æœŸï¼Œé£æœºçš„ç”µå­è®¾å¤‡ä¸»è¦åŸºäºå•ä¸€çš„å¤„ç†å™¨ï¼Œç¼ºä¹äº’è¿åŠŸèƒ½ã€‚å› æ­¤ï¼Œå„ä¸ªç³»ç»Ÿä¹‹é—´æ— æ³•ç›´æ¥æ²Ÿé€šï¼Œåªèƒ½ä¾èµ–ä¼ ç»Ÿçš„æ‰‹åŠ¨æ“ä½œã€‚æ¯”å¦‚ï¼Œæœ€å…¸å‹çš„ä»£è¡¨æ˜¯ç¾å›½çš„ F-4 å¹½çµæˆ˜æ–—æœºï¼Œè¿™æ¬¾é£æœºè™½ç„¶åœ¨æˆ˜æ–—ä¸­è¡¨ç°ä¼˜å¼‚ï¼Œä½†å…¶ç”µå­ç³»ç»Ÿçš„å±€é™æ€§å´åœ¨ç°ä»£æˆ˜æ–—æ¡ä»¶ä¸‹æ˜¾å¾—æ„ˆå‘æ˜æ˜¾ã€‚ ä¸‰ä»£æœºï¼ˆ1990 å¹´ä»£ï¼‰è¿›å…¥ 1990 å¹´ä»£ï¼Œèˆªç©ºç”µå­ç³»ç»Ÿå¼€å§‹å‘ è”åˆå¼ æ¶æ„æ¼”åŒ–ã€‚è¿™ä¸€æ—¶æœŸçš„æˆ˜æœºå¦‚ F-15 å’Œ F-16 é‡‡ç”¨äº†å¤šå¤„ç†å™¨è®¾è®¡ï¼Œå¹¶åŠ å…¥äº†ç³»ç»Ÿé—´çš„äº’è¿ï¼Œå…è®¸å„ç”µå­ç³»ç»Ÿä¹‹é—´å…±äº«ä¿¡æ¯ï¼Œä»è€Œå¤§å¤§æé«˜äº†æˆ˜æœ¯å†³ç­–çš„é€Ÿåº¦å’Œå‡†ç¡®æ€§ã€‚ä¾‹å¦‚ï¼ŒF-16 çš„ç»¼åˆ avionics ç³»ç»Ÿå…è®¸åœ°é¢å’Œç©ºä¸­æŒ‡æŒ¥å®˜å®æ—¶è·å–é£è¡Œå™¨çŠ¶æ€å’Œæ•Œæ–¹æƒ…æŠ¥ï¼Œå¢å¼ºäº†æˆ˜æ–—èƒ½åŠ›ã€‚ ä¸‰ä»£åŠï¼ˆ1990 å¹´ä»£æœ«è‡³ 2000 å¹´ä»£åˆï¼‰åœ¨æ­¤é˜¶æ®µï¼Œèˆªç©ºç”µå­ç³»ç»Ÿæ—¥ç›Šå‘ ç»¼åˆå¼ å‘å±•ã€‚ç»¼åˆå¼èˆªç©ºç”µå­ç³»ç»Ÿå®ç°äº†å±€éƒ¨ç»¼åˆï¼Œå…·ä½“åŒ…æ‹¬åŠŸèƒ½åˆ†åŒºå’Œä»»åŠ¡æµ®åŠ¨ï¼Œèƒ½å¤Ÿåœ¨ä¸åŒçš„ä½œæˆ˜æ¡ä»¶ä¸‹å¿«é€Ÿåˆ‡æ¢åŠŸèƒ½ã€‚æ¯”å¦‚ï¼ŒFA-18 å¤§ä¹Œé¸¦æˆ˜æ–—æ”»å‡»æœºå°±é‡‡ç”¨äº†è¿™ç§è®¾è®¡ï¼Œä½¿å…¶åœ¨æ‰§è¡Œå¤šç§ä»»åŠ¡æ—¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿé€‚åº”æ–°ä»»åŠ¡çš„éœ€æ±‚ã€‚ å››ä»£æœºï¼ˆ2000 å¹´ä»£è‡³ä»Šï¼‰æœ€æ–°çš„ å…ˆè¿›ç»¼åˆå¼ èˆªç©ºç”µå­ç³»ç»Ÿåœ¨ 20 ä¸–çºªæœ«å’Œ 21 ä¸–çºªåˆé€æ­¥æ™®åŠï¼Œæ ‡å¿—ç€ç§‘æŠ€çš„è´¨å˜ã€‚è¿™ç±»ç³»ç»Ÿå…·æœ‰ä¿¡æ¯ç»¼åˆèƒ½åŠ›ï¼Œèƒ½å¤Ÿè¿›è¡Œé«˜é€Ÿå¹¶è¡Œå¤„ç†ï¼Œä¸ä»…å¤§å¹…æé«˜äº†æ•°æ®å¤„ç†èƒ½åŠ›ï¼Œè¿˜æœ‰ç€é«˜ç½®ä¿¡åº¦å’Œæå¥½çš„æ‰©å±•æ€§ä¸å‡çº§èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼ŒF-35 é—ªç”µ II æˆ˜æ–—æœºå°±é‡‡ç”¨äº†æä¸ºå¤æ‚çš„ MCMï¼ˆå¤šèŠ¯ç‰‡æ¨¡å—ï¼‰å’Œ SoCï¼ˆç³»ç»Ÿçº§èŠ¯ç‰‡ï¼‰æŠ€æœ¯ï¼ŒåŒæ—¶é…å¤‡äº†é›†æˆæœºæ¶å’Œæ¶²å†·æŠ€æœ¯ï¼Œä»¥ç¡®ä¿å…¶åœ¨å„ç§æ¶åŠ£æ¡ä»¶ä¸‹çš„ç¨³å®šè¿è¡Œã€‚ æœªæ¥å±•æœ›éšç€ç§‘æŠ€çš„ä¸æ–­è¿›æ­¥ï¼Œèˆªç©ºç”µå­ç³»ç»Ÿçš„è®¾è®¡å°†æ›´åŠ æ³¨é‡è½¯ä»¶å¯†é›†å‹çš„å‘å±•è¶‹åŠ¿ï¼Œè¿™å°†ä¿ƒè¿›æ™ºèƒ½åŒ–ã€ç½‘ç»œåŒ–çš„è¶‹åŠ¿ï¼Œæœªæ¥çš„æˆ˜æ–—æœºä¸ä»…èƒ½å¤Ÿé€Ÿæˆ˜é€Ÿå†³ï¼Œä¹Ÿå°†èƒ½å¤Ÿé¢å¯¹æ›´åŠ å¤æ‚çš„æˆ˜åœºç¯å¢ƒï¼Œä¿éšœæˆ˜äº‰ä¸­çš„ä¿¡æ¯ä¼˜åŠ¿ã€‚æ•´ä½“æ¥çœ‹ï¼Œèˆªç©ºç”µå­ç³»ç»Ÿçš„è¿›æ­¥ä¸ä»…åæ˜ äº†èˆªç©ºæŠ€æœ¯çš„å‘å±•ï¼Œä¹Ÿä»£è¡¨äº†å†›äº‹æˆ˜ç•¥æ€æƒ³çš„æ¼”å˜ä¸åˆ›æ–°ã€‚ æœºè½½è®¡ç®—æœºçš„å‘å±•å†ç¨‹éšç€èˆªç©ºæŠ€æœ¯çš„ä¸æ–­è¿›æ­¥ï¼Œæœºè½½è®¡ç®—æœºçš„è®¾è®¡å’ŒåŠŸèƒ½æ—¥è¶‹ç»¼åˆåŒ–ï¼Œè¿™ç§è¶‹åŠ¿åœ¨æ–°ä¸€ä»£é£æœºèˆªç”µç³»ç»Ÿä¸­è¡¨ç°å¾—å°¤ä¸ºæ˜æ˜¾ã€‚ç»¼åˆåŒ–çš„æœ€ç»ˆç›®æ ‡æ˜¯æé«˜é£æœºçš„æ™ºèƒ½åŒ–æ°´å¹³å’Œæ“ä½œæ•ˆç‡ï¼Œä»è€Œæœ‰æ•ˆé™ä½å…¨å¯¿å‘½æˆæœ¬ã€‚ å…³é”®ç‰¹æ€§æ–°ä¸€ä»£èˆªç”µç³»ç»Ÿç»“åˆå¤šç§å…³é”®ç‰¹æ€§ï¼Œä»¥æ»¡è¶³ç°ä»£èˆªç©ºé£è¡Œçš„å¤šæ ·åŒ–éœ€æ±‚ã€‚è¿™äº›ç‰¹æ€§åŒ…æ‹¬ï¼š ä»»åŠ¡æ€§èƒ½ å¯ç”¨æ€§ï¼šç³»ç»Ÿéœ€è¦åšåˆ°åœ¨å„ç§æç«¯æƒ…å†µä¸‹ä¾ç„¶ä¿æŒé«˜æ•ˆè¿ä½œã€‚ä¾‹å¦‚ï¼ŒæŸäº›èˆªç”µç³»ç»Ÿèƒ½åœ¨ç”µåŠ›ä¸è¶³æˆ–éƒ¨åˆ†ç¡¬ä»¶æ•…éšœçš„æƒ…å†µä¸‹ç»§ç»­æ‰§è¡Œå…³é”®ä»»åŠ¡ã€‚ å¯ä¼¸ç¼©æ€§ï¼šèˆªç”µç³»ç»Ÿè¦èƒ½å¤Ÿæ–¹ä¾¿åœ°æ‰©å±•ï¼Œä»¥åŠ å…¥æ–°çš„åŠŸèƒ½æˆ–è®¾å¤‡ã€‚ä¾‹å¦‚ï¼Œåœ¨å¿«é€Ÿå‡çº§åï¼Œæ—§æœ‰ç³»ç»Ÿèƒ½å¤Ÿæ”¯æŒæ–°å‹ä¼ æ„Ÿå™¨çš„æ¥å…¥ã€‚ å¯æµ‹è¯•æ€§ï¼šå¯ä»¥é€šè¿‡å†…ç½®çš„è‡ªæµ‹è¯•åŠŸèƒ½ï¼ŒåŠæ—¶å‘ç°å¹¶éš”ç¦»ç³»ç»Ÿæ•…éšœï¼Œç¡®ä¿é£è¡Œå®‰å…¨ã€‚ å¯ç»´æŠ¤æ€§ï¼šè®¾è®¡åº”ç®€åŒ–ç»´æŠ¤ç¨‹åºï¼Œå‡å°‘åœ°é¢æ”¯æŒäººå‘˜çš„å·¥ä½œæ—¶é—´ï¼Œæå‡æŠ€æœ¯çš„å¯é æ€§ã€‚ è¿›ç¨‹éš”ç¦»æ€§ï¼šä¸åŒä»»åŠ¡ä¹‹é—´çš„å¤„ç†è¿‡ç¨‹åº”è¯¥èƒ½å¤Ÿäº’ç›¸éš”ç¦»ï¼Œä»¥å‡å°‘ç›¸äº’å¹²æ‰°çš„é£é™©ã€‚ å®‰å…¨æ€§ï¼šåº”å¯¹ç½‘ç»œå®‰å…¨å¨èƒå’Œç³»ç»Ÿæ•…éšœæä¾›ä¿éšœï¼Œä¾‹å¦‚é‡‡ç”¨å¤šé‡è®¤è¯æœºåˆ¶ã€‚ å¯ç§»æ¤æ€§ï¼šç³»ç»Ÿè®¾è®¡åº”å…è®¸åœ¨ä¸åŒå¹³å°ä¸Šè½»æ¾éƒ¨ç½²å’Œä½¿ç”¨ï¼Œä¾‹å¦‚å°†ç›¸åŒè½¯ä»¶åº”ç”¨äºä¸åŒå‹å·çš„é£æœºã€‚ è¿è¡Œæ€§èƒ½ å¼€æ”¾å¼ç»“æ„ï¼šé‡‡ç”¨å¼€æ”¾æ ‡å‡†ï¼Œä»¥ä¾¿äºä¸åŒåˆ¶é€ å•†çš„è®¾å¤‡èƒ½é¡ºåˆ©è¿æ¥å’Œé€šä¿¡ã€‚ ç³»ç»Ÿå±‚æ¬¡ç»“æ„ï¼šåˆ†å±‚è®¾è®¡ä½¿å¾—ç³»ç»Ÿæ›´å®¹æ˜“ç†è§£ã€æ‰©å±•å’Œç®¡ç†ï¼Œæ¯ä¸ªå±‚çº§å¯ä»¥ç‹¬ç«‹ç»´æŠ¤ã€‚ æ¨¡å—åŒ–ç»“æ„ï¼šå„ä¸ªéƒ¨åˆ†å¯ä»¥ç‹¬ç«‹æ›´æ¢ï¼Œæ•…éšœæ£€æµ‹å’Œç»´ä¿®å°†å˜å¾—æ›´åŠ å¿«æ·ã€‚ é«˜é€Ÿäº’è”ç»“æ„ï¼šä¸ºäº†å®ç°å¿«é€Ÿæ•°æ®ä¼ è¾“ï¼Œèˆ±å†…ç½‘ç»œéœ€è¦æ”¯æŒç™¾å…†ç”šè‡³åƒå…†é€Ÿåº¦ï¼Œè¿™å¯¹äºé£æœºçš„å„ç³»ç»Ÿåè°ƒè‡³å…³é‡è¦ã€‚ æ ‡å‡†ä¿¡æ¯ç»“æ„ï¼šç»Ÿä¸€çš„ä¿¡æ¯æ ¼å¼ç¡®ä¿ä¸åŒè®¾å¤‡ä¹‹é—´çš„é«˜æ•ˆæ•°æ®äº¤æ¢ã€‚ æ ‡å‡†é€šä¿¡åè®®ï¼šåˆ¶å®šä¸šå†…é€šç”¨çš„åè®®ï¼Œä½¿å¾—ä¸åŒè®¾å¤‡å’Œç³»ç»Ÿèƒ½å¤Ÿé¡ºç•…äº’åŠ¨ã€‚ æ ‡å‡†æ„ä»¶ï¼šæ¨è¡Œé€šç”¨ç»„ä»¶ï¼Œèƒ½æœ‰æ•ˆé™ä½ç”Ÿäº§æˆæœ¬ï¼Œä¹Ÿä½¿å¾—ç»´æŠ¤è¿‡ç¨‹æ›´ä¸ºä¾¿æ·ã€‚ å…¨å¯¿å‘½æˆæœ¬åœ¨è€ƒè™‘æœºè½½è®¡ç®—æœºçš„å‘å±•æ—¶ï¼Œå…¨å¯¿å‘½æˆæœ¬æ˜¯ä¸€ä¸ªä¸å¯å¿½è§†çš„é‡è¦æ¦‚å¿µã€‚å®ƒä¸ä»…åŒ…æ‹¬è®¾å¤‡çš„é‡‡è´­è´¹ç”¨ï¼Œè¿˜æ¶µç›–äº†è¿è¥ã€ç»´æŠ¤å’Œæœ€ç»ˆæŠ¥åºŸçš„ç›¸å…³æ”¯å‡ºã€‚é€šè¿‡æå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ã€å¯ç»´æŠ¤æ€§ç­‰ç‰¹æ€§ï¼Œå¯ä»¥ä»æ ¹æœ¬ä¸Šé™ä½æ•´ä½“çš„å…¨å¯¿å‘½æˆæœ¬ã€‚ä¾‹å¦‚ï¼Œé‡‡ç”¨é«˜åº¦å¯æµ‹è¯•å’Œå¯ç»´æŠ¤çš„è®¾è®¡ç†å¿µï¼Œä¸ä»…å‡å°‘äº†åœ°é¢ç»´æŠ¤äººå‘˜çš„å·¥ä½œé‡ï¼Œä¹Ÿæ˜¾è‘—å‡å°‘äº†æ•…éšœåœæœºæ—¶é—´ï¼Œä»è€Œä¼˜åŒ–äº†è¿è¥æ•ˆç‡å¹¶é™ä½äº†é•¿æœŸæ”¯å‡ºã€‚ é€šè¿‡è¿™äº›å…ˆè¿›çš„è®¾è®¡åŸåˆ™å’ŒæŠ€æœ¯ï¼Œä»¬èƒ½å¤Ÿæ„å»ºå‡ºæ›´å®‰å…¨ã€æ›´çµæ´»ã€æ›´å…·é€‚åº”æ€§çš„èˆªç©ºç”µå­ç³»ç»Ÿï¼Œä»¥æ»¡è¶³æœªæ¥æ—¥ç›Šå¢é•¿çš„èˆªç©ºéœ€æ±‚ã€‚ IMAä»å†›ç”¨é£æœºå‘å±•åˆ°æ°‘ç”¨é£æœºé›†æˆæ¨¡å—åŒ–æ¶æ„ï¼ˆIMAï¼‰æœ€åˆåœ¨å†›äº‹èˆªç©ºé¢†åŸŸå–å¾—äº†æ˜¾è‘—æˆæœï¼Œé€æ¸æ‰©å±•åˆ°æ°‘ç”¨èˆªç©ºã€‚ä¾‹å¦‚ï¼š F-22 ä¸ F-35ï¼šè¿™ä¸¤ç§æˆ˜æ–—æœºåˆ©ç”¨ IMA æ¶æ„å®ç°ç®€åŒ–çš„ç³»ç»Ÿé›†æˆå’Œå‡çº§ï¼Œä½¿å¾—ä»Šåçš„æŠ€æœ¯æ›´æ–°æ›´åŠ è¿…é€Ÿä¸ç»æµã€‚ A380ï¼šä½œä¸ºä¸–ç•Œä¸Šæœ€å¤§çš„å®¢æœºï¼ŒA380 é‡‡ç”¨è¯¥æ¶æ„æ”¯æŒå¤æ‚èˆªç”µç³»ç»Ÿçš„é«˜æ•ˆé›†æˆï¼Œæé«˜äº†æ•´ä¸ªé£æœºçš„ç³»ç»ŸååŒæ•ˆç‡ã€‚ B787ï¼šæ³¢éŸ³ 787 é€šè¿‡ IMA å®ç°æ›´é«˜çš„ç³»ç»Ÿé›†æˆåº¦ï¼Œå¢å¼ºäº†é£è¡Œæ€§èƒ½å¹¶é™ä½äº†è¿è¥æˆæœ¬ã€‚ ä»ç¾å›½é£æœºå‘å±•åˆ°å…¶å®ƒå›½å®¶ç¾å›½åœ¨èˆªç©ºæŠ€æœ¯é¢†åŸŸçš„å…ˆé”‹è§’è‰²ä¿ƒä½¿å…¶å®ƒå›½å®¶ä¹Ÿå¼€å§‹é‡‡ç”¨ IMAã€‚ä¾‹å¦‚ï¼š æ³•å›½ã€å¾·å›½ã€è‹±å›½çš„è”åˆé¡¹ç›®ï¼šè¿™äº›å›½å®¶çš„å†›ç”¨é£æœºæŠ€æœ¯ï¼Œå¦‚æ¬§æ´²æˆ˜æ–—æœºï¼Œå€Ÿé‰´äº†ç¾å›½çš„è®¾è®¡ç†å¿µï¼Œæ¨åŠ¨äº†é’ˆå¯¹åŒ—çº¦åŠå…¶ç›Ÿå‹çš„èˆªç©ºç³»ç»Ÿç°ä»£åŒ–ã€‚ ç‘å…¸çš„ SAAB DIMAï¼šè¿™ä¸€é¡¹ç›®å±•ç¤ºäº†ç‘å…¸åœ¨æˆ˜æ–—æœºç³»ç»Ÿé›†æˆæ–¹é¢çš„åˆ›æ–°ï¼Œå……åˆ†åˆ©ç”¨äº† IMA çš„è®¾è®¡ä¼˜ç‚¹ï¼Œæå‡äº†é£è¡Œå™¨çš„æˆ˜æ–—èƒ½åŠ›å’Œç»´æŠ¤æ•ˆç‡ã€‚ ä»å±€éƒ¨ç»¼åˆå‘å±•åˆ°å…¨å±€ç»¼åˆéšç€æŠ€æœ¯çš„å‘å±•ï¼Œèˆªç©ºç”µå­ç³»ç»Ÿçš„é›†æˆä¹Ÿå˜å¾—æ›´åŠ å…¨é¢å’Œç³»ç»ŸåŒ–ã€‚ä¾‹å¦‚ï¼š ICNISï¼ˆé›†æˆèˆªç©ºç”µå­ç³»ç»Ÿç½‘ç»œï¼‰ï¼šå®ç°äº†åœ¨é£è¡Œè¿‡ç¨‹ä¸­å¯¹é£æœºå„ç§ç³»ç»Ÿçš„å…¨é¢ç›‘æ§å’Œæ§åˆ¶ï¼ŒåŒ…æ‹¬é£è¡Œå¯¼èˆªå’Œè‡ªå«ç³»ç»Ÿã€‚ IEWSï¼ˆå¢å¼ºå‹é¢„è­¦ç³»ç»Ÿï¼‰ï¼šè¿™ä¸€ç³»ç»Ÿä¸ä»…æé«˜äº†å¨èƒæ£€æµ‹èƒ½åŠ›ï¼Œè¿˜ä¸é£æœºå…¶ä»–ç³»ç»Ÿå¦‚é€šä¿¡å’Œå¯¼èˆªç³»ç»Ÿç´§å¯†é›†æˆï¼Œæå‡äº†æ•´ä½“ä½œæˆ˜æ•ˆèƒ½ã€‚ IVMSï¼ˆæ™ºèƒ½è½¦è¾†ç®¡ç†ç³»ç»Ÿï¼‰ï¼šé€šè¿‡å¯¹é£æœºå†…éƒ¨å„ç§çŠ¶æ€çš„å®æ—¶ç›‘æµ‹ï¼Œç¡®ä¿äº†èˆªç©ºå™¨çš„é«˜æ•ˆè¿è½¬å’Œå®‰å…¨æ€§ã€‚ ä»æ–°é£æœºç»¼åˆåˆ°è€é£æœºçš„æ›´æ–°IMA çš„åº”ç”¨ä¸ä»…é™äºæ–°ä¸€ä»£é£æœºçš„å¼€å‘ï¼Œè¿˜å¹¿æ³›åº”ç”¨äºè€æ—§é£æœºçš„ç°ä»£åŒ–æ”¹é€ ã€‚ä¾‹å¦‚ï¼š F-16 EF Block 60ï¼šè¿™ä¸€å‡çº§ç‰ˆæœ¬é€šè¿‡æ•´åˆ IMA æŠ€æœ¯ï¼Œæ˜¾è‘—å¢å¼ºäº†å…¶ä¼ æ„Ÿå™¨èåˆèƒ½åŠ›å’Œä½œæˆ˜èŒƒå›´ï¼Œä½¿å¾—è€æ—§çš„æˆ˜æ–—æœºåœ¨ç°ä»£ç©ºæˆ˜ç¯å¢ƒä¸­æ›´å…·ç«äº‰åŠ›ã€‚ IMA çš„å®šä¹‰ä¸ä¼˜åŠ¿IMAï¼ˆé›†æˆåŠŸèƒ½æ¶æ„ï¼‰æ˜¯ä¸€ç§å°†ç¡¬ä»¶å’Œè½¯ä»¶èµ„æºæ•´åˆçš„ç³»ç»Ÿï¼Œè¿™äº›èµ„æºå…·æœ‰å¯å…±äº«ã€çµæ´»ã€å¯é‡ç”¨å’Œäº’æ“ä½œçš„ç‰¹æ€§ã€‚å½“è¿™äº›èµ„æºè¢«æ•´åˆåœ¨ä¸€èµ·æ—¶ï¼Œå®ƒä»¬å½¢æˆä¸€ä¸ªå¼ºå¤§çš„å¹³å°ï¼Œèƒ½å¤Ÿä¸ºåœ¨å…¶ä¸Šè¿è¡Œçš„æ‰§è¡Œé£æœºåŠŸèƒ½çš„åº”ç”¨ç¨‹åºæä¾›è®¾è®¡å’ŒéªŒè¯è¿‡çš„æœåŠ¡ã€‚è¿™äº›æœåŠ¡ä¸ä»…å…·å¤‡é¢„è®¢çš„å®‰å…¨çº§åˆ«ï¼Œè¿˜æ»¡è¶³ç‰¹å®šçš„åº”ç”¨æ€§èƒ½éœ€æ±‚ã€‚ åŠŸèƒ½ç»¼åˆä¸ç‰©ç†ç»¼åˆIMA çš„ç»¼åˆåŒ–å¥½å¤„å¯åˆ†ä¸ºä¸¤å¤§ç±»ï¼šåŠŸèƒ½ç»¼åˆå’Œç‰©ç†ç»¼åˆã€‚ åŠŸèƒ½ç»¼åˆåŠŸèƒ½ç»¼åˆé€šè¿‡é›†æˆå¤šç§åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ï¼Œæ˜¾è‘—æé«˜äº†æ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œæ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œåœ¨ç°ä»£æˆ˜æ–—æœºä¸­ï¼Œé£è¡Œæ§åˆ¶ç³»ç»Ÿã€å¯¼èˆªç³»ç»Ÿå’Œæ­¦å™¨æ§åˆ¶ç³»ç»Ÿå¯ä»¥å…±äº«ä¿¡æ¯ï¼Œä¼˜åŒ–ååº”é€Ÿåº¦å’Œå†³ç­–æ•ˆç‡ã€‚é€šè¿‡åŠŸèƒ½ç»¼åˆï¼Œé£è¡Œå‘˜èƒ½å¤Ÿåœ¨åŒä¸€ç•Œé¢ä¸Šè·å–æ‰€æœ‰å¿…è¦ä¿¡æ¯ï¼Œå¢å¼ºå…¶æ“ä½œèƒ½åŠ›ã€‚ ç‰©ç†ç»¼åˆç‰©ç†ç»¼åˆåˆ™æ¶‰åŠç¡¬ä»¶èµ„æºçš„æœ‰æ•ˆåˆ©ç”¨ï¼Œèƒ½å¤Ÿé™ä½å¼€å‘æˆæœ¬å’Œé‡å¤æˆæœ¬ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™äº›å¥½å¤„åŒ…æ‹¬ï¼š é™ä½å•ä¸ªé€šç”¨ç³»ç»Ÿçš„è®¾è®¡æˆæœ¬ï¼šé€šè¿‡è®¾è®¡å¯äº’æ¢çš„æ¨¡å—ï¼Œæ•´ä¸ªç³»ç»Ÿå¯ä»¥æ›´å¿«é€Ÿåœ°å¼€å‘å’Œè°ƒæ•´ã€‚ é™ä½æ‰©å……ä¸ç»´æŠ¤çš„é‡å¤æˆæœ¬ï¼šå½“ç³»ç»Ÿç¡¬ä»¶å’Œè½¯ä»¶æ ‡å‡†åŒ–æ—¶ï¼Œç»´æŠ¤å’Œå‡çº§å˜å¾—æ›´åŠ ç®€ä¾¿ï¼Œå‡å°‘äº†åœ¨æ·»åŠ æ–°åŠŸèƒ½æ—¶çš„èµ„æºæµªè´¹ã€‚ é™ä½ä¿®å¤æˆæœ¬ä¸æé«˜èµ·é£ç‡ï¼šä¸ä¼ ç»Ÿç³»ç»Ÿç›¸æ¯”ï¼Œé›†æˆç»„ä»¶é€šå¸¸å…·æœ‰æ›´é«˜çš„å¯é æ€§ï¼Œå› æ­¤åœ¨æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œé£æœºçš„ç»´ä¿®éœ€æ±‚å‡å°‘ï¼Œæå‡äº†ä»»åŠ¡å®Œæˆçš„æˆåŠŸç‡ã€‚ é™ä½å¤‡ä»½æˆæœ¬ï¼šå½“ä¸åŒåº”ç”¨å…±äº«ç›¸åŒçš„ç¡¬ä»¶èµ„æºæ—¶ï¼Œæ‰€éœ€å¤‡ä»½å’Œå†—ä½™éƒ¨ä»¶çš„æ•°é‡å‡å°‘ã€‚ é™ä½é‡‡è´­ä»·æ ¼ï¼šç”±äºé€šç”¨éƒ¨ä»¶å¯ä»¥ä»å¤šä¸ªä¾›åº”å•†å¤„é‡‡è´­ï¼Œå¢åŠ äº†ç«äº‰ï¼Œè¿™æœ‰åŠ©äºé™ä½å•ä¸ªéƒ¨ä»¶çš„ä»·æ ¼ã€‚ ç»¼åˆåŒ–å¸¦æ¥çš„æˆæœ¬æ•ˆç›Šé›†æˆçš„å¥½å¤„ä½“ç°ä¸ºæˆæœ¬çš„æ˜¾è‘—å‡å°‘ï¼Œæ¶µç›–è®¾è®¡ã€é‡‡è´­ã€è¿è¡Œå’Œæ›´æ–°çš„å„ä¸ªç¯èŠ‚ã€‚ä¾‹å¦‚ï¼š è®¾è®¡å’Œé‡‡è´­çš„ç®€åŒ–ï¼šå¯é‡ç”¨çš„ç¡¬ä»¶å’Œè½¯ä»¶ç»„ä»¶å¤§å¹…é™ä½äº†ä»å¤´å¼€å§‹è®¾è®¡æ–°ç³»ç»Ÿçš„éœ€æ±‚ã€‚ ä½“ç§¯ã€é‡é‡å’ŒåŠŸè€—çš„å‰Šå‡ï¼š **ä½“ç§¯å‡å°‘ 50%**ï¼šé€šè¿‡ä¼˜åŒ–ç³»ç»Ÿè®¾è®¡ï¼Œå‡å°‘ä¸å¿…è¦çš„ç‰©ç†ç©ºé—´éœ€æ±‚ï¼Œä½¿é£è¡Œå™¨åœ¨è®¾è®¡å’Œå†…éƒ¨å¸ƒå±€ä¸Šæ›´åŠ çµæ´»ã€‚ **é‡é‡å‡å°‘æ¥è¿‘ 30%**ï¼šè½»é‡åŒ–çš„ææ–™å’Œé›†æˆåŠŸèƒ½çš„è®¾è®¡ï¼Œä½¿å¾—é£æœºåœ¨é£è¡Œä¸­æ›´é«˜æ•ˆï¼Œè¿›ä¸€æ­¥æå‡äº†ç‡ƒæ²¹æ•ˆç‡å’Œè½½é‡èƒ½åŠ›ã€‚ **ç”µæºåŠŸè€—é™ä½åˆ°å¤§çº¦ 16%**ï¼šé«˜æ•ˆçš„èƒ½æºç®¡ç†ç³»ç»Ÿä½¿å¾—é£æœºåœ¨è¿è¡Œä¸­æ¶ˆè€—æ›´å°‘çš„ç”µåŠ›ï¼Œå»¶é•¿äº†ç”µæ± å’Œå‘ç”µæœºçš„ä½¿ç”¨å¯¿å‘½ã€‚ å¯é æ€§æ”¹è¿› 20 å¤šå€ï¼šé€šè¿‡å¤šæ¬¡éªŒè¯å’Œæµ‹è¯•çš„é›†æˆè®¾è®¡ï¼Œç¡®ä¿äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ï¼Œå‡å°‘äº†æ•…éšœå‘ç”Ÿçš„é¢‘ç‡ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼ŒIMA æ‰€å¸¦æ¥çš„é›†æˆæ•ˆæœä¸ä»…åœ¨æˆæœ¬ä¸Šå¸¦æ¥æ˜¾è‘—çš„ä¼˜åŠ¿ï¼Œè¿˜åœ¨é£æœºçš„æ€§èƒ½å’Œå¯é æ€§ä¸Šå®ç°äº†è´¨çš„æå‡ã€‚è¿™æ ·ä¸€æ¥ï¼Œé£è¡Œå™¨èƒ½å¤Ÿåœ¨æ‰§è¡Œå¤æ‚ä»»åŠ¡æ—¶å±•ç°æ›´é«˜çš„æ•ˆç‡å’Œå®‰å…¨æ€§ï¼Œä¹Ÿç¡®ä¿äº†å…¶åœ¨ç°ä»£èˆªç©ºé¢†åŸŸçš„ç«äº‰åŠ›ã€‚ ç»¼åˆåŒ–å¯¹æœºè½½è®¡ç®—æœºçš„ä¸¥å³»æŒ‘æˆ˜ä¸€èˆ¬çš„å›°éš¾ è®¾è®¡å¤æ‚æ€§å¢åŠ  éšç€ç³»ç»Ÿæ•´åˆç¨‹åº¦çš„æé«˜ï¼Œæœºè½½è®¡ç®—æœºçš„è®¾è®¡å˜å¾—æ›´åŠ å¤æ‚ã€‚ä¾‹å¦‚ï¼Œæ–°çš„ç»¼åˆç³»ç»Ÿå¯èƒ½éœ€è¦åŒæ—¶è€ƒè™‘å¤šä¸ªå­ç³»ç»Ÿï¼Œå¦‚å¯¼èˆªã€é€šä¿¡å’Œå¼•æ“æ§åˆ¶ï¼Œæ¯ä¸ªå­ç³»ç»Ÿéƒ½æœ‰ç‹¬ç‰¹çš„åŠŸèƒ½å’Œè¦æ±‚ã€‚è¿™ç§å¤æ‚æ€§ä¸ä»…å¢åŠ äº†è®¾è®¡çš„éš¾åº¦ï¼Œè¿˜å¯èƒ½å¯¼è‡´æ½œåœ¨çš„æŠ€æœ¯é—®é¢˜ã€‚ åˆ¶é€ ä¸æµ‹è¯•çš„å›°éš¾ ç»¼åˆåŒ–çš„è®¾è®¡ä½¿å¾—åˆ¶é€ å’Œæµ‹è¯•æµç¨‹æ›´åŠ å¤æ‚ã€‚åœ¨ç”Ÿäº§ä¸­ï¼Œä¸åŒç³»ç»Ÿçš„äº¤äº’å…³ç³»å¯èƒ½ä¼šå¯¼è‡´ç»„è£…æ—¶çš„å›°éš¾ï¼Œä¸”æ¯ä¸€ä¸ªæ¨¡å—çš„è´¨é‡æ§åˆ¶éƒ½å˜å¾—è‡³å…³é‡è¦ã€‚åŒæ—¶ï¼Œæµ‹è¯•é˜¶æ®µä¹Ÿéœ€è¦è€ƒè™‘ç³»ç»Ÿé—´çš„å…¼å®¹æ€§å’ŒååŒå·¥ä½œèƒ½åŠ›ï¼Œè¿™å¯èƒ½ä¼šå¢åŠ æµ‹è¯•æ—¶é—´å’Œæˆæœ¬ã€‚ è®¤è¯è¿‡ç¨‹çš„æŒ‘æˆ˜ è®¤è¯æ˜¯ç¡®ä¿æœºè½½è®¡ç®—æœºå®‰å…¨å’Œå¯é çš„å…³é”®ç¯èŠ‚ã€‚éšç€ç»¼åˆç³»ç»Ÿçš„å¤æ‚æ€§å¢åŠ ï¼Œè®¤è¯æµç¨‹ä¼šå˜å¾—å°¤ä¸ºç¹çï¼Œå› ä¸ºéœ€è¦è¯„ä¼°ä¸åŒç³»ç»Ÿä¹‹é—´çš„äº¤äº’å’Œé£é™©ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªé«˜åº¦ç»¼åˆçš„ç³»ç»Ÿä¸­ï¼Œä»»ä½•å­ç³»ç»Ÿçš„é”™è¯¯éƒ½å¯èƒ½å½±å“æ•´ä½“åŠŸèƒ½ï¼Œè¿™ä½¿å¾—è®¤è¯çš„æ·±åº¦å’Œå¹¿åº¦éƒ½æ˜¾è‘—æå‡ã€‚ å®æ—¶æ“ä½œç³»ç»Ÿçš„éœ€æ±‚ å¯¹äºæœºè½½è®¡ç®—æœºè€Œè¨€ï¼Œå®æ—¶æ€§èƒ½è‡³å…³é‡è¦ã€‚ç»¼åˆåŒ–ç³»ç»Ÿéœ€è¦åœ¨å¿«é€Ÿå˜åŒ–çš„ç¯å¢ƒä¸­ä½œå‡ºå¿«é€Ÿååº”ï¼Œå› æ­¤ï¼Œä¸¥æ ¼è¦æ±‚æ“ä½œç³»ç»Ÿèƒ½å¤Ÿæ‰§è¡Œä»»åŠ¡æ—¶ä¿æŒæ—¶é—´ä¸Šçš„å¯é æ€§ã€‚åŒæ—¶ï¼Œç³»ç»Ÿè¿˜éœ€å…·å¤‡éš”ç¦»ä¿æŠ¤èƒ½åŠ›ï¼Œä»¥é˜²æ­¢æ•…éšœæˆ–æ”»å‡»å½±å“åˆ°å…¶ä»–å…³é”®æ¨¡å—ã€‚ é«˜è¦æ±‚çš„æ£€é”™å®šä½èƒ½åŠ› ç»¼åˆåŒ–ç³»ç»Ÿçš„æ•…éšœè¯Šæ–­å’Œå®šä½èƒ½åŠ›éœ€è¦æå¤§æå‡ï¼Œä»¥æ»¡è¶³å¤æ‚æ“ä½œä¸­çš„å®æ—¶å“åº”ã€‚ä¾‹å¦‚ï¼Œåœ¨é£æœºé£è¡Œè¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ä¸ªå°é”™è¯¯éƒ½å¯èƒ½å¯¼è‡´é‡å¤§å®‰å…¨éšæ‚£ã€‚å› æ­¤ï¼Œæ—¶ä»£è¦æ±‚æ›´é«˜æ•ˆçš„æ•…éšœç›‘æµ‹å’Œæ’æŸ¥æœºåˆ¶ï¼Œä»¥åŠæ—¶è§£å†³æ½œåœ¨é—®é¢˜ã€‚ ç»¼åˆåŒ–çš„ä¸»è¦ç‰¹ç‚¹ èµ„æºå…±äº«ï¼ˆResource Sharingï¼‰ ç»¼åˆç³»ç»Ÿå¼ºè°ƒèµ„æºçš„å…±äº«ï¼Œè¿™è¦æ±‚è¿™äº›å…±äº«çš„èµ„æºå…·å¤‡æ›´é«˜çš„ä¿¡æ¯å¤„ç†èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œå¤šä¸ªä¼ æ„Ÿå™¨å¯èƒ½éœ€è¦å…±äº«æ•°æ®ä»¥æé«˜é£è¡Œç›‘æ§çš„ç²¾å‡†åº¦ï¼Œå› æ­¤ï¼Œå®ƒä»¬å¿…é¡»èƒ½å¤Ÿå¿«é€Ÿå¤„ç†å’Œä¼ é€’å¤§æ•°æ®é‡çš„ä¿¡æ¯ã€‚ é«˜æ•ˆé€šä¿¡èƒ½åŠ› åœ¨ç»¼åˆåŒ–ç³»ç»Ÿä¸­ï¼Œå„ä¸ªå…±äº«èµ„æºä¹‹é—´éœ€è¦å…·å¤‡é«˜æ•ˆçš„é€šä¿¡èƒ½åŠ›ï¼Œä»¥æ»¡è¶³é«˜è€¦åˆç¨‹åº¦çš„éœ€æ±‚ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œé£è¡Œæ§åˆ¶ç³»ç»Ÿä¸å¯¼èˆªç³»ç»Ÿéœ€è¦å®æ—¶å…±äº«é£è¡Œæ•°æ®ï¼Œä»¥ç¡®ä¿å¯¼èˆªçš„ç²¾å‡†åŠé£è¡Œå®‰å…¨ã€‚ è½¯ä»¶ç»“æ„çš„é€‚åº”æ€§ éšç€ç³»ç»Ÿè§„æ¨¡æ‰©å¤§å’Œå¤æ‚æ€§å¢å¼ºï¼Œè½¯ä»¶ç»“æ„å¿…é¡»èƒ½å¤Ÿåº”å¯¹å®æ—¶æ€§ã€å¯é æ€§å’Œå®‰å…¨æ€§ç­‰å¤šé‡è¦æ±‚ã€‚æ¯”å¦‚ï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿåœ¨é¢å¯¹çªå‘æƒ…å†µæ—¶çš„ç¨³å®šæ€§ï¼Œå¯ä»¥é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œä½¿å¾—å„ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹æ›´æ–°æˆ–ç»´æŠ¤ï¼Œä»è€Œé™ä½æ•´ä½“ç³»ç»Ÿçš„é£é™©ã€‚ ç»¼åˆåŒ–å¯¹æœºè½½è®¡ç®—æœºæå‡ºçš„ä¸¥å³»æŒ‘æˆ˜ä¸»è¦æŒ‘æˆ˜ï¼ˆ1ï¼‰ï¼šé«˜æ€§èƒ½çš„å¤„ç†å•å…ƒ å¤„ç†å™¨èƒ½åŠ›ï¼š F-22 çš„è®¡ç®—æœºé›†æˆå¤„ç†ï¼ˆCIPï¼‰é€Ÿåº¦ä¸º 400 ç™¾ä¸‡æŒ‡ä»¤æ¯ç§’ï¼ˆMipsï¼‰ï¼Œè€Œ F-35 çš„é›†æˆè®¡ç®—æœºå¤„ç†ï¼ˆICPï¼‰é€Ÿåº¦åˆ™æå‡è‡³ 40.8 åäº¿æŒ‡ä»¤æ¯ç§’ï¼ˆGipsï¼‰ï¼Œæå‡å¹…åº¦è¾¾åˆ° 100 å€ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨åŒæ ·çš„æ—¶é—´å†…ï¼ŒF-35 èƒ½å¤„ç†çš„è®¡ç®—é‡æ˜¯ F-22 çš„ 100 å€ï¼Œä½¿å…¶åœ¨å¤æ‚ä»»åŠ¡ä¸­å±•ç°å‡ºæ›´å¼ºçš„å¤„ç†èƒ½åŠ›ã€‚ æ¯ä¸ªæ•°æ®å¤„ç†é€»è¾‘èµ„æºæ¨¡å—ï¼ˆLRMï¼‰èƒ½å¤Ÿè¾¾åˆ°æ•°åäº¿æ¬¡è¿ç®—èƒ½åŠ›ï¼Œæ”¯æ’‘æ›´é«˜å±‚æ¬¡çš„ç³»ç»Ÿç»´æŠ¤ä»»åŠ¡ã€‚ æ–°ä¸€ä»£å¤„ç†å™¨ï¼š æ–°ä¸€ä»£ç³»ç»Ÿé‡‡ç”¨å¤šæ ¸å¤šå¤„ç†æ¶æ„ï¼Œæ¯ä¸ªé€»è¾‘èµ„æºæ¨¡å—ä¸Šé…ç½®å¤šä¸ªå¤„ç†å™¨ï¼Œé€šå¸¸ä¸º 16 æ ¸å¤„ç†å™¨ã€‚æ­¤ç§è®¾è®¡ä¸ä»…æå‡äº†å¤„ç†å™¨çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼ŒåŒæ—¶ä¹Ÿä½¿å¾—ç³»ç»Ÿèƒ½é«˜æ•ˆå¤„ç†å¤§é‡æ•°æ®ï¼Œæå‡å“åº”é€Ÿåº¦ã€‚ æ™ºèƒ½åŒ–å¤„ç†ï¼š é’ˆå¯¹å¤æ‚è®¡ç®—ä»»åŠ¡ï¼Œè¿™äº›æœºè½½è®¡ç®—æœºè¿˜é‡‡å–äº†æ™ºèƒ½å¤„ç†æŠ€æœ¯ï¼Œé…å¤‡æ™ºèƒ½å¤„ç†å™¨ï¼Œå®ç°è‡ªå­¦ä¹ å’Œé€‚åº”æ€§è®¡ç®—ã€‚è¿™ä¸€å˜åŒ–å°†æ¨åŠ¨æœºè½½è®¡ç®—æœºåœ¨é£è¡Œã€å¯¼èˆªç­‰å…³é”®é¢†åŸŸä¸­çš„æ™ºèƒ½åŒ–æ°´å¹³ï¼Œæä¾›æ›´ä¸ºç²¾å‡†çš„å†³ç­–æ”¯æŒã€‚ ä¸»è¦æŒ‘æˆ˜ï¼ˆ2ï¼‰ï¼šé«˜æ€§èƒ½çš„ç½‘ç»œ ç½‘ç»œé€Ÿåº¦ï¼š F-35 ä½¿ç”¨ 1-2Gbs çš„å…‰çº¤é€šé“ï¼ˆFCï¼‰ç½‘ç»œï¼Œæä¾›äº†é«˜å¸¦å®½çš„é€šä¿¡èƒ½åŠ›ï¼Œä½¿å¾—é£è¡Œå™¨å†…éƒ¨å„ç³»ç»Ÿé—´çš„æ•°æ®ä¼ è¾“è¿…é€Ÿè€Œå¯é ã€‚ åœ¨ä¸€èˆ¬å†›ç”¨é£æœºä¸­ï¼ŒåŸºç¡€ç½‘ç»œå¸¸å¸¸å»ºç«‹åœ¨ 4Gbs çš„å…‰çº¤é€šé“ç½‘ç»œï¼ˆFC-AEï¼‰ä¸Šï¼Œç¡®ä¿äº†å…³é”®æ•°æ®çš„ç¨³å®šä¼ è¾“ã€‚ æ°‘ç”¨èˆªç©ºä¸èˆªç”µç½‘ç»œï¼š æ°‘æœºèˆªç”µç³»ç»Ÿåˆ©ç”¨ 100Mbs çš„ ARINC664 P7 ä»¥å¤ªç½‘ç»œï¼Œå°†å…¶è½¬åŒ–ä¸ºå…¨åŒå·¥äº¤æ¢å¼ä»¥å¤ªç½‘ï¼Œæ˜¾è‘—æé«˜äº†ç³»ç»Ÿçš„å¯é æ€§å’Œç¡®å®šæ€§ï¼Œç¡®ä¿æ¯ä¸ªç³»ç»Ÿèƒ½é«˜æ•ˆåœ°è·å–æ‰€éœ€æ•°æ®ã€‚ å…ˆè¿›ç½‘ç»œæŠ€æœ¯ï¼š TTE ç½‘ç»œï¼šäº‹ä»¶è§¦å‘ä»¥å¤ªç½‘ï¼Œæ”¯æŒé«˜è¾¾ 1Gbs çš„åŒæ­¥æ•°æ®ä¼ è¾“ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“çš„é«˜ç¡®å®šæ€§ï¼Œé€‚ç”¨äºå¯¹å®æ—¶æ€§è¦æ±‚æé«˜çš„é£è¡Œæ§åˆ¶ç³»ç»Ÿã€‚ TSN ç½‘ç»œï¼šæ—¶é—´æ•æ„Ÿç½‘ç»œï¼Œèƒ½å¤Ÿæä¾› 1Gbs å’Œ 10Gbs çš„æ•°æ®ä¼ è¾“èƒ½åŠ›ï¼Œé€‚åº”å¤šç§ä¸šåŠ¡çš„åŒæ—¶é«˜æ•ˆä¼ è¾“ï¼Œé€‚åˆå¤æ‚é£è¡Œä»»åŠ¡çš„æŠ€æœ¯éœ€æ±‚ã€‚ ä¸»è¦æŒ‘æˆ˜ï¼ˆ3ï¼‰ï¼šé«˜æ€§èƒ½çš„è½¯ä»¶ è½¯ä»¶è§„æ¨¡ä¸å¤æ‚æ€§ï¼š éšç€é£è¡Œå™¨ç³»ç»Ÿçš„ç»¼åˆåŒ–ï¼Œè½¯ä»¶çš„è§„æ¨¡é€æ¸å¢å¤§ï¼ŒåŠŸèƒ½æ—¥ç›Šå¤æ‚ã€‚ä¾‹å¦‚ï¼ŒF-22 çš„æ•´ä¸ªè½¯ä»¶é…ç½®æ€»è®¡è¾¾åˆ° 1.7 ç™¾ä¸‡è¡Œæºä»£ç ï¼ˆMSLOCï¼‰ï¼Œå…¶ä¸­èˆªç©ºç”µå­è½¯ä»¶å  87%ï¼Œä¹Ÿå°±æ˜¯ 1.5 ç™¾ä¸‡è¡Œï¼Œæ¶‰åŠé›·è¾¾ã€é€šä¿¡å¯¼èˆªå¹²æ‰°ç­‰å¤šä¸ªå­ç³»ç»Ÿã€‚ F-35 çš„è½¯ä»¶é…ç½®ï¼š F-35 çš„å…¨æœºè½¯ä»¶æ€»è¡Œæ•°è¾¾åˆ° 15 ç™¾ä¸‡è¡Œï¼š æœºè½½è½¯ä»¶çº¦å  6 ç™¾ä¸‡è¡Œï¼Œå…¶ä¸­ä»»åŠ¡ç³»ç»Ÿè½¯ä»¶ä¸º 4.5 ç™¾ä¸‡è¡Œï¼Œé£è¡Œå™¨ç®¡ç†è½¯ä»¶ 1.5 ç™¾ä¸‡è¡Œã€‚ åœ°é¢å¼€å‘ï¼ˆåŒ…å«æ¨¡æ‹Ÿå™¨ï¼‰è½¯ä»¶ä¹Ÿå  6 ç™¾ä¸‡è¡Œï¼Œè¾…åŠ©æ€§è½¯ä»¶åˆ™ä¸º 3 ç™¾ä¸‡è¡Œã€‚ ç»¼åˆåŒ–å¯¹æœºè½½è®¡ç®—æœºæå‡ºçš„ä¸¥å³»æŒ‘æˆ˜æœºè½½è®¡ç®—æœºåœ¨ç°ä»£èˆªç©ºç”µå­ç³»ç»Ÿä¸­çš„è§’è‰²æ„ˆå‘é‡è¦ï¼Œç„¶è€Œï¼Œéšç€ç³»ç»Ÿç»¼åˆåŒ–ç¨‹åº¦çš„æå‡ï¼Œè¿™äº›è®¡ç®—æœºé¢ä¸´äº†å‰æ‰€æœªæœ‰çš„æŒ‘æˆ˜ã€‚ä»¥ä¸‹æ˜¯å¯¹è¿™äº›æŒ‘æˆ˜çš„è¯¦ç»†åˆ†æã€‚ è½¯ä»¶å¤æ‚æ€§å¢å¼ºå®æ—¶æ€§æœºè½½è®¡ç®—æœºå¿…é¡»æ»¡è¶³ä¸åŒç±»å‹ä»»åŠ¡çš„å®æ—¶è¦æ±‚ï¼ŒåŒ…æ‹¬å‘¨æœŸæ€§ä»»åŠ¡ã€éå‘¨æœŸæ€§ä»»åŠ¡ä»¥åŠå¶å‘ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œé£è¡Œæ§åˆ¶ç³»ç»Ÿéœ€ç¡®ä¿åœ¨é£è¡Œè¿‡ç¨‹ä¸­å®æ—¶å¤„ç†æ¥è‡ªä¼ æ„Ÿå™¨çš„æ•°æ®ï¼Œä»¥ä¾¿å‡†ç¡®è°ƒæ•´é£è¡Œå§¿æ€ï¼Œè€Œæ°”è±¡é›·è¾¾åˆ™éœ€å¿«é€Ÿæ›´æ–°å¤©æ°”ä¿¡æ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»»ä½•å»¶è¿Ÿéƒ½å¯èƒ½å±åŠé£è¡Œå®‰å…¨ï¼Œå¯¼è‡´æ— æ³•åŠæ—¶å“åº”çªå‘æƒ…å†µã€‚ å¯é æ€§ç³»ç»Ÿçš„å¯é æ€§å˜å¾—å°¤ä¸ºé‡è¦ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šç§åº”ç”¨çš„ç¯å¢ƒä¸‹ã€‚æ•…éšœçš„å½±å“å‘ˆç°å‡ºæ›´å¤æ‚çš„æ¨¡å¼ï¼Œæ¯”å¦‚ï¼Œä¸€ä¸ªæ•…éšœå¯èƒ½ä¼šå½±å“åˆ°å¤šä¸ªå¹¶è¡Œè¿è¡Œçš„åº”ç”¨ã€‚ä¸ºæ­¤ï¼Œé‡‡çº³åˆ†å¸ƒå¼å®¹é”™æœºåˆ¶æˆä¸ºå¿…è¦ï¼Œé€šè¿‡æ£€æµ‹ã€æ»¤æ³¢ã€è¯Šæ–­ã€å±è”½ã€é™çº§ã€é‡æ„å’Œæ¢å¤ç­‰æ‰‹æ®µæ¥ä¿è¯ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæœºè½½é€šä¿¡ç³»ç»Ÿä¸­ï¼Œå¦‚æœä¸€éƒ¨åˆ†è®¾å¤‡å‡ºç°æ•…éšœï¼Œç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿè¿…é€Ÿè¯†åˆ«å¹¶é‡æ„ï¼Œä»¥é¿å…æ•´ä½“é€šä¿¡ä¸­æ–­ã€‚ å®‰å…¨æ€§å®‰å…¨æ€§æŒ‘æˆ˜æºè‡ªäºå¤šä¸ªç‹¬ç«‹ä»»åŠ¡åœ¨åŒä¸€è®¡ç®—èµ„æºä¸Šçš„å…±äº«ã€‚è¿™äº›ä»»åŠ¡å¾€å¾€å…·æœ‰ä¸åŒçš„å…³é”®æ€§å’Œå®‰å…¨çº§åˆ«ã€‚ä¾‹å¦‚ï¼Œå¯¼èˆªç³»ç»Ÿä¸ä¹˜å®¢å¨±ä¹ç³»ç»ŸåŒæ—¶è¿è¡Œï¼Œå…±äº«åŒä¸€å¤„ç†å™¨ã€‚å¦‚æœå¯¼èˆªç³»ç»Ÿå—åˆ°æ”»å‡»ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²æˆ–ç³»ç»Ÿå´©æºƒï¼Œè¿›è€Œå±åŠé£è¡Œå®‰å…¨ã€‚å› æ­¤ï¼Œç¡®ä¿æ•…éšœä¸ä¼šåœ¨åº”ç”¨ä¹‹é—´ä¼ æ’­ï¼Œæ˜¯ä¿è¯æ•´ä½“ç³»ç»Ÿå®‰å…¨æ€§çš„é‡è¦è¯¾é¢˜ã€‚ ç»¼åˆåŒ–å¯¹ç³»ç»Ÿç»“æ„çš„æŒ‘æˆ˜ç»¼åˆå¼ï¼ˆå±€éƒ¨ç»¼åˆï¼‰ç³»ç»Ÿé‡‡ç”¨ç»¼åˆå¼è®¾è®¡èƒ½å¤Ÿå¤§å¹…åº¦èŠ‚çœæˆæœ¬ï¼Œæå‡èµ„æºåˆ©ç”¨ç‡ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡å°†å¤šä¸ªåº”ç”¨æ•´åˆåˆ°ä¸€ä¸ªç¡¬ä»¶å¹³å°ä¸Šï¼Œå¯ä»¥å‡å°‘è®¾å¤‡é‡‡è´­å’Œç»´æŠ¤è´¹ç”¨ã€‚ç„¶è€Œï¼Œè¿™ç§æ•´åˆå¸¦æ¥äº†æ–°çš„é£é™©ï¼Œç”±äºå„ä¸ªåº”ç”¨ä¹‹é—´äº¤äº’é¢‘ç¹ï¼Œæ•…éšœæ›´æ˜“ä¼ æ’­ï¼Œä¿¡æ¯å®‰å…¨é£é™©åŠ å¤§ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç»¼åˆåŒ–é£è¡Œç®¡ç†ç³»ç»Ÿä¸­ï¼Œå¦‚æœå¯¼èˆªåº”ç”¨å‡ºç°æ•…éšœï¼Œå¯èƒ½ä¼šå¹²æ‰°åˆ°é£è¡Œç›‘æ§å’Œè°ƒåº¦ç­‰å…¶ä»–åŠŸèƒ½ï¼Œé€ æˆå½±å“å¹¿æ³›çš„åæœã€‚ IMA ç»“æ„ç›®æ ‡ä¸ºäº†åº”å¯¹ç»¼åˆåŒ–å¸¦æ¥çš„ç»“æ„æŒ‘æˆ˜ï¼Œé›†æˆæ¨¡å—åŒ–æ¶æ„ï¼ˆIMAï¼‰åº”è¿è€Œç”Ÿã€‚å®ƒæ—¨åœ¨å®ç°å®æ—¶ã€å¯é å’Œå®‰å…¨çš„èµ„æºå…±äº«ã€‚å…±äº«çš„æ¦‚å¿µæ„å‘³ç€ä¸åŒåº”ç”¨ä¹‹é—´å¯ä»¥æœ‰æ•ˆåˆ†é…èµ„æºï¼ŒåŒ…æ‹¬å¤„ç†å™¨ã€å­˜å‚¨å™¨ã€æ•°æ®é€šé“åŠè®¾å¤‡ç­‰ã€‚è¿™ç§æ–¹å¼å…è®¸èµ„æºçš„æŒä¹…å…±äº«æˆ–åˆ†æ—¶å ç”¨ï¼Œå¢å¼ºäº†ç³»ç»Ÿçš„çµæ´»æ€§ã€‚ä¾‹å¦‚ï¼Œåˆ©ç”¨ IMA ç»“æ„æ—¶ï¼Œå¤šä¸ªåº”ç”¨å¯ä»¥åœ¨ä¸åŒæ—¶é—´æ®µä½¿ç”¨åŒä¸€å¤„ç†å™¨ï¼Œä»è€Œé™ä½èµ„æºé—²ç½®ç‡ï¼ŒåŒæ—¶ç¡®ä¿æ¯ä¸ªåº”ç”¨åœ¨å…³é”®æ—¶åˆ»éƒ½èƒ½è·å¾—è¶³å¤Ÿçš„è®¡ç®—èƒ½åŠ›ã€‚ åœ¨é¢å¯¹è¿™äº›æŒ‘æˆ˜æ—¶ï¼Œæœºè½½è®¡ç®—æœºçš„è®¾è®¡è€…ä»¬éœ€è¦ä¸æ–­æ¢ç´¢æ–°çš„æŠ€æœ¯å’Œæ–¹æ³•ï¼Œç¡®ä¿èˆªç©ºç”µå­ç³»ç»Ÿä¸ä»…æ»¡è¶³å½“å‰çš„éœ€æ±‚ï¼Œè¿˜èƒ½é€‚åº”æœªæ¥çš„å˜åŒ–ã€‚ èˆªç©ºç”µå­ç³»ç»Ÿçš„å‘å±•è¶‹åŠ¿ARINC653 ç®€ä»‹ARINC653 æ˜¯èˆªç©ºç”µå­ç³»ç»Ÿä¸­ä¸å¯æˆ–ç¼ºçš„æ ‡å‡†ï¼Œæ—¨åœ¨ä¸ºæœºè½½æ“ä½œç³»ç»Ÿæä¾›å¯é çš„æ¡†æ¶ã€‚è‡ª 1997 å¹´é¦–æ¬¡æå‡ºä»¥æ¥ï¼Œè¯¥æ ‡å‡†å·²ç»ç»å†äº†å¤šä¸ªç‰ˆæœ¬çš„å‘å±•ï¼Œç›®å‰å·²çº³å…¥ä¸­å›½å†›ç”¨æ ‡å‡† GJB5357-2005ã€‚è¿™æ ‡å¿—ç€å®ƒåœ¨ä¸åŒé¢†åŸŸçš„å¹¿æ³›åº”ç”¨å’Œå¯¹ç³»ç»Ÿçš„å½±å“åŠ›ã€‚ ç»¼åˆåŒ–å¯¹æœºè½½æ“ä½œç³»ç»Ÿçš„éœ€æ±‚éšç€èˆªç©ºç”µå­è®¾å¤‡çš„å¤æ‚æ€§å¢åŠ ï¼Œé›†æˆåº¦ä¹Ÿéšä¹‹æå‡ã€‚èˆªç©ºå…¬å¸å’Œåˆ¶é€ å•†ä»¬å¸Œæœ›é€šè¿‡ç»¼åˆåŒ–ç³»ç»Ÿæ¥å‡å°‘æœºè½½è®¾å¤‡çš„æˆæœ¬ï¼ŒåŒæ—¶é™ä½ç³»ç»Ÿçš„é‡é‡ã€ä½“ç§¯ä¸åŠŸè€—ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼Œå¿…é¡»é«˜æ•ˆåˆ©ç”¨è®¡ç®—èµ„æºï¼Œè¿™ä¿ƒä½¿äº†å¤šä»»åŠ¡åœ¨å•ä¸ª CPU ä¸ŠåŒæ—¶è¿è¡Œçš„éœ€è¦ï¼Œè¿™æ­£æ˜¯ ARINC653 æ‰€è§£å†³çš„æ ¸å¿ƒé—®é¢˜ä¹‹ä¸€ã€‚ å¤©è„‰åµŒå…¥å¼å®æ—¶æ“ä½œç³»ç»Ÿå¤©è„‰åµŒå…¥å¼å®æ—¶æ“ä½œç³»ç»Ÿæ˜¯ç»“åˆ ARINC653 è§„èŒƒè€Œç”Ÿçš„åˆ›æ–°ï¼Œå…·å¤‡å¼ºå¤§çš„å®æ—¶è®¡ç®—èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ»¡è¶³èˆªç©ºç”µå­ç³»ç»Ÿçš„é«˜è¦æ±‚ã€‚ä¾‹å¦‚ï¼Œå¤©è„‰ç³»ç»Ÿå¯ä»¥åœ¨é£è¡Œå™¨çš„å¯¼èˆªå’Œæ§åˆ¶ç³»ç»Ÿä¸­å¤„ç†æ¥è‡ªå¤šä¸ªä¼ æ„Ÿå™¨çš„æ•°æ®ï¼Œä¿è¯åœ¨å…³é”®æ—¶åˆ»æä¾›ç²¾ç¡®åé¦ˆã€‚ ARINC653 è§„èŒƒè§£ææŠ€æœ¯æ¨åŠ¨ä¸éœ€æ±‚ç‰µå¼• è®¡ç®—æœºæŠ€æœ¯é£é€Ÿå‘å±•ï¼š90 å¹´ä»£æœ«ï¼ŒCPU çš„æ€§èƒ½ç›¸æ¯” 80 å¹´ä»£æœ‰äº†æ˜¾è‘—æå‡ã€‚å°å‹ CPU çš„å¤„ç†èƒ½åŠ›å¼€å§‹å¯ä»¥æ›¿ä»£ä»¥å¾€éœ€è¦å¤§å‹æœºæ‰èƒ½å®Œæˆçš„ä»»åŠ¡ã€‚è¿™ç§æŠ€æœ¯è¿›æ­¥ä¸ºèˆªç©ºç”µå­ç³»ç»Ÿçš„å¤æ‚æ€§å¥ å®šäº†åŸºç¡€ã€‚ è¡Œä¸šéœ€æ±‚ï¼šç»¼åˆåŒ–èˆªç©ºç”µå­ç³»ç»Ÿçš„è¶‹åŠ¿è¦æ±‚æ›´å¤šçš„åŠŸèƒ½æ±‡èšäºæ›´å°‘çš„è®¾å¤‡ä¸­ï¼Œè¿™å¯¼è‡´äº†å¯¹èµ„æºå…±äº«çš„è¿«åˆ‡éœ€æ±‚ã€‚æ¯”å¦‚ï¼Œç°ä»£é£æœºå¯èƒ½æœ‰å¤šä¸ªç³»ç»ŸåŒæ—¶åœ¨è¿è¡Œï¼Œä»å¯¼èˆªåˆ°é€šè®¯ï¼Œå„ç³»ç»Ÿä¹‹é—´å¯¹èµ„æºçš„ç«äº‰å˜å¾—å°¤ä¸ºå…³é”®ã€‚ é¢ä¸´çš„æ–°é—®é¢˜åœ¨èµ„æºå…±äº«èƒŒæ™¯ä¸‹ï¼Œæ–°é—®é¢˜éšä¹‹äº§ç”Ÿï¼š ä»»åŠ¡é—´å¹²æ‰°ï¼šä¼ ç»Ÿçš„â€è”åˆå¼â€èˆªç©ºç”µå­ç³»ç»Ÿä¸­ï¼Œå„ä¸ªä»»åŠ¡æœ‰ç‹¬ç«‹çš„è®¡ç®—èµ„æºï¼Œé‡‡ç”¨ç‰©ç†éš”ç¦»é˜²æ­¢å¹²æ‰°ã€‚ç„¶è€Œï¼Œéšç€é«˜åº¦å…±äº«è®¡ç®—èµ„æºçš„éœ€æ±‚ä¸Šå‡ï¼Œå¦‚ä½•ç¡®ä¿ä¸åŒä»»åŠ¡ä¸äº’ç›¸å½±å“å°±æˆäº†å¤§é—®é¢˜ã€‚ è§£å†³æ–¹æ¡ˆï¼šARINC653 çš„åˆ†åŒºæ¦‚å¿µARINC653 æå‡ºäº†â€åˆ†åŒºâ€æ¦‚å¿µï¼Œä»¥æœ‰æ•ˆéš”ç¦»ä»»åŠ¡ï¼Œç¡®ä¿ä¸€ä¸ªä»»åŠ¡çš„è¿è¡Œé”™è¯¯ä¸ä¼šå½±å“åˆ°å…¶ä»–ä»»åŠ¡ã€‚æ¯”å¦‚ï¼ŒæŸä¸ªå¯¼èˆªç³»ç»Ÿçš„æ•…éšœä¸ä¼šå½±å“åˆ°é€šä¿¡ç³»ç»Ÿçš„æ­£å¸¸åº”ç­”ã€‚ é™ä½æµ‹è¯•ä¸éªŒè¯çš„æˆæœ¬é€šè¿‡å¼•å…¥åˆ†åŒºï¼Œå„ä»»åŠ¡ä¹‹é—´å®ç°äº†â€éš”ç¦»â€ï¼Œè¿™ä½¿å¾—æµ‹è¯•å’ŒéªŒè¯å¯ä»¥æ ¹æ®ä¸åŒçš„é‡è¦æ€§çº§åˆ«è¿›è¡Œã€‚å‡è®¾æœ‰ä¸€ä¸ªä»»åŠ¡æ˜¯ç”¨äºç´§æ€¥åˆ¶åŠ¨ï¼Œå¦ä¸€ä¸ªæ˜¯ç”¨äºå¨±ä¹ç³»ç»Ÿï¼Œè¿™ä¸¤ä¸ªä»»åŠ¡å¯ä»¥åœ¨ä¸åŒçš„åˆ†åŒºä¸­ç‹¬ç«‹è¿›è¡Œæµ‹è¯•ï¼Œå„è‡ªçš„å®¡æ ¸æ ‡å‡†ä¹Ÿä¸å¿…ç»Ÿä¸€ï¼Œæé«˜äº†æ•ˆç‡ã€‚ ARINC653 è§„èŒƒçš„ä¸»è¦ç‰¹å¾å®æ—¶ç³»ç»Ÿçš„ç¡®å®šæ€§å®æ—¶ç³»ç»Ÿæœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€æ˜¯å…¶æ—¶é—´ç¡®å®šæ€§ï¼Œå³ä¸ä»…è¦æ±‚è®¡ç®—ç»“æœçš„å‡†ç¡®æ€§ï¼Œæ›´éœ€è¦ç»“æœäº§ç”Ÿçš„æ—¶æ•ˆæ€§ã€‚ARINC653 é€šè¿‡ä¸¤çº§ä»»åŠ¡è°ƒåº¦æœºåˆ¶ï¼ˆåˆ†åŒºè°ƒåº¦ä¸è¿›ç¨‹è°ƒåº¦ï¼‰æ¥ç¡®ä¿å®æ—¶æ€§èƒ½ã€‚ å¥åº·ç›‘æ§æœºåˆ¶ä¸ºäº†ä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§å’Œä¾¿äºç»´æŠ¤ï¼ŒARINC653 å¼•å…¥äº†å¥åº·ç›‘æ§æœºåˆ¶ã€‚è¿™ä¸ªæœºåˆ¶è´Ÿè´£ç›‘æ§åº”ç”¨è½¯ä»¶ã€æ“ä½œç³»ç»Ÿä»¥åŠç¡¬ä»¶çš„å¥åº·çŠ¶æ€ï¼ŒåŠæ—¶æŠ¥å‘Šæ•…éšœï¼Œå¸®åŠ©éš”ç¦»é—®é¢˜ï¼Œé¿å…æ•…éšœçš„æ‰©æ•£ã€‚ä¾‹å¦‚ï¼Œå½“æŸä¸ªä¼ æ„Ÿå™¨å‡ºç°æ•…éšœæ—¶ï¼Œç³»ç»Ÿå¯è¿…é€Ÿé‡‡å–æªæ–½ï¼Œç»§ç»­ç¡®ä¿é£è¡Œå®‰å…¨ã€‚ é€šè¿‡ç»“åˆæŠ€æœ¯è¿›æ­¥å’Œè¡Œä¸šéœ€æ±‚ï¼ŒARINC653 ä¸ä»…ä¸ºèˆªç©ºç”µå­ç³»ç»Ÿæä¾›äº†æ›´é«˜çš„å¯é æ€§å’Œå®‰å…¨æ€§ï¼Œä¹Ÿæå¤§åœ°æ¨åŠ¨äº†èˆªç©ºé¢†åŸŸçš„æŠ€æœ¯åˆ›æ–°å’Œå‘å±•ã€‚ ARINC653 ç®€ä»‹ARINC653 æ ‡å‡†ARINC653 æ˜¯ä¸€ç§èˆªç©ºç”µå­ç³»ç»Ÿçš„æ ‡å‡†ï¼Œä¸»è¦ç”¨äºç¡®ä¿èˆªç©ºèˆªå¤©åº”ç”¨çš„è½¯ä»¶å’Œç³»ç»Ÿçš„å¯é æ€§ä¸å®‰å…¨æ€§ã€‚å®ƒæ¶µç›–ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼š åˆ†åŒºç®¡ç†ï¼ˆPartition Managementï¼‰åˆ†åŒºç®¡ç†å…è®¸ç³»ç»Ÿåœ¨ä¸åŒçš„åŠŸèƒ½æ¨¡å—ä¹‹é—´è¿›è¡Œèµ„æºçš„åˆç†åˆ†é…å’Œéš”ç¦»ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å®ç°å¤šä¸ªåº”ç”¨ç¨‹åºå®‰å…¨ã€ç¨³å®šåœ°è¿è¡Œåœ¨åŒä¸€ç¡¬ä»¶å¹³å°ä¸Šï¼Œé¿å…ç”±äºä¸€ä¸ªåº”ç”¨çš„å´©æºƒå½±å“åˆ°å…¶ä»–åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œèˆªç”µç³»ç»Ÿçš„é£è¡Œæ§åˆ¶å’Œé€šä¿¡å¯¼èˆªç­‰ä¸åŒåˆ†åŒºå¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä»è€Œæé«˜æ•´ä¸ªç³»ç»Ÿçš„é²æ£’æ€§ã€‚ è¿›ç¨‹ç®¡ç†ï¼ˆProcess Managementï¼‰æ­¤éƒ¨åˆ†å®šä¹‰äº†è¿›ç¨‹çš„åˆ›å»ºã€è°ƒåº¦å’Œç»ˆæ­¢ç­‰è¡Œä¸ºï¼Œä»¥ç¡®ä¿æ“ä½œç³»ç»Ÿèƒ½å¤Ÿé«˜æ•ˆå¤„ç†å¤šä¸ªä»»åŠ¡ã€‚è‰¯å¥½çš„è¿›ç¨‹ç®¡ç†å¯æé«˜ç³»ç»Ÿå“åº”é€Ÿåº¦ï¼Œæ”¯æŒå…³é”®ä»»åŠ¡çš„å®æ—¶å¤„ç†ã€‚ä¾‹å¦‚ï¼Œåœ¨é£è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯¼èˆªä¸é¿éšœçš„è¿›ç¨‹éœ€è¦ç¡®ä¿å…¶å»¶è¿Ÿæœ€å°ï¼Œä»¥å¿«é€Ÿå“åº”å¤–éƒ¨ç¯å¢ƒçš„å˜åŒ–ã€‚ æ—¶é—´ç®¡ç†ï¼ˆTime Managementï¼‰æ—¶é—´ç®¡ç†è§„å®šäº†ç³»ç»Ÿå†…çš„æ—¶é—´è°ƒåº¦ä¸åŒæ­¥æœºåˆ¶ã€‚è¿™ç¡®ä¿äº†ç³»ç»Ÿä¸­å„ä¸ªåˆ†åŒºèƒ½å¤Ÿä»¥ä¸¥æ ¼çš„æ—¶é—´çº¦æŸæ‰§è¡Œä»»åŠ¡ï¼Œå°¤å…¶é‡è¦çš„æ˜¯ï¼Œåœ¨èˆªç©ºç”µå­åº”ç”¨ä¸­ï¼Œä»»ä½•å»¶è¿Ÿéƒ½å¯èƒ½å¯¼è‡´å®‰å…¨éšæ‚£ã€‚ä¾‹å¦‚ï¼Œåœ¨é£è¡Œæ§åˆ¶ä¸­ï¼Œå®æ—¶æ•°æ®å¤„ç†çš„æ—¶é—´ç²¾åº¦è‡³å…³é‡è¦ï¼Œä»¥ç¡®ä¿é£è¡Œå™¨çš„æœ‰æ•ˆæ§åˆ¶ã€‚ å­˜å‚¨å™¨ç®¡ç†ï¼ˆMemory Managementï¼‰å­˜å‚¨å™¨ç®¡ç†æ¶‰åŠåˆ°åœ¨åˆ†åŒºä¹‹é—´çš„å†…å­˜åˆ†é…ä¸ä¿æŠ¤ã€‚é€šè¿‡æœ‰æ•ˆçš„å†…å­˜ç®¡ç†ï¼Œç³»ç»Ÿå¯ä»¥é˜²æ­¢ä¸€ä¸ªåˆ†åŒºå¯¹å¦ä¸€ä¸ªåˆ†åŒºçš„å¹²æ‰°ï¼Œä»è€Œæå‡æ•´ä½“å®‰å…¨æ€§ã€‚åœ¨ä¸€ä¸ªèˆªç”µç³»ç»Ÿä¸­ï¼Œå›¾åƒå¤„ç†å’Œå¯¼èˆªè®¡ç®—éœ€è¦åˆ†åˆ«å­˜å‚¨å’Œç®¡ç†å…¶æ•°æ®ï¼Œä»¥é¿å…ç”±äºèµ„æºç«äº‰å¯¼è‡´çš„ç³»ç»Ÿä¸ç¨³å®šã€‚ é€šè®¯ï¼ˆCommunicationsï¼‰åˆ†åŒºå†…é€šè®¯åˆ†åŒºå†…é€šè®¯ç¡®ä¿ä¸åŒæ¨¡å—ä¹‹é—´çš„æ•°æ®äº¤æ¢å¯ä»¥é¡ºç•…è¿›è¡Œã€‚ä¾‹å¦‚ï¼Œé£è¡Œæ•°æ®ä¸å¯¼èˆªä¿¡æ¯çš„å®æ—¶å…±äº«ã€‚ åˆ†åŒºå¤–é€šè®¯åˆ†åŒºå¤–é€šè®¯åˆ™å…è®¸ç³»ç»Ÿä¸å¤–éƒ¨è®¾å¤‡æˆ–è€…å…¶ä»–ç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œä»¥è·å–å¤–éƒ¨ä¿¡æ¯å¹¶è¿›è¡Œç›¸åº”å¤„ç†ã€‚è¿™ç§èƒ½åŠ›åœ¨å¤æ‚çš„èˆªç©ºä»»åŠ¡ä¸­å°¤ä¸ºé‡è¦ï¼Œæ¯”å¦‚ä¸åœ°åŸºæ§åˆ¶ä¸­å¿ƒè¿›è¡ŒçŠ¶æ€æ›´æ–°ã€‚ å¥åº·ç›‘æ§ï¼ˆHealth Monitoringï¼‰å¥åº·ç›‘æ§ç³»ç»Ÿå¸®åŠ©æ£€æµ‹å’Œè¯„ä¼°æœºè½½ç³»ç»Ÿçš„æ•´ä½“å¥åº·çŠ¶æ€ï¼Œå®æ—¶åæ˜ å¯èƒ½å‡ºç°çš„æ•…éšœã€‚è¿™å¯ä»¥é€šè¿‡ç›‘æ§è½¯ä»¶ä¸ç¡¬ä»¶çš„çŠ¶æ€æ¥å®ç°ï¼ŒåŠæ—¶å‘ç°é—®é¢˜å¹¶é‡‡å–æªæ–½ã€‚ä¾‹å¦‚ï¼Œåœ¨é£è¡Œä¸­ï¼Œç³»ç»Ÿä¼šæŒç»­ç›‘æ§å‘åŠ¨æœºçš„æ¸©åº¦å’Œå‹åŠ›ç­‰é‡è¦å‚æ•°ã€‚ ç»¼åˆåŒ–å¯¹æœºè½½æ“ä½œç³»ç»Ÿçš„éœ€æ±‚å¤©è„‰åµŒå…¥å¼å®æ—¶æ“ä½œç³»ç»Ÿåº”ç”¨æƒ…å†µé«˜å®‰å…¨æ€§çš„å®æ—¶æ“ä½œç³»ç»Ÿï¼ˆRTOSï¼‰é€æ¸æˆä¸ºæ»¡è¶³ ARINC653 æ¥å£æ ‡å‡†çš„ä¸»æµé€‰æ‹©ã€‚è¿™æ˜¯å› ä¸ºèˆªç©ºç”µæ°”ç³»ç»Ÿçš„å¤æ‚æ€§å’Œå¯¹ä»»åŠ¡ç®¡ç†çš„é«˜è¦æ±‚ï¼Œéœ€è¦æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿…é€Ÿå“åº”å˜åŒ–å¹¶ä¿è¯å„ç³»ç»Ÿæ¨¡å—çš„ç¨³å®šè¿è¡Œã€‚ ä¾‹å¦‚ï¼Œå¤©è„‰åµŒå…¥å¼å®æ—¶æ“ä½œç³»ç»Ÿé€šè¿‡é«˜æ•ˆçš„ä»»åŠ¡è°ƒåº¦å’Œåˆ†åŒºç®¡ç†èƒ½åŠ›ï¼Œæ”¯æŒé£è¡Œæ§åˆ¶ã€å¯¼èˆªã€é€šä¿¡ç­‰å…³é”®åŠŸèƒ½çš„ç‹¬ç«‹æ€§å’Œå†—ä½™ï¼Œæˆä¸ºç°ä»£èˆªç”µç³»ç»Ÿçš„é‡è¦åŸºç¡€ã€‚ ç»¼åˆæ ¸å¿ƒå¤„ç†æœºç¡¬ä»¶å¹³å°åœ¨ç»¼åˆæœºè½½æ“ä½œç³»ç»Ÿæ¶æ„ä¸­ï¼Œä½¿ç”¨äº†ä¸“ç”¨çš„æ ¸å¿ƒå¤„ç†æœºç¡¬ä»¶å¹³å°ï¼Œå…·å¤‡å®æ—¶å®¹é”™å’Œåˆ†å¸ƒå¼ç³»ç»Ÿæ”¯æŒã€‚è¿™ä¸€å¹³å°é€šå¸¸ç”±å¤šä¸ªä¸“ç”¨è®¡ç®—æœºç»„æˆï¼Œè¿æ¥äº† 1553B æ€»çº¿ï¼Œç¡®ä¿æ•°æ®çš„å¿«é€Ÿä¼ è¾“ä¸å¤„ç†ã€‚ å¯¹äºèˆªç©ºåº”ç”¨è€Œè¨€ï¼Œæ€§èƒ½å¯é çš„ç¡¬ä»¶å¹³å°æ˜¯å®æ–½å¤æ‚ä»»åŠ¡å¤„ç†çš„å…³é”®ï¼Œèƒ½å¤Ÿæ”¯æŒä»ä¼ æ„Ÿå™¨æ•°æ®å¤„ç†åˆ°é£è¡Œæ§åˆ¶ç­‰å„ç§åº”ç”¨çš„æ— ç¼æ•´åˆã€‚ ä»»åŠ¡è½¯ä»¶ç»¼åˆæ ¸å¿ƒå¤„ç†æœºçš„è½¯ä»¶å¹³å°åŒ…ç½—ä¸‡è±¡ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š ä¼ æ„Ÿå™¨ä¿¡æ¯èåˆï¼šç”¨äºæ•´åˆæ¥è‡ªå¤šä¸ªä¼ æ„Ÿå™¨çš„æ•°æ®æå‡ä¿¡æ¯çš„å‡†ç¡®æ€§ã€‚ å¯¼å¼¹å‘å°„ç”³è¯·ï¼šæ§åˆ¶æ­¦å™¨å‘å°„æ—¶æœºå’Œå®‰å…¨ã€‚ å›¾åƒèåˆå¤„ç†ï¼šå°†ä¸åŒæ¥æºçš„å›¾åƒè¿›è¡Œåˆæˆï¼Œæå‡ç›‘æ§æ•ˆæœã€‚ è‡ªåŠ¨ç›®æ ‡æç¤ºï¼šé€šè¿‡ç®—æ³•æå‡ç›®æ ‡è¯†åˆ«å‡†ç¡®åº¦å’Œé€Ÿåº¦ã€‚ è¿™ç±»ç³»ç»Ÿä¸ä»…é™äºé›·è¾¾æˆ–é€šä¿¡å¯¼èˆªè¯†åˆ«ï¼Œè¿˜æ¶‰åŠç”µå­æˆ˜ä¸­çš„ä¿¡å·å¤„ç†å’Œæ•°æ®ç®¡ç†ï¼Œä¸ºç°ä»£ç©ºä¸­ä½œæˆ˜æä¾›äº†å…¨é¢çš„æ”¯æŒã€‚ ç‹¬ç«‹çš„å­ç³»ç»Ÿåœ¨å¤æ‚çš„æœºè½½ç³»ç»Ÿä¸­ï¼Œç‹¬ç«‹çš„å­ç³»ç»Ÿè§’è‰²æ—¥ç›Šå‡¸æ˜¾ã€‚å„è‡ªç‹¬ç«‹çš„è®¡ç®—æœºå’Œæ§åˆ¶æ¨¡å—èƒ½å¤Ÿåœ¨æç«¯æ¡ä»¶ä¸‹ä¿æŒä»»åŠ¡çš„è¿ç»­æ€§å’Œç¨³å®šæ€§ã€‚ä¾‹å¦‚ï¼Œèˆªè¡Œç³»ç»Ÿå¯ä»¥åœ¨ä¸å¹²æ‰°æ­¦å™¨æ§åˆ¶ç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼Œç‹¬ç«‹å®ç°é£è¡Œè·¯å¾„çš„è®¡ç®—å’Œè°ƒæ•´ã€‚ ç»¼åˆåŒ–æ¦‚å¿µâ€”-è®¡ç®—æœºåº”ç”¨è½¯ä»¶ç»¼åˆé€šè¿‡ç»¼åˆæ ¸å¿ƒå¤„ç†æœºç¡¬ä»¶å’Œè½¯ä»¶å¹³å°ï¼Œæ„å»ºå‡ºä¸€ä¸ªé«˜æ•ˆä¸”çµæ´»çš„æœºè½½æ“ä½œç³»ç»Ÿï¼Œä¸ºæ—¥ç›Šå¢é•¿çš„èˆªç©ºç”µæ°”éœ€æ±‚æä¾›æ”¯æŒã€‚è¿™æ ·çš„å¹³å°èƒ½å¤Ÿå¤„ç†æ›´å¤šçš„åŠŸèƒ½æ¨¡å—ï¼Œå¤„ç†æ›´å¤æ‚çš„ä»»åŠ¡ï¼Œæœ‰æ•ˆåº”å¯¹æœªæ¥èˆªç©ºæŠ€æœ¯çš„æŒ‘æˆ˜ã€‚ ç»¼åˆåŒ–å¯¹æœºè½½æ“ä½œç³»ç»Ÿçš„éœ€æ±‚åœ°é¢å¼€å‘ç¯å¢ƒç°ä»£æœºè½½æ“ä½œç³»ç»Ÿçš„å‘å±•éœ€è¦åœ¨å¤šæ¨¡å—çš„ç¡¬ä»¶æ¡†æ¶å†…è¿ä½œã€‚è¿™äº›ç¡¬ä»¶é€šå¸¸æ•°é‡ä¼—å¤šï¼Œç§ç±»ç¹å¤šï¼Œæ¯ä¸€ä¸ªç»„ä»¶éƒ½è‡´åŠ›äºå®ç°é«˜å®‰å…¨æ€§å’Œå®æ—¶æ€§ï¼Œæä¾›å®¹é”™æœºåˆ¶ï¼Œå¹¶å…·å¤‡åˆ†å¸ƒå¼æ“ä½œèƒ½åŠ›ã€‚ é«˜å®‰å…¨å®æ—¶å®¹é”™åˆ†å¸ƒå¼æ“ä½œç³»ç»Ÿè¿™ç§æ“ä½œç³»ç»Ÿæ˜¯æœºè½½è®¾å¤‡çš„æ ¸å¿ƒï¼Œèƒ½å¤Ÿæ”¯æŒå¤šä¸ªä»»åŠ¡è½¯ä»¶æ¨¡å—ï¼Œä¾‹å¦‚ï¼š å„ç§ä¼ æ„Ÿå™¨ä¿¡æ¯èåˆï¼šå°†æ¥è‡ªä¸åŒä¼ æ„Ÿå™¨çš„æ•°æ®æ•´åˆï¼Œæé«˜æ€åŠ¿æ„ŸçŸ¥ã€‚ å¯¼å¼¹å‘å°„ç”³è¯·åŠæ§åˆ¶ï¼šç¡®ä¿å‘å°„æµç¨‹çš„å®‰å…¨æ€§ä¸å®æ—¶å“åº”ã€‚ å›¾è±¡èåˆå¤„ç†ï¼šé€šè¿‡å¤šè§†å›¾èåˆæå–æ›´å®Œæ•´çš„ä¿¡æ¯ã€‚ è‡ªåŠ¨ç›®æ ‡æç¤ºã€æ— æºæµ‹è·ï¼šæœ‰æ•ˆè¯†åˆ«å’Œè®¡ç®—ç›®æ ‡è·ç¦»ã€‚ ä»»åŠ¡è¯„ä¼°ä¸æˆ˜æœ¯ç®¡ç†ï¼šæä¾›æˆ˜åœºç¯å¢ƒä¸‹çš„å†³ç­–æ”¯æŒã€‚ åµŒå…¥åŸ¹è®­ä¸å“åº”ç®¡ç†ï¼šé€šè¿‡æ¨¡æ‹Ÿè®­ç»ƒæå‡é£è¡Œå‘˜æŠ€èƒ½ã€‚ æ¯ä¸ªæ¨¡å—çš„è®¾è®¡éƒ½ä½¿å¾—æ“ä½œç³»ç»Ÿèƒ½å¤Ÿåº”å¯¹å¤æ‚çš„æˆ˜åœºç¯å¢ƒï¼Œç¡®ä¿ä¿¡æ¯çš„å¿«é€Ÿå¤„ç†å’Œå“åº”ã€‚ é›·è¾¾ä¸ç”µå­æˆ˜çš„æ•´åˆå¯¹äºæœºè½½ä½œæˆ˜ç³»ç»Ÿæ¥è¯´ï¼Œé›·è¾¾å’Œç”µå­æˆ˜çš„é«˜æ•ˆæ•´åˆè‡³å…³é‡è¦ã€‚ä¾‹å¦‚ï¼Œé›·è¾¾ç³»ç»Ÿä¸ä»…éœ€è¦è¿›è¡Œä¿¡å·å¤„ç†å’Œæ•°æ®å¤„ç†ï¼Œè¿˜éœ€å…·å¤‡é›·è¾¾ç®¡ç†åŠŸèƒ½ã€‚é€šè¿‡å®æ—¶æ•°æ®åˆ†æï¼Œç³»ç»Ÿèƒ½å¤Ÿè¿…é€Ÿè¯†åˆ«å¨èƒå¹¶è¿›è¡Œå“åº”ã€‚ åŒæ ·ï¼Œåœ¨ç”µå­æˆ˜æ¨¡å—ä¸­ï¼Œä¿¡å·å¤„ç†ä¸ç”µå­æˆ˜ç®¡ç†çš„ç»“åˆï¼Œèƒ½å¤Ÿåœ¨å¯¹æŠ—æ•Œæ–¹ç”µå­å¹²æ‰°æ—¶ï¼Œä¿æŒè‡ªèº«ä¿¡æ¯çš„å®‰å…¨ä¸å®Œæ•´ã€‚ é€šä¿¡å¯¼èˆªçš„å…³é”®è§’è‰²é€šä¿¡ã€å¯¼èˆªå’Œè¯†åˆ«ç³»ç»Ÿï¼ˆCNIï¼‰çš„æœ‰æ•ˆç®¡ç†å¯¹äºæœºè½½æ“ä½œè‡³å…³é‡è¦ã€‚è¿™äº›ç³»ç»Ÿéœ€è¦è¿›è¡Œå®æ—¶ä¿¡å·å¤„ç†å’Œæ•°æ®åˆ†æï¼Œä»¥ç¡®ä¿èˆªè¡Œçš„å‡†ç¡®æ€§å’Œå®‰å…¨æ€§ï¼ŒåŒ…æ‹¬ï¼š å‰è§†çº¢å¤–æ¢æµ‹å™¨ï¼šå®æ—¶ç›‘æ§ä¸ç›®æ ‡æµ‹å‘ï¼Œå¸®åŠ©é£è¡Œå‘˜è·å¾—å‘¨è¾¹ç¯å¢ƒä¿¡æ¯ã€‚ åˆ†å¸ƒå¼çº¢å¤–ä¼ æ„Ÿå™¨ï¼šæä¾›å…¨é¢çš„æ€åŠ¿æ„ŸçŸ¥å’Œå¯¼å¼¹å¨èƒå‘Šè­¦ã€‚ å¤©è„‰åµŒå…¥å¼å®æ—¶æ“ä½œç³»ç»Ÿçš„åº”ç”¨å¤©è„‰ç³»åˆ—åµŒå…¥å¼å®æ—¶æ“ä½œç³»ç»Ÿä»£è¡¨äº†å½“å‰æœºè½½æ“ä½œç³»ç»Ÿçš„é«˜æ°´å¹³å‘å±•ï¼Œå…·å¤‡å®Œå…¨è‡ªä¸»çŸ¥è¯†äº§æƒã€‚å¤©è„‰æ“ä½œç³»ç»Ÿçš„ç‰¹å¾åŒ…æ‹¬ï¼š é«˜å®‰å…¨æ€§ä¸é«˜å¯é æ€§ï¼šåœ¨å†›äº‹ä»»åŠ¡ä¸­å¯¹äºç³»ç»Ÿå®‰å…¨æ€§çš„æé«˜è¦æ±‚ã€‚ å¼ºå®æ—¶æ€§èƒ½ï¼šä¿è¯ç³»ç»Ÿèƒ½å¤Ÿåœ¨æçŸ­æ—¶é—´å†…å¤„ç†ç´§æ€¥æƒ…å†µã€‚ å¤©è„‰ç³»åˆ—äº§å“çš„å¤šæ ·åŒ–å¤©è„‰ç³»åˆ—æ“ä½œç³»ç»Ÿæ ¹æ®ä¸åŒçš„åº”ç”¨åœºæ™¯è®¾è®¡äº†å¤šç§ç‰ˆæœ¬ï¼š å¤©è„‰ 1 æ“ä½œç³»ç»Ÿï¼šä¸“æ³¨äºå®æ—¶å¤šä»»åŠ¡å¤„ç†ï¼Œå·²ç»è¿›å…¥å®šå‹é˜¶æ®µï¼Œé€‚ç”¨äºé€šç”¨æœºè½½ç”µå­è®¾å¤‡ã€‚ å¤©è„‰ 2 æ“ä½œç³»ç»Ÿï¼šæä¾›å¤šåº”ç”¨é—´çš„å®‰å…¨éš”ç¦»ï¼Œå…·å¤‡æ•…éšœç®¡ç†åŠŸèƒ½ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œã€‚ å¤©è„‰ 3 æ“ä½œç³»ç»Ÿï¼šä¸ºèˆªç©ºè£…å¤‡æä¾›é«˜æ€§èƒ½çš„å¤šæ ¸ä¿¡æ¯å¤„ç†å¹³å°ï¼Œæ”¯æŒ 64 ä½è®¾è®¡ï¼Œæ»¡è¶³ç°ä»£å¤æ‚ä»»åŠ¡çš„å¤„ç†éœ€æ±‚ã€‚ æ¯ä¸ªç‰ˆæœ¬çš„è®¾è®¡ç‰¹å¾éƒ½èƒ½æ»¡è¶³ä¸åŒçš„ä½œæˆ˜éœ€æ±‚ï¼Œä¸ºé£è¡Œå™¨æä¾›å¯é çš„æ“ä½œåŸºç¡€ã€‚ å¤©è„‰ 1 æ“ä½œç³»ç»Ÿâ€”å®æ—¶å¤šä»»åŠ¡ä½“ç³»ç»“æ„æ”¯æŒåŒ…æ¿çº§æ”¯æŒåŒ… ä»»åŠ¡ç®¡ç†æä¾›å¤šä»»åŠ¡ç¯å¢ƒä¸‹çš„ç®¡ç†å·¥å…·ï¼Œå¯ä»¥çµæ´»åˆ‡æ¢ä¸åŒçš„ä»»åŠ¡ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨å¤šç§æƒ…å†µä¸‹éƒ½èƒ½ç¨³å®šè¿è¡Œã€‚ é«˜å¯é æ–‡ä»¶ç³»ç»Ÿè®¾è®¡ç”¨äºå­˜å‚¨å’Œå¤„ç†å…³é”®æ•°æ®ï¼Œå…·æœ‰å®¹é”™èƒ½åŠ›ï¼Œç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œæœ‰æ•ˆæ€§ã€‚æ¯”å¦‚ï¼Œæ”¯æŒå¿«é€Ÿæ¢å¤ä¸Šä¸€çŠ¶æ€ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚ å¤©è„‰ API æ¥å£æä¾›äº†ä¸ VxWorks 5.x å…¼å®¹çš„æ¥å£ï¼Œä¾¿äºåº”ç”¨çš„å¼€å‘å’Œè¿ç§»ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºçš„æ— ç¼ç§»æ¤ã€‚æ­¤å¤–ï¼Œè¿˜æä¾›å…¶ä»–åŠŸèƒ½æ¥å£ï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿæ›´æ–¹ä¾¿åœ°è¿›è¡Œå¼€å‘ã€‚ ä»»åŠ¡é—´é€šä¿¡é’ˆå¯¹ä¸åŒä»»åŠ¡ä¹‹é—´çš„é€šä¿¡éœ€æ±‚ï¼Œæä¾›äº†é«˜æ•ˆçš„æœºåˆ¶ï¼Œä»¥ç¡®ä¿æ•°æ®çš„åŠæ—¶ä¼ é€’å’Œå…±äº«ã€‚ ä¸­æ–­å¼‚å¸¸æœ‰æ•ˆç®¡ç†ç³»ç»Ÿçš„ä¸­æ–­å’Œå¼‚å¸¸æƒ…å†µï¼Œæ”¯æŒç³»ç»Ÿå¿«é€Ÿå“åº”å¤–éƒ¨äº‹ä»¶ã€‚ å­˜å‚¨ç®¡ç†é€šè¿‡é«˜æ•ˆçš„å­˜å‚¨ç®¡ç†å·¥å…·ï¼Œæœ‰æ•ˆä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚ æ—¶é—´ç®¡ç†é€šè¿‡ç²¾ç¡®çš„æ—¶é—´æ§åˆ¶ï¼Œç¡®ä¿ä»»åŠ¡çš„æŒ‰æ—¶æ‰§è¡Œã€‚ ç½‘ç»œåè®®æ ˆ å›¾å½¢æ˜¾ç¤ºæ”¯æŒ OpenGL ç­‰å›¾å½¢æ¥å£ï¼Œå…è®¸åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­è¿›è¡Œä¸°å¯Œçš„å›¾å½¢å¤„ç†ï¼Œå¢å¼ºç”¨æˆ·ä½“éªŒã€‚ åµŒå…¥å¼æ•°æ®åº“æä¾›åµŒå…¥å¼æ•°æ®åº“åŠŸèƒ½ï¼Œæ–¹ä¾¿æ•°æ®åº“çš„ç®¡ç†å’Œæ“ä½œï¼Œæ”¯æŒå¿«é€Ÿçš„æ•°æ®æŸ¥è¯¢å’Œå­˜å‚¨ã€‚ åˆ†å¸ƒå¼ç®¡ç†æ”¯æŒåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­è¿›è¡Œä»»åŠ¡å’Œèµ„æºçš„ç®¡ç†ï¼Œæé«˜ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚ åŸºæœ¬æ ¸å¿ƒæ¨¡å—æ”¯æŒå±‚ åŠŸèƒ½ç»„ä»¶æä¾›å¤šç§åŠŸèƒ½ç»„ä»¶ï¼Œæ»¡è¶³ä¸åŒåº”ç”¨éœ€æ±‚ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªèº«çš„éœ€æ±‚è¿›è¡Œé€‰æ‹©å’Œé…ç½®ã€‚ ç”¨æˆ·æ‰©å±•ç”¨æˆ·å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚æ‰©å±•ç³»ç»ŸåŠŸèƒ½ï¼Œå¢å¼ºç³»ç»Ÿçµæ´»æ€§ã€‚ Cache ç®¡ç†ã€è®¾å¤‡ç®¡ç†ã€é”™è¯¯ç®¡ç†æä¾›å¯¹ç¼“å­˜ã€è®¾å¤‡åŠé”™è¯¯çš„æœ‰æ•ˆç®¡ç†ï¼Œç¡®ä¿ç³»ç»Ÿé•¿æœŸã€ç¨³å®šåœ°è¿è¡Œã€‚ æ”¯æŒæœºè½½å¸¸ç”¨ç»„ä»¶ TCPIPæä¾›å®Œæ•´çš„ TCPIP åè®®æ”¯æŒï¼Œç¡®ä¿ç½‘ç»œé€šä¿¡çš„å¯é æ€§ã€‚ æ•°æ®åº“å„ç±»æ•°æ®åº“çš„æ”¯æŒä½¿å¾—ç³»ç»Ÿå…·æœ‰è‰¯å¥½çš„æ•°æ®å¤„ç†èƒ½åŠ›ã€‚ é«˜å¯é æ–‡ä»¶ç³»ç»Ÿç¡®ä¿æ–‡ä»¶çš„é«˜å¯é æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨æœºè½½ç¯å¢ƒä¸­ï¼Œæ•°æ®çš„å®Œæ•´æ€§è‡³å…³é‡è¦ã€‚ OpenGLé€šè¿‡ OpenGL è¿›è¡Œå›¾å½¢æ¸²æŸ“ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥ä½¿ç”¨ç°ä»£åŒ–çš„å›¾å½¢ç•Œé¢ã€‚ æ”¯æŒå¤„ç†å™¨ç³»åˆ— PowerPC å…¨ç³»å…¼å®¹å„ç§ PowerPC å¤„ç†å™¨ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿå®ç°æ›´é«˜çš„æ€§èƒ½ã€‚ X86å¹¿æ³›æ”¯æŒ X86 æ¶æ„ï¼Œæ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚ ARMï¼ˆé£è…¾ï¼‰æä¾› ARM å¤„ç†å™¨çš„æ”¯æŒï¼Œå°¤å…¶æ˜¯å›½äº§é£è…¾å¤„ç†å™¨ï¼Œé€‚åº”å›½å†…çš„åº”ç”¨åœºæ™¯ã€‚ MIPSï¼ˆé¾™èŠ¯ï¼‰å¢å¼ºä¸å¤šç§é¾™èŠ¯å¤„ç†å™¨çš„å…¼å®¹ï¼Œç¡®ä¿äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚ å¤©è„‰ 1 èƒ½åŠ›ä¸ VxWorks 5.x ç›¸å½“ï¼Œæ¥å£å…¼å®¹åˆ†å±‚æ¶æ„ æé«˜é‡ç”¨æ€§ã€å¯ç§»æ¤æ€§é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œç³»ç»Ÿçš„å„ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œæ›¿æ¢ï¼Œä»è€Œè‡ªç„¶æé«˜äº†æ¨¡å—çš„é‡ç”¨æ€§å’Œæ•´ä¸ªç³»ç»Ÿçš„å¯ç§»æ¤æ€§ã€‚ å¤©è„‰ 1â€”æœºè½½ç‰¹æ€§è®¾è®¡ æ—¶é—´ç²’åº¦å¯é…ï¼Œé»˜è®¤ 1msæä¾›çµæ´»çš„æ—¶é—´ç²’åº¦é€‰æ‹©ï¼Œä»¥é€‚åº”ä¸åŒçš„åº”ç”¨éœ€æ±‚ã€‚ å‘¨æœŸä»»åŠ¡æ”¯æŒæ”¯æŒå®šæ—¶ä»»åŠ¡ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿå®æ—¶å¤„ç†é«˜é¢‘æ¬¡çš„ä»»åŠ¡è°ƒåº¦ã€‚ ä¸­æ–­åµŒå¥—æ”¯æŒæ”¯æŒä¸­æ–­åµŒå¥—ï¼Œæœ‰æ•ˆæå‡ç³»ç»Ÿå“åº”å¤–éƒ¨äº‹ä»¶çš„èƒ½åŠ›ã€‚ å®æ—¶æ€§ä¸ç¡®å®šæ€§ å­˜å‚¨ç©ºé—´ä¿æŠ¤é€šè¿‡å­˜å‚¨ç©ºé—´ä¿æŠ¤ï¼Œç¡®ä¿é‡è¦æ•°æ®ä¸è¢«éæ³•è®¿é—®æˆ–ä¿®æ”¹ã€‚ åªè¯»æ•°æ®ä¿æŠ¤æä¾›åªè¯»æ•°æ®åŒºçš„æ”¯æŒï¼Œå¢å¼ºæ•°æ®çš„å®‰å…¨æ€§ã€‚ å‡½æ•°æ¥å£è°ƒç”¨é™åˆ¶å¯¹äºå‡½æ•°æ¥å£çš„è°ƒç”¨è¿›è¡Œé™åˆ¶ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨æ€§ä¸å—åˆ°å¨èƒã€‚ å¯é å®‰å…¨ é«˜å¯é æ–‡ä»¶ç³»ç»Ÿè®¾è®¡é«˜å¯é æ€§æ–‡ä»¶ç³»ç»Ÿï¼Œç¡®ä¿æ•°æ®åœ¨å„ç§æ¡ä»¶ä¸‹çš„å®‰å…¨ã€‚ å›¾å½¢æ”¯æŒï¼šOpenGLã€QT å¤šç»„ä»¶é›†æˆé€šè¿‡ OpenGL å’Œ QT ç­‰å·¥å…·é›†æˆï¼Œå®ç°ä¼˜ç§€çš„å›¾å½¢å±•ç¤ºèƒ½åŠ›ã€‚ åµŒå…¥å¼æ•°æ®åº“æä¾›çµæ´»å¯ç”¨çš„åµŒå…¥å¼æ•°æ®åº“æ¨¡å—ï¼Œæ”¯æŒå„ç±»æ•°æ®æ“ä½œã€‚ å¤šç³»åˆ—å¤„ç†å™¨å¹³å°æ”¯æŒå¤šç§å¤„ç†å™¨å¹³å°ï¼Œæå‡äº†ç³»ç»Ÿçš„é€‚åº”æ€§å’Œåº”ç”¨èŒƒå›´ã€‚ æ”¯æŒå¤šç§å›½äº§å¤„ç†å™¨ç‰¹åˆ«å¼ºè°ƒå¯¹å›½äº§å¤„ç†å™¨çš„æ”¯æŒï¼Œæé«˜äº†è‡ªä¸»å¯æ§çš„èƒ½åŠ›ã€‚ å¹³å°é€‚åº”æ€§ å‚æ•°å¯é…ç½®ï¼Œç»„ä»¶å¯å‰ªè£æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œçµæ´»é…ç½®ï¼Œç”¨æˆ·å¯æ ¹æ®å®é™…æƒ…å†µå¯¹ç»„ä»¶è¿›è¡Œè£å‰ªï¼Œå‡å°‘ä¸å¿…è¦çš„èµ„æºæµªè´¹ã€‚ å‘¨æœŸä»»åŠ¡æ¥å£ï¼šæ— éœ€åº”ç”¨è®¾è®¡å‘¨æœŸæœºåˆ¶ï¼Œç®€åŒ–å¼€å‘è¿‡ç¨‹ã€‚ ç©ºé—´ä¿æŠ¤ï¼šå®ç°ç©ºæŒ‡é’ˆæ£€æµ‹å’Œåœ°å€è¶Šç•Œæ£€æµ‹ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨ã€‚ å®‰å…¨ä¿¡å·é‡ï¼šé˜²æ­¢ä»»åŠ¡ä¼˜å…ˆçº§ç¿»è½¬ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œã€‚ VxWorks å…¼å®¹åŒ…ï¼šæé«˜ç§»æ¤æ•ˆç‡ï¼Œè®©ç”¨æˆ·åœ¨ä¸åŒç³»ç»Ÿé—´è¿›è¡Œè½»æ¾åˆ‡æ¢ã€‚ å¯å‰ªè£é…ç½®ï¼šå„ç±»ç»„ä»¶å¯ä»¥æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚è¿›è¡Œé€‰é…ï¼Œç¡®ä¿ä»£ç è§„æ¨¡å°ï¼Œæé«˜ç³»ç»Ÿæ•ˆç‡ã€‚ å¤„ç†å™¨æ”¯æŒï¼šæ”¯æŒ PPCã€ARMã€MIPSã€X86 å››ä¸ªç³»åˆ—ä¸­çš„æ•°åç§å¤„ç†å™¨ï¼Œå¸¦æ¥å¹¿æ³›çš„é…ç½®çµæ´»æ€§ã€‚ å›½äº§ç¡¬ä»¶ï¼šç¡®ä¿æ”¯æŒé£è…¾ã€é¾™èŠ¯ã€é”åã€å›½å¾®ç­‰å›½äº§å¤„ç†å™¨ï¼Œå“åº”å›½å†…çš„å‘å±•éœ€æ±‚ã€‚ å¤©è„‰ 2â€”å®‰å…¨åˆ†åŒºæ—¶é—´ç©ºé—´éš”ç¦»æŠ€æœ¯ï¼š è§£å†³å¤šåº”ç”¨å…±äº«èµ„æºå¸¦æ¥çš„å†²çªï¼Œæé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ å¥åº·ç›‘æ§æœºåˆ¶ï¼š è§£å†³å¤§è§„æ¨¡å¤æ‚è½¯ä»¶æ•…éšœå¤„ç†é—®é¢˜ï¼Œç¡®ä¿ç³»ç»Ÿçš„å¯é è¿è¡Œã€‚ åº”ç”¨å±‚ï¼ˆALï¼‰ åº”ç”¨åˆ†åŒºã€å•å…ƒæµ‹è¯•ç®¡ç†ä¸ºå„ä¸ªåº”ç”¨æä¾›ç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒã€‚ æ–‡ä»¶ç³»ç»Ÿç¡®ä¿æ•°æ®çš„æœ‰æ•ˆç®¡ç†ã€‚ æ¨¡å—æ”¯æŒå±‚ï¼ˆMSLï¼‰ ASP BIT æµ‹è¯•è¿›è¡Œç³»ç»Ÿçº§çš„æµ‹è¯•ï¼Œç¡®ä¿æ¯ä¸ªæ¨¡å—çš„ç¨³å®šæ€§ã€‚ IM ç®¡ç†é«˜æ•ˆçš„é›†æˆç®¡ç†ï¼Œä¿éšœç³»ç»Ÿæ•´ä½“è¿è¡Œé¡ºç•…ã€‚ æ¨¡å—æ”¯æŒå±‚ä¸æ ¸å¿ƒæ“ä½œç³»ç»Ÿæ¥å£å„æ¨¡å—é—´çš„é«˜æ•ˆé€šä¿¡ï¼Œæ”¯æŒç³»ç»Ÿçš„é«˜æ€§èƒ½è¿ä½œã€‚ C è¿è¡Œæ—¶åº“æä¾›ä¸°å¯Œçš„è¿è¡Œæ—¶åº“æ”¯æŒï¼Œå¢å¼ºç³»ç»Ÿç¼–ç¨‹èƒ½åŠ›ã€‚ åˆ†åŒºç®¡ç† ä»»åŠ¡ç®¡ç†æä¾›å…¨é¢çš„ä»»åŠ¡ç®¡ç†å·¥å…·ï¼Œç¡®ä¿æ¯ä¸ªä»»åŠ¡éƒ½èƒ½é«˜æ•ˆæ‰§è¡Œã€‚ ä»»åŠ¡é—´é€šä¿¡ç®¡ç†é«˜æ•ˆçš„é€šä¿¡ç®¡ç†æœºåˆ¶ï¼Œæé«˜ä»»åŠ¡é—´çš„åä½œæ•ˆç‡ã€‚ æ—¶é—´ç®¡ç†ç¡®ä¿æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§è®¾å®šçš„æ—¶é—´è¿›è¡Œè°ƒåº¦ã€‚ è®¾å¤‡ç®¡ç†æœ‰æ•ˆç®¡ç†ç³»ç»Ÿä¸­çš„å„ç§è®¾å¤‡ã€‚ å®šæ—¶å™¨ç®¡ç†æä¾›ç²¾ç¡®çš„å®šæ—¶å™¨ç®¡ç†ï¼Œå®ç°æ—¶é—´çš„ç²¾ç¡®æ§åˆ¶ã€‚ å¥åº·ç›‘æ§ åˆ†åŒºå†…è°ƒè¯•ä»£ç†é’ˆå¯¹æ¯ä¸ªåˆ†åŒºæä¾›ç‹¬ç«‹çš„è°ƒè¯•æ”¯æŒï¼Œå¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿå‘ç°å’Œä¿®å¤é—®é¢˜ã€‚ æ ¸å¿ƒæ“ä½œç³»ç»Ÿåˆå§‹åŒ–ç¡®ä¿æ ¸å¿ƒæ“ä½œç³»ç»Ÿçš„å®Œæ•´å¯åŠ¨ï¼Œä¿éšœæ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œã€‚ ä»»åŠ¡çº§é€šä¿¡ä»£ç†å®ç°ä»»åŠ¡é—´çš„é«˜æ•ˆé€šä¿¡ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“çš„åŠæ—¶æ€§ã€‚ å¥åº·ç›‘æ§è¿›è¡Œå…¨é¢çš„å¥åº·ç›‘æµ‹ï¼Œç¡®ä¿ç³»ç»Ÿé•¿æœŸç¨³å®šè¿è¡Œã€‚ é…ç½®æ•°æ®ç®¡ç†ä¾¿äºç”¨æˆ·å¯¹ç³»ç»Ÿé…ç½®è¿›è¡Œå¿«é€Ÿä¿®æ”¹å’Œç®¡ç†ã€‚ è°ƒåº¦è¡¨ç®¡ç†é«˜æ•ˆç®¡ç†ä»»åŠ¡è°ƒåº¦ï¼Œç¡®ä¿ç³»ç»Ÿèµ„æºçš„é«˜æ•ˆä½¿ç”¨ã€‚ é”™è¯¯å·ç®¡ç†ã€æ—¥å¿—ä¿¡æ¯è¾“å‡ºæä¾›è¯¦ç»†çš„é”™è¯¯æŠ¥å‘Šï¼Œæ–¹ä¾¿åç»­çš„ç»´æŠ¤å’Œäº§å“æ”¹è¿›ã€‚ æ ‡å‡† APEX æœåŠ¡ å®ç°åº”ç”¨åˆ†åŒºçš„å¹³å°æ— å…³æ€§ï¼Œä¾¿äºå¿«é€Ÿè¿ç§»å’ŒéªŒè¯ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚ ç¡®å®šæ€§é…ç½® æé«˜æœºè½½åº”ç”¨çš„å®‰å…¨æ€§ä¸å¯é æ€§ï¼Œç¡®ä¿åœ¨å¤æ‚ç¯å¢ƒä¸‹ä»èƒ½ç¨³å®šè¿è¡Œã€‚ å¤©è„‰ 3 æ“ä½œç³»ç»Ÿâ€”å¤šæ ¸å¤„ç†é£æœºèƒ½åŠ›æå‡ æœºè½½ä¿¡æ¯å¤„ç†å¾—ç›Šäºæ›´é«˜å¤„ç†æ•ˆèƒ½çš„å¤šæ ¸å¤„ç†å¹³å°ï¼Œå¢å¼ºäº†æ•´ä½“æŠ€æœ¯èƒ½åŠ›ã€‚ SWaP ä¸æ–­è¿½æ±‚ åœ¨ä½“ç§¯ã€é‡é‡å’ŒåŠŸè€—æ–¹é¢ï¼ˆSWaPï¼‰è¿½æ±‚æœ€ä½³å¹³è¡¡ã€‚ æœ‰æ•ˆé€”å¾„ï¼šå¤šæ ¸å¤„ç†å™¨ä¸å¤šæ ¸æ“ä½œç³»ç»Ÿ é‡‡ç”¨å¤šæ ¸å¤„ç†å™¨è¿›è¡Œé«˜æ•ˆæ•°æ®å¤„ç†ï¼Œæå‡ä»»åŠ¡æ‰§è¡Œçš„å¹¶è¡Œæ€§ã€‚ é‡‡ç”¨å¤šæ ¸å…¸å‹æœºè½½è®¡ç®—æœº æ”¯æŒé«˜å¹¶å‘ã€å¤šæµæ°´çš„ç®—æ³•ï¼Œé’ˆå¯¹ä¸åŒçš„åº”ç”¨åœºæ™¯è¿›è¡Œä¼˜åŒ–ã€‚ å¤©è„‰ 3â€”äº§å“èƒ½åŠ›å¤©è„‰ 3 æ¶æ„ ç¡¬ä»¶æŠ½è±¡å±‚å°è£…ç¡¬ä»¶ç»†èŠ‚ï¼Œä½¿å¾—åº”ç”¨å¼€å‘æ›´ä¸ºç®€ä¾¿ã€‚ å†…æ ¸ä¸è™šæ‹ŸåŒ–æ”¯æŒæä¾›å¤šæ ¸ç¯å¢ƒçš„è™šæ‹ŸåŒ–èƒ½åŠ›ï¼Œç¡®ä¿åº”ç”¨çš„åˆ†ç¦»ä¸å®‰å…¨ã€‚ ARINC653 æ”¯æŒæ¨¡å—ç¬¦åˆå¤šä¸ªå›½é™…æ ‡å‡†ï¼Œæé«˜é€‚é…æ€§ã€‚ å®æ—¶è¿›ç¨‹æ¨¡å—æ”¯æŒå®æ—¶è¿›ç¨‹çš„é«˜æ•ˆè°ƒåº¦ï¼Œå®ç°å®æ—¶å“åº”ã€‚ æœåŠ¡æ¥å£åº“æä¾›å¤šç§æ¥å£åº“æ”¯æŒï¼ŒåŒ…æ‹¬ ACoreOSVxWorks Posixï¼Œç¡®ä¿åº”ç”¨ç¨‹åºçš„çµæ´»æ€§ã€‚ éåˆ†åŒºæ¨¡å¼ æ”¯æŒä»»åŠ¡è°ƒåº¦ã€ä»»åŠ¡é—´é€šä¿¡ã€ä¸­æ–­å’Œå¼‚å¸¸ç®¡ç†ã€‚ æ”¯æŒå®æ—¶è¿›ç¨‹ï¼ˆRTPï¼‰å…·å¤‡ç‹¬ç«‹çš„ä»»åŠ¡éš”ç¦»å’Œæ—¶é—´è¡¨è°ƒåº¦èƒ½åŠ›ï¼Œç¡®ä¿é«˜æ•ˆè¿ä½œã€‚ æ”¯æŒ POSIX æ¥å£å’Œå›½å¤–æ“ä½œç³»ç»Ÿçš„å…¼å®¹æ€§æå‡äº†å¼€å‘è€…çš„ä½¿ç”¨ä¾¿åˆ©æ€§ã€‚ åˆ†åŒºæ¨¡å¼ æ”¯æŒåˆ†åŒºç®¡ç†ã€å¥åº·ç›‘æ§ã€åˆ†åŒºé—´é€šä¿¡ç­‰ã€‚ æ”¯æŒåˆ†åŒºç»‘å®šå¤„ç†æ ¸è°ƒåº¦ï¼ˆBMPï¼‰ï¼Œç¬¦åˆ ARINC 653 æ ‡å‡†ã€‚ æ”¯æŒ SMP è°ƒåº¦ç¡®ä¿åˆ†åŒºå†…è¿›ç¨‹çš„é«˜æ•ˆè°ƒåº¦ï¼Œå…è®¸æ›´é«˜çš„å¹¶å‘æ‰§è¡Œèƒ½åŠ›ã€‚ å¤©è„‰ 3â€”å¤šæ ¸è¿è¡Œæ¨¡å¼ä¸»æµçš„å¤šæ ¸æ¨¡å¼ä¸æ¶æ„ éå¯¹ç§°å¤šå¤„ç†ï¼ˆAMPï¼‰æ¯ä¸ª CPU æ ¸å¿ƒè¿è¡Œç‹¬ç«‹çš„ OS å®ä¾‹ï¼Œé€‚åˆå¤„ç†ä¸åŒä»»åŠ¡ã€‚ å¯¹ç§°å¤šå¤„ç†ï¼ˆSMPï¼‰ä¸€ä¸ª OS å®ä¾‹åŒæ—¶ç®¡ç†æ‰€æœ‰ CPU æ ¸å¿ƒï¼Œä½¿å¾—èµ„æºåˆ©ç”¨ç‡æœ€å¤§åŒ–ã€‚ ç»‘å®šå¤šå¤„ç†ï¼ˆBMPï¼‰æ¯ä¸ªåº”ç”¨ç»‘å®šç‰¹å®šå¤„ç†æ ¸å¿ƒï¼Œæé«˜ä»»åŠ¡æ‰§è¡Œçš„ä¸“ä¸€æ€§å’Œç¨³å®šæ€§ã€‚ ACoreIDEâ€”å¤©è„‰é›†æˆå¼€å‘ç¯å¢ƒACoreIDE æ˜¯ä¸€ä¸ªç»¼åˆæ€§çš„é›†æˆå¼€å‘ç¯å¢ƒï¼Œæ”¯æŒæ•´ä¸ªè½¯ä»¶å…¨ç”Ÿå‘½å‘¨æœŸçš„å·¥å…·é›†åˆï¼Œä»æœ€åˆçš„äººä¸ºåä½œæ¨¡å¼é€æ¸å‘å±•åˆ°ç°ä»£åŒ–çš„å…¨ç”Ÿå‘½å‘¨æœŸå·¥å…·é›†æˆã€‚ä»¥ä¸‹æ˜¯å…¶ä¸»è¦çš„å·¥ä½œæµç¨‹å’Œç»„æˆéƒ¨åˆ†ï¼š ä¸»è¦å·¥ä½œæµç¨‹ è®¾è®¡ï¼šåœ¨è¿™ä¸€é˜¶æ®µï¼Œå¼€å‘å›¢é˜Ÿä¼šä½¿ç”¨å„ç§è®¾è®¡å·¥å…·è¿›è¡Œç³»ç»Ÿæ¶æ„å’Œæ¨¡å—è®¾è®¡ï¼Œä¾‹å¦‚ UML å»ºæ¨¡å·¥å…·ã€‚ ç¼–ç ï¼šç¨‹åºå‘˜åœ¨ç¼–ç ç¯å¢ƒä¸­ç¼–å†™ä»£ç ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œæ¯”å¦‚ CC++å’Œ Pythonã€‚ è°ƒè¯•ï¼šä½¿ç”¨è°ƒè¯•å·¥å…·å¯¹ä»£ç è¿›è¡Œå®æ—¶ç›‘æ§ï¼ŒæŸ¥æ‰¾ bug å¹¶ä¿®å¤ã€‚ é›†æˆï¼šå°†ä¸åŒæ¨¡å—çš„ä»£ç é›†æˆåˆ°ä¸€èµ·ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·å¿«é€Ÿæ„å»ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚ æµ‹è¯•ï¼šè¿›è¡Œå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•ï¼Œä»¥ç¡®ä¿åŠŸèƒ½éœ€æ±‚å¾—åˆ°æ»¡è¶³å¹¶æ£€æŸ¥ç³»ç»Ÿç¨³å®šæ€§ã€‚ éƒ¨ç½²ï¼šå°†ç»è¿‡æµ‹è¯•çš„åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°ç›®æ ‡ç¯å¢ƒä¸­ï¼Œå¯èƒ½æ¶‰åŠåˆ°å¤šç§å¹³å°å’Œè®¾å¤‡ã€‚ ç»´æŠ¤ï¼šå®šæœŸç›‘æ§ç³»ç»Ÿè¡¨ç°ï¼Œä¿®å¤æ½œåœ¨é—®é¢˜ï¼Œæ¨é€å®‰å…¨æ›´æ–°ã€‚ å·¥å…·é›†æˆ å·¥ç¨‹ç®¡ç†ï¼šé¢†å¯¼ä¸åè°ƒé¡¹ç›®ï¼Œä½¿ç”¨å·¥å…·è¿½è¸ªè½¯ä»¶å¼€å‘è¿›åº¦å’Œé‡Œç¨‹ç¢‘ã€‚ æ¨¡å‹å¼€å‘ï¼šç”¨æˆ·å¯ä»¥åˆ›å»ºå’Œæµ‹è¯•å„ç§æ¨¡å‹ï¼Œè¿›è¡Œç³»ç»Ÿä»¿çœŸã€‚ é…ç½®ç®¡ç†ï¼šç”¨äºè½¯ä»¶ç‰ˆæœ¬æ§åˆ¶ï¼Œç¡®ä¿å›¢é˜Ÿæˆå‘˜ä¹‹é—´å¯ä»¥ååŒå·¥ä½œè€Œä¸å†²çªã€‚ ç¯å¢ƒè®¾ç½® ç¼–è¾‘ç¯å¢ƒä¸ç¼–è¯‘ç¯å¢ƒï¼šæä¾›å‹å¥½çš„ç¼–è¾‘ç•Œé¢ï¼Œæ”¯æŒè¯­æ³•é«˜äº®ã€ä»£ç è¡¥å…¨å’Œå³æ—¶ç¼–è¯‘åé¦ˆã€‚ ä»¿çœŸç¯å¢ƒï¼šæ¨¡æ‹Ÿè®¾å¤‡å’Œç³»ç»Ÿè¿è¡ŒçŠ¶æ€ï¼Œå¸®åŠ©å¼€å‘è€…ç†è§£ä»£ç è¡Œä¸ºã€‚ ä¿¡æ¯æµè§ˆä¸é‡æ”¾è°ƒè¯•ï¼šå…è®¸å¼€å‘è€…æŸ¥çœ‹è¿‡å»çš„è¿è¡Œä¿¡æ¯ï¼Œå¹¶åœ¨é‡ç°é”™è¯¯æ—¶ä½¿ç”¨ã€‚ æ€§èƒ½ç›‘æ§æä¾›å…¨é¢çš„ç›‘æ§å·¥å…·ï¼Œå¸®åŠ©å¼€å‘è€…å®æ—¶æŸ¥çœ‹ç³»ç»Ÿæ€§èƒ½æƒ…å†µï¼š æ€§èƒ½ç›‘è§†ï¼šç›‘æµ‹ cpu å ç”¨ç‡ã€å†…å­˜ä½¿ç”¨æƒ…å†µã€ç«¯å£å’Œ IO æµé‡ã€‚ è°ƒåº¦åˆ†æï¼šå¯¹ç³»ç»Ÿä»»åŠ¡è¿›è¡Œè°ƒåº¦åˆ†æï¼Œä»¥ä¼˜åŒ–èµ„æºåˆ©ç”¨ã€‚ è‡ªåŠ¨åŒ–å·¥å…· è‡ªåŠ¨æµ‹è¯•ï¼šé›†æˆå„ç§è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼Œå‡å°‘äººå·¥å¹²é¢„ï¼Œç¡®ä¿æµ‹è¯•çš„å¯é æ€§ä¸æ•ˆç‡ã€‚ ä»£ç åˆ†æï¼šé™æ€ä»£ç åˆ†æå·¥å…·å¸®åŠ©è¯†åˆ«æ½œåœ¨çš„å®‰å…¨æ¼æ´å’Œæ€§èƒ½ç“¶é¢ˆã€‚ éƒ¨ç½²ç®¡ç†ï¼šé€šè¿‡è„šæœ¬åŒ–çš„æ–¹å¼ç®¡ç†éƒ¨ç½²æµç¨‹ï¼Œç¡®ä¿ä¸€è‡´æ€§ã€‚ å¤„ç†å™¨æ”¯æŒæƒ…å†µå¤©è„‰ç³»ç»Ÿæ”¯æŒå¤šç§æ¶æ„çš„å¤„ç†å™¨ï¼Œç¡®ä¿å¯ä»¥æ»¡è¶³å¤šç§ç±»å‹é¡¹ç›®çš„éœ€æ±‚ã€‚ ç±»å‹ å‹å·ï¼ˆçº¢è‰²ä¸ºå›½äº§å¤„ç†å™¨ï¼‰ æ“ä½œç³»ç»Ÿ PowerPC 440ã€HKSP6101ã€HKSP7101ã€860 ç³»åˆ— å¤©è„‰ 1 ARM V4 ç³»åˆ—ã€V5 ç³»åˆ—ï¼ŒARM920Tã€ARM926E å¤©è„‰ 1 x86 AtomCore i7 ç­‰ å¤©è„‰ 1å¤©è„‰ 2 MIPS é¾™èŠ¯ç³»åˆ—ï¼ŒLS2Hã€LS2K1000 å¤©è„‰ 1å¤©è„‰ 3 ä¸Šè¿°æ”¯æŒçš„å¤„ç†å™¨ç±»å‹æ¶µç›– PowerPC çš„å…¨ç³»åˆ—ï¼ŒARM çš„ä¸»æµå‹å·ï¼Œx86 æ¶æ„å’Œ MIPS æ¶æ„ï¼Œæœ‰åŠ©äºç¡®ä¿è½¯ä»¶çš„å¹¿æ³›é€‚ç”¨æ€§ã€‚ èƒ½åŠ›æ‰©å±•ç»„ä»¶åœ¨ ACoreIDE ä¸­ï¼Œå†…ç½®äº†ä¸°å¯Œçš„èƒ½åŠ›æ‰©å±•ç»„ä»¶ï¼Œæ”¯æŒä¸åŒçš„æ“ä½œç³»ç»Ÿéœ€æ±‚ï¼š ç½‘ç»œåè®®æ ˆï¼šè‡ªç ”çš„ TCPIP v4 å’Œ v6 åè®®æ ˆï¼Œç¡®ä¿ç½‘ç»œé€šä¿¡çš„é«˜æ•ˆä¸å¯é ã€‚ æ–‡ä»¶ç³»ç»Ÿï¼šåŒ…å« FAT æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œèƒ½å¤Ÿè‡ªå¦‚å¤„ç†æ–‡ä»¶å­˜å‚¨ä¸å…±äº«ã€‚ ç³»ç»Ÿä¸­é—´ä»¶ï¼šå¦‚é€šç”¨ç³»ç»Ÿç®¡ç†ï¼ˆGSMï¼‰å’Œæ•°æ®åˆ†å‘æœåŠ¡ï¼ˆDDSï¼‰ï¼Œæä¾›æ ¸å¿ƒæœåŠ¡ã€‚ ç”Ÿæ€å»ºè®¾å¤©è„‰ç³»ç»Ÿå·²ç»å»ºæˆäº†æ»¡è¶³èˆªç©ºè£…å¤‡åº”ç”¨éœ€æ±‚çš„è½¯ä»¶ç”Ÿæ€åœˆï¼Œèƒ½å¤Ÿæ”¯æŒå¤æ‚çš„èˆªç©ºç³»ç»Ÿå’Œè£…å¤‡ï¼ŒåŒæ—¶ç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§ã€å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ é€šè¿‡è¿™ä¸€ç³»åˆ—çš„å·¥å…·å’ŒåŠŸèƒ½çš„é›†æˆï¼ŒACoreIDE ä¸ä»…æå‡äº†è½¯ä»¶å¼€å‘çš„æ•ˆç‡ï¼Œä¹Ÿä¸ºå¼€å‘è€…æä¾›äº†ä¸°å¯Œçš„èµ„æºå’Œæ”¯æŒï¼Œä½¿å…¶èƒ½ä¸“æ³¨äºå®ç°åˆ›æ–°ä¸ä»·å€¼ã€‚","categories":["5.åµŒå…¥å¼å¼€å‘","èˆªç”µç³»ç»Ÿ"]},{"title":"ffmpeg-m3u8è½¬mp4","path":"/2023/08/31/6-å¼€å‘å·¥å…·-éŸ³è§†é¢‘-ffmpeg-m3u8è½¬mp4/","content":"FFmpeg å‘½ä»¤è¡Œå·¥å…·å°† m3u8 æ–‡ä»¶è½¬æ¢ä¸º mp4 æ ¼å¼ ä¸‹è½½å¹¶å®‰è£… FFmpegå¯ä»¥ä» å®˜æ–¹ç½‘ç«™ ä¸‹è½½é€‚åˆæ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬ã€‚ æ‰“å¼€å‘½ä»¤è¡Œå·¥å…· åœ¨ Windows ä¸Šï¼Œå¯ä»¥æŒ‰ä¸‹ Win + R é”®ï¼Œç„¶åè¾“å…¥ cmd å¹¶æŒ‰ Enter é”®æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ã€‚ åœ¨ Mac OS æˆ– Linux ä¸Šï¼Œå¯ä»¥æ‰“å¼€ç»ˆç«¯åº”ç”¨ç¨‹åºã€‚ è½¬æ¢ m3u8 æ–‡ä»¶åœ¨å‘½ä»¤è¡Œä¸­ï¼Œå¯¼èˆªåˆ°åŒ…å« m3u8 æ–‡ä»¶çš„ç›®å½•ï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š ffmpeg -i input.m3u8 -c copy output.mp4 input.m3u8 æ˜¯è¦è½¬æ¢çš„ m3u8 æ–‡ä»¶çš„åç§°ï¼Œoutput.mp4 æ˜¯è½¬æ¢åçš„ mp4 æ–‡ä»¶çš„åç§°ã€‚ è¯¥å‘½ä»¤å°†ä½¿ç”¨ FFmpeg å°† m3u8 æ–‡ä»¶è½¬æ¢ä¸º mp4 æ ¼å¼ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨ç›¸åŒçš„ç›®å½•ä¸­ã€‚ è¯·æ³¨æ„ï¼Œæ­¤å‘½ä»¤åªèƒ½å°† m3u8 æ–‡ä»¶è½¬æ¢ä¸º mp4 æ ¼å¼ï¼Œè€Œä¸èƒ½å°†å…¶ä¸­çš„è§†é¢‘æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°è®¡ç®—æœºã€‚ å¦‚æœéœ€è¦ä¸‹è½½ m3u8 æ–‡ä»¶ä¸­çš„è§†é¢‘æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨å…¶ä»–å·¥å…·æˆ–è½¯ä»¶ã€‚ å°†åˆ†æ®µå¼ m3u8 æ–‡ä»¶è½¬æ¢ä¸º MP4 æ–‡ä»¶#!/bin/bashcd ./m3u8Movie #åˆ†æ®µå¼m3u8æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹for i in 1..2473 #è½®è¯¢æ‰€æœ‰åˆ†æ®µå¼æ–‡ä»¶æ•°é‡do if [ -f $i ]; then #æ£€æµ‹æ–‡ä»¶å­˜åœ¨ mv $i $i.mp4 #é‡å‘½å fi echo file ./$i.mp4 list.txt #æ·»åŠ åˆ°åˆ—è¡¨ä¸­å»done#è°ƒç”¨ffmpegè¿›è¡Œè§†é¢‘è¿æ¥æ“ä½œffmpeg -f concat -safe 0 -i list.txt -c copy ../movie.mp4#-f æŒ‡å®šè¾“å…¥æ ¼å¼ä¸ºconcatï¼Œè¡¨ç¤ºè¦è¿›è¡Œè§†é¢‘æ–‡ä»¶çš„è¿æ¥æ“ä½œ#-safe 0 è®¾ç½®å®‰å…¨æ¨¡å¼ä¸º0ï¼Œå…è®¸ä½¿ç”¨ä¸å®‰å…¨çš„æ–‡ä»¶å#-i æŒ‡å®šæ–‡æœ¬æ–‡ä»¶åŒ…å«äº†è¦è¿æ¥çš„è§†é¢‘æ–‡ä»¶çš„åˆ—è¡¨åŠå…¶è·¯å¾„#-c ç›´æ¥å¤åˆ¶è¾“å…¥è§†é¢‘æ–‡ä»¶çš„éŸ³è§†é¢‘æµï¼Œè€Œä¸è¿›è¡Œé‡æ–°ç¼–ç ã€‚è¿™æ ·å¯ä»¥åŠ å¿«å¤„ç†é€Ÿåº¦è€Œä¸æŸå¤±è´¨é‡ã€‚#æŒ‡å®šè¾“å‡ºæ–‡ä»¶è·¯å¾„å’Œåç§°","categories":["6.å¼€å‘å·¥å…·","éŸ³è§†é¢‘"]},{"title":"TV BOX","path":"/2023/08/30/6-å¼€å‘å·¥å…·-éŸ³è§†é¢‘-TV-BOX/","content":"åº”ç”¨ç«¯TVBOXo0HalfLife0o å¼€æºçš„ APK å¯é€šè¿‡ä»¥ä¸‹é“¾æ¥è®¿é—®ï¼šTVBox APKã€‚ä½¿ç”¨æ­¤åº”ç”¨ç¨‹åºå‰ï¼Œé¦–å…ˆéœ€è¦é…ç½®å…¶åœ°å€ã€‚å‰å¾€åº”ç”¨çš„è®¾ç½®ç•Œé¢ï¼Œæ‰¾åˆ°â€é…ç½®åœ°å€â€é€‰é¡¹ï¼Œæ·»åŠ é€‚åˆçš„è§†é¢‘æºï¼Œç¡®ä¿èƒ½å¤Ÿé¡ºåˆ©è§‚çœ‹æ‰€éœ€çš„å†…å®¹ã€‚ ZY-PlayerZY-Player æ˜¯ another popular åº”ç”¨ç¨‹åºï¼Œå¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°å…¶æºä»£ç å’Œå®‰è£…åŒ…ï¼šZY-Playerã€‚ è§†é¢‘æºæŸäº›è§†é¢‘æºå› åœ°å€é™åˆ¶ï¼Œå¯èƒ½æ— æ³•ç›´æ¥è®¿é—®ã€‚ä¸ºäº†åŠ é€Ÿè·å–è¿™äº›æºï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹é“¾æ¥ï¼Œå¸®åŠ©å¿«é€Ÿè¿æ¥åˆ°è§†é¢‘å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ jsDelivr å’Œ Statically æä¾›çš„åŠ é€Ÿåœ°å€ï¼š jsDelivr åŠ é€Ÿåœ°å€ï¼š ZY-Player-PC.json Statically åŠ é€Ÿåœ°å€ï¼š ZY-Player-PC.json é›†åˆä»¥ä¸‹æ˜¯ä¸€äº›ç»´æŠ¤è‰¯å¥½çš„ TVBox æ¥å£é¡¹ç›®ï¼Œå¯ä»¥ä»ä¸­è·å–æœ€æ–°çš„è§†é¢‘æºé…ç½®ï¼š YuanHsing ç»´æŠ¤çš„ TVBOX æ¥å£é¡¹ç›® å¦ä¸€ä¸ª TVBox é¡¹ç›® å¤‡é€‰é¡¹ç›® ç½‘ç«™å¯ä»¥é€šè¿‡ä»¥ä¸‹ç½‘ç«™è·å–è§†é¢‘æºé…ç½®ï¼Œç¡®ä¿å¯ä»¥æ¥å…¥å„ç±»å†…å®¹ï¼š ç½‘ç«™ åœ°å€ FongMi FongMi é…ç½® å·§æŠ€ å·§æŠ€ é…ç½® ä¿Šäº ä¿Šäº é…ç½® éœœè¾‰æœˆæ˜ éœœè¾‰æœˆæ˜ é…ç½® å°é›… å°é›… é…ç½® TVBox Cainisi ç¥å™¨ ç¥å™¨æ¯æ—¥æ¨é€ é¥­å¤ªç¡¬ é¥­å¤ªç¡¬ äº‘æ˜Ÿæ—¥è®° äº‘æ˜Ÿæ—¥è®° è‚¥çŒ« è‚¥çŒ« ä»“åº“ä»¥ä¸‹æ˜¯ä¸€äº›é‡è¦çš„å¼€å‘è€…åŠå…¶é¡¹ç›®ï¼Œå¯ä»¥åœ¨è¿™äº›ä»“åº“ä¸­æ‰¾åˆ°å„ç±» TV åº”ç”¨ç¨‹åºå’Œæ¥å£ï¼š å”ä¸‰å¤§ä½¬çš„ä»“åº“ï¼šå”ä¸‰ä»“åº“ å·§æŠ€å¤§ä½¬çš„ä»“åº“ï¼šå·§æŠ€ä»“åº“ ä¿Šäºå¤§ä½¬ã€å”ä¸‰å¤§ä½¬å’Œå½±é­”å¤§ä½¬çš„è”åˆä»“åº“ï¼šå®˜æ–¹ä»“åº“ TV çŒ«ç›’ï¼šè¿™ä¸ªé¡¹ç›®éå¸¸å®ç”¨ï¼šçŒ«ç›’é¡¹ç›® pluto-playerï¼šéå¼€æºé¡¹ç›®ï¼Œå…·å¤‡å¤§é‡åŠŸèƒ½ä¸”æ”¯æŒåœ¨çº¿å‡çº§ï¼Œä½†ç›®å‰ä¸æ”¯æŒä½ç‰ˆæœ¬å®‰å“ï¼špluto-player takagen99 é¡¹ç›®ï¼štakagen99 o0HalfLife0o é¡¹ç›®ï¼šo0HalfLife0o AlphaTV é¡¹ç›®ï¼šAlphaTV clanTV é¡¹ç›®ï¼šclanTV FongMi-TV é¡¹ç›®ï¼šFongMi-TV BearTVï¼šè®¸å¤šäººæåˆ°çš„ç†Šçˆ±é¡¹ç›®ï¼šBearTV å®˜æ–¹ä»“åº“ï¼Œå·²äº 2022 å¹´ 7 æœˆ 18 æ—¥å°ä»“ï¼šå®˜æ–¹ä»“åº“é“¾æ¥ å¤šçº¿è·¯ TV ç‰ˆæœ¬ä»“åº“ï¼šå¤šçº¿è·¯ TV ç‰ˆæœ¬ å››è§’å¤§ç¥çš„ä»“åº“ï¼Œéƒ¨åˆ†å†…å®¹å·²ç»è¢«åˆ é™¤ï¼Œä½†å¯ä»¥æ ¹æ®éœ€è¦æŸ¥çœ‹ï¼šå››è§’å¤§ç¥ä»“åº“","categories":["6.å¼€å‘å·¥å…·","éŸ³è§†é¢‘"]},{"title":"éŸ³é¢‘æ’­æ”¾","path":"/2023/08/29/6-å¼€å‘å·¥å…·-éŸ³è§†é¢‘-éŸ³é¢‘æ’­æ”¾/","content":"Audio Controlä½¿ç”¨ç³»ç»Ÿå†…ç½®çš„æ’­æ”¾åŠŸèƒ½è°ƒç”¨ç³»ç»Ÿçš„éŸ³é¢‘åŠŸèƒ½éå¸¸ç®€å•ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥ç›´æ¥æ’­æ”¾éŸ³é¢‘æ–‡ä»¶ï¼š system(play wind.mp3) è¯¥å‘½ä»¤å°†è°ƒç”¨æœ¬åœ°ç³»ç»Ÿçš„æ’­æ”¾å™¨ä»¥æ’­æ”¾ wind.mp3 æ–‡ä»¶ã€‚ç¡®ä¿æ–‡ä»¶è·¯å¾„æ­£ç¡®ä¸”æ–‡ä»¶å­˜åœ¨ï¼Œä»¥é¿å…æ’­æ”¾å¤±è´¥ã€‚ ä½¿ç”¨ FFMPEG å¤„ç†éŸ³é¢‘æ–‡ä»¶FFMPEG æ˜¯ä¸€ä¸ªå¼ºå¤§çš„éŸ³é¢‘å’Œè§†é¢‘å¤„ç†å·¥å…·ã€‚å¯ä»¥ä½¿ç”¨ç®€å•çš„å‘½ä»¤å°†ä¸åŒæ ¼å¼çš„éŸ³é¢‘æ–‡ä»¶è¿›è¡Œè½¬æ¢ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„è½¬æ¢å‘½ä»¤ï¼š å°† MP3 è½¬æ¢ä¸º WAV æ ¼å¼å°† MP3 æ–‡ä»¶è½¬æ¢ä¸º WAV æ ¼å¼ï¼Œé€‚åˆç”¨åœ¨éœ€è¦æ— æŸéŸ³è´¨çš„åœºåˆã€‚ ffmpeg -i input.mp3 -acodec pcm_s16le -ac 1 -ar 8000 output.wav å°† M4A è½¬æ¢ä¸º WAV æ ¼å¼M4A æ˜¯ä¸€ç§å¸¸è§çš„éŸ³é¢‘æ ¼å¼ï¼Œæ­¤å‘½ä»¤åŒæ ·èƒ½å¤Ÿå¤„ç†ã€‚ ffmpeg -i input.m4a -acodec pcm_s16le -ac 1 -ar 8000 output.wav WAV ä¸ PCM çš„ç›¸äº’è½¬æ¢æœ‰æ—¶å€™éœ€è¦åœ¨è¿™ä¸¤ç§æ ¼å¼ä¹‹é—´è¿›è¡Œè½¬æ¢ï¼Œä½¿ç”¨ä¸‹åˆ—å‘½ä»¤å³å¯ï¼š ffmpeg -i input.wav -f s16le -ar 8000 -acodec pcm_s16le output.raw å°† PCM æ•°æ®è½¬æ¢ä¸º WAV æ ¼å¼å°†åŸå§‹ PCM æ•°æ®æ–‡ä»¶è½¬ä¸ºæ›´ä¸ºé€šç”¨çš„ WAV æ ¼å¼ï¼š ffmpeg -f s16le -ar 8000 -ac 1 -acodec pcm_s16le -i input.raw output.wav æ³¨é‡Šè¯´æ˜ -acodec pcm_s16le é€‰é¡¹æŒ‡å®šä½¿ç”¨ 16 ä½ PCM ç¼–ç å™¨ï¼Œè¿™æ˜¯éŸ³é¢‘æ–‡ä»¶è¢«å¹¿æ³›æ”¯æŒå’Œä½¿ç”¨çš„æ ¼å¼ã€‚ -f s16le ç”¨äºæŒ‡å®šä¿å­˜æ ¼å¼ä¸º 16 ä½ PCM æ ¼å¼ã€‚ -ac 1 è®¾ç½®ä¸ºå•å£°é“ï¼Œé€šå¸¸åœ¨è¯­éŸ³å’Œç®€å•éŸ³æ•ˆä¸­è¶³å¤Ÿä½¿ç”¨ã€‚ -ar 8000 æŒ‡å®šäº† 8000Hz çš„é‡‡æ ·ç‡ï¼Œè¿™æ ·å¯ä»¥å…¼é¡¾éŸ³è´¨å’Œæ–‡ä»¶å¤§å°ã€‚ ä½¿ç”¨ Qt æ¨¡å—æ’­æ”¾éŸ³é¢‘Qt æä¾›äº†å¤šç§æ¨¡å—ç”¨äºéŸ³é¢‘æ’­æ”¾ï¼Œä»¥ä¸‹æ˜¯ä½¿ç”¨ QSound å’Œ QMediaPlayer æ¨¡å—çš„ç¤ºä¾‹ï¼š è°ƒç”¨ QSound æ¨¡å—ç¡®ä¿åœ¨å¤´æ–‡ä»¶ä¸­åŒ…å« QSoundï¼Œå¹¶åœ¨é¡¹ç›®æ–‡ä»¶ä¸­æ·»åŠ å¤šåª’ä½“æ¨¡å—æ”¯æŒï¼š #include QSound// åœ¨ .pro æ–‡ä»¶ä¸­QT += multimedia æ’­æ”¾éŸ³é¢‘æ–‡ä»¶çš„ç®€å•æ–¹æ³•å¦‚ä¸‹ï¼š QSound::play(./wind.mp3); æ­¤å‘½ä»¤å°†ç›´æ¥æ’­æ”¾æŒ‡å®šè·¯å¾„ä¸‹çš„éŸ³é¢‘æ–‡ä»¶ã€‚ è°ƒç”¨ QMediaPlayer æ¨¡å—è‹¥éœ€è¦æ›´å¤æ‚çš„éŸ³é¢‘æ§åˆ¶ï¼Œåˆ™å¯ä½¿ç”¨ QMediaPlayerã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š QString filePath = /home/forlinx/wind.mp3;if (!filePath.isEmpty()) player-setMedia(QUrl::fromLocalFile(filePath)); player-play(); åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå¦‚æœç»™å®šçš„æ–‡ä»¶è·¯å¾„ä¸ä¸ºç©ºï¼Œåˆ™è®¾ç½®åª’ä½“æºï¼Œå¹¶å¼€å§‹æ’­æ”¾ã€‚ è€ƒè™‘åœ¨éœ€è¦æ›´ç²¾ç»†çš„éŸ³é¢‘æ§åˆ¶æ—¶ä½¿ç”¨ QSoundEffect æˆ– QAudioOutput ç±»ï¼Œè¿™äº›ç±»æä¾›äº†æ›´çµæ´»çš„éŸ³æ•ˆå¤„ç†é€‰é¡¹ã€‚ ä½¿ç”¨ GStreamer å·¥å…·GStreamer æ˜¯ä¸€ä¸ªç”¨äºå¤šåª’ä½“å¤„ç†çš„æ¡†æ¶ï¼Œä»¥ä¸‹å‘½ä»¤ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å…¶æ’­æ”¾éŸ³é¢‘ï¼š system(gst-play-1.0 wind.mp3) è¿™æ¡å‘½ä»¤è°ƒç”¨ GStreamer çš„æ’­æ”¾å·¥å…·ï¼Œæ’­æ”¾æŒ‡å®šçš„éŸ³é¢‘æ–‡ä»¶ã€‚ç¡®ä¿ GStreamer å·²å®‰è£…ï¼Œå¹¶ä¸”è·¯å¾„è®¾ç½®æ­£ç¡®ã€‚ gst æºç /* * GStreamerå‘½ä»¤è¡Œæ’­æ”¾æµ‹è¯•å·¥å…· */#include locale.h#include gst/gst.h#include stdlib.h#include stdio.h#include string.h#include math.h#include gst-play-kb.h#include gst/play/play.h// å®šä¹‰éŸ³é‡æ­¥æ•°ï¼Œè¡¨ç¤ºéŸ³é‡è°ƒèŠ‚çš„ç»†åˆ†ç¨‹åº¦#define VOLUME_STEPS 20// å®šä¹‰è°ƒè¯•åˆ†ç±»GST_DEBUG_CATEGORY(play_debug);#define GST_CAT_DEFAULT play_debug// å®šä¹‰æ’­æ”¾å™¨ç»“æ„ä½“ï¼ŒåŒ…å«æ’­æ”¾ä¿¡æ¯typedef struct gchar **uris; // æ’­æ”¾æ–‡ä»¶çš„ URI åˆ—è¡¨ guint num_uris; // URI çš„æ•°é‡ gint cur_idx; // å½“å‰æ’­æ”¾çš„ç´¢å¼• GstPlay *player; // GStreamer æ’­æ”¾å™¨å®ä¾‹ GstPlaySignalAdapter *signal_adapter; // ä¿¡å·é€‚é…å™¨ GstState desired_state; // æœŸæœ›çš„çŠ¶æ€ gboolean repeat; // æ˜¯å¦é‡å¤æ’­æ”¾ GMainLoop *loop; // ä¸»å¾ªç¯ Player;// å‡½æ•°å£°æ˜ï¼šæ’­æ”¾ä¸‹ä¸€ä¸ªã€ä¸Šä¸€ä¸ªæˆ–é‡ç½®æ’­æ”¾static gboolean play_next(Player *play);static gboolean play_prev(Player *play);static void play_reset(Player *play);static void play_set_relative_volume(Player *play, gdouble volume_step);#include iostream// è¾“å…¥è¾“å‡ºæµ#include cstdint // å®šä¹‰æ•´æ•°ç±»å‹#include unistd.h// UNIX æ ‡å‡†å‡½æ•°#include fstream // æ–‡ä»¶æµæ“ä½œ// ä½¿ç”¨ç»“æ„ä½“å¯¹ WAV æ–‡ä»¶å¤´è¿›è¡Œå¯¹é½#pragma pack(1)struct WavHeader uint32_t id; // æ–‡ä»¶æ ‡è¯†ç¬¦ uint32_t chunk_size; // æ•°æ®å—å¤§å° uint32_t form_type; // æ–‡ä»¶æ ¼å¼ç±»å‹ uint32_t fmt; // æ ¼å¼æ ‡è¯†ç¬¦ uint32_t subchunk_size; // å­å—å¤§å° uint16_t audio_format; // éŸ³é¢‘æ ¼å¼ uint16_t channel_nums; // å£°é“æ•° uint32_t sample_rate; // é‡‡æ ·ç‡ uint32_t byte_rate; // å­—èŠ‚ç‡ uint16_t block_align; // æ•°æ®å—å¯¹é½ uint16_t bits_per_sample; // æ¯ä¸ªæ ·æœ¬çš„ä½æ•° uint32_t data; // æ•°æ®æ ‡è¯†ç¬¦ uint32_t data_size; // æ•°æ®å¤§å°;#pragma pack()// è®¾ç½®ä¸»éŸ³é‡çš„å‡½æ•°void set_master_volume(long volume) long min, max; // å­˜å‚¨éŸ³é‡èŒƒå›´çš„å˜é‡ snd_mixer_t *handle; // æ··éŸ³å™¨å¥æŸ„ snd_mixer_selem_id_t *sid; // æ··éŸ³å…ƒç´  ID const char *card = default; // å£°å¡ç±»å‹ const char *selem_name = Master; // å£°æ˜åç§° // æ‰“å¼€æ··éŸ³å™¨ snd_mixer_open(handle, 0); snd_mixer_attach(handle, card); snd_mixer_selem_register(handle, NULL, NULL); snd_mixer_load(handle); // åˆ†é…å¹¶è®¾ç½®æ··éŸ³å…ƒç´  ID snd_mixer_selem_id_alloca(sid); snd_mixer_selem_id_set_index(sid, 0); snd_mixer_selem_id_set_name(sid, selem_name); snd_mixer_elem_t *elem = snd_mixer_find_selem(handle, sid); // æŸ¥æ‰¾æ··éŸ³å…ƒç´  // è·å–éŸ³é‡èŒƒå›´å¹¶è®¾ç½®ä¸»éŸ³é‡ snd_mixer_selem_get_playback_volume_range(elem, min, max); snd_mixer_selem_set_playback_volume_all(elem, volume * max / 100); // å°†éŸ³é‡è½¬æ¢ä¸ºå®é™…å€¼ // å…³é—­æ··éŸ³å™¨ snd_mixer_close(handle);// ä¸»å‡½æ•°ï¼šç¨‹åºçš„å…¥å£int main(int argc, char **argv) // æ£€æŸ¥æ˜¯å¦æä¾›äº†è¶³å¤Ÿçš„å‘½ä»¤è¡Œå‚æ•° if (argc 2) std::cout std::string(argv[0]) wav_file_path std::endl; // æç¤ºå¦‚ä½•ä½¿ç”¨ç¨‹åº return -1; // é€€å‡ºç¨‹åº std::string wav_file_name(argv[1]); // è·å– WAV æ–‡ä»¶å static voidend_of_stream_cb (GstPlaySignalAdapter * adapter, Player * play) gst_print ( ); /* and switch to next item in list */ if (!play_next (play)) gst_print (Reached end of play list. ); g_main_loop_quit (play-loop); static voiderror_cb (GstPlaySignalAdapter * adapter, GError * err, Player * play) gst_printerr (ERROR %s for %s , err-message, play-uris[play-cur_idx]); /* if looping is enabled, then disable it else will keep looping forever */ play-repeat = FALSE; /* try next item in list then */ if (!play_next (play)) gst_print (Reached end of play list. ); g_main_loop_quit (play-loop); static voidposition_updated_cb (GstPlaySignalAdapter * adapter, GstClockTime pos, Player * play) GstClockTime dur = -1; gchar status[64] = 0, ; g_object_get (play-player, duration, dur, NULL); memset (status, , sizeof (status) - 1); if (pos != -1 dur 0 dur != -1) gchar dstr[32], pstr[32]; /* FIXME: pretty print in nicer format */ g_snprintf (pstr, 32, % GST_TIME_FORMAT, GST_TIME_ARGS (pos)); pstr[9] = \\0; g_snprintf (dstr, 32, % GST_TIME_FORMAT, GST_TIME_ARGS (dur)); dstr[9] = \\0; gst_print (%s / %s %s\\r, pstr, dstr, status); static voidstate_changed_cb (GstPlaySignalAdapter * adapter, GstPlayState state, Player * play) gst_print (State changed: %s , gst_play_state_get_name (state));static voidbuffering_cb (GstPlaySignalAdapter * adapter, gint percent, Player * play) gst_print (Buffering: %d , percent);static voidprint_one_tag (const GstTagList * list, const gchar * tag, gpointer user_data) gint i, num; num = gst_tag_list_get_tag_size (list, tag); for (i = 0; i num; ++i) const GValue *val; val = gst_tag_list_get_value_index (list, tag, i); if (G_VALUE_HOLDS_STRING (val)) gst_print ( %s : %s , tag, g_value_get_string (val)); else if (G_VALUE_HOLDS_UINT (val)) gst_print ( %s : %u , tag, g_value_get_uint (val)); else if (G_VALUE_HOLDS_DOUBLE (val)) gst_print ( %s : %g , tag, g_value_get_double (val)); else if (G_VALUE_HOLDS_BOOLEAN (val)) gst_print ( %s : %s , tag, g_value_get_boolean (val) ? true : false); else if (GST_VALUE_HOLDS_DATE_TIME (val)) GstDateTime *dt = g_value_get_boxed (val); gchar *dt_str = gst_date_time_to_iso8601_string (dt); gst_print ( %s : %s , tag, dt_str); g_free (dt_str); else gst_print ( %s : tag of type %s , tag, G_VALUE_TYPE_NAME (val)); static voidprint_video_info (GstPlayVideoInfo * info) gint fps_n, fps_d; guint par_n, par_d; if (info == NULL) return; gst_print ( width : %d , gst_play_video_info_get_width (info)); gst_print ( height : %d , gst_play_video_info_get_height (info)); gst_print ( max_bitrate : %d , gst_play_video_info_get_max_bitrate (info)); gst_print ( bitrate : %d , gst_play_video_info_get_bitrate (info)); gst_play_video_info_get_framerate (info, fps_n, fps_d); gst_print ( framerate : %.2f , (gdouble) fps_n / fps_d); gst_play_video_info_get_pixel_aspect_ratio (info, par_n, par_d); gst_print ( pixel-aspect-ratio %u:%u , par_n, par_d);static voidprint_audio_info (GstPlayAudioInfo * info) if (info == NULL) return; gst_print ( sample rate : %d , gst_play_audio_info_get_sample_rate (info)); gst_print ( channels : %d , gst_play_audio_info_get_channels (info)); gst_print ( max_bitrate : %d , gst_play_audio_info_get_max_bitrate (info)); gst_print ( bitrate : %d , gst_play_audio_info_get_bitrate (info)); gst_print ( language : %s , gst_play_audio_info_get_language (info));static voidprint_subtitle_info (GstPlaySubtitleInfo * info) if (info == NULL) return; gst_print ( language : %s , gst_play_subtitle_info_get_language (info));static voidprint_all_stream_info (GstPlayMediaInfo * media_info) guint count = 0; GList *list, *l; gst_print (URI : %s , gst_play_media_info_get_uri (media_info)); gst_print (Duration: % GST_TIME_FORMAT , GST_TIME_ARGS (gst_play_media_info_get_duration (media_info))); gst_print (Global taglist: ); if (gst_play_media_info_get_tags (media_info)) gst_tag_list_foreach (gst_play_media_info_get_tags (media_info), print_one_tag, NULL); else gst_print ( (nil) ); list = gst_play_media_info_get_stream_list (media_info); if (!list) return; gst_print (All Stream information ); for (l = list; l != NULL; l = l-next) GstTagList *tags = NULL; GstPlayStreamInfo *stream = (GstPlayStreamInfo *) l-data; gst_print ( Stream # %u , count++); gst_print ( type : %s_%u , gst_play_stream_info_get_stream_type (stream), gst_play_stream_info_get_index (stream)); tags = gst_play_stream_info_get_tags (stream); gst_print ( taglist : ); if (tags) gst_tag_list_foreach (tags, print_one_tag, NULL); if (GST_IS_PLAY_VIDEO_INFO (stream)) print_video_info ((GstPlayVideoInfo *) stream); else if (GST_IS_PLAY_AUDIO_INFO (stream)) print_audio_info ((GstPlayAudioInfo *) stream); else print_subtitle_info ((GstPlaySubtitleInfo *) stream); static voidprint_all_video_stream (GstPlayMediaInfo * media_info) GList *list, *l; list = gst_play_media_info_get_video_streams (media_info); if (!list) return; gst_print (All video streams ); for (l = list; l != NULL; l = l-next) GstPlayVideoInfo *info = (GstPlayVideoInfo *) l-data; GstPlayStreamInfo *sinfo = (GstPlayStreamInfo *) info; gst_print ( %s_%d # , gst_play_stream_info_get_stream_type (sinfo), gst_play_stream_info_get_index (sinfo)); print_video_info (info); static voidprint_all_subtitle_stream (GstPlayMediaInfo * media_info) GList *list, *l; list = gst_play_media_info_get_subtitle_streams (media_info); if (!list) return; gst_print (All subtitle streams: ); for (l = list; l != NULL; l = l-next) GstPlaySubtitleInfo *info = (GstPlaySubtitleInfo *) l-data; GstPlayStreamInfo *sinfo = (GstPlayStreamInfo *) info; gst_print ( %s_%d # , gst_play_stream_info_get_stream_type (sinfo), gst_play_stream_info_get_index (sinfo)); print_subtitle_info (info); static voidprint_all_audio_stream (GstPlayMediaInfo * media_info) GList *list, *l; list = gst_play_media_info_get_audio_streams (media_info); if (!list) return; gst_print (All audio streams: ); for (l = list; l != NULL; l = l-next) GstPlayAudioInfo *info = (GstPlayAudioInfo *) l-data; GstPlayStreamInfo *sinfo = (GstPlayStreamInfo *) info; gst_print ( %s_%d # , gst_play_stream_info_get_stream_type (sinfo), gst_play_stream_info_get_index (sinfo)); print_audio_info (info); static voidprint_current_tracks (Player * play) GstPlayAudioInfo *audio = NULL; GstPlayVideoInfo *video = NULL; GstPlaySubtitleInfo *subtitle = NULL; gst_print (Current video track: ); video = gst_play_get_current_video_track (play-player); print_video_info (video); gst_print (Current audio track: ); audio = gst_play_get_current_audio_track (play-player); print_audio_info (audio); gst_print (Current subtitle track: ); subtitle = gst_play_get_current_subtitle_track (play-player); print_subtitle_info (subtitle); if (audio) g_object_unref (audio); if (video) g_object_unref (video); if (subtitle) g_object_unref (subtitle);static voidprint_media_info (GstPlayMediaInfo * media_info) print_all_stream_info (media_info); gst_print ( ); print_all_video_stream (media_info); gst_print ( ); print_all_audio_stream (media_info); gst_print ( ); print_all_subtitle_stream (media_info);static voidmedia_info_cb (GstPlaySignalAdapter * adapter, GstPlayMediaInfo * info, Player * play) static int once = 0; if (!once) print_media_info (info); print_current_tracks (play); once = 1; static Player *play_new (gchar ** uris, gdouble initial_volume) Player *play; play = g_new0 (Player, 1); play-uris = uris; play-num_uris = g_strv_length (uris); play-cur_idx = -1; play-player = gst_play_new (NULL); play-loop = g_main_loop_new (NULL, FALSE); play-desired_state = GST_STATE_PLAYING; play-signal_adapter = gst_play_signal_adapter_new_with_main_context (play-player, g_main_loop_get_context (play-loop)); g_signal_connect (play-signal_adapter, position-updated, G_CALLBACK (position_updated_cb), play); g_signal_connect (play-signal_adapter, state-changed, G_CALLBACK (state_changed_cb), play); g_signal_connect (play-signal_adapter, buffering, G_CALLBACK (buffering_cb), play); g_signal_connect (play-signal_adapter, end-of-stream, G_CALLBACK (end_of_stream_cb), play); g_signal_connect (play-signal_adapter, error, G_CALLBACK (error_cb), play); g_signal_connect (play-signal_adapter, media-info-updated, G_CALLBACK (media_info_cb), play); play_set_relative_volume (play, initial_volume - 1.0); return play;static voidplay_free (Player * play) play_reset (play); g_clear_object (play-signal_adapter); gst_object_unref (play-player); g_main_loop_unref (play-loop); g_strfreev (play-uris); g_free (play);/* reset for new file/stream */static voidplay_reset (Player * play)static voidplay_set_relative_volume (Player * play, gdouble volume_step) gdouble volume; g_object_get (play-player, volume, volume, NULL); volume = round ((volume + volume_step) * VOLUME_STEPS) / VOLUME_STEPS; volume = CLAMP (volume, 0.0, 10.0); g_object_set (play-player, volume, volume, NULL); gst_print (Volume: %.0f%% , volume * 100);static gchar *play_uri_get_display_name (Player * play, const gchar * uri) gchar *loc; if (gst_uri_has_protocol (uri, file)) loc = g_filename_from_uri (uri, NULL, NULL); else if (gst_uri_has_protocol (uri, pushfile)) loc = g_filename_from_uri (uri + 4, NULL, NULL); else loc = g_strdup (uri); /* Maybe additionally use glibs filename to display name function */ return loc;static voidplay_uri (Player * play, const gchar * next_uri) gchar *loc; play_reset (play); loc = play_uri_get_display_name (play, next_uri); gst_print (Now playing %s , loc); g_free (loc); g_object_set (play-player, uri, next_uri, NULL); gst_play_play (play-player);/* returns FALSE if we have reached the end of the playlist */static gbooleanplay_next (Player * play) if ((play-cur_idx + 1) = play-num_uris) if (play-repeat) gst_print (Looping playlist ); play-cur_idx = -1; else return FALSE; play_uri (play, play-uris[++play-cur_idx]); return TRUE;/* returns FALSE if we have reached the beginning of the playlist */static gbooleanplay_prev (Player * play) if (play-cur_idx == 0 || play-num_uris = 1) return FALSE; play_uri (play, play-uris[--play-cur_idx]); return TRUE;static voiddo_play (Player * play) gint i; /* dump playlist */ for (i = 0; i play-num_uris; ++i) GST_INFO (%4u : %s, i, play-uris[i]); if (!play_next (play)) return; g_main_loop_run (play-loop);static voidadd_to_playlist (GPtrArray * playlist, const gchar * filename) GDir *dir; gchar *uri; if (gst_uri_is_valid (filename)) g_ptr_array_add (playlist, g_strdup (filename)); return; if ((dir = g_dir_open (filename, 0, NULL))) const gchar *entry; /* FIXME: sort entries for each directory? */ while ((entry = g_dir_read_name (dir))) gchar *path; path = g_strconcat (filename, G_DIR_SEPARATOR_S, entry, NULL); add_to_playlist (playlist, path); g_free (path); g_dir_close (dir); return; uri = gst_filename_to_uri (filename, NULL); if (uri != NULL) g_ptr_array_add (playlist, uri); else g_warning (Could not make URI out of filename %s, filename);static voidshuffle_uris (gchar ** uris, guint num) gchar *tmp; guint i, j; if (num 2) return; for (i = 0; i num; i++) /* gets equally distributed random number in 0..num-1 [0;num[ */ j = g_random_int_range (0, num); tmp = uris[j]; uris[j] = uris[i]; uris[i] = tmp; static voidrestore_terminal (void) gst_play_kb_set_key_handler (NULL, NULL);static voidtoggle_paused (Player * play) if (play-desired_state == GST_STATE_PLAYING) play-desired_state = GST_STATE_PAUSED; gst_play_pause (play-player); else play-desired_state = GST_STATE_PLAYING; gst_play_play (play-player); static voidrelative_seek (Player * play, gdouble percent) gint64 dur = -1, pos = -1; g_return_if_fail (percent = -1.0 percent = 1.0); g_object_get (play-player, position, pos, duration, dur, NULL); if (dur = 0) gst_print ( Could not seek. ); return; pos = pos + dur * percent; if (pos 0) pos = 0; gst_play_seek (play-player, pos);static voidkeyboard_cb (const gchar * key_input, gpointer user_data) Player *play = (Player *) user_data; switch (g_ascii_tolower (key_input[0])) case i: GstPlayMediaInfo *media_info = gst_play_get_media_info (play-player); if (media_info) print_media_info (media_info); g_object_unref (media_info); print_current_tracks (play); break; case : toggle_paused (play); break; case q: case Q: g_main_loop_quit (play-loop); break; case : if (!play_next (play)) gst_print ( Reached end of play list. ); g_main_loop_quit (play-loop); break; case : play_prev (play); break; case 27: /* ESC */ if (key_input[1] == \\0) g_main_loop_quit (play-loop); break; /* fall through */ default: if (strcmp (key_input, GST_PLAY_KB_ARROW_RIGHT) == 0) relative_seek (play, +0.08); else if (strcmp (key_input, GST_PLAY_KB_ARROW_LEFT) == 0) relative_seek (play, -0.01); else if (strcmp (key_input, GST_PLAY_KB_ARROW_UP) == 0) play_set_relative_volume (play, +1.0 / VOLUME_STEPS); else if (strcmp (key_input, GST_PLAY_KB_ARROW_DOWN) == 0) play_set_relative_volume (play, -1.0 / VOLUME_STEPS); else GST_INFO (keyboard input:); for (; *key_input != \\0; ++key_input) GST_INFO ( code %3d, *key_input); break; intmain (int argc, char **argv) Player *play; GPtrArray *playlist; gboolean print_version = FALSE; gboolean interactive = FALSE; /* FIXME: maybe enable by default? */ gboolean shuffle = FALSE; gboolean repeat = FALSE; gdouble volume = 1.0; gchar **filenames = NULL; gchar **uris; guint num, i; GError *err = NULL; GOptionContext *ctx; gchar *playlist_file = NULL; GOptionEntry options[] = version, 0, 0, G_OPTION_ARG_NONE, print_version, Print version information and exit, NULL, shuffle, 0, 0, G_OPTION_ARG_NONE, shuffle, Shuffle playlist, NULL, interactive, 0, 0, G_OPTION_ARG_NONE, interactive, Interactive control via keyboard, NULL, volume, 0, 0, G_OPTION_ARG_DOUBLE, volume, Volume, NULL, playlist, 0, 0, G_OPTION_ARG_FILENAME, playlist_file, Playlist file containing input media files, NULL, loop, 0, 0, G_OPTION_ARG_NONE, repeat, Repeat all, NULL, G_OPTION_REMAINING, 0, 0, G_OPTION_ARG_FILENAME_ARRAY, filenames, NULL, NULL ; g_set_prgname (gst-play); ctx = g_option_context_new (FILE1|URI1 [FILE2|URI2] [FILE3|URI3] ...); g_option_context_add_main_entries (ctx, options, NULL); g_option_context_add_group (ctx, gst_init_get_option_group ()); if (!g_option_context_parse (ctx, argc, argv, err)) gst_print (Error initializing: %s , GST_STR_NULL (err-message)); g_clear_error (err); g_option_context_free (ctx); return 1; g_option_context_free (ctx); GST_DEBUG_CATEGORY_INIT (play_debug, play, 0, gst-play); if (print_version) gchar *version_str; version_str = gst_version_string (); gst_print (%s version %s , g_get_prgname (), 1.0); gst_print (%s , version_str); g_free (version_str); g_free (playlist_file); return 0; playlist = g_ptr_array_new (); if (playlist_file != NULL) gchar *playlist_contents = NULL; gchar **lines = NULL; if (g_file_get_contents (playlist_file, playlist_contents, NULL, err)) lines = g_strsplit (playlist_contents, , 0); num = g_strv_length (lines); for (i = 0; i num; i++) if (lines[i][0] != \\0) GST_LOG (Playlist[%d]: %s, i + 1, lines[i]); add_to_playlist (playlist, lines[i]); g_strfreev (lines); g_free (playlist_contents); else gst_printerr (Could not read playlist: %s , err-message); g_clear_error (err); g_free (playlist_file); playlist_file = NULL; if (playlist-len == 0 (filenames == NULL || *filenames == NULL)) gst_printerr (Usage: %s FILE1|URI1 [FILE2|URI2] [FILE3|URI3] ..., gst-play); gst_printerr ( ), gst_printerr (%s , You must provide at least one filename or URI to play.); /* No input provided. Free array */ g_ptr_array_free (playlist, TRUE); return 1; /* fill playlist */ if (filenames != NULL *filenames != NULL) num = g_strv_length (filenames); for (i = 0; i num; ++i) GST_LOG (command line argument: %s, filenames[i]); add_to_playlist (playlist, filenames[i]); g_strfreev (filenames); num = playlist-len; g_ptr_array_add (playlist, NULL); uris = (gchar **) g_ptr_array_free (playlist, FALSE); if (shuffle) shuffle_uris (uris, num); /* prepare */ play = play_new (uris, volume); play-repeat = repeat; if (interactive) if (gst_play_kb_set_key_handler (keyboard_cb, play)) atexit (restore_terminal); else gst_print (Interactive keyboard handling in terminal not available. ); /* play */ do_play (play); /* clean up */ play_free (play); gst_print ( ); gst_deinit (); return 0; è°ƒç”¨ ALSA å’Œ PCM æ’­æ”¾#include alsa/asoundlib.h#include iostream#include cstdint#include unistd.h#include fstream#pragma pack(1)struct WavHeader uint32_t id; uint32_t chunk_size; uint32_t form_type; uint32_t fmt; uint32_t subchunk_size; uint16_t audio_format; uint16_t channel_nums; uint32_t sample_rate; uint32_t byte_rate; uint16_t block_align; uint16_t bits_per_sample; uint32_t data; uint32_t data_size;;#pragma pack()void set_master_volume(long volume) long min, max; snd_mixer_t *handle; snd_mixer_selem_id_t *sid; const char *card = default; const char *selem_name = Master; snd_mixer_open(handle, 0); snd_mixer_attach(handle, card); snd_mixer_selem_register(handle, NULL, NULL); snd_mixer_load(handle); snd_mixer_selem_id_alloca(sid); snd_mixer_selem_id_set_index(sid, 0); snd_mixer_selem_id_set_name(sid, selem_name); snd_mixer_elem_t* elem = snd_mixer_find_selem(handle, sid); snd_mixer_selem_get_playback_volume_range(elem, min, max); snd_mixer_selem_set_playback_volume_all(elem, volume * max / 100); snd_mixer_close(handle);int main(int argc, char **argv) if(argc 2) std::cout std::string(argv[0]) wav_file_path std::endl; return -1; std::string wav_file_name(argv[1]); if(access(wav_file_name.c_str(), F_OK) != 0) std::cout File ( wav_file_name ) not exist! std::endl; return -1; // open wav file std::fstream wav(wav_file_name, std::ios_base::in|std::ios::binary ); if(wav.fail()) std::cout wav_file_name open failed! std::endl; return -1; // parse wav file WavHeader wav_header; wav.read((char*)wav_header, sizeof(wav_header)); if(wav.fail()) std::cout Read file failed! std::endl; return -1; if(wav_header.id != (uint32_t)0x46464952 or wav_header.fmt != (u_int32_t)0x20746d66 \\ or wav_header.audio_format != 1) std::cout std::hex wav_header.id std::endl; std::cout std::hex wav_header.fmt std::endl; std::cout std::hex wav_header.data std::endl; std::cout audio format: wav_header.audio_format std::endl; // audio format ä¸º1 è¡¨ç¤º std::cout File format error! std::endl; return -1; //summary std::cout sample_rate: wav_header.sample_rate std::endl; std::cout bit per sample: wav_header.bits_per_sample std::endl; std::cout channel nums: wav_header.channel_nums std::endl; set_master_volume(99); // 99% // play audio int err; unsigned int i; snd_pcm_t *handle; snd_pcm_sframes_t frames; std::string device(default); unsigned char buffer[512]; if ((err = snd_pcm_open(handle, device.c_str(), SND_PCM_STREAM_PLAYBACK, 0)) 0) printf(Playback open error: %s , snd_strerror(err)); exit(EXIT_FAILURE); snd_pcm_format_t pcm_format; switch (wav_header.bits_per_sample) case 8: pcm_format = SND_PCM_FORMAT_S8; break; case 16: pcm_format = SND_PCM_FORMAT_S16_LE; break; case 32: pcm_format = SND_PCM_FORMAT_S32_LE; break; default: break; if ((err = snd_pcm_set_params(handle, pcm_format, SND_PCM_ACCESS_RW_INTERLEAVED, wav_header.channel_nums, wav_header.sample_rate, 1, 500000)) 0) /* 0.5sec */ printf(Playback open error: %s , snd_strerror(err)); exit(EXIT_FAILURE); while (true) wav.read((char *)buffer, 512); if(wav.gcount() = 0) std::cout END std::endl; break; frames = snd_pcm_writei(handle, buffer, wav.gcount()/(wav_header.bits_per_sample * 2 / 8)); if (frames 0) frames = snd_pcm_recover(handle, frames, 0); if (frames 0) printf(snd_pcm_writei failed: %s , snd_strerror(frames)); break; if(wav.gcount() != 512) std::cout END std::endl; break; /* pass the remaining samples, otherwise theyre dropped in close */ err = snd_pcm_drain(handle); if (err 0) printf(snd_pcm_drain failed: %s , snd_strerror(err)); snd_pcm_close(handle);","categories":["6.å¼€å‘å·¥å…·","éŸ³è§†é¢‘"]},{"title":"ä¸²å£ç»ˆç«¯è½¯ä»¶picocomåŠputtyçš„å®‰è£…å’Œé…ç½®","path":"/2023/08/22/4-é€šè®¯åè®®-ä¸²å£-ä¸²å£ç»ˆç«¯è½¯ä»¶picocomåŠputtyçš„å®‰è£…å’Œé…ç½®/","content":"ä¸²å£å’Œç»ˆç«¯è½¯ä»¶ä»€ä¹ˆæ˜¯ä¸²å£å·¥å…·æ¥æ”¶å’Œå‘é€åˆ†å¼€ï¼Œåªæœ‰ç‚¹å‡»å‘é€æ—¶ï¼Œæ‰å°†æ•°æ®å‘é€ï¼Œä¸€èˆ¬ç”¨äºä¸²å£æ•°æ®è°ƒè¯• ä»€ä¹ˆæ˜¯ç»ˆç«¯å·¥å…·ç»ˆç«¯å·¥å…·çš„è¿æ¥æ–¹å¼å¤šç§å¤šæ ·ï¼ŒåŒ…å«ä¸²å£ï¼ŒSSHï¼Œtelnet ç­‰æ–¹å¼ï¼Œä¸€èˆ¬ç”¨äºç™»å½•æœåŠ¡å™¨ï¼Œè¿›è¡Œå‘½ä»¤è¡Œæ“ä½œ putty åœ¨ Ubuntu ç¯å¢ƒä¸‹çš„ç¦»çº¿å®‰è£…å’Œé…ç½®ç”±äºæœ¬æ¬¡å®‰è£… putty éœ€è¦åœ¨å†…ç½‘ç¯å¢ƒä¸­å®‰è£…ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡ç¦»çº¿æ–¹å¼å®‰è£…ï¼Œå¦‚æœå¯ä»¥é€šè¿‡åœ¨çº¿æ–¹å¼å®‰è£…æ—¶ï¼Œåªéœ€è¦è¾“å…¥ sudo apt install putty è¿›è¡Œå®‰è£…å³å¯ã€‚ ä¸‹è½½ç¦»çº¿å®‰è£…åŒ…ï¼Œè¿›å…¥å®˜ç½‘åé€‰æ‹© Download PuTTYï¼Œä¸‹æ‹‰æ‰¾åˆ° Unix source archive,å½“å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯ putty-0.78.tar.gz puttyå®˜æ–¹ä¸‹è½½åœ°å€ ä» 0.77 ç‰ˆæœ¬å¼€å§‹å®˜æ–¹æ”¹ç”¨ CMake æ„å»º ä» 0.78 ç‰ˆæœ¬å¼€å§‹å¢åŠ  Github actions è‡ªåŠ¨ç¼–è¯‘è„šæœ¬ï¼Œæ–¹ä¾¿ç›´æ¥åœ¨çº¿ç¼–è¯‘ 2.ç”±äºæ˜¯ç¦»çº¿é…ç½®ï¼Œæ‰€ä»¥åœ¨æœ¬åœ°ç¼–è¯‘ï¼Œä½¿ç”¨ CMake è¿›è¡Œæ„å»ºå³å¯ è§£å‹å‹ç¼©åŒ… tar xvf putty-0.78.tar.gz è¿›å…¥ç›®å½• cd putty-0.78 æ‰§è¡Œ cmake cmake . æ‰§è¡Œå®Œæˆåæ˜¾ç¤º åœ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ„å»º cmake --build . æ‰§è¡Œå®Œæˆåæ˜¾ç¤º å®‰è£… cmake --build . --target install æ­¤å¤„æ¨èä¸€ä¸ª æ±‰åŒ–putty çš„å¼€æºä»“åº“,æœ‰å…´è¶£å¯ä»¥å°è¯• picocom åœ¨ Ubuntu ç¯å¢ƒä¸‹çš„ç¦»çº¿å®‰è£…å’Œé…ç½®picocomä¸‹è½½åœ°å€1.åˆ‡æ¢åˆ° piccocom çš„æºç›®å½• make 2.è¿›è¡Œç˜¦èº«ï¼ˆéå¿…è¦ï¼‰ strip picocom 3.ç§»åŠ¨åˆ° /usr/bin ç›®å½•ä¸‹ä½¿å¾—å¯ä»¥åœ¨ä»»æ„å¤„æ‰§è¡Œå‘½ä»¤ï¼ˆéå¿…è¦ï¼‰ ä½¿ç”¨æ–¹å¼æ‰§è¡Œ picocom -b 115200 -f h /dev/ttyS0 æŒ‡å®šæ³¢ç‰¹ç‡,ä¸²å£ï¼Œæµæ§","categories":["4.é€šè®¯åè®®","ä¸²å£"]},{"title":"WireSharkçš„å®‰è£…","path":"/2023/05/25/6-å¼€å‘å·¥å…·-æ•ˆç‡å·¥å…·-WireShark-WireSharkçš„å®‰è£…/","content":"WireSharké‡ç‚¹æ¼”ç¤ºï¼š å¦‚ä½•é€‰æ‹©ç½‘å¡æ¥å£ å¦‚ä½•è®¾ç½®è¿‡æ»¤æ¡ä»¶ å¦‚ä½•æŸ¥çœ‹æŠ“å–çš„æŠ¥æ–‡ Linux ä¸‹å®‰è£…å’Œé…ç½®å®‰è£…sudo apt-get install wireshark è®¾ç½®è¿è¡Œæƒé™å¦‚æœåœ¨æ­¤é˜¶æ®µä»¥é root ç”¨æˆ·èº«ä»½è¿è¡Œ wiresharkï¼Œå°†æ”¶åˆ°æ¶ˆæ¯â€æ²¡æœ‰æ¥å£å¯ä»¥ç”¨äºåœ¨å½“å‰é…ç½®çš„ç³»ç»Ÿä¸­è¿›è¡Œæ•è·ã€‚â€ ç¼ºçœåœ¨é root è´¦å·ä¸‹è¿è¡Œä¼šå‘ç°çœ‹ä¸è§ interface ä¿¡æ¯ Create the wiresharkgroup. sudo groupadd wireshark Add your username to the wiresharkgroup sudo usermod -a -G wiresharkYOUR_USER_NAME Change the group ownership of file dumpcap to wireshark sudo chgrp wireshark/usr/bin/dumpcap Change the mode of the file dumpcap to allow execution bythe group wireshark sudo chmod 750 /usr/bin/dumpcap Grant capabilities with setcap, man capabilities(7), setcap(8), cap_from_text(3) for more info about what are â€œcap_net_rawâ€, â€œcap_net_adminâ€ and â€œeipâ€. Anyway, after we grant the capabilities, the dump can perform various network-related operations, use RAW and PACKET sockets; bind to anyaddressfor transparent proxying. sudo setcap cap_net_raw,cap_net_admin=eip /usr/bin/dumpcap Verifythe change sudo getcap /usr/bin/dumpcap Outputshould be like below: /usr/bin/dumpcap = cap_net_admin,cap_net_raw+eip At this point, you will need to log out, then backinto ubuntu ç®€å•ä»‹ç»ä¸‹è¿™ä¸ªè½¯ä»¶çš„ä¸€äº›å¸¸ç”¨æŒ‰é’®ï¼Œç®€å•çš„è¯´ä¸‹æœ€å¸¸ç”¨çš„æŒ‰é’®ï¼Œæ‰“å¼€è½¯ä»¶åï¼Œä¸‹é¢çº¢æ¡†ä¸­çš„æŒ‰é’®ä»å·¦åˆ°å³ä¾æ¬¡æ˜¯ï¼š -1 åˆ—è¡¨æ˜¾ç¤ºæ‰€æœ‰ç½‘å¡çš„ç½‘ç»œåŒ…æƒ…å†µï¼Œä¸€èˆ¬ç”¨çš„å¾ˆå°‘ï¼› -2 æ˜¾ç¤ºæŠ“åŒ…é€‰é¡¹ï¼Œä¸€èˆ¬éƒ½æ˜¯ç‚¹è¿™ä¸ªæŒ‰é’®å¼€å§‹æŠ“åŒ…ï¼› -3 å¼€å§‹æ–°çš„æŠ“åŒ…ï¼Œä¸€èˆ¬ç”¨çš„ä¹Ÿå¾ˆå°‘ï¼› -4 åœæ­¢æŠ“åŒ…ï¼Œå½“æŠ“å®ŒåŒ…ä¹‹åï¼Œå°±æ˜¯ç‚¹è¿™ä¸ªåœæ­¢äº†ï¼› -5 æ¸…ç©ºå½“å‰å·²ç»æŠ“åˆ°çš„æ•°æ®åŒ…ï¼Œå¯ä»¥é˜²æ­¢æŠ“åŒ…æ—¶é—´è¿‡é•¿æœºå™¨å˜å¡ï¼› è€Œå®é™…ä¸Šï¼Œä¸€èˆ¬åªè¦çŸ¥é“ä¸Šé¢åŠ ç²—éƒ¨åˆ†çš„æŒ‰é’®åŠŸèƒ½ï¼Œå°±å¯ä»¥å®ŒæˆæŠ“åŒ…äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯å¦‚ä½•æŠ“æƒ³è¦çš„æ•°æ®åŒ…ï¼Œå¦‚ä½•åˆ†æçš„é—®é¢˜äº†ã€‚ æ¥ä¸‹æ¥è¯´ä¸‹æŠ“åŒ…é€‰é¡¹ç•Œé¢ï¼Œä¹Ÿå°±æ˜¯ç‚¹ç¬¬äºŒä¸ªæŒ‰é’®å‡ºæ¥çš„ç•Œé¢ï¼ŒåŒæ ·ï¼Œè¿™é‡Œä¹Ÿåªä»‹ç»æœ€å¸¸ç”¨çš„å‡ ä¸ªåŠŸèƒ½ï¼Œé¦–å…ˆä¸‹å›¾ä¸­æœ€ä¸Šé¢çš„çº¢æ¡†æ˜¯é€‰æ‹©éœ€è¦æŠ“çš„ç½‘å¡ï¼Œé€‰æ‹©å¥½ç½‘å¡åä¼šåœ¨ä¸‹é¢æ˜¾ç¤ºè¿™ä¸ªç½‘å¡çš„ IP åœ°å€ã€‚ ç„¶å Capture Filter ä¸­å°±æ˜¯è¦å†™æŠ“åŒ…è§„åˆ™çš„åœ°æ–¹ï¼Œä¹Ÿå«åšâ€è¿‡æ»¤è§„åˆ™â€ï¼Œä¸‹é¢è¦è¯´çš„å¾ˆå¤šè§„åˆ™éƒ½æ˜¯è¦å†™åˆ°è¿™ä¸ªæ¡†é‡Œçš„ï¼Œè§„åˆ™å†™å¥½åï¼Œç‚¹ä¸‹ é¢çš„ Start å°±å¼€å§‹æŠ“åŒ…äº†ã€‚ å½“æŠ“åŒ…ç»“æŸä¹‹åï¼Œå¦‚æœéœ€è¦æŠŠæŠ“åˆ°çš„æ•°æ®åŒ…æ‰¾å…¶ä»–äººåˆ†æï¼Œé‚£ä¹ˆå¯ä»¥ç‚¹èœå•ä¸Šçš„ fileï¼Œç„¶åç‚¹ Save As ä¿å­˜æŠ“åˆ°çš„æ•°æ®åŒ… ä½¿ç”¨ Wireshark æ—¶æœ€å¸¸è§çš„é—®é¢˜ï¼Œæ˜¯å½“ä½¿ç”¨é»˜è®¤è®¾ç½®æ—¶ï¼Œä¼šå¾—åˆ°å¤§é‡å†—ä½™ä¿¡æ¯ï¼Œä»¥è‡³äºå¾ˆéš¾æ‰¾åˆ°è‡ªå·±éœ€è¦çš„éƒ¨åˆ†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿‡æ»¤å™¨ä¼š å¦‚æ­¤é‡è¦ã€‚å®ƒä»¬å¯ä»¥å¸®åŠ©åœ¨åºæ‚çš„ç»“æœä¸­è¿…é€Ÿæ‰¾åˆ°éœ€è¦çš„ä¿¡æ¯ã€‚ ä¸‰æ¬¡æ¡æ‰‹ Three-way Handshakeä¸€ä¸ªè™šæ‹Ÿè¿æ¥çš„å»ºç«‹æ˜¯é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹æ¥å®ç°çš„ (Client) â€“ [SYN] â€“ (Server)å‡å¦‚ Client å’Œ Server é€šè®¯. å½“ Client è¦å’Œ Server é€šä¿¡æ—¶ï¼ŒClient é¦–å…ˆå‘ Server å‘ä¸€ä¸ª SYN (Synchronize) æ ‡è®°çš„åŒ…ï¼Œå‘Šè¯‰ Server è¯·æ±‚å»ºç«‹è¿æ¥.æ³¨æ„: ä¸€ä¸ª SYN åŒ…å°±æ˜¯ä»… SYN æ ‡è®°è®¾ä¸º 1 çš„ TCP åŒ… (å‚è§ TCP åŒ…å¤´ Resources). è®¤è¯†åˆ°è¿™ç‚¹å¾ˆé‡è¦ï¼Œåªæœ‰å½“ Server æ”¶åˆ° Client å‘æ¥çš„ SYN åŒ…ï¼Œæ‰å¯å»ºç«‹è¿æ¥ï¼Œé™¤æ­¤ä¹‹å¤–åˆ«æ— ä»–æ³•ã€‚å› æ­¤ï¼Œå¦‚æœçš„é˜²ç«å¢™ä¸¢å¼ƒæ‰€æœ‰çš„å‘å¾€å¤–ç½‘æ¥å£çš„ SYN åŒ…ï¼Œé‚£ä¹ˆå°†ä¸ èƒ½è®©å¤–éƒ¨ä»»ä½•ä¸»æœºä¸»åŠ¨å»ºç«‹è¿æ¥ã€‚ (Client) â€“ [SYNACK] â€“(Server)æ¥ç€ï¼ŒServer æ”¶åˆ°æ¥è‡ª Client å‘æ¥çš„ SYN åŒ…åï¼Œä¼šå‘ä¸€ä¸ªå¯¹ SYN åŒ…çš„ç¡®è®¤åŒ… (SYNACK) ç»™ Clientï¼Œè¡¨ç¤ºå¯¹ç¬¬ä¸€ä¸ª SYN åŒ…çš„ç¡®è®¤ï¼Œå¹¶ç»§ç»­æ¡æ‰‹æ“ä½œ.æ³¨æ„: SYNACK åŒ…æ˜¯ä»… SYN å’Œ ACK æ ‡è®°ä¸º 1 çš„åŒ…. (Client) â€“ [ACK] â€“ (Server)Client æ”¶åˆ°æ¥è‡ª Server çš„ SYNACK åŒ…,Client ä¼šå†å‘ Server å‘ä¸€ä¸ªç¡®è®¤åŒ… (ACK)ï¼Œé€šçŸ¥ Server è¿æ¥å·²å»ºç«‹ã€‚è‡³æ­¤ï¼Œä¸‰æ¬¡æ¡æ‰‹å®Œæˆï¼Œä¸€ä¸ª TCP è¿æ¥å®Œæˆã€‚Note: ACK åŒ…å°±æ˜¯ä»… ACK æ ‡è®°è®¾ä¸º 1 çš„ TCP åŒ…. éœ€è¦æ³¨æ„çš„æ˜¯å½“ä¸‰æ­¤æ¡æ‰‹å®Œæˆã€è¿æ¥å»ºç«‹ä»¥åï¼ŒTCP è¿æ¥çš„æ¯ä¸ªåŒ…éƒ½ä¼šè®¾ç½® ACK ä½ã€‚ è¿™å°±æ˜¯ä¸ºä½•è¿æ¥è·Ÿè¸ªå¾ˆé‡è¦çš„åŸå› äº†. æ²¡æœ‰è¿æ¥è·Ÿè¸ª,é˜²ç«å¢™å°†æ— æ³•åˆ¤æ–­æ”¶åˆ°çš„ ACK åŒ…æ˜¯å¦å±äºä¸€ä¸ªå·²ç»å»ºç«‹çš„è¿æ¥.ä¸€èˆ¬çš„åŒ…è¿‡æ»¤ (Ipchains) æ”¶åˆ° ACK åŒ…æ—¶,ä¼šè®©å®ƒé€šè¿‡ (è¿™ç»å¯¹ä¸æ˜¯ä¸ª å¥½ä¸»æ„). è€Œå½“çŠ¶æ€å‹é˜²ç«å¢™æ”¶åˆ°æ­¤ç§åŒ…æ—¶ï¼Œå®ƒä¼šå…ˆåœ¨è¿æ¥è¡¨ä¸­æŸ¥æ‰¾æ˜¯å¦å±äºå“ªä¸ªå·²å»ºè¿æ¥ï¼Œå¦åˆ™ä¸¢å¼ƒè¯¥åŒ…ã€‚ å››æ¬¡æ¡æ‰‹ Four-way Handshake å››æ¬¡æ¡æ‰‹ç”¨æ¥å…³é—­å·²å»ºç«‹çš„ TCP è¿æ¥ (Client) â€“ ACKFIN â€“ (Server) (Client) â€“ ACK â€“ (Server) (Client) â€“ ACKFIN â€“ (Server) (Client) â€“ ACK â€“ (Server)æ³¨æ„: ç”±äº TCP è¿æ¥æ˜¯åŒå‘è¿æ¥, å› æ­¤å…³é—­è¿æ¥éœ€è¦åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šåšã€‚**ACKFIN åŒ… (ACK å’Œ FIN æ ‡è®°è®¾ä¸º 1) é€šå¸¸è¢«è®¤ä¸ºæ˜¯ FIN(ç»ˆç»“) åŒ….**ç„¶è€Œ, ç”±äºè¿æ¥è¿˜æ²¡æœ‰å…³é—­, FIN åŒ…æ€»æ˜¯æ‰“ä¸Š ACK æ ‡è®°. æ²¡æœ‰ ACK æ ‡è®°è€Œä»…æœ‰ FIN æ ‡è®°çš„åŒ…ä¸æ˜¯åˆæ³•çš„åŒ…ï¼Œå¹¶ä¸”é€šå¸¸è¢«è®¤ä¸ºæ˜¯æ¶æ„çš„ã€‚ è¿æ¥å¤ä½ Resetting a connectionå››æ¬¡æ¡æ‰‹ä¸æ˜¯å…³é—­ TCP è¿æ¥çš„å”¯ä¸€æ–¹æ³•. æœ‰æ—¶,å¦‚æœä¸»æœºéœ€è¦å°½å¿«å…³é—­è¿æ¥ (æˆ–è¿æ¥è¶…æ—¶,ç«¯å£æˆ–ä¸»æœºä¸å¯è¾¾),RST(Reset) åŒ…å°†è¢«å‘é€. æ³¨æ„åœ¨ï¼Œç”±äº RST åŒ…ä¸æ˜¯ TCP è¿æ¥ä¸­çš„å¿…é¡»éƒ¨åˆ†, å¯ä»¥åªå‘é€ RST åŒ… (å³ä¸å¸¦ ACK æ ‡è®°). ä½†åœ¨æ­£å¸¸çš„ TCP è¿æ¥ä¸­ RST åŒ…å¯ä»¥å¸¦ ACK ç¡®è®¤æ ‡è®° è¯·æ³¨æ„ RST åŒ…æ˜¯å¯ä»¥ä¸è¦æ”¶åˆ°æ–¹ç¡®è®¤çš„? æ— æ•ˆçš„ TCP æ ‡è®° Invalid TCP Flags åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå·²ç»çœ‹åˆ°äº† SYN, ACK, FIN, å’Œ RST æ ‡è®°. å¦å¤–ï¼Œè¿˜æœ‰ PSH (Push) å’Œ URG (Urgent) æ ‡è®°. æœ€å¸¸è§çš„éæ³•ç»„åˆæ˜¯ SYNFIN åŒ…. æ³¨æ„: ç”±äº SYN åŒ…æ˜¯ç”¨æ¥åˆå§‹åŒ–è¿æ¥çš„, å®ƒä¸å¯èƒ½å’Œ FIN å’Œ RST æ ‡è®°ä¸€èµ·å‡ºç°. è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ¶æ„æ”»å‡». ç”±äºç°åœ¨å¤§å¤šæ•°é˜²ç«å¢™å·²çŸ¥ SYNFIN åŒ…, åˆ«çš„ä¸€äº›ç»„åˆ,ä¾‹å¦‚ SYNFINPSH, SYNFINRST, SYNFINRSTPSHã€‚å¾ˆæ˜æ˜¾ï¼Œå½“ç½‘ç»œä¸­å‡ºç°è¿™ç§åŒ…æ—¶ï¼Œå¾ˆçš„ç½‘ç»œè‚¯å®šå—åˆ°æ”»å‡»äº†ã€‚ åˆ«çš„å·²çŸ¥çš„éæ³•åŒ…æœ‰ FIN (æ—  ACK æ ‡è®°) å’Œâ€NULLâ€åŒ…ã€‚å¦‚åŒæ—©å…ˆè®¨è®ºçš„ï¼Œç”±äº ACKFIN åŒ…çš„å‡ºç°æ˜¯ä¸ºäº†å…³é—­ä¸€ä¸ª TCP è¿æ¥ï¼Œé‚£ä¹ˆæ­£å¸¸çš„ FIN åŒ…æ€»æ˜¯å¸¦æœ‰ ACK æ ‡è®°ã€‚â€NULLâ€åŒ…å°±æ˜¯æ²¡æœ‰ä»»ä½• TCP æ ‡è®°çš„åŒ… (URG,ACK,PSH,RST,SYN,FIN éƒ½ä¸º 0)ã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ­£å¸¸çš„ç½‘ç»œæ´»åŠ¨ä¸‹ï¼ŒTCP åè®®æ ˆä¸å¯èƒ½äº§ç”Ÿå¸¦æœ‰ä¸Šé¢æåˆ°çš„ä»»ä½•ä¸€ç§æ ‡è®°ç»„åˆçš„ TCP åŒ…ã€‚å½“å‘ç°è¿™äº›ä¸æ­£å¸¸çš„åŒ…æ—¶ï¼Œè‚¯å®šæœ‰äººå¯¹çš„ç½‘ç»œä¸æ€€å¥½æ„ã€‚ UDP (ç”¨æˆ·æ•°æ®åŒ…åè®® User DatagramProtocol)TCP æ˜¯é¢å‘è¿æ¥çš„ï¼Œè€Œ UDP æ˜¯éè¿æ¥çš„åè®®ã€‚UDP æ²¡æœ‰å¯¹æ¥å—è¿›è¡Œç¡®è®¤çš„æ ‡è®°å’Œç¡®è®¤æœºåˆ¶ã€‚å¯¹ä¸¢åŒ…çš„å¤„ç†æ˜¯åœ¨åº”ç”¨å±‚æ¥å®Œæˆçš„ã€‚(or accidentalarrival).æ­¤å¤„éœ€è¦é‡ç‚¹æ³¨æ„çš„äº‹æƒ…æ˜¯ï¼šåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“ UDP åŒ…åˆ°è¾¾ä¸€ä¸ªå…³é—­çš„ç«¯å£æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ª UDP å¤ä½åŒ…ã€‚ç”±äº UDP æ˜¯éé¢å‘è¿æ¥çš„, å› æ­¤æ²¡æœ‰ä»»ä½•ç¡®è®¤ä¿¡æ¯æ¥ç¡®è®¤åŒ…æ˜¯å¦æ­£ç¡®åˆ°è¾¾ç›®çš„åœ°ã€‚å› æ­¤å¦‚æœçš„é˜²ç«å¢™ä¸¢å¼ƒ UDP åŒ…ï¼Œå®ƒä¼šå¼€æ”¾æ‰€æœ‰çš„ UDP ç«¯å£ (?)ã€‚ ç”±äº Internet ä¸Šæ­£å¸¸æƒ…å†µä¸‹ä¸€äº›åŒ…å°†è¢«ä¸¢å¼ƒï¼Œç”šè‡³æŸäº›å‘å¾€å·²å…³é—­ç«¯å£ (éé˜²ç«å¢™çš„) çš„ UDP åŒ…å°†ä¸ä¼šåˆ°è¾¾ç›®çš„ï¼Œå®ƒä»¬å°†è¿”å›ä¸€ä¸ªå¤ä½ UDP åŒ…ã€‚ å› ä¸ºè¿™ä¸ªåŸå› ï¼ŒUDP ç«¯å£æ‰«ææ€»æ˜¯ä¸ç²¾ç¡®ã€ä¸å¯é çš„ã€‚ çœ‹èµ·æ¥å¤§ UDP åŒ…çš„ç¢ç‰‡æ˜¯å¸¸è§çš„ DOS(Denial ofService) æ”»å‡»çš„å¸¸è§å½¢å¼ (è¿™é‡Œæœ‰ä¸ª DOS æ”»å‡»çš„ä¾‹å­ï¼Œhttp://grc.com/dos/grcdos.htm ). ICMP (ç½‘é—´æ§åˆ¶æ¶ˆæ¯åè®® Internet ControlMessage Protocol)å¦‚åŒåå­—ä¸€æ ·ï¼Œ ICMP ç”¨æ¥åœ¨ä¸»æœºè·¯ç”±å™¨ä¹‹é—´ä¼ é€’æ§åˆ¶ä¿¡æ¯çš„åè®®ã€‚ ICMP åŒ…å¯ä»¥åŒ…å«è¯Šæ–­ä¿¡æ¯ (ping, traceroute - æ³¨æ„ç›®å‰ unix ç³»ç»Ÿä¸­çš„ traceroute ç”¨ UDP åŒ…è€Œä¸æ˜¯ ICMP)ï¼Œé”™è¯¯ä¿¡æ¯ (ç½‘ç»œä¸»æœºç«¯å£ ä¸å¯è¾¾ networkhostport unreachable), ä¿¡æ¯ (æ—¶é—´æˆ³ timestamp, åœ°å€æ©ç  addressmaskrequest, etc.)ï¼Œæˆ–æ§åˆ¶ä¿¡æ¯ (source quench, redirect, etc.) ã€‚ å¯ä»¥åœ¨ http://www.iana.org/assignments/icmp-parameters ä¸­æ‰¾åˆ° ICMP åŒ…çš„ç±»å‹ã€‚ å°½ç®¡ ICMP é€šå¸¸æ˜¯æ— å®³çš„ï¼Œè¿˜æ˜¯æœ‰äº›ç±»å‹çš„ ICMP ä¿¡æ¯éœ€è¦ä¸¢å¼ƒã€‚ Redirect (5), Alternate Host Address(6), Router Advertisement (9) èƒ½ç”¨æ¥è½¬å‘é€šè®¯ã€‚ Echo (8), Timestamp (13)and AddressMask Request (17) èƒ½ç”¨æ¥åˆ†åˆ«åˆ¤æ–­ä¸»æœºæ˜¯å¦èµ·æ¥ï¼Œæœ¬åœ°æ—¶é—´ å’Œåœ°å€æ©ç ã€‚æ³¨æ„å®ƒä»¬æ˜¯å’Œè¿”å›çš„ä¿¡æ¯ç±»åˆ«æœ‰å…³çš„ã€‚ å®ƒä»¬è‡ªå·±æœ¬èº«æ˜¯ä¸èƒ½è¢«åˆ©ç”¨çš„ï¼Œä½†å®ƒä»¬æ³„éœ²å‡ºçš„ä¿¡æ¯å¯¹æ”»å‡»è€…æ˜¯æœ‰ç”¨çš„ã€‚ ICMP æ¶ˆæ¯æœ‰æ—¶ä¹Ÿè¢«ç”¨æ¥ä½œä¸º DOS æ”»å‡»çš„ä¸€éƒ¨åˆ† (ä¾‹å¦‚ï¼šæ´ªæ°´ ping flood ping,æ­» ping ?å‘µå‘µï¼Œæœ‰è¶£ ping of death)?p åŒ…ç¢ç‰‡æ³¨æ„ A Note About Packet Fragmentation å¦‚æœä¸€ä¸ªåŒ…çš„å¤§å°è¶…è¿‡äº† TCP çš„æœ€å¤§æ®µé•¿åº¦ MSS(Maximum Segment Size) æˆ– MTU (Maximum Transmission Unit)ï¼Œèƒ½å¤ŸæŠŠæ­¤åŒ…å‘å¾€ç›®çš„çš„å”¯ä¸€ æ–¹æ³•æ˜¯æŠŠæ­¤åŒ…åˆ†ç‰‡ã€‚ç”±äºåŒ…åˆ†ç‰‡æ˜¯æ­£å¸¸çš„ï¼Œå®ƒå¯ä»¥è¢«åˆ©ç”¨æ¥åšæ¶æ„çš„æ”»å‡»ã€‚ å› ä¸ºåˆ†ç‰‡çš„åŒ…çš„ç¬¬ä¸€ä¸ªåˆ†ç‰‡åŒ…å«ä¸€ä¸ªåŒ…å¤´ï¼Œè‹¥æ²¡æœ‰åŒ…åˆ†ç‰‡çš„é‡ç»„åŠŸèƒ½ï¼ŒåŒ…è¿‡æ»¤å™¨ä¸å¯èƒ½æ£€æµ‹é™„åŠ çš„åŒ…åˆ†ç‰‡ã€‚å…¸å‹çš„æ”»å‡» Typicalattacks involve in overlapping the packet data in which packet header is å…¸å‹çš„æ”»å‡» Typicalattacksinvolve in overlapping the packet data in which packet header isnormal until isit overwritten with different destination IP (or port) thereby bypassing firewall rulesã€‚åŒ…åˆ†ç‰‡èƒ½ä½œä¸º DOS æ”»å‡»çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒ å¯ä»¥ crash older IP stacks æˆ–æ¶¨æ­» CPU è¿æ¥èƒ½åŠ›ã€‚ NetfilterIptables ä¸­çš„è¿æ¥è·Ÿè¸ªä»£ç èƒ½è‡ªåŠ¨åšåˆ†ç‰‡é‡ç»„ã€‚å®ƒä»æœ‰å¼±ç‚¹ï¼Œå¯èƒ½å—åˆ°é¥±å’Œè¿æ¥æ”»å‡»ï¼Œå¯ä»¥æŠŠ CPU èµ„æºè€—å…‰ã€‚ OKï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œå…³äº Wireshark æŠ“åŒ…å·¥å…·çš„ä¸€äº›å°æ•™ç¨‹å·²ç»å†™å®Œäº†ï¼Œè€Œå¯¼è‡´æƒ³å†™è¿™ä¹ˆä¸€ä¸ªçº ç»“çš„æ•™ç¨‹çš„åŸå› æ˜¯ï¼Œå‰å‡ å¤©é€šè¿‡è¿™ä¸ªæŠ“åŒ…è§£å†³äº†æ¢¦å¹»è¥¿æ¸¸åœ¨ç½‘ç»´å¤§å¸ˆæ— ç›˜ä¸Šå®¹æ˜“æ‰çº¿çš„é—®é¢˜ï¼Œå½“æ—¶æ•æ‰åˆ°æ¢¦å¹»è¥¿æ¸¸æ‰çº¿æ—¶çš„æ•°æ®åŒ…æ˜¯è¿™æ ·çš„ã€‚ æ³¨æ„ä¸‹å›¾ä¸­çš„çº¢è‰²æ•°æ®ï¼Œ123.58.184.241 æ˜¯æ¢¦å¹»è¥¿æ¸¸çš„æœåŠ¡å™¨ï¼Œè€Œ 192.168.1.41 æ˜¯ç©æ¢¦å¹»è¥¿æ¸¸çš„å®¢æˆ·æœºï¼Œåœ¨æ‰çº¿æ—¶ï¼Œå‘ç°æ˜¯å…ˆæœ‰æ¢¦å¹»è¥¿æ¸¸çš„æœåŠ¡å™¨å‘å®¢æˆ·æœºå‘é€ä¸€ä¸ª [FIN,ACK] æ•°æ®åŒ…ï¼Œæ ¹æ®ä¸Šé¢çš„è§£é‡Šï¼ŒFIN æ ‡è®°çš„æ•°æ®åŒ…æ˜¯ä»£è¡¨è¦æ–­å¼€è¿æ¥çš„æ„æ€ï¼Œè€Œæ¥ç€å®¢æˆ·æœºåˆå›ç»™æœåŠ¡å™¨ä¸€ä¸ªç¡®è®¤æ–­ å¼€é“¾æ¥åŒ…ã€‚å½“çœ‹åˆ°è¿™ä¸ªæŠ“åŒ…æ•°æ®æ—¶ï¼Œå°±æ„è¯†åˆ°ï¼Œå¤§å®¶è¯´çš„åœ¨ç½‘ç»´å¤§å¸ˆç³»ç»Ÿè™šæ‹Ÿç›˜ä¸Šæ¢¦å¹»çˆ±æ‰çº¿çš„é—®é¢˜ï¼Œå¹¶éæ™®é€šçš„ç½‘ç»œé—®é¢˜ï¼Œå› ä¸ºé€šè¿‡æ•°æ®åŒ…çš„ä¿¡æ¯æ¥çœ‹ï¼Œæ˜¯æ¢¦å¹»æœ åŠ¡å™¨ä¸»åŠ¨è¦æ±‚æ–­å¼€é“¾æ¥ï¼Œäº§ç”Ÿè¿™ä¸ªæƒ…å†µæ— éæ˜¯ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š æœåŠ¡å™¨å‘ç°å®¢æˆ·ç«¯éæ³•ï¼Œæ¯”å¦‚æœ‰å¤–æŒ‚ä»€ä¹ˆçš„ï¼Œè¸¢æ‰äº†å®¢æˆ·æœºï¼› æœåŠ¡å™¨å‹åŠ›å¤§ï¼Œè¸¢æ‰äº†å®¢æˆ·æœºï¼› æ€»ä¹‹ä¸æ˜¯å®¢æˆ·ç«¯é—®é¢˜å¯¼è‡´çš„æ‰çº¿ï¼› é‚£ä¹ˆæ—¢ç„¶ç»“è®ºæ˜¯å¦‚æ­¤ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰åœ¨ç½‘ç»´å¤§å¸ˆç³»ç»Ÿè™šæ‹Ÿç›˜ä¸Šå®¹æ˜“å‡ºç°æ¢¦å¹»æ‰çº¿é—®é¢˜å‘¢ï¼ŸåŸå› æ˜¯ç”±äºç½‘ç»´å¤§å¸ˆç³»ç»Ÿè™šæ‹Ÿç›˜æ˜¯æ¨¡æ‹ŸçœŸå®ç¡¬ç›˜æ–¹å¼æ¥å®ç°çš„ï¼Œè€Œåœ¨æ¨¡æ‹Ÿè¿‡ç¨‹ ä¸­ï¼Œå°†ç¡¬ç›˜çš„åºåˆ—å·è®¾ç½®ä¸ºå›ºå®šè¿‡çš„ OSDIY888 äº†ï¼Œè€Œæ¢¦å¹»è¥¿æ¸¸åˆšå¥½åè¯†åˆ«å®¢æˆ·æœºç¡¬ç›˜ä¿¡æ¯ï¼Œå‘ç°å¤§é‡å®¢æˆ·ç«¯çš„ç¡¬ç›˜åºåˆ—å·éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå°±è®¤ä¸ºæ˜¯ä½œå¼Šæˆ–è€…ä½¿ ç”¨æŒ‚æœºå¤–æŒ‚äº†ï¼Œç»“æœå°±å¯¼è‡´éšæœºè¢«æœåŠ¡å™¨è¸¢ä¸‹çº¿çš„æƒ…å†µå‘ç”Ÿï¼Œåæ¥å°†ç¡¬ç›˜åºåˆ—å·è®¾ç½®ä¸ºç©ºï¼Œåˆ™æ²¡å†å‡ºç°è¯¥é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜åœ¨æœªæ¥çš„æ–°ç‰ˆæœ¬ä¸­ä¼šè§£å†³æ‰ã€‚ è¯´è¿™ä¸ªæ¡ˆä¾‹çš„ç›®çš„å¹¶ä¸æ˜¯ä¸ºäº†è¯´æ˜æŠ“åŒ…å¤šæœ‰ç”¨ï¼Œè€Œæ˜¯æƒ³è¯´æ˜ä¸€äº›è§£å†³é—®é¢˜çš„æ€è·¯å’Œæ–¹æ³•ï¼Œæœ‰äº›äººæ˜¯æœ‰æ€è·¯ï¼Œä½†æ˜¯ç¼ºæ–¹æ³•ï¼Œæ¯”å¦‚ä¸ä¼šç”¨å·¥å…·ï¼Œè€Œæœ‰äº›äººæ”¶é›†äº†å¾ˆå¤šå·¥å…· å´ä¸ä¼šç”¨ï¼Œè€Œå…¶å®å°±å±äºåè€…ï¼Œå‡ å¹´å‰å°±æ”¶é›†äº† n å¤šå·¥å…·ï¼Œä½†æ˜¯ç”¨åˆ°çš„æ²¡å‡ ä¸ªã€‚æ…¢æ…¢çš„å­¦ä¼šç”¨è¿™äº›å·¥å…·åï¼Œå‘ç°æ€ç»´ + å·¥å…·ï¼Œè§£å†³é—®é¢˜æ˜¯æ•ˆç‡æš´å¢ï¼Œæ¥ä¸‹æ¥çš„å‡ å¤© é‡Œï¼Œä¼šé™†ç»­ä»‹ç»å†™å°å·¥å…·ç»™å¤§å®¶ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶æœ‰ç©ºå­¦ä¹ ä¸‹ï¼Œæœ‰é—®é¢˜å…ˆç™¾åº¦ï¼Œå†è‡ªå·±æ‘¸ç´¢ï¼Œè€Œä¸æ˜¯ä¸€å‘³çš„æ±‚åŠ©ï¼Œæ¯•ç«Ÿæ±‚äººä¸å¦‚æ±‚å·±ï¼è‡ªå·±èƒ½ç›´æ¥æå®šï¼Œæ˜¯çš†å¤§æ¬¢å–œçš„äº‹æƒ… æ³¨æ„ï¼šç”±äºæŸäº›ç³»ç»Ÿä¸ºäº†é˜²æ­¢ ARP æ”»å‡»ï¼Œéƒ½å…ç–«æ‰äº†ä¸€ä¸ª Npptools.dll æ–‡ä»¶ï¼Œè¿™ä¼šå¯¼è‡´è¯¥è½¯ä»¶æ— æ³•æ­£å¸¸å®‰è£…ï¼Œæ‰“ä¸‹è¿™ä¸ªè¡¥ä¸å°±å¯ä»¥äº†","categories":["6.å¼€å‘å·¥å…·","æ•ˆç‡å·¥å…·","WireShark"]},{"title":"WireSharkè¿‡æ»¤å™¨","path":"/2023/05/22/6-å¼€å‘å·¥å…·-æ•ˆç‡å·¥å…·-WireShark-WireSharkè¿‡æ»¤å™¨/","content":"ä»€ä¹ˆæ˜¯ WiresharkWireshark æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„å¼€æºç½‘ç»œå°åŒ…åˆ†æè½¯ä»¶ï¼Œå¹¿æ³›åº”ç”¨äºç½‘ç»œç®¡ç†å’Œç½‘ç»œå®‰å…¨é¢†åŸŸã€‚è¿™æ¬¾è½¯ä»¶èƒ½å¤Ÿå®æ—¶æ•è·ã€åˆ†æå’Œå±•ç¤ºè®¡ç®—æœºç½‘ç»œä¸­çš„æ•°æ®åŒ…ï¼Œä¸ºç½‘ç»œä¸“ä¸šäººå‘˜æä¾›æ·±å…¥äº†è§£ç½‘ç»œæµé‡çš„å·¥å…·ã€‚ åŠŸèƒ½ä¸æ”¯æŒçš„åè®®Wireshark æ”¯æŒå¤šç§ç½‘ç»œåè®®ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š ä»¥å¤ªç½‘ï¼šç”¨äºå±€åŸŸç½‘çš„åŸºæœ¬ä¼ è¾“åè®®ã€‚ æ— çº¿ç½‘ç»œï¼šåˆ†æ Wi-Fi ç½‘ç»œæµé‡ï¼Œäº†è§£æ•°æ®çš„ä¼ è¾“æƒ…å†µã€‚ äº’è”ç½‘åè®®ï¼ˆIPï¼‰ï¼šå¤„ç†äº’è”ç½‘ä¸Šçš„åœ°å€å’Œè·¯ç”±ä¿¡æ¯ã€‚ ä¼ è¾“æ§åˆ¶åè®®ï¼ˆTCPï¼‰ï¼šç¡®ä¿æ•°æ®çš„å¯é ä¼ è¾“ï¼Œæä¾›æµé‡æ§åˆ¶å’Œé”™è¯¯æ ¡éªŒã€‚ ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼ˆUDPï¼‰ï¼šç”¨äºé€Ÿåº¦è¦æ±‚é«˜ä½†ä¸éœ€è¦å¯é æ€§çš„åº”ç”¨ï¼Œå¦‚è§†é¢‘æµå’Œåœ¨çº¿æ¸¸æˆã€‚ æ•è·æ•°æ®åŒ…ä½¿ç”¨ Wireshark æ—¶ï¼Œç”¨æˆ·åªéœ€é€šè¿‡è¿æ¥åˆ°ç›®æ ‡è®¡ç®—æœºç½‘ç»œçš„æ¥å£ï¼ˆå¦‚ä»¥å¤ªç½‘å£æˆ–æ— çº¿ç½‘å¡ï¼‰æ¥æ•è·ç½‘ç»œæ•°æ®åŒ…ã€‚æ•è·çš„æ•°æ®åŒ…å°†ä»¥ç›´è§‚çš„æ–¹å¼åœ¨è½¯ä»¶ç•Œé¢ä¸­æ˜¾ç¤ºã€‚æ¯ä¸ªæ•°æ®åŒ…çš„è¯¦ç»†ä¿¡æ¯ä¸€ç›®äº†ç„¶ï¼ŒåŒ…æ‹¬ï¼š æº IP åœ°å€ï¼šæ•°æ®åŒ…å‘é€æ–¹çš„åœ°å€ã€‚ ç›®æ ‡ IP åœ°å€ï¼šæ•°æ®åŒ…æ¥æ”¶æ–¹çš„åœ°å€ã€‚ åè®®ç±»å‹ï¼šæŒ‡ç¤ºä½¿ç”¨çš„åè®®ï¼ˆå¦‚ TCPã€UDPï¼‰ã€‚ æ•°æ®é•¿åº¦ï¼šæ•´ä¸ªæ•°æ®åŒ…çš„å­—èŠ‚æ•°ã€‚ ç”¨æˆ·å¯ä»¥é€šè¿‡ç®€å•çš„ç‚¹å‡»æ“ä½œï¼Œæ·±å…¥æŸ¥çœ‹æ¯ä¸ªæ•°æ®åŒ…çš„å­—æ®µåŠå…¶å†…å®¹ï¼Œå¸®åŠ©åˆ†ææµé‡ä¸­å¯èƒ½å­˜åœ¨çš„é—®é¢˜ã€‚ è¿‡æ»¤ä¸åˆ†æå·¥å…·Wireshark æä¾›å¼ºå¤§çš„è¿‡æ»¤åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·æ ¹æ®ç‰¹å®šæ¡ä»¶ç­›é€‰æ•°æ®åŒ…ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æ ¹æ®æº IP åœ°å€ã€ç›®æ ‡ IP åœ°å€ã€åè®®ç±»å‹ç­‰è¿‡æ»¤æ•°æ®ï¼Œä»è€Œé›†ä¸­æ³¨æ„åŠ›äºæ„Ÿå…´è¶£çš„æµé‡ã€‚æ­¤å¤–ï¼ŒWireshark è¿˜æä¾›äº†ä¸€ç³»åˆ—åˆ†æå·¥å…·å’Œç»Ÿè®¡åŠŸèƒ½ï¼š æµé‡å›¾è¡¨ï¼šå¯è§†åŒ–å±•ç¤ºç½‘ç»œæµé‡çš„å˜åŒ–è¶‹åŠ¿ï¼Œä¾¿äºè¯†åˆ«æµé‡é«˜å³°æˆ–å¼‚å¸¸æƒ…å†µã€‚ åè®®åˆ†å±‚æ˜¾ç¤ºï¼šç›´è§‚æ˜¾ç¤ºå„ç§åè®®çš„åˆ†å±‚ç»“æ„ï¼Œå¸®åŠ©ç”¨æˆ·ç†æ¸…æ•°æ®äº¤äº’çš„é€»è¾‘ã€‚ æ•°æ®åŒ…é‡ç»„ï¼šå°†åˆ†æ•£çš„å¤šä¸ªæ•°æ®åŒ…é‡æ–°ç»„åˆï¼Œä¾¿äºåˆ†æå®Œæ•´çš„é€šä¿¡å†…å®¹ã€‚ åº”ç”¨åœºæ™¯Wireshark åœ¨å¤šä¸ªé¢†åŸŸå¾—åˆ°äº†å¹¿æ³›åº”ç”¨ï¼Œå¦‚ï¼š ç½‘ç»œç®¡ç†ï¼šç½‘ç»œç®¡ç†å‘˜ä½¿ç”¨ Wireshark æ¥è¯Šæ–­ç½‘ç»œæ•…éšœï¼Œå¦‚å»¶è¿Ÿã€ä¸¢åŒ…å’Œè¿æ¥é—®é¢˜ï¼Œå¸®åŠ©ç¡®ä¿ç½‘ç»œæ­£å¸¸è¿è¡Œã€‚ ç½‘ç»œå®‰å…¨ï¼šé€šè¿‡åˆ†ææ•°æ®åŒ…ï¼Œå®‰å…¨ä¸“ä¸šäººå‘˜å¯ä»¥æ£€æµ‹æ½œåœ¨çš„ç½‘ç»œæ”»å‡»å’Œå¼‚å¸¸æ´»åŠ¨ï¼Œä»è€Œé‡‡å–é€‚å½“çš„å®‰å…¨æªæ–½ã€‚ åè®®å¼€å‘ä¸è°ƒè¯•ï¼šå¼€å‘è€…åˆ©ç”¨ Wireshark æ£€æŸ¥è‡ªå®šä¹‰åè®®çš„å®ç°ï¼Œè°ƒè¯•ç½‘ç»œé€šä¿¡ï¼Œæé«˜è½¯ä»¶çš„å¥å£®æ€§ã€‚ æ€»çš„æ¥è¯´ï¼ŒWireshark å‡­å€Ÿå…¶å¼ºå¤§çš„åŠŸèƒ½ã€ç”¨æˆ·å‹å¥½çš„ç•Œé¢å’Œå¼€æ”¾æºä»£ç çš„ç‰¹æ€§ï¼Œå·²ç»æˆä¸ºç½‘ç»œåˆ†æé¢†åŸŸçš„æ ‡å‡†å·¥å…·ä¹‹ä¸€ï¼Œæ·±å—ä¸šç•Œä¸“ä¸šäººå£«çš„å–œçˆ±ã€‚ è¿‡æ»¤å™¨åœ¨ Wireshark ä¸­ï¼Œè¿‡æ»¤å™¨ï¼ˆFilterï¼‰æ˜¯ä¸€ç§å¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºé€‰æ‹©å’Œç­›é€‰ç‰¹å®šçš„ç½‘ç»œæ•°æ®åŒ…ä»¥ä¾›æ·±å…¥åˆ†æã€‚é€šè¿‡è¿‡æ»¤å™¨ï¼Œç”¨æˆ·èƒ½å¤Ÿæœ‰é’ˆå¯¹æ€§åœ°æ˜¾ç¤ºæ„Ÿå…´è¶£çš„æ•°æ®åŒ…ï¼Œä»è€Œæœ‰æ•ˆå‡å°‘åˆ†æçš„æ•°æ®é‡ï¼Œå¹¶ä¸“æ³¨äºä¸ç‰¹å®šé—®é¢˜ã€äº‹ä»¶æˆ–åè®®ç›¸å…³çš„ä¿¡æ¯ï¼Œæå‡æ•´ä½“çš„åˆ†ææ•ˆç‡ã€‚ Wireshark é‡‡ç”¨ä¸€ç§ç§°ä¸ºâ€æ˜¾ç¤ºè¿‡æ»¤å™¨â€ï¼ˆDisplay Filterï¼‰çš„è¯­æ³•æ¥å®šä¹‰è¿‡æ»¤æ¡ä»¶ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®å¤šä¸ªå‚æ•°æ¥åˆ›å»ºç²¾ç»†çš„è¿‡æ»¤å™¨è§„åˆ™ï¼Œä¾‹å¦‚æº IP åœ°å€ã€ç›®æ ‡ IP åœ°å€ã€åè®®ç±»å‹ï¼ˆå¦‚ TCP æˆ– UDPï¼‰ã€ç«¯å£å·ã€æ•°æ®åŒ…é•¿åº¦ï¼Œä»¥åŠç‰¹å®šå­—æ®µçš„å€¼ç­‰ã€‚å½“è¿™äº›è¿‡æ»¤å™¨åº”ç”¨äºç½‘ç»œæ•°æ®åŒ…æ•è·æˆ–å·²ä¿å­˜çš„æ•°æ®åŒ…æ—¶ï¼Œåªæœ‰ç¬¦åˆè¿™äº›æ¡ä»¶çš„æ•°æ®åŒ…ä¼šè¢«æ˜¾ç¤ºï¼Œå…¶ä»–ä¸ç›¸å…³çš„æ•°æ®åŒ…åˆ™ä¼šè¢«è‡ªåŠ¨éšè—ã€‚ ä¾‹å¦‚ï¼Œè‹¥å¸Œæœ›åˆ†ææ¥è‡ªç‰¹å®šæœåŠ¡å™¨ï¼ˆæº IP åœ°å€ï¼‰åˆ°å®¢æˆ·ç«¯çš„æ‰€æœ‰ TCP é€šä¿¡æµé‡ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼ ip.src == 192.168.1.1 tcp çš„è¿‡æ»¤å™¨ã€‚è¿™ç§æ–¹å¼ä¸ä½†ç¼©å°äº†éœ€è¦æŸ¥çœ‹çš„æ•°æ®åŒ…èŒƒå›´ï¼Œè¿˜èƒ½è®©åˆ†æäººå‘˜æ›´å¿«é€Ÿåœ°è¯„ä¼°è¿™äº›æ•°æ®åŒ…çš„å†…å®¹å’ŒçŠ¶æ€ã€‚ Wireshark æä¾›äº†ä¸°å¯Œçš„è¿‡æ»¤å™¨è¯­æ³•å’ŒåŠŸèƒ½ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ ¹æ®ä¸åŒéœ€æ±‚åˆ›å»ºå¤æ‚çš„è¿‡æ»¤æ ‡å‡†ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆå¦‚ ==, !=, , ç­‰ï¼‰ã€é€»è¾‘è¿ç®—ç¬¦ï¼ˆå¦‚ , ||, !ï¼‰å’Œé€šé…ç¬¦ï¼Œæ„å»ºæ›´ç²¾ç¡®çš„è¿‡æ»¤è§„åˆ™ã€‚åŒæ—¶ï¼Œå¯ä»¥é€šè¿‡ç»„åˆå¤šä¸ªæ¡ä»¶ï¼Œå®šä¹‰å‡ºæ›´ä¸ºå¤æ‚çš„è¿‡æ»¤å™¨ï¼Œä»¥ä¾¿æ›´å¥½åœ°è·å–ç›¸å…³æ•°æ®ã€‚ åœ¨ç½‘ç»œåˆ†æå’Œæ•…éšœæ’é™¤è¿‡ç¨‹ä¸­ï¼Œè¿‡æ»¤å™¨æä¸ºé‡è¦ã€‚å®ƒä»¬ä¸ä»…å¸®åŠ©åˆ†æäººå‘˜æœ‰æ•ˆé›†ä¸­æ³¨æ„åŠ›äºç‰¹å®šæ•°æ®åŒ…ï¼Œè¿˜æä¾›äº†æ›´æ¸…æ™°ã€æœ‰é’ˆå¯¹æ€§çš„åˆ†æè§†è§’ã€‚è¿™å¯¹äºå¤„ç†å¤æ‚ç½‘ç»œé—®é¢˜å’Œä¼˜åŒ–ç½‘ç»œæ€§èƒ½ï¼Œæœ‰ç€ä¸å¯æˆ–ç¼ºçš„ä½œç”¨ã€‚ è¿‡æ»¤å™¨çš„åŒºåˆ«Wireshark ä¸­å­˜åœ¨ä¸¤ç§ä¸»è¦çš„è¿‡æ»¤å™¨ï¼šæ•æ‰è¿‡æ»¤å™¨ï¼ˆCapture Filtersï¼‰å’Œæ˜¾ç¤ºè¿‡æ»¤å™¨ï¼ˆDisplay Filtersï¼‰ï¼Œå®ƒä»¬çš„ä½œç”¨å’Œè¯­æ³•æˆªç„¶ä¸åŒã€‚ æ•æ‰è¿‡æ»¤å™¨æ•æ‰è¿‡æ»¤å™¨ç”¨äºå†³å®šåœ¨è¿›è¡Œæ•°æ®æ•æ‰æ—¶ï¼Œå“ªäº›ä¿¡æ¯åº”è¯¥è¢«è®°å½•åœ¨æ•æ‰ç»“æœä¸­ã€‚è¿™äº›è¿‡æ»¤å™¨å¿…é¡»åœ¨æ•æ‰è¿‡ç¨‹å¼€å§‹ä¹‹å‰è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä»…éœ€æ•æ‰ TCP æµé‡ï¼Œå¯ä»¥è®¾ç½®è¿‡æ»¤å™¨ä¸º tcpï¼Œè¿™æ ·å°±åªä¼šè®°å½• TCP åè®®çš„æ•°æ®åŒ…ï¼Œè€Œå¿½ç•¥å…¶ä»–ç±»å‹çš„æµé‡ã€‚æ•æ‰è¿‡æ»¤å™¨ä½œä¸ºæ•°æ®æ•æ‰çš„ç¬¬ä¸€å±‚è¿‡æ»¤ï¼Œç›®çš„æ˜¯æ§åˆ¶æ•æ‰æ•°æ®çš„æ•°é‡ï¼Œä»è€Œé¿å…ç”Ÿæˆè¿‡å¤§çš„æ—¥å¿—æ–‡ä»¶ï¼Œè¿™å¯¹äºå­˜å‚¨å’Œåç»­åˆ†æéƒ½æœ‰æ˜¾è‘—çš„ç›Šå¤„ã€‚ æ˜¾ç¤ºè¿‡æ»¤å™¨æ˜¾ç¤ºè¿‡æ»¤å™¨åˆ™æ˜¯åœ¨æ•æ‰ç»“æœä¸­è¿›è¡Œè¯¦ç»†æŸ¥æ‰¾çš„å·¥å…·ã€‚åœ¨æ•æ‰å®Œæˆåï¼Œå®ƒå¯ä»¥éšæ—¶è¢«ä¿®æ”¹ï¼Œä»¥ä¾¿å¸®åŠ©ç”¨æˆ·å¿«é€Ÿå®šä½æ‰€éœ€çš„è®°å½•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨æ•æ‰è¿‡ç¨‹ä¸­è®°å½•äº†å¤§é‡çš„æ•°æ®åŒ…ï¼Œç”¨æˆ·å¯ä»¥ä¹‹ååº”ç”¨æ˜¾ç¤ºè¿‡æ»¤å™¨ httpï¼Œè¿…é€Ÿæ‰¾åˆ°å…¶ä¸­çš„ HTTP è¯·æ±‚ä¸å“åº”ã€‚è¿™ç§çµæ´»æ€§ä½¿å¾—æ˜¾ç¤ºè¿‡æ»¤å™¨æˆä¸ºä¸€ç§æ›´ä¸ºå¼ºå¤§å’Œå¤æ‚çš„è¿‡æ»¤æ‰‹æ®µã€‚ æ€»ç»“è€Œè¨€ï¼Œæ•æ‰è¿‡æ»¤å™¨ä¸æ˜¾ç¤ºè¿‡æ»¤å™¨çš„ç›®çš„å’Œä½¿ç”¨åœºæ™¯å®Œå…¨ä¸åŒã€‚æ•æ‰è¿‡æ»¤å™¨æ˜¯åœ¨æ•°æ®æ•æ‰ä¹‹åˆè¿›è¡Œçš„ç¬¬ä¸€é“é˜²çº¿ï¼Œè€Œæ˜¾ç¤ºè¿‡æ»¤å™¨åˆ™æ˜¯åç»­åˆ†ææ—¶ç”¨äºç²¾ç¡®æŸ¥æ‰¾çš„é«˜çº§å·¥å…·ï¼Œå®ƒä»¬å…±åŒæ„æˆäº† Wireshark å¼ºå¤§çš„åˆ†æèƒ½åŠ›ï¼Œå¸®åŠ©ç”¨æˆ·æœ‰æ•ˆè§£æå’Œç†è§£ç½‘ç»œæµé‡ã€‚ æ•æ‰è¿‡æ»¤å™¨Protocolï¼ˆåè®®ï¼‰:å¯èƒ½çš„å€¼ï¼šetherã€fddiã€ipã€arpã€rarpã€decnetã€latã€scaã€moprcã€mopdlã€tcp å’Œ udpã€‚ å¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡æ˜åè®®ï¼Œè¿‡æ»¤å™¨å°†é»˜è®¤ä½¿ç”¨æ‰€æœ‰æ”¯æŒçš„åè®®ã€‚ä¾‹å¦‚ï¼Œæ•æ‰æ‰€æœ‰é€šè¿‡ç½‘ç»œä¼ è¾“çš„æ•°æ®æ—¶ï¼Œå¯ä»¥ç®€å•åœ°çœç•¥åè®®å‚æ•°ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è·å–æ‰€æœ‰å¯ç”¨çš„ä¼ è¾“åè®®æ•°æ®ã€‚ Directionï¼ˆæ–¹å‘ï¼‰:å¯èƒ½çš„å€¼ï¼šsrcï¼ˆæ¥æºï¼‰ã€dstï¼ˆç›®çš„åœ°ï¼‰ã€src and dstï¼ˆæ¥æºå’Œç›®çš„åœ°ï¼‰ã€src or dstï¼ˆæ¥æºæˆ–ç›®çš„åœ°ï¼‰ã€‚ è‹¥æœªç‰¹åˆ«æŒ‡å®šï¼Œåˆ™é»˜è®¤å€¼ä¸º src or dstã€‚ä¸¾ä¸ªä¾‹å­ï¼Œè¡¨è¾¾å¼ host 10.2.2.2 ä¸ src or dst host 10.2.2.2 æ˜¯ç›¸åŒçš„ï¼Œçš†å¯æ•æ‰ç›®çš„åœ°æˆ–æ¥æºä¸º 10.2.2.2 çš„å°åŒ…ã€‚ Host(s):å¯èƒ½çš„å€¼ï¼šnetï¼ˆç½‘ç»œï¼‰ã€portï¼ˆç«¯å£ï¼‰ã€hostï¼ˆä¸»æœºï¼‰ã€portrangeï¼ˆç«¯å£èŒƒå›´ï¼‰ã€‚ è‹¥æœªæŒ‡å®šï¼Œæ­¤å€¼é»˜è®¤ä¸º hostã€‚ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼ src 10.1.1.1 å’Œ src host 10.1.1.1 æ˜¯ç­‰æ•ˆçš„ï¼Œä¼šæ•æ‰æ‰€æœ‰æ¥æºåœ°å€ä¸º 10.1.1.1 çš„å°åŒ…ã€‚ Logical Operationsï¼ˆé€»è¾‘è¿ç®—ï¼‰:å¯èƒ½çš„å€¼ï¼šnotï¼ˆå¦ï¼‰ã€andï¼ˆä¸ï¼‰ã€orï¼ˆæˆ–ï¼‰ã€‚ è¿ç®—æ—¶ï¼Œnot ä¼˜å…ˆçº§æœ€é«˜ï¼Œand å’Œ or ä¼˜å…ˆçº§ç›¸åŒï¼Œå¹¶æŒ‰é¡ºåºä»å·¦è‡³å³è¿›è¡Œã€‚ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼ not tcp port 3128 and tcp port 23 ä¸ (not tcp port 3128) and tcp port 23 æ˜¯ç­‰æ•ˆçš„ï¼Œè€Œ not tcp port 3128 and tcp port 23 ä¸ not (tcp port 3128 and tcp port 23) ä¸åŒã€‚ ç¤ºä¾‹ï¼š tcp dst port 3128æ•æ‰ç›®çš„ TCP ç«¯å£ä¸º 3128 çš„å°åŒ…ï¼Œè¿™é€šå¸¸ç”¨äºä»£ç†æœåŠ¡ã€‚ ip src host 10.1.1.1æ•æ‰æ¥æº IP åœ°å€ä¸º 10.1.1.1 çš„å°åŒ…ï¼Œé€‚ç”¨äºç›‘æ§ç‰¹å®šè®¾å¤‡çš„æµé‡ã€‚ host 10.1.2.3æ•æ‰ç›®çš„æˆ–æ¥æº IP åœ°å€ä¸º 10.1.2.3 çš„å°åŒ…ï¼Œè¿™ç¡®ä¿äº†ä¸è¯¥åœ°å€çš„æ‰€æœ‰æ•°æ®åŒ…éƒ½ä¸è¢«é—æ¼ã€‚ ether host e0-05-c5-44-b1-3cæ•æ‰ç›®çš„æˆ–æ¥æº MAC åœ°å€ä¸º e0-05-c5-44-b1-3c çš„å°åŒ…ã€‚å¦‚æœéœ€è¦ç›‘æ§æœ¬æœºä¸å¤–éƒ¨ç½‘ç»œä¹‹é—´çš„æ•°æ®æµï¼Œå¯ä»¥æ›¿æ¢ä¸ºè·¯ç”±å™¨çš„ MAC åœ°å€ä»¥æ•æ‰ç›¸åº”æµé‡ã€‚ src portrange 2000-2500æ•æ‰æ¥æºç«¯å£ä¸º 2000 è‡³ 2500 èŒƒå›´å†…çš„ UDP æˆ– TCP å°åŒ…ï¼Œè¿™å¸¸ç”¨äºç‰¹å®šæœåŠ¡å¦‚æ¸¸æˆæˆ–æ–‡ä»¶ä¼ è¾“åè®®ã€‚ not icmpæ˜¾ç¤ºé™¤äº† ICMP å°åŒ…ä»¥å¤–çš„æ‰€æœ‰å°åŒ…ï¼Œæ–¹ä¾¿åˆ†æé™¤ ping ä»¥å¤–çš„ç½‘ç»œè¡Œä¸ºã€‚ src host 10.7.2.12 and not dst net 10.200.0.0/16æ˜¾ç¤ºæ¥æº IP ä¸º 10.7.2.12ï¼Œä½†ç›®çš„åœ°ä¸æ˜¯ 10.200.0.0/16 çš„å°åŒ…ï¼Œé€‚ç”¨äºç‰¹å®šçš„æµé‡ç›‘æ§å’Œå®‰å…¨ç­–ç•¥ã€‚ (src host 10.4.1.12 or src net 10.6.0.0/16) and tcp dst portrange 200-10000 and dst net 10.0.0.0/8æ•æ‰æ¥æº IP ä¸º 10.4.1.12 æˆ–æ¥æºç½‘ç»œä¸º 10.6.0.0/16ï¼ŒåŒæ—¶ç›®çš„åœ° TCP ç«¯å£å·åœ¨ 200 è‡³ 10000 ä¹‹é—´ï¼Œå¹¶ä¸”ç›®çš„åœ°ä½äºç½‘ç»œ 10.0.0.0/8 å†…çš„æ‰€æœ‰å°åŒ…ï¼Œç”¨äºå¹¿æ³›çš„æ•°æ®åˆ†æã€‚ src net 192.168.0.0/24æ•æ‰æºåœ°å€ä¸º 192.168.0.0 ç½‘ç»œå†…çš„æ‰€æœ‰å°åŒ…ï¼Œé€‚ç”¨äºå†…éƒ¨ç½‘ç»œç›‘æ§ã€‚ src net 192.168.0.0 mask 255.255.255.0åŒæ ·æ•æ‰æºåœ°å€ä¸º 192.168.0.0 ç½‘ç»œå†…çš„æ‰€æœ‰å°åŒ…ï¼Œå¯ç”¨äºç½‘ç»œç®¡ç†å’Œé—®é¢˜æ’æŸ¥ã€‚ æ³¨æ„äº‹é¡¹ï¼š ä½¿ç”¨å…³é”®å­—ä½œä¸ºå€¼æ—¶ï¼Œéœ€åœ¨å…³é”®å­—å‰åŠ ä¸Šåæ–œæ  \\ã€‚ ç¤ºä¾‹ï¼šether proto \\ipï¼ˆä¸å…³é”®å­— ip ç›¸åŒï¼‰ã€‚è¿™æ ·çš„è¡¨è¾¾æ–¹å¼ä¼šä½¿å¾—è¿‡æ»¤å™¨å…³æ³¨ IP åè®®ã€‚ å¦ä¸€ç§å†™æ³•ï¼šip proto \\icmpï¼ˆä¸å…³é”®å­— icmp ç›¸åŒï¼‰ã€‚è¯¥å†™æ³•è¡¨ç¤ºéœ€è¦æ•æ‰ä¸ ping å·¥å…·é€šä¿¡ç”¨çš„ ICMP åè®®ç›¸å…³çš„æ•°æ®åŒ…ã€‚ å¯ä»¥åœ¨ ip æˆ– ether åé¢ä½¿ç”¨ multicast åŠ broadcast å…³é”®å­—ã€‚ä¾‹å¦‚ï¼Œå½“æƒ³è¦æ’é™¤å¹¿æ’­è¯·æ±‚æ—¶ä½¿ç”¨ no broadcast å…³é”®å­—æ—¶éå¸¸æœ‰æ•ˆã€‚ Protocolï¼ˆåè®®ï¼‰:ä½¿ç”¨ OSI æ¨¡å‹ç¬¬ 2 è‡³ 7 å±‚çš„å¤šç§åè®®ã€‚ç‚¹å‡» â€œExpressionâ€¦â€ æŒ‰é’®å°†æ˜¾ç¤ºå¯ç”¨åè®®ï¼Œå¦‚ IPã€TCPã€DNSã€SSH ç­‰ï¼Œä¾¿äºç”¨æˆ·é€‰æ‹©ã€‚ String1, String2 (å¯é€‰é¡¹):æä¾›æ›´è¯¦ç»†çš„åŒ¹é…æ¡ä»¶ã€‚ åè®®çš„å­ç±»:ç‚¹å‡»ç›¸å…³çˆ¶ç±»æ—çš„ â€œ+â€ å·ï¼Œç„¶åé€‰æ‹©å…¶å­ç±»ï¼Œèƒ½å¤Ÿè¿›ä¸€æ­¥ç²¾ç»†åŒ–æ•°æ®åŒ…çš„æ•æ‰æ¡ä»¶ã€‚ ä½¿ç”¨æ­¤æ•æ‰è¿‡æ»¤å™¨å¯ä»¥é«˜æ•ˆç®¡ç†å’Œç›‘æ§ç½‘ç»œæµé‡ï¼Œå¸®åŠ©æ’æŸ¥æ½œåœ¨çš„å®‰å…¨é—®é¢˜æˆ–ç½‘ç»œæ•…éšœã€‚ æ˜¾ç¤ºè¿‡æ»¤å™¨è¿‡æ»¤å™¨ç”¨äºæ•è·å’Œæ˜¾ç¤ºç‰¹å®šç±»å‹çš„æ•°æ®åŒ…ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„è¿‡æ»¤æ¡ä»¶åŠå…¶è§£é‡Šï¼š ä¾‹å­ snmp || dns || icmpè¿™ä¸ªè¿‡æ»¤å™¨ç”¨äºæ˜¾ç¤º SNMPã€DNS æˆ– ICMP å°åŒ…ã€‚ä½¿ç”¨è¿™ä¸ªè¿‡æ»¤å™¨æ—¶ï¼Œä»»ä½•ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å°åŒ…éƒ½ä¼šè¢«æ˜¾ç¤ºã€‚ ip.addr == 10.1.1.1ç”¨äºæ˜¾ç¤ºæ‰€æœ‰æ¥æºæˆ–ç›®çš„ IP åœ°å€ä¸º 10.1.1.1 çš„å°åŒ…ã€‚è¿™æ„å‘³ç€æ— è®ºæ˜¯å‘èµ·è¿æ¥çš„è®¾å¤‡ï¼Œè¿˜æ˜¯æ¥æ”¶è¿æ¥çš„è®¾å¤‡ï¼Œä»»ä¸€æ–¹ä¸ºè¿™ä¸ª IP åœ°å€çš„å°åŒ…éƒ½ä¼šè¢«è¿‡æ»¤å‡ºæ¥ã€‚ ip.src != 10.1.2.3 or ip.dst != 10.4.5.6è¯¥è¿‡æ»¤å™¨ä¼šæ˜¾ç¤ºæ¥æºä¸ä¸º 10.1.2.3 æˆ–è€…ç›®çš„ä¸ä¸º 10.4.5.6 çš„å°åŒ…ã€‚æ¢å¥è¯è¯´ï¼Œæ˜¾ç¤ºå°åŒ…çš„æ¡ä»¶ä¸ºï¼š æ¥æº IPï¼šä»»æ„ IPï¼Œä½†ä¸æ˜¯ 10.1.2.3 ç›®çš„ IPï¼šä»»æ„ IPï¼Œä½†ä¸æ˜¯ 10.4.5.6 ip.src != 10.1.2.3 and ip.dst != 10.4.5.6è¿™ä¸ªè¿‡æ»¤å™¨ç”¨äºæ˜¾ç¤ºæ¥æº IP ä¸ä¸º 10.1.2.3 ä¸”ç›®çš„ IP ä¸ä¸º 10.4.5.6 çš„å°åŒ…ã€‚è¦æ±‚åŒæ—¶æ»¡è¶³æ¥æºå’Œç›®çš„ IP çš„æ¡ä»¶ï¼Œå‡†ç¡®å–å‡ºæ›´ä¸ºç‰¹å®šçš„å°åŒ…ã€‚ æ¥æº IPï¼šä»»æ„ IPï¼Œä½†ä¸æ˜¯ 10.1.2.3 ç›®çš„ IPï¼šä»»æ„ IPï¼Œä½†ä¸æ˜¯ 10.4.5.6 tcp.port == 25æ­¤è¿‡æ»¤å™¨æ˜¾ç¤ºæ¥æºæˆ–ç›®çš„ TCP ç«¯å£å·ä¸º 25 çš„å°åŒ…ï¼Œé€šå¸¸ç”¨äºè¯†åˆ«å’Œåˆ†æä¸ç”µå­é‚®ä»¶ç›¸å…³çš„æµé‡ï¼Œå› ä¸ºç«¯å£ 25 æ˜¯é‚®ä»¶ä¼ è¾“ä»£ç†ï¼ˆMTAï¼‰ä½¿ç”¨çš„æ ‡å‡†ç«¯å£ã€‚ tcp.dstport == 25æ˜¾ç¤ºç›®çš„ TCP ç«¯å£å·ä¸º 25 çš„å°åŒ…ï¼Œåªå…³æ³¨é‚£äº›å‘å¾€ç‰¹å®šç«¯å£çš„æµé‡ï¼Œé€‚åˆç”¨æ¥ç›‘æ§é‚®ç®±æœåŠ¡å™¨çš„æµé‡ã€‚ tcp.flagsæ­¤è¿‡æ»¤å™¨æ˜¾ç¤ºæ‰€æœ‰åŒ…å« TCP æ ‡å¿—çš„å°åŒ…ã€‚æ­¤æ—¶å¯ä»¥æ·±å…¥åˆ†æ TCP è¿æ¥çš„æ§åˆ¶ä¿¡æ¯ï¼Œå¦‚ SYNã€ACK å’Œ FIN ç­‰ã€‚ tcp.flags.syn == 0x02ç”¨äºæ˜¾ç¤ºåŒ…å« TCP SYN æ ‡å¿—çš„å°åŒ…ï¼Œå¸¸ç”¨äºå»ºç«‹æ–°è¿æ¥æ—¶çš„åˆå§‹è¯·æ±‚ã€‚TCP ä¸‰æ¬¡æ¡æ‰‹çš„ç¬¬ä¸€æ­¥å°±æ˜¯å‘é€ SYN åŒ…ä»¥è¯·æ±‚å»ºç«‹è¿æ¥ã€‚ ä¸€æ—¦è®¾ç½®äº†è¿‡æ»¤å™¨ï¼Œè½¯ä»¶ç•Œé¢ä¼šæ ¹æ®è¿‡æ»¤å™¨çš„è¯­æ³•å¯¹è¡¨è¾¾å¼è¿›è¡Œé¢œè‰²ç¼–ç ã€‚æ­£ç¡®çš„è¿‡æ»¤å™¨èƒŒæ™¯å‘ˆç»¿è‰²ï¼ŒæŒ‡ç¤ºæ²¡æœ‰è¯­æ³•é”™è¯¯ï¼›è€Œé”™è¯¯çš„è¿‡æ»¤å™¨èƒŒæ™¯å‘ˆçº¢è‰²ï¼Œæç¤ºç”¨æˆ·è¿›è¡Œä¿®æ­£ã€‚ æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·è®¿é—® Wireshark è¿‡æ»¤å™¨æŒ‡å—ã€‚ æ•°æ®åŒ…çš„åˆ†æä»¥ä¸Šä»…ä»‹ç»äº†åŸºæœ¬çš„æŠ“å–å’Œè¿‡æ»¤æ–¹æ³•ï¼Œä½†è‹¥æƒ³æ·±å…¥åˆ†æç½‘ç»œåŒ…ï¼Œè¿˜éœ€äº†è§£å¸¸è§çš„åè®®æ ‡è®°å’Œæ“ä½œè¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼ŒTCP çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œç”±ä¸‰ä¸ªä¸»è¦æ­¥éª¤ç»„æˆï¼š SYNï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªå¸¦æœ‰ SYN æ ‡å¿—çš„æ•°æ®åŒ…ï¼Œè¡¨ç¤ºè¯·æ±‚å»ºç«‹è¿æ¥ã€‚ SYN-ACKï¼šæœåŠ¡å™¨å›åº”å®¢æˆ·ç«¯ï¼Œå‘é€ä¸€ä¸ªåŒæ—¶å¸¦æœ‰ SYN å’Œ ACK æ ‡å¿—çš„æ•°æ®åŒ…ï¼Œç¡®è®¤æ¥æ”¶åˆ°çš„è¯·æ±‚ã€‚ ACKï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ ACK æ•°æ®åŒ…ï¼Œç¡®è®¤è¿æ¥æˆåŠŸã€‚ ç†è§£è¿™äº›æ­¥éª¤æœ‰åŠ©äºåˆ†æç½‘ç»œé€šä¿¡è¿‡ç¨‹ï¼Œè¯†åˆ«è¿æ¥æ˜¯å¦æˆåŠŸä»¥åŠå­˜åœ¨çš„æ½œåœ¨é—®é¢˜ã€‚","categories":["6.å¼€å‘å·¥å…·","æ•ˆç‡å·¥å…·","WireShark"]}]